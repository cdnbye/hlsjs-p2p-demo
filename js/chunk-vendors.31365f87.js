(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-vendors"],{"007d":function(e,t,n){var i=n("3eba");n("cb8f"),n("a96b"),n("42f6"),i.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},function(){}),i.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},function(){})},"0156":function(e,t,n){var i=n("6d8b");function r(e,t,n){n=n||{};var r=e.coordinateSystem,a=t.axis,s={},o=a.getAxesOnZeroOf()[0],l=a.position,u=o?"onZero":l,c=a.dim,d=r.getRect(),h=[d.x,d.x+d.width,d.y,d.y+d.height],f={left:0,right:1,top:0,bottom:1,onZero:2},p=t.get("offset")||0,g="x"===c?[h[2]-p,h[3]+p]:[h[0]-p,h[1]+p];if(o){var m=o.toGlobalCoord(o.dataToCoord(0));g[f["onZero"]]=Math.max(Math.min(m,g[1]),g[0])}s.position=["y"===c?g[f[u]]:h[0],"x"===c?g[f[u]]:h[3]],s.rotation=Math.PI/2*("x"===c?0:1);var v={top:-1,bottom:1,left:-1,right:1};s.labelDirection=s.tickDirection=s.nameDirection=v[l],s.labelOffset=o?g[f[l]]-g[f["onZero"]]:0,t.get("axisTick.inside")&&(s.tickDirection=-s.tickDirection),i.retrieve(n.labelInside,t.get("axisLabel.inside"))&&(s.labelDirection=-s.labelDirection);var y=t.get("axisLabel.rotate");return s.labelRotate="top"===u?-y:y,s.z2=1,s}t.layout=r},"01e1":function(e,t,n){"use strict";t["a"]="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope},"01ed":function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("2306");n("5aa9"),n("af24"),i.extendComponentView({type:"grid",render:function(e,t){this.group.removeAll(),e.get("show")&&this.group.add(new a.Rect({shape:e.coordinateSystem.getRect(),style:r.defaults({fill:e.get("backgroundColor")},e.getItemStyle()),silent:!0,z2:-1}))}}),i.registerPreprocessor(function(e){e.xAxis&&e.yAxis&&!e.grid&&(e.grid={})})},"01f9":function(e,t,n){"use strict";var i=n("2d00"),r=n("5ca1"),a=n("2aba"),s=n("32e9"),o=n("84f2"),l=n("41a0"),u=n("7f20"),c=n("38fd"),d=n("2b4c")("iterator"),h=!([].keys&&"next"in[].keys()),f="@@iterator",p="keys",g="values",m=function(){return this};e.exports=function(e,t,n,v,y,b,S){l(n,t,v);var T,_,w,E=function(e){if(!h&&e in I)return I[e];switch(e){case p:return function(){return new n(this,e)};case g:return function(){return new n(this,e)}}return function(){return new n(this,e)}},x=t+" Iterator",A=y==g,k=!1,I=e.prototype,C=I[d]||I[f]||y&&I[y],R=C||E(y),M=y?A?E("entries"):R:void 0,D="Array"==t&&I.entries||C;if(D&&(w=c(D.call(new e)),w!==Object.prototype&&w.next&&(u(w,x,!0),i||"function"==typeof w[d]||s(w,d,m))),A&&C&&C.name!==g&&(k=!0,R=function(){return C.call(this)}),i&&!S||!h&&!k&&I[d]||s(I,d,R),o[t]=R,o[x]=m,y)if(T={values:A?R:E(g),keys:b?R:E(p),entries:M},S)for(_ in T)_ in I||a(I,_,T[_]);else r(r.P+r.F*(h||k),t,T);return T}},"0352":function(e,t,n){var i=n("6cb7"),r=n("b12f"),a=n("0f99"),s=a.detectSourceFormat,o=n("93d0"),l=o.SERIES_LAYOUT_BY_COLUMN;i.extend({type:"dataset",defaultOption:{seriesLayoutBy:l,sourceHeader:null,dimensions:null,source:null},optionUpdated:function(){s(this)}}),r.extend({type:"dataset"})},"04f6":function(e,t){var n=32,i=7;function r(e){var t=0;while(e>=n)t|=1&e,e>>=1;return e+t}function a(e,t,n,i){var r=t+1;if(r===n)return 1;if(i(e[r++],e[t])<0){while(r<n&&i(e[r],e[r-1])<0)r++;s(e,t,r)}else while(r<n&&i(e[r],e[r-1])>=0)r++;return r-t}function s(e,t,n){n--;while(t<n){var i=e[t];e[t++]=e[n],e[n--]=i}}function o(e,t,n,i,r){for(i===t&&i++;i<n;i++){var a,s=e[i],o=t,l=i;while(o<l)a=o+l>>>1,r(s,e[a])<0?l=a:o=a+1;var u=i-o;switch(u){case 3:e[o+3]=e[o+2];case 2:e[o+2]=e[o+1];case 1:e[o+1]=e[o];break;default:while(u>0)e[o+u]=e[o+u-1],u--}e[o]=s}}function l(e,t,n,i,r,a){var s=0,o=0,l=1;if(a(e,t[n+r])>0){o=i-r;while(l<o&&a(e,t[n+r+l])>0)s=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o),s+=r,l+=r}else{o=r+1;while(l<o&&a(e,t[n+r-l])<=0)s=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o);var u=s;s=r-l,l=r-u}s++;while(s<l){var c=s+(l-s>>>1);a(e,t[n+c])>0?s=c+1:l=c}return l}function u(e,t,n,i,r,a){var s=0,o=0,l=1;if(a(e,t[n+r])<0){o=r+1;while(l<o&&a(e,t[n+r-l])<0)s=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o);var u=s;s=r-l,l=r-u}else{o=i-r;while(l<o&&a(e,t[n+r+l])>=0)s=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o),s+=r,l+=r}s++;while(s<l){var c=s+(l-s>>>1);a(e,t[n+c])<0?l=c:s=c+1}return l}function c(e,t){var n,r,a=i,s=0,o=0;s=e.length;var c=[];function d(e,t){n[o]=e,r[o]=t,o+=1}function h(){while(o>1){var e=o-2;if(e>=1&&r[e-1]<=r[e]+r[e+1]||e>=2&&r[e-2]<=r[e]+r[e-1])r[e-1]<r[e+1]&&e--;else if(r[e]>r[e+1])break;p(e)}}function f(){while(o>1){var e=o-2;e>0&&r[e-1]<r[e+1]&&e--,p(e)}}function p(i){var a=n[i],s=r[i],c=n[i+1],d=r[i+1];r[i]=s+d,i===o-3&&(n[i+1]=n[i+2],r[i+1]=r[i+2]),o--;var h=u(e[c],e,a,s,0,t);a+=h,s-=h,0!==s&&(d=l(e[a+s-1],e,c,d,d-1,t),0!==d&&(s<=d?g(a,s,c,d):m(a,s,c,d)))}function g(n,r,s,o){var d=0;for(d=0;d<r;d++)c[d]=e[n+d];var h=0,f=s,p=n;if(e[p++]=e[f++],0!==--o)if(1!==r){var g,m,v,y=a;while(1){g=0,m=0,v=!1;do{if(t(e[f],c[h])<0){if(e[p++]=e[f++],m++,g=0,0===--o){v=!0;break}}else if(e[p++]=c[h++],g++,m=0,1===--r){v=!0;break}}while((g|m)<y);if(v)break;do{if(g=u(e[f],c,h,r,0,t),0!==g){for(d=0;d<g;d++)e[p+d]=c[h+d];if(p+=g,h+=g,r-=g,r<=1){v=!0;break}}if(e[p++]=e[f++],0===--o){v=!0;break}if(m=l(c[h],e,f,o,0,t),0!==m){for(d=0;d<m;d++)e[p+d]=e[f+d];if(p+=m,f+=m,o-=m,0===o){v=!0;break}}if(e[p++]=c[h++],1===--r){v=!0;break}y--}while(g>=i||m>=i);if(v)break;y<0&&(y=0),y+=2}if(a=y,a<1&&(a=1),1===r){for(d=0;d<o;d++)e[p+d]=e[f+d];e[p+o]=c[h]}else{if(0===r)throw new Error;for(d=0;d<r;d++)e[p+d]=c[h+d]}}else{for(d=0;d<o;d++)e[p+d]=e[f+d];e[p+o]=c[h]}else for(d=0;d<r;d++)e[p+d]=c[h+d]}function m(n,r,s,o){var d=0;for(d=0;d<o;d++)c[d]=e[s+d];var h=n+r-1,f=o-1,p=s+o-1,g=0,m=0;if(e[p--]=e[h--],0!==--r)if(1!==o){var v=a;while(1){var y=0,b=0,S=!1;do{if(t(c[f],e[h])<0){if(e[p--]=e[h--],y++,b=0,0===--r){S=!0;break}}else if(e[p--]=c[f--],b++,y=0,1===--o){S=!0;break}}while((y|b)<v);if(S)break;do{if(y=r-u(c[f],e,n,r,r-1,t),0!==y){for(p-=y,h-=y,r-=y,m=p+1,g=h+1,d=y-1;d>=0;d--)e[m+d]=e[g+d];if(0===r){S=!0;break}}if(e[p--]=c[f--],1===--o){S=!0;break}if(b=o-l(e[h],c,0,o,o-1,t),0!==b){for(p-=b,f-=b,o-=b,m=p+1,g=f+1,d=0;d<b;d++)e[m+d]=c[g+d];if(o<=1){S=!0;break}}if(e[p--]=e[h--],0===--r){S=!0;break}v--}while(y>=i||b>=i);if(S)break;v<0&&(v=0),v+=2}if(a=v,a<1&&(a=1),1===o){for(p-=r,h-=r,m=p+1,g=h+1,d=r-1;d>=0;d--)e[m+d]=e[g+d];e[p]=c[f]}else{if(0===o)throw new Error;for(g=p-(o-1),d=0;d<o;d++)e[g+d]=c[d]}}else{for(p-=r,h-=r,m=p+1,g=h+1,d=r-1;d>=0;d--)e[m+d]=e[g+d];e[p]=c[f]}else for(g=p-(o-1),d=0;d<o;d++)e[g+d]=c[d]}n=[],r=[],this.mergeRuns=h,this.forceMergeRuns=f,this.pushRun=d}function d(e,t,i,s){i||(i=0),s||(s=e.length);var l=s-i;if(!(l<2)){var u=0;if(l<n)return u=a(e,i,s,t),void o(e,i,s,i+u,t);var d=new c(e,t),h=r(l);do{if(u=a(e,i,s,t),u<h){var f=l;f>h&&(f=h),o(e,i,i+f,i+u,t),u=f}d.pushRun(i,u),d.mergeRuns(),l-=u,i+=u}while(0!==l);d.forceMergeRuns()}}e.exports=d},"0655":function(e,t,n){var i=n("8728"),r=1e-8;function a(e,t){return Math.abs(e-t)<r}function s(e,t,n){var r=0,s=e[0];if(!s)return!1;for(var o=1;o<e.length;o++){var l=e[o];r+=i(s[0],s[1],l[0],l[1],t,n),s=l}var u=e[0];return a(s[0],u[0])&&a(s[1],u[1])||(r+=i(s[0],s[1],u[0],u[1],t,n)),0!==r}t.contain=s},"06ad":function(e,t,n){var i=n("4436"),r=n("41ef"),a=n("6d8b"),s=a.isArrayLike,o=Array.prototype.slice;function l(e,t){return e[t]}function u(e,t,n){e[t]=n}function c(e,t,n){return(t-e)*n+e}function d(e,t,n){return n>.5?t:e}function h(e,t,n,i,r){var a=e.length;if(1==r)for(var s=0;s<a;s++)i[s]=c(e[s],t[s],n);else{var o=a&&e[0].length;for(s=0;s<a;s++)for(var l=0;l<o;l++)i[s][l]=c(e[s][l],t[s][l],n)}}function f(e,t,n){var i=e.length,r=t.length;if(i!==r){var a=i>r;if(a)e.length=r;else for(var s=i;s<r;s++)e.push(1===n?t[s]:o.call(t[s]))}var l=e[0]&&e[0].length;for(s=0;s<e.length;s++)if(1===n)isNaN(e[s])&&(e[s]=t[s]);else for(var u=0;u<l;u++)isNaN(e[s][u])&&(e[s][u]=t[s][u])}function p(e,t,n){if(e===t)return!0;var i=e.length;if(i!==t.length)return!1;if(1===n){for(var r=0;r<i;r++)if(e[r]!==t[r])return!1}else{var a=e[0].length;for(r=0;r<i;r++)for(var s=0;s<a;s++)if(e[r][s]!==t[r][s])return!1}return!0}function g(e,t,n,i,r,a,s,o,l){var u=e.length;if(1==l)for(var c=0;c<u;c++)o[c]=m(e[c],t[c],n[c],i[c],r,a,s);else{var d=e[0].length;for(c=0;c<u;c++)for(var h=0;h<d;h++)o[c][h]=m(e[c][h],t[c][h],n[c][h],i[c][h],r,a,s)}}function m(e,t,n,i,r,a,s){var o=.5*(n-e),l=.5*(i-t);return(2*(t-n)+o+l)*s+(-3*(t-n)-2*o-l)*a+o*r+t}function v(e){if(s(e)){var t=e.length;if(s(e[0])){for(var n=[],i=0;i<t;i++)n.push(o.call(e[i]));return n}return o.call(e)}return e}function y(e){return e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.floor(e[2]),"rgba("+e.join(",")+")"}function b(e){var t=e[e.length-1].value;return s(t&&t[0])?2:1}function S(e,t,n,a,o,l){var u=e._getter,v=e._setter,S="spline"===t,T=a.length;if(T){var _,w=a[0].value,E=s(w),x=!1,A=!1,k=E?b(a):0;a.sort(function(e,t){return e.time-t.time}),_=a[T-1].time;for(var I=[],C=[],R=a[0].value,M=!0,D=0;D<T;D++){I.push(a[D].time/_);var L=a[D].value;if(E&&p(L,R,k)||!E&&L===R||(M=!1),R=L,"string"==typeof L){var P=r.parse(L);P?(L=P,x=!0):A=!0}C.push(L)}if(l||!M){var O=C[T-1];for(D=0;D<T-1;D++)E?f(C[D],O,k):!isNaN(C[D])||isNaN(O)||A||x||(C[D]=O);E&&f(u(e._target,o),O,k);var N,U,F,B,V,j,G=0,H=0;if(x)var z=[0,0,0,0];var K=function(e,t){var n;if(t<0)n=0;else if(t<H){for(N=Math.min(G+1,T-1),n=N;n>=0;n--)if(I[n]<=t)break;n=Math.min(n,T-2)}else{for(n=G;n<T;n++)if(I[n]>t)break;n=Math.min(n-1,T-2)}G=n,H=t;var i=I[n+1]-I[n];if(0!==i)if(U=(t-I[n])/i,S)if(B=C[n],F=C[0===n?n:n-1],V=C[n>T-2?T-1:n+1],j=C[n>T-3?T-1:n+2],E)g(F,B,V,j,U,U*U,U*U*U,u(e,o),k);else{if(x)r=g(F,B,V,j,U,U*U,U*U*U,z,1),r=y(z);else{if(A)return d(B,V,U);r=m(F,B,V,j,U,U*U,U*U*U)}v(e,o,r)}else if(E)h(C[n],C[n+1],U,u(e,o),k);else{var r;if(x)h(C[n],C[n+1],U,z,1),r=y(z);else{if(A)return d(C[n],C[n+1],U);r=c(C[n],C[n+1],U)}v(e,o,r)}},$=new i({target:e._target,life:_,loop:e._loop,delay:e._delay,onframe:K,ondestroy:n});return t&&"spline"!==t&&($.easing=t),$}}}var T=function(e,t,n,i){this._tracks={},this._target=e,this._loop=t||!1,this._getter=n||l,this._setter=i||u,this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[]};T.prototype={when:function(e,t){var n=this._tracks;for(var i in t)if(t.hasOwnProperty(i)){if(!n[i]){n[i]=[];var r=this._getter(this._target,i);if(null==r)continue;0!==e&&n[i].push({time:0,value:v(r)})}n[i].push({time:e,value:t[i]})}return this},during:function(e){return this._onframeList.push(e),this},pause:function(){for(var e=0;e<this._clipList.length;e++)this._clipList[e].pause();this._paused=!0},resume:function(){for(var e=0;e<this._clipList.length;e++)this._clipList[e].resume();this._paused=!1},isPaused:function(){return!!this._paused},_doneCallback:function(){this._tracks={},this._clipList.length=0;for(var e=this._doneList,t=e.length,n=0;n<t;n++)e[n].call(this)},start:function(e,t){var n,i=this,r=0,a=function(){r--,r||i._doneCallback()};for(var s in this._tracks)if(this._tracks.hasOwnProperty(s)){var o=S(this,e,a,this._tracks[s],s,t);o&&(this._clipList.push(o),r++,this.animation&&this.animation.addClip(o),n=o)}if(n){var l=n.onframe;n.onframe=function(e,t){l(e,t);for(var n=0;n<i._onframeList.length;n++)i._onframeList[n](e,t)}}return r||this._doneCallback(),this},stop:function(e){for(var t=this._clipList,n=this.animation,i=0;i<t.length;i++){var r=t[i];e&&r.onframe(this._target,1),n&&n.removeClip(r)}t.length=0},delay:function(e){return this._delay=e,this},done:function(e){return e&&this._doneList.push(e),this},getClips:function(){return this._clipList}};var _=T;e.exports=_},"07d7":function(e,t,n){var i=n("6d8b"),r=n("41ef"),a=n("607d"),s=n("22d1"),o=n("eda2"),l=i.each,u=o.toCamelCase,c=["","-webkit-","-moz-","-o-"],d="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;";function h(e){var t="cubic-bezier(0.23, 1, 0.32, 1)",n="left "+e+"s "+t+",top "+e+"s "+t;return i.map(c,function(e){return e+"transition:"+n}).join(";")}function f(e){var t=[],n=e.get("fontSize"),i=e.getTextColor();return i&&t.push("color:"+i),t.push("font:"+e.getFont()),n&&t.push("line-height:"+Math.round(3*n/2)+"px"),l(["decoration","align"],function(n){var i=e.get(n);i&&t.push("text-"+n+":"+i)}),t.join(";")}function p(e){var t=[],n=e.get("transitionDuration"),i=e.get("backgroundColor"),a=e.getModel("textStyle"),c=e.get("padding");return n&&t.push(h(n)),i&&(s.canvasSupported?t.push("background-Color:"+i):(t.push("background-Color:#"+r.toHex(i)),t.push("filter:alpha(opacity=70)"))),l(["width","color","radius"],function(n){var i="border-"+n,r=u(i),a=e.get(r);null!=a&&t.push(i+":"+a+("color"===n?"":"px"))}),t.push(f(a)),null!=c&&t.push("padding:"+o.normalizeCssArray(c).join("px ")+"px"),t.join(";")+";"}function g(e,t){if(s.wxa)return null;var n=document.createElement("div"),i=this._zr=t.getZr();this.el=n,this._x=t.getWidth()/2,this._y=t.getHeight()/2,e.appendChild(n),this._container=e,this._show=!1,this._hideTimeout;var r=this;n.onmouseenter=function(){r._enterable&&(clearTimeout(r._hideTimeout),r._show=!0),r._inContent=!0},n.onmousemove=function(t){if(t=t||window.event,!r._enterable){var n=i.handler;a.normalizeEvent(e,t,!0),n.dispatch("mousemove",t)}},n.onmouseleave=function(){r._enterable&&r._show&&r.hideLater(r._hideDelay),r._inContent=!1}}g.prototype={constructor:g,_enterable:!0,update:function(){var e=this._container,t=e.currentStyle||document.defaultView.getComputedStyle(e),n=e.style;"absolute"!==n.position&&"absolute"!==t.position&&(n.position="relative")},show:function(e){clearTimeout(this._hideTimeout);var t=this.el;t.style.cssText=d+p(e)+";left:"+this._x+"px;top:"+this._y+"px;"+(e.get("extraCssText")||""),t.style.display=t.innerHTML?"block":"none",this._show=!0},setContent:function(e){this.el.innerHTML=null==e?"":e},setEnterable:function(e){this._enterable=e},getSize:function(){var e=this.el;return[e.clientWidth,e.clientHeight]},moveTo:function(e,t){var n,i=this._zr;i&&i.painter&&(n=i.painter.getViewportRootOffset())&&(e+=n.offsetLeft,t+=n.offsetTop);var r=this.el.style;r.left=e+"px",r.top=t+"px",this._x=e,this._y=t},hide:function(){this.el.style.display="none",this._show=!1},hideLater:function(e){!this._show||this._inContent&&this._enterable||(e?(this._hideDelay=e,this._show=!1,this._hideTimeout=setTimeout(i.bind(this.hide,this),e)):this.hide())},isShow:function(){return this._show}};var m=g;e.exports=m},"097d":function(e,t,n){"use strict";var i=n("5ca1"),r=n("8378"),a=n("7726"),s=n("ebd6"),o=n("bcaa");i(i.P+i.R,"Promise",{finally:function(e){var t=s(this,r.Promise||a.Promise),n="function"==typeof e;return this.then(n?function(n){return o(t,e()).then(function(){return n})}:e,n?function(n){return o(t,e()).then(function(){throw n})}:e)}})},"0b44":function(e,t,n){var i=n("607d"),r=function(){this._track=[]};function a(e){var t=e[1][0]-e[0][0],n=e[1][1]-e[0][1];return Math.sqrt(t*t+n*n)}function s(e){return[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]}r.prototype={constructor:r,recognize:function(e,t,n){return this._doTrack(e,t,n),this._recognize(e)},clear:function(){return this._track.length=0,this},_doTrack:function(e,t,n){var r=e.touches;if(r){for(var a={points:[],touches:[],target:t,event:e},s=0,o=r.length;s<o;s++){var l=r[s],u=i.clientToLocal(n,l,{});a.points.push([u.zrX,u.zrY]),a.touches.push(l)}this._track.push(a)}},_recognize:function(e){for(var t in o)if(o.hasOwnProperty(t)){var n=o[t](this._track,e);if(n)return n}}};var o={pinch:function(e,t){var n=e.length;if(n){var i=(e[n-1]||{}).points,r=(e[n-2]||{}).points||i;if(r&&r.length>1&&i&&i.length>1){var o=a(i)/a(r);!isFinite(o)&&(o=1),t.pinchScale=o;var l=s(i);return t.pinchX=l[0],t.pinchY=l[1],{type:"pinch",target:e[0].target,event:t}}}}},l=r;e.exports=l},"0bfb":function(e,t,n){"use strict";var i=n("cb7c");e.exports=function(){var e=i(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},"0cde":function(e,t,n){var i=n("1687"),r=n("401b"),a=i.identity,s=5e-5;function o(e){return e>s||e<-s}var l=function(e){e=e||{},e.position||(this.position=[0,0]),null==e.rotation&&(this.rotation=0),e.scale||(this.scale=[1,1]),this.origin=this.origin||null},u=l.prototype;u.transform=null,u.needLocalTransform=function(){return o(this.rotation)||o(this.position[0])||o(this.position[1])||o(this.scale[0]-1)||o(this.scale[1]-1)},u.updateTransform=function(){var e=this.parent,t=e&&e.transform,n=this.needLocalTransform(),r=this.transform;n||t?(r=r||i.create(),n?this.getLocalTransform(r):a(r),t&&(n?i.mul(r,e.transform,r):i.copy(r,e.transform)),this.transform=r,this.invTransform=this.invTransform||i.create(),i.invert(this.invTransform,r)):r&&a(r)},u.getLocalTransform=function(e){return l.getLocalTransform(this,e)},u.setTransform=function(e){var t=this.transform,n=e.dpr||1;t?e.setTransform(n*t[0],n*t[1],n*t[2],n*t[3],n*t[4],n*t[5]):e.setTransform(n,0,0,n,0,0)},u.restoreTransform=function(e){var t=e.dpr||1;e.setTransform(t,0,0,t,0,0)};var c=[];u.decomposeTransform=function(){if(this.transform){var e=this.parent,t=this.transform;e&&e.transform&&(i.mul(c,e.invTransform,t),t=c);var n=t[0]*t[0]+t[1]*t[1],r=t[2]*t[2]+t[3]*t[3],a=this.position,s=this.scale;o(n-1)&&(n=Math.sqrt(n)),o(r-1)&&(r=Math.sqrt(r)),t[0]<0&&(n=-n),t[3]<0&&(r=-r),a[0]=t[4],a[1]=t[5],s[0]=n,s[1]=r,this.rotation=Math.atan2(-t[1]/r,t[0]/n)}},u.getGlobalScale=function(){var e=this.transform;if(!e)return[1,1];var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]),n=Math.sqrt(e[2]*e[2]+e[3]*e[3]);return e[0]<0&&(t=-t),e[3]<0&&(n=-n),[t,n]},u.transformCoordToLocal=function(e,t){var n=[e,t],i=this.invTransform;return i&&r.applyTransform(n,n,i),n},u.transformCoordToGlobal=function(e,t){var n=[e,t],i=this.transform;return i&&r.applyTransform(n,n,i),n},l.getLocalTransform=function(e,t){t=t||[],a(t);var n=e.origin,r=e.scale||[1,1],s=e.rotation||0,o=e.position||[0,0];return n&&(t[4]-=n[0],t[5]-=n[1]),i.scale(t,t,r),s&&i.rotate(t,t,s),n&&(t[4]+=n[0],t[5]+=n[1]),t[4]+=o[0],t[5]+=o[1],t};var d=l;e.exports=d},"0d58":function(e,t,n){var i=n("ce10"),r=n("e11e");e.exports=Object.keys||function(e){return i(e,r)}},"0da8":function(e,t,n){var i=n("19eb"),r=n("9850"),a=n("6d8b"),s=n("5e76");function o(e){i.call(this,e)}o.prototype={constructor:o,type:"image",brush:function(e,t){var n=this.style,i=n.image;n.bind(e,this,t);var r=this._image=s.createOrUpdateImage(i,this._image,this,this.onload);if(r&&s.isImageReady(r)){var a=n.x||0,o=n.y||0,l=n.width,u=n.height,c=r.width/r.height;if(null==l&&null!=u?l=u*c:null==u&&null!=l?u=l/c:null==l&&null==u&&(l=r.width,u=r.height),this.setTransform(e),n.sWidth&&n.sHeight){var d=n.sx||0,h=n.sy||0;e.drawImage(r,d,h,n.sWidth,n.sHeight,a,o,l,u)}else if(n.sx&&n.sy){d=n.sx,h=n.sy;var f=l-d,p=u-h;e.drawImage(r,d,h,f,p,a,o,l,u)}else e.drawImage(r,a,o,l,u);null!=n.text&&(this.restoreTransform(e),this.drawRectText(e,this.getBoundingRect()))}},getBoundingRect:function(){var e=this.style;return this._rect||(this._rect=new r(e.x||0,e.y||0,e.width||0,e.height||0)),this._rect}},a.inherits(o,i);var l=o;e.exports=l},"0f99":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("e0d3")),a=r.makeInner,s=r.getDataItemValue,o=n("8b7f"),l=o.getCoordSysDefineBySeries,u=n("6d8b"),c=u.createHashMap,d=u.each,h=u.map,f=u.isArray,p=u.isString,g=u.isObject,m=u.isTypedArray,v=u.isArrayLike,y=u.extend,b=(u.assert,n("ec6f")),S=n("93d0"),T=S.SOURCE_FORMAT_ORIGINAL,_=S.SOURCE_FORMAT_ARRAY_ROWS,w=S.SOURCE_FORMAT_OBJECT_ROWS,E=S.SOURCE_FORMAT_KEYED_COLUMNS,x=S.SOURCE_FORMAT_UNKNOWN,A=S.SOURCE_FORMAT_TYPED_ARRAY,k=S.SERIES_LAYOUT_BY_ROW,I=a();function C(e){var t=e.option.source,n=x;if(m(t))n=A;else if(f(t))for(var i=0,r=t.length;i<r;i++){var a=t[i];if(null!=a){if(f(a)){n=_;break}if(g(a)){n=w;break}}}else if(g(t)){for(var s in t)if(t.hasOwnProperty(s)&&v(t[s])){n=E;break}}else if(null!=t)throw new Error("Invalid data");I(e).sourceFormat=n}function R(e){return I(e).source}function M(e){I(e).datasetMap=c()}function D(e){var t=e.option,n=t.data,i=m(n)?A:T,r=!1,a=t.seriesLayoutBy,s=t.sourceHeader,o=t.dimensions,l=F(e);if(l){var u=l.option;n=u.source,i=I(l).sourceFormat,r=!0,a=a||u.seriesLayoutBy,null==s&&(s=u.sourceHeader),o=o||u.dimensions}var c=L(n,i,a,s,o),d=t.encode;!d&&l&&(d=U(e,l,n,i,a,c)),I(e).source=new b({data:n,fromDataset:r,seriesLayoutBy:a,sourceFormat:i,dimensionsDefine:c.dimensionsDefine,startIndex:c.startIndex,dimensionsDetectCount:c.dimensionsDetectCount,encodeDefine:d})}function L(e,t,n,i,r){if(!e)return{dimensionsDefine:P(r)};var a,o,l,u;if(t===_)"auto"===i||null==i?O(function(e){null!=e&&"-"!==e&&(p(e)?null==o&&(o=1):o=0)},n,e,10):o=i?1:0,r||1!==o||(r=[],O(function(e,t){r[t]=null!=e?e:""},n,e)),a=r?r.length:n===k?e.length:e[0]?e[0].length:null;else if(t===w)r||(r=N(e),l=!0);else if(t===E)r||(r=[],l=!0,d(e,function(e,t){r.push(t)}));else if(t===T){var c=s(e[0]);a=f(c)&&c.length||1}return l&&d(r,function(e,t){"name"===(g(e)?e.name:e)&&(u=t)}),{startIndex:o,dimensionsDefine:P(r),dimensionsDetectCount:a,potentialNameDimIndex:u}}function P(e){if(e){var t=c();return h(e,function(e,n){if(e=y({},g(e)?e:{name:e}),null==e.name)return e;e.name+="",null==e.displayName&&(e.displayName=e.name);var i=t.get(e.name);return i?e.name+="-"+i.count++:t.set(e.name,{count:1}),e})}}function O(e,t,n,i){if(null==i&&(i=1/0),t===k)for(var r=0;r<n.length&&r<i;r++)e(n[r]?n[r][0]:null,r);else{var a=n[0]||[];for(r=0;r<a.length&&r<i;r++)e(a[r],r)}}function N(e){var t,n=0;while(n<e.length&&!(t=e[n++]));if(t){var i=[];return d(t,function(e,t){i.push(t)}),i}}function U(e,t,n,i,r,a){var s=l(e),o={},u=[],h=[],f=e.subType,p=c(["pie","map","funnel"]),g=c(["line","bar","pictorialBar","scatter","effectScatter","candlestick","boxplot"]);if(s&&null!=g.get(f)){var m=e.ecModel,v=I(m).datasetMap,y=t.uid+"_"+r,b=v.get(y)||v.set(y,{categoryWayDim:1,valueWayDim:0});d(s.coordSysDims,function(e){if(null==s.firstCategoryDimIndex){var t=b.valueWayDim++;o[e]=t,h.push(t)}else if(s.categoryAxisMap.get(e))o[e]=0,u.push(0);else{t=b.categoryWayDim++;o[e]=t,h.push(t)}})}else if(null!=p.get(f)){for(var S,T=0;T<5&&null==S;T++)V(n,i,r,a.dimensionsDefine,a.startIndex,T)||(S=T);if(null!=S){o.value=S;var _=a.potentialNameDimIndex||Math.max(S-1,0);h.push(_),u.push(_)}}return u.length&&(o.itemName=u),h.length&&(o.seriesName=h),o}function F(e){var t=e.option,n=t.data;if(!n)return e.ecModel.getComponent("dataset",t.datasetIndex||0)}function B(e,t){return V(e.data,e.sourceFormat,e.seriesLayoutBy,e.dimensionsDefine,e.startIndex,t)}function V(e,t,n,i,r,a){var o,l,u=5;if(m(e))return!1;if(i&&(l=i[a],l=g(l)?l.name:l),t===_)if(n===k){for(var c=e[a],d=0;d<(c||[]).length&&d<u;d++)if(null!=(o=b(c[r+d])))return o}else for(d=0;d<e.length&&d<u;d++){var h=e[r+d];if(h&&null!=(o=b(h[a])))return o}else if(t===w){if(!l)return;for(d=0;d<e.length&&d<u;d++){var v=e[d];if(v&&null!=(o=b(v[l])))return o}}else if(t===E){if(!l)return;c=e[l];if(!c||m(c))return!1;for(d=0;d<c.length&&d<u;d++)if(null!=(o=b(c[d])))return o}else if(t===T)for(d=0;d<e.length&&d<u;d++){v=e[d];var y=s(v);if(!f(y))return!1;if(null!=(o=b(y[a])))return o}function b(e){return(null==e||!isFinite(e)||""===e)&&(!(!p(e)||"-"===e)||void 0)}return!1}t.detectSourceFormat=C,t.getSource=R,t.resetSourceDefaulter=M,t.prepareSource=D,t.guessOrdinal=B},"11e9":function(e,t,n){var i=n("52a7"),r=n("4630"),a=n("6821"),s=n("6a99"),o=n("69a8"),l=n("c69a"),u=Object.getOwnPropertyDescriptor;t.f=n("9e1e")?u:function(e,t){if(e=a(e),t=s(t,!0),l)try{return u(e,t)}catch(e){}if(o(e,t))return r(!i.f.call(e,t),e[t])}},"128e":function(e,t,n){"use strict";function i(){return"boolean"===typeof __RX_PLAYER_DEBUG_MODE__&&__RX_PLAYER_DEBUG_MODE__}function r(e){return null===e||void 0===e}class a{constructor(){this._listeners={}}addEventListener(e,t,n){const i=this._listeners[e];Array.isArray(i)?i.push(t):this._listeners[e]=[t],void 0!==n&&n.register(()=>{this.removeEventListener(e,t)})}removeEventListener(e,t){if(r(e))return void(this._listeners={});const n=this._listeners[e];if(!Array.isArray(n))return;if(r(t))return void delete this._listeners[e];const i=n.indexOf(t);-1!==i&&n.splice(i,1),0===n.length&&delete this._listeners[e]}trigger(e,t){const n=this._listeners[e];Array.isArray(n)&&n.slice().forEach(e=>{try{e(t)}catch(e){0,console.error("RxPlayer: EventEmitter error",e instanceof Error?e:null)}})}}var s=n("45c1"),o=n("d708"),l="function"===typeof queueMicrotask?queueMicrotask:function(e){Promise.resolve().then(e,()=>e())};function u(){if(!o["a"]&&!r(s["a"].WebKitSourceBuffer)&&void 0===s["a"].WebKitSourceBuffer.prototype.addEventListener){const e=s["a"].WebKitSourceBuffer,t=e.prototype;for(const n in a.prototype)a.prototype.hasOwnProperty(n)&&(t[n]=a.prototype[n]);t._listeners=[],t._emitUpdate=function(e,t){l(()=>{this.trigger(e,t),this.updating=!1,this.trigger("updateend")})},t.appendBuffer=function(e){if(this.updating)throw new Error("updating");this.trigger("updatestart"),this.updating=!0;try{this.append(e)}catch(e){return void this._emitUpdate("error",e)}this._emitUpdate("update")}}}let c=!1,d=!1,h=!1,f=!1,p=!1,g=!1,m=!1,v=!1,y=!1,b=!1,S=!1,T=!1,_=!1,w=!1,E=!1;(function(){var e,t,n;o["a"]||("undefined"!==typeof s["a"].MSInputMethodContext&&"undefined"!==typeof document.documentMode?(d=!0,h=!0):"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&/(Trident|Edge)\//.test(navigator.userAgent)?h=!0:-1!==navigator.userAgent.toLowerCase().indexOf("edg/")?c=!0:-1!==navigator.userAgent.toLowerCase().indexOf("firefox")?f=!0:"string"===typeof navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)?g=!0:(Object.prototype.toString.call(s["a"].HTMLElement).indexOf("Constructor")>=0||"[object SafariRemoteNotification]"===(null===(t=null===(e=s["a"].safari)||void 0===e?void 0:e.pushNotification)||void 0===t?void 0:t.toString())||/Safari\/(\d+)/.test(navigator.userAgent)&&/Version\/(\d+)/.test(navigator.userAgent)&&-1!==(null===(n=navigator.vendor)||void 0===n?void 0:n.indexOf("Apple"))&&!/Chrome\/(\d+)/.test(navigator.userAgent)&&!/Chromium\/(\d+)/.test(navigator.userAgent))&&(p=!0),/SamsungBrowser/.test(navigator.userAgent)&&(m=!0),-1!==navigator.userAgent.indexOf("PlayStation 4")?_=!0:-1!==navigator.userAgent.indexOf("PlayStation 5")?w=!0:/Tizen/.test(navigator.userAgent)?v=!0:/[Ww]eb[O0]S/.test(navigator.userAgent)?(y=!0,/[Ww]eb[O0]S.TV-2022/.test(navigator.userAgent)||/[Cc]hr[o0]me\/87/.test(navigator.userAgent)?S=!0:(/[Ww]eb[O0]S.TV-2021/.test(navigator.userAgent)||/[Cc]hr[o0]me\/79/.test(navigator.userAgent))&&(b=!0)):/[Pp]anasonic/.test(navigator.userAgent)?T=!0:-1!==navigator.userAgent.indexOf("Xbox")&&(E=!0))})();const x=w;var A=x;function k(e){return void 0===e||e.indexOf("widevine")<0}const I={DEFAULT_REQUEST_TIMEOUT:3e4,DEFAULT_CONNECTION_TIMEOUT:15e3,DEFAULT_TEXT_TRACK_MODE:"native",DEFAULT_ENABLE_FAST_SWITCHING:!0,DELTA_POSITION_AFTER_RELOAD:{bitrateSwitch:-.1,trackSwitch:{audio:0,video:0,other:0}},DEFAULT_CODEC_SWITCHING_BEHAVIOR:"continue",DEFAULT_AUTO_PLAY:!1,DEFAULT_WANTED_BUFFER_AHEAD:30,DEFAULT_MAX_BUFFER_AHEAD:1/0,DEFAULT_MAX_BUFFER_BEHIND:1/0,DEFAULT_MAX_VIDEO_BUFFER_SIZE:1/0,MAXIMUM_MAX_BUFFER_AHEAD:{text:18e3},MINIMUM_MAX_BUFFER_AHEAD:{text:120},MAXIMUM_MAX_BUFFER_BEHIND:{text:18e3},DEFAULT_BASE_BANDWIDTH:0,INACTIVITY_DELAY:6e4,DEFAULT_THROTTLE_VIDEO_BITRATE_WHEN_HIDDEN:!1,DEFAULT_VIDEO_RESOLUTION_LIMIT:"none",DEFAULT_LIVE_GAP:{DEFAULT:10,LOW_LATENCY:3.5},BUFFER_DISCONTINUITY_THRESHOLD:.2,BITRATE_REBUFFERING_RATIO:1.5,DEFAULT_MAX_MANIFEST_REQUEST_RETRY:4,DEFAULT_CDN_DOWNGRADE_TIME:60,DEFAULT_MAX_REQUESTS_RETRY_ON_ERROR:4,INITIAL_BACKOFF_DELAY_BASE:{REGULAR:200,LOW_LATENCY:50},MAX_BACKOFF_DELAY_BASE:{REGULAR:3e3,LOW_LATENCY:1e3},SAMPLING_INTERVAL_MEDIASOURCE:1e3,SAMPLING_INTERVAL_LOW_LATENCY:500,SAMPLING_INTERVAL_NO_MEDIASOURCE:500,ABR_ENTER_BUFFER_BASED_ALGO:10,ABR_EXIT_BUFFER_BASED_ALGO:5,ABR_MINIMUM_TOTAL_BYTES:15e4,ABR_MINIMUM_CHUNK_SIZE:16e3,ABR_STARVATION_FACTOR:{DEFAULT:.72,LOW_LATENCY:.72},ABR_REGULAR_FACTOR:{DEFAULT:.72,LOW_LATENCY:.72},ABR_STARVATION_GAP:{DEFAULT:5,LOW_LATENCY:5},OUT_OF_STARVATION_GAP:{DEFAULT:7,LOW_LATENCY:7},ABR_STARVATION_DURATION_DELTA:.1,ABR_FAST_EMA:2,ABR_SLOW_EMA:10,RESUME_GAP_AFTER_SEEKING:{DEFAULT:1.5,LOW_LATENCY:.5},RESUME_GAP_AFTER_NOT_ENOUGH_DATA:{DEFAULT:.5,LOW_LATENCY:.5},RESUME_GAP_AFTER_BUFFERING:{DEFAULT:5,LOW_LATENCY:.5},REBUFFERING_GAP:{DEFAULT:.5,LOW_LATENCY:.2},MINIMUM_BUFFER_AMOUNT_BEFORE_FREEZING:2,UNFREEZING_SEEK_DELAY:6e3,FREEZING_STALLED_DELAY:600,UNFREEZING_DELTA_POSITION:.001,SEGMENT_SYNCHRONIZATION_DELAY:1500,MISSING_DATA_TRIGGER_SYNC_DELAY:.1,MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:.15,MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:.4,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:.3,MINIMUM_SEGMENT_SIZE:.001,APPEND_WINDOW_SECURITIES:{START:.2,END:.1},MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL:50,TEXT_TRACK_SIZE_CHECKS_INTERVAL:250,BUFFER_PADDING:{audio:1,video:3,other:1},SEGMENT_PRIORITIES_STEPS:[2,4,8,12,18,25],MAX_HIGH_PRIORITY_LEVEL:1,MIN_CANCELABLE_PRIORITY:3,EME_DEFAULT_VIDEO_CODECS:['video/mp4;codecs="avc1.4d401e"','video/mp4;codecs="avc1.42e01e"','video/webm;codecs="vp8"'],EME_DEFAULT_AUDIO_CODECS:['audio/mp4;codecs="mp4a.40.2"',"audio/webm;codecs=opus"],EME_DEFAULT_WIDEVINE_ROBUSTNESSES:["HW_SECURE_ALL","HW_SECURE_DECODE","HW_SECURE_CRYPTO","SW_SECURE_DECODE","SW_SECURE_CRYPTO"],EME_DEFAULT_PLAYREADY_RECOMMENDATION_ROBUSTNESSES:["3000","2000"],EME_KEY_SYSTEMS:{clearkey:["webkit-org.w3.clearkey","org.w3.clearkey"],widevine:["com.widevine.alpha"],playready:["com.microsoft.playready.recommendation","com.microsoft.playready","com.chromecast.playready","com.youtube.playready"],fairplay:["com.apple.fps.1_0"]},MAX_CONSECUTIVE_MANIFEST_PARSING_IN_UNSAFE_MODE:10,MIN_MANIFEST_PARSING_TIME_TO_ENTER_UNSAFE_MODE:200,MIN_DASH_S_ELEMENTS_TO_PARSE_UNSAFELY:300,OUT_OF_SYNC_MANIFEST_REFRESH_DELAY:3e3,FAILED_PARTIAL_UPDATE_MANIFEST_REFRESH_DELAY:3e3,DASH_FALLBACK_LIFETIME_WHEN_MINIMUM_UPDATE_PERIOD_EQUAL_0:3,EME_DEFAULT_MAX_SIMULTANEOUS_MEDIA_KEY_SESSIONS:15,EME_MAX_STORED_PERSISTENT_SESSION_INFORMATION:1e3,EME_WAITING_DELAY_LOADED_SESSION_EMPTY_KEYSTATUSES:100,FORCED_ENDED_THRESHOLD:8e-4,ADAP_REP_SWITCH_BUFFER_PADDINGS:{video:{before:5,after:5},audio:{before:2,after:2.5},text:{before:0,after:0}},SOURCE_BUFFER_FLUSHING_INTERVAL:500,CONTENT_REPLACEMENT_PADDING:1.2,CACHE_LOAD_DURATION_THRESHOLDS:{video:50,audio:10},STREAM_EVENT_EMITTER_POLL_INTERVAL:250,DEFAULT_MAXIMUM_TIME_ROUNDING_ERROR:.001,BUFFERED_HISTORY_RETENTION_TIME:6e4,BUFFERED_HISTORY_MAXIMUM_ENTRIES:200,MIN_BUFFER_AHEAD:5,UPTO_CURRENT_POSITION_CLEANUP:5,DEFAULT_VIDEO_REPRESENTATIONS_SWITCHING_MODE:"seamless",DEFAULT_AUDIO_REPRESENTATIONS_SWITCHING_MODE:"seamless",DEFAULT_VIDEO_TRACK_SWITCHING_MODE:"reload",DEFAULT_AUDIO_TRACK_SWITCHING_MODE:"seamless"};var C=I;function R(e,...t){if(null===e||void 0===e)throw new TypeError("Cannot convert undefined or null to object");const n=Object(e);for(let i=0;i<t.length;i++){const e=t[i];for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}return n}var M="function"===typeof Object.assign?Object.assign:R;function D(e){return null!==e&&void 0!==e&&!Array.isArray(e)&&"object"===typeof e}function L(e,...t){if(0===t.length)return e;const n=t.shift();if(D(e)&&D(n))for(const i in n)if(D(n[i])){let t=e[i];void 0===t&&(t={},e[i]=t),L(t,n[i])}else M(e,{[i]:n[i]});return L(e,...t)}class P{constructor(){this._config=C}update(e){const t=L(this._config,e);this._config=t}getCurrent(){return this._config}}const O=new P;var N=O,U=function(){};const F="NONE";class B extends a{constructor(){super(),this.error=U,this.warn=U,this.info=U,this.debug=U,this._levels={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4},this._currentLevel=F}setLevel(e,t){let n;const i=this._levels[e];"number"===typeof i?(n=i,this._currentLevel=e):(n=0,this._currentLevel="NONE"),void 0===t?(this.error=n>=this._levels.ERROR?console.error.bind(console):U,this.warn=n>=this._levels.WARNING?console.warn.bind(console):U,this.info=n>=this._levels.INFO?console.info.bind(console):U,this.debug=n>=this._levels.DEBUG?console.log.bind(console):U):(this.error=n>=this._levels.ERROR?(...e)=>t("ERROR",e):U,this.warn=n>=this._levels.WARNING?(...e)=>t("WARNING",e):U,this.info=n>=this._levels.INFO?(...e)=>t("INFO",e):U,this.debug=n>=this._levels.DEBUG?(...e)=>t("DEBUG",e):U),this.trigger("onLogLevelChange",this._currentLevel)}getLevel(){return this._currentLevel}hasLevel(e){return this._levels[e]>=this._levels[this._currentLevel]}}const V=new B;var j=V;const G=1/60;function H(e,t){return Math.abs(e-t)<G}function z(e,t){const n=Math.min(e.start,t.start),i=Math.max(e.end,t.end);return{start:n,end:i}}function K(e){for(let t=0;t<e.length;t++){const n=e[t];n.start===n.end&&e.splice(t--,1)}return e}function $(e){for(let t=1;t<e.length;t++){const n=e[t-1],i=e[t];if(X(n,i)){const r=z(n,i);e.splice(--t,2,r)}}return e}function W(e,t){return e.end<=t.start}function q({start:e,end:t},n){return e<=n&&n<t}function Y(e,t){return q(e,t.start)||e.start<t.end&&t.end<e.end||q(t,e.start)}function X(e,t){return H(t.start,e.end)||H(t.end,e.start)}function Q(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}function Z(e,t){for(let n=e.length-1;n>=0;n--){const i=e.start(n);if(t>=i){const r=e.end(n);if(t<r)return{start:i,end:r}}}return null}function J(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n].start;if(t>=i){const i=e[n].end;if(t<i)return e[n]}}return null}function ee(e,t){const n=e.length;for(let i=0;i<n;i++){const n=e.start(i);if(t<n)return n-t}return 1/0}function te(e,t){let n=null;const i=[];for(let r=0;r<e.length;r++){const a=e[r].start,s=e[r].end;t<a||t>=s?i.push({start:a,end:s}):n={start:a,end:s}}return{outerRanges:i,innerRange:n}}function ne(e,t){const n=Z(e,t);return null!==n?n.end-t:1/0}function ie(e,t){const n=J(e,t);return null!==n?n.end-t:1/0}function re(e,t){if(t.start===t.end)return e;let n=t,i=0;for(;i<e.length;i++){const t=e[i],r=Y(n,t),a=X(n,t);if(r||a)n=z(n,t),e.splice(i--,1);else if(0===i){if(W(n,e[0]))break}else if(W(e[i-1],n)&&W(n,t))break}return e.splice(i,0,n),$(K(e))}function ae(e,t){const n=[];for(let i=0;i<t.length;i++)Y(e,t[i])&&n.push(t[i]);return n}function se(e,t){const n=[];for(let i=0;i<e.length;i++){const r=e[i],a=ae(r,t);if(a.length>0)for(let e=0;e<a.length;e++){const t=a[e];n.push({start:Math.max(r.start,t.start),end:Math.min(r.end,t.end)})}}return n}function oe(e,t){const n=[];for(let i=0;i<e.length;i++){const r=e[i],a=[],s=ae(r,t);if(s.length>0)for(let e=0;e<s.length;e++){const t=s[e];a.push({start:Math.max(r.start,t.start),end:Math.min(r.end,t.end)})}if(0===a.length)n.push(r);else{let e=r.start;for(let t=0;t<a.length;t++)a[t].start>e&&n.push({start:e,end:a[t].start}),e=a[t].end;e<r.end&&n.push({start:e,end:r.end})}}return n}function le(e,t,n){if("function"===typeof Array.prototype.findIndex)return e.findIndex(t,n);const i=e.length>>>0;for(let r=0;r<i;r++)if(t.call(n,e[r],r,e))return r;return-1}class ue{constructor(e,t){this._value=e,this._listeners=[],this._isFinished=!1,this._onFinishCbs=[],void 0!==t&&(this._deregisterCancellation=t.register(()=>this.finish()))}getValue(){return this._value}setValue(e){if(this._isFinished)return void 0;if(this._value=e,0===this._listeners.length)return;const t=this._listeners.slice();for(const n of t)try{n.hasBeenCleared||n.trigger(e,n.complete)}catch(e){}}setValueIfChanged(e){e!==this._value&&this.setValue(e)}onUpdate(e,t){const n=()=>{if(void 0!==(null===t||void 0===t?void 0:t.clearSignal)&&t.clearSignal.deregister(n),i.hasBeenCleared)return;i.hasBeenCleared=!0;const e=this._listeners.indexOf(i);e>=0&&this._listeners.splice(e,1)},i={trigger:e,complete:n,hasBeenCleared:!1};this._listeners.push(i),!0===(null===t||void 0===t?void 0:t.emitCurrentValue)&&e(this._value,n),this._isFinished||i.hasBeenCleared?n():void 0!==(null===t||void 0===t?void 0:t.clearSignal)&&t.clearSignal.register(n)}waitUntilDefined(e,t){this.onUpdate((t,n)=>{void 0!==t&&(n(),e(this._value))},{clearSignal:null===t||void 0===t?void 0:t.clearSignal,emitCurrentValue:!0})}_onFinished(e,t){if(t.isCancelled())return U;const n=()=>{const e=le(this._onFinishCbs,e=>e.trigger===i);e>=0&&(this._onFinishCbs[e].hasBeenCleared=!0,this._onFinishCbs.splice(e,1))},i=()=>{n(),e()},r=t.register(n);return this._onFinishCbs.push({trigger:i,hasBeenCleared:!1}),r}finish(){void 0!==this._deregisterCancellation&&this._deregisterCancellation(),this._isFinished=!0;const e=this._listeners.slice();for(const t of e)try{t.hasBeenCleared||(t.complete(),t.hasBeenCleared=!0)}catch(e){}if(this._listeners.length=0,this._onFinishCbs.length>0){const e=this._onFinishCbs.slice();for(const t of e)try{t.hasBeenCleared||(t.trigger(),t.hasBeenCleared=!0)}catch(e){}this._onFinishCbs.length=0}}}function ce(e,t,n){const i=new ue(t(e.getValue()),n);return e.onUpdate(function(e){i.setValue(t(e))},{clearSignal:n}),e._onFinished(()=>{i.finish()},n),i}var de=ue;class he extends Error{constructor(e){super(e),Object.setPrototypeOf(this,he.prototype),this.name="AssertionError"}}function fe(e,t){0}function pe(e,t,n="object"){fe(!r(e),`${n} should be an object`);for(const i in t)t.hasOwnProperty(i)&&fe(typeof e[i]===t[i],`${n} should have property ${i} as a ${t[i]}`)}function ge(e){throw new he("Unreachable path taken")}class me{constructor(){const[e,t]=be();this._isUsed=!1,this._trigger=e,this.signal=new ve(t)}isUsed(){return this._isUsed}linkToSignal(e){const t=e.register(()=>{this.cancel()});return this.signal.register(t),t}cancel(e){if(this._isUsed)return;this._isUsed=!0;const t=null!==e&&void 0!==e?e:new ye;this._trigger(t)}static isCancellationError(e){return e instanceof ye}}class ve{constructor(e){this._isCancelled=!1,this.cancellationError=null,this._listeners=[],e(e=>{this.cancellationError=e,this._isCancelled=!0;while(this._listeners.length>0)try{const t=this._listeners.pop();null===t||void 0===t||t(e)}catch(e){j.error("Error while calling clean up listener",e instanceof Error?e.toString():"Unknown error")}})}isCancelled(){return this._isCancelled}register(e){return this._isCancelled?(fe(null!==this.cancellationError),e(this.cancellationError),U):(this._listeners.push(e),()=>this.deregister(e))}deregister(e){for(let t=this._listeners.length-1;t>=0;t--)this._listeners[t]===e&&this._listeners.splice(t,1)}}class ye extends Error{constructor(){const e="This task was cancelled.";super(e),Object.setPrototypeOf(this,ye.prototype),this.name="CancellationError"}}function be(){let e=U;return[function(t){e(t)},function(t){e=t}]}const Se=new de(0);const Te="undefined"!==typeof performance?()=>performance.now()+Se.getValue():()=>Date.now()+Se.getValue();var _e=Te;function we(e){const t=e.map(t=>Math.log(t/e[0])),n=t.map(e=>e-t[0]+1),i=(n[n.length-1]-1)/(2*e.length+10),r=1/i;return e.map((e,t)=>a(t));function a(t){if(0===t)return 0;const s=Math.min(Math.max(1,t),e.length-1);return e[s]===e[s-1]?a(t-1):r*(i+(e[s]*n[s-1]-e[s-1]*n[s])/(e[s]-e[s-1]))+4}}const Ee=6e3,xe=15e3,Ae=3e3,ke=1e3,Ie=9e3;class Ce{constructor(e){this._levelsMap=we(e).map(e=>{return e+4}),this._bitrates=e,this._lastUnsuitableQualityTimestamp=void 0,this._blockRaiseDelay=Ee,j.debug("ABR: Steps for buffer based chooser.",this._levelsMap.map((t,n)=>`bufferLevel: ${t}, bitrate: ${e[n]}`).join(" ,"))}onAddedSegment(e){const t=this._levelsMap,n=this._bitrates,{bufferGap:i,currentBitrate:a,currentScore:s,speed:o}=e;if(r(a))return void(this._currentEstimate=n[0]);let l,u=-1;for(let r=0;r<n.length;r++){const e=n[r];if(e===a)u=r;else if(e>a)break}if(u<0||n.length!==t.length)return j.info("ABR: Current Bitrate not found in the calculated levels"),void(this._currentEstimate=n[0]);void 0!==s&&(l=0===o?s.score:s.score/o);const c=isFinite(i)?i:0,d=_e();if(c<t[u]||void 0!==l&&l<1&&1===(null===s||void 0===s?void 0:s.confidenceLevel)){const e=void 0===this._lastUnsuitableQualityTimestamp?-1:d-this._lastUnsuitableQualityTimestamp;if(e<this._blockRaiseDelay+Ie){const e=this._blockRaiseDelay+Ae;this._blockRaiseDelay=Math.min(e,xe),j.debug("ABR: Incrementing blocking raise in BufferBasedChooser due to unstable quality",this._blockRaiseDelay)}else{const e=this._blockRaiseDelay-ke;this._blockRaiseDelay=Math.max(Ee,e),j.debug("ABR: Lowering quality in BufferBasedChooser",this._blockRaiseDelay)}this._lastUnsuitableQualityTimestamp=d;const i=le(n,e=>e===a);for(let r=i-1;r>=0;r--)if(c>=t[r])return void(this._currentEstimate=n[r]);return void(this._currentEstimate=n[0])}if(void 0!==this._lastUnsuitableQualityTimestamp&&d-this._lastUnsuitableQualityTimestamp<this._blockRaiseDelay||void 0===l||l<1.15||1!==(null===s||void 0===s?void 0:s.confidenceLevel))return void(this._currentEstimate=a);const h=t[u],f=(()=>{for(let e=u+1;e<t.length;e++)if(t[e]>h)return e})();if(void 0!==f){const e=t[f];if(i>=e)return j.debug("ABR: Raising quality in BufferBasedChooser",n[f]),void(this._currentEstimate=n[f])}this._currentEstimate=a}getLastEstimate(){return this._currentEstimate}}function Re(e,t,n){if("function"===typeof Array.prototype.find)return e.find(t,n);const i=e.length>>>0;for(let r=0;r<i;r++){const i=e[r];if(t.call(n,i,r,e))return i}}class Me{constructor(e){this._alpha=Math.exp(Math.log(.5)/e),this._lastEstimate=0,this._totalWeight=0}addSample(e,t){const n=Math.pow(this._alpha,e),i=t*(1-n)+n*this._lastEstimate;isNaN(i)||(this._lastEstimate=i,this._totalWeight+=e)}getEstimate(){const e=1-Math.pow(this._alpha,this._totalWeight);return this._lastEstimate/e}}function De(e,t){let n=-1;for(let s=0;s<e.length;s++){const{segment:i}=e[s].content;if(i.duration<=0)continue;const r=i.time+i.duration;if(!i.complete&&s===e.length-1&&t-i.time>-1.2){n=s;break}if(r>t&&t-i.time>-1.2){n=s;break}}if(n<0)return[];const i=e[n],r=i.content.segment.time,a=[i];for(let s=n+1;s<e.length;s++){if(e[s].content.segment.time!==r)break;a.push(e[s])}return a}function Le(e){if(e.progress.length<5)return;const t=new Me(2),{progress:n}=e;for(let i=1;i<n.length;i++){const e=n[i].size-n[i-1].size,r=n[i].timestamp-n[i-1].timestamp,a=8*e/(r/1e3);t.addSample(r/1e3,a)}return t.getEstimate()}function Pe(e,t){const n=8*(e.totalSize-e.size);return Math.max(n/t,0)}function Oe(e,t,n,i,a){if(i)return;const{bufferGap:s,speed:o,position:l}=t,u=isFinite(s)?s:0,c=l.getWanted()+u,d=De(e,c);if(1!==d.length)return;const h=d[0],f=_e();let p=1.5*h.content.segment.duration;if(p=Math.min(p,3e3),p=Math.max(p,12e3),f-h.requestTimestamp<p)return;const g=h.progress.length>0?h.progress[h.progress.length-1]:void 0,m=Le(h);if(void 0!==g&&void 0!==m){const e=Pe(g,m);if((f-g.timestamp)/1e3<=e){const t=e-u/o;if(t>2500)return m}}if(!h.content.segment.complete)return;const v=h.content.segment.duration,y=(f-h.requestTimestamp)/1e3,b=y<=(1.5*v+2)/o;if(r(n)||b)return;const S=v/y,T=n.bitrate*Math.min(.7,S);return void 0===a||T<a?T:void 0}function Ne(e,t,n){if(n)return!0;const i=isFinite(e.bufferGap)?e.bufferGap:0,r=e.position.getWanted()+i,a=Re(t,({content:e})=>e.segment.duration>0&&e.segment.time+e.segment.duration>r);if(void 0===a)return!0;const s=_e(),o=a.progress.length>0?a.progress[a.progress.length-1]:void 0,l=Le(a);if(void 0===o||void 0===l)return!0;const u=Pe(o,l);if((s-o.timestamp)/1e3>1.2*u)return!0;const c=u-i/e.speed;return c>-1.5}class Ue{constructor(e,t){const{ABR_STARVATION_GAP:n,OUT_OF_STARVATION_GAP:i,ABR_STARVATION_FACTOR:r,ABR_REGULAR_FACTOR:a}=N.getCurrent();this._initialBitrate=e,this._inStarvationMode=!1,this._lowLatencyMode=t,this._config=t?{starvationGap:n.LOW_LATENCY,outOfStarvationGap:i.LOW_LATENCY,starvationBitrateFactor:r.LOW_LATENCY,regularBitrateFactor:a.LOW_LATENCY}:{starvationGap:n.DEFAULT,outOfStarvationGap:i.DEFAULT,starvationBitrateFactor:r.DEFAULT,regularBitrateFactor:a.DEFAULT}}getBandwidthEstimate(e,t,n,i,a){let s,o;const l=this._config,{bufferGap:u,position:c,duration:d}=e,h=isFinite(u)?u:0,{ABR_STARVATION_DURATION_DELTA:f}=N.getCurrent();return isNaN(d)||h+c.getWanted()<d-f?!this._inStarvationMode&&h<=l.starvationGap?(j.info("ABR: enter starvation mode."),this._inStarvationMode=!0):this._inStarvationMode&&h>=l.outOfStarvationGap&&(j.info("ABR: exit starvation mode."),this._inStarvationMode=!1):this._inStarvationMode&&(j.info("ABR: exit starvation mode."),this._inStarvationMode=!1),this._inStarvationMode&&(o=Oe(i,e,n,this._lowLatencyMode,a),void 0!==o&&(j.info("ABR: starvation mode emergency estimate:",o),t.reset(),s=r(n)?o:Math.min(o,n.bitrate))),r(s)&&(o=t.getEstimate(),s=void 0!==o?o*(this._inStarvationMode?l.starvationBitrateFactor:l.regularBitrateFactor):void 0!==a?a*(this._inStarvationMode?l.starvationBitrateFactor:l.regularBitrateFactor):this._initialBitrate),e.speed>1&&(s/=e.speed),{bandwidthEstimate:o,bitrateChosen:s}}isUrgent(e,t,n,i){return null===t||!(e>=t.bitrate)&&Ne(i,n,this._lowLatencyMode)}}class Fe{constructor(e,t){this._scoreCalculator=e,this._lastAbrEstimate=t,this._consecutiveWrongGuesses=0,this._blockGuessesUntil=0,this._lastMaintanableBitrate=null}getGuess(e,t,n,i,r){const{bufferGap:a,speed:s}=t,o=this._lastAbrEstimate.representation;if(null===o)return null;if(i>o.bitrate)return 2===this._lastAbrEstimate.algorithmType&&(null!==this._lastAbrEstimate.representation&&(this._lastMaintanableBitrate=this._lastAbrEstimate.representation.bitrate),this._consecutiveWrongGuesses=0),null;const l=this._scoreCalculator.getEstimate(n);if(2!==this._lastAbrEstimate.algorithmType){if(void 0===l)return null;if(this._canGuessHigher(a,s,l)){const t=Be(e,n);if(null!==t)return t}return null}if(this._isLastGuessValidated(o,i,l)&&(j.debug("ABR: Guessed Representation validated",o.bitrate),this._lastMaintanableBitrate=o.bitrate,this._consecutiveWrongGuesses=0),n.id!==o.id)return o;const u=this._shouldStopGuess(n,l,a,r);if(u)return this._consecutiveWrongGuesses++,this._blockGuessesUntil=_e()+Math.min(15e3*this._consecutiveWrongGuesses,12e4),Ve(e,n);if(void 0===l)return n;if(this._canGuessHigher(a,s,l)){const t=Be(e,n);if(null!==t)return t}return n}_canGuessHigher(e,t,{score:n,confidenceLevel:i}){return isFinite(e)&&e>=2.5&&_e()>this._blockGuessesUntil&&1===i&&n/t>1.01}_shouldStopGuess(e,t,n,i){if(void 0!==t&&t.score<1.01)return!0;if((void 0===t||t.score<1.2)&&n<.6)return!0;const r=i.filter(t=>{return t.content.representation.id===e.id}),a=_e();for(const s of r){const t=a-s.requestTimestamp;if(s.content.segment.isInit){if(t>1e3)return!0}else{if(t>1e3*s.content.segment.duration+200)return!0;{const t=Le(s);if(void 0!==t&&t<.8*e.bitrate)return!0}}}return!1}_isLastGuessValidated(e,t,n){return void 0!==n&&1===n.confidenceLevel&&n.score>1.5||t>=e.bitrate&&(null===this._lastMaintanableBitrate||this._lastMaintanableBitrate<e.bitrate)}}function Be(e,t){const n=e.length;let i=le(e,({id:e})=>e===t.id);if(i<0)return j.error("ABR: Current Representation not found."),null;while(++i<n)if(e[i].bitrate>t.bitrate)return e[i];return null}function Ve(e,t){let n=le(e,({id:e})=>e===t.id);if(n<0)return j.error("ABR: Current Representation not found."),null;while(--n>=0)if(e[n].bitrate<t.bitrate)return e[n];return null}class je{constructor(){const{ABR_FAST_EMA:e,ABR_SLOW_EMA:t}=N.getCurrent();this._fastEWMA=new Me(e),this._slowEWMA=new Me(t),this._bytesSampled=0}addSample(e,t){const{ABR_MINIMUM_CHUNK_SIZE:n}=N.getCurrent();if(t<n)return;const i=8e3*t/e,r=e/1e3;this._bytesSampled+=t,this._fastEWMA.addSample(r,i),this._slowEWMA.addSample(r,i)}getEstimate(){const{ABR_MINIMUM_TOTAL_BYTES:e}=N.getCurrent();if(!(this._bytesSampled<e))return Math.min(this._fastEWMA.getEstimate(),this._slowEWMA.getEstimate())}reset(){const{ABR_FAST_EMA:e,ABR_SLOW_EMA:t}=N.getCurrent();this._fastEWMA=new Me(e),this._slowEWMA=new Me(t),this._bytesSampled=0}}function Ge(e,t){if(0===e.length)return[];e.sort((e,t)=>e.bitrate-t.bitrate);const n=e[0].bitrate,i=Math.max(t,n),r=le(e,e=>e.bitrate>i);return-1===r?e:e.slice(0,r)}function He(e,t){if(void 0===t.width||void 0===t.height)return e;const n=t.width*t.pixelRatio,i=t.height*t.pixelRatio,r=e.slice().sort((e,t)=>{var n,i;return(null!==(n=e.width)&&void 0!==n?n:0)-(null!==(i=t.width)&&void 0!==i?i:0)}),a=Re(r,e=>"number"===typeof e.width&&e.width>=n&&"number"===typeof e.height&&e.height>=i);if(void 0===a)return e;const s="number"===typeof a.width?a.width:0;return e.filter(e=>"number"!==typeof e.width||e.width<=s)}class ze{constructor(){this.bandwidth=void 0,this.representation=null,this.algorithmType=3}update(e,t,n){this.representation=e,this.bandwidth=t,this.algorithmType=n}}function Ke(e){return Object.keys(e).map(t=>e[t])}var $e="function"===typeof Object.values?Object.values:Ke;class We{constructor(){this._currentRequests={}}add(e){const{id:t,requestTimestamp:n,content:i}=e;this._currentRequests[t]={requestTimestamp:n,progress:[],content:i}}addProgress(e){const t=this._currentRequests[e.id];r(t)?j.warn("ABR: progress for a request not added"):t.progress.push(e)}remove(e){r(this._currentRequests[e])&&j.warn("ABR: can't remove unknown request"),delete this._currentRequests[e]}getRequests(){return $e(this._currentRequests).filter(e=>!r(e)).sort((e,t)=>e.content.segment.time-t.content.segment.time)}}class qe{constructor(){this._currentRepresentationData=null,this._lastRepresentationWithGoodScore=null}addSample(e,t,n){const i=n/t,r=this._currentRepresentationData;let a;null!==r&&r.representation.id===e.id?(a=r.ewma,r.ewma.addSample(t,i),r.loadedDuration+=n,r.loadedSegments++):(a=new Me(5),a.addSample(t,i),this._currentRepresentationData={representation:e,ewma:a,loadedDuration:n,loadedSegments:0}),a.getEstimate()>1&&this._lastRepresentationWithGoodScore!==e&&(j.debug("ABR: New last stable representation",e.bitrate),this._lastRepresentationWithGoodScore=e)}getEstimate(e){if(null===this._currentRepresentationData||this._currentRepresentationData.representation.id!==e.id)return;const{ewma:t,loadedSegments:n,loadedDuration:i}=this._currentRepresentationData,r=t.getEstimate(),a=n>=5&&i>=10?1:0;return{score:r,confidenceLevel:a}}getLastStableRepresentation(){return this._lastRepresentationWithGoodScore}}function Ye(e,t){const n=le(e,e=>e.bitrate>t);return-1===n?e[e.length-1]:0===n?e[0]:e[n-1]}const Xe=new de(void 0);Xe.finish();const Qe=new de(1/0);function Ze(e){const t={},{initialBitrates:n,throttlers:i,lowLatencyMode:a}=e;return function(e,t,r,o,l){var u,c,d;const{type:h}=e.adaptation,f=s(h),p=null!==(u=n[h])&&void 0!==u?u:0,g={limitResolution:null!==(c=i.limitResolution[h])&&void 0!==c?c:Xe,throttleBitrate:null!==(d=i.throttleBitrate[h])&&void 0!==d?d:Qe};return Je({bandwidthEstimator:f,context:e,currentRepresentation:t,filters:g,initialBitrate:p,playbackObserver:o,representations:r,lowLatencyMode:a},l)};function s(e){const n=t[e];if(r(n)){j.debug("ABR: Creating new BandwidthEstimator for ",e);const n=new je;return t[e]=n,n}return n}}function Je({bandwidthEstimator:e,context:t,currentRepresentation:n,filters:i,initialBitrate:r,lowLatencyMode:a,playbackObserver:s,representations:o},l){const u=new qe,c=new Ue(null!==r&&void 0!==r?r:0,a),d=new We;let h=U;const f={metrics:y,requestBegin:b,requestProgress:S,requestEnd:T,addedSegment(e){h(e)}};let p=new me;p.linkToSignal(l);const g=m(o.getValue(),p.signal);return o.onUpdate(v,{clearSignal:l}),{estimates:g,callbacks:f};function m(r,o){if(r.length<=1)return new de({bitrate:void 0,representation:r[0],urgent:!0,knownStableBitrate:void 0});let l=!1;const f=r.sort((e,t)=>e.bitrate-t.bitrate),p=new Ce(f.map(e=>e.bitrate)),g=new ze,m=new Fe(u,g);let v=s.getReference().getValue();const y=new de(S());return s.listen(e=>{v=e,b()},{includeLastObservation:!1,clearSignal:o}),h=function(e){if(null===v)return;const{position:t,speed:n}=v,i=e.buffered,r=ie(i,t.getWanted()),{representation:a}=e.content,s=u.getEstimate(a),o=a.bitrate,l={bufferGap:r,currentBitrate:o,currentScore:s,speed:n};p.onAddedSegment(l),b()},o.register(()=>{h=U}),i.throttleBitrate.onUpdate(b,{clearSignal:o}),i.limitResolution.onUpdate(b,{clearSignal:o}),y;function b(){y.setValue(S())}function S(){const{bufferGap:r,position:s,maximumPosition:o}=v,h=i.limitResolution.getValue(),y=i.throttleBitrate.getValue(),b=n.getValue(),S=et(f,h,y),T=d.getRequests(),{bandwidthEstimate:_,bitrateChosen:w}=c.getBandwidthEstimate(v,e,b,T,g.bandwidth),E=u.getLastStableRepresentation(),x=null===E?void 0:E.bitrate/(v.speed>0?v.speed:1),{ABR_ENTER_BUFFER_BASED_ALGO:A,ABR_EXIT_BUFFER_BASED_ALGO:k}=N.getCurrent();l&&r<=k?l=!1:!l&&isFinite(r)&&r>=A&&(l=!0);const I=Ye(S,w),C=p.getLastEstimate();let R=I.bitrate,M=null;l&&void 0!==C&&C>R&&(M=Ye(S,C),R=M.bitrate);let D=null;return a&&null!==b&&t.manifest.isDynamic&&o-s.getWanted()<40&&(D=m.getGuess(f,v,b,R,T)),null!==D&&D.bitrate>R?(j.debug("ABR: Choosing representation with guess-based estimation.",D.bitrate,D.id),g.update(D,_,2),{bitrate:_,representation:D,urgent:null===b||D.bitrate<b.bitrate,knownStableBitrate:x}):null!==M?(j.debug("ABR: Choosing representation with buffer-based estimation.",M.bitrate,M.id),g.update(M,_,0),{bitrate:_,representation:M,urgent:c.isUrgent(M.bitrate,b,T,v),knownStableBitrate:x}):(j.debug("ABR: Choosing representation with bandwidth estimation.",I.bitrate,I.id),g.update(I,_,1),{bitrate:_,representation:I,urgent:c.isUrgent(I.bitrate,b,T,v),knownStableBitrate:x})}}function v(){const e=o.getValue();p.cancel(),p=new me,p.linkToSignal(l);const t=m(e,p.signal);t.onUpdate(function(e){g.setValue(e)},{clearSignal:p.signal,emitCurrentValue:!0})}function y(t){const{requestDuration:n,segmentDuration:i,size:r,content:a}=t;if(e.addSample(n,r),!a.segment.isInit){const{segment:e,representation:t}=a;if(void 0===i&&!e.complete)return;const r=null!==i&&void 0!==i?i:e.duration;u.addSample(t,n/1e3,r)}}function b(e){d.add(e)}function S(e){d.addProgress(e)}function T(e){d.remove(e.id)}}function et(e,t,n){let i=e;return void 0!==n&&n<1/0&&(i=Ge(i,n)),void 0!==t&&(i=He(i,t)),i}Qe.finish();var tt=Ze;class nt extends Error{constructor(e,t,n){let i;switch(n){case"TIMEOUT":i="The request timed out";break;case"ERROR_EVENT":i="An error prevented the request to be performed successfully";break;case"PARSE_ERROR":i="An error happened while formatting the response data";break;case"ERROR_HTTP_CODE":i="An HTTP status code indicating failure was received: "+String(t);break}super(i),Object.setPrototypeOf(this,nt.prototype),this.name="RequestError",this.url=e,this.status=t,this.type=n}serialize(){return{url:this.url,status:this.status,type:this.type}}}const it={TIMEOUT:"TIMEOUT",ERROR_EVENT:"ERROR_EVENT",ERROR_HTTP_CODE:"ERROR_HTTP_CODE",PARSE_ERROR:"PARSE_ERROR"},rt=it,at={NETWORK_ERROR:"NETWORK_ERROR",MEDIA_ERROR:"MEDIA_ERROR",ENCRYPTED_MEDIA_ERROR:"ENCRYPTED_MEDIA_ERROR",OTHER_ERROR:"OTHER_ERROR"},st={PIPELINE_LOAD_ERROR:"PIPELINE_LOAD_ERROR",PIPELINE_PARSE_ERROR:"PIPELINE_PARSE_ERROR",INTEGRITY_ERROR:"INTEGRITY_ERROR",MANIFEST_PARSE_ERROR:"MANIFEST_PARSE_ERROR",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"MANIFEST_INCOMPATIBLE_CODECS_ERROR",MANIFEST_UPDATE_ERROR:"MANIFEST_UPDATE_ERROR",MANIFEST_UNSUPPORTED_ADAPTATION_TYPE:"MANIFEST_UNSUPPORTED_ADAPTATION_TYPE",MEDIA_STARTING_TIME_NOT_FOUND:"MEDIA_STARTING_TIME_NOT_FOUND",MEDIA_TIME_BEFORE_MANIFEST:"MEDIA_TIME_BEFORE_MANIFEST",MEDIA_TIME_AFTER_MANIFEST:"MEDIA_TIME_AFTER_MANIFEST",MEDIA_TIME_NOT_FOUND:"MEDIA_TIME_NOT_FOUND",NO_PLAYABLE_REPRESENTATION:"NO_PLAYABLE_REPRESENTATION",MEDIA_IS_ENCRYPTED_ERROR:"MEDIA_IS_ENCRYPTED_ERROR",CREATE_MEDIA_KEYS_ERROR:"CREATE_MEDIA_KEYS_ERROR",MEDIA_KEYS_ATTACHMENT_ERROR:"MEDIA_KEYS_ATTACHMENT_ERROR",KEY_ERROR:"KEY_ERROR",KEY_STATUS_CHANGE_ERROR:"KEY_STATUS_CHANGE_ERROR",KEY_UPDATE_ERROR:"KEY_UPDATE_ERROR",KEY_LOAD_ERROR:"KEY_LOAD_ERROR",KEY_LOAD_TIMEOUT:"KEY_LOAD_TIMEOUT",KEY_GENERATE_REQUEST_ERROR:"KEY_GENERATE_REQUEST_ERROR",INCOMPATIBLE_KEYSYSTEMS:"INCOMPATIBLE_KEYSYSTEMS",INVALID_ENCRYPTED_EVENT:"INVALID_ENCRYPTED_EVENT",INVALID_KEY_SYSTEM:"INVALID_KEY_SYSTEM",LICENSE_SERVER_CERTIFICATE_ERROR:"LICENSE_SERVER_CERTIFICATE_ERROR",MULTIPLE_SESSIONS_SAME_INIT_DATA:"MULTIPLE_SESSIONS_SAME_INIT_DATA",BUFFER_APPEND_ERROR:"BUFFER_APPEND_ERROR",BUFFER_FULL_ERROR:"BUFFER_FULL_ERROR",BUFFER_TYPE_UNKNOWN:"BUFFER_TYPE_UNKNOWN",MEDIA_ERR_BLOCKED_AUTOPLAY:"MEDIA_ERR_BLOCKED_AUTOPLAY",MEDIA_ERR_PLAY_NOT_ALLOWED:"MEDIA_ERR_PLAY_NOT_ALLOWED",MEDIA_ERR_NOT_LOADED_METADATA:"MEDIA_ERR_NOT_LOADED_METADATA",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_UNKNOWN:"MEDIA_ERR_UNKNOWN",MEDIA_SOURCE_NOT_SUPPORTED:"MEDIA_SOURCE_NOT_SUPPORTED",MEDIA_KEYS_NOT_SUPPORTED:"MEDIA_KEYS_NOT_SUPPORTED",DISCONTINUITY_ENCOUNTERED:"DISCONTINUITY_ENCOUNTERED",NONE:"NONE"};function ot(e,t){return`${e}: ${t}`}class lt extends Error{constructor(e,t,n){super(ot(e,t)),Object.setPrototypeOf(this,lt.prototype),this.name="EncryptedMediaError",this.type=at.ENCRYPTED_MEDIA_ERROR,this.code=e,this._originalMessage=t,this.fatal=!1,"string"===typeof(null===n||void 0===n?void 0:n.keyStatuses)&&(this.keyStatuses=n.keyStatuses)}serialize(){return{name:this.name,code:this.code,reason:this._originalMessage,keyStatuses:this.keyStatuses}}}class ut extends Error{constructor(e,t,n){super(ot(e,t)),Object.setPrototypeOf(this,ut.prototype),this.name="MediaError",this.type=at.MEDIA_ERROR,this._originalMessage=t,this.code=e,this.fatal=!1,void 0!==(null===n||void 0===n?void 0:n.tracks)&&(null===n||void 0===n?void 0:n.tracks.length)>0&&(this.tracksInfo=n.tracks)}serialize(){return{name:this.name,code:this.code,reason:this._originalMessage,tracks:this.tracksInfo}}}class ct extends Error{constructor(e,t){super(ot(e,t.message)),Object.setPrototypeOf(this,ct.prototype),this.name="NetworkError",this.type=at.NETWORK_ERROR,this.url=t.url,this.status=t.status,this.errorType=t.type,this._baseError=t,this.code=e,this.fatal=!1}isHttpError(e){return this.errorType===rt.ERROR_HTTP_CODE&&this.status===e}serialize(){return{name:this.name,code:this.code,baseError:this._baseError.serialize()}}}class dt extends Error{constructor(e,t){super(ot(e,t)),Object.setPrototypeOf(this,dt.prototype),this.name="OtherError",this.type=at.OTHER_ERROR,this.code=e,this.fatal=!1,this._originalMessage=t}serialize(){return{name:this.name,code:this.code,reason:this._originalMessage}}}function ht(e){return(e instanceof lt||e instanceof ut||e instanceof dt||e instanceof ct)&&Object.keys(at).indexOf(e.type)>=0}function ft(e,{defaultCode:t,defaultReason:n}){if(ht(e))return e;const i=e instanceof Error?e.toString():n;return new dt(t,i)}function pt(){let e="",t=-1;return function(){return t++,t>=Number.MAX_SAFE_INTEGER&&(e+="0",t=0),e+String(t)}}function gt(e,t,n){if("function"===typeof Array.prototype.includes)return e.includes(t,n);const i=e.length>>>0;if(0===i)return!1;const r=0|n;let a=r>=0?Math.min(r,i-1):Math.max(i+r,0);const s=(e,t)=>e===t||"number"===typeof e&&"number"===typeof t&&isNaN(e)&&isNaN(t);while(a<i){if(s(e[a],t))return!0;a++}return!1}const mt=[];function vt(e){gt(mt,e)||(console.warn(e),mt.push(e))}function yt(e,t){if(e.length!==t.length)return!1;if(e===t)return!0;for(let n=e.length-1;n>=0;n--)if(e[n]!==t[n])return!1;return!0}const bt=["audio","video","text"];function St(e){var t,n;const i=e.timeBounds;if(null===i.timeshiftDepth)return null!==(t=i.minimumSafePosition)&&void 0!==t?t:0;const{maximumTimeData:r}=i;let a;if(i.maximumTimeData.isLinear){const e=_e()-r.time;a=r.maximumSafePosition+e/1e3}else a=r.maximumSafePosition;const s=a-i.timeshiftDepth;return Math.max(null!==(n=i.minimumSafePosition)&&void 0!==n?n:0,s)}function Tt(e){const{maximumTimeData:t}=e.timeBounds;if(!e.isLive||void 0===t.livePosition)return;if(!t.isLinear)return t.livePosition;const n=_e()-t.time;return t.livePosition+n/1e3}function _t(e){const{maximumTimeData:t}=e.timeBounds;if(!t.isLinear)return t.maximumSafePosition;const n=_e()-t.time;return t.maximumSafePosition+n/1e3}function wt(e,t){if(void 0===t)return kt(e).filter(e=>{return!0===e.isSupported});const n=e.adaptations[t];return void 0===n?[]:n.filter(e=>{return!0===e.isSupported})}function Et(e,t){let n=null;for(let i=e.periods.length-1;i>=0;i--){const r=e.periods[i];if(At(r,t,n))return r;n=r}}function xt(e,t){const n=t.end;if(void 0===n)return null;const i=Re(e.periods,e=>{return void 0===e.end||n<e.end});return void 0===i?null:i}function At(e,t,n){return t>=e.start&&(void 0===e.end||t<e.end)||t===e.end&&(null===n||n.start>e.end)}function kt(e){const t=e.adaptations;return Ke(t).reduce((e,t)=>r(t)?e:e.concat(t),[])}function It(e,t){var n,i;const r={language:null!==(n=e.language)&&void 0!==n?n:"",normalized:null!==(i=e.normalizedLanguage)&&void 0!==i?i:"",audioDescription:!0===e.isAudioDescription,id:e.id,representations:(t?e.representations.filter(e=>!0===e.isSupported&&!1!==e.decipherable):e.representations).map(Mt),label:e.label};return!0===e.isDub&&(r.dub=!0),r}function Ct(e){var t,n;return{language:null!==(t=e.language)&&void 0!==t?t:"",normalized:null!==(n=e.normalizedLanguage)&&void 0!==n?n:"",closedCaption:!0===e.isClosedCaption,id:e.id,label:e.label,forced:e.isForcedSubtitles}}function Rt(e,t){const n=void 0!==e.trickModeTracks?e.trickModeTracks.map(e=>{const n=(t?e.representations.filter(e=>!0===e.isSupported&&!1!==e.decipherable):e.representations).map(Dt),i={id:e.id,representations:n,isTrickModeTrack:!0};return!0===e.isSignInterpreted&&(i.signInterpreted=!0),i}):void 0,i={id:e.id,representations:(t?e.representations.filter(e=>!0===e.isSupported&&!1!==e.decipherable):e.representations).map(Dt),label:e.label};return!0===e.isSignInterpreted&&(i.signInterpreted=!0),!0===e.isTrickModeTrack&&(i.isTrickModeTrack=!0),void 0!==n&&(i.trickModeTracks=n),i}function Mt(e){const{id:t,bitrate:n,codecs:i,isSpatialAudio:r,isSupported:a,decipherable:s}=e;return{id:t,bitrate:n,codec:null===i||void 0===i?void 0:i[0],isSpatialAudio:r,isCodecSupported:a,decipherable:s}}function Dt(e){const{id:t,bitrate:n,frameRate:i,width:r,height:a,codecs:s,hdrInfo:o,isSupported:l,decipherable:u}=e;return{id:t,bitrate:n,frameRate:i,width:r,height:a,codec:null===s||void 0===s?void 0:s[0],hdrInfo:o,isCodecSupported:l,decipherable:u}}function Lt(e){switch(e.type){case"audio":return{type:"audio",track:It(e,!1)};case"video":return{type:"video",track:Rt(e,!1)};case"text":return{type:"text",track:Ct(e)}}}function Pt(e){return new Function(`return (${e}(arguments[0], arguments[1]))`)}function Ot(e){return"string"===typeof e&&e.length>0}const Nt={aa:"aar",ab:"abk",ae:"ave",af:"afr",ak:"aka",am:"amh",an:"arg",ar:"ara",as:"asm",av:"ava",ay:"aym",az:"aze",ba:"bak",be:"bel",bg:"bul",bi:"bis",bm:"bam",bn:"ben",bo:"bod",br:"bre",bs:"bos",ca:"cat",ce:"che",ch:"cha",co:"cos",cr:"cre",cs:"ces",cu:"chu",cv:"chv",cy:"cym",da:"dan",de:"deu",dv:"div",dz:"dzo",ee:"ewe",el:"ell",en:"eng",eo:"epo",es:"spa",et:"est",eu:"eus",fa:"fas",ff:"ful",fi:"fin",fj:"fij",fo:"fao",fr:"fra",fy:"fry",ga:"gle",gd:"gla",gl:"glg",gn:"grn",gu:"guj",gv:"glv",ha:"hau",he:"heb",hi:"hin",ho:"hmo",hr:"hrv",ht:"hat",hu:"hun",hy:"hye",hz:"her",ia:"ina",id:"ind",ie:"ile",ig:"ibo",ii:"iii",ik:"ipk",io:"ido",is:"isl",it:"ita",iu:"iku",ja:"jpn",jv:"jav",ka:"kat",kg:"kon",ki:"kik",kj:"kua",kk:"kaz",kl:"kal",km:"khm",kn:"kan",ko:"kor",kr:"kau",ks:"kas",ku:"kur",kv:"kom",kw:"cor",ky:"kir",la:"lat",lb:"ltz",lg:"lug",li:"lim",ln:"lin",lo:"lao",lt:"lit",lu:"lub",lv:"lav",mg:"mlg",mh:"mah",mi:"mri",mk:"mkd",ml:"mal",mn:"mon",mr:"mar",ms:"msa",mt:"mlt",my:"mya",na:"nau",nb:"nob",nd:"nde",ne:"nep",ng:"ndo",nl:"nld",nn:"nno",no:"nor",nr:"nbl",nv:"nav",ny:"nya",oc:"oci",oj:"oji",om:"orm",or:"ori",os:"oss",pa:"pan",pi:"pli",pl:"pol",ps:"pus",pt:"por",qu:"que",rm:"roh",rn:"run",ro:"ron",ru:"rus",rw:"kin",sa:"san",sc:"srd",sd:"snd",se:"sme",sg:"sag",si:"sin",sk:"slk",sl:"slv",sm:"smo",sn:"sna",so:"som",sq:"sqi",sr:"srp",ss:"ssw",st:"sot",su:"sun",sv:"swe",sw:"swa",ta:"tam",te:"tel",tg:"tgk",th:"tha",ti:"tir",tk:"tuk",tl:"tgl",tn:"tsn",to:"ton",tr:"tur",ts:"tso",tt:"tat",tw:"twi",ty:"tah",ug:"uig",uk:"ukr",ur:"urd",uz:"uzb",ve:"ven",vi:"vie",vo:"vol",wa:"wln",wo:"wol",xh:"xho",yi:"yid",yo:"yor",za:"zha",zh:"zho",zu:"zul"};var Ut=Nt;const Ft={alb:"sqi",arm:"hye",baq:"eus",bur:"mya",chi:"zho",cze:"ces",dut:"nld",fre:"fra",geo:"kat",ger:"deu",gre:"ell",ice:"isl",mac:"mkd",mao:"mri",may:"msa",per:"fas",slo:"slk",rum:"ron",tib:"bod",wel:"cym"};var Bt=Ft;function Vt(e){if(r(e)||""===e)return"und";const t=(""+e).toLowerCase().split("-"),n=t[0],i=jt(n);return Ot(i)?i:e}function jt(e){let t;switch(e.length){case 2:t=Ut[e];break;case 3:t=Bt[e];break}return t}var Gt=Vt,Ht=Gt;const zt={dashParsers:{wasm:null,native:null,fastJs:null},codecSupportProber:null,createDebugElement:null,directfile:null,decrypt:null,htmlTextDisplayer:null,htmlTextTracksParsers:{},mainThreadMediaSourceInit:null,multithread:null,nativeTextDisplayer:null,nativeTextTracksParsers:{},transports:{}};var Kt=zt,$t=Kt;const Wt=pt();class qt{constructor(e,t){var n,i,r,a,s;if(this.id=e.id,this.uniqueId=Wt(),this.bitrate=e.bitrate,this.codecs=[],void 0!==e.isSpatialAudio&&(this.isSpatialAudio=e.isSpatialAudio),void 0!==e.height&&(this.height=e.height),void 0!==e.width&&(this.width=e.width),void 0!==e.mimeType&&(this.mimeType=e.mimeType),void 0!==e.contentProtections&&(this.contentProtections=e.contentProtections),void 0!==e.frameRate&&(this.frameRate=e.frameRate),void 0!==e.hdrInfo&&(this.hdrInfo=e.hdrInfo),this.cdnMetadata=e.cdnMetadata,this.index=e.index,"audio"===t||"video"===t)if(null!==$t.codecSupportProber){if(void 0!==e.supplementalCodecs){const t=$t.codecSupportProber.isSupported(null!==(n=this.mimeType)&&void 0!==n?n:"",null!==(i=e.supplementalCodecs)&&void 0!==i?i:"");!1!==t&&(this.codecs=[e.supplementalCodecs],!0===t&&(this.isSupported=!0))}!0!==this.isSupported&&(this.codecs.length>0?this.codecs.push(null!==(r=e.codecs)&&void 0!==r?r:""):(this.codecs=void 0===e.codecs?[]:[e.codecs],this.isSupported=$t.codecSupportProber.isSupported(null!==(a=this.mimeType)&&void 0!==a?a:"",null!==(s=e.codecs)&&void 0!==s?s:"")))}else void 0!==e.supplementalCodecs&&this.codecs.push(e.supplementalCodecs),void 0!==e.codecs&&this.codecs.push(e.codecs);else void 0!==e.codecs&&this.codecs.push(e.codecs),this.isSupported=!0}refreshCodecSupport(e){var t;const n=null!==(t=this.mimeType)&&void 0!==t?t:"";let i=this.codecs;0===i.length&&(i=[""]);for(let r=0;r<i.length;r++)for(const t of e){const e=i[r];if(t.codec===e&&t.mimeType===n){if(t.result)return this.isSupported=!0,void(this.codecs=[e]);if(r===i.length)return this.isSupported=!1,void(this.codecs=[e])}}}getMimeTypeString(){var e,t,n;return`${null!==(e=this.mimeType)&&void 0!==e?e:""};codecs="${null!==(n=null===(t=this.codecs)||void 0===t?void 0:t[0])&&void 0!==n?n:""}"`}getEncryptionData(e){var t,n;const i=this.getAllEncryptionData(),r=[];for(let a=0;a<i.length;a++){let s=!1;const o=i[a];for(let i=0;i<o.values.length;i++)if(o.values[i].systemId.toLowerCase()===e.toLowerCase())if(s)r[r.length-1].values.push(o.values[i]);else{const e=null===(n=null===(t=this.contentProtections)||void 0===t?void 0:t.keyIds)||void 0===n?void 0:n.map(e=>e.keyId);r.push({type:o.type,keyIds:e,values:[o.values[i]]}),s=!0}}return r}getAllEncryptionData(){var e,t;if(void 0===this.contentProtections||0===this.contentProtections.initData.length)return[];const n=null===(t=null===(e=this.contentProtections)||void 0===e?void 0:e.keyIds)||void 0===t?void 0:t.map(e=>e.keyId);return this.contentProtections.initData.map(e=>{return{type:e.type,keyIds:n,values:e.values}})}addProtectionData(e,t,n){let i=!1;if(void 0===this.contentProtections)return this.contentProtections={keyIds:void 0!==t?[{keyId:t}]:[],initData:[{type:e,values:n}]},!0;if(void 0!==t){const e=this.contentProtections.keyIds;if(void 0===e)this.contentProtections.keyIds=[{keyId:t}];else{let n=!1;for(const i of e)yt(i.keyId,t)&&(n=!0);n||(j.warn("Manifest: found unanounced key id."),e.push({keyId:t}))}}const r=this.contentProtections.initData;for(let a=0;a<r.length;a++)if(r[a].type===e){const e=r[a].values;for(let t=0;t<n.length;t++){const r=n[t];let a;for(a=0;a<e.length;a++)if(r.systemId===e[a].systemId){if(yt(r.data,e[a].data))break;j.warn("Manifest: different init data for the same system ID")}a===e.length&&(e.push(r),i=!0)}return i}return this.contentProtections.initData.push({type:e,values:n}),!0}getMetadataSnapshot(){return{id:this.id,uniqueId:this.uniqueId,bitrate:this.bitrate,codecs:this.codecs,mimeType:this.mimeType,width:this.width,height:this.height,frameRate:this.frameRate,isSupported:this.isSupported,hdrInfo:this.hdrInfo,contentProtections:this.contentProtections,decipherable:this.decipherable}}}var Yt,Xt=qt;class Qt{constructor(e,t={}){const{trickModeTracks:n}=e,{representationFilter:i,isManuallyAdded:a}=t;this.id=e.id,this.type=e.type,void 0!==e.isTrickModeTrack&&(this.isTrickModeTrack=e.isTrickModeTrack),void 0!==e.language&&(this.language=e.language,this.normalizedLanguage=Ht(e.language)),void 0!==e.closedCaption&&(this.isClosedCaption=e.closedCaption),void 0!==e.audioDescription&&(this.isAudioDescription=e.audioDescription),void 0!==e.isDub&&(this.isDub=e.isDub),void 0!==e.forcedSubtitles&&(this.isForcedSubtitles=e.forcedSubtitles),void 0!==e.isSignInterpreted&&(this.isSignInterpreted=e.isSignInterpreted),void 0!==e.label&&(this.label=e.label),void 0!==n&&n.length>0&&(this.trickModeTracks=n.map(e=>new Qt(e)));const s=e.representations,o=[];let l;for(let u=0;u<s.length;u++){const e=new Xt(s[u],this.type);let t=!0;if(!r(i)){const n={id:e.id,bitrate:e.bitrate,codecs:e.codecs,height:e.height,width:e.width,frameRate:e.frameRate,hdrInfo:e.hdrInfo};if(void 0!==e.contentProtections&&(n.contentProtections={},void 0!==e.contentProtections.keyIds)){const t=e.contentProtections.keyIds.map(({keyId:e})=>e);n.contentProtections.keyIds=t}t=i(n,{trackType:this.type,language:this.language,normalizedLanguage:this.normalizedLanguage,isClosedCaption:this.isClosedCaption,isDub:this.isDub,isAudioDescription:this.isAudioDescription,isSignInterpreted:this.isSignInterpreted})}t?(o.push(e),void 0===l&&(!0===e.isSupported?l=!0:!1===e.isSupported&&(l=!1))):j.debug("Filtering Representation due to representationFilter",this.type,`Adaptation: ${this.id}`,`Representation: ${e.id}`,`(${e.bitrate})`)}o.sort((e,t)=>e.bitrate-t.bitrate),this.representations=o,this.isSupported=l,this.manuallyAdded=!0===a}refreshCodecSupport(e){for(const t of this.representations)void 0===t.isSupported&&(t.refreshCodecSupport(e),!0!==this.isSupported&&!0===t.isSupported?this.isSupported=!0:void 0===this.isSupported&&!1===t.isSupported&&(this.isSupported=!1))}getRepresentation(e){return Re(this.representations,({id:t})=>e===t)}getMetadataSnapshot(){const e=[],t=this.representations;for(const n of t)e.push(n.getMetadataSnapshot());return{id:this.id,type:this.type,isSupported:this.isSupported,language:this.language,isForcedSubtitles:this.isForcedSubtitles,isClosedCaption:this.isClosedCaption,isAudioDescription:this.isAudioDescription,isSignInterpreted:this.isSignInterpreted,normalizedLanguage:this.normalizedLanguage,representations:e,label:this.label,isDub:this.isDub}}}class Zt{constructor(e,t,n){if(this.id=e.id,this.adaptations=Object.keys(e.adaptations).reduce((i,a)=>{const s=e.adaptations[a];if(r(s))return i;const o=s.map(e=>{const i=new Qt(e,{representationFilter:n});return i.representations.length>0&&!1===i.isSupported&&t.push(i),i}).filter(e=>e.representations.length>0);if(o.every(e=>!1===e.isSupported)&&s.length>0&&("video"===a||"audio"===a))throw new ut("MANIFEST_INCOMPATIBLE_CODECS_ERROR","No supported "+a+" adaptations",{tracks:void 0});return o.length>0&&(i[a]=o),i},{}),!Array.isArray(this.adaptations.video)&&!Array.isArray(this.adaptations.audio))throw new ut("MANIFEST_PARSE_ERROR","No supported audio and video tracks.");this.duration=e.duration,this.start=e.start,r(this.duration)||r(this.start)||(this.end=this.start+this.duration),this.streamEvents=void 0===e.streamEvents?[]:e.streamEvents}refreshCodecSupport(e,t){Object.keys(this.adaptations).forEach(n=>{const i=this.adaptations[n];if(void 0===i)return;let r=!1;for(const a of i){const n=a.isSupported;a.refreshCodecSupport(e),!1!==n&&!1===a.isSupported&&t.push(a),!1===r?r=a.isSupported:void 0===r&&!0===a.isSupported&&(r=!0)}if(("video"===n||"audio"===n)&&!1===r)throw new ut("MANIFEST_INCOMPATIBLE_CODECS_ERROR","No supported "+n+" adaptations",{tracks:void 0})},{})}getAdaptations(){return kt(this)}getAdaptationsForType(e){const t=this.adaptations[e];return null!==t&&void 0!==t?t:[]}getAdaptation(e){return Re(this.getAdaptations(),({id:t})=>e===t)}getSupportedAdaptations(e){return wt(this,e)}containsTime(e,t){return At(this,e,t)}getMetadataSnapshot(){const e={},t=this.getAdaptations();for(const n of t){let t=e[n.type];void 0===t&&(t=[],e[n.type]=t),t.push(n.getMetadataSnapshot())}return{start:this.start,end:this.end,id:this.id,streamEvents:this.streamEvents,adaptations:e}}}function Jt(e,t,n){const i={updatedAdaptations:[],removedAdaptations:[],addedAdaptations:[]};e.start=t.start,e.end=t.end,e.duration=t.duration,e.streamEvents=t.streamEvents;const r=e.getAdaptations(),a=t.getAdaptations();for(let s=0;s<r.length;s++){const e=r[s],t=le(a,t=>t.id===e.id);if(-1===t){j.warn('Manifest: Adaptation "'+r[s].id+'" not found when merging.');const[e]=r.splice(s,1);s--,i.removedAdaptations.push({id:e.id,trackType:e.type})}else{const[r]=a.splice(t,1),s=[],o=[],l=[];i.updatedAdaptations.push({adaptation:e.id,trackType:e.type,updatedRepresentations:s,addedRepresentations:o,removedRepresentations:l});const u=e.representations,c=r.representations.slice();for(let e=0;e<u.length;e++){const t=u[e],i=le(c,e=>e.id===t.id);if(-1===i){j.warn(`Manifest: Representation "${u[e].id}" `+"not found when merging.");const[t]=u.splice(e,1);e--,l.push(t.id)}else{const[e]=c.splice(i,1);s.push(t.getMetadataSnapshot()),t.cdnMetadata=e.cdnMetadata,n===Yt.Full?t.index._replace(e.index):t.index._update(e.index)}}c.length>0&&(j.warn(`Manifest: ${c.length} new Representations `+"found when merging."),e.representations.push(...c),o.push(...c.map(e=>e.getMetadataSnapshot())))}}if(a.length>0){j.warn(`Manifest: ${a.length} new Adaptations `+"found when merging.");for(const t of a){const n=e.adaptations[t.type];void 0===n?e.adaptations[t.type]=[t]:n.push(t),i.addedAdaptations.push(t.getMetadataSnapshot())}}return i}function en(e,t){const n={updatedPeriods:[],addedPeriods:[],removedPeriods:[]};let i=0;for(let a=0;a<t.length;a++){const r=t[a];let s=i,o=e[s];while(void 0!==o&&o.id!==r.id)s++,o=e[s];if(void 0!==o){const l=Jt(o,r,Yt.Full);n.updatedPeriods.push({period:{id:o.id,start:o.start,end:o.end,duration:o.duration,streamEvents:o.streamEvents},result:l});const u=t.slice(i,a),c=s-i,d=e.splice(i,c,...u);n.removedPeriods.push(...d.map(e=>({id:e.id,start:e.start,end:e.end}))),n.addedPeriods.push(...u.map(e=>e.getMetadataSnapshot())),i=a+1}}if(i>e.length)return j.error("Manifest: error when updating Periods"),n;if(i<e.length){const t=e.splice(i,e.length-i);n.removedPeriods.push(...t.map(e=>({id:e.id,start:e.start,end:e.end})))}const r=t.slice(i,t.length);return r.length>0&&(e.push(...r),n.addedPeriods.push(...r.map(e=>e.getMetadataSnapshot()))),n}function tn(e,t){const n={updatedPeriods:[],addedPeriods:[],removedPeriods:[]};if(0===e.length)return e.splice(0,0,...t),n.addedPeriods.push(...t.map(e=>e.getMetadataSnapshot())),n;if(0===t.length)return n;const i=e[e.length-1];if(i.start<t[0].start){if(i.end!==t[0].start)throw new ut("MANIFEST_UPDATE_ERROR","Cannot perform partial update: not enough data");return e.push(...t),n.addedPeriods.push(...t.map(e=>e.getMetadataSnapshot())),n}const r=le(e,({id:e})=>e===t[0].id);if(r<0)throw new ut("MANIFEST_UPDATE_ERROR","Cannot perform partial update: incoherent data");const a=Jt(e[r],t[0],Yt.Partial);n.updatedPeriods.push({period:M(e[r].getMetadataSnapshot(),{adaptations:void 0}),result:a});let s=r+1;for(let o=1;o<t.length;o++){const i=t[o];let r=-1;for(let t=s;t<e.length;t++)if(i.id===e[t].id){r=t;break}if(r<0){let t=-1;for(let n=s;n<e.length;n++)if(i.start<e[n].start){t=n;break}const r=t-s,a=e.splice(s,r,i);n.addedPeriods.push(i.getMetadataSnapshot()),n.removedPeriods.push(...a.map(e=>({id:e.id,start:e.start,end:e.end})))}else{if(r>s){j.warn("Manifest: old Periods not found in new when updating, removing");const t=e.splice(s,r-s);n.removedPeriods.push(...t.map(e=>({id:e.id,start:e.start,end:e.end}))),r=s}const t=Jt(e[r],i,Yt.Full);n.updatedPeriods.push({period:M(e[r].getMetadataSnapshot(),{adaptations:void 0}),result:t})}s++}if(s<e.length){j.warn("Manifest: Ending Periods not found in new when updating, removing");const t=e.splice(s,e.length-s);n.removedPeriods.push(...t.map(e=>({id:e.id,start:e.start,end:e.end})))}return n}(function(e){e[e["Full"]=0]="Full",e[e["Partial"]=1]="Partial"})(Yt||(Yt={}));const nn=pt();class rn extends a{constructor(e,t,n){var i;super();const{representationFilter:r,manifestUpdateUrl:a}=t;this.manifestFormat=0,this.id=nn(),this.expired=null!==(i=e.expired)&&void 0!==i?i:null,this.transport=e.transportType,this.clockOffset=e.clockOffset;const s=[];if(this.periods=e.periods.map(e=>{const t=new Zt(e,s,r);return t}).sort((e,t)=>e.start-t.start),s.length>0){const e=new ut("MANIFEST_INCOMPATIBLE_CODECS_ERROR","An Adaptation contains only incompatible codecs.",{tracks:s.map(Lt)});n.push(e)}this.adaptations=void 0===this.periods[0]?{}:this.periods[0].adaptations,this.timeBounds=e.timeBounds,this.isDynamic=e.isDynamic,this.isLive=e.isLive,this.isLastPeriodKnown=e.isLastPeriodKnown,this.uris=void 0===e.uris?[]:e.uris,this.updateUrl=a,this.lifetime=e.lifetime,this.clockOffset=e.clockOffset,this.suggestedPresentationDelay=e.suggestedPresentationDelay,this.availabilityStartTime=e.availabilityStartTime,this.publishTime=e.publishTime}refreshCodecSupport(e){const t=[];for(const n of this.periods)n.refreshCodecSupport(e,t);return t.length>0?new ut("MANIFEST_INCOMPATIBLE_CODECS_ERROR","An Adaptation contains only incompatible codecs.",{tracks:t.map(Lt)}):null}getPeriod(e){return Re(this.periods,t=>{return e===t.id})}getPeriodForTime(e){return Et(this,e)}getNextPeriod(e){return Re(this.periods,t=>{return t.start>e})}getPeriodAfter(e){return xt(this,e)}getUrls(){return this.uris}replace(e){this._performUpdate(e,Yt.Full)}update(e){this._performUpdate(e,Yt.Partial)}getMinimumSafePosition(){return St(this)}getLivePosition(){return Tt(this)}getMaximumSafePosition(){return _t(this)}updateRepresentationsDeciperability(e){const t=an(this,e);t.length>0&&this.trigger("decipherabilityUpdate",t)}getAdaptations(){vt("manifest.getAdaptations() is deprecated. Please use manifest.period[].getAdaptations() instead");const e=this.periods[0];if(void 0===e)return[];const t=e.adaptations,n=[];for(const i in t)if(t.hasOwnProperty(i)){const e=t[i];n.push(...e)}return n}getAdaptationsForType(e){vt("manifest.getAdaptationsForType(type) is deprecated. Please use manifest.period[].getAdaptationsForType(type) instead");const t=this.periods[0];if(void 0===t)return[];const n=t.adaptations[e];return void 0===n?[]:n}getAdaptation(e){return vt("manifest.getAdaptation(id) is deprecated. Please use manifest.period[].getAdaptation(id) instead"),Re(this.getAdaptations(),({id:t})=>e===t)}getMetadataSnapshot(){const e=[];for(const t of this.periods)e.push(t.getMetadataSnapshot());return{manifestFormat:1,id:this.id,periods:e,isDynamic:this.isDynamic,isLive:this.isLive,isLastPeriodKnown:this.isLastPeriodKnown,suggestedPresentationDelay:this.suggestedPresentationDelay,clockOffset:this.clockOffset,uris:this.uris,availabilityStartTime:this.availabilityStartTime,timeBounds:this.timeBounds}}_performUpdate(e,t){let n;if(this.availabilityStartTime=e.availabilityStartTime,this.expired=e.expired,this.isDynamic=e.isDynamic,this.isLive=e.isLive,this.isLastPeriodKnown=e.isLastPeriodKnown,this.lifetime=e.lifetime,this.clockOffset=e.clockOffset,this.suggestedPresentationDelay=e.suggestedPresentationDelay,this.transport=e.transport,this.publishTime=e.publishTime,t===Yt.Full)this.timeBounds=e.timeBounds,this.uris=e.uris,n=en(this.periods,e.periods);else{this.timeBounds.maximumTimeData=e.timeBounds.maximumTimeData,this.updateUrl=e.uris[0],n=tn(this.periods,e.periods);const t=this.getMinimumSafePosition();while(this.periods.length>0){const e=this.periods[0];if(void 0===e.end||e.end>t)break;this.periods.shift()}}this.adaptations=void 0===this.periods[0]?{}:this.periods[0].adaptations,this.trigger("manifestUpdate",n)}}function an(e,t){const n=[];for(const i of e.periods)for(const r of i.getAdaptations())for(const a of r.representations){const s={manifest:e,period:i,adaptation:r,representation:a},o=t(s);o!==a.decipherable&&(n.push(s),a.decipherable=o,j.debug(`Decipherability changed for "${a.id}"`,`(${a.bitrate})`,String(a.decipherable)))}return n}var sn=rn;function on(e){return e instanceof nt?new ct("PIPELINE_LOAD_ERROR",e):ft(e,{defaultCode:"PIPELINE_LOAD_ERROR",defaultReason:"Unknown error when fetching the Manifest"})}class ln extends Error{constructor(e,t,n){super(e),Object.setPrototypeOf(this,ln.prototype),this.name="CustomLoaderError",this.canRetry=t,this.xhr=n}}function un(e,t){let n;return new Promise((i,r)=>{if(null!==e.cancellationError)return r(e.cancellationError);let a=!1;function s(e){void 0!==n&&n(),r(e)}n=t(function(t){e.deregister(s),a=!0,i(t)},function(t){e.deregister(s),a=!0,r(t)}),a||e.register(s)})}function cn(e,t){return un(t,t=>{const n=setTimeout(()=>t(),e);return()=>clearTimeout(n)})}const dn=.3;function hn(e){const t=(2*Math.random()-1)*dn;return e*(t+1)}function fn(e){return e instanceof nt?e.type===rt.ERROR_HTTP_CODE?e.status>=500||404===e.status||415===e.status||412===e.status:e.type===rt.TIMEOUT||e.type===rt.ERROR_EVENT:e instanceof ln?"boolean"===typeof e.canRetry?e.canRetry:void 0!==e.xhr&&(e.xhr.status>=500||404===e.xhr.status||415===e.xhr.status||412===e.xhr.status):ht(e)&&"INTEGRITY_ERROR"===e.code}async function pn(e,t,n,i,r){if(null!==r.cancellationError)return Promise.reject(r.cancellationError);const{baseDelay:a,maxDelay:s,maxRetry:o,onRetry:l}=i;null!==e&&0===e.length&&j.warn("Fetchers: no CDN given to `scheduleRequestWithCdns`.");const u=new Map,c=d();if(void 0===c)throw new Error("No CDN to request");return h(c);function d(){if(null===e){const e=u.get(null);if(void 0!==e&&e.isBlacklisted)return;return null}if(null===t)return g(e);{const n=t.getCdnPreferenceForResource(e);return g(n)}}async function h(e){try{const i=await n(e,r);return i}catch(n){if(me.isCancellationError(n))throw n;null!==e&&null!==t&&t.downgradeCdn(e);let i=u.get(e);if(void 0===i?(i={errorCounter:1,blockedUntil:void 0,isBlacklisted:!1},u.set(e,i)):i.errorCounter++,!fn(n))return i.blockedUntil=void 0,i.isBlacklisted=!0,f(n);if(i.errorCounter>o)i.blockedUntil=void 0,i.isBlacklisted=!0;else{const e=i.errorCounter,t=Math.min(a*Math.pow(2,e-1),s),n=hn(t);i.blockedUntil=_e()+n}return f(n)}}async function f(e){const t=d();if(r.isCancelled())throw r.cancellationError;if(void 0===t)throw e;if(l(e),r.isCancelled())throw r.cancellationError;return p(t,e)}function p(e,n){const i=u.get(e);if(void 0===i||void 0===i.blockedUntil)return h(e);const a=_e(),s=i.blockedUntil-a;if(s<=0)return h(e);const o=new me,l=o.linkToSignal(r);return new Promise((i,a)=>{function u(e){l(),i(e)}function c(e){l(),a(e)}null===t||void 0===t||t.addEventListener("priorityChange",()=>{const t=d();if(r.isCancelled())throw r.cancellationError;if(void 0===t)return c(n);t!==e&&(o.cancel(),p(t,n).then(u,c))},o.signal),cn(s,o.signal).then(()=>h(e).then(u,c),U)})}function g(e){var t;if(0===u.size)return e[0];const n=_e();return null===(t=e.filter(e=>{var t;return!0!==(null===(t=u.get(e))||void 0===t?void 0:t.isBlacklisted)}).reduce((e,t)=>{var i;let r=null===(i=u.get(t))||void 0===i?void 0:i.blockedUntil;return void 0!==r&&r<=n&&(r=void 0),void 0===e?[t,r]:void 0===e[1]?e:void 0===r?[t,void 0]:r<e[1]?[t,r]:e},void 0))||void 0===t?void 0:t[0]}}function gn(e,t,n){return pn(null,null,e,t,n)}class mn extends a{constructor(e,t,n){super(),this.scheduleManualRefresh=U,this._manifestUrls=e,this._pipelines=t.manifest,this._settings=n,this._canceller=new me,this._isStarted=!1,this._isRefreshPending=!1,this._consecutiveUnsafeMode=0,this._prioritizedContentUrl=null}dispose(){this._canceller.cancel(),this.removeEventListener()}start(){if(this._isStarted)return;let e;this._isStarted=!0;const t=this._settings.initialManifest;e=t instanceof sn?Promise.resolve({manifest:t}):void 0!==t?this.parse(t,{previousManifest:null,unsafeMode:!1},void 0):this._fetchManifest(void 0).then(e=>{return e.parse({previousManifest:null,unsafeMode:!1})}),e.then(e=>{this.trigger("manifestReady",e.manifest),this._canceller.isUsed()||this._recursivelyRefreshManifest(e.manifest,e)}).catch(e=>this._onFatalError(e))}updateContentUrls(e,t){var n;this._prioritizedContentUrl=null!==(n=null===e||void 0===e?void 0:e[0])&&void 0!==n?n:void 0,t&&this.scheduleManualRefresh({enablePartialRefresh:!1,delay:0,canUseUnsafeMode:!1})}async _fetchManifest(e){var t;const n=this._canceller.signal,i=this._settings,r=this._pipelines,a=null!==e&&void 0!==e?e:null===(t=this._manifestUrls)||void 0===t?void 0:t[0],s=this._getBackoffSetting(e=>{this.trigger("warning",on(e))});try{const e=await o(a);return{parse:t=>{return this._parseLoadedManifest(e,t,a)}}}catch(e){throw on(e)}function o(e){const{loadManifest:t}=r;let a=void 0===i.requestTimeout?N.getCurrent().DEFAULT_REQUEST_TIMEOUT:i.requestTimeout,o=void 0===i.connectionTimeout?N.getCurrent().DEFAULT_CONNECTION_TIMEOUT:i.connectionTimeout;a<0&&(a=void 0),o<0&&(o=void 0);const l=()=>t(e,{timeout:a,connectionTimeout:o},n);return gn(l,s,n)}}parse(e,t,n){return this._parseLoadedManifest({responseData:e,size:void 0,requestDuration:void 0},t,n)}async _parseLoadedManifest(e,t,n){var i;const r=_e(),a=this._canceller.signal,s=this.trigger.bind(this),{sendingTime:o,receivedTime:l}=e,u=this._getBackoffSetting(e=>{this.trigger("warning",on(e))}),c=null!==n&&void 0!==n?n:null===(i=this._manifestUrls)||void 0===i?void 0:i[0],d={externalClockOffset:t.externalClockOffset,unsafeMode:t.unsafeMode,previousManifest:t.previousManifest,originalUrl:c};try{const t=this._pipelines.parseManifest(e,d,f,a,h);if(vn(t)){const{manifest:e,warnings:n}=await t;return p(e,n)}return p(t.manifest,t.warnings)}catch(e){const t=ft(e,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"Unknown error when parsing the Manifest"});throw t}async function h(e){try{const t=await gn(e,u,a);return t}catch(e){throw on(e)}}function f(e){for(const t of e){if(a.isCancelled())return;const e=ft(t,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"Unknown error when parsing the Manifest"});s("warning",e)}}function p(e,t){f(t);const n=_e()-r;return j.info(`MF: Manifest parsed in ${n}ms`),{manifest:e,sendingTime:o,receivedTime:l,parsingTime:n}}}_getBackoffSetting(e){const{DEFAULT_MAX_MANIFEST_REQUEST_RETRY:t,INITIAL_BACKOFF_DELAY_BASE:n,MAX_BACKOFF_DELAY_BASE:i}=N.getCurrent(),{lowLatencyMode:r,maxRetry:a}=this._settings,s=r?n.LOW_LATENCY:n.REGULAR,o=r?i.LOW_LATENCY:i.REGULAR,l=null!==a&&void 0!==a?a:t;return{onRetry:e,baseDelay:s,maxDelay:o,maxRetry:l}}_recursivelyRefreshManifest(e,{sendingTime:t,parsingTime:n,updatingTime:i}){const{MAX_CONSECUTIVE_MANIFEST_PARSING_IN_UNSAFE_MODE:r,MIN_MANIFEST_PARSING_TIME_TO_ENTER_UNSAFE_MODE:a}=N.getCurrent(),s=void 0!==n?n+(null!==i&&void 0!==i?i:0):void 0;let o=!1;this._consecutiveUnsafeMode>0?o=this._consecutiveUnsafeMode<r:void 0!==s&&(o=s>=a);const l=void 0===t?0:_e()-t,u=Math.max(this._settings.minimumManifestUpdateInterval-l,0),c=new me;if(c.linkToSignal(this._canceller.signal),this.scheduleManualRefresh=(n=>{const{enablePartialRefresh:i,delay:r,canUseUnsafeMode:a}=n,s=a&&o,l=void 0===t?0:_e()-t,u=Math.max(this._settings.minimumManifestUpdateInterval-l,0),d=setTimeout(()=>{c.cancel(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:i,unsafeMode:s})},Math.max((null!==r&&void 0!==r?r:0)-l,u));c.signal.register(()=>{clearTimeout(d)})}),null!==e.expired){const t=setTimeout(()=>{var t;null===(t=e.expired)||void 0===t||t.then(()=>{c.cancel(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:o})},U)},u);c.signal.register(()=>{clearTimeout(t)})}if(void 0!==e.lifetime&&e.lifetime>=0){const t=1e3*e.lifetime-l;let n;void 0===s?n=t:e.lifetime<3&&s>=100?(n=Math.min(Math.max(3e3-l,Math.max(t,0)+s),6*t),j.info("MUS: Manifest update rythm is too frequent. Postponing next request.",t,n)):s>=1e3*e.lifetime/10?(n=Math.min(Math.max(t,0)+s,6*t),j.info("MUS: Manifest took too long to parse. Postponing next request",n,n)):n=t;const i=setTimeout(()=>{c.cancel(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:o})},Math.max(n,u));c.signal.register(()=>{clearTimeout(i)})}}_triggerNextManifestRefresh(e,{enablePartialRefresh:t,unsafeMode:n}){const i=e.updateUrl;let r,a;null!==this._prioritizedContentUrl?(r=!0,a=this._prioritizedContentUrl,this._prioritizedContentUrl=null):(r=!t||void 0===i,a=r?e.getUrls()[0]:i);const s=e.clockOffset;n?(this._consecutiveUnsafeMode+=1,j.info('Init: Refreshing the Manifest in "unsafeMode" for the '+String(this._consecutiveUnsafeMode)+" consecutive time.")):this._consecutiveUnsafeMode>0&&(j.info('Init: Not parsing the Manifest in "unsafeMode" anymore after '+String(this._consecutiveUnsafeMode)+" consecutive times."),this._consecutiveUnsafeMode=0),this._isRefreshPending||(this._isRefreshPending=!0,this._fetchManifest(a).then(t=>t.parse({externalClockOffset:s,previousManifest:e,unsafeMode:n})).then(t=>{this._isRefreshPending=!1;const{manifest:n,sendingTime:i,parsingTime:a}=t,s=_e();if(r)e.replace(n);else try{e.update(n)}catch(t){const n=t instanceof Error?t.message:"unknown error";j.warn(`MUS: Attempt to update Manifest failed: ${n}`,"Re-downloading the Manifest fully");const{FAILED_PARTIAL_UPDATE_MANIFEST_REFRESH_DELAY:r}=N.getCurrent(),a=void 0===i?0:_e()-i,s=Math.max(this._settings.minimumManifestUpdateInterval-a,0);let o=U;const l=setTimeout(()=>{o(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:!1})},Math.max(r-a,s));return void(o=this._canceller.signal.register(()=>{clearTimeout(l)}))}const o=_e()-s;this._recursivelyRefreshManifest(e,{sendingTime:i,parsingTime:a,updatingTime:o})}).catch(e=>{this._isRefreshPending=!1,this._onFatalError(e)}))}_onFatalError(e){this._canceller.isUsed()||(this.trigger("error",e),this.dispose())}}function vn(e){return e instanceof Promise}var yn=mn;class bn extends a{constructor(e){super(),this._downgradedCdnList={metadata:[],timeouts:[]},e.register(()=>{for(const e of this._downgradedCdnList.timeouts)clearTimeout(e);this._downgradedCdnList={metadata:[],timeouts:[]}})}getCdnPreferenceForResource(e){return e.length<=1?e:this._innerGetCdnPreferenceForResource(e)}downgradeCdn(e){const t=Sn(this._downgradedCdnList.metadata,e);t>=0&&this._removeIndexFromDowngradeList(t);const{DEFAULT_CDN_DOWNGRADE_TIME:n}=N.getCurrent(),i=n;this._downgradedCdnList.metadata.push(e);const r=setTimeout(()=>{const t=Sn(this._downgradedCdnList.metadata,e);t>=0&&this._removeIndexFromDowngradeList(t),this.trigger("priorityChange",null)},i);this._downgradedCdnList.timeouts.push(r),this.trigger("priorityChange",null)}_innerGetCdnPreferenceForResource(e){const[t,n]=e.reduce((e,t)=>{return this._downgradedCdnList.metadata.some(e=>e.id===t.id&&e.baseUrl===t.baseUrl)?e[1].push(t):e[0].push(t),e},[[],[]]);return t.concat(n)}_removeIndexFromDowngradeList(e){this._downgradedCdnList.metadata.splice(e,1);const t=this._downgradedCdnList.timeouts.splice(e,1);clearTimeout(t[0])}}function Sn(e,t){return 0===e.length?-1:void 0!==t.id?le(e,e=>e.id===t.id):le(e,e=>e.baseUrl===t.baseUrl)}function Tn(e,t){const n=new WeakMap;return{createRequest(i,r,a,s){const o=e=>{return t(i,a,e)},l=e.create(o,r,a,s);return n.set(l,o),l},updatePriority(t,i){const r=n.get(t);void 0!==r?e.updatePriority(r,i):j.warn("Fetchers: Cannot update the priority of a request: task not found.")}}}function _n(e,t){return e.segment.id===t.segment.id&&e.representation.uniqueId===t.representation.uniqueId}function wn(e){if(r(e))return"";const{period:t,adaptation:n,representation:i,segment:a}=e;let s;return s=a.isInit?"init":a.complete?`${a.time}-${a.duration}`:`${a.time}`,`${n.type} P: ${t.id} A: ${n.id} `+`R: ${i.id} S: ${s}`}class En{constructor(){this._cache=new WeakMap}add({representation:e,segment:t},n){t.isInit&&this._cache.set(e,n)}get({representation:e,segment:t}){if(t.isInit){const t=this._cache.get(e);if(void 0!==t)return t}return null}}var xn=En;const An=pt();function kn(e,t,n,i,a){let s;s=void 0===a.connectionTimeout||a.connectionTimeout<0?void 0:a.connectionTimeout;const o={timeout:a.requestTimeout<0?void 0:a.requestTimeout,connectionTimeout:s},l=gt(["audio","video"],e)?new xn:void 0,{loadSegment:u,parseSegment:c}=t;return async function(e,t,s){var d,h,f;const{segment:p,adaptation:g,representation:m,manifest:v,period:y}=e,b=wn(e),S=An();let T;const _=[];let w=0,E=!1;const x={segment:p,type:g.type,language:g.language,isLive:v.isLive,periodStart:y.start,periodEnd:y.end,mimeType:m.mimeType,codecs:m.codecs[0],manifestPublishTime:v.publishTime},A={onProgress(e){var t;void 0===T&&void 0!==e.totalSize&&e.size<e.totalSize&&(null===(t=i.onProgress)||void 0===t||t.call(i,{duration:e.duration,size:e.size,totalSize:e.totalSize,timestamp:_e(),id:S}))},onNewChunk(e){t.onChunk(R(e,!0))}},k=void 0!==l?l.get(e):null;if(null!==k)return j.debug("SF: Found wanted segment in cache",b),t.onChunk(R(k,!1)),Promise.resolve();j.debug("SF: Beginning request",b),null===(d=i.onRequestBegin)||void 0===d||d.call(i,{requestTimestamp:_e(),id:S,content:e}),s.register(I);try{const r=await pn(e.representation.cdnMetadata,n,C,M({onRetry:D},a),s);if("segment-loaded"===r.resultType){const n=r.resultData.responseData;void 0!==l&&l.add(e,r.resultData.responseData),t.onChunk(R(n,!1))}else"segment-created"===r.resultType&&t.onChunk(R(r.resultData,!1));j.debug("SF: Segment request ended with success",b),t.onAllChunksReceived(),"segment-created"!==r.resultType?(T=r.resultData,L()):T=null,s.isCancelled()||null===(h=i.onRequestEnd)||void 0===h||h.call(i,{id:S}),s.deregister(I)}catch(e){if(s.deregister(I),T=null,e instanceof ye)throw j.debug("SF: Segment request aborted",b),e;throw j.debug("SF: Segment request failed",b),null===(f=i.onRequestEnd)||void 0===f||f.call(i,{id:S}),on(e)}function I(){var e;void 0===T&&(j.debug("SF: Segment request cancelled",b),T=null,null===(e=i.onRequestEnd)||void 0===e||e.call(i,{id:S}))}function C(e){return u(e,x,o,s,A)}function R(e,t){_.push(!1);const n=_.length-1;return function(i){const r={data:e,isChunked:t};try{const e=c(r,x,i);return _[n]||(w=void 0!==w&&"media"===e.segmentType&&null!==e.chunkInfos&&void 0!==e.chunkInfos.duration?w+e.chunkInfos.duration:void 0,_[n]=!0,L()),e}catch(e){throw ft(e,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"Unknown parsing error"})}}}function D(e){t.onRetry(on(e))}function L(){var t;E||!r(T)&&void 0!==T.size&&void 0!==T.requestDuration&&_.length>0&&_.every(e=>e)&&(E=!0,null===(t=i.onMetrics)||void 0===t||t.call(i,{size:T.size,requestDuration:T.requestDuration,content:e,segmentDuration:w}))}}}function In({maxRetry:e,lowLatencyMode:t,requestTimeout:n,connectionTimeout:i}){const{DEFAULT_MAX_REQUESTS_RETRY_ON_ERROR:r,DEFAULT_REQUEST_TIMEOUT:a,DEFAULT_CONNECTION_TIMEOUT:s,INITIAL_BACKOFF_DELAY_BASE:o,MAX_BACKOFF_DELAY_BASE:l}=N.getCurrent();return{maxRetry:null!==e&&void 0!==e?e:r,baseDelay:t?o.LOW_LATENCY:o.REGULAR,maxDelay:t?l.LOW_LATENCY:l.REGULAR,requestTimeout:void 0===n?a:n,connectionTimeout:void 0===i?s:i}}class Cn{constructor({prioritySteps:e}){if(this._minPendingPriority=null,this._waitingQueue=[],this._pendingTasks=[],this._prioritySteps=e,this._prioritySteps.high>=this._prioritySteps.low)throw new Error("TP: the max high level priority should be given a lowerpriority number than the min low priority.")}create(e,t,n,i){let r;return un(i,(a,s)=>{const o=()=>{if(r.hasEnded)return;const e=()=>{u(),this._endTask(r)},t=t=>{n.beforeEnded(),e(),a(t)},o=t=>{e(),s(t)},l=new me,u=l.linkToSignal(i);r.interrupter=l,l.signal.register(()=>{r.interrupter=null,i.isCancelled()||n.beforeInterrupted()}),this._minPendingPriority=null===this._minPendingPriority?r.priority:Math.min(this._minPendingPriority,r.priority),this._pendingTasks.push(r),r.taskFn(l.signal).then(t).catch(e=>{!i.isCancelled()&&l.isUsed()&&e instanceof ye||o(e)})};return r={hasEnded:!1,priority:t,trigger:o,taskFn:e,interrupter:null},this._canBeStartedNow(r)?(r.trigger(),this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks()):this._waitingQueue.push(r),()=>this._endTask(r)})}_endTask(e){e.hasEnded=!0;const t=Rn(e.taskFn,this._waitingQueue);if(t>=0)this._waitingQueue.splice(t,1);else{const t=Rn(e.taskFn,this._pendingTasks);if(t<0)return;this._pendingTasks.splice(t,1),this._pendingTasks.length>0?this._minPendingPriority===e.priority&&(this._minPendingPriority=Math.min(...this._pendingTasks.map(e=>e.priority))):this._minPendingPriority=null,this._loopThroughWaitingQueue()}}updatePriority(e,t){const n=Rn(e,this._waitingQueue);if(n>=0){const e=this._waitingQueue[n];if(e.priority===t)return;if(e.priority=t,!this._canBeStartedNow(e))return;return this._findAndRunWaitingQueueTask(n),void(this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks())}const i=Rn(e,this._pendingTasks);if(i<0)return void j.warn("TP: request to update the priority of a non-existent task");const r=this._pendingTasks[i];if(r.priority===t)return;const a=r.priority;r.priority=t,null===this._minPendingPriority||t<this._minPendingPriority?this._minPendingPriority=t:this._minPendingPriority===a&&(1===this._pendingTasks.length?this._minPendingPriority=t:this._minPendingPriority=Math.min(...this._pendingTasks.map(e=>e.priority)),this._loopThroughWaitingQueue()),this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks()}_loopThroughWaitingQueue(){const e=this._waitingQueue.reduce((e,t)=>{return null===e||e>t.priority?t.priority:e},null);if(!(null===e||null!==this._minPendingPriority&&this._minPendingPriority<e))for(let t=0;t<this._waitingQueue.length;t++){const n=null===this._minPendingPriority?e:Math.min(this._minPendingPriority,e),i=this._waitingQueue[t];i.priority<=n&&(this._findAndRunWaitingQueueTask(t),t--)}}_interruptCancellableTasks(){for(let e=0;e<this._pendingTasks.length;e++){const t=this._pendingTasks[e];if(t.priority>=this._prioritySteps.low)return this._interruptPendingTask(t),this._interruptCancellableTasks()}}_findAndRunWaitingQueueTask(e){if(e>=this._waitingQueue.length||e<0)return j.warn("TP : Tried to start a non existing task"),!1;const t=this._waitingQueue.splice(e,1)[0];return t.trigger(),!0}_interruptPendingTask(e){var t;const n=Rn(e.taskFn,this._pendingTasks);n<0?j.warn("TP: Interrupting a non-existent pending task. Aborting..."):(this._pendingTasks.splice(n,1),this._waitingQueue.push(e),0===this._pendingTasks.length?this._minPendingPriority=null:this._minPendingPriority===e.priority&&(this._minPendingPriority=Math.min(...this._pendingTasks.map(e=>e.priority))),null===(t=e.interrupter)||void 0===t||t.cancel())}_canBeStartedNow(e){return null===this._minPendingPriority||e.priority<=this._minPendingPriority}_isRunningHighPriorityTasks(){return null!==this._minPendingPriority&&this._minPendingPriority<=this._prioritySteps.high}}function Rn(e,t){return le(t,t=>t.taskFn===e)}class Mn{constructor(e,t,n){const i=new bn(n),{MIN_CANCELABLE_PRIORITY:r,MAX_HIGH_PRIORITY_LEVEL:a}=N.getCurrent();this._transport=e,this._prioritizer=new Cn({prioritySteps:{high:a,low:r}}),this._cdnPrioritizer=i,this._backoffOptions=t}createSegmentFetcher(e,t){const n=In(this._backoffOptions),i=this._transport[e],r=kn(e,i,this._cdnPrioritizer,t,n);return Tn(this._prioritizer,r)}}var Dn=Mn;class Ln{constructor(e){this._array=[],this._sortingFn=e}add(...e){e.sort(this._sortingFn);let t=0;for(let n=0;n<e.length;n++){const i=e[n];let r=!1;while(!r&&t<this._array.length)this._sortingFn(i,this._array[t])<0?(this._array.splice(t,0,i),r=!0):t++;r||this._array.push(i)}}length(){return this._array.length}get(e){if(e<0||e>=this._array.length)throw new Error("Invalid index.");return this._array[e]}toArray(){return this._array.slice()}findFirst(e){return Re(this._array,e)}has(e){return gt(this._array,e)}removeElement(e){const t=this._array.indexOf(e);if(t>=0)return this._array.splice(t,1),t}head(){return this._array[0]}last(){return this._array[this._array.length-1]}shift(){return this._array.shift()}pop(){return this._array.pop()}}class Pn extends a{constructor(e,t,n){super(),this._canceller=new me,this._manifest=e,this._activeStreams=new Map,this._allBufferTypes=n,this._lastCurrentPeriodId=null;const i=new On(e);this._maximumPositionCalculator=i;const r=this._canceller.signal;t.listen(({position:t})=>{const n=t.getWanted();if(n<e.getMinimumSafePosition()){const e=new ut("MEDIA_TIME_BEFORE_MANIFEST","The current position is behind the earliest time announced in the Manifest.");this.trigger("warning",e)}else if(n>i.getMaximumAvailablePosition()){const e=new ut("MEDIA_TIME_AFTER_MANIFEST","The current position is after the latest time announced in the Manifest.");this.trigger("warning",e)}},{includeLastObservation:!0,clearSignal:r}),e.addEventListener("manifestUpdate",()=>{this.trigger("endingPositionChange",this._getManifestEndTime()),r.isCancelled()||this._checkEndOfStream()},r)}getCurrentEndingTime(){return this._getManifestEndTime()}onAdaptationChange(e,t,n){if(this._manifest.isLastPeriodKnown){const i=this._manifest.periods[this._manifest.periods.length-1];if(t.id===(null===i||void 0===i?void 0:i.id)&&("audio"===e||"video"===e)){"audio"===e?this._maximumPositionCalculator.updateLastAudioAdaptation(n):this._maximumPositionCalculator.updateLastVideoAdaptation(n);const t=this._maximumPositionCalculator.getEndingPosition(),i=void 0!==t?{isEnd:!0,endingPosition:t}:{isEnd:!1,endingPosition:this._maximumPositionCalculator.getMaximumAvailablePosition()};this.trigger("endingPositionChange",i)}}this._canceller.isUsed()||null===n&&this._addActivelyLoadedPeriod(t,e)}onRepresentationChange(e,t){this._addActivelyLoadedPeriod(t,e)}onPeriodCleared(e,t){this._removeActivelyLoadedPeriod(t,e)}onLastSegmentFinishedLoading(e){const t=this._lazilyCreateActiveStreamInfo(e);t.hasFinishedLoadingLastPeriod||(t.hasFinishedLoadingLastPeriod=!0,this._checkEndOfStream())}onLastSegmentLoadingResume(e){const t=this._lazilyCreateActiveStreamInfo(e);t.hasFinishedLoadingLastPeriod&&(t.hasFinishedLoadingLastPeriod=!1,this._checkEndOfStream())}dispose(){this.removeEventListener(),this._canceller.cancel()}_addActivelyLoadedPeriod(e,t){const n=this._lazilyCreateActiveStreamInfo(t);n.activePeriods.has(e)||(n.activePeriods.add(e),this._checkCurrentPeriod())}_removeActivelyLoadedPeriod(e,t){const n=this._activeStreams.get(t);void 0!==n&&n.activePeriods.has(e)&&(n.activePeriods.removeElement(e),this._checkCurrentPeriod())}_checkCurrentPeriod(){if(0===this._allBufferTypes.length)return;const e=this._activeStreams.get(this._allBufferTypes[0]);if(void 0!==e)for(const t of e.activePeriods.toArray()){let e=!0;for(const n of this._allBufferTypes){const i=this._activeStreams.get(n);if(void 0===i)return;const r=i.activePeriods.toArray(),a=r.some(e=>e.id===t.id);if(!a){e=!1;break}}if(e)return void(this._lastCurrentPeriodId!==t.id&&(this._lastCurrentPeriodId=t.id,this.trigger("periodChange",t)))}}_getManifestEndTime(){const e=this._maximumPositionCalculator.getEndingPosition();return void 0!==e?{isEnd:!0,endingPosition:e}:{isEnd:!1,endingPosition:this._maximumPositionCalculator.getMaximumAvailablePosition()}}_lazilyCreateActiveStreamInfo(e){let t=this._activeStreams.get(e);return void 0===t&&(t={activePeriods:new Ln((e,t)=>e.start-t.start),hasFinishedLoadingLastPeriod:!1},this._activeStreams.set(e,t)),t}_checkEndOfStream(){if(!this._manifest.isLastPeriodKnown)return;const e=this._allBufferTypes.every(e=>{const t=this._activeStreams.get(e);return void 0!==t&&t.hasFinishedLoadingLastPeriod});e?this.trigger("endOfStream",null):this.trigger("resumeStream",null)}}class On{constructor(e){this._manifest=e,this._lastAudioAdaptation=void 0,this._lastVideoAdaptation=void 0}updateLastAudioAdaptation(e){this._lastAudioAdaptation=e}updateLastVideoAdaptation(e){this._lastVideoAdaptation=e}getMaximumAvailablePosition(){if(this._manifest.isDynamic)return this._manifest.getMaximumSafePosition();if(void 0===this._lastVideoAdaptation||void 0===this._lastAudioAdaptation)return this._manifest.getMaximumSafePosition();if(null===this._lastAudioAdaptation){if(null===this._lastVideoAdaptation)return this._manifest.getMaximumSafePosition();{const e=Nn(this._lastVideoAdaptation);return"number"!==typeof e?this._manifest.getMaximumSafePosition():e}}if(null===this._lastVideoAdaptation){const e=Nn(this._lastAudioAdaptation);return"number"!==typeof e?this._manifest.getMaximumSafePosition():e}{const e=Nn(this._lastAudioAdaptation),t=Nn(this._lastVideoAdaptation);return"number"!==typeof e||"number"!==typeof t?this._manifest.getMaximumSafePosition():Math.min(e,t)}}getEndingPosition(){var e,t;if(!this._manifest.isDynamic)return this.getMaximumAvailablePosition();if(void 0!==this._lastVideoAdaptation&&void 0!==this._lastAudioAdaptation){if(null===this._lastAudioAdaptation)return null===this._lastVideoAdaptation?void 0:null!==(e=Un(this._lastVideoAdaptation))&&void 0!==e?e:void 0;if(null===this._lastVideoAdaptation)return null!==(t=Un(this._lastAudioAdaptation))&&void 0!==t?t:void 0;{const e=Un(this._lastAudioAdaptation),t=Un(this._lastVideoAdaptation);return"number"!==typeof e||"number"!==typeof t?void 0:Math.min(e,t)}}}}function Nn(e){const{representations:t}=e;let n,i=null;for(const a of t)if(a.index!==n){n=a.index;const e=a.index.getLastAvailablePosition();if(void 0===e)return;null!==e&&(i=r(i)?e:Math.min(i,e))}return i}function Un(e){const{representations:t}=e;let n,i=null;for(let a=0;a<t.length;a++)if(t[a].index!==n){n=t[a].index;const e=t[a].index.getEnd();if(void 0===e)return;null!==e&&(i=r(i)?e:Math.min(i,e))}return i}function Fn(e,t,n,i,r,a){a.register(()=>{t.interruptDurationSetting()});const s=new Pn(e,n,i.getBufferTypes());a.register(()=>{s.dispose()}),s.addEventListener("warning",e=>r.onWarning(e)),s.addEventListener("periodChange",e=>r.onPeriodChanged(e)),s.addEventListener("endingPositionChange",e=>{t.setDuration(e.endingPosition,e.isEnd)}),s.addEventListener("endOfStream",()=>{j.debug("Init: end-of-stream order received."),t.maintainEndOfStream()}),s.addEventListener("resumeStream",()=>{t.stopEndOfStream()});const o=s.getCurrentEndingTime();return t.setDuration(o.endingPosition,o.isEnd),s}class Bn{constructor(e){this._segmentSinksStore=e,this._currentFreezeTimestamp=null}needToReload(e){const{readyState:t,rebuffering:n,freezing:i}=e,r=void 0!==e.bufferGap&&isFinite(e.bufferGap)?e.bufferGap:0;if(r<6||null===n&&null===i||t>1)return this._currentFreezeTimestamp=null,!1;const a=_e();null===this._currentFreezeTimestamp&&(this._currentFreezeTimestamp=a);const s=null!==n&&a-n.timestamp>4e3,o=null!==i&&a-i.timestamp>4e3;if((s||o)&&_e()-this._currentFreezeTimestamp>4e3){const e=this._segmentSinksStore.getStatus("audio"),t=this._segmentSinksStore.getStatus("video");let n=!0,i=!0;for(const r of[e,t])if("initialized"===r.type)for(const e of r.value.getLastKnownInventory()){const{representation:t}=e.infos;if(!1===t.decipherable)return j.warn("Init: we have undecipherable segments left in the buffer, reloading"),this._currentFreezeTimestamp=null,!0;void 0!==t.contentProtections&&(i=!1,!0!==t.decipherable&&(n=!1))}if(!i&&n)return j.warn("Init: we are frozen despite only having decipherable segments left in the buffer, reloading"),this._currentFreezeTimestamp=null,!0}return!1}}class Vn{constructor(e,t){this._history=[],this._lifetime=e,this._maxHistoryLength=t}addBufferedSegment(e,t){const n=_e();this._history.push({date:n,buffered:t,context:e}),this._cleanHistory(n)}getHistoryFor(e){return this._history.filter(t=>_n(t.context,e))}_cleanHistory(e){const t=e-this._lifetime;let n=0;for(const i of this._history){if(!(i.date<t))break;n++}if(n>0&&(this._history=this._history.splice(n)),this._history.length>this._maxHistoryLength){const e=this._history.length-this._maxHistoryLength;this._history=this._history.splice(e)}}}class jn{constructor(){const{BUFFERED_HISTORY_RETENTION_TIME:e,BUFFERED_HISTORY_MAXIMUM_ENTRIES:t}=N.getCurrent();this._inventory=[],this._bufferedHistory=new Vn(e,t)}reset(){this._inventory.length=0}synchronizeBuffered(e){var t,n,i,a,s,o,l;const u=this._inventory;let c=0,d=u[0];const{MINIMUM_SEGMENT_SIZE:h}=N.getCurrent(),f=null===d||void 0===d?void 0:d.infos.adaptation.type;if(j.hasLevel("DEBUG")){const t=e.map(e=>`${e.start}-${e.end}`).join(",");j.debug(`SI: synchronizing ${null!==f&&void 0!==f?f:"unknown"} buffered ranges:`,t)}const p=e.length;for(let r=0;r<p;r++){if(void 0===d)return;const g=e[r].start,m=e[r].end;if(m-g<h){j.warn("SI: skipped range when synchronizing because it was too small",f,g,m);continue}const v=c;while(void 0!==d&&(null!==(t=d.bufferedEnd)&&void 0!==t?t:d.end)-g<h)d=u[++c];let y=null;const b=c-v;if(b>0){const e=u[v+b-1];y={end:null!==(n=e.bufferedEnd)&&void 0!==n?n:e.end,precizeEnd:e.precizeEnd},j.debug(`SI: ${b} segments GCed.`,f);const t=u.splice(v,b);for(const n of t)void 0===n.bufferedStart&&void 0===n.bufferedEnd&&2!==n.status&&this._bufferedHistory.addBufferedSegment(n.infos,null);c=v}if(void 0===d)return;if(m-(null!==(i=d.bufferedStart)&&void 0!==i?i:d.start)>=h){if(zn(d,g,y,f),c===u.length-1)return void Kn(d,m,f);d=u[++c];let t=null!==(a=d.bufferedStart)&&void 0!==a?a:d.start,n=null!==(s=d.bufferedEnd)&&void 0!==s?s:d.end;const i=r<p-1?e[r+1].start:void 0;while(void 0!==d){if(m<t)break;if(m-t<h&&n-m>=h)break;if(void 0!==i&&m-t<n-i)break;const e=u[c-1];void 0===e.bufferedEnd&&(d.precizeStart?e.bufferedEnd=d.start:e.infos.segment.complete?e.bufferedEnd=e.end:e.bufferedEnd=d.start,j.debug("SI: calculating buffered end of contiguous segment",f,e.bufferedEnd,e.end)),d.bufferedStart=e.bufferedEnd,d=u[++c],void 0!==d&&(t=null!==(o=d.bufferedStart)&&void 0!==o?o:d.start,n=null!==(l=d.bufferedEnd)&&void 0!==l?l:d.end)}}const S=u[c-1];void 0!==S&&Kn(S,m,f)}if(!r(d)){const{SEGMENT_SYNCHRONIZATION_DELAY:e}=N.getCurrent(),t=_e();for(let n=c;n<u.length;n++){const i=u[n];t-i.insertionTs>=e&&(j.debug("SI: A segment at the end has been completely GCed",f,`${i.start}-${i.end}`),void 0===i.bufferedStart&&void 0===i.bufferedEnd&&2!==i.status&&this._bufferedHistory.addBufferedSegment(i.infos,null),u.splice(n,1),n--)}}void 0!==f&&j.hasLevel("DEBUG")&&j.debug(`SI: current ${f} inventory timeline:\n`+$n(this._inventory))}insertChunk({period:e,adaptation:t,representation:n,segment:i,chunkSize:r,start:a,end:s},o,l){if(i.isInit)return;const u=t.type;if(a>=s)return void j.warn("SI: Invalid chunked inserted: starts before it ends",u,a,s);const c=this._inventory,d={status:o?0:2,insertionTs:l,chunkSize:r,splitted:!1,start:a,end:s,precizeStart:!1,precizeEnd:!1,bufferedStart:void 0,bufferedEnd:void 0,infos:{segment:i,period:e,adaptation:t,representation:n}};for(let f=c.length-1;f>=0;f--){const e=c[f];if(e.start<=a){if(e.end<=a){j.debug("SI: Pushing segment strictly after previous one.",u,a,e.end),this._inventory.splice(f+1,0,d),f+=2;while(f<c.length&&c[f].start<d.end){if(c[f].end>d.end)return j.debug("SI: Segment pushed updates the start of the next one",u,d.end,c[f].start),c[f].start=d.end,c[f].bufferedStart=void 0,void(c[f].precizeStart=c[f].precizeStart&&d.precizeEnd);j.debug("SI: Segment pushed removes the next one",u,a,s,c[f].start,c[f].end),c.splice(f,1)}return}if(e.start===a){if(e.end<=s){j.debug("SI: Segment pushed replace another one",u,a,s,e.end),this._inventory.splice(f,1,d),f+=1;while(f<c.length&&c[f].start<d.end){if(c[f].end>d.end)return j.debug("SI: Segment pushed updates the start of the next one",u,d.end,c[f].start),c[f].start=d.end,c[f].bufferedStart=void 0,void(c[f].precizeStart=c[f].precizeStart&&d.precizeEnd);j.debug("SI: Segment pushed removes the next one",u,a,s,c[f].start,c[f].end),c.splice(f,1)}return}return j.debug("SI: Segment pushed ends before another with the same start",u,a,s,e.end),c.splice(f,0,d),e.start=d.end,e.bufferedStart=void 0,void(e.precizeStart=e.precizeStart&&d.precizeEnd)}if(e.end<=d.end){j.debug("SI: Segment pushed updates end of previous one",u,a,s,e.start,e.end),this._inventory.splice(f+1,0,d),e.end=d.start,e.bufferedEnd=void 0,e.precizeEnd=e.precizeEnd&&d.precizeStart,f+=2;while(f<c.length&&c[f].start<d.end){if(c[f].end>d.end)return j.debug("SI: Segment pushed updates the start of the next one",u,d.end,c[f].start),c[f].start=d.end,c[f].bufferedStart=void 0,void(c[f].precizeStart=c[f].precizeStart&&d.precizeEnd);j.debug("SI: Segment pushed removes the next one",u,a,s,c[f].start,c[f].end),c.splice(f,1)}return}{j.warn("SI: Segment pushed is contained in a previous one",u,a,s,e.start,e.end);const t={status:e.status,insertionTs:e.insertionTs,chunkSize:e.chunkSize,splitted:!0,start:d.end,end:e.end,precizeStart:e.precizeStart&&e.precizeEnd&&d.precizeEnd,precizeEnd:e.precizeEnd,bufferedStart:void 0,bufferedEnd:e.end,infos:e.infos};return e.end=d.start,e.splitted=!0,e.bufferedEnd=void 0,e.precizeEnd=e.precizeEnd&&d.precizeStart,c.splice(f+1,0,d),void c.splice(f+2,0,t)}}}const h=this._inventory[0];if(void 0===h)return j.debug("SI: first segment pushed",u,a,s),void this._inventory.push(d);if(!(h.start>=s)){if(h.end<=s){j.debug("SI: Segment pushed starts before and completely recovers the previous first one",u,a,s,h.start,h.end),this._inventory.splice(0,1,d);while(c.length>1&&c[1].start<d.end){if(c[1].end>d.end)return j.debug("SI: Segment pushed updates the start of the next one",u,d.end,c[1].start),c[1].start=d.end,c[1].bufferedStart=void 0,void(c[1].precizeStart=d.precizeEnd);j.debug("SI: Segment pushed removes the next one",u,a,s,c[1].start,c[1].end),c.splice(1,1)}return}return j.debug("SI: Segment pushed start of the next one",u,a,s,h.start,h.end),h.start=s,h.bufferedStart=void 0,h.precizeStart=d.precizeEnd,void this._inventory.splice(0,0,d)}j.debug("SI: Segment pushed comes before all previous ones",u,a,s,h.start),this._inventory.splice(0,0,d)}completeSegment(e){if(e.segment.isInit)return;const t=this._inventory,n=[];for(let i=0;i<t.length;i++)if(_n(t[i].infos,e)){let r=!1;n.length>0&&(r=!0,1===n.length&&(j.warn("SI: Completed Segment is splitted.",e.segment.id,e.segment.time,e.segment.end),n[0].splitted=!0));const a=i;let s=t[i].chunkSize;i+=1;while(i<t.length&&_n(t[i].infos,e)){const e=t[i].chunkSize;void 0!==s&&void 0!==e&&(s+=e),i++}const o=i-1,l=o-a,u=t[o].end,c=t[o].bufferedEnd;l>0&&(this._inventory.splice(a+1,l),i-=l),0===this._inventory[a].status&&(this._inventory[a].status=1),this._inventory[a].chunkSize=s,this._inventory[a].end=u,this._inventory[a].bufferedEnd=c,this._inventory[a].splitted=r,n.push(this._inventory[a])}if(0===n.length)j.warn("SI: Completed Segment not found",e.segment.id,e.segment.time);else for(const i of n)void 0!==i.bufferedStart&&void 0!==i.bufferedEnd?2!==i.status&&this._bufferedHistory.addBufferedSegment(i.infos,{start:i.bufferedStart,end:i.bufferedEnd}):j.debug("SI: buffered range not known after sync. Skipping history.",i.start,i.end)}getInventory(){return this._inventory}getHistoryFor(e){return this._bufferedHistory.getHistoryFor(e)}}function Gn(e){if(void 0===e.bufferedStart||1!==e.status)return!1;const{start:t,end:n}=e,i=n-t,{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:r,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:a}=N.getCurrent();return Math.abs(t-e.bufferedStart)<=r&&(void 0===e.bufferedEnd||e.bufferedEnd>e.bufferedStart&&Math.abs(e.bufferedEnd-e.bufferedStart-i)<=Math.min(a,i/3))}function Hn(e){if(void 0===e.bufferedEnd||!e.infos.segment.complete||1!==e.status)return!1;const{start:t,end:n}=e,i=n-t,{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:r,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:a}=N.getCurrent();return Math.abs(n-e.bufferedEnd)<=r&&void 0!==e.bufferedStart&&e.bufferedEnd>e.bufferedStart&&Math.abs(e.bufferedEnd-e.bufferedStart-i)<=Math.min(a,i/3)}function zn(e,t,n,i){const{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:r,MISSING_DATA_TRIGGER_SYNC_DELAY:a,SEGMENT_SYNCHRONIZATION_DELAY:s}=N.getCurrent();if(void 0!==e.bufferedStart)e.bufferedStart<t&&(j.debug("SI: Segment partially GCed at the start",i,e.bufferedStart,t),e.bufferedStart=t),!e.precizeStart&&Gn(e)&&(e.start=e.bufferedStart,e.precizeStart=!0);else if(e.precizeStart)j.debug("SI: buffered start is precize start",i,e.start),e.bufferedStart=e.start;else if(null!==n&&n.end>t&&(n.precizeEnd||e.start-n.end<=r))j.debug("SI: buffered start is end of previous segment",i,t,e.start,n.end),e.bufferedStart=n.end,Gn(e)&&(e.start=n.end,e.precizeStart=!0);else if(e.start-t<=r){const n=_e();if(e.start-t>=a&&n-e.insertionTs<s)return void j.debug("SI: Ignored bufferedStart synchronization",i,t,e.start,n-e.insertionTs);j.debug("SI: found true buffered start",i,t,e.start),e.bufferedStart=t,Gn(e)&&(e.start=t,e.precizeStart=!0)}else if(t<e.start)j.debug("SI: range start too far from expected start",i,t,e.start),e.bufferedStart=e.start;else{const n=_e();if(e.start-t>=a&&n-e.insertionTs<s)return void j.debug("SI: Ignored bufferedStart synchronization",i,t,e.start,n-e.insertionTs);j.debug("SI: Segment appears immediately garbage collected at the start",i,t,e.start),e.bufferedStart=t}}function Kn(e,t,n){const{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:i,MISSING_DATA_TRIGGER_SYNC_DELAY:r,SEGMENT_SYNCHRONIZATION_DELAY:a}=N.getCurrent();if(void 0!==e.bufferedEnd)e.bufferedEnd>t&&(j.debug("SI: Segment partially GCed at the end",n,e.bufferedEnd,t),e.bufferedEnd=t),!e.precizeEnd&&t-e.end<=i&&Hn(e)&&(e.precizeEnd=!0,e.end=t);else if(e.precizeEnd)j.debug("SI: buffered end is precize end",n,e.end),e.bufferedEnd=e.end;else if(t-e.end<=i||!e.infos.segment.complete){const i=_e();if(t-e.end>=r&&i-e.insertionTs<a)return void j.debug("SI: Ignored bufferedEnd synchronization",n,t,e.end,i-e.insertionTs);j.debug("SI: found true buffered end",n,t,e.end),e.bufferedEnd=t,Hn(e)&&(e.end=t,e.precizeEnd=!0)}else if(t>e.end)j.debug("SI: range end too far from expected end",n,t,e.end),e.bufferedEnd=e.end;else{const i=_e();if(t-e.end>=r&&i-e.insertionTs<a)return void j.debug("SI: Ignored bufferedEnd synchronization",n,t,e.end,i-e.insertionTs);j.debug("SI: Segment appears immediately garbage collected at the end",n,e.bufferedEnd,t),e.bufferedEnd=t}}function $n(e){const t=1/60,n={},i=[];let r=null,a=null;function s(e){const t=String.fromCharCode(i.length+65);return i.push({letter:t,periodId:e.period.id,representationId:e.representation.id,bitrate:e.representation.bitrate}),t}let o="";for(let l=0;l<e.length;l++){const i=e[l];if(void 0!==i.bufferedStart&&void 0!==i.bufferedEnd){const e=i.infos.period.id,l=i.infos.representation.id,u=n[e];let c;void 0===u?(c=s(i.infos),n[e]={[l]:c}):void 0===u[l]?(c=s(i.infos),u[l]=c):c=u[l],null===r?o+=`${i.bufferedStart.toFixed(2)}|${c}|`:a===c?r.bufferedEnd+t<i.bufferedStart&&(o+=`${r.bufferedEnd.toFixed(2)} ~ `+`${i.bufferedStart.toFixed(2)}|${c}|`):o+=`${r.bufferedEnd.toFixed(2)} ~ `+`${i.bufferedStart.toFixed(2)}|${c}|`,r=i,a=c}}return null!==r&&(o+=String(r.end.toFixed(2))),i.forEach(e=>{var t;o+=`\n[${e.letter}] `+`P: ${e.periodId} || R: ${e.representationId}`+`(${null!==(t=e.bitrate)&&void 0!==t?t:"unknown bitrate"})`}),o}var Wn,qn=jn;class Yn{constructor(){this._segmentInventory=new qn}synchronizeInventory(e){this._segmentInventory.synchronizeBuffered(e)}getLastKnownInventory(){return this._segmentInventory.getInventory()}getSegmentHistory(e){return this._segmentInventory.getHistoryFor(e)}}(function(e){e[e["Push"]=0]="Push",e[e["Remove"]=1]="Remove",e[e["SignalSegmentComplete"]=2]="SignalSegmentComplete"})(Wn||(Wn={}));class Xn extends Yn{constructor(e,t,n){super(),j.info("AVSB: calling `mediaSource.addSourceBuffer`",t);const i=n.addSourceBuffer(e,t);this.bufferType=e,this._sourceBuffer=i,this._lastInitSegmentUniqueId=null,this.codec=t,this._initSegmentsMap=new Map,this._pendingOperations=[]}declareInitSegment(e,t){Qn(t),this._initSegmentsMap.set(e,t)}freeInitSegment(e){this._initSegmentsMap.delete(e)}async pushChunk(e){Qn(e.data.chunk),j.debug("AVSB: receiving order to push data to the SourceBuffer",this.bufferType,wn(e.inventoryInfos));const t=this._getActualDataToPush(e.data);0===t.length&&t.push(new Uint8Array);const n=Promise.all(t.map(t=>{const{codec:n,timestampOffset:i,appendWindow:r}=e.data;return j.debug("AVSB: pushing segment",this.bufferType,wn(e.inventoryInfos)),this._sourceBuffer.appendBuffer(t,{codec:n,timestampOffset:i,appendWindow:r})}));let i;this._addToOperationQueue(n,{type:Wn.Push,value:e});try{i=await n}catch(t){throw this._segmentInventory.insertChunk(e.inventoryInfos,!1,_e()),t}null!==e.inventoryInfos&&this._segmentInventory.insertChunk(e.inventoryInfos,!0,_e());const r=i[i.length-1];return this._segmentInventory.synchronizeBuffered(r),r}async removeBuffer(e,t){j.debug("AVSB: receiving order to remove data from the SourceBuffer",this.bufferType,e,t);const n=this._sourceBuffer.remove(e,t);this._addToOperationQueue(n,{type:Wn.Remove,value:{start:e,end:t}});const i=await n;return this._segmentInventory.synchronizeBuffered(i),i}async signalSegmentComplete(e){if(this._pendingOperations.length>0){const{promise:t}=this._pendingOperations[this._pendingOperations.length-1];this._addToOperationQueue(t,{type:Wn.SignalSegmentComplete,value:e});try{await t}catch(e){}}this._segmentInventory.completeSegment(e)}getPendingOperations(){return this._pendingOperations.map(e=>e.operation)}dispose(){try{j.debug("AVSB: Calling `dispose` on the SourceBufferInterface"),this._sourceBuffer.dispose()}catch(e){j.debug(`AVSB: Failed to dispose a ${this.bufferType} SourceBufferInterface:`,e instanceof Error?e:"")}}_getActualDataToPush(e){const t=[];if(null!==e.initSegmentUniqueId&&!this._isLastInitSegment(e.initSegmentUniqueId)){let n=this._initSegmentsMap.get(e.initSegmentUniqueId);if(void 0===n)throw new Error("Invalid initialization segment uniqueId");const i=new ArrayBuffer(n.byteLength),r=new Uint8Array(i);r.set(n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer)),n=r,t.push(n),this._lastInitSegmentUniqueId=e.initSegmentUniqueId}return null!==e.chunk&&t.push(e.chunk),t}_isLastInitSegment(e){return null!==this._lastInitSegmentUniqueId&&this._lastInitSegmentUniqueId===e}_addToOperationQueue(e,t){const n={operation:t,promise:e};this._pendingOperations.push(n);const i=()=>{const e=this._pendingOperations.indexOf(n);e>=0&&this._pendingOperations.splice(e,1)};e.then(i,i)}}function Qn(e){}var Zn=Xn;class Jn extends Yn{constructor(e){j.debug("HTSB: Creating TextSegmentSink"),super(),this.bufferType="text",this._sender=e,this._pendingOperations=[],this._sender.reset()}declareInitSegment(e){j.warn("HTSB: Declaring initialization segment for  Text SegmentSink",e)}freeInitSegment(e){j.warn("HTSB: Freeing initialization segment for  Text SegmentSink",e)}async pushChunk(e){const{data:t}=e;ei(t.chunk);const n=this._sender.pushTextData(Object.assign(Object.assign({},t),{chunk:t.chunk}));this._addToOperationQueue(n,{type:Wn.Push,value:e});const i=await n;return null!==e.inventoryInfos&&this._segmentInventory.insertChunk(e.inventoryInfos,!0,_e()),this._segmentInventory.synchronizeBuffered(i),i}async removeBuffer(e,t){const n=this._sender.remove(e,t);this._addToOperationQueue(n,{type:Wn.Remove,value:{start:e,end:t}});const i=await n;return this._segmentInventory.synchronizeBuffered(i),i}async signalSegmentComplete(e){if(this._pendingOperations.length>0){const{promise:t}=this._pendingOperations[this._pendingOperations.length-1];this._addToOperationQueue(t,{type:Wn.SignalSegmentComplete,value:e});try{await t}catch(e){}}this._segmentInventory.completeSegment(e)}getPendingOperations(){return this._pendingOperations.map(e=>e.operation)}dispose(){j.debug("HTSB: Disposing TextSegmentSink"),this._sender.reset()}_addToOperationQueue(e,t){const n={operation:t,promise:e};this._pendingOperations.push(n);const i=()=>{const e=this._pendingOperations.indexOf(n);e>=0&&this._pendingOperations.splice(e,1)};e.then(i,i)}}function ei(e){}var ti=Jn;const ni=["audio","video","text"];class ii{static isNative(e){return ri(e)}constructor(e,t,n){this._mediaSource=e,this._textInterface=n,this._hasVideo=t,this._initializedSegmentSinks={},this._onNativeBufferAddedOrDisabled=[]}getBufferTypes(){const e=this.getNativeBufferTypes();return null!==this._textInterface&&e.push("text"),e}getNativeBufferTypes(){return this._hasVideo?["video","audio"]:["audio"]}getStatus(e){const t=this._initializedSegmentSinks[e];return void 0===t?{type:"uninitialized"}:null===t?{type:"disabled"}:{type:"initialized",value:t}}waitForUsableBuffers(e){return this._areNativeBuffersUsable()?Promise.resolve():un(e,e=>{let t;const n=()=>{const e=this._onNativeBufferAddedOrDisabled.indexOf(t);e>=0&&this._onNativeBufferAddedOrDisabled.splice(e,1)};return t=(()=>{this._areNativeBuffersUsable()&&(n(),e())}),this._onNativeBufferAddedOrDisabled.push(t),n})}disableSegmentSink(e){const t=this._initializedSegmentSinks[e];if(null!==t){if(void 0!==t)throw new Error("Cannot disable an active SegmentSink.");this._initializedSegmentSinks[e]=null,ii.isNative(e)&&this._onNativeBufferAddedOrDisabled.forEach(e=>e())}else j.warn(`SBS: The ${e} SegmentSink was already disabled.`)}createSegmentSink(e,t){const n=this._initializedSegmentSinks[e];if(ri(e)){if(!r(n))return n instanceof Zn&&n.codec!==t?j.warn("SB: Reusing native SegmentSink with codec",n.codec,"for codec",t):j.info("SB: Reusing native SegmentSink with codec",t),n;j.info("SB: Adding native SegmentSink with codec",t);const i="audio"===e?"audio":"video",a=new Zn(i,t,this._mediaSource);return this._initializedSegmentSinks[e]=a,this._onNativeBufferAddedOrDisabled.forEach(e=>e()),a}if(!r(n))return j.info("SB: Reusing a previous custom SegmentSink for the type",e),n;let i;if("text"===e){if(j.info("SB: Creating a new text SegmentSink"),null===this._textInterface)throw new Error("HTML Text track feature not activated");return i=new ti(this._textInterface),this._initializedSegmentSinks.text=i,i}throw j.error("SB: Unknown buffer type:",e),new ut("BUFFER_TYPE_UNKNOWN","The player wants to create a SegmentSink of an unknown type.")}disposeSegmentSink(e){const t=this._initializedSegmentSinks[e];r(t)?j.warn("SB: Trying to dispose a SegmentSink that does not exist"):(j.info("SB: Aborting SegmentSink",e),t.dispose(),delete this._initializedSegmentSinks[e])}disposeAll(){ni.forEach(e=>{"initialized"===this.getStatus(e).type&&this.disposeSegmentSink(e)})}_areNativeBuffersUsable(){const e=this.getNativeBufferTypes(),t=e.some(e=>void 0===this._initializedSegmentSinks[e]);if(t)return!1;const n=e.every(e=>null===this._initializedSegmentSinks[e]);return!n}createSegmentSinkMetricsForType(e){var t,n;return{bufferType:e,codec:null===(t=this._initializedSegmentSinks[e])||void 0===t?void 0:t.codec,segmentInventory:null===(n=this._initializedSegmentSinks[e])||void 0===n?void 0:n.getLastKnownInventory().map(e=>Object.assign(Object.assign({},e),{infos:ai(e.infos)}))}}getSegmentSinksMetrics(){return{segmentSinks:{audio:this.createSegmentSinkMetricsForType("audio"),video:this.createSegmentSinkMetricsForType("video"),text:this.createSegmentSinkMetricsForType("text")}}}}function ri(e){return"audio"===e||"video"===e}function ai(e){return{adaptation:e.adaptation.getMetadataSnapshot(),period:e.period.getMetadataSnapshot(),representation:e.representation.getMetadataSnapshot()}}var si=ii;class oi{constructor(e){this._weakMap=new WeakMap,this._fn=e}get(e){const t=this._weakMap.get(e);if(void 0===t){const t=this._fn(e);return this._weakMap.set(e,t),t}return t}destroy(e){this._weakMap.delete(e)}}function li({segmentSink:e,playbackObserver:t,maxBufferBehind:n,maxBufferAhead:i},r){let a,s=[];function o(){null!==s&&ui(e,a,s,n.getValue(),i.getValue(),r).catch(e=>{const t=e instanceof Error?e.message:"Unknown error";j.error("Could not run BufferGarbageCollector:",t)})}t.listen(t=>{a=t.position.getWanted(),s=t.buffered[e.bufferType],o()},{includeLastObservation:!0,clearSignal:r}),n.onUpdate(o,{clearSignal:r}),i.onUpdate(o,{clearSignal:r}),o()}async function ui(e,t,n,i,a,s){if(!isFinite(i)&&!isFinite(a))return Promise.resolve();const o=[],{innerRange:l,outerRanges:u}=te(n,t),c=()=>{if(isFinite(i)){for(const e of u)t-i>=e.end?o.push(e):t>=e.end&&t-i>e.start&&t-i<e.end&&o.push({start:e.start,end:t-i});r(l)||t-i>l.start&&o.push({start:l.start,end:t-i})}},d=()=>{if(isFinite(a)){for(const e of u)t+a<=e.start?o.push(e):t<=e.start&&t+a<e.end&&t+a>e.start&&o.push({start:t+a,end:e.end});r(l)||t+a<l.end&&o.push({start:t+a,end:l.end})}};c(),d();for(const r of o)if(r.start<r.end){if(j.debug("GC: cleaning range from SegmentSink",r.start,r.end),null!==s.cancellationError)throw s.cancellationError;await e.removeBuffer(r.start,r.end)}}class ci extends a{constructor(e,t,n,i){super(),this._content=e,this._currentCanceller=null,this._downloadQueue=t,this._initSegmentRequest=null,this._mediaSegmentRequest=null,this._segmentFetcher=n,this._initSegmentInfoRef=new de(void 0),this._mediaSegmentAwaitingInitMetadata=null,i||this._initSegmentInfoRef.setValue(null)}getRequestedInitSegment(){return null===this._initSegmentRequest?null:this._initSegmentRequest.segment}getRequestedMediaSegment(){return null===this._mediaSegmentRequest?null:this._mediaSegmentRequest.segment}start(){null===this._currentCanceller&&(this._currentCanceller=new me,this._downloadQueue.onUpdate(e=>{const{segmentQueue:t}=e;if(t.length>0&&t[0].segment.id===this._mediaSegmentAwaitingInitMetadata)return;const n=this._mediaSegmentRequest;if(0===t.length){if(null===n)return;return j.debug("Stream: no more media segment to request. Cancelling queue.",this._content.adaptation.type),void this._restartMediaSegmentDownloadingQueue()}if(null===n)return j.debug("Stream: Media segments now need to be requested. Starting queue.",this._content.adaptation.type,t.length),void this._restartMediaSegmentDownloadingQueue();{const e=t[0];return n.segment.id!==e.segment.id?(j.debug("Stream: Next media segment changed, cancelling previous",this._content.adaptation.type),void this._restartMediaSegmentDownloadingQueue()):void(n.priority!==e.priority&&(j.debug("Stream: Priority of next media segment changed, updating",this._content.adaptation.type,n.priority,e.priority),this._segmentFetcher.updatePriority(n.request,e.priority)))}},{emitCurrentValue:!0,clearSignal:this._currentCanceller.signal}),this._downloadQueue.onUpdate(e=>{var t;const n=this._initSegmentRequest;null===e.initSegment||null===n?(null===(t=e.initSegment)||void 0===t?void 0:t.segment.id)!==(null===n||void 0===n?void 0:n.segment.id)&&(null===e.initSegment&&j.debug("Stream: no more init segment to request. Cancelling queue.",this._content.adaptation.type),this._restartInitSegmentDownloadingQueue(e.initSegment)):e.initSegment.priority!==n.priority&&this._segmentFetcher.updatePriority(n.request,e.initSegment.priority)},{emitCurrentValue:!0,clearSignal:this._currentCanceller.signal}))}stop(){var e;null===(e=this._currentCanceller)||void 0===e||e.cancel(),this._currentCanceller=null}_restartMediaSegmentDownloadingQueue(){null!==this._mediaSegmentRequest&&this._mediaSegmentRequest.canceller.cancel();const{segmentQueue:e}=this._downloadQueue.getValue(),t=e[0],n=e=>{if(null!==this._currentCanceller&&this._currentCanceller.isUsed())return void(this._mediaSegmentRequest=null);if(void 0===e)return this._mediaSegmentRequest=null,void this.trigger("emptyQueue",null);const t=new me,i=null===this._currentCanceller?U:t.linkToSignal(this._currentCanceller.signal),{segment:r,priority:a}=e,s=M({segment:r},this._content);let o=!1,l=!1;t.signal.register(()=>{this._mediaSegmentRequest=null,o||(this._mediaSegmentAwaitingInitMetadata===r.id&&(this._mediaSegmentAwaitingInitMetadata=null),o=!0,l=!1)});const u=e=>{fe("media"===e.segmentType,"Should have loaded a media segment."),this.trigger("parsedMediaSegment",M({},e,{segment:r}))},c=()=>{const e=this._downloadQueue.getValue().segmentQueue;if(0===e.length)return o=!0,void this.trigger("emptyQueue",null);e[0].segment.id===r.id&&e.shift(),o=!0,n(e[0])},d=this._segmentFetcher.createRequest(s,a,{onRetry:e=>{this.trigger("requestRetry",{segment:r,error:e})},beforeInterrupted(){j.info("Stream: segment request interrupted temporarly.",r.id,r.time)},onChunk:e=>{const n=this._initSegmentInfoRef.getValue();void 0!==n?u(e(null!==n&&void 0!==n?n:void 0)):(l=!0,this._initSegmentInfoRef.waitUntilDefined(t=>{u(e(null!==t&&void 0!==t?t:void 0))},{clearSignal:t.signal}))},onAllChunksReceived:()=>{l?(this._mediaSegmentAwaitingInitMetadata=r.id,this._initSegmentInfoRef.waitUntilDefined(()=>{this._mediaSegmentAwaitingInitMetadata=null,l=!1,this.trigger("fullyLoadedSegment",r)},{clearSignal:t.signal})):this.trigger("fullyLoadedSegment",r)},beforeEnded:()=>{i(),this._mediaSegmentRequest=null,l?this._initSegmentInfoRef.waitUntilDefined(c,{clearSignal:t.signal}):c()}},t.signal);d.catch(e=>{i(),o||(o=!0,this.stop(),this.trigger("error",e))}),this._mediaSegmentRequest={segment:r,priority:a,request:d,canceller:t}};n(t)}_restartInitSegmentDownloadingQueue(e){if(null!==this._currentCanceller&&this._currentCanceller.isUsed())return;if(null!==this._initSegmentRequest&&this._initSegmentRequest.canceller.cancel(),null===e)return;const t=new me,n=null===this._currentCanceller?U:t.linkToSignal(this._currentCanceller.signal),{segment:i,priority:r}=e,a=M({segment:i},this._content);let s=!1;const o=this._segmentFetcher.createRequest(a,r,{onRetry:e=>{this.trigger("requestRetry",{segment:i,error:e})},beforeInterrupted:()=>{j.info("Stream: init segment request interrupted temporarly.",i.id)},beforeEnded:()=>{n(),this._initSegmentRequest=null,s=!0},onChunk:e=>{var t;const n=e(void 0);fe("init"===n.segmentType,"Should have loaded an init segment."),this.trigger("parsedInitSegment",M({},n,{segment:i})),"init"===n.segmentType&&this._initSegmentInfoRef.setValue(null!==(t=n.initTimescale)&&void 0!==t?t:null)},onAllChunksReceived:()=>{this.trigger("fullyLoadedSegment",i)}},t.signal);o.catch(e=>{n(),s||(s=!0,this.stop(),this.trigger("error",e))}),t.signal.register(()=>{this._initSegmentRequest=null,s||(s=!0)}),this._initSegmentRequest={segment:i,priority:r,request:o,canceller:t}}}function di(e,t,n,i,r){const{period:a,adaptation:s,representation:o}=e,l=hi(r,t);if(null===l){if(null===n){if(i&&void 0!==a.end&&t.end>=a.end)return{start:void 0,end:null};const e=o.index.checkDiscontinuity(t.start);if(null!==e)return{start:void 0,end:e}}return null}const u=r[l];if(void 0!==u.bufferedStart&&u.bufferedStart>t.start&&(null===n||u.infos.segment.end<=n)){const e=u.bufferedStart;return i||!1===o.index.awaitSegmentBetween(t.start,e)?(j.debug("RS: current discontinuity encountered",s.type,u.bufferedStart),{start:void 0,end:e}):null}const c=fi(r,t,l+1);if(null!==c){const e=r[c-1],t=r[c];if(null===n||t.infos.segment.end<=n){if(!i&&!1!==o.index.awaitSegmentBetween(e.infos.segment.end,t.infos.segment.time))return null;const n=e.bufferedEnd,r=t.bufferedStart;return j.debug("RS: future discontinuity encountered",s.type,n,r),{start:n,end:r}}}if(null===n){if(i&&void 0!==a.end){if(t.end<a.end)return null;const e=pi(r,a.end);if(null!==e){const t=r[e];if(void 0!==t.bufferedEnd&&t.bufferedEnd<a.end)return j.debug("RS: discontinuity encountered at the end of the current period",s.type,t.bufferedEnd,a.end),{start:t.bufferedEnd,end:null}}}if(void 0!==a.end&&t.end>=a.end)return null;for(let e=r.length-1;e>=0;e--){const n=r[e];if(void 0===n.bufferedStart)break;if(n.bufferedStart<t.end){if(void 0!==n.bufferedEnd&&n.bufferedEnd<t.end){const e=o.index.checkDiscontinuity(t.end);if(null!==e)return{start:n.bufferedEnd,end:e}}return null}}}return null}function hi(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(void 0===i.bufferedStart||void 0===i.bufferedEnd||i.bufferedStart>=t.end)return null;if(i.bufferedEnd>t.start)return n}return null}function fi(e,t,n){if(n<=0)return j.error("RS: Asked to check a discontinuity before the first chunk."),null;for(let i=n;i<e.length;i++){const n=e[i],r=e[i-1];if(void 0===n.bufferedStart||void 0===r.bufferedEnd||n.bufferedStart>=t.end)return null;if(n.bufferedStart-r.bufferedEnd>0)return i}return null}function pi(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(void 0===i.bufferedStart)return null;if(i.bufferedStart<t)return n}return null}function gi({bufferedSegments:e,content:t,currentPlaybackTime:n,fastSwitchThreshold:i,getBufferedHistory:r,neededRange:a,segmentsBeingPushed:s,maxBufferSize:o}){const{adaptation:l,representation:u}=t;let c=mi(e,s,o);const d=u.index.getSegments(a.start,a.end-a.start),h=e.filter(e=>!yi(e.infos,t,n,i)),f=Ei(h,a,r),{MINIMUM_SEGMENT_SIZE:p,MIN_BUFFER_AHEAD:g}=N.getCurrent();let m=!1;const v=Math.min(1/60,p);let y=!1;const b=[],S=d.filter(e=>{const o=M({segment:e},t);if(s.length>0){const e=s.some(e=>_n(o,e));if(e)return!1}const{duration:d,time:h,end:S}=e;if(e.isInit)return!0;if(m)return b.push(e),!1;if(e.complete&&d<p)return!1;if(s.length>0){const e=s.some(e=>{if(e.period.id!==t.period.id||e.adaptation.id!==t.adaptation.id)return!1;const{segment:r}=e;if(r.time-v>h)return!1;if(r.complete){if(r.end+v<S)return!1}else if(Math.abs(h-r.time)>h)return!1;return!yi(e,o,n,i)});if(e)return!1}for(let n=0;n<f.length;n++){const e=f[n],i=e.infos.period.id===t.period.id;if(1===e.status&&i){const t=e.infos.segment;if(h-t.time>-v)if(t.complete){if(t.end-S>-v)return!1}else if(Math.abs(h-t.time)<v)return!1}}const T=d*t.representation.bitrate;if(c-T<0&&(y=!0,h>a.start+g))return m=!0,b.push(e),!1;const _=r(o);if(_.length>1){const t=_[_.length-1],n=_[_.length-2];if(null===t.buffered&&null===n.buffered)return j.warn("Stream: Segment GCed multiple times in a row, ignoring it.","If this happens a lot and lead to unpleasant experience, please  check your device's available memory. If it's low when this message is emitted, you might want to update the RxPlayer's settings (`maxBufferAhead`, `maxVideoBufferSize` etc.) so less memory is used by regular media data buffering."+l.type,u.id,e.time),!1}for(let t=0;t<f.length;t++){const e=f[t];if(e.end+v>h){const n=e.start>h+v||vi(f,t).end<S-v;return n&&(c-=T),n}}return c-=T,!0});return{segmentsToLoad:S,segmentsOnHold:b,isBufferFull:y}}function mi(e,t,n){let i=8e3*n;return i-=t.reduce((e,t)=>{const{bitrate:n}=t.representation,{duration:i}=t.segment;return e+n*i},0),e.reduce((e,t)=>{return void 0!==t.chunkSize?e-8*t.chunkSize:e},i)}function vi(e,t){let n=t+1;const{MINIMUM_SEGMENT_SIZE:i}=N.getCurrent(),r=Math.min(1/60,i);while(n<e.length-1&&e[n-1].end+r>e[n].start)n++;return n--,e[n]}function yi(e,t,n,i){const{CONTENT_REPLACEMENT_PADDING:r}=N.getCurrent();if(e.period.id!==t.period.id)return!1;const{segment:a}=e;return!(a.time<n+r)&&(e.adaptation.id!==t.adaptation.id||bi(e.representation,t.representation,i))}function bi(e,t,n){const i=e.bitrate,{BITRATE_REBUFFERING_RATIO:r}=N.getCurrent();if(void 0===n){const e=i*r;return t.bitrate>e}return i<n&&t.bitrate>i}function Si(e,t,n){const{MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:i}=N.getCurrent();return void 0!==e.bufferedStart&&(!(null!==t&&void 0!==t.bufferedEnd&&e.bufferedStart-t.bufferedEnd<.1)&&(n<e.bufferedStart&&e.bufferedStart-e.start>i&&(j.info("Stream: The start of the wanted segment has been garbage collected",e.start,e.bufferedStart),!0)))}function Ti(e,t,n){const{MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:i}=N.getCurrent();return void 0!==e.bufferedEnd&&(!(null!==t&&void 0!==t.bufferedStart&&t.bufferedStart-e.bufferedEnd<.1)&&(n>e.bufferedEnd&&e.end-e.bufferedEnd>i&&(j.info("Stream: The end of the wanted segment has been garbage collected",e.end,e.bufferedEnd),!0)))}function _i(e,t){var n,i;if(e.length<2)return!0;const r=e[e.length-1],a=null===(n=r.buffered)||void 0===n?void 0:n.start;if(void 0!==t&&void 0!==a&&t-a>.05)return!0;const s=e[e.length-2],o=null===(i=s.buffered)||void 0===i?void 0:i.start;return void 0===o||void 0===a||Math.abs(o-a)>.01}function wi(e,t){var n,i;if(e.length<2)return!0;const r=e[e.length-1],a=null===(n=r.buffered)||void 0===n?void 0:n.end;if(void 0!==t&&void 0!==a&&a-t>.05)return!0;const s=e[e.length-2],o=null===(i=s.buffered)||void 0===i?void 0:i.end;return void 0===o||void 0===a||Math.abs(o-a)>.01}function Ei(e,t,n){return e.filter((e,i,r)=>{const a=0===i?null:r[i-1],s=i>=r.length-1?null:r[i+1];let o=null;if(Si(e,a,t.start)){if(o=n(e.infos),_i(o,e.bufferedStart))return!1;j.debug("Stream: skipping segment gc-ed at the start",e.start,e.bufferedStart)}if(Ti(e,s,t.end)){if(o=null!==o&&void 0!==o?o:n(e.infos),wi(o,e.bufferedEnd))return!1;j.debug("Stream: skipping segment gc-ed at the end",e.end,e.bufferedEnd)}return!0})}function xi(e,t){const n=e-t,{SEGMENT_PRIORITIES_STEPS:i}=N.getCurrent();for(let r=0;r<i.length;r++)if(n<i[r])return r;return i.length}function Ai(e,t,n,i,r,a,s){var o,l,u;const{representation:c}=e,d=null!==(l=null!==(o=n.getIsPaused())&&void 0!==o?o:n.getReference().getValue().paused.pending)&&void 0!==l?l:n.getReference().getValue().paused.last,h=null!==(u=n.getPlaybackRate())&&void 0!==u?u:n.getReference().getValue().speed;let f=t;(void 0===d||void 0===h||d||h<=0)&&(f-=.1);const p=ki(e,f,r),g=c.index.shouldRefresh(p.start,p.end),m=s.getPendingOperations().filter(e=>e.type===Wn.SignalSegmentComplete).map(e=>e.value),v=s.getLastKnownInventory();let y=n.getCurrentTime();void 0===y&&(y=n.getReference().getValue().position.getWanted());const b=s.getSegmentHistory.bind(s),{segmentsToLoad:S,segmentsOnHold:T,isBufferFull:_}=gi({content:e,bufferedSegments:v,currentPlaybackTime:y,fastSwitchThreshold:i,getBufferedHistory:b,neededRange:p,segmentsBeingPushed:m,maxBufferSize:a}),w=S.map(e=>({priority:xi(e.time,f),segment:e})),E=c.index.isInitialized()&&!c.index.isStillAwaitingFutureSegments()&&p.hasReachedPeriodEnd&&0===w.length&&0===T.length;let x=null;m.length>0&&(x=Math.min(...m.map(e=>e.segment.time))),T.length>0&&(x=null!==x?Math.min(x,T[0].time):T[0].time),w.length>0&&(x=null!==x?Math.min(x,w[0].segment.time):w[0].segment.time);const A=di(e,p,x,E,v);return{imminentDiscontinuity:A,hasFinishedLoading:E,neededSegments:w,isBufferFull:_,shouldRefreshManifest:g}}function ki(e,t,n){var i;let a;const{manifest:s,period:o,representation:l}=e,u=l.index.getLastAvailablePosition(),c=l.index;a=!r(u)&&si.isNative(e.adaptation.type)&&t>=u&&c.isInitialized()&&!c.isStillAwaitingFutureSegments()&&Ii(s,o,t)?u-1:t-.1;const d=a+n;let h;return h=!(!l.index.isInitialized()||l.index.isStillAwaitingFutureSegments()||void 0===o.end)&&(void 0===u?d>=o.end:null===u||d>=u),{start:Math.max(a,o.start),end:Math.min(d,null!==(i=o.end)&&void 0!==i?i:1/0),hasReachedPeriodEnd:h}}function Ii(e,t,n){var i;const r=e.getPeriodAfter(t);return t.containsTime(n,r)&&e.isLastPeriodKnown&&t.id===(null===(i=e.periods[e.periods.length-1])||void 0===i?void 0:i.id)}class Ci extends Error{constructor(e,t,n){super(t),Object.setPrototypeOf(this,Ci.prototype),this.name="SourceBufferError",this.errorName=e,this.isBufferFull=n}serialize(){return{errorName:this.name,message:this.message,isBufferFull:this.isBufferFull}}toString(){return`${this.errorName}: ${this.message}`}}function Ri(e){return new Promise(t=>{setTimeout(t,e)})}async function Mi(e,t,n,i,r){try{return await t.pushChunk(n)}catch(a){if(r.isCancelled()&&a instanceof ye)throw a;if(!(a instanceof Ci)||!a.isBufferFull){const e=a instanceof Error?a.toString():"An unknown error happened when pushing content";throw new ut("BUFFER_APPEND_ERROR",e,{tracks:[Lt(n.inventoryInfos.adaptation)]})}const{position:s}=e.getReference().getValue(),o=s.getWanted();try{j.warn("Stream: Running garbage collector");const e=Math.max(o-5,0),a=o+i.getValue()+12;if(await t.removeBuffer(0,e),await t.removeBuffer(a,Number.MAX_VALUE),await Ri(200),null!==r.cancellationError)throw r.cancellationError;return await t.pushChunk(n)}catch(e){if(e instanceof ye)throw e;const t=e instanceof Error?e.toString():"Could not clean the buffer";throw new ut("BUFFER_FULL_ERROR",t,{tracks:[Lt(n.inventoryInfos.adaptation)]})}}}async function Di({playbackObserver:e,content:t,initSegmentUniqueId:n,segment:i,segmentSink:r,bufferGoal:a},s){if(null!==s.cancellationError)throw s.cancellationError;const o=t.representation.getMimeTypeString(),l={initSegmentUniqueId:n,chunk:null,timestampOffset:0,appendWindow:[void 0,void 0],codec:o},u=M({segment:i,chunkSize:void 0,start:0,end:0},t),c=await Mi(e,r,{data:l,inventoryInfos:u},a,s);return{content:t,segment:i,buffered:c}}async function Li({playbackObserver:e,bufferGoal:t,content:n,initSegmentUniqueId:i,parsedSegment:r,segment:a,segmentSink:s},o){var l,u;if(null===r.chunkData)return null;if(null!==o.cancellationError)throw o.cancellationError;const{chunkData:c,chunkInfos:d,chunkOffset:h,chunkSize:f,appendWindow:p}=r,g=n.representation.getMimeTypeString(),{APPEND_WINDOW_SECURITIES:m}=N.getCurrent(),v=[void 0!==p[0]?Math.max(0,p[0]-m.START):void 0,void 0!==p[1]?p[1]+m.END:void 0],y={initSegmentUniqueId:i,chunk:c,timestampOffset:h,appendWindow:v,codec:g};let b=null!==(l=null===d||void 0===d?void 0:d.time)&&void 0!==l?l:a.time;const S=null!==(u=null===d||void 0===d?void 0:d.duration)&&void 0!==u?u:a.duration;let T=b+S;void 0!==v[0]&&(b=Math.max(b,v[0])),void 0!==v[1]&&(T=Math.min(T,v[1]));const _=M({segment:a,chunkSize:f,start:b,end:T},n),w=await Mi(e,s,{data:y,inventoryInfos:_},t,o);return{content:n,segment:a,buffered:w}}function Pi({content:e,options:t,playbackObserver:n,segmentSink:i,segmentFetcher:r,terminate:a},s,o){const{period:l,adaptation:u,representation:c}=e,{bufferGoal:d,maxBufferSize:h,drmSystemId:f,fastSwitchThreshold:p}=t,g=u.type,m=new me;m.linkToSignal(o);const v=new me;v.linkToSignal(m.signal);const y={segment:c.index.getInitSegment(),uniqueId:null,isLoaded:!1};m.signal.register(()=>{null!==y.uniqueId&&i.freeInitSegment(y.uniqueId)});const b=new de({initSegment:null,segmentQueue:[]},v.signal),S=null!==y.segment;S||(y.isLoaded=!0);let T=!1;if(void 0!==f){const t=c.getEncryptionData(f);if(t.length>0&&t.every(e=>void 0!==e.keyIds)&&(T=!0,s.encryptionDataEncountered(t.map(t=>M({content:e},t))),m.isUsed()))return}const _=new ci(e,b,r,S);return _.addEventListener("error",e=>{v.signal.isCancelled()||(m.cancel(),s.error(e))}),_.addEventListener("parsedInitSegment",E),_.addEventListener("parsedMediaSegment",E),_.addEventListener("emptyQueue",w),_.addEventListener("requestRetry",e=>{if(s.warning(e.error),v.signal.isCancelled())return;const t=e.segment,{index:n}=c;!1===n.isSegmentStillAvailable(t)?w():n.canBeOutOfSyncError(e.error,t)&&s.manifestMightBeOufOfSync()}),_.addEventListener("fullyLoadedSegment",t=>{i.signalSegmentComplete(M({segment:t},e)).catch(x)}),_.start(),v.signal.register(()=>{_.removeEventListener(),_.stop()}),n.listen(w,{includeLastObservation:!1,clearSignal:v.signal}),e.manifest.addEventListener("manifestUpdate",w,v.signal),d.onUpdate(w,{emitCurrentValue:!1,clearSignal:v.signal}),h.onUpdate(w,{emitCurrentValue:!1,clearSignal:v.signal}),a.onUpdate(w,{emitCurrentValue:!1,clearSignal:v.signal}),void w();function w(){if(v.isUsed())return;const t=n.getReference().getValue(),r=t.position.getWanted(),o=Ai(e,r,n,p.getValue(),d.getValue(),h.getValue(),i),{neededSegments:u}=o;let f=null;if(c.index.isInitialized()){if(u.length>0&&!y.isLoaded&&null!==y.segment){const e=u[0].priority;f={segment:y.segment,priority:e}}}else if(null===y.segment)j.warn("Stream: Uninitialized index without an initialization segment");else if(y.isLoaded)j.warn("Stream: Uninitialized index with an already loaded initialization segment");else{const e=t.position.getWanted();f={segment:y.segment,priority:xi(l.start,e)}}const m=a.getValue();if(null===m)b.setValue({initSegment:f,segmentQueue:u});else{if(m.urgent)return j.debug("Stream: Urgent switch, terminate now.",g),b.setValue({initSegment:null,segmentQueue:[]}),b.finish(),v.cancel(),void s.terminating();{const e=u[0],t=_.getRequestedInitSegment(),n=_.getRequestedMediaSegment(),i=null===n||void 0===e||n.id!==e.segment.id?[]:[e],r=null===t?null:f;if(b.setValue({initSegment:r,segmentQueue:i}),0===i.length&&null===r)return j.debug("Stream: No request left, terminate",g),b.finish(),v.cancel(),void s.terminating()}}if(s.streamStatusUpdate({period:l,position:t.position.getWanted(),bufferType:g,imminentDiscontinuity:o.imminentDiscontinuity,isEmptyStream:!1,hasFinishedLoading:o.hasFinishedLoading,neededSegments:o.neededSegments}),v.signal.isCancelled())return;const{UPTO_CURRENT_POSITION_CLEANUP:S}=N.getCurrent();if(o.isBufferFull){const e=Math.max(0,r-S);e>0&&i.removeBuffer(0,e).catch(x)}o.shouldRefreshManifest&&s.needsManifestRefresh()}function E(t){if(!m.isUsed()){for(const e of t.protectionData)c.addProtectionData(e.initDataType,e.keyId,e.initData);if(!T){const t=c.getAllEncryptionData();if(t.length>0&&(s.encryptionDataEncountered(t.map(t=>M({content:e},t))),T=!0,m.isUsed()))return}if("init"!==t.segmentType){const{inbandEvents:r,predictedSegments:a,needsManifestRefresh:o}=t;if(void 0!==a&&c.index.addPredictedSegments(a,t.segment),!0===o&&(s.needsManifestRefresh(),m.isUsed()))return;if(void 0!==r&&r.length>0&&(s.inbandEvent(r),m.isUsed()))return;const l=y.uniqueId;Li({playbackObserver:n,bufferGoal:d,content:e,initSegmentUniqueId:l,parsedSegment:t,segment:t.segment,segmentSink:i},m.signal).then(e=>{null!==e&&s.addedSegment(e)}).catch(x)}else{if(c.index.isInitialized()||void 0===t.segmentList||c.index.initialize(t.segmentList),y.isLoaded=!0,null!==t.initializationData){const r=c.uniqueId;y.uniqueId=r,i.declareInitSegment(r,t.initializationData),Di({playbackObserver:n,bufferGoal:d,content:e,initSegmentUniqueId:r,segment:t.segment,segmentData:t.initializationData,segmentSink:i},m.signal).then(e=>{null!==e&&s.addedSegment(e)}).catch(x)}w()}}}function x(e){m.isUsed()&&e instanceof ye||(m.cancel(),s.error(e))}}var Oi=Pi;function Ni(e,t){for(let n=0;n<e.length;n++)if(e[n].infos.period.start>=t.start)return n>0?e[n-1]:null;return e.length>0?e[e.length-1]:null}function Ui(e,t){for(const n of e)if(n.infos.period.start>t.start)return n;return null}function Fi(e,t,n,i,r){var a,s,o,l;if("lazy"===n.switchingMode)return{type:"continue",value:void 0};const u=i.getLastKnownInventory(),c=[];for(const m of u)m.infos.period.id!==e.id||m.infos.adaptation.id===t.id&&gt(n.representationIds,m.infos.representation.id)||re(c,{start:null!==(a=m.bufferedStart)&&void 0!==a?a:m.start,end:null!==(s=m.bufferedEnd)&&void 0!==s?s:m.end});const d=i.getPendingOperations();for(const m of d)if(m.type===Wn.Push){const i=m.value.inventoryInfos;if(i.period.id===e.id&&(i.adaptation.id!==t.id||!gt(n.representationIds,i.representation.id))){const e=i.segment.time,t=e+i.segment.duration;re(c,{start:e,end:t})}}if(0===c.length)return{type:"continue",value:void 0};if("reload"===n.switchingMode){const e=r.getReadyState();if(void 0===e||e>1)return{type:"needs-reload",value:void 0}}const h="direct"===n.switchingMode,f=[],p=Ni(u,e);if(null!==p&&(void 0===p.bufferedEnd||e.start-p.bufferedEnd<1)&&f.push({start:0,end:e.start+1}),!h){const{ADAP_REP_SWITCH_BUFFER_PADDINGS:e}=N.getCurrent(),n=t.type,i=null!==(o=e[n].before)&&void 0!==o?o:0,a=null!==(l=e[n].after)&&void 0!==l?l:0;let s=r.getCurrentTime();if(void 0===s){const e=r.getReference().getValue();s=e.position.getPolled()}f.push({start:s-i,end:s+a})}if(void 0!==e.end){const t=Ui(u,e);null!==t&&(void 0===t.bufferedStart||t.bufferedStart-e.end<1)&&f.push({start:e.end-1,end:Number.MAX_VALUE})}const g=oe(c,f);return 0===g.length?{type:"continue",value:void 0}:h?{type:"flush-buffer",value:g}:{type:"clean-buffer",value:g}}function Bi({playbackObserver:e,content:t,options:n,representationEstimator:i,segmentSink:r,segmentFetcherCreator:a,wantedBufferAhead:s,maxVideoBufferSize:o},u,c){const{manifest:d,period:h,adaptation:f}=t,p=new me;p.linkToSignal(c);const g=new Map,m=new de(null,p.signal);let v;const y=t.representations.getValue().representationIds,b=t.adaptation.representations.filter(e=>gt(y,e.id)&&!1!==e.decipherable&&!1!==e.isSupported),S=new de(b,p.signal),{estimates:T,callbacks:_}=i({manifest:d,period:h,adaptation:f},m,S,e,p.signal),w=a.createSegmentFetcher(f.type,{onRequestBegin:_.requestBegin,onRequestEnd:_.requestEnd,onProgress:_.requestProgress,onMetrics:_.metrics}),E=new de(0);let x;return T.onUpdate(({bitrate:e,knownStableBitrate:t})=>{n.enableFastSwitching&&E.setValueIfChanged(t),void 0!==e&&e!==v&&(v=e,j.debug(`Stream: new ${f.type} bitrate estimate`,e),u.bitrateEstimateChange({type:f.type,bitrate:e}))},{emitCurrentValue:!0,clearSignal:p.signal}),void t.representations.onUpdate(e=>{void 0!==x&&x.cancel();const n=t.representations.getValue().representationIds,i=t.adaptation.representations.filter(e=>gt(n,e.id));S.setValueIfChanged(i),x=new me,x.linkToSignal(p.signal),A(e,x.signal).catch(e=>{!0===(null===x||void 0===x?void 0:x.isUsed())&&me.isCancellationError(e)||(p.cancel(),u.error(e))})},{clearSignal:p.signal,emitCurrentValue:!0});async function A(t,n){const i=Fi(h,f,t,r,e);switch(i.type){case"continue":break;case"needs-reload":return l(()=>{e.listen(()=>{if(n.isCancelled())return;const{DELTA_POSITION_AFTER_RELOAD:e}=N.getCurrent(),t=e.bitrateSwitch;return u.waitingMediaSourceReload({bufferType:f.type,period:h,timeOffset:t,stayInPeriod:!0})},{includeLastObservation:!0,clearSignal:n})});case"flush-buffer":case"clean-buffer":for(const e of i.value)if(await r.removeBuffer(e.start,e.end),n.isCancelled())return;if("flush-buffer"===i.type&&(u.needsBufferFlush(),n.isCancelled()))return;break;default:ge(i)}k(n)}function k(e){const t=new me;t.linkToSignal(e);const{representation:n}=T.getValue();if(null===n)return;const i=new de(null,t.signal);T.onUpdate(e=>{if(null!==e.representation&&e.representation.id!==n.id)return e.urgent?(j.info("Stream: urgent Representation switch",f.type),i.setValue({urgent:!0})):(j.info("Stream: slow Representation switch",f.type),i.setValue({urgent:!1}))},{clearSignal:t.signal,emitCurrentValue:!0});const r={type:f.type,adaptation:f,period:h,representation:n};if(m.setValue(n),p.isUsed())return;if(u.representationChange(r),p.isUsed())return;const a={streamStatusUpdate:u.streamStatusUpdate,encryptionDataEncountered:u.encryptionDataEncountered,manifestMightBeOufOfSync:u.manifestMightBeOufOfSync,needsManifestRefresh:u.needsManifestRefresh,inbandEvent:u.inbandEvent,warning:u.warning,error(e){p.cancel(),u.error(e)},addedSegment(e){_.addedSegment(e)},terminating(){if(!t.isUsed())return t.cancel(),k(e)}};I(n,i,a,e)}function I(t,i,a,l){const c=new me;c.linkToSignal(l);const m=ce(s,e=>{return e*C(t)},c.signal),v="video"===f.type?o:new de(1/0);j.info("Stream: changing representation",f.type,t.id,t.bitrate);const y=M({},a,{error(e){var n;const r=ft(e,{defaultCode:"NONE",defaultReason:"Unknown `RepresentationStream` error"});if("BUFFER_FULL_ERROR"!==r.code)a.error(e);else{const e=s.getValue(),o=null!==(n=g.get(t.id))&&void 0!==n?n:1,u=.7*o;if(u<=.05||e*u<=2)throw r;g.set(t.id,u),cn(4e3,p.signal).then(()=>{return I(t,i,a,l)}).catch(U)}},terminating(){c.cancel(),a.terminating()}});Oi({playbackObserver:e,content:{representation:t,adaptation:f,period:h,manifest:d},segmentSink:r,segmentFetcher:w,terminate:i,options:{bufferGoal:m,maxBufferSize:v,drmSystemId:n.drmSystemId,fastSwitchThreshold:E}},y,l),d.addEventListener("manifestUpdate",e=>{for(const n of e.updatedPeriods)if(n.period.id===h.id){for(const e of n.result.updatedAdaptations)if(e.adaptation===f.id)for(const n of e.removedRepresentations)if(n===t.id){if(l.isCancelled())return;return u.waitingMediaSourceReload({bufferType:f.type,period:h,timeOffset:0,stayInPeriod:!0})}}else if(n.period.start>h.start)break},l)}function C(e){const t=g.get(e.id),n=void 0!==t?t:1;return void 0===t&&g.set(e.id,n),n}}var Vi=Bi;function ji(e,t,n){if("function"===typeof String.prototype.startsWith)return e.startsWith(t,n);const i="number"===typeof n?Math.max(n,0):0;return e.substring(i,i+t.length)===t}function Gi(e,t){const[n,...i]=e.split(";"),[r,...a]=t.split(";");if(n!==r)return!1;const s=Re(i,e=>ji(e,"codecs=")),o=Re(a,e=>ji(e,"codecs="));if(void 0===s||void 0===o)return!1;const l=s.substring(7),u=o.substring(7);return l.split(".")[0]===u.split(".")[0]}var Hi=Gi;function zi(e,t,n,i,r,a){var s,o,l,u;if(void 0!==e.codec&&"reload"===a.onCodecSwitch&&!Ki(n,e.codec))return{type:"needs-reload",value:void 0};const c=e.getLastKnownInventory(),d=[];for(const v of c)v.infos.period.id===t.id&&v.infos.adaptation.id!==n.id&&re(d,{start:null!==(s=v.bufferedStart)&&void 0!==s?s:v.start,end:null!==(o=v.bufferedEnd)&&void 0!==o?o:v.end});const h=e.getPendingOperations();for(const v of h)if(v.type===Wn.Push){const e=v.value.inventoryInfos;if(e.period.id===t.id&&e.adaptation.id!==n.id){const t=e.segment.time,n=t+e.segment.duration;re(d,{start:t,end:n})}}if(0===d.length)return{type:"continue",value:void 0};if("reload"===i){const e=r.getReadyState();if(void 0===e||e>1)return{type:"needs-reload",value:void 0}}const f="direct"===i,p=[],g=Ni(c,t);if(null!==g&&(void 0===g.bufferedEnd||t.start-g.bufferedEnd<1)&&p.push({start:0,end:t.start+1}),!f){const e=n.type,{ADAP_REP_SWITCH_BUFFER_PADDINGS:t}=N.getCurrent(),i=null!==(l=t[e].before)&&void 0!==l?l:0,a=null!==(u=t[e].after)&&void 0!==u?u:0;let s=r.getCurrentTime();if(void 0===s){const e=r.getReference().getValue();s=e.position.getPolled()}p.push({start:s-i,end:s+a})}if(void 0!==t.end){const e=Ui(c,t);null!==e&&(void 0===e.bufferedStart||e.bufferedStart-t.end<1)&&p.push({start:t.end-1,end:Number.MAX_VALUE})}const m=oe(d,p);return 0===m.length?{type:"continue",value:void 0}:f&&"text"!==n.type?{type:"flush-buffer",value:m}:{type:"clean-buffer",value:m}}function Ki(e,t){return e.representations.some(e=>!0===e.isSupported&&!1!==e.decipherable&&Hi(e.getMimeTypeString(),t))}function $i({bufferType:e,content:t,garbageCollectors:n,playbackObserver:i,representationEstimator:r,segmentFetcherCreator:a,segmentSinksStore:s,options:o,wantedBufferAhead:u,maxVideoBufferSize:c},d,h){const{manifest:f,period:p}=t,g=new de(void 0,h);if(d.periodStreamReady({type:e,manifest:f,period:p,adaptationRef:g}),h.isCancelled())return;let m,v=!0;function y(t,n,l,h){const g=Yi(i,t.type);function m(t){if(!si.isNative(e)){j.error(`Stream: ${e} Stream crashed. Aborting it.`,t instanceof Error?t:""),s.disposeSegmentSink(e);const n=ft(t,{defaultCode:"NONE",defaultReason:"Unknown `AdaptationStream` error"});if(d.warning(n),h.isCancelled())return;return Xi(i,u,e,{period:p},d,h)}j.error(`Stream: ${e} Stream crashed. Stopping playback.`,t instanceof Error?t:""),d.error(t)}Vi({content:{manifest:f,period:p,adaptation:t,representations:n},options:o,playbackObserver:g,representationEstimator:r,segmentSink:l,segmentFetcherCreator:a,wantedBufferAhead:u,maxVideoBufferSize:c},Object.assign(Object.assign({},d),{error:m}),h)}function b(t,n,r){l(()=>{i.listen(()=>{r.isCancelled()||d.waitingMediaSourceReload({bufferType:e,period:p,timeOffset:t,stayInPeriod:n})},{includeLastObservation:!0,clearSignal:r})})}g.onUpdate(t=>{(async()=>{var r;if(void 0===t)return;const a=new me;if(a.linkToSignal(h),null===m||void 0===m||m.cancel(),m=a,null===t){j.info(`Stream: Set no ${e} Adaptation. P:`,p.start);const t=s.getStatus(e);if("initialized"===t.type){if(j.info(`Stream: Clearing previous ${e} SegmentSink`),si.isNative(e))return b(0,!0,a.signal);{const e=null!==(r=p.end)&&void 0!==r?r:1/0;if(p.start>e)j.warn("Stream: Can't free buffer: period's start is after its end");else if(await t.value.removeBuffer(p.start,e),a.isUsed())return}}else if("uninitialized"===t.type&&(s.disableSegmentSink(e),a.isUsed()))return;if(d.adaptationChange({type:e,adaptation:null,period:p}),a.isUsed())return;return Xi(i,u,e,{period:p},d,a.signal)}const l=p.adaptations[e],c=Re(null!==l&&void 0!==l?l:[],e=>e.id===t.adaptationId);if(void 0===c)return m.cancel(),void j.warn("Stream: Unfound chosen Adaptation choice",t.adaptationId);const{DELTA_POSITION_AFTER_RELOAD:g}=N.getCurrent();let S,T=!1;if(v)S=0;else if(void 0!==t.relativeResumingPosition)S=t.relativeResumingPosition;else switch(T=!0,e){case"audio":S=g.trackSwitch.audio;break;case"video":S=g.trackSwitch.video;break;default:S=g.trackSwitch.other;break}if(v=!1,si.isNative(e)&&"disabled"===s.getStatus(e).type)return b(S,!0,a.signal);f.addEventListener("manifestUpdate",e=>{for(const t of e.updatedPeriods)if(t.period.id===p.id){for(const e of t.result.removedAdaptations)if(e.id===c.id)return b(S,!0,a.signal)}else if(t.period.start>p.start)break},m.signal);const{representations:_}=t;if(j.info(`Stream: Updating ${e} adaptation`,`A: ${c.id}`,`P: ${p.start}`),d.adaptationChange({type:e,adaptation:c,period:p}),a.isUsed())return;const w=Wi(s,e,c),E=zi(w,p,c,t.switchingMode,i,o);if("needs-reload"===E.type)return b(S,!0,a.signal);if(await s.waitForUsableBuffers(a.signal),!a.isUsed()){if("flush-buffer"===E.type||"clean-buffer"===E.type){for(const{start:e,end:t}of E.value)if(await w.removeBuffer(e,t),a.isUsed())return;if("flush-buffer"===E.type&&(d.needsBufferFlush({relativeResumingPosition:S,relativePosHasBeenDefaulted:T}),a.isUsed()))return}n.get(w)(a.signal),y(c,_,w,a.signal)}})().catch(e=>{e instanceof ye||(null===m||void 0===m||m.cancel(),d.error(e))})},{clearSignal:h,emitCurrentValue:!0})}function Wi(e,t,n){const i=e.getStatus(t);if("initialized"===i.type)return j.info("Stream: Reusing a previous SegmentSink for the type",t),i.value;const r=qi(n);return e.createSegmentSink(t,r)}function qi(e){const t=e.representations.filter(e=>{return!0===e.isSupported&&!1!==e.decipherable});if(0===t.length){const t=new ut("NO_PLAYABLE_REPRESENTATION","No Representation in the chosen "+e.type+" Adaptation can be played",{tracks:[Lt(e)]});throw t}return t[0].getMimeTypeString()}function Yi(e,t){return e.deriveReadOnlyObserver(function(e,n){const i=new de(r(),n);return e.onUpdate(a,{clearSignal:n,emitCurrentValue:!1}),i;function r(){const n=e.getValue(),i=n.buffered[t],r=null!==i?ie(i,n.position.getWanted()):0;return M({},n,{bufferGap:r,buffered:i})}function a(){i.setValue(r())}})}function Xi(e,t,n,i,r,a){const{period:s}=i;let o=!1;function l(){const i=e.getReference().getValue(),a=t.getValue(),l=i.position.getWanted();void 0!==s.end&&l+a>=s.end&&(j.debug('Stream: full "empty" AdaptationStream',n),o=!0),r.streamStatusUpdate({period:s,bufferType:n,imminentDiscontinuity:null,position:l,isEmptyStream:!0,hasFinishedLoading:o,neededSegments:[]})}t.onUpdate(l,{emitCurrentValue:!1,clearSignal:a}),e.listen(l,{includeLastObservation:!1,clearSignal:a}),l()}var Qi=$i;function Zi(e,t){if(0===t.length)return[];const n=[],i=e.getLastKnownInventory();for(let r=0;r<i.length;r++){const e=i[r],a=t.some(t=>{return e.infos.period.id===t.period.id&&e.infos.adaptation.id===t.adaptation.id&&e.infos.representation.id===t.representation.id});if(a){const{bufferedStart:t,bufferedEnd:i}=e;if(void 0===t||void 0===i)return j.warn("SO: No buffered start or end found from a segment."),[{start:0,end:Number.MAX_VALUE}];const r=n[n.length-1];void 0!==r&&r.end===t?r.end=i:n.push({start:t,end:i})}}return n}function Ji(e,t,n,i,a,s,o,u){const{manifest:c,initialPeriod:d}=e,{maxBufferAhead:h,maxBufferBehind:f,wantedBufferAhead:p,maxVideoBufferSize:g}=s,{MINIMUM_MAX_BUFFER_AHEAD:m,MAXIMUM_MAX_BUFFER_AHEAD:v,MAXIMUM_MAX_BUFFER_BEHIND:y}=N.getCurrent(),b=new oi(e=>{var n,i;const{bufferType:r}=e,a=null!==(n=y[r])&&void 0!==n?n:1/0,s=null!==(i=v[r])&&void 0!==i?i:1/0;return n=>{li({segmentSink:e,playbackObserver:t,maxBufferBehind:ce(f,e=>Math.min(e,a),n),maxBufferAhead:ce(h,e=>{var t;const n=Math.max(e,null!==(t=m[r])&&void 0!==t?t:0);return Math.min(n,s)},n)},n)}});for(const r of i.getBufferTypes())S(r,d);function S(e,n){const a=new Ln((e,t)=>e.start-t.start);let s=!1,d=new me;return d.linkToSignal(u),t.listen(({position:t})=>{var n;const i=t.getWanted();if(!s||!f(i))return;j.info("Stream: Destroying all PeriodStreams due to out of bounds situation",e,i),s=!1;while(a.length()>0){const t=a.get(a.length()-1);a.removeElement(t),o.periodStreamCleared({type:e,manifest:c,period:t})}d.cancel(),d=new me,d.linkToSignal(u);const r=null!==(n=c.getPeriodForTime(i))&&void 0!==n?n:c.getNextPeriod(i);if(void 0===r)return j.warn("Stream: The wanted position is not found in the Manifest."),void(s=!0);h(r)},{clearSignal:u,includeLastObservation:!0}),c.addEventListener("decipherabilityUpdate",e=>{u.isCancelled()||p(e).catch(e=>{u.isCancelled()||(d.cancel(),o.error(e))})},u),h(n);function h(t){const n=Object.assign(Object.assign({},o),{waitingMediaSourceReload(e){const t=a.head();void 0===t||t.id!==e.period.id?o.lockedStream({bufferType:e.bufferType,period:e.period}):o.needsMediaSourceReload({timeOffset:e.timeOffset,minimumPosition:e.stayInPeriod?e.period.start:void 0,maximumPosition:e.stayInPeriod?e.period.end:void 0})},periodStreamReady(e){s=!0,a.add(e.period),o.periodStreamReady(e)},periodStreamCleared(e){a.removeElement(e.period),o.periodStreamCleared(e)},error(e){d.cancel(),o.error(e)}});T(e,t,n,d.signal)}function f(e){const t=a.head(),n=a.last();return void 0===t||void 0===n||(t.start>e||(r(n.end)?1/0:n.end)<e)}async function p(n){const r=i.getStatus(e),f=n.filter(t=>t.adaptation.type===e);if(0===f.length||"initialized"!==r.type||f.every(e=>!0===e.representation.decipherable))return;const p=r.value,g=f.filter(e=>void 0===e.representation.decipherable),m=f.filter(e=>!1===e.representation.decipherable),v=Zi(p,m),y=Zi(p,g);s=!1,j.info("Stream: Destroying all PeriodStreams for decipherability matters",e);while(a.length()>0){const t=a.get(a.length()-1);a.removeElement(t),o.periodStreamCleared({type:e,manifest:c,period:t})}d.cancel(),d=new me,d.linkToSignal(u);for(const{start:e,end:t}of[...v,...y]){if(u.isCancelled())return;if(e<t){if(u.isCancelled())return;await p.removeBuffer(e,t)}}l(()=>{if(u.isCancelled())return;const e=t.getReference().getValue();if(er(e,v)){if(o.needsDecipherabilityFlush(),u.isCancelled())return}else if(er(e,y)&&(o.needsBufferFlush(),u.isCancelled()))return;const n=e.position.getWanted(),i=c.getPeriodForTime(n);void 0!==i?h(i):o.error(new ut("MEDIA_TIME_NOT_FOUND","The wanted position is not found in the Manifest."))})}}function T(e,r,u,d){j.info("Stream: Creating new Stream for",e,r.start);let h=null;const f=new me;f.linkToSignal(d),t.listen(({position:t},n)=>{if(void 0!==r.end&&t.getWanted()>=r.end){const i=c.getPeriodAfter(r);if(r.containsTime(t.getWanted(),i))return;j.info("Stream: Destroying PeriodStream as the current playhead moved above it",e,r.start,t.getWanted(),r.end),n(),u.periodStreamCleared({type:e,manifest:c,period:r}),f.cancel()}},{clearSignal:d,includeLastObservation:!0});const m={bufferType:e,content:{manifest:c,period:r},garbageCollectors:b,maxVideoBufferSize:g,segmentFetcherCreator:a,segmentSinksStore:i,options:s,playbackObserver:t,representationEstimator:n,wantedBufferAhead:p},v=Object.assign(Object.assign({},u),{streamStatusUpdate(t){if(t.hasFinishedLoading){const e=c.getPeriodAfter(r);null!==e&&y(e)}else null!==h&&(j.info("Stream: Destroying next PeriodStream due to current one being active",e,h.period.start),u.periodStreamCleared({type:e,manifest:c,period:h.period}),h.canceller.cancel(),h=null);u.streamStatusUpdate(t)},error(e){null!==h&&(h.canceller.cancel(),h=null),f.cancel(),u.error(e)}});function y(t){if(null!==h){if(h.period.id===t.id)return;j.warn("Stream: Creating next `PeriodStream` while one was already created.",e,t.id,h.period.id),u.periodStreamCleared({type:e,manifest:c,period:h.period}),h.canceller.cancel()}const n=new me;n.linkToSignal(d),h={canceller:n,period:t},T(e,t,u,h.canceller.signal)}function S(t){c.addEventListener("manifestUpdate",n=>{for(const e of n.removedPeriods)if(e.id===r.id){if(c.periods.length>0&&c.periods[0].start<=e.start)return l(()=>{if(!t.isCancelled())return o.needsMediaSourceReload({timeOffset:0,minimumPosition:void 0,maximumPosition:void 0})})}else if(e.start>r.start)break;if(n.addedPeriods.length>0&&null!==h){const t=c.getPeriodAfter(r);null!==t&&h.period.id===t.id||(j.warn("Stream: Destroying next PeriodStream due to new one being added",e,h.period.start),u.periodStreamCleared({type:e,manifest:c,period:h.period}),h.canceller.cancel(),h=null)}},t)}Qi(m,v,f.signal),S(f.signal)}}function er(e,t){if(0===t.length)return!1;const n=e.position.getPolled();return e.speed>=0?t[t.length-1].end>=n-5:t[0].start<=n+5}var tr=Ji,nr=tr;const ir={createSync(e){return{syncValue:e,getValueAsAsync(){return Promise.resolve(e)}}},createAsync(e){let t=null;return e.then(e=>{t=e},U),{syncValue:t,getValueAsAsync(){return e}}}};var rr=ir;const ar=new WeakMap;var sr={setState(e,t){ar.set(e,t)},getState(e){const t=ar.get(e);return void 0===t?null:t},clearState(e){ar.set(e,null)}};function or(e){const t=sr.getState(e);return null===t?null:[t.mediaKeySystemAccess.keySystem,t.mediaKeySystemAccess.getConfiguration()]}class lr extends a{}function ur(e,t){const n={audio:null,video:null,text:null};if(null!==t&&(n.text=t.getBufferedRanges()),null===e)return n;const i=Re(e.sourceBuffers,e=>"audio"===e.type),r=Re(e.sourceBuffers,e=>"video"===e.type),a=null===i||void 0===i?void 0:i.getBuffered();void 0!==a&&(n.audio=a);const s=null===r||void 0===r?void 0:r.getBuffered();return void 0!==s&&(n.video=s),n}function cr(e,{autoPlay:t,initialPlayPerformed:n,manifest:i,mediaSource:r,speed:a,textDisplayer:s},o){return e.deriveReadOnlyObserver(function(e,l){const u=new me;u.linkToSignal(l),u.linkToSignal(o);const c=new de(d(),u.signal);return a.onUpdate(h,{clearSignal:u.signal,emitCurrentValue:!1}),e.onUpdate(h,{clearSignal:u.signal,emitCurrentValue:!1}),c;function d(){const o=e.getValue(),l=a.getValue();return dr(o,i),{maximumPosition:_t(i),bufferGap:o.bufferGap,position:o.position,buffered:ur(r,s),duration:o.duration,rebuffering:o.rebuffering,freezing:o.freezing,paused:{last:o.paused,pending:hr(n,t)},readyState:o.readyState,speed:l}}function h(){c.setValue(d())}})}function dr(e,t){if(!t.isDynamic||t.isLastPeriodKnown){const n=t.periods[t.periods.length-1];if(void 0!==n&&void 0!==n.end){const t=e.position.getWanted();if(t>=n.start&&t>=n.end-1){const t=e.buffered;(0===t.length||t.end(t.length-1)<e.duration-1)&&e.position.forceWantedPosition(n.end-1)}}}}function hr(e,t){return e.getValue()?void 0:!t}function fr(e){const{textTracks:t}=e;if(!r(t)){for(let e=0;e<t.length;e++)t[e].mode="disabled";if(e.hasChildNodes()){const{childNodes:t}=e;for(let n=t.length-1;n>=0;n--)if("track"===t[n].nodeName)try{e.removeChild(t[n])}catch(e){j.warn("Compat: Could not remove text track child from element.")}}}e.src="",e.removeAttribute("src")}const pr=s["a"],gr=void 0===pr?void 0:r(pr.MediaSource)?r(pr.MozMediaSource)?r(pr.WebKitMediaSource)?pr.MSMediaSource:pr.WebKitMediaSource:pr.MozMediaSource:pr.MediaSource;function mr(e,t){if("function"===typeof e.changeType){try{e.changeType(t)}catch(e){return j.warn("Could not call 'changeType' on the given SourceBuffer:",e instanceof Error?e:""),!1}return!0}return!1}const vr=["","webkit","moz","ms"];function yr(e,t){const n=document.createElement(e.tagName),i="on"+t;return i in n||(n.setAttribute(i,"return;"),"function"===typeof n[i])}function br(e,t){return t.filter(t=>yr(e,t))[0]}function Sr(e,t){return e.reduce((e,n)=>e.concat((void 0===t?vr:t).map(e=>e+n)),[])}function Tr(e,t){let n;const i=Sr(e,t);return(e,t,r)=>{if(!r.isCancelled()){if("undefined"!==typeof HTMLElement&&e instanceof HTMLElement){if("undefined"===typeof n&&(n=br(e,i)),!Ot(n))return void 0;e.addEventListener(n,t),r.register(()=>{void 0!==n&&e.removeEventListener(n,t)})}i.forEach(n=>{let i=!1;"function"===typeof e.addEventListener?e.addEventListener(n,t):(i=!0,e["on"+n]=t),r.register(()=>{"function"===typeof e.removeEventListener&&e.removeEventListener(n,t),i&&delete e["on"+n]})})}}}function _r(e){let t;const n=document;r(n.hidden)?r(n.mozHidden)?r(n.msHidden)?r(n.webkitHidden)||(t="webkit"):t="ms":t="moz":t="";const i=Ot(t)?t+"Hidden":"hidden",a=Ot(t)?t+"visibilitychange":"visibilitychange",s=document[i],o=new de(!s,e);return Br(document,a,()=>{const e=!document[i];o.setValueIfChanged(e)},e),o}function wr(e,t){const n=e;if(!0===n.webkitSupportsPresentationMode&&"function"===typeof n.webkitSetPresentationMode){const e="picture-in-picture"===n.webkitPresentationMode,i=new de({isEnabled:e,pipWindow:null},t);return Br(n,"webkitpresentationmodechanged",()=>{const e="picture-in-picture"===n.webkitPresentationMode;i.setValue({isEnabled:e,pipWindow:null})},t),i}const i=document.pictureInPictureElement===n,r=new de({isEnabled:i,pipWindow:null},t);return Br(n,"enterpictureinpicture",e=>{var t;r.setValue({isEnabled:!0,pipWindow:null!==(t=e.pictureInPictureWindow)&&void 0!==t?t:null})},t),Br(n,"leavepictureinpicture",()=>{r.setValue({isEnabled:!1,pipWindow:null})},t),r}function Er(e,t){const n=_r(t);let i;const r=new de(!0,t);return t.register(()=>{clearTimeout(i),i=void 0}),n.onUpdate(a,{clearSignal:t}),e.onUpdate(a,{clearSignal:t}),a(),r;function a(){if(clearTimeout(i),i=void 0,e.getValue().isEnabled||n.getValue())r.setValueIfChanged(!0);else{const{INACTIVITY_DELAY:e}=N.getCurrent();i=setTimeout(()=>{r.setValueIfChanged(!1)},e)}}}function xr(e){var t,n;const i=r(s["a"].devicePixelRatio)||0===s["a"].devicePixelRatio?1:s["a"].devicePixelRatio,a=new de({width:null===(t=s["a"].screen)||void 0===t?void 0:t.width,height:null===(n=s["a"].screen)||void 0===n?void 0:n.height,pixelRatio:i},e),o=setInterval(l,2e4);return e.register(function(){clearInterval(o)}),a;function l(){const e=a.getValue();e.width===screen.width&&e.height===screen.height&&e.pixelRatio===i||a.setValue({width:screen.width,height:screen.height,pixelRatio:i})}}function Ar(e,t,n){const i=r(s["a"].devicePixelRatio)||0===s["a"].devicePixelRatio?1:s["a"].devicePixelRatio,a=new de({width:e.clientWidth,height:e.clientHeight,pixelRatio:i},n);let o=U;t.onUpdate(u,{clearSignal:n}),Br(s["a"],"resize",u,n),Br(e,"enterpictureinpicture",u,n),Br(e,"leavepictureinpicture",u,n);const l=setInterval(u,2e4);return u(),n.register(function(){o(),clearInterval(l)}),a;function u(){o();const n=t.getValue(),{pipWindow:s}=n;if(n.isEnabled)if(r(s)){const e=a.getValue();void 0===e.width&&void 0===e.height&&e.pixelRatio===i||a.setValue({width:void 0,height:void 0,pixelRatio:i})}else{const e=()=>{l()};s.addEventListener("resize",e),o=(()=>{s.removeEventListener("resize",e),o=U}),l()}else{const t=a.getValue();t.width===e.clientWidth&&t.height===e.clientHeight&&t.pixelRatio===i||a.setValue({width:e.clientWidth,height:e.clientHeight,pixelRatio:i})}function l(){const e=a.getValue();e.width===(null===s||void 0===s?void 0:s.width)&&e.height===(null===s||void 0===s?void 0:s.height)&&e.pixelRatio===i||a.setValue({width:null===s||void 0===s?void 0:s.width,height:null===s||void 0===s?void 0:s.height,pixelRatio:i})}}}Tr(["loadedmetadata"]),Tr(["timeupdate"]),Tr(["addtrack"]),Tr(["removetrack"]);const kr=Tr(["sourceopen","webkitsourceopen"]),Ir=Tr(["sourceclose","webkitsourceclose"]),Cr=Tr(["sourceended","webkitsourceended"]),Rr=Tr(["update"]),Mr=Tr(["removesourcebuffer"]),Dr=Tr(["keymessage","message"]),Lr=Tr(["keyadded","ready"]),Pr=Tr(["keyerror","error"]),Or=Tr(["keystatuseschange"]),Nr=Tr(["seeking"]),Ur=Tr(["seeked"]),Fr=Tr(["ended"]);function Br(e,t,n,i){e.addEventListener(t,n),i.register(()=>{e.removeEventListener(t,n)})}function Vr(...e){const t=e.length;let n,i=-1,r=0;while(++i<t)n=e[i],r+="number"===typeof n?n:n.length;const a=new Uint8Array(r);let s=0;i=-1;while(++i<t)n=e[i],"number"===typeof n?s+=n:n.length>0&&(a.set(n,s),s+=n.length);return a}function jr(e,t){return(e[t+0]<<8)+(e[t+1]<<0)}function Gr(e,t){return 65536*e[t+0]+256*e[t+1]+e[t+2]}function Hr(e,t){return 16777216*e[t+0]+65536*e[t+1]+256*e[t+2]+e[t+3]}function zr(e,t){return 4294967296*(16777216*e[t+0]+65536*e[t+1]+256*e[t+2]+e[t+3])+16777216*e[t+4]+65536*e[t+5]+256*e[t+6]+e[t+7]}function Kr(e){return new Uint8Array([e>>>8&255,255&e])}function $r(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}function Wr(e){const t=e%4294967296,n=(e-t)/4294967296;return new Uint8Array([n>>>24&255,n>>>16&255,n>>>8&255,255&n,t>>>24&255,t>>>16&255,t>>>8&255,255&t])}function qr(e,t){return(e[t+0]<<0)+(e[t+1]<<8)}function Yr(e,t){return e[t+0]+256*e[t+1]+65536*e[t+2]+16777216*e[t+3]}function Xr(e){return new Uint8Array([255&e,e>>>8&255])}function Qr(e){return new Uint8Array([255&e,e>>>8&255,e>>>16&255,e>>>24&255])}function Zr(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];i.updating&&t.push(i)}return t}function Jr(e,t){if(j.debug("Init: Trying to call endOfStream"),"open"!==e.readyState)return void j.debug("Init: MediaSource not open, cancel endOfStream");const{sourceBuffers:n}=e,i=Zr(n);if(0===i.length){j.info("Init: Triggering end of stream");try{e.endOfStream()}catch(e){j.error("Unable to call endOfStream",e instanceof Error?e:new Error("Unknown error"))}return}j.debug("Init: Waiting SourceBuffers to be updated before calling endOfStream.");const r=new me;r.linkToSignal(t);for(const a of i)Rr(a,()=>{r.cancel(),Jr(e,t)},r.signal);Mr(n,()=>{r.cancel(),Jr(e,t)},r.signal)}function ea(e,t){let n=new me;n.linkToSignal(t),kr(e,()=>{j.debug("Init: MediaSource re-opened while end-of-stream is active"),n.cancel(),n=new me,n.linkToSignal(t),Jr(e,n.signal)},t),Jr(e,n.signal)}function ta(){return w}const na=31536e3;class ia{constructor(e){this._mediaSource=e,this._currentMediaSourceDurationUpdateCanceller=null}updateDuration(e,t){null!==this._currentMediaSourceDurationUpdateCanceller&&this._currentMediaSourceDurationUpdateCanceller.cancel(),this._currentMediaSourceDurationUpdateCanceller=new me;const n=this._mediaSource,i=this._currentMediaSourceDurationUpdateCanceller.signal,r=sa(n,i);let a=new me;function s(){if(a.cancel(),!r.getValue())return;a=new me,a.linkToSignal(i);const s=aa(n.sourceBuffers,a.signal);let o=new me;return o.linkToSignal(a.signal),s.onUpdate(i=>{o.cancel(),o=new me,o.linkToSignal(a.signal),i||oa(n,e,t,o.signal)},{clearSignal:a.signal,emitCurrentValue:!0})}a.linkToSignal(i),r.onUpdate(s,{emitCurrentValue:!0,clearSignal:i})}stopUpdating(){null!==this._currentMediaSourceDurationUpdateCanceller&&(this._currentMediaSourceDurationUpdateCanceller.cancel(),this._currentMediaSourceDurationUpdateCanceller=null)}}function ra(e,t,n){let i=t;n||(i=ta()?1/0:la(t));let r=0;for(let a=0;a<e.sourceBuffers.length;a++){const t=e.sourceBuffers[a],n=t.buffered.length;n>0&&(r=Math.max(t.buffered.end(n-1)))}if(i===e.duration)return"success";if(r>i){if(r<e.duration)try{j.info("Init: Updating duration to what is currently buffered",r),e.duration=r}catch(e){return j.warn("Duration Updater: Can't update duration on the MediaSource.",e instanceof Error?e:""),"failed"}return"partial"}{const n=e.duration;try{if(j.info("Init: Updating duration",i),e.duration=i,"open"===e.readyState&&!isFinite(i)){const n=la(t);j.info("Init: calling `mediaSource.setLiveSeekableRange`",n),e.setLiveSeekableRange(0,n)}}catch(e){return j.warn("Duration Updater: Can't update duration on the MediaSource.",e instanceof Error?e:""),"failed"}const r=Math.abs(e.duration-i);if(r>=.1){const t=Math.abs(e.duration-n);return r<t?"partial":"failed"}return"success"}}function aa(e,t){if(0===e.length){const e=new de(!1);return e.finish(),e}const n=new de(!1,t);i();for(let r=0;r<e.length;r++){const n=e[r];n.addEventListener("updatestart",i),n.addEventListener("update",i),t.register(()=>{n.removeEventListener("updatestart",i),n.removeEventListener("update",i)})}return n;function i(){for(let t=0;t<e.length;t++){const i=e[t];if(i.updating)return void n.setValueIfChanged(!0)}n.setValueIfChanged(!1)}}function sa(e,t){const n=new de("open"===e.readyState,t);return kr(e,()=>{j.debug("Init: Reacting to MediaSource open in duration updater"),n.setValueIfChanged(!0)},t),Cr(e,()=>{j.debug("Init: Reacting to MediaSource ended in duration updater"),n.setValueIfChanged(!1)},t),Ir(e,()=>{j.debug("Init: Reacting to MediaSource close in duration updater"),n.setValueIfChanged(!1)},t),n}function oa(e,t,n,i){const r=ra(e,t,n);if("success"===r)return;const a=setTimeout(()=>{s(),oa(e,t,n,i)},2e3),s=i.register(()=>{clearTimeout(a)})}function la(e){return Math.max(Math.pow(2,32),e+na)}class ua extends a{constructor(e){if(super(),this.id=e,this.sourceBuffers=[],this._canceller=new me,r(gr))throw new ut("MEDIA_SOURCE_NOT_SUPPORTED","No MediaSource Object was found in the current browser.");j.info("Init: Creating MediaSource");const t=new gr;this.readyState=t.readyState;const n=t.handle;this.handle=r(n)?{type:"media-source",value:t}:{type:"handle",value:n},this._mediaSource=t,this._durationUpdater=new ia(t),this._endOfStreamCanceller=null,kr(t,()=>{this.readyState=t.readyState,this.trigger("mediaSourceOpen",null)},this._canceller.signal),Cr(t,()=>{this.readyState=t.readyState,this.trigger("mediaSourceEnded",null)},this._canceller.signal),Ir(t,()=>{this.readyState=t.readyState,this.trigger("mediaSourceClose",null)},this._canceller.signal)}addSourceBuffer(e,t){const n=this._mediaSource.addSourceBuffer(t),i=new ca(e,t,n);return this.sourceBuffers.push(i),i}setDuration(e,t){this._durationUpdater.updateDuration(e,t)}interruptDurationSetting(){this._durationUpdater.stopUpdating()}maintainEndOfStream(){null===this._endOfStreamCanceller&&(this._endOfStreamCanceller=new me,this._endOfStreamCanceller.linkToSignal(this._canceller.signal),j.debug("Init: end-of-stream order received."),ea(this._mediaSource,this._endOfStreamCanceller.signal))}stopEndOfStream(){null!==this._endOfStreamCanceller&&(j.debug("Init: resume-stream order received."),this._endOfStreamCanceller.cancel(),this._endOfStreamCanceller=null)}dispose(){this.sourceBuffers.forEach(e=>e.dispose()),this._canceller.cancel(),da(this._mediaSource)}}class ca{constructor(e,t,n){this.type=e,this.codec=t,this._canceller=new me,this._sourceBuffer=n,this._operationQueue=[],this._currentOperations=[];const i=e=>{let t;t=e instanceof Error?e:e.error instanceof Error?e.error:new Error("Unknown SourceBuffer Error");const n=this._currentOperations;if(this._currentOperations=[],0===n.length)j.error("SBI: error for an unknown operation",t);else{const e=new Ci(t.name,t.message,"QuotaExceededError"===t.name);for(const t of n)t.reject(e)}},r=()=>{const e=this._currentOperations;this._currentOperations=[];try{for(const t of e)t.resolve(Q(this._sourceBuffer.buffered))}catch(t){for(const n of e)t instanceof Error&&"InvalidStateError"===t.name?n.resolve([]):n.reject(t)}this._performNextOperation()};n.addEventListener("error",i),n.addEventListener("updateend",r),this._canceller.signal.register(()=>{n.removeEventListener("error",i),n.removeEventListener("updateend",r)})}appendBuffer(...e){return j.debug("SBI: receiving order to push data to the SourceBuffer",this.type),this._addToQueue({operationName:0,params:e})}remove(e,t){return j.debug("SBI: receiving order to remove data from the SourceBuffer",this.type,e,t),this._addToQueue({operationName:1,params:[e,t]})}getBuffered(){try{return Q(this._sourceBuffer.buffered)}catch(e){return j.error("Failed to get buffered time range of SourceBuffer",this.type,e instanceof Error?e:null),[]}}abort(){try{this._sourceBuffer.abort()}catch(e){j.debug("Init: Failed to abort SourceBuffer:",e instanceof Error?e:null)}this._emptyCurrentQueue()}dispose(){try{this._sourceBuffer.abort()}catch(e){}this._emptyCurrentQueue()}_emptyCurrentQueue(){const e=new ye;this._currentOperations.length>0&&(this._currentOperations.forEach(t=>{t.reject(e)}),this._currentOperations=[]),this._operationQueue.length>0&&(this._operationQueue.forEach(t=>{t.reject(e)}),this._operationQueue=[])}_addToQueue(e){return new Promise((t,n)=>{const i=0===this._operationQueue.length&&0===this._currentOperations.length,r=M({resolve:t,reject:n},e);this._operationQueue.push(r),i&&this._performNextOperation()})}_performNextOperation(){var e,t,n,i,r;if(0!==this._currentOperations.length||this._sourceBuffer.updating)return;const a=this._operationQueue.shift();if(void 0!==a)if(0===a.operationName){this._currentOperations=[{operationName:0,resolve:a.resolve,reject:a.reject}];const s=a.params[0],o=a.params[1];let l=s;if(this._operationQueue.length>0&&0===this._operationQueue[0].operationName){let a;a=s instanceof ArrayBuffer?new Uint8Array(s):s instanceof Uint8Array?s:new Uint8Array(s.buffer);const u=[a];while(0===(null===(e=this._operationQueue[0])||void 0===e?void 0:e.operationName)){const e=this._operationQueue[0],a=null!==(t=o.appendWindow)&&void 0!==t?t:[void 0,void 0],s=null!==(n=e.params[1].appendWindow)&&void 0!==n?n:[void 0,void 0],l=null!==(i=o.timestampOffset)&&void 0!==i?i:0,c=null!==(r=e.params[1].timestampOffset)&&void 0!==r?r:0;if(a[0]!==s[0]||a[1]!==s[1]||o.codec!==e.params[1].codec||l!==c)break;{const t=e.params[0];let n;n=t instanceof ArrayBuffer?new Uint8Array(t):t instanceof Uint8Array?t:new Uint8Array(t.buffer),u.push(n),this._operationQueue.splice(0,1),this._currentOperations.push({operationName:0,resolve:e.resolve,reject:e.reject})}}u.length>1&&(j.info(`MMSI: Merging ${u.length} segments together for perf`,this.type),l=Vr(...u))}try{this._appendBufferNow(l,o)}catch(e){const t=e instanceof Error?new Ci(e.name,e.message,"QuotaExceededError"===e.name):new Ci("Error","Unknown SourceBuffer Error during appendBuffer",!1);this._currentOperations.forEach(e=>{e.reject(t)}),this._currentOperations=[]}}else{this._currentOperations=[a];const[e,t]=a.params;j.debug("SBI: removing data from SourceBuffer",this.type,e,t);try{this._sourceBuffer.remove(e,t)}catch(e){const t=e instanceof Error?new Ci(e.name,e.message,!1):new Ci("Error","Unknown SourceBuffer Error during remove",!1);a.reject(t),this._currentOperations=[]}}}_appendBufferNow(e,t){const n=this._sourceBuffer,{codec:i,timestampOffset:r,appendWindow:a=[]}=t;if(void 0!==i&&i!==this.codec){j.debug("SBI: updating codec",i);const e=mr(n,i);e?this.codec=i:j.debug("SBI: could not update codec",i,this.codec)}if(void 0!==r&&n.timestampOffset!==r){const e=r;j.debug("SBI: updating timestampOffset",i,n.timestampOffset,e),n.timestampOffset=e}if(void 0===a[0])n.appendWindowStart>0&&(j.debug("SBI: re-setting `appendWindowStart` to `0`"),n.appendWindowStart=0);else if(a[0]!==n.appendWindowStart){if(a[0]>=n.appendWindowEnd){const e=a[0]+1;j.debug("SBI: pre-updating `appendWindowEnd`",e),n.appendWindowEnd=e}j.debug("SBI: setting `appendWindowStart`",a[0]),n.appendWindowStart=a[0]}void 0===a[1]?n.appendWindowEnd!==1/0&&(j.debug("SBI: re-setting `appendWindowEnd` to `Infinity`"),n.appendWindowEnd=1/0):a[1]!==n.appendWindowEnd&&(j.debug("SBI: setting `appendWindowEnd`",a[1]),n.appendWindowEnd=a[1]),j.debug("SBI: pushing segment",this.type),n.appendBuffer(e)}}function da(e){if("closed"!==e.readyState){const{readyState:t,sourceBuffers:n}=e;for(let i=n.length-1;i>=0;i--){const r=n[i];try{if("open"===t){j.info("Init: Aborting SourceBuffer before removing");try{r.abort()}catch(e){}}j.info("Init: Removing SourceBuffer from mediaSource"),e.removeSourceBuffer(r)}catch(e){}}n.length>0&&j.info("Init: Not all SourceBuffers could have been removed.")}}const ha=pt();function fa(e,t){if(null!==t&&e.src===t&&(j.info("Init: Clearing HTMLMediaElement's src"),fr(e)),null!==t)try{j.debug("Init: Revoking previous URL"),URL.revokeObjectURL(t)}catch(e){j.warn("Init: Error while revoking the media source URL",e instanceof Error?e:"")}}function pa(e,t){const n=Ot(e.src)?e.src:null;fa(e,n);const i=new ua(ha());return t.register(()=>{i.dispose()}),i}function ga(e,t){return un(t,n=>{const i=pa(e,t);if(i.addEventListener("mediaSourceOpen",()=>{j.info("Init: MediaSource opened"),n(i)},t),j.info("MTCI: Attaching MediaSource URL to the media element"),"handle"===i.handle.type)e.srcObject=i.handle.value,t.register(()=>{fa(e,null)});else{const n=URL.createObjectURL(i.handle.value);e.src=n,t.register(()=>{fa(e,n)})}})}function ma(e,t,n){var i;if(!r(n)){const t=St(e),a=_t(e);if(!r(n.position))return j.debug("Init: using startAt.minimumPosition"),Math.max(Math.min(n.position,a),t);if(!r(n.wallClockTime)){j.debug("Init: using startAt.wallClockTime");const i=void 0===e.availabilityStartTime?0:e.availabilityStartTime,r=n.wallClockTime-i;return Math.max(Math.min(r,a),t)}if(!r(n.fromFirstPosition)){j.debug("Init: using startAt.fromFirstPosition");const{fromFirstPosition:e}=n;return e<=0?t:Math.min(a,t+e)}if(!r(n.fromLastPosition)){j.debug("Init: using startAt.fromLastPosition");const{fromLastPosition:e}=n;return e>=0?a:Math.max(t,a+e)}if(!r(n.fromLivePosition)){j.debug("Init: using startAt.fromLivePosition");const r=null!==(i=Tt(e))&&void 0!==i?i:a,{fromLivePosition:s}=n;return s>=0?r:Math.max(t,r+s)}if(!r(n.percentage)){j.debug("Init: using startAt.percentage");const{percentage:e}=n;if(e>100)return a;if(e<0)return t;const i=+e/100,r=a-t;return t+r*i}}const a=St(e);if(e.isLive){const{suggestedPresentationDelay:n,clockOffset:i}=e,r=_t(e);let s;const{DEFAULT_LIVE_GAP:o}=N.getCurrent();if(void 0===i)j.info("Init: no clock offset found for a live content, starting close to maximum available position"),s=r;else{j.info("Init: clock offset found for a live content, checking if we can start close to it");const t=void 0===e.availabilityStartTime?0:e.availabilityStartTime,n=(_e()+i)/1e3-t;s=Math.min(r,n)}const l=null!==n&&void 0!==n?n:t?o.LOW_LATENCY:o.DEFAULT;return j.debug(`Init: ${s} defined as the live time, applying a live gap`+` of ${l}`),Math.max(s-l,a)}return j.info("Init: starting at the minimum available position:",a),a}function va(){return m}function ya(e){return!e||!g}function ba(){return w}function Sa(e,t,n,i){const r=new me;r.linkToSignal(i);const a=new de(!1,r.signal);return e.listen(e=>{if(null!==e.rebuffering||null!==e.freezing||0===e.readyState)return;if(!ya(n)){if(isNaN(t.duration))return;if(t.duration>0)return a.setValue(!0),void r.cancel()}const i=ba()?4:3;return e.readyState>=i&&(null!==e.currentRange||e.ended)&&(!va()||t.duration>0)?(a.setValue(!0),void r.cancel()):void 0},{includeLastObservation:!0,clearSignal:r.signal}),a}const Ta=!g;var _a,wa=Ta;function Ea({mediaElement:e,playbackObserver:t,startTime:n,mustAutoPlay:i,isDirectfile:r,onWarning:a},s){const o=new de(!1,s),l=new Promise((l,u)=>{const c=s.register(e=>{u(e)});if(s.isCancelled())return;let d=!1;const h=e=>{t.setCurrentTime(e),d=!0};if(r&&"number"!==typeof n)t.listen((e,t)=>{if(e.readyState>=1){t();const e="number"===typeof n?n:n();0!==e&&(wa?h(e):setTimeout(()=>{h(e)},0)),f()}},{includeLastObservation:!0,clearSignal:s});else{const e="number"===typeof n?n:n();0!==e&&h(e),f()}function f(){let n=!1;t.listen((t,i)=>{if(n||0===t.seeking&&"seeking"!==t.event&&"internal-seeking"!==t.event||(n=!0),(!d||n)&&0!==t.readyState){if(i(),va()&&0===e.duration){const e=new ut("MEDIA_ERR_NOT_LOADED_METADATA","Cannot load automatically: your browser falsely announced having loaded the content.");a(e)}s.isCancelled()||p()}},{includeLastObservation:!0,clearSignal:s})}function p(){t.listen((e,t)=>{0===e.seeking&&null===e.rebuffering&&e.readyState>=1&&(t(),g())},{includeLastObservation:!0,clearSignal:s})}function g(){var t;if(j.info("Init: Can begin to play content"),!i)return e.autoplay&&j.warn("Init: autoplay is enabled on HTML media element. Media will play as soon as possible."),o.setValue(!0),o.finish(),c(),l({type:"skipped"});if(e.ended)return j.warn("Init: autoplay is enabled but the video is ended. Skipping autoplay to prevent video to start again"),o.setValue(!0),o.finish(),c(),l({type:"skipped"});let n;try{n=null!==(t=e.play())&&void 0!==t?t:Promise.resolve()}catch(e){return c(),u(e)}n.then(()=>{if(!s.isCancelled())return o.setValue(!0),o.finish(),c(),l({type:"autoplay"})}).catch(e=>{if(c(),!s.isCancelled()){if(e instanceof Error&&"NotAllowedError"===e.name){j.warn("Init: Media element can't play. It may be due to browser auto-play policies.");const e=new ut("MEDIA_ERR_BLOCKED_AUTOPLAY","Cannot trigger auto-play automatically: your browser does not allow it.");if(a(e),s.isCancelled())return;return l({type:"autoplay-blocked"})}u(e)}})}});return{autoPlayResult:l,initialPlayPerformed:o}}function xa(e,t,n,i,r){if(0===t.length)return u("No `keySystems` option given.");if(null===$t.decrypt)return u("EME feature not activated.");const a=new me;a.linkToSignal(r);const s=new de({initializationState:{type:"uninitialized",value:null},drmSystemId:void 0},r),o=$t.decrypt;if(!o.hasEmeApis())return u("EME API not available on the current page.");j.debug("Init: Creating ContentDecryptor");const l=new o(e,t);return l.addEventListener("stateChange",e=>{if(e===_a.WaitingForAttachment){const t=new de(!1);t.onUpdate((t,n)=>{t&&(n(),e===_a.WaitingForAttachment&&l.attach())},{clearSignal:a.signal}),s.setValue({initializationState:{type:"awaiting-media-link",value:{isMediaLinked:t}},drmSystemId:l.systemId})}else e===_a.ReadyForContent&&(s.setValue({initializationState:{type:"initialized",value:null},drmSystemId:l.systemId}),l.removeEventListener("stateChange"))}),l.addEventListener("error",e=>{a.cancel(),i.onError(e)}),l.addEventListener("warning",e=>{i.onWarning(e)}),l.addEventListener("blackListProtectionData",e=>{i.onBlackListProtectionData(e)}),l.addEventListener("keyIdsCompatibilityUpdate",e=>{i.onKeyIdsCompatibilityUpdate(e)}),n.onUpdate(e=>{null!==e&&l.onInitializationData(e)},{clearSignal:a.signal}),a.signal.register(()=>{l.dispose()}),s;function u(e){n.onUpdate((t,n)=>{if(null===t)return;n();const r=new lt("MEDIA_IS_ENCRYPTED_ERROR",e);i.onError(r)},{clearSignal:r});const t=new de({initializationState:{type:"initialized",value:null},drmSystemId:void 0});return t.finish(),t}}(function(e){e[e["Initializing"]=0]="Initializing",e[e["WaitingForAttachment"]=1]="WaitingForAttachment",e[e["ReadyForContent"]=2]="ReadyForContent",e[e["Error"]=3]="Error",e[e["Disposed"]=4]="Disposed"})(_a||(_a={}));class Aa{constructor(e){this._displayer=e}pushTextData(e){try{return Promise.resolve(this._displayer.pushTextData(e))}catch(e){return Promise.reject(e)}}remove(e,t){try{return Promise.resolve(this._displayer.removeBuffer(e,t))}catch(e){return Promise.reject(e)}}reset(){this._displayer.reset()}stop(){this._displayer.stop()}}const ka=1/60;class Ia extends a{constructor(e,t,n){super(),this._playbackObserver=e,this._manifest=t,this._speed=n,this._discontinuitiesStore=[],this._isStarted=!1,this._canceller=new me}start(){if(this._isStarted)return;this._isStarted=!0;const e=new La(this._playbackObserver,this._speed);this._canceller.signal.register(()=>{e.dispose()});let t=null;this._playbackObserver.listen(n=>{const i=this._discontinuitiesStore,{buffered:r,position:a,readyState:s,rebuffering:o,freezing:l}=n,{BUFFER_DISCONTINUITY_THRESHOLD:u,FREEZING_STALLED_DELAY:c,UNFREEZING_SEEK_DELAY:d,UNFREEZING_DELTA_POSITION:h}=N.getCurrent();if(null!==l){const n=_e(),i=null===t?l.timestamp:t.attemptTimestamp;if(!a.isAwaitingFuturePosition()&&n-i>d&&(j.warn("Init: trying to seek to un-freeze player"),this._playbackObserver.setCurrentTime(this._playbackObserver.getCurrentTime()+h),t={attemptTimestamp:n}),n-l.timestamp>c)return null===o?e.stopRebuffering():e.startRebuffering(),void this.trigger("stalled","freezing")}else t=null;if(null===o){if(e.stopRebuffering(),1===s){let e;return e=0!==n.seeking?1===n.seeking?"internal-seek":"seeking":"not-ready",void this.trigger("stalled",e)}return void this.trigger("unstalled",null)}const f="seeking"===o.reason&&1===n.seeking?"internal-seek":o.reason;if(a.isAwaitingFuturePosition())return e.stopRebuffering(),j.debug("Init: let rebuffering happen as we're awaiting a future position"),void this.trigger("stalled",f);if(e.startRebuffering(),null===this._manifest)return void this.trigger("stalled",f);const{position:p}=o;if(null!==p&&void 0!==p&&this._speed.getValue()>0){const e=Ca(i,this._manifest,p);if(null!==e){const t=e+.001;if(!(t<=this._playbackObserver.getCurrentTime()))return j.warn("SA: skippable discontinuity found in the stream",a.getPolled(),t),this._playbackObserver.setCurrentTime(t),void this.trigger("warning",Da(p,t));j.info("Init: position to seek already reached, no seeking",this._playbackObserver.getCurrentTime(),t)}}const g=null!==p&&void 0!==p?p:a.getPolled(),m=ee(r,g);if(this._speed.getValue()>0&&m<u){const e=g+m+ka;if(this._playbackObserver.getCurrentTime()<e)return j.warn("Init: discontinuity encountered inferior to the threshold",g,e,u),this._playbackObserver.setCurrentTime(e),void this.trigger("warning",Da(g,e))}for(let e=this._manifest.periods.length-2;e>=0;e--){const t=this._manifest.periods[e];if(void 0!==t.end&&t.end<=g){if(this._manifest.periods[e+1].start>g&&this._manifest.periods[e+1].start>this._playbackObserver.getCurrentTime()){const t=this._manifest.periods[e+1];return this._playbackObserver.setCurrentTime(t.start),void this.trigger("warning",Da(g,t.start))}break}}this.trigger("stalled",f)},{includeLastObservation:!0,clearSignal:this._canceller.signal})}updateDiscontinuityInfo(e){this._isStarted||this.start();const t=this._playbackObserver.getReference().getValue();Ma(this._discontinuitiesStore,e,t)}onLockedStream(e,t){var n;this._isStarted||this.start();const i=this._playbackObserver.getReference().getValue();if(!i.rebuffering||i.paused||this._speed.getValue()<=0||"audio"!==e&&"video"!==e)return;const r=i.position.getWanted(),a=null!==(n=i.rebuffering.position)&&void 0!==n?n:r,s=t.start;r<s&&Math.abs(a-s)<1&&(j.warn("Init: rebuffering because of a future locked stream.\nTrying to unlock by seeking to the next Period"),this._playbackObserver.setCurrentTime(s+.001))}destroy(){this._canceller.cancel()}}function Ca(e,t,n){if(0===e.length)return null;let i=null;for(const r of e){const{period:e}=r;if(e.start>n)return i;let a;if(void 0===e.end||e.end>n){const{discontinuity:s,position:o}=r,{start:l,end:u}=s,c=null!==l&&void 0!==l?l:o;if(n>=c-ka)if(null===u){const n=xt(t,e);null!==n?a=n.start+ka:j.warn("Init: discontinuity at Period's end but no next Period")}else n<u+ka&&(a=u+ka);void 0!==a&&(j.info("Init: discontinuity found",n,a),i=null!==i&&i>a?i:a)}}return i}function Ra(e){return null!==e.discontinuity}function Ma(e,t,n){const i=Math.min(n.position.getPolled(),n.position.getWanted());while(e.length>0&&void 0!==e[0].period.end&&e[0].period.end+10<i)e.shift();const{period:r,bufferType:a}=t;if("audio"===a||"video"===a){for(let n=0;n<e.length;n++)if(e[n].period.id===r.id){if(e[n].bufferType===a)return void(Ra(t)?e[n]=t:e.splice(n,1))}else if(e[n].period.start>r.start)return void(Ra(t)&&e.splice(n,0,t));Ra(t)&&e.push(t)}}function Da(e,t){return new ut("DISCONTINUITY_ENCOUNTERED","A discontinuity has been encountered at position "+String(e)+", seeked at position "+String(t))}class La{constructor(e,t){this._speedUpdateCanceller=new me,this._isRebuffering=!1,this._playbackObserver=e,this._isDisposed=!1,this._speed=t,this._updateSpeed()}startRebuffering(){this._isRebuffering||this._isDisposed||(this._isRebuffering=!0,this._speedUpdateCanceller.cancel(),j.info("Init: Pause playback to build buffer"),this._playbackObserver.setPlaybackRate(0))}stopRebuffering(){this._isRebuffering&&!this._isDisposed&&(this._isRebuffering=!1,this._speedUpdateCanceller=new me,this._updateSpeed())}dispose(){this._speedUpdateCanceller.cancel(),this._isDisposed=!0}_updateSpeed(){this._speed.onUpdate(e=>{j.info("Init: Resume playback speed",e),this._playbackObserver.setPlaybackRate(e)},{clearSignal:this._speedUpdateCanceller.signal,emitCurrentValue:!0})}}function Pa(e,t){return e.id===t.id&&e.start===t.start&&e.end===t.end}var Oa=Pa;function Na(e,t){const n=[],{periods:i}=t;for(const r of i){const{streamEvents:t}=r;t.forEach(({start:t,end:i,id:r,data:a})=>{for(const l of e)if(Oa(l,{id:r,start:t,end:i}))return void n.push(l);let s;if(void 0!==a.value.element)s=a.value.element;else{if(void 0===a.value.xmlData)return;{let e=a.value.xmlData.namespaces.reduce((e,t)=>{return e+"xmlns:"+t.key+'="'+t.value+'" '},"<toremove ");e+=">";const t=(new DOMParser).parseFromString(e+a.value.xmlData.data+"</toremove>","application/xml").documentElement;s=t.children.length>0?t.children[0]:t.childNodes[0]}}const o={type:a.type,value:Object.assign(Object.assign({},a.value),{element:s})};if(void 0===i){const e={start:t,id:r,data:o,publicEvent:{start:t,data:o}};n.push(e)}else{const e={start:t,end:i,id:r,data:o,publicEvent:{start:t,end:i,data:o}};n.push(e)}})}return n}var Ua=Na;class Fa extends a{constructor(e,t,n){super(),this._manifest=e,this._mediaElement=t,this._playbackObserver=n,this._canceller=null,this._scheduledEventsRef=new de([]),this._eventsBeingPlayed=new WeakMap}start(){if(null!==this._canceller)return;this._canceller=new me;const e=this._canceller.signal,t=this._playbackObserver,n=this._mediaElement;let i=!1,r=new me;r.linkToSignal(e),this._scheduledEventsRef.setValue(Ua([],this._manifest)),this._scheduledEventsRef.onUpdate(({length:a})=>{if(0===a)return void(i&&(r.cancel(),r=new me,r.linkToSignal(e),i=!1));if(i)return;i=!0;let s=c();const o=()=>{const e=c();this._emitStreamEvents(this._scheduledEventsRef.getValue(),s,e,r.signal),s=e},{STREAM_EVENT_EMITTER_POLL_INTERVAL:l}=N.getCurrent(),u=setInterval(o,l);function c(){const e=t.getReference().getValue(),i=n.currentTime,r=0!==e.seeking;return{currentTime:i,isSeeking:r}}t.listen(o,{includeLastObservation:!1,clearSignal:r.signal}),r.signal.register(()=>{clearInterval(u)})},{emitCurrentValue:!0,clearSignal:e})}onManifestUpdate(e){const t=this._scheduledEventsRef.getValue();this._scheduledEventsRef.setValue(Ua(t,e))}stop(){null!==this._canceller&&(this._canceller.cancel(),this._canceller=null)}_emitStreamEvents(e,t,n,i){const{currentTime:r}=t,{isSeeking:a,currentTime:s}=n,o=[],l=[];for(let u=0;u<e.length;u++){const t=e[u],n=t.start,i=Ba(t)?t.end:void 0,c=this._eventsBeingPlayed.has(t);c?(n>s||void 0!==i&&s>=i)&&(Ba(t)&&l.push(t.publicEvent),this._eventsBeingPlayed.delete(t)):n<=s&&void 0!==i&&s<i?(o.push({type:"stream-event",value:t.publicEvent}),this._eventsBeingPlayed.set(t,!0)):r<n&&s>=(null!==i&&void 0!==i?i:n)&&(a?o.push({type:"stream-event-skip",value:t.publicEvent}):(o.push({type:"stream-event",value:t.publicEvent}),Ba(t)&&l.push(t.publicEvent)))}if(o.length>0)for(const u of o)if("stream-event"===u.type?this.trigger("event",u.value):this.trigger("eventSkip",u.value),i.isCancelled())return;if(l.length>0)for(const u of l)if("function"===typeof u.onExit&&u.onExit(),i.isCancelled())return}}function Ba(e){return void 0!==e.end}var Va=Fa;function ja(e,t,n){function i(){const n=e.error;let i,a;switch(r(n)||(i=n.code,a=n.message),i){case 1:return a=null!==a&&void 0!==a?a:"The fetching of the associated resource was aborted by the user's request.",t(new ut("MEDIA_ERR_ABORTED",a));case 2:return a=null!==a&&void 0!==a?a:"A network error occurred which prevented the media from being successfully fetched",t(new ut("MEDIA_ERR_NETWORK",a));case 3:return a=null!==a&&void 0!==a?a:"An error occurred while trying to decode the media resource",t(new ut("MEDIA_ERR_DECODE",a));case 4:return a=null!==a&&void 0!==a?a:"The media resource has been found to be unsuitable.",t(new ut("MEDIA_ERR_SRC_NOT_SUPPORTED",a));default:return a=null!==a&&void 0!==a?a:"The HTMLMediaElement errored due to an unknown reason.",t(new ut("MEDIA_ERR_UNKNOWN",a))}}n.isCancelled()||(e.addEventListener("error",i),n.register(()=>{e.removeEventListener("error",i)}))}class Ga extends lr{constructor(e){super(),this._settings=e,this._initCanceller=new me,this._manifest=null;const t=void 0===e.url?void 0:[e.url];this._manifestFetcher=new yn(t,e.transport,e.manifestRequestSettings)}prepare(){null===this._manifest&&(this._manifest=rr.createAsync(un(this._initCanceller.signal,(e,t)=>{this._manifestFetcher.addEventListener("warning",e=>this.trigger("warning",e)),this._manifestFetcher.addEventListener("error",e=>{this.trigger("error",e),t(e)}),this._manifestFetcher.addEventListener("manifestReady",t=>{e(t)})})),this._manifestFetcher.start(),this._initCanceller.signal.register(()=>{this._manifestFetcher.dispose()}))}start(e,t){this.prepare(),ja(e,e=>this._onFatalError(e),this._initCanceller.signal);const n=new de(null,this._initCanceller.signal);this._initializeMediaSourceAndDecryption(e,n).then(i=>this._onInitialMediaSourceReady(e,i.mediaSource,t,i.drmSystemId,n,i.unlinkMediaSource)).catch(e=>{this._onFatalError(e)})}updateContentUrls(e,t){this._manifestFetcher.updateContentUrls(e,t)}dispose(){this._initCanceller.cancel()}_onFatalError(e){this._initCanceller.isUsed()||(this._initCanceller.cancel(),this.trigger("error",e))}_initializeMediaSourceAndDecryption(e,t){const n=this._initCanceller;return un(n.signal,i=>{const{keySystems:r}=this._settings,a=xa(e,r,t,{onWarning:e=>this.trigger("warning",e),onError:e=>this._onFatalError(e),onBlackListProtectionData:e=>{(async()=>{var t;if(null===this._manifest)return;const n=null!==(t=this._manifest.syncValue)&&void 0!==t?t:await this._manifest.getValueAsAsync();za(n,e)})().catch(U)},onKeyIdsCompatibilityUpdate:e=>{(async()=>{var t;if(null===this._manifest)return;const n=null!==(t=this._manifest.syncValue)&&void 0!==t?t:await this._manifest.getValueAsAsync();Ha(n,e.whitelistedKeyIds,e.blacklistedKeyIds,e.delistedKeyIds)})().catch(U)}},n.signal);a.onUpdate((t,r)=>{if("uninitialized"===t.initializationState.type)return;r();const s=new me;s.linkToSignal(n.signal),ga(e,s.signal).then(e=>{const r=a.getValue();if("awaiting-media-link"===r.initializationState.type)r.initializationState.value.isMediaLinked.setValue(!0),a.onUpdate((t,n)=>{if("initialized"===t.initializationState.type)return n(),void i({mediaSource:e,drmSystemId:t.drmSystemId,unlinkMediaSource:s})},{emitCurrentValue:!0,clearSignal:n.signal});else if("initialized"===t.initializationState.type)return void i({mediaSource:e,drmSystemId:t.drmSystemId,unlinkMediaSource:s})}).catch(e=>{s.isUsed()||this._onFatalError(e)})},{emitCurrentValue:!0,clearSignal:n.signal})})}async _onInitialMediaSourceReady(e,t,n,i,r,a){var s;const{adaptiveOptions:o,autoPlay:l,bufferOptions:u,lowLatencyMode:c,segmentRequestOptions:d,speed:h,startAt:f,textTrackOptions:p,transport:g}=this._settings,m=this._initCanceller;let v;fe(null!==this._manifest);try{v=null!==(s=this._manifest.syncValue)&&void 0!==s?s:await this._manifest.getValueAsAsync()}catch(e){return}v.addEventListener("manifestUpdate",e=>{this.trigger("manifestUpdate",e)},m.signal),v.addEventListener("decipherabilityUpdate",e=>{this.trigger("decipherabilityUpdate",e)},m.signal),j.debug("Init: Calculating initial time");const y=ma(v,c,f);j.debug("Init: Initial time calculated:",y);const b=tt(o),S=M({textTrackOptions:p,drmSystemId:i},u),T=new Dn(g,d,m.signal);if(this.trigger("manifestReady",v),m.isUsed())return;const _=this._startBufferingOnMediaSource.bind(this),w=this.trigger.bind(this),E=this._onFatalError.bind(this);function x(t,i,a,s){const o={mediaElement:e,playbackObserver:n,mediaSource:t,initialTime:i,autoPlay:a,manifest:v,representationEstimator:b,segmentFetcherCreator:T,speed:h,protectionRef:r,bufferOptions:S};function l(t){if(s.cancel(),m.isUsed())return;if(w("reloadingMediaSource",t),m.isUsed())return;const n=new me;n.linkToSignal(m.signal),ga(e,n.signal).then(e=>{x(e,t.position,t.autoPlay,n)}).catch(e=>{n.isUsed()||E(e)})}_(o,l,s.signal)}x(t,y,l,a)}_startBufferingOnMediaSource(e,t,n){var i;const{autoPlay:r,bufferOptions:a,initialTime:s,manifest:o,mediaElement:l,mediaSource:u,playbackObserver:c,protectionRef:d,representationEstimator:h,segmentFetcherCreator:f,speed:p}=e,g=null!==(i=o.getPeriodForTime(s))&&void 0!==i?i:o.getNextPeriod(s);if(void 0===g){const e=new ut("MEDIA_STARTING_TIME_NOT_FOUND","Wanted starting time not found in the Manifest.");return this._onFatalError(e)}let m=null,v=null;if("html"===this._settings.textTrackOptions.textTrackMode&&null!==$t.htmlTextDisplayer?v=new $t.htmlTextDisplayer(l,this._settings.textTrackOptions.textTrackElement):null!==$t.nativeTextDisplayer&&(v=new $t.nativeTextDisplayer(l)),null!==v){const e=new Aa(v);m=e,n.register(()=>{e.stop(),null===v||void 0===v||v.stop()})}const y=new si(u,"VIDEO"===l.nodeName,m);n.register(()=>{y.disposeAll()});const{autoPlayResult:b,initialPlayPerformed:S}=Ea({mediaElement:l,playbackObserver:c,startTime:s,mustAutoPlay:r,onWarning:e=>{this.trigger("warning",e)},isDirectfile:!1},n);if(n.isCancelled())return;S.onUpdate((e,t)=>{if(e){t();const e=new Va(o,l,c);o.addEventListener("manifestUpdate",()=>{e.onManifestUpdate(o)},n),e.addEventListener("event",e=>{this.trigger("streamEvent",e)},n),e.addEventListener("eventSkip",e=>{this.trigger("streamEventSkip",e)},n),e.start(),n.register(()=>{e.stop()})}},{clearSignal:n,emitCurrentValue:!0});const T=cr(c,{autoPlay:r,manifest:o,mediaSource:u,textDisplayer:v,initialPlayPerformed:S,speed:p},n),_=this._createRebufferingController(c,o,p,n),w=new Bn(y);A&&o.addEventListener("decipherabilityUpdate",e=>{e.some(e=>!0!==e.representation.decipherable)&&C(0,void 0,void 0)},n),c.listen(e=>{if(w.needToReload(e)){let e;const n=c.getReference().getValue();e=n.position.isAwaitingFuturePosition()?n.position.getWanted():c.getCurrentTime();const i=S.getValue()?!c.getIsPaused():r;t({position:e,autoPlay:i})}},{clearSignal:n}),T.listen(e=>{["video","audio","text"].forEach(t=>{var n;const i=y.getStatus(t);"initialized"===i.type&&i.value.synchronizeInventory(null!==(n=e.buffered[t])&&void 0!==n?n:[])})},{clearSignal:n});const E=Fn(o,u,T,y,{onWarning:e=>this.trigger("warning",e),onPeriodChanged:e=>this.trigger("activePeriodChanged",{period:e})},n);b.then(()=>{Sa(c,l,!1,n).onUpdate((e,t)=>{e&&(t(),this.trigger("loaded",{getSegmentSinkMetrics:async()=>{return new Promise(e=>e(y.getSegmentSinksMetrics()))}}))},{emitCurrentValue:!0,clearSignal:n})}).catch(e=>{n.isCancelled()||this._onFatalError(e)});const x=this;function I(){return{needsBufferFlush:e=>{var t;let i;const r=c.getCurrentTime(),a=null!==(t=null===e||void 0===e?void 0:e.relativeResumingPosition)&&void 0!==t?t:0,s=Boolean(null===e||void 0===e?void 0:e.relativePosHasBeenDefaulted);i=0===a&&s?r+.001:r+a,c.setCurrentTime(i),c.listen((e,t)=>{(null!==e.currentRange||e.position.getPolled()>i+.1)&&(t(),c.setCurrentTime(e.position.getWanted()+.001))},{includeLastObservation:!1,clearSignal:n})},streamStatusUpdate(e){const{period:t,bufferType:i,imminentDiscontinuity:r,position:a}=e;if(_.updateDiscontinuityInfo({period:t,bufferType:i,discontinuity:r,position:a}),!n.isCancelled()&&o.isLastPeriodKnown&&e.period.id===o.periods[o.periods.length-1].id){const t=e.hasFinishedLoading||e.isEmptyStream;t?E.onLastSegmentFinishedLoading(e.bufferType):E.onLastSegmentLoadingResume(e.bufferType)}},needsManifestRefresh:()=>x._manifestFetcher.scheduleManualRefresh({enablePartialRefresh:!0,canUseUnsafeMode:!0}),manifestMightBeOufOfSync:()=>{const{OUT_OF_SYNC_MANIFEST_REFRESH_DELAY:e}=N.getCurrent();x._manifestFetcher.scheduleManualRefresh({enablePartialRefresh:!1,canUseUnsafeMode:!1,delay:e})},lockedStream:e=>_.onLockedStream(e.bufferType,e.period),adaptationChange:e=>{x.trigger("adaptationChange",e),n.isCancelled()||E.onAdaptationChange(e.type,e.period,e.adaptation)},representationChange:e=>{x.trigger("representationChange",e),n.isCancelled()||E.onRepresentationChange(e.type,e.period)},inbandEvent:e=>x.trigger("inbandEvents",e),warning:e=>x.trigger("warning",e),periodStreamReady:e=>x.trigger("periodStreamReady",e),periodStreamCleared:e=>{E.onPeriodCleared(e.type,e.period),n.isCancelled()||x.trigger("periodStreamCleared",e)},bitrateEstimateChange:e=>x.trigger("bitrateEstimateChange",e),needsMediaSourceReload:e=>{C(e.timeOffset,e.minimumPosition,e.maximumPosition)},needsDecipherabilityFlush(){var e,n,i,r;const a=or(l);if(k(null===a||void 0===a?void 0:a[0])){const r=T.getReference().getValue(),a=r.position.isAwaitingFuturePosition()?r.position.getWanted():null!==(e=T.getCurrentTime())&&void 0!==e?e:r.position.getPolled(),s=null!==(i=null!==(n=r.paused.pending)&&void 0!==n?n:T.getIsPaused())&&void 0!==i?i:r.paused.last;t({position:a,autoPlay:!s})}else{const e=T.getReference().getValue(),t=e.position.isAwaitingFuturePosition()?e.position.getWanted():null!==(r=T.getCurrentTime())&&void 0!==r?r:e.position.getPolled();t+.001<e.duration?c.setCurrentTime(l.currentTime+.001):c.setCurrentTime(t)}},encryptionDataEncountered:e=>{for(const t of e)if(d.setValue(t),n.isCancelled())return},error:e=>x._onFatalError(e)}}function C(e,n,i){var r,a,s;const o=T.getReference().getValue(),l=o.position.isAwaitingFuturePosition()?o.position.getWanted():null!==(r=T.getCurrentTime())&&void 0!==r?r:o.position.getPolled(),u=null!==(s=null!==(a=o.paused.pending)&&void 0!==a?a:T.getIsPaused())&&void 0!==s?s:o.paused.last;let c=l+e;void 0!==n&&(c=Math.max(n,c)),void 0!==i&&(c=Math.min(i,c)),t({position:c,autoPlay:!u})}nr({manifest:o,initialPeriod:g},T,h,y,f,a,I(),n)}_createRebufferingController(e,t,n,i){const r=new Ia(e,t,n);return r.addEventListener("stalled",e=>this.trigger("stalled",e)),r.addEventListener("unstalled",()=>this.trigger("unstalled",null)),r.addEventListener("warning",e=>this.trigger("warning",e)),i.register(()=>r.destroy()),r.start(),r}}function Ha(e,t,n,i){e.updateRepresentationsDeciperability(e=>{const{representation:r}=e;if(void 0===r.contentProtections)return r.decipherable;const a=r.contentProtections.keyIds;if(void 0!==a)for(const s of a){for(const e of n)if(yt(e,s.keyId))return!1;for(const e of t)if(yt(e,s.keyId))return!0;for(const e of i)if(yt(e,s.keyId))return}return r.decipherable})}function za(e,t){e.updateRepresentationsDeciperability(e=>{var n,i;const r=e.representation;if(!1===r.decipherable)return!1;const a=null!==(i=null===(n=r.contentProtections)||void 0===n?void 0:n.initData)&&void 0!==i?i:[];for(const s of a)if(void 0===t.type||s.type===t.type){const e=t.values.getFormattedValues().every(e=>{return s.values.some(t=>{return(void 0===e.systemId||t.systemId===e.systemId)&&yt(t.data,e.data)})});if(e)return!1}return r.decipherable})}var Ka=n("01e1");const $a=200,Wa=new Map;function qa(e){if(r(gr))return Ka["a"]&&j.error("Compat: Cannot request codec support in a worker without MSE."),!1;if("function"===typeof gr.isTypeSupported){const t=Wa.get(e);if(void 0!==t)return t;{const t=gr.isTypeSupported(e);return Wa.size>=$a&&Wa.clear(),Wa.set(e,t),t}}return!0}const Ya=50;class Xa{constructor(){this._cachedCodecSupport=new Map}isSupported(e,t){const n=`${null!==e&&void 0!==e?e:""};codecs="${null!==t&&void 0!==t?t:""}"`,i=this._cachedCodecSupport.get(n);if(void 0!==i)return i;this._cachedCodecSupport.size>=Ya&&this._cachedCodecSupport.clear();const r=qa(n);return this._cachedCodecSupport.set(n,r),r}}const Qa=new Xa;var Za=Qa;function Ja(e,t){let n=e;for(const i of t){const e=es(n,i);if(null===e)return null;n=e}return n}function es(e,t){const n=is(e,t);return null!==n?e.subarray(n[1],n[2]):null}function ts(e,t){const n=[];let i=e;while(1){const e=is(i,t);if(null===e)return n;fe(0!==e[2]&&0!==i.length),n.push(i.subarray(e[1],e[2])),i=i.subarray(e[2])}}function ns(e,t){const n=is(e,t);return null!==n?e.subarray(n[0],n[2]):null}function is(e,t){const n=e.length;let i,r,a=0,s=0;while(a+8<=n){if(r=a,s=Hr(e,r),r+=4,i=Hr(e,r),r+=4,0===s)s=n-a;else if(1===s){if(r+8>n)return null;s=zr(e,r),r+=8}if(s<0)throw new Error("ISOBMFF: Size out of range");if(i===t)return 1970628964===t&&(r+=16),[a,r,a+s];a+=s}return null}function rs(e,t,n,i,r){const a=e.length;let s;for(let o=0;o<a;o+=s){let l=o;s=Hr(e,l),l+=4;const u=Hr(e,l);if(l+=4,0===s)s=a-o;else if(1===s){if(l+8>a)return;s=zr(e,l),l+=8}if(1970628964===u&&l+16<=a&&Hr(e,l)===t&&Hr(e,l+4)===n&&Hr(e,l+8)===i&&Hr(e,l+12)===r)return l+=16,e.subarray(l,o+s)}}function as(e){const t=e.length;if(t<8)return j.warn("ISOBMFF: box inferior to 8 bytes, cannot find offsets"),null;let n=0,i=Hr(e,n);n+=4;const r=Hr(e,n);if(n+=4,0===i)i=t;else if(1===i){if(n+8>t)return j.warn("ISOBMFF: box too short, cannot find offsets"),null;i=zr(e,n),n+=8}if(i<0)throw new Error("ISOBMFF: Size out of range");return 1970628964===r&&(n+=16),[0,n,i]}function ss(e){const t=es(e,1836019558);return null===t?null:es(t,1953653094)}function os(e){const t=ts(e,1836019558);return t.reduce((e,t)=>{const n=es(t,1953653094);return null!==n&&e.push(n),e},[])}function ls(e){return es(e,1835295092)}function us(e){const t=es(e,1836019574);if(null===t)return null;const n=es(t,1953653099);return null===n?null:es(n,1835297121)}function cs(e,t=0){return es(e.subarray(t),1701671783)}const ds=/^(?:[a-z]+:)?\/\//i,hs=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/;function fs(e){const t=e.lastIndexOf("/");if(t<0)return e.length;if(ds.test(e)){const n=e.indexOf("/");if(n>=0&&t===n+1)return e.length}const n=e.indexOf("?");return n>=0&&n<t?fs(e.substring(0,n)):t+1}function ps(e,t){const n=vs(e),i=vs(t);if(i.scheme)return ys(i);const r={scheme:n.scheme,authority:n.authority,path:"",query:i.query,fragment:i.fragment};return i.authority?(r.authority=i.authority,r.path=bs(i.path),ys(r)):(""===i.path?(r.path=n.path,i.query||(r.query=n.query)):ji(i.path,"/")?r.path=bs(i.path):r.path=bs(Ss(n,i.path)),ys(r))}const gs=new Map,ms=200;function vs(e){var t,n,i,r,a;if(gs.has(e))return gs.get(e);const s=e.match(hs);let o;return o=null===s?{scheme:"",authority:"",path:"",query:"",fragment:""}:{scheme:null!==(t=s[1])&&void 0!==t?t:"",authority:null!==(n=s[2])&&void 0!==n?n:"",path:null!==(i=s[3])&&void 0!==i?i:"",query:null!==(r=s[4])&&void 0!==r?r:"",fragment:null!==(a=s[5])&&void 0!==a?a:""},gs.size>=ms&&gs.clear(),gs.set(e,o),o}function ys(e){let t="";return e.scheme&&(t+=e.scheme+":"),e.authority&&(t+="//"+e.authority),t+=e.path,e.query&&(t+="?"+e.query),e.fragment&&(t+="#"+e.fragment),t}function bs(e){const t=e.split(/(?=\/)/),n=[];for(let i=0;i<t.length;i++){const e=t[i];".."!==e&&"."!==e&&""!==e&&("/.."!==e?"/."!==e?n.push(e):i===t.length-1&&n.push("/"):(n.pop(),i===t.length-1&&n.push("/")))}return n.join("")}function Ss(e,t){if(e.authority&&""===e.path)return"/"+t;const n=e.path;return n.substring(0,n.lastIndexOf("/")+1)+t}function Ts(...e){var t,n,i;const r=e.filter(e=>""!==e),a=r.length;if(0===a)return"";if(1===a)return null!==(t=r[0])&&void 0!==t?t:"";{const e=null!==(n=r[0])&&void 0!==n?n:"",t=null!==(i=r[1])&&void 0!==i?i:"",a=ps(e,t),s=r.slice(2);return Ts(a,...s)}}var _s=Ts;const ws="object"===typeof s["a"]&&"function"===typeof s["a"].TextDecoder,Es="object"===typeof s["a"]&&"function"===typeof s["a"].TextEncoder;function xs(e){const t=new ArrayBuffer(2*e.length),n=new Uint8Array(t);for(let i=0;i<n.length;i+=2){const t=e.charCodeAt(i/2);n[i]=255&t,n[i+1]=t>>8&255}return n}function As(e){if(ws)try{const t=new TextDecoder("utf-16le");return t.decode(e)}catch(e){const t=e instanceof Error?e:"";j.warn("Utils: could not use TextDecoder to parse UTF-16LE, fallbacking to another implementation",t)}let t="";for(let n=0;n<e.length;n+=2)t+=String.fromCharCode((e[n+1]<<8)+e[n]);return t}function ks(e){if(Es)try{const t=new TextEncoder;return t.encode(e)}catch(e){const t=e instanceof Error?e:"";j.warn("Utils: could not use TextEncoder to encode string into UTF-8, fallbacking to another implementation",t)}let t;const n=encodeURIComponent(e);if("function"===typeof unescape)t=unescape(n);else{const e=/[0-9a-fA-F]/,i=n.length;t="";for(let r=0;r<n.length;r++){let a=!1;if("%"===n[r])if(r<=i-6&&"u"===n[r+1]&&e.test(n[r+2])&&e.test(n[r+3])&&e.test(n[r+4])&&e.test(n[r+5])){const e=parseInt(n.substring(r+1,r+6),16);t+=String.fromCharCode(e),a=!0,r+=5}else if(r<=i-3&&e.test(n[r+1])&&e.test(n[r+2])){const e=parseInt(n.substring(r+1,r+3),16);t+=String.fromCharCode(e),a=!0,r+=2}a||(t+=n[r])}}const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=255&t.charCodeAt(r);return i}function Is(e){const t=16e3;let n="";for(let i=0;i<e.length;i+=t){const r=e.subarray(i,i+t);n+=String.fromCharCode.apply(null,r)}return n}function Cs(e,t){const n=e.toString(16);return n.length>=t?n:new Array(t-n.length+1).join("0")+n}function Rs(e){if(ws)try{const t=new TextDecoder;return t.decode(e)}catch(e){const t=e instanceof Error?e:"";j.warn("Utils: could not use TextDecoder to parse UTF-8, fallbacking to another implementation",t)}let t=e;239===t[0]&&187===t[1]&&191===t[2]&&(t=t.subarray(3));const n=Is(t);let i;if("function"===typeof escape)i=escape(n);else{const e=/[A-Za-z0-9*_\+-\.\/]/;i="";for(let t=0;t<n.length;t++)if(e.test(n[t]))i+=n[t];else{const e=n.charCodeAt(t);i+=e>=256?"%u"+Cs(e,4):"%"+Cs(e,2)}}return decodeURIComponent(i)}function Ms(e){const t=e.length,n=new Uint8Array(t/2);for(let i=0,r=0;i<t;i+=2,r++)n[r]=255&parseInt(e.substring(i,i+2),16);return n}function Ds(e,t=""){let n="";for(let i=0;i<e.byteLength;i++)n+=(e[i]>>>4).toString(16),n+=(15&e[i]).toString(16),t.length>0&&i<e.byteLength-1&&(n+=t);return n}function Ls(e){fe(16===e.length,"GUID length should be 16");const t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=new Uint8Array(16);return u[0]=r,u[1]=i,u[2]=n,u[3]=t,u[4]=s,u[5]=a,u[6]=l,u[7]=o,u.set(e.subarray(8,16),8),u}function Ps(e,t){let n=t;while(n<e.length){const t=e[n];if(0===t)break;n+=1}const i=e.subarray(t,n);return{end:n+1,string:Rs(i)}}const Os=Math.pow(2,32)-1,Ns={};function Us(e){if(void 0!==Ns[e])return Ns[e];const t=ks(e);return Ns[e]=t,t}function Fs(e,t){const n=t.length+8;return n<=Os?Vr($r(n),Us(e),t):Vr($r(1),Us(e),Wr(n+8),t)}function Bs(e,t){return Fs(e,Vr(...t))}function Vs(e){const t=[];e.periods.forEach(n=>{const i=n.id;if(gt(t,i)){j.warn("Two periods with the same ID found. Updating.");const r=i+"-dup";n.id=r,Vs(e),t.push(r)}else t.push(i);const{adaptations:r}=n,a=[];Object.keys(r).forEach(t=>{const n=r[t];void 0!==n&&n.forEach(t=>{const n=t.id;if(gt(a,n)){j.warn("Two adaptations with the same ID found. Updating.",n);const i=n+"-dup";t.id=i,Vs(e),a.push(i)}else a.push(n);const i=[];t.representations.forEach(t=>{const n=t.id;if(gt(i,n)){j.warn("Two representations with the same ID found. Updating.",n);const r=`${n}-dup`;t.id=r,Vs(e),i.push(r)}else i.push(n)})})})})}function js(e,t){let n;return n="AACH"===t?5:Ot(e)?(248&parseInt(e.substring(0,2),16))>>3:2,0===n?"mp4a.40.2":`mp4a.40.${n}`}function Gs(e){const t=/00000001\d7([0-9a-fA-F]{6})/.exec(e);return null!==t&&Ot(t[1])?"avc1."+t[1]:"avc1.4D401E"}function Hs(e){return e.reduce((t,n,i)=>{const r=n.getAttribute("d"),a=n.getAttribute("t"),s=n.getAttribute("r"),o=null!==s?+s-1:0;let l=null!==a?+a:void 0,u=null!==r?+r:void 0;if(0===i)l=void 0===l||isNaN(l)?0:l;else{const e=t[i-1];if(void 0===l||isNaN(l)){if(void 0===e.duration||isNaN(e.duration))throw new Error("Smooth: Invalid CNodes. Missing timestamp.");l=e.start+e.duration*(e.repeatCount+1)}}if(void 0===u||isNaN(u)){const n=e[i+1];if(void 0===n)return t;{const e=n.getAttribute("t"),t=Ot(e)?+e:null;if(null===t)throw new Error("Can't build index timeline from Smooth Manifest.");u=t-l}}return t.push({duration:u,start:l,repeatCount:o}),t},[])}const zs=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],Ks=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];function $s(e){if(e>=Ks.length)throw new Error("Unable to parse base64 string.");const t=Ks[e];if(255===t)throw new Error("Unable to parse base64 string.");return t}function Ws(e){let t,n="";const i=e.length;for(t=2;t<i;t+=3)n+=zs[e[t-2]>>2],n+=zs[(3&e[t-2])<<4|e[t-1]>>4],n+=zs[(15&e[t-1])<<2|e[t]>>6],n+=zs[63&e[t]];return t===i+1&&(n+=zs[e[t-2]>>2],n+=zs[(3&e[t-2])<<4],n+="=="),t===i&&(n+=zs[e[t-2]>>2],n+=zs[(3&e[t-2])<<4|e[t-1]>>4],n+=zs[(15&e[t-1])<<2],n+="="),n}function qs(e){const t=e.length%4;let n=e;0!==t&&(j.warn("base64ToBytes: base64 given miss padding"),n+=3===t?"=":2===t?"==":"===");const i=n.indexOf("=");if(-1!==i&&i<n.length-2)throw new Error("Unable to parse base64 string.");const r=n.endsWith("==")?2:n.endsWith("=")?1:0,a=n.length,s=new Uint8Array(a/4*3);let o;for(let l=0,u=0;l<a;l+=4,u+=3)o=$s(n.charCodeAt(l))<<18|$s(n.charCodeAt(l+1))<<12|$s(n.charCodeAt(l+2))<<6|$s(n.charCodeAt(l+3)),s[u]=o>>16,s[u+1]=o>>8&255,s[u+2]=255&o;return s.subarray(0,s.length-r)}function Ys(e){const t=qr(e,8),n=As(e.subarray(10,t+10)),i=(new DOMParser).parseFromString(n,"application/xml"),r=i.querySelector("KID");if(null===r)throw new Error("Cannot parse PlayReady private data: invalid XML");const a=null===r.textContent?"":r.textContent,s=Ls(qs(a));return Ds(s).toLowerCase()}function Xs(e){return[{systemId:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",privateData:Vr([8,1,18,16],e)}]}function Qs(e,t=Xs){if(null===e.firstElementChild||"ProtectionHeader"!==e.firstElementChild.nodeName)throw new Error("Protection should have ProtectionHeader child");const n=e.firstElementChild,i=qs(null===n.textContent?"":n.textContent),r=Ys(i),a=Ms(r),s=n.getAttribute("SystemID"),o=(null!==s?s:"").toLowerCase().replace(/\{|\}/g,"");return{keyId:a,keySystems:[{systemId:o,privateData:i}].concat(t(a))}}function Zs(e,t,n){const{repeatCount:i}=e;if(i>=0)return i;let a;return a=r(t)?void 0!==n?n:Number.MAX_VALUE:t.start,Math.ceil((a-e.start)/e.duration)-1}function Js(e,t,n){const{start:i,duration:r}=e;if(r<=0)return i;const a=Zs(e,t,n);return i+(a+1)*r}function eo(e,t){var n;return e*t.timescale+(null!==(n=t.indexTimeOffset)&&void 0!==n?n:0)}function to(e,t){var n;return(e-(null!==(n=t.indexTimeOffset)&&void 0!==n?n:0))/t.timescale}function no(e,t,n){return[e*n,(e+t)*n]}function io(e,t){let n=0,i=e.length;while(n<i){const r=n+i>>>1;e[r].start<=t?n=r+1:i=r}return n-1}function ro(e,t,n){const{timeline:i}=e,r=eo(t,e);if(r<0)return null;const a=io(i,r);if(a<0||a>=i.length-1)return null;const s=i[a];if(s.duration<=0)return null;const o=i[a+1];if(void 0===o)return null;const l=o.start,u=Js(s,o,n);return r>=u&&r<l?to(l,e):null}function ao(e,t,n){return e.replace(/\{bitrate\}/g,String(t)).replace(/{CustomAttributes}/g,n.length>0?n[0]:"")}function so(e,t){return e.replace(/\{start time\}/g,String(t))}function oo(e,t,n){const i=t-e;return i>0?Math.floor(i/n):0}function lo(e,t,n){const i=void 0===e||0===e?1:e;return{up:t*i,to:(t+n)*i}}function uo(e,t){let n=e.repeatCount;if(void 0!==e.duration&&n<0){const i=void 0!==t?t.start:1/0;n=Math.ceil((i-e.start)/e.duration)-1}return n}class co{constructor(e){const{isLive:t,segmentPrivateInfos:n,media:i,sharedSmoothTimeline:r}=e;if(this._sharedSmoothTimeline=r,this._initSegmentInfos={bitsPerSample:n.bitsPerSample,channels:n.channels,codecPrivateData:n.codecPrivateData,packetSize:n.packetSize,samplingRate:n.samplingRate,timescale:r.timescale,height:n.height,width:n.width,protection:n.protection},this._isLive=t,this._media=i,0!==r.timeline.length&&t){const{timeline:e,validityTime:t}=r,n=e[e.length-1],i=Js(n,null),a=t/1e3*r.timescale;this._scaledLiveGap=a-i}}getInitSegment(){return{id:"init",isInit:!0,privateInfos:{smoothInitSegment:this._initSegmentInfos},url:null,time:0,end:0,duration:0,timescale:1,complete:!0}}getSegments(e,t){this._refreshTimeline();const{timescale:n,timeline:i}=this._sharedSmoothTimeline,{up:r,to:a}=lo(n,e,t),s=this._media;let o;const l=[],u=i.length,c=void 0===this._scaledLiveGap?void 0:_e()/1e3*n-this._scaledLiveGap;for(let d=0;d<u;d++){const e=i[d],{duration:t,start:u}=e,h=uo(e,i[d+1]);let f=oo(u,r,t),p=u+f*t;const g=t;while(p<a&&f<=h&&(void 0===c||p+g<=c)){const e=p,i=void 0!==o?o+f:void 0,r={id:String(p),isInit:!1,time:e/n,end:(e+t)/n,duration:t/n,timescale:1,number:i,url:so(s,e),complete:!0,privateInfos:{smoothMediaSegment:{time:e,duration:t}}};l.push(r),f++,p=u+f*t}if(p>=a)return l;void 0!==o&&(o+=h+1)}return l}shouldRefresh(e,t){if(this._refreshTimeline(),!this._isLive)return!1;const{timeline:n,timescale:i}=this._sharedSmoothTimeline,r=n[n.length-1];if(void 0===r)return!1;const a=r.repeatCount,s=r.start+(a+1)*r.duration;if(t*i<s)return!1;if(e*i>=s)return!0;const o=r.start+a*r.duration;return e*i>o}getFirstAvailablePosition(){this._refreshTimeline();const{timeline:e,timescale:t}=this._sharedSmoothTimeline;return 0===e.length?null:e[0].start/t}getLastAvailablePosition(){this._refreshTimeline();const{timeline:e,timescale:t}=this._sharedSmoothTimeline;if(void 0===this._scaledLiveGap){const n=e[e.length-1];return Js(n,null)/t}for(let n=e.length-1;n>=0;n--){const i=e[n],r=_e()/1e3*t,{start:a,duration:s,repeatCount:o}=i;for(let e=o;e>=0;e--){const n=a+s*(e+1),i=n;if(i<=r-this._scaledLiveGap)return n/t}}}getEnd(){if(!this._isLive)return this.getLastAvailablePosition()}awaitSegmentBetween(e,t){var n;if(fe(e<=t),this.isStillAwaitingFutureSegments())return!1;const i=this.getLastAvailablePosition();return!(void 0!==i&&t<i)&&(t>(null!==(n=this.getFirstAvailablePosition())&&void 0!==n?n:0)&&void 0)}checkDiscontinuity(e){return this._refreshTimeline(),ro(this._sharedSmoothTimeline,e,void 0)}isSegmentStillAvailable(e){if(e.isInit)return!0;this._refreshTimeline();const{timeline:t,timescale:n}=this._sharedSmoothTimeline;for(let i=0;i<t.length;i++){const r=t[i],a=r.start/n;if(a>e.time)return!1;if(a===e.time)return!0;if(r.repeatCount>=0&&void 0!==r.duration){const e=a-r.start,t=e/r.duration-1;return t%1===0&&t<=r.repeatCount}}return!1}canBeOutOfSyncError(e){return!!this._isLive&&(e instanceof ct&&(e.isHttpError(404)||e.isHttpError(412)))}_replace(e){this._initialScaledLastPosition=e._initialScaledLastPosition,this._scaledLiveGap=e._scaledLiveGap,this._sharedSmoothTimeline.replace(e._sharedSmoothTimeline)}_update(e){this._scaledLiveGap=e._scaledLiveGap,this._sharedSmoothTimeline.update(e._sharedSmoothTimeline)}isStillAwaitingFutureSegments(){return this._isLive}isInitialized(){return!0}initialize(){j.error("A `SmoothRepresentationIndex` does not need to be initialized")}addPredictedSegments(e,t){this._sharedSmoothTimeline.addPredictedSegments(e,t)}_refreshTimeline(){this._sharedSmoothTimeline.refresh()}}function ho(e,t){let n=0;while(e.length>0){const i=e[0];if(i.start>=t)return n;if(-1===i.repeatCount)return n;if(0===i.repeatCount)e.shift(),n+=1;else{const r=e[1];if(void 0!==r&&r.start<=t)e.shift(),n+=1;else{if(i.duration<=0)return n;let r=i.start+i.duration,a=1;while(r<t&&a<=i.repeatCount)r+=i.duration,a++;if(!(a>i.repeatCount)){const e=i.repeatCount-a;return i.start=r,i.repeatCount=e,n+=a,n}e.shift(),n=i.repeatCount+1}}}return n}function fo(e,t){if(0===e.length)return e.push(...t),!0;if(0===t.length)return!1;const n=e.length,i=t[0].start,r=e[n-1],a=Js(r,t[0]);if(a<i)throw new ut("MANIFEST_UPDATE_ERROR","Cannot perform partial update: not enough data");for(let c=n-1;c>=0;c--){const r=e[c].start;if(r===i){const i=n-c;return e.splice(c,i,...t),!1}if(r<i){const r=e[c];if(r.start+r.duration>i)return j.warn("RepresentationIndex: Manifest update removed all previous segments"),e.splice(0,n,...t),!0;if(void 0===r.repeatCount||r.repeatCount<=0)return r.repeatCount<0&&(r.repeatCount=Math.floor((i-r.start)/r.duration)-1),e.splice(c+1,n-(c+1),...t),!1;const a=r.start+r.duration*(r.repeatCount+1);if(a<=i)return e.splice(c+1,n-(c+1),...t),!1;const s=(i-r.start)/r.duration-1;if(s%1===0&&r.duration===t[0].duration){const i=t[0].repeatCount<0?-1:t[0].repeatCount+s+1;return e.splice(c,n-c,...t),e[c].start=r.start,e[c].repeatCount=i,!1}return j.warn("RepresentationIndex: Manifest update removed previous segments"),e[c].repeatCount=Math.floor(s),e.splice(c+1,n-(c+1),...t),!1}}const s=e[e.length-1],o=t[t.length-1];if(void 0!==s.repeatCount&&s.repeatCount<0)return s.start>o.start?(j.warn("RepresentationIndex: The new index is older than the previous one"),!1):(j.warn('RepresentationIndex: The new index is "bigger" than the previous one'),e.splice(0,n,...t),!0);const l=s.start+s.duration*(s.repeatCount+1),u=o.start+o.duration*(o.repeatCount+1);return l>=u?(j.warn("RepresentationIndex: The new index is older than the previous one"),!1):(j.warn('RepresentationIndex: The new index is "bigger" than the previous one'),e.splice(0,n,...t),!0)}function po(e,t,n,i){const r=e.length,a=e[r-1],s=n.timescale===t?{time:n.time,duration:n.duration}:{time:n.time/n.timescale*t,duration:n.duration/n.timescale*t},o=i.time===s.time;return!o&&(s.time>=Js(a,null)&&(a.duration===s.duration?a.repeatCount++:e.push({duration:s.duration,start:s.time,repeatCount:0}),!0))}class go{constructor(e){const{timeline:t,timescale:n,timeShiftBufferDepth:i,manifestReceivedTime:r}=e;this.timeline=t,this.timescale=n;const a=null!==r&&void 0!==r?r:_e();if(this.validityTime=a,this._timeShiftBufferDepth=i,0!==t.length){const e=t[t.length-1],n=Js(e,null);this._initialScaledLastPosition=n}}refresh(){if(void 0===this._initialScaledLastPosition)return;const e=this._timeShiftBufferDepth,t=(_e()-this.validityTime)/1e3,n=t+this._initialScaledLastPosition/this.timescale;if(void 0!==e){const t=(n-e)*this.timescale;ho(this.timeline,t)}}replace(e){const t=this.timeline,n=e.timeline,i=this.timescale,r=e.timescale;if(this._initialScaledLastPosition=e._initialScaledLastPosition,this.validityTime=e.validityTime,0===t.length||0===n.length||i!==r)return;const a=t[t.length-1],s=n[n.length-1],o=Js(s,null);if(!(Js(a,null)<=o))for(let l=0;l<t.length;l++){const e=t[l],n=Js(e,null);if(n===o)return void(this.timeline=this.timeline.concat(t.slice(l+1)));if(n>o){if(e.duration!==s.duration)return;const n=o-e.start;if(0===n)return j.warn("Smooth Parser: a discontinuity detected in the previous manifest has been resolved."),void(this.timeline=this.timeline.concat(t.slice(l)));if(n<0||n%e.duration!==0)return;const i=n/e.duration-1,r=e.repeatCount-i;if(r<0)return;s.repeatCount+=r;const a=t.slice(l+1);return void(this.timeline=this.timeline.concat(a))}}}update(e){fo(this.timeline,e.timeline),this._initialScaledLastPosition=e._initialScaledLastPosition,this.validityTime=e.validityTime}addPredictedSegments(e,t){var n;if(void 0!==(null===(n=t.privateInfos)||void 0===n?void 0:n.smoothMediaSegment)){this.refresh();for(let n=0;n<e.length;n++)po(this.timeline,this.timescale,e[n],t.privateInfos.smoothMediaSegment)}else j.warn("Smooth Parser: should only encounter SmoothRepresentationIndex")}}function mo(e){return"boolean"===typeof e?e:"string"===typeof e&&"TRUE"===e.toUpperCase()}function vo(e,t,n){let i=e.firstElementChild,r=n;while(null!==i)r=t(r,i.nodeName,i),i=i.nextElementSibling;return r}const yo={audio:"audio/mp4",video:"video/mp4",text:"application/ttml+xml"},bo={AACL:"audio/mp4",AVC1:"video/mp4",H264:"video/mp4",TTML:"application/ttml+xml+mp4",DFXP:"application/ttml+xml+mp4"};function So(e={}){const t=void 0===e.referenceDateTime?Date.UTC(1970,0,1,0,0,0,0)/1e3:e.referenceDateTime,n=void 0===e.minRepresentationBitrate?0:e.minRepresentationBitrate,{serverSyncInfos:i}=e,a=void 0!==i?i.serverTimestamp-i.clientTime:void 0;function s(e,t){const n=vo(e,(e,t,n)=>{return"CustomAttributes"===t&&e.push(...vo(n,(e,t,n)=>{if("Attribute"===t){const t=n.getAttribute("Name"),i=n.getAttribute("Value");null!==t&&null!==i&&e.push(t+"="+i)}return e},[])),e},[]);function i(t){const n=e.getAttribute(t);return null===n?void 0:n}switch(t){case"audio":{const e=i("AudioTag"),t=i("BitsPerSample"),r=i("Channels"),a=i("CodecPrivateData"),s=i("FourCC"),o=i("PacketSize"),l=i("SamplingRate"),u=i("Bitrate");let c=void 0===u?0:parseInt(u,10);if(c=isNaN(c)?0:c,void 0!==s&&void 0===bo[s]||void 0===a)return j.warn("Smooth parser: Unsupported audio codec. Ignoring quality level."),null;const d=js(a,s);return{audiotag:void 0!==e?parseInt(e,10):e,bitrate:c,bitsPerSample:void 0!==t?parseInt(t,10):t,channels:void 0!==r?parseInt(r,10):r,codecPrivateData:a,codecs:d,customAttributes:n,mimeType:void 0!==s?bo[s]:s,packetSize:void 0!==o?parseInt(o,10):o,samplingRate:void 0!==l?parseInt(l,10):l}}case"video":{const e=i("CodecPrivateData"),t=i("FourCC"),r=i("MaxWidth"),a=i("MaxHeight"),s=i("Bitrate");let o=void 0===s?0:parseInt(s,10);if(o=isNaN(o)?0:o,void 0!==t&&void 0===bo[t]||void 0===e)return j.warn("Smooth parser: Unsupported video codec. Ignoring quality level."),null;const l=Gs(e);return{bitrate:o,customAttributes:n,mimeType:void 0!==t?bo[t]:t,codecPrivateData:e,codecs:l,width:void 0!==r?parseInt(r,10):void 0,height:void 0!==a?parseInt(a,10):void 0}}case"text":{const e=i("CodecPrivateData"),t=i("FourCC"),r=i("Bitrate");let a=void 0===r?0:parseInt(r,10);return a=isNaN(a)?0:a,{bitrate:a,customAttributes:n,mimeType:void 0!==t?bo[t]:t,codecPrivateData:null!==e&&void 0!==e?e:""}}default:return j.error("Smooth Parser: Unrecognized StreamIndex type: "+t),null}}function o(e){const{root:t,timescale:i,baseUrl:a,protections:o,timeShiftBufferDepth:l,manifestReceivedTime:u,isLive:c}=e,d=t.getAttribute("Timescale");let h=null===d?i:+d;isNaN(h)&&(h=i);const f=t.getAttribute("Type");if(null===f)throw new Error("StreamIndex without type.");gt(bt,f)||j.warn("Smooth Parser: Unrecognized adaptation type:",f);const p=f,g=t.getAttribute("Subtype"),m=t.getAttribute("Language"),v=t.getAttribute("Url"),y=null===v?"":v;const{qualityLevels:b,cNodes:S}=vo(t,(e,t,i)=>{switch(t){case"QualityLevel":const r=s(i,p);if(null===r)return e;("video"!==p||r.bitrate>n)&&e.qualityLevels.push(r);break;case"c":e.cNodes.push(i);break}return e},{qualityLevels:[],cNodes:[]}),T=new go({timeline:Hs(S),timescale:h,timeShiftBufferDepth:l,manifestReceivedTime:u});fe(0!==b.length,"Adaptation should have at least one playable representation.");const _=p+(Ot(m)?"_"+m:""),w=b.map(e=>{const t=ao(y,e.bitrate,e.customAttributes),n=Ot(e.mimeType)?e.mimeType:yo[p],i=e.codecs,s=_+"_"+(r(p)?"":p+"-")+(r(n)?"":n+"-")+(r(i)?"":i+"-")+String(e.bitrate),l=[];let u;o.length>0&&(u=o[0],o.forEach(e=>{const t=e.keyId;e.keySystems.forEach(e=>{l.push({keyId:t,systemId:e.systemId})})}));const d={bitsPerSample:e.bitsPerSample,channels:e.channels,codecPrivateData:e.codecPrivateData,packetSize:e.packetSize,samplingRate:e.samplingRate,height:e.height,width:e.width,protection:r(u)?void 0:{keyId:u.keyId}},h=new co({isLive:c,sharedSmoothTimeline:T,media:t,segmentPrivateInfos:d}),f=M({},e,{index:h,cdnMetadata:[{baseUrl:a}],mimeType:n,codecs:i,id:s});if(l.length>0||void 0!==u){const e=void 0===u?[]:u.keySystems.map(e=>{const{systemId:t,privateData:n}=e,i=t.replace(/-/g,""),r=To(i,n);return{systemId:i,data:r}});if(e.length>0){const t=[{type:"cenc",values:e}];f.contentProtections={keyIds:l,initData:t}}else f.contentProtections={keyIds:l,initData:[]}}return f});if("ADVT"===g)return null;const E={id:_,type:p,representations:w,language:null===m?void 0:m};return"text"===p&&"DESC"===g&&(E.closedCaption=!0),E}function l(n,i,s){let l="";if(void 0!==i){const e=fs(i);l=i.substring(0,e)}const u=n.documentElement;if(r(u)||"SmoothStreamingMedia"!==u.nodeName)throw new Error("document root should be SmoothStreamingMedia");const c=u.getAttribute("MajorVersion"),d=u.getAttribute("MinorVersion");if(null===c||null===d||!/^[2]-[0-2]$/.test(c+"-"+d))throw new Error("Version should be 2.0, 2.1 or 2.2");const h=u.getAttribute("Timescale");let f=Ot(h)?+h:1e7;isNaN(f)&&(f=1e7);const{protections:p,adaptationNodes:g}=vo(u,(t,n,i)=>{switch(n){case"Protection":t.protections.push(Qs(i,e.keySystems));break;case"StreamIndex":t.adaptationNodes.push(i);break}return t},{adaptationNodes:[],protections:[]}),m={},v=mo(u.getAttribute("IsLive"));let y;if(v){const e=u.getAttribute("DVRWindowLength");null===e||isNaN(+e)||0===+e||(y=+e/f)}const b=g.reduce((e,t)=>{const n=o({root:t,baseUrl:l,timescale:f,protections:p,isLive:v,timeShiftBufferDepth:y,manifestReceivedTime:s});if(null===n)return e;const i=n.type,r=e[i];return void 0===r?e[i]=[n]:r.push(n),e},m);let S,T,_,w,E=null;const x=void 0!==b.video?b.video[0]:void 0,A=void 0!==b.audio?b.audio[0]:void 0;let k,I,C;if(void 0!==x||void 0!==A){const e=[],t=[];if(void 0!==x){const n=x.representations[0];if(void 0!==n){const i=n.index.getFirstAvailablePosition(),a=n.index.getLastAvailablePosition();r(i)||e.push(i),r(a)||t.push(a)}}if(void 0!==A){const n=A.representations[0];if(void 0!==n){const i=n.index.getFirstAvailablePosition(),a=n.index.getLastAvailablePosition();r(i)||e.push(i),r(a)||t.push(a)}}e.length>0&&(k=Math.max(...e)),t.length>0&&(I=Math.min(...t),C=Math.max(...t))}const R=u.getAttribute("Duration"),M=null!==R&&0!==+R?+R/f:void 0;if(v){S=e.suggestedPresentationDelay,T=t,_=null!==k&&void 0!==k?k:T;let n=C;void 0===n&&(n=Date.now()/1e3-T);let i=I;void 0===i&&(i=n),w={isLinear:!0,maximumSafePosition:i,livePosition:n,time:_e()},E=null!==y&&void 0!==y?y:null}else{_=null!==k&&void 0!==k?k:0;let e=I;void 0===e&&(e=void 0!==M?_+M:1/0),w={isLinear:!1,maximumSafePosition:e,livePosition:void 0,time:_e()}}const D=v?0:_,L=v?void 0:w.maximumSafePosition,P={availabilityStartTime:void 0===T?0:T,clockOffset:a,isLive:v,isDynamic:v,isLastPeriodKnown:!0,timeBounds:{minimumSafePosition:_,timeshiftDepth:E,maximumTimeData:w},periods:[{adaptations:b,duration:void 0!==L?L-D:M,end:L,id:"gen-smooth-period-0",start:D}],suggestedPresentationDelay:S,transportType:"smooth",uris:r(i)?[]:[i]};return Vs(P),P}return l}function To(e,t){if(32!==e.length)throw new Error("HSS: wrong system id length");const n=0;return Fs("pssh",Vr([n,0,0,0],Ms(e),$r(t.length),t))}var _o=So,wo=_o;const Eo="json";function xo(e){const t={url:e.url,headers:e.headers,responseType:r(e.responseType)?Eo:e.responseType,timeout:e.timeout,connectionTimeout:e.connectionTimeout};return new Promise((n,i)=>{const{onProgress:a,cancelSignal:s}=e,{url:o,headers:l,responseType:u,timeout:c,connectionTimeout:d}=t,h=new XMLHttpRequest;let f,p;if(h.open("GET",o,!0),void 0!==c&&(h.timeout=c,f=setTimeout(()=>{v(),i(new nt(o,h.status,it.TIMEOUT))},c+3e3)),void 0!==d&&(p=setTimeout(()=>{v(),h.readyState!==XMLHttpRequest.DONE&&h.abort(),i(new nt(o,h.status,it.TIMEOUT))},d)),h.responseType=u,"document"===h.responseType&&h.overrideMimeType("text/xml"),!r(l)){const e=l;for(const t in e)e.hasOwnProperty(t)&&h.setRequestHeader(t,e[t])}const g=_e();let m=null;if(void 0===s||(m=s.register(function(e){v(),h.readyState!==XMLHttpRequest.DONE&&h.abort(),i(e)}),!s.isCancelled())){if(h.onerror=function(){v(),i(new nt(o,h.status,it.ERROR_EVENT))},h.ontimeout=function(){v(),i(new nt(o,h.status,it.TIMEOUT))},void 0!==d&&(h.onreadystatechange=function(){h.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&clearTimeout(p)}),void 0!==a&&(h.onprogress=function(e){const t=_e();a({url:o,duration:t-g,sendingTime:g,currentTime:t,size:e.loaded,totalSize:e.total})}),h.onload=function(e){if(h.readyState===XMLHttpRequest.DONE)if(v(),h.status>=200&&h.status<300){const t=_e(),a=h.response instanceof ArrayBuffer?h.response.byteLength:e.total,s=h.status,l=h.responseType,u=Ot(h.responseURL)?h.responseURL:o;let c;if(c="json"===l?"object"===typeof h.response?h.response:Ao(h.responseText):h.response,r(c))return void i(new nt(o,h.status,it.PARSE_ERROR));n({status:s,url:u,responseType:l,sendingTime:g,receivedTime:t,requestDuration:t-g,size:a,responseData:c})}else i(new nt(o,h.status,it.ERROR_HTTP_CODE))},j.hasLevel("DEBUG")){let t="XHR: Sending GET "+o;void 0!==e.responseType&&(t+=" type="+e.responseType),void 0!==c&&(t+=" to="+String(c/1e3)),void 0!==d&&(t+=" cto="+String(d/1e3)),void 0!==(null===l||void 0===l?void 0:l.Range)&&(t+=" Range="+(null===l||void 0===l?void 0:l.Range)),j.debug(t)}h.send()}function v(){void 0!==f&&clearTimeout(f),void 0!==p&&clearTimeout(p),null!==m&&m()}})}function Ao(e){try{return JSON.parse(e)}catch(e){return null}}var ko=xo;function Io(e,t){const n=e.length;let i=0;while(i+8<=n){let r=Hr(e,i);if(0===r)r=n-i;else if(1===r){if(i+16>n)return-1;r=zr(e,i+8)}if(isNaN(r)||r<=0)return-1;const a=Hr(e,i+4);if(a===t)return i+r<=n?i:-1;i+=r}return-1}function Co(e,t){if(t){const t=Io(e,1718909296);if(t<0)throw new dt("INTEGRITY_ERROR","Incomplete `ftyp` box");const n=Io(e,1836019574);if(n<0)throw new dt("INTEGRITY_ERROR","Incomplete `moov` box")}else{const t=Io(e,1836019558);if(t<0)throw new dt("INTEGRITY_ERROR","Incomplete `moof` box");const n=Io(e,1835295092);if(n<0)throw new dt("INTEGRITY_ERROR","Incomplete `mdat` box")}}function Ro(e,t){return(n,i,r)=>{return new Promise((a,s)=>{const o=Date.now()-_e();let l=!1;const u=e=>{if(l||r.isCancelled())return;l=!0,r.deregister(p);const t=void 0!==e.receivingTime?e.receivingTime-o:void 0,n=void 0!==e.sendingTime?e.sendingTime-o:void 0;a({responseData:e.data,size:e.size,requestDuration:e.duration,url:e.url,receivedTime:t,sendingTime:n})},c=e=>{var t,n;if(l||r.isCancelled())return;l=!0,r.deregister(p);const i=e,a=null!==(t=null===i||void 0===i?void 0:i.message)&&void 0!==t?t:"Unknown error when fetching the Manifest through a custom manifestLoader.",o=new ln(a,null!==(n=null===i||void 0===i?void 0:i.canRetry)&&void 0!==n&&n,null===i||void 0===i?void 0:i.xhr);s(o)},d=()=>{l||r.isCancelled()||(l=!0,r.deregister(p),t(n,i,r).then(a,s))},h={reject:c,resolve:u,fallback:d},f=e({url:n,timeout:i.timeout},h);function p(e){l||(l=!0,"function"===typeof f&&f(),s(e))}r.register(p)})}}function Mo(e){return function(t,n,i){if(void 0===t)throw new Error("Cannot perform HTTP(s) request. URL not known");switch(e){case"arraybuffer":return ko({url:t,responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i});case"text":return ko({url:t,responseType:"text",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i});case"document":return ko({url:t,responseType:"document",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i});default:ge(e)}}}function Do({customManifestLoader:e},t){const n=Mo(t);return"function"!==typeof e?n:Ro(e,n)}function Lo(e,t){const n=is(e,1936286840);if(null===n)return null;let i=t;const r=n[2]-n[0];let a=n[1];const s=e[a];a+=8;const o=Hr(e,a);let l;if(a+=4,0===s)l=Hr(e,a),a+=4,i+=Hr(e,a)+r,a+=4;else{if(1!==s)return null;l=zr(e,a),a+=8,i+=zr(e,a)+r,a+=8}const u=[];a+=2;let c=jr(e,a);a+=2;while(--c>=0){const t=Hr(e,a);a+=4;const n=(2147483648&t)>>>31,r=2147483647&t;if(1===n)throw new Error("sidx with reference_type `1` not yet implemented");const s=Hr(e,a);a+=4,a+=4,u.push({time:l,duration:s,timescale:o,range:[i,i+r-1]}),l+=s,i+=r}return u}function Po(e){const t=ss(e);if(null===t)return;const n=es(t,1952867444);if(null===n)return;const i=n[0];return 1===i?zr(n,4):0===i?Hr(n,4):void 0}function Oo(e){const t=es(e,1952868452);if(null===t)return;let n=1;const i=Gr(t,n);n+=3;const r=(1&i)>0,a=(2&i)>0,s=(8&i)>0;if(!s)return;n+=4,r&&(n+=8),a&&(n+=4);const o=Hr(t,n);return o}function No(e){const t=os(e);if(0===t.length)return;let n=0;for(const i of t){const e=es(i,1953658222);if(null===e)return;let t=0;const r=e[t];if(t+=1,r>1)return;const a=Gr(e,t);t+=3;const s=(256&a)>0;let o=0;if(!s&&(o=Oo(i),void 0===o))return;const l=(1&a)>0,u=(4&a)>0,c=(512&a)>0,d=(1024&a)>0,h=(2048&a)>0,f=Hr(e,t);t+=4,l&&(t+=4),u&&(t+=4);let p=f,g=0;while(p-- >0)s?(g+=Hr(e,t),t+=4):g+=o,c&&(t+=4),d&&(t+=4),h&&(t+=4);n+=g}return n}function Uo(e){const t=us(e);if(null===t)return;const n=es(t,1835296868);if(null===n)return;let i=0;const r=n[i];return i+=4,1===r?Hr(n,i+16):0===r?Hr(n,i+8):void 0}function Fo(e){const t=e.length;if(t<4)throw new Error("Cannot update box length: box too short");const n=Hr(e,0);if(0===n){if(t>Os){const n=new Uint8Array(t+8);return n.set($r(1),0),n.set(e.subarray(4,8),4),n.set(Wr(t+8),8),n.set(e.subarray(8,t),16),n}return e.set($r(t),0),e}if(1===n){if(t<16)throw new Error("Cannot update box length: box too short");return e.set(Wr(t),8),e}if(t<=Os)return e.set($r(t),0),e;{const n=new Uint8Array(t+8);return n.set($r(1),0),n.set(e.subarray(4,8),4),n.set(Wr(t+8),8),n.set(e.subarray(8,t),16),n}}function Bo(e){const t=[];let n=0;while(n<e.length){const i=cs(e,n);if(null===i)break;const r=i.length;n+=r;const a=i[0];if(0!==a)j.warn("ISOBMFF: EMSG version "+a.toString()+" not supported.");else{let e=4;const{end:n,string:a}=Ps(i,e);e=n;const{end:s,string:o}=Ps(i,e);e=s;const l=Hr(i,e);e+=4;const u=Hr(i,e);e+=4;const c=Hr(i,e);e+=4;const d=Hr(i,e);e+=4;const h=i.subarray(e,r),f={schemeIdUri:a,value:o,timescale:l,presentationTimeDelta:u,eventDuration:c,id:d,messageData:h};t.push(f)}}if(0!==t.length)return t}function Vo(e){const t=Ja(e,[1836019574,1953653099,1835297121,1835626086,1937007212,1937011556]);if(null===t)return null;const n=t.subarray(8);let i=es(n,1701733238),r=0;if(null===i?(r=28,i=es(n,1701733217)):r=78,null===i)return null;const a=Ja(i.subarray(r),[1936289382,1935894633,1952804451]);if(null===a||a.byteLength<24)return null;const s=a.subarray(8,24);return s.every(e=>0===e)?null:s}function jo(e){const t=rs(e,3565190898,3392751253,2387879627,2655430559);if(void 0===t)return[];const n=[],i=t[0],r=t[4];for(let a=0;a<r;a++){let e,r;1===i?(r=zr(t,16*a+5),e=zr(t,16*a+5+8)):(r=Hr(t,8*a+5),e=Hr(t,8*a+5+4)),n.push({time:r,duration:e})}return n}function Go(e){const t=rs(e,1830656773,1121273062,2162299933,2952222642);if(void 0!==t)return{duration:zr(t,12),time:zr(t,4)}}function Ho(e,t,n,i,r){var a;const s=[];let o,l,u;if(r){const t=ss(e);null!==t?(u=jo(t),l=Go(t)):j.warn("smooth: could not find traf atom")}if(void 0!==u)for(let p=0;p<u.length;p++)s.push({time:u[p].time,duration:u[p].duration,timescale:n});if(void 0!==l)return o={time:l.time/n,duration:l.duration/n},{nextSegments:s,chunkInfos:o,scaledSegmentTime:l.time};if(t||!i.complete)return{nextSegments:s,chunkInfos:null,scaledSegmentTime:void 0};const c=i.duration*n,d=Math.min(.9*n,c/4),h=No(e),f=void 0!==(null===(a=i.privateInfos)||void 0===a?void 0:a.smoothMediaSegment)?i.privateInfos.smoothMediaSegment.time:Math.round(i.time*n);return o=void 0!==h&&Math.abs(h-c)<=d?{time:i.time,duration:h/n}:{time:i.time,duration:i.duration},{nextSegments:s,chunkInfos:o,scaledSegmentTime:f}}function zo(e){return"string"===typeof e&&e.indexOf("mp4")>=0}function Ko(){return!h}function $o(e,t,n,i,r,a,s){return Fs("avc1",Vr(6,Kr(1),16,Kr(e),Kr(t),Kr(n),2,Kr(i),6,[0,1,r.length],ks(r),31-r.length,Kr(a),[255,255],s))}function Wo(e,t,n,i,r,a,s,o){return Fs("encv",Vr(6,Kr(1),16,Kr(e),Kr(t),Kr(n),2,Kr(i),6,[0,1,r.length],ks(r),31-r.length,Kr(a),[255,255],s,o))}function qo(e,t,n,i,r,a){return Fs("mp4a",Vr(6,Kr(e),8,Kr(t),Kr(n),2,Kr(i),Kr(r),2,a))}function Yo(e,t,n,i,r,a,s){return Fs("enca",Vr(6,Kr(e),8,Kr(t),Kr(n),2,Kr(i),Kr(r),2,a,s))}function Xo(e){return Fs("dref",Vr(7,[1],e))}function Qo(e,t){const n=Vr(...[ks(e),[0,0,0,1]].concat(t.map(ks)));return Fs("ftyp",n)}function Zo(e,t){return Fs("schm",Vr(4,ks(e),$r(t)))}function Jo(e){return Fs("tfdt",Vr([1,0,0,0],Wr(e)))}function el(){const e=new Uint8Array(12);return e[3]=1,Fs("vmhd",e)}function tl(e){return Fs("trex",Vr(4,$r(e),[0,0,0,1],12))}function nl(e){return Fs("free",new Uint8Array(e-8))}function il(e,t){return Fs("esds",Vr(4,[3,25],Kr(e),[0,4,17,64,21],11,[5,2],Ms(t),[6,1,2]))}function rl(e){return Fs("frma",ks(e))}function al(e,t,n){let i;i=2===n?1:4===n?3:0;const r=e[1],a=e[2],s=e[3];return Fs("avcC",Vr([1,r,a,s,252|i,225],Kr(e.length),e,[1],Kr(t.length),t))}function sl(e){let t,n;switch(e){case"video":t="vide",n="VideoHandler";break;case"audio":t="soun",n="SoundHandler";break;default:t="hint",n="";break}return Fs("hdlr",Vr(8,ks(t),12,ks(n),1))}function ol(e){return Fs("mdhd",Vr(12,$r(e),8))}function ll(e,t){return Fs("mvhd",Vr(12,$r(e),4,[0,1],2,[1,0],10,[0,1],14,[0,1],14,[64,0,0,0],26,Kr(t+1)))}function ul(e,t,n,i){return Fs("saio",Vr(4,[0,0,0,1],$r(e.length+t.length+n.length+i.length+8+8+8+8)))}function cl(e){if(0===e.length)return Fs("saiz",new Uint8Array(0));const t=Hr(e,0),n=Hr(e,4),i=new Uint8Array(n+9);i.set($r(n),5);let r,a,s=9,o=8;while(o<e.length)o+=8,2===(2&t)?(a=2,r=jr(e,o),o+=6*r+2):(r=0,a=0),i[s]=6*r+8+a,s++;return Fs("saiz",i)}function dl(){return Fs("smhd",new Uint8Array(8))}function hl(e){const t=[7,[e.length]];return Fs("stsd",Vr(...t.concat(e)))}function fl(e,t,n){return Fs("tkhd",Vr($r(7),8,$r(n),20,[1,0,0,0],[0,1,0,0],12,[0,1,0,0],12,[64,0,0,0],Kr(e),2,Kr(t),2))}function pl(e,t,n){return Fs("tenc",Vr(6,[e,t],n))}function gl(e,t,n,i,r){const a=[e,t,n];return void 0!==r&&a.push(Fs("senc",r),cl(r),ul(i,e,t,n)),Bs("traf",a)}function ml(e,t){const n=is(e,1836019558);if(null===n)throw new Error("Smooth: Invalid ISOBMFF given");const i=e.subarray(n[1],n[2]),r=ns(i,1835427940),a=es(i,1953653094);if(null===a||null===r)throw new Error("Smooth: Invalid ISOBMFF given");const s=is(a,1952868452),o=is(a,1953658222);if(null===s||null===o)throw new Error("Smooth: Invalid ISOBMFF given");const l=a.subarray(s[0],s[2]),u=a.subarray(o[0],o[2]);l.set([0,0,0,1],s[1]-s[0]+4);const c=Jo(t),d=vl(u,o[1]-o[0]),h=rs(a,2721664850,1520127764,2722393154,2086964724),f=gl(l,c,d,r,h),p=Bs("moof",[r,f]),g=is(p,1836019558),m=is(f,1953653094),v=is(d,1953658222);if(null===g||null===m||null===v)throw new Error("Smooth: Invalid moof, trun or traf generation");const y=g[1]-g[0]+r.length+(m[1]-m[0])+l.length+c.length+(v[1]-v[0])+8,b=n[2]-n[0],S=p.length-b,T=is(e,1835295092);if(null===T)throw new Error("Smooth: Invalid ISOBMFF given");if(Ko()&&(0===S||S<=-8)){const t=T[1];return p.set($r(t),y),e.set(p,n[0]),S<=-8&&e.set(nl(-S),p.length),e}{const t=T[1]+S;p.set($r(t),y);const i=new Uint8Array(e.length+S),r=e.subarray(0,n[0]),a=e.subarray(n[2],e.length);return i.set(r,0),i.set(p,r.length),i.set(a,r.length+p.length),i}}function vl(e,t){const n=(1&e[t+3])>0;if(n)return e;const i=new Uint8Array(e.length+4);return i.set(e.subarray(0,t+8),0),i[t+3]=1|i[t+3],i.set([0,0,0,0],t+8),i.set(e.subarray(t+8,e.length),t+12),Fo(i)}function yl([e,t]){return t===1/0?`bytes=${e}-`:`bytes=${e}-${t}`}function bl(e,t,n){const i=[e,t,n];return Bs("moov",i)}function Sl(e,t,n,i,r,a){const s=Bs("stbl",[n,Fs("stts",new Uint8Array(8)),Fs("stsc",new Uint8Array(8)),Fs("stsz",new Uint8Array(12)),Fs("stco",new Uint8Array(8))]),o=Fs("url ",new Uint8Array([0,0,0,1])),l=Xo(o),u=Bs("dinf",[l]),c=Bs("minf",[i,u,s]),d=sl(t),h=ol(e),f=Bs("mdia",[h,d,c]),p=fl(r,a,1),g=Bs("trak",[p,f]),m=tl(1),v=Bs("mvex",[m]),y=ll(e,1),b=bl(y,v,g),S=Qo("isom",["isom","iso2","iso6","avc1","dash"]);return Vr(S,b)}function Tl(e,t,n,i,r,a,s,o){const[,l,u]=s.split("00000001");if(void 0===l||void 0===u)throw new Error("Smooth: unsupported codec private data.");const c=Ms(l),d=Ms(u),h=al(c,d,a);let f;if(void 0===o){const e=$o(t,n,i,r,"AVC Coding",24,h);f=hl([e])}else{const e=pl(1,8,o),a=Bs("schi",[e]),s=Zo("cenc",65536),l=rl("avc1"),u=Bs("sinf",[l,s,a]),c=Wo(t,n,i,r,"AVC Coding",24,h,u);f=hl([c])}return Sl(e,"video",f,el(),t,n)}const _l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];function wl(e,t,n){const i=_l.indexOf(t);let r;return r=(63&e)<<4,r=(r|31&i)<<4,r=(r|31&n)<<3,Ds(Kr(r))}function El(e,t,n,i,r,a,s){const o=0===a.length?wl(2,r,t):a,l=il(1,o),u=(()=>{if(void 0===s){const e=qo(1,t,n,i,r,l);return hl([e])}const e=pl(1,8,s),a=Bs("schi",[e]),o=Zo("cenc",65536),u=rl("mp4a"),c=Bs("sinf",[u,o,a]),d=Yo(1,t,n,i,r,l,c);return hl([d])})();return Sl(e,"audio",u,dl(),0,0)}function xl(e,t,n,i,r,a){let s;const o=t.segment.range;return Array.isArray(o)&&(s={Range:yl(o)}),ko({url:e,responseType:"arraybuffer",headers:s,timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:r,onProgress:n.onProgress}).then(e=>{const n=zo(t.mimeType);if(!n||!0!==a)return{resultType:"segment-loaded",resultData:e};const i=new Uint8Array(e.responseData);return Co(i,t.segment.isInit),{resultType:"segment-loaded",resultData:Object.assign(Object.assign({},e),{responseData:i})}})}const Al=({checkMediaSegmentIntegrity:e,segmentLoader:t})=>(n,i,r,a,s)=>{const{segment:o}=i;if(o.isInit){if(void 0===o.privateInfos||void 0===o.privateInfos.smoothInitSegment)throw new Error("Smooth: Invalid segment format");const e=o.privateInfos.smoothInitSegment;let t;const{codecPrivateData:n,timescale:r,height:a,width:s,protection:l={keyId:void 0,keySystems:void 0}}=e;if(void 0===n)throw new Error("Smooth: no codec private data.");switch(i.type){case"video":t=Tl(r,null!==s&&void 0!==s?s:0,null!==a&&void 0!==a?a:0,72,72,4,n,l.keyId);break;case"audio":{const{channels:i=0,bitsPerSample:a=0,packetSize:s=0,samplingRate:o=0}=e;t=El(r,i,a,s,o,n,l.keyId);break}default:0,t=new Uint8Array(0)}return Promise.resolve({resultType:"segment-created",resultData:t})}return null===n?Promise.resolve({resultType:"segment-created",resultData:null}):"function"!==typeof t?xl(n,i,s,r,a,e):new Promise((o,l)=>{let u=!1;const c=t=>{if(u||a.isCancelled())return;u=!0,a.deregister(y);const n=zo(i.mimeType);n&&!0===e||o({resultType:"segment-loaded",resultData:{responseData:t.data,size:t.size,requestDuration:t.duration}});const r=t.data instanceof Uint8Array?t.data:new Uint8Array(t.data);Co(r,i.segment.isInit),o({resultType:"segment-loaded",resultData:{responseData:r,size:t.size,requestDuration:t.duration}})},d=e=>{var t,n;if(u||a.isCancelled())return;u=!0,a.deregister(y);const i=e,r=null!==(t=null===i||void 0===i?void 0:i.message)&&void 0!==t?t:"Unknown error when fetching a Smooth segment through a custom segmentLoader.",s=new ln(r,null!==(n=null===i||void 0===i?void 0:i.canRetry)&&void 0!==n&&n,null===i||void 0===i?void 0:i.xhr);l(s)},h=e=>{u||a.isCancelled()||s.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize})},f=()=>{u||a.isCancelled()||(u=!0,a.deregister(y),xl(n,i,s,r,a,e).then(o,l))},p={reject:d,resolve:c,fallback:f,progress:h};let g;void 0!==i.segment.range&&(g=[i.segment.range],void 0!==i.segment.indexRange&&g.push(i.segment.indexRange));const m={isInit:i.segment.isInit,timeout:r.timeout,byteRanges:g,trackType:i.type,url:n},v=t(m,p);function y(e){u||(u=!0,u||"function"!==typeof v||v(),l(e))}a.register(y)})};var kl=Al;function Il(e,t){return null===e?null:null===t.url?e.baseUrl:_s(e.baseUrl,t.url)}var Cl=function(e){const t=wo(e),n=kl(e),i={customManifestLoader:e.manifestLoader},r=Do(i,"text"),a={loadManifest:r,parseManifest(n,i){var r;const a=null!==(r=n.url)&&void 0!==r?r:i.originalUrl,{receivedTime:s,responseData:o}=n,l="string"===typeof o?(new DOMParser).parseFromString(o,"text/xml"):o,u=t(l,a,s),c=[],d=new sn(u,{representationFilter:e.representationFilter},c);return{manifest:d,url:a,warnings:c}}},s={loadSegment(e,t,i,r,a){const s=Il(e,t.segment);return n(s,t,i,r,a)},parseSegment(e,t,n){var i,r;const{segment:a}=t,{data:s,isChunked:o}=e;if(null===s)return a.isInit?{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:"media",chunkData:null,chunkInfos:null,chunkOffset:0,chunkSize:0,protectionData:[],appendWindow:[void 0,void 0]};const l=s instanceof Uint8Array?s:new Uint8Array(s);if(a.isInit){const e=null===(r=null===(i=a.privateInfos)||void 0===i?void 0:i.smoothInitSegment)||void 0===r?void 0:r.timescale;return{segmentType:"init",initializationData:s,initializationDataSize:s.byteLength,initTimescale:e,protectionData:[]}}const u=void 0!==n?Ho(l,o,n,a,t.isLive):null;if(null===u||null===u.chunkInfos||void 0===u.scaledSegmentTime)throw new Error("Smooth Segment without time information");const{nextSegments:c,chunkInfos:d,scaledSegmentTime:h}=u,f=ml(l,h),p=c.length>0?c:void 0;return{segmentType:"media",chunkData:f,chunkInfos:d,chunkOffset:0,chunkSize:f.length,protectionData:[],predictedSegments:p,appendWindow:[void 0,void 0]}}},o={loadSegment(t,n,i,r,a){const{segment:s}=n,o=Il(t,s);if(s.isInit||null===o)return Promise.resolve({resultType:"segment-created",resultData:null});const l=zo(n.mimeType);return l?ko({url:o,responseType:"arraybuffer",timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:r,onProgress:a.onProgress}).then(t=>{if(!0!==e.checkMediaSegmentIntegrity)return{resultType:"segment-loaded",resultData:t};const i=new Uint8Array(t.responseData);return Co(i,n.segment.isInit),{resultType:"segment-loaded",resultData:Object.assign(Object.assign({},t),{responseData:i})}}):ko({url:o,responseType:"text",timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:r,onProgress:a.onProgress}).then(e=>({resultType:"segment-loaded",resultData:e}))},parseSegment(e,t,n){var i;const{segment:r,language:a,mimeType:s="",codecs:o=""}=t,l=zo(t.mimeType),{data:u,isChunked:c}=e;let d,h;if(r.isInit)return{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0};if(null===u)return{segmentType:"media",chunkData:null,chunkInfos:null,chunkOffset:0,chunkSize:0,protectionData:[],appendWindow:[void 0,void 0]};let f,p,g,m,v=null;if(l){let e;e="string"===typeof u?ks(u):u instanceof Uint8Array?u:new Uint8Array(u),d=e.length;const a=void 0!==n?Ho(e,c,n,r,t.isLive):null;h=null===a||void 0===a?void 0:a.nextSegments,v=null!==(i=null===a||void 0===a?void 0:a.chunkInfos)&&void 0!==i?i:null,null===v?c?j.warn("Smooth: Unavailable time data for current text track."):(f=r.time,p=r.end):(f=v.time,p=void 0!==v.duration?v.time+v.duration:r.end);const l=o.toLowerCase();if("application/ttml+xml+mp4"===s||"stpp"===l||"stpp.ttml.im1t"===l)m="ttml";else{if("wvtt"!==l)throw new Error(`could not find a text-track parser for the type ${s}`);m="vtt"}const y=ls(e);g=null===y?"":Rs(y)}else{let e;if(f=r.time,p=r.end,"string"!==typeof u){const t=u instanceof Uint8Array?u:new Uint8Array(u);d=t.length,e=Rs(t)}else e=u;switch(s){case"application/x-sami":case"application/smil":m="sami";break;case"application/ttml+xml":m="ttml";break;case"text/vtt":m="vtt";break}if(void 0===m){const e=o.toLowerCase();if("srt"!==e)throw new Error(`could not find a text-track parser for the type ${s}`);m="srt"}g=e}const y=Array.isArray(h)&&h.length>0?h:void 0,b=null!==f&&void 0!==f?f:0;return{segmentType:"media",chunkData:{type:m,data:g,start:f,end:p,language:a},chunkSize:d,chunkInfos:v,chunkOffset:b,protectionData:[],predictedSegments:y,appendWindow:[void 0,void 0]}}};return{manifest:a,audio:s,video:s,text:o}},Rl=Cl;function Ml(e){void 0===e.transports.smooth&&(e.transports.smooth=Rl),e.mainThreadMediaSourceInit=Ga,e.codecSupportProber=Za}class Dl{constructor(){this._refs=new Map,this._stored=[]}addReferences(e){for(const t of e)void 0!==t.attributes.refId&&this._refs.set(t.attributes.refId,t)}add(e,t){this._tryParsing(e,t,!1)||this._stored.push([e,t]),void 0!==t.attributes.refId&&(this._refs.set(t.attributes.refId,t),this._resolveStoredRefs(!1))}finalize(){this._resolveStoredRefs(!0)}_resolveStoredRefs(e){for(let t=this._stored.length-1;t>=0;t--){const[n,i]=this._stored[t];(this._tryParsing(n,i,e)||e)&&this._stored.splice(t,1)}return 0===this._stored.length}_tryParsing(e,t,n){if(void 0===t.attributes.ref)return Ll(e,t),!0;const i=this._getReferenced(t.attributes.ref);return void 0===i?(n&&(j.warn("DASH: forcing the parsing of a referencing ContentProtection"),Ll(e,t)),!1):(t.children.cencPssh.push(...i.children.cencPssh),void 0===t.attributes.keyId&&void 0!==i.attributes.keyId&&(t.attributes.keyId=i.attributes.keyId),void 0===t.attributes.schemeIdUri&&void 0!==i.attributes.schemeIdUri&&(t.attributes.schemeIdUri=i.attributes.schemeIdUri),void 0===t.attributes.value&&void 0!==i.attributes.value&&(t.attributes.value=i.attributes.value),Ll(e,t),!0)}_getReferenced(e){return this._refs.get(e)}}function Ll(e,t){let n;if(void 0!==t.attributes.schemeIdUri&&"urn:uuid:"===t.attributes.schemeIdUri.substring(0,9)&&(n=t.attributes.schemeIdUri.substring(9).replace(/-/g,"").toLowerCase()),void 0!==t.attributes.keyId&&t.attributes.keyId.length>0){const i={keyId:t.attributes.keyId,systemId:n};void 0===e.contentProtections?e.contentProtections={keyIds:[i],initData:[]}:void 0===e.contentProtections.keyIds?e.contentProtections.keyIds=[i]:e.contentProtections.keyIds.push(i)}if(void 0===n)return;const{cencPssh:i}=t.children,r=[];for(const s of i)r.push({systemId:n,data:s});if(0===r.length)return;if(void 0===e.contentProtections)return void(e.contentProtections={keyIds:[],initData:[{type:"cenc",values:r}]});const a=Re(e.contentProtections.initData,e=>"cenc"===e.type);void 0===a?e.contentProtections.initData.push({type:"cenc",values:r}):a.values.push(...r)}function Pl(e){const t=Date.parse(e)-_e();if(!isNaN(t))return t;j.warn("DASH Parser: Invalid clock received: ",e)}function Ol(e){const t=e.children.utcTimings.filter(e=>("urn:mpeg:dash:utc:http-iso:2014"===e.schemeIdUri||"urn:mpeg:dash:utc:http-xsdate:2014"===e.schemeIdUri)&&void 0!==e.value);return t.length>0?t[0].value:void 0}function Nl(e){const{representations:t}=e;let n=null;for(let i=0;i<t.length;i++){const e=t[i].index.getLastAvailablePosition();if(void 0===e)return;null!==e&&(n=null===n?e:Math.min(n,e))}return null===n?null:n}function Ul(e){for(let t=e.length-1;t>=0;t--){const n=e[t].adaptations,i=void 0===n.audio?void 0:n.audio[0],r=void 0===n.video?void 0:n.video[0];if(void 0!==i||void 0!==r){let e=null,t=null;if(void 0!==i){const t=Nl(i);if(void 0===t)return{safe:void 0,unsafe:void 0};e=t}if(void 0!==r){const e=Nl(r);if(void 0===e)return{safe:void 0,unsafe:void 0};t=e}if(void 0!==i&&null===e||void 0!==r&&null===t)return j.info("Parser utils: found Period with no segment. ","Going to previous one to calculate last position"),{safe:void 0,unsafe:void 0};if(null!==t)return null!==e?{safe:Math.min(e,t),unsafe:Math.max(e,t)}:{safe:t,unsafe:t};if(null!==e)return{safe:e,unsafe:e}}}return{safe:void 0,unsafe:void 0}}function Fl(e){const{representations:t}=e;let n=null;for(let i=0;i<t.length;i++){const e=t[i].index.getFirstAvailablePosition();if(void 0===e)return;null!==e&&(n=null===n?e:Math.max(n,e))}return null===n?null:n}function Bl(e){for(let t=0;t<=e.length-1;t++){const n=e[t].adaptations,i=void 0===n.audio?void 0:n.audio[0],r=void 0===n.video?void 0:n.video[0];if(void 0!==i||void 0!==r){let e=null,t=null;if(void 0!==i){const t=Fl(i);if(void 0===t)return;e=t}if(void 0!==r){const e=Fl(r);if(void 0===e)return;t=e}if(void 0!==i&&null===e||void 0!==r&&null===t)return void j.info("Parser utils: found Period with no segment. ","Going to next one to calculate first position");if(null!==t)return null!==e?Math.max(e,t):t;if(null!==e)return e}}}function Vl(e){if(0===e.length)throw new Error("DASH Parser: no period available for a dynamic content");const t=Bl(e),n=Ul(e);return{minimumSafePosition:t,maximumSafePosition:n.safe,maximumUnsafePosition:n.unsafe}}class jl{constructor(e){this._isDynamic=e.isDynamic,this._timeShiftBufferDepth=e.isDynamic&&void 0!==e.timeShiftBufferDepth?e.timeShiftBufferDepth:null,this._serverTimestampOffset=e.serverTimestampOffset,this._availabilityStartTime=e.availabilityStartTime}setLastPosition(e,t){this._lastPosition=e,this._positionTime=t}lastPositionIsKnown(){return this._isDynamic?void 0!==this._positionTime&&void 0!==this._lastPosition:void 0!==this._lastPosition}getEstimatedMinimumSegmentTime(){var e;if(!this._isDynamic||null===this._timeShiftBufferDepth)return 0;const t=null!==(e=this.getEstimatedLiveEdge())&&void 0!==e?e:this.getEstimatedMaximumPosition(0);if(void 0===t)return;const n=t-this._timeShiftBufferDepth;return n}getEstimatedLiveEdge(){if(this._isDynamic&&void 0!==this._serverTimestampOffset)return(_e()+this._serverTimestampOffset)/1e3-this._availabilityStartTime}getEstimatedMaximumPosition(e){if(!this._isDynamic)return this._lastPosition;const t=this.getEstimatedLiveEdge();return void 0!==t&&e!==1/0?t+e:void 0!==this._positionTime&&void 0!==this._lastPosition?Math.max(this._lastPosition-this._positionTime+_e()/1e3,0):this._lastPosition}}function Gl(e,t){return"dynamic"!==e.type?0:r(e.availabilityStartTime)?null!==t&&void 0!==t?t:0:e.availabilityStartTime}function Hl(e,t){return"function"===typeof Array.prototype.flatMap?e.flatMap(t):e.reduce((e,n)=>{const i=t(n);return Array.isArray(i)?(e.push(...i),e):(e.push(i),e)},[])}function zl(e){if(0===e.length)return[];const t=[e[0]];for(let n=1;n<e.length;n++){const i=e[n];let r=t[t.length-1];while(void 0===r.duration||r.start+r.duration>i.start){if(j.warn("DASH: Updating overlapping Periods.",null===r||void 0===r?void 0:r.start,i.start),r.duration=i.start-r.start,r.end=i.start,r.duration>0)break;if(t.pop(),0===t.length)break;r=t[t.length-1]}t.push(i)}return t}function Kl(e,t){const n=[];return e.forEach((i,a)=>{let s,o;if(r(i.attributes.start))if(0===a)s=!t.isDynamic||r(t.availabilityStartTime)?0:t.availabilityStartTime;else{const e=n[n.length-1];if(r(e)||r(e.periodEnd))throw new Error("Missing start time when parsing periods.");s=e.periodEnd}else s=i.attributes.start;const l=e[a+1];r(i.attributes.duration)?a===e.length-1?o=t.duration:r(l.attributes.start)||(o=l.attributes.start-s):o=i.attributes.duration;const u=r(o)?void 0:s+o;n.push({periodStart:s,periodDuration:o,periodEnd:u})}),n}function $l(e,t){for(const n of t){const{adaptation:t,trickModeAttachedAdaptationIds:i}=n;for(const n of i)for(const i of bt){const r=e[i];if(void 0!==r)for(const e of r)e.id===n&&(void 0===e.trickModeTracks&&(e.trickModeTracks=[]),e.trickModeTracks.push(t))}}}var Wl=$l;const ql=["subtitle","caption"];function Yl(e,t,n,i){function r(e,t){const n=e.split("/")[0];return gt(bt,n)?n:"application/ttml+xml"===e?"text":"application/mp4"===e&&null!==t&&void 0!==Re(t,e=>"urn:mpeg:dash:role:2011"===e.schemeIdUri&&gt(ql,e.value))?"text":void 0}function a(e){switch(e.substring(0,3)){case"avc":case"hev":case"hvc":case"vp8":case"vp9":case"av1":return"video";case"vtt":return"text"}switch(e.substring(0,4)){case"mp4a":return"audio";case"wvtt":case"stpp":return"text"}}if(null!==t){const e=r(t,i);if(void 0!==e)return e}if(null!==n){const e=a(n);if(void 0!==e)return e}for(let s=0;s<e.length;s++){const t=e[s],{mimeType:n,codecs:o}=t.attributes;if(void 0!==n){const e=r(n,i);if(void 0!==e)return e}if(void 0!==o){const e=a(o);if(void 0!==e)return e}}}const Xl=/[, ]+/g;function Ql(e){return Ot(e)?e.trim().replace(Xl,", "):""}function Zl(e){const[t,n,i,r,a,s,o,l]=e.split(".");if("vp08"!==t&&"vp09"!==t&&"vp10"!==t)return;let u,c,d;return(void 0!==r&&"10"===r||"12"===r)&&(u=parseInt(r,10)),void 0!==o&&("16"===o?c="pq":"18"===o&&(c="hlg")),void 0!==s&&void 0!==l&&"09"===s&&"09"===l&&(d="rec2020"),void 0!==u&&void 0!==c?{colorDepth:u,eotf:c,colorSpace:d}:void 0}function Jl(e,t){var n;const{initialization:i}=e,a={};return void 0!==t&&(a.isEMSGWhitelisted=t),{id:"init",isInit:!0,time:0,end:0,duration:0,timescale:1,range:r(i)?void 0:i.range,indexRange:e.indexRange,url:null!==(n=null===i||void 0===i?void 0:i.url)&&void 0!==n?n:null,complete:!0,privateInfos:a,timestampOffset:-e.indexTimeOffset/e.timescale}}function eu(e,t){const n=e.toString();if(n.length>=t)return n;const i=new Array(t+1).join("0")+n;return i.slice(-t)}function tu(e){return(t,n,i)=>{const r=Ot(i)?parseInt(i,10):1;return eu(String(e),r)}}function nu(e,t,n){return iu(e,t,n)}function iu(e,t,n){return-1===e.indexOf("$")?e:e.replace(/\$\$/g,"$").replace(/\$RepresentationID\$/g,String(t)).replace(/\$Bandwidth(\%0(\d+)d)?\$/g,tu(void 0===n?0:n))}function ru(e,t){return function(n){return-1===n.indexOf("$")?n:n.replace(/\$\$/g,"$").replace(/\$Number(\%0(\d+)d)?\$/g,(e,n,i)=>{if(void 0===t)throw new Error("Segment number not defined in a $Number$ scheme");return tu(t)(e,n,i)}).replace(/\$Time(\%0(\d+)d)?\$/g,(t,n,i)=>{if(void 0===e)throw new Error("Segment time not defined in a $Time$ scheme");return tu(e)(t,n,i)})}}function au(e,t,n){const i=n-e;return i>0?Math.floor(i/t):0}function su(e,t,n,i,r,a){var s;const o=i.getEstimatedMaximumPosition(null!==(s=e.availabilityTimeOffset)&&void 0!==s?s:0),l=Math.min(t+n,null!==o&&void 0!==o?o:1/0),u=eo(t,e),c=eo(l,e),{timeline:d,timescale:h,segmentUrlTemplate:f,startNumber:p,endNumber:g}=e;let m=null!==p&&void 0!==p?p:1;const v=[],y=d.length;for(let b=0;b<y;b++){const t=d[b],{duration:n,start:i,range:s}=t;let l;l=void 0===o?r:Math.min(o*h,null!==r&&void 0!==r?r:1/0);const p=Zs(t,d[b+1],l),S=!1!==e.availabilityTimeComplete||b!==y-1&&0!==p;let T=au(i,n,u),_=i+T*n;while(_<c&&T<=p){const t=m+T;if(void 0!==g&&t>g)break;const r=null===f?null:ru(_,t)(f);let o=_-e.indexTimeOffset,l=n;o<0&&(l=n+o,o=0);const u={id:String(_),time:o/h,end:(o+l)/h,duration:l/h,isInit:!1,range:s,timescale:1,url:r,number:t,timestampOffset:-e.indexTimeOffset/h,complete:S,privateInfos:{isEMSGWhitelisted:a}};v.push(u),T++,_=i+T*n}if(_>=c)return v;if(m+=p+1,void 0!==g&&m>g)return v}return v}function ou(e,t){if(t.timescale!==e.timescale){const{timescale:n}=e;e.timeline.push({start:t.time/t.timescale*n,duration:t.duration/t.timescale*n,repeatCount:void 0===t.count?0:t.count,range:t.range})}else e.timeline.push({start:t.time,duration:t.duration,repeatCount:void 0===t.count?0:t.count,range:t.range});return!0}class lu{constructor(e,t){var n,i,a,s;const{periodStart:o,periodEnd:l,representationId:u,representationBitrate:c,isEMSGWhitelisted:d}=t,h=null!==(n=e.timescale)&&void 0!==n?n:1,f=null!==(i=e.presentationTimeOffset)&&void 0!==i?i:0,p=f-o*h,g=void 0===(null===(a=e.initialization)||void 0===a?void 0:a.media)?null:nu(e.initialization.media,u,c),m=void 0===e.media?null:nu(e.media,u,c);let v;void 0!==e.initialization?v=e.initialization.range:void 0!==e.indexRange&&(v=[0,e.indexRange[0]-1]),this._index={indexRange:e.indexRange,indexTimeOffset:p,initialization:{url:g,range:v},segmentUrlTemplate:m,startNumber:e.startNumber,endNumber:e.endNumber,timeline:null!==(s=e.timeline)&&void 0!==s?s:[],timescale:h},this._manifestBoundsCalculator=t.manifestBoundsCalculator,this._scaledPeriodStart=eo(o,this._index),this._scaledPeriodEnd=r(l)?void 0:eo(l,this._index),this._isInitialized=this._index.timeline.length>0,this._isEMSGWhitelisted=d}getInitSegment(){return Jl(this._index,this._isEMSGWhitelisted)}getSegments(e,t){return su(this._index,e,t,this._manifestBoundsCalculator,this._scaledPeriodEnd,this._isEMSGWhitelisted)}shouldRefresh(){return!1}getFirstAvailablePosition(){const e=this._index;return 0===e.timeline.length?null:to(Math.max(this._scaledPeriodStart,e.timeline[0].start),e)}getLastAvailablePosition(){var e;const{timeline:t}=this._index;if(0===t.length)return null;const n=t[t.length-1],i=Math.min(Js(n,null,this._scaledPeriodEnd),null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0);return to(i,this._index)}getEnd(){return this.getLastAvailablePosition()}awaitSegmentBetween(){return!1}isSegmentStillAvailable(){return!0}checkDiscontinuity(){return null}canBeOutOfSyncError(){return!1}isStillAwaitingFutureSegments(){return!1}isInitialized(){return this._isInitialized}initialize(e){if(!this._isInitialized){for(let t=0;t<e.length;t++)ou(this._index,e[t]);this._isInitialized=!0}}addPredictedSegments(){j.warn("Cannot add predicted segments to a `BaseRepresentationIndex`")}_replace(e){this._index=e._index,this._isInitialized=e._isInitialized,this._scaledPeriodEnd=e._scaledPeriodEnd,this._isEMSGWhitelisted=e._isEMSGWhitelisted}_update(){j.error("Base RepresentationIndex: Cannot update a SegmentList")}}class uu{constructor(e,t){var n,i,a;if(void 0===e.duration)throw new Error("Invalid SegmentList: no duration");const{periodStart:s,periodEnd:o,representationId:l,representationBitrate:u,isEMSGWhitelisted:c}=t;this._isEMSGWhitelisted=c,this._periodStart=s,this._periodEnd=o;const d=null!==(n=e.presentationTimeOffset)&&void 0!==n?n:0,h=null!==(i=e.timescale)&&void 0!==i?i:1,f=d-s*h,p=void 0===(null===(a=e.initialization)||void 0===a?void 0:a.media)?null:nu(e.initialization.media,l,u),g=e.list.map(e=>({url:void 0===e.media?null:nu(e.media,l,u),mediaRange:e.mediaRange}));this._index={list:g,timescale:h,duration:e.duration,indexTimeOffset:f,indexRange:e.indexRange,initialization:r(e.initialization)?void 0:{url:p,range:e.initialization.range}}}getInitSegment(){const e=Jl(this._index);return void 0===e.privateInfos&&(e.privateInfos={}),e.privateInfos.isEMSGWhitelisted=this._isEMSGWhitelisted,e}getSegments(e,t){const n=this._index,{duration:i,list:r,timescale:a}=n,s=i/a,o=e-this._periodStart,[l,u]=no(o,t,a),c=Math.min(r.length-1,Math.floor(u/i)),d=[];let h=Math.floor(l/i);while(h<=c){const e=r[h].mediaRange,t=r[h].url,i=h*s+this._periodStart,o={id:String(h),time:i,isInit:!1,range:e,duration:s,timescale:1,end:i+s,url:t,timestampOffset:-n.indexTimeOffset/a,complete:!0,privateInfos:{isEMSGWhitelisted:this._isEMSGWhitelisted}};d.push(o),h++}return d}shouldRefresh(e,t){return!1}getFirstAvailablePosition(){return this._periodStart}getLastAvailablePosition(){var e;const t=this._index,{duration:n,list:i}=t;return Math.min(i.length*n/t.timescale+this._periodStart,null!==(e=this._periodEnd)&&void 0!==e?e:1/0)}getEnd(){return this.getLastAvailablePosition()}awaitSegmentBetween(){return!1}isSegmentStillAvailable(){return!0}checkDiscontinuity(){return null}canBeOutOfSyncError(){return!1}isStillAwaitingFutureSegments(){return!1}isInitialized(){return!0}initialize(){j.error("A `ListRepresentationIndex` does not need to be initialized")}addPredictedSegments(){j.warn("Cannot add predicted segments to a `ListRepresentationIndex`")}_replace(e){this._index=e._index}_update(){j.error("A `ListRepresentationIndex` cannot be updated")}}function cu(e){return N.getCurrent().DEFAULT_MAXIMUM_TIME_ROUNDING_ERROR*e}function du(e,t,n){let i=e.start,a=e.duration;const s=e.repeatCount;return void 0===i&&(null===t?i=0:r(t.duration)||(i=t.start+t.duration*(t.repeatCount+1))),void 0!==a&&!isNaN(a)||null===n||void 0===n.start||isNaN(n.start)||void 0===i||isNaN(i)||(a=n.start-i),void 0===i||isNaN(i)||void 0===a||isNaN(a)||void 0!==s&&isNaN(s)?(j.warn('DASH: A "S" Element could not have been parsed.'),null):{start:i,duration:a,repeatCount:void 0===s?0:s}}function hu(e){const t={};for(const n of Object.keys(e.attributes)){const i=e.attributes[n];if(!r(i))switch(n){case"t":const e=parseInt(i,10);isNaN(e)?j.warn(`DASH: invalid t ("${i}")`):t.start=e;break;case"d":const r=parseInt(i,10);isNaN(r)?j.warn(`DASH: invalid d ("${i}")`):t.duration=r;break;case"r":const a=parseInt(i,10);isNaN(a)?j.warn(`DASH: invalid r ("${i}")`):t.repeatCount=a;break}}return t}function fu(e){const t={};for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];switch(i.name){case"t":const e=parseInt(i.value,10);isNaN(e)?j.warn(`DASH: invalid t ("${i.value}")`):t.start=e;break;case"d":const n=parseInt(i.value,10);isNaN(n)?j.warn(`DASH: invalid d ("${i.value}")`):t.duration=n;break;case"r":const r=parseInt(i.value,10);isNaN(r)?j.warn(`DASH: invalid r ("${i.value}")`):t.repeatCount=r;break}}return t}function pu(e){const t=[];if(Array.isArray(e))for(let i=0;i<e.length;i++)t.push(hu(e[i]));else for(let i=0;i<e.length;i++)t.push(fu(e[i]));const n=[];for(let i=0;i<t.length;i++){const e=t[i],r=void 0===n[n.length-1]?null:n[n.length-1],a=void 0===t[i+1]?null:t[i+1],s=du(e,r,a);null!==s&&n.push(s)}return n}function gu(e,t){if(0===e.length||0===t.length)return null;const n=e[0].start,i=Array.isArray(t)?t[0].attributes.t:t[0].getAttribute("t"),a=r(i)?null:parseInt(i,10);if(null===a||Number.isNaN(a))return null;if(n===a)return{prevSegmentsIdx:0,newElementsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(n<a){let t=e[0],n=0;while(1){if(t.repeatCount>0){const e=a-t.start;if(e%t.duration===0&&e/t.duration<=t.repeatCount){const i=e/t.duration;return{repeatNumberInPrevSegments:i,prevSegmentsIdx:n,newElementsIdx:0,repeatNumberInNewElements:0}}}if(n++,n>=e.length)return null;if(t=e[n],t.start===a)return{prevSegmentsIdx:n,newElementsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(t.start>a)return null}}else{let e=0,i=Array.isArray(t)?t[0]:null,s=Array.isArray(t)?null:t[0],o=a;while(1){const l=null!==i?i.attributes.d:null===s||void 0===s?void 0:s.getAttribute("d"),u=r(l)?null:parseInt(l,10);if(null===u||Number.isNaN(u))return null;const c=null!==i?i.attributes.r:null===s||void 0===s?void 0:s.getAttribute("r"),d=r(c)?null:parseInt(c,10);if(null!==d){if(Number.isNaN(d)||d<0)return null;if(d>0){const t=n-o;if(t%u===0&&t/u<=d){const n=t/u;return{repeatNumberInPrevSegments:0,repeatNumberInNewElements:n,prevSegmentsIdx:0,newElementsIdx:e}}}o+=u*(d+1)}else o+=u;if(e++,e>=t.length)return null;Array.isArray(t)?i=t[e]:s=t[e];const h=null!==i?i.attributes.t:null===s||void 0===s?void 0:s.getAttribute("t"),f=r(h)?null:parseInt(h,10);if(null!==f){if(Number.isNaN(f))return null;o=f}if(o===n)return{newElementsIdx:e,prevSegmentsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(o>a)return null}}}function mu(e,t){var n;const i=gu(t,e);if(null===i)return j.warn('DASH: Cannot perform "based" update. Common segment not found.'),pu(e);const{prevSegmentsIdx:r,newElementsIdx:a,repeatNumberInPrevSegments:s,repeatNumberInNewElements:o}=i,l=t.length-r,u=l+a-1;if(u>=e.length)return j.info('DASH: Cannot perform "based" update. New timeline too short'),pu(e);const c=t.slice(r);if(s>0){const e=c[0];e.start+=e.duration*s,c[0].repeatCount-=s}if(o>0&&0!==a)return j.info('DASH: Cannot perform "based" update. The new timeline has a different form.'),pu(e);const d=c[c.length-1],h=Array.isArray(e)?hu(e[u]):fu(e[u]),f=(null!==(n=h.repeatCount)&&void 0!==n?n:0)-o;if(h.duration!==d.duration||d.repeatCount>f)return j.info('DASH: Cannot perform "based" update. The new timeline has a different form at the beginning.'),pu(e);void 0!==h.repeatCount&&h.repeatCount>d.repeatCount&&(d.repeatCount=h.repeatCount);const p=[],g=[];if(Array.isArray(e))for(let m=u+1;m<e.length;m++)g.push(hu(e[m]));else for(let m=u+1;m<e.length;m++)g.push(fu(e[m]));for(let m=0;m<g.length;m++){const e=g[m],t=void 0===p[p.length-1]?d:p[p.length-1],n=void 0===g[m+1]?null:g[m+1],i=du(e,t,n);null!==i&&p.push(i)}return c.concat(p)}class vu{constructor(e,t){var n,i,a,s,o;if(!vu.isTimelineIndexArgument(e))throw new Error("The given index is not compatible with a TimelineRepresentationIndex.");const{availabilityTimeComplete:l,availabilityTimeOffset:u,manifestBoundsCalculator:c,isDynamic:d,isLastPeriod:h,representationId:f,representationBitrate:p,periodStart:g,periodEnd:m,isEMSGWhitelisted:v}=t,y=null!==(n=e.timescale)&&void 0!==n?n:1,b=null!==(i=e.presentationTimeOffset)&&void 0!==i?i:0,S=g*y,T=b-S;this._manifestBoundsCalculator=c,this._isEMSGWhitelisted=v,this._isLastPeriod=h,this._lastUpdate=null!==(a=t.receivedTime)&&void 0!==a?a:_e(),this._unsafelyBaseOnPreviousIndex=null,null!==t.unsafelyBaseOnPreviousRepresentation&&t.unsafelyBaseOnPreviousRepresentation.index instanceof vu&&(t.unsafelyBaseOnPreviousRepresentation.index._unsafelyBaseOnPreviousIndex=null,this._unsafelyBaseOnPreviousIndex=t.unsafelyBaseOnPreviousRepresentation.index),this._isDynamic=d,this._parseTimeline=null!==(s=e.timelineParser)&&void 0!==s?s:null;const _=void 0===(null===(o=e.initialization)||void 0===o?void 0:o.media)?null:nu(e.initialization.media,f,p),w=void 0===e.media?null:nu(e.media,f,p);let E;E=void 0===u&&void 0===l?1/0:null!==u&&void 0!==u?u:0,this._index={availabilityTimeComplete:null===l||void 0===l||l,availabilityTimeOffset:E,indexRange:e.indexRange,indexTimeOffset:T,initialization:r(e.initialization)?void 0:{url:_,range:e.initialization.range},segmentUrlTemplate:w,startNumber:e.startNumber,endNumber:e.endNumber,timeline:void 0===e.timeline?null:yu(e.timeline,e.startNumber,e.endNumber),timescale:y},this._scaledPeriodStart=eo(g,this._index),this._scaledPeriodEnd=void 0===m?void 0:eo(m,this._index)}getInitSegment(){return Jl(this._index,this._isEMSGWhitelisted)}getSegments(e,t){return this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline()),su(this._index,e,t,this._manifestBoundsCalculator,this._scaledPeriodEnd,this._isEMSGWhitelisted)}shouldRefresh(){return!1}getFirstAvailablePosition(){this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());const e=this._index.timeline;return 0===e.length?null:to(Math.max(this._scaledPeriodStart,e[0].start),this._index)}getLastAvailablePosition(){var e;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());const t=Su(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(null===t)return null;const n=Math.min(t.end,null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0);return to(n,this._index)}getEnd(){var e;if(this._isDynamic&&!this._isLastPeriod)return;if(this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline()),this._index.timeline.length<=0)return null;const t=this._index.timeline[this._index.timeline.length-1],n=Math.min(Js(t,null,this._scaledPeriodEnd),null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0);return to(n,this._index)}awaitSegmentBetween(e,t){var n,i;if(fe(e<=t),!this._isDynamic)return!1;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());const{timescale:r,timeline:a}=this._index,s=cu(r),o=eo(t,this._index),l=Su(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(null!==l){const e=Math.min(l.end,null!==(n=this._scaledPeriodEnd)&&void 0!==n?n:1/0),t=e+s;if(t>=Math.min(o,null!==(i=this._scaledPeriodEnd)&&void 0!==i?i:1/0))return!1}const u=eo(e,this._index);if(a.length>0&&null!==l&&!l.isLastOfTimeline){const e=a[a.length-1],t=Js(e,null,this._scaledPeriodEnd),n=t+s;if(u<n+s)return!0}return!!this._isLastPeriod&&(void 0===this._scaledPeriodEnd?o+s>this._scaledPeriodStart&&void 0:u-s<this._scaledPeriodEnd&&o+s>this._scaledPeriodStart)}isSegmentStillAvailable(e){return!!e.isInit||(this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline()),bu(e,this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd))}checkDiscontinuity(e){this._refreshTimeline();let t=this._index.timeline;return null===t&&(t=this._getTimeline(),this._index.timeline=t),ro({timeline:t,timescale:this._index.timescale,indexTimeOffset:this._index.indexTimeOffset},e,this._scaledPeriodEnd)}canBeOutOfSyncError(e){return!!this._isDynamic&&(e instanceof ct&&e.isHttpError(404))}_replace(e){this._parseTimeline=e._parseTimeline,this._index=e._index,this._isDynamic=e._isDynamic,this._scaledPeriodStart=e._scaledPeriodStart,this._scaledPeriodEnd=e._scaledPeriodEnd,this._lastUpdate=e._lastUpdate,this._manifestBoundsCalculator=e._manifestBoundsCalculator,this._isLastPeriod=e._isLastPeriod}_update(e){null===this._index.timeline&&(this._index.timeline=this._getTimeline()),null===e._index.timeline&&(e._index.timeline=e._getTimeline());const t=fo(this._index.timeline,e._index.timeline);t&&(this._index.startNumber=e._index.startNumber),this._index.availabilityTimeOffset=e._index.availabilityTimeOffset,this._index.availabilityTimeComplete=e._index.availabilityTimeComplete,this._index.endNumber=e._index.endNumber,this._isDynamic=e._isDynamic,this._scaledPeriodStart=e._scaledPeriodStart,this._scaledPeriodEnd=e._scaledPeriodEnd,this._lastUpdate=e._lastUpdate,this._isLastPeriod=e._isLastPeriod}isStillAwaitingFutureSegments(){var e;if(!this._isDynamic)return!1;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());const{timeline:t}=this._index;if(0===t.length){if(void 0!==this._scaledPeriodEnd){const e=this._manifestBoundsCalculator.getEstimatedLiveEdge();if(void 0!==e&&eo(e,this._index)>this._scaledPeriodEnd)return!1}return this._isLastPeriod}const n=cu(this._index.timescale),i=Su(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(null!==i&&!i.isLastOfTimeline){const t=Math.min(i.end,null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0);return!(void 0!==this._scaledPeriodEnd&&t+n>=this._scaledPeriodEnd)}if(!this._isLastPeriod)return!1;if(void 0===this._scaledPeriodEnd)return!0;const r=t[t.length-1],a=Js(r,null,this._scaledPeriodEnd);return a+n<this._scaledPeriodEnd}isInitialized(){return!0}initialize(){j.error("A `TimelineRepresentationIndex` does not need to be initialized")}addPredictedSegments(){j.warn("Cannot add predicted segments to a `TimelineRepresentationIndex`")}static isTimelineIndexArgument(e){return"function"===typeof e.timelineParser||Array.isArray(e.timeline)}_refreshTimeline(){if(null===this._index.timeline&&(this._index.timeline=this._getTimeline()),!this._isDynamic)return;const e=this._manifestBoundsCalculator.getEstimatedMinimumSegmentTime();if(r(e))return;const t=eo(e,this._index),n=ho(this._index.timeline,t);void 0!==this._index.startNumber?this._index.startNumber+=n:void 0!==this._index.endNumber&&(this._index.startNumber=n+1)}_getTimeline(){if(null===this._parseTimeline)return null!==this._index.timeline?this._index.timeline:(j.error("DASH: Timeline already lazily parsed."),[]);const e=this._parseTimeline();this._parseTimeline=null;const{MIN_DASH_S_ELEMENTS_TO_PARSE_UNSAFELY:t}=N.getCurrent();if(null===this._unsafelyBaseOnPreviousIndex||e.length<t)return yu(pu(e),this._index.startNumber,this._index.endNumber);let n;return null===this._unsafelyBaseOnPreviousIndex._index.timeline?(n=this._unsafelyBaseOnPreviousIndex._getTimeline(),this._unsafelyBaseOnPreviousIndex._index.timeline=n):n=this._unsafelyBaseOnPreviousIndex._index.timeline,this._unsafelyBaseOnPreviousIndex=null,yu(mu(e,n),this._index.startNumber,this._index.endNumber)}}function yu(e,t,n){if(void 0===n)return e;let i=null!==t&&void 0!==t?t:1;for(let r=0;r<e.length;r++){const t=e[r];if(i+=t.repeatCount+1,i>n){if(i===n+1)return e.slice(0,r+1);{const a=e.slice(0,r),s=Object.assign({},t),o=i-t.repeatCount-1;return s.repeatCount=Math.max(0,n-o),a.push(s),a}}}return e}function bu(e,t,n,i){const a=Su(t,n,i);if(null===a)return!1;for(let s=0;s<t.timeline.length;s++){if(a.timelineIdx<s)return!1;const n=t.timeline[s],i=(n.start-t.indexTimeOffset)/t.timescale;if(i>e.time)return!1;if(i===e.time)return void 0===n.range?void 0===e.range:!r(e.range)&&n.range[0]===e.range[0]&&n.range[1]===e.range[1];if(n.repeatCount>=0&&void 0!==n.duration){const e=i-n.start,t=e/n.duration-1;return t%1===0&&t<=a.newRepeatCount}}return!1}function Su(e,t,n){if(e.timeline.length<=0)return null;if(e.availabilityTimeOffset===1/0){const t=e.timeline.length-1,i=e.timeline[t];return{isLastOfTimeline:!0,timelineIdx:t,newRepeatCount:i.repeatCount,end:Js(i,null,n)}}const i=t.getEstimatedMaximumPosition(e.availabilityTimeOffset);if(void 0===i){const t=e.timeline.length-1,i=e.timeline[t];return{isLastOfTimeline:!0,timelineIdx:t,newRepeatCount:i.repeatCount,end:Js(i,null,n)}}for(let r=e.timeline.length-1;r>=e.timeline.length;r--){const t=e.timeline[r],a=t.start+t.duration;if(to(a,e)<=i){const s=Js(t,e.timeline[r+1],n);if(to(s,e)<=i)return{isLastOfTimeline:r===e.timeline.length-1,timelineIdx:r,newRepeatCount:t.repeatCount,end:a};{const n=eo(i,e),a=n-t.start,s=Math.floor(a/t.duration);return fe(s>=1),{isLastOfTimeline:!1,timelineIdx:r,newRepeatCount:s-1,end:t.start+s*t.duration}}}}return null}var Tu=vu;class _u{constructor(e,t){var n,i,a;const{availabilityTimeOffset:s,manifestBoundsCalculator:o,isDynamic:l,periodEnd:u,periodStart:c,representationId:d,representationBitrate:h,isEMSGWhitelisted:f}=t,p=null!==(n=e.timescale)&&void 0!==n?n:1;this._availabilityTimeOffset=s,this._manifestBoundsCalculator=o;const g=null!==(i=e.presentationTimeOffset)&&void 0!==i?i:0,m=c*p,v=g-m;if(void 0===e.duration)throw new Error("Invalid SegmentTemplate: no duration");const y=void 0===(null===(a=e.initialization)||void 0===a?void 0:a.media)?null:nu(e.initialization.media,d,h),b=void 0===e.media?null:nu(e.media,d,h);this._index={duration:e.duration,timescale:p,indexRange:e.indexRange,indexTimeOffset:v,initialization:r(e.initialization)?void 0:{url:y,range:e.initialization.range},url:b,presentationTimeOffset:g,startNumber:e.startNumber,endNumber:e.endNumber},this._isDynamic=l,this._periodStart=c,this._scaledRelativePeriodEnd=void 0===u?void 0:(u-c)*p,this._isEMSGWhitelisted=f}getInitSegment(){return Jl(this._index,this._isEMSGWhitelisted)}getSegments(e,t){const n=this._index,{duration:i,startNumber:a,endNumber:s,timescale:o,url:l}=n,u=this._periodStart*o,c=this._scaledRelativePeriodEnd,d=e*o-u,h=(e+t)*o-u,f=this._getFirstSegmentStart(),p=this._getLastSegmentStart();if(r(f)||r(p))return[];const g=Math.max(f,d),m=Math.min(p,h);if(m+i<=g)return[];const v=[],y=null!==a&&void 0!==a?a:1;let b=Math.floor(g/i);for(let S=b*i;S<=m;S+=i){const e=b+y;if(void 0!==s&&e>s)return v;const t=!r(c)&&S+i>c?c-S:i,a=S+u,d=S+this._index.presentationTimeOffset,h=null===l?null:ru(d,e)(l),f={id:String(e),number:e,time:a/o,end:(a+t)/o,duration:t/o,timescale:1,isInit:!1,scaledDuration:t/o,url:h,timestampOffset:-n.indexTimeOffset/o,complete:!0,privateInfos:{isEMSGWhitelisted:this._isEMSGWhitelisted}};v.push(f),b++}return v}getFirstAvailablePosition(){const e=this._getFirstSegmentStart();return r(e)?e:e/this._index.timescale+this._periodStart}getLastAvailablePosition(){const e=this._getLastSegmentStart();if(r(e))return e;const t=this._estimateRelativeScaledEnd(),n=Math.min(e+this._index.duration,null!==t&&void 0!==t?t:1/0);return n/this._index.timescale+this._periodStart}getEnd(){if(!this._isDynamic)return this.getLastAvailablePosition();const e=this._estimateRelativeScaledEnd();if(void 0===e)return;const{timescale:t}=this._index,n=e+this._periodStart*t;return n/t}awaitSegmentBetween(e,t){if(fe(e<=t),!this._isDynamic)return!1;const{timescale:n}=this._index,i=cu(n),a=this._periodStart*n,s=e*n-a,o=t*n-a,l=this._getLastSegmentStart();if(r(l)){const e=this._estimateRelativeScaledEnd();return void 0===e?o+i>=0:o+i>=0&&s<e-i}const u=l+this._index.duration,c=this._estimateRelativeScaledEnd();return void 0===c?o>u-i:o>u-i&&s<c-i}shouldRefresh(){return!1}checkDiscontinuity(){return null}isSegmentStillAvailable(e){if(e.isInit)return!0;const t=this.getSegments(e.time,.1);return 0!==t.length&&(t[0].time===e.time&&t[0].end===e.end&&t[0].number===e.number)}canBeOutOfSyncError(){return!1}isStillAwaitingFutureSegments(){if(!this._isDynamic)return!1;const e=this._estimateRelativeScaledEnd();if(void 0===e)return!0;const{timescale:t}=this._index,n=this._getLastSegmentStart();if(r(n))return!0;const i=n+this._index.duration,a=cu(t);return i+a<e}isInitialized(){return!0}initialize(){j.error("A `TemplateRepresentationIndex` does not need to be initialized")}addPredictedSegments(){j.warn("Cannot add predicted segments to a `TemplateRepresentationIndex`")}_replace(e){this._index=e._index,this._isDynamic=e._isDynamic,this._periodStart=e._periodStart,this._scaledRelativePeriodEnd=e._scaledRelativePeriodEnd,this._manifestBoundsCalculator=e._manifestBoundsCalculator}_update(e){this._replace(e)}_getFirstSegmentStart(){var e;if(!this._isDynamic)return 0;if(0===this._scaledRelativePeriodEnd||void 0===this._scaledRelativePeriodEnd){const t=this._manifestBoundsCalculator.getEstimatedMaximumPosition(null!==(e=this._availabilityTimeOffset)&&void 0!==e?e:0);if(void 0!==t&&t<this._periodStart)return null}const{duration:t,timescale:n}=this._index,i=this._manifestBoundsCalculator.getEstimatedMinimumSegmentTime();if(void 0===i)return;const r=i>this._periodStart?(i-this._periodStart)*n:0,a=Math.floor(r/t);return a*t}_getLastSegmentStart(){var e,t;const{duration:n,timescale:i,endNumber:r,startNumber:a=1}=this._index;if(this._isDynamic){const t=this._manifestBoundsCalculator.getEstimatedLiveEdge();if(void 0!==t&&void 0!==this._scaledRelativePeriodEnd&&this._scaledRelativePeriodEnd<t-this._periodStart*this._index.timescale){let e=Math.ceil(this._scaledRelativePeriodEnd/n);return void 0!==r&&r-a+1<e&&(e=r-a+1),(e-1)*n}const s=this._manifestBoundsCalculator.getEstimatedMaximumPosition(null!==(e=this._availabilityTimeOffset)&&void 0!==e?e:0);if(void 0===s)return;const o=(s-this._periodStart)*i;if(o<0)return null;let l=Math.floor(o/n);return void 0!==r&&r-a+1<l&&(l=r-a+1),l<=0?null:(l-1)*n}{const e=null!==(t=this._scaledRelativePeriodEnd)&&void 0!==t?t:0;let s=Math.ceil(e/n);void 0!==r&&r-a+1<s&&(s=r-a+1);const o=(s-1)*n,l=N.getCurrent().MINIMUM_SEGMENT_SIZE*i;return void 0!==r||e-o>l||s<2?o:(s-2)*n}}_estimateRelativeScaledEnd(){var e,t;if(void 0!==this._index.endNumber){const n=this._index.endNumber-(null!==(e=this._index.startNumber)&&void 0!==e?e:1)+1;return Math.max(Math.min(n*this._index.duration,null!==(t=this._scaledRelativePeriodEnd)&&void 0!==t?t:1/0),0)}if(void 0!==this._scaledRelativePeriodEnd)return Math.max(this._scaledRelativePeriodEnd,0)}}function wu(e,t){var n,i,r;const{availabilityTimeOffset:a,manifestBoundsCalculator:s,isDynamic:o,end:l,start:u,receivedTime:c,unsafelyBaseOnPreviousRepresentation:d,inbandEventStreams:h,isLastPeriod:f}=t,p=e=>{return void 0!==h&&h.some(({schemeIdUri:t})=>t===e.schemeIdUri)},g={availabilityTimeComplete:void 0,availabilityTimeOffset:a,unsafelyBaseOnPreviousRepresentation:d,isEMSGWhitelisted:p,isLastPeriod:f,manifestBoundsCalculator:s,isDynamic:o,periodEnd:l,periodStart:u,receivedTime:c,representationBitrate:e.attributes.bitrate,representationId:e.attributes.id};let m;if(void 0!==e.children.segmentBase){const{segmentBase:t}=e.children;m=new lu(t,g)}else if(void 0!==e.children.segmentList){const{segmentList:t}=e.children;m=new uu(t,g)}else if(void 0!==e.children.segmentTemplate||t.parentSegmentTemplates.length>0){const a=t.parentSegmentTemplates.slice(),s=e.children.segmentTemplate;void 0!==s&&a.push(s);const o=M({},...a);void 0===o.availabilityTimeOffset&&void 0===t.availabilityTimeOffset||(g.availabilityTimeOffset=(null!==(n=o.availabilityTimeOffset)&&void 0!==n?n:0)+(null!==(i=t.availabilityTimeOffset)&&void 0!==i?i:0)),void 0===o.availabilityTimeComplete&&void 0===t.availabilityTimeComplete||(g.availabilityTimeComplete=null!==(r=o.availabilityTimeComplete)&&void 0!==r?r:t.availabilityTimeComplete),m=Tu.isTimelineIndexArgument(o)?new Tu(o,g):new _u(o,g)}else{const e=t.adaptation.children;if(void 0!==e.segmentBase){const{segmentBase:t}=e;m=new lu(t,g)}else if(void 0!==e.segmentList){const{segmentList:t}=e;m=new uu(t,g)}else m=new _u({duration:Number.MAX_VALUE,timescale:1,startNumber:0,media:""},g)}return m}function Eu(e,t){var n;if(0===t.length)return e;const i=t.map(e=>{return{url:e.value}});if(0===e.length)return i;const r=[];for(let a=0;a<e.length;a++){const t=e[a];for(let e=0;e<i.length;e++){const a=i[e],s=_s(t.url,a.url);r.push({url:s,serviceLocation:null!==(n=a.serviceLocation)&&void 0!==n?n:t.serviceLocation})}}return r}function xu(e,t){const n=[];if(void 0!==e.children.inbandEventStreams&&n.push(...e.children.inbandEventStreams),void 0!==t.children.inbandEventStreams&&n.push(...t.children.inbandEventStreams),0!==n.length)return n}function Au({adaptationProfiles:e,essentialProperties:t,supplementalProperties:n,manifestProfiles:i,codecs:r}){const a=(null!==e&&void 0!==e?e:"")+(null!==i&&void 0!==i?i:"");if(-1!==a.indexOf("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10")&&("hvc1.2.4.L153.B0"===r||"hev1.2.4.L153.B0"===r))return{colorDepth:10,eotf:"pq",colorSpace:"rec2020"};const s=Re([...null!==t&&void 0!==t?t:[],...null!==n&&void 0!==n?n:[]],e=>"urn:mpeg:mpegB:cicp:TransferCharacteristics"===e.schemeIdUri);if(void 0!==s)switch(s.value){case"15":return;case"16":return{eotf:"pq"};case"18":return{eotf:"hlg"}}return void 0!==r&&/^vp(08|09|10)/.exec(r)?Zl(r):void 0}function ku(e,t,n){var i,r,a,s,o,l,u;const c=[];for(const d of e){let e=void 0!==d.attributes.id?d.attributes.id:String(d.attributes.bitrate)+(void 0!==d.attributes.height?`-${d.attributes.height}`:"")+(void 0!==d.attributes.width?`-${d.attributes.width}`:"")+(void 0!==d.attributes.mimeType?`-${d.attributes.mimeType}`:"")+(void 0!==d.attributes.codecs?`-${d.attributes.codecs}`:"");while(c.some(t=>t.id===e))e+="-dup";const h=null!==(r=null===(i=n.unsafelyBaseOnPreviousAdaptation)||void 0===i?void 0:i.getRepresentation(e))&&void 0!==r?r:null,f=xu(d,t),p=null!==(a=d.attributes.availabilityTimeComplete)&&void 0!==a?a:n.availabilityTimeComplete;let g;void 0===d.attributes.availabilityTimeOffset&&void 0===n.availabilityTimeOffset||(g=(null!==(s=d.attributes.availabilityTimeOffset)&&void 0!==s?s:0)+(null!==(o=n.availabilityTimeOffset)&&void 0!==o?o:0));const m=M({},n,{availabilityTimeOffset:g,availabilityTimeComplete:p,unsafelyBaseOnPreviousRepresentation:h,adaptation:t,inbandEventStreams:f}),v=wu(d,m);let y;void 0===d.attributes.bitrate?(j.warn("DASH: No usable bitrate found in the Representation."),y=0):y=d.attributes.bitrate;const b=Eu(n.baseURLs,d.children.baseURLs),S=0===b.length?[{baseUrl:"",id:void 0}]:b.map(e=>({baseUrl:e.url,id:e.serviceLocation})),T={bitrate:y,cdnMetadata:S,index:v,id:e};let _,w;void 0!==d.children.supplementalProperties&&Re(d.children.supplementalProperties,e=>"tag:dolby.com,2018:dash:EC3_ExtensionType:2018"===e.schemeIdUri&&"JOC"===e.value)&&(T.isSpatialAudio=!0),void 0!==d.attributes.codecs?_=d.attributes.codecs:void 0!==t.attributes.codecs&&(_=t.attributes.codecs),void 0!==_&&(_="mp4a.40.02"===_?"mp4a.40.2":_,T.codecs=_),void 0!==d.attributes.supplementalCodecs?w=d.attributes.supplementalCodecs:void 0!==t.attributes.supplementalCodecs&&(w=t.attributes.supplementalCodecs),void 0!==w&&(T.supplementalCodecs=Ql(w)),void 0!==d.attributes.frameRate?T.frameRate=d.attributes.frameRate:void 0!==t.attributes.frameRate&&(T.frameRate=t.attributes.frameRate),void 0!==d.attributes.height?T.height=d.attributes.height:void 0!==t.attributes.height&&(T.height=t.attributes.height),void 0!==d.attributes.mimeType?T.mimeType=d.attributes.mimeType:void 0!==t.attributes.mimeType&&(T.mimeType=t.attributes.mimeType),void 0!==d.attributes.width?T.width=d.attributes.width:void 0!==t.attributes.width&&(T.width=t.attributes.width);{const e=[...null!==(l=t.children.contentProtections)&&void 0!==l?l:[],...null!==(u=d.children.contentProtections)&&void 0!==u?u:[]];for(const t of e)n.contentProtectionParser.add(T,t)}T.hdrInfo=Au({adaptationProfiles:t.attributes.profiles,supplementalProperties:t.children.supplementalProperties,essentialProperties:t.children.essentialProperties,manifestProfiles:n.manifestProfiles,codecs:_}),c.push(T)}return c}function Iu(e){if(void 0===e)return!1;const t="urn:tva:metadata:cs:AudioPurposeCS:2007"===e.schemeIdUri&&"1"===e.value,n="urn:mpeg:dash:role:2011"===e.schemeIdUri&&"description"===e.value;return t||n}function Cu(e,t){if(void 0!==e){const t=e.some(e=>"urn:tva:metadata:cs:AudioPurposeCS:2007"===e.schemeIdUri&&"2"===e.value);if(t)return!0}if(void 0!==t){const e=t.some(e=>"urn:mpeg:dash:role:2011"===e.schemeIdUri&&"caption"===e.value);if(e)return!0}return!1}function Ru(e){return void 0!==e&&("urn:mpeg:dash:role:2011"===e.schemeIdUri&&"sign"===e.value)}function Mu(e,t){if(Ot(e.attributes.id))return e.attributes.id;const{isClosedCaption:n,isForcedSubtitle:i,isAudioDescription:r,isSignInterpreted:a,isTrickModeTrack:s,type:o}=t;let l=o;return Ot(e.attributes.language)&&(l+=`-${e.attributes.language}`),!0===n&&(l+="-cc"),!0===i&&(l+="-cc"),!0===r&&(l+="-ad"),!0===a&&(l+="-si"),s&&(l+="-trickMode"),Ot(e.attributes.contentType)&&(l+=`-${e.attributes.contentType}`),Ot(e.attributes.codecs)&&(l+=`-${e.attributes.codecs}`),Ot(e.attributes.mimeType)&&(l+=`-${e.attributes.mimeType}`),void 0!==e.attributes.frameRate&&(l+=`-${String(e.attributes.frameRate)}`),l}function Du(e){if(!r(e.children.supplementalProperties)){const{supplementalProperties:t}=e.children;for(const e of t)if("urn:mpeg:dash:adaptation-set-switching:2016"===e.schemeIdUri&&!r(e.value))return e.value.split(",").map(e=>e.trim()).filter(e=>e)}return[]}function Lu(e,t){var n,i,a,s,o,l,u;const c={video:[],audio:[],text:[]},d=[],h={},f=[];for(let g=0;g<e.length;g++){const p=e[g],m=p.children,{essentialProperties:v,roles:y,label:b}=m,S=Array.isArray(y)&&y.some(e=>"main"===e.value)&&y.some(e=>"urn:mpeg:dash:role:2011"===e.schemeIdUri),T=p.children.representations,_=null!==(n=p.attributes.availabilityTimeComplete)&&void 0!==n?n:t.availabilityTimeComplete;let w;void 0===p.attributes.availabilityTimeOffset&&void 0===t.availabilityTimeOffset||(w=(null!==(i=p.attributes.availabilityTimeOffset)&&void 0!==i?i:0)+(null!==(a=t.availabilityTimeOffset)&&void 0!==a?a:0));const E=p.attributes.mimeType,x=p.attributes.codecs,A=Yl(T,Ot(E)?E:null,Ot(x)?x:null,r(m.roles)?null:m.roles);if(void 0===A)continue;const k=null!==(s=p.attributes.selectionPriority)&&void 0!==s?s:1,I=p.attributes.id,C=Du(p),R=[];void 0!==t.segmentTemplate&&R.push(t.segmentTemplate),void 0!==p.children.segmentTemplate&&R.push(p.children.segmentTemplate);const M={availabilityTimeComplete:_,availabilityTimeOffset:w,baseURLs:Eu(t.baseURLs,m.baseURLs),contentProtectionParser:t.contentProtectionParser,manifestBoundsCalculator:t.manifestBoundsCalculator,end:t.end,isDynamic:t.isDynamic,isLastPeriod:t.isLastPeriod,manifestProfiles:t.manifestProfiles,parentSegmentTemplates:R,receivedTime:t.receivedTime,start:t.start,unsafelyBaseOnPreviousAdaptation:null},D=Array.isArray(v)?Re(v,e=>{return"http://dashif.org/guidelines/trickmode"===e.schemeIdUri}):void 0,L=null===(o=null===D||void 0===D?void 0:D.value)||void 0===o?void 0:o.split(" "),P=void 0!==L,{accessibilities:O}=m;let N,U,F,B,V;void 0!==y&&y.some(e=>"dub"===e.value)&&(N=!0),U="text"===A&&Cu(O,y),"text"===A&&void 0!==y&&y.some(e=>"forced-subtitle"===e.value||"forced_subtitle"===e.value)&&(F=!0),"audio"!==A?B=!1:void 0!==O&&(B=O.some(Iu)),"video"!==A?V=!1:void 0!==O&&(V=O.some(Ru));let G=Mu(p,{isAudioDescription:B,isForcedSubtitle:F,isClosedCaption:U,isSignInterpreted:V,isTrickModeTrack:P,type:A});while(gt(f,G))G+="-dup";const H=G;f.push(G),M.unsafelyBaseOnPreviousAdaptation=null!==(u=null===(l=t.unsafelyBaseOnPreviousPeriod)||void 0===l?void 0:l.getAdaptation(G))&&void 0!==u?u:null;const z=ku(T,p,M),K={id:G,representations:z,type:A,isTrickModeTrack:P};if(r(p.attributes.language)||(K.language=p.attributes.language),r(U)||(K.closedCaption=U),r(B)||(K.audioDescription=B),!0===N&&(K.isDub=!0),void 0!==F&&(K.forcedSubtitles=F),!0===V&&(K.isSignInterpreted=!0),void 0!==b&&(K.label=b),void 0!==L)d.push({adaptation:K,trickModeAttachedAdaptationIds:L});else{let e=-1;for(const t of C){const n=h[t];if(void 0!==n&&n.newID!==H&&gt(n.adaptationSetSwitchingIDs,I)){e=le(c[A],e=>e[0].id===t);const n=c[A][e];if(void 0!==n&&n[0].audioDescription===K.audioDescription&&n[0].closedCaption===K.closedCaption&&n[0].language===K.language){j.info('DASH Parser: merging "switchable" AdaptationSets',I,t),n[0].representations.push(...K.representations),n[1]={priority:Math.max(k,n[1].priority),isMainAdaptation:S||n[1].isMainAdaptation,indexInMpd:Math.min(g,n[1].indexInMpd)};break}}}e<0&&c[A].push([K,{priority:k,isMainAdaptation:S,indexInMpd:g}])}!r(I)&&r(h[I])&&(h[I]={newID:H,adaptationSetSwitchingIDs:C})}const p=bt.reduce((e,t)=>{const n=c[t];return n.length>0&&(n.sort(Pu),e[t]=n.map(([e])=>e)),e},{});return c.video.sort(Pu),Wl(p,d),p}function Pu(e,t){const n=t[1].priority-e[1].priority;return 0!==n?n:e[1].isMainAdaptation!==t[1].isMainAdaptation?e[1].isMainAdaptation?-1:1:e[1].indexInMpd-t[1].indexInMpd}const Ou=pt();function Nu(e,t){var n,i,a,s,o;const l=[],u=Kl(e,t);if(u.length!==e.length)throw new Error("MPD parsing error: the time information are incoherent.");const{isDynamic:c,manifestBoundsCalculator:d}=t;c||r(t.duration)||d.setLastPosition(t.duration);for(let h=e.length-1;h>=0;h--){const f=h===e.length-1,p=e[h],g=t.xlinkInfos.get(p),m=Eu(t.baseURLs,p.children.baseURLs),{periodStart:v,periodDuration:y,periodEnd:b}=u[h];let S;r(p.attributes.id)?(j.warn("DASH: No usable id found in the Period. Generating one."),S="gen-dash-period-"+Ou()):S=p.attributes.id;while(l.some(e=>e.id===S))S+="-dup";const T=void 0!==g?g.receivedTime:t.receivedTime,_=null!==(i=null===(n=t.unsafelyBaseOnPreviousManifest)||void 0===n?void 0:n.getPeriod(S))&&void 0!==i?i:null,w=p.attributes.availabilityTimeComplete,E=p.attributes.availabilityTimeOffset,{manifestProfiles:x,contentProtectionParser:A}=t,{segmentTemplate:k}=p.children;A.addReferences(null!==(a=p.children.contentProtections)&&void 0!==a?a:[]);const I={availabilityTimeComplete:w,availabilityTimeOffset:E,baseURLs:m,contentProtectionParser:A,manifestBoundsCalculator:d,end:b,isDynamic:c,isLastPeriod:f,manifestProfiles:x,receivedTime:T,segmentTemplate:k,start:v,unsafelyBaseOnPreviousPeriod:_},C=Lu(p.children.adaptations,I),R=(null!==(s=t.xmlNamespaces)&&void 0!==s?s:[]).concat(null!==(o=p.attributes.namespaces)&&void 0!==o?o:[]),M=Bu(p.children.eventStreams,v,R),D={id:S,start:v,end:b,duration:y,adaptations:C,streamEvents:M};if(l.unshift(D),!d.lastPositionIsKnown()){const e=Fu(C);if(c)if("number"===typeof e){const t=_e()/1e3;d.setLastPosition(e,t)}else{const e=Uu(t,v);if(void 0!==e){const[t,n]=e;d.setLastPosition(t,n)}}else"number"===typeof e&&d.setLastPosition(e)}}if(t.isDynamic&&!d.lastPositionIsKnown()){const e=Uu(t,0);if(void 0!==e){const[t,n]=e;d.setLastPosition(t,n)}}return zl(l)}function Uu(e,t){if(r(e.clockOffset)){const n=Date.now()/1e3;if(n>=t){j.warn("DASH Parser: no clock synchronization mechanism found. Using the system clock instead.");const t=n-e.availabilityStartTime,i=_e()/1e3;return[t,i]}}else{const n=e.clockOffset/1e3-e.availabilityStartTime,i=_e()/1e3,r=i+n;if(r>=t)return[r,i]}}function Fu(e){let t=null,n=!0;const i=$e(e).filter(e=>!r(e)),a=Hl(i,e=>e);for(const s of a){const e=s.representations;for(const i of e){const e=i.index.getLastAvailablePosition();null!==e&&(n=!1,"number"===typeof e&&(t=r(t)?e:Math.max(t,e)))}}return r(t)?n?null:void 0:t}function Bu(e,t,n){var i,r;const a=[];for(const s of e){const{schemeIdUri:e="",timescale:o=1}=s.attributes,l=n.concat(null!==(i=s.attributes.namespaces)&&void 0!==i?i:[]);for(const n of s.children.events)if(void 0!==n.eventStreamData){const i=(null!==(r=n.presentationTime)&&void 0!==r?r:0)/o+t,s=void 0===n.duration?void 0:i+n.duration/o;let u,c;if(!Ka["a"]&&n.eventStreamData instanceof Element)u=n.eventStreamData;else try{c={namespaces:l,data:"string"===typeof n.eventStreamData?n.eventStreamData:Rs(new Uint8Array(n.eventStreamData))}}catch(e){j.error("DASH: Error while parsing event-stream:",e instanceof Error?e.message:"Unknown error")}a.push({start:i,end:s,id:n.id,data:{type:"dash-event-stream",value:{schemeIdUri:e,timescale:o,element:u,xmlData:c}}})}}return a}function Vu(e,t,n,i,a=new WeakMap){const{children:s,attributes:o}=e;if(r(t.externalClockOffset)){const a="dynamic"===o.type,l=Re(s.utcTimings,e=>{return"urn:mpeg:dash:utc:direct:2014"===e.schemeIdUri&&!r(e.value)}),u=r(l)||r(l.value)?void 0:Pl(l.value),c=r(u)||isNaN(u)?void 0:u;if(r(c)||!0===i){if(a&&!0!==i){const i=Ol(e);if(!r(i)&&i.length>0)return{type:"needs-clock",value:{url:i,continue:function(i){return i.success?(t.externalClockOffset=Pl(i.data),Vu(e,t,n,!0)):(n.push(i.error),j.warn("DASH Parser: Error on fetching the clock ressource",i.error),Vu(e,t,n,!0))}}}}}else t.externalClockOffset=c}const l=[];for(let u=0;u<s.periods.length;u++){const{xlinkHref:e,xlinkActuate:t}=s.periods[u].attributes;r(e)||"onLoad"!==t||l.push({index:u,ressource:e})}return 0===l.length?ju(e,t,n,a):{type:"needs-xlinks",value:{xlinksUrls:l.map(({ressource:e})=>e),continue:function(r){if(r.length!==l.length)throw new Error("DASH parser: wrong number of loaded ressources.");for(let e=r.length-1;e>=0;e--){const t=l[e].index,{parsed:i,warnings:o,receivedTime:u,sendingTime:c,url:d}=r[e];o.length>0&&n.push(...o);for(const e of i)a.set(e,{receivedTime:u,sendingTime:c,url:d});s.periods.splice(t,1,...i)}return Vu(e,t,n,i,a)}}}}function ju(e,t,n,i){var a,s,o,l,u;const{children:c,attributes:d}=e,h="dynamic"===d.type,f=void 0!==t.url?[{url:t.url.substring(0,fs(t.url))}]:[],p=Eu(f,c.baseURLs),g=Gl(d,t.referenceDateTime),m=d.timeShiftBufferDepth,{externalClockOffset:v,unsafelyBaseOnPreviousManifest:y}=t,{externalClockOffset:b}=t,S=new jl({availabilityStartTime:g,isDynamic:h,timeShiftBufferDepth:m,serverTimestampOffset:b}),T=new Dl;T.addReferences(null!==(a=c.contentProtections)&&void 0!==a?a:[]);const _={availabilityStartTime:g,baseURLs:p,clockOffset:v,contentProtectionParser:T,duration:d.duration,isDynamic:h,manifestBoundsCalculator:S,manifestProfiles:e.attributes.profiles,receivedTime:t.manifestReceivedTime,timeShiftBufferDepth:m,unsafelyBaseOnPreviousManifest:y,xlinkInfos:i,xmlNamespaces:e.attributes.namespaces},w=Nu(c.periods,_);T.finalize();const E=d.duration;let x,A,k,I=null;void 0!==d.minimumUpdatePeriod&&d.minimumUpdatePeriod>=0&&(x=0===d.minimumUpdatePeriod?N.getCurrent().DASH_FALLBACK_LIFETIME_WHEN_MINIMUM_UPDATE_PERIOD_EQUAL_0:d.minimumUpdatePeriod);const{minimumSafePosition:C,maximumSafePosition:R,maximumUnsafePosition:M}=Vl(w),D=_e();if(h){let e;if(void 0!==R)e=R;else if(void 0===b)j.warn("DASH Parser: use system clock to define maximum position"),e=Date.now()/1e3-g;else{const t=_e()+b;e=t/1e3-g}let t=S.getEstimatedLiveEdge();void 0===t&&(t=void 0!==M?M:e),k={isLinear:!0,maximumSafePosition:e,livePosition:t,time:D},A=C,I=null!==m&&void 0!==m?m:null,null!==I&&void 0!==A&&t-A>I&&(I=t-A)}else{A=C,void 0===A&&(A=null!==(o=null===(s=w[0])||void 0===s?void 0:s.start)&&void 0!==o?o:0);let e=null!==E&&void 0!==E?E:1/0;if(void 0!==w[w.length-1]){const t=w[w.length-1],n=null!==(l=t.end)&&void 0!==l?l:void 0!==t.duration?t.start+t.duration:void 0;void 0!==n&&n<e&&(e=n)}void 0!==R&&R<e&&(e=R),k={isLinear:!1,maximumSafePosition:e,livePosition:void 0,time:D}}const L=!h||void 0===e.attributes.minimumUpdatePeriod&&(void 0!==(null===(u=w[w.length-1])||void 0===u?void 0:u.end)||void 0!==e.attributes.duration),P={availabilityStartTime:g,clockOffset:t.externalClockOffset,isDynamic:h,isLive:h,isLastPeriodKnown:L,periods:w,publishTime:d.publishTime,suggestedPresentationDelay:d.suggestedPresentationDelay,transportType:"dash",timeBounds:{minimumSafePosition:A,timeshiftDepth:I,maximumTimeData:k},lifetime:x,uris:r(t.url)?c.locations:[t.url,...c.locations]};return{type:"done",value:{parsed:P,warnings:n}}}var Gu=Vu;function Hu(e){const t=e.textContent,n=[];return null===t||0===t.length?[void 0,n]:[{value:t},n]}const zu=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,Ku=/([0-9]+)-([0-9]+)/;function $u(e,t){if("true"===e)return[!0,null];if("false"===e)return[!1,null];const n=new ic(`\`${t}\` property is not a boolean value but "${e}"`);return[!1,n]}function Wu(e,t){const n=parseInt(e,10);if(isNaN(n)){const n=new ic(`\`${t}\` property is not an integer value but "${e}"`);return[null,n]}return[n,null]}function qu(e,t){if("INF"===e)return[1/0,null];const n=parseFloat(e);if(isNaN(n)){const n=new ic(`\`${t}\` property is invalid: "${e}"`);return[null,n]}return[n,null]}function Yu(e,t){if("true"===e)return[!0,null];if("false"===e)return[!1,null];const n=parseInt(e,10);if(isNaN(n)){const n=new ic(`\`${t}\` property is not a boolean nor an integer but "${e}"`);return[null,n]}return[n,null]}function Xu(e,t){const n=Date.parse(e);if(isNaN(n)){const n=new ic(`\`${t}\` is in an invalid date format: "${e}"`);return[null,n]}return[new Date(Date.parse(e)).getTime()/1e3,null]}function Qu(e,t){if(!Ot(e)){const e=new ic(`\`${t}\` property is empty`);return[0,e]}const n=zu.exec(e);if(null===n){const n=new ic(`\`${t}\` property has an unrecognized format "${e}"`);return[null,n]}const i=365*parseFloat(Ot(n[2])?n[2]:"0")*24*60*60+30*parseFloat(Ot(n[4])?n[4]:"0")*24*60*60+24*parseFloat(Ot(n[6])?n[6]:"0")*60*60+60*parseFloat(Ot(n[8])?n[8]:"0")*60+60*parseFloat(Ot(n[10])?n[10]:"0")+parseFloat(Ot(n[12])?n[12]:"0");return[i,null]}function Zu(e,t){const n=Ku.exec(e);if(null===n){const n=new ic(`\`${t}\` property has an unrecognized format "${e}"`);return[null,n]}return[[+n[1],+n[2]],null]}function Ju(e,t){try{return[qs(e),null]}catch(n){const i=new ic(`\`${t}\` is not a valid base64 string: "${e}"`);return[null,i]}}function ec(e,t){const n=/^(\d+)\/(\d+)$/.exec(e);return null!==n?[+n[1]/+n[2],null]:qu(e,t)}function tc(e){let t,n;for(let i=0;i<e.attributes.length;i++){const r=e.attributes[i];switch(r.name){case"schemeIdUri":t=r.value;break;case"value":n=r.value;break}}return{schemeIdUri:t,value:n}}function nc(e,t){return function(n,{asKey:i,parser:r,dashName:a}){const[s,o]=r(n,a);null!==o&&(j.warn(o.message),t.push(o)),null!==s&&(e[i]=s)}}class ic extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ic.prototype),this.name="MPDError"}}function rc(e){const t=[],n=[];for(let i=0;i<e.length;i++)if(e[i].nodeType===Node.ELEMENT_NODE){const r=e[i];if("cenc:pssh"===r.nodeName){const e=r.textContent;if(null!==e&&e.length>0){const[i,r]=Ju(e,"cenc:pssh");null!==r&&(j.warn(r.message),t.push(r)),null!==i&&n.push(i)}}}return[{cencPssh:n},t]}function ac(e){const t={};for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];switch(i.name){case"schemeIdUri":t.schemeIdUri=i.value;break;case"value":t.value=i.value;break;case"cenc:default_KID":t.keyId=Ms(i.value.replace(/-/g,""));break;case"ref":t.ref=i.value;break;case"refId":t.refId=i.value;break}}return t}function sc(e){const[t,n]=rc(e.childNodes),i=ac(e);return[{children:t,attributes:i},n]}function oc(e){const t={};for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];switch(i.name){case"id":t.id=i.value;break;case"lang":t.language=i.value;break;case"contentType":t.contentType=i.value;break;case"par":t.par=i.value;break}}return t}function lc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"range":i(n.value,{asKey:"range",parser:Zu,dashName:"range"});break;case"sourceURL":t.media=n.value;break}}return[t,n]}function uc(e){const t={};let n=[];const i=nc(t,n),r=e.childNodes;for(let a=0;a<r.length;a++)if(r[a].nodeType===Node.ELEMENT_NODE){const e=r[a];if("Initialization"===e.nodeName){const[i,r]=lc(e);t.initialization=i,n=n.concat(r)}}for(let a=0;a<e.attributes.length;a++){const t=e.attributes[a];switch(t.name){case"timescale":i(t.value,{asKey:"timescale",parser:Wu,dashName:"timescale"});break;case"presentationTimeOffset":i(t.value,{asKey:"presentationTimeOffset",parser:qu,dashName:"presentationTimeOffset"});break;case"indexRange":i(t.value,{asKey:"indexRange",parser:Zu,dashName:"indexRange"});break;case"indexRangeExact":i(t.value,{asKey:"indexRangeExact",parser:$u,dashName:"indexRangeExact"});break;case"availabilityTimeOffset":i(t.value,{asKey:"availabilityTimeOffset",parser:qu,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":i(t.value,{asKey:"availabilityTimeComplete",parser:$u,dashName:"availabilityTimeComplete"});break;case"duration":i(t.value,{asKey:"duration",parser:Wu,dashName:"duration"});break;case"startNumber":i(t.value,{asKey:"startNumber",parser:Wu,dashName:"startNumber"});break;case"endNumber":i(t.value,{asKey:"endNumber",parser:Wu,dashName:"endNumber"});break}}return[t,n]}function cc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"media":t.media=n.value;break;case"indexRange":i(n.value,{asKey:"indexRange",parser:Zu,dashName:"indexRange"});break;case"index":t.index=n.value;break;case"mediaRange":i(n.value,{asKey:"mediaRange",parser:Zu,dashName:"mediaRange"});break}}return[t,n]}function dc(e){const[t,n]=uc(e);let i=n;const r=[],a=e.childNodes;for(let o=0;o<a.length;o++)if(a[o].nodeType===Node.ELEMENT_NODE){const e=a[o];if("SegmentURL"===e.nodeName){const[t,n]=cc(e);r.push(t),i=i.concat(n)}}const s=M(t,{list:r});return[s,i]}function hc(e){let t=null;return function(){if(null===t){const n=e.getElementsByTagName("S");return t=n,n}return t}}function fc(e){const[t,n]=uc(e),i=n;let a;for(let r=0;r<e.childNodes.length;r++)if(e.childNodes[r].nodeType===Node.ELEMENT_NODE){const t=e.childNodes[r];"SegmentTimeline"===t.nodeName&&(a=hc(t))}const s=M({},t,{duration:t.duration,timelineParser:a}),o=nc(s,i);for(let l=0;l<e.attributes.length;l++){const t=e.attributes[l];switch(t.nodeName){case"initialization":r(s.initialization)&&(s.initialization={media:t.value});break;case"index":s.index=t.value;break;case"availabilityTimeOffset":o(t.value,{asKey:"availabilityTimeOffset",parser:qu,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":o(t.value,{asKey:"availabilityTimeComplete",parser:$u,dashName:"availabilityTimeComplete"});break;case"media":s.media=t.value;break;case"bitstreamSwitching":o(t.value,{asKey:"bitstreamSwitching",parser:$u,dashName:"bitstreamSwitching"});break}}return[s,i]}function pc(e){const t={baseURLs:[]},n=[];let i=[];for(let a=0;a<e.length;a++)if(e[a].nodeType===Node.ELEMENT_NODE){const s=e[a];switch(s.nodeName){case"BaseURL":const[e,a]=Hu(s);void 0!==e&&t.baseURLs.push(e),i=i.concat(a);break;case"InbandEventStream":void 0===t.inbandEventStreams&&(t.inbandEventStreams=[]),t.inbandEventStreams.push(tc(s));break;case"SegmentBase":const[o,l]=uc(s);t.segmentBase=o,l.length>0&&(i=i.concat(l));break;case"SegmentList":const[u,c]=dc(s);i=i.concat(c),t.segmentList=u;break;case"SegmentTemplate":const[d,h]=fc(s);i=i.concat(h),t.segmentTemplate=d;break;case"ContentProtection":const[f,p]=sc(s);p.length>0&&(i=i.concat(p)),void 0!==f&&n.push(f);break;case"SupplementalProperty":r(t.supplementalProperties)?t.supplementalProperties=[tc(s)]:t.supplementalProperties.push(tc(s));break}}return n.length>0&&(t.contentProtections=n),[t,i]}function gc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"audioSamplingRate":t.audioSamplingRate=n.value;break;case"bandwidth":i(n.value,{asKey:"bitrate",parser:Wu,dashName:"bandwidth"});break;case"codecs":t.codecs=n.value;break;case"codingDependency":i(n.value,{asKey:"codingDependency",parser:$u,dashName:"codingDependency"});break;case"frameRate":i(n.value,{asKey:"frameRate",parser:ec,dashName:"frameRate"});break;case"height":i(n.value,{asKey:"height",parser:Wu,dashName:"height"});break;case"id":t.id=n.value;break;case"maxPlayoutRate":i(n.value,{asKey:"maxPlayoutRate",parser:qu,dashName:"maxPlayoutRate"});break;case"maximumSAPPeriod":i(n.value,{asKey:"maximumSAPPeriod",parser:qu,dashName:"maximumSAPPeriod"});break;case"mimeType":t.mimeType=n.value;break;case"profiles":t.profiles=n.value;break;case"qualityRanking":i(n.value,{asKey:"qualityRanking",parser:Wu,dashName:"qualityRanking"});break;case"scte214:supplementalCodecs":t.supplementalCodecs=n.value;break;case"segmentProfiles":t.segmentProfiles=n.value;break;case"width":i(n.value,{asKey:"width",parser:Wu,dashName:"width"});break;case"availabilityTimeOffset":i(n.value,{asKey:"availabilityTimeOffset",parser:qu,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":i(n.value,{asKey:"availabilityTimeComplete",parser:$u,dashName:"availabilityTimeComplete"});break}}return void 0===t.bitrate&&n.push(new ic("No bitrate found on a Representation")),[t,n]}function mc(e){const[t,n]=pc(e.childNodes),[i,r]=gc(e),a=n.concat(r);return[{children:t,attributes:i},a]}function vc(e){const t={baseURLs:[],representations:[]},n=[];let i=[];for(let a=0;a<e.length;a++)if(e[a].nodeType===Node.ELEMENT_NODE){const s=e[a];switch(s.nodeName){case"Accessibility":void 0===t.accessibilities?t.accessibilities=[tc(s)]:t.accessibilities.push(tc(s));break;case"BaseURL":const[e,a]=Hu(s);void 0!==e&&t.baseURLs.push(e),a.length>0&&(i=i.concat(a));break;case"ContentComponent":t.contentComponent=oc(s);break;case"EssentialProperty":r(t.essentialProperties)?t.essentialProperties=[tc(s)]:t.essentialProperties.push(tc(s));break;case"InbandEventStream":void 0===t.inbandEventStreams&&(t.inbandEventStreams=[]),t.inbandEventStreams.push(tc(s));break;case"Label":const o=s.textContent;null!==o&&void 0!==o&&(t.label=o);break;case"Representation":const[l,u]=mc(s);t.representations.push(l),u.length>0&&(i=i.concat(u));break;case"Role":r(t.roles)?t.roles=[tc(s)]:t.roles.push(tc(s));break;case"SupplementalProperty":r(t.supplementalProperties)?t.supplementalProperties=[tc(s)]:t.supplementalProperties.push(tc(s));break;case"SegmentBase":const[c,d]=uc(s);t.segmentBase=c,d.length>0&&(i=i.concat(d));break;case"SegmentList":const[h,f]=dc(s);t.segmentList=h,f.length>0&&(i=i.concat(f));break;case"SegmentTemplate":const[p,g]=fc(s);t.segmentTemplate=p,g.length>0&&(i=i.concat(g));break;case"ContentProtection":const[m,v]=sc(s);v.length>0&&(i=i.concat(v)),void 0!==m&&n.push(m);break}}return n.length>0&&(t.contentProtections=n),[t,i]}function yc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"id":t.id=n.value;break;case"group":i(n.value,{asKey:"group",parser:Wu,dashName:"group"});break;case"lang":t.language=n.value;break;case"contentType":t.contentType=n.value;break;case"par":t.par=n.value;break;case"minBandwidth":i(n.value,{asKey:"minBitrate",parser:Wu,dashName:"minBandwidth"});break;case"maxBandwidth":i(n.value,{asKey:"maxBitrate",parser:Wu,dashName:"maxBandwidth"});break;case"minWidth":i(n.value,{asKey:"minWidth",parser:Wu,dashName:"minWidth"});break;case"maxWidth":i(n.value,{asKey:"maxWidth",parser:Wu,dashName:"maxWidth"});break;case"minHeight":i(n.value,{asKey:"minHeight",parser:Wu,dashName:"minHeight"});break;case"maxHeight":i(n.value,{asKey:"maxHeight",parser:Wu,dashName:"maxHeight"});break;case"minFrameRate":i(n.value,{asKey:"minFrameRate",parser:ec,dashName:"minFrameRate"});break;case"maxFrameRate":i(n.value,{asKey:"maxFrameRate",parser:ec,dashName:"maxFrameRate"});break;case"selectionPriority":i(n.value,{asKey:"selectionPriority",parser:Wu,dashName:"selectionPriority"});break;case"segmentAlignment":i(n.value,{asKey:"segmentAlignment",parser:Yu,dashName:"segmentAlignment"});break;case"subsegmentAlignment":i(n.value,{asKey:"subsegmentAlignment",parser:Yu,dashName:"subsegmentAlignment"});break;case"bitstreamSwitching":i(n.value,{asKey:"bitstreamSwitching",parser:$u,dashName:"bitstreamSwitching"});break;case"audioSamplingRate":t.audioSamplingRate=n.value;break;case"codecs":t.codecs=n.value;break;case"scte214:supplementalCodecs":t.supplementalCodecs=n.value;break;case"codingDependency":i(n.value,{asKey:"codingDependency",parser:$u,dashName:"codingDependency"});break;case"frameRate":i(n.value,{asKey:"frameRate",parser:ec,dashName:"frameRate"});break;case"height":i(n.value,{asKey:"height",parser:Wu,dashName:"height"});break;case"maxPlayoutRate":i(n.value,{asKey:"maxPlayoutRate",parser:qu,dashName:"maxPlayoutRate"});break;case"maximumSAPPeriod":i(n.value,{asKey:"maximumSAPPeriod",parser:qu,dashName:"maximumSAPPeriod"});break;case"mimeType":t.mimeType=n.value;break;case"profiles":t.profiles=n.value;break;case"segmentProfiles":t.segmentProfiles=n.value;break;case"width":i(n.value,{asKey:"width",parser:Wu,dashName:"width"});break;case"availabilityTimeOffset":i(n.value,{asKey:"availabilityTimeOffset",parser:qu,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":i(n.value,{asKey:"availabilityTimeComplete",parser:$u,dashName:"availabilityTimeComplete"});break}}return[t,n]}function bc(e){const t=e.childNodes,[n,i]=vc(t),[r,a]=yc(e),s=i.concat(a);return[{children:n,attributes:r},s]}function Sc(e){const t={children:{events:[]},attributes:{}};let n=[];const i=nc(t.attributes,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"schemeIdUri":t.attributes.schemeIdUri=n.value;break;case"timescale":i(n.value,{asKey:"timescale",parser:Wu,dashName:"timescale"});break;case"value":t.attributes.value=n.value;break}}for(let r=0;r<e.childNodes.length;r++)if(e.childNodes[r].nodeType===Node.ELEMENT_NODE){const i=e.childNodes[r];switch(i.nodeName){case"Event":const[e,r]=Tc(i);t.children.events.push(e),r.length>0&&(n=n.concat(r));break}}return[t,n]}function Tc(e){const t={eventStreamData:e},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"presentationTime":i(n.value,{asKey:"presentationTime",parser:Wu,dashName:"presentationTime"});break;case"duration":i(n.value,{asKey:"duration",parser:Wu,dashName:"duration"});break;case"id":t.id=n.value;break}}return[t,n]}function _c(e){const t=[],n=[];let i;const r=[];let a=[];const s=[];for(let o=0;o<e.length;o++)if(e[o].nodeType===Node.ELEMENT_NODE){const l=e[o];switch(l.nodeName){case"BaseURL":const[e,o]=Hu(l);void 0!==e&&t.push(e),a=a.concat(o);break;case"AdaptationSet":const[u,c]=bc(l);n.push(u),a=a.concat(c);break;case"EventStream":const[d,h]=Sc(l);s.push(d),a=a.concat(h);break;case"SegmentTemplate":const[f,p]=fc(l);i=f,p.length>0&&(a=a.concat(p));break;case"ContentProtection":const[g,m]=sc(l);m.length>0&&(a=a.concat(m)),void 0!==g&&r.push(g);break}}return[{baseURLs:t,adaptations:n,eventStreams:s,segmentTemplate:i,contentProtections:r},a]}function wc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"id":t.id=n.value;break;case"start":i(n.value,{asKey:"start",parser:Qu,dashName:"start"});break;case"duration":i(n.value,{asKey:"duration",parser:Qu,dashName:"duration"});break;case"bitstreamSwitching":i(n.value,{asKey:"bitstreamSwitching",parser:$u,dashName:"bitstreamSwitching"});break;case"xlink:href":t.xlinkHref=n.value;break;case"xlink:actuate":t.xlinkActuate=n.value;break}}return[t,n]}function Ec(e){const[t,n]=_c(e.childNodes),[i,r]=wc(e),a=n.concat(r);return[{children:t,attributes:i},a]}function xc(e){const t=[],n=[],i=[],r=[],a=[];let s=[];for(let o=0;o<e.length;o++)if(e[o].nodeType===Node.ELEMENT_NODE){const l=e[o];switch(l.nodeName){case"BaseURL":const[e,o]=Hu(l);void 0!==e&&t.push(e),s=s.concat(o);break;case"Location":n.push(null===l.textContent?"":l.textContent);break;case"Period":const[u,c]=Ec(l);i.push(u),s=s.concat(c);break;case"UTCTiming":const d=tc(l);r.push(d);break;case"ContentProtection":const[h,f]=sc(l);f.length>0&&(s=s.concat(f)),void 0!==h&&a.push(h);break}}return[{baseURLs:t,locations:n,periods:i,utcTimings:r,contentProtections:a},s]}function Ac(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"id":t.id=n.value;break;case"profiles":t.profiles=n.value;break;case"type":t.type=n.value;break;case"availabilityStartTime":i(n.value,{asKey:"availabilityStartTime",parser:Xu,dashName:"availabilityStartTime"});break;case"availabilityEndTime":i(n.value,{asKey:"availabilityEndTime",parser:Xu,dashName:"availabilityEndTime"});break;case"publishTime":i(n.value,{asKey:"publishTime",parser:Xu,dashName:"publishTime"});break;case"mediaPresentationDuration":i(n.value,{asKey:"duration",parser:Qu,dashName:"mediaPresentationDuration"});break;case"minimumUpdatePeriod":i(n.value,{asKey:"minimumUpdatePeriod",parser:Qu,dashName:"minimumUpdatePeriod"});break;case"minBufferTime":i(n.value,{asKey:"minBufferTime",parser:Qu,dashName:"minBufferTime"});break;case"timeShiftBufferDepth":i(n.value,{asKey:"timeShiftBufferDepth",parser:Qu,dashName:"timeShiftBufferDepth"});break;case"suggestedPresentationDelay":i(n.value,{asKey:"suggestedPresentationDelay",parser:Qu,dashName:"suggestedPresentationDelay"});break;case"maxSegmentDuration":i(n.value,{asKey:"maxSegmentDuration",parser:Qu,dashName:"maxSegmentDuration"});break;case"maxSubsegmentDuration":i(n.value,{asKey:"maxSubsegmentDuration",parser:Qu,dashName:"maxSubsegmentDuration"});break}}return[t,n]}function kc(e){const[t,n]=xc(e.childNodes),[i,r]=Ac(e),a=n.concat(r);return[{children:t,attributes:i},a]}function Ic(e,t){const n=e.documentElement;if(r(n)||"MPD"!==n.nodeName)throw new Error("DASH Parser: document root should be MPD");const[i,a]=kc(n),s=Gu(i,t,a);return o(s);function o(e){return"done"===e.type?e:"needs-clock"===e.type?{type:"needs-resources",value:{urls:[e.value.url],format:"string",continue(t){if(1!==t.length)throw new Error("DASH parser: wrong number of loaded ressources.");const n=e.value.continue(t[0].responseData);return o(n)}}}:"needs-xlinks"===e.type?{type:"needs-resources",value:{urls:e.value.xlinksUrls,format:"string",continue(t){const n=[];for(let e=0;e<t.length;e++){const{responseData:i,receivedTime:a,sendingTime:s,url:o}=t[e];if(!i.success)throw i.error;const l="<root>"+i.data+"</root>",u=(new DOMParser).parseFromString(l,"text/xml");if(r(u)||0===u.children.length)throw new Error("DASH parser: Invalid external ressources");const c=u.children[0].children,d=[],h=[];for(let e=0;e<c.length;e++)if(c[e].nodeType===Node.ELEMENT_NODE){const[t,n]=Ec(c[e]);h.push(...n),d.push(t)}n.push({url:o,receivedTime:a,sendingTime:s,parsed:d,warnings:h})}const i=e.value.continue(n);return o(i)}}}:void ge(e)}}var Cc=Ic;function Rc(e){const{referenceDateTime:t}=e,n=void 0!==e.serverSyncInfos?e.serverSyncInfos.serverTimestamp-e.serverSyncInfos.clientTime:void 0;return function(i,r,a,s,o){var l;const{responseData:u}=i,c=r.externalClockOffset,d=null!==(l=i.url)&&void 0!==l?l:r.originalUrl,h=null!==n&&void 0!==n?n:c,f=r.unsafeMode?r.previousManifest:null,p={unsafelyBaseOnPreviousManifest:f,url:d,referenceDateTime:t,externalClockOffset:h},g=$t.dashParsers;if(null===g.wasm||"uninitialized"===g.wasm.status||"failure"===g.wasm.status)return j.debug("DASH: WASM MPD Parser not initialized. Running JS one."),m();{const e=Oc(u);if(!Nc(e))return j.info("DASH: MPD doesn't seem to be UTF-8-encoded. Running JS parser instead of the WASM one."),m();if("initialized"===g.wasm.status){j.debug("DASH: Running WASM MPD Parser.");const t=g.wasm.runWasmParser(e,p);return v(t)}{j.debug("DASH: Awaiting WASM initialization before parsing the MPD.");const t=g.wasm.waitForInitialization().catch(()=>{});return t.then(()=>{if(null===g.wasm||"initialized"!==g.wasm.status)return j.warn("DASH: WASM MPD parser initialization failed. Running JS parser instead"),m();j.debug("DASH: Running WASM MPD Parser.");const t=g.wasm.runWasmParser(e,p);return v(t)})}}function m(){if(null!==g.fastJs){const e=Lc(u),t=g.fastJs(e,p);return v(t)}if(null!==g.native){const e=Pc(u),t=g.native(e,p);return v(t)}throw new Error("No MPD parser is imported")}function v(t){if("done"===t.type){if(t.value.warnings.length>0&&a(t.value.warnings),s.isCancelled())return Promise.reject(s.cancellationError);const n=[],i=new sn(t.value.parsed,e,n);return{manifest:i,url:d,warnings:n}}const{value:n}=t,i=n.urls.map(e=>{return o(()=>{const t=N.getCurrent().DEFAULT_REQUEST_TIMEOUT,i=N.getCurrent().DEFAULT_CONNECTION_TIMEOUT;return"string"===n.format?ko({url:e,responseType:"text",timeout:t,connectionTimeout:i,cancelSignal:s}):ko({url:e,responseType:"arraybuffer",timeout:t,connectionTimeout:i,cancelSignal:s})}).then(e=>{if("string"===n.format){if("string"!==typeof e.responseData)throw new Error("External DASH resources should have been a string");return M(e,{responseData:{success:!0,data:e.responseData}})}if(!(e.responseData instanceof ArrayBuffer))throw new Error("External DASH resources should have been ArrayBuffers");return M(e,{responseData:{success:!0,data:e.responseData}})},e=>{const t=ft(e,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"An unknown error occured when parsing ressources."});return M({},{size:void 0,requestDuration:void 0,responseData:{success:!1,error:t}})})});return Promise.all(i).then(e=>{return"string"===n.format?(Mc(e),v(n.continue(e))):(Dc(e),v(n.continue(e)))})}}}function Mc(e){}function Dc(e){}function Lc(e){if(e instanceof ArrayBuffer)return Rs(new Uint8Array(e));if("string"===typeof e)return e;if(e instanceof Document)return e.documentElement.outerHTML;throw new Error("DASH Manifest Parser: Unrecognized Manifest format")}function Pc(e){if(e instanceof ArrayBuffer)return(new DOMParser).parseFromString(Rs(new Uint8Array(e)),"text/xml");if("string"===typeof e)return(new DOMParser).parseFromString(e,"text/xml");if(e instanceof Document)return e;throw new Error("DASH Manifest Parser: Unrecognized Manifest format")}function Oc(e){if(e instanceof ArrayBuffer)return e;if("string"===typeof e)return ks(e).buffer;if(e instanceof Document)return ks(e.documentElement.innerHTML).buffer;throw new Error("DASH Manifest Parser: Unrecognized Manifest format")}function Nc(e){const t=new DataView(e);return 61371===t.getUint16(0)&&191===t.getUint8(2)||65279!==t.getUint16(0)&&65534!==t.getUint16(0)}const Uc="function"===typeof Headers?Headers:null,Fc="function"===typeof AbortController?AbortController:null;function Bc(e){var t,n;let i;if(!r(e.headers))if(r(Uc))i=e.headers;else{i=new Uc;const t=Object.keys(e.headers);for(let n=0;n<t.length;n++){const r=t[n];i.append(r,e.headers[r])}}j.debug("Fetch: Called with URL",e.url);let a=null,s=!1,o=!1;const l=_e(),u=r(Fc)?null:new Fc;function c(){r(u)?j.warn("Fetch: AbortController API not available."):u.abort()}let d,h;void 0!==e.timeout&&(d=setTimeout(()=>{s=!0,void 0!==h&&clearTimeout(h),c()},e.timeout)),void 0!==e.connectionTimeout&&(h=setTimeout(()=>{o=!0,void 0!==d&&clearTimeout(d),c()},e.connectionTimeout));const f=e.cancelSignal.register(function(e){a=e,c()}),p={method:"GET"};if(void 0!==i&&(p.headers=i),p.signal=r(u)?null:u.signal,j.hasLevel("DEBUG")){let i="FETCH: Sending GET "+e.url;void 0!==e.timeout&&(i+=" to="+String(e.timeout/1e3)),void 0!==e.connectionTimeout&&(i+=" cto="+String(e.connectionTimeout/1e3)),void 0!==(null===(t=e.headers)||void 0===t?void 0:t.Range)&&(i+=" Range="+(null===(n=e.headers)||void 0===n?void 0:n.Range)),j.debug(i)}return fetch(e.url,p).then(t=>{if(void 0!==h&&clearTimeout(h),t.status>=300)throw j.warn("Fetch: Request HTTP Error",t.status,t.url),new nt(t.url,t.status,it.ERROR_HTTP_CODE);if(r(t.body))throw new nt(t.url,t.status,it.PARSE_ERROR);const n=t.headers.get("Content-Length"),i=r(n)||isNaN(+n)?void 0:+n,a=t.body.getReader();let s=0;return o();async function o(){const n=await a.read();if(!n.done&&!r(n.value)){s+=n.value.byteLength;const r=_e(),a={url:t.url,currentTime:r,duration:r-l,sendingTime:l,chunkSize:n.value.byteLength,chunk:n.value.buffer,size:s,totalSize:i};return e.onData(a),o()}if(n.done){void 0!==d&&clearTimeout(d),f();const e=_e(),n=e-l;return{requestDuration:n,receivedTime:e,sendingTime:l,size:s,status:t.status,url:t.url}}return o()}}).catch(t=>{if(null!==a)throw a;if(f(),s)throw j.warn("Fetch: Request timed out."),new nt(e.url,0,it.TIMEOUT);if(o)throw j.warn("Fetch: Request connection timed out."),new nt(e.url,0,it.TIMEOUT);if(t instanceof nt)throw t;throw j.warn("Fetch: Request Error",t instanceof Error?t.toString():""),new nt(e.url,0,it.ERROR_EVENT)})}function Vc(){return"function"===typeof s["a"].fetch&&!r(Fc)&&!r(Uc)}function jc(e,t){return"audio"===e||"video"===e?"video/mp4"===t||"audio/mp4"===t?"mp4":"video/webm"===t||"audio/webm"===t?"webm":void 0:"text"===e&&"application/mp4"===t?"mp4":void 0}function Gc(e){return(t,n,i,r,a)=>{return new Promise((o,l)=>{const u=new me,c=u.linkToSignal(r);function d(){u.signal.deregister(l),c()}u.signal.register(l),e(t,n,i,u.signal,Object.assign(Object.assign({},a),{onNewChunk(e){try{s(e),a.onNewChunk(e)}catch(e){d(),u.cancel(),l(e)}}})).then(e=>{if(d(),!u.isUsed()){if("segment-loaded"===e.resultType)try{s(e.resultData.responseData)}catch(e){return void l(e)}o(e)}},e=>{d(),l(e)})});function s(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&"mp4"===jc(n.type,n.mimeType)&&Co(new Uint8Array(e),n.segment.isInit)}}}function Hc(e,t){return null===e?null:null===t.url?e.baseUrl:_s(e.baseUrl,t.url)}function zc(e,t,n,i,r){if(void 0===t.range)return ko({url:e,responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}).then(e=>({resultType:"segment-loaded",resultData:e}));if(void 0===t.indexRange)return ko({url:e,headers:{Range:yl(t.range)},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}).then(e=>({resultType:"segment-loaded",resultData:e}));if(t.range[1]+1===t.indexRange[0])return ko({url:e,headers:{Range:yl([t.range[0],t.indexRange[1]])},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}).then(e=>({resultType:"segment-loaded",resultData:e}));const a=ko({url:e,headers:{Range:yl(t.range)},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}),s=ko({url:e,headers:{Range:yl(t.indexRange)},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress});return Promise.all([a,s]).then(([t,n])=>{const i=Vr(new Uint8Array(t.responseData),new Uint8Array(n.responseData)),r=Math.min(t.sendingTime,n.sendingTime),a=Math.max(t.receivedTime,n.receivedTime);return{resultType:"segment-loaded",resultData:{url:e,responseData:i,size:t.size+n.size,requestDuration:a-r,sendingTime:r,receivedTime:a}}})}function Kc(e){let t=0;const n=[];let i=null;while(t<=e.length){if(t===e.length){i=null;break}i=e.subarray(t,1/0);const r=Io(i,1836019558);if(r<0)break;const a=Hr(e,r+t),s=t+r+a;if(s>e.length)break;const o=Io(i,1835295092);if(o<0)break;const l=Hr(e,o+t),u=t+o+l;if(u>e.length)break;const c=Math.max(s,u),d=e.subarray(t,c);n.push(d),t=c}return 0===n.length?[null,i]:[n,i]}function $c(e,t,n,i,r){const{segment:a}=t,s=void 0!==a.range?{Range:yl(a.range)}:void 0;let o=null;function l(e){const t=new Uint8Array(e.chunk),n=null!==o?Vr(o,t):t,a=Kc(n),s=a[0];o=a[1],null!==s&&(s.forEach(e=>{i.onNewChunk(e)}),r.isCancelled())||(i.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize}),r.isCancelled())}return Bc({url:e,headers:s,onData:l,timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:r}).then(e=>({resultType:"chunk-complete",resultData:e}))}function Wc(e,t,n,i,r,a){if(t.segment.isInit)return zc(e,t.segment,i,a,r);const s=jc(t.type,t.mimeType);if(n&&("mp4"===s||void 0===s)){if(Vc())return $c(e,t,i,r,a);vt("DASH: Your browser does not have the fetch API. You will have a higher chance of rebuffering when playing close to the live edge")}const{segment:o}=t;return ko({url:e,responseType:"arraybuffer",headers:void 0!==o.range?{Range:yl(o.range)}:void 0,timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:a,onProgress:r.onProgress}).then(e=>({resultType:"segment-loaded",resultData:e}))}function qc({lowLatencyMode:e,segmentLoader:t,checkMediaSegmentIntegrity:n}){return!0!==n?i:Gc(i);function i(n,i,r,a,s){const o=Hc(n,i.segment);return null===o?Promise.resolve({resultType:"segment-created",resultData:null}):e||void 0===t?Wc(o,i,e,r,s,a):new Promise((n,l)=>{let u=!1;const c=e=>{u||a.isCancelled()||(u=!0,a.deregister(y),n({resultType:"segment-loaded",resultData:{responseData:e.data,size:e.size,requestDuration:e.duration}}))},d=e=>{var t,n;if(u||a.isCancelled())return;u=!0,a.deregister(y);const i=e,r=null!==(t=null===i||void 0===i?void 0:i.message)&&void 0!==t?t:"Unknown error when fetching a DASH segment through a custom segmentLoader.",s=new ln(r,null!==(n=null===i||void 0===i?void 0:i.canRetry)&&void 0!==n&&n,null===i||void 0===i?void 0:i.xhr);l(s)},h=e=>{u||a.isCancelled()||s.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize})},f=()=>{u||a.isCancelled()||(u=!0,a.deregister(y),Wc(o,i,e,r,s,a).then(n,l))},p={reject:d,resolve:c,progress:h,fallback:f};let g;void 0!==i.segment.range&&(g=[i.segment.range],void 0!==i.segment.indexRange&&g.push(i.segment.indexRange));const m={isInit:i.segment.isInit,timeout:r.timeout,byteRanges:g,trackType:i.type,url:o},v=t(m,p);function y(e){u||(u=!0,"function"===typeof v&&v(),l(e))}a.register(y)})}}function Yc(e,t,n){return new Uint8Array(Array.prototype.slice.call(e,t,n))}function Xc(e,t,n){return e.slice(t,n)}var Qc="function"===typeof Uint8Array.prototype.slice?Xc:Yc;function Zc(e){let t=0;const n=es(e,1836019574);if(null===n)return[];const i=[];while(t<n.length){let e;try{e=is(n,1886614376)}catch(e){const t=e instanceof Error?e:"";return j.warn("Error while removing PSSH from ISOBMFF",t),i}if(null===e)return i;const r=Qc(n,e[0],e[2]),a=Jc(r,e[1]-e[0]);void 0!==a&&i.push({systemId:a,data:r}),n[e[0]+4]=102,n[e[0]+5]=114,n[e[0]+6]=101,n[e[0]+7]=101,t=e[2]}return i}function Jc(e,t){if(e[t]>1)return void j.warn("ISOBMFF: un-handled PSSH version");const n=t+4;if(n+16>e.length)return;const i=Qc(e,n,n+16);return Ds(i)}const ed=408125543,td=357149030,nd=2807729,id=17545,rd=475249515,ad=187,sd=179,od=183,ld=241;function ud(e,t,n,[i,r]){let a=i;while(a<r){const i=pd(n,a);if(null===i)return null;const{value:r,length:s}=i,o=a+s,l=gd(n,o);if(null===l)return null;const{length:u,value:c}=l,d=o+u,h=d+c;if(r===e)return[d,h];if(t.length>0)for(let a=0;a<t.length;a++)if(r===t[a]){const i=t.slice(a+1,t.length);return ud(e,i,n,[d,h])}a=h}return null}function cd(e,t){const n=ud(nd,[ed,td],e,[t,e.length]);if(null===n)return null;const i=n[1]-n[0];return 1e9/yd(e,n[0],i)}function dd(e,t){const n=ud(id,[ed,td],e,[t,e.length]);if(null===n)return null;const i=n[1]-n[0];return 4===i?md(e,n[0]):8===i?vd(e,n[0]):null}function hd(e,t){const n=ud(ed,[],e,[t,e.length]);if(null===n)return null;const[i,r]=n,a=cd(e,i);if(null===a)return null;const s=dd(e,i);if(null===s)return null;const o=ud(rd,[],e,[i,r]);if(null===o)return null;const l=[];let u=o[0];while(u<o[1]){const t=ud(ad,[],e,[u,o[1]]);if(null===t)break;const n=ud(sd,[],e,[t[0],t[1]]);if(null===n)return null;const r=yd(e,n[0],n[1]-n[0]),a=ud(ld,[od],e,[t[0],t[1]]);if(null===a)return null;const s=yd(e,a[0],a[1]-a[0])+i;l.push({time:r,rangeStart:s}),u=t[1]}const c=[];for(let d=0;d<l.length;d++){const e=l[d];d===l.length-1?c.push({time:e.time,timescale:a,duration:0===d?s:s-e.time,range:[e.rangeStart,1/0]}):c.push({time:e.time,timescale:a,duration:l[d+1].time-e.time,range:[e.rangeStart,l[d+1].rangeStart-1]})}return c}function fd(e,t){for(let n=1;n<=8;n++)if(e[t]>=Math.pow(2,8-n))return n}function pd(e,t){const n=fd(e,t);if(void 0===n)return j.warn("webm: unrepresentable length"),null;if(t+n>e.length)return j.warn("webm: impossible length"),null;let i=0;for(let r=0;r<n;r++)i=e[t+r]*Math.pow(2,8*(n-r-1))+i;return{length:n,value:i}}function gd(e,t){const n=fd(e,t);if(void 0===n)return j.warn("webm: unrepresentable length"),null;if(t+n>e.length)return j.warn("webm: impossible length"),null;let i=(e[t]&(1<<8-n)-1)*Math.pow(2,8*(n-1));for(let r=1;r<n;r++)i=e[t+r]*Math.pow(2,8*(n-r-1))+i;return{length:n,value:i}}function md(e,t){return new DataView(e.buffer).getFloat32(t)}function vd(e,t){return new DataView(e.buffer).getFloat64(t)}function yd(e,t,n){let i=0;for(let r=0;r<n;r++)i=e[t+r]*Math.pow(2,8*(n-r-1))+i;return i}function bd(e,t,n,i){const r=Po(e);if(void 0===r||void 0===i)return null;let a,s=void 0!==n.timestampOffset?r+n.timestampOffset*i:r,o=No(e);if(s<0&&(void 0!==o&&(o+=s),s=0),t||!n.complete)return void 0===o&&j.warn("DASH: Chunked segments should indicate a duration through their trun boxes"),{time:s/i,duration:void 0!==o?o/i:void 0};const l=n.duration*i,u=Math.min(.9*i,l/4);return void 0!==o&&Math.abs(o-l)<=u&&(a=o),{time:s/i,duration:void 0!==a?a/i:a}}function Sd(e,t){if(e.length<=0)return!1;const n=e.length;for(let i=0;i<n;i++){const n=e[i],r=t,{messageData:a}=n,s=Rs(a),o=Date.parse(s);if(void 0===r||void 0===o||isNaN(o)||o>=r)return!0}return!1}function Td(e,t){if(0===e.length)return;const{manifestRefreshEventsFromEMSGs:n,EMSGs:i}=e.reduce((e,t)=>{return"urn:mpeg:dash:event:2012"===t.schemeIdUri&&"1"===t.value?(void 0===e.manifestRefreshEventsFromEMSGs&&(e.manifestRefreshEventsFromEMSGs=[]),e.manifestRefreshEventsFromEMSGs.push(t)):(void 0===e.EMSGs&&(e.EMSGs=[]),e.EMSGs.push(t)),e},{manifestRefreshEventsFromEMSGs:void 0,EMSGs:void 0}),r=null===i||void 0===i?void 0:i.map(e=>({type:"emsg",value:e})),a=void 0!==t&&void 0!==n&&Sd(n,t);return{inbandEvents:r,needsManifestRefresh:a}}function _d({__priv_patchLastSegmentInSidx:e}){return function(t,n,i){var a,s;const{segment:o,periodStart:l,periodEnd:u}=n,{data:c,isChunked:d}=t,h=[l,u];if(null===c)return o.isInit?{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:"media",chunkData:null,chunkSize:0,chunkInfos:null,chunkOffset:0,protectionData:[],appendWindow:h};const f=c instanceof Uint8Array?c:new Uint8Array(c),p=jc(n.type,n.mimeType),g="mp4"===p||void 0===p,m=[];if(g){const e=Zc(f);let t;o.isInit&&(t=null!==(a=Vo(f))&&void 0!==a?a:void 0),(e.length>0||void 0!==t)&&m.push({initDataType:"cenc",keyId:t,initData:e})}if(!o.isInit){const e=g?bd(f,d,o,i):null,t=null!==(s=o.timestampOffset)&&void 0!==s?s:0;if(g){const i=Bo(f);if(void 0!==i){const r=i.filter(e=>{return void 0!==o.privateInfos&&void 0!==o.privateInfos.isEMSGWhitelisted&&o.privateInfos.isEMSGWhitelisted(e)}),a=Td(r,n.manifestPublishTime);if(void 0!==a){const{needsManifestRefresh:n,inbandEvents:i}=a;return{segmentType:"media",chunkData:f,chunkSize:f.length,chunkInfos:e,chunkOffset:t,appendWindow:h,inbandEvents:i,protectionData:m,needsManifestRefresh:n}}}}return{segmentType:"media",chunkData:f,chunkSize:f.length,chunkInfos:e,chunkOffset:t,protectionData:m,appendWindow:h}}const{indexRange:v}=o;let y,b;if("webm"===p)y=hd(f,0);else if(g&&(y=Lo(f,Array.isArray(v)?v[0]:0),!0===e&&null!==y&&y.length>0)){const e=y[y.length-1];Array.isArray(e.range)&&(e.range[1]=1/0)}g?b=Uo(f):"webm"===p&&(b=cd(f,0));const S=r(b)?void 0:b;return{segmentType:"init",initializationData:f,initializationDataSize:f.length,protectionData:m,initTimescale:S,segmentList:null!==y&&void 0!==y?y:void 0}}}function wd({lowLatencyMode:e,checkMediaSegmentIntegrity:t}){return!0!==t?n:Gc(n);function n(t,n,i,r,a){const{segment:s}=n,{range:o}=s,l=Hc(t,s);if(null===l)return Promise.resolve({resultType:"segment-created",resultData:null});if(s.isInit)return zc(l,s,i,r,a);const u=jc(n.type,n.mimeType),c="mp4"===u||void 0===u;if(e&&c){if(Vc())return $c(l,n,i,a,r);vt("DASH: Your browser does not have the fetch API. You will have a higher chance of rebuffering when playing close to the live edge")}return c?ko({url:l,responseType:"arraybuffer",headers:Array.isArray(o)?{Range:yl(o)}:null,timeout:i.timeout,connectionTimeout:i.connectionTimeout,onProgress:a.onProgress,cancelSignal:r}).then(e=>({resultType:"segment-loaded",resultData:e})):ko({url:l,responseType:"text",headers:Array.isArray(o)?{Range:yl(o)}:null,timeout:i.timeout,connectionTimeout:i.connectionTimeout,onProgress:a.onProgress,cancelSignal:r}).then(e=>({resultType:"segment-loaded",resultData:e}))}}function Ed(e){const t=ls(e);return null===t?"":Rs(t)}function xd(e){if(void 0===e)throw new Error("Cannot parse subtitles: unknown format");switch(e.toLowerCase()){case"stpp":case"stpp.ttml.im1t":return"ttml";case"wvtt":return"vtt"}throw new Error("The codec used for the subtitles "+`"${e}" is not managed yet.`)}function Ad(e,t){switch(t){case"application/ttml+xml":return"ttml";case"application/x-sami":case"application/smil":return"sami";case"text/vtt":return"vtt"}if(void 0!==e){const t=e.toLowerCase();if("srt"===t)return"srt"}throw new Error(`could not find a text-track parser for the type ${null!==t&&void 0!==t?t:""}`)}function kd({segment:e,language:t,codecs:n},i,r,a){if(e.isInit)return null;let s,o;null===r?a?(s=e.time,o=e.end):j.warn("Transport: Unavailable time data for current text track."):(s=r.time,void 0!==r.duration?o=s+r.duration:!a&&e.complete&&(o=s+e.duration));const l=xd(n),u=Ed(i);return{data:u,type:l,language:t,start:s,end:o}}function Id(e,t,n){const{segment:i}=e;if(i.isInit)return null;let r,a;n?j.warn("Transport: Unavailable time data for current text track."):(r=i.time,i.complete&&(a=i.time+i.duration));const s=Ad(e.codecs,e.mimeType);return{data:t,type:s,language:e.language,start:r,end:a}}function Cd(e,t,n,i,r){var a;const{segment:s}=n,{isInit:o,indexRange:l}=s;let u;if(u="string"===typeof e?ks(e):e instanceof Uint8Array?e:new Uint8Array(e),o){const e=Lo(u,Array.isArray(l)?l[0]:0);if(!0===r&&null!==e&&e.length>0){const t=e[e.length-1];Array.isArray(t.range)&&(t.range[1]=1/0)}const t=Uo(u);return{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:t,segmentList:null!==e&&void 0!==e?e:void 0}}const c=bd(u,t,s,i),d=kd(n,u,c,t),h=null!==(a=s.timestampOffset)&&void 0!==a?a:0;return{segmentType:"media",chunkData:d,chunkSize:u.length,chunkInfos:c,chunkOffset:h,protectionData:[],appendWindow:[n.periodStart,n.periodEnd]}}function Rd(e,t,n){const{periodStart:i,periodEnd:r,segment:a}=n,{timestampOffset:s=0}=a;if(a.isInit)return{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0};let o,l;if("string"!==typeof e){const t=e instanceof Uint8Array?e:new Uint8Array(e);o=Rs(t),l=t.length}else o=e;const u=Id(n,o,t);return{segmentType:"media",chunkData:u,chunkSize:l,chunkInfos:null,chunkOffset:s,protectionData:[],appendWindow:[i,r]}}function Md({__priv_patchLastSegmentInSidx:e}){return function(t,n,i){var r;const{periodStart:a,periodEnd:s,segment:o}=n,{data:l,isChunked:u}=t;if(null===l)return o.isInit?{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:"media",chunkData:null,chunkSize:0,chunkInfos:null,chunkOffset:null!==(r=o.timestampOffset)&&void 0!==r?r:0,protectionData:[],appendWindow:[a,s]};const c=jc(n.type,n.mimeType);if("webm"===c)throw new Error("Text tracks with a WEBM container are not yet handled.");return"mp4"===c?Cd(l,u,n,i,e):Rd(l,u,n)}}var Dd=function(e){const t=Do({customManifestLoader:e.manifestLoader},Ld()?"text":"arraybuffer"),n=Rc(e),i=qc(e),r=_d(e),a=wd(e),s=Md(e);return{manifest:{loadManifest:t,parseManifest:n},audio:{loadSegment:i,parseSegment:r},video:{loadSegment:i,parseSegment:r},text:{loadSegment:a,parseSegment:s}}};function Ld(){return null!==$t.dashParsers.wasm&&("initialized"===$t.dashParsers.wasm.status||"initializing"===$t.dashParsers.wasm.status)}var Pd=Dd;function Od(e){void 0===e.transports.dash&&(e.transports.dash=Pd),e.dashParsers.native=Cc,e.mainThreadMediaSourceInit=Ga,e.codecSupportProber=Za}class Nd extends lr{constructor(e){super(),this._settings=e,this._initCanceller=new me}prepare(){}start(e,t){const n=this._initCanceller.signal,{keySystems:i,speed:r,url:a}=this._settings;fr(e);const s=new de(null);s.finish();const o=xa(e,i,s,{onError:e=>this._onFatalError(e),onWarning:e=>this.trigger("warning",e),onBlackListProtectionData:U,onKeyIdsCompatibilityUpdate:U},n);ja(e,e=>this._onFatalError(e),n);const l=new Ia(t,null,r);l.addEventListener("stalled",e=>this.trigger("stalled",e)),l.addEventListener("unstalled",()=>this.trigger("unstalled",null)),l.addEventListener("warning",e=>this.trigger("warning",e)),n.register(()=>{l.destroy()}),l.start(),o.onUpdate((i,r)=>{"uninitialized"!==i.initializationState.type&&(r(),j.info("Setting URL to HTMLMediaElement",a),e.src=a,n.register(()=>{j.info("Init: Removing directfile src from media element",e.src),fr(e)}),"awaiting-media-link"===i.initializationState.type?(i.initializationState.value.isMediaLinked.setValue(!0),o.onUpdate((n,i)=>{"initialized"===n.initializationState.type&&(i(),this._seekAndPlay(e,t))},{emitCurrentValue:!0,clearSignal:n})):(fe("initialized"===i.initializationState.type),this._seekAndPlay(e,t)))},{emitCurrentValue:!0,clearSignal:n})}updateContentUrls(e,t){throw new Error("Cannot update content URL of directfile contents")}dispose(){this._initCanceller.cancel()}_onFatalError(e){this._initCanceller.cancel(),this.trigger("error",e)}_seekAndPlay(e,t){const n=this._initCanceller.signal,{autoPlay:i,startAt:r}=this._settings,a=()=>{j.debug("Init: Calculating initial time");const t=Ud(e,r);return j.debug("Init: Initial time calculated:",t),t};Ea({mediaElement:e,playbackObserver:t,startTime:a,mustAutoPlay:i,onWarning:e=>this.trigger("warning",e),isDirectfile:!0},n).autoPlayResult.then(()=>Sa(t,e,!0,n).onUpdate((e,t)=>{e&&(t(),this.trigger("loaded",{getSegmentSinkMetrics:null}))},{emitCurrentValue:!0,clearSignal:n})).catch(e=>{n.isCancelled()||this._onFatalError(e)})}}function Ud(e,t){if(r(t))return 0;if(!r(t.position))return t.position;if(!r(t.wallClockTime))return t.wallClockTime;if(!r(t.fromFirstPosition))return t.fromFirstPosition;const n=e.duration;if("number"===typeof t.fromLastPosition)return r(n)||!isFinite(n)?(j.warn("startAt.fromLastPosition set but no known duration, beginning at 0."),0):Math.max(0,n+t.fromLastPosition);if("number"===typeof t.fromLivePosition){const i=e.seekable.length>0?e.seekable.end(0):n;return r(i)?(j.warn("startAt.fromLivePosition set but no known live position, beginning at 0."),0):Math.max(0,i+t.fromLivePosition)}if(!r(t.percentage)){if(r(n)||!isFinite(n))return j.warn("startAt.percentage set but no known duration, beginning at 0."),0;const{percentage:e}=t;if(e>=100)return n;if(e<=0)return 0;const i=+e/100;return n*i}return 0}function Fd(e,t){for(let n=0;n<e.length;n++)v&&n===t||(e[n].enabled=!1);return!(t<0||t>=e.length)&&(e[t].enabled=!0,!0)}function Bd(e,t){var n;if(t.length!==e.length)return!0;for(let i=0;i<t.length;i++)if(t[i].nativeTrack!==(null===(n=e[i])||void 0===n?void 0:n.nativeTrack))return!0;return!1}function Vd(e){var t;const n=[],i={};for(let r=0;r<e.length;r++){const a=e[r],s=""===a.language?"nolang":a.language,o=null!==(t=i[s])&&void 0!==t?t:1,l="gen_audio_"+s+"_"+o.toString();i[s]=o+1;const u={language:a.language,id:l,normalized:Ht(a.language),audioDescription:"descriptions"===a.kind||"description"===a.kind,representations:[]};n.push({track:u,nativeTrack:a})}return n}function jd(e){var t;const n=[],i={};for(let r=0;r<e.length;r++){const a=e[r],s=""===a.language?"nolang":a.language,o=null!==(t=i[s])&&void 0!==t?t:1,l="gen_text_"+s+"_"+o.toString();i[s]=o+1;const u="forced"===a.kind||void 0,c={language:a.language,forced:u,label:a.label,id:l,normalized:Ht(a.language),closedCaption:"captions"===a.kind};n.push({track:c,nativeTrack:a})}return n}function Gd(e){var t;const n=[],i={};for(let r=0;r<e.length;r++){const a=e[r],s=""===a.language?"nolang":a.language,o=null!==(t=i[s])&&void 0!==t?t:1,l="gen_video_"+s+"_"+o.toString();i[s]=o+1,n.push({track:{id:l,representations:[]},nativeTrack:a})}return n}class Hd extends a{constructor(e){var t,n,i;super(),this._nativeAudioTracks=e.audioTracks,this._nativeVideoTracks=e.videoTracks,this._nativeTextTracks=e.textTracks,this._audioTracks=void 0!==this._nativeAudioTracks?Vd(this._nativeAudioTracks):[],this._videoTracks=void 0!==this._nativeVideoTracks?Gd(this._nativeVideoTracks):[],this._textTracks=void 0!==this._nativeTextTracks?jd(this._nativeTextTracks):[],this._lastEmittedNativeAudioTrack=null===(t=this._getCurrentAudioTrack())||void 0===t?void 0:t.nativeTrack,this._lastEmittedNativeVideoTrack=null===(n=this._getCurrentVideoTrack())||void 0===n?void 0:n.nativeTrack,this._lastEmittedNativeTextTrack=null===(i=this._getCurrentTextTrack())||void 0===i?void 0:i.nativeTrack,this._handleNativeTracksCallbacks()}setAudioTrackById(e){for(let t=0;t<this._audioTracks.length;t++){const{track:n,nativeTrack:i}=this._audioTracks[t];if(n.id===e)return this._enableAudioTrackFromIndex(t),void(this._audioTrackLockedOn=i)}throw new Error("Audio track not found.")}disableTextTrack(){zd(this._textTracks),this._textTrackLockedOn=null}setTextTrackById(e){let t=!1;for(let n=0;n<this._textTracks.length;n++){const{track:i,nativeTrack:r}=this._textTracks[n];i.id===e?(r.mode="showing",t=!0,this._textTrackLockedOn=r):"showing"!==r.mode&&"hidden"!==r.mode||(r.mode="disabled")}if(!t)throw new Error("Text track not found.")}disableVideoTrack(){$d(this._videoTracks),this._videoTrackLockedOn=null}setVideoTrackById(e){for(let t=0;t<this._videoTracks.length;t++){const{track:n,nativeTrack:i}=this._videoTracks[t];if(n.id===e)return i.selected=!0,void(this._videoTrackLockedOn=i)}throw new Error("Video track not found.")}getChosenAudioTrack(){const e=this._getCurrentAudioTrack();return r(e)?e:e.track}getChosenTextTrack(){const e=this._getCurrentTextTrack();return r(e)?e:e.track}getChosenVideoTrack(){const e=this._getCurrentVideoTrack();return r(e)?e:e.track}getAvailableAudioTracks(){return this._audioTracks.map(({track:e,nativeTrack:t})=>{return{id:e.id,language:e.language,normalized:e.normalized,audioDescription:e.audioDescription,active:t.enabled,representations:e.representations}})}getAvailableTextTracks(){return this._textTracks.map(({track:e,nativeTrack:t})=>{return{id:e.id,label:e.label,forced:e.forced,language:e.language,normalized:e.normalized,closedCaption:e.closedCaption,active:"showing"===t.mode}})}getAvailableVideoTracks(){return this._videoTracks.map(({track:e,nativeTrack:t})=>{return{id:e.id,representations:e.representations,active:t.selected}})}dispose(){void 0!==this._nativeVideoTracks&&(this._nativeVideoTracks.onchange=null,this._nativeVideoTracks.onaddtrack=null,this._nativeVideoTracks.onremovetrack=null),void 0!==this._nativeAudioTracks&&(this._nativeAudioTracks.onchange=null,this._nativeAudioTracks.onaddtrack=null,this._nativeAudioTracks.onremovetrack=null),void 0!==this._nativeTextTracks&&(this._nativeTextTracks.onchange=null,this._nativeTextTracks.onaddtrack=null,this._nativeTextTracks.onremovetrack=null),this.removeEventListener()}_getCurrentAudioTrack(){if(void 0!==this._nativeAudioTracks){for(let e=0;e<this._audioTracks.length;e++){const t=this._audioTracks[e];if(t.nativeTrack.enabled)return t}return null}}_getCurrentVideoTrack(){if(void 0!==this._nativeVideoTracks){for(let e=0;e<this._videoTracks.length;e++){const t=this._videoTracks[e];if(t.nativeTrack.selected)return t}return null}}_getCurrentTextTrack(){if(void 0!==this._nativeTextTracks){for(let e=0;e<this._textTracks.length;e++){const t=this._textTracks[e];if("showing"===t.nativeTrack.mode)return t}return null}}_setPreviouslyLockedAudioTrack(){if(void 0!==this._audioTrackLockedOn)if(null===this._audioTrackLockedOn)for(let e=0;e<this._audioTracks.length;e++){const{nativeTrack:t}=this._audioTracks[e];t.enabled=!1}else for(let e=0;e<this._audioTracks.length;e++){const{nativeTrack:t}=this._audioTracks[e];if(t===this._audioTrackLockedOn)return void this._enableAudioTrackFromIndex(e)}}_setPreviouslyLockedTextTrack(){if(void 0!==this._textTrackLockedOn)if(null!==this._textTrackLockedOn)for(let e=0;e<this._textTracks.length;e++){const{nativeTrack:t}=this._textTracks[e];if(t===this._textTrackLockedOn)return Kd(this._textTracks,t),void("showing"!==t.mode&&(t.mode="showing"))}else zd(this._textTracks)}_setPreviouslyLockedVideoTrack(){if(void 0!==this._videoTrackLockedOn)if(null!==this._videoTrackLockedOn)for(let e=0;e<this._videoTracks.length;e++){const{nativeTrack:t}=this._videoTracks[e];if(t===this._videoTrackLockedOn)return void(t.selected=!0)}else $d(this._videoTracks)}_handleNativeTracksCallbacks(){void 0!==this._nativeAudioTracks&&(this._nativeAudioTracks.onaddtrack=(()=>{var e,t;if(void 0!==this._nativeAudioTracks){const n=Vd(this._nativeAudioTracks);if(Bd(this._audioTracks,n)){this._audioTracks=n,this._setPreviouslyLockedAudioTrack(),this.trigger("availableAudioTracksChange",this.getAvailableAudioTracks());const i=this._getCurrentAudioTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeAudioTrack&&(this.trigger("audioTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeAudioTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeAudioTracks.onremovetrack=(()=>{var e,t;if(void 0!==this._nativeAudioTracks){const n=Vd(this._nativeAudioTracks);if(Bd(this._audioTracks,n)){this._audioTracks=n,this.trigger("availableAudioTracksChange",this.getAvailableAudioTracks());const i=this._getCurrentAudioTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeAudioTrack&&(this.trigger("audioTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeAudioTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeAudioTracks.onchange=(()=>{if(void 0!==this._audioTracks)for(let e=0;e<this._audioTracks.length;e++){const{track:t,nativeTrack:n}=this._audioTracks[e];if(n.enabled)return void(n!==this._lastEmittedNativeAudioTrack&&(this.trigger("audioTrackChange",t),this._lastEmittedNativeAudioTrack=n))}null!==this._lastEmittedNativeAudioTrack&&(this.trigger("audioTrackChange",null),this._lastEmittedNativeAudioTrack=null)})),void 0!==this._nativeTextTracks&&(this._nativeTextTracks.onaddtrack=(()=>{var e,t;if(void 0!==this._nativeTextTracks){const n=jd(this._nativeTextTracks);if(Bd(this._textTracks,n)){this._textTracks=n,this._setPreviouslyLockedTextTrack(),this.trigger("availableTextTracksChange",this.getAvailableTextTracks());const i=this._getCurrentTextTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeTextTrack&&(this.trigger("textTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeTextTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeTextTracks.onremovetrack=(()=>{var e,t;if(void 0!==this._nativeTextTracks){const n=jd(this._nativeTextTracks);if(Bd(this._textTracks,n)){this._textTracks=n,this._setPreviouslyLockedTextTrack(),this.trigger("availableTextTracksChange",this.getAvailableTextTracks());const i=this._getCurrentTextTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeTextTrack&&(this.trigger("textTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeTextTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeTextTracks.onchange=(()=>{if(void 0!==this._textTracks)for(let e=0;e<this._textTracks.length;e++){const{track:t,nativeTrack:n}=this._textTracks[e];if("showing"===n.mode)return void(n!==this._lastEmittedNativeTextTrack&&(this.trigger("textTrackChange",t),this._lastEmittedNativeTextTrack=n))}null!==this._lastEmittedNativeTextTrack&&(this.trigger("textTrackChange",null),this._lastEmittedNativeTextTrack=null)})),void 0!==this._nativeVideoTracks&&(this._nativeVideoTracks.onaddtrack=(()=>{var e,t;if(void 0!==this._nativeVideoTracks){const n=Gd(this._nativeVideoTracks);if(Bd(this._videoTracks,n)){this._videoTracks=n,this._setPreviouslyLockedVideoTrack(),this.trigger("availableVideoTracksChange",this.getAvailableVideoTracks());const i=this._getCurrentVideoTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeVideoTrack&&(this.trigger("videoTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeVideoTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeVideoTracks.onremovetrack=(()=>{var e,t;if(void 0!==this._nativeVideoTracks){const n=Gd(this._nativeVideoTracks);if(Bd(this._videoTracks,n)){this._videoTracks=n,this._setPreviouslyLockedVideoTrack(),this.trigger("availableVideoTracksChange",this.getAvailableVideoTracks());const i=this._getCurrentVideoTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeVideoTrack&&(this.trigger("videoTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeVideoTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeVideoTracks.onchange=(()=>{if(void 0!==this._videoTracks)for(let e=0;e<this._videoTracks.length;e++){const{track:t,nativeTrack:n}=this._videoTracks[e];if(n.selected)return void(n!==this._lastEmittedNativeVideoTrack&&(this.trigger("videoTrackChange",t),this._lastEmittedNativeVideoTrack=n))}null!==this._lastEmittedNativeVideoTrack&&(this.trigger("videoTrackChange",null),this._lastEmittedNativeVideoTrack=null)}))}_enableAudioTrackFromIndex(e){Fd(this._audioTracks.map(({nativeTrack:e})=>e),e)}}function zd(e){for(let t=0;t<e.length;t++){const{nativeTrack:n}=e[t];n.mode="disabled"}}function Kd(e,t){for(let n=0;n<e.length;n++){const{nativeTrack:i}=e[n];i===t||"showing"!==i.mode&&"hidden"!==i.mode||(i.mode="disabled")}}function $d(e){for(let t=0;t<e.length;t++){const{nativeTrack:n}=e[t];n.selected=!1}}function Wd(e){e.directfile={initDirectFile:Nd,mediaElementTracksStore:Hd}}let qd;const{WebKitMediaKeys:Yd}=s["a"];function Xd(){return(p||g)&&void 0!==qd}void 0!==Yd&&"function"===typeof Yd.isTypeSupported&&"function"===typeof Yd.prototype.createSession&&"function"===typeof HTMLMediaElement.prototype.webkitSetMediaKeys&&(qd=Yd);class Qd{constructor(e,t,n){this._keyType=e,this._mediaKeys=t,this._configuration=n}get keySystem(){return this._keyType}createMediaKeys(){return new Promise(e=>e(this._mediaKeys))}getConfiguration(){return this._configuration}}let Zd;const{MSMediaKeys:Jd}=s["a"];function eh(e){try{const t=e();return"object"===typeof t&&null!==t&&"function"===typeof t.then?t:Promise.resolve(t)}catch(e){return Promise.reject(e)}}void 0!==Jd&&void 0!==Jd.prototype&&"function"===typeof Jd.isTypeSupported&&"function"===typeof Jd.prototype.createSession&&(Zd=Jd);class th extends a{constructor(e){super(),this.expiration=NaN,this.keyStatuses=new Map,this._mk=e,this._sessionClosingCanceller=new me,this.closed=new Promise(e=>{this._sessionClosingCanceller.signal.register(()=>e())}),this.update=(e=>{return new Promise((t,n)=>{if(void 0===this._ss)return n("MediaKeySession not set.");try{t(this._ss.update(e,""))}catch(e){n(e)}})})}generateRequest(e,t){return new Promise(e=>{let n;n=t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer),this._ss=this._mk.createSession("video/mp4",n),Dr(this._ss,e=>{var t;this.trigger(null!==(t=e.type)&&void 0!==t?t:"message",e)},this._sessionClosingCanceller.signal),Lr(this._ss,e=>{var t;this.trigger(null!==(t=e.type)&&void 0!==t?t:"keyadded",e)},this._sessionClosingCanceller.signal),Pr(this._ss,e=>{var t;this.trigger(null!==(t=e.type)&&void 0!==t?t:"keyerror",e)},this._sessionClosingCanceller.signal),e()})}close(){return new Promise(e=>{r(this._ss)||(this._ss.close(),this._ss=void 0),this._sessionClosingCanceller.cancel(),e()})}load(){return Promise.resolve(!1)}remove(){return Promise.resolve()}get sessionId(){var e,t;return null!==(t=null===(e=this._ss)||void 0===e?void 0:e.sessionId)&&void 0!==t?t:""}}class nh{constructor(e){if(void 0===Zd)throw new Error("No MSMediaKeys API.");this._mediaKeys=new Zd(e)}_setVideo(e){return eh(()=>{this._videoElement=e,void 0!==this._videoElement.msSetMediaKeys&&this._videoElement.msSetMediaKeys(this._mediaKeys)})}createSession(){if(void 0===this._videoElement||void 0===this._mediaKeys)throw new Error("Video not attached to the MediaKeys");return new th(this._mediaKeys)}setServerCertificate(){throw new Error("Server certificate is not implemented in your browser")}}function ih(){const e=(e,t)=>{if(void 0===Zd)throw new Error("No MSMediaKeys API.");return void 0!==t?Zd.isTypeSupported(e,t):Zd.isTypeSupported(e)},t=e=>new nh(e),n=(e,t)=>{if(null===t)return Promise.resolve(void 0);if(!(t instanceof nh))throw new Error("Custom setMediaKeys is supposed to be called with IE11 custom MediaKeys.");return t._setVideo(e)};return{isTypeSupported:e,createCustomMediaKeys:t,setMediaKeys:n}}let rh;const{MozMediaKeys:ah}=s["a"];function sh(){const e=(e,t)=>{if(void 0===rh)throw new Error("No MozMediaKeys API.");return void 0!==t?rh.isTypeSupported(e,t):rh.isTypeSupported(e)},t=e=>{if(void 0===rh)throw new Error("No MozMediaKeys API.");return new rh(e)},n=(e,t)=>{return eh(()=>{const n=e;if(void 0===n.mozSetMediaKeys||"function"!==typeof n.mozSetMediaKeys)throw new Error("Can't set video on MozMediaKeys.");return n.mozSetMediaKeys(t)})};return{isTypeSupported:e,createCustomMediaKeys:t,setMediaKeys:n}}function oh(e){return"function"===typeof(null===e||void 0===e?void 0:e.webkitGenerateKeyRequest)}void 0!==ah&&void 0!==ah.prototype&&"function"===typeof ah.isTypeSupported&&"function"===typeof ah.prototype.createSession&&(rh=ah);class lh extends a{constructor(e,t){super(),this._vid=e,this._key=t,this.sessionId="",this._closeSession=U,this.keyStatuses=new Map,this.expiration=NaN;const n=e=>{this.trigger(e.type,e)};this.closed=new Promise(t=>{this._closeSession=(()=>{["keymessage","message","keyadded","ready","keyerror","error"].forEach(t=>{e.removeEventListener(t,n),e.removeEventListener(`webkit${t}`,n)}),t()})}),["keymessage","message","keyadded","ready","keyerror","error"].forEach(t=>{e.addEventListener(t,n),e.addEventListener(`webkit${t}`,n)})}update(e){return new Promise((t,n)=>{try{if(this._key.indexOf("clearkey")>=0){const n=e instanceof ArrayBuffer?new Uint8Array(e):e,i=JSON.parse(Rs(n)),r=qs(i.keys[0].k),a=qs(i.keys[0].kid);t(this._vid.webkitAddKey(this._key,r,a,""))}else t(this._vid.webkitAddKey(this._key,e,null,""))}catch(e){n(e)}})}generateRequest(e,t){return new Promise(e=>{this._vid.webkitGenerateKeyRequest(this._key,t),e()})}close(){return new Promise(e=>{this._closeSession(),e()})}load(){return Promise.resolve(!1)}remove(){return Promise.resolve()}}class uh{constructor(e){this._keySystem=e}_setVideo(e){return eh(()=>{if(!oh(e))throw new Error("Video not attached to the MediaKeys");this._videoElement=e})}createSession(){if(r(this._videoElement))throw new Error("Video not attached to the MediaKeys");return new lh(this._videoElement,this._keySystem)}setServerCertificate(){throw new Error("Server certificate is not implemented in your browser")}}function ch(){const e=function(e){let t=document.querySelector("video");return r(t)&&(t=document.createElement("video")),!r(t)&&"function"===typeof t.canPlayType&&!!t.canPlayType("video/mp4",e)},t=e=>new uh(e),n=(e,t)=>{if(null===t)return Promise.resolve(void 0);if(!(t instanceof uh))throw new Error("Custom setMediaKeys is supposed to be called with old webkit custom MediaKeys.");return t._setVideo(e)};return{isTypeSupported:e,createCustomMediaKeys:t,setMediaKeys:n}}function dh(e,t){const n=e instanceof Uint8Array?e:new Uint8Array(e),i=t instanceof Uint8Array?t:new Uint8Array(t),r=Yr(n,0);if(r+4!==n.length)throw new Error("Unsupported WebKit initData.");const a=As(n),s=a.indexOf("skd://"),o=s>-1?a.substring(s+6):a,l=xs(o);let u=0;const c=new Uint8Array(n.byteLength+4+l.byteLength+4+i.byteLength);return c.set(n),u+=n.length,c.set(Qr(l.byteLength),u),u+=4,c.set(l,u),u+=l.byteLength,c.set(Qr(i.byteLength),u),u+=4,c.set(i,u),c}function hh(e){return ji(e,"com.apple.fps")}function fh(e,t){const n=e;return eh(()=>{if(void 0===n.webkitSetMediaKeys)throw new Error("No webKitMediaKeys API.");n.webkitSetMediaKeys(t)})}class ph extends a{constructor(e,t,n){super(),this._serverCertificate=n,this._videoElement=e,this._keyType=t,this._unbindSession=U,this._closeSession=U,this.closed=new Promise(e=>{this._closeSession=e}),this.keyStatuses=new Map,this.expiration=NaN}update(e){return new Promise((t,n)=>{if(void 0===this._nativeSession||void 0===this._nativeSession.update||"function"!==typeof this._nativeSession.update)return n("Unavailable WebKit key session.");try{let i;i=e instanceof ArrayBuffer?new Uint8Array(e):e instanceof Uint8Array?e:new Uint8Array(e.buffer),t(this._nativeSession.update(i))}catch(e){n(e)}})}generateRequest(e,t){return new Promise(e=>{var n;const i=this._videoElement;if(void 0===(null===(n=i.webkitKeys)||void 0===n?void 0:n.createSession))throw new Error("No WebKitMediaKeys API.");let r;if(hh(this._keyType)){if(void 0===this._serverCertificate)throw new Error("A server certificate is needed for creating fairplay session.");r=dh(t,this._serverCertificate)}else r=t;const a=i.webkitKeys.createSession("video/mp4",r);if(void 0===a||null===a)throw new Error("Impossible to get the key sessions");this._listenEvent(a),this._nativeSession=a,e()})}close(){return new Promise((e,t)=>{this._unbindSession(),this._closeSession(),void 0!==this._nativeSession?(this._nativeSession.close(),e()):t("No session to close.")})}load(){return Promise.resolve(!1)}remove(){return Promise.resolve()}get sessionId(){var e,t;return null!==(t=null===(e=this._nativeSession)||void 0===e?void 0:e.sessionId)&&void 0!==t?t:""}_listenEvent(e){this._unbindSession();const t=e=>{this.trigger(e.type,e)};["keymessage","message","keyadded","ready","keyerror","error"].forEach(n=>{e.addEventListener(n,t),e.addEventListener(`webkit${n}`,t)}),this._unbindSession=(()=>{["keymessage","message","keyadded","ready","keyerror","error"].forEach(n=>{e.removeEventListener(n,t),e.removeEventListener(`webkit${n}`,t)})})}}class gh{constructor(e){if(void 0===qd)throw new Error("No WebKitMediaKeys API.");this._keyType=e,this._mediaKeys=new qd(e)}_setVideo(e){if(this._videoElement=e,void 0===this._videoElement)throw new Error("Video not attached to the MediaKeys");return fh(this._videoElement,this._mediaKeys)}createSession(){if(void 0===this._videoElement||void 0===this._mediaKeys)throw new Error("Video not attached to the MediaKeys");return new ph(this._videoElement,this._keyType,this._serverCertificate)}setServerCertificate(e){return this._serverCertificate=e,Promise.resolve()}}function mh(){if(void 0===qd)throw new Error("No WebKitMediaKeys API.");const e=qd.isTypeSupported,t=e=>new gh(e),n=(e,t)=>{if(null===t)return fh(e,t);if(!(t instanceof gh))throw new Error("Custom setMediaKeys is supposed to be called with webkit custom MediaKeys.");return t._setVideo(e)};return{isTypeSupported:e,createCustomMediaKeys:t,setMediaKeys:n}}const vh=bh("auto");var yh=vh;function bh(e){var t;let n,i,a,l=Sh;if("standard"!==e&&("auto"!==e||Xd())||!o["a"]&&r(navigator.requestMediaKeySystemAccess)){let o,u;if("webkit"===e&&void 0!==qd){i=Tr(["needkey"]);const e=mh();o=e.isTypeSupported,u=e.createCustomMediaKeys,l=e.setMediaKeys,a="webkit"}else if(oh(null===(t=s["a"].HTMLVideoElement)||void 0===t?void 0:t.prototype)){i=Tr(["needkey"]);const e=ch();o=e.isTypeSupported,u=e.createCustomMediaKeys,l=e.setMediaKeys,a="older-webkit"}else if(void 0!==qd){i=Tr(["needkey"]);const e=mh();o=e.isTypeSupported,u=e.createCustomMediaKeys,l=e.setMediaKeys,a="webkit"}else if(d&&void 0!==Zd){i=Tr(["encrypted","needkey"]);const e=ih();o=e.isTypeSupported,u=e.createCustomMediaKeys,l=e.setMediaKeys,a="ms"}else if(void 0!==rh){i=Tr(["encrypted","needkey"]);const e=sh();o=e.isTypeSupported,u=e.createCustomMediaKeys,l=e.setMediaKeys,a="moz"}else{i=Tr(["encrypted","needkey"]);const e=s["a"].MediaKeys,t=()=>{if(void 0===e)throw new ut("MEDIA_KEYS_NOT_SUPPORTED","No `MediaKeys` implementation found in the current browser.");if("undefined"===typeof e.isTypeSupported){const e="This browser seems to be unable to play encrypted contents currently.Note: Some browsers do not allow decryption in some situations, like when not using HTTPS.";throw new Error(e)}};o=(n=>{return t(),fe("function"===typeof e.isTypeSupported),e.isTypeSupported(n)}),u=(n=>{return t(),new e(n)}),a="unknown"}n=function(e,t){if(!o(e))return Promise.reject(new Error("Unsupported key type"));for(let n=0;n<t.length;n++){const i=t[n],{videoCapabilities:a,audioCapabilities:s,initDataTypes:o,distinctiveIdentifier:l}=i;let c=!0;if(c=c&&(r(o)||o.some(e=>"cenc"===e)),c=c&&"required"!==l,c){const t={initDataTypes:["cenc"],distinctiveIdentifier:"not-allowed",persistentState:"required",sessionTypes:["temporary","persistent-license"]};void 0!==a&&(t.videoCapabilities=a),void 0!==s&&(t.audioCapabilities=s);const n=u(e);return Promise.resolve(new Qd(e,n,t))}}return Promise.reject(new Error("Unsupported configuration"))}}else n=((...e)=>navigator.requestMediaKeySystemAccess(...e)),i=Tr(["encrypted"]),a="standard";return{requestMediaKeySystemAccess:n,onEncrypted:i,setMediaKeys:l,implementation:a}}function Sh(e,t){try{let n;const i=e;return"function"===typeof i.setMediaKeys?n=i.setMediaKeys(t):"function"===typeof i.webkitSetMediaKeys?n=i.webkitSetMediaKeys(t):"function"===typeof i.mozSetMediaKeys?n=i.mozSetMediaKeys(t):"function"===typeof i.msSetMediaKeys&&null!==t&&(n=i.msSetMediaKeys(t)),"object"===typeof n&&null!==n&&"function"===typeof n.then?n:Promise.resolve(n)}catch(e){return Promise.reject(e)}}var Th=yh;const _h=Hr(ks("pssh"),0);function wh(e){const t=[];let n=0;while(n<e.length){if(e.length<n+8||Hr(e,n+4)!==_h)return j.warn("Compat: Unrecognized initialization data. Use as is."),[{systemId:void 0,data:e}];const i=Hr(new Uint8Array(e),n);if(n+i>e.length)return j.warn("Compat: Unrecognized initialization data. Use as is."),[{systemId:void 0,data:e}];const r=e.subarray(n,n+i),a=Jc(r,8),s={systemId:a,data:r};Eh(t,s)?j.warn("Compat: Duplicated PSSH found in initialization data, removing it."):t.push(s),n+=i}return n!==e.length?(j.warn("Compat: Unrecognized initialization data. Use as is."),[{systemId:void 0,data:e}]):t}function Eh(e,t){for(let n=0;n<e.length;n++){const i=e[n];if((void 0===t.systemId||void 0===i.systemId||t.systemId===i.systemId)&&yt(t.data,i.data))return!0}return!1}function xh(e){const{initData:t,initDataType:n}=e;if(r(t))return j.warn("Compat: No init data found on media encrypted event."),null;const i=new Uint8Array(t),a=wh(i);return{type:n,values:a}}function Ah(){return y}function kh(e,t,n){const i=e.setMediaKeys(t,n).then(()=>{j.info("Compat: MediaKeys updated with success")}).catch(e=>{if(null!==n)throw j.error("Compat: Could not update MediaKeys",e instanceof Error?e:"Unknown Error"),e;j.error("Compat: Could not reset MediaKeys",e instanceof Error?e:"Unknown Error")});return Ah()?i:Promise.race([i,Ri(1e3)])}function Ih(e){var t;const n=sr.getState(e);return sr.setState(e,null),kh(null!==(t=null===n||void 0===n?void 0:n.emeImplementation)&&void 0!==t?t:Th,e,null)}async function Ch(e,{emeImplementation:t,keySystemOptions:n,loadedSessionsStore:i,mediaKeySystemAccess:r,mediaKeys:a},s){const o=sr.getState(e),l=null!==o&&o.loadedSessionsStore!==i?o.loadedSessionsStore.closeAllSessions():Promise.resolve();if(await l,s.isCancelled())throw s.cancellationError;if(sr.setState(e,{emeImplementation:t,keySystemOptions:n,mediaKeySystemAccess:r,mediaKeys:a,loadedSessionsStore:i}),e.mediaKeys!==a)return j.info("DRM: Attaching MediaKeys to the media element"),kh(t,e,a).then(()=>{j.info("DRM: MediaKeys attached with success")}).catch(e=>{const t=e instanceof Error?e.toString():"Unknown Error";throw new lt("MEDIA_KEYS_ATTACHMENT_ERROR","Could not attach the MediaKeys to the media element: "+t)})}function Rh(e){if(""===e.sessionId)return!1;const t=e.keyStatuses,n=[];return t.forEach(e=>{n.push(e)}),n.length<=0?(j.debug("DRM: isSessionUsable: MediaKeySession given has an empty keyStatuses",e.sessionId),!1):gt(n,"expired")?(j.debug("DRM: isSessionUsable: MediaKeySession given has an expired key",e.sessionId),!1):gt(n,"internal-error")?(j.debug("DRM: isSessionUsable: MediaKeySession given has a key with an internal-error",e.sessionId),!1):(j.debug("DRM: isSessionUsable: MediaKeySession is usable",e.sessionId),!0)}function Mh(e,t,n,i){const{loadedSessionsStore:r,persistentSessionsStore:a}=e;return"temporary"===n?Dh(r,t):null===a?(j.warn("DRM: Cannot create persistent MediaKeySession, PersistentSessionsStore not created."),Dh(r,t)):Lh(r,a,t,i)}function Dh(e,t){j.info("DRM: Creating a new temporary session");const n=e.createSession(t,"temporary");return Promise.resolve({type:"created-session",value:n})}async function Lh(e,t,n,i){if(null!==i.cancellationError)throw i.cancellationError;j.info("DRM: Creating persistent MediaKeySession");const r=e.createSession(n,"persistent-license"),a=t.getAndReuse(n);if(null===a)return{type:"created-session",value:r};try{const i=await e.loadPersistentSession(r.mediaKeySession,a.sessionId);if(!i){j.warn("DRM: No data stored for the loaded session"),t.delete(a.sessionId),e.removeSessionWithoutClosingIt(r.mediaKeySession);const i=e.createSession(n,"persistent-license");return{type:"created-session",value:i}}return i&&Rh(r.mediaKeySession)?(t.add(n,n.keyIds,r.mediaKeySession),j.info("DRM: Succeeded to load persistent session."),{type:"loaded-persistent-session",value:r}):(j.warn("DRM: Previous persistent session not usable anymore."),s())}catch(e){return j.warn("DRM: Unable to load persistent session: "+(e instanceof Error?e.toString():"Unknown Error")),s()}async function s(){if(null!==i.cancellationError)throw i.cancellationError;j.info("DRM: Removing previous persistent session.");const a=t.get(n);null!==a&&t.delete(a.sessionId);try{await e.closeSession(r.mediaKeySession)}catch(t){if(""!==r.mediaKeySession.sessionId)throw t;e.removeSessionWithoutClosingIt(r.mediaKeySession)}if(null!==i.cancellationError)throw i.cancellationError;const s=e.createSession(n,"persistent-license");return{type:"created-session",value:s}}}async function Ph(e,t){if(t<0||t>=e.getLength())return;j.info("DRM: LSS cache limit exceeded",t,e.getLength());const n=[],i=e.getAll().slice(),r=i.length-t;for(let a=0;a<r;a++){const t=i[a];n.push(e.closeSession(t.mediaKeySession))}await Promise.all(n)}async function Oh(e,t,n,i,r){let a=null;const{loadedSessionsStore:s,persistentSessionsStore:o}=t,l=s.reuse(e);if(null!==l){if(a=l.mediaKeySession,Rh(a))return j.info("DRM: Reuse loaded session",a.sessionId),{type:"loaded-open-session",value:{mediaKeySession:a,sessionType:l.sessionType,keySessionRecord:l.keySessionRecord}};null!==o&&""!==l.mediaKeySession.sessionId&&o.delete(l.mediaKeySession.sessionId)}if(null!==a&&(await s.closeSession(a),null!==r.cancellationError))throw r.cancellationError;if(await Ph(s,i),null!==r.cancellationError)throw r.cancellationError;const u=await Mh(t,e,n,r);return{type:u.type,value:{mediaKeySession:u.value.mediaKeySession,sessionType:u.value.sessionType,keySessionRecord:u.value.keySessionRecord}}}function Nh(){return!y&&!T}function Uh(e){return!c||-1===e.indexOf("playready")}const Fh='<WRMHEADER xmlns="http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader" version="4.0.0.0"><DATA><PROTECTINFO><KEYLEN>16</KEYLEN><ALGID>AESCTR</ALGID></PROTECTINFO><KID>ckB07BNLskeUq0qd83fTbA==</KID><DS_ID>yYIPDBca1kmMfL60IsfgAQ==</DS_ID><CUSTOMATTRIBUTES xmlns=""><encryptionref>312_4024_2018127108</encryptionref></CUSTOMATTRIBUTES><CHECKSUM>U/tsUYRgMzw=</CHECKSUM></DATA></WRMHEADER>';function Bh(e){const t=xs(e),n=Xr(t.length),i=new Uint8Array([1,0]),r=new Uint8Array([1,0]),a=Qr(t.length+6),s=Vr(a,r,i,n,t),o=Ms("9a04f07998404286ab92e65be0885f95");return Vh(s,o)}function Vh(e,t){const n=ks("pssh"),i=new Uint8Array([0,0,0,0]),r=$r(e.length),a=$r(32+e.length);return Vr(a,n,i,t,r,e)}function jh(){return d}function Gh(e,t,n){const i=t.getConfiguration();if(jh()||r(i))return null;const a=e.filter(e=>{return e.type===n.type&&(!!(r(e.persistentLicenseConfig)&&"required"!==e.persistentState||"required"===i.persistentState)&&("required"!==e.distinctiveIdentifier||"required"===i.distinctiveIdentifier))})[0];return void 0!==a?{keySystemOptions:a,keySystemAccess:t}:null}function Hh(e){const{EME_KEY_SYSTEMS:t}=N.getCurrent();for(const n of Object.keys(t))if(gt(t[n],e))return n}function zh(e){const{keyName:t,keyType:n,keySystemOptions:i}=e,a=["temporary"];let s="optional",o="optional";r(i.persistentLicenseConfig)||(s="required",a.push("persistent-license")),r(i.persistentState)||(s=i.persistentState),r(i.distinctiveIdentifier)||(o=i.distinctiveIdentifier);const{EME_DEFAULT_AUDIO_CODECS:l,EME_DEFAULT_VIDEO_CODECS:u,EME_DEFAULT_WIDEVINE_ROBUSTNESSES:c,EME_DEFAULT_PLAYREADY_RECOMMENDATION_ROBUSTNESSES:d}=N.getCurrent();let h,f;const{audioCapabilitiesConfig:p,videoCapabilitiesConfig:g}=i;if("full"===(null===p||void 0===p?void 0:p.type))h=p.value;else{let e;e="robustness"===(null===p||void 0===p?void 0:p.type)?p.value:"widevine"===t?c:"com.microsoft.playready.recommendation"===n?d:[],0===e.length&&e.push(void 0);const i="contentType"===(null===p||void 0===p?void 0:p.type)?p.value:l;h=Hl(e,e=>i.map(t=>{return void 0!==e?{contentType:t,robustness:e}:{contentType:t}}))}if("full"===(null===g||void 0===g?void 0:g.type))f=g.value;else{let e;e="robustness"===(null===g||void 0===g?void 0:g.type)?g.value:"widevine"===t?c:"com.microsoft.playready.recommendation"===n?d:[],0===e.length&&e.push(void 0);const i="contentType"===(null===g||void 0===g?void 0:g.type)?g.value:u;f=Hl(e,e=>i.map(t=>{return void 0!==e?{contentType:t,robustness:e}:{contentType:t}}))}const m={initDataTypes:["cenc"],videoCapabilities:f,audioCapabilities:h,distinctiveIdentifier:o,persistentState:s,sessionTypes:a};return[m,Object.assign(Object.assign({},m),{audioCapabilities:void 0,videoCapabilities:void 0})]}function Kh(e,t,n){j.info("DRM: Searching for compatible MediaKeySystemAccess");const i=sr.getState(e);if(null!==i&&Th.implementation===i.emeImplementation.implementation){const e=Gh(t,i.mediaKeySystemAccess,i.keySystemOptions);if(null!==e)return j.info("DRM: Found cached compatible keySystem"),Promise.resolve({type:"reuse-media-key-system-access",value:{mediaKeySystemAccess:e.keySystemAccess,options:e.keySystemOptions}})}const a=t.reduce((e,t)=>{const{EME_KEY_SYSTEMS:n}=N.getCurrent(),i=n[t.type];let a;if(r(i)){const e=Hh(t.type),n=t.type;a=[{keyName:e,keyType:n,keySystemOptions:t}]}else a=i.map(e=>{const n=t.type;return{keyName:n,keyType:e,keySystemOptions:t}});return e.concat(a)},[]);return s(0);async function s(e){if(e>=a.length)throw new lt("INCOMPATIBLE_KEYSYSTEMS","No key system compatible with your wanted configuration has been found in the current browser.");if(r(Th.requestMediaKeySystemAccess))throw new Error("requestMediaKeySystemAccess is not implemented in your browser.");const t=a[e],{keyType:i,keySystemOptions:o}=t,l=zh(t);j.debug(`DRM: Request keysystem access ${i},`+`${e+1} of ${a.length}`);try{const t=await $h(i,l);return j.info("DRM: Found compatible keysystem",i,e+1),{type:"create-media-key-system-access",value:{options:o,mediaKeySystemAccess:t}}}catch(t){if(j.debug("DRM: Rejected access to keysystem",i,e+1),null!==n.cancellationError)throw n.cancellationError;return s(e+1)}}}async function $h(e,t){const n=await Th.requestMediaKeySystemAccess(e,t);if(!Uh(e))try{const e=await n.createMediaKeys(),t=e.createSession(),i=Bh(Fh);await t.generateRequest("cenc",i)}catch(e){throw j.debug("DRM: KeySystemAccess was granted but it is not usable"),e}return n}function Wh(e){j.info("Compat: Trying to move CENC PSSH from init data at the end of it.");let t=!1,n=new Uint8Array,i=new Uint8Array,r=0;while(r<e.length){if(e.length<r+8||Hr(e,r+4)!==_h)throw j.warn("Compat: unrecognized initialization data. Cannot patch it."),new Error("Compat: unrecognized initialization data. Cannot patch it.");const a=Hr(new Uint8Array(e),r);if(r+a>e.length)throw j.warn("Compat: unrecognized initialization data. Cannot patch it."),new Error("Compat: unrecognized initialization data. Cannot patch it.");const s=e.subarray(r,r+a);if(16===e[r+12]&&119===e[r+13]&&239===e[r+14]&&236===e[r+15]&&192===e[r+16]&&178===e[r+17]&&77===e[r+18]&&2===e[r+19]&&172===e[r+20]&&227===e[r+21]&&60===e[r+22]&&30===e[r+23]&&82===e[r+24]&&226===e[r+25]&&251===e[r+26]&&75===e[r+27]){const e=as(s),i=null===e?void 0:s[e[1]];j.info("Compat: CENC PSSH found with version",i),void 0===i?j.warn("Compat: could not read version of CENC PSSH"):t===(1===i)?n=Vr(n,s):1===i?(j.warn("Compat: cenc version 1 encountered, removing every other cenc pssh box."),n=s,t=!0):j.warn("Compat: filtering out cenc pssh box with wrong version",i)}else i=Vr(i,s);r+=a}if(r!==e.length)throw j.warn("Compat: unrecognized initialization data. Cannot patch it."),new Error("Compat: unrecognized initialization data. Cannot patch it.");return Vr(i,n)}function qh(e,t,n){let i;j.debug("Compat: Calling generateRequest on the MediaKeySession");try{i=Wh(n)}catch(e){i=n}const r=null!==t&&void 0!==t?t:"";return e.generateRequest(r,i).catch(t=>{if(""!==r||!(t instanceof TypeError))throw t;return j.warn('Compat: error while calling `generateRequest` with an empty initialization data type. Retrying with a default "cenc" value.',t),e.generateRequest("cenc",i)})}const Yh=100;async function Xh(e,t){j.info("DRM: Load persisted session",t);const n=await e.load(t);return!n||e.keyStatuses.size>0?n:new Promise(t=>{e.addEventListener("keystatuseschange",r);const i=setTimeout(r,Yh);function r(){a(),t(n)}function a(){clearTimeout(i),e.removeEventListener("keystatuseschange",r)}})}function Qh(e){const t=new me;return Promise.race([e.close().then(()=>{t.cancel()}),e.closed.then(()=>{t.cancel()}),n()]);async function n(){try{await cn(1e3,t.signal),await i()}catch(e){if(e instanceof ye)return;const t=e instanceof Error?e.message:"Unknown error made it impossible to close the session";j.error(`DRM: ${t}`)}}async function i(){try{await e.update(new Uint8Array(1))}catch(e){if(t.isUsed())return;if(e instanceof Error&&"The session is already closed."===e.message)return;await cn(1e3,t.signal)}if(!t.isUsed())throw new Error("Compat: Couldn't know if session is closed")}}function Zh(e,t){for(const n of e){const e=t.some(e=>yt(e,n));if(!e)return!1}return!0}function Jh(e,t){for(const n of e){const e=t.some(e=>yt(e,n));if(e)return!0}return!1}class ef{constructor(e){this._initializationData=e,this._keyIds=null}associateKeyIds(e){null===this._keyIds&&(this._keyIds=[]);const t=Array.from(e);for(const n of t)this.isAssociatedWithKeyId(n)||this._keyIds.push(n)}isAssociatedWithKeyId(e){if(null===this._keyIds)return!1;for(const t of this._keyIds)if(yt(t,e))return!0;return!1}getAssociatedKeyIds(){return null===this._keyIds?[]:this._keyIds}isCompatibleWith(e){const{keyIds:t}=e;if(void 0!==t&&t.length>0){if(null!==this._keyIds&&Zh(t,this._keyIds))return!0;if(void 0!==this._initializationData.keyIds)return Zh(t,this._initializationData.keyIds)}return this._checkInitializationDataCompatibility(e)}_checkInitializationDataCompatibility(e){return void 0!==e.keyIds&&e.keyIds.length>0&&void 0!==this._initializationData.keyIds?Zh(e.keyIds,this._initializationData.keyIds):this._initializationData.type===e.type&&this._initializationData.values.isCompatibleWith(e.values)}}class tf{constructor(e){this._mediaKeys=e,this._storage=[]}createSession(e,t){const n=new ef(e);j.debug("DRM-LSS: calling `createSession`",t);const i=this._mediaKeys.createSession(t),a={mediaKeySession:i,sessionType:t,keySessionRecord:n,isGeneratingRequest:!1,isLoadingPersistentSession:!1,closingStatus:{type:"none"}};return r(i.closed)||i.closed.then(()=>{j.info("DRM-LSS: session was closed, removing it.",i.sessionId);const e=this.getIndex(n);e>=0&&this._storage[e].mediaKeySession===i&&this._storage.splice(e,1)}).catch(e=>{j.warn(`DRM-LSS: MediaKeySession.closed rejected: ${e}`)}),this._storage.push(Object.assign({},a)),j.debug("DRM-LSS: MediaKeySession added",a.sessionType,this._storage.length),a}reuse(e){for(let t=this._storage.length-1;t>=0;t--){const n=this._storage[t];if(n.keySessionRecord.isCompatibleWith(e))return this._storage.splice(t,1),this._storage.push(n),j.debug("DRM-LSS: Reusing session:",n.mediaKeySession.sessionId,n.sessionType),Object.assign({},n)}return null}getEntryForSession(e){for(let t=this._storage.length-1;t>=0;t--){const n=this._storage[t];if(n.mediaKeySession===e)return Object.assign({},n)}return null}async generateLicenseRequest(e,t,n){let i;for(const r of this._storage)if(r.mediaKeySession===e){i=r;break}if(void 0===i)return j.error("DRM-LSS: generateRequest error. No MediaKeySession found with the given initData and initDataType"),qh(e,t,n);if(i.isGeneratingRequest=!0,"none"!==i.closingStatus.type)throw new Error("The `MediaKeySession` is being closed.");try{await qh(e,t,n)}catch(e){if(void 0===i)throw e;throw i.isGeneratingRequest=!1,"awaiting"===i.closingStatus.type&&i.closingStatus.start(),e}void 0!==i&&(i.isGeneratingRequest=!1,"awaiting"===i.closingStatus.type&&i.closingStatus.start())}async loadPersistentSession(e,t){let n,i;for(const r of this._storage)if(r.mediaKeySession===e){n=r;break}if(void 0===n)return j.error("DRM-LSS: loadPersistentSession error. No MediaKeySession found with the given initData and initDataType"),Xh(e,t);if(n.isLoadingPersistentSession=!0,"none"!==n.closingStatus.type)throw new Error("The `MediaKeySession` is being closed.");try{i=await Xh(e,t)}catch(e){if(void 0===n)throw e;throw n.isLoadingPersistentSession=!1,"awaiting"===n.closingStatus.type&&n.closingStatus.start(),e}return void 0===n?i:(n.isLoadingPersistentSession=!1,"awaiting"===n.closingStatus.type&&n.closingStatus.start(),i)}async closeSession(e){let t;for(const n of this._storage)if(n.mediaKeySession===e){t=n;break}return void 0===t?(j.warn("DRM-LSS: No MediaKeySession found with the given initData and initDataType"),Promise.resolve(!1)):this._closeEntry(t)}getLength(){return this._storage.length}getAll(){return this._storage}async closeAllSessions(){const e=this._storage;j.debug("DRM-LSS: Closing all current MediaKeySessions",e.length),this._storage=[];const t=e.map(e=>this._closeEntry(e));await Promise.all(t)}removeSessionWithoutClosingIt(e){fe(""===e.sessionId,"Initialized `MediaKeySession`s should always be properly closed");for(let t=this._storage.length-1;t>=0;t--){const n=this._storage[t];if(n.mediaKeySession===e)return j.debug("DRM-LSS: Removing session without closing it",e.sessionId),this._storage.splice(t,1),!0}return!1}getIndex(e){for(let t=0;t<this._storage.length;t++){const n=this._storage[t];if(n.keySessionRecord===e)return t}return-1}async _closeEntry(e){const{mediaKeySession:t}=e;return new Promise((n,i)=>{function r(){void 0!==e&&(e.closingStatus={type:"pending"}),nf(t).then(()=>{void 0!==e&&(e.closingStatus={type:"done"}),n(!0)}).catch(t=>{void 0!==e&&(e.closingStatus={type:"failed"}),i(t)})}void 0!==e&&(e.isLoadingPersistentSession||e.isGeneratingRequest)?e.closingStatus={type:"awaiting",start:r}:r()})}}async function nf(e){j.debug("DRM: Trying to close a MediaKeySession",e.sessionId);try{return await Qh(e),void j.debug("DRM: Succeeded to close MediaKeySession")}catch(e){return void j.error("DRM: Could not close MediaKeySession: "+(e instanceof Error?e.toString():"Unknown error"))}}function rf(e){let t,n=0;for(let i=0;i<e.length;i++)t=e[i],n=(n<<5)-n+t,n&=n;return n}class af{constructor(e){this.initData=e}toJSON(){return Ws(this.initData)}static decode(e){return qs(e)}}function sf(e,t){var n,i;return null!==(i=null!==(n=of(e,t))&&void 0!==n?n:of(t,e))&&void 0!==i&&i}function of(e,t){if(0===e.length)return!1;if(t.length<e.length)return null;const n=e[0];let i=0,r=0;for(;r<t.length;r++){const a=t[r];if(a.systemId!==n.systemId)continue;if(a.hash!==n.hash)return!1;let s,o;if(s=n.data instanceof Uint8Array?n.data:"string"===typeof n.data?af.decode(n.data):n.data.initData,o=a.data instanceof Uint8Array?a.data:"string"===typeof a.data?af.decode(a.data):a.data.initData,!yt(s,o))return!1;if(t.length-r<e.length)return null;for(i=1;i<e.length;i++){const n=e[i];for(r+=1;r<t.length;r++){const e=t[r];if(n.systemId!==e.systemId)continue;if(n.hash!==e.hash)return!1;let i,a;if(i=n.data instanceof Uint8Array?n.data:"string"===typeof n.data?af.decode(n.data):n.data.initData,a=e.data instanceof Uint8Array?e.data:"string"===typeof e.data?af.decode(e.data):e.data.initData,!yt(i,a))return!1;break}if(i===t.length)return null}return!0}return null}function lf(e){pe(e,{save:"function",load:"function"},"persistentLicenseConfig")}class uf{constructor(e){lf(e),this._entries=[],this._storage=e;try{let e=this._storage.load();Array.isArray(e)||(e=[]),this._entries=e}catch(e){j.warn("DRM-PSS: Could not get entries from license storage",e instanceof Error?e:""),this.dispose()}}getLength(){return this._entries.length}getAll(){return this._entries}get(e){const t=this._getIndex(e);return-1===t?null:this._entries[t]}getAndReuse(e){const t=this._getIndex(e);if(-1===t)return null;const n=this._entries.splice(t,1)[0];return this._entries.push(n),n}add(e,t,n){var i;if(r(n)||!Ot(n.sessionId))return void j.warn("DRM-PSS: Invalid Persisten Session given.");const{sessionId:a}=n,s=this._getIndex(e);if(s>=0){const e=void 0===t?3:4,n=this._entries[s],r=null!==(i=n.version)&&void 0!==i?i:-1;if(r>=e&&a===n.sessionId)return;j.info("DRM-PSS: Updating session info.",a),this._entries.splice(s,1)}else j.info("DRM-PSS: Add new session",a);const o=cf(e.values.getFormattedValues());void 0===t?this._entries.push({version:3,sessionId:a,values:o,initDataType:e.type}):this._entries.push({version:4,sessionId:a,keyIds:t.map(e=>new af(e)),values:o,initDataType:e.type}),this._save()}delete(e){let t=-1;for(let i=0;i<this._entries.length;i++){const n=this._entries[i];if(n.sessionId===e){t=i;break}}if(-1===t)return void j.warn("DRM-PSS: initData to delete not found.");const n=this._entries[t];j.warn("DRM-PSS: Delete session from store",n.sessionId),this._entries.splice(t,1),this._save()}deleteOldSessions(e){j.info(`DRM-PSS: Deleting last ${e} sessions.`),e<=0||(e<=this._entries.length?this._entries.splice(0,e):(j.warn("DRM-PSS: Asked to remove more information that it contains",e,this._entries.length),this._entries=[]),this._save())}dispose(){this._entries=[],this._save()}_getIndex(e){let t=null;function n(){if(null===t){const n=e.values.constructRequestData();t={initData:n,initDataHash:rf(n)}}return t}for(let i=0;i<this._entries.length;i++){const t=this._entries[i];if(t.initDataType===e.type)switch(t.version){case 4:if(void 0!==e.keyIds){const n=e.keyIds.every(e=>{const n=Ws(e);for(const i of t.keyIds)if("string"===typeof i){if(n===i)return!0}else if(yt(i.initData,e))return!0;return!1});if(n)return i}else{const n=e.values.getFormattedValues();if(sf(n,t.values))return i}break;case 3:const r=e.values.getFormattedValues();if(sf(r,t.values))return i;break;case 2:{const{initData:e,initDataHash:r}=n();if(t.initDataHash===r)try{const n="string"===typeof t.initData?af.decode(t.initData):t.initData.initData;if(yt(n,e))return i}catch(e){j.warn("DRM-PSS: Could not decode initialization data.",e instanceof Error?e:"")}break}case 1:{const{initData:e,initDataHash:r}=n();if(t.initDataHash===r){if("undefined"===typeof t.initData.length)return i;if(yt(t.initData,e))return i}break}default:{const{initDataHash:e}=n();if(t.initData===e)return i}}}return-1}_save(){try{this._storage.save(this._entries)}catch(e){const t=e instanceof Error?e:void 0;j.warn("DRM-PSS: Could not save MediaKeySession information",t)}}}function cf(e){return e.map(({systemId:e,data:t,hash:n})=>({systemId:e,hash:n,data:new af(t)}))}const df=new WeakMap;var hf={prepare(e){df.set(e,null)},set(e,t){const n=t instanceof Uint8Array?t:new Uint8Array(t instanceof ArrayBuffer?t:t.buffer),i=rf(n);df.set(e,{hash:i,serverCertificate:n})},hasOne(e){const t=df.get(e);return void 0!==t&&(null!==t||void 0)},has(e,t){const n=df.get(e);if(void 0===n||null===n)return!1;const{hash:i,serverCertificate:r}=n,a=t instanceof Uint8Array?t:new Uint8Array(t instanceof ArrayBuffer?t:t.buffer),s=rf(a);if(s!==i||r.length!==a.length)return!1;for(let o=0;o<r.length;o++)if(r[o]!==a[o])return!1;return!0}};function ff(e){const{persistentLicenseConfig:t}=e;return r(t)?null:(j.debug("DRM: Set the given license storage"),new uf(t))}async function pf(e,t,n){const i=await Kh(e,t,n);if(null!==n.cancellationError)throw n.cancellationError;const{options:a,mediaKeySystemAccess:s}=i.value,o=sr.getState(e),l=ff(a);if(Nh()&&null!==o&&"reuse-media-key-system-access"===i.type){const{mediaKeys:e,loadedSessionsStore:t}=o;if(!1===hf.hasOne(e)||!r(a.serverCertificate)&&hf.has(e,a.serverCertificate))return{mediaKeys:e,mediaKeySystemAccess:s,stores:{loadedSessionsStore:t,persistentSessionsStore:l},options:a}}const u=await gf(s);j.info("DRM: MediaKeys created with success");const c=new tf(u);return{mediaKeys:u,mediaKeySystemAccess:s,stores:{loadedSessionsStore:c,persistentSessionsStore:l},options:a}}async function gf(e){j.info("DRM: Calling createMediaKeys on the MediaKeySystemAccess");try{const t=await e.createMediaKeys();return t}catch(e){const t=e instanceof Error?e.message:"Unknown error when creating MediaKeys.";throw new lt("CREATE_MEDIA_KEYS_ERROR",t)}}async function mf(e,t,n){const i=await pf(e,t,n),{mediaKeys:r}=i,a=null!==e.mediaKeys&&void 0!==e.mediaKeys&&r!==e.mediaKeys;return a&&(j.debug("DRM: Disabling old MediaKeys"),await Ih(e)),i}function vf(e,t,n){const{baseDelay:i,maxDelay:a,totalRetry:s,shouldRetry:o,onRetry:l}=t;let u=0;return c();async function c(){if(null!==n.cancellationError)throw n.cancellationError;try{const t=await e();return t}catch(e){if(null!==n.cancellationError)throw n.cancellationError;if(!r(o)&&!o(e)||u++>=s)throw e;"function"===typeof l&&l(e,u);const t=yf(i,u,a);await Ri(t);const d=c();return d}}}function yf(e,t,n){const i=e*Math.pow(2,t-1),r=hn(i);return Math.min(r,n)}function bf(e,t){return-1!==e.indexOf("playready")&&(h||c)?Ls(t):t}class Sf extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,Sf.prototype),this.reason=e}}const Tf={EXPIRED:"expired",INTERNAL_ERROR:"internal-error",OUTPUT_RESTRICTED:"output-restricted"};function _f(e,t,n){const{onKeyInternalError:i,onKeyOutputRestricted:r,onKeyExpiration:a}=t,s=[],o=[],l=[];let u;return e.keyStatuses.forEach((e,t)=>{const[u,c]=(()=>{return"string"===typeof e?[e,t]:[t,e]})(),d=bf(n,new Uint8Array(c)),h={keyId:d.buffer,keyStatus:u};switch(j.hasLevel("DEBUG")&&j.debug(`DRM: key status update (${Ds(d)}): ${u}`),u){case Tf.EXPIRED:{const e=new lt("KEY_STATUS_CHANGE_ERROR",`A decryption key expired (${Ds(d)})`,{keyStatuses:[h,...l]});if("error"===a||void 0===a)throw e;switch(a){case"close-session":throw new Sf(e);case"fallback":s.push(d);break;default:"continue"===a||void 0===a?o.push(d):ge(a);break}l.push(h);break}case Tf.INTERNAL_ERROR:{const e=new lt("KEY_STATUS_CHANGE_ERROR",`A "${u}" status has been encountered (${Ds(d)})`,{keyStatuses:[h,...l]});switch(i){case void 0:case"error":throw e;case"close-session":throw new Sf(e);case"fallback":s.push(d);break;case"continue":o.push(d);break;default:if(void 0===i)throw e;ge(i)}l.push(h);break}case Tf.OUTPUT_RESTRICTED:{const e=new lt("KEY_STATUS_CHANGE_ERROR",`A "${u}" status has been encountered (${Ds(d)})`,{keyStatuses:[h,...l]});switch(r){case void 0:case"error":throw e;case"fallback":s.push(d);break;case"continue":o.push(d);break;default:if(void 0===r)throw e;ge(r)}l.push(h);break}default:o.push(d);break}}),l.length>0&&(u=new lt("KEY_STATUS_CHANGE_ERROR","One or several problematic key statuses have been encountered",{keyStatuses:l})),{warning:u,blacklistedKeyIds:s,whitelistedKeyIds:o}}function wf(e,t,n,i,a){j.info("DRM: Binding session events",e.sessionId);const{getLicenseConfig:s={}}=t,o=new me;return o.linkToSignal(a),r(e.closed)||e.closed.then(()=>o.cancel()).catch(e=>{a.isCancelled()||(o.cancel(),i.onError(e))}),Pr(e,e=>{o.cancel(),i.onError(new lt("KEY_ERROR",e.type))},o.signal),Or(e,()=>{j.info("DRM: keystatuseschange event received",e.sessionId);try{l()}catch(e){if(a.isCancelled()||o.isUsed()&&e instanceof ve)return;o.cancel(),i.onError(e)}},o.signal),Dr(e,t=>{const n=t,a=new Uint8Array(n.message),l=Ot(n.messageType)?n.messageType:"license-request";j.info(`DRM: Received message event, type ${l}`,e.sessionId);const d=c(s.retry);vf(()=>u(a,l),d,o.signal).then(t=>{if(o.isUsed())return Promise.resolve();if(r(t))j.info("DRM: No license given, skipping session.update");else try{return xf(e,t)}catch(e){o.cancel(),i.onError(e)}}).catch(e=>{if(o.isUsed())return;o.cancel();const t=Ef(e);if(!r(e)){const{fallbackOnLastTry:n}=e;if(!0===n)return j.warn("DRM: Last `getLicense` attempt failed. Blacklisting the current session."),void i.onError(new Af(t))}i.onError(t)})},o.signal),j.info("DRM: transmitting current keystatuses",e.sessionId),void l();function l(){if(o.isUsed()||0===e.keyStatuses.size)return;const{warning:r,blacklistedKeyIds:a,whitelistedKeyIds:s}=_f(e,t,n);void 0!==r&&(i.onWarning(r),o.isUsed())||i.onKeyUpdate({whitelistedKeyIds:s,blacklistedKeyIds:a})}function u(e,n){let i;return new Promise((a,o)=>{try{j.debug("DRM: Calling `getLicense`",n);const a=t.getLicense(e,n),c=r(s.timeout)?1e4:s.timeout;c>=0&&(i=setTimeout(()=>{o(new kf(`"getLicense" timeout exceeded (${c} ms)`))},c)),Promise.resolve(a).then(l,u)}catch(e){u(e)}function l(e){void 0!==i&&clearTimeout(i),a(e)}function u(e){void 0!==i&&clearTimeout(i),o(e)}})}function c(e){return{totalRetry:null!==e&&void 0!==e?e:2,baseDelay:200,maxDelay:3e3,shouldRetry:e=>e instanceof kf||r(e)||!0!==e.noRetry,onRetry:e=>i.onWarning(Ef(e))}}}function Ef(e){if(e instanceof kf)return new lt("KEY_LOAD_TIMEOUT","The license server took too much time to respond.");const t=new lt("KEY_LOAD_ERROR","An error occured when calling `getLicense`.");return!r(e)&&Ot(e.message)&&(t.message=e.message),t}async function xf(e,t){j.info("DRM: Updating MediaKeySession with message");try{await e.update(t)}catch(e){const t=e instanceof Error?e.toString():"`session.update` failed";throw new lt("KEY_UPDATE_ERROR",t)}j.info("DRM: MediaKeySession update succeeded.")}class Af extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,Af.prototype),this.sessionError=e}}class kf extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Af.prototype),this.message=e}}async function If(e,t){try{const n=await e.setServerCertificate(t);return n}catch(e){j.warn("DRM: mediaKeys.setServerCertificate returned an error",e instanceof Error?e:"");const t=e instanceof Error?e.toString():"`setServerCertificate` error";throw new lt("LICENSE_SERVER_CERTIFICATE_ERROR",t)}}async function Cf(e,t){if(!0===hf.hasOne(e))return j.info("DRM: The MediaKeys already has a server certificate, skipping..."),{type:"already-has-one"};if("function"!==typeof e.setServerCertificate)return j.warn("DRM: Could not set the server certificate. mediaKeys.setServerCertificate is not a function"),{type:"method-not-implemented"};j.info("DRM: Setting server certificate on the MediaKeys"),hf.prepare(e);try{const n=await If(e,t);return hf.set(e,t),{type:"success",value:n}}catch(e){const t=ht(e)?e:new lt("LICENSE_SERVER_CERTIFICATE_ERROR","Unknown error when setting the server certificate.");return{type:"error",value:t}}}function Rf(e,t){if(isNaN(t)||t<0||t>=e.getLength())return;const n=e.getLength(),i=n-t;j.info("DRM: Too many stored persistent sessions, removing some.",n,i),e.deleteOldSessions(i)}function Mf(e){return ji(e,"com.microsoft.playready")||"com.chromecast.playready"===e||"com.youtube.playready"===e?"9a04f07998404286ab92e65be0885f95":"com.widevine.alpha"===e?"edef8ba979d64acea3c827dcd51d21ed":ji(e,"com.apple.fps")?"94ce86fb07ff4f43adb893d2fa968ca2":ji(e,"com.nagra.")?"adb41c242dbf4a6d958b4457c0d27b95":void 0}class Df{constructor(e){this._innerValues=e,this._lazyFormattedValues=null}constructRequestData(){return Vr(...this._innerValues.map(e=>e.data))}isCompatibleWith(e){const t=e instanceof Df?e.getFormattedValues():e;return sf(this.getFormattedValues(),t)}getFormattedValues(){return null===this._lazyFormattedValues&&(this._lazyFormattedValues=Lf(this._innerValues)),this._lazyFormattedValues}}function Lf(e){return e.slice().sort((e,t)=>{return e.systemId===t.systemId?0:void 0===e.systemId?1:void 0===t.systemId?-1:e.systemId<t.systemId?-1:1}).map(({systemId:e,data:t})=>({systemId:e,data:t,hash:rf(t)}))}class Pf extends a{static hasEmeApis(){return!r(Th.requestMediaKeySystemAccess)}constructor(e,t){super(),j.debug("DRM: Starting ContentDecryptor logic.");const n=new me;this._currentSessions=[],this._canceller=n,this._initDataQueue=[],this._stateData={state:_a.Initializing,isMediaKeysAttached:0,isInitDataQueueLocked:!0,data:null},this.error=null,Th.onEncrypted(e,e=>{j.debug("DRM: Encrypted event received from media element.");const t=xh(e);null!==t&&this.onInitializationData(t)},n.signal),mf(e,t,n.signal).then(t=>{const{options:n,mediaKeySystemAccess:i}=t;let a;(r(n.persistentLicenseConfig)||!0===n.persistentLicenseConfig.disableRetroCompatibility)&&(a=Mf(i.keySystem)),this.systemId=a,this._stateData.state===_a.Initializing&&(this._stateData={state:_a.WaitingForAttachment,isInitDataQueueLocked:!0,isMediaKeysAttached:0,data:{mediaKeysInfo:t,mediaElement:e}},this.trigger("stateChange",this._stateData.state))}).catch(e=>{this._onFatalError(e)})}getState(){return this._stateData.state}attach(){if(this._stateData.state!==_a.WaitingForAttachment)throw new Error("`attach` should only be called when in the WaitingForAttachment state");if(0!==this._stateData.isMediaKeysAttached)return void j.warn("DRM: ContentDecryptor's `attach` method called more than once.");const{mediaElement:e,mediaKeysInfo:t}=this._stateData.data,{options:n,mediaKeys:i,mediaKeySystemAccess:a,stores:s}=t,o=!0===n.disableMediaKeysAttachmentLock;if(o&&(this._stateData={state:_a.ReadyForContent,isInitDataQueueLocked:!0,isMediaKeysAttached:1,data:{mediaKeysInfo:t,mediaElement:e}},this.trigger("stateChange",this._stateData.state),this._isStopped()))return;this._stateData.isMediaKeysAttached=1;const l={emeImplementation:Th,loadedSessionsStore:s.loadedSessionsStore,mediaKeySystemAccess:a,mediaKeys:i,keySystemOptions:n};j.debug("DRM: Attaching current MediaKeys"),Ch(e,l,this._canceller.signal).then(async()=>{this._stateData.isMediaKeysAttached=2;const{serverCertificate:e}=n;if(!r(e)){const t=await Cf(i,e);"error"===t.type&&this.trigger("warning",t.value)}if(this._isStopped())return;const a=this._stateData.state;this._stateData={state:_a.ReadyForContent,isMediaKeysAttached:2,isInitDataQueueLocked:!1,data:{mediaKeysData:t}},a!==_a.ReadyForContent&&this.trigger("stateChange",_a.ReadyForContent),this._isStopped()||this._processCurrentInitDataQueue()}).catch(e=>{this._onFatalError(e)})}dispose(){this.removeEventListener(),this._stateData={state:_a.Disposed,isMediaKeysAttached:void 0,isInitDataQueueLocked:void 0,data:null},this._canceller.cancel(),this.trigger("stateChange",this._stateData.state)}onInitializationData(e){if(!1!==this._stateData.isInitDataQueueLocked){if(this._isStopped())throw new Error("ContentDecryptor either disposed or stopped.");return void this._initDataQueue.push(e)}const{mediaKeysData:t}=this._stateData.data,n=Object.assign(Object.assign({},e),{values:new Df(e.values)});this._processInitializationData(n,t).catch(e=>{this._onFatalError(e)})}async _processInitializationData(e,t){var n,i,a;j.hasLevel("DEBUG")&&j.debug("DRM: processing init data",null===(n=e.content)||void 0===n?void 0:n.adaptation.type,null===(i=e.content)||void 0===i?void 0:i.representation.bitrate,(null!==(a=e.keyIds)&&void 0!==a?a:[]).map(e=>Ds(e)).join(", "));const{mediaKeySystemAccess:s,stores:o,options:l}=t;if(this._tryToUseAlreadyCreatedSession(e,t)||this._isStopped())return;if("content"===l.singleLicensePer){const t=Re(this._currentSessions,e=>"created-session"===e.source);if(void 0!==t){const n=e.keyIds;if(void 0===n)return void(void 0===e.content?j.warn("DRM: Unable to fallback from a non-decipherable quality."):(j.debug("DRM: Blacklisting new init data (due to singleLicensePer content policy)"),this.trigger("blackListProtectionData",e)));if(t.record.associateKeyIds(n),void 0===e.content)j.warn("DRM: Unable to fallback from a non-decipherable quality.");else{if(j.hasLevel("DEBUG")){const e=n.reduce((e,t)=>`${e}, ${Ds(t)}`,"");j.debug("DRM: Blacklisting new key ids",e)}this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:[],blacklistedKeyIds:n,delistedKeyIds:[]})}return}}else if("periods"===l.singleLicensePer&&void 0!==e.content){const{period:t}=e.content,n=this._currentSessions.filter(e=>"created-session"===e.source),i=new Set;jf(i,t);for(const e of n){const t=Array.from(i);for(const n of t)if(e.record.isAssociatedWithKeyId(n)){e.record.associateKeyIds(i.values());for(const n of t)e.keyStatuses.whitelisted.some(e=>yt(e,n))||e.keyStatuses.blacklisted.some(e=>yt(e,n))||e.keyStatuses.blacklisted.push(n);return j.hasLevel("DEBUG")&&j.debug("DRM: Session already created for",Ds(n),'under singleLicensePer "periods" policy'),void this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:e.keyStatuses.whitelisted,blacklistedKeyIds:e.keyStatuses.blacklisted,delistedKeyIds:[]})}}}let u;this._lockInitDataQueue(),r(l.persistentLicenseConfig)?u="temporary":Of(s)?u="persistent-license":(j.warn('DRM: Cannot create "persistent-license" session: not supported'),u="temporary");const{EME_DEFAULT_MAX_SIMULTANEOUS_MEDIA_KEY_SESSIONS:c,EME_MAX_STORED_PERSISTENT_SESSION_INFORMATION:d}=N.getCurrent(),h="number"===typeof l.maxSessionCacheSize?l.maxSessionCacheSize:c,f=await Oh(e,o,u,h,this._canceller.signal);if(this._isStopped())return;const p={record:f.value.keySessionRecord,source:f.type,keyStatuses:{whitelisted:[],blacklisted:[]},blacklistedSessionError:null};this._currentSessions.push(p);const{mediaKeySession:g,sessionType:m}=f.value;let v=!1;if(wf(g,l,s.keySystem,{onKeyUpdate:t=>{const n=Bf(e,p.record,l.singleLicensePer,"created-session"===p.source,t.whitelistedKeyIds,t.blacklistedKeyIds);if(p.record.associateKeyIds(n.whitelisted),p.record.associateKeyIds(n.blacklisted),p.keyStatuses={whitelisted:n.whitelisted,blacklisted:n.blacklisted},0!==p.record.getAssociatedKeyIds().length&&"persistent-license"===m&&null!==o.persistentSessionsStore&&!v){const{persistentSessionsStore:t}=o;Rf(t,d-1),t.add(e,p.record.getAssociatedKeyIds(),g),v=!0}void 0!==e.content&&this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:n.whitelisted,blacklistedKeyIds:n.blacklisted,delistedKeyIds:[]}),this._unlockInitDataQueue()},onWarning:e=>{this.trigger("warning",e)},onError:t=>{var n;if(t instanceof Sf){j.warn("DRM: A session's closing condition has been triggered"),this._lockInitDataQueue();const i=this._currentSessions.indexOf(p);return i>=0&&this._currentSessions.splice(i),void 0!==e.content&&this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:[],blacklistedKeyIds:[],delistedKeyIds:p.record.getAssociatedKeyIds()}),null===(n=o.persistentSessionsStore)||void 0===n||n.delete(g.sessionId),o.loadedSessionsStore.closeSession(g).catch(e=>{const t=e instanceof Error?e:"unknown error";j.warn("DRM: failed to close expired session",t)}).then(()=>this._unlockInitDataQueue()).catch(e=>this._onFatalError(e)),void(this._isStopped()||this.trigger("warning",t.reason))}t instanceof Af?(p.blacklistedSessionError=t,void 0!==e.content&&(j.info("DRM: blacklisting Representations based on protection data."),this.trigger("blackListProtectionData",e)),this._unlockInitDataQueue()):this._onFatalError(t)}},this._canceller.signal),void 0!==l.singleLicensePer&&"init-data"!==l.singleLicensePer||this._unlockInitDataQueue(),"created-session"===f.type){const t=e.values.constructRequestData();try{await o.loadedSessionsStore.generateLicenseRequest(g,e.type,t)}catch(e){const t=o.loadedSessionsStore.getEntryForSession(g);if(null===t||"none"!==t.closingStatus.type){const e=this._currentSessions.indexOf(p);return e>=0&&this._currentSessions.splice(e,1),Promise.resolve()}throw new lt("KEY_GENERATE_REQUEST_ERROR",e instanceof Error?e.toString():"Unknown error")}}return Promise.resolve()}_tryToUseAlreadyCreatedSession(e,t){const{stores:n,options:i}=t,a=Re(this._currentSessions,t=>t.record.isCompatibleWith(e));if(void 0===a)return!1;const s=a.blacklistedSessionError;if(!r(s))return void 0===e.type||void 0===e.content?(j.error("DRM: This initialization data has already been blacklisted but the current content is not known."),!0):(j.info("DRM: This initialization data has already been blacklisted. Blacklisting the related content."),this.trigger("blackListProtectionData",e),!0);if(void 0!==e.keyIds){let t;if(void 0===i.singleLicensePer||"init-data"===i.singleLicensePer){const{blacklisted:n}=a.keyStatuses;t=Jh(e.keyIds,n)}else{const{whitelisted:n}=a.keyStatuses;t=!Zh(e.keyIds,n)}if(t)return void 0===e.content?(j.error("DRM: Cannot forbid key id, the content is unknown."),!0):(j.info("DRM: Current initialization data is linked to blacklisted keys. Marking Representations as not decipherable"),this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:[],blacklistedKeyIds:e.keyIds,delistedKeyIds:[]}),!0)}const o=n.loadedSessionsStore.reuse(e);if(null!==o)return j.debug("DRM: Init data already processed. Skipping it."),!0;const l=this._currentSessions.indexOf(a);return-1===l?j.error("DRM: Unable to remove processed init data: not found."):(j.debug("DRM: A session from a processed init data is not available anymore. Re-processing it."),this._currentSessions.splice(l,1)),!1}_onFatalError(e){if(this._canceller.isUsed())return;const t=e instanceof Error?e:new dt("NONE","Unknown decryption error");this.error=t,this._initDataQueue.length=0,this._stateData={state:_a.Error,isMediaKeysAttached:void 0,isInitDataQueueLocked:void 0,data:null},this._canceller.cancel(),this.trigger("error",t),this._stateData.state===_a.Error&&this.trigger("stateChange",this._stateData.state)}_isStopped(){return this._stateData.state===_a.Disposed||this._stateData.state===_a.Error}_processCurrentInitDataQueue(){while(!1===this._stateData.isInitDataQueueLocked){const e=this._initDataQueue.shift();if(void 0===e)return;this.onInitializationData(e)}}_lockInitDataQueue(){!1===this._stateData.isInitDataQueueLocked&&(this._stateData.isInitDataQueueLocked=!0)}_unlockInitDataQueue(){2===this._stateData.isMediaKeysAttached?(this._stateData.isInitDataQueueLocked=!1,this._processCurrentInitDataQueue()):j.error("DRM: Trying to unlock in the wrong state")}}function Of(e){const{sessionTypes:t}=e.getConfiguration();return void 0!==t&&gt(t,"persistent-license")}function Nf(e,t){return e.filter(e=>{return!t.some(t=>yt(t,e))})}function Uf(e,t){const n=e.getAssociatedKeyIds(),i=Nf(n,t);return i.length>0&&j.hasLevel("DEBUG")&&j.debug("DRM: KeySessionRecord's keys missing in the license, blacklisting them",i.map(e=>Ds(e)).join(", ")),i}function Ff(e,t){let n=[];const{keyIds:i}=e;return void 0!==i&&(n=Nf(i,t)),n.length>0&&j.hasLevel("DEBUG")&&j.debug("DRM: init data keys missing in the license, blacklisting them",n.map(e=>Ds(e)).join(", ")),n}function Bf(e,t,n,i,r,a){var s;const o=[...r,...a],l=Uf(t,o),u=o.concat(l);if(void 0!==n&&"init-data"!==n){const t=Ff(e,u);u.push(...t);const{content:r}=e;if(i&&void 0!==r)if("content"===n){const e=new Set,{manifest:t}=r;for(const n of t.periods)jf(e,n);Vf(e,u)}else if("periods"===n){const{manifest:t}=r;for(const n of t.periods){const t=new Set;if(jf(t,n),(null===(s=e.content)||void 0===s?void 0:s.period.id)===n.id)Vf(t,u);else{const e=Array.from(t);for(const n of e){const e=u.some(e=>yt(e,n));if(e){Vf(t,u);break}}}}}}return{whitelisted:r,blacklisted:u.slice(r.length)}}function Vf(e,t){const n=Array.from(e.values());for(const i of n){const e=t.some(e=>yt(e,i));e||t.push(i)}}function jf(e,t){const n=t.adaptations,i=Ke(n).reduce((e,t)=>r(t)?e:e.concat(t),[]);for(const r of i)for(const t of r.representations)if(void 0!==t.contentProtections&&void 0!==t.contentProtections.keyIds)for(const n of t.contentProtections.keyIds)e.add(n.keyId)}var Gf=Pf;function Hf(e){e.decrypt=Gf}function zf(e){var t;let n,i;const r="subtitles";if(h){const i=e.textTracks.length;n=i>0?e.textTracks[i-1]:e.addTextTrack(r),n.mode=null!==(t=n.SHOWING)&&void 0!==t?t:"showing"}else i=document.createElement("track"),e.appendChild(i),n=i.track,i.kind=r,n.mode="showing";return{track:n,trackElement:i}}function Kf(e,t){const{activeCues:n}=e;if(null===n)return!1;for(let i=0;i<n.length;i++)if(n[i]===t)return!0;return!1}function $f(e,t){if(f&&Kf(e,t)){const n=e.mode;e.mode="hidden";try{e.removeCue(t)}catch(e){j.warn("Compat: Could not remove cue from text track.")}e.mode=n}else try{e.removeCue(t)}catch(e){j.warn("Compat: Could not remove cue from text track.")}}class Wf{constructor(){this._ranges=[],this.length=0}insert(e,t){re(this._ranges,{start:e,end:t}),this.length=this._ranges.length}remove(e,t){const n=[];e>0&&n.push({start:0,end:e}),t<1/0&&n.push({start:t,end:1/0}),this._ranges=se(this._ranges,n),this.length=this._ranges.length}start(e){if(e>=this._ranges.length)throw new Error("INDEX_SIZE_ERROR");return this._ranges[e].start}end(e){if(e>=this._ranges.length)throw new Error("INDEX_SIZE_ERROR");return this._ranges[e].end}}function qf(e,t,n,i){j.debug("NTSB: Finding parser for native text tracks:",e);const r=$t.nativeTextTracksParsers[e];if("function"!==typeof r)throw new Error("no parser found for the given text track");j.debug("NTSB: Parser found, parsing...");const a=r(t,n,i);return j.debug("NTSB: Parsed successfully!",a.length),a}class Yf{constructor(e){j.debug("NTD: Creating NativeTextDisplayer");const{track:t,trackElement:n}=zf(e);this._buffered=new Wf,this._videoElement=e,this._track=t,this._trackElement=n}pushTextData(e){var t,n;if(j.debug("NTD: Appending new native text tracks"),null===e.chunk)return Q(this._buffered);const{timestampOffset:i,appendWindow:r,chunk:a}=e,{start:s,end:o,data:l,type:u,language:c}=a,d=null!==(t=r[0])&&void 0!==t?t:0,h=null!==(n=r[1])&&void 0!==n?n:1/0,f=qf(u,l,i,c);if(0!==d&&h!==1/0){let e=0;while(e<f.length&&f[e].endTime<=d)e++;f.splice(0,e),e=0;while(e<f.length&&f[e].startTime<d)f[e].startTime=d,e++;e=f.length-1;while(e>=0&&f[e].startTime>=h)e--;f.splice(e,f.length),e=f.length-1;while(e>=0&&f[e].endTime>h)f[e].endTime=h,e--}let p,g;if(void 0!==s)p=Math.max(d,s);else{if(f.length<=0)return j.warn("NTD: Current text tracks have no cues nor start time. Aborting"),Q(this._buffered);j.warn("NTD: No start time given. Guessing from cues."),p=f[0].startTime}if(void 0!==o)g=Math.min(h,o);else{if(f.length<=0)return j.warn("NTD: Current text tracks have no cues nor end time. Aborting"),Q(this._buffered);j.warn("NTD: No end time given. Guessing from cues."),g=f[f.length-1].endTime}if(g<=p)return j.warn("NTD: Invalid text track appended: ","the start time is inferior or equal to the end time."),Q(this._buffered);if(f.length>0){const e=f[0],t=this._track.cues;null!==t&&t.length>0&&e.startTime<t[t.length-1].startTime&&this._removeData(e.startTime,1/0);for(const n of f)this._track.addCue(n)}return this._buffered.insert(p,g),Q(this._buffered)}removeBuffer(e,t){return this._removeData(e,t),Q(this._buffered)}getBufferedRanges(){return Q(this._buffered)}reset(){j.debug("NTD: Aborting NativeTextDisplayer"),this._removeData(0,1/0);const{_trackElement:e,_videoElement:t}=this;if(void 0!==e&&t.hasChildNodes())try{t.removeChild(e)}catch(e){j.warn("NTD: Can't remove track element from the video")}const n=this._track.mode;this._track.mode="disabled",this._track.mode=n,void 0!==this._trackElement&&(this._trackElement.innerHTML="")}stop(){j.debug("NTD: Aborting NativeTextDisplayer"),this._removeData(0,1/0);const{_trackElement:e,_videoElement:t}=this;if(void 0!==e&&t.hasChildNodes())try{t.removeChild(e)}catch(e){j.warn("NTD: Can't remove track element from the video")}this._track.mode="disabled",void 0!==this._trackElement&&(this._trackElement.innerHTML="")}_removeData(e,t){j.debug("NTD: Removing native text track data",e,t);const n=this._track,i=n.cues;if(null!==i)for(let r=i.length-1;r>=0;r--){const a=i[r],{startTime:s,endTime:o}=a;s>=e&&s<=t&&o<=t&&$f(n,a)}this._buffered.remove(e,t)}}var Xf=Yf;const Qf=/(\d+) (\d+)/;function Zf(e){const t=e.getAttribute("ttp:frameRate"),n=e.getAttribute("ttp:subFramRate"),i=e.getAttribute("ttp:tickRate"),r=e.getAttribute("ttp:frameRateMultiplier"),a=e.getAttribute("xml:space"),s=e.getAttribute("ttp:cellResolution");let o={columns:32,rows:15};if(null!==s){const e=Qf.exec(s);if(null===e||e.length<3)j.warn("TTML Parser: Invalid cellResolution");else{const t=parseInt(e[1],10),n=parseInt(e[2],10);isNaN(t)||isNaN(n)?j.warn("TTML Parser: Invalid cellResolution"):o={columns:t,rows:n}}}if(Ot(a)&&"default"!==a&&"preserve"!==a)throw new Error("Invalid spacing style");let l=Number(t);(isNaN(l)||l<=0)&&(l=30);let u=Number(n);(isNaN(u)||u<=0)&&(u=1);let c=Number(i);(isNaN(c)||c<=0)&&(c=void 0);let d=l;const h=null!==u&&void 0!==u?u:1,f=null!==a&&void 0!==a?a:"default",p=null!==c&&void 0!==c?c:l*u;if(null!==r){const e=/^(\d+) (\d+)$/g.exec(r);if(null!==e){const t=Number(e[1]),n=Number(e[2]),i=t/n;d=l*i}}return{cellResolution:o,tickRate:p,frameRate:d,subFrameRate:h,spaceStyle:f}}function Jf(e,t,n,i){const r={},a=e.slice();for(let s=0;s<=t.length-1;s++){const e=t[s];if(void 0!==e){let t,s;if(e.nodeType===Node.ELEMENT_NODE){const n=e;for(let e=0;e<=n.attributes.length-1;e++){const i=n.attributes[e],o=i.name;if("style"===o)t=i.value;else if("region"===o)s=i.value;else{const t=o.substring(4);if(gt(a,t)&&(r[t]=i.value,a.splice(e,1),0===a.length))return r}}}if(Ot(t)){const e=Re(n,e=>e.id===t);if(void 0!==e)for(let t=0;t<=a.length-1;t++){const n=a[t];if(!Ot(r[n])&&Ot(e.style[n])){if(r[n]=e.style[n],a.splice(t,1),0===a.length)return r;t--}}}if(Ot(s)){const e=Re(i,e=>e.id===s);if(void 0!==e)for(let t=0;t<=a.length-1;t++){const n=a[t];if(!Ot(r[n])&&Ot(e.style[n])){if(r[n]=e.style[n],a.splice(t,1),0===a.length)return r;t--}}}}}return r}function ep(e){if(e.nodeType!==Node.ELEMENT_NODE)return{};const t=e,n={};for(let i=0;i<=t.attributes.length-1;i++){const e=t.attributes[i];if(ji(e.name,"tts")){const t=e.name.substring(4);n[t]=e.value}}return n}function tp(e){const t=[];function n(i,r){t.push(r);for(let a=0;a<i.extendsStyles.length;a++){const r=i.extendsStyles[a],s=le(e,e=>e.id===r);if(s<0)j.warn("TTML Parser: unknown style inheritance: "+r);else{const r=e[s];gt(t,s)?j.warn("TTML Parser: infinite style inheritance loop avoided"):n(r,s),i.style=M({},r.style,i.style)}}i.extendsStyles.length=0}for(let i=0;i<e.length;i++)n(e[i],i),t.length=0}function np(e,t){if(!(e.parentNode instanceof Element))return[];function n(e){const i=[];e.tagName.toLowerCase()===t.toLowerCase()&&i.push(e);const r=e.parentNode;return r instanceof Element&&i.push(...n(r)),i}return n(e.parentNode)}function ip(e){let t=np(e,"div");if(0===t.length){const n=np(e,"tt:div");n.length>0&&(t=n)}return t}function rp(e){const t=e.getElementsByTagName("body");if(t.length>0)return t[0];const n=e.getElementsByTagName("tt:body");return n.length>0?n[0]:null}function ap(e){const t=e.getElementsByTagName("style");if(t.length>0)return t;const n=e.getElementsByTagName("tt:style");return n.length>0?n:t}function sp(e){const t=e.getElementsByTagName("region");if(t.length>0)return t;const n=e.getElementsByTagName("tt:region");return n.length>0?n:t}function op(e){const t=e.getElementsByTagName("p");if(t.length>0)return t;const n=e.getElementsByTagName("tt:p");return n.length>0?n:t}function lp(e){return"br"===e.nodeName||"tt:br"===e.nodeName}function up(e){return"span"===e.nodeName||"tt:span"===e.nodeName}const cp=["align","backgroundColor","color","direction","display","displayAlign","extent","fontFamily","fontSize","fontStyle","fontWeight","lineHeight","opacity","origin","overflow","padding","textAlign","textDecoration","textOutline","unicodeBidi","visibility","wrapOption","writingMode"];function dp(e,t){const n=[],i=(new DOMParser).parseFromString(e,"text/xml");if(null!==i&&void 0!==i){const e=i.getElementsByTagName("tt");let r=e[0];if(void 0===r){const e=i.getElementsByTagNameNS("*","tt");if(r=e[0],void 0===r)throw new Error("invalid XML")}const a=rp(r),s=ap(r),o=sp(r),l=op(r),u=Zf(r),c=[];for(let t=0;t<=s.length-1;t++){const e=s[t];if(e instanceof Element){const t=e.getAttribute("xml:id");if(null!==t){const n=e.getAttribute("style"),i=null===n?[]:n.split(" ");c.push({id:t,style:ep(e),extendsStyles:i})}}}tp(c);const d=[];for(let t=0;t<=o.length-1;t++){const e=o[t];if(e instanceof Element){const t=e.getAttribute("xml:id");if(null!==t){let n=ep(e);const i=e.getAttribute("style");if(Ot(i)){const e=Re(c,e=>e.id===i);void 0!==e&&(n=M({},e.style,n))}d.push({id:t,style:n,extendsStyles:[]})}}}const h=Jf(cp,null!==a?[a]:[],c,d),f=null!==a?a.getAttribute("xml:space"):void 0,p="default"===f||"default"===u.spaceStyle;for(let i=0;i<l.length;i++){const e=l[i];if(e instanceof Element){const i=ip(e),r=M({},h,Jf(cp,[e,...i],c,d)),s=e.getAttribute("xml:space"),o=Ot(s)?"default"===s:p,l={paragraph:e,timeOffset:t,idStyles:c,regionStyles:d,body:a,paragraphStyle:r,ttParams:u,shouldTrimWhiteSpace:o};null!==l&&n.push(l)}}}return n}function hp(e){return"function"===typeof s["a"].VTTCue&&e instanceof s["a"].VTTCue}function fp(e,t,n){if(e>=t)return j.warn(`Compat: Invalid cue times: ${e} - ${t}`),null;if(r(s["a"].VTTCue)){if(r(s["a"].TextTrackCue))throw new Error("VTT cues not supported in your target");return new TextTrackCue(e,t,n)}return new VTTCue(e,t,n)}const pp=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,gp=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,mp=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,vp=/^(\d*\.?\d*)f$/,yp=/^(\d*\.?\d*)t$/,bp=/^(?:(\d*\.?\d*)h)?(?:(\d*\.?\d*)m)?(?:(\d*\.?\d*)s)?(?:(\d*\.?\d*)ms)?$/,Sp=/^(\d{1,2}|100)% (\d{1,2}|100)%$/,Tp=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/,_p=/^#([0-9A-f]{2})([0-9A-f]{2})([0-9A-f]{2})([0-9A-f]{2})$/,wp=/^#([0-9A-f])([0-9A-f])([0-9A-f])([0-9A-f])$/,Ep=/^rgb\( *(\d+) *, *(\d+) *, *(\d+) *\)/,xp=/^rgba\( *(\d+) *, *(\d+) *, *(\d+) *, *(\d+) *\)/;function Ap(e,t){return pp.test(e)?Cp(t,e):gp.test(e)?Rp(gp,e):mp.test(e)?Rp(mp,e):vp.test(e)?kp(t,e):yp.test(e)?Ip(t,e):bp.test(e)?Rp(bp,e):void 0}function kp(e,t){const n=vp.exec(t),i=Number(n[1]);return i/e.frameRate}function Ip(e,t){const n=yp.exec(t),i=Number(n[1]);return i/e.tickRate}function Cp(e,t){const n=pp.exec(t),i=Number(n[1]),r=Number(n[2]);let a=Number(n[3]),s=Number(n[4]),o=Number(n[5]);return isNaN(o)&&(o=0),s+=o/e.subFrameRate,a+=s/e.frameRate,a+60*r+3600*i}function Rp(e,t){const n=e.exec(t);if(null===n||""===n[0])return null;let i=Number(n[1]);isNaN(i)&&(i=0);let r=Number(n[2]);isNaN(r)&&(r=0);let a=Number(n[3]);isNaN(a)&&(a=0);let s=Number(n[4]);return isNaN(s)&&(s=0),s/1e3+a+60*r+3600*i}var Mp=Ap;function Dp(e,t){const n=e.getAttribute("begin"),i=e.getAttribute("dur"),a=e.getAttribute("end"),s=Ot(n)?Mp(n,t):null,o=Ot(i)?Mp(i,t):null,l=Ot(a)?Mp(a,t):null;if(r(s)||r(l)&&r(o))throw new Error("Invalid text cue");const u=r(l)?s+o:l;return{start:s,end:u}}const Lp={left:"start",center:"center",right:"end",start:"start",end:"end"},Pp={left:"line-left",center:"center",right:"line-right"};function Op(e){const{paragraph:t,timeOffset:n,paragraphStyle:i,ttParams:r,shouldTrimWhiteSpace:a}=e;if(!t.hasAttribute("begin")&&!t.hasAttribute("end")&&/^\s*$/.test(null===t.textContent?"":t.textContent))return null;const{start:s,end:o}=Dp(t,r),l=Np(t,a),u=fp(s+n,o+n,l);return null===u?null:(hp(u)&&Up(u,i),u)}function Np(e,t){function n(e,t){const i=e.childNodes;let r="";for(let a=0;a<i.length;a++){const e=i[a];if("#text"===e.nodeName){let n=e.textContent;if(null===n&&(n=""),t){let e=n.trim();e=e.replace(/\s+/g," "),n=e}const i=n.replace(/&|\u0026/g,"&amp;").replace(/<|\u003C/g,"&lt;").replace(/>|\u2265/g,"&gt;").replace(/\u200E/g,"&lrm;").replace(/\u200F/g,"&rlm;").replace(/\u00A0/g,"&nbsp;");r+=i}else if(lp(e))r+="\n";else if(up(e)&&e.nodeType===Node.ELEMENT_NODE&&e.childNodes.length>0){const i=e.getAttribute("xml:space"),a=Ot(i)?"default"===i:t;r+=n(e,a)}}return r}return n(e,t)}function Up(e,t){const n=t.extent;if(Ot(n)){const t=Sp.exec(n);r(t)||(e.size=Number(t[1]))}const i=t.writingMode;switch(i){case"tb":case"tblr":e.vertical="lr";break;case"tbrl":e.vertical="rl";break;default:break}const a=t.origin;if(Ot(a)){const e=Sp.exec(a);r(e)}const s=t.align;if(Ot(s)){e.align=s,"center"===s&&("center"!==e.align&&(e.align="middle"),e.position="auto");const t=Pp[s];e.positionAlign=void 0===t?"":t;const n=Lp[s];e.lineAlign=void 0===n?"":n}}function Fp(e,t){const n=dp(e,t),i=[];for(let r=0;r<n.length;r++){const e=n[r],t=Op(e);null!==t&&i.push(t)}return i}var Bp=Fp;function Vp(e){e.nativeTextTracksParsers.ttml=Bp,e.nativeTextDisplayer=Xf}const jp=/&#([0-9]+);/g,Gp=/<br>/gi,Hp=/<style[^>]*>([\s\S]*?)<\/style[^>]*>/i,zp=/\s*<p (?:class=([^>]+))?>(.*)/i,Kp=/<sync[^>]+?start="?([0-9]*)"?[^0-9]/i;function $p(e){const t=[];for(let n=0;n<e.length;n++){const{start:i,end:a,text:s}=e[n];if(Ot(s)&&!r(a)){const e=fp(i,a,s);null!==e&&t.push(e)}}return t}function Wp(e){const t=/\.(\S+)\s*{([^}]*)}/gi,n={};let i=t.exec(e);while(Array.isArray(i)){const a=i[1],s=qp(i[2],"lang");r(a)||r(s)||(n[s]=a),i=t.exec(e)}return n}function qp(e,t){const n=new RegExp("\\s*"+t+":\\s*(\\S+);","i").exec(e);return Array.isArray(n)?n[1]:null}function Yp(e){return e.replace(Gp,"\n").replace(jp,(e,t)=>String.fromCharCode(Number(t)))}function Xp(e,t,n){const i=/<sync[ >]/gi,r=/<sync[ >]|<\/body>/gi,a=[],s=Hp.exec(e),o=null!==s?s[1]:"";let l,u;r.exec(e);const c=Wp(o);let d;if(Ot(n)&&(d=c[n],void 0===d))throw new Error(`sami: could not find lang ${n} in CSS`);while(1){if(l=i.exec(e),u=r.exec(e),null===l&&null===u)break;if(null===l||null===u||l.index>=u.index)throw new Error("parse error");const t=e.slice(l.index,u.index),n=Kp.exec(t);if(null===n)throw new Error("parse error (sync time attribute)");const a=+n[1];if(isNaN(a))throw new Error("parse error (sync time attribute NaN)");h(t.split("\n"),a/1e3)}return $p(a);function h(e,n){let i,r=e.length;while(--r>=0){if(i=zp.exec(e[r]),null===i)continue;const[,s,o]=i;d===s&&("&nbsp;"===o?a[a.length-1].end=n:a.push({text:Yp(o),start:n+t}))}}}var Qp=Xp;function Zp(e){e.nativeTextTracksParsers.sami=Qp,e.nativeTextDisplayer=Xf}function Jp(e){let t=0;while(t<e.length){if(""===e[t])return t+1;t++}return t}function eg(e,t){return"string"===typeof e[t]&&/^STYLE( .*)?$/g.test(e[t])&&(void 0===e[t+1]||e[t+1].indexOf("--\x3e")<0)}function tg(e,t){return"string"===typeof e[t]&&/^NOTE( .*)?$/g.test(e[t])&&(void 0===e[t+1]||e[t+1].indexOf("--\x3e")<0)}function ng(e,t){return"string"===typeof e[t]&&/^REGION( .*)?$/g.test(e[t])&&(void 0===e[t+1]||e[t+1].indexOf("--\x3e")<0)}function ig(e,t){const n=e[t];if(void 0===n||""===n||eg(e,t)||ng(e,t)||tg(e,t))return!1;if(n.indexOf("--\x3e")>=0)return!0;const i=e[t+1];return void 0!==i&&i.indexOf("--\x3e")>=0}function rg(e,t){let n=t+1;while(Ot(e[n]))n++;return n}function ag(e,t){const n=[];for(let i=t;i<e.length;i++)if(ig(e,i)){const t=rg(e,i);n.push(e.slice(i,t)),i=t}else if(Ot(e[i]))while(Ot(e[i]))i++;return n}function sg(e){const t=e.split(":").reverse();if(Ot(t[2])||Ot(t[1])){const e=Ot(t[2])?parseInt(t[2],10):0,n=parseInt(t[1],10),i=parseFloat(t[0].replace(",","."));if(isNaN(e)||isNaN(n)||isNaN(i))return;return 60*e*60+60*n+i}}function og(e){const t=e.split(/ |\t/);return t.reduce((e,t)=>{const n=t.split(":");return 2===n.length&&(e[n[0]]=n[1]),e},{})}function lg(e){const t=/^([\d:.]+)[ |\t]+-->[ |\t]+([\d:.]+)[ |\t]*(.*)$/,n=t.exec(e);if(null===n)return null;const i=sg(n[1]),r=sg(n[2]);if(void 0===i||void 0===r)return null;const a=og(n[3]);return{start:i,end:r,settings:a}}function ug(e,t){const n=/-->/;let i,r,a;if(n.test(e[0]))i=e[0],r=e.slice(1,e.length);else{if(!n.test(e[1]))return null;a=e[0],i=e[1],r=e.slice(2,e.length)}const s=lg(i);if(null===s)return null;const{start:o,end:l,settings:u}=s;return{start:o+t,end:l+t,settings:u,payload:r,header:a}}function cg(e,t){if(!Ot(e.vertical)||"rl"!==e.vertical&&"lr"!==e.vertical||(t.vertical=e.vertical),Ot(e.line)){const n=/^(\d+(\.\d+)?)%(,([a-z]+))?/,i=n.exec(e.line);if(Array.isArray(i))t.line=Number(i[1]),t.snapToLines=!1,gt(["start","center","end"],i[4])&&(t.lineAlign=i[4]);else{const n=/^(-?\d+)(,([a-z]+))?/,i=n.exec(e.line);Array.isArray(i)&&(t.line=Number(i[1]),t.snapToLines=!0,gt(["start","center","end"],i[3])&&(t.lineAlign=i[3]))}}if(Ot(e.position)){const n=/^([\d\.]+)%(?:,(line-left|line-right|center))?$/,i=n.exec(e.position);if(Array.isArray(i)&&i.length>=2){const e=parseInt(i[1],10);isNaN(e)||(t.position=e,void 0!==i[2]&&(t.positionAlign=i[2]))}}Ot(e.size)&&(t.size=e.size),"string"===typeof e.align&&gt(["start","center","end","left"],e.align)&&(t.align=e.align)}function dg(e){const{start:t,end:n,payload:i}=e,r=i.join("\n");return fp(t,n,r)}function hg(e,t){const n=e.split(/\r\n|\n|\r/);if(!/^WEBVTT($| |\t)/.test(n[0]))throw new Error("Can't parse WebVTT: Invalid file.");const i=Jp(n),r=ag(n,i),a=[];for(let s=0;s<r.length;s++){const e=ug(r[s],t);if(null!==e){const t=dg(e);null!==t&&(hp(t)&&cg(e.settings,t),a.push(t))}}return a}var fg=hg;function pg(e){e.nativeTextTracksParsers.vtt=fg,e.nativeTextDisplayer=Xf}function gg(e,t){let n=t+1;while(Ot(e[n]))n++;return n}function mg(e){const t=[];for(let n=0;n<e.length;n++)if(Ot(e[n])){const i=gg(e,n),r=e.slice(n,i);r.length>0&&(1===r.length?r[0].indexOf("--\x3e")>=0&&t.push(r):(r[1].indexOf("--\x3e")>=0||r[0].indexOf("--\x3e")>=0)&&t.push(r)),n=i}return t}function vg(e){const t=e.split(":");if(Ot(t[2])){const e=parseInt(t[0],10),n=parseInt(t[1],10),i=parseFloat(t[2].replace(",","."));if(isNaN(e)||isNaN(n)||isNaN(i))return;return 60*e*60+60*n+i}}function yg(e,t){if(0===e.length)return null;let n,i,r=[];if(Ot(e[1])&&-1!==e[1].indexOf("--\x3e")&&([n,i]=e[1].split("--\x3e").map(e=>e.trim()),r=e.slice(2,e.length)),Ot(n)&&Ot(i)||([n,i]=e[0].split("--\x3e").map(e=>e.trim()),r=e.slice(1,e.length)),!Ot(n)||!Ot(i))return null;const a=vg(n),s=vg(i);return void 0===a||void 0===s?null:{start:a+t,end:s+t,payload:r}}function bg(e,t){const n=e.split(/\r\n|\n|\r/),i=mg(n),r=[];for(let a=0;a<i.length;a++){const e=yg(i[a],t);if(null!==e){const t=Sg(e);null!==t&&r.push(t)}}return r}function Sg(e){const{start:t,end:n,payload:i}=e,r=i.join("\n");return fp(t,n,r)}function Tg(e){e.nativeTextTracksParsers.srt=bg,e.nativeTextDisplayer=Xf}const _g=s["a"].ResizeObserver;function wg(e,t,n){const{height:i,width:r}=e.getBoundingClientRect(),a=new de({height:i,width:r},n);let s=i,o=r;if(void 0!==_g){const t=new _g(e=>{if(0===e.length)return void j.error("Compat: Resized but no observed element.");const t=e[0],{height:n,width:i}=t.contentRect;n===s&&i===o||(s=n,o=i,a.setValue({height:n,width:i}))});t.observe(e),n.register(()=>{t.disconnect()})}else{const i=setInterval(()=>{const{height:t,width:n}=e.getBoundingClientRect();t===s&&n===o||(s=t,o=n,a.setValue({height:t,width:n}))},t);n.register(()=>{clearInterval(i)})}return a}function Eg(e,t,n,i){j.debug("HTSB: Finding parser for html text tracks:",e);const r=$t.htmlTextTracksParsers[e];if("function"!==typeof r)throw new Error("no parser found for the given text track");j.debug("HTSB: Parser found, parsing...");const a=r(t,n,i);return j.debug("HTTB: Parsed successfully!",a.length),a}const xg=.2;function Ag(e,t,n=xg){return Math.abs(e-t)<=Math.min(n,xg)}const kg=.05;function Ig(e,t){const n=e.end-e.start,i=t.end-t.start,r=Math.abs(e.start-t.start),a=Math.min(n,i,xg);return r/a<=kg}function Cg(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.start<t)return e.slice(0,n+1)}return[]}function Rg(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.end>t)return e.slice(n,e.length)}return[]}function Mg(e,t,n){const i=Math.max(e.start,t),r=Cg(e.cues,t),a={start:e.start,end:i,cues:r},s=Math.min(n,e.end),o=Rg(e.cues,n),l={start:s,end:e.end,cues:o};return[a,l]}const Dg=.001,Lg=5;class Pg{constructor(){this._cuesBuffer=[]}isEmpty(){return 0===this._cuesBuffer.length}get(e){const t=this._cuesBuffer,n=[];for(let i=t.length-1;i>=0;i--){const r=t[i];if(e<r.end&&e>=r.start){const t=r.cues;for(const i of t)e>=i.start&&e<i.end&&n.push(i.element);if(0===n.length&&t.length>0)for(const i of t)(Ag(e,i.start,Dg)||Ag(e,i.end,Dg))&&n.push(i.element);return n}}return[]}remove(e,t){const n=Math.max(e,t),i=this._cuesBuffer;for(let r=0;r<i.length;r++)if(i[r].end>e){const t=i[r];if(t.start>=n)return;if(t.end>=n){if(e<=t.start)t.cues=Rg(t.cues,n),t.start=n;else{const[a,s]=Mg(t,e,n);this._cuesBuffer[r]=a,i.splice(r+1,0,s)}return}t.start>=e?(i.splice(r,1),r--):(t.cues=Cg(t.cues,e),t.end=Math.max(e,t.start))}}insert(e,t,n){const i=this._cuesBuffer,r={start:t,end:n,cues:e},a=Math.abs(t-n)/Lg;function s(e){const t=i[e];void 0===t||Ag(r.end,t.end,a)?i[e]=r:t.start>=r.end?i.splice(e,0,r):(t.cues=Rg(t.cues,r.end),t.start=r.end,i.splice(e,0,r))}for(let o=0;o<i.length;o++){let e=i[o];if(t<e.end){if(Ig(r,e)){if(Ag(n,e.end,a))return void(i[o]=r);if(n<e.end)return e.cues=Rg(e.cues,n),e.start=n,void i.splice(o,0,r);do{i.splice(o,1),e=i[o]}while(void 0!==e&&n>e.end);return void s(o)}if(t<e.start){if(n<e.start)return void i.splice(o,0,r);if(Ag(n,e.start,a))return e.start=n,void i.splice(o,0,r);if(Ag(n,e.end,a))return void i.splice(o,1,r);if(n<e.end)return e.cues=Rg(e.cues,n),e.start=n,void i.splice(o,0,r);do{i.splice(o,1),e=i[o]}while(void 0!==e&&n>e.end);return void s(o)}if(Ag(e.end,n,a))return e.cues=Cg(e.cues,t),e.end=t,void i.splice(o+1,0,r);if(e.end>n){const[a,s]=Mg(e,t,n);return this._cuesBuffer[o]=a,i.splice(o+1,0,r),void i.splice(o+2,0,s)}{e.cues=Cg(e.cues,t),e.end=t;const r=o+1;e=i[r];while(void 0!==e&&n>e.end)i.splice(r,1),e=i[r];return void s(r)}}}if(i.length){const e=i[i.length-1];Ag(e.end,t,a)&&(e.end=t)}i.push(r)}}function Og(e,t,n,i){const r=[t/n.columns,e/n.rows],a=i.getElementsByClassName("proportional-style");for(let s=0;s<a.length;s++){const e=a[s];if(e instanceof HTMLElement){const t=e.getAttribute("data-proportional-font-size");null===t||isNaN(+t)||(e.style.fontSize=String(+t*r[1])+"px");const n=e.getAttribute("data-proportional-width");null===n||isNaN(+n)||(e.style.width=String(+n*r[0])+"px");const i=e.getAttribute("data-proportional-height");null===i||isNaN(+i)||(e.style.height=String(+i*r[1])+"px");const a=e.getAttribute("data-proportional-line-height");null===a||isNaN(+a)||(e.style.lineHeight=String(+a*r[1])+"px");const s=e.getAttribute("data-proportional-left");null===s||isNaN(+s)||(e.style.left=String(+s*r[0])+"px");const o=e.getAttribute("data-proportional-top");null===o||isNaN(+o)||(e.style.top=String(+o*r[1])+"px");const l=e.getAttribute("data-proportional-padding-top");null===l||isNaN(+l)||(e.style.paddingTop=String(+l*r[1])+"px");const u=e.getAttribute("data-proportional-padding-bottom");null===u||isNaN(+u)||(e.style.paddingBottom=String(+u*r[1])+"px");const c=e.getAttribute("data-proportional-padding-left");null===c||isNaN(+c)||(e.style.paddingLeft=String(+c*r[0])+"px");const d=e.getAttribute("data-proportional-padding-right");null===d||isNaN(+d)||(e.style.paddingRight=String(+d*r[0])+"px")}}return a.length>0}function Ng(e,t){try{e.removeChild(t)}catch(e){j.warn("HTD: Can't remove text track: not in the element.")}}function Ug(e){const t=e.getAttribute("data-resolution-rows"),n=e.getAttribute("data-resolution-columns");if(null===t||null===n)return null;const i=parseInt(t,10),r=parseInt(n,10);return null===i||null===r?null:{rows:i,columns:r}}class Fg{constructor(e,t){j.debug("HTD: Creating HTMLTextDisplayer"),this._buffered=new Wf,this._videoElement=e,this._textTrackElement=t,this._sizeUpdateCanceller=new me,this._subtitlesIntervalCanceller=new me,this._buffer=new Pg,this._currentCues=[],this._isAutoRefreshing=!1}pushTextData(e){var t,n;j.debug("HTD: Appending new html text tracks");const{timestampOffset:i,appendWindow:r,chunk:a}=e;if(null===a)return Q(this._buffered);const{start:s,end:o,data:l,type:u,language:c}=a,d=null!==(t=r[0])&&void 0!==t?t:0,h=null!==(n=r[1])&&void 0!==n?n:1/0,f=Eg(u,l,i,c);if(0!==d&&h!==1/0){let e=0;while(e<f.length&&f[e].end<=d)e++;f.splice(0,e),e=0;while(e<f.length&&f[e].start<d)f[e].start=d,e++;e=f.length-1;while(e>=0&&f[e].start>=h)e--;f.splice(e,f.length),e=f.length-1;while(e>=0&&f[e].end>h)f[e].end=h,e--}let p,g;if(void 0!==s)p=Math.max(d,s);else{if(f.length<=0)return j.warn("HTD: Current text tracks have no cues nor start time. Aborting"),Q(this._buffered);j.warn("HTD: No start time given. Guessing from cues."),p=f[0].start}if(void 0!==o)g=Math.min(h,o);else{if(f.length<=0)return j.warn("HTD: Current text tracks have no cues nor end time. Aborting"),Q(this._buffered);j.warn("HTD: No end time given. Guessing from cues."),g=f[f.length-1].end}return g<=p?(j.warn("HTD: Invalid text track appended: ","the start time is inferior or equal to the end time."),Q(this._buffered)):(this._buffer.insert(f,p,g),this._buffered.insert(p,g),this._isAutoRefreshing||this._buffer.isEmpty()||this.autoRefreshSubtitles(this._subtitlesIntervalCanceller.signal),Q(this._buffered))}removeBuffer(e,t){return j.debug("HTD: Removing html text track data",e,t),this._buffer.remove(e,t),this._buffered.remove(e,t),this._isAutoRefreshing&&this._buffer.isEmpty()&&(this.refreshSubtitles(),this._isAutoRefreshing=!1,this._subtitlesIntervalCanceller.cancel(),this._subtitlesIntervalCanceller=new me),Q(this._buffered)}getBufferedRanges(){return Q(this._buffered)}reset(){j.debug("HTD: Resetting HTMLTextDisplayer"),this.stop(),this._subtitlesIntervalCanceller=new me}stop(){this._subtitlesIntervalCanceller.isUsed()||(j.debug("HTD: Stopping HTMLTextDisplayer"),this._disableCurrentCues(),this._buffer.remove(0,1/0),this._buffered.remove(0,1/0),this._isAutoRefreshing=!1,this._subtitlesIntervalCanceller.cancel())}_disableCurrentCues(){if(this._sizeUpdateCanceller.cancel(),this._currentCues.length>0){for(const e of this._currentCues)Ng(this._textTrackElement,e.element);this._currentCues=[]}}_displayCues(e){const t=this._currentCues.length===e.length&&this._currentCues.every((t,n)=>t.element===e[n]);if(t)return;this._sizeUpdateCanceller.cancel();for(const i of this._currentCues)Ng(this._textTrackElement,i.element);this._currentCues=[];for(const i of e){const e=Ug(i);this._currentCues.push({element:i,resolution:e}),this._textTrackElement.appendChild(i)}const n=this._currentCues.filter(e=>null!==e.resolution);if(n.length>0){this._sizeUpdateCanceller=new me,this._sizeUpdateCanceller.linkToSignal(this._subtitlesIntervalCanceller.signal);const{TEXT_TRACK_SIZE_CHECKS_INTERVAL:e}=N.getCurrent(),t=wg(this._textTrackElement,e,this._sizeUpdateCanceller.signal);t.onUpdate(({height:e,width:t})=>{for(const i of n){const{resolution:n,element:r}=i;Og(e,t,n,r)}},{clearSignal:this._sizeUpdateCanceller.signal,emitCurrentValue:!0})}}autoRefreshSubtitles(e){if(this._isAutoRefreshing||e.isCancelled())return;let t=null;const{MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL:n}=N.getCurrent(),i=()=>{this._isAutoRefreshing=!1,null!==t&&(t.cancel(),t=null)},r=()=>{i(),this._isAutoRefreshing=!0,t=new me,t.linkToSignal(e);const r=setInterval(()=>this.refreshSubtitles(),n);t.signal.register(()=>{clearInterval(r)}),this.refreshSubtitles()};Nr(this._videoElement,()=>{i(),this._disableCurrentCues()},e),Ur(this._videoElement,r,e),Fr(this._videoElement,r,e),r()}refreshSubtitles(){const{MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL:e}=N.getCurrent();let t;t=this._videoElement.paused||this._videoElement.playbackRate<=0?this._videoElement.currentTime:Math.max(this._videoElement.currentTime+e/1e3/2,0);const n=this._buffer.get(t);0===n.length?this._disableCurrentCues():this._displayCues(n)}}var Bg=Fg;function Vg(e){return void 0===e.extent&&void 0===e.origin&&void 0===e.displayAlign&&void 0===e.display&&void 0===e.textAlign&&void 0===e.fontSize}function jg(e){e.extent="70% 20%",e.fontSize="1c",e.origin="15% 80%",e.displayAlign="before",e.textAlign="center"}let Gg;function Hg(e,t){if(void 0===Gg&&(Gg=void 0!==e.classList&&"function"===typeof e.classList.add),Gg)e.classList.add(t);else{const n=" "+e.className+" ";n.indexOf(" "+t+" ")<0&&(e.className+=" "+t)}}function zg(e,t){const n=t.trim();if("auto"===n)return;const i=n.split(" ");if(2!==i.length)return;const r=Tp.exec(i[0]),a=Tp.exec(i[1]);null!==r&&null!==a&&("px"===r[2]||"%"===r[2]||"em"===r[2]?e.style.width=r[1]+r[2]:"c"===r[2]?(Hg(e,"proportional-style"),e.setAttribute("data-proportional-width",r[1])):j.warn("TTML Parser: unhandled extent unit:",r[2]),"px"===a[2]||"%"===a[2]||"em"===a[2]?e.style.height=a[1]+a[2]:"c"===a[2]?(Hg(e,"proportional-style"),e.setAttribute("data-proportional-height",a[1])):j.warn("TTML Parser: unhandled extent unit:",a[2]))}function Kg(e,t){const n=t.trim(),i=n.split(" ");if(0===i.length)return;const r=Tp.exec(i[0]);if(null!==r)if("px"===r[2]||"em"===r[2])e.style.fontSize=r[1]+r[2];else if("c"===r[2])e.style.position="relative",Hg(e,"proportional-style"),e.setAttribute("data-proportional-font-size",r[1]);else if("%"===r[2]){const t=Number(r[1]);isNaN(t)?j.warn('TTML Parser: could not parse fontSize value "'+r[1]+'" into a number'):(e.style.position="relative",Hg(e,"proportional-style"),e.setAttribute("data-proportional-font-size",String(t/100)))}else j.warn("TTML Parser: unhandled fontSize unit:",r[2])}function $g(e,t){const n=t.trim(),i=n.split(" ");if("auto"===n)return;const r=Tp.exec(i[0]);null!==r&&("px"===r[2]||"%"===r[2]||"em"===r[2]?e.style.lineHeight=r[1]+r[2]:"c"===r[2]?(Hg(e,"proportional-style"),e.setAttribute("data-proportional-line-height",r[1])):j.warn("TTML Parser: unhandled lineHeight unit:",r[2]))}function Wg(e,t){const n=t.trim();if("auto"===n)return;const i=n.split(" ");if(2!==i.length)return;const r=Tp.exec(i[0]),a=Tp.exec(i[1]);null!==r&&null!==a&&("px"===r[2]||"%"===r[2]||"em"===r[2]?e.style.left=r[1]+r[2]:"c"===r[2]?(Hg(e,"proportional-style"),e.setAttribute("data-proportional-left",r[1])):j.warn("TTML Parser: unhandled origin unit:",r[2]),"px"===a[2]||"%"===a[2]||"em"===a[2]?e.style.top=a[1]+a[2]:"c"===a[2]?(Hg(e,"proportional-style"),e.setAttribute("data-proportional-top",a[1])):j.warn("TTML Parser: unhandled origin unit:",a[2]))}function qg(e,t){const n=t.trim(),i=n.split(" ");if(i.length<1)return;const r=Tp.exec(i[0]);if(null===r)return;if("px"===r[2]||"%"===r[2]||"em"===r[2]){const t=r[1]+r[2];1===i.length?e.style.padding=t:2===i.length?(e.style.paddingTop=t,e.style.paddingBottom=t):e.style.paddingTop=t}else"c"===r[2]?(Hg(e,"proportional-style"),1===i.length?(e.setAttribute("data-proportional-padding-top",r[1]),e.setAttribute("data-proportional-padding-bottom",r[1]),e.setAttribute("data-proportional-padding-left",r[1]),e.setAttribute("data-proportional-padding-right",r[1])):2===i.length?(e.setAttribute("data-proportional-padding-top",r[1]),e.setAttribute("data-proportional-padding-bottom",r[1])):e.setAttribute("data-proportional-padding-top",r[1])):j.warn("TTML Parser: unhandled padding unit:",r[2]);if(1===i.length)return;const a=Tp.exec(i[1]);if(null===a)return;if("px"===a[2]||"%"===a[2]||"em"===a[2]){const t=a[1]+a[2];i.length<4?(e.style.paddingLeft=t,e.style.paddingRight=t):e.style.paddingRight=t}else"c"===a[2]?(Hg(e,"proportional-style"),i.length<4?(e.setAttribute("data-proportional-padding-left",a[1]),e.setAttribute("data-proportional-padding-right",a[1])):e.setAttribute("data-proportional-padding-right",a[1])):j.warn("TTML Parser: unhandled padding unit:",a[2]);if(2===i.length)return;const s=Tp.exec(i[2]);if(null===s)return;if("px"===s[2]||"%"===s[2]||"em"===s[2]){const t=s[1]+s[2];e.style.paddingBottom=t}else"c"===s[2]?(Hg(e,"proportional-style"),e.setAttribute("data-proportional-padding-bottom",s[1])):j.warn("TTML Parser: unhandled padding unit:",s[2]);if(3===i.length)return;const o=Tp.exec(i[3]);if(null!==o)if("px"===o[2]||"%"===o[2]||"em"===o[2]){const t=o[1]+o[2];e.style.paddingLeft=t}else"c"===o[2]?(Hg(e,"proportional-style"),e.setAttribute("data-proportional-padding-left",o[1])):j.warn("TTML Parser: unhandled padding unit:",o[2])}function Yg(e,t){let n=t;return Ot(t)&&t.trim().endsWith("%")&&(n=t.trim().slice(0,-1),n=(parseInt(n,10)/100).toString()+"em"),`-1px -1px ${n} ${e},`+`1px -1px ${n} ${e},`+`-1px 1px ${n} ${e},`+`1px 1px ${n} ${e}`}function Xg(e){let t;return t=_p.exec(e),r(t)?(t=wp.exec(e),r(t)?(t=Ep.exec(e),r(t)?(t=xp.exec(e),r(t)?e:"rgba("+String(+t[1])+","+String(+t[2])+","+String(+t[3])+","+String(+t[4]/255)+")"):"rgb("+String(+t[1])+","+String(+t[2])+","+String(+t[3])+")"):"rgba("+String(parseInt(t[1]+t[1],16))+","+String(parseInt(t[2]+t[2],16))+","+String(parseInt(t[3]+t[3],16))+","+String(parseInt(t[4]+t[4],16)/255)+")"):"rgba("+String(parseInt(t[1],16))+","+String(parseInt(t[2],16))+","+String(parseInt(t[3],16))+","+String(parseInt(t[4],16)/255)+")"}const Qg=["color","direction","display","fontFamily","fontSize","fontStyle","fontWeight","textDecoration","textOutline","unicodeBidi","visibility","wrapOption"];function Zg(e,t,n){const i=t.color;Ot(i)&&(e.style.color=Xg(i));const r=t.backgroundColor;Ot(r)&&(e.style.backgroundColor=Xg(r));const a=t.textOutline;if(Ot(a)){const t=a.trim().replace(/\s+/g," ").split(" "),n=t.length;if(3===n){const n=Xg(t[0]),i=t[1];e.style.textShadow=Yg(n,i)}else if(Ot(i)&&1===n){const n=t[0];e.style.textShadow=Yg(i,n)}else if(2===n){const n=/^[#A-Z]/i.test(t[0]),r=/^[0-9]/.test(t[0]);if(n!==r)if(n){const n=Xg(t[0]),i=t[1];e.style.textShadow=Yg(n,i)}else if(Ot(i)){const n=t[0];e.style.textShadow=Yg(i,n)}}}const s=t.textDecoration;if(Ot(s))switch(s){case"noUnderline":case"noLineThrough":case"noOverline":e.style.textDecoration="none";break;case"lineThrough":e.style.textDecoration="line-through";break;default:e.style.textDecoration=s;break}const o=t.fontFamily;if(Ot(o))switch(o){case"proportionalSansSerif":e.style.fontFamily="Arial, Helvetica, Liberation Sans, sans-serif";break;case"monospaceSansSerif":case"sansSerif":e.style.fontFamily="sans-serif";break;case"monospaceSerif":case"default":e.style.fontFamily="Courier New, Liberation Mono, monospace";break;case"proportionalSerif":e.style.fontFamily="serif";break;default:e.style.fontFamily=o}const l=t.fontStyle;Ot(l)&&(e.style.fontStyle=l);const u=t.fontWeight;Ot(u)&&(e.style.fontWeight=u);const c=t.fontSize;Ot(c)?Kg(e,c):(Hg(e,"proportional-style"),e.setAttribute("data-proportional-font-size","1"));const d=t.direction;Ot(d)&&(e.style.direction=d);const h=t.unicodeBidi;if(Ot(h))switch(h){case"bidiOverride":e.style.unicodeBidi="bidi-override";break;case"embed":e.style.unicodeBidi="embed";break;default:e.style.unicodeBidi="normal"}const f=t.visibility;Ot(f)&&(e.style.visibility=f);const p=t.display;"none"===p&&(e.style.display="none");const g=t.wrapOption;e.style.whiteSpace="noWrap"===g?n?"nowrap":"pre":n?"normal":"pre-wrap"}function Jg(e,t){e.style.color="white",e.style.position="absolute";const n=t.extent;Ot(n)&&zg(e,n);const i=t.writingMode;Ot(i);const r=t.overflow;e.style.overflow=Ot(r)?r:"hidden";const a=t.padding;Ot(a)&&qg(e,a);const s=t.origin;Ot(s)&&Wg(e,s);const o=t.displayAlign;if(Ot(o))switch(e.style.display="flex",e.style.flexDirection="column",o){case"before":e.style.justifyContent="flex-start";break;case"center":e.style.justifyContent="center";break;case"after":e.style.justifyContent="flex-end";break}const l=t.opacity;Ot(l)&&(e.style.opacity=l);const u=t.visibility;Ot(u)&&(e.style.visibility=u);const c=t.display;"none"===c&&(e.style.display="none")}function em(e,t){e.style.margin="0px",Hg(e,"proportional-style"),e.setAttribute("data-proportional-font-size","1");const n=t.backgroundColor;Ot(n)&&(e.style.backgroundColor=Xg(n));const i=t.lineHeight;Ot(i)&&$g(e,i);const r=t.textAlign;if(Ot(r))switch(r){case"center":e.style.textAlign="center";break;case"left":case"start":e.style.textAlign="left";break;case"right":case"end":e.style.textAlign="right";break}}function tm(e,t,n){const i=document.createElement("span");let r=null===e.textContent?"":e.textContent;if(n){let e=r.trim();e=e.replace(/\s+/g," "),r=e}const a=document.createTextNode(r);return i.appendChild(a),i.className="rxp-texttrack-span",Zg(i,t,n),i}function nm(e,t,n,i,r){function a(e,i,r,s){const o=e.childNodes,l=[];for(let u=0;u<o.length;u++){const e=o[u];if("#text"===e.nodeName){const{backgroundColor:a}=Jf(["backgroundColor"],r,n,t);Ot(a)?i.backgroundColor=a:delete i.backgroundColor;const o=tm(e,i,s);l.push(o)}else if(lp(e)){const e=document.createElement("BR");l.push(e)}else if(up(e)&&e.nodeType===Node.ELEMENT_NODE&&e.childNodes.length>0){const o=e.getAttribute("xml:space"),u=Ot(o)?"default"===o:s,c=M({},i,Jf(Qg,[e],n,t));l.push(...a(e,c,[e,...r],u))}}return l}return a(e,M({},i),[],r)}function im(e,t,n,i,r,{cellResolution:a,shouldTrimWhiteSpace:s}){const o=ip(e),l=document.createElement("DIV");if(l.className="rxp-texttrack-region",l.setAttribute("data-resolution-columns",String(a.columns)),l.setAttribute("data-resolution-rows",String(a.rows)),Jg(l,r),null!==t){const{bodyBackgroundColor:e}=Jf(["backgroundColor"],[...o,t],i,n);Ot(e)&&(l.style.backgroundColor=Xg(e))}const u=document.createElement("p");u.className="rxp-texttrack-p",em(u,r);const c=nm(e,n,i,r,s);for(let d=0;d<c.length;d++)u.appendChild(c[d]);return l.appendChild(u),l}function rm(e){const{paragraph:t,ttParams:n,body:i,regionStyles:r,idStyles:a,paragraphStyle:s,timeOffset:o,shouldTrimWhiteSpace:l}=e;if(!t.hasAttribute("begin")&&!t.hasAttribute("end")&&/^\s*$/.test(null===t.textContent?"":t.textContent))return null;const{cellResolution:u}=n,{start:c,end:d}=Dp(t,n),h=im(t,i,r,a,s,{cellResolution:u,shouldTrimWhiteSpace:l});return{start:c+o,end:d+o,element:h}}function am(e,t){const n=dp(e,t),i=[];for(let r=0;r<n.length;r++){const{paragraphStyle:e}=n[r];Vg(e)&&jg(e);const t=rm(n[r]);null!==t&&i.push(t)}return i}var sm=am;function om(e){e.htmlTextTracksParsers.ttml=sm,e.htmlTextDisplayer=Bg}const lm=/&#([0-9]+);/g,um=/<br>/gi,cm=/<style[^>]*>([\s\S]*?)<\/style[^>]*>/i,dm=/\s*<p (?:class=([^>]+))?>(.*)/i,hm=/<sync[^>]+?start="?([0-9]*)"?[^0-9]/i;function fm(e){const t=/\.(\S+)\s*{([^}]*)}/gi,n={};let i=t.exec(e);while(null!==i){const a=i[1],s=gm(i[2],"lang");r(a)||r(s)||(n[s]=a),i=t.exec(e)}return n}function pm(e){const t=/p\s*{([^}]*)}/gi,n=t.exec(e);return null===n?"":n[1]}function gm(e,t){const n=new RegExp("\\s*"+t+":\\s*(\\S+);","i").exec(e);return Array.isArray(n)?n[1]:null}function mm(e){return e.replace(lm,(e,t)=>String.fromCharCode(Number(t)))}function vm(e,t,n){const i=/<sync[ >]/gi,r=/<sync[ >]|<\/body>/gi,a=[],s=cm.exec(e),o=Array.isArray(s)?s[1]:"";let l,u;r.exec(e);const c=fm(o),d=pm(o);let h;if(Ot(n)&&(h=c[n],void 0===h))throw new Error(`sami: could not find lang ${n} in CSS`);while(1){if(l=i.exec(e),u=r.exec(e),null===l&&null===u)break;if(null===l||null===u||l.index>=u.index)throw new Error("parse error");const t=e.slice(l.index,u.index),n=hm.exec(t);if(!Array.isArray(n))throw new Error("parse error (sync time attribute)");const a=+n[1];if(isNaN(a))throw new Error("parse error (sync time attribute NaN)");f(t.split("\n"),a/1e3)}return a;function f(e,n){let i=e.length;while(--i>=0){const r=dm.exec(e[i]);if(!Array.isArray(r))continue;const[,s,o]=r;if(h===s)if("&nbsp;"===o)a[a.length-1].end=n;else{const e=document.createElement("DIV");e.className="rxp-texttrack-region";const i=document.createElement("DIV");i.className="rxp-texttrack-div",i.style.position="absolute",i.style.bottom="0",i.style.width="100%",i.style.color="#fff",i.style.textShadow="-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000";const r=document.createElement("div");r.className="rxp-texttrack-p",Ot(d)&&(r.style.cssText=d);const s=o.split(um);for(let t=0;t<s.length;t++){0!==t&&r.appendChild(document.createElement("BR"));const e=document.createElement("SPAN");e.className="rxp-texttrack-span",e.textContent=mm(s[t]),r.appendChild(e)}i.appendChild(r),e.appendChild(i),a.push({element:e,start:n+t,end:-1})}}}}var ym=vm;function bm(e){e.htmlTextTracksParsers.sami=ym,e.htmlTextDisplayer=Bg}function Sm(e,t){const n=[];for(let i=t;i<e.length;i++)if(eg(e,i)){const t=i;i++;while(Ot(e[i]))i++;const r=e.slice(t,i);n.push(r)}else if(Ot(e[i]))while(Ot(e[i]))i++;return n}const Tm={white:"#ffffff",lime:"#00ff00",cyan:"#00ffff",red:"#ff0000",yellow:"#ffff00",magenta:"#ff00ff",blue:"#0000ff",black:"#000000"};function _m(){return Object.keys(Tm).reduce((e,t)=>{return e[t]=`color: ${Tm[t]};`,e[`bg_${t}`]=`background-color: ${Tm[t]};`,e},{})}function wm(e){const t=_m();let n="";return e.forEach(e=>{if(e.length>=2)for(let i=1;i<e.length;i++){let r=e[i];if(Array.isArray(/::cue {/.exec(r))){r=e[++i];while(Ot(r)&&!Array.isArray(/}/.exec(r))&&0!==r.length)n+=r,r=e[++i]}else{const n=[];let a=/::cue\(\.?(.*?)\)(?:,| {)/.exec(r);while(Ot(r)&&Array.isArray(a))n.push(a[1]),r=e[++i],a=/::cue\(\.?(.*?)\)(?:,| {)/.exec(r);let s="";while(Ot(r)&&!Array.isArray(/}/.exec(r))&&0!==r.length)s+=r,r=e[++i];n.forEach(e=>{const n=t[e];void 0===n?t[e]=s:t[e]+=s})}}}),{classes:t,global:n}}function Em(e,t){const n=["u","i","b"],i=["u","i","b","c","#text"],r=e.nodeName.toLowerCase().split(".")[0];let a;if(gt(i,r))if("#text"===r){const t=e.wholeText.split("\n");a=document.createElement("span");for(let e=0;e<t.length;e++)if(e>0&&a.appendChild(document.createElement("br")),t[e].length>0){const n=document.createTextNode(t[e]);a.appendChild(n)}}else{const i=e.nodeName.toLowerCase().split("."),s=[];if(i.forEach(e=>{Ot(t[e])&&s.push(t[e])}),0!==s.length){const e=document.createAttribute("style");s.forEach(t=>{e.value+=t});const t=gt(n,r)?r:"span";a=document.createElement(t),a.setAttributeNode(e)}else{const e=gt(n,r)?r:"span";a=document.createElement(e)}for(let n=0;n<e.childNodes.length;n++){const i=Em(e.childNodes[n],t);a.appendChild(i)}}else{a=document.createElement("span");for(let n=0;n<e.childNodes.length;n++){const i=Em(e.childNodes[n],t);a.appendChild(i)}}return a}function xm(e,t){const n=e.replace(/<[0-9]{2}:[0-9]{2}.[0-9]{3}>/,"").replace(/<([u,i,b,c])(\..*?)?(?: .*?)?>(.*?)<\/\1>/g,"<$1$2>$3</$1$2>"),i=(new DOMParser).parseFromString(n,"text/html"),r=i.body.childNodes,a=[];for(let s=0;s<r.length;s++)a.push(Em(r[s],t));return a}function Am(e){const t=document.createAttribute("style");return t.value=km(e),t}const km=e=>{const t=void 0!==e&&0!==$e(e).length;if(!t)return"text-align:center";const n=Mm(e),i=Pm(e);return"position: absolute;margin: 0;"+`transform: translate(${n.offset}%,${i.offset}%);`+`width: ${Fm(e.size)}%;`+`left: ${n.position}%;`+`top: ${null!==i.position?`${i.position}%`:"auto"};`+`text-align: ${Um(e.align)};`};var Im,Cm,Rm;(function(e){e["LINE_LEFT"]="line-left",e["CENTER"]="center",e["LINE_RIGHT"]="line-right"})(Im||(Im={})),function(e){e["LEFT"]="left",e["CENTER"]="center",e["RIGHT"]="right"}(Cm||(Cm={})),function(e){e["START"]="start",e["CENTER"]="center",e["END"]="end"}(Rm||(Rm={}));const Mm=e=>{return{position:Dm(e),offset:Lm(e)}},Dm=e=>{const t=Vm(e.position);if(null!==t)return t;const n=Um(e.align),i={[Cm.LEFT]:0,[Cm.CENTER]:50,[Cm.RIGHT]:100};return i[n]},Lm=e=>{const t=e=>{const t=/,(line-left|line-right|center)/,n=t.exec(e);return!Array.isArray(n)||n.length<2?null:n[1]},n={[Im.LINE_LEFT]:0,[Im.CENTER]:-50,[Im.LINE_RIGHT]:-100},i=void 0!==e.position?t(e.position):null;if(null!==i)return n[i];const r={[Cm.LEFT]:0,[Cm.CENTER]:-50,[Cm.RIGHT]:-100},a=void 0!==e.align?Um(e.align):Cm.CENTER;return r[a]},Pm=e=>{return{position:Om(e.line),offset:Nm(e.line)}},Om=e=>{return Vm(e)},Nm=e=>{const t=e=>{const t=/,(start|center|end)/,n=t.exec(e);return!Array.isArray(n)||n.length<2?null:n[1]},n={[Rm.START]:0,[Rm.CENTER]:-50,[Rm.END]:-100};if(void 0===e)return n[Rm.START];const i=t(e);return null!==i?n[i]:n[Rm.START]},Um=e=>{switch(e){case"left":case"start":return"left";case"right":case"end":return"right";default:return"center"}},Fm=e=>{const t=100;return Bm(e,t)},Bm=(e,t)=>{const n=Vm(e);return null!==n?n:t},Vm=e=>{if(void 0===e)return null;const t=/^([\d.]+)%/,n=t.exec(e);return!Array.isArray(n)||n.length<2?null:parseInt(n[1],10)};function jm(e,t){const{start:n,end:i,settings:r,header:a,payload:s}=e,o=document.createElement("div"),l=document.createAttribute("style");l.value="width:100%;height:100%;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;",o.setAttributeNode(l);const u=document.createElement("p"),c=Am(r);u.setAttributeNode(c);const d=document.createElement("span"),h=document.createAttribute("style");h.value="background-color:rgba(0,0,0,0.8);color:white;",d.setAttributeNode(h);const{global:f,classes:p}=t,g=Ot(a)?p[a]:void 0,m=[f,g].filter(e=>void 0!==e).join("");return h.value+=m,d.setAttributeNode(h),xm(s.join("\n"),p).forEach(e=>{d.appendChild(e)}),o.appendChild(u),u.appendChild(d),{start:n,end:i,element:o}}function Gm(e,t){const n=/\r\n|\n|\r/g,i=e.split(n),r=[];if(null===/^WEBVTT( |\t|\n|\r|$)/.exec(i[0]))throw new Error("Can't parse WebVTT: Invalid File.");const a=Jp(i),s=Sm(i,a),o=ag(i,a),l=wm(s);for(let u=0;u<o.length;u++){const e=ug(o[u],t);if(null!==e){const t=jm(e,l);r.push(t)}}return r}var Hm=Gm;function zm(e){e.htmlTextTracksParsers.vtt=Hm,e.htmlTextDisplayer=Bg}function Km(e,t){const n=e.split(/\r\n|\n|\r/),i=mg(n),r=[];for(let a=0;a<i.length;a++){const e=yg(i[a],t);if(null!==e){const t=$m(e);null!==t&&r.push(t)}}return r}function $m(e){const{start:t,end:n,payload:i}=e,r=document.createElement("div");r.className="rxp-texttrack-p",r.style.fontSize="28px",r.style.position="absolute",r.style.bottom="5%",r.style.width="100%",r.style.textAlign="center",r.style.color="#fff",r.style.textShadow="-1px -1px 2px #000,1px -1px 2px #000,-1px 1px 2px #000,1px 1px 2px #000";for(let a=0;a<i.length;a++){0!==a&&r.appendChild(document.createElement("br"));const e=Wm(i[a]);r.appendChild(e)}return{start:t,end:n,element:r}}function Wm(e){const t=document.createElement("div");t.innerHTML=e;const n=function(e){const t=e.childNodes,i=document.createElement("span");i.className="rxp-texttrack-span";for(let r=0;r<t.length;r++){const e=t[r];if("#text"===e.nodeName){const t=e.wholeText.split("\n");for(let e=0;e<t.length;e++)if(0!==e&&i.appendChild(document.createElement("br")),t[e].length>0){const n=document.createTextNode(t[e]);i.appendChild(n)}}else if("B"===e.nodeName){const t=n(e);t.style.fontWeight="bold",i.appendChild(t)}else if("I"===e.nodeName){const t=n(e);t.style.fontStyle="italic",i.appendChild(t)}else if("U"===e.nodeName){const t=n(e);t.style.textDecoration="underline",i.appendChild(t)}else if(qm(e)&&"string"===typeof e.color){const t=n(e);t.style.color=e.color,i.appendChild(t)}else{const t=n(e);i.appendChild(t)}}return i};return n(t)}function qm(e){return"FONT"===e.nodeName&&"color"in e}function Ym(e){e.htmlTextTracksParsers.srt=Km,e.htmlTextDisplayer=Bg}function Xm(){if(!f)return j.warn("Compat: Can't access Firefox version on no firefox browser."),null;const e=navigator.userAgent,t=/Firefox\/([0-9]+)\./.exec(e);if(null===t)return-1;const n=parseInt(t[1],10);return isNaN(n)?-1:n}function Qm(){if(!f)return!0;const e=Xm();if(null===e||e<67)return!0;const t=null===HTMLVideoElement||void 0===HTMLVideoElement?void 0:HTMLVideoElement.prototype;return void 0!==(null===t||void 0===t?void 0:t.requirePictureInPicture)}function Zm(e){const t=e;if("function"===typeof t.getStartDate){const e=t.getStartDate();if("object"===typeof e&&null!==e){const t=+e;if(!isNaN(t))return t/1e3}else if("number"===typeof e&&!isNaN(e))return e}}const Jm="function"===typeof MediaSource&&!0===MediaSource.canConstructInDedicatedWorker;var ev=Jm;function tv(){return _&&"object"===typeof Worker||"function"===typeof Worker}class nv extends Error{constructor(e,t){super(ot(e,t)),Object.setPrototypeOf(this,nv.prototype),this.name="WorkerInitializationError",this.type="WORKER_INITIALIZATION_ERROR",this.code=e}}function iv(e){for(let t=0;t<e.length;t++){const n=e[t];if("function"===typeof n)n(Kt);else{if(r(n)||"function"!==typeof n._addFeature)throw new Error("Unrecognized feature");n._addFeature(Kt)}}}const rv=v;var av=rv;function sv(e,t,n){const i=t(e.getReference(),n);return{getCurrentTime(){return e.getCurrentTime()},getReadyState(){return e.getReadyState()},getPlaybackRate(){return e.getPlaybackRate()},getIsPaused(){return e.getIsPaused()},getReference(){return i},listen(e,t){var r;n.isCancelled()||!0===(null===(r=null===t||void 0===t?void 0:t.clearSignal)||void 0===r?void 0:r.isCancelled())||i.onUpdate(e,{clearSignal:null===t||void 0===t?void 0:t.clearSignal,emitCurrentValue:null===t||void 0===t?void 0:t.includeLastObservation})},deriveReadOnlyObserver(e){return sv(this,e,n)}}}class ov{constructor(e,t){this._last=e,this._wanted=t}serialize(){return[this._last,this._wanted]}getPolled(){return this._last}getWanted(){var e;return null!==(e=this._wanted)&&void 0!==e?e:this._last}forceWantedPosition(e){this._wanted=e}isAwaitingFuturePosition(){return null!==this._wanted}}const lv=["canplay","ended","play","pause","seeking","seeked","loadedmetadata","ratechange"];class uv{constructor(e,t){this._internalSeeksIncoming=[],this._mediaElement=e,this._withMediaSource=t.withMediaSource,this._lowLatencyMode=t.lowLatencyMode,this._canceller=new me,this._observationRef=this._createSharedReference(),this._expectedSeekingPosition=null,this._pendingSeek=null;const n=()=>{if(null!==this._pendingSeek){const e=this._pendingSeek;this._pendingSeek=null,this._actuallySetCurrentTime(e)}};e.addEventListener("loadedmetadata",n),this._canceller.signal.register(()=>{e.removeEventListener("loadedmetadata",n)})}stop(){this._canceller.cancel()}getCurrentTime(){return this._mediaElement.currentTime}getPlaybackRate(){return this._mediaElement.playbackRate}getIsPaused(){return this._mediaElement.paused}setCurrentTime(e){this._mediaElement.readyState>=1?this._actuallySetCurrentTime(e):(this._internalSeeksIncoming=[],this._pendingSeek=e,this._generateObservationForEvent("manual"))}setPlaybackRate(e){this._mediaElement.playbackRate=e}getReadyState(){return this._mediaElement.readyState}getReference(){return this._observationRef}listen(e,t){var n;if(this._canceller.isUsed()||!0===(null===(n=null===t||void 0===t?void 0:t.clearSignal)||void 0===n?void 0:n.isCancelled()))return U;this._observationRef.onUpdate(e,{clearSignal:null===t||void 0===t?void 0:t.clearSignal,emitCurrentValue:null===t||void 0===t?void 0:t.includeLastObservation})}deriveReadOnlyObserver(e){return sv(this,e,this._canceller.signal)}_actuallySetCurrentTime(e){j.info("API: Seeking internally",e),this._internalSeeksIncoming.push(e),this._mediaElement.currentTime=e}_createSharedReference(){if(void 0!==this._observationRef)return this._observationRef;const{SAMPLING_INTERVAL_MEDIASOURCE:e,SAMPLING_INTERVAL_LOW_LATENCY:t,SAMPLING_INTERVAL_NO_MEDIASOURCE:n}=N.getCurrent(),i=new de(this._getCurrentObservation("init"),this._canceller.signal);let r;r=this._lowLatencyMode?t:this._withMediaSource?e:n;const a=()=>{this._generateObservationForEvent("timeupdate")};let s=setInterval(a,r);const o=lv.map(e=>{const t=()=>{l(),this._generateObservationForEvent(e)};return this._mediaElement.addEventListener(e,t),()=>{this._mediaElement.removeEventListener(e,t)}});return this._canceller.signal.register(()=>{clearInterval(s),o.forEach(e=>e()),i.finish()}),i;function l(){clearInterval(s),s=setInterval(a,r)}}_getCurrentObservation(e){var t,n;let i=e;const r=void 0===this._observationRef?mv(this._mediaElement):this._observationRef.getValue();let a=!1,s=this._pendingSeek;const o=hv(this._mediaElement),{buffered:l,readyState:u,position:c,seeking:d}=o;if("seeking"===i)if(this._internalSeeksIncoming.length>0){a=!0,i="internal-seeking";const e=this._internalSeeksIncoming.shift();this._expectedSeekingPosition=av?Math.max(c,null!==e&&void 0!==e?e:0):c}else this._expectedSeekingPosition=c;else d?this._expectedSeekingPosition=Math.max(c,null!==(t=this._expectedSeekingPosition)&&void 0!==t?t:0):av&&null!==this._expectedSeekingPosition&&c<this._expectedSeekingPosition?s=this._expectedSeekingPosition:this._expectedSeekingPosition=null;d&&1===r.seeking&&"seeking"!==e&&(a=!0);const h=null!==(n=this._expectedSeekingPosition)&&void 0!==n?n:c;let f,p;!this._withMediaSource&&0===l.length&&u>=3?(f=void 0,p=void 0):(f=Z(l,h),p=null!==f?f.end-h:1/0);const g=fv({previousObservation:r,currentObservation:o,basePosition:h,observationEvent:i,lowLatencyMode:this._lowLatencyMode,withMediaSource:this._withMediaSource,bufferGap:p,currentRange:f}),m=pv(r,o,i,p);let v;v=a?1:d?2:0;const y=M({},o,{position:new ov(o.position,s),event:i,seeking:v,rebuffering:g,freezing:m,bufferGap:p,currentRange:f});return j.hasLevel("DEBUG")&&j.debug("API: current media element state tick","event",y.event,"position",y.position.getPolled(),"seeking",y.seeking,"internalSeek",a,"rebuffering",null!==y.rebuffering,"freezing",null!==y.freezing,"ended",y.ended,"paused",y.paused,"playbackRate",y.playbackRate,"readyState",y.readyState,"pendingPosition",s),y}_generateObservationForEvent(e){const t=this._getCurrentObservation(e);j.hasLevel("DEBUG")&&j.debug("API: current playback timeline:\n"+gv(t.buffered,t.position.getPolled()),`\n${e}`),this._observationRef.setValue(t)}}function cv(e,t){if(null===e)return 0;const n=t?"LOW_LATENCY":"DEFAULT",{RESUME_GAP_AFTER_SEEKING:i,RESUME_GAP_AFTER_NOT_ENOUGH_DATA:r,RESUME_GAP_AFTER_BUFFERING:a}=N.getCurrent();switch(e.reason){case"seeking":return i[n];case"not-ready":return r[n];case"buffering":return a[n]}}function dv(e,t,n,i,r){const{REBUFFERING_GAP:a}=N.getCurrent(),s=r?"LOW_LATENCY":"DEFAULT";return void 0===t?n&&Math.abs(i-e)<=a[s]:null!==t&&i-t.end<=a[s]}function hv(e){const{buffered:t,currentTime:n,duration:i,ended:r,paused:a,playbackRate:s,readyState:o,seeking:l}=e;return{buffered:t,position:n,duration:i,ended:r,paused:a,playbackRate:s,readyState:o,seeking:l}}function fv({previousObservation:e,currentObservation:t,basePosition:n,observationEvent:i,withMediaSource:r,lowLatencyMode:a,bufferGap:s,currentRange:o}){const{REBUFFERING_GAP:l}=N.getCurrent(),{position:u,duration:c,paused:d,readyState:h,ended:f}=t,{rebuffering:p,event:g,position:m}=e,v=dv(n,o,f,c,a),y=h>=1&&"loadedmetadata"!==i&&null===p&&!(v||f);let b,S,T=null;const _=a?l.LOW_LATENCY:l.DEFAULT;if(r){if(y)s===1/0?(b=!0,T=n):void 0===s?h<3&&(b=!0,T=void 0):s<=_&&(b=!0,T=n+s);else if(null!==p){const e=cv(p,a);!0!==b&&null!==p&&h>1&&(v||f||void 0!==s&&isFinite(s)&&s>e)||void 0===s&&h>=3?S=!0:void 0===s?T=void 0:s===1/0?T=n:s<=e&&(T=n+s)}}else y&&(!d&&"timeupdate"===i&&"timeupdate"===g&&u===m.getPolled()||"seeking"===i&&(s===1/0||void 0===s&&h<3))?b=!0:null!==p&&("seeking"!==i&&u!==m.getPolled()||"canplay"===i||void 0===s&&h>=3||void 0!==s&&s<1/0&&(s>cv(p,a)||v||f))&&(S=!0);if(!0===S)return null;if(!0===b||null!==p){let e;return e="seeking"===i||null!==p&&"seeking"===p.reason?"seeking":t.seeking?"seeking":1===h?"not-ready":"buffering",null!==p&&p.reason===e?{reason:p.reason,timestamp:p.timestamp,position:T}:{reason:e,timestamp:_e(),position:T}}return null}function pv(e,t,n,i){const{MINIMUM_BUFFER_AMOUNT_BEFORE_FREEZING:r}=N.getCurrent();return e.freezing?t.ended||t.paused||0===t.readyState||0===t.playbackRate||e.position.getPolled()!==t.position?null:e.freezing:"timeupdate"===n&&void 0!==i&&i>r&&!t.ended&&!t.paused&&t.readyState>=1&&0!==t.playbackRate&&t.position===e.position.getPolled()?{timestamp:_e()}:null}function gv(e,t){let n="",i="";for(let r=0;r<e.length;r++){const a=e.start(r),s=e.end(r),o=a.toFixed(2),l=s.toFixed(2),u=(s-a).toFixed(2),c=`${o}|==${u}==|${l}`;if(n+=c,0===i.length&&s>t){const e=n.length-Math.floor(c.length/2);i=" ".repeat(e)+`^${t}`}if(r<e.length-1){const a=e.start(r+1),o=(a-s).toFixed(2),l=` ~${o}~ `;if(n+=l,0===i.length&&t<a){const e=n.length-Math.floor(l.length/2);i=" ".repeat(e)+`^${t}`}}}return 0===i.length&&(i=" ".repeat(n.length)+`^${t}`),n+"\n"+i}function mv(e){const t=hv(e);return M(t,{rebuffering:null,event:"init",seeking:0,position:new ov(t.position,null),freezing:null,bufferGap:0,currentRange:null})}async function vv(e){const t=sr.getState(e);if(null===t)return;j.info("DRM: Disposing of the current MediaKeys");const{loadedSessionsStore:n}=t;return sr.clearState(e),await n.closeAllSessions(),kh(t.emeImplementation,e,null)}function yv(){return d}function bv(e){if(j.info("DRM: Clearing-up DRM session."),yv())return j.info("DRM: disposing current MediaKeys."),vv(e);const t=sr.getState(e);return null!==t&&!0===t.keySystemOptions.closeSessionsOnStop?(j.info("DRM: closing all current sessions."),t.loadedSessionsStore.closeAllSessions()):(j.info("DRM: Nothing to clear. Returning right away. No state =",null===t),Promise.resolve())}class Sv extends a{constructor(e){super(),this._canceller=new me,this._adaptationRef=e,this._updateToken=!1,this.refresh=U}start(e){if(this._updateToken=!0,null===e)return this._lastEmitted=null,this._updateToken=!1,void this._adaptationRef.setValue(null);const t=this._constructLockedRepresentationsReference(e);this._updateToken&&(this._lastEmitted={adaptation:e.adaptation,switchingMode:e.switchingMode,lockedRepresentations:null},this._updateToken=!1,this._adaptationRef.setValue({adaptationId:e.adaptation.id,switchingMode:e.switchingMode,representations:t,relativeResumingPosition:void 0}))}updateTrack(e){if(this._updateToken=!0,null===e){if(null===this._lastEmitted)return;return this._updateToken=!1,this._canceller.cancel(),this._canceller=new me,this._lastEmitted=null,void this._adaptationRef.setValue(null)}const{adaptation:t,switchingMode:n,relativeResumingPosition:i}=e;this._canceller.cancel(),this._canceller=new me;const r=this._constructLockedRepresentationsReference(e);this._updateToken&&(this._lastEmitted={adaptation:t,switchingMode:n,lockedRepresentations:null},this._updateToken=!1,this._adaptationRef.setValue({adaptationId:t.id,switchingMode:n,representations:r,relativeResumingPosition:i}))}_constructLockedRepresentationsReference(e){const t=new de({representationIds:[],switchingMode:"lazy"}),n=this;return this.refresh=i,this._canceller.signal.register(r),e.lockedRepresentations.onUpdate(i,{clearSignal:this._canceller.signal,emitCurrentValue:!1}),i(),t;function i(){const i=e.lockedRepresentations.getValue();let r,a;if(null===i)a=e.adaptation.representations.filter(e=>{return!0===e.isSupported&&!1!==e.decipherable}),r="lazy";else{const{representationIds:t}=i;r=i.switchingMode;const s=e.adaptation.representations.filter(e=>gt(t,e.id));if(a=s.filter(e=>!0===e.isSupported&&!1!==e.decipherable),0===a.length)return void n.trigger("noPlayableLockedRepresentation",null)}if(a.length<=0)return e.adaptation.isSupported=!1,void n.trigger("noPlayableRepresentation",null);const s=t.getValue(),o=a.map(e=>e.id).slice().sort();if(o.length===s.representationIds.length){for(let e=0;e<o.length;e++)if(s.representationIds[e]!==o[e])return void t.setValue({representationIds:o,switchingMode:r})}else t.setValue({representationIds:o,switchingMode:r})}function r(){n.refresh=U}}dispose(){this.removeEventListener(),this._canceller.cancel(),this._adaptationRef.finish()}}class Tv extends a{constructor(e){var t;super(),this._storedPeriodInfo=[],this._isDisposed=!1,this._cachedPeriodInfo=new WeakMap,this._isTrickModeTrackEnabled=e.preferTrickModeTracks,this._defaultAudioTrackSwitchingMode=null!==(t=e.defaultAudioTrackSwitchingMode)&&void 0!==t?t:N.getCurrent().DEFAULT_AUDIO_TRACK_SWITCHING_MODE}getAvailablePeriods(){return this._storedPeriodInfo.reduce((e,t)=>{return t.isPeriodAdvertised&&e.push(kv(t.period)),e},[])}onManifestUpdate(e){var t,n,i,r,a,s;const{DEFAULT_VIDEO_TRACK_SWITCHING_MODE:o}=N.getCurrent(),{periods:l}=e;const u=[];let c=0;for(let d=0;d<this._storedPeriodInfo.length;d++){const e=this._storedPeriodInfo[d].period,r=l[c];if(void 0===r)for(let t=this._storedPeriodInfo.length-1;t>=d;t--)this._storedPeriodInfo[t].inManifest=!1,Ev(this._storedPeriodInfo[t])&&this._removePeriodObject(t);else if(e===r){c++;const e=this._storedPeriodInfo[d].text.storedSettings;if(null!==e){const n=wt(r,"text"),i=n.some(t=>t.id===e.adaptation.id);if(!i){j.warn("TS: Chosen text Adaptation not available anymore");const e=this._storedPeriodInfo[d];if(e.text.storedSettings=null,this.trigger("trackUpdate",{period:kv(r),trackType:"text",reason:"missing"}),this._isDisposed)return;const n=wv(this._storedPeriodInfo,e.period.id);void 0!==n&&null===n.text.storedSettings&&(null===(t=n.text.dispatcher)||void 0===t||t.updateTrack(null))}}const a=this._storedPeriodInfo[d].video.storedSettings;if(null!==a){const e=wt(r,"video"),t=e.some(e=>e.id===a.adaptation.id);if(!t){j.warn("TS: Chosen video Adaptation not available anymore");const t=this._storedPeriodInfo[d];let i;if(0===e.length)i=null;else{const t=e[0],n=xv(t,this._isTrickModeTrackEnabled),r=new de(null);i={adaptationBase:t,adaptation:n,switchingMode:o,lockedRepresentations:r}}if(t.video.storedSettings=i,this.trigger("trackUpdate",{period:kv(r),trackType:"video",reason:"missing"}),this._isDisposed)return;const a=wv(this._storedPeriodInfo,t.period.id);void 0!==a&&a.video.storedSettings===i&&(null===(n=a.video.dispatcher)||void 0===n||n.updateTrack(i))}}const s=this._storedPeriodInfo[d].audio.storedSettings;if(null!==s){const e=wt(r,"audio"),t=e.some(e=>e.id===s.adaptation.id);if(!t){j.warn("TS: Chosen audio Adaptation not available anymore");const t=this._storedPeriodInfo[d],n=0===e.length?null:{adaptation:e[0],switchingMode:this._defaultAudioTrackSwitchingMode,lockedRepresentations:new de(null)};if(t.audio.storedSettings=n,this.trigger("trackUpdate",{period:kv(r),trackType:"audio",reason:"missing"}),this._isDisposed)return;const a=wv(this._storedPeriodInfo,t.period.id);void 0!==a&&a.audio.storedSettings===n&&(null===(i=a.audio.dispatcher)||void 0===i||i.updateTrack(n))}}}else if(e.start<=r.start)this._storedPeriodInfo[d].inManifest=!1,Ev(this._storedPeriodInfo[d])&&(this._removePeriodObject(d),d--);else{const e=Av(r,!0,this._isTrickModeTrackEnabled,this._defaultAudioTrackSwitchingMode);this._storedPeriodInfo.splice(d,0,e),u.push(e),c++}}if(c<l.length){const e=l.slice(c).map(e=>Av(e,!0,this._isTrickModeTrackEnabled,this._defaultAudioTrackSwitchingMode));this._storedPeriodInfo.push(...e),u.push(...e)}for(const d of this._storedPeriodInfo)null===(r=d.audio.dispatcher)||void 0===r||r.refresh(),null===(a=d.video.dispatcher)||void 0===a||a.refresh(),null===(s=d.text.dispatcher)||void 0===s||s.refresh()}onDecipherabilityUpdates(){var e,t,n;for(const i of this._storedPeriodInfo)null===(e=i.audio.dispatcher)||void 0===e||e.refresh(),null===(t=i.video.dispatcher)||void 0===t||t.refresh(),null===(n=i.text.dispatcher)||void 0===n||n.refresh()}addTrackReference(e,t,n){let i=wv(this._storedPeriodInfo,t.id);if(void 0===i){i=Av(t,!1,this._isTrickModeTrackEnabled,this._defaultAudioTrackSwitchingMode);let e=!1;for(let n=0;n<this._storedPeriodInfo.length;n++)this._storedPeriodInfo[n].period.start>t.start&&(this._storedPeriodInfo.splice(n,0,i),e=!0);e||this._storedPeriodInfo.push(i)}if(!i.isPeriodAdvertised&&(i.isPeriodAdvertised=!0,this.trigger("newAvailablePeriods",[{id:t.id,start:t.start,end:t.end}]),this._isDisposed))return;if(null!==i[e].dispatcher)return void j.error(`TS: Subject already added for ${e} `+`and Period ${t.start}`);const a=i[e].storedSettings,s=new Sv(n);i[e].dispatcher=s,s.addEventListener("noPlayableRepresentation",()=>{var n,i,a,s;const o=Re(null!==(n=t.adaptations[e])&&void 0!==n?n:[],e=>{if(!1===e.isSupported)return!1;const t=e.representations.filter(e=>!0===e.isSupported&&!1!==e.decipherable);return t.length>0});if(void 0===o){const t=new ut("NO_PLAYABLE_REPRESENTATION",`No ${e} Representation can be played`,{tracks:void 0});return this.trigger("error",t),void this.dispose()}let l=null===(i=wv(this._storedPeriodInfo,t.id))||void 0===i?void 0:i[e];if(r(l))return;const u="audio"===e?this._defaultAudioTrackSwitchingMode:"reload",c={adaptation:o,switchingMode:u,lockedRepresentations:new de(null)};l.storedSettings=c,this.trigger("trackUpdate",{period:kv(t),trackType:e,reason:"no-playable-representation"}),this._isDisposed||(l=null===(a=wv(this._storedPeriodInfo,t.id))||void 0===a?void 0:a[e],r(l)||l.storedSettings!==c||null===(s=l.dispatcher)||void 0===s||s.updateTrack(c))}),s.addEventListener("noPlayableLockedRepresentation",()=>{null===a||void 0===a||a.lockedRepresentations.setValue(null),this.trigger("brokenRepresentationsLock",{period:{id:t.id,start:t.start,end:t.end},trackType:e})}),s.start(a)}removeTrackReference(e,t){const n=_v(this._storedPeriodInfo,t);if(void 0===n)return void j.warn(`TS: ${e} not found for period`,t.start);const i=this._storedPeriodInfo[n],r=i[e];null!==(null===r||void 0===r?void 0:r.dispatcher)?(r.dispatcher.dispose(),r.dispatcher=null,Ev(i)&&this._removePeriodObject(n)):j.warn(`TS: TrackDispatcher already removed for ${e} `+`and Period ${t.start}`)}getPeriodObjectFromPeriod(e){const t=wv(this._storedPeriodInfo,e.id);return void 0===t&&void 0!==e?this._cachedPeriodInfo.get(e):t}getPeriodObjectFromId(e){return wv(this._storedPeriodInfo,e)}disableVideoTrickModeTracks(){this._isTrickModeTrackEnabled&&(this._isTrickModeTrackEnabled=!1,this._resetVideoTrackChoices("trickmode-disabled"))}enableVideoTrickModeTracks(){this._isTrickModeTrackEnabled||(this._isTrickModeTrackEnabled=!0,this._resetVideoTrackChoices("trickmode-enabled"))}resetPeriodObjects(){var e,t,n;for(let i=this._storedPeriodInfo.length-1;i>=0;i--){const r=this._storedPeriodInfo[i];null===(e=r.audio.dispatcher)||void 0===e||e.dispose(),r.audio.dispatcher=null,null===(t=r.video.dispatcher)||void 0===t||t.dispose(),r.video.dispatcher=null,null===(n=r.text.dispatcher)||void 0===n||n.dispose(),r.text.dispatcher=null,r.inManifest||this._removePeriodObject(i)}}isTrickModeEnabled(){return this._isTrickModeTrackEnabled}setAudioTrack(e){const{periodRef:t,trackId:n,switchingMode:i,lockedRepresentations:r,relativeResumingPosition:a}=e;return this._setAudioOrTextTrack({bufferType:"audio",periodRef:t,trackId:n,switchingMode:null!==i&&void 0!==i?i:this._defaultAudioTrackSwitchingMode,lockedRepresentations:r,relativeResumingPosition:a})}setTextTrack(e,t){return this._setAudioOrTextTrack({bufferType:"text",periodRef:e,trackId:t,switchingMode:"direct",lockedRepresentations:null,relativeResumingPosition:void 0})}_setAudioOrTextTrack({bufferType:e,periodRef:t,trackId:n,switchingMode:i,lockedRepresentations:r,relativeResumingPosition:a}){var s,o;const l=t.period,u=Re(null!==(s=l.adaptations[e])&&void 0!==s?s:[],({id:e,isSupported:t})=>!0===t&&e===n);if(void 0===u)throw new Error(`Wanted ${e} track not found.`);const c=t[e];let d;if(null===r)d=new de(null);else{const t=this._getRepresentationsToLock(u,r),n="audio"===e?this._defaultAudioTrackSwitchingMode:"direct";d=new de({representationIds:t,switchingMode:n})}const h={adaptation:u,switchingMode:i,lockedRepresentations:d,relativeResumingPosition:a};if(c.storedSettings=h,this.trigger("trackUpdate",{period:kv(l),trackType:e,reason:"manual"}),this._isDisposed)return;const f=wv(this._storedPeriodInfo,l.id);void 0!==f&&f[e].storedSettings===h&&(null===(o=f[e].dispatcher)||void 0===o||o.updateTrack(h))}setVideoTrack(e){var t,n;const{periodRef:i,trackId:r,switchingMode:a,lockedRepresentations:s,relativeResumingPosition:o}=e,l=i.period,u=Re(null!==(t=l.adaptations.video)&&void 0!==t?t:[],({id:e,isSupported:t})=>!0===t&&e===r);if(void 0===u)throw new Error("Wanted video track not found.");const{DEFAULT_VIDEO_TRACK_SWITCHING_MODE:c}=N.getCurrent(),d=i.video,h=xv(u,this._isTrickModeTrackEnabled);let f;if(null===s)f=new de(null);else{const e=this._getRepresentationsToLock(u,s),t=c;f=new de({representationIds:e,switchingMode:t})}const p={adaptationBase:u,switchingMode:null!==a&&void 0!==a?a:c,adaptation:h,relativeResumingPosition:o,lockedRepresentations:f};if(d.storedSettings=p,this.trigger("trackUpdate",{period:kv(l),trackType:"video",reason:"manual"}),this._isDisposed)return;const g=wv(this._storedPeriodInfo,l.id);void 0!==g&&g.video.storedSettings===p&&(null===(n=g.video.dispatcher)||void 0===n||n.updateTrack(p))}disableTrack(e,t){var n,i;const r=e[t];if(null===r.storedSettings)return;if("text"!==t&&(null===(n=e[t].storedSettings)||void 0===n||n.lockedRepresentations.finish()),r.storedSettings=null,this.trigger("trackUpdate",{period:kv(e.period),trackType:t,reason:"manual"}),this._isDisposed)return;const a=wv(this._storedPeriodInfo,e.period.id);void 0!==a&&null===a[t].storedSettings&&(null===(i=a[t].dispatcher)||void 0===i||i.updateTrack(null))}getChosenAudioTrack(e){return null===e.audio.storedSettings?null:It(e.audio.storedSettings.adaptation,!0)}getChosenTextTrack(e){return null===e.text.storedSettings?null:Ct(e.text.storedSettings.adaptation)}getChosenVideoTrack(e){return null===e.video.storedSettings?null:Rt(e.video.storedSettings.adaptation,!0)}getAvailableAudioTracks(e){const t=e.audio.storedSettings,n=null!==t?t.adaptation.id:null,i=wt(e.period,"audio");return i.map(e=>{const t=null!==n&&n===e.id;return M(It(e,!0),{active:t})})}getAvailableTextTracks(e){const t=e.text.storedSettings,n=null!==t?t.adaptation.id:null,i=wt(e.period,"text");return i.map(e=>{const t=null!==n&&n===e.id;return M(Ct(e),{active:t})})}getAvailableVideoTracks(e){const t=e.video.storedSettings,n=null===t?void 0:t.adaptation.id,i=wt(e.period,"video");return i.map(e=>{const t=null!==n&&n===e.id,i=Rt(e,!0),r=void 0!==i.trickModeTracks?i.trickModeTracks.map(e=>{const t=null!==n&&n===e.id;return M(e,{active:t})}):[],a=M(i,{active:t});return void 0!==r&&(a.trickModeTracks=r),a})}getLockedAudioRepresentations(e){const{storedSettings:t}=e.audio;if(null===t)return null;const n=t.lockedRepresentations.getValue();return null===n?null:n.representationIds}getLockedVideoRepresentations(e){const{storedSettings:t}=e.video;if(null===t)return null;const n=t.lockedRepresentations.getValue();return null===n?null:n.representationIds}lockAudioRepresentations(e,t){var n;const{storedSettings:i}=e.audio;if(null===i)return;const{DEFAULT_AUDIO_REPRESENTATIONS_SWITCHING_MODE:r}=N.getCurrent(),a=this._getRepresentationsToLock(i.adaptation,t.representations),s=null!==(n=t.switchingMode)&&void 0!==n?n:r;i.lockedRepresentations.setValue({representationIds:a,switchingMode:s})}lockVideoRepresentations(e,t){var n;const{storedSettings:i}=e.video;if(null===i)return;const{DEFAULT_VIDEO_REPRESENTATIONS_SWITCHING_MODE:r}=N.getCurrent(),a=this._getRepresentationsToLock(i.adaptation,t.representations),s=null!==(n=t.switchingMode)&&void 0!==n?n:r;i.lockedRepresentations.setValue({representationIds:a,switchingMode:s})}unlockAudioRepresentations(e){const{storedSettings:t}=e.audio;null!==t&&null!==t.lockedRepresentations.getValue()&&t.lockedRepresentations.setValue(null)}unlockVideoRepresentations(e){const{storedSettings:t}=e.video;null!==t&&null!==t.lockedRepresentations.getValue()&&t.lockedRepresentations.setValue(null)}dispose(){this._isDisposed=!0;while(1){const e=this._storedPeriodInfo.pop();if(void 0===e)return;e.isRemoved=!0}}_resetVideoTrackChoices(e){var t;for(let i=0;i<this._storedPeriodInfo.length;i++){const e=this._storedPeriodInfo[i];if(null!==e.video.storedSettings){const t=e.video.storedSettings.adaptationBase;if(null!==t){const n=xv(t,this._isTrickModeTrackEnabled);e.video.storedSettings.adaptationBase=t,e.video.storedSettings.adaptation=n}}}const n=this._storedPeriodInfo.slice();for(let i=0;i<n.length;i++){const r=n[i].period,a=n[i].video,s=a.storedSettings;if(this.trigger("trackUpdate",{period:kv(r),trackType:"video",reason:e}),this._isDisposed)return;const o=wv(this._storedPeriodInfo,r.id);void 0!==o&&o.video.storedSettings===s&&(null===(t=o.video.dispatcher)||void 0===t||t.updateTrack(s))}}_removePeriodObject(e){const t=this._storedPeriodInfo[e];this._storedPeriodInfo[e].isRemoved=!0,this._storedPeriodInfo.splice(e,1),this._cachedPeriodInfo.set(t.period,t)}_getRepresentationsToLock(e,t){const n=t.reduce((t,n)=>{const i=Re(e.representations,e=>{return e.id===n});return void 0===i?j.warn("API: Wanted locked Representation not found."):t.push(i.id),t},[]);if(0===n.length)throw new Error("Cannot lock Representations: None of the given Representation id are found");return n}}function _v(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.period.id===t.id)return n}}function wv(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.period.id===t)return i}}function Ev(e){var t,n,i;return!e.inManifest&&null===(null===(t=e.text)||void 0===t?void 0:t.dispatcher)&&null===(null===(n=e.audio)||void 0===n?void 0:n.dispatcher)&&null===(null===(i=e.video)||void 0===i?void 0:i.dispatcher)}function xv(e,t){var n;return t&&void 0!==(null===(n=e.trickModeTracks)||void 0===n?void 0:n[0])?e.trickModeTracks[0]:e}function Av(e,t,n,i){var r,a;const s=wt(e,"audio")[0],o=wt(e,"video")[0],l=xv(o,n),{DEFAULT_VIDEO_TRACK_SWITCHING_MODE:u}=N.getCurrent(),c=void 0!==s?{adaptation:s,switchingMode:i,lockedRepresentations:new de(null)}:null,d=void 0!==l?{adaptation:l,adaptationBase:o,switchingMode:u,lockedRepresentations:new de(null)}:null;let h=null;const f=(null!==(r=e.adaptations.text)&&void 0!==r?r:[]).filter(e=>!0===e.isForcedSubtitles);if(f.length>0){if(null!==s&&void 0!==s){const e=Re(f,e=>e.normalizedLanguage===s.normalizedLanguage);void 0!==e&&(h=e)}null===h&&(h=null!==(a=Re(f,e=>void 0===e.normalizedLanguage))&&void 0!==a?a:null)}let p=null;return null!==h&&(p={adaptation:h,switchingMode:"direct",lockedRepresentations:new de(null)}),{period:e,inManifest:t,isPeriodAdvertised:!1,isRemoved:!1,audio:{storedSettings:c,dispatcher:null},video:{storedSettings:d,dispatcher:null},text:{storedSettings:p,dispatcher:null}}}function kv(e){return{start:e.start,end:e.end,id:e.id}}var Iv=Tv;function Cv(e){let t,n,i,a,s,o;const{DEFAULT_BASE_BANDWIDTH:l,DEFAULT_VIDEO_RESOLUTION_LIMIT:u,DEFAULT_MAX_BUFFER_AHEAD:c,DEFAULT_MAX_BUFFER_BEHIND:d,DEFAULT_MAX_VIDEO_BUFFER_SIZE:h,DEFAULT_THROTTLE_VIDEO_BITRATE_WHEN_HIDDEN:f,DEFAULT_WANTED_BUFFER_AHEAD:p}=N.getCurrent();if(r(e.maxBufferAhead))t=c;else if(t=Number(e.maxBufferAhead),isNaN(t))throw new Error("Invalid maxBufferAhead parameter. Should be a number.");if(r(e.maxBufferBehind))n=d;else if(n=Number(e.maxBufferBehind),isNaN(n))throw new Error("Invalid maxBufferBehind parameter. Should be a number.");if(r(e.wantedBufferAhead))i=p;else if(i=Number(e.wantedBufferAhead),isNaN(i))throw new Error("Invalid wantedBufferAhead parameter. Should be a number.");if(r(e.maxVideoBufferSize))a=h;else if(a=Number(e.maxVideoBufferSize),isNaN(a))throw new Error("Invalid maxVideoBufferSize parameter. Should be a number.");const g=r(e.videoResolutionLimit)?u:e.videoResolutionLimit,m=r(e.throttleVideoBitrateWhenHidden)?f:!!e.throttleVideoBitrateWhenHidden;if(r(e.videoElement))s=document.createElement("video");else{if(!(e.videoElement instanceof HTMLMediaElement))throw new Error("Invalid videoElement parameter. Should be a HTMLMediaElement.");s=e.videoElement}if(r(e.baseBandwidth))o=l;else if(o=Number(e.baseBandwidth),isNaN(o))throw new Error("Invalid baseBandwidth parameter. Should be a number.");return{maxBufferAhead:t,maxBufferBehind:n,videoResolutionLimit:g,videoElement:s,wantedBufferAhead:i,maxVideoBufferSize:a,throttleVideoBitrateWhenHidden:m,baseBandwidth:o}}function Rv(e){var t,n,i,r;if(null===e||"object"!==typeof e&&void 0!==e)throw new Error("API: reload - Invalid options format.");if(null===(null===e||void 0===e?void 0:e.reloadAt)||"object"!==typeof(null===e||void 0===e?void 0:e.reloadAt)&&void 0!==(null===e||void 0===e?void 0:e.reloadAt))throw new Error("API: reload - Invalid 'reloadAt' option format.");if("number"!==typeof(null===(t=null===e||void 0===e?void 0:e.reloadAt)||void 0===t?void 0:t.position)&&void 0!==(null===(n=null===e||void 0===e?void 0:e.reloadAt)||void 0===n?void 0:n.position))throw new Error("API: reload - Invalid 'reloadAt.position' option format.");if("number"!==typeof(null===(i=null===e||void 0===e?void 0:e.reloadAt)||void 0===i?void 0:i.relative)&&void 0!==(null===(r=null===e||void 0===e?void 0:e.reloadAt)||void 0===r?void 0:r.relative))throw new Error("API: reload - Invalid 'reloadAt.relative' option format.");if(!Array.isArray(null===e||void 0===e?void 0:e.keySystems)&&void 0!==(null===e||void 0===e?void 0:e.keySystems))throw new Error("API: reload - Invalid 'keySystems' option format.");if(void 0!==(null===e||void 0===e?void 0:e.autoPlay)&&"boolean"!==typeof e.autoPlay)throw new Error("API: reload - Invalid 'autoPlay' option format.")}function Mv(e){var t,n,i;let a,s,o,l,u,c,d;const{DEFAULT_AUTO_PLAY:h,DEFAULT_CODEC_SWITCHING_BEHAVIOR:f,DEFAULT_ENABLE_FAST_SWITCHING:p,DEFAULT_TEXT_TRACK_MODE:g}=N.getCurrent();if(r(e))throw new Error("No option set on loadVideo");if(r(e.url)){if(r(e.initialManifest)&&r(e.manifestLoader))throw new Error("Unable to load a content: no url set on loadVideo.\nPlease provide at least either an `url` argument, a `initialManifest` option or a `manifestLoader` option so the RxPlayer can load the content.")}else a=String(e.url);if(r(e.transport))throw new Error("No transport set on loadVideo");s=String(e.transport);const m=r(e.autoPlay)?h:!!e.autoPlay;if(r(e.keySystems))o=[];else{o=Array.isArray(e.keySystems)?e.keySystems:[e.keySystems];for(const e of o)if("string"!==typeof e.type||"function"!==typeof e.getLicense)throw new Error("Invalid key system given: Missing type string or getLicense callback")}const v=void 0!==e.lowLatencyMode&&!!e.lowLatencyMode,y=e.initialManifest,b=null!==(t=e.minimumManifestUpdateInterval)&&void 0!==t?t:0;let S=null!==(n=e.defaultAudioTrackSwitchingMode)&&void 0!==n?n:void 0;void 0===S||gt(["seamless","direct","reload"],S)||(j.warn("The `defaultAudioTrackSwitchingMode` loadVideo option must match one of the following strategy name:\n- `seamless`\n- `direct`\n- `reload`"),S=void 0);let T=r(e.onCodecSwitch)?f:e.onCodecSwitch;if(gt(["continue","reload"],T)||(j.warn("The `onCodecSwitch` loadVideo option must match one of the following string:\n- `continue`\n- `reload`\nIf badly set, "+f+" will be used as default"),T=f),r(e.textTrackMode))l=g;else{if("native"!==e.textTrackMode&&"html"!==e.textTrackMode)throw new Error("Invalid textTrackMode.");l=e.textTrackMode}if("html"===l){if(r(e.textTrackElement))throw new Error('You have to provide a textTrackElement in "html" textTrackMode.');if(!(e.textTrackElement instanceof HTMLElement))throw new Error("textTrackElement should be an HTMLElement.");c=e.textTrackElement}else r(e.textTrackElement)||j.warn('API: You have set a textTrackElement without being in an "html" textTrackMode. It will be ignored.');if(r(e.mode))u="auto";else{if(!gt(["auto","multithread","main"],e.mode))throw new Error("Invalid `mode` option.");u=e.mode}const _=r(e.enableFastSwitching)?p:e.enableFastSwitching;if(!r(e.startAt))if("wallClockTime"in e.startAt&&e.startAt.wallClockTime instanceof Date){const t=e.startAt.wallClockTime.getTime()/1e3;d=M({},e.startAt,{wallClockTime:t})}else d=e.startAt;const w=null!==(i=e.requestConfig)&&void 0!==i?i:{};return{__priv_patchLastSegmentInSidx:e.__priv_patchLastSegmentInSidx,__priv_manifestUpdateUrl:e.__priv_manifestUpdateUrl,checkMediaSegmentIntegrity:e.checkMediaSegmentIntegrity,autoPlay:m,defaultAudioTrackSwitchingMode:S,enableFastSwitching:_,initialManifest:y,keySystems:o,lowLatencyMode:v,manifestLoader:e.manifestLoader,minimumManifestUpdateInterval:b,requestConfig:w,onCodecSwitch:T,referenceDateTime:e.referenceDateTime,representationFilter:e.representationFilter,segmentLoader:e.segmentLoader,serverSyncInfos:e.serverSyncInfos,startAt:d,textTrackElement:c,textTrackMode:l,transport:s,mode:u,url:a}}function Dv(e,t,n,i,r){if(r.isCancelled()||null===e)return;let a=2===t.getReference().getValue().seeking;a&&(n(),r.isCancelled())||t.listen(e=>{"seeking"===e.event?(a=!0,n()):a&&"seeked"===e.event&&(a=!1,i())},{includeLastObservation:!0,clearSignal:r})}function Lv(e,t,n,i){i.isCancelled()||null===e||(e.addEventListener("play",t),e.addEventListener("pause",n),i.register(()=>{e.removeEventListener("play",t),e.removeEventListener("pause",n)}))}function Pv(e,t,n,i){const r=new de("LOADING",i);e.addEventListener("loaded",()=>{if("LOADING"===r.getValue()){if(r.setValue("LOADED"),!i.isCancelled()){const e=Ov(t,null);"PAUSED"!==e&&r.setValue(e)}}else"RELOADING"===r.getValue()?r.setValue(Ov(t,null)):s(null)},i),e.addEventListener("reloadingMediaSource",()=>{Nv(r.getValue())&&r.setValueIfChanged("RELOADING")},i);let a=null;return e.addEventListener("stalled",e=>{e!==a&&(s(e),a=e)},i),e.addEventListener("unstalled",()=>{null!==a&&(s(null),a=null)},i),n.listen(e=>{gt(["seeking","ended","play","pause"],e.event)&&s(a)},{clearSignal:i}),r;function s(e){if(!Nv(r.getValue()))return;const n=Ov(t,e),i=r.getValue();"LOADED"===i&&"PAUSED"===n||r.setValueIfChanged(n)}}function Ov(e,t){const{FORCED_ENDED_THRESHOLD:n}=N.getCurrent();if(e.ended)return"ENDED";if(null!==t){const i=Math.abs(e.duration-e.currentTime);return!r(n)&&i<n?"ENDED":"seeking"===t?"SEEKING":"freezing"===t?"FREEZING":"BUFFERING"}return e.paused?"PAUSED":"PLAYING"}function Nv(e){return"LOADING"!==e&&"RELOADING"!==e&&"STOPPED"!==e}const Uv=pt(),Fv=["manifestLoader","segmentLoader"];class Bv extends a{static get ErrorTypes(){return at}static get ErrorCodes(){return st}static get LogLevel(){return j.getLevel()}static set LogLevel(e){j.setLevel(e)}static addFeatures(e){iv(e)}static _priv_registerVideoElement(e){if(Bv._priv_currentlyUsedVideoElements.has(e)){const e="The video element is already attached to another RxPlayer instance.\nMake sure to dispose the previous instance with player.dispose() before creating a new player instance attaching that video element.";console.warn(e)}Bv._priv_currentlyUsedVideoElements.add(e)}static _priv_deregisterVideoElement(e){Bv._priv_currentlyUsedVideoElements.has(e)&&Bv._priv_currentlyUsedVideoElements.delete(e)}constructor(e={}){super();const{baseBandwidth:t,videoResolutionLimit:n,maxBufferAhead:i,maxBufferBehind:r,throttleVideoBitrateWhenHidden:a,videoElement:s,wantedBufferAhead:o,maxVideoBufferSize:l}=Cv(e);s.preload="auto",this.version="4.1.0",this.log=j,this.state="STOPPED",this.videoElement=s,Bv._priv_registerVideoElement(this.videoElement);const u=new me;this._destroyCanceller=u,this._priv_pictureInPictureRef=wr(s,u.signal),this._priv_speed=new de(s.playbackRate,this._destroyCanceller.signal),this._priv_preferTrickModeTracks=!1,this._priv_contentLock=new de(!1,this._destroyCanceller.signal),this._priv_bufferOptions={wantedBufferAhead:new de(o,this._destroyCanceller.signal),maxBufferAhead:new de(i,this._destroyCanceller.signal),maxBufferBehind:new de(r,this._destroyCanceller.signal),maxVideoBufferSize:new de(l,this._destroyCanceller.signal)},this._priv_bitrateInfos={lastBitrates:{audio:t,video:t}},this._priv_throttleVideoBitrateWhenHidden=a,this._priv_videoResolutionLimit=n,this._priv_currentError=null,this._priv_contentInfos=null,this._priv_contentEventsMemory={},this._priv_reloadingMetadata={},this._priv_lastAutoPlay=!1,this._priv_worker=null,this._priv_segmentSinkMetricsCallback=null;const c=()=>{this.trigger("volumeChange",{volume:s.volume,muted:s.muted})};s.addEventListener("volumechange",c),u.signal.register(()=>{s.removeEventListener("volumechange",c)})}attachWorker(e){return new Promise((t,n)=>{var r;if(!tv())return j.warn("API: Cannot rely on a WebWorker: Worker API unavailable"),n(new nv("INCOMPATIBLE_ERROR","Worker unavailable"));if("string"===typeof e.workerUrl)this._priv_worker=new Worker(e.workerUrl);else{const t=URL.createObjectURL(e.workerUrl);this._priv_worker=new Worker(t),URL.revokeObjectURL(t)}this._priv_worker.onerror=(e=>{null!==this._priv_worker&&(this._priv_worker.terminate(),this._priv_worker=null),j.error("API: Unexpected worker error",e.error instanceof Error?e.error:void 0),n(new nv("UNKNOWN_ERROR",'Unexpected Worker "error" event'))});const a=e=>{const i=e.data;"init-error"===i.type?(j.warn("API: Processing InitError worker message: detaching worker"),null!==this._priv_worker&&(this._priv_worker.removeEventListener("message",a),this._priv_worker.terminate(),this._priv_worker=null),n(new nv("SETUP_ERROR","Worker parser initialization failed: "+i.value.errorMessage))):"init-success"===i.type&&(j.info("API: InitSuccess received from worker."),null!==this._priv_worker&&this._priv_worker.removeEventListener("message",a),t())};this._priv_worker.addEventListener("message",a),j.debug("---\x3e Sending To Worker:","init"),this._priv_worker.postMessage({type:"init",value:{dashWasmUrl:e.dashWasmUrl,logLevel:j.getLevel(),sendBackLogs:i(),date:Date.now(),timestamp:_e(),hasVideo:"video"===(null===(r=this.videoElement)||void 0===r?void 0:r.nodeName.toLowerCase()),hasMseInWorker:ev}}),j.addEventListener("onLogLevelChange",e=>{null!==this._priv_worker&&(j.debug("---\x3e Sending To Worker:","log-level-update"),this._priv_worker.postMessage({type:"log-level-update",value:{logLevel:e,sendBackLogs:i()}}))},this._destroyCanceller.signal)})}getCurrentModeInformation(){return null===this._priv_contentInfos?null:{isDirectFile:this._priv_contentInfos.isDirectFile,useWorker:this._priv_contentInfos.useWorker}}addEventListener(e,t){return super.addEventListener(e,t)}stop(){null!==this._priv_contentInfos&&this._priv_contentInfos.currentContentCanceller.cancel(),this._priv_cleanUpCurrentContentState(),"STOPPED"!==this.state&&this._priv_setPlayerState("STOPPED")}dispose(){this.stop(),null!==this.videoElement&&(Bv._priv_deregisterVideoElement(this.videoElement),vv(this.videoElement).catch(e=>{const t=e instanceof Error?e.message:"Unknown error";j.error("API: Could not dispose decryption resources: "+t)})),this._destroyCanceller.cancel(),this._priv_reloadingMetadata={},this.videoElement=null,null!==this._priv_worker&&(this._priv_worker.terminate(),this._priv_worker=null)}loadVideo(e){const t=Mv(e);j.info("API: Calling loadvideo",t.url,t.transport),this._priv_reloadingMetadata={options:t},this._priv_initializeContentPlayback(t),this._priv_lastAutoPlay=t.autoPlay}reload(e){var t,n,i;const{options:r,manifest:a,reloadPosition:s,reloadInPause:o}=this._priv_reloadingMetadata;if(void 0===r)throw new Error("API: Can't reload without having previously loaded a content.");let l,u,c;if(Rv(e),void 0!==(null===(t=null===e||void 0===e?void 0:e.reloadAt)||void 0===t?void 0:t.position))l={position:e.reloadAt.position};else if(void 0!==(null===(n=null===e||void 0===e?void 0:e.reloadAt)||void 0===n?void 0:n.relative)){if(void 0===s)throw new Error("Can't reload to a relative position when previous content was not loaded.");l={position:e.reloadAt.relative+s}}else void 0!==s&&(l={position:s});void 0!==(null===e||void 0===e?void 0:e.autoPlay)?u=e.autoPlay:void 0!==o&&(u=!o),void 0!==(null===e||void 0===e?void 0:e.keySystems)?c=e.keySystems:void 0!==(null===(i=this._priv_reloadingMetadata.options)||void 0===i?void 0:i.keySystems)&&(c=this._priv_reloadingMetadata.options.keySystems);const d=Object.assign(Object.assign({},r),{initialManifest:a});void 0!==l&&(d.startAt=l),void 0!==u&&(d.autoPlay=u),void 0!==c&&(d.keySystems=c),this._priv_initializeContentPlayback(d)}createDebugElement(e){if(null===$t.createDebugElement)throw new Error("Feature `DEBUG_ELEMENT` not added to the RxPlayer");const t=new me;return $t.createDebugElement(e,this,t.signal),{dispose(){t.cancel()}}}_priv_initializeContentPlayback(e){var t,n,i,a,s,o;const{autoPlay:l,defaultAudioTrackSwitchingMode:u,enableFastSwitching:c,initialManifest:d,keySystems:h,lowLatencyMode:f,minimumManifestUpdateInterval:p,requestConfig:g,onCodecSwitch:m,startAt:v,transport:y,checkMediaSegmentIntegrity:b,manifestLoader:S,referenceDateTime:T,segmentLoader:_,serverSyncInfos:w,mode:E,__priv_manifestUpdateUrl:x,__priv_patchLastSegmentInSidx:A,url:k}=e;if(null===this.videoElement)throw new Error("the attached video element is disposed");const I="directfile"===y,C=new me,R=this.videoElement;let D,L=!1,P=null;if(I){if(null===$t.directfile)throw this.stop(),this._priv_currentError=null,new Error("DirectFile feature not activated in your build.");if(r(k))throw new Error("No URL for a DirectFile content");if(j.info("API: Initializing DirectFile mode in the main thread"),P=this._priv_initializeMediaElementTracksStore(C.signal),C.isUsed())return;D=new $t.directfile.initDirectFile({autoPlay:l,keySystems:h,speed:this._priv_speed,startAt:v,url:k})}else{const u={lowLatencyMode:f,maxRetry:null===(t=g.manifest)||void 0===t?void 0:t.maxRetry,requestTimeout:null===(n=g.manifest)||void 0===n?void 0:n.timeout,connectionTimeout:null===(i=g.manifest)||void 0===i?void 0:i.connectionTimeout,minimumManifestUpdateInterval:p,initialManifest:d},I=Qm(),P={throttleBitrate:{},limitResolution:{}};this._priv_throttleVideoBitrateWhenHidden&&(I?P.throttleBitrate={video:ce(Er(this._priv_pictureInPictureRef,C.signal),e=>e?1/0:0,C.signal)}:j.warn("API: Can't apply throttleVideoBitrateWhenHidden because browser can't be trusted for visibility.")),"videoElement"===this._priv_videoResolutionLimit?I?P.limitResolution={video:Ar(R,this._priv_pictureInPictureRef,C.signal)}:j.warn("API: Can't apply videoResolutionLimit because browser can't be trusted for video size."):"screen"===this._priv_videoResolutionLimit&&(P.limitResolution={video:xr(C.signal)});const O={initialBitrates:this._priv_bitrateInfos.lastBitrates,lowLatencyMode:f,throttlers:P},N="native"===e.textTrackMode?{textTrackMode:"native"}:{textTrackMode:"html",textTrackElement:e.textTrackElement},U=M({enableFastSwitching:c,onCodecSwitch:m},this._priv_bufferOptions),F={lowLatencyMode:f,maxRetry:null===(a=g.segment)||void 0===a?void 0:a.maxRetry,requestTimeout:null===(s=g.segment)||void 0===s?void 0:s.timeout,connectionTimeout:null===(o=g.segment)||void 0===o?void 0:o.connectionTimeout},B=null!==$t.multithread&&null!==this._priv_worker&&"dash"===y&&Fv.every(t=>r(e[t]))&&"function"!==typeof e.representationFilter;if("main"===E||"auto"===E&&!B){if(null===$t.mainThreadMediaSourceInit)throw new Error("Cannot load video, neither in a WebWorker nor with the `MEDIA_SOURCE_MAIN` feature");const t=$t.transports[y];if("function"!==typeof t)throw this.stop(),this._priv_currentError=null,new Error(`transport "${y}" not supported`);const n="string"===typeof e.representationFilter?Pt(e.representationFilter):e.representationFilter;j.info("API: Initializing MediaSource mode in the main thread");const i=t({lowLatencyMode:f,checkMediaSegmentIntegrity:b,manifestLoader:S,referenceDateTime:T,representationFilter:n,segmentLoader:_,serverSyncInfos:w,__priv_manifestUpdateUrl:x,__priv_patchLastSegmentInSidx:A});D=new $t.mainThreadMediaSourceInit({adaptiveOptions:O,autoPlay:l,bufferOptions:U,keySystems:h,lowLatencyMode:f,transport:i,manifestRequestSettings:u,segmentRequestOptions:F,speed:this._priv_speed,startAt:v,textTrackOptions:N,url:k})}else{if(null===$t.multithread)throw new Error("Cannot load video in multithread mode: `MULTI_THREAD` feature not imported.");if(null===this._priv_worker)throw new Error("Cannot load video in multithread mode: `attachWorker` method not called.");fe("function"!==typeof e.representationFilter),L=!0,j.info("API: Initializing MediaSource mode in a WebWorker");const t={lowLatencyMode:f,checkMediaSegmentIntegrity:b,referenceDateTime:T,serverSyncInfos:w,manifestLoader:void 0,segmentLoader:void 0,representationFilter:e.representationFilter,__priv_manifestUpdateUrl:x,__priv_patchLastSegmentInSidx:A};D=new $t.multithread.init({adaptiveOptions:O,autoPlay:l,bufferOptions:U,keySystems:h,lowLatencyMode:f,transportOptions:t,manifestRequestSettings:u,segmentRequestOptions:F,speed:this._priv_speed,startAt:v,textTrackOptions:N,worker:this._priv_worker,url:k})}}const O={contentId:Uv(),originalUrl:k,currentContentCanceller:C,defaultAudioTrackSwitchingMode:u,initializer:D,isDirectFile:I,manifest:null,currentPeriod:null,activeAdaptations:null,activeRepresentations:null,tracksStore:null,mediaElementTracksStore:P,useWorker:L};D.addEventListener("error",e=>{this._priv_onFatalError(e,O)}),D.addEventListener("warning",e=>{const t=ft(e,{defaultCode:"NONE",defaultReason:"An unknown error happened."});j.warn("API: Sending warning:",t),this.trigger("warning",t)}),D.addEventListener("reloadingMediaSource",e=>{null!==O.tracksStore&&O.tracksStore.resetPeriodObjects(),this._priv_segmentSinkMetricsCallback=null,this._priv_lastAutoPlay=e.autoPlay}),D.addEventListener("inbandEvents",e=>this.trigger("inbandEvents",e)),D.addEventListener("streamEvent",e=>this.trigger("streamEvent",e)),D.addEventListener("streamEventSkip",e=>this.trigger("streamEventSkip",e)),D.addEventListener("activePeriodChanged",e=>this._priv_onActivePeriodChanged(O,e)),D.addEventListener("periodStreamReady",e=>this._priv_onPeriodStreamReady(O,e)),D.addEventListener("periodStreamCleared",e=>this._priv_onPeriodStreamCleared(O,e)),D.addEventListener("representationChange",e=>this._priv_onRepresentationChange(O,e)),D.addEventListener("adaptationChange",e=>this._priv_onAdaptationChange(O,e)),D.addEventListener("bitrateEstimateChange",e=>this._priv_onBitrateEstimateChange(e)),D.addEventListener("manifestReady",e=>this._priv_onManifestReady(O,e)),D.addEventListener("manifestUpdate",e=>this._priv_onManifestUpdate(O,e)),D.addEventListener("decipherabilityUpdate",e=>this._priv_onDecipherabilityUpdate(O,e)),D.addEventListener("loaded",e=>{this._priv_segmentSinkMetricsCallback=e.getSegmentSinkMetrics}),D.prepare(),this.stop();const N=new uv(R,{withMediaSource:!I,lowLatencyMode:f});C.signal.register(()=>{N.stop()});const U=Pv(D,R,N,C.signal);C.signal.register(()=>{D.dispose()});const F=e=>{switch(e){case"STOPPED":case"RELOADING":case"LOADING":break;case"ENDED":this._priv_reloadingMetadata.reloadInPause=!0,this._priv_reloadingMetadata.reloadPosition=N.getReference().getValue().position.getPolled();break;default:const t=N.getReference().getValue();this._priv_reloadingMetadata.reloadInPause=t.paused,this._priv_reloadingMetadata.reloadPosition=t.position.getWanted();break}};let B=null;const V=e=>{null!==B&&(B.cancel(),B=null),U.onUpdate((t,n)=>{Nv(t)&&(n(),null!==B&&B.cancel(),B=new me,B.linkToSignal(C.signal),e!==!R.paused&&(R.paused?this.trigger("pause",null):this.trigger("play",null)),Lv(R,()=>this.trigger("play",null),()=>this.trigger("pause",null),C.signal))},{emitCurrentValue:!1,clearSignal:C.signal})};V(l),D.addEventListener("reloadingMediaSource",e=>{V(e.autoPlay)}),this._priv_currentError=null,this._priv_contentInfos=O;let G=null;U.onUpdate(e=>{F(e),this._priv_setPlayerState(e),C.isUsed()||(null!==G?Nv(this.state)||(G.cancel(),G=null):Nv(this.state)&&(G=new me,G.linkToSignal(C.signal),Dv(R,N,()=>this.trigger("seeking",null),()=>this.trigger("seeked",null),G.signal)))},{emitCurrentValue:!0,clearSignal:C.signal}),N.listen(e=>{F(this.state),this._priv_triggerPositionUpdate(O,e)},{clearSignal:C.signal}),C.signal.register(()=>{D.removeEventListener()}),this._priv_contentLock.onUpdate((e,t)=>{e||(t(),D.start(R,N))},{emitCurrentValue:!0,clearSignal:C.signal})}getError(){return this._priv_currentError}getVideoElement(){return this.videoElement}getPlayerState(){return this.state}isContentLoaded(){return!gt(["LOADING","RELOADING","STOPPED"],this.state)}isBuffering(){return gt(["BUFFERING","SEEKING","LOADING","RELOADING"],this.state)}isPaused(){return!this.videoElement||(gt(["LOADING","RELOADING"],this.state)?!this._priv_lastAutoPlay:this.videoElement.paused)}isLive(){if(null===this._priv_contentInfos)return!1;const{isDirectFile:e,manifest:t}=this._priv_contentInfos;return!e&&null!==t&&t.isLive}areTrickModeTracksEnabled(){return this._priv_preferTrickModeTracks}getContentUrls(){if(null===this._priv_contentInfos)return;const{isDirectFile:e,manifest:t,originalUrl:n}=this._priv_contentInfos;return e?void 0===n?void 0:[n]:null!==t?t.uris:void 0}updateContentUrls(e,t){if(null===this._priv_contentInfos)throw new Error("No content loaded");const n=!0===(null===t||void 0===t?void 0:t.refresh);this._priv_contentInfos.initializer.updateContentUrls(e,n)}getMediaDuration(){if(null===this.videoElement)throw new Error("Disposed player");return this.videoElement.duration}getCurrentBufferGap(){if(null===this.videoElement)throw new Error("Disposed player");const e=this.videoElement,t=ne(e.buffered,e.currentTime);return t===1/0?0:t}getWallClockTime(){if(null===this.videoElement)throw new Error("Disposed player");if(null===this._priv_contentInfos)return this.videoElement.currentTime;const{isDirectFile:e,manifest:t}=this._priv_contentInfos;if(e){const e=Zm(this.videoElement);return(null!==e&&void 0!==e?e:0)+this.videoElement.currentTime}if(null!==t){const e=this.videoElement.currentTime,n=void 0!==t.availabilityStartTime?t.availabilityStartTime:0;return e+n}return 0}getPosition(){if(null===this.videoElement)throw new Error("Disposed player");return this.videoElement.currentTime}getLastStoredContentPosition(){return this._priv_reloadingMetadata.reloadPosition}getPlaybackRate(){return this._priv_speed.getValue()}setPlaybackRate(e,t){var n;e!==this._priv_speed.getValue()&&this._priv_speed.setValue(e);const i=null===t||void 0===t?void 0:t.preferTrickModeTracks;if("boolean"!==typeof i)return;this._priv_preferTrickModeTracks=i;const a=null===(n=this._priv_contentInfos)||void 0===n?void 0:n.tracksStore;r(a)||(i&&!a.isTrickModeEnabled()?a.enableVideoTrickModeTracks():!i&&a.isTrickModeEnabled()&&a.disableVideoTrickModeTracks())}getVideoRepresentation(){const e=this.__priv_getCurrentRepresentations();if(null!==e)return e.video}getAudioRepresentation(){const e=this.__priv_getCurrentRepresentations();if(null!==e)return e.audio}play(){if(null===this.videoElement)throw new Error("Disposed player");const e=this.videoElement.play();return r(e)||"function"!==typeof e.catch?Promise.resolve():e.catch(e=>{if("NotAllowedError"===e.name){const t=new ut("MEDIA_ERR_PLAY_NOT_ALLOWED",e.toString());this.trigger("warning",t)}throw e})}pause(){if(null===this.videoElement)throw new Error("Disposed player");this.videoElement.pause()}seekTo(e){var t;if(null===this.videoElement)throw new Error("Disposed player");if(null===this._priv_contentInfos)throw new Error("player: no content loaded");const{isDirectFile:n,manifest:i}=this._priv_contentInfos;if(!n&&null===i)throw new Error("player: the content did not load yet");let a;if("number"===typeof e)a=e;else if("object"===typeof e){const s=e,o=this.videoElement.currentTime;if(r(s.relative))if(r(s.position)){if(r(s.wallClockTime))throw new Error('invalid time object. You must set one of the following properties: "relative", "position" or "wallClockTime"');if(null!==i)a=s.wallClockTime-(null!==(t=i.availabilityStartTime)&&void 0!==t?t:0);else if(n&&null!==this.videoElement){const e=Zm(this.videoElement);void 0!==e&&(a=s.wallClockTime-e)}void 0===a&&(a=s.wallClockTime)}else a=s.position;else a=o+s.relative}if(void 0===a)throw new Error("invalid time given");return j.info("API: API Seek to",a),this.videoElement.currentTime=a,a}getVolume(){if(null===this.videoElement)throw new Error("Disposed player");return this.videoElement.volume}setVolume(e){if(null===this.videoElement)throw new Error("Disposed player");const t=this.videoElement;e!==t.volume&&(t.volume=e)}isMute(){var e;return!0===(null===(e=this.videoElement)||void 0===e?void 0:e.muted)}mute(){if(null===this.videoElement)throw new Error("Disposed player");this.videoElement.muted||(this.videoElement.muted=!0)}unMute(){if(null===this.videoElement)throw new Error("Disposed player");this.videoElement.muted&&(this.videoElement.muted=!1)}setMaxBufferBehind(e){this._priv_bufferOptions.maxBufferBehind.setValue(e)}setMaxBufferAhead(e){this._priv_bufferOptions.maxBufferAhead.setValue(e)}setWantedBufferAhead(e){this._priv_bufferOptions.wantedBufferAhead.setValue(e)}setMaxVideoBufferSize(e){this._priv_bufferOptions.maxVideoBufferSize.setValue(e)}getMaxBufferBehind(){return this._priv_bufferOptions.maxBufferBehind.getValue()}getMaxBufferAhead(){return this._priv_bufferOptions.maxBufferAhead.getValue()}getWantedBufferAhead(){return this._priv_bufferOptions.wantedBufferAhead.getValue()}getMaxVideoBufferSize(){return this._priv_bufferOptions.maxVideoBufferSize.getValue()}getCurrentPeriod(){var e;const t=null===(e=this._priv_contentInfos)||void 0===e?void 0:e.currentPeriod;return r(t)?null:{id:t.id,start:t.start,end:t.end}}getKeySystemConfiguration(){if(null===this.videoElement)throw new Error("Disposed player");const e=or(this.videoElement);return null===e?null:{keySystem:e[0],configuration:e[1]}}getAvailablePeriods(){if(null===this._priv_contentInfos)return[];const{isDirectFile:e,tracksStore:t}=this._priv_contentInfos;return e?[]:null===t?[]:t.getAvailablePeriods().slice()}getAvailableAudioTracks(e){var t;if(null===this._priv_contentInfos)return[];const{isDirectFile:n,mediaElementTracksStore:i}=this._priv_contentInfos;return n?null!==(t=null===i||void 0===i?void 0:i.getAvailableAudioTracks())&&void 0!==t?t:[]:this._priv_callTracksStoreGetterSetter(e,[],(e,t)=>{var n;return null!==(n=e.getAvailableAudioTracks(t))&&void 0!==n?n:[]})}getAvailableTextTracks(e){var t;if(null===this._priv_contentInfos)return[];const{isDirectFile:n,mediaElementTracksStore:i}=this._priv_contentInfos;return n?null!==(t=null===i||void 0===i?void 0:i.getAvailableTextTracks())&&void 0!==t?t:[]:this._priv_callTracksStoreGetterSetter(e,[],(e,t)=>{var n;return null!==(n=e.getAvailableTextTracks(t))&&void 0!==n?n:[]})}getAvailableVideoTracks(e){var t;if(null===this._priv_contentInfos)return[];const{isDirectFile:n,mediaElementTracksStore:i}=this._priv_contentInfos;return n?null!==(t=null===i||void 0===i?void 0:i.getAvailableVideoTracks())&&void 0!==t?t:[]:this._priv_callTracksStoreGetterSetter(e,[],(e,t)=>{var n;return null!==(n=e.getAvailableVideoTracks(t))&&void 0!==n?n:[]})}getAudioTrack(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;if(t){if(null===n)return;return n.getChosenAudioTrack()}return this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.getChosenAudioTrack(t))}getTextTrack(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;if(t){if(null===n)return;return n.getChosenTextTrack()}return this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.getChosenTextTrack(t))}getVideoTrack(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;if(t){if(null===n)return;return n.getChosenVideoTrack()}return this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.getChosenVideoTrack(t))}setAudioTrack(e){var t;if(null===this._priv_contentInfos)throw new Error("No content loaded");const{isDirectFile:n,mediaElementTracksStore:i}=this._priv_contentInfos;if(n)try{const t="string"===typeof e?e:e.trackId;return void(null===i||void 0===i||i.setAudioTrackById(t))}catch(e){throw new Error("player: unknown audio track")}let r,a,s,o,l=null;return"string"===typeof e?a=e:(a=e.trackId,r=e.periodId,s=e.switchingMode,l=null!==(t=e.lockedRepresentations)&&void 0!==t?t:null,o=e.relativeResumingPosition),this._priv_callTracksStoreGetterSetter(r,void 0,(e,t)=>e.setAudioTrack({periodRef:t,trackId:a,switchingMode:s,lockedRepresentations:l,relativeResumingPosition:o}))}setTextTrack(e){if(null===this._priv_contentInfos)throw new Error("No content loaded");const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;if(t)try{const t="string"===typeof e?e:e.trackId;return void(null===n||void 0===n||n.setTextTrackById(t))}catch(e){throw new Error("player: unknown text track")}let i,r;return"string"===typeof e?r=e:(r=e.trackId,i=e.periodId),this._priv_callTracksStoreGetterSetter(i,void 0,(e,t)=>e.setTextTrack(t,r))}disableTextTrack(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;if(!t)return this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.disableTrack(t,"text"));null===n||void 0===n||n.disableTextTrack()}setVideoTrack(e){var t;if(null===this._priv_contentInfos)throw new Error("No content loaded");const{isDirectFile:n,mediaElementTracksStore:i}=this._priv_contentInfos;if(n)try{const t="string"===typeof e?e:e.trackId;return void(null===i||void 0===i||i.setVideoTrackById(t))}catch(e){throw new Error("player: unknown video track")}let r,a,s,o,l=null;return"string"===typeof e?a=e:(a=e.trackId,r=e.periodId,s=e.switchingMode,l=null!==(t=e.lockedRepresentations)&&void 0!==t?t:null,o=e.relativeResumingPosition),this._priv_callTracksStoreGetterSetter(r,void 0,(e,t)=>e.setVideoTrack({periodRef:t,trackId:a,switchingMode:s,lockedRepresentations:l,relativeResumingPosition:o}))}disableVideoTrack(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;return t&&null!==n?n.disableVideoTrack():this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.disableTrack(t,"video"))}lockVideoRepresentations(e){if(null===this._priv_contentInfos)throw new Error("No content loaded");const{isDirectFile:t}=this._priv_contentInfos;if(t)throw new Error("Cannot lock video Representations in directfile mode.");let n,i,r;return Array.isArray(e)?(n=e,i=void 0):(n=e.representations,i=e.periodId,r=e.switchingMode),this._priv_callTracksStoreGetterSetter(i,void 0,(e,t)=>e.lockVideoRepresentations(t,{representations:n,switchingMode:r}))}lockAudioRepresentations(e){if(null===this._priv_contentInfos)throw new Error("No content loaded");const{isDirectFile:t}=this._priv_contentInfos;if(t)throw new Error("Cannot lock audio Representations in directfile mode.");let n,i,r;return Array.isArray(e)?(n=e,i=void 0):(n=e.representations,i=e.periodId,r=e.switchingMode),this._priv_callTracksStoreGetterSetter(i,void 0,(e,t)=>e.lockAudioRepresentations(t,{representations:n,switchingMode:r}))}getLockedVideoRepresentations(e){if(null===this._priv_contentInfos)return null;const{isDirectFile:t}=this._priv_contentInfos;return t?null:this._priv_callTracksStoreGetterSetter(e,null,(e,t)=>e.getLockedVideoRepresentations(t))}getLockedAudioRepresentations(e){if(null===this._priv_contentInfos)return null;const{isDirectFile:t}=this._priv_contentInfos;return t?null:this._priv_callTracksStoreGetterSetter(e,null,(e,t)=>e.getLockedAudioRepresentations(t))}unlockVideoRepresentations(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t}=this._priv_contentInfos;return t?void 0:this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.unlockVideoRepresentations(t))}unlockAudioRepresentations(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t}=this._priv_contentInfos;return t?void 0:this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.unlockAudioRepresentations(t))}getMinimumPosition(){if(null===this._priv_contentInfos)return null;if(this._priv_contentInfos.isDirectFile)return 0;const{manifest:e}=this._priv_contentInfos;return null!==e?St(e):null}getLivePosition(){if(null===this._priv_contentInfos)return null;const{isDirectFile:e,manifest:t}=this._priv_contentInfos;return e?void 0:!0!==(null===t||void 0===t?void 0:t.isLive)?null:Tt(t)}getMaximumPosition(){if(null===this._priv_contentInfos)return null;const{isDirectFile:e,manifest:t}=this._priv_contentInfos;if(e){if(null===this.videoElement)throw new Error("Disposed player");return this.videoElement.duration}return null!==t?t.isDynamic||null===this.videoElement?_t(t):this.videoElement.duration:null}async __priv_getSegmentSinkMetrics(){return null===this._priv_segmentSinkMetricsCallback?void 0:this._priv_segmentSinkMetricsCallback()}__priv_getManifest(){return null===this._priv_contentInfos?null:this._priv_contentInfos.manifest}__priv_getCurrentAdaptation(){if(null===this._priv_contentInfos)return null;const{currentPeriod:e,activeAdaptations:t}=this._priv_contentInfos;return null===e||null===t||r(t[e.id])?null:t[e.id]}__priv_getCurrentRepresentations(){if(null===this._priv_contentInfos)return null;const{currentPeriod:e,activeRepresentations:t}=this._priv_contentInfos;return null===e||null===t||r(t[e.id])?null:t[e.id]}_priv_cleanUpCurrentContentState(){var e,t,n,i;j.debug("Locking `contentLock` to clean-up the current content."),this._priv_contentLock.setValue(!0),null===(t=null===(e=this._priv_contentInfos)||void 0===e?void 0:e.tracksStore)||void 0===t||t.dispose(),null===(i=null===(n=this._priv_contentInfos)||void 0===n?void 0:n.mediaElementTracksStore)||void 0===i||i.dispose(),this._priv_contentInfos=null,this._priv_segmentSinkMetricsCallback=null,this._priv_contentEventsMemory={};const a=()=>{null!==this.videoElement&&(j.debug("Unlocking `contentLock`. Next content can begin."),this._priv_contentLock.setValue(!1))};r(this.videoElement)?a():bv(this.videoElement).then(()=>{j.debug("API: DRM session cleaned-up with success!"),a()},e=>{j.error("API: An error arised when trying to clean-up the DRM session:"+(e instanceof Error?e.toString():"Unknown Error")),a()})}_priv_onManifestReady(e,t){var n;if(e.contentId!==(null===(n=this._priv_contentInfos)||void 0===n?void 0:n.contentId))return;e.manifest=t,0===t.manifestFormat&&(this._priv_reloadingMetadata.manifest=t);const i=new Iv({preferTrickModeTracks:this._priv_preferTrickModeTracks,defaultAudioTrackSwitchingMode:e.defaultAudioTrackSwitchingMode});e.tracksStore=i,i.addEventListener("newAvailablePeriods",e=>{this.trigger("newAvailablePeriods",e)}),i.addEventListener("brokenRepresentationsLock",e=>{this.trigger("brokenRepresentationsLock",e)}),i.addEventListener("trackUpdate",e=>{var t,n;this.trigger("trackUpdate",e);const i=null!==(n=null===(t=this._priv_contentInfos)||void 0===t?void 0:t.currentPeriod)&&void 0!==n?n:void 0;"no-playable-representation"===e.reason&&e.period.id===(null===i||void 0===i?void 0:i.id)&&this._priv_onAvailableTracksMayHaveChanged(e.trackType)}),e.tracksStore.addEventListener("warning",e=>{this.trigger("warning",e)}),e.tracksStore.addEventListener("error",t=>{this._priv_onFatalError(t,e)}),e.tracksStore.onManifestUpdate(t)}_priv_onManifestUpdate(e,t){var n,i,a;if(null===this._priv_contentInfos||null===this._priv_contentInfos.manifest)return;r(null===e||void 0===e?void 0:e.tracksStore)||e.tracksStore.onManifestUpdate(this._priv_contentInfos.manifest);const s=null!==(i=null===(n=this._priv_contentInfos)||void 0===n?void 0:n.currentPeriod)&&void 0!==i?i:void 0,o=null===(a=this._priv_contentInfos)||void 0===a?void 0:a.tracksStore;if(void 0!==s&&!r(o))for(const r of t.updatedPeriods)if(r.period.id===s.id&&(r.result.addedAdaptations.length>0||r.result.removedAdaptations.length>0)){const e=o.getPeriodObjectFromPeriod(s);if(void 0===e)return;this._priv_onAvailableTracksMayHaveChanged("audio"),this._priv_onAvailableTracksMayHaveChanged("text"),this._priv_onAvailableTracksMayHaveChanged("video")}}_priv_onDecipherabilityUpdate(e,t){if(null===e||null===e.manifest)return;r(null===e||void 0===e?void 0:e.tracksStore)||e.tracksStore.onDecipherabilityUpdates();const n=t.reduce((t,n)=>{var i,r,a;const s=void 0!==Re(t,e=>e[0].id===n.period.id&&e[1]===n.adaptation.type);if(!s){const s=e.tracksStore;if(null===s)return t;let o=!1;const l=s.getPeriodObjectFromPeriod(n.period);if(void 0===l)return t;switch(n.adaptation.type){case"audio":o=(null===(i=s.getChosenAudioTrack(l))||void 0===i?void 0:i.id)===n.adaptation.id;break;case"video":o=(null===(r=s.getChosenVideoTrack(l))||void 0===r?void 0:r.id)===n.adaptation.id;break;case"text":o=(null===(a=s.getChosenTextTrack(l))||void 0===a?void 0:a.id)===n.adaptation.id;break}o&&t.push([n.period,n.adaptation.type])}return t},[]);for(const[i,r]of n)this._priv_triggerEventIfNotStopped("representationListUpdate",{period:{start:i.start,end:i.end,id:i.id},trackType:r,reason:"decipherability-update"},e.currentContentCanceller.signal)}_priv_onActivePeriodChanged(e,{period:t}){var n,i,a,s,o,l;if(e.contentId!==(null===(n=this._priv_contentInfos)||void 0===n?void 0:n.contentId))return;e.currentPeriod=t;const u=e.currentContentCanceller.signal;this._priv_contentEventsMemory.periodChange!==t&&(this._priv_contentEventsMemory.periodChange=t,this._priv_triggerEventIfNotStopped("periodChange",{start:t.start,end:t.end,id:t.id},u)),this._priv_triggerEventIfNotStopped("availableAudioTracksChange",this.getAvailableAudioTracks(),u),this._priv_triggerEventIfNotStopped("availableTextTracksChange",this.getAvailableTextTracks(),u),this._priv_triggerEventIfNotStopped("availableVideoTracksChange",this.getAvailableVideoTracks(),u);const c=null===(i=this._priv_contentInfos)||void 0===i?void 0:i.tracksStore;if(r(c))this._priv_triggerEventIfNotStopped("audioTrackChange",null,u),this._priv_triggerEventIfNotStopped("textTrackChange",null,u),this._priv_triggerEventIfNotStopped("videoTrackChange",null,u);else{const e=c.getPeriodObjectFromPeriod(t);if(e){const t=c.getChosenAudioTrack(e);this._priv_triggerEventIfNotStopped("audioTrackChange",t,u);const n=c.getChosenTextTrack(e);this._priv_triggerEventIfNotStopped("textTrackChange",n,u);const i=c.getChosenVideoTrack(e);this._priv_triggerEventIfNotStopped("videoTrackChange",i,u)}}const d=null!==(s=null===(a=this.__priv_getCurrentRepresentations())||void 0===a?void 0:a.audio)&&void 0!==s?s:null;this._priv_triggerEventIfNotStopped("audioRepresentationChange",d,u);const h=null!==(l=null===(o=this.__priv_getCurrentRepresentations())||void 0===o?void 0:o.video)&&void 0!==l?l:null;this._priv_triggerEventIfNotStopped("videoRepresentationChange",h,u)}_priv_onPeriodStreamReady(e,t){var n;if(e.contentId!==(null===(n=this._priv_contentInfos)||void 0===n?void 0:n.contentId))return;const{type:i,period:a,adaptationRef:s}=t,o=e.tracksStore;switch(i){case"video":case"audio":case"text":r(o)?(j.error(`API: TracksStore not instanciated for a new ${i} period`),s.setValue(null)):o.addTrackReference(i,a,s);break;default:ge(i)}}_priv_onPeriodStreamCleared(e,t){var n;if(e.contentId!==(null===(n=this._priv_contentInfos)||void 0===n?void 0:n.contentId))return;const{type:i,period:a}=t,s=e.tracksStore;switch(i){case"audio":case"text":case"video":r(s)||s.removeTrackReference(i,a);break}const{activeAdaptations:o,activeRepresentations:l}=e;if(!r(o)&&!r(o[a.id])){const e=o[a.id];delete e[i],0===Object.keys(e).length&&delete o[a.id]}if(!r(l)&&!r(l[a.id])){const e=l[a.id];delete e[i],0===Object.keys(e).length&&delete l[a.id]}}_priv_onAdaptationChange(e,{type:t,adaptation:n,period:i}){var a;if(e.contentId!==(null===(a=this._priv_contentInfos)||void 0===a?void 0:a.contentId))return;null===e.activeAdaptations&&(e.activeAdaptations={});const{activeAdaptations:s,currentPeriod:o}=e,l=s[i.id];r(l)?s[i.id]={[t]:n}:l[t]=n;const{tracksStore:u}=e,c=e.currentContentCanceller.signal;if(null!==u&&null!==o&&!r(i)&&i.id===o.id){const e=u.getPeriodObjectFromPeriod(i);if(void 0===e)return;switch(t){case"audio":const n=u.getChosenAudioTrack(e);this._priv_triggerEventIfNotStopped("audioTrackChange",n,c);break;case"text":const i=u.getChosenTextTrack(e);this._priv_triggerEventIfNotStopped("textTrackChange",i,c);break;case"video":const r=u.getChosenVideoTrack(e);this._priv_triggerEventIfNotStopped("videoTrackChange",r,c);break}}}_priv_onRepresentationChange(e,{type:t,period:n,representation:i}){var a;if(e.contentId!==(null===(a=this._priv_contentInfos)||void 0===a?void 0:a.contentId))return;null===e.activeRepresentations&&(e.activeRepresentations={});const{activeRepresentations:s,currentPeriod:o}=e,l=s[n.id];if(r(l)?s[n.id]={[t]:i}:l[t]=i,!r(n)&&null!==o&&o.id===n.id){const e=this._priv_contentInfos.currentContentCanceller.signal;"video"===t?this._priv_triggerEventIfNotStopped("videoRepresentationChange",i,e):"audio"===t&&this._priv_triggerEventIfNotStopped("audioRepresentationChange",i,e)}}_priv_onBitrateEstimateChange({type:e,bitrate:t}){void 0!==t&&(this._priv_bitrateInfos.lastBitrates[e]=t),this.trigger("__priv_bitrateEstimateChange",{type:e,bitrate:t})}_priv_setPlayerState(e){this.state!==e&&(this.state=e,j.info("API: playerStateChange event",e),this.trigger("playerStateChange",e))}_priv_triggerPositionUpdate(e,t){var n,i;if(e.contentId!==(null===(n=this._priv_contentInfos)||void 0===n?void 0:n.contentId))return;const{isDirectFile:a,manifest:s}=e;if(!a&&null===s||r(t))return;const o=null!==s?_t(s):void 0,l={position:t.position.getPolled(),duration:t.duration,playbackRate:t.playbackRate,maximumPosition:o,bufferGap:void 0!==t.bufferGap&&isFinite(t.bufferGap)?t.bufferGap:0};if(null!==s&&s.isLive&&t.position.getPolled()>0){const e=null!==(i=s.availabilityStartTime)&&void 0!==i?i:0;l.wallClockTime=t.position.getPolled()+e;const n=Tt(s);void 0!==n&&(l.liveGap=n-t.position.getPolled())}else if(a&&null!==this.videoElement){const e=Zm(this.videoElement);void 0!==e&&(l.wallClockTime=e+t.position.getPolled())}this.trigger("positionUpdate",l)}_priv_triggerEventIfNotStopped(e,t,n){n.isCancelled()||this.trigger(e,t)}_priv_initializeMediaElementTracksStore(e){var t,n,i;fe(null!==$t.directfile,"Initializing `MediaElementTracksStore` without Directfile feature"),fe(null!==this.videoElement,"Initializing `MediaElementTracksStore` on a disposed RxPlayer");const r=new $t.directfile.mediaElementTracksStore(this.videoElement);return this._priv_triggerEventIfNotStopped("availableAudioTracksChange",r.getAvailableAudioTracks(),e),this._priv_triggerEventIfNotStopped("availableVideoTracksChange",r.getAvailableVideoTracks(),e),this._priv_triggerEventIfNotStopped("availableTextTracksChange",r.getAvailableTextTracks(),e),this._priv_triggerEventIfNotStopped("audioTrackChange",null!==(t=r.getChosenAudioTrack())&&void 0!==t?t:null,e),this._priv_triggerEventIfNotStopped("textTrackChange",null!==(n=r.getChosenTextTrack())&&void 0!==n?n:null,e),this._priv_triggerEventIfNotStopped("videoTrackChange",null!==(i=r.getChosenVideoTrack())&&void 0!==i?i:null,e),r.addEventListener("availableVideoTracksChange",e=>this.trigger("availableVideoTracksChange",e)),r.addEventListener("availableAudioTracksChange",e=>this.trigger("availableAudioTracksChange",e)),r.addEventListener("availableTextTracksChange",e=>this.trigger("availableTextTracksChange",e)),r.addEventListener("audioTrackChange",e=>this.trigger("audioTrackChange",e)),r.addEventListener("videoTrackChange",e=>this.trigger("videoTrackChange",e)),r.addEventListener("textTrackChange",e=>this.trigger("textTrackChange",e)),r}_priv_callTracksStoreGetterSetter(e,t,n){var i,r;if(null===this._priv_contentInfos||null===this._priv_contentInfos.tracksStore)return j.warn("API: Trying to call track API too soon"),t;const{tracksStore:a}=this._priv_contentInfos,s=null!==(r=null===(i=this._priv_contentInfos)||void 0===i?void 0:i.currentPeriod)&&void 0!==r?r:void 0,o=null!==e&&void 0!==e?e:null===s||void 0===s?void 0:s.id;if(void 0===o)return t;const l=o===(null===s||void 0===s?void 0:s.id)?a.getPeriodObjectFromPeriod(s):a.getPeriodObjectFromId(o);return void 0===l?t:n(a,l)}_priv_onAvailableTracksMayHaveChanged(e,t){const n=this._priv_contentInfos;if(null===n)return;const{currentPeriod:i,tracksStore:a,currentContentCanceller:s}=n,o=s.signal;if(r(i)||null===a)return;const l=null!==t&&void 0!==t?t:a.getPeriodObjectFromPeriod(i);if(void 0!==l)switch(e){case"video":const t=a.getAvailableVideoTracks(l);this._priv_triggerEventIfNotStopped("availableVideoTracksChange",null!==t&&void 0!==t?t:[],o);break;case"audio":const n=a.getAvailableAudioTracks(l);this._priv_triggerEventIfNotStopped("availableAudioTracksChange",null!==n&&void 0!==n?n:[],o);break;case"text":const i=a.getAvailableTextTracks(l);this._priv_triggerEventIfNotStopped("availableTextTracksChange",null!==i&&void 0!==i?i:[],o);break;default:ge(e)}}_priv_onFatalError(e,t){const n=ft(e,{defaultCode:"NONE",defaultReason:"An unknown error stopped content playback."});n.fatal=!0,t.currentContentCanceller.cancel(),this._priv_cleanUpCurrentContentState(),this._priv_currentError=n,j.error("API: The player stopped because of an error",n),this._priv_setPlayerState("STOPPED"),this._priv_currentError===n&&this.trigger("error",n)}}Bv._priv_currentlyUsedVideoElements=new WeakSet,Bv.version="4.1.0";var Vv=Bv,jv=Vv;u(),jv.addFeatures([Ml,Od,Wd,Hf,Vp,Zp,pg,Tg,om,bm,zm,Ym]),i()&&j.setLevel("DEBUG");t["a"]=jv;"boolean"===typeof __GLOBAL_SCOPE__&&__GLOBAL_SCOPE__&&(s["a"].RxPlayer=jv)},"133d":function(e,t,n){var i=n("6d8b"),r=n("e0d3");function a(e,t){var n,a=[],s=e.seriesIndex;if(null==s||!(n=t.getSeriesByIndex(s)))return{point:[]};var o=n.getData(),l=r.queryDataIndex(o,e);if(null==l||l<0||i.isArray(l))return{point:[]};var u=o.getItemGraphicEl(l),c=n.coordinateSystem;if(n.getTooltipPosition)a=n.getTooltipPosition(l)||[];else if(c&&c.dataToPoint)a=c.dataToPoint(o.getValues(i.map(c.dimensions,function(e){return o.mapDimension(e)}),l,!0))||[];else if(u){var d=u.getBoundingRect().clone();d.applyTransform(u.transform),a=[d.x+d.width/2,d.y+d.height/2]}return{point:a,el:u}}e.exports=a},1418:function(e,t,n){var i=n("6d8b"),r=n("a15a"),a=r.createSymbol,s=n("2306"),o=n("3842"),l=o.parsePercent,u=n("c775"),c=u.getDefaultLabel;function d(e,t,n){s.Group.call(this),this.updateData(e,t,n)}var h=d.prototype,f=d.getSymbolSize=function(e,t){var n=e.getItemVisual(t,"symbolSize");return n instanceof Array?n.slice():[+n,+n]};function p(e){return[e[0]/2,e[1]/2]}function g(e,t){this.parent.drift(e,t)}h._createSymbol=function(e,t,n,i,r){this.removeAll();var s=t.getItemVisual(n,"color"),o=a(e,-1,-1,2,2,s,r);o.attr({z2:100,culling:!0,scale:p(i)}),o.drift=g,this._symbolType=e,this.add(o)},h.stopSymbolAnimation=function(e){this.childAt(0).stopAnimation(e)},h.getSymbolPath=function(){return this.childAt(0)},h.getScale=function(){return this.childAt(0).scale},h.highlight=function(){this.childAt(0).trigger("emphasis")},h.downplay=function(){this.childAt(0).trigger("normal")},h.setZ=function(e,t){var n=this.childAt(0);n.zlevel=e,n.z=t},h.setDraggable=function(e){var t=this.childAt(0);t.draggable=e,t.cursor=e?"move":"pointer"},h.updateData=function(e,t,n){this.silent=!1;var i=e.getItemVisual(t,"symbol")||"circle",r=e.hostModel,a=f(e,t),o=i!==this._symbolType;if(o){var l=e.getItemVisual(t,"symbolKeepAspect");this._createSymbol(i,e,t,a,l)}else{var u=this.childAt(0);u.silent=!1,s.updateProps(u,{scale:p(a)},r,t)}if(this._updateCommon(e,t,a,n),o){u=this.childAt(0);var c=n&&n.fadeIn,d={scale:u.scale.slice()};c&&(d.style={opacity:u.style.opacity}),u.scale=[0,0],c&&(u.style.opacity=0),s.initProps(u,d,r,t)}this._seriesModel=r};var m=["itemStyle"],v=["emphasis","itemStyle"],y=["label"],b=["emphasis","label"];h._updateCommon=function(e,t,n,r){var a=this.childAt(0),o=e.hostModel,u=e.getItemVisual(t,"color");"image"!==a.type&&a.useStyle({strokeNoScale:!0});var d=r&&r.itemStyle,h=r&&r.hoverItemStyle,f=r&&r.symbolRotate,g=r&&r.symbolOffset,S=r&&r.labelModel,T=r&&r.hoverLabelModel,_=r&&r.hoverAnimation,w=r&&r.cursorStyle;if(!r||e.hasItemOption){var E=r&&r.itemModel?r.itemModel:e.getItemModel(t);d=E.getModel(m).getItemStyle(["color"]),h=E.getModel(v).getItemStyle(),f=E.getShallow("symbolRotate"),g=E.getShallow("symbolOffset"),S=E.getModel(y),T=E.getModel(b),_=E.getShallow("hoverAnimation"),w=E.getShallow("cursor")}else h=i.extend({},h);var x=a.style;a.attr("rotation",(f||0)*Math.PI/180||0),g&&a.attr("position",[l(g[0],n[0]),l(g[1],n[1])]),w&&a.attr("cursor",w),a.setColor(u,r&&r.symbolInnerColor),a.setStyle(d);var A=e.getItemVisual(t,"opacity");null!=A&&(x.opacity=A);var k=e.getItemVisual(t,"liftZ"),I=a.__z2Origin;null!=k?null==I&&(a.__z2Origin=a.z2,a.z2+=k):null!=I&&(a.z2=I,a.__z2Origin=null);var C=r&&r.useNameLabel;function R(t,n){return C?e.getName(t):c(e,t)}s.setLabelStyle(x,h,S,T,{labelFetcher:o,labelDataIndex:t,defaultText:R,isRectText:!0,autoColor:u}),a.off("mouseover").off("mouseout").off("emphasis").off("normal"),a.hoverStyle=h,s.setHoverStyle(a);var M=p(n);if(_&&o.isAnimationEnabled()){var D=function(){if(!this.incremental){var e=M[1]/M[0];this.animateTo({scale:[Math.max(1.1*M[0],M[0]+3),Math.max(1.1*M[1],M[1]+3*e)]},400,"elasticOut")}},L=function(){this.incremental||this.animateTo({scale:M},400,"elasticOut")};a.on("mouseover",D).on("mouseout",L).on("emphasis",D).on("normal",L)}},h.fadeOut=function(e,t){var n=this.childAt(0);this.silent=n.silent=!0,(!t||!t.keepLabel)&&(n.style.text=null),s.updateProps(n,{style:{opacity:0},scale:[0,0]},this._seriesModel,this.dataIndex,e)},i.inherits(d,s.Group);var S=d;e.exports=S},1495:function(e,t,n){var i=n("86cc"),r=n("cb7c"),a=n("0d58");e.exports=n("9e1e")?Object.defineProperties:function(e,t){r(e);var n,s=a(t),o=s.length,l=0;while(o>l)i.f(e,n=s[l++],t[n]);return e}},1548:function(e,t,n){var i=n("6d8b"),r=n("3301"),a=n("697e"),s=n("2023"),o=n("4319"),l=n("f934");l.getLayoutRect;t.getLayoutRect=l.getLayoutRect;var u=n("ee1a"),c=u.enableDataStack,d=u.isDimensionStacked,h=u.getStackedDimension,f=n("862d");t.completeDimensions=f;var p=n("b1d4");t.createDimensions=p;var g=n("a15a");function m(e){return r(e.getSource(),e)}t.createSymbol=g.createSymbol;var v={isDimensionStacked:d,enableDataStack:c,getStackedDimension:h};function y(e,t){var n=t;o.isInstance(t)||(n=new o(t),i.mixin(n,s));var r=a.createScaleByModel(n);return r.setExtent(e[0],e[1]),a.niceScaleExtent(r,n),r}function b(e){i.mixin(e,s)}t.createList=m,t.dataStack=v,t.createScale=y,t.mixinAxisModelCommonMethods=b},1687:function(e,t){var n="undefined"===typeof Float32Array?Array:Float32Array;function i(){var e=new n(6);return r(e),e}function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function s(e,t,n){var i=t[0]*n[0]+t[2]*n[1],r=t[1]*n[0]+t[3]*n[1],a=t[0]*n[2]+t[2]*n[3],s=t[1]*n[2]+t[3]*n[3],o=t[0]*n[4]+t[2]*n[5]+t[4],l=t[1]*n[4]+t[3]*n[5]+t[5];return e[0]=i,e[1]=r,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e}function o(e,t,n){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+n[0],e[5]=t[5]+n[1],e}function l(e,t,n){var i=t[0],r=t[2],a=t[4],s=t[1],o=t[3],l=t[5],u=Math.sin(n),c=Math.cos(n);return e[0]=i*c+s*u,e[1]=-i*u+s*c,e[2]=r*c+o*u,e[3]=-r*u+c*o,e[4]=c*a+u*l,e[5]=c*l-u*a,e}function u(e,t,n){var i=n[0],r=n[1];return e[0]=t[0]*i,e[1]=t[1]*r,e[2]=t[2]*i,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*r,e}function c(e,t){var n=t[0],i=t[2],r=t[4],a=t[1],s=t[3],o=t[5],l=n*s-a*i;return l?(l=1/l,e[0]=s*l,e[1]=-a*l,e[2]=-i*l,e[3]=n*l,e[4]=(i*o-s*r)*l,e[5]=(a*r-n*o)*l,e):null}function d(e){var t=i();return a(t,e),t}t.create=i,t.identity=r,t.copy=a,t.mul=s,t.translate=o,t.rotate=l,t.scale=u,t.invert=c,t.clone=d},"17b8":function(e,t,n){var i=n("3014"),r=i.extend({type:"series.bar",dependencies:["grid","polar"],brushSelector:"rect",getProgressive:function(){return!!this.get("large")&&this.get("progressive")},getProgressiveThreshold:function(){var e=this.get("progressiveThreshold"),t=this.get("largeThreshold");return t>e&&(e=t),e}});e.exports=r},"17d6":function(e,t,n){var i=n("6d8b"),r=n("22d1"),a=n("e0d3"),s=a.makeInner,o=s(),l=i.each;function u(e,t,n){if(!r.node){var i=t.getZr();o(i).records||(o(i).records={}),c(i,t);var a=o(i).records[e]||(o(i).records[e]={});a.handler=n}}function c(e,t){function n(n,i){e.on(n,function(n){var r=p(t);l(o(e).records,function(e){e&&i(e,n,r.dispatchAction)}),d(r.pendings,t)})}o(e).initialized||(o(e).initialized=!0,n("click",i.curry(f,"click")),n("mousemove",i.curry(f,"mousemove")),n("globalout",h))}function d(e,t){var n,i=e.showTip.length,r=e.hideTip.length;i?n=e.showTip[i-1]:r&&(n=e.hideTip[r-1]),n&&(n.dispatchAction=null,t.dispatchAction(n))}function h(e,t,n){e.handler("leave",null,n)}function f(e,t,n,i){t.handler(e,n,i)}function p(e){var t={showTip:[],hideTip:[]},n=function(i){var r=t[i.type];r?r.push(i):(i.dispatchAction=n,e.dispatchAction(i))};return{dispatchAction:n,pendings:t}}function g(e,t){if(!r.node){var n=t.getZr(),i=(o(n).records||{})[e];i&&(o(n).records[e]=null)}}t.register=u,t.unregister=g},"18c0":function(e,t,n){var i=n("6d8b"),r=n("e0d8"),a=n("8e43"),s=r.prototype,o=r.extend({type:"ordinal",init:function(e,t){e&&!i.isArray(e)||(e=new a({categories:e})),this._ordinalMeta=e,this._extent=t||[0,e.categories.length-1]},parse:function(e){return"string"===typeof e?this._ordinalMeta.getOrdinal(e):Math.round(e)},contain:function(e){return e=this.parse(e),s.contain.call(this,e)&&null!=this._ordinalMeta.categories[e]},normalize:function(e){return s.normalize.call(this,this.parse(e))},scale:function(e){return Math.round(s.scale.call(this,e))},getTicks:function(){var e=[],t=this._extent,n=t[0];while(n<=t[1])e.push(n),n++;return e},getLabel:function(e){if(!this.isBlank())return this._ordinalMeta.categories[e]},count:function(){return this._extent[1]-this._extent[0]+1},unionExtentFromData:function(e,t){this.unionExtent(e.getApproximateExtent(t))},getOrdinalMeta:function(){return this._ordinalMeta},niceTicks:i.noop,niceExtent:i.noop});o.create=function(){return new o};var l=o;e.exports=l},1991:function(e,t,n){var i,r,a,s=n("9b43"),o=n("31f4"),l=n("fab2"),u=n("230e"),c=n("7726"),d=c.process,h=c.setImmediate,f=c.clearImmediate,p=c.MessageChannel,g=c.Dispatch,m=0,v={},y="onreadystatechange",b=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},S=function(e){b.call(e.data)};h&&f||(h=function(e){var t=[],n=1;while(arguments.length>n)t.push(arguments[n++]);return v[++m]=function(){o("function"==typeof e?e:Function(e),t)},i(m),m},f=function(e){delete v[e]},"process"==n("2d95")(d)?i=function(e){d.nextTick(s(b,e,1))}:g&&g.now?i=function(e){g.now(s(b,e,1))}:p?(r=new p,a=r.port2,r.port1.onmessage=S,i=s(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(i=function(e){c.postMessage(e+"","*")},c.addEventListener("message",S,!1)):i=y in u("script")?function(e){l.appendChild(u("script"))[y]=function(){l.removeChild(this),b.call(e)}}:function(e){setTimeout(s(b,e,1),0)}),e.exports={set:h,clear:f}},"19eb":function(e,t,n){var i=n("6d8b"),r=n("2b61"),a=n("d5b7"),s=n("9e2e");function o(e){for(var t in e=e||{},a.call(this,e),e)e.hasOwnProperty(t)&&"style"!==t&&(this[t]=e[t]);this.style=new r(e.style,this),this._rect=null,this.__clipPaths=[]}o.prototype={constructor:o,type:"displayable",__dirty:!0,invisible:!1,z:0,z2:0,zlevel:0,draggable:!1,dragging:!1,silent:!1,culling:!1,cursor:"pointer",rectHover:!1,progressive:!1,incremental:!1,inplace:!1,beforeBrush:function(e){},afterBrush:function(e){},brush:function(e,t){},getBoundingRect:function(){},contain:function(e,t){return this.rectContain(e,t)},traverse:function(e,t){e.call(t,this)},rectContain:function(e,t){var n=this.transformCoordToLocal(e,t),i=this.getBoundingRect();return i.contain(n[0],n[1])},dirty:function(){this.__dirty=!0,this._rect=null,this.__zr&&this.__zr.refresh()},animateStyle:function(e){return this.animate("style",e)},attrKV:function(e,t){"style"!==e?a.prototype.attrKV.call(this,e,t):this.style.set(t)},setStyle:function(e,t){return this.style.set(e,t),this.dirty(!1),this},useStyle:function(e){return this.style=new r(e,this),this.dirty(!1),this}},i.inherits(o,a),i.mixin(o,s);var l=o;e.exports=l},"1fa8":function(e,t,n){var i=n("cb7c");e.exports=function(e,t,n,r){try{return r?t(i(n)[0],n[1]):t(n)}catch(t){var a=e["return"];throw void 0!==a&&i(a.call(e)),t}}},"1fab":function(e,t){var n=Array.prototype.slice,i=function(){this._$handlers={}};i.prototype={constructor:i,one:function(e,t,n){var i=this._$handlers;if(!t||!e)return this;i[e]||(i[e]=[]);for(var r=0;r<i[e].length;r++)if(i[e][r].h===t)return this;return i[e].push({h:t,one:!0,ctx:n||this}),this},on:function(e,t,n){var i=this._$handlers;if(!t||!e)return this;i[e]||(i[e]=[]);for(var r=0;r<i[e].length;r++)if(i[e][r].h===t)return this;return i[e].push({h:t,one:!1,ctx:n||this}),this},isSilent:function(e){var t=this._$handlers;return t[e]&&t[e].length},off:function(e,t){var n=this._$handlers;if(!e)return this._$handlers={},this;if(t){if(n[e]){for(var i=[],r=0,a=n[e].length;r<a;r++)n[e][r]["h"]!=t&&i.push(n[e][r]);n[e]=i}n[e]&&0===n[e].length&&delete n[e]}else delete n[e];return this},trigger:function(e){if(this._$handlers[e]){var t=arguments,i=t.length;i>3&&(t=n.call(t,1));for(var r=this._$handlers[e],a=r.length,s=0;s<a;){switch(i){case 1:r[s]["h"].call(r[s]["ctx"]);break;case 2:r[s]["h"].call(r[s]["ctx"],t[1]);break;case 3:r[s]["h"].call(r[s]["ctx"],t[1],t[2]);break;default:r[s]["h"].apply(r[s]["ctx"],t);break}r[s]["one"]?(r.splice(s,1),a--):s++}}return this},triggerWithContext:function(e){if(this._$handlers[e]){var t=arguments,i=t.length;i>4&&(t=n.call(t,1,t.length-1));for(var r=t[t.length-1],a=this._$handlers[e],s=a.length,o=0;o<s;){switch(i){case 1:a[o]["h"].call(r);break;case 2:a[o]["h"].call(r,t[1]);break;case 3:a[o]["h"].call(r,t[1],t[2]);break;default:a[o]["h"].apply(r,t);break}a[o]["one"]?(a.splice(o,1),s--):o++}}return this}};var r=i;e.exports=r},2023:function(e,t,n){var i=n("6d8b"),r=(n("697e"),{getMin:function(e){var t=this.option,n=e||null==t.rangeStart?t.min:t.rangeStart;return this.axis&&null!=n&&"dataMin"!==n&&"function"!==typeof n&&!i.eqNaN(n)&&(n=this.axis.scale.parse(n)),n},getMax:function(e){var t=this.option,n=e||null==t.rangeEnd?t.max:t.rangeEnd;return this.axis&&null!=n&&"dataMax"!==n&&"function"!==typeof n&&!i.eqNaN(n)&&(n=this.axis.scale.parse(n)),n},getNeedCrossZero:function(){var e=this.option;return null==e.rangeStart&&null==e.rangeEnd&&!e.scale},getCoordSysModel:i.noop,setRange:function(e,t){this.option.rangeStart=e,this.option.rangeEnd=t},resetRange:function(){this.option.rangeStart=this.option.rangeEnd=null}});e.exports=r},2039:function(e,t,n){var i=n("6d8b"),r={};function a(){this._coordinateSystems=[]}a.prototype={constructor:a,create:function(e,t){var n=[];i.each(r,function(i,r){var a=i.create(e,t);n=n.concat(a||[])}),this._coordinateSystems=n},update:function(e,t){i.each(this._coordinateSystems,function(n){n.update&&n.update(e,t)})},getCoordinateSystems:function(){return this._coordinateSystems.slice()}},a.register=function(e,t){r[e]=t},a.get=function(e){return r[e]};var s=a;e.exports=s},"20c8":function(e,t,n){var i=n("4a3f"),r=n("401b"),a=n("e263"),s=n("9850"),o=n("2cf4"),l=o.devicePixelRatio,u={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},c=[],d=[],h=[],f=[],p=Math.min,g=Math.max,m=Math.cos,v=Math.sin,y=Math.sqrt,b=Math.abs,S="undefined"!=typeof Float32Array,T=function(e){this._saveData=!e,this._saveData&&(this.data=[]),this._ctx=null};T.prototype={constructor:T,_xi:0,_yi:0,_x0:0,_y0:0,_ux:0,_uy:0,_len:0,_lineDash:null,_dashOffset:0,_dashIdx:0,_dashSum:0,setScale:function(e,t){this._ux=b(1/l/e)||0,this._uy=b(1/l/t)||0},getContext:function(){return this._ctx},beginPath:function(e){return this._ctx=e,e&&e.beginPath(),e&&(this.dpr=e.dpr),this._saveData&&(this._len=0),this._lineDash&&(this._lineDash=null,this._dashOffset=0),this},moveTo:function(e,t){return this.addData(u.M,e,t),this._ctx&&this._ctx.moveTo(e,t),this._x0=e,this._y0=t,this._xi=e,this._yi=t,this},lineTo:function(e,t){var n=b(e-this._xi)>this._ux||b(t-this._yi)>this._uy||this._len<5;return this.addData(u.L,e,t),this._ctx&&n&&(this._needsDash()?this._dashedLineTo(e,t):this._ctx.lineTo(e,t)),n&&(this._xi=e,this._yi=t),this},bezierCurveTo:function(e,t,n,i,r,a){return this.addData(u.C,e,t,n,i,r,a),this._ctx&&(this._needsDash()?this._dashedBezierTo(e,t,n,i,r,a):this._ctx.bezierCurveTo(e,t,n,i,r,a)),this._xi=r,this._yi=a,this},quadraticCurveTo:function(e,t,n,i){return this.addData(u.Q,e,t,n,i),this._ctx&&(this._needsDash()?this._dashedQuadraticTo(e,t,n,i):this._ctx.quadraticCurveTo(e,t,n,i)),this._xi=n,this._yi=i,this},arc:function(e,t,n,i,r,a){return this.addData(u.A,e,t,n,n,i,r-i,0,a?0:1),this._ctx&&this._ctx.arc(e,t,n,i,r,a),this._xi=m(r)*n+e,this._yi=v(r)*n+e,this},arcTo:function(e,t,n,i,r){return this._ctx&&this._ctx.arcTo(e,t,n,i,r),this},rect:function(e,t,n,i){return this._ctx&&this._ctx.rect(e,t,n,i),this.addData(u.R,e,t,n,i),this},closePath:function(){this.addData(u.Z);var e=this._ctx,t=this._x0,n=this._y0;return e&&(this._needsDash()&&this._dashedLineTo(t,n),e.closePath()),this._xi=t,this._yi=n,this},fill:function(e){e&&e.fill(),this.toStatic()},stroke:function(e){e&&e.stroke(),this.toStatic()},setLineDash:function(e){if(e instanceof Array){this._lineDash=e,this._dashIdx=0;for(var t=0,n=0;n<e.length;n++)t+=e[n];this._dashSum=t}return this},setLineDashOffset:function(e){return this._dashOffset=e,this},len:function(){return this._len},setData:function(e){var t=e.length;this.data&&this.data.length==t||!S||(this.data=new Float32Array(t));for(var n=0;n<t;n++)this.data[n]=e[n];this._len=t},appendPath:function(e){e instanceof Array||(e=[e]);for(var t=e.length,n=0,i=this._len,r=0;r<t;r++)n+=e[r].len();S&&this.data instanceof Float32Array&&(this.data=new Float32Array(i+n));for(r=0;r<t;r++)for(var a=e[r].data,s=0;s<a.length;s++)this.data[i++]=a[s];this._len=i},addData:function(e){if(this._saveData){var t=this.data;this._len+arguments.length>t.length&&(this._expandData(),t=this.data);for(var n=0;n<arguments.length;n++)t[this._len++]=arguments[n];this._prevCmd=e}},_expandData:function(){if(!(this.data instanceof Array)){for(var e=[],t=0;t<this._len;t++)e[t]=this.data[t];this.data=e}},_needsDash:function(){return this._lineDash},_dashedLineTo:function(e,t){var n,i,r=this._dashSum,a=this._dashOffset,s=this._lineDash,o=this._ctx,l=this._xi,u=this._yi,c=e-l,d=t-u,h=y(c*c+d*d),f=l,m=u,v=s.length;c/=h,d/=h,a<0&&(a=r+a),a%=r,f-=a*c,m-=a*d;while(c>0&&f<=e||c<0&&f>=e||0==c&&(d>0&&m<=t||d<0&&m>=t))i=this._dashIdx,n=s[i],f+=c*n,m+=d*n,this._dashIdx=(i+1)%v,c>0&&f<l||c<0&&f>l||d>0&&m<u||d<0&&m>u||o[i%2?"moveTo":"lineTo"](c>=0?p(f,e):g(f,e),d>=0?p(m,t):g(m,t));c=f-e,d=m-t,this._dashOffset=-y(c*c+d*d)},_dashedBezierTo:function(e,t,n,r,a,s){var o,l,u,c,d,h=this._dashSum,f=this._dashOffset,p=this._lineDash,g=this._ctx,m=this._xi,v=this._yi,b=i.cubicAt,S=0,T=this._dashIdx,_=p.length,w=0;for(f<0&&(f=h+f),f%=h,o=0;o<1;o+=.1)l=b(m,e,n,a,o+.1)-b(m,e,n,a,o),u=b(v,t,r,s,o+.1)-b(v,t,r,s,o),S+=y(l*l+u*u);for(;T<_;T++)if(w+=p[T],w>f)break;o=(w-f)/S;while(o<=1)c=b(m,e,n,a,o),d=b(v,t,r,s,o),T%2?g.moveTo(c,d):g.lineTo(c,d),o+=p[T]/S,T=(T+1)%_;T%2!==0&&g.lineTo(a,s),l=a-c,u=s-d,this._dashOffset=-y(l*l+u*u)},_dashedQuadraticTo:function(e,t,n,i){var r=n,a=i;n=(n+2*e)/3,i=(i+2*t)/3,e=(this._xi+2*e)/3,t=(this._yi+2*t)/3,this._dashedBezierTo(e,t,n,i,r,a)},toStatic:function(){var e=this.data;e instanceof Array&&(e.length=this._len,S&&(this.data=new Float32Array(e)))},getBoundingRect:function(){c[0]=c[1]=h[0]=h[1]=Number.MAX_VALUE,d[0]=d[1]=f[0]=f[1]=-Number.MAX_VALUE;for(var e=this.data,t=0,n=0,i=0,o=0,l=0;l<e.length;){var p=e[l++];switch(1==l&&(t=e[l],n=e[l+1],i=t,o=n),p){case u.M:i=e[l++],o=e[l++],t=i,n=o,h[0]=i,h[1]=o,f[0]=i,f[1]=o;break;case u.L:a.fromLine(t,n,e[l],e[l+1],h,f),t=e[l++],n=e[l++];break;case u.C:a.fromCubic(t,n,e[l++],e[l++],e[l++],e[l++],e[l],e[l+1],h,f),t=e[l++],n=e[l++];break;case u.Q:a.fromQuadratic(t,n,e[l++],e[l++],e[l],e[l+1],h,f),t=e[l++],n=e[l++];break;case u.A:var g=e[l++],y=e[l++],b=e[l++],S=e[l++],T=e[l++],_=e[l++]+T,w=(e[l++],1-e[l++]);1==l&&(i=m(T)*b+g,o=v(T)*S+y),a.fromArc(g,y,b,S,T,_,w,h,f),t=m(_)*b+g,n=v(_)*S+y;break;case u.R:i=t=e[l++],o=n=e[l++];var E=e[l++],x=e[l++];a.fromLine(i,o,i+E,o+x,h,f);break;case u.Z:t=i,n=o;break}r.min(c,c,h),r.max(d,d,f)}return 0===l&&(c[0]=c[1]=d[0]=d[1]=0),new s(c[0],c[1],d[0]-c[0],d[1]-c[1])},rebuildPath:function(e){for(var t,n,i,r,a,s,o=this.data,l=this._ux,c=this._uy,d=this._len,h=0;h<d;){var f=o[h++];switch(1==h&&(i=o[h],r=o[h+1],t=i,n=r),f){case u.M:t=i=o[h++],n=r=o[h++],e.moveTo(i,r);break;case u.L:a=o[h++],s=o[h++],(b(a-i)>l||b(s-r)>c||h===d-1)&&(e.lineTo(a,s),i=a,r=s);break;case u.C:e.bezierCurveTo(o[h++],o[h++],o[h++],o[h++],o[h++],o[h++]),i=o[h-2],r=o[h-1];break;case u.Q:e.quadraticCurveTo(o[h++],o[h++],o[h++],o[h++]),i=o[h-2],r=o[h-1];break;case u.A:var p=o[h++],g=o[h++],y=o[h++],S=o[h++],T=o[h++],_=o[h++],w=o[h++],E=o[h++],x=y>S?y:S,A=y>S?1:y/S,k=y>S?S/y:1,I=Math.abs(y-S)>.001,C=T+_;I?(e.translate(p,g),e.rotate(w),e.scale(A,k),e.arc(0,0,x,T,C,1-E),e.scale(1/A,1/k),e.rotate(-w),e.translate(-p,-g)):e.arc(p,g,x,T,C,1-E),1==h&&(t=m(T)*y+p,n=v(T)*S+g),i=m(C)*y+p,r=v(C)*S+g;break;case u.R:t=i=o[h],n=r=o[h+1],e.rect(o[h++],o[h++],o[h++],o[h++]);break;case u.Z:e.closePath(),i=t,r=n}}}},T.CMD=u;var _=T;e.exports=_},2145:function(e,t){var n={};function i(e,t){n[e]=t}function r(e){return n[e]}t.register=i,t.get=r},"214f":function(e,t,n){"use strict";var i=n("32e9"),r=n("2aba"),a=n("79e5"),s=n("be13"),o=n("2b4c");e.exports=function(e,t,n){var l=o(e),u=n(s,l,""[e]),c=u[0],d=u[1];a(function(){var t={};return t[l]=function(){return 7},7!=""[e](t)})&&(r(String.prototype,e,c),i(RegExp.prototype,l,2==t?function(e,t){return d.call(e,this,t)}:function(e){return d.call(e,this)}))}},"216a":function(e,t,n){var i=n("6d8b"),r=n("3842"),a=n("eda2"),s=n("944e"),o=n("89e3"),l=o.prototype,u=Math.ceil,c=Math.floor,d=1e3,h=60*d,f=60*h,p=24*f,g=function(e,t,n,i){while(n<i){var r=n+i>>>1;e[r][1]<t?n=r+1:i=r}return n},m=o.extend({type:"time",getLabel:function(e){var t=this._stepLvl,n=new Date(e);return a.formatTime(t[0],n,this.getSetting("useUTC"))},niceExtent:function(e){var t=this._extent;if(t[0]===t[1]&&(t[0]-=p,t[1]+=p),t[1]===-1/0&&t[0]===1/0){var n=new Date;t[1]=+new Date(n.getFullYear(),n.getMonth(),n.getDate()),t[0]=t[1]-p}this.niceTicks(e.splitNumber,e.minInterval,e.maxInterval);var i=this._interval;e.fixMin||(t[0]=r.round(c(t[0]/i)*i)),e.fixMax||(t[1]=r.round(u(t[1]/i)*i))},niceTicks:function(e,t,n){e=e||10;var i=this._extent,a=i[1]-i[0],o=a/e;null!=t&&o<t&&(o=t),null!=n&&o>n&&(o=n);var l=v.length,d=g(v,o,0,l),h=v[Math.min(d,l-1)],f=h[1];if("year"===h[0]){var p=a/f,m=r.nice(p/e,!0);f*=m}var y=this.getSetting("useUTC")?0:60*new Date(+i[0]||+i[1]).getTimezoneOffset()*1e3,b=[Math.round(u((i[0]-y)/f)*f+y),Math.round(c((i[1]-y)/f)*f+y)];s.fixExtent(b,i),this._stepLvl=h,this._interval=f,this._niceExtent=b},parse:function(e){return+r.parseDate(e)}});i.each(["contain","normalize"],function(e){m.prototype[e]=function(t){return l[e].call(this,this.parse(t))}});var v=[["hh:mm:ss",d],["hh:mm:ss",5*d],["hh:mm:ss",10*d],["hh:mm:ss",15*d],["hh:mm:ss",30*d],["hh:mm\nMM-dd",h],["hh:mm\nMM-dd",5*h],["hh:mm\nMM-dd",10*h],["hh:mm\nMM-dd",15*h],["hh:mm\nMM-dd",30*h],["hh:mm\nMM-dd",f],["hh:mm\nMM-dd",2*f],["hh:mm\nMM-dd",6*f],["hh:mm\nMM-dd",12*f],["MM-dd\nyyyy",p],["MM-dd\nyyyy",2*p],["MM-dd\nyyyy",3*p],["MM-dd\nyyyy",4*p],["MM-dd\nyyyy",5*p],["MM-dd\nyyyy",6*p],["week",7*p],["MM-dd\nyyyy",10*p],["week",14*p],["week",21*p],["month",31*p],["week",42*p],["month",62*p],["week",42*p],["quarter",380*p/4],["month",31*p*4],["month",31*p*5],["half-year",380*p/2],["month",31*p*8],["month",31*p*10],["year",380*p]];m.create=function(e){return new m({useUTC:e.ecModel.get("useUTC")})};var y=m;e.exports=y},"217b":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("3301")),a=n("4f85"),s=a.extend({type:"series.line",dependencies:["grid","polar"],getInitialData:function(e,t){return r(this.getSource(),this)},defaultOption:{zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,hoverAnimation:!0,clipOverflow:!0,label:{position:"top"},lineStyle:{width:2,type:"solid"},step:!1,smooth:!1,smoothMonotone:null,symbol:"emptyCircle",symbolSize:4,symbolRotate:null,showSymbol:!0,showAllSymbol:"auto",connectNulls:!1,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:1/0}});e.exports=s},"22d1":function(e,t){var n={};n="object"===typeof wx&&"function"===typeof wx.getSystemInfoSync?{browser:{},os:{},node:!1,wxa:!0,canvasSupported:!0,svgSupported:!1,touchEventsSupported:!0}:"undefined"===typeof document&&"undefined"!==typeof self?{browser:{},os:{},node:!1,worker:!0,canvasSupported:!0}:"undefined"===typeof navigator?{browser:{},os:{},node:!0,worker:!1,canvasSupported:!0,svgSupported:!0}:r(navigator.userAgent);var i=n;function r(e){var t={},n={},i=e.match(/Firefox\/([\d.]+)/),r=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/.+?rv:(([\d.]+))/),a=e.match(/Edge\/([\d.]+)/),s=/micromessenger/i.test(e);return i&&(n.firefox=!0,n.version=i[1]),r&&(n.ie=!0,n.version=r[1]),a&&(n.edge=!0,n.version=a[1]),s&&(n.weChat=!0),{browser:n,os:t,node:!1,canvasSupported:!!document.createElement("canvas").getContext,svgSupported:"undefined"!==typeof SVGRect,touchEventsSupported:"ontouchstart"in window&&!n.ie&&!n.edge,pointerEventsSupported:"onpointerdown"in window&&(n.edge||n.ie&&n.version>=11)}}e.exports=i},2306:function(e,t,n){var i=n("6d8b"),r=n("342d"),a=n("41ef"),s=n("1687"),o=n("401b"),l=n("cbe5"),u=n("0cde"),c=n("0da8");t.Image=c;var d=n("e1fc");t.Group=d;var h=n("76a5");t.Text=h;var f=n("d9fc");t.Circle=f;var p=n("4aa2");t.Sector=p;var g=n("4573");t.Ring=g;var m=n("87b1");t.Polygon=m;var v=n("d498");t.Polyline=v;var y=n("c7a2");t.Rect=y;var b=n("cb11");t.Line=b;var S=n("ac0f");t.BezierCurve=S;var T=n("8d32");t.Arc=T;var _=n("d4c6");t.CompoundPath=_;var w=n("48a9");t.LinearGradient=w;var E=n("dded");t.RadialGradient=E;var x=n("9850");t.BoundingRect=x;var A=n("392f");t.IncrementalDisplayable=A;var k=Math.round,I=Math.max,C=Math.min,R={};function M(e){return l.extend(e)}function D(e,t){return r.extendFromString(e,t)}function L(e,t,n,i){var a=r.createFromString(e,t),s=a.getBoundingRect();return n&&("center"===i&&(n=O(n,s)),U(a,n)),a}function P(e,t,n){var i=new c({style:{image:e,x:t.x,y:t.y,width:t.width,height:t.height},onload:function(e){if("center"===n){var r={width:e.width,height:e.height};i.setStyle(O(t,r))}}});return i}function O(e,t){var n,i=t.width/t.height,r=e.height*i;r<=e.width?n=e.height:(r=e.width,n=r/i);var a=e.x+e.width/2,s=e.y+e.height/2;return{x:a-r/2,y:s-n/2,width:r,height:n}}var N=r.mergePath;function U(e,t){if(e.applyTransform){var n=e.getBoundingRect(),i=n.calculateTransform(t);e.applyTransform(i)}}function F(e){var t=e.shape,n=e.style.lineWidth;return k(2*t.x1)===k(2*t.x2)&&(t.x1=t.x2=V(t.x1,n,!0)),k(2*t.y1)===k(2*t.y2)&&(t.y1=t.y2=V(t.y1,n,!0)),e}function B(e){var t=e.shape,n=e.style.lineWidth,i=t.x,r=t.y,a=t.width,s=t.height;return t.x=V(t.x,n,!0),t.y=V(t.y,n,!0),t.width=Math.max(V(i+a,n,!1)-t.x,0===a?0:1),t.height=Math.max(V(r+s,n,!1)-t.y,0===s?0:1),e}function V(e,t,n){var i=k(2*e);return(i+k(t))%2===0?i/2:(i+(n?1:-1))/2}function j(e){return null!=e&&"none"!=e}function G(e){return"string"===typeof e?a.lift(e,-.1):e}function H(e){if(e.__hoverStlDirty){var t=e.style.stroke,n=e.style.fill,i=e.__hoverStl;i.fill=i.fill||(j(n)?G(n):null),i.stroke=i.stroke||(j(t)?G(t):null);var r={};for(var a in i)null!=i[a]&&(r[a]=e.style[a]);e.__normalStl=r,e.__hoverStlDirty=!1}}function z(e){if(!e.__isHover){if(H(e),e.useHoverLayer)e.__zr&&e.__zr.addHover(e,e.__hoverStl);else{var t=e.style,n=t.insideRollbackOpt;n&&le(t),t.extendFrom(e.__hoverStl),n&&(oe(t,t.insideOriginalTextPosition,n),null==t.textFill&&(t.textFill=n.autoColor)),e.dirty(!1),e.z2+=1}e.__isHover=!0}}function K(e){if(e.__isHover){var t=e.__normalStl;e.useHoverLayer?e.__zr&&e.__zr.removeHover(e):(t&&e.setStyle(t),e.z2-=1),e.__isHover=!1}}function $(e){"group"===e.type?e.traverse(function(e){"group"!==e.type&&z(e)}):z(e)}function W(e){"group"===e.type?e.traverse(function(e){"group"!==e.type&&K(e)}):K(e)}function q(e,t){e.__hoverStl=e.hoverStyle||t||{},e.__hoverStlDirty=!0,e.__isHover&&H(e)}function Y(e){this.__hoverSilentOnTouch&&e.zrByTouch||!this.__isEmphasis&&$(this)}function X(e){this.__hoverSilentOnTouch&&e.zrByTouch||!this.__isEmphasis&&W(this)}function Q(){this.__isEmphasis=!0,$(this)}function Z(){this.__isEmphasis=!1,W(this)}function J(e,t,n){e.__hoverSilentOnTouch=n&&n.hoverSilentOnTouch,"group"===e.type?e.traverse(function(e){"group"!==e.type&&q(e,t)}):q(e,t),e.on("mouseover",Y).on("mouseout",X),e.on("emphasis",Q).on("normal",Z)}function ee(e,t,n,r,a,s,o){a=a||R;var l,u=a.labelFetcher,c=a.labelDataIndex,d=a.labelDimIndex,h=n.getShallow("show"),f=r.getShallow("show");(h||f)&&(u&&(l=u.getFormattedLabel(c,"normal",null,d)),null==l&&(l=i.isFunction(a.defaultText)?a.defaultText(c,a):a.defaultText));var p=h?l:null,g=f?i.retrieve2(u?u.getFormattedLabel(c,"emphasis",null,d):null,l):null;null==p&&null==g||(te(e,n,s,a),te(t,r,o,a,!0)),e.text=p,t.text=g}function te(e,t,n,r,a){return ie(e,t,r,a),n&&i.extend(e,n),e.host&&e.host.dirty&&e.host.dirty(!1),e}function ne(e,t,n){var i,r={isRectText:!0};!1===n?i=!0:r.autoColor=n,ie(e,t,r,i),e.host&&e.host.dirty&&e.host.dirty(!1)}function ie(e,t,n,r){if(n=n||R,n.isRectText){var a=t.getShallow("position")||(r?null:"inside");"outside"===a&&(a="top"),e.textPosition=a,e.textOffset=t.getShallow("offset");var s=t.getShallow("rotate");null!=s&&(s*=Math.PI/180),e.textRotation=s,e.textDistance=i.retrieve2(t.getShallow("distance"),r?null:5)}var o,l=t.ecModel,u=l&&l.option.textStyle,c=re(t);if(c)for(var d in o={},c)if(c.hasOwnProperty(d)){var h=t.getModel(["rich",d]);ae(o[d]={},h,u,n,r)}return e.rich=o,ae(e,t,u,n,r,!0),n.forceRich&&!n.textStyle&&(n.textStyle={}),e}function re(e){var t;while(e&&e!==e.ecModel){var n=(e.option||R).rich;if(n)for(var i in t=t||{},n)n.hasOwnProperty(i)&&(t[i]=1);e=e.parentModel}return t}function ae(e,t,n,r,a,s){if(n=!a&&n||R,e.textFill=se(t.getShallow("color"),r)||n.color,e.textStroke=se(t.getShallow("textBorderColor"),r)||n.textBorderColor,e.textStrokeWidth=i.retrieve2(t.getShallow("textBorderWidth"),n.textBorderWidth),!a){if(s){var o=e.textPosition;e.insideRollback=oe(e,o,r),e.insideOriginalTextPosition=o,e.insideRollbackOpt=r}null==e.textFill&&(e.textFill=r.autoColor)}e.fontStyle=t.getShallow("fontStyle")||n.fontStyle,e.fontWeight=t.getShallow("fontWeight")||n.fontWeight,e.fontSize=t.getShallow("fontSize")||n.fontSize,e.fontFamily=t.getShallow("fontFamily")||n.fontFamily,e.textAlign=t.getShallow("align"),e.textVerticalAlign=t.getShallow("verticalAlign")||t.getShallow("baseline"),e.textLineHeight=t.getShallow("lineHeight"),e.textWidth=t.getShallow("width"),e.textHeight=t.getShallow("height"),e.textTag=t.getShallow("tag"),s&&r.disableBox||(e.textBackgroundColor=se(t.getShallow("backgroundColor"),r),e.textPadding=t.getShallow("padding"),e.textBorderColor=se(t.getShallow("borderColor"),r),e.textBorderWidth=t.getShallow("borderWidth"),e.textBorderRadius=t.getShallow("borderRadius"),e.textBoxShadowColor=t.getShallow("shadowColor"),e.textBoxShadowBlur=t.getShallow("shadowBlur"),e.textBoxShadowOffsetX=t.getShallow("shadowOffsetX"),e.textBoxShadowOffsetY=t.getShallow("shadowOffsetY")),e.textShadowColor=t.getShallow("textShadowColor")||n.textShadowColor,e.textShadowBlur=t.getShallow("textShadowBlur")||n.textShadowBlur,e.textShadowOffsetX=t.getShallow("textShadowOffsetX")||n.textShadowOffsetX,e.textShadowOffsetY=t.getShallow("textShadowOffsetY")||n.textShadowOffsetY}function se(e,t){return"auto"!==e?e:t&&t.autoColor?t.autoColor:null}function oe(e,t,n){var i,r=n.useInsideStyle;return null==e.textFill&&!1!==r&&(!0===r||n.isRectText&&t&&"string"===typeof t&&t.indexOf("inside")>=0)&&(i={textFill:null,textStroke:e.textStroke,textStrokeWidth:e.textStrokeWidth},e.textFill="#fff",null==e.textStroke&&(e.textStroke=n.autoColor,null==e.textStrokeWidth&&(e.textStrokeWidth=2))),i}function le(e){var t=e.insideRollback;t&&(e.textFill=t.textFill,e.textStroke=t.textStroke,e.textStrokeWidth=t.textStrokeWidth)}function ue(e,t){var n=t||t.getModel("textStyle");return i.trim([e.fontStyle||n&&n.getShallow("fontStyle")||"",e.fontWeight||n&&n.getShallow("fontWeight")||"",(e.fontSize||n&&n.getShallow("fontSize")||12)+"px",e.fontFamily||n&&n.getShallow("fontFamily")||"sans-serif"].join(" "))}function ce(e,t,n,i,r,a){"function"===typeof r&&(a=r,r=null);var s=i&&i.isAnimationEnabled();if(s){var o=e?"Update":"",l=i.getShallow("animationDuration"+o),u=i.getShallow("animationEasing"+o),c=i.getShallow("animationDelay"+o);"function"===typeof c&&(c=c(r,i.getAnimationDelayParams?i.getAnimationDelayParams(t,r):null)),"function"===typeof l&&(l=l(r)),l>0?t.animateTo(n,l,c||0,u,a,!!a):(t.stopAnimation(),t.attr(n),a&&a())}else t.stopAnimation(),t.attr(n),a&&a()}function de(e,t,n,i,r){ce(!0,e,t,n,i,r)}function he(e,t,n,i,r){ce(!1,e,t,n,i,r)}function fe(e,t){var n=s.identity([]);while(e&&e!==t)s.mul(n,e.getLocalTransform(),n),e=e.parent;return n}function pe(e,t,n){return t&&!i.isArrayLike(t)&&(t=u.getLocalTransform(t)),n&&(t=s.invert([],t)),o.applyTransform([],e,t)}function ge(e,t,n){var i=0===t[4]||0===t[5]||0===t[0]?1:Math.abs(2*t[4]/t[0]),r=0===t[4]||0===t[5]||0===t[2]?1:Math.abs(2*t[4]/t[2]),a=["left"===e?-i:"right"===e?i:0,"top"===e?-r:"bottom"===e?r:0];return a=pe(a,t,n),Math.abs(a[0])>Math.abs(a[1])?a[0]>0?"right":"left":a[1]>0?"bottom":"top"}function me(e,t,n,r){if(e&&t){var a=s(e);t.traverse(function(e){if(!e.isGroup&&e.anid){var t=a[e.anid];if(t){var i=l(e);e.attr(l(t)),de(e,i,n,e.dataIndex)}}})}function s(e){var t={};return e.traverse(function(e){!e.isGroup&&e.anid&&(t[e.anid]=e)}),t}function l(e){var t={position:o.clone(e.position),rotation:e.rotation};return e.shape&&(t.shape=i.extend({},e.shape)),t}}function ve(e,t){return i.map(e,function(e){var n=e[0];n=I(n,t.x),n=C(n,t.x+t.width);var i=e[1];return i=I(i,t.y),i=C(i,t.y+t.height),[n,i]})}function ye(e,t){var n=I(e.x,t.x),i=C(e.x+e.width,t.x+t.width),r=I(e.y,t.y),a=C(e.y+e.height,t.y+t.height);if(i>=n&&a>=r)return{x:n,y:r,width:i-n,height:a-r}}function be(e,t,n){t=i.extend({rectHover:!0},t);var r=t.style={strokeNoScale:!0};if(n=n||{x:-1,y:-1,width:2,height:2},e)return 0===e.indexOf("image://")?(r.image=e.slice(8),i.defaults(r,n),new c(t)):L(e.replace("path://",""),t,n,"center")}t.extendShape=M,t.extendPath=D,t.makePath=L,t.makeImage=P,t.mergePath=N,t.resizePath=U,t.subPixelOptimizeLine=F,t.subPixelOptimizeRect=B,t.subPixelOptimize=V,t.setHoverStyle=J,t.setLabelStyle=ee,t.setTextStyle=te,t.setText=ne,t.getFont=ue,t.updateProps=de,t.initProps=he,t.getTransform=fe,t.applyTransform=pe,t.transformDirection=ge,t.groupTransition=me,t.clipPointsByRect=ve,t.clipRectByRect=ye,t.createIcon=be},"230e":function(e,t,n){var i=n("d3f4"),r=n("7726").document,a=i(r)&&i(r.createElement);e.exports=function(e){return a?r.createElement(e):{}}},"23c6":function(e,t,n){var i=n("2d95"),r=n("2b4c")("toStringTag"),a="Arguments"==i(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=Object(e),r))?n:a?i(t):"Object"==(o=i(t))&&"function"==typeof t.callee?"Arguments":o}},"26e1":function(e,t,n){var i=n("6d8b"),r=n("e0d3"),a=i.each,s=i.isObject,o=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function l(e){var t=e&&e.itemStyle;if(t)for(var n=0,r=o.length;n<r;n++){var a=o[n],s=t.normal,l=t.emphasis;s&&s[a]&&(e[a]=e[a]||{},e[a].normal?i.merge(e[a].normal,s[a]):e[a].normal=s[a],s[a]=null),l&&l[a]&&(e[a]=e[a]||{},e[a].emphasis?i.merge(e[a].emphasis,l[a]):e[a].emphasis=l[a],l[a]=null)}}function u(e,t,n){if(e&&e[t]&&(e[t].normal||e[t].emphasis)){var r=e[t].normal,a=e[t].emphasis;r&&(n?(e[t].normal=e[t].emphasis=null,i.defaults(e[t],r)):e[t]=r),a&&(e.emphasis=e.emphasis||{},e.emphasis[t]=a)}}function c(e){u(e,"itemStyle"),u(e,"lineStyle"),u(e,"areaStyle"),u(e,"label"),u(e,"labelLine"),u(e,"upperLabel"),u(e,"edgeLabel")}function d(e,t){var n=s(e)&&e[t],i=s(n)&&n.textStyle;if(i)for(var a=0,o=r.TEXT_STYLE_OPTIONS.length;a<o;a++){t=r.TEXT_STYLE_OPTIONS[a];i.hasOwnProperty(t)&&(n[t]=i[t])}}function h(e){e&&(c(e),d(e,"label"),e.emphasis&&d(e.emphasis,"label"))}function f(e){if(s(e)){l(e),c(e),d(e,"label"),d(e,"upperLabel"),d(e,"edgeLabel"),e.emphasis&&(d(e.emphasis,"label"),d(e.emphasis,"upperLabel"),d(e.emphasis,"edgeLabel"));var t=e.markPoint;t&&(l(t),h(t));var n=e.markLine;n&&(l(n),h(n));var r=e.markArea;r&&h(r);var a=e.data;if("graph"===e.type){a=a||e.nodes;var o=e.links||e.edges;if(o&&!i.isTypedArray(o))for(var f=0;f<o.length;f++)h(o[f]);i.each(e.categories,function(e){c(e)})}if(a&&!i.isTypedArray(a))for(f=0;f<a.length;f++)h(a[f]);t=e.markPoint;if(t&&t.data){var p=t.data;for(f=0;f<p.length;f++)h(p[f])}n=e.markLine;if(n&&n.data){var g=n.data;for(f=0;f<g.length;f++)i.isArray(g[f])?(h(g[f][0]),h(g[f][1])):h(g[f])}"gauge"===e.type?(d(e,"axisLabel"),d(e,"title"),d(e,"detail")):"treemap"===e.type?(u(e.breadcrumb,"itemStyle"),i.each(e.levels,function(e){c(e)})):"tree"===e.type&&c(e.leaves)}}function p(e){return i.isArray(e)?e:e?[e]:[]}function g(e){return(i.isArray(e)?e[0]:e)||{}}function m(e,t){a(p(e.series),function(e){s(e)&&f(e)});var n=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];t&&n.push("valueAxis","categoryAxis","logAxis","timeAxis"),a(n,function(t){a(p(e[t]),function(e){e&&(d(e,"axisLabel"),d(e.axisPointer,"label"))})}),a(p(e.parallel),function(e){var t=e&&e.parallelAxisDefault;d(t,"axisLabel"),d(t&&t.axisPointer,"label")}),a(p(e.calendar),function(e){u(e,"itemStyle"),d(e,"dayLabel"),d(e,"monthLabel"),d(e,"yearLabel")}),a(p(e.radar),function(e){d(e,"name")}),a(p(e.geo),function(e){s(e)&&(h(e),a(p(e.regions),function(e){h(e)}))}),a(p(e.timeline),function(e){h(e),u(e,"label"),u(e,"itemStyle"),u(e,"controlStyle",!0);var t=e.data;i.isArray(t)&&i.each(t,function(e){i.isObject(e)&&(u(e,"label"),u(e,"itemStyle"))})}),a(p(e.toolbox),function(e){u(e,"iconStyle"),a(e.feature,function(e){u(e,"iconStyle")})}),d(g(e.axisPointer),"label"),d(g(e.tooltip).axisPointer,"label")}e.exports=m},"27ee":function(e,t,n){var i=n("23c6"),r=n("2b4c")("iterator"),a=n("84f2");e.exports=n("8378").getIteratorMethod=function(e){if(void 0!=e)return e[r]||e["@@iterator"]||a[i(e)]}},"282b":function(e,t,n){var i=n("6d8b");function r(e){for(var t=0;t<e.length;t++)e[t][1]||(e[t][1]=e[t][0]);return function(t,n,r){for(var a={},s=0;s<e.length;s++){var o=e[s][1];if(!(n&&i.indexOf(n,o)>=0||r&&i.indexOf(r,o)<0)){var l=t.getShallow(o);null!=l&&(a[e[s][0]]=l)}}return a}}e.exports=r},2877:function(e,t,n){"use strict";function i(e,t,n,i,r,a,s,o){var l,u="function"===typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),i&&(u.functional=!0),a&&(u._scopeId="data-v-"+a),s?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},u._ssrRegister=l):r&&(l=o?function(){r.call(this,this.$root.$options.shadowRoot)}:r),l)if(u.functional){u._injectStyles=l;var c=u.render;u.render=function(e,t){return l.call(t),c(e,t)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:u}}n.d(t,"a",function(){return i})},"29a8":function(e,t){var n={toolbox:{brush:{title:{rect:"矩形选择",polygon:"圈选",lineX:"横向选择",lineY:"纵向选择",keep:"保持选择",clear:"清除选择"}},dataView:{title:"数据视图",lang:["数据视图","关闭","刷新"]},dataZoom:{title:{zoom:"区域缩放",back:"区域缩放还原"}},magicType:{title:{line:"切换为折线图",bar:"切换为柱状图",stack:"切换为堆叠",tiled:"切换为平铺"}},restore:{title:"还原"},saveAsImage:{title:"保存为图片",lang:["右键另存为图片"]}},series:{typeNames:{pie:"饼图",bar:"柱状图",line:"折线图",scatter:"散点图",effectScatter:"涟漪散点图",radar:"雷达图",tree:"树图",treemap:"矩形树图",boxplot:"箱型图",candlestick:"K线图",k:"K线图",heatmap:"热力图",map:"地图",parallel:"平行坐标图",lines:"线图",graph:"关系图",sankey:"桑基图",funnel:"漏斗图",gauge:"仪表盘图",pictorialBar:"象形柱图",themeRiver:"主题河流图",sunburst:"旭日图"}},aria:{general:{withTitle:"这是一个关于“{title}”的图表。",withoutTitle:"这是一个图表，"},series:{single:{prefix:"",withName:"图表类型是{seriesType}，表示{seriesName}。",withoutName:"图表类型是{seriesType}。"},multiple:{prefix:"它由{seriesCount}个图表系列组成。",withName:"第{seriesId}个系列是一个表示{seriesName}的{seriesType}，",withoutName:"第{seriesId}个系列是一个{seriesType}，",separator:{middle:"；",end:"。"}}},data:{allData:"其数据是——",partialData:"其中，前{displayCnt}项是——",withName:"{name}的数据是{value}",withoutName:"{value}",separator:{middle:"，",end:""}}}};e.exports=n},"2aba":function(e,t,n){var i=n("7726"),r=n("32e9"),a=n("69a8"),s=n("ca5a")("src"),o="toString",l=Function[o],u=(""+l).split(o);n("8378").inspectSource=function(e){return l.call(e)},(e.exports=function(e,t,n,o){var l="function"==typeof n;l&&(a(n,"name")||r(n,"name",t)),e[t]!==n&&(l&&(a(n,s)||r(n,s,e[t]?""+e[t]:u.join(String(t)))),e===i?e[t]=n:o?e[t]?e[t]=n:r(e,t,n):(delete e[t],r(e,t,n)))})(Function.prototype,o,function(){return"function"==typeof this&&this[s]||l.call(this)})},"2aeb":function(e,t,n){var i=n("cb7c"),r=n("1495"),a=n("e11e"),s=n("613b")("IE_PROTO"),o=function(){},l="prototype",u=function(){var e,t=n("230e")("iframe"),i=a.length,r="<",s=">";t.style.display="none",n("fab2").appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(r+"script"+s+"document.F=Object"+r+"/script"+s),e.close(),u=e.F;while(i--)delete u[l][a[i]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(o[l]=i(e),n=new o,o[l]=null,n[s]=e):n=u(),void 0===t?n:r(n,t)}},"2b0e":function(e,t,n){"use strict";(function(e){
/*!
 * Vue.js v2.5.17
 * (c) 2014-2018 Evan You
 * Released under the MIT License.
 */
var n=Object.freeze({});function i(e){return void 0===e||null===e}function r(e){return void 0!==e&&null!==e}function a(e){return!0===e}function s(e){return!1===e}function o(e){return"string"===typeof e||"number"===typeof e||"symbol"===typeof e||"boolean"===typeof e}function l(e){return null!==e&&"object"===typeof e}var u=Object.prototype.toString;function c(e){return"[object Object]"===u.call(e)}function d(e){return"[object RegExp]"===u.call(e)}function h(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}function f(e){return null==e?"":"object"===typeof e?JSON.stringify(e,null,2):String(e)}function p(e){var t=parseFloat(e);return isNaN(t)?e:t}function g(e,t){for(var n=Object.create(null),i=e.split(","),r=0;r<i.length;r++)n[i[r]]=!0;return t?function(e){return n[e.toLowerCase()]}:function(e){return n[e]}}g("slot,component",!0);var m=g("key,ref,slot,slot-scope,is");function v(e,t){if(e.length){var n=e.indexOf(t);if(n>-1)return e.splice(n,1)}}var y=Object.prototype.hasOwnProperty;function b(e,t){return y.call(e,t)}function S(e){var t=Object.create(null);return function(n){var i=t[n];return i||(t[n]=e(n))}}var T=/-(\w)/g,_=S(function(e){return e.replace(T,function(e,t){return t?t.toUpperCase():""})}),w=S(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}),E=/\B([A-Z])/g,x=S(function(e){return e.replace(E,"-$1").toLowerCase()});function A(e,t){function n(n){var i=arguments.length;return i?i>1?e.apply(t,arguments):e.call(t,n):e.call(t)}return n._length=e.length,n}function k(e,t){return e.bind(t)}var I=Function.prototype.bind?k:A;function C(e,t){t=t||0;var n=e.length-t,i=new Array(n);while(n--)i[n]=e[n+t];return i}function R(e,t){for(var n in t)e[n]=t[n];return e}function M(e){for(var t={},n=0;n<e.length;n++)e[n]&&R(t,e[n]);return t}function D(e,t,n){}var L=function(e,t,n){return!1},P=function(e){return e};function O(e,t){if(e===t)return!0;var n=l(e),i=l(t);if(!n||!i)return!n&&!i&&String(e)===String(t);try{var r=Array.isArray(e),a=Array.isArray(t);if(r&&a)return e.length===t.length&&e.every(function(e,n){return O(e,t[n])});if(r||a)return!1;var s=Object.keys(e),o=Object.keys(t);return s.length===o.length&&s.every(function(n){return O(e[n],t[n])})}catch(e){return!1}}function N(e,t){for(var n=0;n<e.length;n++)if(O(e[n],t))return n;return-1}function U(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}}var F="data-server-rendered",B=["component","directive","filter"],V=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured"],j={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:L,isReservedAttr:L,isUnknownElement:L,getTagNamespace:D,parsePlatformTagName:P,mustUseProp:L,_lifecycleHooks:V};function G(e){var t=(e+"").charCodeAt(0);return 36===t||95===t}function H(e,t,n,i){Object.defineProperty(e,t,{value:n,enumerable:!!i,writable:!0,configurable:!0})}var z=/[^\w.$]/;function K(e){if(!z.test(e)){var t=e.split(".");return function(e){for(var n=0;n<t.length;n++){if(!e)return;e=e[t[n]]}return e}}}var $,W="__proto__"in{},q="undefined"!==typeof window,Y="undefined"!==typeof WXEnvironment&&!!WXEnvironment.platform,X=Y&&WXEnvironment.platform.toLowerCase(),Q=q&&window.navigator.userAgent.toLowerCase(),Z=Q&&/msie|trident/.test(Q),J=Q&&Q.indexOf("msie 9.0")>0,ee=Q&&Q.indexOf("edge/")>0,te=(Q&&Q.indexOf("android"),Q&&/iphone|ipad|ipod|ios/.test(Q)||"ios"===X),ne=(Q&&/chrome\/\d+/.test(Q),{}.watch),ie=!1;if(q)try{var re={};Object.defineProperty(re,"passive",{get:function(){ie=!0}}),window.addEventListener("test-passive",null,re)}catch(e){}var ae=function(){return void 0===$&&($=!q&&!Y&&"undefined"!==typeof e&&"server"===e["process"].env.VUE_ENV),$},se=q&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function oe(e){return"function"===typeof e&&/native code/.test(e.toString())}var le,ue="undefined"!==typeof Symbol&&oe(Symbol)&&"undefined"!==typeof Reflect&&oe(Reflect.ownKeys);le="undefined"!==typeof Set&&oe(Set)?Set:function(){function e(){this.set=Object.create(null)}return e.prototype.has=function(e){return!0===this.set[e]},e.prototype.add=function(e){this.set[e]=!0},e.prototype.clear=function(){this.set=Object.create(null)},e}();var ce=D,de=0,he=function(){this.id=de++,this.subs=[]};he.prototype.addSub=function(e){this.subs.push(e)},he.prototype.removeSub=function(e){v(this.subs,e)},he.prototype.depend=function(){he.target&&he.target.addDep(this)},he.prototype.notify=function(){for(var e=this.subs.slice(),t=0,n=e.length;t<n;t++)e[t].update()},he.target=null;var fe=[];function pe(e){he.target&&fe.push(he.target),he.target=e}function ge(){he.target=fe.pop()}var me=function(e,t,n,i,r,a,s,o){this.tag=e,this.data=t,this.children=n,this.text=i,this.elm=r,this.ns=void 0,this.context=a,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=t&&t.key,this.componentOptions=s,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=o,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},ve={child:{configurable:!0}};ve.child.get=function(){return this.componentInstance},Object.defineProperties(me.prototype,ve);var ye=function(e){void 0===e&&(e="");var t=new me;return t.text=e,t.isComment=!0,t};function be(e){return new me(void 0,void 0,void 0,String(e))}function Se(e){var t=new me(e.tag,e.data,e.children,e.text,e.elm,e.context,e.componentOptions,e.asyncFactory);return t.ns=e.ns,t.isStatic=e.isStatic,t.key=e.key,t.isComment=e.isComment,t.fnContext=e.fnContext,t.fnOptions=e.fnOptions,t.fnScopeId=e.fnScopeId,t.isCloned=!0,t}var Te=Array.prototype,_e=Object.create(Te),we=["push","pop","shift","unshift","splice","sort","reverse"];we.forEach(function(e){var t=Te[e];H(_e,e,function(){var n=[],i=arguments.length;while(i--)n[i]=arguments[i];var r,a=t.apply(this,n),s=this.__ob__;switch(e){case"push":case"unshift":r=n;break;case"splice":r=n.slice(2);break}return r&&s.observeArray(r),s.dep.notify(),a})});var Ee=Object.getOwnPropertyNames(_e),xe=!0;function Ae(e){xe=e}var ke=function(e){if(this.value=e,this.dep=new he,this.vmCount=0,H(e,"__ob__",this),Array.isArray(e)){var t=W?Ie:Ce;t(e,_e,Ee),this.observeArray(e)}else this.walk(e)};function Ie(e,t,n){e.__proto__=t}function Ce(e,t,n){for(var i=0,r=n.length;i<r;i++){var a=n[i];H(e,a,t[a])}}function Re(e,t){var n;if(l(e)&&!(e instanceof me))return b(e,"__ob__")&&e.__ob__ instanceof ke?n=e.__ob__:xe&&!ae()&&(Array.isArray(e)||c(e))&&Object.isExtensible(e)&&!e._isVue&&(n=new ke(e)),t&&n&&n.vmCount++,n}function Me(e,t,n,i,r){var a=new he,s=Object.getOwnPropertyDescriptor(e,t);if(!s||!1!==s.configurable){var o=s&&s.get;o||2!==arguments.length||(n=e[t]);var l=s&&s.set,u=!r&&Re(n);Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){var t=o?o.call(e):n;return he.target&&(a.depend(),u&&(u.dep.depend(),Array.isArray(t)&&Pe(t))),t},set:function(t){var i=o?o.call(e):n;t===i||t!==t&&i!==i||(l?l.call(e,t):n=t,u=!r&&Re(t),a.notify())}})}}function De(e,t,n){if(Array.isArray(e)&&h(t))return e.length=Math.max(e.length,t),e.splice(t,1,n),n;if(t in e&&!(t in Object.prototype))return e[t]=n,n;var i=e.__ob__;return e._isVue||i&&i.vmCount?n:i?(Me(i.value,t,n),i.dep.notify(),n):(e[t]=n,n)}function Le(e,t){if(Array.isArray(e)&&h(t))e.splice(t,1);else{var n=e.__ob__;e._isVue||n&&n.vmCount||b(e,t)&&(delete e[t],n&&n.dep.notify())}}function Pe(e){for(var t=void 0,n=0,i=e.length;n<i;n++)t=e[n],t&&t.__ob__&&t.__ob__.dep.depend(),Array.isArray(t)&&Pe(t)}ke.prototype.walk=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)Me(e,t[n])},ke.prototype.observeArray=function(e){for(var t=0,n=e.length;t<n;t++)Re(e[t])};var Oe=j.optionMergeStrategies;function Ne(e,t){if(!t)return e;for(var n,i,r,a=Object.keys(t),s=0;s<a.length;s++)n=a[s],i=e[n],r=t[n],b(e,n)?c(i)&&c(r)&&Ne(i,r):De(e,n,r);return e}function Ue(e,t,n){return n?function(){var i="function"===typeof t?t.call(n,n):t,r="function"===typeof e?e.call(n,n):e;return i?Ne(i,r):r}:t?e?function(){return Ne("function"===typeof t?t.call(this,this):t,"function"===typeof e?e.call(this,this):e)}:t:e}function Fe(e,t){return t?e?e.concat(t):Array.isArray(t)?t:[t]:e}function Be(e,t,n,i){var r=Object.create(e||null);return t?R(r,t):r}Oe.data=function(e,t,n){return n?Ue(e,t,n):t&&"function"!==typeof t?e:Ue(e,t)},V.forEach(function(e){Oe[e]=Fe}),B.forEach(function(e){Oe[e+"s"]=Be}),Oe.watch=function(e,t,n,i){if(e===ne&&(e=void 0),t===ne&&(t=void 0),!t)return Object.create(e||null);if(!e)return t;var r={};for(var a in R(r,e),t){var s=r[a],o=t[a];s&&!Array.isArray(s)&&(s=[s]),r[a]=s?s.concat(o):Array.isArray(o)?o:[o]}return r},Oe.props=Oe.methods=Oe.inject=Oe.computed=function(e,t,n,i){if(!e)return t;var r=Object.create(null);return R(r,e),t&&R(r,t),r},Oe.provide=Ue;var Ve=function(e,t){return void 0===t?e:t};function je(e,t){var n=e.props;if(n){var i,r,a,s={};if(Array.isArray(n)){i=n.length;while(i--)r=n[i],"string"===typeof r&&(a=_(r),s[a]={type:null})}else if(c(n))for(var o in n)r=n[o],a=_(o),s[a]=c(r)?r:{type:r};else 0;e.props=s}}function Ge(e,t){var n=e.inject;if(n){var i=e.inject={};if(Array.isArray(n))for(var r=0;r<n.length;r++)i[n[r]]={from:n[r]};else if(c(n))for(var a in n){var s=n[a];i[a]=c(s)?R({from:a},s):{from:s}}else 0}}function He(e){var t=e.directives;if(t)for(var n in t){var i=t[n];"function"===typeof i&&(t[n]={bind:i,update:i})}}function ze(e,t,n){"function"===typeof t&&(t=t.options),je(t,n),Ge(t,n),He(t);var i=t.extends;if(i&&(e=ze(e,i,n)),t.mixins)for(var r=0,a=t.mixins.length;r<a;r++)e=ze(e,t.mixins[r],n);var s,o={};for(s in e)l(s);for(s in t)b(e,s)||l(s);function l(i){var r=Oe[i]||Ve;o[i]=r(e[i],t[i],n,i)}return o}function Ke(e,t,n,i){if("string"===typeof n){var r=e[t];if(b(r,n))return r[n];var a=_(n);if(b(r,a))return r[a];var s=w(a);if(b(r,s))return r[s];var o=r[n]||r[a]||r[s];return o}}function $e(e,t,n,i){var r=t[e],a=!b(n,e),s=n[e],o=Xe(Boolean,r.type);if(o>-1)if(a&&!b(r,"default"))s=!1;else if(""===s||s===x(e)){var l=Xe(String,r.type);(l<0||o<l)&&(s=!0)}if(void 0===s){s=We(i,r,e);var u=xe;Ae(!0),Re(s),Ae(u)}return s}function We(e,t,n){if(b(t,"default")){var i=t.default;return e&&e.$options.propsData&&void 0===e.$options.propsData[n]&&void 0!==e._props[n]?e._props[n]:"function"===typeof i&&"Function"!==qe(t.type)?i.call(e):i}}function qe(e){var t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:""}function Ye(e,t){return qe(e)===qe(t)}function Xe(e,t){if(!Array.isArray(t))return Ye(t,e)?0:-1;for(var n=0,i=t.length;n<i;n++)if(Ye(t[n],e))return n;return-1}function Qe(e,t,n){if(t){var i=t;while(i=i.$parent){var r=i.$options.errorCaptured;if(r)for(var a=0;a<r.length;a++)try{var s=!1===r[a].call(i,e,t,n);if(s)return}catch(e){Ze(e,i,"errorCaptured hook")}}}Ze(e,t,n)}function Ze(e,t,n){if(j.errorHandler)try{return j.errorHandler.call(null,e,t,n)}catch(e){Je(e,null,"config.errorHandler")}Je(e,t,n)}function Je(e,t,n){if(!q&&!Y||"undefined"===typeof console)throw e;console.error(e)}var et,tt,nt=[],it=!1;function rt(){it=!1;var e=nt.slice(0);nt.length=0;for(var t=0;t<e.length;t++)e[t]()}var at=!1;if("undefined"!==typeof setImmediate&&oe(setImmediate))tt=function(){setImmediate(rt)};else if("undefined"===typeof MessageChannel||!oe(MessageChannel)&&"[object MessageChannelConstructor]"!==MessageChannel.toString())tt=function(){setTimeout(rt,0)};else{var st=new MessageChannel,ot=st.port2;st.port1.onmessage=rt,tt=function(){ot.postMessage(1)}}if("undefined"!==typeof Promise&&oe(Promise)){var lt=Promise.resolve();et=function(){lt.then(rt),te&&setTimeout(D)}}else et=tt;function ut(e){return e._withTask||(e._withTask=function(){at=!0;var t=e.apply(null,arguments);return at=!1,t})}function ct(e,t){var n;if(nt.push(function(){if(e)try{e.call(t)}catch(e){Qe(e,t,"nextTick")}else n&&n(t)}),it||(it=!0,at?tt():et()),!e&&"undefined"!==typeof Promise)return new Promise(function(e){n=e})}var dt=new le;function ht(e){ft(e,dt),dt.clear()}function ft(e,t){var n,i,r=Array.isArray(e);if(!(!r&&!l(e)||Object.isFrozen(e)||e instanceof me)){if(e.__ob__){var a=e.__ob__.dep.id;if(t.has(a))return;t.add(a)}if(r){n=e.length;while(n--)ft(e[n],t)}else{i=Object.keys(e),n=i.length;while(n--)ft(e[i[n]],t)}}}var pt,gt=S(function(e){var t="&"===e.charAt(0);e=t?e.slice(1):e;var n="~"===e.charAt(0);e=n?e.slice(1):e;var i="!"===e.charAt(0);return e=i?e.slice(1):e,{name:e,once:n,capture:i,passive:t}});function mt(e){function t(){var e=arguments,n=t.fns;if(!Array.isArray(n))return n.apply(null,arguments);for(var i=n.slice(),r=0;r<i.length;r++)i[r].apply(null,e)}return t.fns=e,t}function vt(e,t,n,r,a){var s,o,l,u;for(s in e)o=e[s],l=t[s],u=gt(s),i(o)||(i(l)?(i(o.fns)&&(o=e[s]=mt(o)),n(u.name,o,u.once,u.capture,u.passive,u.params)):o!==l&&(l.fns=o,e[s]=l));for(s in t)i(e[s])&&(u=gt(s),r(u.name,t[s],u.capture))}function yt(e,t,n){var s;e instanceof me&&(e=e.data.hook||(e.data.hook={}));var o=e[t];function l(){n.apply(this,arguments),v(s.fns,l)}i(o)?s=mt([l]):r(o.fns)&&a(o.merged)?(s=o,s.fns.push(l)):s=mt([o,l]),s.merged=!0,e[t]=s}function bt(e,t,n){var a=t.options.props;if(!i(a)){var s={},o=e.attrs,l=e.props;if(r(o)||r(l))for(var u in a){var c=x(u);St(s,l,u,c,!0)||St(s,o,u,c,!1)}return s}}function St(e,t,n,i,a){if(r(t)){if(b(t,n))return e[n]=t[n],a||delete t[n],!0;if(b(t,i))return e[n]=t[i],a||delete t[i],!0}return!1}function Tt(e){for(var t=0;t<e.length;t++)if(Array.isArray(e[t]))return Array.prototype.concat.apply([],e);return e}function _t(e){return o(e)?[be(e)]:Array.isArray(e)?Et(e):void 0}function wt(e){return r(e)&&r(e.text)&&s(e.isComment)}function Et(e,t){var n,s,l,u,c=[];for(n=0;n<e.length;n++)s=e[n],i(s)||"boolean"===typeof s||(l=c.length-1,u=c[l],Array.isArray(s)?s.length>0&&(s=Et(s,(t||"")+"_"+n),wt(s[0])&&wt(u)&&(c[l]=be(u.text+s[0].text),s.shift()),c.push.apply(c,s)):o(s)?wt(u)?c[l]=be(u.text+s):""!==s&&c.push(be(s)):wt(s)&&wt(u)?c[l]=be(u.text+s.text):(a(e._isVList)&&r(s.tag)&&i(s.key)&&r(t)&&(s.key="__vlist"+t+"_"+n+"__"),c.push(s)));return c}function xt(e,t){return(e.__esModule||ue&&"Module"===e[Symbol.toStringTag])&&(e=e.default),l(e)?t.extend(e):e}function At(e,t,n,i,r){var a=ye();return a.asyncFactory=e,a.asyncMeta={data:t,context:n,children:i,tag:r},a}function kt(e,t,n){if(a(e.error)&&r(e.errorComp))return e.errorComp;if(r(e.resolved))return e.resolved;if(a(e.loading)&&r(e.loadingComp))return e.loadingComp;if(!r(e.contexts)){var s=e.contexts=[n],o=!0,u=function(){for(var e=0,t=s.length;e<t;e++)s[e].$forceUpdate()},c=U(function(n){e.resolved=xt(n,t),o||u()}),d=U(function(t){r(e.errorComp)&&(e.error=!0,u())}),h=e(c,d);return l(h)&&("function"===typeof h.then?i(e.resolved)&&h.then(c,d):r(h.component)&&"function"===typeof h.component.then&&(h.component.then(c,d),r(h.error)&&(e.errorComp=xt(h.error,t)),r(h.loading)&&(e.loadingComp=xt(h.loading,t),0===h.delay?e.loading=!0:setTimeout(function(){i(e.resolved)&&i(e.error)&&(e.loading=!0,u())},h.delay||200)),r(h.timeout)&&setTimeout(function(){i(e.resolved)&&d(null)},h.timeout))),o=!1,e.loading?e.loadingComp:e.resolved}e.contexts.push(n)}function It(e){return e.isComment&&e.asyncFactory}function Ct(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];if(r(n)&&(r(n.componentOptions)||It(n)))return n}}function Rt(e){e._events=Object.create(null),e._hasHookEvent=!1;var t=e.$options._parentListeners;t&&Lt(e,t)}function Mt(e,t,n){n?pt.$once(e,t):pt.$on(e,t)}function Dt(e,t){pt.$off(e,t)}function Lt(e,t,n){pt=e,vt(t,n||{},Mt,Dt,e),pt=void 0}function Pt(e){var t=/^hook:/;e.prototype.$on=function(e,n){var i=this,r=this;if(Array.isArray(e))for(var a=0,s=e.length;a<s;a++)i.$on(e[a],n);else(r._events[e]||(r._events[e]=[])).push(n),t.test(e)&&(r._hasHookEvent=!0);return r},e.prototype.$once=function(e,t){var n=this;function i(){n.$off(e,i),t.apply(n,arguments)}return i.fn=t,n.$on(e,i),n},e.prototype.$off=function(e,t){var n=this,i=this;if(!arguments.length)return i._events=Object.create(null),i;if(Array.isArray(e)){for(var r=0,a=e.length;r<a;r++)n.$off(e[r],t);return i}var s=i._events[e];if(!s)return i;if(!t)return i._events[e]=null,i;if(t){var o,l=s.length;while(l--)if(o=s[l],o===t||o.fn===t){s.splice(l,1);break}}return i},e.prototype.$emit=function(e){var t=this,n=t._events[e];if(n){n=n.length>1?C(n):n;for(var i=C(arguments,1),r=0,a=n.length;r<a;r++)try{n[r].apply(t,i)}catch(n){Qe(n,t,'event handler for "'+e+'"')}}return t}}function Ot(e,t){var n={};if(!e)return n;for(var i=0,r=e.length;i<r;i++){var a=e[i],s=a.data;if(s&&s.attrs&&s.attrs.slot&&delete s.attrs.slot,a.context!==t&&a.fnContext!==t||!s||null==s.slot)(n.default||(n.default=[])).push(a);else{var o=s.slot,l=n[o]||(n[o]=[]);"template"===a.tag?l.push.apply(l,a.children||[]):l.push(a)}}for(var u in n)n[u].every(Nt)&&delete n[u];return n}function Nt(e){return e.isComment&&!e.asyncFactory||" "===e.text}function Ut(e,t){t=t||{};for(var n=0;n<e.length;n++)Array.isArray(e[n])?Ut(e[n],t):t[e[n].key]=e[n].fn;return t}var Ft=null;function Bt(e){var t=e.$options,n=t.parent;if(n&&!t.abstract){while(n.$options.abstract&&n.$parent)n=n.$parent;n.$children.push(e)}e.$parent=n,e.$root=n?n.$root:e,e.$children=[],e.$refs={},e._watcher=null,e._inactive=null,e._directInactive=!1,e._isMounted=!1,e._isDestroyed=!1,e._isBeingDestroyed=!1}function Vt(e){e.prototype._update=function(e,t){var n=this;n._isMounted&&$t(n,"beforeUpdate");var i=n.$el,r=n._vnode,a=Ft;Ft=n,n._vnode=e,r?n.$el=n.__patch__(r,e):(n.$el=n.__patch__(n.$el,e,t,!1,n.$options._parentElm,n.$options._refElm),n.$options._parentElm=n.$options._refElm=null),Ft=a,i&&(i.__vue__=null),n.$el&&(n.$el.__vue__=n),n.$vnode&&n.$parent&&n.$vnode===n.$parent._vnode&&(n.$parent.$el=n.$el)},e.prototype.$forceUpdate=function(){var e=this;e._watcher&&e._watcher.update()},e.prototype.$destroy=function(){var e=this;if(!e._isBeingDestroyed){$t(e,"beforeDestroy"),e._isBeingDestroyed=!0;var t=e.$parent;!t||t._isBeingDestroyed||e.$options.abstract||v(t.$children,e),e._watcher&&e._watcher.teardown();var n=e._watchers.length;while(n--)e._watchers[n].teardown();e._data.__ob__&&e._data.__ob__.vmCount--,e._isDestroyed=!0,e.__patch__(e._vnode,null),$t(e,"destroyed"),e.$off(),e.$el&&(e.$el.__vue__=null),e.$vnode&&(e.$vnode.parent=null)}}}function jt(e,t,n){var i;return e.$el=t,e.$options.render||(e.$options.render=ye),$t(e,"beforeMount"),i=function(){e._update(e._render(),n)},new on(e,i,D,null,!0),n=!1,null==e.$vnode&&(e._isMounted=!0,$t(e,"mounted")),e}function Gt(e,t,i,r,a){var s=!!(a||e.$options._renderChildren||r.data.scopedSlots||e.$scopedSlots!==n);if(e.$options._parentVnode=r,e.$vnode=r,e._vnode&&(e._vnode.parent=r),e.$options._renderChildren=a,e.$attrs=r.data.attrs||n,e.$listeners=i||n,t&&e.$options.props){Ae(!1);for(var o=e._props,l=e.$options._propKeys||[],u=0;u<l.length;u++){var c=l[u],d=e.$options.props;o[c]=$e(c,d,t,e)}Ae(!0),e.$options.propsData=t}i=i||n;var h=e.$options._parentListeners;e.$options._parentListeners=i,Lt(e,i,h),s&&(e.$slots=Ot(a,r.context),e.$forceUpdate())}function Ht(e){while(e&&(e=e.$parent))if(e._inactive)return!0;return!1}function zt(e,t){if(t){if(e._directInactive=!1,Ht(e))return}else if(e._directInactive)return;if(e._inactive||null===e._inactive){e._inactive=!1;for(var n=0;n<e.$children.length;n++)zt(e.$children[n]);$t(e,"activated")}}function Kt(e,t){if((!t||(e._directInactive=!0,!Ht(e)))&&!e._inactive){e._inactive=!0;for(var n=0;n<e.$children.length;n++)Kt(e.$children[n]);$t(e,"deactivated")}}function $t(e,t){pe();var n=e.$options[t];if(n)for(var i=0,r=n.length;i<r;i++)try{n[i].call(e)}catch(n){Qe(n,e,t+" hook")}e._hasHookEvent&&e.$emit("hook:"+t),ge()}var Wt=[],qt=[],Yt={},Xt=!1,Qt=!1,Zt=0;function Jt(){Zt=Wt.length=qt.length=0,Yt={},Xt=Qt=!1}function en(){var e,t;for(Qt=!0,Wt.sort(function(e,t){return e.id-t.id}),Zt=0;Zt<Wt.length;Zt++)e=Wt[Zt],t=e.id,Yt[t]=null,e.run();var n=qt.slice(),i=Wt.slice();Jt(),rn(n),tn(i),se&&j.devtools&&se.emit("flush")}function tn(e){var t=e.length;while(t--){var n=e[t],i=n.vm;i._watcher===n&&i._isMounted&&$t(i,"updated")}}function nn(e){e._inactive=!1,qt.push(e)}function rn(e){for(var t=0;t<e.length;t++)e[t]._inactive=!0,zt(e[t],!0)}function an(e){var t=e.id;if(null==Yt[t]){if(Yt[t]=!0,Qt){var n=Wt.length-1;while(n>Zt&&Wt[n].id>e.id)n--;Wt.splice(n+1,0,e)}else Wt.push(e);Xt||(Xt=!0,ct(en))}}var sn=0,on=function(e,t,n,i,r){this.vm=e,r&&(e._watcher=this),e._watchers.push(this),i?(this.deep=!!i.deep,this.user=!!i.user,this.lazy=!!i.lazy,this.sync=!!i.sync):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++sn,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new le,this.newDepIds=new le,this.expression="","function"===typeof t?this.getter=t:(this.getter=K(t),this.getter||(this.getter=function(){})),this.value=this.lazy?void 0:this.get()};on.prototype.get=function(){var e;pe(this);var t=this.vm;try{e=this.getter.call(t,t)}catch(e){if(!this.user)throw e;Qe(e,t,'getter for watcher "'+this.expression+'"')}finally{this.deep&&ht(e),ge(),this.cleanupDeps()}return e},on.prototype.addDep=function(e){var t=e.id;this.newDepIds.has(t)||(this.newDepIds.add(t),this.newDeps.push(e),this.depIds.has(t)||e.addSub(this))},on.prototype.cleanupDeps=function(){var e=this,t=this.deps.length;while(t--){var n=e.deps[t];e.newDepIds.has(n.id)||n.removeSub(e)}var i=this.depIds;this.depIds=this.newDepIds,this.newDepIds=i,this.newDepIds.clear(),i=this.deps,this.deps=this.newDeps,this.newDeps=i,this.newDeps.length=0},on.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():an(this)},on.prototype.run=function(){if(this.active){var e=this.get();if(e!==this.value||l(e)||this.deep){var t=this.value;if(this.value=e,this.user)try{this.cb.call(this.vm,e,t)}catch(e){Qe(e,this.vm,'callback for watcher "'+this.expression+'"')}else this.cb.call(this.vm,e,t)}}},on.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},on.prototype.depend=function(){var e=this,t=this.deps.length;while(t--)e.deps[t].depend()},on.prototype.teardown=function(){var e=this;if(this.active){this.vm._isBeingDestroyed||v(this.vm._watchers,this);var t=this.deps.length;while(t--)e.deps[t].removeSub(e);this.active=!1}};var ln={enumerable:!0,configurable:!0,get:D,set:D};function un(e,t,n){ln.get=function(){return this[t][n]},ln.set=function(e){this[t][n]=e},Object.defineProperty(e,n,ln)}function cn(e){e._watchers=[];var t=e.$options;t.props&&dn(e,t.props),t.methods&&yn(e,t.methods),t.data?hn(e):Re(e._data={},!0),t.computed&&gn(e,t.computed),t.watch&&t.watch!==ne&&bn(e,t.watch)}function dn(e,t){var n=e.$options.propsData||{},i=e._props={},r=e.$options._propKeys=[],a=!e.$parent;a||Ae(!1);var s=function(a){r.push(a);var s=$e(a,t,n,e);Me(i,a,s),a in e||un(e,"_props",a)};for(var o in t)s(o);Ae(!0)}function hn(e){var t=e.$options.data;t=e._data="function"===typeof t?fn(t,e):t||{},c(t)||(t={});var n=Object.keys(t),i=e.$options.props,r=(e.$options.methods,n.length);while(r--){var a=n[r];0,i&&b(i,a)||G(a)||un(e,"_data",a)}Re(t,!0)}function fn(e,t){pe();try{return e.call(t,t)}catch(e){return Qe(e,t,"data()"),{}}finally{ge()}}var pn={lazy:!0};function gn(e,t){var n=e._computedWatchers=Object.create(null),i=ae();for(var r in t){var a=t[r],s="function"===typeof a?a:a.get;0,i||(n[r]=new on(e,s||D,D,pn)),r in e||mn(e,r,a)}}function mn(e,t,n){var i=!ae();"function"===typeof n?(ln.get=i?vn(t):n,ln.set=D):(ln.get=n.get?i&&!1!==n.cache?vn(t):n.get:D,ln.set=n.set?n.set:D),Object.defineProperty(e,t,ln)}function vn(e){return function(){var t=this._computedWatchers&&this._computedWatchers[e];if(t)return t.dirty&&t.evaluate(),he.target&&t.depend(),t.value}}function yn(e,t){e.$options.props;for(var n in t)e[n]=null==t[n]?D:I(t[n],e)}function bn(e,t){for(var n in t){var i=t[n];if(Array.isArray(i))for(var r=0;r<i.length;r++)Sn(e,n,i[r]);else Sn(e,n,i)}}function Sn(e,t,n,i){return c(n)&&(i=n,n=n.handler),"string"===typeof n&&(n=e[n]),e.$watch(t,n,i)}function Tn(e){var t={get:function(){return this._data}},n={get:function(){return this._props}};Object.defineProperty(e.prototype,"$data",t),Object.defineProperty(e.prototype,"$props",n),e.prototype.$set=De,e.prototype.$delete=Le,e.prototype.$watch=function(e,t,n){var i=this;if(c(t))return Sn(i,e,t,n);n=n||{},n.user=!0;var r=new on(i,e,t,n);return n.immediate&&t.call(i,r.value),function(){r.teardown()}}}function _n(e){var t=e.$options.provide;t&&(e._provided="function"===typeof t?t.call(e):t)}function wn(e){var t=En(e.$options.inject,e);t&&(Ae(!1),Object.keys(t).forEach(function(n){Me(e,n,t[n])}),Ae(!0))}function En(e,t){if(e){for(var n=Object.create(null),i=ue?Reflect.ownKeys(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}):Object.keys(e),r=0;r<i.length;r++){var a=i[r],s=e[a].from,o=t;while(o){if(o._provided&&b(o._provided,s)){n[a]=o._provided[s];break}o=o.$parent}if(!o)if("default"in e[a]){var l=e[a].default;n[a]="function"===typeof l?l.call(t):l}else 0}return n}}function xn(e,t){var n,i,a,s,o;if(Array.isArray(e)||"string"===typeof e)for(n=new Array(e.length),i=0,a=e.length;i<a;i++)n[i]=t(e[i],i);else if("number"===typeof e)for(n=new Array(e),i=0;i<e;i++)n[i]=t(i+1,i);else if(l(e))for(s=Object.keys(e),n=new Array(s.length),i=0,a=s.length;i<a;i++)o=s[i],n[i]=t(e[o],o,i);return r(n)&&(n._isVList=!0),n}function An(e,t,n,i){var r,a=this.$scopedSlots[e];if(a)n=n||{},i&&(n=R(R({},i),n)),r=a(n)||t;else{var s=this.$slots[e];s&&(s._rendered=!0),r=s||t}var o=n&&n.slot;return o?this.$createElement("template",{slot:o},r):r}function kn(e){return Ke(this.$options,"filters",e,!0)||P}function In(e,t){return Array.isArray(e)?-1===e.indexOf(t):e!==t}function Cn(e,t,n,i,r){var a=j.keyCodes[t]||n;return r&&i&&!j.keyCodes[t]?In(r,i):a?In(a,e):i?x(i)!==t:void 0}function Rn(e,t,n,i,r){if(n)if(l(n)){var a;Array.isArray(n)&&(n=M(n));var s=function(s){if("class"===s||"style"===s||m(s))a=e;else{var o=e.attrs&&e.attrs.type;a=i||j.mustUseProp(t,o,s)?e.domProps||(e.domProps={}):e.attrs||(e.attrs={})}if(!(s in a)&&(a[s]=n[s],r)){var l=e.on||(e.on={});l["update:"+s]=function(e){n[s]=e}}};for(var o in n)s(o)}else;return e}function Mn(e,t){var n=this._staticTrees||(this._staticTrees=[]),i=n[e];return i&&!t?i:(i=n[e]=this.$options.staticRenderFns[e].call(this._renderProxy,null,this),Ln(i,"__static__"+e,!1),i)}function Dn(e,t,n){return Ln(e,"__once__"+t+(n?"_"+n:""),!0),e}function Ln(e,t,n){if(Array.isArray(e))for(var i=0;i<e.length;i++)e[i]&&"string"!==typeof e[i]&&Pn(e[i],t+"_"+i,n);else Pn(e,t,n)}function Pn(e,t,n){e.isStatic=!0,e.key=t,e.isOnce=n}function On(e,t){if(t)if(c(t)){var n=e.on=e.on?R({},e.on):{};for(var i in t){var r=n[i],a=t[i];n[i]=r?[].concat(r,a):a}}else;return e}function Nn(e){e._o=Dn,e._n=p,e._s=f,e._l=xn,e._t=An,e._q=O,e._i=N,e._m=Mn,e._f=kn,e._k=Cn,e._b=Rn,e._v=be,e._e=ye,e._u=Ut,e._g=On}function Un(e,t,i,r,s){var o,l=s.options;b(r,"_uid")?(o=Object.create(r),o._original=r):(o=r,r=r._original);var u=a(l._compiled),c=!u;this.data=e,this.props=t,this.children=i,this.parent=r,this.listeners=e.on||n,this.injections=En(l.inject,r),this.slots=function(){return Ot(i,r)},u&&(this.$options=l,this.$slots=this.slots(),this.$scopedSlots=e.scopedSlots||n),l._scopeId?this._c=function(e,t,n,i){var a=Yn(o,e,t,n,i,c);return a&&!Array.isArray(a)&&(a.fnScopeId=l._scopeId,a.fnContext=r),a}:this._c=function(e,t,n,i){return Yn(o,e,t,n,i,c)}}function Fn(e,t,i,a,s){var o=e.options,l={},u=o.props;if(r(u))for(var c in u)l[c]=$e(c,u,t||n);else r(i.attrs)&&Vn(l,i.attrs),r(i.props)&&Vn(l,i.props);var d=new Un(i,l,s,a,e),h=o.render.call(null,d._c,d);if(h instanceof me)return Bn(h,i,d.parent,o);if(Array.isArray(h)){for(var f=_t(h)||[],p=new Array(f.length),g=0;g<f.length;g++)p[g]=Bn(f[g],i,d.parent,o);return p}}function Bn(e,t,n,i){var r=Se(e);return r.fnContext=n,r.fnOptions=i,t.slot&&((r.data||(r.data={})).slot=t.slot),r}function Vn(e,t){for(var n in t)e[_(n)]=t[n]}Nn(Un.prototype);var jn={init:function(e,t,n,i){if(e.componentInstance&&!e.componentInstance._isDestroyed&&e.data.keepAlive){var r=e;jn.prepatch(r,r)}else{var a=e.componentInstance=zn(e,Ft,n,i);a.$mount(t?e.elm:void 0,t)}},prepatch:function(e,t){var n=t.componentOptions,i=t.componentInstance=e.componentInstance;Gt(i,n.propsData,n.listeners,t,n.children)},insert:function(e){var t=e.context,n=e.componentInstance;n._isMounted||(n._isMounted=!0,$t(n,"mounted")),e.data.keepAlive&&(t._isMounted?nn(n):zt(n,!0))},destroy:function(e){var t=e.componentInstance;t._isDestroyed||(e.data.keepAlive?Kt(t,!0):t.$destroy())}},Gn=Object.keys(jn);function Hn(e,t,n,s,o){if(!i(e)){var u=n.$options._base;if(l(e)&&(e=u.extend(e)),"function"===typeof e){var c;if(i(e.cid)&&(c=e,e=kt(c,u,n),void 0===e))return At(c,t,n,s,o);t=t||{},ri(e),r(t.model)&&$n(e.options,t);var d=bt(t,e,o);if(a(e.options.functional))return Fn(e,d,t,n,s);var h=t.on;if(t.on=t.nativeOn,a(e.options.abstract)){var f=t.slot;t={},f&&(t.slot=f)}Kn(t);var p=e.options.name||o,g=new me("vue-component-"+e.cid+(p?"-"+p:""),t,void 0,void 0,void 0,n,{Ctor:e,propsData:d,listeners:h,tag:o,children:s},c);return g}}}function zn(e,t,n,i){var a={_isComponent:!0,parent:t,_parentVnode:e,_parentElm:n||null,_refElm:i||null},s=e.data.inlineTemplate;return r(s)&&(a.render=s.render,a.staticRenderFns=s.staticRenderFns),new e.componentOptions.Ctor(a)}function Kn(e){for(var t=e.hook||(e.hook={}),n=0;n<Gn.length;n++){var i=Gn[n];t[i]=jn[i]}}function $n(e,t){var n=e.model&&e.model.prop||"value",i=e.model&&e.model.event||"input";(t.props||(t.props={}))[n]=t.model.value;var a=t.on||(t.on={});r(a[i])?a[i]=[t.model.callback].concat(a[i]):a[i]=t.model.callback}var Wn=1,qn=2;function Yn(e,t,n,i,r,s){return(Array.isArray(n)||o(n))&&(r=i,i=n,n=void 0),a(s)&&(r=qn),Xn(e,t,n,i,r)}function Xn(e,t,n,i,a){if(r(n)&&r(n.__ob__))return ye();if(r(n)&&r(n.is)&&(t=n.is),!t)return ye();var s,o,l;(Array.isArray(i)&&"function"===typeof i[0]&&(n=n||{},n.scopedSlots={default:i[0]},i.length=0),a===qn?i=_t(i):a===Wn&&(i=Tt(i)),"string"===typeof t)?(o=e.$vnode&&e.$vnode.ns||j.getTagNamespace(t),s=j.isReservedTag(t)?new me(j.parsePlatformTagName(t),n,i,void 0,void 0,e):r(l=Ke(e.$options,"components",t))?Hn(l,n,e,i,t):new me(t,n,i,void 0,void 0,e)):s=Hn(t,n,e,i);return Array.isArray(s)?s:r(s)?(r(o)&&Qn(s,o),r(n)&&Zn(n),s):ye()}function Qn(e,t,n){if(e.ns=t,"foreignObject"===e.tag&&(t=void 0,n=!0),r(e.children))for(var s=0,o=e.children.length;s<o;s++){var l=e.children[s];r(l.tag)&&(i(l.ns)||a(n)&&"svg"!==l.tag)&&Qn(l,t,n)}}function Zn(e){l(e.style)&&ht(e.style),l(e.class)&&ht(e.class)}function Jn(e){e._vnode=null,e._staticTrees=null;var t=e.$options,i=e.$vnode=t._parentVnode,r=i&&i.context;e.$slots=Ot(t._renderChildren,r),e.$scopedSlots=n,e._c=function(t,n,i,r){return Yn(e,t,n,i,r,!1)},e.$createElement=function(t,n,i,r){return Yn(e,t,n,i,r,!0)};var a=i&&i.data;Me(e,"$attrs",a&&a.attrs||n,null,!0),Me(e,"$listeners",t._parentListeners||n,null,!0)}function ei(e){Nn(e.prototype),e.prototype.$nextTick=function(e){return ct(e,this)},e.prototype._render=function(){var e,t=this,i=t.$options,r=i.render,a=i._parentVnode;a&&(t.$scopedSlots=a.data.scopedSlots||n),t.$vnode=a;try{e=r.call(t._renderProxy,t.$createElement)}catch(n){Qe(n,t,"render"),e=t._vnode}return e instanceof me||(e=ye()),e.parent=a,e}}var ti=0;function ni(e){e.prototype._init=function(e){var t=this;t._uid=ti++,t._isVue=!0,e&&e._isComponent?ii(t,e):t.$options=ze(ri(t.constructor),e||{},t),t._renderProxy=t,t._self=t,Bt(t),Rt(t),Jn(t),$t(t,"beforeCreate"),wn(t),cn(t),_n(t),$t(t,"created"),t.$options.el&&t.$mount(t.$options.el)}}function ii(e,t){var n=e.$options=Object.create(e.constructor.options),i=t._parentVnode;n.parent=t.parent,n._parentVnode=i,n._parentElm=t._parentElm,n._refElm=t._refElm;var r=i.componentOptions;n.propsData=r.propsData,n._parentListeners=r.listeners,n._renderChildren=r.children,n._componentTag=r.tag,t.render&&(n.render=t.render,n.staticRenderFns=t.staticRenderFns)}function ri(e){var t=e.options;if(e.super){var n=ri(e.super),i=e.superOptions;if(n!==i){e.superOptions=n;var r=ai(e);r&&R(e.extendOptions,r),t=e.options=ze(n,e.extendOptions),t.name&&(t.components[t.name]=e)}}return t}function ai(e){var t,n=e.options,i=e.extendOptions,r=e.sealedOptions;for(var a in n)n[a]!==r[a]&&(t||(t={}),t[a]=si(n[a],i[a],r[a]));return t}function si(e,t,n){if(Array.isArray(e)){var i=[];n=Array.isArray(n)?n:[n],t=Array.isArray(t)?t:[t];for(var r=0;r<e.length;r++)(t.indexOf(e[r])>=0||n.indexOf(e[r])<0)&&i.push(e[r]);return i}return e}function oi(e){this._init(e)}function li(e){e.use=function(e){var t=this._installedPlugins||(this._installedPlugins=[]);if(t.indexOf(e)>-1)return this;var n=C(arguments,1);return n.unshift(this),"function"===typeof e.install?e.install.apply(e,n):"function"===typeof e&&e.apply(null,n),t.push(e),this}}function ui(e){e.mixin=function(e){return this.options=ze(this.options,e),this}}function ci(e){e.cid=0;var t=1;e.extend=function(e){e=e||{};var n=this,i=n.cid,r=e._Ctor||(e._Ctor={});if(r[i])return r[i];var a=e.name||n.options.name;var s=function(e){this._init(e)};return s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.cid=t++,s.options=ze(n.options,e),s["super"]=n,s.options.props&&di(s),s.options.computed&&hi(s),s.extend=n.extend,s.mixin=n.mixin,s.use=n.use,B.forEach(function(e){s[e]=n[e]}),a&&(s.options.components[a]=s),s.superOptions=n.options,s.extendOptions=e,s.sealedOptions=R({},s.options),r[i]=s,s}}function di(e){var t=e.options.props;for(var n in t)un(e.prototype,"_props",n)}function hi(e){var t=e.options.computed;for(var n in t)mn(e.prototype,n,t[n])}function fi(e){B.forEach(function(t){e[t]=function(e,n){return n?("component"===t&&c(n)&&(n.name=n.name||e,n=this.options._base.extend(n)),"directive"===t&&"function"===typeof n&&(n={bind:n,update:n}),this.options[t+"s"][e]=n,n):this.options[t+"s"][e]}})}function pi(e){return e&&(e.Ctor.options.name||e.tag)}function gi(e,t){return Array.isArray(e)?e.indexOf(t)>-1:"string"===typeof e?e.split(",").indexOf(t)>-1:!!d(e)&&e.test(t)}function mi(e,t){var n=e.cache,i=e.keys,r=e._vnode;for(var a in n){var s=n[a];if(s){var o=pi(s.componentOptions);o&&!t(o)&&vi(n,a,i,r)}}}function vi(e,t,n,i){var r=e[t];!r||i&&r.tag===i.tag||r.componentInstance.$destroy(),e[t]=null,v(n,t)}ni(oi),Tn(oi),Pt(oi),Vt(oi),ei(oi);var yi=[String,RegExp,Array],bi={name:"keep-alive",abstract:!0,props:{include:yi,exclude:yi,max:[String,Number]},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){var e=this;for(var t in e.cache)vi(e.cache,t,e.keys)},mounted:function(){var e=this;this.$watch("include",function(t){mi(e,function(e){return gi(t,e)})}),this.$watch("exclude",function(t){mi(e,function(e){return!gi(t,e)})})},render:function(){var e=this.$slots.default,t=Ct(e),n=t&&t.componentOptions;if(n){var i=pi(n),r=this,a=r.include,s=r.exclude;if(a&&(!i||!gi(a,i))||s&&i&&gi(s,i))return t;var o=this,l=o.cache,u=o.keys,c=null==t.key?n.Ctor.cid+(n.tag?"::"+n.tag:""):t.key;l[c]?(t.componentInstance=l[c].componentInstance,v(u,c),u.push(c)):(l[c]=t,u.push(c),this.max&&u.length>parseInt(this.max)&&vi(l,u[0],u,this._vnode)),t.data.keepAlive=!0}return t||e&&e[0]}},Si={KeepAlive:bi};function Ti(e){var t={get:function(){return j}};Object.defineProperty(e,"config",t),e.util={warn:ce,extend:R,mergeOptions:ze,defineReactive:Me},e.set=De,e.delete=Le,e.nextTick=ct,e.options=Object.create(null),B.forEach(function(t){e.options[t+"s"]=Object.create(null)}),e.options._base=e,R(e.options.components,Si),li(e),ui(e),ci(e),fi(e)}Ti(oi),Object.defineProperty(oi.prototype,"$isServer",{get:ae}),Object.defineProperty(oi.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(oi,"FunctionalRenderContext",{value:Un}),oi.version="2.5.17";var _i=g("style,class"),wi=g("input,textarea,option,select,progress"),Ei=function(e,t,n){return"value"===n&&wi(e)&&"button"!==t||"selected"===n&&"option"===e||"checked"===n&&"input"===e||"muted"===n&&"video"===e},xi=g("contenteditable,draggable,spellcheck"),Ai=g("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,translate,truespeed,typemustmatch,visible"),ki="http://www.w3.org/1999/xlink",Ii=function(e){return":"===e.charAt(5)&&"xlink"===e.slice(0,5)},Ci=function(e){return Ii(e)?e.slice(6,e.length):""},Ri=function(e){return null==e||!1===e};function Mi(e){var t=e.data,n=e,i=e;while(r(i.componentInstance))i=i.componentInstance._vnode,i&&i.data&&(t=Di(i.data,t));while(r(n=n.parent))n&&n.data&&(t=Di(t,n.data));return Li(t.staticClass,t.class)}function Di(e,t){return{staticClass:Pi(e.staticClass,t.staticClass),class:r(e.class)?[e.class,t.class]:t.class}}function Li(e,t){return r(e)||r(t)?Pi(e,Oi(t)):""}function Pi(e,t){return e?t?e+" "+t:e:t||""}function Oi(e){return Array.isArray(e)?Ni(e):l(e)?Ui(e):"string"===typeof e?e:""}function Ni(e){for(var t,n="",i=0,a=e.length;i<a;i++)r(t=Oi(e[i]))&&""!==t&&(n&&(n+=" "),n+=t);return n}function Ui(e){var t="";for(var n in e)e[n]&&(t&&(t+=" "),t+=n);return t}var Fi={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Bi=g("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),Vi=g("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignObject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),ji=function(e){return Bi(e)||Vi(e)};function Gi(e){return Vi(e)?"svg":"math"===e?"math":void 0}var Hi=Object.create(null);function zi(e){if(!q)return!0;if(ji(e))return!1;if(e=e.toLowerCase(),null!=Hi[e])return Hi[e];var t=document.createElement(e);return e.indexOf("-")>-1?Hi[e]=t.constructor===window.HTMLUnknownElement||t.constructor===window.HTMLElement:Hi[e]=/HTMLUnknownElement/.test(t.toString())}var Ki=g("text,number,password,search,email,tel,url");function $i(e){if("string"===typeof e){var t=document.querySelector(e);return t||document.createElement("div")}return e}function Wi(e,t){var n=document.createElement(e);return"select"!==e?n:(t.data&&t.data.attrs&&void 0!==t.data.attrs.multiple&&n.setAttribute("multiple","multiple"),n)}function qi(e,t){return document.createElementNS(Fi[e],t)}function Yi(e){return document.createTextNode(e)}function Xi(e){return document.createComment(e)}function Qi(e,t,n){e.insertBefore(t,n)}function Zi(e,t){e.removeChild(t)}function Ji(e,t){e.appendChild(t)}function er(e){return e.parentNode}function tr(e){return e.nextSibling}function nr(e){return e.tagName}function ir(e,t){e.textContent=t}function rr(e,t){e.setAttribute(t,"")}var ar=Object.freeze({createElement:Wi,createElementNS:qi,createTextNode:Yi,createComment:Xi,insertBefore:Qi,removeChild:Zi,appendChild:Ji,parentNode:er,nextSibling:tr,tagName:nr,setTextContent:ir,setStyleScope:rr}),sr={create:function(e,t){or(t)},update:function(e,t){e.data.ref!==t.data.ref&&(or(e,!0),or(t))},destroy:function(e){or(e,!0)}};function or(e,t){var n=e.data.ref;if(r(n)){var i=e.context,a=e.componentInstance||e.elm,s=i.$refs;t?Array.isArray(s[n])?v(s[n],a):s[n]===a&&(s[n]=void 0):e.data.refInFor?Array.isArray(s[n])?s[n].indexOf(a)<0&&s[n].push(a):s[n]=[a]:s[n]=a}}var lr=new me("",{},[]),ur=["create","activate","update","remove","destroy"];function cr(e,t){return e.key===t.key&&(e.tag===t.tag&&e.isComment===t.isComment&&r(e.data)===r(t.data)&&dr(e,t)||a(e.isAsyncPlaceholder)&&e.asyncFactory===t.asyncFactory&&i(t.asyncFactory.error))}function dr(e,t){if("input"!==e.tag)return!0;var n,i=r(n=e.data)&&r(n=n.attrs)&&n.type,a=r(n=t.data)&&r(n=n.attrs)&&n.type;return i===a||Ki(i)&&Ki(a)}function hr(e,t,n){var i,a,s={};for(i=t;i<=n;++i)a=e[i].key,r(a)&&(s[a]=i);return s}function fr(e){var t,n,s={},l=e.modules,u=e.nodeOps;for(t=0;t<ur.length;++t)for(s[ur[t]]=[],n=0;n<l.length;++n)r(l[n][ur[t]])&&s[ur[t]].push(l[n][ur[t]]);function c(e){return new me(u.tagName(e).toLowerCase(),{},[],void 0,e)}function d(e,t){function n(){0===--n.listeners&&h(e)}return n.listeners=t,n}function h(e){var t=u.parentNode(e);r(t)&&u.removeChild(t,e)}function f(e,t,n,i,s,o,l){if(r(e.elm)&&r(o)&&(e=o[l]=Se(e)),e.isRootInsert=!s,!p(e,t,n,i)){var c=e.data,d=e.children,h=e.tag;r(h)?(e.elm=e.ns?u.createElementNS(e.ns,h):u.createElement(h,e),_(e),b(e,d,t),r(c)&&T(e,t),y(n,e.elm,i)):a(e.isComment)?(e.elm=u.createComment(e.text),y(n,e.elm,i)):(e.elm=u.createTextNode(e.text),y(n,e.elm,i))}}function p(e,t,n,i){var s=e.data;if(r(s)){var o=r(e.componentInstance)&&s.keepAlive;if(r(s=s.hook)&&r(s=s.init)&&s(e,!1,n,i),r(e.componentInstance))return m(e,t),a(o)&&v(e,t,n,i),!0}}function m(e,t){r(e.data.pendingInsert)&&(t.push.apply(t,e.data.pendingInsert),e.data.pendingInsert=null),e.elm=e.componentInstance.$el,S(e)?(T(e,t),_(e)):(or(e),t.push(e))}function v(e,t,n,i){var a,o=e;while(o.componentInstance)if(o=o.componentInstance._vnode,r(a=o.data)&&r(a=a.transition)){for(a=0;a<s.activate.length;++a)s.activate[a](lr,o);t.push(o);break}y(n,e.elm,i)}function y(e,t,n){r(e)&&(r(n)?n.parentNode===e&&u.insertBefore(e,t,n):u.appendChild(e,t))}function b(e,t,n){if(Array.isArray(t)){0;for(var i=0;i<t.length;++i)f(t[i],n,e.elm,null,!0,t,i)}else o(e.text)&&u.appendChild(e.elm,u.createTextNode(String(e.text)))}function S(e){while(e.componentInstance)e=e.componentInstance._vnode;return r(e.tag)}function T(e,n){for(var i=0;i<s.create.length;++i)s.create[i](lr,e);t=e.data.hook,r(t)&&(r(t.create)&&t.create(lr,e),r(t.insert)&&n.push(e))}function _(e){var t;if(r(t=e.fnScopeId))u.setStyleScope(e.elm,t);else{var n=e;while(n)r(t=n.context)&&r(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t),n=n.parent}r(t=Ft)&&t!==e.context&&t!==e.fnContext&&r(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t)}function w(e,t,n,i,r,a){for(;i<=r;++i)f(n[i],a,e,t,!1,n,i)}function E(e){var t,n,i=e.data;if(r(i))for(r(t=i.hook)&&r(t=t.destroy)&&t(e),t=0;t<s.destroy.length;++t)s.destroy[t](e);if(r(t=e.children))for(n=0;n<e.children.length;++n)E(e.children[n])}function x(e,t,n,i){for(;n<=i;++n){var a=t[n];r(a)&&(r(a.tag)?(A(a),E(a)):h(a.elm))}}function A(e,t){if(r(t)||r(e.data)){var n,i=s.remove.length+1;for(r(t)?t.listeners+=i:t=d(e.elm,i),r(n=e.componentInstance)&&r(n=n._vnode)&&r(n.data)&&A(n,t),n=0;n<s.remove.length;++n)s.remove[n](e,t);r(n=e.data.hook)&&r(n=n.remove)?n(e,t):t()}else h(e.elm)}function k(e,t,n,a,s){var o,l,c,d,h=0,p=0,g=t.length-1,m=t[0],v=t[g],y=n.length-1,b=n[0],S=n[y],T=!s;while(h<=g&&p<=y)i(m)?m=t[++h]:i(v)?v=t[--g]:cr(m,b)?(C(m,b,a),m=t[++h],b=n[++p]):cr(v,S)?(C(v,S,a),v=t[--g],S=n[--y]):cr(m,S)?(C(m,S,a),T&&u.insertBefore(e,m.elm,u.nextSibling(v.elm)),m=t[++h],S=n[--y]):cr(v,b)?(C(v,b,a),T&&u.insertBefore(e,v.elm,m.elm),v=t[--g],b=n[++p]):(i(o)&&(o=hr(t,h,g)),l=r(b.key)?o[b.key]:I(b,t,h,g),i(l)?f(b,a,e,m.elm,!1,n,p):(c=t[l],cr(c,b)?(C(c,b,a),t[l]=void 0,T&&u.insertBefore(e,c.elm,m.elm)):f(b,a,e,m.elm,!1,n,p)),b=n[++p]);h>g?(d=i(n[y+1])?null:n[y+1].elm,w(e,d,n,p,y,a)):p>y&&x(e,t,h,g)}function I(e,t,n,i){for(var a=n;a<i;a++){var s=t[a];if(r(s)&&cr(e,s))return a}}function C(e,t,n,o){if(e!==t){var l=t.elm=e.elm;if(a(e.isAsyncPlaceholder))r(t.asyncFactory.resolved)?D(e.elm,t,n):t.isAsyncPlaceholder=!0;else if(a(t.isStatic)&&a(e.isStatic)&&t.key===e.key&&(a(t.isCloned)||a(t.isOnce)))t.componentInstance=e.componentInstance;else{var c,d=t.data;r(d)&&r(c=d.hook)&&r(c=c.prepatch)&&c(e,t);var h=e.children,f=t.children;if(r(d)&&S(t)){for(c=0;c<s.update.length;++c)s.update[c](e,t);r(c=d.hook)&&r(c=c.update)&&c(e,t)}i(t.text)?r(h)&&r(f)?h!==f&&k(l,h,f,n,o):r(f)?(r(e.text)&&u.setTextContent(l,""),w(l,null,f,0,f.length-1,n)):r(h)?x(l,h,0,h.length-1):r(e.text)&&u.setTextContent(l,""):e.text!==t.text&&u.setTextContent(l,t.text),r(d)&&r(c=d.hook)&&r(c=c.postpatch)&&c(e,t)}}}function R(e,t,n){if(a(n)&&r(e.parent))e.parent.data.pendingInsert=t;else for(var i=0;i<t.length;++i)t[i].data.hook.insert(t[i])}var M=g("attrs,class,staticClass,staticStyle,key");function D(e,t,n,i){var s,o=t.tag,l=t.data,u=t.children;if(i=i||l&&l.pre,t.elm=e,a(t.isComment)&&r(t.asyncFactory))return t.isAsyncPlaceholder=!0,!0;if(r(l)&&(r(s=l.hook)&&r(s=s.init)&&s(t,!0),r(s=t.componentInstance)))return m(t,n),!0;if(r(o)){if(r(u))if(e.hasChildNodes())if(r(s=l)&&r(s=s.domProps)&&r(s=s.innerHTML)){if(s!==e.innerHTML)return!1}else{for(var c=!0,d=e.firstChild,h=0;h<u.length;h++){if(!d||!D(d,u[h],n,i)){c=!1;break}d=d.nextSibling}if(!c||d)return!1}else b(t,u,n);if(r(l)){var f=!1;for(var p in l)if(!M(p)){f=!0,T(t,n);break}!f&&l["class"]&&ht(l["class"])}}else e.data!==t.text&&(e.data=t.text);return!0}return function(e,t,n,o,l,d){if(!i(t)){var h=!1,p=[];if(i(e))h=!0,f(t,p,l,d);else{var g=r(e.nodeType);if(!g&&cr(e,t))C(e,t,p,o);else{if(g){if(1===e.nodeType&&e.hasAttribute(F)&&(e.removeAttribute(F),n=!0),a(n)&&D(e,t,p))return R(t,p,!0),e;e=c(e)}var m=e.elm,v=u.parentNode(m);if(f(t,p,m._leaveCb?null:v,u.nextSibling(m)),r(t.parent)){var y=t.parent,b=S(t);while(y){for(var T=0;T<s.destroy.length;++T)s.destroy[T](y);if(y.elm=t.elm,b){for(var _=0;_<s.create.length;++_)s.create[_](lr,y);var w=y.data.hook.insert;if(w.merged)for(var A=1;A<w.fns.length;A++)w.fns[A]()}else or(y);y=y.parent}}r(v)?x(v,[e],0,0):r(e.tag)&&E(e)}}return R(t,p,h),t.elm}r(e)&&E(e)}}var pr={create:gr,update:gr,destroy:function(e){gr(e,lr)}};function gr(e,t){(e.data.directives||t.data.directives)&&mr(e,t)}function mr(e,t){var n,i,r,a=e===lr,s=t===lr,o=yr(e.data.directives,e.context),l=yr(t.data.directives,t.context),u=[],c=[];for(n in l)i=o[n],r=l[n],i?(r.oldValue=i.value,Sr(r,"update",t,e),r.def&&r.def.componentUpdated&&c.push(r)):(Sr(r,"bind",t,e),r.def&&r.def.inserted&&u.push(r));if(u.length){var d=function(){for(var n=0;n<u.length;n++)Sr(u[n],"inserted",t,e)};a?yt(t,"insert",d):d()}if(c.length&&yt(t,"postpatch",function(){for(var n=0;n<c.length;n++)Sr(c[n],"componentUpdated",t,e)}),!a)for(n in o)l[n]||Sr(o[n],"unbind",e,e,s)}var vr=Object.create(null);function yr(e,t){var n,i,r=Object.create(null);if(!e)return r;for(n=0;n<e.length;n++)i=e[n],i.modifiers||(i.modifiers=vr),r[br(i)]=i,i.def=Ke(t.$options,"directives",i.name,!0);return r}function br(e){return e.rawName||e.name+"."+Object.keys(e.modifiers||{}).join(".")}function Sr(e,t,n,i,r){var a=e.def&&e.def[t];if(a)try{a(n.elm,e,n,i,r)}catch(i){Qe(i,n.context,"directive "+e.name+" "+t+" hook")}}var Tr=[sr,pr];function _r(e,t){var n=t.componentOptions;if((!r(n)||!1!==n.Ctor.options.inheritAttrs)&&(!i(e.data.attrs)||!i(t.data.attrs))){var a,s,o,l=t.elm,u=e.data.attrs||{},c=t.data.attrs||{};for(a in r(c.__ob__)&&(c=t.data.attrs=R({},c)),c)s=c[a],o=u[a],o!==s&&wr(l,a,s);for(a in(Z||ee)&&c.value!==u.value&&wr(l,"value",c.value),u)i(c[a])&&(Ii(a)?l.removeAttributeNS(ki,Ci(a)):xi(a)||l.removeAttribute(a))}}function wr(e,t,n){e.tagName.indexOf("-")>-1?Er(e,t,n):Ai(t)?Ri(n)?e.removeAttribute(t):(n="allowfullscreen"===t&&"EMBED"===e.tagName?"true":t,e.setAttribute(t,n)):xi(t)?e.setAttribute(t,Ri(n)||"false"===n?"false":"true"):Ii(t)?Ri(n)?e.removeAttributeNS(ki,Ci(t)):e.setAttributeNS(ki,t,n):Er(e,t,n)}function Er(e,t,n){if(Ri(n))e.removeAttribute(t);else{if(Z&&!J&&"TEXTAREA"===e.tagName&&"placeholder"===t&&!e.__ieph){var i=function(t){t.stopImmediatePropagation(),e.removeEventListener("input",i)};e.addEventListener("input",i),e.__ieph=!0}e.setAttribute(t,n)}}var xr={create:_r,update:_r};function Ar(e,t){var n=t.elm,a=t.data,s=e.data;if(!(i(a.staticClass)&&i(a.class)&&(i(s)||i(s.staticClass)&&i(s.class)))){var o=Mi(t),l=n._transitionClasses;r(l)&&(o=Pi(o,Oi(l))),o!==n._prevClass&&(n.setAttribute("class",o),n._prevClass=o)}}var kr,Ir={create:Ar,update:Ar},Cr="__r",Rr="__c";function Mr(e){if(r(e[Cr])){var t=Z?"change":"input";e[t]=[].concat(e[Cr],e[t]||[]),delete e[Cr]}r(e[Rr])&&(e.change=[].concat(e[Rr],e.change||[]),delete e[Rr])}function Dr(e,t,n){var i=kr;return function r(){var a=e.apply(null,arguments);null!==a&&Pr(t,r,n,i)}}function Lr(e,t,n,i,r){t=ut(t),n&&(t=Dr(t,e,i)),kr.addEventListener(e,t,ie?{capture:i,passive:r}:i)}function Pr(e,t,n,i){(i||kr).removeEventListener(e,t._withTask||t,n)}function Or(e,t){if(!i(e.data.on)||!i(t.data.on)){var n=t.data.on||{},r=e.data.on||{};kr=t.elm,Mr(n),vt(n,r,Lr,Pr,t.context),kr=void 0}}var Nr={create:Or,update:Or};function Ur(e,t){if(!i(e.data.domProps)||!i(t.data.domProps)){var n,a,s=t.elm,o=e.data.domProps||{},l=t.data.domProps||{};for(n in r(l.__ob__)&&(l=t.data.domProps=R({},l)),o)i(l[n])&&(s[n]="");for(n in l){if(a=l[n],"textContent"===n||"innerHTML"===n){if(t.children&&(t.children.length=0),a===o[n])continue;1===s.childNodes.length&&s.removeChild(s.childNodes[0])}if("value"===n){s._value=a;var u=i(a)?"":String(a);Fr(s,u)&&(s.value=u)}else s[n]=a}}}function Fr(e,t){return!e.composing&&("OPTION"===e.tagName||Br(e,t)||Vr(e,t))}function Br(e,t){var n=!0;try{n=document.activeElement!==e}catch(e){}return n&&e.value!==t}function Vr(e,t){var n=e.value,i=e._vModifiers;if(r(i)){if(i.lazy)return!1;if(i.number)return p(n)!==p(t);if(i.trim)return n.trim()!==t.trim()}return n!==t}var jr={create:Ur,update:Ur},Gr=S(function(e){var t={},n=/;(?![^(]*\))/g,i=/:(.+)/;return e.split(n).forEach(function(e){if(e){var n=e.split(i);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t});function Hr(e){var t=zr(e.style);return e.staticStyle?R(e.staticStyle,t):t}function zr(e){return Array.isArray(e)?M(e):"string"===typeof e?Gr(e):e}function Kr(e,t){var n,i={};if(t){var r=e;while(r.componentInstance)r=r.componentInstance._vnode,r&&r.data&&(n=Hr(r.data))&&R(i,n)}(n=Hr(e.data))&&R(i,n);var a=e;while(a=a.parent)a.data&&(n=Hr(a.data))&&R(i,n);return i}var $r,Wr=/^--/,qr=/\s*!important$/,Yr=function(e,t,n){if(Wr.test(t))e.style.setProperty(t,n);else if(qr.test(n))e.style.setProperty(t,n.replace(qr,""),"important");else{var i=Qr(t);if(Array.isArray(n))for(var r=0,a=n.length;r<a;r++)e.style[i]=n[r];else e.style[i]=n}},Xr=["Webkit","Moz","ms"],Qr=S(function(e){if($r=$r||document.createElement("div").style,e=_(e),"filter"!==e&&e in $r)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),n=0;n<Xr.length;n++){var i=Xr[n]+t;if(i in $r)return i}});function Zr(e,t){var n=t.data,a=e.data;if(!(i(n.staticStyle)&&i(n.style)&&i(a.staticStyle)&&i(a.style))){var s,o,l=t.elm,u=a.staticStyle,c=a.normalizedStyle||a.style||{},d=u||c,h=zr(t.data.style)||{};t.data.normalizedStyle=r(h.__ob__)?R({},h):h;var f=Kr(t,!0);for(o in d)i(f[o])&&Yr(l,o,"");for(o in f)s=f[o],s!==d[o]&&Yr(l,o,null==s?"":s)}}var Jr={create:Zr,update:Zr};function ea(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(/\s+/).forEach(function(t){return e.classList.add(t)}):e.classList.add(t);else{var n=" "+(e.getAttribute("class")||"")+" ";n.indexOf(" "+t+" ")<0&&e.setAttribute("class",(n+t).trim())}}function ta(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(/\s+/).forEach(function(t){return e.classList.remove(t)}):e.classList.remove(t),e.classList.length||e.removeAttribute("class");else{var n=" "+(e.getAttribute("class")||"")+" ",i=" "+t+" ";while(n.indexOf(i)>=0)n=n.replace(i," ");n=n.trim(),n?e.setAttribute("class",n):e.removeAttribute("class")}}function na(e){if(e){if("object"===typeof e){var t={};return!1!==e.css&&R(t,ia(e.name||"v")),R(t,e),t}return"string"===typeof e?ia(e):void 0}}var ia=S(function(e){return{enterClass:e+"-enter",enterToClass:e+"-enter-to",enterActiveClass:e+"-enter-active",leaveClass:e+"-leave",leaveToClass:e+"-leave-to",leaveActiveClass:e+"-leave-active"}}),ra=q&&!J,aa="transition",sa="animation",oa="transition",la="transitionend",ua="animation",ca="animationend";ra&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(oa="WebkitTransition",la="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(ua="WebkitAnimation",ca="webkitAnimationEnd"));var da=q?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(e){return e()};function ha(e){da(function(){da(e)})}function fa(e,t){var n=e._transitionClasses||(e._transitionClasses=[]);n.indexOf(t)<0&&(n.push(t),ea(e,t))}function pa(e,t){e._transitionClasses&&v(e._transitionClasses,t),ta(e,t)}function ga(e,t,n){var i=va(e,t),r=i.type,a=i.timeout,s=i.propCount;if(!r)return n();var o=r===aa?la:ca,l=0,u=function(){e.removeEventListener(o,c),n()},c=function(t){t.target===e&&++l>=s&&u()};setTimeout(function(){l<s&&u()},a+1),e.addEventListener(o,c)}var ma=/\b(transform|all)(,|$)/;function va(e,t){var n,i=window.getComputedStyle(e),r=i[oa+"Delay"].split(", "),a=i[oa+"Duration"].split(", "),s=ya(r,a),o=i[ua+"Delay"].split(", "),l=i[ua+"Duration"].split(", "),u=ya(o,l),c=0,d=0;t===aa?s>0&&(n=aa,c=s,d=a.length):t===sa?u>0&&(n=sa,c=u,d=l.length):(c=Math.max(s,u),n=c>0?s>u?aa:sa:null,d=n?n===aa?a.length:l.length:0);var h=n===aa&&ma.test(i[oa+"Property"]);return{type:n,timeout:c,propCount:d,hasTransform:h}}function ya(e,t){while(e.length<t.length)e=e.concat(e);return Math.max.apply(null,t.map(function(t,n){return ba(t)+ba(e[n])}))}function ba(e){return 1e3*Number(e.slice(0,-1))}function Sa(e,t){var n=e.elm;r(n._leaveCb)&&(n._leaveCb.cancelled=!0,n._leaveCb());var a=na(e.data.transition);if(!i(a)&&!r(n._enterCb)&&1===n.nodeType){var s=a.css,o=a.type,u=a.enterClass,c=a.enterToClass,d=a.enterActiveClass,h=a.appearClass,f=a.appearToClass,g=a.appearActiveClass,m=a.beforeEnter,v=a.enter,y=a.afterEnter,b=a.enterCancelled,S=a.beforeAppear,T=a.appear,_=a.afterAppear,w=a.appearCancelled,E=a.duration,x=Ft,A=Ft.$vnode;while(A&&A.parent)A=A.parent,x=A.context;var k=!x._isMounted||!e.isRootInsert;if(!k||T||""===T){var I=k&&h?h:u,C=k&&g?g:d,R=k&&f?f:c,M=k&&S||m,D=k&&"function"===typeof T?T:v,L=k&&_||y,P=k&&w||b,O=p(l(E)?E.enter:E);0;var N=!1!==s&&!J,F=wa(D),B=n._enterCb=U(function(){N&&(pa(n,R),pa(n,C)),B.cancelled?(N&&pa(n,I),P&&P(n)):L&&L(n),n._enterCb=null});e.data.show||yt(e,"insert",function(){var t=n.parentNode,i=t&&t._pending&&t._pending[e.key];i&&i.tag===e.tag&&i.elm._leaveCb&&i.elm._leaveCb(),D&&D(n,B)}),M&&M(n),N&&(fa(n,I),fa(n,C),ha(function(){pa(n,I),B.cancelled||(fa(n,R),F||(_a(O)?setTimeout(B,O):ga(n,o,B)))})),e.data.show&&(t&&t(),D&&D(n,B)),N||F||B()}}}function Ta(e,t){var n=e.elm;r(n._enterCb)&&(n._enterCb.cancelled=!0,n._enterCb());var a=na(e.data.transition);if(i(a)||1!==n.nodeType)return t();if(!r(n._leaveCb)){var s=a.css,o=a.type,u=a.leaveClass,c=a.leaveToClass,d=a.leaveActiveClass,h=a.beforeLeave,f=a.leave,g=a.afterLeave,m=a.leaveCancelled,v=a.delayLeave,y=a.duration,b=!1!==s&&!J,S=wa(f),T=p(l(y)?y.leave:y);0;var _=n._leaveCb=U(function(){n.parentNode&&n.parentNode._pending&&(n.parentNode._pending[e.key]=null),b&&(pa(n,c),pa(n,d)),_.cancelled?(b&&pa(n,u),m&&m(n)):(t(),g&&g(n)),n._leaveCb=null});v?v(w):w()}function w(){_.cancelled||(e.data.show||((n.parentNode._pending||(n.parentNode._pending={}))[e.key]=e),h&&h(n),b&&(fa(n,u),fa(n,d),ha(function(){pa(n,u),_.cancelled||(fa(n,c),S||(_a(T)?setTimeout(_,T):ga(n,o,_)))})),f&&f(n,_),b||S||_())}}function _a(e){return"number"===typeof e&&!isNaN(e)}function wa(e){if(i(e))return!1;var t=e.fns;return r(t)?wa(Array.isArray(t)?t[0]:t):(e._length||e.length)>1}function Ea(e,t){!0!==t.data.show&&Sa(t)}var xa=q?{create:Ea,activate:Ea,remove:function(e,t){!0!==e.data.show?Ta(e,t):t()}}:{},Aa=[xr,Ir,Nr,jr,Jr,xa],ka=Aa.concat(Tr),Ia=fr({nodeOps:ar,modules:ka});J&&document.addEventListener("selectionchange",function(){var e=document.activeElement;e&&e.vmodel&&Na(e,"input")});var Ca={inserted:function(e,t,n,i){"select"===n.tag?(i.elm&&!i.elm._vOptions?yt(n,"postpatch",function(){Ca.componentUpdated(e,t,n)}):Ra(e,t,n.context),e._vOptions=[].map.call(e.options,La)):("textarea"===n.tag||Ki(e.type))&&(e._vModifiers=t.modifiers,t.modifiers.lazy||(e.addEventListener("compositionstart",Pa),e.addEventListener("compositionend",Oa),e.addEventListener("change",Oa),J&&(e.vmodel=!0)))},componentUpdated:function(e,t,n){if("select"===n.tag){Ra(e,t,n.context);var i=e._vOptions,r=e._vOptions=[].map.call(e.options,La);if(r.some(function(e,t){return!O(e,i[t])})){var a=e.multiple?t.value.some(function(e){return Da(e,r)}):t.value!==t.oldValue&&Da(t.value,r);a&&Na(e,"change")}}}};function Ra(e,t,n){Ma(e,t,n),(Z||ee)&&setTimeout(function(){Ma(e,t,n)},0)}function Ma(e,t,n){var i=t.value,r=e.multiple;if(!r||Array.isArray(i)){for(var a,s,o=0,l=e.options.length;o<l;o++)if(s=e.options[o],r)a=N(i,La(s))>-1,s.selected!==a&&(s.selected=a);else if(O(La(s),i))return void(e.selectedIndex!==o&&(e.selectedIndex=o));r||(e.selectedIndex=-1)}}function Da(e,t){return t.every(function(t){return!O(t,e)})}function La(e){return"_value"in e?e._value:e.value}function Pa(e){e.target.composing=!0}function Oa(e){e.target.composing&&(e.target.composing=!1,Na(e.target,"input"))}function Na(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}function Ua(e){return!e.componentInstance||e.data&&e.data.transition?e:Ua(e.componentInstance._vnode)}var Fa={bind:function(e,t,n){var i=t.value;n=Ua(n);var r=n.data&&n.data.transition,a=e.__vOriginalDisplay="none"===e.style.display?"":e.style.display;i&&r?(n.data.show=!0,Sa(n,function(){e.style.display=a})):e.style.display=i?a:"none"},update:function(e,t,n){var i=t.value,r=t.oldValue;if(!i!==!r){n=Ua(n);var a=n.data&&n.data.transition;a?(n.data.show=!0,i?Sa(n,function(){e.style.display=e.__vOriginalDisplay}):Ta(n,function(){e.style.display="none"})):e.style.display=i?e.__vOriginalDisplay:"none"}},unbind:function(e,t,n,i,r){r||(e.style.display=e.__vOriginalDisplay)}},Ba={model:Ca,show:Fa},Va={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function ja(e){var t=e&&e.componentOptions;return t&&t.Ctor.options.abstract?ja(Ct(t.children)):e}function Ga(e){var t={},n=e.$options;for(var i in n.propsData)t[i]=e[i];var r=n._parentListeners;for(var a in r)t[_(a)]=r[a];return t}function Ha(e,t){if(/\d-keep-alive$/.test(t.tag))return e("keep-alive",{props:t.componentOptions.propsData})}function za(e){while(e=e.parent)if(e.data.transition)return!0}function Ka(e,t){return t.key===e.key&&t.tag===e.tag}var $a={name:"transition",props:Va,abstract:!0,render:function(e){var t=this,n=this.$slots.default;if(n&&(n=n.filter(function(e){return e.tag||It(e)}),n.length)){0;var i=this.mode;0;var r=n[0];if(za(this.$vnode))return r;var a=ja(r);if(!a)return r;if(this._leaving)return Ha(e,r);var s="__transition-"+this._uid+"-";a.key=null==a.key?a.isComment?s+"comment":s+a.tag:o(a.key)?0===String(a.key).indexOf(s)?a.key:s+a.key:a.key;var l=(a.data||(a.data={})).transition=Ga(this),u=this._vnode,c=ja(u);if(a.data.directives&&a.data.directives.some(function(e){return"show"===e.name})&&(a.data.show=!0),c&&c.data&&!Ka(a,c)&&!It(c)&&(!c.componentInstance||!c.componentInstance._vnode.isComment)){var d=c.data.transition=R({},l);if("out-in"===i)return this._leaving=!0,yt(d,"afterLeave",function(){t._leaving=!1,t.$forceUpdate()}),Ha(e,r);if("in-out"===i){if(It(a))return u;var h,f=function(){h()};yt(l,"afterEnter",f),yt(l,"enterCancelled",f),yt(d,"delayLeave",function(e){h=e})}}return r}}},Wa=R({tag:String,moveClass:String},Va);delete Wa.mode;var qa={props:Wa,render:function(e){for(var t=this.tag||this.$vnode.data.tag||"span",n=Object.create(null),i=this.prevChildren=this.children,r=this.$slots.default||[],a=this.children=[],s=Ga(this),o=0;o<r.length;o++){var l=r[o];if(l.tag)if(null!=l.key&&0!==String(l.key).indexOf("__vlist"))a.push(l),n[l.key]=l,(l.data||(l.data={})).transition=s;else;}if(i){for(var u=[],c=[],d=0;d<i.length;d++){var h=i[d];h.data.transition=s,h.data.pos=h.elm.getBoundingClientRect(),n[h.key]?u.push(h):c.push(h)}this.kept=e(t,null,u),this.removed=c}return e(t,null,a)},beforeUpdate:function(){this.__patch__(this._vnode,this.kept,!1,!0),this._vnode=this.kept},updated:function(){var e=this.prevChildren,t=this.moveClass||(this.name||"v")+"-move";e.length&&this.hasMove(e[0].elm,t)&&(e.forEach(Ya),e.forEach(Xa),e.forEach(Qa),this._reflow=document.body.offsetHeight,e.forEach(function(e){if(e.data.moved){var n=e.elm,i=n.style;fa(n,t),i.transform=i.WebkitTransform=i.transitionDuration="",n.addEventListener(la,n._moveCb=function e(i){i&&!/transform$/.test(i.propertyName)||(n.removeEventListener(la,e),n._moveCb=null,pa(n,t))})}}))},methods:{hasMove:function(e,t){if(!ra)return!1;if(this._hasMove)return this._hasMove;var n=e.cloneNode();e._transitionClasses&&e._transitionClasses.forEach(function(e){ta(n,e)}),ea(n,t),n.style.display="none",this.$el.appendChild(n);var i=va(n);return this.$el.removeChild(n),this._hasMove=i.hasTransform}}};function Ya(e){e.elm._moveCb&&e.elm._moveCb(),e.elm._enterCb&&e.elm._enterCb()}function Xa(e){e.data.newPos=e.elm.getBoundingClientRect()}function Qa(e){var t=e.data.pos,n=e.data.newPos,i=t.left-n.left,r=t.top-n.top;if(i||r){e.data.moved=!0;var a=e.elm.style;a.transform=a.WebkitTransform="translate("+i+"px,"+r+"px)",a.transitionDuration="0s"}}var Za={Transition:$a,TransitionGroup:qa};oi.config.mustUseProp=Ei,oi.config.isReservedTag=ji,oi.config.isReservedAttr=_i,oi.config.getTagNamespace=Gi,oi.config.isUnknownElement=zi,R(oi.options.directives,Ba),R(oi.options.components,Za),oi.prototype.__patch__=q?Ia:D,oi.prototype.$mount=function(e,t){return e=e&&q?$i(e):void 0,jt(this,e,t)},q&&setTimeout(function(){j.devtools&&se&&se.emit("init",oi)},0),t["a"]=oi}).call(this,n("c8ba"))},"2b17":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=(r.isTypedArray,r.extend),s=(r.assert,r.each),o=r.isObject,l=n("e0d3"),u=l.getDataItemValue,c=l.isDataItemOption,d=n("3842"),h=d.parseDate,f=n("ec6f"),p=n("93d0"),g=p.SOURCE_FORMAT_TYPED_ARRAY,m=p.SOURCE_FORMAT_ARRAY_ROWS,v=p.SOURCE_FORMAT_ORIGINAL,y=p.SOURCE_FORMAT_OBJECT_ROWS;function b(e,t){f.isInstance(e)||(e=f.seriesDataToSource(e)),this._source=e;var n=this._data=e.data,i=e.sourceFormat;i===g&&(this._offset=0,this._dimSize=t,this._data=n);var r=T[i===m?i+"_"+e.seriesLayoutBy:i];a(this,r)}var S=b.prototype;S.pure=!1,S.persistent=!0,S.getSource=function(){return this._source};var T={arrayRows_column:{pure:!0,count:function(){return Math.max(0,this._data.length-this._source.startIndex)},getItem:function(e){return this._data[e+this._source.startIndex]},appendData:E},arrayRows_row:{pure:!0,count:function(){var e=this._data[0];return e?Math.max(0,e.length-this._source.startIndex):0},getItem:function(e){e+=this._source.startIndex;for(var t=[],n=this._data,i=0;i<n.length;i++){var r=n[i];t.push(r?r[e]:null)}return t},appendData:function(){throw new Error('Do not support appendData when set seriesLayoutBy: "row".')}},objectRows:{pure:!0,count:_,getItem:w,appendData:E},keyedColumns:{pure:!0,count:function(){var e=this._source.dimensionsDefine[0].name,t=this._data[e];return t?t.length:0},getItem:function(e){for(var t=[],n=this._source.dimensionsDefine,i=0;i<n.length;i++){var r=this._data[n[i].name];t.push(r?r[e]:null)}return t},appendData:function(e){var t=this._data;s(e,function(e,n){for(var i=t[n]||(t[n]=[]),r=0;r<(e||[]).length;r++)i.push(e[r])})}},original:{count:_,getItem:w,appendData:E},typedArray:{persistent:!1,pure:!0,count:function(){return this._data?this._data.length/this._dimSize:0},getItem:function(e,t){e-=this._offset,t=t||[];for(var n=this._dimSize*e,i=0;i<this._dimSize;i++)t[i]=this._data[n+i];return t},appendData:function(e){this._data=e},clean:function(){this._offset+=this.count(),this._data=null}}};function _(){return this._data.length}function w(e){return this._data[e]}function E(e){for(var t=0;t<e.length;t++)this._data.push(e[t])}var x={arrayRows:A,objectRows:function(e,t,n,i){return null!=n?e[i]:e},keyedColumns:A,original:function(e,t,n,i){var r=u(e);return null!=n&&r instanceof Array?r[n]:r},typedArray:A};function A(e,t,n,i){return null!=n?e[n]:e}var k={arrayRows:I,objectRows:function(e,t,n,i){return C(e[t],this._dimensionInfos[t])},keyedColumns:I,original:function(e,t,n,i){var r=e&&(null==e.value?e:e.value);return!this._rawData.pure&&c(e)&&(this.hasItemOption=!0),C(r instanceof Array?r[i]:r,this._dimensionInfos[t])},typedArray:function(e,t,n,i){return e[i]}};function I(e,t,n,i){return C(e[i],this._dimensionInfos[t])}function C(e,t){var n=t&&t.type;if("ordinal"===n){var i=t&&t.ordinalMeta;return i?i.parseAndCollect(e):e}return"time"===n&&"number"!==typeof e&&null!=e&&"-"!==e&&(e=+h(e)),null==e||""===e?NaN:+e}function R(e,t,n){if(e){var i=e.getRawDataItem(t);if(null!=i){var r,a,s=e.getProvider().getSource().sourceFormat,o=e.getDimensionInfo(n);return o&&(r=o.name,a=o.index),x[s](i,t,a,r)}}}function M(e,t,n){if(e){var i=e.getProvider().getSource().sourceFormat;if(i===v||i===y){var r=e.getRawDataItem(t);return i!==v||o(r)||(r=null),r?r[n]:void 0}}}t.DefaultDataProvider=b,t.defaultDimValueGetters=k,t.retrieveRawValue=R,t.retrieveRawAttr=M},"2b4c":function(e,t,n){var i=n("5537")("wks"),r=n("ca5a"),a=n("7726").Symbol,s="function"==typeof a,o=e.exports=function(e){return i[e]||(i[e]=s&&a[e]||(s?a:r)("Symbol."+e))};o.store=i},"2b61":function(e,t,n){var i=n("7d6d"),r=[["shadowBlur",0],["shadowOffsetX",0],["shadowOffsetY",0],["shadowColor","#000"],["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]],a=function(e,t){this.extendFrom(e,!1),this.host=t};function s(e,t,n){var i=null==t.x?0:t.x,r=null==t.x2?1:t.x2,a=null==t.y?0:t.y,s=null==t.y2?0:t.y2;t.global||(i=i*n.width+n.x,r=r*n.width+n.x,a=a*n.height+n.y,s=s*n.height+n.y),i=isNaN(i)?0:i,r=isNaN(r)?1:r,a=isNaN(a)?0:a,s=isNaN(s)?0:s;var o=e.createLinearGradient(i,a,r,s);return o}function o(e,t,n){var i=n.width,r=n.height,a=Math.min(i,r),s=null==t.x?.5:t.x,o=null==t.y?.5:t.y,l=null==t.r?.5:t.r;t.global||(s=s*i+n.x,o=o*r+n.y,l*=a);var u=e.createRadialGradient(s,o,0,s,o,l);return u}a.prototype={constructor:a,host:null,fill:"#000",stroke:null,opacity:1,lineDash:null,lineDashOffset:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,lineWidth:1,strokeNoScale:!1,text:null,font:null,textFont:null,fontStyle:null,fontWeight:null,fontSize:null,fontFamily:null,textTag:null,textFill:"#000",textStroke:null,textWidth:null,textHeight:null,textStrokeWidth:0,textLineHeight:null,textPosition:"inside",textRect:null,textOffset:null,textAlign:null,textVerticalAlign:null,textDistance:5,textShadowColor:"transparent",textShadowBlur:0,textShadowOffsetX:0,textShadowOffsetY:0,textBoxShadowColor:"transparent",textBoxShadowBlur:0,textBoxShadowOffsetX:0,textBoxShadowOffsetY:0,transformText:!1,textRotation:0,textOrigin:null,textBackgroundColor:null,textBorderColor:null,textBorderWidth:0,textBorderRadius:0,textPadding:null,rich:null,truncate:null,blend:null,bind:function(e,t,n){for(var a=this,s=n&&n.style,o=!s,l=0;l<r.length;l++){var u=r[l],c=u[0];(o||a[c]!==s[c])&&(e[c]=i(e,c,a[c]||u[1]))}if((o||a.fill!==s.fill)&&(e.fillStyle=a.fill),(o||a.stroke!==s.stroke)&&(e.strokeStyle=a.stroke),(o||a.opacity!==s.opacity)&&(e.globalAlpha=null==a.opacity?1:a.opacity),(o||a.blend!==s.blend)&&(e.globalCompositeOperation=a.blend||"source-over"),this.hasStroke()){var d=a.lineWidth;e.lineWidth=d/(this.strokeNoScale&&t&&t.getLineScale?t.getLineScale():1)}},hasFill:function(){var e=this.fill;return null!=e&&"none"!==e},hasStroke:function(){var e=this.stroke;return null!=e&&"none"!==e&&this.lineWidth>0},extendFrom:function(e,t){if(e)for(var n in e)!e.hasOwnProperty(n)||!0!==t&&(!1===t?this.hasOwnProperty(n):null==e[n])||(this[n]=e[n])},set:function(e,t){"string"===typeof e?this[e]=t:this.extendFrom(e,!0)},clone:function(){var e=new this.constructor;return e.extendFrom(this,!0),e},getGradient:function(e,t,n){for(var i="radial"===t.type?o:s,r=i(e,t,n),a=t.colorStops,l=0;l<a.length;l++)r.addColorStop(a[l].offset,a[l].color);return r}};for(var l=a.prototype,u=0;u<r.length;u++){var c=r[u];c[0]in l||(l[c[0]]=c[1])}a.getGradient=l.getGradient;var d=a;e.exports=d},"2c17":function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=r.createHashMap,s=r.each;i.registerProcessor({getTargetSeries:function(e){var t=a();return e.eachComponent("dataZoom",function(e){e.eachTargetAxis(function(e,n,i){var r=i.getAxisProxy(e.name,n);s(r.getTargetSeriesModels(),function(e){t.set(e.uid,e)})})}),t},modifyOutputEnd:!0,overallReset:function(e,t){e.eachComponent("dataZoom",function(e){e.eachTargetAxis(function(e,n,i){i.getAxisProxy(e.name,n).reset(i,t)}),e.eachTargetAxis(function(e,n,i){i.getAxisProxy(e.name,n).filterData(i,t)})}),e.eachComponent("dataZoom",function(e){var t=e.findRepresentativeAxisProxy(),n=t.getDataPercentWindow(),i=t.getDataValueWindow();e.setRawRange({start:n[0],end:n[1],startValue:i[0],endValue:i[1]},!0)})}})},"2cf4":function(e,t){var n=1;"undefined"!==typeof window&&(n=Math.max(window.devicePixelRatio||1,1));var i=0,r=n;t.debugMode=i,t.devicePixelRatio=r},"2d00":function(e,t){e.exports=!1},"2d95":function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},"2f45":function(e,t,n){var i=n("6d8b"),r=i.each,a=i.createHashMap,s=(i.assert,n("4e08")),o=(s.__DEV__,a(["tooltip","label","itemName","itemId","seriesName"]));function l(e){var t={},n=t.encode={},i=a(),s=[],l=[];r(e.dimensions,function(t){var r=e.getDimensionInfo(t),a=r.coordDim;if(a){var u=n[a];n.hasOwnProperty(a)||(u=n[a]=[]),u[r.coordDimIndex]=t,r.isExtraCoord||(i.set(a,1),c(r.type)&&(s[0]=t)),r.defaultTooltip&&l.push(t)}o.each(function(e,t){var i=n[t];n.hasOwnProperty(t)||(i=n[t]=[]);var a=r.otherDims[t];null!=a&&!1!==a&&(i[a]=r.name)})});var u=[],d={};i.each(function(e,t){var i=n[t];d[t]=i[0],u=u.concat(i)}),t.dataDimsOnCoord=u,t.encodeFirstDimNotExtra=d;var h=n.label;h&&h.length&&(s=h.slice());var f=n.tooltip;return f&&f.length?l=f.slice():l.length||(l=s.slice()),n.defaultedLabel=s,n.defaultedTooltip=l,t}function u(e){return"category"===e?"ordinal":"time"===e?"time":"float"}function c(e){return!("ordinal"===e||"time"===e)}t.OTHER_DIMENSIONS=o,t.summarizeDimensions=l,t.getDimensionTypeByAxis=u},3014:function(e,t,n){var i=n("4f85"),r=n("3301"),a=i.extend({type:"series.__base_bar__",getInitialData:function(e,t){return r(this.getSource(),this)},getMarkerPosition:function(e){var t=this.coordinateSystem;if(t){var n=t.dataToPoint(t.clampData(e)),i=this.getData(),r=i.getLayout("offset"),a=i.getLayout("size"),s=t.getBaseAxis().isHorizontal()?0:1;return n[s]+=r+a/2,n}return[NaN,NaN]},defaultOption:{zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,large:!1,largeThreshold:400,progressive:5e3,progressiveChunkMode:"mod",itemStyle:{},emphasis:{}}});e.exports=a},"30a3":function(e,t,n){var i=n("6d8b"),r=n("607d"),a=r.Dispatcher,s=n("98b7"),o=n("06ad"),l=function(e){e=e||{},this.stage=e.stage||{},this.onframe=e.onframe||function(){},this._clips=[],this._running=!1,this._time,this._pausedTime,this._pauseStart,this._paused=!1,a.call(this)};l.prototype={constructor:l,addClip:function(e){this._clips.push(e)},addAnimator:function(e){e.animation=this;for(var t=e.getClips(),n=0;n<t.length;n++)this.addClip(t[n])},removeClip:function(e){var t=i.indexOf(this._clips,e);t>=0&&this._clips.splice(t,1)},removeAnimator:function(e){for(var t=e.getClips(),n=0;n<t.length;n++)this.removeClip(t[n]);e.animation=null},_update:function(){for(var e=(new Date).getTime()-this._pausedTime,t=e-this._time,n=this._clips,i=n.length,r=[],a=[],s=0;s<i;s++){var o=n[s],l=o.step(e,t);l&&(r.push(l),a.push(o))}for(s=0;s<i;)n[s]._needsRemove?(n[s]=n[i-1],n.pop(),i--):s++;i=r.length;for(s=0;s<i;s++)a[s].fire(r[s]);this._time=e,this.onframe(t),this.trigger("frame",t),this.stage.update&&this.stage.update()},_startLoop:function(){var e=this;function t(){e._running&&(s(t),!e._paused&&e._update())}this._running=!0,s(t)},start:function(){this._time=(new Date).getTime(),this._pausedTime=0,this._startLoop()},stop:function(){this._running=!1},pause:function(){this._paused||(this._pauseStart=(new Date).getTime(),this._paused=!0)},resume:function(){this._paused&&(this._pausedTime+=(new Date).getTime()-this._pauseStart,this._paused=!1)},clear:function(){this._clips=[]},isFinished:function(){return!this._clips.length},animate:function(e,t){t=t||{};var n=new o(e,t.loop,t.getter,t.setter);return this.addAnimator(n),n}},i.mixin(l,a);var u=l;e.exports=u},"31f4":function(e,t){e.exports=function(e,t,n){var i=void 0===n;switch(t.length){case 0:return i?e():e.call(n);case 1:return i?e(t[0]):e.call(n,t[0]);case 2:return i?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},"32e9":function(e,t,n){var i=n("86cc"),r=n("4630");e.exports=n("9e1e")?function(e,t,n){return i.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},3301:function(e,t,n){var i=n("6d8b"),r=n("6179"),a=n("b1d4"),s=n("93d0"),o=s.SOURCE_FORMAT_ORIGINAL,l=n("2f45"),u=l.getDimensionTypeByAxis,c=n("e0d3"),d=c.getDataItemValue,h=n("2039"),f=n("8b7f"),p=f.getCoordSysDefineBySeries,g=n("ec6f"),m=n("ee1a"),v=m.enableDataStack;function y(e,t,n){n=n||{},g.isInstance(e)||(e=g.seriesDataToSource(e));var s,o=t.get("coordinateSystem"),l=h.get(o),c=p(t);c&&(s=i.map(c.coordSysDims,function(e){var t={name:e},n=c.axisMap.get(e);if(n){var i=n.get("type");t.type=u(i)}return t})),s||(s=l&&(l.getDimensionsInfo?l.getDimensionsInfo():l.dimensions.slice())||["x","y"]);var d,f,m=a(e,{coordDimensions:s,generateCoord:n.generateCoord});c&&i.each(m,function(e,t){var n=e.coordDim,i=c.categoryAxisMap.get(n);i&&(null==d&&(d=t),e.ordinalMeta=i.getOrdinalMeta()),null!=e.otherDims.itemName&&(f=!0)}),f||null==d||(m[d].otherDims.itemName=0);var y=v(t,m),S=new r(m,t);S.setCalculationInfo(y);var T=null!=d&&b(e)?function(e,t,n,i){return i===d?n:this.defaultDimValueGetter(e,t,n,i)}:null;return S.hasItemOption=!1,S.initData(e,null,T),S}function b(e){if(e.sourceFormat===o){var t=S(e.data||[]);return null!=t&&!i.isArray(d(t))}}function S(e){var t=0;while(t<e.length&&null==e[t])t++;return e[t]}var T=y;e.exports=T},"33a4":function(e,t,n){var i=n("84f2"),r=n("2b4c")("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[r]===e)}},"342d":function(e,t,n){var i=n("cbe5"),r=n("20c8"),a=n("ee84"),s=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"],o=Math.sqrt,l=Math.sin,u=Math.cos,c=Math.PI,d=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},h=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(d(e)*d(t))},f=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(h(e,t))};function p(e,t,n,i,r,a,s,d,p,g,m){var v=p*(c/180),y=u(v)*(e-n)/2+l(v)*(t-i)/2,b=-1*l(v)*(e-n)/2+u(v)*(t-i)/2,S=y*y/(s*s)+b*b/(d*d);S>1&&(s*=o(S),d*=o(S));var T=(r===a?-1:1)*o((s*s*(d*d)-s*s*(b*b)-d*d*(y*y))/(s*s*(b*b)+d*d*(y*y)))||0,_=T*s*b/d,w=T*-d*y/s,E=(e+n)/2+u(v)*_-l(v)*w,x=(t+i)/2+l(v)*_+u(v)*w,A=f([1,0],[(y-_)/s,(b-w)/d]),k=[(y-_)/s,(b-w)/d],I=[(-1*y-_)/s,(-1*b-w)/d],C=f(k,I);h(k,I)<=-1&&(C=c),h(k,I)>=1&&(C=0),0===a&&C>0&&(C-=2*c),1===a&&C<0&&(C+=2*c),m.addData(g,E,x,s,d,A,C,v,a)}function g(e){if(!e)return[];var t,n=e.replace(/-/g," -").replace(/  /g," ").replace(/ /g,",").replace(/,,/g,",");for(t=0;t<s.length;t++)n=n.replace(new RegExp(s[t],"g"),"|"+s[t]);var i,a=n.split("|"),o=0,l=0,u=new r,c=r.CMD;for(t=1;t<a.length;t++){var d,h=a[t],f=h.charAt(0),g=0,m=h.slice(1).replace(/e,-/g,"e-").split(",");m.length>0&&""===m[0]&&m.shift();for(var v=0;v<m.length;v++)m[v]=parseFloat(m[v]);while(g<m.length&&!isNaN(m[g])){if(isNaN(m[0]))break;var y,b,S,T,_,w,E,x=o,A=l;switch(f){case"l":o+=m[g++],l+=m[g++],d=c.L,u.addData(d,o,l);break;case"L":o=m[g++],l=m[g++],d=c.L,u.addData(d,o,l);break;case"m":o+=m[g++],l+=m[g++],d=c.M,u.addData(d,o,l),f="l";break;case"M":o=m[g++],l=m[g++],d=c.M,u.addData(d,o,l),f="L";break;case"h":o+=m[g++],d=c.L,u.addData(d,o,l);break;case"H":o=m[g++],d=c.L,u.addData(d,o,l);break;case"v":l+=m[g++],d=c.L,u.addData(d,o,l);break;case"V":l=m[g++],d=c.L,u.addData(d,o,l);break;case"C":d=c.C,u.addData(d,m[g++],m[g++],m[g++],m[g++],m[g++],m[g++]),o=m[g-2],l=m[g-1];break;case"c":d=c.C,u.addData(d,m[g++]+o,m[g++]+l,m[g++]+o,m[g++]+l,m[g++]+o,m[g++]+l),o+=m[g-2],l+=m[g-1];break;case"S":y=o,b=l;var k=u.len(),I=u.data;i===c.C&&(y+=o-I[k-4],b+=l-I[k-3]),d=c.C,x=m[g++],A=m[g++],o=m[g++],l=m[g++],u.addData(d,y,b,x,A,o,l);break;case"s":y=o,b=l;k=u.len(),I=u.data;i===c.C&&(y+=o-I[k-4],b+=l-I[k-3]),d=c.C,x=o+m[g++],A=l+m[g++],o+=m[g++],l+=m[g++],u.addData(d,y,b,x,A,o,l);break;case"Q":x=m[g++],A=m[g++],o=m[g++],l=m[g++],d=c.Q,u.addData(d,x,A,o,l);break;case"q":x=m[g++]+o,A=m[g++]+l,o+=m[g++],l+=m[g++],d=c.Q,u.addData(d,x,A,o,l);break;case"T":y=o,b=l;k=u.len(),I=u.data;i===c.Q&&(y+=o-I[k-4],b+=l-I[k-3]),o=m[g++],l=m[g++],d=c.Q,u.addData(d,y,b,o,l);break;case"t":y=o,b=l;k=u.len(),I=u.data;i===c.Q&&(y+=o-I[k-4],b+=l-I[k-3]),o+=m[g++],l+=m[g++],d=c.Q,u.addData(d,y,b,o,l);break;case"A":S=m[g++],T=m[g++],_=m[g++],w=m[g++],E=m[g++],x=o,A=l,o=m[g++],l=m[g++],d=c.A,p(x,A,o,l,w,E,S,T,_,d,u);break;case"a":S=m[g++],T=m[g++],_=m[g++],w=m[g++],E=m[g++],x=o,A=l,o+=m[g++],l+=m[g++],d=c.A,p(x,A,o,l,w,E,S,T,_,d,u);break}}"z"!==f&&"Z"!==f||(d=c.Z,u.addData(d)),i=d}return u.toStatic(),u}function m(e,t){var n=g(e);return t=t||{},t.buildPath=function(e){if(e.setData){e.setData(n.data);var t=e.getContext();t&&e.rebuildPath(t)}else{t=e;n.rebuildPath(t)}},t.applyTransform=function(e){a(n,e),this.dirty(!0)},t}function v(e,t){return new i(m(e,t))}function y(e,t){return i.extend(m(e,t))}function b(e,t){for(var n=[],r=e.length,a=0;a<r;a++){var s=e[a];s.path||s.createPathProxy(),s.__dirtyPath&&s.buildPath(s.path,s.shape,!0),n.push(s.path)}var o=new i(t);return o.createPathProxy(),o.buildPath=function(e){e.appendPath(n);var t=e.getContext();t&&e.rebuildPath(t)},o}t.createFromString=v,t.extendFromString=y,t.mergePath=b},3842:function(e,t,n){var i=n("6d8b"),r=1e-4;function a(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function s(e,t,n,i){var r=t[1]-t[0],a=n[1]-n[0];if(0===r)return 0===a?n[0]:(n[0]+n[1])/2;if(i)if(r>0){if(e<=t[0])return n[0];if(e>=t[1])return n[1]}else{if(e>=t[0])return n[0];if(e<=t[1])return n[1]}else{if(e===t[0])return n[0];if(e===t[1])return n[1]}return(e-t[0])/r*a+n[0]}function o(e,t){switch(e){case"center":case"middle":e="50%";break;case"left":case"top":e="0%";break;case"right":case"bottom":e="100%";break}return"string"===typeof e?a(e).match(/%$/)?parseFloat(e)/100*t:parseFloat(e):null==e?NaN:+e}function l(e,t,n){return null==t&&(t=10),t=Math.min(Math.max(0,t),20),e=(+e).toFixed(t),n?e:+e}function u(e){return e.sort(function(e,t){return e-t}),e}function c(e){if(e=+e,isNaN(e))return 0;var t=1,n=0;while(Math.round(e*t)/t!==e)t*=10,n++;return n}function d(e){var t=e.toString(),n=t.indexOf("e");if(n>0){var i=+t.slice(n+1);return i<0?-i:0}var r=t.indexOf(".");return r<0?0:t.length-1-r}function h(e,t){var n=Math.log,i=Math.LN10,r=Math.floor(n(e[1]-e[0])/i),a=Math.round(n(Math.abs(t[1]-t[0]))/i),s=Math.min(Math.max(-r+a,0),20);return isFinite(s)?s:20}function f(e,t,n){if(!e[t])return 0;var r=i.reduce(e,function(e,t){return e+(isNaN(t)?0:t)},0);if(0===r)return 0;var a=Math.pow(10,n),s=i.map(e,function(e){return(isNaN(e)?0:e)/r*a*100}),o=100*a,l=i.map(s,function(e){return Math.floor(e)}),u=i.reduce(l,function(e,t){return e+t},0),c=i.map(s,function(e,t){return e-l[t]});while(u<o){for(var d=Number.NEGATIVE_INFINITY,h=null,f=0,p=c.length;f<p;++f)c[f]>d&&(d=c[f],h=f);++l[h],c[h]=0,++u}return l[t]/a}var p=9007199254740991;function g(e){var t=2*Math.PI;return(e%t+t)%t}function m(e){return e>-r&&e<r}var v=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d\d)(?::(\d\d)(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function y(e){if(e instanceof Date)return e;if("string"===typeof e){var t=v.exec(e);if(!t)return new Date(NaN);if(t[8]){var n=+t[4]||0;return"Z"!==t[8].toUpperCase()&&(n-=t[8].slice(0,3)),new Date(Date.UTC(+t[1],+(t[2]||1)-1,+t[3]||1,n,+(t[5]||0),+t[6]||0,+t[7]||0))}return new Date(+t[1],+(t[2]||1)-1,+t[3]||1,+t[4]||0,+(t[5]||0),+t[6]||0,+t[7]||0)}return null==e?new Date(NaN):new Date(Math.round(e))}function b(e){return Math.pow(10,S(e))}function S(e){return Math.floor(Math.log(e)/Math.LN10)}function T(e,t){var n,i=S(e),r=Math.pow(10,i),a=e/r;return n=t?a<1.5?1:a<2.5?2:a<4?3:a<7?5:10:a<1?1:a<2?2:a<3?3:a<5?5:10,e=n*r,i>=-20?+e.toFixed(i<0?-i:0):e}function _(e){e.sort(function(e,t){return o(e,t,0)?-1:1});for(var t=-1/0,n=1,i=0;i<e.length;){for(var r=e[i].interval,a=e[i].close,s=0;s<2;s++)r[s]<=t&&(r[s]=t,a[s]=s?1:1-n),t=r[s],n=a[s];r[0]===r[1]&&a[0]*a[1]!==1?e.splice(i,1):i++}return e;function o(e,t,n){return e.interval[n]<t.interval[n]||e.interval[n]===t.interval[n]&&(e.close[n]-t.close[n]===(n?-1:1)||!n&&o(e,t,1))}}function w(e){return e-parseFloat(e)>=0}t.linearMap=s,t.parsePercent=o,t.round=l,t.asc=u,t.getPrecision=c,t.getPrecisionSafe=d,t.getPixelPrecision=h,t.getPercentWithPrecision=f,t.MAX_SAFE_INTEGER=p,t.remRadian=g,t.isRadianAroundZero=m,t.parseDate=y,t.quantity=b,t.nice=T,t.reformIntervals=_,t.isNumeric=w},3846:function(e,t,n){n("9e1e")&&"g"!=/./g.flags&&n("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:n("0bfb")})},"386d":function(e,t,n){n("214f")("search",1,function(e,t,n){return[function(n){"use strict";var i=e(this),r=void 0==n?void 0:n[t];return void 0!==r?r.call(n,i):new RegExp(n)[t](String(i))},n]})},"38a2":function(e,t,n){var i=n("2b17"),r=i.retrieveRawValue,a=n("eda2"),s=a.getTooltipMarker,o=a.formatTpl,l=/\{@(.+?)\}/g,u={getDataParams:function(e,t){var n=this.getData(t),i=this.getRawValue(e,t),r=n.getRawIndex(e),a=n.getName(e),o=n.getRawDataItem(e),l=n.getItemVisual(e,"color");return{componentType:this.mainType,componentSubType:this.subType,seriesType:"series"===this.mainType?this.subType:null,seriesIndex:this.seriesIndex,seriesId:this.id,seriesName:this.name,name:a,dataIndex:r,data:o,dataType:t,value:i,color:l,marker:s(l),$vars:["seriesName","name","value"]}},getFormattedLabel:function(e,t,n,i,a){t=t||"normal";var s=this.getData(n),u=s.getItemModel(e),c=this.getDataParams(e,n);null!=i&&c.value instanceof Array&&(c.value=c.value[i]);var d=u.get("normal"===t?[a||"label","formatter"]:[t,a||"label","formatter"]);if("function"===typeof d)return c.status=t,d(c);if("string"===typeof d){var h=o(d,c);return h.replace(l,function(t,n){var i=n.length;return"["===n.charAt(0)&&"]"===n.charAt(i-1)&&(n=+n.slice(1,i-1)),r(s,e,n)})}},getRawValue:function(e,t){return r(this.getData(t),e)},formatTooltip:function(){}};e.exports=u},"38fd":function(e,t,n){var i=n("69a8"),r=n("4bf8"),a=n("613b")("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=r(e),i(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},3901:function(e,t,n){var i=n("282b"),r=i([["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),a={getLineStyle:function(e){var t=r(this,e),n=this.getLineDash(t.lineWidth);return n&&(t.lineDash=n),t},getLineDash:function(e){null==e&&(e=1);var t=this.get("type"),n=Math.max(e,2),i=4*e;return"solid"===t||null==t?null:"dashed"===t?[i,i]:[n,n]}};e.exports=a},"392f":function(e,t,n){var i=n("6d8b"),r=i.inherits,a=n("19eb"),s=n("9850");function o(e){a.call(this,e),this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.notClear=!0}o.prototype.incremental=!0,o.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.dirty(),this.notClear=!1},o.prototype.addDisplayable=function(e,t){t?this._temporaryDisplayables.push(e):this._displayables.push(e),this.dirty()},o.prototype.addDisplayables=function(e,t){t=t||!1;for(var n=0;n<e.length;n++)this.addDisplayable(e[n],t)},o.prototype.eachPendingDisplayable=function(e){for(var t=this._cursor;t<this._displayables.length;t++)e&&e(this._displayables[t]);for(t=0;t<this._temporaryDisplayables.length;t++)e&&e(this._temporaryDisplayables[t])},o.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++){var t=this._displayables[e];t.parent=this,t.update(),t.parent=null}for(e=0;e<this._temporaryDisplayables.length;e++){t=this._temporaryDisplayables[e];t.parent=this,t.update(),t.parent=null}},o.prototype.brush=function(e,t){for(var n=this._cursor;n<this._displayables.length;n++){var i=this._displayables[n];i.beforeBrush&&i.beforeBrush(e),i.brush(e,n===this._cursor?null:this._displayables[n-1]),i.afterBrush&&i.afterBrush(e)}this._cursor=n;for(n=0;n<this._temporaryDisplayables.length;n++){i=this._temporaryDisplayables[n];i.beforeBrush&&i.beforeBrush(e),i.brush(e,0===n?null:this._temporaryDisplayables[n-1]),i.afterBrush&&i.afterBrush(e)}this._temporaryDisplayables=[],this.notClear=!0};var l=[];o.prototype.getBoundingRect=function(){if(!this._rect){for(var e=new s(1/0,1/0,-1/0,-1/0),t=0;t<this._displayables.length;t++){var n=this._displayables[t],i=n.getBoundingRect().clone();n.needLocalTransform()&&i.applyTransform(n.getLocalTransform(l)),e.union(i)}this._rect=e}return this._rect},o.prototype.contain=function(e,t){var n=this.transformCoordToLocal(e,t),i=this.getBoundingRect();if(i.contain(n[0],n[1]))for(var r=0;r<this._displayables.length;r++){var a=this._displayables[r];if(a.contain(e,t))return!0}return!1},r(o,a);var u=o;e.exports=u},"3a56":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("3eba")),a=n("6d8b"),s=n("22d1"),o=n("e0d3"),l=n("50e5"),u=n("cc39"),c=a.each,d=l.eachAxisDim,h=r.extendComponentModel({type:"dataZoom",dependencies:["xAxis","yAxis","zAxis","radiusAxis","angleAxis","singleAxis","series"],defaultOption:{zlevel:0,z:4,orient:null,xAxisIndex:null,yAxisIndex:null,filterMode:"filter",throttle:null,start:0,end:100,startValue:null,endValue:null,minSpan:null,maxSpan:null,minValueSpan:null,maxValueSpan:null,rangeMode:null},init:function(e,t,n){this._dataIntervalByAxis={},this._dataInfo={},this._axisProxies={},this.textStyleModel,this._autoThrottle=!0,this._rangePropMode=["percent","percent"];var i=f(e);this.mergeDefaultAndTheme(e,n),this.doInit(i)},mergeOption:function(e){var t=f(e);a.merge(this.option,e,!0),this.doInit(t)},doInit:function(e){var t=this.option;s.canvasSupported||(t.realtime=!1),this._setDefaultThrottle(e),p(this,e),c([["start","startValue"],["end","endValue"]],function(e,n){"value"===this._rangePropMode[n]&&(t[e[0]]=null)},this),this.textStyleModel=this.getModel("textStyle"),this._resetTarget(),this._giveAxisProxies()},_giveAxisProxies:function(){var e=this._axisProxies;this.eachTargetAxis(function(t,n,i,r){var a=this.dependentModels[t.axis][n],s=a.__dzAxisProxy||(a.__dzAxisProxy=new u(t.name,n,this,r));e[t.name+"_"+n]=s},this)},_resetTarget:function(){var e=this.option,t=this._judgeAutoMode();d(function(t){var n=t.axisIndex;e[n]=o.normalizeToArray(e[n])},this),"axisIndex"===t?this._autoSetAxisIndex():"orient"===t&&this._autoSetOrient()},_judgeAutoMode:function(){var e=this.option,t=!1;d(function(n){null!=e[n.axisIndex]&&(t=!0)},this);var n=e.orient;return null==n&&t?"orient":t?void 0:(null==n&&(e.orient="horizontal"),"axisIndex")},_autoSetAxisIndex:function(){var e=!0,t=this.get("orient",!0),n=this.option,i=this.dependentModels;if(e){var r="vertical"===t?"y":"x";i[r+"Axis"].length?(n[r+"AxisIndex"]=[0],e=!1):c(i.singleAxis,function(i){e&&i.get("orient",!0)===t&&(n.singleAxisIndex=[i.componentIndex],e=!1)})}e&&d(function(t){if(e){var i=[],r=this.dependentModels[t.axis];if(r.length&&!i.length)for(var a=0,s=r.length;a<s;a++)"category"===r[a].get("type")&&i.push(a);n[t.axisIndex]=i,i.length&&(e=!1)}},this),e&&this.ecModel.eachSeries(function(e){this._isSeriesHasAllAxesTypeOf(e,"value")&&d(function(t){var i=n[t.axisIndex],r=e.get(t.axisIndex),s=e.get(t.axisId),o=e.ecModel.queryComponents({mainType:t.axis,index:r,id:s})[0];r=o.componentIndex,a.indexOf(i,r)<0&&i.push(r)})},this)},_autoSetOrient:function(){var e;this.eachTargetAxis(function(t){!e&&(e=t.name)},this),this.option.orient="y"===e?"vertical":"horizontal"},_isSeriesHasAllAxesTypeOf:function(e,t){var n=!0;return d(function(i){var r=e.get(i.axisIndex),a=this.dependentModels[i.axis][r];a&&a.get("type")===t||(n=!1)},this),n},_setDefaultThrottle:function(e){if(e.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var t=this.ecModel.option;this.option.throttle=t.animation&&t.animationDurationUpdate>0?100:20}},getFirstTargetAxisModel:function(){var e;return d(function(t){if(null==e){var n=this.get(t.axisIndex);n.length&&(e=this.dependentModels[t.axis][n[0]])}},this),e},eachTargetAxis:function(e,t){var n=this.ecModel;d(function(i){c(this.get(i.axisIndex),function(r){e.call(t,i,r,this,n)},this)},this)},getAxisProxy:function(e,t){return this._axisProxies[e+"_"+t]},getAxisModel:function(e,t){var n=this.getAxisProxy(e,t);return n&&n.getAxisModel()},setRawRange:function(e,t){var n=this.option;c([["start","startValue"],["end","endValue"]],function(t){null==e[t[0]]&&null==e[t[1]]||(n[t[0]]=e[t[0]],n[t[1]]=e[t[1]])},this),!t&&p(this,e)},getPercentRange:function(){var e=this.findRepresentativeAxisProxy();if(e)return e.getDataPercentWindow()},getValueRange:function(e,t){if(null!=e||null!=t)return this.getAxisProxy(e,t).getDataValueWindow();var n=this.findRepresentativeAxisProxy();return n?n.getDataValueWindow():void 0},findRepresentativeAxisProxy:function(e){if(e)return e.__dzAxisProxy;var t=this._axisProxies;for(var n in t)if(t.hasOwnProperty(n)&&t[n].hostedBy(this))return t[n];for(var n in t)if(t.hasOwnProperty(n)&&!t[n].hostedBy(this))return t[n]},getRangePropMode:function(){return this._rangePropMode.slice()}});function f(e){var t={};return c(["start","end","startValue","endValue","throttle"],function(n){e.hasOwnProperty(n)&&(t[n]=e[n])}),t}function p(e,t){var n=e._rangePropMode,i=e.get("rangeMode");c([["start","startValue"],["end","endValue"]],function(e,r){var a=null!=t[e[0]],s=null!=t[e[1]];a&&!s?n[r]="percent":!a&&s?n[r]="value":i?n[r]=i[r]:a&&(n[r]="percent")})}var g=h;e.exports=g},"3b2b":function(e,t,n){var i=n("7726"),r=n("5dbc"),a=n("86cc").f,s=n("9093").f,o=n("aae3"),l=n("0bfb"),u=i.RegExp,c=u,d=u.prototype,h=/a/g,f=/a/g,p=new u(h)!==h;if(n("9e1e")&&(!p||n("79e5")(function(){return f[n("2b4c")("match")]=!1,u(h)!=h||u(f)==f||"/a/i"!=u(h,"i")}))){u=function(e,t){var n=this instanceof u,i=o(e),a=void 0===t;return!n&&i&&e.constructor===u&&a?e:r(p?new c(i&&!a?e.source:e,t):c((i=e instanceof u)?e.source:e,i&&a?l.call(e):t),n?this:d,u)};for(var g=function(e){e in u||a(u,e,{configurable:!0,get:function(){return c[e]},set:function(t){c[e]=t}})},m=s(c),v=0;m.length>v;)g(m[v++]);d.constructor=u,u.prototype=d,n("2aba")(i,"RegExp",u)}n("7a56")("RegExp")},"3eba":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("697e7")),a=n("6d8b"),s=n("41ef"),o=n("22d1"),l=n("04f6"),u=n("1fab"),c=n("7e63"),d=n("843e"),h=n("2039"),f=n("ca98"),p=n("fb05"),g=n("d15d"),m=n("6cb7"),v=n("4f85"),y=n("b12f"),b=n("e887"),S=n("2306"),T=n("e0d3"),_=n("88b3"),w=_.throttle,E=n("fd63"),x=n("b809"),A=n("998c"),k=n("69ff"),I=n("c533"),C=n("f219");n("0352");var R=a.assert,M=a.each,D=a.isFunction,L=a.isObject,P=m.parseClassType,O="4.1.0",N={zrender:"4.0.4"},U=1,F=1e3,B=5e3,V=1e3,j=2e3,G=3e3,H=4e3,z=5e3,K={PROCESSOR:{FILTER:F,STATISTIC:B},VISUAL:{LAYOUT:V,GLOBAL:j,CHART:G,COMPONENT:H,BRUSH:z}},$="__flagInMainProcess",W="__optionUpdated",q=/^[a-zA-Z0-9_]+$/;function Y(e){return function(t,n,i){t=t&&t.toLowerCase(),u.prototype[e].call(this,t,n,i)}}function X(){u.call(this)}function Q(e,t,n){n=n||{},"string"===typeof t&&(t=xe[t]),this.id,this.group,this._dom=e;var i="canvas",s=this._zr=r.init(e,{renderer:n.renderer||i,devicePixelRatio:n.devicePixelRatio,width:n.width,height:n.height});this._throttledZrFlush=w(a.bind(s.flush,s),17);t=a.clone(t);t&&p(t,!0),this._theme=t,this._chartsViews=[],this._chartsMap={},this._componentsViews=[],this._componentsMap={},this._coordSysMgr=new h;var o=this._api=ye(this);function c(e,t){return e.__prio-t.__prio}l(Ee,c),l(Te,c),this._scheduler=new k(this,o,Te,Ee),u.call(this),this._messageCenter=new X,this._initEvents(),this.resize=a.bind(this.resize,this),this._pendingActions=[],s.animation.on("frame",this._onframe,this),oe(s,this),a.setAsPrimitive(this)}X.prototype.on=Y("on"),X.prototype.off=Y("off"),X.prototype.one=Y("one"),a.mixin(X,u);var Z=Q.prototype;function J(e,t,n){var i,r=this._model,a=this._coordSysMgr.getCoordinateSystems();t=T.parseFinder(r,t);for(var s=0;s<a.length;s++){var o=a[s];if(o[e]&&null!=(i=o[e](r,t,n)))return i}}Z._onframe=function(){if(!this._disposed){var e=this._scheduler;if(this[W]){var t=this[W].silent;this[$]=!0,te(this),ee.update.call(this),this[$]=!1,this[W]=!1,ae.call(this,t),se.call(this,t)}else if(e.unfinished){var n=U,i=this._model,r=this._api;e.unfinished=!1;do{var a=+new Date;e.performSeriesTasks(i),e.performDataProcessorTasks(i),ie(this,i),e.performVisualTasks(i),he(this,this._model,r,"remain"),n-=+new Date-a}while(n>0&&e.unfinished);e.unfinished||this._zr.flush()}}},Z.getDom=function(){return this._dom},Z.getZr=function(){return this._zr},Z.setOption=function(e,t,n){var i;if(L(t)&&(n=t.lazyUpdate,i=t.silent,t=t.notMerge),this[$]=!0,!this._model||t){var r=new f(this._api),a=this._theme,s=this._model=new c(null,null,a,r);s.scheduler=this._scheduler,s.init(null,null,a,r)}this._model.setOption(e,_e),n?(this[W]={silent:i},this[$]=!1):(te(this),ee.update.call(this),this._zr.flush(),this[W]=!1,this[$]=!1,ae.call(this,i),se.call(this,i))},Z.setTheme=function(){console.log("ECharts#setTheme() is DEPRECATED in ECharts 3.0")},Z.getModel=function(){return this._model},Z.getOption=function(){return this._model&&this._model.getOption()},Z.getWidth=function(){return this._zr.getWidth()},Z.getHeight=function(){return this._zr.getHeight()},Z.getDevicePixelRatio=function(){return this._zr.painter.dpr||window.devicePixelRatio||1},Z.getRenderedCanvas=function(e){if(o.canvasSupported){e=e||{},e.pixelRatio=e.pixelRatio||1,e.backgroundColor=e.backgroundColor||this._model.get("backgroundColor");var t=this._zr;return t.painter.getRenderedCanvas(e)}},Z.getSvgDataUrl=function(){if(o.svgSupported){var e=this._zr,t=e.storage.getDisplayList();return a.each(t,function(e){e.stopAnimation(!0)}),e.painter.pathToDataUrl()}},Z.getDataURL=function(e){e=e||{};var t=e.excludeComponents,n=this._model,i=[],r=this;M(t,function(e){n.eachComponent({mainType:e},function(e){var t=r._componentsMap[e.__viewId];t.group.ignore||(i.push(t),t.group.ignore=!0)})});var a="svg"===this._zr.painter.getType()?this.getSvgDataUrl():this.getRenderedCanvas(e).toDataURL("image/"+(e&&e.type||"png"));return M(i,function(e){e.group.ignore=!1}),a},Z.getConnectedDataURL=function(e){if(o.canvasSupported){var t=this.group,n=Math.min,i=Math.max,s=1/0;if(Ie[t]){var l=s,u=s,c=-s,d=-s,h=[],f=e&&e.pixelRatio||1;a.each(ke,function(r,s){if(r.group===t){var o=r.getRenderedCanvas(a.clone(e)),f=r.getDom().getBoundingClientRect();l=n(f.left,l),u=n(f.top,u),c=i(f.right,c),d=i(f.bottom,d),h.push({dom:o,left:f.left,top:f.top})}}),l*=f,u*=f,c*=f,d*=f;var p=c-l,g=d-u,m=a.createCanvas();m.width=p,m.height=g;var v=r.init(m);return M(h,function(e){var t=new S.Image({style:{x:e.left*f-l,y:e.top*f-u,image:e.dom}});v.add(t)}),v.refreshImmediately(),m.toDataURL("image/"+(e&&e.type||"png"))}return this.getDataURL(e)}},Z.convertToPixel=a.curry(J,"convertToPixel"),Z.convertFromPixel=a.curry(J,"convertFromPixel"),Z.containPixel=function(e,t){var n,i=this._model;return e=T.parseFinder(i,e),a.each(e,function(e,i){i.indexOf("Models")>=0&&a.each(e,function(e){var r=e.coordinateSystem;if(r&&r.containPoint)n|=!!r.containPoint(t);else if("seriesModels"===i){var a=this._chartsMap[e.__viewId];a&&a.containPoint&&(n|=a.containPoint(t,e))}},this)},this),!!n},Z.getVisual=function(e,t){var n=this._model;e=T.parseFinder(n,e,{defaultMainType:"series"});var i=e.seriesModel,r=i.getData(),a=e.hasOwnProperty("dataIndexInside")?e.dataIndexInside:e.hasOwnProperty("dataIndex")?r.indexOfRawIndex(e.dataIndex):null;return null!=a?r.getItemVisual(a,t):r.getVisual(t)},Z.getViewOfComponentModel=function(e){return this._componentsMap[e.__viewId]},Z.getViewOfSeriesModel=function(e){return this._chartsMap[e.__viewId]};var ee={prepareAndUpdate:function(e){te(this),ee.update.call(this,e)},update:function(e){var t=this._model,n=this._api,i=this._zr,r=this._coordSysMgr,a=this._scheduler;if(t){a.restoreData(t,e),a.performSeriesTasks(t),r.create(t,n),a.performDataProcessorTasks(t,e),ie(this,t),r.update(t,n),ue(t),a.performVisualTasks(t,e),ce(this,t,n,e);var l=t.get("backgroundColor")||"transparent";if(o.canvasSupported)i.setBackgroundColor(l);else{var u=s.parse(l);l=s.stringify(u,"rgb"),0===u[3]&&(l="transparent")}fe(t,n)}},updateTransform:function(e){var t=this._model,n=this,i=this._api;if(t){var r=[];t.eachComponent(function(a,s){var o=n.getViewOfComponentModel(s);if(o&&o.__alive)if(o.updateTransform){var l=o.updateTransform(s,t,i,e);l&&l.update&&r.push(o)}else r.push(o)});var s=a.createHashMap();t.eachSeries(function(r){var a=n._chartsMap[r.__viewId];if(a.updateTransform){var o=a.updateTransform(r,t,i,e);o&&o.update&&s.set(r.uid,1)}else s.set(r.uid,1)}),ue(t),this._scheduler.performVisualTasks(t,e,{setDirty:!0,dirtyMap:s}),he(n,t,i,e,s),fe(t,this._api)}},updateView:function(e){var t=this._model;t&&(b.markUpdateMethod(e,"updateView"),ue(t),this._scheduler.performVisualTasks(t,e,{setDirty:!0}),ce(this,this._model,this._api,e),fe(t,this._api))},updateVisual:function(e){ee.update.call(this,e)},updateLayout:function(e){ee.update.call(this,e)}};function te(e){var t=e._model,n=e._scheduler;n.restorePipelines(t),n.prepareStageTasks(),le(e,"component",t,n),le(e,"chart",t,n),n.plan()}function ne(e,t,n,i,r){var s=e._model;if(i){var o={};o[i+"Id"]=n[i+"Id"],o[i+"Index"]=n[i+"Index"],o[i+"Name"]=n[i+"Name"];var l={mainType:i,query:o};r&&(l.subType=r);var u=n.excludeSeriesId;null!=u&&(u=a.createHashMap(T.normalizeToArray(u))),s&&s.eachComponent(l,function(t){u&&null!=u.get(t.id)||c(e["series"===i?"_chartsMap":"_componentsMap"][t.__viewId])},e)}else M(e._componentsViews.concat(e._chartsViews),c);function c(i){i&&i.__alive&&i[t]&&i[t](i.__model,s,e._api,n)}}function ie(e,t){var n=e._chartsMap,i=e._scheduler;t.eachSeries(function(e){i.updateStreamModes(e,n[e.__viewId])})}function re(e,t){var n=e.type,i=e.escapeConnect,r=be[n],s=r.actionInfo,o=(s.update||"update").split(":"),l=o.pop();o=null!=o[0]&&P(o[0]),this[$]=!0;var u=[e],c=!1;e.batch&&(c=!0,u=a.map(e.batch,function(t){return t=a.defaults(a.extend({},t),e),t.batch=null,t}));var d,h=[],f="highlight"===n||"downplay"===n;M(u,function(e){d=r.action(e,this._model,this._api),d=d||a.extend({},e),d.type=s.event||d.type,h.push(d),f?ne(this,l,e,"series"):o&&ne(this,l,e,o.main,o.sub)},this),"none"===l||f||o||(this[W]?(te(this),ee.update.call(this,e),this[W]=!1):ee[l].call(this,e)),d=c?{type:s.event||n,escapeConnect:i,batch:h}:h[0],this[$]=!1,!t&&this._messageCenter.trigger(d.type,d)}function ae(e){var t=this._pendingActions;while(t.length){var n=t.shift();re.call(this,n,e)}}function se(e){!e&&this.trigger("updated")}function oe(e,t){e.on("rendered",function(){t.trigger("rendered"),!e.animation.isFinished()||t[W]||t._scheduler.unfinished||t._pendingActions.length||t.trigger("finished")})}function le(e,t,n,i){for(var r="component"===t,a=r?e._componentsViews:e._chartsViews,s=r?e._componentsMap:e._chartsMap,o=e._zr,l=e._api,u=0;u<a.length;u++)a[u].__alive=!1;function c(e){var t="_ec_"+e.id+"_"+e.type,u=s[t];if(!u){var c=P(e.type),d=r?y.getClass(c.main,c.sub):b.getClass(c.sub);u=new d,u.init(n,l),s[t]=u,a.push(u),o.add(u.group)}e.__viewId=u.__id=t,u.__alive=!0,u.__model=e,u.group.__ecComponentInfo={mainType:e.mainType,index:e.componentIndex},!r&&i.prepareView(u,e,n,l)}r?n.eachComponent(function(e,t){"series"!==e&&c(t)}):n.eachSeries(c);for(u=0;u<a.length;){var d=a[u];d.__alive?u++:(!r&&d.renderTask.dispose(),o.remove(d.group),d.dispose(n,l),a.splice(u,1),delete s[d.__id],d.__id=d.group.__ecComponentInfo=null)}}function ue(e){e.clearColorPalette(),e.eachSeries(function(e){e.clearColorPalette()})}function ce(e,t,n,i){de(e,t,n,i),M(e._chartsViews,function(e){e.__alive=!1}),he(e,t,n,i),M(e._chartsViews,function(e){e.__alive||e.remove(t,n)})}function de(e,t,n,i,r){M(r||e._componentsViews,function(e){var r=e.__model;e.render(r,t,n,i),ve(r,e)})}function he(e,t,n,i,r){var a,s=e._scheduler;t.eachSeries(function(t){var n=e._chartsMap[t.__viewId];n.__alive=!0;var o=n.renderTask;s.updatePayload(o,i),r&&r.get(t.uid)&&o.dirty(),a|=o.perform(s.getPerformArgs(o)),n.group.silent=!!t.get("silent"),ve(t,n),me(t,n)}),s.unfinished|=a,ge(e._zr,t),x(e._zr.dom,t)}function fe(e,t){M(we,function(n){n(e,t)})}Z.resize=function(e){this._zr.resize(e);var t=this._model;if(this._loadingFX&&this._loadingFX.resize(),t){var n=t.resetOption("media"),i=e&&e.silent;this[$]=!0,n&&te(this),ee.update.call(this),this[$]=!1,ae.call(this,i),se.call(this,i)}},Z.showLoading=function(e,t){if(L(e)&&(t=e,e=""),e=e||"default",this.hideLoading(),Ae[e]){var n=Ae[e](this._api,t),i=this._zr;this._loadingFX=n,i.add(n)}},Z.hideLoading=function(){this._loadingFX&&this._zr.remove(this._loadingFX),this._loadingFX=null},Z.makeActionFromEvent=function(e){var t=a.extend({},e);return t.type=Se[e.type],t},Z.dispatchAction=function(e,t){L(t)||(t={silent:!!t}),be[e.type]&&this._model&&(this[$]?this._pendingActions.push(e):(re.call(this,e,t.silent),t.flush?this._zr.flush(!0):!1!==t.flush&&o.browser.weChat&&this._throttledZrFlush(),ae.call(this,t.silent),se.call(this,t.silent)))},Z.appendData=function(e){var t=e.seriesIndex,n=this.getModel(),i=n.getSeriesByIndex(t);i.appendData(e),this._scheduler.unfinished=!0},Z.on=Y("on"),Z.off=Y("off"),Z.one=Y("one");var pe=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];function ge(e,t){var n=e.storage,i=0;n.traverse(function(e){e.isGroup||i++}),i>t.get("hoverLayerThreshold")&&!o.node&&n.traverse(function(e){e.isGroup||(e.useHoverLayer=!0)})}function me(e,t){var n=e.get("blendMode")||null;t.group.traverse(function(e){e.isGroup||e.style.blend!==n&&e.setStyle("blend",n),e.eachPendingDisplayable&&e.eachPendingDisplayable(function(e){e.setStyle("blend",n)})})}function ve(e,t){var n=e.get("z"),i=e.get("zlevel");t.group.traverse(function(e){"group"!==e.type&&(null!=n&&(e.z=n),null!=i&&(e.zlevel=i))})}function ye(e){var t=e._coordSysMgr;return a.extend(new d(e),{getCoordinateSystems:a.bind(t.getCoordinateSystems,t),getComponentByElement:function(t){while(t){var n=t.__ecComponentInfo;if(null!=n)return e._model.getComponent(n.mainType,n.index);t=t.parent}}})}Z._initEvents=function(){M(pe,function(e){this._zr.on(e,function(t){var n,i=this.getModel(),r=t.target;if("globalout"===e)n={};else if(r&&null!=r.dataIndex){var s=r.dataModel||i.getSeriesByIndex(r.seriesIndex);n=s&&s.getDataParams(r.dataIndex,r.dataType)||{}}else r&&r.eventData&&(n=a.extend({},r.eventData));n&&(n.event=t,n.type=e,this.trigger(e,n))},this)},this),M(Se,function(e,t){this._messageCenter.on(t,function(e){this.trigger(t,e)},this)},this)},Z.isDisposed=function(){return this._disposed},Z.clear=function(){this.setOption({series:[]},!0)},Z.dispose=function(){if(!this._disposed){this._disposed=!0,T.setAttribute(this.getDom(),Me,"");var e=this._api,t=this._model;M(this._componentsViews,function(n){n.dispose(t,e)}),M(this._chartsViews,function(n){n.dispose(t,e)}),this._zr.dispose(),delete ke[this.id]}},a.mixin(Q,u);var be={},Se={},Te=[],_e=[],we=[],Ee=[],xe={},Ae={},ke={},Ie={},Ce=new Date-0,Re=new Date-0,Me="_echarts_instance_",De={};function Le(e){var t=0,n=1,i=2,r="__connectUpdateStatus";function a(e,t){for(var n=0;n<e.length;n++){var i=e[n];i[r]=t}}M(Se,function(s,o){e._messageCenter.on(o,function(s){if(Ie[e.group]&&e[r]!==t){if(s&&s.escapeConnect)return;var o=e.makeActionFromEvent(s),l=[];M(ke,function(t){t!==e&&t.group===e.group&&l.push(t)}),a(l,t),M(l,function(e){e[r]!==n&&e.dispatchAction(o)}),a(l,i)}})})}function Pe(e,t,n){var i=Be(e);if(i)return i;var r=new Q(e,t,n);return r.id="ec_"+Ce++,ke[r.id]=r,T.setAttribute(e,Me,r.id),Le(r),r}function Oe(e){if(a.isArray(e)){var t=e;e=null,M(t,function(t){null!=t.group&&(e=t.group)}),e=e||"g_"+Re++,M(t,function(t){t.group=e})}return Ie[e]=!0,e}function Ne(e){Ie[e]=!1}var Ue=Ne;function Fe(e){"string"===typeof e?e=ke[e]:e instanceof Q||(e=Be(e)),e instanceof Q&&!e.isDisposed()&&e.dispose()}function Be(e){return ke[T.getAttribute(e,Me)]}function Ve(e){return ke[e]}function je(e,t){xe[e]=t}function Ge(e){_e.push(e)}function He(e,t){Xe(Te,e,t,F)}function ze(e){we.push(e)}function Ke(e,t,n){"function"===typeof t&&(n=t,t="");var i=L(e)?e.type:[e,e={event:t}][0];e.event=(e.event||i).toLowerCase(),t=e.event,R(q.test(i)&&q.test(t)),be[i]||(be[i]={action:n,actionInfo:e}),Se[t]=i}function $e(e,t){h.register(e,t)}function We(e){var t=h.get(e);if(t)return t.getDimensionsInfo?t.getDimensionsInfo():t.dimensions.slice()}function qe(e,t){Xe(Ee,e,t,V,"layout")}function Ye(e,t){Xe(Ee,e,t,G,"visual")}function Xe(e,t,n,i,r){(D(t)||L(t))&&(n=t,t=i);var a=k.wrapStageHandler(n,r);return a.__prio=t,a.__raw=n,e.push(a),a}function Qe(e,t){Ae[e]=t}function Ze(e){return m.extend(e)}function Je(e){return y.extend(e)}function et(e){return v.extend(e)}function tt(e){return b.extend(e)}function nt(e){a.$override("createCanvas",e)}function it(e,t,n){t.geoJson&&!t.features&&(n=t.specialAreas,t=t.geoJson),"string"===typeof t&&(t="undefined"!==typeof JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t+");")()),De[e]={geoJson:t,specialAreas:n}}function rt(e){return De[e]}Ye(j,E),Ge(p),He(B,g),Qe("default",A),Ke({type:"highlight",event:"highlight",update:"highlight"},a.noop),Ke({type:"downplay",event:"downplay",update:"downplay"},a.noop),je("light",I),je("dark",C);var at={};t.version=O,t.dependencies=N,t.PRIORITY=K,t.init=Pe,t.connect=Oe,t.disConnect=Ne,t.disconnect=Ue,t.dispose=Fe,t.getInstanceByDom=Be,t.getInstanceById=Ve,t.registerTheme=je,t.registerPreprocessor=Ge,t.registerProcessor=He,t.registerPostUpdate=ze,t.registerAction=Ke,t.registerCoordinateSystem=$e,t.getCoordinateSystemDimensions=We,t.registerLayout=qe,t.registerVisual=Ye,t.registerLoading=Qe,t.extendComponentModel=Ze,t.extendComponentView=Je,t.extendSeriesModel=et,t.extendChartView=tt,t.setCanvasCreator=nt,t.registerMap=it,t.getMap=rt,t.dataTool=at;var st=n("b719");(function(){for(var e in st)st.hasOwnProperty(e)&&(t[e]=st[e])})()},"401b":function(e,t){var n="undefined"===typeof Float32Array?Array:Float32Array;function i(e,t){var i=new n(2);return null==e&&(e=0),null==t&&(t=0),i[0]=e,i[1]=t,i}function r(e,t){return e[0]=t[0],e[1]=t[1],e}function a(e){var t=new n(2);return t[0]=e[0],t[1]=e[1],t}function s(e,t,n){return e[0]=t,e[1]=n,e}function o(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function l(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e}function u(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function c(e){return Math.sqrt(h(e))}var d=c;function h(e){return e[0]*e[0]+e[1]*e[1]}var f=h;function p(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function g(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function m(e,t){return e[0]*t[0]+e[1]*t[1]}function v(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function y(e,t){var n=c(t);return 0===n?(e[0]=0,e[1]=0):(e[0]=t[0]/n,e[1]=t[1]/n),e}function b(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}var S=b;function T(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}var _=T;function w(e,t){return e[0]=-t[0],e[1]=-t[1],e}function E(e,t,n,i){return e[0]=t[0]+i*(n[0]-t[0]),e[1]=t[1]+i*(n[1]-t[1]),e}function x(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e}function A(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function k(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}t.create=i,t.copy=r,t.clone=a,t.set=s,t.add=o,t.scaleAndAdd=l,t.sub=u,t.len=c,t.length=d,t.lenSquare=h,t.lengthSquare=f,t.mul=p,t.div=g,t.dot=m,t.scale=v,t.normalize=y,t.distance=b,t.dist=S,t.distanceSquare=T,t.distSquare=_,t.negate=w,t.lerp=E,t.applyTransform=x,t.min=A,t.max=k},"414c":function(e,t,n){var i=n("3a56"),r=i.extend({type:"dataZoom.select"});e.exports=r},"41a0":function(e,t,n){"use strict";var i=n("2aeb"),r=n("4630"),a=n("7f20"),s={};n("32e9")(s,n("2b4c")("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=i(s,{next:r(1,n)}),a(e,t+" Iterator")}},"41ef":function(e,t,n){var i=n("d51b"),r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(e){return e=Math.round(e),e<0?0:e>255?255:e}function s(e){return e=Math.round(e),e<0?0:e>360?360:e}function o(e){return e<0?0:e>1?1:e}function l(e){return e.length&&"%"===e.charAt(e.length-1)?a(parseFloat(e)/100*255):a(parseInt(e,10))}function u(e){return e.length&&"%"===e.charAt(e.length-1)?o(parseFloat(e)/100):o(parseFloat(e))}function c(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}function d(e,t,n){return e+(t-e)*n}function h(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e}function f(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}var p=new i(20),g=null;function m(e,t){g&&f(g,t),g=p.put(e,g||t.slice())}function v(e,t){if(e){t=t||[];var n=p.get(e);if(n)return f(t,n);e+="";var i=e.replace(/ /g,"").toLowerCase();if(i in r)return f(t,r[i]),m(e,t),t;if("#"!==i.charAt(0)){var a=i.indexOf("("),s=i.indexOf(")");if(-1!==a&&s+1===i.length){var o=i.substr(0,a),c=i.substr(a+1,s-(a+1)).split(","),d=1;switch(o){case"rgba":if(4!==c.length)return void h(t,0,0,0,1);d=u(c.pop());case"rgb":return 3!==c.length?void h(t,0,0,0,1):(h(t,l(c[0]),l(c[1]),l(c[2]),d),m(e,t),t);case"hsla":return 4!==c.length?void h(t,0,0,0,1):(c[3]=u(c[3]),y(c,t),m(e,t),t);case"hsl":return 3!==c.length?void h(t,0,0,0,1):(y(c,t),m(e,t),t);default:return}}h(t,0,0,0,1)}else{if(4===i.length){var g=parseInt(i.substr(1),16);return g>=0&&g<=4095?(h(t,(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1),m(e,t),t):void h(t,0,0,0,1)}if(7===i.length){g=parseInt(i.substr(1),16);return g>=0&&g<=16777215?(h(t,(16711680&g)>>16,(65280&g)>>8,255&g,1),m(e,t),t):void h(t,0,0,0,1)}}}}function y(e,t){var n=(parseFloat(e[0])%360+360)%360/360,i=u(e[1]),r=u(e[2]),s=r<=.5?r*(i+1):r+i-r*i,o=2*r-s;return t=t||[],h(t,a(255*c(o,s,n+1/3)),a(255*c(o,s,n)),a(255*c(o,s,n-1/3)),1),4===e.length&&(t[3]=e[3]),t}function b(e){if(e){var t,n,i=e[0]/255,r=e[1]/255,a=e[2]/255,s=Math.min(i,r,a),o=Math.max(i,r,a),l=o-s,u=(o+s)/2;if(0===l)t=0,n=0;else{n=u<.5?l/(o+s):l/(2-o-s);var c=((o-i)/6+l/2)/l,d=((o-r)/6+l/2)/l,h=((o-a)/6+l/2)/l;i===o?t=h-d:r===o?t=1/3+c-h:a===o&&(t=2/3+d-c),t<0&&(t+=1),t>1&&(t-=1)}var f=[360*t,n,u];return null!=e[3]&&f.push(e[3]),f}}function S(e,t){var n=v(e);if(n){for(var i=0;i<3;i++)n[i]=t<0?n[i]*(1-t)|0:(255-n[i])*t+n[i]|0,n[i]>255?n[i]=255:e[i]<0&&(n[i]=0);return I(n,4===n.length?"rgba":"rgb")}}function T(e){var t=v(e);if(t)return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)}function _(e,t,n){if(t&&t.length&&e>=0&&e<=1){n=n||[];var i=e*(t.length-1),r=Math.floor(i),s=Math.ceil(i),l=t[r],u=t[s],c=i-r;return n[0]=a(d(l[0],u[0],c)),n[1]=a(d(l[1],u[1],c)),n[2]=a(d(l[2],u[2],c)),n[3]=o(d(l[3],u[3],c)),n}}var w=_;function E(e,t,n){if(t&&t.length&&e>=0&&e<=1){var i=e*(t.length-1),r=Math.floor(i),s=Math.ceil(i),l=v(t[r]),u=v(t[s]),c=i-r,h=I([a(d(l[0],u[0],c)),a(d(l[1],u[1],c)),a(d(l[2],u[2],c)),o(d(l[3],u[3],c))],"rgba");return n?{color:h,leftIndex:r,rightIndex:s,value:i}:h}}var x=E;function A(e,t,n,i){if(e=v(e),e)return e=b(e),null!=t&&(e[0]=s(t)),null!=n&&(e[1]=u(n)),null!=i&&(e[2]=u(i)),I(y(e),"rgba")}function k(e,t){if(e=v(e),e&&null!=t)return e[3]=o(t),I(e,"rgba")}function I(e,t){if(e&&e.length){var n=e[0]+","+e[1]+","+e[2];return"rgba"!==t&&"hsva"!==t&&"hsla"!==t||(n+=","+e[3]),t+"("+n+")"}}t.parse=v,t.lift=S,t.toHex=T,t.fastLerp=_,t.fastMapToColor=w,t.lerp=E,t.mapToColor=x,t.modifyHSL=A,t.modifyAlpha=k,t.stringify=I},"42e5":function(e,t){var n=function(e){this.colorStops=e||[]};n.prototype={constructor:n,addColorStop:function(e,t){this.colorStops.push({offset:e,color:t})}};var i=n;e.exports=i},"42f6":function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("22d1"),s=n("07d7"),o=n("eda2"),l=n("3842"),u=n("2306"),c=n("133d"),d=n("f934"),h=n("4319"),f=n("17d6"),p=n("697e"),g=n("ff2e"),m=r.bind,v=r.each,y=l.parsePercent,b=new u.Rect({shape:{x:-1,y:-1,width:2,height:2}}),S=i.extendComponentView({type:"tooltip",init:function(e,t){if(!a.node){var n=new s(t.getDom(),t);this._tooltipContent=n}},render:function(e,t,n){if(!a.node&&!a.wxa){this.group.removeAll(),this._tooltipModel=e,this._ecModel=t,this._api=n,this._lastDataByCoordSys=null,this._alwaysShowContent=e.get("alwaysShowContent");var i=this._tooltipContent;i.update(),i.setEnterable(e.get("enterable")),this._initGlobalListener(),this._keepShow()}},_initGlobalListener:function(){var e=this._tooltipModel,t=e.get("triggerOn");f.register("itemTooltip",this._api,m(function(e,n,i){"none"!==t&&(t.indexOf(e)>=0?this._tryShow(n,i):"leave"===e&&this._hide(i))},this))},_keepShow:function(){var e=this._tooltipModel,t=this._ecModel,n=this._api;if(null!=this._lastX&&null!=this._lastY&&"none"!==e.get("triggerOn")){var i=this;clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout(function(){i.manuallyShowTip(e,t,n,{x:i._lastX,y:i._lastY})})}},manuallyShowTip:function(e,t,n,i){if(i.from!==this.uid&&!a.node){var r=_(i,n);this._ticket="";var s=i.dataByCoordSys;if(i.tooltip&&null!=i.x&&null!=i.y){var o=b;o.position=[i.x,i.y],o.update(),o.tooltip=i.tooltip,this._tryShow({offsetX:i.x,offsetY:i.y,target:o},r)}else if(s)this._tryShow({offsetX:i.x,offsetY:i.y,position:i.position,event:{},dataByCoordSys:i.dataByCoordSys,tooltipOption:i.tooltipOption},r);else if(null!=i.seriesIndex){if(this._manuallyAxisShowTip(e,t,n,i))return;var l=c(i,t),u=l.point[0],d=l.point[1];null!=u&&null!=d&&this._tryShow({offsetX:u,offsetY:d,position:i.position,target:l.el,event:{}},r)}else null!=i.x&&null!=i.y&&(n.dispatchAction({type:"updateAxisPointer",x:i.x,y:i.y}),this._tryShow({offsetX:i.x,offsetY:i.y,position:i.position,target:n.getZr().findHover(i.x,i.y).target,event:{}},r))}},manuallyHideTip:function(e,t,n,i){var r=this._tooltipContent;!this._alwaysShowContent&&this._tooltipModel&&r.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=null,i.from!==this.uid&&this._hide(_(i,n))},_manuallyAxisShowTip:function(e,t,n,i){var r=i.seriesIndex,a=i.dataIndex,s=t.getComponent("axisPointer").coordSysAxesInfo;if(null!=r&&null!=a&&null!=s){var o=t.getSeriesByIndex(r);if(o){var l=o.getData();e=T([l.getItemModel(a),o,(o.coordinateSystem||{}).model,e]);if("axis"===e.get("trigger"))return n.dispatchAction({type:"updateAxisPointer",seriesIndex:r,dataIndex:a,position:i.position}),!0}}},_tryShow:function(e,t){var n=e.target,i=this._tooltipModel;if(i){this._lastX=e.offsetX,this._lastY=e.offsetY;var r=e.dataByCoordSys;r&&r.length?this._showAxisTooltip(r,e):n&&null!=n.dataIndex?(this._lastDataByCoordSys=null,this._showSeriesItemTooltip(e,n,t)):n&&n.tooltip?(this._lastDataByCoordSys=null,this._showComponentItemTooltip(e,n,t)):(this._lastDataByCoordSys=null,this._hide(t))}},_showOrMove:function(e,t){var n=e.get("showDelay");t=r.bind(t,this),clearTimeout(this._showTimout),n>0?this._showTimout=setTimeout(t,n):t()},_showAxisTooltip:function(e,t){var n=this._ecModel,i=this._tooltipModel,a=[t.offsetX,t.offsetY],s=[],l=[],u=T([t.tooltipOption,i]);v(e,function(e){v(e.dataByAxis,function(e){var t=n.getComponent(e.axisDim+"Axis",e.axisIndex),i=e.value,a=[];if(t&&null!=i){var u=g.getValueLabel(i,t.axis,n,e.seriesDataIndices,e.valueLabelOpt);r.each(e.seriesDataIndices,function(r){var s=n.getSeriesByIndex(r.seriesIndex),o=r.dataIndexInside,c=s&&s.getDataParams(o);c.axisDim=e.axisDim,c.axisIndex=e.axisIndex,c.axisType=e.axisType,c.axisId=e.axisId,c.axisValue=p.getAxisRawValue(t.axis,i),c.axisValueLabel=u,c&&(l.push(c),a.push(s.formatTooltip(o,!0)))});var c=u;s.push((c?o.encodeHTML(c)+"<br />":"")+a.join("<br />"))}})},this),s.reverse(),s=s.join("<br /><br />");var c=t.position;this._showOrMove(u,function(){this._updateContentNotChangedOnAxis(e)?this._updatePosition(u,c,a[0],a[1],this._tooltipContent,l):this._showTooltipContent(u,s,l,Math.random(),a[0],a[1],c)})},_showSeriesItemTooltip:function(e,t,n){var i=this._ecModel,r=t.seriesIndex,a=i.getSeriesByIndex(r),s=t.dataModel||a,o=t.dataIndex,l=t.dataType,u=s.getData(),c=T([u.getItemModel(o),s,a&&(a.coordinateSystem||{}).model,this._tooltipModel]),d=c.get("trigger");if(null==d||"item"===d){var h=s.getDataParams(o,l),f=s.formatTooltip(o,!1,l),p="item_"+s.name+"_"+o;this._showOrMove(c,function(){this._showTooltipContent(c,f,h,p,e.offsetX,e.offsetY,e.position,e.target)}),n({type:"showTip",dataIndexInside:o,dataIndex:u.getRawIndex(o),seriesIndex:r,from:this.uid})}},_showComponentItemTooltip:function(e,t,n){var i=t.tooltip;if("string"===typeof i){var r=i;i={content:r,formatter:r}}var a=new h(i,this._tooltipModel,this._ecModel),s=a.get("content"),o=Math.random();this._showOrMove(a,function(){this._showTooltipContent(a,s,a.get("formatterParams")||{},o,e.offsetX,e.offsetY,e.position,t)}),n({type:"showTip",from:this.uid})},_showTooltipContent:function(e,t,n,i,r,a,s,l){if(this._ticket="",e.get("showContent")&&e.get("show")){var u=this._tooltipContent,c=e.get("formatter");s=s||e.get("position");var d=t;if(c&&"string"===typeof c)d=o.formatTpl(c,n,!0);else if("function"===typeof c){var h=m(function(t,i){t===this._ticket&&(u.setContent(i),this._updatePosition(e,s,r,a,u,n,l))},this);this._ticket=i,d=c(n,i,h)}u.setContent(d),u.show(e),this._updatePosition(e,s,r,a,u,n,l)}},_updatePosition:function(e,t,n,i,a,s,o){var l=this._api.getWidth(),u=this._api.getHeight();t=t||e.get("position");var c=a.getSize(),h=e.get("align"),f=e.get("verticalAlign"),p=o&&o.getBoundingRect().clone();if(o&&p.applyTransform(o.transform),"function"===typeof t&&(t=t([n,i],s,a.el,p,{viewSize:[l,u],contentSize:c.slice()})),r.isArray(t))n=y(t[0],l),i=y(t[1],u);else if(r.isObject(t)){t.width=c[0],t.height=c[1];var g=d.getLayoutRect(t,{width:l,height:u});n=g.x,i=g.y,h=null,f=null}else if("string"===typeof t&&o){var m=A(t,p,c);n=m[0],i=m[1]}else{m=w(n,i,a.el,l,u,h?null:20,f?null:20);n=m[0],i=m[1]}if(h&&(n-=k(h)?c[0]/2:"right"===h?c[0]:0),f&&(i-=k(f)?c[1]/2:"bottom"===f?c[1]:0),e.get("confine")){m=E(n,i,a.el,l,u);n=m[0],i=m[1]}a.moveTo(n,i)},_updateContentNotChangedOnAxis:function(e){var t=this._lastDataByCoordSys,n=!!t&&t.length===e.length;return n&&v(t,function(t,i){var r=t.dataByAxis||{},a=e[i]||{},s=a.dataByAxis||[];n&=r.length===s.length,n&&v(r,function(e,t){var i=s[t]||{},r=e.seriesDataIndices||[],a=i.seriesDataIndices||[];n&=e.value===i.value&&e.axisType===i.axisType&&e.axisId===i.axisId&&r.length===a.length,n&&v(r,function(e,t){var i=a[t];n&=e.seriesIndex===i.seriesIndex&&e.dataIndex===i.dataIndex})})}),this._lastDataByCoordSys=e,!!n},_hide:function(e){this._lastDataByCoordSys=null,e({type:"hideTip",from:this.uid})},dispose:function(e,t){a.node||a.wxa||(this._tooltipContent.hide(),f.unregister("itemTooltip",t))}});function T(e){var t=e.pop();while(e.length){var n=e.pop();n&&(h.isInstance(n)&&(n=n.get("tooltip",!0)),"string"===typeof n&&(n={formatter:n}),t=new h(n,t,t.ecModel))}return t}function _(e,t){return e.dispatchAction||r.bind(t.dispatchAction,t)}function w(e,t,n,i,r,a,s){var o=x(n),l=o.width,u=o.height;return null!=a&&(e+l+a>i?e-=l+a:e+=a),null!=s&&(t+u+s>r?t-=u+s:t+=s),[e,t]}function E(e,t,n,i,r){var a=x(n),s=a.width,o=a.height;return e=Math.min(e+s,i)-s,t=Math.min(t+o,r)-o,e=Math.max(e,0),t=Math.max(t,0),[e,t]}function x(e){var t=e.clientWidth,n=e.clientHeight;if(document.defaultView&&document.defaultView.getComputedStyle){var i=document.defaultView.getComputedStyle(e);i&&(t+=parseInt(i.paddingLeft,10)+parseInt(i.paddingRight,10)+parseInt(i.borderLeftWidth,10)+parseInt(i.borderRightWidth,10),n+=parseInt(i.paddingTop,10)+parseInt(i.paddingBottom,10)+parseInt(i.borderTopWidth,10)+parseInt(i.borderBottomWidth,10))}return{width:t,height:n}}function A(e,t,n){var i=n[0],r=n[1],a=5,s=0,o=0,l=t.width,u=t.height;switch(e){case"inside":s=t.x+l/2-i/2,o=t.y+u/2-r/2;break;case"top":s=t.x+l/2-i/2,o=t.y-r-a;break;case"bottom":s=t.x+l/2-i/2,o=t.y+u+a;break;case"left":s=t.x-i-a,o=t.y+u/2-r/2;break;case"right":s=t.x+l+a,o=t.y+u/2-r/2}return[s,o]}function k(e){return"center"===e||"middle"===e}e.exports=S},4319:function(e,t,n){var i=n("6d8b"),r=n("22d1"),a=n("e0d3"),s=a.makeInner,o=n("625e"),l=o.enableClassExtend,u=o.enableClassCheck,c=n("3901"),d=n("9bdb"),h=n("fe21"),f=n("551f"),p=i.mixin,g=s();function m(e,t,n){this.parentModel=t,this.ecModel=n,this.option=e}function v(e,t,n){for(var i=0;i<t.length;i++)if(t[i]&&(e=e&&"object"===typeof e?e[t[i]]:null,null==e))break;return null==e&&n&&(e=n.get(t)),e}function y(e,t){var n=g(e).getParent;return n?n.call(e,t):e.parentModel}m.prototype={constructor:m,init:null,mergeOption:function(e){i.merge(this.option,e,!0)},get:function(e,t){return null==e?this.option:v(this.option,this.parsePath(e),!t&&y(this,e))},getShallow:function(e,t){var n=this.option,i=null==n?n:n[e],r=!t&&y(this,e);return null==i&&r&&(i=r.getShallow(e)),i},getModel:function(e,t){var n,i=null==e?this.option:v(this.option,e=this.parsePath(e));return t=t||(n=y(this,e))&&n.getModel(e),new m(i,t,this.ecModel)},isEmpty:function(){return null==this.option},restoreData:function(){},clone:function(){var e=this.constructor;return new e(i.clone(this.option))},setReadOnly:function(e){},parsePath:function(e){return"string"===typeof e&&(e=e.split(".")),e},customizeGetParent:function(e){g(this).getParent=e},isAnimationEnabled:function(){if(!r.node){if(null!=this.option.animation)return!!this.option.animation;if(this.parentModel)return this.parentModel.isAnimationEnabled()}}},l(m),u(m),p(m,c),p(m,d),p(m,h),p(m,f);var b=m;e.exports=b},4436:function(e,t,n){var i=n("74cb");function r(e){this._target=e.target,this._life=e.life||1e3,this._delay=e.delay||0,this._initialized=!1,this.loop=null!=e.loop&&e.loop,this.gap=e.gap||0,this.easing=e.easing||"Linear",this.onframe=e.onframe,this.ondestroy=e.ondestroy,this.onrestart=e.onrestart,this._pausedTime=0,this._paused=!1}r.prototype={constructor:r,step:function(e,t){if(this._initialized||(this._startTime=e+this._delay,this._initialized=!0),this._paused)this._pausedTime+=t;else{var n=(e-this._startTime-this._pausedTime)/this._life;if(!(n<0)){n=Math.min(n,1);var r=this.easing,a="string"==typeof r?i[r]:r,s="function"===typeof a?a(n):n;return this.fire("frame",s),1==n?this.loop?(this.restart(e),"restart"):(this._needsRemove=!0,"destroy"):null}}},restart:function(e){var t=(e-this._startTime-this._pausedTime)%this._life;this._startTime=e-t+this.gap,this._pausedTime=0,this._needsRemove=!1},fire:function(e,t){e="on"+e,this[e]&&this[e](this._target,t)},pause:function(){this._paused=!0},resume:function(){this._paused=!1}};var a=r;e.exports=a},"446e":function(e,t,n){(function(e){
/*
 @license
 Shaka Player
 Copyright 2016 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
(function(){var n="undefined"!=typeof window?window:e,i={};for(var r in function(e,t,n){var i;function r(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var a="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype?e:(e[t]=n.value,e)};function s(n){n=["object"==typeof globalThis&&globalThis,n,"object"==typeof e&&e,"object"==typeof self&&self,"object"==typeof t&&t];for(var i=0;i<n.length;++i){var r=n[i];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}var o=s(this);function l(e,t){if(t)e:{var n=o;e=e.split(".");for(var i=0;i<e.length-1;i++){var r=e[i];if(!(r in n))break e;n=n[r]}e=e[e.length-1],i=n[e],t=t(i),t!=i&&null!=t&&a(n,e,{configurable:!0,writable:!0,value:t})}}function u(e){return e={next:e},e[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:r(e)}}function d(e){if(!(e instanceof Array)){e=c(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}l("Symbol",function(e){function t(e){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new n(i+(e||"")+"_"+r++,e)}function n(e,t){this.g=e,a(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;n.prototype.toString=function(){return this.g};var i="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return t}),l("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),n=0;n<t.length;n++){var i=o[t[n]];"function"===typeof i&&"function"!=typeof i.prototype[e]&&a(i.prototype,e,{configurable:!0,writable:!0,value:function(){return u(r(this))}})}return e});var h,f="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)h=Object.setPrototypeOf;else{var p;e:{var g={a:!0},m={};try{m.__proto__=g,p=m.a;break e}catch(e){}p=!1}h=p?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var v=h;function y(e,t){if(e.prototype=f(t.prototype),e.prototype.constructor=e,v)v(e,t);else for(var n in t)if("prototype"!=n)if(Object.defineProperties){var i=Object.getOwnPropertyDescriptor(t,n);i&&Object.defineProperty(e,n,i)}else e[n]=t[n];e.pk=t.prototype}function b(){this.o=!1,this.l=null,this.h=void 0,this.g=1,this.j=this.m=0,this.A=this.i=null}function S(e){if(e.o)throw new TypeError("Generator is already running");e.o=!0}function T(e,t){e.i={Gg:t,Tg:!0},e.g=e.m||e.j}function _(e,t,n){return e.g=n,{value:t}}function w(e){e.g=0}function E(e,t,n){e.m=t,void 0!=n&&(e.j=n)}function x(e,t){e.m=0,e.j=t||0}function A(e,t,n){e.g=t,e.m=n||0}function k(e,t){return e.m=t||0,t=e.i.Gg,e.i=null,t}function I(e){e.A=[e.i],e.m=0,e.j=0}function C(e,t){var n=e.A.splice(0)[0];(n=e.i=e.i||n)?n.Tg?e.g=e.m||e.j:void 0!=n.u&&e.j<n.u?(e.g=n.u,e.i=null):e.g=e.j:e.g=t}function R(e){this.g=new b,this.h=e}function M(e,t){S(e.g);var n=e.g.l;return n?D(e,"return"in n?n["return"]:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),L(e))}function D(e,t,n,i){try{var r=t.call(e.g.l,n);if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");if(!r.done)return e.g.o=!1,r;var a=r.value}catch(t){return e.g.l=null,T(e.g,t),L(e)}return e.g.l=null,i.call(e.g,a),L(e)}function L(e){for(;e.g.g;)try{var t=e.h(e.g);if(t)return e.g.o=!1,{value:t.value,done:!1}}catch(t){e.g.h=void 0,T(e.g,t)}if(e.g.o=!1,e.g.i){if(t=e.g.i,e.g.i=null,t.Tg)throw t.Gg;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function P(e){this.next=function(t){return S(e.g),e.g.l?t=D(e,e.g.l.next,t,e.g.s):(e.g.s(t),t=L(e)),t},this.throw=function(t){return S(e.g),e.g.l?t=D(e,e.g.l["throw"],t,e.g.s):(T(e.g,t),t=L(e)),t},this.return=function(t){return M(e,t)},this[Symbol.iterator]=function(){return this}}function O(e){function t(t){return e.next(t)}function n(t){return e.throw(t)}return new Promise(function(i,r){function a(e){e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(a,r)}a(e.next())})}function N(e){return O(new P(new R(e)))}function U(){for(var e=Number(this),t=[],n=e;n<arguments.length;n++)t[n-e]=arguments[n];return t}function F(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function B(e,t){e instanceof String&&(e+="");var n=0,i=!1,r={next:function(){if(!i&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}function V(e,t,n){e instanceof String&&(e=String(e));for(var i=e.length,r=0;r<i;r++){var a=e[r];if(t.call(n,a,r,e))return{Rg:r,v:a}}return{Rg:-1,v:void 0}}function j(e,t,n){if(null==e)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return e+""}b.prototype.s=function(e){this.h=e},b.prototype.return=function(e){this.i={return:e},this.g=this.j},b.prototype.u=function(e){this.g=e},l("Promise",function(e){function t(e){this.h=0,this.i=void 0,this.g=[],this.o=!1;var t=this.j();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}}function n(){this.g=null}function i(e){return e instanceof t?e:new t(function(t){t(e)})}if(e)return e;n.prototype.h=function(e){if(null==this.g){this.g=[];var t=this;this.i(function(){t.l()})}this.g.push(e)};var r=o.setTimeout;n.prototype.i=function(e){r(e,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var e=this.g;this.g=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(e){this.j(e)}}}this.g=null},n.prototype.j=function(e){this.i(function(){throw e})},t.prototype.j=function(){function e(e){return function(i){n||(n=!0,e.call(t,i))}}var t=this,n=!1;return{resolve:e(this.F),reject:e(this.l)}},t.prototype.F=function(e){if(e===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.H(e);else{e:switch(typeof e){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.C(e):this.m(e)}},t.prototype.C=function(e){var t=void 0;try{t=e.then}catch(e){return void this.l(e)}"function"==typeof t?this.I(t,e):this.m(e)},t.prototype.l=function(e){this.s(2,e)},t.prototype.m=function(e){this.s(1,e)},t.prototype.s=function(e,t){if(0!=this.h)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.h);this.h=e,this.i=t,2===this.h&&this.G(),this.A()},t.prototype.G=function(){var e=this;r(function(){if(e.B()){var t=o.console;"undefined"!==typeof t&&t.error(e.i)}},1)},t.prototype.B=function(){if(this.o)return!1;var e=o.CustomEvent,t=o.Event,n=o.dispatchEvent;return"undefined"===typeof n||("function"===typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"===typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=o.document.createEvent("CustomEvent"),e.initCustomEvent("unhandledrejection",!1,!0,e)),e.promise=this,e.reason=this.i,n(e))},t.prototype.A=function(){if(null!=this.g){for(var e=0;e<this.g.length;++e)a.h(this.g[e]);this.g=null}};var a=new n;return t.prototype.H=function(e){var t=this.j();e.be(t.resolve,t.reject)},t.prototype.I=function(e,t){var n=this.j();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},t.prototype.then=function(e,n){function i(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(e){a(e)}}:t}var r,a,s=new t(function(e,t){r=e,a=t});return this.be(i(e,r),i(n,a)),s},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.be=function(e,t){function n(){switch(i.h){case 1:e(i.i);break;case 2:t(i.i);break;default:throw Error("Unexpected state: "+i.h)}}var i=this;null==this.g?a.h(n):this.g.push(n),this.o=!0},t.resolve=i,t.reject=function(e){return new t(function(t,n){n(e)})},t.race=function(e){return new t(function(t,n){for(var r=c(e),a=r.next();!a.done;a=r.next())i(a.value).be(t,n)})},t.all=function(e){var n=c(e),r=n.next();return r.done?i([]):new t(function(e,t){function a(t){return function(n){s[t]=n,o--,0==o&&e(s)}}var s=[],o=0;do{s.push(void 0),o++,i(r.value).be(a(s.length-1),t),r=n.next()}while(!r.done)})},t}),l("WeakMap",function(e){function t(e){if(this.g=(l+=Math.random()+1).toString(),e){e=c(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}}function n(){}function i(e){var t=typeof e;return"object"===t&&null!==e||"function"===t}function r(e){if(!F(e,o)){var t=new n;a(e,o,{value:t})}}function s(e){var t=Object[e];t&&(Object[e]=function(e){return e instanceof n?e:(Object.isExtensible(e)&&r(e),t(e))})}if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),n=Object.seal({}),i=new e([[t,2],[n,3]]);return 2==i.get(t)&&3==i.get(n)&&(i.delete(t),i.set(n,4),!i.has(t)&&4==i.get(n))}catch(e){return!1}}())return e;var o="$jscomp_hidden_"+Math.random();s("freeze"),s("preventExtensions"),s("seal");var l=0;return t.prototype.set=function(e,t){if(!i(e))throw Error("Invalid WeakMap key");if(r(e),!F(e,o))throw Error("WeakMap key fail: "+e);return e[o][this.g]=t,this},t.prototype.get=function(e){return i(e)&&F(e,o)?e[o][this.g]:void 0},t.prototype.has=function(e){return i(e)&&F(e,o)&&F(e[o],this.g)},t.prototype.delete=function(e){return!!(i(e)&&F(e,o)&&F(e[o],this.g))&&delete e[o][this.g]},t}),l("Map",function(e){function t(){var e={};return e.Ob=e.next=e.head=e}function n(e,t){var n=e.g;return u(function(){if(n){for(;n.head!=e.g;)n=n.Ob;for(;n.next!=n.head;)return n=n.next,{done:!1,value:t(n)};n=null}return{done:!0,value:void 0}})}function i(e,t){var n=t&&typeof t;"object"==n||"function"==n?a.has(t)?n=a.get(t):(n=""+ ++s,a.set(t,n)):n="p_"+t;var i=e.h[n];if(i&&F(e.h,n))for(e=0;e<i.length;e++){var r=i[e];if(t!==t&&r.key!==r.key||t===r.key)return{id:n,list:i,index:e,entry:r}}return{id:n,list:i,index:-1,entry:void 0}}function r(e){if(this.h={},this.g=t(),this.size=0,e){e=c(e);for(var n;!(n=e.next()).done;)n=n.value,this.set(n[0],n[1])}}if(function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e(c([[t,"s"]]));if("s"!=n.get(t)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var i=n.entries(),r=i.next();return!r.done&&r.value[0]==t&&"s"==r.value[1]&&(r=i.next(),!(r.done||4!=r.value[0].x||"t"!=r.value[1]||!i.next().done))}catch(e){return!1}}())return e;var a=new WeakMap;r.prototype.set=function(e,t){e=0===e?0:e;var n=i(this,e);return n.list||(n.list=this.h[n.id]=[]),n.entry?n.entry.value=t:(n.entry={next:this.g,Ob:this.g.Ob,head:this.g,key:e,value:t},n.list.push(n.entry),this.g.Ob.next=n.entry,this.g.Ob=n.entry,this.size++),this},r.prototype.delete=function(e){return e=i(this,e),!(!e.entry||!e.list)&&(e.list.splice(e.index,1),e.list.length||delete this.h[e.id],e.entry.Ob.next=e.entry.next,e.entry.next.Ob=e.entry.Ob,e.entry.head=null,this.size--,!0)},r.prototype.clear=function(){this.h={},this.g=this.g.Ob=t(),this.size=0},r.prototype.has=function(e){return!!i(this,e).entry},r.prototype.get=function(e){return(e=i(this,e).entry)&&e.value},r.prototype.entries=function(){return n(this,function(e){return[e.key,e.value]})},r.prototype.keys=function(){return n(this,function(e){return e.key})},r.prototype.values=function(){return n(this,function(e){return e.value})},r.prototype.forEach=function(e,t){for(var n,i=this.entries();!(n=i.next()).done;)n=n.value,e.call(t,n[1],n[0],this)},r.prototype[Symbol.iterator]=r.prototype.entries;var s=0;return r}),l("Set",function(e){function t(e){if(this.g=new Map,e){e=c(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.g.size}return function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e(c([t]));if(!n.has(t)||1!=n.size||n.add(t)!=n||1!=n.size||n.add({x:4})!=n||2!=n.size)return!1;var i=n.entries(),r=i.next();return!r.done&&r.value[0]==t&&r.value[1]==t&&(r=i.next(),!r.done&&r.value[0]!=t&&4==r.value[0].x&&r.value[1]==r.value[0]&&i.next().done)}catch(e){return!1}}()?e:(t.prototype.add=function(e){return e=0===e?0:e,this.g.set(e,e),this.size=this.g.size,this},t.prototype.delete=function(e){return e=this.g.delete(e),this.size=this.g.size,e},t.prototype.clear=function(){this.g.clear(),this.size=0},t.prototype.has=function(e){return this.g.has(e)},t.prototype.entries=function(){return this.g.entries()},t.prototype.values=function(){return this.g.values()},t.prototype.keys=t.prototype.values,t.prototype[Symbol.iterator]=t.prototype.values,t.prototype.forEach=function(e,t){var n=this;this.g.forEach(function(i){return e.call(t,i,i,n)})},t)}),l("Array.prototype.keys",function(e){return e||function(){return B(this,function(e){return e})}}),l("Array.prototype.findIndex",function(e){return e||function(e,t){return V(this,e,t).Rg}}),l("Array.from",function(e){return e||function(e,t,n){t=null!=t?t:function(e){return e};var i=[],r="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];if("function"==typeof r){e=r.call(e);for(var a=0;!(r=e.next()).done;)i.push(t.call(n,r.value,a++))}else for(r=e.length,a=0;a<r;a++)i.push(t.call(n,e[a],a));return i}}),l("Array.prototype.values",function(e){return e||function(){return B(this,function(e,t){return t})}}),l("Object.is",function(e){return e||function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}}),l("Array.prototype.includes",function(e){return e||function(e,t){var n=this;n instanceof String&&(n=String(n));var i=n.length;for(t=t||0,0>t&&(t=Math.max(t+i,0));t<i;t++){var r=n[t];if(r===e||Object.is(r,e))return!0}return!1}}),l("String.prototype.includes",function(e){return e||function(e,t){return-1!==j(this,e,"includes").indexOf(e,t||0)}}),l("String.fromCodePoint",function(e){return e||function(e){for(var t="",n=0;n<arguments.length;n++){var i=Number(arguments[n]);if(0>i||1114111<i||i!==Math.floor(i))throw new RangeError("invalid_code_point "+i);65535>=i?t+=String.fromCharCode(i):(i-=65536,t+=String.fromCharCode(i>>>10&1023|55296),t+=String.fromCharCode(1023&i|56320))}return t}}),l("Array.prototype.find",function(e){return e||function(e,t){return V(this,e,t).v}}),l("String.prototype.startsWith",function(e){return e||function(e,t){var n=j(this,e,"startsWith"),i=n.length,r=e.length;t=Math.max(0,Math.min(0|t,n.length));for(var a=0;a<r&&t<i;)if(n[t++]!=e[a++])return!1;return a>=r}}),l("WeakSet",function(e){function t(e){if(this.g=new WeakMap,e){e=c(e);for(var t;!(t=e.next()).done;)this.add(t.value)}}return function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),n=Object.seal({}),i=new e([t]);return!(!i.has(t)||i.has(n))&&(i.delete(t),i.add(n),!i.has(t)&&i.has(n))}catch(e){return!1}}()?e:(t.prototype.add=function(e){return this.g.set(e,!0),this},t.prototype.has=function(e){return this.g.has(e)},t.prototype.delete=function(e){return this.g.delete(e)},t)});var G="function"==typeof Object.assign?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)F(i,r)&&(e[r]=i[r])}return e};l("Object.assign",function(e){return e||G}),l("Promise.prototype.finally",function(e){return e||function(e){return this.then(function(t){return Promise.resolve(e()).then(function(){return t})},function(t){return Promise.resolve(e()).then(function(){throw t})})}}),l("Array.prototype.entries",function(e){return e||function(){return B(this,function(e,t){return[e,t]})}}),l("Number.isNaN",function(e){return e||function(e){return"number"===typeof e&&isNaN(e)}}),l("String.prototype.repeat",function(e){return e||function(e){var t=j(this,null,"repeat");if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var n="";e;)1&e&&(n+=t),(e>>>=1)&&(t+=t);return n}}),l("Number.isFinite",function(e){return e||function(e){return"number"===typeof e&&(!isNaN(e)&&1/0!==e&&-1/0!==e)}}),l("Object.values",function(e){return e||function(e){var t,n=[];for(t in e)F(e,t)&&n.push(e[t]);return n}}),l("Math.log2",function(e){return e||function(e){return Math.log(e)/Math.LN2}}),l("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991}),l("Math.trunc",function(e){return e||function(e){if(e=Number(e),isNaN(e)||1/0===e||-1/0===e||0===e)return e;var t=Math.floor(Math.abs(e));return 0>e?-t:t}}),l("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)F(e,t)&&n.push([t,e[t]]);return n}});var H=this||self;function z(e,t){e=e.split(".");var n,i=H;e[0]in i||"undefined"==typeof i.execScript||i.execScript("var "+e[0]);for(;e.length&&(n=e.shift());)e.length||void 0===t?i=i[n]&&i[n]!==Object.prototype[n]?i[n]:i[n]={}:i[n]=t}
/*
 @license
 Shaka Player
 Copyright 2016 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
function K(){}function $(){}function W(e){this.g=Math.exp(Math.log(.5)/e),this.i=this.h=0}function q(e){return e.h/(1-Math.pow(e.g,e.i))}function Y(){this.h=new W(2),this.j=new W(5),this.g=0,this.i=128e3,this.l=16e3}function X(){}function Q(){}function Z(){}function J(e){var t=U.apply(1,arguments);ie.has(e)||(ie.add(e),Z.apply(X,d(t)))}function ee(){}function te(){}function ne(){}W.prototype.sample=function(e,t){var n=Math.pow(this.g,e);t=t*(1-n)+n*this.h,isNaN(t)||(this.h=t,this.i+=e)},Y.prototype.configure=function(e){this.i=e.minTotalBytes,this.l=e.minBytes,this.h.g=Math.exp(Math.log(.5)/e.fastHalfLife),this.j.g=Math.exp(Math.log(.5)/e.slowHalfLife)},Y.prototype.sample=function(e,t){if(!(t<this.l)){var n=8e3*t/e;e/=1e3,this.g+=t,this.h.sample(e,n),this.j.sample(e,n)}},Y.prototype.getBandwidthEstimate=function(e){return this.g<this.i?e:Math.min(q(this.h),q(this.j))};var ie=new Set;function re(){this.g={}}function ae(){this.g=new re}function se(e,t,n,i){this.target=e,this.type=t,this.listener=n,this.g=oe(e,i),this.target.addEventListener(t,n,this.g)}function oe(e,t){if(void 0==t)return!1;if("boolean"==typeof t)return t;var n=new Set(["passive","capture"]);return Object.keys(t).filter(function(e){return!n.has(e)}),le(e)?t:t.capture||!1}function le(e){var t=ue;if(void 0==t){t=!1;try{var n={},i={get:function(){return t=!0,!1}};Object.defineProperty(n,"passive",i),Object.defineProperty(n,"capture",i),i=function(){},e.addEventListener("test",i,n),e.removeEventListener("test",i,n)}catch(e){t=!1}ue=t}return t||!1}e.console&&(Z=function(){return console.warn.apply(console,d(U.apply(0,arguments)))},Q=function(){console.error.apply(console,d(U.apply(0,arguments)))}),i=re.prototype,i.push=function(e,t){this.g.hasOwnProperty(e)?this.g[e].push(t):this.g[e]=[t]},i.get=function(e){return(e=this.g[e])?e.slice():null},i.remove=function(e,t){e in this.g&&(this.g[e]=this.g[e].filter(function(e){return e!=t}),0==this.g[e].length&&delete this.g[e])},i.forEach=function(e){for(var t in this.g)e(t,this.g[t])},i.size=function(){return Object.keys(this.g).length},i.keys=function(){return Object.keys(this.g)},i=ae.prototype,i.release=function(){this.Ra(),this.g=null},i.D=function(e,t,n,i){this.g&&(e=new se(e,t,n,i),this.g.push(t,e))},i.ha=function(e,t,n,i){function r(i){a.lb(e,t,r),n(i)}var a=this;this.D(e,t,r,i)},i.lb=function(e,t,n){if(this.g){var i=this.g.get(t)||[];i=c(i);for(var r=i.next();!r.done;r=i.next())r=r.value,r.target!=e||n!=r.listener&&n||(r.lb(),this.g.remove(t,r))}},i.Ra=function(){if(this.g){var e,t=this.g,n=[];for(e in t.g)n.push.apply(n,d(t.g[e]));for(t=c(n),n=t.next();!n.done;n=t.next())n.value.lb();this.g.g={}}},z("shaka.util.EventManager",ae),ae.prototype.removeAll=ae.prototype.Ra,ae.prototype.unlisten=ae.prototype.lb,ae.prototype.listenOnce=ae.prototype.ha,ae.prototype.listen=ae.prototype.D,ae.prototype.release=ae.prototype.release,se.prototype.lb=function(){this.target.removeEventListener(this.type,this.listener,this.g),this.listener=this.target=null,this.g=!1};var ue=void 0;function ce(t){if(he.has(t))return he.get(t);if(e.ManagedMediaSource){var n=ManagedMediaSource.isTypeSupported(t);return he.set(t,n),n}return!!e.MediaSource&&(n=MediaSource.isTypeSupported(t),he.set(t,n),n)}function de(){return!!e.SourceBuffer&&!!SourceBuffer.prototype&&!!SourceBuffer.prototype.changeType}var he=new Map;function fe(e,t){this.g=e,this.h=t}function pe(e,t){var n=new fe(5,0),i=ve,r=i.g,a=n.h-r.h;(0<(n.g-r.g||a)?i.i:i.h)(i.g,n,e,t)}function ge(e,t,n,i){Z([n,"has been deprecated and will be removed in",t,". We are currently at version",e,". Additional information:",i].join(" "))}function me(e,t,n,i){Q([n,"has been deprecated and has been removed in",t,". We are now at version",e,". Additional information:",i].join(" "))}fe.prototype.toString=function(){return"v"+this.g+"."+this.h};var ve=null;function ye(){}function be(){}function Se(){}function Te(e,t){if(!e&&!t)return!0;if(!e||!t||e.byteLength!=t.byteLength)return!1;if(_e(e)==_e(t)&&(e.byteOffset||0)==(t.byteOffset||0))return!0;var n=Ee(e);t=Ee(t);for(var i=0;i<e.byteLength;i++)if(n[i]!=t[i])return!1;return!0}function _e(e){return e instanceof ArrayBuffer?e:e.buffer}function we(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}function Ee(e,t,n){return n=void 0===n?1/0:n,ke(e,void 0===t?0:t,n,Uint8Array)}function xe(e,t,n){return n=void 0===n?1/0:n,ke(e,void 0===t?0:t,n,Uint16Array)}function Ae(e,t,n){return n=void 0===n?1/0:n,ke(e,void 0===t?0:t,n,DataView)}function ke(e,t,n,i){var r=_e(e),a=1;"BYTES_PER_ELEMENT"in i&&(a=i.BYTES_PER_ELEMENT);var s=((e.byteOffset||0)+e.byteLength)/a;return e=Math.floor(Math.max(0,Math.min(((e.byteOffset||0)+t)/a,s))),new i(r,e,Math.floor(Math.min(e+Math.max(n,0),s))-e)}function Ie(){}function Ce(e){this.l=new be,(e=Re[e.toLowerCase()])&&(this.l=e()),this.h=new ye,(e=Me)&&(this.h=e())}ye.prototype.extract=function(){},ye.prototype.decode=function(){return[]},ye.prototype.clear=function(){},ye.prototype.getStreams=function(){return[]},be.prototype.init=function(){},be.prototype.parse=function(){return[]},z("shaka.util.BufferUtils",Se),Se.toDataView=Ae,Se.toUint16=xe,Se.toUint8=Ee,Se.toArrayBuffer=we,Se.equal=Te,Ie.prototype.init=function(){},Ie.prototype.i=function(){},Ie.prototype.g=function(){},Ie.prototype.j=function(){},z("shaka.media.IClosedCaptionParser",Ie),Ce.prototype.init=function(e,t){void 0!==t&&t||(this.g(),this.l.init(e))},Ce.prototype.i=function(e){e=this.l.parse(e),e=c(e);for(var t=e.next();!t.done;t=e.next()){t=t.value;var n=Ee(t.packet);0<n.length&&this.h.extract(n,t.pts)}return this.h.decode()},Ce.prototype.g=function(){this.h.clear()},Ce.prototype.j=function(){return this.h.getStreams()},z("shaka.media.ClosedCaptionParser",Ce),Ce.findDecoder=function(){return Me},Ce.unregisterDecoder=function(){Me=null},Ce.registerDecoder=function(e){Me=e},Ce.findParser=function(e){return Re[e]},Ce.unregisterParser=function(e){delete Re[e]},Ce.registerParser=function(e,t){Re[e]=t};var Re={},Me=null;function De(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=Le,this.scroll=Pe}z("shaka.text.CueRegion",De);var Le=1;De.units={PX:0,PERCENTAGE:Le,LINES:2};var Pe="";function Oe(e,t){return!("number"!==typeof e||"number"!==typeof t||!isNaN(e)||!isNaN(t))||e===t}function Ne(e,t){t=e.indexOf(t),-1<t&&e.splice(t,1)}function Ue(e,t,n){if(n||(n=Oe),e.length!=t.length)return!1;t=t.slice();var i={};e=c(e);for(var r=e.next();!r.done;i={Qe:i.Qe},r=e.next()){if(i.Qe=r.value,r=t.findIndex(function(e){return function(t){return n(e.Qe,t)}}(i)),-1==r)return!1;t[r]=t[t.length-1],t.pop()}return 0==t.length}function Fe(e,t,n){if(n||(n=Oe),e.length!=t.length)return!1;for(var i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}function Be(e,t,n){this.startTime=e,this.endTime=t,this.payload=n,this.region=new De,this.position=null,this.positionAlign=Ge,this.size=0,this.textAlign=He,this.direction=We,this.writingMode=qe,this.lineInterpretation=Ye,this.line=null,this.lineHeight="",this.lineAlign=Xe,this.displayAlign=Ke,this.fontSize=this.border=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=et,this.fontStyle=tt,this.linePadding=this.letterSpacing=this.fontFamily="",this.opacity=1,this.textCombineUpright="",this.textDecoration=[],this.textStrokeWidth=this.textStrokeColor=this.textShadow="",this.wrapLine=!0,this.id="",this.nestedCues=[],this.lineBreak=this.isContainer=!1,this.rubyTag=null,this.cellResolution={kc:32,rows:15}}function Ve(e,t){return e=new Be(e,t,""),e.lineBreak=!0,e}function je(e,t){if(e.startTime!=t.startTime||e.endTime!=t.endTime||e.payload!=t.payload)return!1;for(var n in e)if("startTime"!=n&&"endTime"!=n&&"payload"!=n)if("nestedCues"==n){if(!Fe(e.nestedCues,t.nestedCues,je))return!1}else if("region"==n||"cellResolution"==n){for(var i in e[n])if(e[n][i]!=t[n][i])return!1}else if(Array.isArray(e[n])){if(!Fe(e[n],t[n]))return!1}else if(e[n]!=t[n])return!1;return!0}De.scrollMode={NONE:Pe,UP:"up"},Be.prototype.clone=function(){var e,t=new Be(0,0,"");for(e in this)t[e]=this[e],t[e]&&t[e].constructor==Array&&(t[e]=t[e].slice());return t},z("shaka.text.Cue",Be),Be.equal=je,Be.prototype.clone=Be.prototype.clone;var Ge="auto";Be.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:Ge};var He="center",ze={LEFT:"left",RIGHT:"right",CENTER:He,START:"start",END:"end"};Be.textAlign=ze;var Ke="after",$e={BEFORE:"before",CENTER:"center",AFTER:Ke};Be.displayAlign=$e;var We="ltr";Be.direction={HORIZONTAL_LEFT_TO_RIGHT:We,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var qe="horizontal-tb";Be.writingMode={HORIZONTAL_TOP_TO_BOTTOM:qe,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var Ye=0;Be.lineInterpretation={LINE_NUMBER:Ye,PERCENTAGE:1};var Xe="start",Qe={CENTER:"center",START:Xe,END:"end"};Be.lineAlign=Qe;var Ze={white:"white",lime:"lime",cyan:"cyan",red:"red",yellow:"yellow",magenta:"magenta",blue:"blue",black:"black"};Be.defaultTextColor=Ze;var Je={bg_white:"white",bg_lime:"lime",bg_cyan:"cyan",bg_red:"red",bg_yellow:"yellow",bg_magenta:"magenta",bg_blue:"blue",bg_black:"black"};Be.defaultTextBackgroundColor=Je;var et=400;Be.fontWeight={NORMAL:et,BOLD:700};var tt="normal",nt={NORMAL:tt,ITALIC:"italic",OBLIQUE:"oblique"};function it(){}function rt(e,t,n){st[e.toLowerCase().split(";")[0]+"-"+n]={priority:n,De:t}}function at(e,t){for(var n=e.toLowerCase().split(";")[0],i=c([ct,ut,lt,ot]),r=i.next();!r.done;r=i.next())if(r=st[n+"-"+r.value]){var a=r.De(),s=a.isSupported(e,t);if(a.destroy(),s)return r.De}return null}Be.fontStyle=nt,Be.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},it.prototype.destroy=function(){},z("shaka.transmuxer.TransmuxerEngine",it),it.findTransmuxer=at,it.unregisterTransmuxer=function(e,t){delete st[e.toLowerCase().split(";")[0]+"-"+t]},it.registerTransmuxer=rt,it.prototype.destroy=it.prototype.destroy;var st={},ot=1,lt=2,ut=3,ct=4;it.PluginPriority={FALLBACK:ot,PREFERRED_SECONDARY:lt,PREFERRED:ut,APPLICATION:ct};
/*
 @license
 Copyright 2008 The Closure Library Authors
 SPDX-License-Identifier: Apache-2.0
*/
var dt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");
/*
 @license
 Copyright 2006 The Closure Library Authors
 SPDX-License-Identifier: Apache-2.0
*/function ht(e){var t;e instanceof ht?(ft(this,e.Db),this.yc=e.yc,pt(this,e.Gb),gt(this,e.Pc),this.Pa=e.Pa,mt(this,e.g.clone()),this.lc=e.lc):e&&(t=String(e).match(dt))?(ft(this,t[1]||"",!0),this.yc=vt(t[2]||""),pt(this,t[3]||"",!0),gt(this,t[4]),this.Pa=vt(t[5]||"",!0),mt(this,t[6]||"",!0),this.lc=vt(t[7]||"")):this.g=new xt(null)}function ft(e,t,n){e.Db=n?vt(t,!0):t,e.Db&&(e.Db=e.Db.replace(/:$/,""))}function pt(e,t,n){e.Gb=n?vt(t,!0):t}function gt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.Pc=t}else e.Pc=null}function mt(e,t,n){t instanceof xt?e.g=t:(n||(t=yt(t,wt)),e.g=new xt(t))}function vt(e,t){return e?t?decodeURI(e):decodeURIComponent(e):""}function yt(e,t,n){return null!=e?(e=encodeURI(e).replace(t,bt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function bt(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(15&e).toString(16)}i=ht.prototype,i.Db="",i.yc="",i.Gb="",i.Pc=null,i.Pa="",i.lc="",i.toString=function(){var e=[],t=this.Db;if(t&&e.push(yt(t,St,!0),":"),t=this.Gb){e.push("//");var n=this.yc;n&&e.push(yt(n,St,!0),"@"),e.push(encodeURIComponent(t).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.Pc,null!=t&&e.push(":",String(t))}return(t=this.Pa)&&(this.Gb&&"/"!=t.charAt(0)&&e.push("/"),e.push(yt(t,"/"==t.charAt(0)?_t:Tt,!0))),(t=this.g.toString())&&e.push("?",t),(t=this.lc)&&e.push("#",yt(t,Et)),e.join("")},i.resolve=function(e){var t=this.clone();"data"===t.Db&&(t=new ht);var n=!!e.Db;n?ft(t,e.Db):n=!!e.yc,n?t.yc=e.yc:n=!!e.Gb,n?pt(t,e.Gb):n=null!=e.Pc;var i=e.Pa;if(n)gt(t,e.Pc);else if(n=!!e.Pa){if("/"!=i.charAt(0))if(this.Gb&&!this.Pa)i="/"+i;else{var r=t.Pa.lastIndexOf("/");-1!=r&&(i=t.Pa.substr(0,r+1)+i)}if(".."==i||"."==i)i="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var a=[],s=0;s<i.length;){var o=i[s++];"."==o?r&&s==i.length&&a.push(""):".."==o?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),r&&s==i.length&&a.push("")):(a.push(o),r=!0)}i=a.join("/")}}return n?t.Pa=i:n=""!==e.g.toString(),n?mt(t,e.g.clone()):n=!!e.lc,n&&(t.lc=e.lc),t},i.clone=function(){return new ht(this)};var St=/[#\/\?@]/g,Tt=/[#\?:]/g,_t=/[#\?]/g,wt=/[#\?@]/g,Et=/#/g;function xt(e){this.g=e||null}function At(e){if(!e.Ka&&(e.Ka={},e.pd=0,e.g))for(var t=e.g.split("&"),n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var a=t[n].substring(0,i);r=t[n].substring(i+1)}else a=t[n];a=decodeURIComponent(a.replace(/\+/g," ")),r=r||"",e.add(a,decodeURIComponent(r.replace(/\+/g," ")))}}function kt(e){return At(e),e.pd}function It(e,t,n){var i=U.apply(3,arguments);if(this.severity=e,this.category=t,this.code=n,this.data=i,this.handled=!1,this.message="Shaka Error "+this.code,Ct)try{throw Error(this.message||"Shaka Error")}catch(e){this.stack=e.stack}}i=xt.prototype,i.Ka=null,i.pd=null,i.add=function(e,t){At(this),this.g=null;var n=this.Ka.hasOwnProperty(e)?this.Ka[e]:null;return n||(this.Ka[e]=n=[]),n.push(t),this.pd++,this},i.set=function(e,t){return At(this),this.g=null,this.Ka.hasOwnProperty(e)?this.Ka[e]=[t]:this.add(e,t),this},i.get=function(e){return At(this),this.Ka[e]||[]},i.toString=function(){if(this.g)return this.g;if(!this.Ka)return"";var e,t=[];for(e in this.Ka)for(var n=encodeURIComponent(e),i=this.Ka[e],r=0;r<i.length;r++){var a=n;""!==i[r]&&(a+="="+encodeURIComponent(i[r])),t.push(a)}return this.g=t.join("&")},i.clone=function(){var e=new xt;if(e.g=this.g,this.Ka){var t,n={};for(t in this.Ka)n[t]=this.Ka[t].concat();e.Ka=n,e.pd=this.pd}return e},It.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},z("shaka.util.Error",It);var Ct=!0;function Rt(e){this.h=e,this.g=void 0}function Mt(e,t){return!e.length||!t.length||e===t||0<Dt(e,t).length}function Dt(e,t){if(!e.length)return t;if(!t.length)return e;var n=[];e=c(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;for(var r=c(t),a=r.next();!a.done;a=r.next())if(a=a.value,i.keySystem==a.keySystem){r=new Map;for(var s=c((i.initData||[]).concat(a.initData||[])),o=s.next();!o.done;o=s.next())o=o.value,r.set(o.keyId,o);r=Array.from(r.values()),s=i.keyIds&&a.keyIds?new Set([].concat(d(i.keyIds),d(a.keyIds))):i.keyIds||a.keyIds,n.push({keySystem:i.keySystem,licenseServerUri:i.licenseServerUri||a.licenseServerUri,distinctiveIdentifierRequired:i.distinctiveIdentifierRequired||a.distinctiveIdentifierRequired,persistentStateRequired:i.persistentStateRequired||a.persistentStateRequired,videoRobustness:i.videoRobustness||a.videoRobustness,audioRobustness:i.audioRobustness||a.audioRobustness,serverCertificate:i.serverCertificate||a.serverCertificate,serverCertificateUri:i.serverCertificateUri||a.serverCertificateUri,initData:r,keyIds:s});break}}return n}function Lt(e){return!!e&&!!e.match(/^com\.(microsoft|chromecast)\.playready/)}It.Severity={RECOVERABLE:1,CRITICAL:2},It.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9,ADS:10},It.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,ATTEMPTS_EXHAUSTED:1010,SEGMENT_MISSING:1011,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,INVALID_MP4_CEA:2010,TEXT_COULD_NOT_GUESS_MIME_TYPE:2011,CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS:2012,TEXT_ONLY_WEBVTT_SRC_EQUALS:2013,MISSING_TEXT_PLUGIN:2014,CHAPTERS_TRACK_FAILED:2015,UNSUPPORTED_EXTERNAL_THUMBNAILS_URI:2017,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,CONTENT_TRANSFORMATION_FAILED:3019,MSS_MISSING_DATA_FOR_TRANSMUXING:3020,MSS_TRANSMUXING_FAILED:3022,TRANSMUXING_NO_VIDEO_DATA:3023,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,RESTRICTIONS_CANNOT_BE_MET:4012,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,NO_VARIANTS:4036,PERIOD_FLATTENING_FAILED:4037,INCONSISTENT_DRM_ACROSS_PERIODS:4038,HLS_VARIABLE_NOT_FOUND:4039,HLS_MSE_ENCRYPTED_MP2T_NOT_SUPPORTED:4040,HLS_MSE_ENCRYPTED_LEGACY_APPLE_MEDIA_KEYS_NOT_SUPPORTED:4041,NO_WEB_CRYPTO_API:4042,CANNOT_ADD_EXTERNAL_THUMBNAILS_TO_LIVE_STREAM:4045,MSS_INVALID_XML:4046,MSS_LIVE_CONTENT_NOT_SUPPORTED:4047,AES_128_INVALID_IV_LENGTH:4048,AES_128_INVALID_KEY_LENGTH:4049,DASH_CONFLICTING_AES_128:4050,DASH_UNSUPPORTED_AES_128:4051,DASH_INVALID_PATCH:4052,STREAMING_ENGINE_STARTUP_INVALID_STATE:5006,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,SERVER_CERTIFICATE_REQUEST_FAILED:6017,MIN_HDCP_VERSION_NOT_MATCH:6018,ERROR_CHECKING_HDCP_VERSION:6019,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,OBJECT_DESTROYED:7003,CONTENT_NOT_LOADED:7004,SRC_EQUALS_PRELOAD_NOT_SUPPORTED:7005,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013,STORAGE_LIMIT_REACHED:9014,DOWNLOAD_SIZE_CALLBACK_ERROR:9015,MODIFY_OPERATION_NOT_SUPPORTED:9016,INDEXED_DB_INIT_TIMED_OUT:9017,CS_IMA_SDK_MISSING:1e4,CS_AD_MANAGER_NOT_INITIALIZED:10001,SS_IMA_SDK_MISSING:10002,SS_AD_MANAGER_NOT_INITIALIZED:10003,CURRENT_DAI_REQUEST_NOT_FINISHED:10004,MT_AD_MANAGER_NOT_INITIALIZED:10005},Rt.prototype.value=function(){return void 0==this.g&&(this.g=this.h()),this.g};var Pt=new Rt(function(){return we(new Uint8Array([0]))}),Ot=new Map;function Nt(e){this.h=e,this.g=null}function Ut(e){this.h=e,this.g=null}function Ft(){var t=e.ManagedMediaSource||e.MediaSource;return!(!t||!t.isTypeSupported)}function Bt(e){return""!=sn().canPlayType(e)}function Vt(){return!!navigator.userAgent.match(/Edge?\//)}function jt(){return an("Xbox One")}function Gt(){return an("Tizen")}function Ht(){return an("Tizen 3")}function zt(){return an("Tizen 2")}function Kt(){return an("Web0S")}function $t(){return Kt()&&38===qt()}function Wt(){return an("CrKey")}function qt(){if(!an("Chrome")||navigator.userAgent.match(/Edge\//))return null;var e=navigator.userAgent.match(/Chrome\/(\d+)/);return e?parseInt(e[1],10):null}function Yt(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!Gt()&&!an("PC=EOS")&&!an("PC=APL")&&!an("VirginMedia")&&!Jt()&&!Qt()&&!an("AFT")&&!an("WPE")&&!an("DT_STB_BCM")}function Xt(){return an("PlayStation 5")}function Qt(){return an("PlayStation 4")}function Zt(){return an("Hisense")||an("VIDAA")}function Jt(){return an("SOPOpenBrowser")}function en(){if(!Yt())return null;var e=navigator.userAgent.match(/Version\/(\d+)/);return e?parseInt(e[1],10):(e=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(e[1],10):null}function tn(){return navigator.userAgentData&&navigator.userAgentData.platform?"windows"==navigator.userAgentData.platform.toLowerCase():!!navigator.platform&&navigator.platform.toLowerCase().includes("windows")}function nn(){return an("Android")}function rn(){return!!(Gt()||Kt()||jt()||Qt()||Xt()||an("AFT")||an("PC=EOS")||an("PC=APL")||an("VirginMedia")||Jt()||an("WPE")||Wt()||Zt()||an("DT_STB_BCM"))}function an(e){return(navigator.userAgent||"").includes(e)}function sn(){return cn||(un||(un=new Ut(function(){cn=null})),(cn=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0])||(cn=document.createElement("video")),un.Y(1),cn)}function on(t){return t?t===e.shakaMediaKeysPolyfill:!!e.shakaMediaKeysPolyfill}function ln(){var t,n,i,r,a,s,o,l,u,c,d,h,f,p;return N(function(g){switch(g.g){case 1:if(t={width:1/0,height:1/0},Wt()){if(d=e.cast&&cast.__platform__&&cast.__platform__.canDisplayType,t.width=1280,t.height=720,E(g,15),!(h=d)){g.u(17);break}return _(g,cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160'),18)}if(Gt()){t.width=1920,t.height=1080;try{webapis.systeminfo&&webapis.systeminfo.getMaxVideoResolution?(n=webapis.systeminfo.getMaxVideoResolution(),t.width=n.width,t.height=n.height):webapis.productinfo.is8KPanelSupported&&webapis.productinfo.is8KPanelSupported()?(t.width=7680,t.height=4320):webapis.productinfo.isUdPanelSupported&&webapis.productinfo.isUdPanelSupported()&&(t.width=3840,t.height=2160)}catch(e){Z("Tizen: Error detecting screen size, default screen size 1920x1080.")}g.u(3);break}if(jt()){t.width=1920,t.height=1080;try{i=new Windows.Media.Protection.ProtectionCapabilities,r=Windows.Media.Protection.ProtectionCapabilityResult,a=null;do{a=i.isTypeSupported('video/mp4;codecs="hvc1,mp4a";features="decode-res-x=3840,decode-res-y=2160,decode-bitrate=20000,decode-fps=30,decode-bpc=10,display-res-x=3840,display-res-y=2160,display-bpc=8"',"com.microsoft.playready.recommendation")}while(a===r.maybe);a===r.probably&&(t.width=3840,t.height=2160)}catch(e){Z("Xbox: Error detecting screen size, default screen size 1920x1080.")}g.u(3);break}if(Kt()){try{s=JSON.parse(e.PalmSystem.deviceInfo),t.width=Math.max(1920,s.screenWidth),t.height=Math.max(1080,s.screenHeight)}catch(e){Z("WebOS: Error detecting screen size, default screen size 1920x1080."),t.width=1920,t.height=1080}g.u(3);break}if(Zt()){e.Hisense_Get4KSupportState&&e.Hisense_Get4KSupportState()?(t.width=3840,t.height=2160):(t.width=1920,t.height=1080),g.u(3);break}if(!Qt()&&!Xt()){g.u(3);break}return o=!1,E(g,9),_(g,e.msdk.device.getDisplayInfo(),11);case 11:l=g.h,o="4K"===l.resolution,A(g,10);break;case 9:return k(g),E(g,12),_(g,e.msdk.device.getDisplayInfoImmediate(),14);case 14:u=g.h,o="4K"===u.resolution,A(g,10);break;case 12:c=k(g),Z("PlayStation: Failed to get the display info:",c);case 10:o?(t.width=3840,t.height=2160):(t.width=1920,t.height=1080),g.u(3);break;case 18:h=g.h;case 17:if(h){t.width=3840,t.height=2160,g.u(19);break}if(!(f=d)){g.u(20);break}return _(g,cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=1920; height=1080'),21);case 21:f=g.h;case 20:f&&(t.width=1920,t.height=1080);case 19:A(g,3);break;case 15:p=k(g),Q("Failed to check canDisplayType:",p);case 3:return g.return(t)}})}Nt.prototype.Y=function(t){var n=this;this.stop();var i=!0,r=null;return this.g=function(){e.clearTimeout(r),i=!1},r=e.setTimeout(function(){i&&n.h()},1e3*t),this},Nt.prototype.stop=function(){this.g&&(this.g(),this.g=null)},Ut.prototype.xc=function(){return this.stop(),this.h(),this},Ut.prototype.Y=function(e){var t=this;return this.stop(),this.g=new Nt(function(){t.h()}).Y(e),this},Ut.prototype.Sa=function(e){var t=this;return this.stop(),this.g=new Nt(function(){t.g.Y(e),t.h()}).Y(e),this},Ut.prototype.stop=function(){this.g&&(this.g.stop(),this.g=null)},z("shaka.util.Timer",Ut),Ut.prototype.stop=Ut.prototype.stop,Ut.prototype.tickEvery=Ut.prototype.Sa,Ut.prototype.tickAfter=Ut.prototype.Y,Ut.prototype.tickNow=Ut.prototype.xc;var un=null,cn=null;function dn(){}function hn(t){if(!t)return"";if(t=Ee(t),239==t[0]&&187==t[1]&&191==t[2]&&(t=t.subarray(3)),e.TextDecoder&&!Qt())return t=(new TextDecoder).decode(t),t.includes("�")&&Q('Decoded string contains an "unknown character" codepoint.  That probably means the UTF8 encoding was incorrect!'),t;for(var n="",i=0;i<t.length;++i){var r=65533;if(0==(128&t[i])?r=t[i]:t.length>=i+2&&192==(224&t[i])&&128==(192&t[i+1])?(r=(31&t[i])<<6|63&t[i+1],i+=1):t.length>=i+3&&224==(240&t[i])&&128==(192&t[i+1])&&128==(192&t[i+2])?(r=(15&t[i])<<12|(63&t[i+1])<<6|63&t[i+2],i+=2):t.length>=i+4&&240==(241&t[i])&&128==(192&t[i+1])&&128==(192&t[i+2])&&128==(192&t[i+3])&&(r=(7&t[i])<<18|(63&t[i+1])<<12|(63&t[i+2])<<6|63&t[i+3],i+=3),65535>=r)n+=String.fromCharCode(r);else{r-=65536;var a=1023&r;n+=String.fromCharCode(55296+(r>>10)),n+=String.fromCharCode(56320+a)}}return n}function fn(e,t,n){if(!e)return"";if(!n&&0!=e.byteLength%2)throw new It(2,2,2004);n=Math.floor(e.byteLength/2);var i=new Uint16Array(n);e=Ae(e);for(var r=0;r<n;r++)i[r]=e.getUint16(2*r,t);return vn(i)}function pn(e){function t(e){return n.byteLength<=e||32<=n[e]&&126>=n[e]}if(!e)return"";var n=Ee(e);if(239==n[0]&&187==n[1]&&191==n[2])return hn(n);if(254==n[0]&&255==n[1])return fn(n.subarray(2),!1);if(255==n[0]&&254==n[1])return fn(n.subarray(2),!0);if(0==n[0]&&0==n[2])return fn(e,!1);if(0==n[1]&&0==n[3])return fn(e,!0);if(t(0)&&t(1)&&t(2)&&t(3))return hn(e);throw new It(2,2,2003)}function gn(t){if(e.TextEncoder&&!Qt()){var n=new TextEncoder;return we(n.encode(t))}t=encodeURIComponent(t),t=unescape(t),n=new Uint8Array(t.length);for(var i=0;i<t.length;i++)n[i]=t[i].charCodeAt(0);return we(n)}function mn(e,t){for(var n=new ArrayBuffer(2*e.length),i=new DataView(n),r=0;r<e.length;++r)i.setUint16(2*r,e.charCodeAt(r),t);return n}function vn(e){return bn.value()(e)}function yn(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&nbsp;":" ","&lrm;":"‎","&rlm;":"‏"},n=/&(?:amp|lt|gt|quot|apos|nbsp|lrm|rlm|#[xX]?[0-9a-fA-F]+);/g,i=RegExp(n.source);return e&&i.test(e)?e.replace(n,function(e){return"#"==e[1]?(e="x"==e[2]||"X"==e[2]?parseInt(e.substring(3),16):parseInt(e.substring(2),10),0<=e&&1114111>=e?String.fromCodePoint(e):""):t[e]||"'"}):e||""}z("shaka.util.StringUtils",dn),dn.resetFromCharCode=function(){bn.g=void 0},dn.toUTF16=mn,dn.toUTF8=gn,dn.fromBytesAutoDetect=pn,dn.fromUTF16=fn,dn.fromUTF8=hn;var bn=new Rt(function(){function e(e){try{var t=new Uint8Array(e);return 0<String.fromCharCode.apply(null,t).length}catch(e){return!1}}for(var t={Tb:65536};0<t.Tb;t={Tb:t.Tb},t.Tb/=2)if(e(t.Tb))return function(e){return function(t){for(var n="",i=0;i<t.length;i+=e.Tb)n+=String.fromCharCode.apply(null,t.subarray(i,i+e.Tb));return n}}(t);return null});function Sn(){}function Tn(e){return e=vn(Ee(e)),btoa(e)}function _n(e,t){return t=void 0==t||t,e=Tn(e).replace(/\+/g,"-").replace(/\//g,"_"),t?e:e.replace(/[=]*$/,"")}function wn(t){t=e.atob(t.replace(/-/g,"+").replace(/_/g,"/"));for(var n=new Uint8Array(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}function En(t){for(var n=t.length/2,i=new Uint8Array(n),r=0;r<n;r++)i[r]=e.parseInt(t.substr(2*r,2),16);return i}function xn(e){var t=Ee(e);e="",t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value,n=n.toString(16),1==n.length&&(n="0"+n),e+=n;return e}function An(){for(var e=U.apply(0,arguments),t=0,n=0;n<e.length;++n)t+=e[n].byteLength;t=new Uint8Array(t);for(var i=n=0;i<e.length;++i){var r=e[i];r instanceof Uint8Array?t.set(r,n):t.set(Ee(r),n),n+=r.byteLength}return t}function kn(e,t){if(0==t.length)return e;if(1==e.length&&1==t.length){var n=new ht(e[0]);return t=new ht(t[0]),[n.resolve(t).toString()]}t=t.map(function(e){return new ht(e)}),n=[],e=c(e);for(var i=e.next();!i.done;i=e.next()){i=new ht(i.value);for(var r=c(t),a=r.next();!a.done;a=r.next())n.push(i.resolve(a.value).toString())}return n}function In(e,t,n,i){return e={keySystem:e,encryptionScheme:t,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:n||[],keyIds:new Set},i&&(e.keySystemUris=new Set([i])),e}function Cn(t,n){n=void 0===n?"cenc":n;var i=[],r=[],a=[];t.forEach(function(e,t){var n=t;22!=n.length&&(n=_n(En(t),!1));var s=e;22!=s.length&&(s=_n(En(e),!1)),e={kty:"oct",kid:n,k:s},i.push(e),r.push(e.kid),a.push(t)}),t=JSON.stringify({keys:i});var s=JSON.stringify({kids:r});return s=[{initData:Ee(gn(s)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",encryptionScheme:n,licenseServerUri:"data:application/json;base64,"+e.btoa(t),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:s,keyIds:new Set(a)}}function Rn(e,t){if(1==t.length)return t[0];if(e=Mn(e,t),null!=e)return e;throw new It(2,4,4025,t)}function Mn(e,t){for(var n=c(Nn[e]),i=n.next();!i.done;i=n.next()){i=i.value;for(var r=c(t),a=r.next();!a.done;a=r.next())if(a=a.value,i.test(a.trim()))return a.trim()}return e==Ln?"":null}function Dn(e,t){var n=[];e=c(Nn[e]);for(var i=e.next();!i.done;i=e.next()){i=i.value;for(var r=c(t),a=r.next();!a.done;a=r.next())a=a.value,i.test(a.trim())&&n.push(a.trim())}return n}z("shaka.util.Uint8ArrayUtils",Sn),Sn.concat=An,Sn.toHex=xn,Sn.fromHex=En,Sn.fromBase64=wn,Sn.toBase64=_n,Sn.toStandardBase64=Tn;var Ln="text",Pn={ga:"video",X:"audio",ta:Ln,Ze:"image",nj:"application"},On=1/15,Nn={audio:[/^vorbis$/,/^Opus$/,/^opus$/,/^fLaC$/,/^flac$/,/^mp4a/,/^[ae]c-3$/,/^ac-4/,/^dts[cex]$/,/^iamf/,/^mhm[12]/],video:[/^avc/,/^hev/,/^hvc/,/^vvc/,/^vvi/,/^vp0?[89]/,/^av01/,/^dvh/,/^dva/,/^dav/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function Un(){}function Fn(e,t){var n=e;return t&&!Xn.includes(e)&&(n+='; codecs="'+t+'"'),n}function Bn(e,t){return t&&(e+='; codecs="'+t+'"'),e}function Vn(e,t,n){var i=Fn(e,t);return t=Bn(e,t),at(t)?(e=at(t))?(e=e(),n=e.convertCodecs(n,t),e.destroy()):n=t:n="video/mp2t"!=e&&"audio"==n?i.replace("video","audio"):i,n}function jn(e,t,n){var i=[t];return Yn.forEach(function(t,r){var a=e[r];"codecs"==r?Xn.includes(e.mimeType)||i.push('codecs="'+n+'"'):a&&i.push(t+'="'+a+'"')}),"PQ"==e.hdr&&i.push('eotf="smpte2084"'),i.join(";")}function Gn(e){return e.split(";")[0].split("/")[1]}function Hn(e){var t=qn(e);switch(e=t[0],t=t[1].toLowerCase(),!0){case"mp4a"===e&&"69"===t:case"mp4a"===e&&"6b"===t:case"mp4a"===e&&"40.34"===t:return"mp3";case"mp4a"===e&&"66"===t:case"mp4a"===e&&"67"===t:case"mp4a"===e&&"68"===t:case"mp4a"===e&&"40.2"===t:case"mp4a"===e&&"40.02"===t:case"mp4a"===e&&"40.5"===t:case"mp4a"===e&&"40.05"===t:case"mp4a"===e&&"40.29"===t:case"mp4a"===e&&"40.42"===t:return"aac";case"mp4a"===e&&"a5"===t:return"ac-3";case"mp4a"===e&&"a6"===t:return"ec-3";case"mp4a"===e&&"b2"===t:return"dtsx";case"mp4a"===e&&"a9"===t:return"dtsc";case"avc1"===e:case"avc3"===e:return"avc";case"hvc1"===e:case"hev1"===e:return"hevc";case"dvh1"===e:case"dvhe"===e:return"dovi-hevc";case"dvav"===e:case"dva1"===e:return"dovi-avc";case"dav1"===e:return"dovi-av1"}return e}function zn(e){var t=[];e=c(e.split(","));for(var n=e.next();!n.done;n=e.next())n=qn(n.value),t.push(n[0]);return t.sort().join(",")}function Kn(e){return e.split(";")[0]}function $n(e){return e=e.split(/ *; */),e.shift(),(e=e.find(function(e){return e.startsWith("codecs=")}))?e.split("=")[1].replace(/^"|"$/g,""):""}function Wn(e){return"application/x-mpegurl"===e||"application/vnd.apple.mpegurl"===e}function qn(e){e=e.split(".");var t=e[0];return e.shift(),[t,e.join(".")]}z("shaka.util.MimeUtils",Un),Un.getFullTypeWithAllCodecs=Bn,Un.getFullType=Fn;var Yn=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels"),Xn=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"];function Qn(e){this.i=null,this.j=e,this.B=!1,this.l=this.s=0,this.m=1/0,this.h=this.g=null,this.C="",this.A=function(){},this.o=new Map}function Zn(e){return!!ri[e]||("application/cea-608"==e||"application/cea-708"==e)&&!!Me}function Jn(e,t,n,i,r){var a,s,o,l,u,d,h;return N(function(f){if(1==f.g)return _(f,Promise.resolve(),2);if(!e.i||!e.j)return f.return();if(null==n||null==i)return e.i.parseInit(Ee(t)),f.return();for(a=e.B?n:e.s,s={periodStart:e.s,segmentStart:n,segmentEnd:i,vttOffset:a},o=e.i.parseMedia(Ee(t),s,r),l=c(o),u=l.next();!u.done;u=l.next())d=u.value,e.A(d,r||null,s);h=o.filter(function(t){return t.startTime>=e.l&&t.startTime<e.m}),e.j.append(h),null==e.g&&(e.g=Math.max(n,e.l)),e.h=Math.min(i,e.m),w(f)})}function ei(e,t,n){e.l=t,e.m=n}function ti(e,t,n){if(e.C=t,t=e.o.get(t))for(var i=c(t.keys()),r=i.next();!r.done;r=i.next())(r=t.get(r.value).filter(function(e){return e.endTime<=n}))&&e.j.append(r)}function ni(e,t,n){t.startTime+=n,t.endTime+=n,t=c(t.nestedCues);for(var i=t.next();!i.done;i=t.next())ni(e,i.value,n)}function ii(e,t,n,i,r){var a=n+" "+i,s=new Map;t=c(t);for(var o=t.next();!o.done;o=t.next()){var l=o.value;o=l.stream,l=l.cue,s.has(o)||s.set(o,new Map),s.get(o).has(a)||s.get(o).set(a,[]),ni(e,l,r),l.startTime>=e.l&&l.startTime<e.m&&(s.get(o).get(a).push(l),o==e.C&&e.j.append([l]))}for(r=c(s.keys()),a=r.next();!a.done;a=r.next())for(a=a.value,e.o.has(a)||e.o.set(a,new Map),t=c(s.get(a).keys()),o=t.next();!o.done;o=t.next())o=o.value,l=s.get(a).get(o),e.o.get(a).set(o,l);e.g=null==e.g?Math.max(n,e.l):Math.min(e.g,Math.max(n,e.l)),e.h=Math.max(e.h,Math.min(i,e.m))}Qn.prototype.destroy=function(){return this.j=this.i=null,this.o.clear(),Promise.resolve()},Qn.prototype.remove=function(e,t){var n=this;return N(function(i){if(1==i.g)return _(i,Promise.resolve(),2);!n.j||!n.j.remove(e,t)||null==n.g||t<=n.g||e>=n.h||(e<=n.g&&t>=n.h?n.g=n.h=null:e<=n.g&&t<n.h?n.g=t:e>n.g&&t>=n.h&&(n.h=e)),w(i)})},z("shaka.text.TextEngine",Qn),Qn.prototype.destroy=Qn.prototype.destroy,Qn.findParser=function(e){return ri[e]},Qn.unregisterParser=function(e){delete ri[e]},Qn.registerParser=function(e,t){ri[e]=t};var ri={};function ai(e,t){return e.concat(t)}function si(){}function oi(e){return null!=e}function li(){}function ui(e,t){return e=hi(e),t=hi(t),e.split("-")[0]==t.split("-")[0]}function ci(e,t){return e=hi(e),t=hi(t),e=e.split("-"),t=t.split("-"),e[0]==t[0]&&1==e.length&&2==t.length}function di(e,t){return e=hi(e),t=hi(t),e=e.split("-"),t=t.split("-"),2==e.length&&2==t.length&&e[0]==t[0]}function hi(e){e=c(e.split("-x-"));var t=e.next().value;t=void 0===t?"":t,e=e.next().value,e=void 0===e?"":e;var n=c(t.split("-"));return t=n.next().value,t=void 0===t?"":t,n=n.next().value,n=void 0===n?"":n,e=e?"x-"+e:"",t=t.toLowerCase(),t=vi.get(t)||t,n=n.toUpperCase(),(n?t+"-"+n:t)+(e?"-"+e:"")}function fi(e,t){return e=hi(e),t=hi(t),t==e?4:ci(t,e)?3:di(t,e)?2:ci(e,t)?1:0}function pi(e){var t=e.indexOf("-");return e=0<=t?e.substring(0,t):e,e=e.toLowerCase(),vi.get(e)||e}function gi(e){return e.language?hi(e.language):e.audio&&e.audio.language?hi(e.audio.language):e.video&&e.video.language?hi(e.video.language):"und"}function mi(e,t){e=hi(e);var n=new Set,i=c(t);for(t=i.next();!t.done;t=i.next())n.add(hi(t.value));for(i=c(n),t=i.next();!t.done;t=i.next())if(t=t.value,t==e)return t;for(i=c(n),t=i.next();!t.done;t=i.next())if(t=t.value,ci(t,e))return t;for(i=c(n),t=i.next();!t.done;t=i.next())if(t=t.value,di(t,e))return t;for(n=c(n),t=n.next();!t.done;t=n.next())if(t=t.value,ci(e,t))return t;return null}z("shaka.util.LanguageUtils",li),li.findClosestLocale=mi,li.getLocaleForVariant=gi,li.getLocaleForText=function(e){return hi(e.language||"und")},li.getBase=pi,li.relatedness=fi,li.areSiblings=function(e,t){var n=pi(e),i=pi(t);return e!=n&&t!=i&&n==i},li.normalize=hi,li.isSiblingOf=di,li.isParentOf=ci,li.areLanguageCompatible=ui,li.areLocaleCompatible=function(e,t){return e=hi(e),t=hi(t),e==t};var vi=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]);function yi(e){function t(e){switch(typeof e){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return e;default:if(!e||e.buffer instanceof ArrayBuffer)return e;if(n.has(e))return null;var i=e.constructor==Array;if(e.constructor!=Object&&!i)return null;n.add(e);var r,a=i?[]:{};for(r in e)a[r]=t(e[r]);return i&&(a.length=e.length),a}}var n=new WeakSet;return t(e)}function bi(e){var t,n={};for(t in e)n[t]=e[t];return n}function Si(){}function Ti(e,t,n,i){var r=e.variants;if((t.length||n.length)&&(r=_i(r,t,n)),i.length){for(t=new re,n=c(r),r=n.next();!r.done;r=n.next())r=r.value,t.push(String(r.video.width||0),r);var a=[];t.forEach(function(e,t){e=0;var n=[],r={};t=c(t);for(var s=t.next();!s.done;r={ld:r.ld},s=t.next())r.ld=s.value,s=i.filter(function(e){return function(t){return e.ld.decodingInfos[0][t]}}(r)).length,s>e?(e=s,n=[r.ld]):s==e&&n.push(r.ld);a.push.apply(a,d(n))}),r=a}n=new Set,t=new Set;var s=c(r);for(r=s.next();!r.done;r=s.next())r=r.value,r.audio&&n.add(r.audio),r.video&&t.add(r.video);n=Array.from(n).sort(function(e,t){return e.bandwidth-t.bandwidth});var o=[];for(r=new Map,n=c(n),s=n.next();!s.done;s=n.next()){s=s.value;var l=s.language+(s.channelsCount||0)+(s.audioSamplingRate||0)+s.roles.join(",")+s.label+s.groupId+s.fastSwitching,u=r.get(l)||[];if(u.length){var h=u[u.length-1],f=Hn(h.codecs),p=Hn(s.codecs);f!=p||s.bandwidth&&h.bandwidth&&!(s.bandwidth>h.bandwidth)||(u.push(s),o.push(s.id))}else u.push(s),o.push(s.id);r.set(l,u)}n=Array.from(t).sort(function(e,t){return e.bandwidth&&t.bandwidth?e.bandwidth-t.bandwidth:e.width-t.width}),t=de();var g=[];for(r=new Map,n=c(n),s=n.next();!s.done;s=n.next()){if(s=s.value,l=Math.round(s.frameRate||0)+(s.hdr||"")+s.fastSwitching,u=r.get(l)||[],u.length){if(h=u[u.length-1],!t&&(f=Hn(h.codecs),p=Hn(s.codecs),f!==p))continue;s.width>h.width||s.height>h.height?(u.push(s),g.push(s.id)):s.width==h.width&&s.height==h.height&&(f=Hn(h.codecs),p=Hn(s.codecs),f!=p||s.bandwidth&&h.bandwidth&&!(s.bandwidth>h.bandwidth)||(u.push(s),g.push(s.id)))}else u.push(s),g.push(s.id);r.set(l,u)}e.variants=e.variants.filter(function(e){var t=e.audio;return e=e.video,!(t&&!o.includes(t.id)||e&&!g.includes(e.id))})}function _i(e,t,n){var i={};t=c(t);for(var r=t.next();!r.done;i={Xe:i.Xe},r=t.next())if(i.Xe=r.value,r=e.filter(function(e){return function(t){return t.video&&t.video.codecs.startsWith(e.Xe)}}(i)),r.length){e=r;break}for(i={},n=c(n),t=n.next();!t.done;i={Pe:i.Pe},t=n.next())if(i.Pe=t.value,t=e.filter(function(e){return function(t){return t.audio&&t.audio.codecs.startsWith(e.Pe)}}(i)),t.length){e=t;break}return e}function wi(e,t,n){e.variants=e.variants.filter(function(e){return Ei(e,t,n)})}function Ei(e,t,n){function i(e,t,n){return e>=t&&e<=n}var r=e.video;if(r&&r.width&&r.height){var a=r.width,s=r.height;if(s>a&&(s=c([s,a]),a=s.next().value,s=s.next().value),!i(a,t.minWidth,Math.min(t.maxWidth,n.width))||!i(s,t.minHeight,Math.min(t.maxHeight,n.height))||!i(r.width*r.height,t.minPixels,t.maxPixels))return!1}return!(e&&e.video&&e.video.frameRate&&!i(e.video.frameRate,t.minFrameRate,t.maxFrameRate)||e&&e.audio&&e.audio.channelsCount&&!i(e.audio.channelsCount,t.minChannelsCount,t.maxChannelsCount)||!i(e.bandwidth,t.minBandwidth,t.maxBandwidth))}function xi(e,t,n){var i=!1;e=c(e);for(var r=e.next();!r.done;r=e.next()){r=r.value;var a=r.allowedByApplication;r.allowedByApplication=Ei(r,t,n),a!=r.allowedByApplication&&(i=!0)}return i}function Ai(e,t,n){return n=void 0===n?[]:n,N(function(i){return 1==i.g?_(i,ki(e,t,0<t.offlineSessionIds.length,n),2):(Ni(t),_(i,Ui(t),0))})}function ki(e,t,n,i){var r,a;return N(function(s){if(1==s.g)return _(s,Di(t.variants,n,!1,i),2);r=null,e&&(a=e.g)&&(r=a.keySystem),t.variants=t.variants.filter(function(e){var t=Ii(e,r);if(!t){var n=[];e.audio&&n.push(Xi(e.audio)),e.video&&n.push(Xi(e.video))}return t}),w(s)})}function Ii(e,t){var n=jt(),i=an("Firefox")&&nn(),r=e.video,a=r&&r.width||0,s=r&&r.height||0;if(n&&r&&(1920<a||1080<s)&&(r.codecs.includes("avc1.")||r.codecs.includes("avc3.")))return!1;if(r){if(n=Oi(r.codecs),r.codecs.includes(",")){if(a=r.codecs.split(","),n=Rn("video",a),n=Oi(n),a=Rn("audio",a),a=Pi(a,r.mimeType),s=Vn(r.mimeType,a,"audio"),!ce(s))return!1;n=[n,a].join()}if(a=Vn(r.mimeType,n,"video"),!ce(a))return!1;r.codecs=n}if(r=e.audio,i&&r&&r.encrypted&&r.codecs.toLowerCase().includes("opus"))return!1;if(r){if(i=Pi(r.codecs,r.mimeType),n=Vn(r.mimeType,i,"audio"),!ce(n))return!1;r.codecs=i}return e.decodingInfos.some(function(e){return!(!e.supported||t&&(e=e.keySystemAccess)&&e.keySystem!=t)})}function Ci(e){var t=[];for(n in e)t.push(n);t.sort();var n=[];t=c(t);for(var i=t.next();!i.done;i=t.next()){var r=i.value;i=JSON.stringify(r),r=e[r],r instanceof Object?(r=Ci(r),n.push(i+":"+r)):(r=JSON.stringify(r),n.push(i+":"+r))}return"{"+n.join(",")+"}"}function Ri(e,t){var n,i,r,a,s,o,l;return N(function(u){if(1==u.g){for(n=function(e,t){if(e){var n=bi(e);return n.supported=e.supported&&t.supported,n.powerEfficient=e.powerEfficient&&t.powerEfficient,n.smooth=e.smooth&&t.smooth,t.keySystemAccess&&!n.keySystemAccess&&(n.keySystemAccess=t.keySystemAccess),n}return t},i=null,r=[],a={},s=c(t),o=s.next();!o.done;a={Wc:a.Wc,Xc:a.Xc},o=s.next())l=o.value,a.Xc=Ci(l),a.Wc=Qi,a.Wc[a.Xc]?i=n(i,a.Wc[a.Xc]):r.push(Mi(l).then(function(e){return function(t){var r=null;t=c(t||[]);for(var a=t.next();!a.done;a=t.next())r=n(r,a.value);r&&(e.Wc[e.Xc]=r,i=n(i,r))}}(a)));return _(u,Promise.all(r),2)}i&&e.decodingInfos.push(i),w(u)})}function Mi(e){var t=[""];e.video&&(t=$n(e.video.contentType).split(","));var n=[""];e.audio&&(n=$n(e.audio.contentType).split(","));var i=[];t=c(t);for(var r=t.next();!r.done;r=t.next()){r=r.value;for(var a={},s=c(n),o=s.next();!o.done;a={fc:a.fc},o=s.next())o=o.value,a.fc=yi(e),e.video&&(a.fc.video.contentType=Fn(Kn(a.fc.video.contentType),r)),e.audio&&(a.fc.audio.contentType=Fn(Kn(a.fc.audio.contentType),o)),i.push(new Promise(function(e){return function(t,n){navigator.mediaCapabilities.decodingInfo(e.fc).then(function(e){t(e)}).catch(n)}}(a)))}return Promise.all(i).catch(function(){return JSON.stringify(e),null})}function Di(e,t,n,i){var r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S;return N(function(T){switch(T.g){case 1:if(e.some(function(e){return e.decodingInfos.length}))return T.return();r={},a=c(i),s=a.next();case 2:if(s.done){T.u(4);break}r.Se=s.value,o=!1,l=c(e),u=l.next();case 5:if(u.done){T.u(7);break}d=u.value,h=Li(d,t,n).filter(function(e){return function(t){return t=t[0],(t.keySystemConfiguration&&t.keySystemConfiguration.keySystem)===e.Se}}(r)),f=c(h),p=f.next();case 8:if(p.done){T.u(10);break}return g=p.value,_(T,Ri(d,g),9);case 9:p=f.next(),T.u(8);break;case 10:d.decodingInfos.length&&(o=!0),u=l.next(),T.u(5);break;case 7:if(o)return T.return();r={Se:r.Se},s=a.next(),T.u(2);break;case 4:m=c(e),u=m.next();case 12:if(u.done){T.u(0);break}v=u.value,y=Li(v,t,n).filter(function(e){return e=e[0],e=e.keySystemConfiguration&&e.keySystemConfiguration.keySystem,!e||!i.includes(e)}),b=c(y),p=b.next();case 15:if(p.done){u=m.next(),T.u(12);break}return S=p.value,_(T,Ri(v,S),16);case 16:p=b.next(),T.u(15)}})}function Li(e,t,n){var i=e.audio,r=e.video,a=[],s=[];if(r)for(var o=c(r.fullMimeTypes),l=o.next();!l.done;l=o.next()){l=l.value;var u=$n(l);if(u.includes(",")&&!i){var d=u.split(","),h=Kn(l);u=Rn("video",d),d=Rn("audio",d),d=Pi(d,h),h=Vn(h,d,"audio"),s.push({contentType:h,channels:2,bitrate:e.bandwidth||1,samplerate:1,spatialRendering:!1})}if(u=Oi(u),l={contentType:Vn(Kn(l),u,"video"),width:r.width||64,height:r.height||64,bitrate:r.bandwidth||e.bandwidth||1,framerate:r.frameRate||1},r.hdr)switch(r.hdr){case"SDR":l.transferFunction="srgb";break;case"PQ":l.transferFunction="pq";break;case"HLG":l.transferFunction="hlg"}r.colorGamut&&(l.colorGamut=r.colorGamut),a.push(l)}if(i)for(o=c(i.fullMimeTypes),l=o.next();!l.done;l=o.next())u=l.value,l=Kn(u),u=Pi($n(u),l),l=Vn(l,u,"audio"),s.push({contentType:l,channels:i.channelsCount||2,bitrate:i.bandwidth||e.bandwidth||1,samplerate:i.audioSamplingRate||1,spatialRendering:i.spatialAudio});for(o=[],0==a.length&&a.push(null),0==s.length&&s.push(null),a=c(a),l=a.next();!l.done;l=a.next())for(l=l.value,u=c(s),h=u.next();!h.done;h=u.next())h=h.value,d={type:n?"file":"media-source"},l&&(d.video=l),h&&(d.audio=h),o.push(d);if(s=(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[]),!s.length)return[o];e=[],n=new Map,s=c(s);for(var f=s.next();!f.done;f=s.next())a=f.value,n.get(a.keySystem)||n.set(a.keySystem,[]),n.get(a.keySystem).push(a);for(s=t?"required":"optional",t=t?["persistent-license"]:["temporary"],a=c(n.keys()),l=a.next();!l.done;l=a.next()){for(l=l.value,u=[],h=c(o),d=h.next();!d.done;d=h.next()){d=Object.assign({},d.value);var p=n.get(l),g={keySystem:l,initDataType:"cenc",persistentState:s,distinctiveIdentifier:"optional",sessionTypes:t};for(p=c(p),f=p.next();!f.done;f=p.next()){if(f=f.value,f.initData&&f.initData.length){for(var m=new Set,v=c(f.initData),y=v.next();!y.done;y=v.next())m.add(y.value.initDataType);g.initDataType=f.initData[0].initDataType}f.distinctiveIdentifierRequired&&(g.distinctiveIdentifier="required"),f.persistentStateRequired&&(g.persistentState="required"),f.sessionType&&(g.sessionTypes=[f.sessionType]),i&&(g.audio?(f.encryptionScheme&&(g.audio.encryptionScheme=g.audio.encryptionScheme||f.encryptionScheme),g.audio.robustness=g.audio.robustness||f.audioRobustness):(g.audio={robustness:f.audioRobustness},f.encryptionScheme&&(g.audio.encryptionScheme=f.encryptionScheme)),""==g.audio.robustness&&delete g.audio.robustness),r&&(g.video?(f.encryptionScheme&&(g.video.encryptionScheme=g.video.encryptionScheme||f.encryptionScheme),g.video.robustness=g.video.robustness||f.videoRobustness):(g.video={robustness:f.videoRobustness},f.encryptionScheme&&(g.video.encryptionScheme=f.encryptionScheme)),""==g.video.robustness&&delete g.video.robustness)}d.keySystemConfiguration=g,u.push(d)}e.push(u)}return e}function Pi(e,t){return"flac"==e.toLowerCase()?en()?"fLaC":"flac":"opus"===e.toLowerCase()?en()&&"mp4"==Gn(t)?"Opus":"opus":e}function Oi(e){if(e.includes("avc1")){var t=e.split(".");if(3==t.length)return e=t.shift()+".",e+=parseInt(t.shift(),10).toString(16),e+("000"+parseInt(t.shift(),10).toString(16)).slice(-4)}else if("vp9"==e)return"vp09.00.41.08";return e}function Ni(e){e.textStreams=e.textStreams.filter(function(e){return e=Fn(e.mimeType,e.codecs),Zn(e)})}function Ui(e){var t,n,i,r,a,s,o;return N(function(l){switch(l.g){case 1:t=[],n=c(e.imageStreams),i=n.next();case 2:if(i.done){l.u(4);break}if(r=i.value,a=r.mimeType,"application/mp4"==a&&"mjpg"==r.codecs&&(a="image/jpg"),Ji.has(a)){l.u(5);break}if(s=er.get(a),!s){Ji.set(a,!1),l.u(5);break}return _(l,Fi(s),7);case 7:o=l.h,Ji.set(a,o);case 5:Ji.get(a)&&t.push(r),i=n.next(),l.u(2);break;case 4:e.imageStreams=t,w(l)}})}function Fi(e){return new Promise(function(t){var n=new Image;n.src=e,"decode"in n?n.decode().then(function(){t(!0)}).catch(function(){t(!1)}):n.onload=n.onerror=function(){t(2===n.height)}})}function Bi(e){var t=e.audio,n=e.video,i=t?t.mimeType:null,r=n?n.mimeType:null,a=t?t.codecs:null,s=n?n.codecs:null,o=[];s&&o.push(s),a&&o.push(a);var l=[];n&&l.push(n.mimeType),t&&l.push(t.mimeType),l=l[0]||null;var u=[];t&&u.push(t.kind),n&&u.push(n.kind),u=u[0]||null;var d=new Set;if(t)for(var h=c(t.roles),f=h.next();!f.done;f=h.next())d.add(f.value);if(n)for(h=c(n.roles),f=h.next();!f.done;f=h.next())d.add(f.value);return e={id:e.id,active:!1,type:"variant",bandwidth:e.bandwidth,language:e.language,label:null,kind:u,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,colorGamut:null,videoLayout:null,mimeType:l,audioMimeType:i,videoMimeType:r,codecs:o.join(", "),audioCodec:a,videoCodec:s,primary:e.primary,roles:Array.from(d),audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null,accessibilityPurpose:null,originalLanguage:null},n&&(e.videoId=n.id,e.originalVideoId=n.originalId,e.width=n.width||null,e.height=n.height||null,e.frameRate=n.frameRate||null,e.pixelAspectRatio=n.pixelAspectRatio||null,e.videoBandwidth=n.bandwidth||null,e.hdr=n.hdr||null,e.colorGamut=n.colorGamut||null,e.videoLayout=n.videoLayout||null),t&&(e.audioId=t.id,e.originalAudioId=t.originalId,e.channelsCount=t.channelsCount,e.audioSamplingRate=t.audioSamplingRate,e.audioBandwidth=t.bandwidth||null,e.spatialAudio=t.spatialAudio,e.label=t.label,e.audioRoles=t.roles,e.accessibilityPurpose=t.accessibilityPurpose,e.originalLanguage=t.originalLanguage),e}function Vi(e){return{id:e.id,active:!1,type:Ln,bandwidth:0,language:e.language,label:e.label,kind:e.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,colorGamut:null,videoLayout:null,mimeType:e.mimeType,audioMimeType:null,videoMimeType:null,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:e.primary,roles:e.roles,audioRoles:null,forced:e.forced,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:e.originalId,originalImageId:null,accessibilityPurpose:e.accessibilityPurpose,originalLanguage:e.originalLanguage}}function ji(e){var t=e.width||null,n=e.height||null,i=null;e.segmentIndex&&(i=e.segmentIndex.get(0));var r=e.tilesLayout;return i&&(r=i.tilesLayout||r),r&&null!=t&&(t/=Number(r.split("x")[0])),r&&null!=n&&(n/=Number(r.split("x")[1])),{id:e.id,active:!1,type:"image",bandwidth:e.bandwidth||0,language:"",label:null,kind:null,width:t,height:n,frameRate:null,pixelAspectRatio:null,hdr:null,colorGamut:null,videoLayout:null,mimeType:e.mimeType,audioMimeType:null,videoMimeType:null,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:r||null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:e.originalId,accessibilityPurpose:null,originalLanguage:null}}function Gi(e){return e.__shaka_id||(e.__shaka_id=Zi++),e.__shaka_id}function Hi(e){var t=Ki(e);return t.active="disabled"!=e.mode,t.type="text",t.originalTextId=e.id,"captions"==e.kind&&(t.mimeType="unknown"),"subtitles"==e.kind&&(t.mimeType="text/vtt"),e.kind&&(t.roles=[e.kind]),"forced"==e.kind&&(t.forced=!0),t}function zi(e){var t=Ki(e);return t.active=e.enabled,t.type="variant",t.originalAudioId=e.id,"main"==e.kind&&(t.primary=!0),e.kind&&(t.roles=[e.kind],t.audioRoles=[e.kind],t.label=e.label),t}function Ki(e){var t=e.language;return{id:Gi(e),active:!1,type:"",bandwidth:0,language:hi(t||"und"),label:e.label,kind:e.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,colorGamut:null,videoLayout:null,mimeType:null,audioMimeType:null,videoMimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],forced:!1,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null,accessibilityPurpose:null,originalLanguage:t}}function $i(e){return e.allowedByApplication&&e.allowedByKeySystem&&0==e.disabledUntilTime}function Wi(e){return e.filter(function(e){return $i(e)})}function qi(e,t,n,i){var r=e,a=e.filter(function(e){return e.primary});a.length&&(r=a);var s=r.length?r[0].language:"";if(r=r.filter(function(e){return e.language==s}),t){var o=mi(hi(t),e.map(function(e){return e.language}));o&&(r=e.filter(function(e){return hi(e.language)==o}))}if(r=r.filter(function(e){return e.forced==i}),n){if(e=Yi(r,n),e.length)return e}else if(e=r.filter(function(e){return 0==e.roles.length}),e.length)return e;return e=r.map(function(e){return e.roles}).reduce(ai,[]),e.length?Yi(r,e[0]):r}function Yi(e,t){return e.filter(function(e){return e.roles.includes(t)})}function Xi(e){return"audio"==e.type?"type=audio codecs="+e.codecs+" bandwidth="+e.bandwidth+" channelsCount="+e.channelsCount+" audioSamplingRate="+e.audioSamplingRate:"video"==e.type?"type=video codecs="+e.codecs+" bandwidth="+e.bandwidth+" frameRate="+e.frameRate+" width="+e.width+" height="+e.height:"unexpected stream type"}z("shaka.util.StreamUtils",Si),Si.meetsRestrictions=Ei;var Qi={},Zi=0,Ji=(new Map).set("image/svg+xml",!0).set("image/png",!0).set("image/jpeg",!0).set("image/jpg",!0),er=(new Map).set("image/webp","data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA").set("image/avif","data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=");function tr(){var e=this;this.A=null,this.s=!1,this.i=new Y,this.F=new ae,navigator.connection&&navigator.connection.addEventListener&&this.F.D(navigator.connection,"change",function(){if(e.s&&e.g.useNetworkInformation){e.i=new Y,e.g&&e.i.configure(e.g.advanced);var t=e.chooseVariant();t&&navigator.onLine&&e.A(t,e.g.clearBufferSwitch,e.g.safeMarginSwitch)}}),this.o=[],this.B=1,this.G=!1,this.h=this.m=this.g=this.j=null,this.C=new Ut(function(){if(e.g.restrictToElementSize){var t=e.chooseVariant();t&&e.A(t,e.g.clearBufferSwitch,e.g.safeMarginSwitch)}}),this.l=null}function nr(e){if(!e.G){var t=e.i;if(!(t.g>=t.i))return;e.G=!0,e.j-=1e3*(e.g.switchInterval-e.g.minTimeToSwitch)}Date.now()-e.j<1e3*e.g.switchInterval||(t=e.chooseVariant(),e.getBandwidthEstimate(),t&&e.A(t,e.g.clearBufferSwitch,e.g.safeMarginSwitch))}function ir(e,t,n,i,r){if(e.l){var a=e.l.Ng();a&&(n=n.filter(function(e){return!e.bandwidth||!a||e.bandwidth<=a}))}return t&&(n=n.filter(function(e){return Ei(e,t,{width:r,height:i})})),n.sort(function(e,t){return e.bandwidth-t.bandwidth})}function rr(e){var t=[];e=c(e);for(var n=e.next();!n.done;n=e.next())(n=n.value.video)&&n.height&&n.width&&t.push({height:n.height,width:n.width});return t.sort(function(e,t){return e.width-t.width})}i=tr.prototype,i.stop=function(){this.A=null,this.s=!1,this.o=[],this.B=1,this.m=this.j=null,this.h&&(this.h.disconnect(),this.h=null),this.C.stop(),this.l=null},i.release=function(){this.F.release(),this.C=null},i.init=function(e){this.A=e},i.chooseVariant=function(t){t=void 0!==t&&t;var n=1/0,i=1/0;if(this.g.restrictToScreenSize&&(i=this.g.ignoreDevicePixelRatio?1:e.devicePixelRatio,n=e.screen.height*i,i*=e.screen.width),this.h&&this.g.restrictToElementSize){var r=this.g.ignoreDevicePixelRatio?1:e.devicePixelRatio;n=Math.min(n,this.m.clientHeight*r),i=Math.min(i,this.m.clientWidth*r)}var a=this.o.filter(function(e){return e&&!(e.audio&&e.audio.fastSwitching||e.video&&e.video.fastSwitching)});if(a.length||(a=this.o),r=a,t&&a.length!=this.o.length&&(r=this.o.filter(function(e){return e&&!!(e.audio&&e.audio.fastSwitching||e.video&&e.video.fastSwitching)})),t=ir(this,this.g.restrictions,r,1/0,1/0),1/0!=n||1/0!=i){for(t=rr(t),t=c(t),a=t.next();!a.done;a=t.next())if(a=a.value,a.height>=n&&a.width>=i){n=a.height,i=a.width;break}t=ir(this,this.g.restrictions,r,n,i)}for(n=this.getBandwidthEstimate(),r.length&&!t.length&&(t=ir(this,null,r,1/0,1/0),t=[t[0]]),i=t[0]||null,r=0;r<t.length;r++){a=t[r];for(var s=isNaN(this.B)?1:Math.abs(this.B),o=s*a.bandwidth/this.g.bandwidthDowngradeTarget,l={bandwidth:1/0},u=r+1;u<t.length;u++)if(a.bandwidth!=t[u].bandwidth){l=t[u];break}s=s*l.bandwidth/this.g.bandwidthUpgradeTarget,n>=o&&n<=s&&(i.bandwidth!=a.bandwidth||i.bandwidth==a.bandwidth&&i.video&&a.video&&(i.video.width<a.video.width||i.video.height<a.video.height))&&(i=a)}return this.j=Date.now(),i},i.enable=function(){this.s=!0},i.disable=function(){this.s=!1},i.segmentDownloaded=function(e,t,n){e<this.g.cacheLoadThreshold||(this.i.sample(e,t),n&&null!=this.j&&this.s&&nr(this))},i.trySuggestStreams=function(){null!=this.j&&this.s&&nr(this)},i.getBandwidthEstimate=function(){var e=this.g.defaultBandwidthEstimate;return navigator.connection&&navigator.connection.downlink&&this.g.useNetworkInformation&&(e=1e6*navigator.connection.downlink),e=this.i.getBandwidthEstimate(e),this.l?this.l.getBandwidthEstimate(e):e},i.setVariants=function(e){this.o=e},i.playbackRateChanged=function(e){this.B=e},i.setMediaElement=function(t){var n=this;this.m=t,this.h&&(this.h.disconnect(),this.h=null),this.m&&"ResizeObserver"in e&&(this.h=new ResizeObserver(function(){n.C.Y(ar)}),this.h.observe(this.m))},i.setCmsdManager=function(e){this.l=e},i.configure=function(e){this.g=e,this.i&&this.g&&this.i.configure(this.g.advanced)},z("shaka.abr.SimpleAbrManager",tr),tr.prototype.configure=tr.prototype.configure,tr.prototype.setCmsdManager=tr.prototype.setCmsdManager,tr.prototype.setMediaElement=tr.prototype.setMediaElement,tr.prototype.playbackRateChanged=tr.prototype.playbackRateChanged,tr.prototype.setVariants=tr.prototype.setVariants,tr.prototype.getBandwidthEstimate=tr.prototype.getBandwidthEstimate,tr.prototype.trySuggestStreams=tr.prototype.trySuggestStreams,tr.prototype.segmentDownloaded=tr.prototype.segmentDownloaded,tr.prototype.disable=tr.prototype.disable,tr.prototype.enable=tr.prototype.enable,tr.prototype.chooseVariant=tr.prototype.chooseVariant,tr.prototype.init=tr.prototype.init,tr.prototype.release=tr.prototype.release,tr.prototype.stop=tr.prototype.stop;var ar=1;function sr(e,t,n,i){for(n=void 0===n||n,i=void 0!==i&&i,this.h=e,this.g=new Set([e]),t=t||[],e=c(t),t=e.next();!t.done;t=e.next())this.add(t.value,n,i)}function or(e,t,n,i){var r;if(!(r=!!e.audio!=!!t.audio||!!e.video!=!!t.video||e.language!=t.language)&&(r=e.audio&&t.audio)){r=e.audio;var a=t.audio;r=!!((!r.channelsCount||!a.channelsCount||2<r.channelsCount||2<a.channelsCount)&&r.channelsCount!=a.channelsCount||r.spatialAudio!==a.spatialAudio||n&&!lr(r,a)||!ur(r.roles,a.roles)||i&&r.groupId!==a.groupId)}return!(i=r)&&(i=e.video&&t.video)&&(e=e.video,t=t.video,i=!((!n||lr(e,t))&&ur(e.roles,t.roles))),!i}function lr(e,t){if(e.mimeType!=t.mimeType)return!1;if(e=e.codecs.split(",").map(function(e){return zn(e)}),t=t.codecs.split(",").map(function(e){return zn(e)}),e.length!=t.length)return!1;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function ur(e,t){if(e=new Set(e),t=new Set(t),e.delete("main"),t.delete("main"),e.size!=t.size)return!1;e=c(e);for(var n=e.next();!n.done;n=e.next())if(!t.has(n.value))return!1;return!0}function cr(e,t,n){t=void 0===t?"reload":t,n=void 0!==n&&n,this.i=e,this.h=t,this.g=n,this.j=new dr(e.language,"",e.audio&&e.audio.channelsCount?e.audio.channelsCount:0,"",!1,"","","",t,n)}function dr(e,t,n,i,r,a,s,o,l,u,c){this.A=e,this.B=t,this.i=n,this.j=i,this.C=r,this.m=a,this.h=void 0===s?"":s,this.l=void 0===o?"":o,this.o=void 0===l?"reload":l,this.s=void 0!==u&&u,this.g=void 0===c?"":c}function hr(e,t){t=hi(t);var n=mi(t,e.map(function(e){return gi(e)}));return n?e.filter(function(e){return n==gi(e)}):[]}function fr(e,t){return e.filter(function(e){return!!e.audio&&(t?e.audio.roles.includes(t):0==e.audio.roles.length)})}function pr(e,t){return e.filter(function(e){return!(!e.audio||!e.audio.label)&&e.audio.label.toLowerCase()==t.toLowerCase()})}function gr(e,t){return e.filter(function(e){return!(!e.video||!e.video.label)&&e.video.label.toLowerCase()==t.toLowerCase()})}function mr(e,t){return e.filter(function(e){return!e.audio||!e.audio.channelsCount||e.audio.channelsCount==t})}function vr(t,n){return"AUTO"==n&&(n=e.matchMedia("(color-gamut: p3)").matches?"PQ":"SDR"),t.filter(function(e){return!e.video||!e.video.hdr||e.video.hdr==n})}function yr(e,t){return e.filter(function(e){return!e.video||!e.video.videoLayout||e.video.videoLayout==t})}function br(e,t){return e.filter(function(e){return!e.audio||e.audio.spatialAudio==t})}function Sr(e,t){return e.filter(function(e){return!e.audio||e.audio.codecs==t})}function Tr(){this.g=Er,this.i=(new Map).set(Er,2).set(wr,1),this.h=0}function _r(e,t,n){e.i.set(Er,n).set(wr,t)}z("shaka.config.AutoShowText",{NEVER:0,ALWAYS:1,IF_PREFERRED_TEXT_LANGUAGE:2,IF_SUBTITLES_MAY_BE_NEEDED:3}),z("shaka.config.CodecSwitchingStrategy",{Qj:"reload",yh:"smooth"}),sr.prototype.add=function(e,t,n){return!!or(this.h,e,void 0===t||t,void 0!==n&&n)&&(this.g.add(e),!0)},sr.prototype.values=function(){return this.g.values()},cr.prototype.create=function(e){var t=this,n="smooth"==this.h&&de(),i=e.filter(function(e){return or(t.i,e,!n,t.g)});return i.length?new sr(i[0],i,!n,this.g):this.j.create(e)},dr.prototype.create=function(e){var t=[];t=hr(e,this.A);var n=e.filter(function(e){return e.primary});return t=t.length?t:n.length?n:e,e=fr(t,this.B),e.length&&(t=e),this.m&&(e=yr(t,this.m),e.length&&(t=e)),this.j&&(e=vr(t,this.j),e.length&&(t=e)),this.i&&(e=mr(t,this.i),e.length&&(t=e)),this.h&&(e=pr(t,this.h),e.length&&(t=e)),this.l&&(e=gr(t,this.l),e.length&&(t=e)),e=br(t,this.C),e.length&&(t=e),this.g&&(e=Sr(t,this.g),e.length&&(t=e)),new sr(t[0],t,!("smooth"==this.o&&de()),this.s)};var wr=0,Er=1;function xr(e,t){var n=kr();this.l=null==e.maxAttempts?n.maxAttempts:e.maxAttempts,this.j=null==e.baseDelay?n.baseDelay:e.baseDelay,this.o=null==e.fuzzFactor?n.fuzzFactor:e.fuzzFactor,this.m=null==e.backoffFactor?n.backoffFactor:e.backoffFactor,this.g=0,this.h=this.j,(this.i=void 0!==t&&t)&&(this.g=1)}function Ar(e){var t,n;return N(function(i){if(1==i.g){if(e.g>=e.l){if(!e.i)throw new It(2,7,1010);e.g=1,e.h=e.j}return t=e.g,e.g++,0==t?i.return():(n=e.h*(1+(2*Math.random()-1)*e.o),_(i,new Promise(function(e){new Ut(e).Y(n/1e3)}),2))}e.h*=e.m,w(i)})}function kr(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4}}function Ir(){var e,t,n=new Promise(function(n,i){e=n,t=i});return n.resolve=e,n.reject=t,n}function Cr(e,t){this.promise=e,this.i=t,this.g=!1}function Rr(e){return new Cr(Promise.reject(e),function(){return Promise.resolve()})}function Mr(){var e=Promise.reject(new It(2,7,7001));return e.catch(function(){}),new Cr(e,function(){return Promise.resolve()})}function Dr(e){return new Cr(Promise.resolve(e),function(){return Promise.resolve()})}function Lr(e){return new Cr(e,function(){return e.catch(function(){})})}function Pr(e){return new Cr(Promise.all(e.map(function(e){return e.promise})),function(){return Promise.all(e.map(function(e){return e.abort()}))})}function Or(e,t,n){try{var i=e(t);return i&&i.promise&&i.abort?(n.resolve(i.promise),function(){return i.abort()}):(n.resolve(i),function(){return Promise.resolve(i).then(function(){},function(){})})}catch(e){return n.reject(e),function(){return Promise.resolve()}}}function Nr(t,n){if(n)if(n instanceof Map)for(var i=c(n.keys()),r=i.next();!r.done;r=i.next())r=r.value,Object.defineProperty(this,r,{value:n.get(r),writable:!0,enumerable:!0});else for(i in n)Object.defineProperty(this,i,{value:n[i],writable:!0,enumerable:!0});this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=e.performance&&e.performance.now?e.performance.now():Date.now(),this.type=t,this.isTrusted=!1,this.target=this.currentTarget=null,this.g=!1}function Ur(e){var t,n=new Nr(e.type);for(t in e)Object.defineProperty(n,t,{value:e[t],writable:!0,enumerable:!0});return n}Ir.prototype.resolve=function(){},Ir.prototype.reject=function(){},Cr.prototype.abort=function(){return this.g=!0,this.i()},Cr.prototype.finally=function(e){return this.promise.then(function(){return e(!0)},function(){return e(!1)}),this},Cr.prototype.Aa=function(e,t){function n(n){return function(o){if(r.g&&n)a.reject(s);else{var l=n?e:t;l?i=Or(l,o,a):(n?a.resolve:a.reject)(o)}}}function i(){return a.reject(s),r.abort()}var r=this,a=new Ir,s=new It(2,7,7001);return this.promise.then(n(!0),n(!1)),new Cr(a,function(){return i()})},z("shaka.util.AbortableOperation",Cr),Cr.prototype.chain=Cr.prototype.Aa,Cr.prototype["finally"]=Cr.prototype.finally,Cr.all=Pr,Cr.prototype.abort=Cr.prototype.abort,Cr.notAbortable=Lr,Cr.completed=Dr,Cr.aborted=Mr,Cr.failed=Rr,Nr.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},Nr.prototype.stopImmediatePropagation=function(){this.g=!0},Nr.prototype.stopPropagation=function(){},z("shaka.util.FakeEvent",Nr);var Fr={pj:"abrstatuschanged",qj:"adaptation",rj:"audiotrackchanged",sj:"buffering",tj:"complete",uj:"downloadfailed",vj:"downloadheadersreceived",wj:"drmsessionupdate",yj:"emsg",Pj:"prft",Error:"error",zj:"expirationupdated",Aj:"firstquartile",Bj:"gapjumped",Ej:"keystatuschanged",Gj:"loaded",Hj:"loading",Jj:"manifestparsed",Kj:"manifestupdated",Lj:"mediaqualitychanged",Metadata:"metadata",Mj:"midpoint",Nj:"nospatialvideoinfo",Oj:"onstatechange",Rj:"ratechange",Sj:"segmentappended",Tj:"sessiondata",Uj:"spatialvideoinfo",Vj:"stalldetected",Wj:"started",Xj:"statechanged",Yj:"streaming",Zj:"textchanged",$j:"texttrackvisibility",ak:"thirdquartile",bk:"timelineregionadded",ck:"timelineregionenter",dk:"timelineregionexit",ek:"trackschanged",gk:"unloading",ik:"variantchanged"};function Br(){this.ya=new re,this.Ge=this}function Vr(){this.g=[]}function jr(e,t){e.g.push(t.finally(function(){Ne(e.g,t)}))}function Gr(e,t,n,i,r,a){Br.call(this),this.i=!1,this.m=new Vr,this.g=new Set,this.h=new Set,this.l=e||null,this.j=t||null,this.A=n||null,this.B=i||null,this.F=r||null,this.C=a||null,this.o=this.s=!1}function Hr(e,t,n,i){n=n||Jr;var r=ea[e];(!r||n>=r.priority)&&(ea[e]={priority:n,De:t,Ki:void 0!==i&&i})}function zr(e,t){for(var n=c(e.g),i=n.next();!i.done;i=n.next())t.g.add(i.value);for(e=c(e.h),i=e.next();!i.done;i=e.next())t.h.add(i.value)}function Kr(e,t,n){return{uris:e,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:t,licenseRequestType:null,sessionId:null,drmInfo:null,initData:null,initDataType:null,streamDataCallback:void 0===n?null:n}}function $r(e,t,n,i){function r(e){a=a.Aa(function(){return n.body&&(n.body=we(n.body)),e(t,n,i)})}var a=Dr(void 0);e.B&&r(e.B),e=c(e.g);for(var s=e.next();!s.done;s=e.next())r(s.value);return a.Aa(void 0,function(e){if(e instanceof It&&7001==e.code)throw e;throw new It(2,1,1006,e)})}function Wr(e,t,n,i,r,a,s,o){e.s&&(n.uris[a]=n.uris[a].replace("https://","http://")),e.o&&(n.uris[a]=n.uris[a].replace("http://","https://")),0<a&&e.F&&e.F(t,i,n.uris[a],n.uris[a-1]);var l=new ht(n.uris[a]),u=l.Db,c=!1;u||(u=location.protocol,u=u.slice(0,-1),ft(l,u),n.uris[a]=l.toString()),u=u.toLowerCase();var d=(u=ea[u])?u.De:null;if(!d)return Rr(new It(2,1,1e3,l));var h,f=u.Ki,p=null,g=null,m=!1,v=!1;return Lr(Ar(r)).Aa(function(){if(e.i)return Mr();h=Date.now();var r=0;n.requestStartTime=Date.now();var s=d(n.uris[a],n,t,function(a,s,l){p&&p.stop(),g&&g.Y(u/1e3),e.l&&t==Zr&&(r++,n.packetNumber=r,e.l(a,s,Yr(i),n),c=!0,o.g=l)},function(i){e.j&&e.j(i,n,t),v=!0,n.timeToFirstByte=Date.now()-n.requestStartTime});if(!f)return s;var l=n.retryParameters.connectionTimeout;l&&(p=new Ut(function(){m=!0,s.abort()}),p.Y(l/1e3));var u=n.retryParameters.stallTimeout;return u&&(g=new Ut(function(){m=!0,s.abort()})),s}).Aa(function(i){p&&p.stop(),g&&g.stop(),void 0==i.timeMs&&(i.timeMs=Date.now()-h);var r={response:i,pi:c};return!v&&e.j&&e.j(i.headers,n,t),r},function(l){if(p&&p.stop(),g&&g.stop(),e.A){var u=null,c=0;l instanceof It&&(u=l,1001==l.code&&(c=l.data[1])),e.A(n,u,c,m)}if(e.i)return Mr();if(m&&(l=new It(1,1,1003,n.uris[a],t)),l instanceof It){if(7001==l.code)throw l;if(1010==l.code)throw s;if(1==l.severity)return u=(new Map).set("error",l),u=new Nr("retry",u),e.dispatchEvent(u),a=(a+1)%n.uris.length,Wr(e,t,n,i,r,a,l,o)}throw l})}function qr(e,t,n,i){var r=Dr(void 0),a={};e=c(e.h);for(var s=e.next();!s.done;a={Ue:a.Ue},s=e.next())a.Ue=s.value,r=r.Aa(function(e){return function(){var r=n.response;return r.data&&(r.data=we(r.data)),e.Ue(t,r,i)}}(a));return r.Aa(function(){return n},function(e){var t=2;if(e instanceof It){if(7001==e.code)throw e;t=e.severity}throw new It(t,1,1007,e)})}function Yr(e){if(e){var t=e.segment;if(e=e.stream,t&&e&&e.fastSwitching&&t.Kd)return!1}return!0}function Xr(){this.g=0}function Qr(e,t,n){Cr.call(this,e,t),this.h=n}Br.prototype.addEventListener=function(e,t){this.ya&&this.ya.push(e,t)},Br.prototype.removeEventListener=function(e,t){this.ya&&this.ya.remove(e,t)},Br.prototype.dispatchEvent=function(e){if(!this.ya)return!0;var t=this.ya.get(e.type)||[],n=this.ya.get("All");for(n&&(t=t.concat(n)),t=c(t),n=t.next();!n.done;n=t.next()){n=n.value,e.target=this.Ge,e.currentTarget=this.Ge;try{n.handleEvent?n.handleEvent(e):n.call(this,e)}catch(e){}if(e.g)break}return e.defaultPrevented},Br.prototype.release=function(){this.ya=null},Vr.prototype.destroy=function(){for(var e=[],t=c(this.g),n=t.next();!n.done;n=t.next())n=n.value,n.promise.catch(function(){}),e.push(n.abort());return this.g=[],Promise.all(e)},y(Gr,Br),i=Gr.prototype,i.fg=function(e){this.s=e},i.gg=function(e){this.o=e},i.Ni=function(e){this.g.add(e)},i.ij=function(e){this.g.delete(e)},i.Ag=function(){this.g.clear()},i.Oi=function(e){this.h.add(e)},i.jj=function(e){this.h.delete(e)},i.Bg=function(){this.h.clear()},i.destroy=function(){return this.i=!0,this.g.clear(),this.h.clear(),Br.prototype.release.call(this),this.m.destroy()},i.request=function(e,t,n){var i=this,r=new Xr;if(this.i){var a=Promise.reject(new It(2,7,7001));return a.catch(function(){}),new Qr(a,function(){return Promise.resolve()},r)}t.method=t.method||"GET",t.headers=t.headers||{},t.retryParameters=t.retryParameters?yi(t.retryParameters):kr(),t.uris=yi(t.uris),a=$r(this,e,t,n);var s=a.Aa(function(){return Wr(i,e,t,n,new xr(t.retryParameters,!1),0,null,r)}),o=s.Aa(function(t){return qr(i,e,t,n)}),l=Date.now(),u=0;a.promise.then(function(){u=Date.now()-l},function(){});var c=0;s.promise.then(function(){c=Date.now()},function(){});var d=o.Aa(function(r){var a=Date.now()-c,s=r.response;return s.timeMs+=u,s.timeMs+=a,r.pi||!i.l||s.fromCache||"HEAD"==t.method||e!=Zr||i.l(s.timeMs,s.data.byteLength,Yr(n)),i.C&&i.C(e,s,n),s},function(e){throw e&&(e.severity=2),e});return a=new Qr(d.promise,function(){return d.abort()},r),jr(this.m,a),a},z("shaka.net.NetworkingEngine",Gr),Gr.prototype.request=Gr.prototype.request,Gr.prototype.destroy=Gr.prototype.destroy,Gr.makeRequest=Kr,Gr.defaultRetryParameters=function(){return kr()},Gr.prototype.clearAllResponseFilters=Gr.prototype.Bg,Gr.prototype.unregisterResponseFilter=Gr.prototype.jj,Gr.prototype.registerResponseFilter=Gr.prototype.Oi,Gr.prototype.clearAllRequestFilters=Gr.prototype.Ag,Gr.prototype.unregisterRequestFilter=Gr.prototype.ij,Gr.prototype.registerRequestFilter=Gr.prototype.Ni,Gr.unregisterScheme=function(e){delete ea[e]},Gr.registerScheme=Hr,Gr.prototype.setForceHTTPS=Gr.prototype.gg,Gr.prototype.setForceHTTP=Gr.prototype.fg,Gr.NumBytesRemainingClass=Xr,y(Qr,Cr),Gr.PendingRequest=Qr;var Zr=1;Gr.RequestType={MANIFEST:0,SEGMENT:Zr,LICENSE:2,APP:3,TIMING:4,SERVER_CERTIFICATE:5,KEY:6,ADS:7,CONTENT_STEERING:8},Gr.AdvancedRequestType={INIT_SEGMENT:0,MEDIA_SEGMENT:1,MEDIA_PLAYLIST:2,MASTER_PLAYLIST:3,MPD:4,MSS:5,MPD_PATCH:6};var Jr=3;Gr.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:Jr};var ea={};function ta(e){this.g=!1,this.h=new Ir,this.i=e}function na(e,t){if(e.g){if(t instanceof It&&7003==t.code)throw t;throw new It(2,7,7003,t)}}function ia(e,t){var n=[];e=c(e);for(var i=e.next();!i.done;i=e.next())n.push(t(i.value));return n}function ra(e,t){e=c(e);for(var n=e.next();!n.done;n=e.next())if(!t(n.value))return!1;return!0}function aa(e){for(var t=new Map,n=c(Object.keys(e)),i=n.next();!i.done;i=n.next())i=i.value,t.set(i,e[i]);return t}function sa(e){var t={};return e.forEach(function(e,n){t[n]=e}),t}function oa(e,t){this.h=Ae(e),this.i=t==ua,this.g=0}function la(){return new It(2,3,3e3)}ta.prototype.destroy=function(){var e=this;return this.g?this.h:(this.g=!0,this.i().then(function(){e.h.resolve()},function(){e.h.resolve()}))},i=oa.prototype,i.oa=function(){return this.g<this.h.byteLength},i.ua=function(){return this.g},i.getLength=function(){return this.h.byteLength},i.T=function(){try{var e=this.h.getUint8(this.g);return this.g+=1,e}catch(e){throw la()}},i.ka=function(){try{var e=this.h.getUint16(this.g,this.i);return this.g+=2,e}catch(e){throw la()}},i.P=function(){try{var e=this.h.getUint32(this.g,this.i);return this.g+=4,e}catch(e){throw la()}},i.bh=function(){try{var e=this.h.getInt32(this.g,this.i);return this.g+=4,e}catch(e){throw la()}},i.Qc=function(){try{if(this.i)var e=this.h.getUint32(this.g,!0),t=this.h.getUint32(this.g+4,!0);else t=this.h.getUint32(this.g,!1),e=this.h.getUint32(this.g+4,!1)}catch(e){throw la()}if(2097151<t)throw new It(2,3,3001);return this.g+=8,t*Math.pow(2,32)+e},i.rb=function(e){if(this.g+e>this.h.byteLength)throw la();var t=Ee(this.h,this.g,e);return this.g+=e,t},i.skip=function(e){if(this.g+e>this.h.byteLength)throw la();this.g+=e},i.Vi=function(e){if(this.g<e)throw la();this.g-=e},i.seek=function(e){if(0>e||e>this.h.byteLength)throw la();this.g=e},i.tc=function(){for(var e=this.g;this.oa()&&0!=this.h.getUint8(this.g);)this.g+=1;return e=Ee(this.h,e,this.g-e),this.g+=1,hn(e)},z("shaka.util.DataViewReader",oa),oa.prototype.readTerminatedString=oa.prototype.tc,oa.prototype.seek=oa.prototype.seek,oa.prototype.rewind=oa.prototype.Vi,oa.prototype.skip=oa.prototype.skip,oa.prototype.readBytes=oa.prototype.rb,oa.prototype.readUint64=oa.prototype.Qc,oa.prototype.readInt32=oa.prototype.bh,oa.prototype.readUint32=oa.prototype.P,oa.prototype.readUint16=oa.prototype.ka,oa.prototype.readUint8=oa.prototype.T,oa.prototype.getLength=oa.prototype.getLength,oa.prototype.getPosition=oa.prototype.ua,oa.prototype.hasMoreData=oa.prototype.oa;var ua=1;function ca(){this.i=[],this.h=[],this.g=!1}function da(e){for(var t=ya(e);e.reader.oa()&&!e.parser.g;)e.parser.Oc(e.start+t,e.reader,e.partialOkay)}function ha(e){for(var t=ya(e),n=e.reader.P(),i=0;i<n&&(e.parser.Oc(e.start+t,e.reader,e.partialOkay),!e.parser.g);i++);}function fa(e){var t=ya(e);for(e.reader.skip(78);e.reader.oa()&&!e.parser.g;)e.parser.Oc(e.start+t,e.reader,e.partialOkay)}function pa(e){var t=ya(e);e.reader.skip(8);var n=e.reader.ka();for(e.reader.skip(6),2==n?e.reader.skip(48):e.reader.skip(12),1==n&&e.reader.skip(16);e.reader.oa()&&!e.parser.g;)e.parser.Oc(e.start+t,e.reader,e.partialOkay)}function ga(e){return function(t){e(t.reader.rb(t.reader.getLength()-t.reader.ua()))}}function ma(e){var t=0;e=c(e);for(var n=e.next();!n.done;n=e.next())t=t<<8|n.value.charCodeAt(0);return t}function va(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}function ya(e){return 8+(e.has64BitSize?8:0)+(null!=e.flags?4:0)}oa.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:ua},i=ca.prototype,i.box=function(e,t){return e=ma(e),this.i[e]=ba,this.h[e]=t,this},i.S=function(e,t){return e=ma(e),this.i[e]=Sa,this.h[e]=t,this},i.stop=function(){this.g=!0},i.parse=function(e,t,n){for(e=new oa(e,0),this.g=!1;e.oa()&&!this.g;)this.Oc(0,e,t,n)},i.Oc=function(e,t,n,i){var r=t.ua();if(i&&r+8>t.getLength())this.g=!0;else{var a=t.P(),s=t.P(),o=va(s),l=!1;switch(a){case 0:a=t.getLength()-r;break;case 1:if(i&&t.ua()+8>t.getLength())return void(this.g=!0);a=t.Qc(),l=!0}var u=this.h[s];if(u){var c=null,d=null;if(this.i[s]==Sa){if(i&&t.ua()+4>t.getLength())return void(this.g=!0);d=t.P(),c=d>>>24,d&=16777215}s=r+a,n&&s>t.getLength()&&(s=t.getLength()),i&&s>t.getLength()?this.g=!0:(i=s-t.ua(),t=0<i?t.rb(i):new Uint8Array(0),t=new oa(t,0),u({name:o,parser:this,partialOkay:n||!1,version:c,flags:d,reader:t,size:a,start:r+e,has64BitSize:l}))}else t.skip(Math.min(r+a-t.ua(),t.getLength()-t.ua()))}},z("shaka.util.Mp4Parser",ca),ca.headerSize=ya,ca.typeToString=va,ca.allData=ga,ca.audioSampleEntry=pa,ca.visualSampleEntry=fa,ca.sampleDescription=ha,ca.children=da,ca.prototype.parseNext=ca.prototype.Oc,ca.prototype.parse=ca.prototype.parse,ca.prototype.stop=ca.prototype.stop,ca.prototype.fullBox=ca.prototype.S,ca.prototype.box=ca.prototype.box;var ba=0,Sa=1;function Ta(e){var t=this;this.g=[],this.h=[],this.data=[],(new ca).box("moov",da).box("moof",da).S("pssh",function(e){if(!(1<e.version)){var n=Ee(e.reader.h,-12,e.size);if(t.data.push(n),t.g.push(xn(e.reader.rb(16))),0<e.version){n=e.reader.P();for(var i=0;i<n;i++){var r=xn(e.reader.rb(16));t.h.push(r)}}}}).parse(e)}function _a(e,t,n,i){var r=e.length,a=t.length+16+r;0<i&&(a+=4+16*n.size);var s=new Uint8Array(a),o=Ae(s),l=0;if(o.setUint32(l,a),l+=4,o.setUint32(l,1886614376),l+=4,1>i?o.setUint32(l,0):o.setUint32(l,16777216),l+=4,s.set(t,l),l+=t.length,0<i)for(o.setUint32(l,n.size),l+=4,t=c(n),n=t.next();!n.done;n=t.next())n=En(n.value),s.set(n,l),l+=n.length;return o.setUint32(l,r),s.set(e,l+4),s}
/*
 @license
 tXml
 Copyright 2015 Tobias Nickel
 SPDX-License-Identifier: MIT
*/
function wa(e,t){return e=pn(e),Ea(e,t)}function Ea(e,t){return e=Aa(e),!t&&e.length?e[0]:(e=e.find(function(e){return e.tagName===t}))?e:null}function xa(e){return Za.has(e)?Za.get(e):""}function Aa(e){function t(r,a){a=void 0!==a&&a;for(var s=[];e[i];)if(60==e.charCodeAt(i)){if(47===e.charCodeAt(i+1)){a=i+2,i=e.indexOf(">",i),a=e.substring(a,i);var o=a.indexOf(r);if(-1==o){var l=r.indexOf(".");0<l&&(o=a.indexOf(r.substring(0,l)))}if(-1==o)throw r=e.substring(0,i).split("\n"),Error("Unexpected close tag\nLine: "+(r.length-1)+"\nColumn: "+(r[r.length-1].length+1)+"\nChar: "+e[i]);i+1&&(i+=1);break}if(33===e.charCodeAt(i+1)){if(45==e.charCodeAt(i+2)){for(;-1!==i&&(62!==e.charCodeAt(i)||45!=e.charCodeAt(i-1)||45!=e.charCodeAt(i-2)||-1==i);)i=e.indexOf(">",i+1);-1===i&&(i=e.length)}else if(91===e.charCodeAt(i+2)&&91===e.charCodeAt(i+8)&&"cdata"===e.substr(i+3,5).toLowerCase()){o=e.indexOf("]]>",i),-1==o?(s.push(e.substr(i+9)),i=e.length):(s.push(e.substring(i+9,o)),i=o+3);continue}i++;continue}e:{l=a,i++;var u=n(),c={};for(o=[];62!==e.charCodeAt(i)&&e[i];){var h=e.charCodeAt(i);if(64<h&&91>h||96<h&&123>h){h=n();for(var f=e.charCodeAt(i);f&&39!==f&&34!==f&&!(64<f&&91>f||96<f&&123>f)&&62!==f;)i++,f=e.charCodeAt(i);var p=i+1;if(i=e.indexOf(e[i],p),p=e.slice(p,i),39===f||34===f){if(-1===i){for(l={tagName:u,attributes:c,children:o,parent:null},u=0;u<o.length;u++)"string"!==typeof o[u]&&(o[u].parent=l);o=l;break e}}else p=null,i--;h.startsWith("xmlns:")&&Za.set(p,h.split(":")[1]),"tt"===u&&"xml:space"===h&&"preserve"===p&&(l=!0),c[h]=p}i++}for(47!==e.charCodeAt(i-1)?(i++,o=t(u,l)):i++,l={tagName:u,attributes:c,children:o,parent:null},u=o.length,c=0;c<u;c++)h=o[c],"string"!==typeof h?h.parent=l:c==u-1&&"\n"==h&&o.pop();o=l}if(s.push(o),"string"===typeof o)break;"?"===o.tagName[0]&&o.children&&(s.push.apply(s,d(o.children)),o.children=[])}else o=i,i=e.indexOf("<",i)-1,-2===i&&(i=e.length),o=e.slice(o,i+1),a?0<o.length&&s.push(o):s.length&&1==o.length&&"\n"==o[0]?s.push(o):0<o.trim().length&&s.push(o),i++;return s}function n(){for(var t=i;-1==="\r\n\t>/= ".indexOf(e[i])&&e[i];)i++;return e.slice(t,i)}var i=0;return t("")}function ka(e){return"string"===typeof e}function Ia(e){var t=[];if(!e.children)return[];e=c(e.children);for(var n=e.next();!n.done;n=e.next())n=n.value,"string"!==typeof n&&t.push(n);return t}function Ca(e,t){var n=[];if(!e.children)return[];e=c(e.children);for(var i=e.next();!i.done;i=e.next())i=i.value,i.tagName===t&&n.push(i);return n}function Ra(e){return"string"===typeof e?yn(e):(e=e.children.reduce(function(e,t){return"string"===typeof t?e+t:e},""),""===e?null:yn(e))}function Ma(e){return Array.from(e.children).every(function(e){return"string"===typeof e})?((e=Ra(e))&&(e=e.trim()),e):null}function Da(e,t,n){if(n=void 0===n?[]:n,e.tagName===t&&n.push(e),e.children){e=c(e.children);for(var i=e.next();!i.done;i=e.next())Da(i.value,t,n)}return n}function La(e,t){return e=Ca(e,t),1!=e.length?null:e[0]}function Pa(e,t,n){return e=Ua(e,t,n),1!=e.length?null:e[0]}function Oa(e,t,n,i){i=void 0===i?null:i;var r=null;return e=e.attributes[t],null!=e&&(r=n(e)),null==r?i:r}function Na(e,t,n){return t=xa(t),e.attributes[t+":"+n]||null}function Ua(e,t,n){t=xa(t);var i=[];if(e.children){e=c(e.children);for(var r=e.next();!r.done;r=e.next())(r=r.value)&&r.tagName===t+":"+n&&i.push(r)}return i}function Fa(e,t,n){t=c(t);for(var i=t.next();!i.done;i=t.next())if(i=Na(e,i.value,n))return i;return null}function Ba(e){return e?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),e=Date.parse(e),isNaN(e)?null:e/1e3):null}function Va(e){return e?(e=RegExp("^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$").exec(e),e?(e=31536e3*Number(e[1]||null)+2592e3*Number(e[2]||null)+86400*Number(e[3]||null)+3600*Number(e[4]||null)+60*Number(e[5]||null)+Number(e[6]||null),isFinite(e)?e:null):null):null}function ja(e){var t=/([0-9]+)-([0-9]+)/.exec(e);return t?(e=Number(t[1]),isFinite(e)?(t=Number(t[2]),isFinite(t)?{start:e,end:t}:null):null):null}function Ga(e){return e=Number(e),0===e%1?e:null}function Ha(e){return e=Number(e),0===e%1&&0<e?e:null}function za(e){return e=Number(e),0===e%1&&0<=e?e:null}function Ka(e){return e=Number(e),isNaN(e)?null:e}function $a(e){return!!e&&"true"===e.toLowerCase()}function Wa(e){var t,n=(t=e.match(/^(\d+)\/(\d+)$/))?Number(t[1])/Number(t[2]):Number(e);return isNaN(n)?null:n}function qa(e){var t=[];e=yn(e).split(/\/+(?=(?:[^'"]*['"][^'"]*['"])*[^'"]*$)/),e=c(e);for(var n=e.next();!n.done;n=e.next()){n=n.value;var i=n.match(/^([\w]+)/);if(i){var r=n.match(/(@id='(.*?)')/),a=n.match(/\[(\d+)\]/);t.push({name:i[0],id:r?r[0].match(/'(.*?)'/)[0].replace(/'/gm,""):null,position:a?Number(a[1])-1:null,Vb:n.split("/@")[1]||null})}else n.startsWith("@")&&t.length&&(t[t.length-1].Vb=n.slice(1))}return t}function Ya(e,t){var n=qa(t.attributes.sel||"");if(n.length){var i=n[n.length-1],r=t.attributes.pos||null;n=i.position,null===n?n="prepend"===r?0:e.length:"prepend"===r?--n:"after"===r&&++n,r=t.tagName,(i=i.Vb)?Xa(e[n],r,i,Ma(t)||""):("remove"!==r&&"replace"!==r||e.splice(n,1),"add"!==r&&"replace"!==r||e.splice.apply(e,[n,0].concat(d(t.children))))}}function Xa(e,t,n,i){"remove"===t?delete e.attributes[n]:"add"!==t&&"replace"!==t||(e.attributes[n]=i)}function Qa(e,t,n){t=void 0===t||t,n=void 0===n||n;var i,r=document.createElement(e.tagName);for(i in e.attributes)r.setAttribute(i,e.attributes[i]);if(t&&e.parent&&"?xml"!=e.parent.tagName&&Qa(e.parent,!0,!1).appendChild(r),n)for(e=c(e.children),t=e.next();!t.done;t=e.next())t=t.value,n=void 0,n="string"==typeof t?new Text(t):Qa(t,!1,!0),r.appendChild(n);return r}var Za=new Map([]);function Ja(e){var t=this;this.C=e,this.H=new Set,this.m=this.s=null,this.fa=this.da=!1,this.I=0,this.g=null,this.B=new ae,this.i=new Map,this.A=new Map,this.l=new Ir,this.h=null,this.o=function(n){2==n.severity&&t.l.reject(n),e.onError(n)},this.Z=new Map,this.ea=new Map,this.L=new Ut(function(){return _s(t)}),this.R=!1,this.N=[],this.U=!1,this.K=new Ut(function(){ks(t)}),this.l.catch(function(){}),this.j=new ta(function(){return es(t)}),this.aa=!1,this.F=this.G=null}function es(e){return N(function(t){switch(t.g){case 1:return e.B.release(),e.B=null,e.l.reject(),e.K.stop(),e.K=null,e.L.stop(),e.L=null,_(t,xs(e),2);case 2:if(!e.m){t.u(3);break}return E(t,4),_(t,e.m.setMediaKeys(null),6);case 6:A(t,5);break;case 4:k(t);case 5:e.m=null;case 3:e.g=null,e.H.clear(),e.s=null,e.A=new Map,e.h=null,e.o=function(){},e.C=null,e.aa=!1,e.G=null,w(t)}})}function ts(e,t,n){return e.fa=!0,e.A=new Map,e.R=n,rs(e,t)}function ns(e,t,n){e.A=new Map,n=c(n);for(var i=n.next();!i.done;i=n.next())e.A.set(i.value,{initData:null,initDataType:null});for(n=c(e.h.persistentSessionsMetadata),i=n.next();!i.done;i=n.next())i=i.value,e.A.set(i.sessionId,{initData:i.initData,initDataType:i.initDataType});return e.R=0<e.A.size,rs(e,t)}function is(e,t,n,i,r,a){var s=new Map;return r={audioCapabilities:r,videoCapabilities:a,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:t},r.drmInfos=[{keySystem:t,licenseServerUri:n,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:i,serverCertificateUri:"",initData:null,keyIds:null}],s.set(t,r),hs(e,s,[])}function rs(e,t){var n,i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b;return N(function(S){if(1==S.g){if(n=gs(e))for(i=c(t),r=i.next();!r.done;r=i.next())a=r.value,a.video&&(a.video.drmInfos=[n]),a.audio&&(a.audio.drmInfos=[n]);for(s=t.some(function(e){return!!(e.video&&e.video.drmInfos.length||e.audio&&e.audio.drmInfos.length)}),s||(o=aa(e.h.servers),Rs(t,o)),l=new Set,u=c(t),r=u.next();!r.done;r=u.next())for(d=r.value,h=As(d),f=c(h),p=f.next();!p.done;p=f.next())g=p.value,l.add(g);for(m=c(l),p=m.next();!p.done;p=m.next())v=p.value,Ds(v,aa(e.h.servers),aa(e.h.advanced||{}),e.h.keySystemsMapping);return _(S,Di(t,e.R,e.aa,e.h.preferredKeySystems),2)}return na(e.j),y=s||Object.keys(e.h.servers).length,y?(b=hs(e,void 0,t),S.return(s?b:b.catch(function(){}))):(e.da=!0,S.return(Promise.resolve()))})}function as(e){var t;return N(function(n){switch(n.g){case 1:if(e.m.mediaKeys)return n.return();if(!e.G){n.u(2);break}return _(n,e.G,3);case 3:return na(e.j),n.return();case 2:return E(n,4),e.G=e.m.setMediaKeys(e.s),_(n,e.G,6);case 6:A(n,5);break;case 4:t=k(n),e.o(new It(2,6,6003,t.message));case 5:na(e.j),w(n)}})}function ss(e,t){return N(function(n){if(1==n.g)return _(n,as(e),2);cs(e,t.initDataType,Ee(t.initData)),w(n)})}function os(e){var t,n,i,r,a;return N(function(s){switch(s.g){case 1:if(!e.s||!e.g)return s.return();if(!e.g.serverCertificateUri||e.g.serverCertificate&&e.g.serverCertificate.length){s.u(2);break}return t=Kr([e.g.serverCertificateUri],e.h.retryParameters),E(s,3),n=e.C.Nb.request(5,t),_(s,n.promise,5);case 5:i=s.h,e.g.serverCertificate=Ee(i.data),A(s,4);break;case 3:throw r=k(s),new It(2,6,6017,r);case 4:if(e.j.g)return s.return();case 2:return e.g.serverCertificate&&e.g.serverCertificate.length?(E(s,6),_(s,e.s.setServerCertificate(e.g.serverCertificate),8)):s.return();case 8:A(s,0);break;case 6:throw a=k(s),new It(2,6,6004,a.message)}})}function ls(e,t){var n,i,r;return N(function(a){return 1==a.g?_(a,ys(e,t,{initData:null,initDataType:null}),2):3!=a.g?(n=a.h,n?(i=[],(r=e.i.get(n))&&(r.mb=new Ir,i.push(r.mb)),i.push(n.remove()),_(a,Promise.all(i),3)):a.return()):(e.i.delete(n),void w(a))})}function us(e){var t,n,i,r,a;return N(function(s){if(1==s.g)return e.A.size?(e.A.forEach(function(t,n){ys(e,n,t)}),_(s,e.l,3)):s.u(2);if(2!=s.g){if(t=e.g&&e.g.keyIds||new Set([]),0<t.size&&Cs(e))return s.return(e.l);e.l=new Ir,e.l.catch(function(){})}for(n=(e.g?e.g.initData:[])||[],i=c(n),r=i.next();!r.done;r=i.next())a=r.value,cs(e,a.initDataType,a.initData);return Is(e)&&e.l.resolve(),s.return(e.l)})}function cs(e,t,n){if(n.length){if(e.h.ignoreDuplicateInitData){var i=e.i.values();i=c(i);for(var r=i.next();!r.done;r=i.next())if(Te(n,r.value.initData))return}0<e.i.size&&Is(e)&&(e.l.resolve(),e.l=new Ir,e.l.catch(function(){})),bs(e,t,n,e.g.sessionType)}}function ds(e){return e=e.i.keys(),e=ia(e,function(e){return e.sessionId}),Array.from(e)}function hs(e,t,n){var i,r,a,s,o,l,u,d,h,f,p,g,m,v,y;return N(function(b){switch(b.g){case 1:if(i=new Map,n.length){r=fs(e,n,i),b.u(2);break}return _(b,ps(e,t),3);case 3:r=b.h;case 2:if(a=r,!a)throw new It(2,6,6001);for(na(e.j),E(b,4),e.H.clear(),s=a.getConfiguration(),o=s.audioCapabilities||[],l=s.videoCapabilities||[],u=c(o),d=u.next();!d.done;d=u.next())h=d.value,e.H.add(h.contentType.toLowerCase());for(f=c(l),d=f.next();!d.done;d=f.next())p=d.value,e.H.add(p.contentType.toLowerCase());if(n.length){var S=a.keySystem,T=i.get(a.keySystem),w=[],x=[],I=[],C=[],R=[],M=new Set,D=new Set;Ms(T,w,x,C,I,R,M,D);var L=e.R?"persistent-license":"temporary";for(S={keySystem:S,encryptionScheme:w[0],licenseServerUri:x[0],distinctiveIdentifierRequired:T[0].distinctiveIdentifierRequired,persistentStateRequired:T[0].persistentStateRequired,sessionType:T[0].sessionType||L,audioRobustness:T[0].audioRobustness||"",videoRobustness:T[0].videoRobustness||"",serverCertificate:C[0],serverCertificateUri:I[0],initData:R,keyIds:M},0<D.size&&(S.keySystemUris=D),T=c(T),D=T.next();!D.done;D=T.next())D=D.value,D.distinctiveIdentifierRequired&&(S.distinctiveIdentifierRequired=D.distinctiveIdentifierRequired),D.persistentStateRequired&&(S.persistentStateRequired=D.persistentStateRequired);T=S}else T=a.keySystem,D=t.get(a.keySystem),S=[],w=[],x=[],I=[],C=[],R=new Set,Ms(D.drmInfos,S,w,I,x,C,R),T={keySystem:T,encryptionScheme:S[0],licenseServerUri:w[0],distinctiveIdentifierRequired:"required"==D.distinctiveIdentifier,persistentStateRequired:"required"==D.persistentState,sessionType:D.sessionTypes[0]||"temporary",audioRobustness:(D.audioCapabilities?D.audioCapabilities[0].robustness:"")||"",videoRobustness:(D.videoCapabilities?D.videoCapabilities[0].robustness:"")||"",serverCertificate:I[0],serverCertificateUri:x[0],initData:C,keyIds:R};if(e.g=T,!e.g.licenseServerUri)throw new It(2,6,6012,e.g.keySystem);return _(b,a.createMediaKeys(),6);case 6:if(g=b.h,na(e.j),e.s=g,!(""!=e.h.minHdcpVersion&&"getStatusForPolicy"in e.s)){b.u(7);break}return E(b,8),_(b,e.s.getStatusForPolicy({minHdcpVersion:e.h.minHdcpVersion}),10);case 10:if(m=b.h,"usable"!=m)throw new It(2,6,6018);na(e.j),A(b,7,4);break;case 8:if(v=k(b,4),v instanceof It)throw v;throw new It(2,6,6019,v.message);case 7:return e.da=!0,_(b,os(e),11);case 11:na(e.j),A(b,0);break;case 4:if(y=k(b),na(e.j,y),e.g=null,e.H.clear(),y instanceof It)throw y;throw new It(2,6,6002,y.message)}})}function fs(e,t,n){for(var i=c(t),r=i.next();!r.done;r=i.next()){var a=c(As(r.value));for(r=a.next();!r.done;r=a.next())r=r.value,n.has(r.keySystem)||n.set(r.keySystem,[]),n.get(r.keySystem).push(r)}if(1==n.size&&n.has(""))throw new It(2,6,6e3);for(i={},e=c(e.h.preferredKeySystems),r=e.next();!r.done;i={Te:i.Te},r=e.next())for(i.Te=r.value,a=c(t),r=a.next();!r.done;r=a.next())if(r=r.value.decodingInfos.find(function(e){return function(t){return t.supported&&null!=t.keySystemAccess&&t.keySystemAccess.keySystem==e.Te}}(i)))return r.keySystemAccess;for(e=c([!0,!1]),r=e.next();!r.done;r=e.next())for(i=r.value,a=c(t),r=a.next();!r.done;r=a.next()){var s=c(r.value.decodingInfos);for(r=s.next();!r.done;r=s.next()){var o=r.value;if(o.supported&&o.keySystemAccess){r=n.get(o.keySystemAccess.keySystem);var l=c(r);for(r=l.next();!r.done;r=l.next())if(!!r.value.licenseServerUri==i)return o.keySystemAccess}}}return null}function ps(e,t){var n,i,r,a,s,o,l,u,d,h,f,p,g,m,v;return N(function(y){switch(y.g){case 1:if(1==t.size&&t.has(""))throw new It(2,6,6e3);for(i=c(t.values()),r=i.next();!r.done;r=i.next())a=r.value,0==a.audioCapabilities.length&&delete a.audioCapabilities,0==a.videoCapabilities.length&&delete a.videoCapabilities;s=c(e.h.preferredKeySystems),o=s.next();case 2:if(o.done){y.u(4);break}if(l=o.value,!t.has(l)){y.u(3);break}return u=t.get(l),E(y,6),_(y,navigator.requestMediaKeySystemAccess(l,[u]),8);case 8:return n=y.h,y.return(n);case 6:k(y);case 7:na(e.j);case 3:o=s.next(),y.u(2);break;case 4:d=c([!0,!1]),h=d.next();case 9:if(h.done){y.u(11);break}f=h.value,p=c(t.keys()),o=p.next();case 12:if(o.done){h=d.next(),y.u(9);break}if(g=o.value,m=t.get(g),v=m.drmInfos.some(function(e){return!!e.licenseServerUri}),v!=f){y.u(13);break}return E(y,15),_(y,navigator.requestMediaKeySystemAccess(g,[m]),17);case 17:return n=y.h,y.return(n);case 15:k(y);case 16:na(e.j);case 13:o=p.next(),y.u(12);break;case 11:return y.return(n)}})}function gs(e){return e=aa(e.h.clearKeys),0==e.size?null:Cn(e)}function ms(e){Is(e)&&e.l.resolve()}function vs(e,t){new Ut(function(){t.loaded=!0,ms(e)}).Y(Ps)}function ys(e,t,n){var i,r,a,s,o,l,u;return N(function(c){switch(c.g){case 1:try{i=e.s.createSession("persistent-license")}catch(t){return r=new It(2,6,6005,t.message),e.o(r),c.return(Promise.reject(r))}return e.B.D(i,"message",function(t){e.m&&e.h.delayLicenseRequestUntilPlayed&&e.m.paused&&!e.U?e.N.push(t):Ss(e,t)}),e.B.D(i,"keystatuseschange",function(t){return Ts(e,t)}),a={initData:n.initData,initDataType:n.initDataType,loaded:!1,Rf:1/0,mb:null,type:"persistent-license"},e.i.set(i,a),E(c,2),_(c,i.load(t),4);case 4:return s=c.h,na(e.j),s||(e.i.delete(i),o=e.h.persistentSessionOnlinePlayback?1:2,e.o(new It(o,6,6013)),a.loaded=!0),vs(e,a),ms(e),c.return(i);case 2:l=k(c),na(e.j,l),e.i.delete(i),u=e.h.persistentSessionOnlinePlayback?1:2,e.o(new It(u,6,6005,l.message)),a.loaded=!0,ms(e);case 3:return c.return(Promise.resolve())}})}function bs(e,t,n,i){try{var r=e.s.createSession(i)}catch(t){return void e.o(new It(2,6,6005,t.message))}e.B.D(r,"message",function(t){e.m&&e.h.delayLicenseRequestUntilPlayed&&e.m.paused&&!e.U?e.N.push(t):Ss(e,t)}),e.B.D(r,"keystatuseschange",function(t){return Ts(e,t)}),e.i.set(r,{initData:n,initDataType:t,loaded:!1,Rf:1/0,mb:null,type:i});try{n=e.h.initDataTransform(n,t,e.g)}catch(n){return t=n,n instanceof It||(t=new It(2,6,6016,n)),void e.o(t)}e.h.logLicenseExchange&&_n(n),r.generateRequest(t,n).catch(function(t){if(!e.j.g){e.i.delete(r);var n=t.errorCode;if(n&&n.systemCode){var i=n.systemCode;0>i&&(i+=Math.pow(2,32)),i="0x"+i.toString(16)}e.o(new It(2,6,6006,t.message,t,i))}})}function Ss(e,t){var n,i,r,a,s,o,l,u,d,h,f,p,g,m;N(function(v){switch(v.g){case 1:if(n=t.target,e.h.logLicenseExchange&&_n(t.message),i=e.i.get(n),r=e.g.licenseServerUri,a=e.h.advanced[e.g.keySystem],"individualization-request"==t.messageType&&a&&a.individualizationServer&&(r=a.individualizationServer),s=Kr([r],e.h.retryParameters),s.body=t.message,s.method="POST",s.licenseRequestType=t.messageType,s.sessionId=n.sessionId,s.drmInfo=e.g,i&&(s.initData=i.initData,s.initDataType=i.initDataType),a&&a.headers)for(o in a.headers)s.headers[o]=a.headers[o];if(Lt(e.g.keySystem)){var y=fn(s.body,!0,!0);if(y.includes("PlayReadyKeyMessage")){y=Ea(y,"PlayReadyKeyMessage");var b=Da(y,"HttpHeader");b=c(b);for(var S=b.next();!S.done;S=b.next()){var T=S.value;S=Da(T,"name")[0],T=Da(T,"value")[0],s.headers[Ra(S)]=Ra(T)}y=Da(y,"Challenge")[0],s.body=wn(Ra(y))}else s.headers["Content-Type"]="text/xml; charset=utf-8"}return l=Date.now(),E(v,2),d=e.C.Nb.request(2,s),_(v,d.promise,4);case 4:u=v.h,A(v,3);break;case 2:return h=k(v),e.j.g?v.return():(f=new It(2,6,6007,h),1==e.i.size?(e.o(f),i&&i.mb&&i.mb.reject(f)):(i&&i.mb&&i.mb.reject(f),e.i.delete(n),Is(e)&&(e.l.resolve(),e.L.Y(.1))),v.return());case 3:return e.j.g?v.return():(e.I+=(Date.now()-l)/1e3,e.h.logLicenseExchange&&_n(u.data),E(v,5),_(v,n.update(u.data),7));case 7:A(v,6);break;case 5:return p=k(v),g=new It(2,6,6008,p.message),e.o(g),i&&i.mb&&i.mb.reject(g),v.return();case 6:if(e.j.g)return v.return();m=new Nr("drmsessionupdate"),e.C.onEvent(m),i&&(i.mb&&i.mb.resolve(),vs(e,i)),w(v)}})}function Ts(e,t){t=t.target;var n=e.i.get(t),i=!1;t.keyStatuses.forEach(function(t,r){if("string"==typeof r){var a=r;r=t,t=a}if(Lt(e.g.keySystem)&&16==r.byteLength&&(Vt()||Qt())){a=Ae(r);var s=a.getUint32(0,!0),o=a.getUint16(4,!0),l=a.getUint16(6,!0);a.setUint32(0,s,!1),a.setUint16(4,o,!1),a.setUint16(6,l,!1)}"status-pending"!=t&&(n.loaded=!0),"expired"==t&&(i=!0),r=xn(r).slice(0,32),e.Z.set(r,t)});var r=t.expiration-Date.now();(0>r||i&&1e3>r)&&n&&!n.mb&&(e.i.delete(t),t.close().catch(function(){})),Is(e)&&(e.l.resolve(),e.L.Y(Os))}function _s(e){var t=e.Z,n=e.ea;n.clear(),t.forEach(function(e,t){return n.set(t,e)}),t=Array.from(n.values()),t.length&&t.every(function(e){return"expired"==e})&&e.o(new It(2,6,6014)),e.C.Ae(sa(n))}function ws(){var e,t,n,i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,x,I,C,R,M;return N(function(D){if(1==D.g){for(e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.microsoft.playready.hardware com.microsoft.playready.recommendation com.chromecast.playready com.apple.fps.1_0 com.apple.fps".split(" "),t=["SW_SECURE_CRYPTO","SW_SECURE_DECODE","HW_SECURE_CRYPTO","HW_SECURE_DECODE","HW_SECURE_ALL"],n=["150","2000","3000"],i={"com.widevine.alpha":t,"com.microsoft.playready.recommendation":n},r=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],a=[{contentType:'audio/mp4; codecs="mp4a.40.2"'},{contentType:'audio/webm; codecs="opus"'}],s={videoCapabilities:r,audioCapabilities:a,initDataTypes:["cenc","sinf","skd","keyids"]},o=[null,"cenc","cbcs","cbcs-1-9"],l=new Map,u=function(e,t){var n,i,r,a,s,o,u,c;return N(function(d){switch(d.g){case 1:return E(d,2),_(d,t.createMediaKeys(),4);case 4:A(d,3);break;case 2:return k(d),d.return();case 3:i=!!(n=t.getConfiguration().sessionTypes)&&n.includes("persistent-license"),Ht()&&(i=!1),r=t.getConfiguration().videoCapabilities,a=t.getConfiguration().audioCapabilities,s={persistentState:i,encryptionSchemes:[],videoRobustnessLevels:[],audioRobustnessLevels:[]},l.has(e)&&l.get(e)?s=l.get(e):l.set(e,s),(o=r[0].encryptionScheme)&&!s.encryptionSchemes.includes(o)&&s.encryptionSchemes.push(o),(u=r[0].robustness)&&!s.videoRobustnessLevels.includes(u)&&s.videoRobustnessLevels.push(u),(c=a[0].robustness)&&!s.audioRobustnessLevels.includes(c)&&s.audioRobustnessLevels.push(c),w(d)}})},d=function(e,t,n,i){var r,a,o,l,d,h,f,p,g;return N(function(m){switch(m.g){case 1:for(E(m,2),r=yi(s),a=c(r.videoCapabilities),o=a.next();!o.done;o=a.next())l=o.value,l.encryptionScheme=t,l.robustness=n;for(d=c(r.audioCapabilities),o=d.next();!o.done;o=d.next())h=o.value,h.encryptionScheme=t,h.robustness=i;return f=yi(r),f.persistentState="required",f.sessionTypes=["persistent-license"],p=[f,r],_(m,navigator.requestMediaKeySystemAccess(e,p),4);case 4:return g=m.h,_(m,u(e,g),5);case 5:A(m,0);break;case 2:k(m),w(m)}})},h=function(e,t,n,i){var s,o,l;return N(function(c){switch(c.g){case 1:return E(c,2),s={type:"media-source",video:{contentType:r[0].contentType,width:640,height:480,bitrate:1,framerate:1},audio:{contentType:a[0].contentType,channels:2,bitrate:1,samplerate:1},keySystemConfiguration:{keySystem:e,video:{encryptionScheme:t,robustness:n},audio:{encryptionScheme:t,robustness:i}}},_(c,navigator.mediaCapabilities.decodingInfo(s),4);case 4:return o=c.h,l=o.keySystemAccess,_(c,u(e,l),5);case 5:A(c,0);break;case 2:k(c),w(c)}})},f=c(e),p=f.next();!p.done;p=f.next())g=p.value,l.set(g,null);for(m=[],v=c(o),y=v.next();!y.done;y=v.next())for(b=y.value,S=c(e),p=S.next();!p.done;p=S.next())T=p.value,"org.w3.clearkey"===T&&en()||(m.push(d(T,b,"","")),m.push(h(T,b,"","")));for(x=c(e),p=x.next();!p.done;p=x.next())for(I=p.value,C=c(i[I]||[]),R=C.next();!R.done;R=C.next())M=R.value,m.push(d(I,null,M,"")),m.push(d(I,null,"",M)),m.push(h(I,null,M,"")),m.push(h(I,null,"",M));return _(D,Promise.all(m),2)}return D.return(sa(l))})}function Es(e){var t;return N(function(n){return 1==n.g?(t=new Promise(function(e,t){new Ut(t).Y(Ls)}),E(n,2),_(n,Promise.race([Promise.all([e.close(),e.closed]),t]),4)):2!=n.g?A(n,0):(k(n),void w(n))})}function xs(e){var t;return N(function(n){return t=Array.from(e.i.entries()),e.i.clear(),_(n,Promise.all(t.map(function(t){t=c(t);var n=t.next().value,i=t.next().value;return N(function(t){return 1==t.g?(E(t,2),e.fa||e.A.has(n.sessionId)||"persistent-license"!==i.type||e.h.persistentSessionOnlinePlayback?_(t,Es(n),5):_(t,n.remove(),5)):2!=t.g?A(t,0):(k(t),void w(t))})})),0)})}function As(e){return(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[])}function ks(e){e.i.forEach(function(t,n){var i=t.Rf,r=n.expiration;isNaN(r)&&(r=1/0),r!=i&&(e.C.onExpirationUpdated(n.sessionId,r),t.Rf=r)})}function Is(e){return e=e.i.values(),ra(e,function(e){return e.loaded})}function Cs(e){for(var t=c(e.g&&e.g.keyIds||new Set([])),n=t.next();!n.done;n=t.next())if("usable"!==e.Z.get(n.value))return!1;return!0}function Rs(e,t){var n=[];for(t.forEach(function(e,t){n.push({keySystem:t,licenseServerUri:e,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",initData:[],keyIds:new Set})}),e=c(e),t=e.next();!t.done;t=e.next())t=t.value,t.video&&(t.video.drmInfos=n),t.audio&&(t.audio.drmInfos=n)}function Ms(t,n,i,r,a,s,o,l){var u=[],h={};t=c(t);for(var f=t.next();!f.done;h={na:h.na},f=t.next()){if(h.na=f.value,n.includes(h.na.encryptionScheme)||n.push(h.na.encryptionScheme),"org.w3.clearkey"==h.na.keySystem&&h.na.licenseServerUri.startsWith("data:application/json;base64,")?u.includes(h.na.licenseServerUri)||u.push(h.na.licenseServerUri):i.includes(h.na.licenseServerUri)||i.push(h.na.licenseServerUri),a.includes(h.na.serverCertificateUri)||a.push(h.na.serverCertificateUri),h.na.serverCertificate&&(r.some(function(e){return function(t){return Te(t,e.na.serverCertificate)}}(h))||r.push(h.na.serverCertificate)),h.na.initData){f={};for(var p=c(h.na.initData),g=p.next();!g.done;f={Ud:f.Ud},g=p.next())f.Ud=g.value,s.some(function(e){return function(t){var n=e.Ud;return!(!t.keyId||t.keyId!=n.keyId)||t.initDataType==n.initDataType&&Te(t.initData,n.initData)}}(f))||s.push(f.Ud)}if(h.na.keyIds)for(f=c(h.na.keyIds),p=f.next();!p.done;p=f.next())o.add(p.value);if(h.na.keySystemUris&&l)for(f=c(h.na.keySystemUris),p=f.next();!p.done;p=f.next())l.add(p.value)}if(1==u.length)i.push(u[0]);else if(0<u.length){for(n=[],u=c(u),r=u.next();!r.done;r=u.next())r=e.atob(r.value.split("data:application/json;base64,").pop()),r=JSON.parse(r),n.push.apply(n,d(r.keys));u=JSON.stringify({keys:n}),i.push("data:application/json;base64,"+e.btoa(u))}}function Ds(t,n,i,r){var a=t.keySystem;!a||"org.w3.clearkey"==a&&t.licenseServerUri||(n.size&&(n=n.get(a)||"",t.licenseServerUri=n),t.keyIds||(t.keyIds=new Set),(i=i.get(a))&&(t.distinctiveIdentifierRequired||(t.distinctiveIdentifierRequired=i.distinctiveIdentifierRequired),t.persistentStateRequired||(t.persistentStateRequired=i.persistentStateRequired),t.videoRobustness||(t.videoRobustness=i.videoRobustness),t.audioRobustness||(t.audioRobustness=i.audioRobustness),t.serverCertificate||(t.serverCertificate=i.serverCertificate),i.sessionType&&(t.sessionType=i.sessionType),t.serverCertificateUri||(t.serverCertificateUri=i.serverCertificateUri)),r[a]&&(t.keySystem=r[a]),e.cast&&e.cast.__platform__&&"com.microsoft.playready"==a&&(t.keySystem="com.chromecast.playready"))}i=Ja.prototype,i.destroy=function(){return this.j.destroy()},i.configure=function(e){this.h=e,this.K&&this.K.Sa(this.h.updateExpirationTime)},i.Ub=function(e){var t=this;return N(function(n){if(1==n.g)return t.s?(t.m=e,t.B.ha(t.m,"play",function(){for(var e=c(t.N),n=e.next();!n.done;n=e.next())Ss(t,n.value);t.U=!0,t.N=[]}),"webkitCurrentPlaybackTargetIsWireless"in t.m&&t.B.D(t.m,"webkitcurrentplaybacktargetiswirelesschanged",function(){return xs(t)}),t.F=t.g&&t.g.initData.find(function(e){return 0<e.initData.length})||null,t.F||"com.apple.fps"!==t.g.keySystem||t.A.size?_(n,as(t),2):n.u(2)):(t.B.ha(e,"encrypted",function(){t.o(new It(2,6,6010))}),n.return());us(t).catch(function(){}),t.F||t.A.size||t.h.parseInbandPsshEnabled||t.B.D(t.m,"encrypted",function(e){return ss(t,e)}),w(n)})},i.Df=function(){var e=this,t=this.i.keys();return t=ia(t,function(t){var n=e.i.get(t);return{sessionId:t.sessionId,sessionType:n.type,initData:n.initData,initDataType:n.initDataType}}),Array.from(t)},i.td=function(){var e=1/0,t=this.i.keys();t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value,isNaN(n.expiration)||(e=Math.min(e,n.expiration));return e},i.ge=function(){return sa(this.ea)};var Ls=1,Ps=5,Os=.5;
/*
 @license
 Shaka Player
 Copyright 2023 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/function Ns(e,t,n){this.h=e,this.i=t,this.g=n}function Us(e,t){return N(function(n){if(1==n.g)return _(n,Ai(e.g,t,e.h.drm.preferredKeySystems),2);if(e.h.streaming.dontChooseCodecs||Ti(t,e.h.preferredVideoCodecs,e.h.preferredAudioCodecs,e.h.preferredDecodingAttributes),!t.variants.some($i))throw new It(2,4,4032);return n.return(Fs(e,t))})}function Fs(e,t){var n=xi(t.variants,e.h.restrictions,e.i);if(t){var i=e.g?e.g.g:null;if(i&&e.g.s)for(var r=c(t.variants),a=r.next();!a.done;a=r.next())a=a.value,Bs(e,i.keySystem,a.video),Bs(e,i.keySystem,a.audio);Vs(e,t)}return n}function Bs(e,t,n){if(n){n=c(n.drmInfos);for(var i=n.next();!i.done;i=n.next())if(i=i.value,i.keySystem==t){i=c(i.initData||[]);for(var r=i.next();!r.done;r=i.next())r=r.value,cs(e.g,r.initDataType,r.initData)}}}function Vs(e,t){e=e.g?e.g.ge():{};var n=Object.keys(e);n=n.length&&"00"==n[0];var i=!1,r=!1,a=new Set,s=new Set;t=c(t.variants);for(var o=t.next();!o.done;o=t.next()){o=o.value;var l=[];o.audio&&l.push(o.audio),o.video&&l.push(o.video),l=c(l);for(var u=l.next();!u.done;u=l.next())if(u=u.value,u.keyIds.size){u=c(u.keyIds);for(var d=u.next();!d.done;d=u.next()){d=d.value;var h=e[n?"00":d];h?js.includes(h)&&s.add(h):a.add(d)}}o.allowedByApplication?o.allowedByKeySystem&&(i=!0):r=!0}if(!i)throw e={hasAppRestrictions:r,missingKeys:Array.from(a),restrictedKeyStatuses:Array.from(s)},new It(2,4,4012,e)}var js=["output-restricted","internal-error"];function Gs(){}function Hs(e,t){if(t){var n=zs[t.toLowerCase()];if(n)return n}throw new It(2,4,4e3,e,t)}z("shaka.media.ManifestParser",Gs),Gs.unregisterParserByMime=function(e){delete zs[e]},Gs.registerParserByMime=function(e,t){zs[e]=t},Gs.registerParserByExtension=function(){pe("ManifestParser.registerParserByExtension","Please use an ManifestParser with registerParserByMime function.")},Gs.AccessibilityPurpose={hk:"visually impaired",Cj:"hard of hearing"};var zs={};function Ks(e,t){function n(){s=!0}function i(e){o.push(e),da(e)}var r,a=e=Ee(e),s=!1,o=[],l=[];if((new ca).box("moov",i).box("trak",i).box("mdia",i).box("minf",i).box("stbl",i).S("stsd",function(e){r=e,o.push(e),ha(e)}).S("encv",n).S("enca",n).S("dvav",function(e){l.push({box:e,jb:1701733238})}).S("dva1",function(e){l.push({box:e,jb:1701733238})}).S("dvh1",function(e){l.push({box:e,jb:1701733238})}).S("dvhe",function(e){l.push({box:e,jb:1701733238})}).S("hev1",function(e){l.push({box:e,jb:1701733238})}).S("hvc1",function(e){l.push({box:e,jb:1701733238})}).S("avc1",function(e){l.push({box:e,jb:1701733238})}).S("avc3",function(e){l.push({box:e,jb:1701733238})}).S("ac-3",function(e){l.push({box:e,jb:1701733217})}).S("ec-3",function(e){l.push({box:e,jb:1701733217})}).S("ac-4",function(e){l.push({box:e,jb:1701733217})}).S("mp4a",function(e){l.push({box:e,jb:1701733217})}).parse(e),s)return e;if(0==l.length||!r)throw ne(xn(e)),new It(2,3,3019,t);l.reverse(),t=c(l);for(var u=t.next();!u.done;u=t.next())u=u.value,a=$s(a,r,u.box,o,u.jb);return Vt()&&tn()?(t=new Uint8Array(e.byteLength+a.byteLength),t.set(a),t.set(e,a.byteLength),t):a}function $s(e,t,n,i,r){var a=qs.value(),s=e.subarray(n.start,n.start+n.size),o=Ae(s),l=new Uint8Array(n.size+a.byteLength);for(l.set(s,0),s=Ae(l),s.setUint32(4,r),l.set(a,n.size),r=o.getUint32(4),s.setUint32(n.size+16,r),Ws(l,0,l.byteLength),r=new Uint8Array(e.byteLength+l.byteLength),n=jt()||Vt()?n.start:n.start+n.size,a=e.subarray(n),r.set(e.subarray(0,n)),r.set(l,n),r.set(a,n+l.byteLength),e=c(i),i=e.next();!i.done;i=e.next())i=i.value,Ws(r,i.start,i.size+l.byteLength);return l=Ae(r,t.start),t=ya(t),e=l.getUint32(t),l.setUint32(t,e+1),r}function Ws(e,t,n){e=Ae(e,t),t=e.getUint32(0),0!=t&&(1==t?(e.setUint32(8,n>>32),e.setUint32(12,4294967295&n)):e.setUint32(0,n))}var qs=new Rt(function(){return new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])});function Ys(e,t,n,i,r,a,s){this.M=e,this.Ha=t,this.sa=n,this.Lc=void 0===i?null:i,this.timescale=void 0===r?null:r,this.g=void 0===a?null:a,this.aesKey=void 0===s?null:s,this.mimeType=this.codecs=null}function Xs(e,t){return e===t||(e&&t?e.$b()==t.$b()&&e.Xb()==t.Xb()&&Fe(e.M().sort(),t.M().sort())&&Te(e.vd(),t.vd()):e==t)}function Qs(e,t,n,i,r,a,s,o,l,u,d,h,f,p,g,m){for(u=void 0===u?[]:u,p=void 0===p?Js:p,this.startTime=e,this.j=this.endTime=t,this.C=n,this.Ha=i,this.sa=r,this.$=a,this.timestampOffset=s,this.appendWindowStart=o,this.appendWindowEnd=l,this.g=u,this.tilesLayout=void 0===d?"":d,this.A=void 0===h?null:h,this.h=void 0===f?null:f,this.status=p,this.preload=!1,this.l=!0,this.m=!1,this.aesKey=void 0===g?null:g,this.s=null,this.i=0,this.o=void 0!==m&&m,this.pe=this.Kd=!1,e=c(this.g),t=e.next();!t.done;t=e.next())t.value.Xg();this.o&&this.g.length&&this.g[this.g.length-1].Wg(),this.B=this.mimeType=this.codecs=null}function Zs(e,t){e.$=t,e=c(e.g);for(var n=e.next();!n.done;n=e.next())Zs(n.value,t)}Ys.prototype.$b=function(){return this.Ha},Ys.prototype.Xb=function(){return this.sa},Ys.prototype.vd=function(){return this.g},z("shaka.media.InitSegmentReference",Ys),Ys.prototype.getEndByte=Ys.prototype.Xb,Ys.prototype.getStartByte=Ys.prototype.$b,i=Qs.prototype,i.M=function(){return this.C()},i.getStartTime=function(){return this.startTime},i.Th=function(){return this.endTime},i.$b=function(){return this.Ha},i.Xb=function(){return this.sa},i.ki=function(){return this.tilesLayout},i.ji=function(){return this.A},i.ac=function(){return this.status},i.Ei=function(){this.status=eo},i.Of=function(){this.preload=!0},i.yi=function(){return this.preload},i.se=function(){this.l=!1},i.vi=function(){return this.l},i.Xg=function(){this.Kd=!0},i.xi=function(){return this.Kd},i.Wg=function(){this.pe=!0},i.wi=function(){return this.pe},i.Vg=function(){this.m=!0},i.ri=function(){return this.m},i.oh=function(e){this.s=e},i.ii=function(){return this.s},i.offset=function(e){this.startTime+=e,this.endTime+=e,this.j+=e;for(var t=c(this.g),n=t.next();!n.done;n=t.next())n=n.value,n.startTime+=e,n.endTime+=e,n.j+=e},i.jg=function(e){null==this.h?Q("Sync attempted without sync time!"):(e=this.h-e-this.startTime,.001<=Math.abs(e)&&this.offset(e))},i.fj=function(e){this.B=e},i.vd=function(){return this.B},z("shaka.media.SegmentReference",Qs),Qs.prototype.getSegmentData=Qs.prototype.vd,Qs.prototype.setSegmentData=Qs.prototype.fj,Qs.prototype.syncAgainst=Qs.prototype.jg,Qs.prototype.offset=Qs.prototype.offset,Qs.prototype.getThumbnailSprite=Qs.prototype.ii,Qs.prototype.setThumbnailSprite=Qs.prototype.oh,Qs.prototype.hasByterangeOptimization=Qs.prototype.ri,Qs.prototype.markAsByterangeOptimization=Qs.prototype.Vg,Qs.prototype.isLastPartial=Qs.prototype.wi,Qs.prototype.markAsLastPartial=Qs.prototype.Wg,Qs.prototype.isPartial=Qs.prototype.xi,Qs.prototype.markAsPartial=Qs.prototype.Xg,Qs.prototype.isIndependent=Qs.prototype.vi,Qs.prototype.markAsNonIndependent=Qs.prototype.se,Qs.prototype.isPreload=Qs.prototype.yi,Qs.prototype.markAsPreload=Qs.prototype.Of,Qs.prototype.markAsUnavailable=Qs.prototype.Ei,Qs.prototype.getStatus=Qs.prototype.ac,Qs.prototype.getTileDuration=Qs.prototype.ji,Qs.prototype.getTilesLayout=Qs.prototype.ki,Qs.prototype.getEndByte=Qs.prototype.Xb,Qs.prototype.getStartByte=Qs.prototype.$b,Qs.prototype.getEndTime=Qs.prototype.Th,Qs.prototype.getStartTime=Qs.prototype.getStartTime,Qs.prototype.getUris=Qs.prototype.M;var Js=0,eo=1;function to(e){return 1==e.length&&1e-4>e.end(0)-e.start(0)}function no(e){return!e||to(e)?null:e.length?e.end(e.length-1):null}function io(e,t){return!(!e||!e.length||to(e)||t>e.end(e.length-1))&&t>=e.start(0)}function ro(e,t){if(!e||!e.length||to(e))return 0;var n=0;e=c(so(e));for(var i=e.next();!i.done;i=e.next()){var r=i.value;i=r.start,r=r.end,r>t&&(n+=r-Math.max(i,t))}return n}function ao(e,t,n){return e&&e.length&&!to(e)?(e=so(e).findIndex(function(e,i,r){return e.start>t&&(0==i||r[i-1].end-t<=n)}),0<=e?e:null):null}function so(e){if(!e)return[];for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}
/*
 @license
 Shaka Player
 Copyright 2022 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
function oo(){}function lo(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9]}function uo(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9]}function co(e,t){var n=(127&e[t])<<21;return n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|127&e[t+3]}function ho(e){var t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if("APIC"===e.type){if(2>e.size||3!==e.data[0])return null;var n=e.data.subarray(1).indexOf(0);if(-1===n)return null;var i=hn(Ee(e.data,1,n)),r=e.data[2+n],a=e.data.subarray(3+n).indexOf(0);if(-1===a)return null;var s,o=hn(Ee(e.data,3+n,a));return s="--\x3e"===i?hn(Ee(e.data,4+n+a)):we(e.data.subarray(4+n+a)),t.mimeType=i,t.pictureType=r,t.description=o,t.data=s,t}return"TXXX"===e.type?2>e.size||3!==e.data[0]?null:(i=e.data.subarray(1).indexOf(0),-1===i?null:(n=hn(Ee(e.data,1,i)),e=hn(Ee(e.data,2+i)).replace(/\0*$/,""),t.description=n,t.data=e,t)):"WXXX"===e.type?2>e.size||3!==e.data[0]?null:(i=e.data.subarray(1).indexOf(0),-1===i?null:(n=hn(Ee(e.data,1,i)),e=hn(Ee(e.data,2+i)).replace(/\0*$/,""),t.description=n,t.data=e,t)):"PRIV"===e.type?2>e.size?null:(n=e.data.indexOf(0),-1===n?null:(n=hn(Ee(e.data,0,n)),t.description=n,"com.apple.streaming.transportStreamTimestamp"==n?(n=e.data.subarray(n.length+1),e=1&n[3],n=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7],n/=45,e&&(n+=47721858.84),t.data=n):(e=we(e.data.subarray(n.length+1)),t.data=e),t)):"T"===e.type[0]?2>e.size||3!==e.data[0]?null:(e=hn(e.data.subarray(1)).replace(/\0*$/,""),t.data=e,t):"W"===e.type[0]?(e=hn(e.data).replace(/\0*$/,""),t.data=e,t):e.data?(t.data=we(e.data),t):null}function fo(e){for(var t=0,n=[];lo(e,t);){var i=co(e,t+6);for(e[t+5]>>6&1&&(t+=10),t+=10,i=t+i;t+10<i;){var r=e.subarray(t),a=co(r,4);r={type:String.fromCharCode(r[0],r[1],r[2],r[3]),size:a,data:r.subarray(10,10+a)},(a=ho(r))&&n.push(a),t+=r.size+10}uo(e,t)&&(t+=10)}return n}function po(e,t){for(var n=t=void 0===t?0:t,i=0;lo(e,t);)e[t+5]>>6&1&&(i+=10),i+=10,i+=co(e,t+6),uo(e,t+10)&&(i+=10),t+=i;return 0<i?e.subarray(n,n+i):new Uint8Array([])}function go(e,t){var n=null,i=null,r=null,a=e.P();return 1&t&&(r=e.Qc()),2&t&&e.skip(4),8&t&&(n=e.P()),16&t&&(i=e.P()),{trackId:a,qd:n,fe:i,jk:r}}function mo(e,t){return 1==t?(t=e.P(),e=e.P(),{baseMediaDecodeTime:t*Math.pow(2,32)+e}):{baseMediaDecodeTime:e.P()}}function vo(e,t){return 1==t?(e.skip(8),e.skip(8)):(e.skip(4),e.skip(4)),t=e.P(),e.skip(4),e=e.ka(),{timescale:t,language:String.fromCharCode(96+(e>>10))+String.fromCharCode(96+((960&e)>>5))+String.fromCharCode(96+(31&e))}}function yo(e,t,n){var i=e.P(),r=[],a=null;1&n&&(a=e.P()),4&n&&e.skip(4);for(var s=0;s<i;s++){var o={$f:null,sampleSize:null,He:null};256&n&&(o.$f=e.P()),512&n&&(o.sampleSize=e.P()),1024&n&&e.skip(4),2048&n&&(o.He=0==t?e.P():e.bh()),r.push(o)}return{nk:i,fh:r,Mh:a}}function bo(e){e.skip(6),e.skip(2),e.skip(8);var t=e.ka();return e.skip(2),e.skip(2),e.skip(2),e=e.ka()+e.ka()/65536,{channelCount:t,sampleRate:e}}function So(e){return e=e.P(),{Na:va(e)}}function To(e){var t=null,n=null,i=e.rb(4),r=String.fromCharCode(i[0]);if(r+=String.fromCharCode(i[1]),r+=String.fromCharCode(i[2]),r+=String.fromCharCode(i[3]),"nclx"===r){switch(e.ka()){case 1:case 5:case 6:case 7:t="srgb";break;case 9:t="rec2020";break;case 11:case 12:t="p3"}switch(i=e.ka(),e.ka(),i){case 1:case 6:case 13:case 14:case 15:n="SDR";break;case 16:n="PQ";break;case 18:n="HLG"}}return{colorGamut:t,Qd:n}}function _o(e,t){return t=void 0!==t&&t,e=e.toString(16).toUpperCase(),t?e:("0"+e).slice(-2)}function wo(e){return(10>e?"0":"")+e}function Eo(e,t){if(this.j=e,void 0!==t&&t){t=new Uint8Array(e.byteLength);for(var n=0,i=0;i<e.byteLength;i++)2<=i&&3==e[i]&&0==e[i-1]&&0==e[i-2]||(t[n]=e[i],n++);this.j=Ee(t,0,n)}this.i=this.j.byteLength,this.g=this.h=0}function xo(e){var t=e.j.byteLength-e.i,n=new Uint8Array(4),i=Math.min(4,e.i);0!==i&&(n.set(e.j.subarray(t,t+i)),e.h=new oa(n,0).P(),e.g=8*i,e.i-=i)}function Ao(e,t){if(e.g<=t){t-=e.g;var n=Math.floor(t/8);t-=8*n,e.g-=n,xo(e)}e.h<<=t,e.g-=t}function ko(e,t){var n=Math.min(e.g,t),i=e.h>>>32-n;return e.g-=n,0<e.g?e.h<<=n:0<e.i&&xo(e),n=t-n,0<n?i<<n|ko(e,n):i}function Io(e){var t;for(t=0;t<e.g;++t)if(0!==(e.h&2147483648>>>t))return e.h<<=t,e.g-=t,t;return xo(e),t+Io(e)}function Co(e){Ao(e,1+Io(e))}function Ro(e){var t=Io(e);return ko(e,t+1)-1}function Mo(e){return e=Ro(e),1&e?1+e>>>1:-1*(e>>>1)}function Do(e){return 1===ko(e,1)}function Lo(e){return ko(e,8)}function Po(e,t){for(var n=8,i=8,r=0;r<t;r++)0!==i&&(i=Mo(e),i=(n+i+256)%256),n=0===i?n:i}function Oo(e){return Lo(e),Ro(e),Ro(e)}function No(){this.G=null,this.H=!1,this.m=this.I=null,this.j=[],this.g=[],this.A=this.B=null,this.i=[],this.h=[],this.C=null,this.l=[],this.F=this.o=this.s=null}function Uo(e,t){if(1!==(t[0]<<16|t[1]<<8|t[2]))return null;var n={data:new Uint8Array(0),packetLength:t[4]<<8|t[5],pts:null,dts:null,nalus:[]};if(n.packetLength&&n.packetLength>t.byteLength-6)return null;var i=t[7];if(192&i){var r=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2;null==e.s&&(e.s=r),n.pts=Vo(r,e.s),e.s=n.pts,n.dts=n.pts,64&i&&(i=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,null==e.o&&(e.o=i),n.dts=Vo(i,e.o)),e.o=n.dts}return e=t[8]+9,t.byteLength<=e?null:(n.data=t.subarray(e),n)}function Fo(e){var t={height:null,width:null,Na:null};if(e=e.ke(),!e.length)return t;if(e=e.find(function(e){return 7==e.type}),!e)return t;e=new Eo(e.data);var n=Lo(e),i=Lo(e),r=Lo(e);if(Co(e),Ho.includes(n)){var a=Ro(e);if(3===a&&Ao(e,1),Co(e),Co(e),Ao(e,1),Do(e)){a=3!==a?8:12;for(var s=0;s<a;s++)Do(e)&&Po(e,6>s?16:64)}}if(Co(e),a=Ro(e),0===a)Ro(e);else if(1===a)for(Ao(e,1),Co(e),Co(e),a=Ro(e),s=0;s<a;s++)Co(e);Co(e),Ao(e,1),a=Ro(e),s=Ro(e);var o=ko(e,1);0===o&&Ao(e,1),Ao(e,1);var l=0,u=0,c=0,d=0;return Do(e)&&(l=Ro(e),u=Ro(e),c=Ro(e),d=Ro(e)),t.height=String((2-o)*(s+1)*16-2*c-2*d),t.width=String(16*(a+1)-2*l-2*u),t.Na="avc1."+("0"+n.toString(16).toUpperCase()).slice(-2)+("0"+i.toString(16).toUpperCase()).slice(-2)+("0"+r.toString(16).toUpperCase()).slice(-2),t}function Bo(e){var t={height:null,width:null,Na:null};if(e=e.ke(),!e.length)return t;if(e=e.find(function(e){return 33==e.type}),!e)return t;var n=new Eo(e.fullData,!0);Lo(n),Lo(n),ko(n,4);var i=ko(n,3);Do(n);var r=ko(n,2),a=ko(n,1),s=ko(n,5),o=ko(n,32);e=Lo(n);for(var l=Lo(n),u=Lo(n),c=Lo(n),d=Lo(n),h=Lo(n),f=Lo(n),p=[],g=[],m=0;m<i;m++)p.push(Do(n)),g.push(Do(n));if(0<i)for(m=i;8>m;m++)ko(n,2);for(m=0;m<i;m++)p[m]&&ko(n,88),g[m]&&Lo(n);Ro(n),i=Ro(n),3==i&&ko(n,1),p=Ro(n),g=Ro(n);var v=m=0,y=0,b=0;return Do(n)&&(m+=Ro(n),v+=Ro(n),y+=Ro(n),b+=Ro(n)),t.width=String(p-(m+v)*(1===i||2===i?2:1)),t.height=String(g-(y+b)*(1===i?2:1)),n=function(e){for(var t=0,n=0;32>n;n++)t|=(e>>n&1)<<31-n;return t>>>0}(o),a=1==a?"H":"L",r="hvc1."+["","A","B","C"][r]+s,r+="."+n.toString(16).toUpperCase(),r+="."+a+f,h&&(r+="."+h.toString(16).toUpperCase()),d&&(r+="."+d.toString(16).toUpperCase()),c&&(r+="."+c.toString(16).toUpperCase()),u&&(r+="."+u.toString(16).toUpperCase()),l&&(r+="."+l.toString(16).toUpperCase()),e&&(r+="."+e.toString(16).toUpperCase()),t.Na=r,t}function Vo(e,t){var n=1;for(e>t&&(n=-1);4294967296<Math.abs(t-e);)e+=8589934592*n;return e}function jo(e){return!(0>Go(e))}function Go(e){for(var t=Math.min(1e3,e.length-564),n=0;n<t;){if(71==e[n]&&71==e[n+188]&&71==e[n+376])return n;n++}return-1}Qs.Status={oj:Js,fk:eo,Ij:2},z("shaka.util.Id3Utils",oo),oo.getID3Data=po,oo.getID3Frames=fo,z("shaka.util.ExpGolomb",Eo),i=No.prototype,i.clearData=function(){this.j=[],this.g=[],this.i=[],this.h=[],this.l=[]},i.parse=function(e){if(564>e.length)return this;for(var t=Math.max(0,Go(e)),n=e.length-(e.length+t)%188,i=!1,r=t;r<n;r+=188)if(71==e[r]){var a=!!(64&e[r+1]),s=((31&e[r+1])<<8)+e[r+2];if(1<(48&e[r+3])>>4){var o=r+5+e[r+4];if(o==r+188)continue}else o=r+4;switch(s){case 0:a&&(o+=e[o]+1),this.G=(31&e[o+10])<<8|e[o+11];break;case 17:case 8191:break;case this.G:a&&(o+=e[o]+1),a=e,s={audio:-1,video:-1,me:-1,audioCodec:"",videoCodec:""};var l=o+3+((15&a[o+1])<<8|a[o+2])-4;for(o+=12+((15&a[o+10])<<8|a[o+11]);o<l;){var u=(31&a[o+1])<<8|a[o+2],c=(15&a[o+3])<<8|a[o+4];switch(a[o]){case 6:if(0<c)for(var d=o+5,h=c;2<h;){var f=a[d+1]+2;switch(a[d]){case 5:var p=vn(a.subarray(d+2,d+f));-1==s.audio&&"Opus"===p?(s.audio=u,s.audioCodec="opus"):-1==s.video&&"AV01"===p&&(s.video=u,s.videoCodec="av1");break;case 106:-1==s.audio&&(s.audio=u,s.audioCodec="ac3");break;case 122:-1==s.audio&&(s.audio=u,s.audioCodec="ec3");break;case 124:-1==s.audio&&(s.audio=u,s.audioCodec="aac");break;case 127:"opus"==s.audioCodec&&(p=null,128===a[d+2]&&(p=a[d+3]),null!=p&&(this.F={channelCount:0===(15&p)?2:15&p,Jh:p,sampleRate:48e3}))}d+=f,h-=f}break;case 15:-1==s.audio&&(s.audio=u,s.audioCodec="aac");break;case 17:-1==s.audio&&(s.audio=u,s.audioCodec="aac-loas");break;case 21:-1==s.me&&(s.me=u);break;case 27:-1==s.video&&(s.video=u,s.videoCodec="avc");break;case 3:case 4:-1==s.audio&&(s.audio=u,s.audioCodec="mp3");break;case 36:-1==s.video&&(s.video=u,s.videoCodec="hvc");break;case 129:-1==s.audio&&(s.audio=u,s.audioCodec="ac3");break;case 132:case 135:-1==s.audio&&(s.audio=u,s.audioCodec="ec3")}o+=c+5}a=s,-1!=a.video&&(this.I=a.video,this.m=a.videoCodec),-1!=a.audio&&(this.B=a.audio,this.A=a.audioCodec),-1!=a.me&&(this.C=a.me),i&&!this.H&&(i=!1,r=t-188),this.H=!0;break;case this.I:o=e.subarray(o,r+188),a?this.j.push([o]):this.j.length&&this.j[this.j.length-1]&&this.j[this.j.length-1].push(o);break;case this.B:o=e.subarray(o,r+188),a?this.i.push([o]):this.i.length&&this.i[this.i.length-1]&&this.i[this.i.length-1].push(o);break;case this.C:o=e.subarray(o,r+188),a?this.l.push([o]):this.l.length&&this.l[this.l.length-1]&&this.l[this.l.length-1].push(o);break;default:i=!0}}return this},i.Ji=function(e){return pe("TsParser.parseAvcNalus","Please use parseNalus function instead."),this.Uf(e)},i.Uf=function(e,t,n){var i=e.pts?e.pts/9e4:null;e=e.data;var r=e.byteLength,a=1;"hvc"==this.m&&(a=2);for(var s,o=n||0,l=[],u=-1,c=0,d=0;d<r;++d){var h=e[d];if(h){if(2<=o&&1==h){if(t&&!l.length&&-1==u&&(h=d-(3<o?3:o),n&&0!=h&&(h=e.subarray(0,h),t.data=An(t.data,h),t.fullData=An(t.fullData,h))),0<=u?(o=d-((3<o?3:o)+1),l.push({data:e.subarray(u+a,o+1),fullData:e.subarray(u,o+1),type:c,time:i})):t&&!l.length&&(u=d-o,0<u&&(u=e.subarray(0,u),t.data=An(t.data,u),t.fullData=An(t.fullData,u))),d>=r-a)return l;d++,u=d,c="hvc"==this.m?e[d]>>1&63:31&e[d]}o=0}else o++;d>=r-1&&0<=u&&0<=o&&(s={data:e.subarray(u+a,r),fullData:e.subarray(u,r),type:c,time:i})}return s&&l.push(s),!l.length&&t&&(t.data=An(t.data,e),t.fullData=An(t.fullData,e)),l},i.getMetadata=function(){for(var e=[],t=c(this.l),n=t.next();!n.done;n=t.next())n=An.apply(Sn,d(n.value)),(n=Uo(this,n))&&e.push({cueTime:n.pts?n.pts/9e4:null,data:n.data,frames:fo(n.data),dts:n.dts,pts:n.pts});return e},i.Wb=function(){if(this.i.length&&!this.h.length){for(var e=!1,t=c(this.i),n=t.next();!n.done;n=t.next()){var i=An.apply(Sn,d(n.value)),r=Uo(this,i);n=this.h.length?this.h[this.h.length-1]:null,r&&null!=r.pts&&null!=r.dts&&(!n||n.pts!=r.pts&&n.dts!=r.dts)?(this.h.length&&r.dts<(n.dts||0)&&(e=!0),this.h.push(r)):this.h.length&&(i=r?r.data:i)&&(n=this.h.pop(),n.data=An(n.data,i),this.h.push(n))}e&&(this.h=this.h.sort(function(e,t){var n=(e.pts||0)-(t.pts||0);return(e.dts||0)-(t.dts||0)||n}))}return this.h},i.Ic=function(e){if(e=void 0===e||e,this.j.length&&!this.g.length){for(var t=!1,n=c(this.j),i=n.next();!i.done;i=n.next()){var r=An.apply(Sn,d(i.value)),a=Uo(this,r);i=this.g.length?this.g[this.g.length-1]:null,a&&null!=a.pts&&null!=a.dts&&(!i||i.pts!=a.pts&&i.dts!=a.dts)?(this.g.length&&a.dts<(i.dts||0)&&(t=!0),this.g.push(a)):this.g.length&&(r=a?a.data:r)&&(i=this.g.pop(),i.data=An(i.data,r),this.g.push(i))}if(e){for(n=[],i=c(this.g),r=i.next();!r.done;r=i.next())if(r=r.value,r.nalus=this.Uf(r,s,void 0),r.nalus.length){n.push(r);var s=r.nalus[r.nalus.length-1]}this.g=n}t&&(this.g=this.g.sort(function(e,t){var n=(e.pts||0)-(t.pts||0);return(e.dts||0)-(t.dts||0)||n}))}return e?this.g:(e=this.g,this.g=[],e)},i.getStartTime=function(e){if("audio"==e){e=null;var t=this.Wb();return t.length&&(e=t[0],e=Math.min(e.dts,e.pts)/9e4),e}return"video"==e?(e=null,t=this.Ic(!1),t.length&&(e=t[0],e=Math.min(e.dts,e.pts)/9e4),e):null},i.sd=function(){return{audio:this.A,video:this.m}},i.ke=function(){for(var e=[],t=c(this.Ic()),n=t.next();!n.done;n=t.next())e.push.apply(e,d(n.value.nalus));return e},i.ni=function(){pe("TsParser.getVideoResolution","Please use getVideoInfo function instead.");var e=this.Hf();return{height:e.height,width:e.width}},i.Hf=function(){return"hvc"==this.m?Bo(this):Fo(this)},z("shaka.util.TsParser",No),No.syncOffset=Go,No.probe=jo,No.prototype.getVideoInfo=No.prototype.Hf,No.prototype.getVideoResolution=No.prototype.ni,No.prototype.getVideoNalus=No.prototype.ke,No.prototype.getCodecs=No.prototype.sd,No.prototype.getStartTime=No.prototype.getStartTime,No.prototype.getVideoData=No.prototype.Ic,No.prototype.getAudioData=No.prototype.Wb,No.prototype.getMetadata=No.prototype.getMetadata,No.prototype.parseNalus=No.prototype.Uf,No.prototype.parseAvcNalus=No.prototype.Ji,No.prototype.parse=No.prototype.parse,No.prototype.clearData=No.prototype.clearData,No.Timescale=9e4;var Ho=[100,110,122,244,44,83,86,118,128,138,139,134];function zo(e,t,n){this.g=null,this.o=-1,this.l=e,this.i=t,this.m=n,this.j=!1;e:{if("undefined"===typeof libDPIModule&&Z("Could not find LCEVC Library dependencies on this page"),"undefined"!==typeof LCEVCdec)this.h=LCEVCdec;else{if("undefined"===typeof LcevcDil){Z("Could not find LCEVC Library on this page"),e=!1;break e}this.h=LcevcDil,this.j=!0,pe("LcevcDil","lcevc_dil.js is deprecated, please use lcevc_dec.js instead")}"undefined"===typeof this.h.SupportObject?(Z("Could not find LCEVC Library on this page"),e=!1):(this.h.SupportObject.SupportStatus||Z(this.h.SupportObject.SupportError),e="undefined"!==typeof this.h&&"undefined"!==typeof libDPIModule&&this.i instanceof HTMLCanvasElement&&this.h.SupportObject.SupportStatus)}e&&!this.g&&this.h.SupportObject.webGLSupport(this.i)&&(this.i.classList.remove("shaka-hidden"),this.g=this.j?new this.h.LcevcDil(this.l,this.i,this.m):new this.h.LCEVCdec(this.l,this.i,this.m))}function Ko(e){e.g&&e.i.classList.add("shaka-hidden")}function $o(e,t,n){var i=Wo,r=Zo;switch(t.mimeType){case"video/webm":i=qo;break;case"video/mp4":i=Yo}switch(n){case"DASH":r=Qo;break;case"HLS":r=Xo}e.g&&(e.o=t.id,e.g.setLevelSwitching(t.id,!0),e.g.setContainerFormat(i),e.j||e.g.setStreamingFormat(r))}zo.prototype.release=function(){this.g&&(this.g.close(),this.g=null)},z("shaka.lcevc.Dec",zo),zo.prototype.release=zo.prototype.release;var Wo=0,qo=1,Yo=2,Xo=0,Qo=1,Zo=-1;function Jo(e,t,n,i){var r=this;this.i=e,this.da=n,this.A=null,this.F=t,this.h={},this.G={},this.Da={},this.g=null,this.fa=!1,this.Z=i||null,this.l={},this.s=new ae,this.j={},this.H=null,this.L=new Ir,this.N="",this.ra=!1,this.m=el(this,this.L),this.C=!1,this.I=new ta(function(){return nl(r)}),this.B=!1,this.aa="UNKNOWN",this.Ea=this.Fa=!1,this.za=new Ir,this.o=!1,this.xa=!0,this.qa=this.R=this.ya=this.U=this.K=this.ea=null,this.pa=new Ir}function el(t,n){if(e.ManagedMediaSource){t.i.disableRemotePlayback=!0;var i=new ManagedMediaSource;return t.s.D(i,"startstreaming",function(){t.xa=!0}),t.s.D(i,"endstreaming",function(){t.xa=!1}),t.s.ha(i,"sourceopen",function(){URL.revokeObjectURL(t.N),n.resolve()}),t.s.ha(t.i,"playing",function(){t.ra=!0}),t.N=Ml(i),t.i.src=t.N,i}return i=new MediaSource,t.s.ha(i,"sourceopen",function(){URL.revokeObjectURL(t.N),n.resolve()}),t.s.ha(t.i,"playing",function(){t.ra=!0}),t.N=Ml(i),t.i.src=t.N,i}function tl(e,t){var n,i,r,a,s,o,l,u,d,h,f;return N(function(p){if(1==p.g)return e.createSegmentIndex?_(p,e.createSegmentIndex(),2):p.u(2);if(!e.segmentIndex)return p.return(!1);if(0==e.segmentIndex.getNumReferences())return p.return(!0);for(n=Pn,i=new Set,r=c(e.segmentIndex),a=r.next();!a.done;a=r.next())if(s=a.value,o=s.mimeType||e.mimeType||"",l=s.codecs||e.codecs||"",u=o+":"+l,!i.has(u))if(i.add(u),t==n.ta){if(d=Fn(o,l),!Zn(d))return p.return(!1)}else if(t==n.ga?l=Oi(l):t==n.X&&(l=Pi(l,o)),h=jn(e,o,l),f=Bn(o,l),!ce(h)&&!at(f))return p.return(!1);return p.return(!0)})}function nl(e){var t,n,i,r,a,s,o,l;return N(function(u){if(1==u.g){for(n in t=[],e.l)for(i=e.l[n],r=i[0],e.l[n]=i.slice(0,1),r&&t.push(r.p.catch(si)),a=c(i.slice(1)),s=a.next();!s.done;s=a.next())o=s.value,o.p.reject(new It(2,7,7003,void 0));for(l in e.g&&t.push(e.g.destroy()),e.F&&t.push(e.F.destroy()),e.j)t.push(e.j[l].destroy());return _(u,Promise.all(t),2)}e.s&&(e.s.release(),e.s=null),e.i&&(e.i.removeAttribute("src"),e.i.load(),e.i=null),e.A=null,e.m=null,e.g=null,e.F=null,e.h={},e.j={},e.H=null,e.l={},e.Z=null,e.K=null,e.da=null,w(u)})}function il(e,t,n,i){var r,a,s,o,l,u,c,d,h,f,p,g;return N(function(m){switch(m.g){case 1:return r=Pn,a=K,s=$,_(m,tl(n,t),2);case 2:if(s.call(a,m.h,"Type negotiation should happen before MediaSourceEngine.init!"),o=Fn(n.mimeType,i),t==r.ta){rl(e,o,e.B,n.external),m.u(0);break}if(l=e.A.forceTransmux,(!ce(o)||!e.B&&Xn.includes(o))&&(l=!0),u=Bn(n.mimeType,i),!l){m.u(4);break}if(c=Mn(r.X,(i||"").split(",")),d=Mn(r.ga,(i||"").split(",")),!c||!d){m.u(5);break}return e.o=!0,_(m,il(e,r.X,n,c),6);case 6:return _(m,il(e,r.ga,n,d),7);case 7:return m.return();case 5:(h=at(u))&&(f=h(),e.j[t]=f,o=f.convertCodecs(t,u));case 4:p=o+e.A.addExtraFeaturesToSourceBuffer(o),na(e.I);try{g=e.m.addSourceBuffer(p)}catch(t){throw new It(2,3,3015,t,"The mediaSource_ status was "+e.m.readyState+" expected 'open'",null)}e.B&&(g.mode=Dl),e.s.D(g,"error",function(){var n=e.l[t][0];n.p.reject(new It(2,3,3014,e.i.error?e.i.error.code:0,n.uri))}),e.s.D(g,"updateend",function(){return Sl(e,t)}),e.h[t]=g,e.G[t]=o,e.Da[t]=!!n.drmInfos.length,w(m)}})}function rl(e,t,n,i){e.g||(e.g=new Qn(e.F),e.g&&(e.g.A=e.A.modifyCueCallback));var r=e.g;i=i||e.fa,e=e.aa,"application/cea-608"==t||"application/cea-708"==t?r.i=null:(r.i=(0,ri[t])(),r.i.setSequenceMode?r.i.setSequenceMode(n):pe("Text parsers w/ setSequenceMode",'Text parsers should have a "setSequenceMode" method!'),r.i.setManifestType?r.i.setManifestType(e):pe("Text parsers w/ setManifestType",'Text parsers should have a "setManifestType" method!'),r.B=i)}function al(e){return!e.C&&(!e.m||"ended"==e.m.readyState)}function sl(e,t){return e.C||!Object.keys(e.h).length?e=null:t==Ln?e=e.g.g:(e=ul(e,t),e=!e||to(e)?null:1==e.length&&0>e.start(0)?0:e.length?e.start(0):null),e}function ol(e,t){return e.C?null:t==Ln?e.g.h:no(ul(e,t))}function ll(e,t,n){return e.C?0:t==Ln?(e=e.g,null==e.h||e.h<n?0:e.h-Math.max(n,e.g)):(e=ul(e,t),ro(e,n))}function ul(e,t){try{return e.h[t].buffered}catch(e){return null}}function cl(e,t,n,i,r,a){var s=null,o=Ee(n);if(Xn.includes(r))a=fo(o),a.length&&i&&((t=a.find(function(e){return"com.apple.streaming.transportStreamTimestamp"===e.description}))&&t.data&&(s=Math.round(t.data)/1e3),e.da.onMetadata([{cueTime:i.startTime,data:o,frames:a,dts:i.startTime,pts:i.startTime}],0,i.endTime));else if(r.includes("/mp4")&&i&&0==i.timestampOffset&&i.$&&i.$.timescale){var l=i.$.timescale;if(!isNaN(l)){var u=0,c=!1;(new ca).box("moof",da).box("traf",da).S("tfdt",function(e){u=mo(e.reader,e.version).baseMediaDecodeTime/l,c=!0,e.parser.stop()}).parse(n,!0),c&&(s=u)}}else!r.includes("/mp4")&&!r.includes("/webm")&&jo(o)&&(e.K?e.K.clearData():e.K=new No,o=e.K.parse(o),t=o.getStartTime(t),null!=t&&(s=t),o=o.getMetadata(),o.length)&&e.da.onMetadata(o,a,i?i.endTime:null);return s}function dl(e,t,n,i,r,a,s,o,l,u){var c,d,h,f,p,g,m,v,y,b,S,T,E,x;return s=void 0!==s&&s,o=void 0!==o&&o,l=void 0!==l&&l,u=void 0!==u&&u,N(function(A){switch(A.g){case 1:if(c=Pn,t!=c.ta){A.u(2);break}if(!e.B){A.u(3);break}return _(A,e.za,4);case 4:d=A.h,e.g.s=d;case 3:return _(A,Jn(e.g,n,i?i.startTime:null,i?i.endTime:null,i?i.M()[0]:null),5);case 5:return A.return();case 2:if(u||!e.o){A.u(6);break}return _(A,dl(e,c.X,n,i,r,a,s,o,l,!0),7);case 7:return _(A,dl(e,c.ga,n,i,r,a,s,o,l,!0),8);case 8:return A.return();case 6:if(!e.h[t])return A.return();if(h=e.h[t].timestampOffset,f=e.G[t],e.j[t]&&(f=e.j[t].getOriginalMimeType()),i&&(p=cl(e,t,n,i,f,h),null!=p&&(null==e.U&&t==c.ga&&(e.U=p,e.ya=i.startTime,null!=e.R&&(g=0,e.ya==e.qa&&(g=e.U-e.R),e.pa.resolve(g))),null==e.R&&t==c.X&&(e.R=p,e.qa=i.startTime,null!=e.U&&(m=0,e.ya==e.qa&&(m=e.U-e.R),e.pa.resolve(m))),v=i.startTime-p,y=Math.abs(h-v),(.001<=y||s||o)&&(!l||0<v||!h)&&(h=v,e.Ea&&(Tl(e,t,function(){return yl(e,t)},null),Tl(e,t,function(){return bl(e,t,h)},null))),b=t==c.ga||!(c.ga in e.h),e.B&&b&&e.za.resolve(h))),a&&t==c.ga&&(e.g||rl(e,"application/cea-608",e.B,!1),e.H||(S=f.split(";",1)[0],e.H=new Ce(S)),i?(T=e.H.i(n),T.length&&ii(e.g,T,i.startTime,i.endTime,h)):e.H.init(n,o)),!e.j[t]){A.u(9);break}return _(A,e.j[t].transmux(n,r,i,e.m.duration,t),10);case 10:n=A.h;case 9:if(n=xl(e,n,i?i.startTime:null,t,i?i.M()[0]:null),!i||!e.B||t==c.ta){A.u(11);break}if(!s&&!o){A.u(11);break}if(E=i.startTime,"HLS"!=e.aa||e.o||t!=c.X||!e.h[c.ga]){A.u(13);break}return _(A,e.pa,14);case 14:x=A.h,.1<Math.abs(x)&&(E-=x);case 13:Tl(e,t,function(){return yl(e,t)},null),Tl(e,t,function(){return bl(e,t,E)},null);case 11:return _(A,Tl(e,t,function(){var i=n;if("video"==t&&e.Z){var r=e.Z;r.g&&r.g.appendBuffer(i,"video",r.o,-h)}e.h[t].appendBuffer(i)},i?i.M()[0]:null),15);case 15:w(A)}})}function hl(e,t){var n=ol(e,"video")||0;ti(e.g,t,n)}function fl(e){e.g&&ti(e.g,"",0)}function pl(e,t){var n;return N(function(i){return 1==i.g?(n=Pn,t==n.ta?e.g?_(i,e.g.remove(0,1/0),0):i.return():_(i,Tl(e,t,function(){return vl(e,t,0,e.m.duration)},null),4)):e.o?_(i,Tl(e,n.X,function(){return vl(e,n.X,0,e.m.duration)},null),0):i.u(0)})}function gl(e,t,n,i,r,a,s,o,l){var u,c,d;return N(function(h){return 1==h.g?(u=Pn,t==u.ta?(a||(e.g.s=n),ei(e.g,i,r),h.return()):(c=[],_(h,Cl(e,t,s,o,l),2))):(d=h.h,d||(c.push(Tl(e,t,function(){return yl(e,t)},null)),e.o&&c.push(Tl(e,u.X,function(){return yl(e,u.X)},null))),a||(c.push(Tl(e,t,function(){return bl(e,t,n)},null)),e.o&&c.push(Tl(e,u.X,function(){return bl(e,u.X,n)},null))),c.push(Tl(e,t,function(){e.h[t].appendWindowStart=0,e.h[t].appendWindowEnd=r,e.h[t].appendWindowStart=i,Sl(e,t)},null)),e.o&&c.push(Tl(e,u.X,function(){var t=u.X;e.h[t].appendWindowStart=0,e.h[t].appendWindowEnd=r,e.h[t].appendWindowStart=i,Sl(e,t)},null)),_(h,Promise.all(c),0))})}function ml(e,t,n){var i;return N(function(r){return 1==r.g?(i=Pn,t==i.ta?r.return():(t==i.ga&&(e.za=new Ir),Tl(e,t,function(){return yl(e,t)},null),e.o&&Tl(e,i.X,function(){return yl(e,i.X)},null),_(r,Tl(e,t,function(){return bl(e,t,n)},null),2))):e.o?_(r,Tl(e,i.X,function(){return bl(e,i.X,n)},null),0):r.u(0)})}function vl(e,t,n,i){i<=n?Sl(e,t):e.h[t].remove(n,i)}function yl(e,t){var n=e.h[t].appendWindowStart,i=e.h[t].appendWindowEnd;e.h[t].abort(),e.h[t].appendWindowStart=n,e.h[t].appendWindowEnd=i,Sl(e,t)}function bl(e,t,n){0>n&&(n+=.001),e.h[t].timestampOffset=n,Sl(e,t)}function Sl(e,t){if(!e.C){var n=e.l[t][0];n&&(n.p.resolve(),wl(e,t))}}function Tl(e,t,n,i){return na(e.I),n={start:n,p:new Ir,uri:i},e.l[t].push(n),1==e.l[t].length&&El(e,t),n.p}function _l(e,t){var n,i,r,a,s,o,l;return N(function(u){switch(u.g){case 1:for(r in na(e.I),n=[],i={},e.h)i.cd=new Ir,a={start:function(e){return function(){return e.cd.resolve()}}(i),p:i.cd,uri:null},e.l[r].push(a),n.push(i.cd),1==e.l[r].length&&a.start(),i={cd:i.cd};return E(u,2),_(u,Promise.all(n),4);case 4:A(u,3);break;case 2:throw s=k(u),s;case 3:return E(u,5,6),_(u,t(),6);case 6:for(o in I(u),e.h)wl(e,o);C(u,0);break;case 5:throw l=k(u),new It(2,3,3015,l,e.i.error||"No error in the media element",null)}})}function wl(e,t){e.l[t].shift(),El(e,t)}function El(e,t){var n=e.l[t][0];if(n)try{n.start()}catch(i){"QuotaExceededError"==i.name?n.p.reject(new It(2,3,3017,t)):n.p.reject(new It(2,3,3015,i,e.i.error||"No error in the media element",n.uri)),wl(e,t)}}function xl(e,t,n,i,r){var a=null==n,s=e.Da[i];return n=e.da.Xh(),(a=e.A.insertFakeEncryptionInInit&&a&&s)&&(n=Lt(n),a=Gt()||jt()||Jt()||Vt()&&tn()&&n),a&&"mp4"==Gn(e.G[i])&&(t=Ks(t,r)),t}function Al(e,t,n,i){return Tl(e,t,function(){t!==Ln&&(de()&&(e.j[t]&&(e.j[t].destroy(),delete e.j[t]),i&&(e.j[t]=i),e.h[t].changeType(n+e.A.addExtraFeaturesToSourceBuffer(n)),e.G[t]=n),Sl(e,t))},null)}function kl(e,t){var n,i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,w,E,A,k,R;return N(function(M){switch(M.g){case 1:for(o in n=Pn,e.C=!0,e.o=!1,i=e.i.currentTime,r=e.i.autoplay,a=e.i.paused,e.ra&&(e.i.autoplay=!1),x(M,2),e.s.Ra(),s=[],e.j)s.push(e.j[o].destroy());for(l in e.l)for(u=e.l[l],d=u[0],e.l[l]=u.slice(0,1),d&&s.push(d.p.catch(si)),h=c(u.slice(1)),f=h.next();!f.done;f=h.next())p=f.value,p.p.reject(new It(2,7,7003,void 0));for(g in e.h){m=e.h[g];try{e.m.removeSourceBuffer(m)}catch(e){}}return _(M,Promise.all(s),4);case 4:return e.j={},e.h={},v=e.m.duration,e.L=new Ir,e.m=el(e,e.L),_(M,e.L,5);case 5:!isNaN(v)&&v?e.m.duration=v:!isNaN(e.ea)&&e.ea&&(e.m.duration=e.ea),y=new Ir,b=e.m.sourceBuffers,S=t.size,T=0,w=function(){T++,T===S&&(y.resolve(),e.s.lb(b,"addsourcebuffer",w))},e.s.D(b,"addsourcebuffer",w),E=c(t.keys()),A=E.next();case 6:return A.done?(e.i.currentTime=i,_(M,y,2)):(k=A.value,R=t.get(k),_(M,il(e,k,R,R.codecs),9));case 9:e.o?(e.l[n.X]=[],e.l[n.ga]=[]):e.l[k]=[],A=E.next(),M.u(6);break;case 2:I(M),e.C=!1,na(e.I),e.s.ha(e.i,"canplaythrough",function(){e.I.g||(e.i.autoplay=r,a||e.i.play())}),C(M,0)}})}function Il(e,t){return _l(e,function(){return kl(e,t)})}function Cl(e,t,n,i,r){var a,s,o,l,u,c,d,h,f,p,g,m,v,y,b;return N(function(S){return 1==S.g?(a=Pn,t==a.ta?S.return(!1):(s=zn($n(e.G[t])),o=Kn(e.G[t]),u=!1,c=Fn(n,i),d=e.A.forceTransmux,(!ce(c)||!e.B&&Xn.includes(c))&&(d=!0),d&&(h=Bn(n,i),f=at(h))&&(l=f(),p=Mn(a.X,(i||"").split(",")),g=Mn(a.ga,(i||"").split(",")),p&&g?(u=!0,m=g,t==a.X&&(m=p),c=l.convertCodecs(t,Bn(n,m))):c=l.convertCodecs(t,h)),v=zn($n(c)),y=Kn(c),s===v&&o===y?(e.j[t]&&!l?(e.j[t].destroy(),delete e.j[t]):!e.j[t]&&l?e.j[t]=l:l&&(e.j[t]&&e.j[t].transmux!=l.transmux?(e.j[t].destroy(),delete e.j[t],e.j[t]=l):l.destroy()),S.return(!1)):(b=!0,(e.o||u&&l&&!e.j[t])&&(b=!1),b&&"smooth"===e.A.codecSwitchingStrategy&&de()?_(S,Al(e,t,c,l),3):(l&&l.destroy(),_(S,Il(e,r),3))))):S.return(!0)})}function Rl(e,t,n,i){if(t==Ln)var r=!1;else{r=zn($n(e.G[t]));var a=Kn(e.G[t]),s=Fn(n,i),o=e.A.forceTransmux;(!ce(s)||!e.B&&Xn.includes(s))&&(o=!0),n=Bn(n,i),o&&(o=at(n))&&(o=o(),s=o.convertCodecs(t,n),o.destroy()),t=zn($n(s)),s=Kn(s),r=r!==t||a!==s}return!!r&&("smooth"!==e.A.codecSwitchingStrategy||!de()||e.o)}i=Jo.prototype,i.destroy=function(){return this.I.destroy()},i.init=function(e,t,n,i){t=void 0!==t&&t,n=void 0===n?"UNKNOWN":n,i=void 0!==i&&i;var r,a,s,o,l,u=this;return N(function(d){switch(d.g){case 1:return r=Pn,_(d,u.L,2);case 2:u.B=t,u.aa=n,u.Fa=i,u.Ea=!u.B&&"HLS"==u.aa&&!u.Fa,u.K=null,a=c(e.keys()),s=a.next();case 3:if(s.done){d.u(0);break}return o=s.value,l=e.get(o),_(d,il(u,o,l,l.codecs),6);case 6:u.o?(u.l[r.X]=[],u.l[r.ga]=[]):u.l[o]=[],s=a.next(),d.u(3)}})},i.configure=function(e){this.A=e,this.g&&(this.g.A=e.modifyCueCallback)},i.yb=function(){var e={total:this.C?[]:so(this.i.buffered),audio:this.C?[]:so(ul(this,"audio")),video:this.C?[]:so(ul(this,"video")),text:[]};if(this.g){var t=this.g.g,n=this.g.h;null!=t&&null!=n&&e.text.push({start:t,end:n})}return e},i.remove=function(e,t,n){var i,r=this;return N(function(a){return 1==a.g?(i=Pn,e==i.ta?_(a,r.g.remove(t,n),0):_(a,Tl(r,e,function(){return vl(r,e,t,n)},null),4)):r.o?_(a,Tl(r,i.X,function(){return vl(r,i.X,t,n)},null),0):a.u(0)})},i.flush=function(e){var t,n=this;return N(function(i){return 1==i.g?(t=Pn,e==t.ta?i.return():_(i,Tl(n,e,function(){n.i.currentTime-=.001,Sl(n,e)},null),2)):n.o?_(i,Tl(n,t.X,function(){var e=t.X;n.i.currentTime-=.001,Sl(n,e)},null),0):i.u(0)})},i.endOfStream=function(e){var t=this;return N(function(n){return _(n,_l(t,function(){al(t)||"closed"===t.m.readyState||(e?t.m.endOfStream(e):t.m.endOfStream())}),0)})},i.$a=function(e){var t=this;return N(function(n){return _(n,_l(t,function(){if(e<t.m.duration)for(var n in t.h){var i={start:function(){},p:new Ir,uri:null};t.l[n].unshift(i)}t.m.duration=e,t.ea=e}),0)})},i.getDuration=function(){return this.m.duration};var Ml=e.URL.createObjectURL,Dl="sequence";function Ll(e,t,n){this.i=e,this.A=t,this.o=this.j=1/0,this.g=1,this.h=this.l=null,this.B=0,this.G=!0,this.H=0,this.C=void 0===n||n,this.F=0,this.s=!1,this.m=e}function Pl(e,t,n){this.j=n,this.l=e,this.s=Ul(e),this.g=e.g.currentTime,this.m=Date.now()/1e3,this.h=!1,this.o=0,this.A=t,this.i=function(){}}function Ol(e,t){e.i=t}function Nl(e){this.g=e}function Ul(e){if(e.g.paused||0==e.g.playbackRate||0==e.g.buffered.length)var t=!1;else e:{t=e.g.currentTime,e=c(so(e.g.buffered));for(var n=e.next();!n.done;n=e.next())if(n=n.value,!(t<n.start-.1||t>n.end-.5)){t=!0;break e}t=!1}return t}function Fl(e,t,n,i,r){var a=this;this.A=r,this.g=e,this.B=t,this.s=n,this.l=new ae,this.j=!1,this.F=e.readyState,this.C=this.i=0,this.h=i,this.o=!1,this.l.D(e,"waiting",function(){return Bl(a)}),this.m=new Ut(function(){Bl(a)}).Sa(this.s.gapJumpTimerTime)}function Bl(e){if(0!=e.g.readyState){if(e.g.seeking){if(!e.j)return}else e.j=!1;if(!e.g.paused||e.g.currentTime==e.i&&(e.g.autoplay||e.g.currentTime!=e.i)){var t;if(e.g.readyState!=e.F&&(e.F=e.g.readyState),!(t=!e.h)){t=e.h;var n=t.l,i=Ul(n),r=n.g.currentTime,a=Date.now()/1e3;t.g==r&&t.s==i||(t.m=a,t.g=r,t.s=i,t.h=!1),r=a-t.m,(i=r>=t.A&&i&&!t.h)&&(t.i(t.g,r),t.h=!0,t.g=n.g.currentTime,t.o++,t.j(new Nr("stalldetected"))),t=!i}t&&(t=e.g.currentTime,n=e.g.buffered,i=ao(n,t,e.s.gapDetectionThreshold),null!=i&&(0!=i||e.o))&&(r=n.start(i),(navigator.userAgent.match(/Edge\//)||jt())&&(r=Math.ceil(100*(r+.01))/100),r>=e.B.Ab()||.001>r-t||(0!=i&&n.end(i-1),e.g.currentTime=r,t==e.i&&(e.i=r),e.C++,e.A(new Nr("gapjumped"))))}}}function Vl(e,t,n,i){t==HTMLMediaElement.HAVE_NOTHING||e.readyState>=t?i():(t=jl.value().get(t),n.ha(e,t,i))}i=Ll.prototype,i.getDuration=function(){return this.j},i.Zh=function(){return this.g},i.mh=function(e){this.i=e},i.$a=function(e){this.j=e},i.di=function(){return this.i},i.kh=function(e){this.B=e},i.wc=function(e){this.G=e},i.Ie=function(e){this.o=e},i.je=function(){return this.o},i.eg=function(e){this.A=e},i.Sh=function(){return this.A},i.$g=function(e,t){if(0!=e.length){var n=(Date.now()+this.B)/1e3;if(e=e.filter(function(e){return e.start+t<n}),0!=e.length){var i=e[e.length-1].end+t;this.ye(e[0].start+t),this.g=e.reduce(function(e,t){return Math.max(e,t.end-t.start)},this.g),this.h=Math.max(this.h,i),null!=this.i&&this.C&&!this.s&&(this.i=n-this.h-this.g)}}},i.Jd=function(e){if(0!=e.length){var t=e[0].startTime,n=e[0].endTime,i=(Date.now()+this.B)/1e3;e=c(e);for(var r=e.next();!r.done;r=e.next())r=r.value,i<r.startTime||(t=Math.min(t,r.startTime),n=Math.max(n,r.endTime),this.g=Math.max(this.g,r.endTime-r.startTime));this.ye(t),this.h=Math.max(this.h,n),null!=this.i&&this.C&&!this.s&&(this.i=i-this.h-this.g)}},i.$h=function(){return this.h},i.re=function(){this.s=!0},i.zi=function(){return this.s},i.lh=function(e){this.m=e},i.Wh=function(){return this.m},i.ye=function(e){this.l=null==this.l?e:Math.min(this.l,e)},i.Pf=function(e){this.g=Math.max(this.g,e)},i.offset=function(e){null!=this.l&&(this.l+=e),null!=this.h&&(this.h+=e)},i.V=function(){return 1/0==this.j&&!this.G},i.qc=function(){return 1/0!=this.j&&!this.G},i.nb=function(){return Math.max(this.H,this.Zb()-this.o)},i.qh=function(e){this.H=e},i.Zb=function(){return this.V()||this.qc()?Math.min(Math.max(0,(Date.now()+this.B)/1e3-this.g-this.i)+this.F,this.j):this.h?Math.min(this.h,this.j):this.j},i.ud=function(e){var t=Math.max(this.l,this.H);return 1/0==this.o?Math.ceil(1e3*t)/1e3:Math.max(t,Math.min(this.Zb()-this.o+e,this.Ab()))},i.Yb=function(){return this.ud(0)},i.Ab=function(){return Math.max(0,this.Zb()-(this.V()||this.qc()?this.A:0))},i.uh=function(){return!(null==this.i||null!=this.h&&this.C)},i.jh=function(e){this.F=e},i.Qh=function(){return this.F},z("shaka.media.PresentationTimeline",Ll),Ll.prototype.getAvailabilityTimeOffset=Ll.prototype.Qh,Ll.prototype.setAvailabilityTimeOffset=Ll.prototype.jh,Ll.prototype.usingPresentationStartTime=Ll.prototype.uh,Ll.prototype.getSeekRangeEnd=Ll.prototype.Ab,Ll.prototype.getSeekRangeStart=Ll.prototype.Yb,Ll.prototype.getSafeSeekRangeStart=Ll.prototype.ud,Ll.prototype.getSegmentAvailabilityEnd=Ll.prototype.Zb,Ll.prototype.setUserSeekStart=Ll.prototype.qh,Ll.prototype.getSegmentAvailabilityStart=Ll.prototype.nb,Ll.prototype.isInProgress=Ll.prototype.qc,Ll.prototype.isLive=Ll.prototype.V,Ll.prototype.offset=Ll.prototype.offset,Ll.prototype.notifyMaxSegmentDuration=Ll.prototype.Pf,Ll.prototype.notifyMinSegmentStartTime=Ll.prototype.ye,Ll.prototype.getInitialProgramDateTime=Ll.prototype.Wh,Ll.prototype.setInitialProgramDateTime=Ll.prototype.lh,Ll.prototype.isStartTimeLocked=Ll.prototype.zi,Ll.prototype.lockStartTime=Ll.prototype.re,Ll.prototype.getMaxSegmentEndTime=Ll.prototype.$h,Ll.prototype.notifySegments=Ll.prototype.Jd,Ll.prototype.notifyTimeRange=Ll.prototype.$g,Ll.prototype.getDelay=Ll.prototype.Sh,Ll.prototype.setDelay=Ll.prototype.eg,Ll.prototype.getSegmentAvailabilityDuration=Ll.prototype.je,Ll.prototype.setSegmentAvailabilityDuration=Ll.prototype.Ie,Ll.prototype.setStatic=Ll.prototype.wc,Ll.prototype.setClockOffset=Ll.prototype.kh,Ll.prototype.getPresentationStartTime=Ll.prototype.di,Ll.prototype.setDuration=Ll.prototype.$a,Ll.prototype.setPresentationStartTime=Ll.prototype.mh,Ll.prototype.getMaxSegmentDuration=Ll.prototype.Zh,Ll.prototype.getDuration=Ll.prototype.getDuration,Pl.prototype.release=function(){this.j=this.l=null,this.i=function(){}},Fl.prototype.release=function(){this.l&&(this.l.release(),this.l=null),null!=this.m&&(this.m.stop(),this.m=null),this.h&&(this.h.release(),this.h=null),this.g=this.B=this.A=null},Fl.prototype.Sf=function(){this.o=!0,Bl(this)};var jl=new Rt(function(){return new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]])});function Gl(e,t,n,i){var r=this;this.g=e,this.m=t,this.s=n,this.l=null,this.j=function(){return null==r.l&&(r.l=i()),r.l},this.o=!1,this.h=new ae,this.i=new Wl(e),Vl(this.g,HTMLMediaElement.HAVE_METADATA,this.h,function(){Kl(r,r.j())})}function Hl(e){return e.o?e.g.currentTime:e.j()}function zl(e,t){0<e.g.readyState?ql(e.i,t):Vl(e.g,HTMLMediaElement.HAVE_METADATA,e.h,function(){Kl(e,e.j())})}function Kl(e,t){.001>Math.abs(e.g.currentTime-t)?$l(e):(e.h.ha(e.g,"seeking",function(){$l(e)}),ql(e.i,e.g.currentTime&&0!=e.g.currentTime?e.g.currentTime:t))}function $l(e){e.o=!0,e.h.D(e.g,"seeking",function(){return e.m()}),e.s(e.g.currentTime)}function Wl(e){var t=this;this.h=e,this.m=10,this.l=this.j=this.i=0,this.g=new Ut(function(){0>=t.i?t.g.stop():t.h.currentTime!=t.j?t.g.stop():(t.h.currentTime=t.l,t.i--)})}function ql(e,t){e.j=e.h.currentTime,e.l=t,e.i=e.m,e.h.currentTime=t,e.g.Sa(.1)}function Yl(e){this.h=e,this.j=!1,this.g=null,this.i=new ae}function Xl(e,t,n,i,r,a){var s=this;this.i=e,this.g=t.presentationTimeline,this.B=t.minBufferTime||0,this.l=n,this.A=r,this.s=null,this.o=eu(e,n,a),this.j=new Fl(e,t.presentationTimeline,n,this.o,a),this.h=new Gl(e,function(){e:{var e=s.j;e.j=!0,e.o=!1;var t=Hl(s.h);if(e=Zl(s,t),.001<Math.abs(e-t)){if(t=!1,!Wt()||Wt()&&nn())t=!0;else{var n=Date.now()/1e3;(!s.s||s.s<n-1)&&(s.s=n,t=!0)}if(t){zl(s.h,e),e=void 0;break e}}s.A(),e=void 0}return e},function(e){var t=s.j;t.g.seeking&&!t.j&&(t.j=!0,t.i=e)},function(){var e=i;return null==e?e=1/0>s.g.getDuration()?s.g.Yb():s.g.Ab():0>e&&(e=s.g.Ab()+e),Ql(s,Jl(s,e))}),this.m=new Ut(function(){if(0!=s.i.readyState&&!s.i.paused){var e=Hl(s.h),t=s.g.Yb(),n=s.g.Ab();3>n-t&&(t=n-3),e<t&&(e=Zl(s,e),s.i.currentTime=e)}})}function Ql(e,t){var n=e.g.getDuration();return t>=n?n-e.l.durationBackoff:t}function Zl(e,t){var n=Math.max(e.B,e.l.rebufferingGoal),i=e.l.safeSeekOffset,r=e.g.Yb(),a=e.g.Ab(),s=e.g.getDuration();3>a-r&&(r=a-3);var o=e.g.ud(n),l=e.g.ud(i);return n=e.g.ud(n+i),t>=s?Ql(e,t):t>a?a:t<r?io(e.i.buffered,l)?l:n:t>=o||io(e.i.buffered,t)?t:n}function Jl(e,t){var n=e.g.Yb();return t<n?n:(e=e.g.Ab(),t>e?e:t)}function eu(e,t,n){if(!t.stallEnabled)return null;var i=t.stallSkip;return t=new Pl(new Nl(e),t.stallThreshold,n),Ol(t,function(){i?e.currentTime+=i:(e.pause(),e.play())}),t}function tu(e){this.O=e,this.l=null,this.i=0,this.m=!1}function nu(e,t,n){return e=new Qs(e,e+t,function(){return n},0,null,null,e,e,e+t),new tu([e])}function iu(e,t,n,i){this.i=e,this.h=t,this.g=n,this.reverse=i}function ru(){tu.call(this,[]),this.g=[]}function au(e){var t=this;this.g=e,this.j=!1,this.i=this.g.ie(),this.h=new Ut(function(){t.g.Yg(.25*t.i)})}function su(e){e.h.stop();var t=e.j?0:e.i;if(0<=t)try{return void(e.g.ie()!=t&&e.g.hg(t))}catch(e){}e.h.Sa(.25),0!=e.g.ie()&&e.g.hg(0)}function ou(e){var t=this;this.h=e,this.g=new Set,this.i=new Ut(function(){lu(t,!1)}).Sa(.25)}function lu(e,t){for(var n=c(e.g),i=n.next();!i.done;i=n.next())i.value.j(e.h.currentTime,t)}function uu(){this.g=null,this.h=[]}function cu(e,t){var n=0;e.g&&e.g.state==t&&(n+=e.g.duration),e=c(e.h);for(var i=e.next();!i.done;i=e.next())i=i.value,n+=i.state==t?i.duration:0;return n}function du(e){function t(e){return{timestamp:e.timestamp,state:e.state,duration:e.duration}}for(var n=[],i=c(e.h),r=i.next();!r.done;r=i.next())n.push(t(r.value));return e.g&&n.push(t(e.g)),n}function hu(){this.i=this.h=null,this.g=[]}function fu(e,t,n){e.i!=t&&(e.i=t,e.g.push({timestamp:Date.now()/1e3,id:t.id,type:"text",fromAdaptation:n,bandwidth:null}))}function pu(){this.ae=this.Ug=this.A=this.B=this.I=this.C=this.s=this.j=this.H=this.m=this.i=this.U=this.Z=this.L=this.N=this.R=this.l=this.o=NaN,this.K=0,this.F=this.G=NaN,this.g=new uu,this.h=new hu}function gu(e,t,n,i){this.m=e,this.i=t,this.l=n,this.h=new Map,this.j=new Map,this.g=null,this.o=i}function mu(e,t){e.l=t,e=c(e.h.values());for(var n=e.next();!n.done;n=e.next())n.value.g=t}function vu(e,t,n){if(n=void 0!==n&&n,e.i.segmentIndex&&(e.g||(e.g=e.i.segmentIndex.Kb(t,!0,e.o)),e.g)){for(n&&e.g.next();e.h.size<e.m;){if(t=e.g.next().value,!t)break;if(n=!0,t.preload&&null!=t.sa&&(n=!1),2==t.ac()&&(n=!1),n&&t.$&&yu(e,t.$),n&&!e.h.has(t)&&(n=new xu(e.l),Au(n,t,e.i),e.h.set(t,n)),e.i.fastSwitching&&t.Kd&&t.pe)break}Tu(e)}}function yu(e,t){if(e.i.segmentIndex&&!Array.from(e.j.keys()).some(function(e){return Xs(e,t)})){var n=new xu(e.l);Au(n,t,e.i),e.j.set(t,n)}}function bu(e,t){t=c(t.keys());for(var n=t.next();!n.done;n=t.next())(n=n.value)&&Eu(e,n)}function Su(e){bu(e,e.h),bu(e,e.j),e.g=null}function Tu(e){for(var t=Array.from(e.h.keys()),n={},i=c(e.j.keys()),r=i.next();!r.done;n={Vd:n.Vd},r=i.next())n.Vd=r.value,t.some(function(e){return function(t){return Xs(t.$,e.Vd)}}(n))||Eu(e,n.Vd)}function _u(e,t){e.m=t;for(var n=Array.from(e.h.keys());n.length>t;){var i=n.pop();i&&Eu(e,i)}Tu(e)}function wu(e,t){t&&t!==e.i&&(Su(e),e.i=t)}function Eu(e,t){var n=e.h;t instanceof Ys&&(n=e.j),e=n.get(t),n.delete(t),e&&e.abort()}function xu(e){this.g=e,this.Be=this.ig=null}function Au(e,t,n){var i=new Uint8Array(0);e.Be=e.g(t,n,function(t){return N(function(n){if(1==n.g)return i=0<i.byteLength?An(i,t):t,e.ig?_(n,e.ig(i),3):n.u(0);i=new Uint8Array(0),w(n)})})}function ku(e){Br.call(this);var t=this;this.g=new Set,this.i=e,this.h=new Ut(function(){for(var e=t.i(),n=c(t.g),i=n.next();!i.done;i=n.next())i=i.value,i.endTime<e.start&&(t.g.delete(i),i=new Nr("regionremove",new Map([["region",i]])),t.dispatchEvent(i))}).Sa(2)}function Iu(e){Br.call(this),this.g=new Map,this.h=e}function Cu(e,t){var n=e.g.get(t);return n||(n={Md:[],kf:null,contentType:t},e.g.set(t,n)),n}function Ru(e,t,n){var i=Cu(e,t.contentType);Du(e,i),e={Lc:t,position:n},i=i.Md,t=i.findIndex(function(e){return e.position>=n}),0<=t?i.splice(t,i[t].position==n?1:0,e):i.push(e)}function Mu(e,t,n){return!!((e=e.h()[n])&&0<e.length&&(n=e[e.length-1].end,t>=e[0].start&&t<n))}function Du(e,t){if((e=e.h()[t.contentType])&&0<e.length){var n=e[0].start,i=e[e.length-1].end,r=t.Md;t.Md=r.filter(function(e,t){return!(e.position<=n&&t+1<r.length&&r[t+1].position<=n||e.position>=i)})}else t.Md=[]}function Lu(e){var t={bandwidth:e.bandwidth||0,audioSamplingRate:null,codecs:e.codecs,contentType:e.type,frameRate:null,height:null,mimeType:e.mimeType,channelsCount:null,pixelAspectRatio:null,width:null,label:null,roles:e.roles,language:null};return"video"==e.type&&(t.frameRate=e.frameRate||null,t.height=e.height||null,t.pixelAspectRatio=e.pixelAspectRatio||null,t.width=e.width||null),"audio"==e.type&&(t.audioSamplingRate=e.audioSamplingRate,t.channelsCount=e.channelsCount,t.label=e.label||null,t.language=e.language),t}function Pu(e){var t=Kn(e),n=t.split("/")[0];return e=$n(e),{type:n,mimeType:t,codecs:e,language:null,height:null,width:null,channelCount:null,sampleRate:null,closedCaptions:new Map,Qd:null,colorGamut:null}}function Ou(e,t){function n(e){a=e.name;var t=e.reader;t.skip(24);var n=t.ka(),i=t.ka();t.skip(50),f=String(n),h=String(i),e.reader.oa()&&da(e)}function i(e){var t=bo(e.reader);p=t.channelCount,g=t.sampleRate,r(e.name)}function r(e){switch(e=e.toLowerCase(),e){case"avc1":case"avc3":o.push(e+".42E01E"),u=!0;break;case"hev1":case"hvc1":o.push(e+".1.6.L93.90"),u=!0;break;case"dvh1":case"dvhe":o.push(e+".05.04"),u=!0;break;case"vp09":o.push(e+".00.10.08"),u=!0;break;case"av01":o.push(e+".0.01M.08"),u=!0;break;case"mp4a":s.push("mp4a.40.2"),l=!0;break;case"ac-3":case"ec-3":case"ac-4":case"opus":case"flac":s.push(e),l=!0}}var a,s=[],o=[],l=!1,u=!1,d=null,h=null,f=null,p=null,g=null,m=null,v=null;if((new ca).box("moov",da).box("trak",da).box("mdia",da).S("mdhd",function(e){d=vo(e.reader,e.version).language}).box("minf",da).box("stbl",da).S("stsd",ha).box("mp4a",function(e){var t=bo(e.reader);p=t.channelCount,g=t.sampleRate,e.reader.oa()?da(e):r(e.name)}).box("esds",function(e){e=e.reader;for(var t,n,i="mp4a";e.oa();){t=e.T();for(var r=e.T();128&r;)r=e.T();if(3==t)e.ka(),r=e.T(),128&r&&e.ka(),64&r&&e.skip(e.T()),32&r&&e.ka();else if(4==t)n=e.T(),e.skip(12);else if(5==t)break}n&&(i+="."+_o(n),5==t&&e.oa()&&(t=e.T(),n=(248&t)>>3,31===n&&e.oa()&&(n=32+((7&t)<<3)+((224&e.T())>>5)),i+="."+n)),s.push(i),l=!0}).box("ac-3",i).box("ec-3",i).box("ac-4",i).box("Opus",i).box("fLaC",i).box("avc1",n).box("avc3",n).box("hev1",n).box("hvc1",n).box("dva1",n).box("dvav",n).box("dvh1",n).box("dvhe",n).box("vp09",n).box("av01",n).box("avcC",function(e){var t=a||"";switch(a){case"dvav":t="avc3";break;case"dva1":t="avc1"}e=e.reader,e.skip(1),e=t+"."+_o(e.T())+_o(e.T())+_o(e.T()),o.push(e),u=!0}).box("hvcC",function(e){var t=a||"";switch(a){case"dvh1":t="hvc1";break;case"dvhe":t="hev1"}var n=e.reader;n.skip(1),e=n.T();var i=["","A","B","C"][e>>6],r=31&e,s=n.P(),l=(32&e)>>5?"H":"L";e=[n.T(),n.T(),n.T(),n.T(),n.T(),n.T()],n=n.T();for(var c=0,d=0;32>d;d++){if(c|=1&s,31==d)break;c<<=1,s>>=1}for(t=t+"."+i+r+"."+_o(c,!0),t+="."+l+n,i="",r=e.length;r--;)((l=e[r])||i)&&(i="."+l.toString(16).toUpperCase()+i);t+=i,o.push(t),u=!0}).box("dvcC",function(e){var t=a||"";switch(a){case"hvc1":t="dvh1";break;case"hev1":t="dvhe";break;case"avc1":t="dva1";break;case"avc3":t="dvav";break;case"av01":t="dav1"}var n=e.reader;n.skip(2),e=n.T(),n=n.T(),o.push(t+"."+wo(e>>1&127)+"."+wo(e<<5&32|n>>3&31)),u=!0}).box("dvvC",function(e){var t=a||"";switch(a){case"hvc1":t="dvh1";break;case"hev1":t="dvhe";break;case"avc1":t="dva1";break;case"avc3":t="dvav";break;case"av01":t="dav1"}var n=e.reader;n.skip(2),e=n.T(),n=n.T(),o.push(t+"."+wo(e>>1&127)+"."+wo(e<<5&32|n>>3&31)),u=!0}).S("vpcC",function(e){var t=a||"",n=e.reader;e=n.T();var i=n.T();n=n.T()>>4&15,o.push(t+"."+wo(e)+"."+wo(i)+"."+wo(n)),u=!0}).box("av1C",function(e){var t=a||"";switch(a){case"dav1":t="av01"}var n=e.reader;n.skip(1),e=n.T(),n=n.T();var i=e>>>5,r=(64&n)>>6;o.push(t+"."+i+"."+wo(31&e)+(n>>>7?"H":"M")+"."+wo(2===i&&r?(32&n)>>5?12:10:r?10:8)+"."+((16&n)>>4)+"."+((8&n)>>3)+((4&n)>>2)+(3&n)+"."+wo(1)+"."+wo(1)+"."+wo(1)+".0"),u=!0}).box("enca",pa).box("encv",fa).box("sinf",da).box("frma",function(e){e=So(e.reader).Na,r(e)}).box("colr",function(e){o=o.map(function(t){if(t.startsWith("av01.")){var n=e.reader,i=n.ua(),r=n.rb(4),a=String.fromCharCode(r[0]);if(a+=String.fromCharCode(r[1]),a+=String.fromCharCode(r[2]),a+=String.fromCharCode(r[3]),"nclx"===a){r=n.ka(),a=n.ka();var s=n.ka(),o=n.T()>>7,l=t.split(".");10==l.length&&(l[6]=wo(r),l[7]=wo(a),l[8]=wo(s),l[9]=String(o),t=l.join("."))}n.seek(i)}return t});var t=To(e.reader),n=t.colorGamut;m=t.Qd,v=n}).parse(e||t,!0),!s.length&&!o.length)return null;var y=l&&!u,b=new Map;if(u){var S=new Ce("video/mp4");for(e&&S.init(e),S.i(t),e=c(S.j()),t=e.next();!t.done;t=e.next())t=t.value,b.set(t,t);S.g()}return{type:y?"audio":"video",mimeType:y?"audio/mp4":"video/mp4",codecs:Nu(s.concat(o)).join(", "),language:d,height:h,width:f,channelCount:p,sampleRate:g,closedCaptions:b,Qd:m,colorGamut:v}}function Nu(e){var t=new Set,n=[];e=c(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;var r=zn(i);t.has(r)||(n.push(i),t.add(r))}return t=Dn("audio",n),i=Dn("video",n),e=Dn(Ln,n),i=Uu(i),t=t.concat(i).concat(e),n.length&&!t.length?n:t}function Uu(e){if(1>=e.length)return e;var t=e.find(function(e){return e.startsWith("dvh1.")||e.startsWith("dvhe.")||e.startsWith("dav1.")});return t?ce('video/mp4; codecs="'+t+'"')?[t]:e.filter(function(e){return e!=t}):e}function Fu(e){var t=null;return(new ca).box("moov",da).box("trak",da).box("mdia",da).box("minf",da).box("stbl",da).S("stsd",ha).box("encv",fa).box("enca",pa).box("sinf",da).box("schi",da).S("tenc",function(e){e=e.reader,e.T(),e.T(),e.T(),e.T(),t=xn(e.rb(16))}).parse(e,!0),t}function Bu(t,n,i){var r,a,s,o,l;return N(function(u){if(1==u.g)return r=n,r.cryptoKey?u.u(2):_(u,r.fetchKey(),3);if(a=r.iv,!a)for(a=Ee(new ArrayBuffer(16)),s=r.firstMediaSequenceNumber+i,o=a.byteLength-1;0<=o;o--)a[o]=255&s,s>>=8;return l="CBC"==n.blockCipherMode?{name:"AES-CBC",iv:a}:{name:"AES-CTR",counter:a,length:64},u.return(e.crypto.subtle.decrypt(l,r.cryptoKey,t))})}function Vu(e,t,n,i,r){return e=Kr(e,i,r),0==t&&null==n||(e.headers.Range=n?"bytes="+t+"-"+n:"bytes="+t+"-"),e}function ju(e,t){var n=this;this.g=t,this.l=e,this.h=null,this.B=1,this.s=this.j=null,this.H=0,this.F=!1,this.i=new Map,this.C=!1,this.I=null,this.A=!1,this.m=new ta(function(){return Gu(n)}),this.K=Date.now()/1e3,this.o=new Map,this.G={projection:null,hfov:null},this.N=0,this.L=1/0}function Gu(e){var t,n,i,r,a,s,o;return N(function(l){if(1==l.g){for(t=[],n=c(e.i.values()),i=n.next();!i.done;i=n.next())r=i.value,vc(r),t.push(yc(r)),r.W&&(Su(r.W),r.W=null);for(a=c(e.o.values()),s=a.next();!s.done;s=a.next())o=s.value,Su(o);return _(l,Promise.all(t),2)}e.i.clear(),e.o.clear(),e.g=null,e.l=null,e.h=null,w(l)})}function Hu(e,t,n){e.l.presentationTimeline.V()||(e.N=t,e.L=n)}function zu(e,t){var n,i,r,a,s,o;N(function(l){switch(l.g){case 1:return n=Pn,e.H++,i=e.H,E(l,2),_(l,pl(e.g.ca,n.ta),4);case 4:A(l,3);break;case 2:r=k(l),e.g&&e.g.onError(r);case 3:a=Fn(t.mimeType,t.codecs),rl(e.g.ca,a,e.l.sequenceMode,t.external),s=e.g.ca.F,(s.isTextVisible()||e.h.alwaysStreamText)&&e.H==i&&(o=Ju(e,t),e.i.set(n.ta,o),mc(e,o,0)),w(l)}})}function Ku(e){var t=e.i.get(Ln);t&&(vc(t),yc(t).catch(function(){}),e.i.delete(Ln)),e.s=null}function $u(e,t){for(var n=0>e.g.fb(),i=c(e.i.values()),r=i.next();!r.done;r=i.next())r=r.value,r.ia&&r.ia.Uc(n),r.W&&r.W.Uc(n);for(i=c(e.o.values()),r=i.next();!r.done;r=i.next())r.value.Uc(n);(n=e.i.get("video"))&&(i=n.stream)&&(t?(t=i.trickModeVideo)&&!n.vc&&(Yu(e,t,!1,0,!1),n.vc=i):(t=n.vc)&&(n.vc=null,Yu(e,t,!0,0,!1)))}function Wu(e,t,n,i,r,a){n=void 0!==n&&n,i=void 0===i?0:i,r=void 0!==r&&r,a=void 0!==a&&a,e.j=t,e.C&&(t.video&&Yu(e,t.video,n,i,r,a),t.audio&&Yu(e,t.audio,n,i,r,a))}function qu(e,t){N(function(n){if(1==n.g)return e.s=t,e.C?t.segmentIndex?n.u(2):_(n,t.createSegmentIndex(),2):n.return();Yu(e,t,!0,0,!1),w(n)})}function Yu(e,t,n,i,r,a){var s=e.i.get(t.type);s||t.type!=Ln?s&&(s.vc&&(t.trickModeVideo?(s.vc=t,t=t.trickModeVideo):s.vc=null),s.stream!=t||r)&&(e.o.has(t)?s.W=e.o.get(t):s.W&&wu(s.W,t),t.type==Ln&&(r=Fn(t.mimeType,t.codecs),rl(e.g.ca,r,e.l.sequenceMode,t.external)),e.o.has(s.stream)||s.stream.closeSegmentIndex&&s.stream.closeSegmentIndex(),s.stream=t,s.ia=null,s.wg=!!a,n?s.nd?s.Oe=!0:s.Qa?(s.ec=!0,s.ee=i,s.Oe=!0):(vc(s),gc(e,s,!0,i).catch(function(t){e.g&&e.g.onError(t)})):s.Qa||s.ub||mc(e,s,0),Xu(e,s).catch(function(t){e.g&&e.g.onError(t)})):zu(e,t)}function Xu(e,t){var n,i;return N(function(r){if(1==r.g)return t.kb?(n=t.stream,i=t.kb,n.segmentIndex?r.u(2):_(r,n.createSegmentIndex(),2)):r.return();if(t.kb!=i||t.stream!=n)return r.return();var a=e.g.he(),s=ol(e.g.ca,t.type),o=t.stream.segmentIndex.find(t.Ya?t.Ya.endTime:a),l=null==o?null:t.stream.segmentIndex.get(o);o=l&&l.sa?l.sa-l.Ha:null,l&&!o&&(o=(l.endTime-l.getStartTime())*(t.stream.bandwidth||0)/8),o?((l=l.$)&&(o+=(l.sa?l.sa-l.Ha:null)||0),l=e.g.getBandwidthEstimate(),a=8*o/l<(s||0)-a-Math.max(e.l.minBufferTime||0,e.h.rebufferingGoal)||t.kb.h.g>o):a=!1,a&&t.kb.abort(),w(r)})}function Qu(e,t){t.nd||t.ec||(t.Qa?(t.ec=!0,t.ee=0):null==sl(e.g.ca,t.type)?null==t.ub&&mc(e,t,0):(vc(t),gc(e,t,!1,0).catch(function(t){e.g&&e.g.onError(t)})))}function Zu(e,t){var n,i,r,a,s,o,l,u,d,h;return N(function(f){if(1==f.g){if(n=Pn,!e.j)throw new It(2,5,5006);return i=new Map,r=new Set,e.j.audio&&(i.set(n.X,e.j.audio),r.add(e.j.audio)),e.j.video&&(i.set(n.ga,e.j.video),r.add(e.j.video)),e.s&&(i.set(n.ta,e.s),r.add(e.s)),a=e.g.ca,_(f,a.init(i,e.l.sequenceMode,e.l.type,e.l.ignoreManifestTimestampsInSegmentsMode),2)}for(na(e.m),e.updateDuration(),s=c(i.keys()),o=s.next();!o.done;o=s.next())l=o.value,u=i.get(l),e.i.has(l)||(d=Ju(e,u),t.has(u.id)&&(h=t.get(u.id),mu(h,function(t,n,i){return pc(t,n,i||null,e.h.retryParameters,e.g.Nb)}),d.W=h),e.i.set(l,d),mc(e,d,0));w(f)})}function Ju(e,t){return{stream:t,type:t.type,ia:null,W:ec(e,t),Ya:null,Kc:null,qe:null,oe:null,ne:null,vc:null,endOfStream:!1,Qa:!1,ub:null,ec:!1,ee:0,Oe:!1,nd:!1,Nd:!0,Yf:!1,yd:!1,kb:null}}function ec(e,t){if("video"===t.type&&e.h.disableVideoPrefetch||"audio"===t.type&&e.h.disableAudioPrefetch||t.type===Ln&&("application/cea-608"==t.mimeType||"application/cea-708"==t.mimeType)||t.type===Ln&&e.h.disableTextPrefetch)return null;if(e.o.has(t))return e.o.get(t);var n=e.i.get(t.type);return(n=n&&n.W)&&t===n.i?n:0<e.h.segmentPrefetchLimit?new gu(e.h.segmentPrefetchLimit,t,function(t,n,i){return pc(t,n,i||null,e.h.retryParameters,e.g.Nb)},0>e.g.fb()):null}function tc(e){for(var t=e.h.segmentPrefetchLimit,n=e.h.prefetchAudioLanguages,i={},r=c(e.l.variants),a=r.next();!a.done;i={Ta:i.Ta},a=r.next())if(i.Ta=a.value,i.Ta.audio)if(e.o.has(i.Ta.audio)){if(a=e.o.get(i.Ta.audio),_u(a,t),!(0<t&&n.some(function(e){return function(t){return ui(e.Ta.audio.language,t)}}(i)))){var s=e.i.get(i.Ta.audio.type);a!==(s&&s.W)&&Su(a),e.o.delete(i.Ta.audio)}}else 0>=t||!n.some(function(e){return function(t){return ui(e.Ta.audio.language,t)}}(i))||!(a=ec(e,i.Ta.audio))||(i.Ta.audio.segmentIndex||i.Ta.audio.createSegmentIndex(),e.o.set(i.Ta.audio,a))}function nc(e,t){var n,i,r,a,s,o;return N(function(l){switch(l.g){case 1:if(na(e.m),t.Qa||null==t.ub||t.nd)return l.return();if(t.ub=null,!t.ec){l.u(2);break}return _(l,gc(e,t,t.Oe,t.ee),3);case 3:return l.return();case 2:if(t.stream.segmentIndex){l.u(4);break}return n=t.stream,E(l,5),_(l,t.stream.createSegmentIndex(),7);case 7:A(l,6);break;case 5:return i=k(l),_(l,bc(e,t,i),8);case 8:return l.return();case 6:if(n!=t.stream)return n.closeSegmentIndex&&n.closeSegmentIndex(),t.Qa||t.ub||mc(e,t,0),l.return();case 4:E(l,9),r=ic(e,t),null!=r&&(mc(e,t,r),t.yd=!1),A(l,10);break;case 9:return a=k(l),_(l,bc(e,t,a),11);case 11:return l.return();case 10:if(s=Array.from(e.i.values()),!e.C||!s.every(function(e){return e.endOfStream})){l.u(0);break}return _(l,e.g.ca.endOfStream(),13);case 13:na(e.m),o=e.g.ca.getDuration(),0!=o&&o<e.l.presentationTimeline.getDuration()&&e.l.presentationTimeline.$a(o),w(l)}})}function ic(e,t){if(hc(t))return hl(e.g.ca,t.stream.originalId||""),null;if(t.type==Ln&&fl(e.g.ca),!e.g.ca.xa&&t.type!=Ln)return e.h.updateIntervalSeconds/2;var n=e.g.he();if("audio"===t.type)for(var i=c(e.o.keys()),r=i.next();!r.done;r=i.next())r=e.o.get(r.value),r.Oa(n,!0),vu(r,n);i=t.Ya?t.Ya.endTime:n,r=ll(e.g.ca,t.type,n);var a=Math.max(1,Math.max(e.l.minBufferTime||0,e.h.rebufferingGoal,e.h.bufferingGoal)*e.B),s=e.l.presentationTimeline.getDuration()-i,o=ol(e.g.ca,t.type);if(1e-6>s&&o)return t.endOfStream=!0,"video"==t.type&&(e=e.i.get(Ln))&&hc(e)&&(e.endOfStream=!0),null;if(t.endOfStream=!1,r>=a)return e.h.updateIntervalSeconds/2;if(r=rc(e,t,n,o),!r)return e.h.updateIntervalSeconds;for(a=1/0,s=Array.from(e.i.values()),s=c(s),o=s.next();!o.done;o=s.next())o=o.value,hc(o)||o.ia&&!o.ia.current()||(a=Math.min(a,o.Ya?o.Ya.endTime:n));return i>=a+e.l.presentationTimeline.g?e.h.updateIntervalSeconds:(t.W&&t.ia&&!e.o.has(t.stream)&&(t.W.Oa(r.startTime),vu(t.W,r.startTime)),ac(e,t,n,r).catch(function(){}),null)}function rc(e,t,n,i){if(t.ia)return t.ia.current();if(t.Ya||i)return t.ia=t.stream.segmentIndex.Kb(t.Ya?t.Ya.endTime:i,!1,0>e.g.fb()),t.ia&&t.ia.next().value;i=e.h.inaccurateManifestTolerance;var r=Math.max(n-i,0);e=0>e.g.fb();var a=null;return i&&(t.ia=t.stream.segmentIndex.Kb(r,!1,e),a=t.ia&&t.ia.next().value),a||(t.ia=t.stream.segmentIndex.Kb(n,!1,e),a=t.ia&&t.ia.next().value),a}function ac(t,n,i,r){var a,s,o,l,u,c,d,h,f,p,g,m,v,y,b,S;return N(function(T){switch(T.g){case 1:if(a=Pn,s=n.stream,o=n.ia,n.Qa=!0,E(T,2),2==r.ac())throw new It(1,1,1011);return _(T,lc(t,n,r),4);case 4:return na(t.m),t.A?T.return():(l="video/mp4"==s.mimeType||"audio/mp4"==s.mimeType,u=e.ReadableStream,t.h.lowLatencyMode&&t.l.isLowLatency&&u&&l&&("HLS"!=t.l.type||r.m)?(h=new Uint8Array(0),p=f=!1,m=function(e){var a,o,l;return N(function(u){switch(u.g){case 1:if(f)return u.return();if(p=!0,na(t.m),t.A)return u.return();if(E(u,2),h=sc(h,e),a=!1,o=0,(new ca).box("mdat",function(e){o=e.size+e.start,a=!0}).parse(h,!1,!0),!a){u.u(4);break}return l=h.subarray(0,o),h=h.subarray(o),_(u,cc(t,n,i,s,r,l,!0),5);case 5:n.W&&n.ia&&vu(n.W,r.startTime,!0);case 4:A(u,0);break;case 2:g=k(u),w(u)}})},_(T,fc(t,n,r,m),9)):(c=fc(t,n,r),_(T,c,7)));case 7:return d=T.h,na(t.m),t.A?T.return():(na(t.m),n.ec?(n.Qa=!1,mc(t,n,0),T.return()):_(T,cc(t,n,i,s,r,d),6));case 9:if(v=T.h,g)throw g;if(p){T.u(10);break}return f=!0,na(t.m),t.A?T.return():n.ec?(n.Qa=!1,mc(t,n,0),T.return()):_(T,cc(t,n,i,s,r,v),10);case 10:n.W&&n.ia&&vu(n.W,r.startTime,!0);case 6:if(na(t.m),t.A)return T.return();n.Ya=r,o.next(),n.Qa=!1,n.Yf=!1,y=t.g.ca.yb(),b=y[n.type],te(JSON.stringify(b)),n.ec||t.g.Sf(r,n.stream),mc(t,n,0),A(T,0);break;case 2:if(S=k(T),na(t.m,S),t.A)return T.return();if(n.Qa=!1,7001==S.code)n.Qa=!1,vc(n),mc(t,n,0),T.u(0);else if(n.type==a.ta&&t.h.ignoreTextStreamFailures)t.i.delete(a.ta),T.u(0);else{if(3017!=S.code)return n.yd=!0,1==S.category&&n.W&&Eu(n.W,r),S.severity=2,_(T,bc(t,n,S),0);oc(t,n,S),T.u(0)}}})}function sc(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function oc(e,t,n){if(!Array.from(e.i.values()).some(function(e){return e!=t&&e.Yf})){if(e.g.disableStream(t.stream,e.h.maxDisabledTime))return;var i=Math.round(100*e.B);if(20<i)e.B-=.2;else{if(!(4<i))return t.yd=!0,e.A=!0,void e.g.onError(n);e.B-=.04}t.Yf=!0}mc(e,t,4)}function lc(e,t,n){var i,r,a,s,o,l,u,c,d,h,f,p;return N(function(g){switch(g.g){case 1:if(i=Pn,r=[],a=Math.max(0,Math.max(n.appendWindowStart,e.N)-.1),s=Math.min(n.appendWindowEnd,e.L)+.01,o=zn(n.codecs||t.stream.codecs),l=Kn(n.mimeType||t.stream.mimeType),u=n.timestampOffset,u==t.qe&&a==t.oe&&s==t.ne&&o==t.Lf&&l==t.Mf){g.u(2);break}if(c=t.Lf&&t.Mf&&Rl(e.g.ca,t.type,l,o),!c){g.u(3);break}if(d=null,t.type===i.ga?d=e.i.get(i.X):t.type===i.X&&(d=e.i.get(i.ga)),!d){g.u(3);break}return _(g,yc(d).catch(function(){}),5);case 5:d.Kc=null,Qu(e,d);case 3:return _(g,uc(e,t,u,a,s,n,o,l),2);case 2:return Xs(n.$,t.Kc)||(t.Kc=n.$,n.l&&n.$&&(h=fc(e,t,n.$),f=function(){var r,a,s,o,l,u,c;return N(function(d){switch(d.g){case 1:return E(d,2),_(d,h,4);case 4:return r=d.h,na(e.m),a=null,s=new Map,o={projection:null,hfov:null},l=new ca,l.box("moov",da).box("trak",da).box("mdia",da).S("mdhd",function(e){a=vo(e.reader,e.version).timescale}).box("hdlr",function(e){switch(e=e.reader,e.skip(8),e.tc()){case"soun":s.set(i.X,a);break;case"vide":s.set(i.ga,a)}a=null}).box("minf",da).box("stbl",da).S("stsd",ha).box("encv",fa).box("avc1",fa).box("avc3",fa).box("hev1",fa).box("hvc1",fa).box("dvav",fa).box("dva1",fa).box("dvh1",fa).box("dvhe",fa).box("vexu",da).box("proj",da).S("prji",function(e){e=e.reader.tc(),o.projection=e}).box("hfov",function(e){e=e.reader.P()/1e3,o.hfov=e}).parse(r),Tc(e,o),s.has(t.type)?n.$.timescale=s.get(t.type):null!=a&&(n.$.timescale=a),u=t.stream.closedCaptions&&0<t.stream.closedCaptions.size,_(d,e.g.yg(t.type,r),5);case 5:return _(d,dl(e.g.ca,t.type,r,null,t.stream,u),6);case 6:A(d,0);break;case 2:throw c=k(d),t.Kc=null,c}})},e.g.Hi(n.startTime,n.$),r.push(f()))),e.l.sequenceMode&&(p=t.Ya?t.Ya.i:null,n.i!=p&&r.push(ml(e.g.ca,t.type,n.startTime))),_(g,Promise.all(r),0)}})}function uc(e,t,n,i,r,a,s,o){var l,u,c,d;return N(function(h){if(1==h.g)return l=Pn,u=new Map,e.j.audio&&u.set(l.X,e.j.audio),e.j.video&&u.set(l.ga,e.j.video),E(h,2),t.oe=i,t.ne=r,s&&(t.Lf=s),o&&(t.Mf=o),t.qe=n,c=e.l.sequenceMode||"HLS"==e.l.type,_(h,gl(e.g.ca,t.type,n,i,r,c,a.mimeType||t.stream.mimeType,a.codecs||t.stream.codecs,u),4);if(2!=h.g)return A(h,0);throw d=k(h),t.oe=null,t.ne=null,t.Lf=null,t.Mf=null,t.qe=null,d})}function cc(e,t,n,i,r,a,s){var o,l,u,c,d,h,f,p,g;return s=void 0!==s&&s,N(function(m){switch(m.g){case 1:return o=i.closedCaptions&&0<i.closedCaptions.size,u=null!=i.emsgSchemeIdUris&&0<i.emsgSchemeIdUris.length||e.h.dispatchAllEmsgBoxes,c=e.h.parsePrftBox&&!e.F,d="video/mp4"==i.mimeType||"audio/mp4"==i.mimeType,h=null,r.$&&(h=r.$.timescale),f=d&&h&&"video"===i.type&&"DASH"==e.l.type&&e.h.shouldFixTimestampOffset,(u||c||f)&&(l=new ca),u&&l.S("emsg",function(t){var n=i.emsgSchemeIdUris;if(0===t.version)var a=t.reader.tc(),s=t.reader.tc(),o=t.reader.P(),l=t.reader.P(),u=t.reader.P(),c=t.reader.P(),d=r.startTime+l/o;else o=t.reader.P(),d=t.reader.Qc()/o+r.timestampOffset,l=d-r.startTime,u=t.reader.P(),c=t.reader.P(),a=t.reader.tc(),s=t.reader.tc();t=t.reader.rb(t.reader.getLength()-t.reader.ua()),(n&&n.includes(a)||e.h.dispatchAllEmsgBoxes)&&("urn:mpeg:dash:event:2012"==a?e.g.Ii():(n=d+u/o,o=(new Map).set("detail",{startTime:d,endTime:n,schemeIdUri:a,value:s,timescale:o,presentationTimeDelta:l,eventDuration:u,id:c,messageData:t}),o=new Nr("emsg",o),o.cancelable=!0,e.g.onEvent(o),o.defaultPrevented||"https://aomedia.org/emsg/ID3"!=a&&"https://developer.apple.com/streaming/emsg-id3"!=a||(a=fo(t),!a.length)||e.g.onMetadata([{cueTime:d,data:t,frames:a,dts:d,pts:d}],0,n)))}),c&&l.S("prft",function(t){if(!e.F&&r.$.timescale){var n=t.reader,i=t.version;n.P(),t=n.P();var a=n.P();t=1e3*t+a/Math.pow(2,32)*1e3,0===i?n=n.P():(i=n.P(),n=n.P(),n=i*Math.pow(2,32)+n),t=new Date(new Date(Date.UTC(1900,0,1,0,0,0)).getTime()+t).getTime(),n=(new Map).set("detail",{wallClockTime:t,programStartDate:new Date(t-n/r.$.timescale*1e3)}),n=new Nr("prft",n),e.g.onEvent(n),e.F=!0}}),f&&l.box("moof",da).box("traf",da).S("tfdt",function(n){var i,a,s,o,l,u;return N(function(c){return i=mo(n.reader,n.version),a=i.baseMediaDecodeTime,a?(s=-a/h,o=Number(t.qe)||0,o<s?(l=t.oe,u=t.ne,_(c,uc(e,t,s,l,u,r),0)):c.u(0)):c.return()})}),(u||c||f)&&l.parse(a,!1,s),_(m,dc(e,t,n),2);case 2:return na(e.m),p=t.Nd,t.Nd=!1,g=t.wg,t.wg=!1,_(m,e.g.yg(t.type,a),3);case 3:return _(m,dl(e.g.ca,t.type,a,r,i,o,p,g,s),4);case 4:na(e.m),w(m)}})}function dc(e,t,n){var i,r,a,s;return N(function(o){if(1==o.g)return i=Math.max(e.h.bufferBehind,e.l.presentationTimeline.g),r=sl(e.g.ca,t.type),null==r?o.return():(a=n-r,s=a-i,s<=e.h.evictionGoal?o.return():_(o,e.g.ca.remove(t.type,r,r+s),2));na(e.m),w(o)})}function hc(e){return e&&e.type==Ln&&("application/cea-608"==e.stream.mimeType||"application/cea-708"==e.stream.mimeType)}function fc(e,t,n,i){var r,a,s,o,l;return N(function(u){switch(u.g){case 1:if(r=n.vd())return u.return(r);if(a=null,t.W){var c=t.W,d=c.h;n instanceof Ys&&(d=c.j),d.has(n)?(c=d.get(n),i&&(c.ig=i),a=c.Be):a=null}return a||(a=pc(n,t.stream,i||null,e.h.retryParameters,e.g.Nb)),s=0,t.ia&&(s=t.ia.h),t.kb=a,_(u,a.promise,2);case 2:if(o=u.h,t.kb=null,l=o.data,!n.aesKey){u.u(3);break}return _(u,Bu(l,n.aesKey,s),4);case 4:l=u.h;case 3:return u.return(l)}})}function pc(e,t,n,i,r){var a=e instanceof Qs?e:void 0,s=a?1:0;return e=Vu(e.M(),e.Ha,e.sa,i,n),e.contentType=t.type,r.request(Zr,e,{type:s,stream:t,segment:a})}function gc(e,t,n,i){var r,a;return N(function(s){return 1==s.g?(t.ec=!1,t.Oe=!1,t.ee=0,t.nd=!0,t.Ya=null,t.ia=null,t.W&&!e.o.has(t.stream)&&Su(t.W),i?(r=e.g.he(),a=e.g.ca.getDuration(),_(s,e.g.ca.remove(t.type,r+i,a),3)):_(s,pl(e.g.ca,t.type),4)):3!=s.g?(na(e.m),n?_(s,e.g.ca.flush(t.type),3):s.u(3)):(na(e.m),t.nd=!1,t.endOfStream=!1,t.Qa||t.ub||mc(e,t,0),void w(s))})}function mc(e,t,n){var i=t.type;(i!=Ln||e.i.has(i))&&(t.ub=new Nt(function(){var n;return N(function(i){return 1==i.g?(E(i,2),_(i,nc(e,t),4)):2!=i.g?A(i,0):(n=k(i),e.g&&e.g.onError(n),void w(i))})}).Y(n))}function vc(e){null!=e.ub&&(e.ub.stop(),e.ub=null)}function yc(e){return N(function(t){return e.kb?_(t,e.kb.abort(),0):t.u(0)})}function bc(e,t,n){var i;return N(function(r){if(1==r.g)return _(r,Ar(e.I),2);na(e.m),1===n.category&&(i=0===e.h.maxDisabledTime&&1011==n.code?1:e.h.maxDisabledTime,n.handled=e.g.disableStream(t.stream,i),n.handled&&(n.severity=1)),n.handled&&1011==n.code||e.g.onError(n),n.handled||e.h.failureCallback(n),w(r)})}function Sc(e){var t,n,i,r,a,s;return N(function(o){return 1==o.g?(t=Date.now()/1e3,n=e.h.minTimeBetweenRecoveries,!e.h.allowMediaSourceRecoveries||t-e.K<n?o.return(!1):(e.K=t,i=Pn,(r=e.i.get(i.X))&&(r.Kc=null,Qu(e,r),yc(r).catch(function(){})),(a=e.i.get(i.ga))&&(a.Kc=null,Qu(e,a),yc(a).catch(function(){})),s=new Map,e.j.audio&&s.set(i.X,e.j.audio),e.j.video&&s.set(i.ga,e.j.video),_(o,Il(e.g.ca,s),2))):o.return(!0)})}function Tc(e,t){if(e.G.projection!=t.projection||e.G.hfov!=t.hfov){if(null!=t.projection||null!=t.hfov){var n=(new Map).set("detail",t);n=new Nr("spatialvideoinfo",n)}else n=new Nr("nospatialvideoinfo");n.cancelable=!0,e.g.onEvent(n),e.G=t}}function _c(){}function wc(e,t,n,i,r){var a,s=r in i,o=s?n.constructor==Object&&0==Object.keys(i).length:n.constructor==Object&&0==Object.keys(n).length,l=s||o,u=!0;for(a in t){var c=r+"."+a,d=s?i[r]:n[a];l||a in n?void 0===t[a]?void 0===d||l?delete e[a]:e[a]=yi(d):o?e[a]=t[a]:d.constructor==Object&&t[a]&&t[a].constructor==Object?(e[a]||(e[a]=yi(d)),c=wc(e[a],t[a],d,i,c),u=u&&c):typeof t[a]!=typeof d||null==t[a]||"function"!=typeof t[a]&&t[a].constructor!=d.constructor?(Q("Invalid config, wrong type for "+c),u=!1):("function"==typeof n[a]&&n[a].length!=t[a].length&&Z("Unexpected number of arguments for "+c),e[a]=t[a]):(Q("Invalid config, unrecognized key "+c),u=!1)}return u}function Ec(e,t){for(var n={},i=n,r=0,a=0;;){if(r=e.indexOf(".",r),0>r)break;0!=r&&"\\"==e[r-1]||(a=e.substring(a,r).replace(/\\\./g,"."),i[a]={},i=i[a],a=r+1),r+=1}return i[e.substring(a).replace(/\\\./g,".")]=t,n}function xc(e,t){return e&&t}function Ac(e,t){function n(e){for(var t=c(Object.keys(e)),i=t.next();!i.done;i=t.next())i=i.value,a(e[i])&&0===Object.keys(e[i]).length?delete e[i]:r(e[i])?delete e[i]:"function"==typeof e[i]?delete e[i]:a(e[i])&&(n(e[i]),0===Object.keys(e[i]).length&&delete e[i])}function i(e,t){return Object.keys(e).reduce(function(n,s){var o=e[s];return t.hasOwnProperty(s)?a(o)&&a(t[s])?(o=i(o,t[s]),(0<Object.keys(o).length||!a(o))&&(n[s]=o)):r(o)&&r(t[s])||Number.isNaN(o)&&Number.isNaN(t[s])||o!==t[s]&&(n[s]=o):n[s]=o,n},{})}function r(e){return Array.isArray(e)&&0===e.length}function a(e){return e&&"object"===typeof e&&!Array.isArray(e)}return e=i(e,t),n(e),e}function kc(){}function Ic(e){return e=pn(e),new ht(e).Gb}function Cc(e,t,n){function i(e){Ae(a).setUint32(s,e.byteLength,!0),s+=4,a.set(Ee(e),s),s+=e.byteLength}if(!n||!n.byteLength)throw new It(2,6,6015);var r;r="string"==typeof t?mn(t,!0):t,e=pn(e),e=mn(e,!0);var a=new Uint8Array(12+e.byteLength+r.byteLength+n.byteLength),s=0;return i(e),i(r),i(n),a}function Rc(e,t,n){return"skd"!==t?e:(t=n.serverCertificate,n=pn(e).split("skd://").pop(),Cc(e,n,t))}function Mc(e,t){2===e&&(t.headers["Content-Type"]="application/octet-stream")}function Dc(){}function Lc(){var e=1/0;navigator.connection&&navigator.connection.saveData&&(e=360);var t={retryParameters:kr(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,persistentSessionOnlinePlayback:!1,persistentSessionsMetadata:[],initDataTransform:function(e,t,n){return on()&&"skd"==t&&(t=n.serverCertificate,n=Ic(e),e=Cc(e,n,t)),e},logLicenseExchange:!1,updateExpirationTime:1,preferredKeySystems:[],keySystemsMapping:{},parseInbandPsshEnabled:jt(),minHdcpVersion:"",ignoreDuplicateInitData:!zt()};(jt()||Qt())&&t.preferredKeySystems.push("com.microsoft.playready");var n="reload",i=!1;zt()||Ht()||an("Tizen 4")||an("Tizen 5")||an("Tizen 6")||$t()||Kt()&&53===qt()||Kt()&&68===qt()||!(!Wt()||Wt()&&nn()||Wt()&&an("Fuchsia"))||tn()&&Vt()||(n="smooth",i=!0),i={retryParameters:kr(),availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,disableThumbnails:!1,defaultPresentationDelay:0,segmentRelativeVttTiming:!1,raiseFatalErrorOnManifestUpdateRequestFailure:!1,continueLoadingWhenPaused:!0,dash:{clockSyncUri:"",ignoreDrmInfo:!1,disableXlinkProcessing:!1,xlinkFailGracefully:!1,ignoreMinBufferTime:!1,autoCorrectDrift:!0,initialSegmentLimit:1e3,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1,ignoreMaxSegmentDuration:!1,keySystemsByURI:{"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95":"com.microsoft.playready"},manifestPreprocessor:Nc,manifestPreprocessorTXml:Uc,sequenceMode:!1,enableAudioGroups:!1,multiTypeVariantsAllowed:i,useStreamOnceInPeriodFlattening:!1,updatePeriod:-1,enableFastSwitching:!0},hls:{ignoreTextStreamFailures:!1,ignoreImageStreamFailures:!1,defaultAudioCodec:"mp4a.40.2",defaultVideoCodec:"avc1.42E01E",ignoreManifestProgramDateTime:!1,ignoreManifestProgramDateTimeForTypes:[],mediaPlaylistFullMimeType:'video/mp2t; codecs="avc1.42E01E, mp4a.40.2"',useSafariBehaviorForLive:!0,liveSegmentsDelay:3,sequenceMode:!(Ht()||zt()||$t()||Qt()),ignoreManifestTimestampsInSegmentsMode:!1,disableCodecGuessing:!1,disableClosedCaptionsDetection:!1,allowLowLatencyByteRangeOptimization:!0},mss:{manifestPreprocessor:Nc,manifestPreprocessorTXml:Uc,sequenceMode:!1,keySystemsBySystemId:{"9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","79f0049a-4098-8642-ab92-e65be0885f95":"com.microsoft.playready"}}};var r={retryParameters:kr(),failureCallback:function(e){return xc([e])},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,evictionGoal:1,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,gapDetectionThreshold:.5,gapJumpTimerTime:.25,durationBackoff:1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsForFairPlay:!0,inaccurateManifestTolerance:2,lowLatencyMode:!1,autoLowLatencyMode:!1,forceHTTP:!1,forceHTTPS:!1,preferNativeHls:!1,updateIntervalSeconds:1,dispatchAllEmsgBoxes:!1,observeQualityChanges:!1,maxDisabledTime:30,parsePrftBox:!1,segmentPrefetchLimit:0,prefetchAudioLanguages:[],disableAudioPrefetch:!1,disableTextPrefetch:!1,disableVideoPrefetch:!1,liveSync:{enabled:!1,targetLatency:.5,targetLatencyTolerance:.5,maxPlaybackRate:1.1,minPlaybackRate:.95,panicMode:!1,panicThreshold:60,dynamicTargetLatency:{enabled:!1,stabilityThreshold:60,rebufferIncrement:.5,maxAttempts:10,maxLatency:4,minLatency:1}},allowMediaSourceRecoveries:!0,minTimeBetweenRecoveries:5,vodDynamicPlaybackRate:!1,vodDynamicPlaybackRateLowBufferRate:.95,vodDynamicPlaybackRateBufferRatio:.5,infiniteLiveStreamDuration:!1,preloadNextUrlWindow:30,loadTimeout:30,clearDecodingCache:Qt()||Xt(),dontChooseCodecs:!1,shouldFixTimestampOffset:Kt()||Gt()};(Kt()||Gt()||Wt()||Zt())&&(r.stallSkip=0);var a={trackSelectionCallback:function(e){return N(function(t){return t.return(e)})},downloadSizeCallback:function(e){var t;return N(function(n){return 1==n.g?navigator.storage&&navigator.storage.estimate?_(n,navigator.storage.estimate(),3):n.return(!0):(t=n.h,n.return(t.usage+e<.95*t.quota))})},progressCallback:function(e,t){return xc([e,t])},usePersistentLicense:!0,numberOfParallelDownloads:5};e={enabled:!0,useNetworkInformation:!0,defaultBandwidthEstimate:1e6,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:e,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0,minChannelsCount:0,maxChannelsCount:1/0},advanced:{minTotalBytes:128e3,minBytes:16e3,fastHalfLife:2,slowHalfLife:5},restrictToElementSize:!1,restrictToScreenSize:!1,ignoreDevicePixelRatio:!1,clearBufferSwitch:!1,safeMarginSwitch:0,cacheLoadThreshold:20,minTimeToSwitch:Yt()?.5:0},n={codecSwitchingStrategy:n,addExtraFeaturesToSourceBuffer:function(e){return xc([e],"")},forceTransmux:!1,insertFakeEncryptionInInit:!0,modifyCueCallback:function(e,t){return xc([e,t])}};var s=!1,o=!1,l=!0;rn()&&(o=s=!0,l=!1);var u={drm:t,manifest:i,streaming:r,mediaSource:n,offline:a,abrFactory:function(){return new tr},abr:e,autoShowText:3,preferredAudioLanguage:"",preferredAudioLabel:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,preferredVideoHdrLevel:"AUTO",preferredVideoLayout:"",preferredVideoLabel:"",preferredVideoCodecs:[],preferredAudioCodecs:[],preferForcedSubs:!1,preferSpatialAudio:!1,preferredDecodingAttributes:[],restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0,minChannelsCount:0,maxChannelsCount:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayer:{captionsUpdatePeriod:.25},textDisplayFactory:function(){return null},cmcd:{enabled:!1,sessionId:"",contentId:"",rtpSafetyFactor:5,useHeaders:!1,includeKeys:[]},cmsd:{enabled:!0,applyMaximumSuggestedBitrate:!0,estimatedThroughputWeightRatio:.5},lcevc:{enabled:!1,dynamicPerformanceScaling:!0,logLevel:0,drawLogo:!1},ads:{customPlayheadTracker:s,skipPlayDetection:o,supportsMultipleMediaElements:l}};return a.trackSelectionCallback=function(e){return N(function(t){return t.return(Oc(e,u.preferredAudioLanguage,u.preferredVideoHdrLevel))})},u}function Pc(e,t,n){var i={".drm.keySystemsMapping":"",".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",sessionType:"",serverCertificate:new Uint8Array(0),serverCertificateUri:"",individualizationServer:"",headers:{}}};return wc(e,t,n||Lc(),i,"")}function Oc(t,n,i){var r=i;"AUTO"==r&&(r=e.matchMedia("(color-gamut: p3)").matches?"PQ":"SDR");var a=t.filter(function(e){return!("variant"!=e.type||e.hdr&&e.hdr!=r)});i=[];var s=mi(n,a.map(function(e){return e.language}));s&&(i=a.filter(function(e){return hi(e.language)==s})),0==i.length&&(i=a.filter(function(e){return e.primary})),0==i.length&&(a.map(function(e){return e.language}),i=a);var o=i.filter(function(e){return e.height&&480>=e.height});for(o.length&&(o.sort(function(e,t){return t.height-e.height}),i=o.filter(function(e){return e.height==o[0].height})),n=[],i.length&&(a=Math.floor(i.length/2),i.sort(function(e,t){return e.bandwidth-t.bandwidth}),n.push(i[a])),t=c(t),i=t.next();!i.done;i=t.next())i=i.value,i.type!=Ln&&"image"!=i.type||n.push(i);return n}function Nc(e){return xc([e],e)}function Uc(e){return xc([e],e)}function Fc(e,t,n,i){Br.call(this),this.L=e,this.U=t,this.xa=i.networkingEngine,this.A=n,this.o=null,this.ra=0,this.Fa=i.Dc,this.C=i.Ci,this.bb=i.Di,this.g=i.config,this.j=this.F=this.h=null,this.ea=!1,this.G=i.Mi,this.pa=!1,this.l=null,this.da=!1,this.i=this.B=null,this.aa=!1,this.K=new Map,this.qa=!1,this.za=i.Li,this.Z=new pu,this.m=new Ir,this.N=null,this.s=!1,this.Da=i.Fh,this.fa=null,this.Ea=i.Eh,this.R=!1,this.I=[],this.H=[]}function Bc(e,t,n){(e=t?e.H:e.I)?e.push(n):n()}function Vc(e){if(e.H)for(var t=c(e.H),n=t.next();!n.done;n=t.next())n=n.value,n();e.H=null}function jc(e,t){if(e.N=t,e.R=!0,e.I){t=c(e.I);for(var n=t.next();!n.done;n=t.next())n=n.value,n()}e.I=null}function Gc(e){return e.aa=!0,e.i}function Hc(e){return e.ea=!0,e.j}function zc(e){return e.pa=!0,e.G}function Kc(e){return e.da=!0,e.l}function $c(e){return e.qa=!0,e.K}function Wc(e){if(e.s)throw new It(2,7,7003)}function qc(e,t){e.dispatchEvent(new Nr("onstatechange",(new Map).set("state",t)))}function Yc(e){var t,n,i,r,a;return N(function(s){if(1==s.g)return qc(e,"manifest-parser"),e.j||(e.F=Hs(e.L,e.U),e.j=e.F(),e.j.configure(e.g.manifest)),t=Date.now()/1e3,qc(e,"manifest"),e.h?s.u(2):(n=e,_(s,e.j.start(e.L,e.bb),3));if(2!=s.g&&(n.h=s.h),i=new Nr("manifestparsed",void 0),e.dispatchEvent(i),0==e.h.variants.length)throw new It(2,4,4036);Zc(e.h),r=Date.now()/1e3,a=r-t,e.Z.H=a,w(s)})}function Xc(e){var t,n,i,r,a;return N(function(s){switch(s.g){case 1:qc(e,"drm-engine"),e.ra=Date.now()/1e3,e.l=e.Fa(),e.C.g=e.l,e.l.configure(e.g.drm);var o=e.C;if(t=xi(e.h.variants,o.h.restrictions,o.i),!t){s.u(2);break}return n=new Nr("trackschanged",void 0),_(s,Promise.resolve(),3);case 3:Wc(e),e.dispatchEvent(n);case 2:return i=Wi(e.h.variants),_(s,ns(e.l,i,e.h.offlineSessionIds),4);case 4:return Wc(e),_(s,Us(e.C,e.h),5);case 5:if(r=s.h,!r){s.u(0);break}return a=new Nr("trackschanged",void 0),_(s,Promise.resolve(),7);case 7:e.dispatchEvent(a),w(s)}})}function Qc(e,t,n){var i,r,a,s,o;N(function(l){if(1==l.g)return i=e.g.streaming.segmentPrefetchLimit||2,r=new gu(i,t,function(t,n,i){return pc(t,n,i||null,e.g.streaming.retryParameters,e.xa)},!1),e.K.set(t.id,r),_(l,t.createSegmentIndex(),2);a=e.A||0,(o=(s=t.segmentIndex.Kb(a))?s.current():null)||(o=t.segmentIndex.get(0)),o&&(n?o.$&&yu(r,o.$):vu(r,o.startTime)),w(l)})}function Zc(e){function t(e){return e.video&&e.audio||e.video&&e.video.codecs.includes(",")}e.variants.some(t)&&(e.variants=e.variants.filter(t))}function Jc(e,t){Br.call(this);var n=this;this.i=e,this.l=t,this.g=new Map,this.m=[{Ac:null,zc:nd,pc:function(e,t){return ed(n,"enter",e,t)}},{Ac:td,zc:nd,pc:function(e,t){return ed(n,"enter",e,t)}},{Ac:id,zc:nd,pc:function(e,t){return ed(n,"enter",e,t)}},{Ac:nd,zc:td,pc:function(e,t){return ed(n,"exit",e,t)}},{Ac:nd,zc:id,pc:function(e,t){return ed(n,"exit",e,t)}},{Ac:td,zc:id,pc:function(e,t){return ed(n,"skip",e,t)}},{Ac:id,zc:td,pc:function(e,t){return ed(n,"skip",e,t)}}],this.h=new ae,this.h.D(this.i,"regionremove",function(e){n.g.delete(e.region)})}function ed(e,t,n,i){t=new Nr(t,new Map([["region",n],["seeking",i]])),e.dispatchEvent(t)}Gl.prototype.release=function(){this.h&&(this.h.release(),this.h=null),null!=this.i&&(this.i.release(),this.i=null),this.m=function(){},this.g=null},Wl.prototype.release=function(){this.g&&(this.g.stop(),this.g=null),this.h=null},i=Yl.prototype,i.$e=function(){function e(){if(null==t.g||0==t.g&&1/0!=t.h.duration)t.j=!0;else{var e=t.h.currentTime,n=t.g;0>t.g&&(n=Math.max(0,e+t.g)),e!=n?(t.i.ha(t.h,"seeking",function(){t.j=!0}),t.h.currentTime=n):t.j=!0}}var t=this;Vl(this.h,HTMLMediaElement.HAVE_CURRENT_DATA,this.i,function(){e()})},i.release=function(){this.i&&(this.i.release(),this.i=null),this.h=null},i.af=function(e){this.g=this.j?this.g:e},i.$d=function(){return(this.j?this.h.currentTime:this.g)||0},i.vg=function(){return 0},i.ug=function(){return 0},i.Zg=function(){},i=Xl.prototype,i.$e=function(){this.m.Sa(.25)},i.release=function(){this.h&&(this.h.release(),this.h=null),this.j&&(this.j.release(),this.j=null),this.m&&(this.m.stop(),this.m=null),this.i=this.h=this.g=this.l=null,this.A=function(){}},i.af=function(e){zl(this.h,e)},i.$d=function(){var e=Hl(this.h);return 0<this.i.readyState&&!this.i.paused?Jl(this,e):e},i.vg=function(){return this.o?this.o.o:0},i.ug=function(){return this.j.C},i.Zg=function(){this.j.Sf()},i=tu.prototype,i.getNumReferences=function(){return this.O.length},i.getNumEvicted=function(){return this.i},i.release=function(){this.m||(this.O=[],this.l&&this.l.stop(),this.l=null)},i.Fi=function(){this.m=!0},i.Jb=function(e){for(var t=c(this.O),n=t.next();!n.done;n=t.next())e(n.value)},i.find=function(e){for(var t=this.O.length-1,n=t;0<=n;--n){var i=this.O[n],r=n<t?this.O[n+1].startTime:i.endTime;if(e>=i.startTime&&e<r)return n+this.i}return this.O.length&&e<this.O[0].startTime?this.i:null},i.get=function(e){return 0==this.O.length?null:(e-=this.i,0>e||e>=this.O.length?null:this.O[e])},i.offset=function(e){if(!this.m)for(var t=c(this.O),n=t.next();!n.done;n=t.next())n.value.offset(e)},i.ue=function(e){if(!this.m&&e.length){var t=Math.round(1e3*e[0].startTime)/1e3;this.O=this.O.filter(function(e){return Math.round(1e3*e.startTime)/1e3<t}),this.O.push.apply(this.O,d(e))}},i.Id=function(e,t){var n=this;e=e.filter(function(e){return e.endTime>t&&(0==n.O.length||e.endTime>n.O[0].startTime)}),this.ue(e),this.Oa(t)},i.Oa=function(e){if(!this.m){var t=this.O.length;this.O=this.O.filter(function(t){return t.endTime>e}),this.i+=t-this.O.length}},i.Ec=function(e,t,n){if(n=void 0!==n&&n,!this.m){for(;this.O.length;){if(!(this.O[this.O.length-1].startTime>=t))break;this.O.pop()}for(;this.O.length;){if(!(this.O[0].endTime<=e))break;this.O.shift(),n||this.i++}0!=this.O.length&&(e=this.O[this.O.length-1],t=new Qs(e.startTime,t,e.C,e.Ha,e.sa,e.$,e.timestampOffset,e.appendWindowStart,e.appendWindowEnd,e.g,e.tilesLayout,e.A,e.h,e.status,e.aesKey),t.mimeType=e.mimeType,t.codecs=e.codecs,t.i=e.i,this.O[this.O.length-1]=t)}},i.Me=function(e,t){var n=this;this.m||(this.l&&this.l.stop(),this.l=new Ut(function(){var e=t();e?n.O.push.apply(n.O,d(e)):(n.l.stop(),n.l=null)}),this.l.Sa(e))},tu.prototype[Symbol.iterator]=function(){return this.Kb(0)},tu.prototype.Kb=function(e,t,n){t=void 0!==t&&t,n=void 0!==n&&n;var i=this.find(e);if(null==i)return null;var r=this.get(i);n?i++:i--;var a=-1;if(r&&0<r.g.length)for(var s=r.g.length-1;0<=s;--s){var o=r.g[s];if(e>=o.startTime&&e<o.endTime){if(!t){for(;s&&!o.l;)s--,o=r.g[s];if(!o.l)return Q("No independent partial segment found!"),null}n?i--:i++,a=s-1;break}}return new iu(this,i,a,n)},z("shaka.media.SegmentIndex",tu),tu.forSingleSegment=nu,tu.prototype.getIteratorForTime=tu.prototype.Kb,tu.prototype.updateEvery=tu.prototype.Me,tu.prototype.fit=tu.prototype.Ec,tu.prototype.evict=tu.prototype.Oa,tu.prototype.mergeAndEvict=tu.prototype.Id,tu.prototype.offset=tu.prototype.offset,tu.prototype.get=tu.prototype.get,tu.prototype.find=tu.prototype.find,tu.prototype.markImmutable=tu.prototype.Fi,tu.prototype.release=tu.prototype.release,tu.prototype.getNumEvicted=tu.prototype.getNumEvicted,tu.prototype.getNumReferences=tu.prototype.getNumReferences,iu.prototype.Uc=function(e){this.reverse=e},iu.prototype.Lh=function(){return this.h},iu.prototype.current=function(){var e=this.i.get(this.h);return e&&0<e.g.length&&e.o&&this.g>=e.g.length&&(this.h++,this.g=0,e=this.i.get(this.h)),e&&0<e.g.length?e.g[this.g]:e},iu.prototype.next=function(){var e=this.i.get(this.h);return this.reverse?e&&0<e.g.length?(this.g--,0>this.g&&(this.h--,this.g=(e=this.i.get(this.h))&&0<e.g.length?e.g.length-1:0)):(this.h--,this.g=0):e&&0<e.g.length?(this.g++,e.o&&this.g==e.g.length&&(this.h++,this.g=0)):(this.h++,this.g=0),e=this.current(),{value:e,done:!e}},z("shaka.media.SegmentIterator",iu),iu.prototype.next=iu.prototype.next,iu.prototype.current=iu.prototype.current,iu.prototype.currentPosition=iu.prototype.Lh,iu.prototype.setReverse=iu.prototype.Uc,y(ru,tu),i=ru.prototype,i.clone=function(){var e=new ru;return e.g=this.g.slice(),e},i.release=function(){for(var e=c(this.g),t=e.next();!t.done;t=e.next())t.value.release();this.g=[]},i.Jb=function(e){for(var t=c(this.g),n=t.next();!n.done;n=t.next())n.value.Jb(e)},i.find=function(e){for(var t=0,n=c(this.g),i=n.next();!i.done;i=n.next()){i=i.value;var r=i.find(e);if(null!=r)return r+t;t+=i.getNumEvicted()+i.getNumReferences()}return null},i.get=function(e){for(var t=0,n=c(this.g),i=n.next();!i.done;i=n.next()){i=i.value;var r=i.get(e-t);if(r)return r;r=i.getNumReferences(),t+=i.getNumEvicted()+r}return null},i.offset=function(){},i.ue=function(){},i.Oa=function(){},i.Id=function(){},i.Ec=function(){},i.Me=function(){},z("shaka.media.MetaSegmentIndex",ru),ru.prototype.updateEvery=ru.prototype.Me,ru.prototype.fit=ru.prototype.Ec,ru.prototype.mergeAndEvict=ru.prototype.Id,ru.prototype.evict=ru.prototype.Oa,ru.prototype.merge=ru.prototype.ue,ru.prototype.offset=ru.prototype.offset,ru.prototype.get=ru.prototype.get,ru.prototype.find=ru.prototype.find,ru.prototype.forEachTopLevelReference=ru.prototype.Jb,ru.prototype.release=ru.prototype.release,au.prototype.release=function(){this.set(this.nc()),this.h&&(this.h.stop(),this.h=null),this.g=null},au.prototype.set=function(e){this.i=e,su(this)},au.prototype.nc=function(){return this.g.nc()},ou.prototype.release=function(){this.i.stop();for(var e=c(this.g),t=e.next();!t.done;t=e.next())t.value.release();this.g.clear()},gu.prototype.Oa=function(e,t){t=void 0!==t&&t;for(var n=c(this.h.keys()),i=n.next();!i.done;i=n.next())i=i.value,e>i.endTime&&Eu(this,i);t&&Tu(this)},gu.prototype.Uc=function(e){this.o=e,this.g&&this.g.Uc(e)},xu.prototype.abort=function(){this.Be&&this.Be.abort()},y(ku,Br),ku.prototype.release=function(){this.g.clear(),this.h.stop(),Br.prototype.release.call(this)},y(Iu,Br),Iu.prototype.release=function(){this.g.clear(),Br.prototype.release.call(this)},Iu.prototype.j=function(e){for(var t=c(this.g.values()),n=t.next();!n.done;n=t.next()){n=n.value;var i=n.kf;e:{for(var r=n.Md,a=r.length-1;0<=a;a--){var s=r[a];if(s.position<=e){r=s.Lc;break e}}r=null}a=r&&!(i===r||i&&r&&i.bandwidth==r.bandwidth&&i.audioSamplingRate==r.audioSamplingRate&&i.codecs==r.codecs&&i.contentType==r.contentType&&i.frameRate==r.frameRate&&i.height==r.height&&i.mimeType==r.mimeType&&i.channelsCount==r.channelsCount&&i.pixelAspectRatio==r.pixelAspectRatio&&i.width==r.width),s=r&&i&&r.label&&i.label&&i.label!==r.label;var o=r&&i&&r.language&&i.language&&i.language!==r.language;i=r&&i&&r.roles&&i.roles&&!Fe(i.roles,r.roles),(s||o||i)&&Mu(this,e,r.contentType)&&(n.kf=r,i=new Nr("audiotrackchange",new Map([["quality",r],["position",e]])),this.dispatchEvent(i)),a&&Mu(this,e,r.contentType)&&(n.kf=r,JSON.stringify(r),n=new Nr("qualitychange",new Map([["quality",r],["position",e]])),this.dispatchEvent(n))}},i=ju.prototype,i.destroy=function(){return this.m.destroy()},i.configure=function(e){if(this.h=e,this.I=new xr({maxAttempts:Math.max(e.retryParameters.maxAttempts,2),baseDelay:e.retryParameters.baseDelay,backoffFactor:e.retryParameters.backoffFactor,fuzzFactor:e.retryParameters.fuzzFactor,timeout:0,stallTimeout:0,connectionTimeout:0},!0),e.disableAudioPrefetch){var t=this.i.get("audio");t&&t.W&&(Su(t.W),t.W=null),t=c(this.o.keys());for(var n=t.next();!n.done;n=t.next())n=n.value,Su(this.o.get(n)),this.o.delete(n)}for(e.disableTextPrefetch&&(t=this.i.get(Ln))&&t.W&&(Su(t.W),t.W=null),e.disableVideoPrefetch&&(t=this.i.get("video"))&&t.W&&(Su(t.W),t.W=null),t=c(this.i.keys()),n=t.next();!n.done;n=t.next())n=this.i.get(n.value),n.W?(_u(n.W,e.segmentPrefetchLimit),0<e.segmentPrefetchLimit||(Su(n.W),n.W=null)):0<e.segmentPrefetchLimit&&(n.W=ec(this,n.stream));e.disableAudioPrefetch||tc(this)},i.start=function(e){var t=this;return N(function(n){if(1==n.g)return _(n,Zu(t,e||new Map),2);na(t.m),t.C=!0,w(n)})},i.Nd=function(){if(this.g)for(var e=this.g.he(),t=c(this.i.keys()),n=t.next();!n.done;n=t.next()){var i=n.value;n=this.i.get(i);var r=this.g.ca;if(r.C?r=!1:i==Ln?(r=r.g,r=null!=r.g&&null!=r.h&&(e>=r.g&&e<r.h)):(r=ul(r,i),r=io(r,e)),!r){if(n.W&&(n.W.g=null),"audio"===n.type){r=c(this.o.values());for(var a=r.next();!a.done;a=r.next())a.value.g=null}n.ia=null,(null!=ol(this.g.ca,i)||n.Qa)&&Qu(this,n),n.kb&&(n.kb.abort(),n.kb=null),i===Ln&&(i=this.g.ca,i.H&&i.H.g()),n.Nd=!0}}},i.updateDuration=function(){var e=this.l.presentationTimeline.getDuration();1/0>e?this.g.ca.$a(e):this.g.ca.$a(this.h.infiniteLiveStreamDuration?1/0:Math.pow(2,32))},z("shaka.util.ConfigUtils",_c),_c.getDifferenceFromConfigObjects=Ac,_c.convertToConfigObject=Ec,_c.mergeConfigObjects=wc,z("shaka.util.FairPlayUtils",kc),kc.commonFairPlayResponse=function(e,t){if(2===e){try{var n=hn(t.data)}catch(e){return}e=!1,n=n.trim(),"<ckc>"===n.substr(0,5)&&"</ckc>"===n.substr(-6)&&(n=n.slice(5,-6),e=!0);try{var i=JSON.parse(n);i.ckc&&(n=i.ckc,e=!0),i.CkcMessage&&(n=i.CkcMessage,e=!0),i.License&&(n=i.License,e=!0)}catch(e){}e&&(t.data=we(wn(n)))}},kc.expressplayFairPlayRequest=function(e,t){Mc(e,t)},kc.conaxFairPlayRequest=function(e,t){Mc(e,t)},kc.ezdrmFairPlayRequest=function(e,t){Mc(e,t)},kc.verimatrixFairPlayRequest=function(e,t){2===e&&(e=Ee(t.body),e=_n(e),t.headers["Content-Type"]="application/x-www-form-urlencoded",t.body=gn("spc="+e))},kc.expressplayInitDataTransform=function(e,t,n){return Rc(e,t,n)},kc.conaxInitDataTransform=function(t,n,i){if("skd"!==n)return t;n=i.serverCertificate,i=pn(t).split("skd://").pop().split("?").shift(),i=e.atob(i);var r=new ArrayBuffer(2*i.length);r=xe(r);for(var a=0,s=i.length;a<s;a++)r[a]=i.charCodeAt(a);return Cc(t,r,n)},kc.ezdrmInitDataTransform=function(e,t,n){return"skd"!==t?e:(t=n.serverCertificate,n=pn(e).split(";").pop(),Cc(e,n,t))},kc.verimatrixInitDataTransform=function(e,t,n){return Rc(e,t,n)},kc.initDataTransform=Cc,kc.defaultGetContentId=Ic,kc.isFairPlaySupported=function(){var e;return N(function(t){return 1==t.g?(e={initDataTypes:["cenc","sinf","skd"],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42E01E"'}]},E(t,2),_(t,navigator.requestMediaKeySystemAccess("com.apple.fps",[e]),4)):2!=t.g?t.return(!0):(k(t),t.return(!1))})},z("shaka.util.PlayerConfiguration",Dc),Dc.mergeConfigObjects=Pc,Dc.createDefault=Lc,y(Fc,Br),i=Fc.prototype,i.getStartTime=function(){return this.A},i.Gc=function(){return this.L},i.Ef=function(){return this.h},i.getStats=function(){return this.Z},i.start=function(){var e=this;(function(){var t;N(function(n){switch(n.g){case 1:return _(n,Promise.resolve(),2);case 2:return E(n,3),_(n,Yc(e),5);case 5:return Wc(e),_(n,Xc(e),6);case 6:if(Wc(e),e.o||(e.o=new dr(e.g.preferredAudioLanguage,e.g.preferredVariantRole,e.g.preferredAudioChannelCount,e.g.preferredVideoHdrLevel,e.g.preferSpatialAudio,e.g.preferredVideoLayout,e.g.preferredAudioLabel,e.g.preferredVideoLabel,e.g.mediaSource.codecSwitchingStrategy,e.g.manifest.dash.enableAudioGroups)),e.Ea){var i=e.g.abrFactory;e.B=i,e.i=i(),e.i.configure(e.g.abr)}if(e.Da){i=e.h.presentationTimeline.V();var r=Wi(e.h.variants);r=e.o.create(r),e.i.configure(e.g.abr),e.i.setVariants(Array.from(r.values())),(r=e.i.chooseVariant(!0))&&(e.fa=r,r.video&&Qc(e,r.video,i),r.audio&&Qc(e,r.audio,i))}return _(n,void 0,7);case 7:Wc(e),e.m.resolve(),A(n,0);break;case 3:t=k(n),e.m.reject(t),w(n)}})})()},i.dispatchEvent=function(e){return this.N?this.N.dispatchEvent(e):Br.prototype.dispatchEvent.call(this,e)},i.onError=function(e){2===e.severity&&(this.m.reject(e),this.destroy());var t=(new Map).set("detail",e);t=new Nr("error",t),this.dispatchEvent(t),t.defaultPrevented&&(e.handled=!0)},i.configure=function(e,t){e=Ec(e,t),Pc(this.g,e)},i.getConfiguration=function(){return yi(this.g)},i.mj=function(){return this.m},i.destroy=function(){var e,t,n,i=this;return N(function(r){switch(r.g){case 1:if(i.s=!0,!i.j||i.ea){r.u(2);break}return _(r,i.j.stop(),2);case 2:if(!i.i||i.aa){r.u(4);break}return _(r,i.i.stop(),4);case 4:if(i.G&&!i.pa&&i.G.release(),!i.l||i.da){r.u(6);break}return _(r,i.l.destroy(),6);case 6:if(0<i.K.size&&!i.qa)for(e=c(i.K.values()),t=e.next();!t.done;t=e.next())n=t.value,Su(n);w(r)}})},z("shaka.media.PreloadManager",Fc),Fc.prototype.destroy=Fc.prototype.destroy,Fc.prototype.waitForFinish=Fc.prototype.mj,y(Jc,Br),Jc.prototype.release=function(){this.i=null,this.g.clear(),this.h.release(),this.h=null,Br.prototype.release.call(this)},Jc.prototype.j=function(e,t){if(!this.l||0!=e){this.l=!1;for(var n=c(this.i.g),i=n.next();!i.done;i=n.next()){i=i.value;var r=this.g.get(i),a=e<i.startTime?td:e>i.endTime?id:nd;this.g.set(i,a);for(var s=c(this.m),o=s.next();!o.done;o=s.next())o=o.value,o.Ac==r&&o.zc==a&&o.pc(i,t)}}};var td=1,nd=2,id=3;function rd(e,t,n){var i,r,a,s,o,l,u;return N(function(c){switch(c.g){case 1:var d=new ht(e).Pa.split("/").pop().split(".");return i=1==d.length?"":d.pop().toLowerCase(),(r=ad[i])?c.return(r):(a=0,s=Kr([e],n),E(c,2),s.method="HEAD",_(c,t.request(a,s).promise,4));case 4:o=c.h,r=o.headers["content-type"],A(c,3);break;case 2:if(l=k(c),!l||1002!=l.code&&1001!=l.code){c.u(3);break}return s.method="GET",_(c,t.request(a,s).promise,6);case 6:u=c.h,r=u.headers["content-type"];case 3:return c.return(r?r.toLowerCase().split(";").shift():"")}})}var ad={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mpd:"application/dash+xml",ism:"application/vnd.ms-sstr+xml",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav",sbv:"text/x-subviewer",srt:"text/srt",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml",lrc:"application/x-subtitle-lrc",ssa:"text/x-ssa",ass:"text/x-ssa"};function sd(e,t){if(e.lineBreak)return"\n";if(e.nestedCues.length)return e.nestedCues.map(function(t){return sd(t,e)}).join("");var n=[],i=700<=e.fontWeight,r="italic"==e.fontStyle,a=e.textDecoration.includes("underline");return i&&n.push(["b"]),r&&n.push(["i"]),a&&n.push(["u"]),r=e.color,""==r&&t&&(r=t.color),i="",(r=od(r))&&(i+="."+r),r=e.backgroundColor,""==r&&t&&(r=t.backgroundColor),(t=od(r))&&(i+=".bg_"+t),i&&n.push(["c",i]),n.reduceRight(function(e,t){var n=c(t);return t=n.next().value,n=n.next().value,"<"+t+(void 0===n?"":n)+">"+e+"</"+t+">"},e.payload)}function od(e){e=e.toLowerCase();var t=e.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i);switch(t?e="#"+(256|parseInt(t[1],10)).toString(16).slice(1)+(256|parseInt(t[2],10)).toString(16).slice(1)+(256|parseInt(t[3],10)).toString(16).slice(1):e.startsWith("#")&&7<e.length&&(e=e.slice(0,7)),e){case"white":case"#fff":case"#ffffff":return"white";case"lime":case"#0f0":case"#00ff00":return"lime";case"cyan":case"#0ff":case"#00ffff":return"cyan";case"red":case"#f00":case"#ff0000":return"red";case"yellow":case"#ff0":case"#ffff00":return"yellow";case"magenta":case"#f0f":case"#ff00ff":return"magenta";case"blue":case"#00f":case"#0000ff":return"blue";case"black":case"#000":case"#000000":return"black"}return null}function ld(e,t){var n=[];e=c(ud(e));for(var i=e.next();!i.done;i=e.next())if(i=i.value,i.isContainer)n.push.apply(n,d(ld(i.nestedCues,i)));else{var r=i.clone();r.nestedCues=[],r.payload=sd(i,t),n.push(r)}return n}function ud(e){var t=[],n={};e=c(e);for(var i=e.next();!i.done;n={Sd:n.Sd},i=e.next())n.Sd=i.value,t.some(function(e){return function(t){return je(e.Sd,t)}}(n))||t.push(n.Sd);return t}function cd(e){function t(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()}if(e.startTime>=e.endTime)return null;var n=new VTTCue(e.startTime,e.endTime,e.payload);n.id=t(e.startTime.toString())+t(e.endTime.toString())+t(e.payload),n.lineAlign=e.lineAlign,n.positionAlign=e.positionAlign,e.size&&(n.size=e.size);try{n.align=e.textAlign}catch(e){}return"center"==e.textAlign&&"center"!=n.align&&(n.align="middle"),"vertical-lr"==e.writingMode?n.vertical="lr":"vertical-rl"==e.writingMode&&(n.vertical="rl"),1==e.lineInterpretation&&(n.snapToLines=!1),null!=e.line&&(n.line=e.line),null!=e.position&&(n.position=e.position),n}function dd(e,t){this.g=null;for(var n=c(Array.from(e.textTracks)),i=n.next();!i.done;i=n.next())i=i.value,"metadata"!==i.kind&&"chapters"!==i.kind&&(i.mode="disabled",i.label==t&&(this.g=i));this.g||(this.g=e.addTextTrack("subtitles",t)),this.g.mode="hidden"}function hd(e,t){var n=e.mode;e.mode="showing"==n?"showing":"hidden";for(var i=c(Array.from(e.cues)),r=i.next();!r.done;r=i.next())(r=r.value)&&t(r)&&e.removeCue(r);e.mode=n}function fd(){}function pd(){}function gd(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function md(t,n,i){var r=this;this.m=!1,this.h=[],this.A=t,this.s=n,this.l=null,this.g=document.createElement("div"),this.g.classList.add("shaka-text-container"),this.g.style.textAlign="center",this.g.style.display="flex",this.g.style.flexDirection="column",this.g.style.alignItems="center",this.g.style.justifyContent="flex-end",this.s.appendChild(this.g),i&&i.captionsUpdatePeriod||pe("UITextDisplayer w/ config","Please migrate to initializing UITextDisplayer with a config."),this.C=new Ut(function(){r.A.paused||bd(r)}).Sa(i&&i.captionsUpdatePeriod?i.captionsUpdatePeriod:.25),this.i=new Map,this.j=new ae,this.j.D(document,"fullscreenchange",function(){bd(r,!0)}),this.j.D(this.A,"seeking",function(){bd(r,!0)}),this.j.D(this.A,"resize",function(){var e=r.A,t=e.videoWidth;e=e.videoHeight,r.l=t&&e?t/e:null}),this.o=null,"ResizeObserver"in e&&(this.o=new ResizeObserver(function(){bd(r,!0)}),this.o.observe(this.g)),this.B=new Map}function vd(e,t){for(;null!=t;){if(t==e.g)return!0;t=t.parentElement}return!1}function yd(e,t,n,i,r){var a=!1,s=[],o=[];t=c(t);for(var l=t.next();!l.done;l=t.next()){l=l.value,r.push(l);var u=e.i.get(l),d=l.startTime<=i&&l.endTime>i,h=u?u.wh:null;u&&(s.push(u.jf),u.uc&&s.push(u.uc),d||(a=!0,e.i.delete(l),u=null)),d&&(o.push(l),u?vd(e,h)||(a=!0):(Sd(e,l,r),u=e.i.get(l),h=u.wh,a=!0)),0<l.nestedCues.length&&h&&yd(e,l.nestedCues,h,i,r),r.pop()}if(a){for(i=c(s),r=i.next();!r.done;r=i.next())r=r.value,r.parentElement&&r.parentElement.removeChild(r);for(o.sort(function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime-t.endTime}),o=c(o),l=o.next();!l.done;l=o.next())i=e.i.get(l.value),i.uc?(i.uc.contains(n)&&i.uc.removeChild(n),n.appendChild(i.uc),i.uc.appendChild(i.jf)):n.appendChild(i.jf)}}function bd(e,t){if(e.g){var n=e.A.currentTime;if(!e.m||void 0!==t&&t){t=c(e.B.values());for(var i=t.next();!i.done;i=t.next())gd(i.value);gd(e.g),e.i.clear(),e.B.clear()}e.m&&yd(e,e.h,e.g,n,[])}}function Sd(e,t,n){var i=1<n.length,r=i?"span":"div";t.lineBreak&&(r="br"),t.rubyTag&&(r=t.rubyTag),i=!i&&0<t.nestedCues.length;var a=document.createElement(r);if("br"!=r&&_d(e,a,t,n,i),n=null,t.region&&t.region.id){var s=t.region,o=e.l===4/3?2.5:1.9;if(n=s.id+"_"+s.width+"x"+s.height+(s.heightUnits==Le?"%":"px")+"-"+s.viewportAnchorX+"x"+s.viewportAnchorY+(s.viewportAnchorUnits==Le?"%":"px"),e.B.has(n))n=e.B.get(n);else{r=document.createElement("span");var l=s.heightUnits==Le?"%":"px",u=s.widthUnits==Le?"%":"px",c=s.viewportAnchorUnits==Le?"%":"px";r.id="shaka-text-region---"+n,r.classList.add("shaka-text-region"),r.style.position="absolute",r.style.height=2===s.heightUnits?5.33*s.height+"%":s.height+l,r.style.width=2===s.widthUnits?s.width*o+"%":s.width+u,2===s.viewportAnchorUnits?(l=s.viewportAnchorY/75*100,u=s.viewportAnchorX/(e.l===4/3?160:210)*100,l-=s.regionAnchorY*s.height*5.33/100,u-=s.regionAnchorX*s.width*o/100,r.style.top=l+"%",r.style.left=u+"%"):(r.style.top=s.viewportAnchorY-s.regionAnchorY*s.height/100+c,r.style.left=s.viewportAnchorX-s.regionAnchorX*s.width/100+c),0!==s.heightUnits&&0!==s.widthUnits&&0!==s.viewportAnchorUnits&&(s=Math.max(0,Math.min(100-(parseInt(r.style.width.slice(0,-1),10)||0),parseInt(r.style.left.slice(0,-1),10)||0)),r.style.top=Math.max(0,Math.min(100-(parseInt(r.style.height.slice(0,-1),10)||0),parseInt(r.style.top.slice(0,-1),10)||0))+"%",r.style.left=s+"%"),r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.justifyContent="before"==t.displayAlign?"flex-start":"center"==t.displayAlign?"center":"flex-end",e.B.set(n,r),n=r}}r=a,i&&(r=document.createElement("span"),r.classList.add("shaka-text-wrapper"),r.style.backgroundColor=t.backgroundColor,r.style.lineHeight="normal",a.appendChild(r)),e.i.set(t,{jf:a,wh:r,uc:n})}function Td(e){var t=e.direction,n=e.positionAlign;return e=e.textAlign,n!==Ge?n:"left"===e||"start"===e&&t===We||"end"===e&&"rtl"===t?"line-left":"right"===e||"start"===e&&"rtl"===t||"end"===e&&t===We?"line-right":"center"}function _d(e,t,n,i,r){var a=t.style,s=0==n.nestedCues.length,o=1<i.length;a.whiteSpace="pre-wrap";var l=n.payload.replace(/\s+$/g,function(e){return" ".repeat(e.length)});if(a.webkitTextStrokeColor=n.textStrokeColor,a.webkitTextStrokeWidth=n.textStrokeWidth,a.color=n.color,a.direction=n.direction,a.opacity=n.opacity,a.paddingLeft=wd(n.linePadding,n,e.s),a.paddingRight=wd(n.linePadding,n,e.s),a.textCombineUpright=n.textCombineUpright,a.textShadow=n.textShadow,n.backgroundImage)a.backgroundImage="url('"+n.backgroundImage+"')",a.backgroundRepeat="no-repeat",a.backgroundSize="contain",a.backgroundPosition="center",n.backgroundColor&&(a.backgroundColor=n.backgroundColor),a.width="100%",a.height="100%";else{if(n.nestedCues.length)var u=t;else u=document.createElement("span"),t.appendChild(u);n.border&&(u.style.border=n.border),!r&&((t=Ed(i,function(e){return e.backgroundColor}))?u.style.backgroundColor=t:l&&(u.style.backgroundColor="rgba(0, 0, 0, 0.8)"),t=Ed(i,function(e){return e.fontFamily}))&&(u.style.fontFamily=t),l&&(u.textContent=l)}o&&!i[i.length-1].isContainer?a.display="inline":(a.display="flex",a.flexDirection="column",a.alignItems="center","left"==n.textAlign||"start"==n.textAlign?(a.width="100%",a.alignItems="start"):"right"!=n.textAlign&&"end"!=n.textAlign||(a.width="100%",a.alignItems="end"),a.justifyContent="before"==n.displayAlign?"flex-start":"center"==n.displayAlign?"center":"flex-end"),s||(a.margin="0"),a.fontFamily=n.fontFamily,a.fontWeight=n.fontWeight.toString(),a.fontStyle=n.fontStyle,a.letterSpacing=n.letterSpacing,a.fontSize=wd(n.fontSize,n,e.s),i=n.line,null!=i&&(s=n.lineInterpretation,s==Ye&&(s=1,o=16,e.l&&1>e.l&&(o=32),i=0>i?100+i/o*100:i/o*100),1==s&&(a.position="absolute",n.writingMode==qe?(a.width="100%",n.lineAlign==Xe?a.top=i+"%":"end"==n.lineAlign&&(a.bottom=100-i+"%")):"vertical-lr"==n.writingMode?(a.height="100%",n.lineAlign==Xe?a.left=i+"%":"end"==n.lineAlign&&(a.right=100-i+"%")):(a.height="100%",n.lineAlign==Xe?a.right=i+"%":"end"==n.lineAlign&&(a.left=100-i+"%")))),a.lineHeight=n.lineHeight,e=Td(n),"line-left"==e?(a.cssFloat="left",null!==n.position&&(a.position="absolute",n.writingMode==qe?(a.left=n.position+"%",a.width="auto"):a.top=n.position+"%")):"line-right"==e?(a.cssFloat="right",null!==n.position&&(a.position="absolute",n.writingMode==qe?(a.right=n.position+"%",a.width="auto"):a.bottom=n.position+"%")):null!==n.position&&50!=n.position&&(a.position="absolute",n.writingMode==qe?(a.left=n.position+"%",a.width="auto"):a.top=n.position+"%"),a.textAlign=n.textAlign,a.textDecoration=n.textDecoration.join(" "),a.writingMode=n.writingMode,"writingMode"in document.documentElement.style&&a.writingMode==n.writingMode||(a.webkitWritingMode=n.writingMode),n.size&&(n.writingMode==qe?a.width=n.size+"%":a.height=n.size+"%")}function wd(e,t,n){var i=(i=new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(e))?{value:Number(i[1]),unit:i[2]}:null;if(!i)return e;var r=i.value;switch(i.unit){case"%":return r/100*n.clientHeight/t.cellResolution.rows+"px";case"c":return n.clientHeight*r/t.cellResolution.rows+"px";default:return e}}function Ed(e,t){for(var n=e.length-1;0<=n;n--){var i=t(e[n]);if(i||0===i)return i}return null}function xd(e,t){function n(e){for(var n=e,i=c(t),r=i.next();!r.done;r=i.next())r=r.value,r.end&&r.start<e&&(n+=r.end-r.start);return e=Math.floor(n/3600),i=Math.floor(n/60%60),r=Math.floor(n%60),n=Math.floor(1e3*n%1e3),(10>e?"0":"")+e+":"+(10>i?"0":"")+i+":"+(10>r?"0":"")+r+"."+(100>n?10>n?"00":"0":"")+n}var i=ld(e);e="WEBVTT\n\n",i=c(i);for(var r=i.next();!r.done;r=i.next())r=r.value,e+=n(r.startTime)+" --\x3e "+n(r.endTime)+function(e){var t=[];switch(e.textAlign){case"left":t.push("align:left");break;case"right":t.push("align:right");break;case He:t.push("align:middle");break;case"start":t.push("align:start");break;case"end":t.push("align:end")}switch(e.writingMode){case"vertical-lr":t.push("vertical:lr");break;case"vertical-rl":t.push("vertical:rl")}return t.length?" "+t.join(" "):""}(r)+"\n",e+=r.payload+"\n\n";return e}function Ad(e,t){this.h=e,this.g=t,this.m=void 0,this.i=!1,this.l=!0,this.j=!1}function kd(e){e.i=!1,e.l=!0,e.j=!1}function Id(e,t,n){try{if(!e.g.enabled)return t;var i=Cd(e);e:{switch(n.toLowerCase()){case"audio/mp4":case"audio/webm":case"audio/ogg":case"audio/mpeg":case"audio/aac":case"audio/flac":case"audio/wav":var r=Vd;break e;case"video/webm":case"video/mp4":case"video/mpeg":case"video/mp2t":r=Gd;break e;case"application/x-mpegurl":case"application/vnd.apple.mpegurl":case"application/dash+xml":case"video/vnd.mpeg.dash.mpd":case"application/vnd.ms-sstr+xml":r=Bd;break e}r=void 0}i.ot=r,i.su=!0;var a=Nd(i);return Fd(t,a)}catch(e){return J("CMCD_SRC_ERROR","Could not generate src CMCD data.",e),t}}function Cd(t){return t.g.sessionId||(t.g.sessionId=e.crypto.randomUUID()),{v:1,sf:t.m,sid:t.g.sessionId,cid:t.g.contentId,mtp:t.h.getBandwidthEstimate()/1e3}}function Rd(e,t,n){n=void 0===n?{}:n;var i=void 0===i?e.g.useHeaders:i;if(e.g.enabled){Object.assign(n,Cd(e)),n.pr=e.h.fb();var r=n.ot===jd||n.ot===Gd;if(e.j&&r&&(n.bs=!0,n.su=!0,e.j=!1),null==n.su&&(n.su=e.l),e=Md(e,n),i)i=Ud(e),Object.keys(i).length&&Object.assign(t.headers,i);else{var a=Nd(e);a&&(t.uris=t.uris.map(function(e){return Fd(e,a)}))}}}function Md(e,t){var n=e.g.includeKeys;return n.length?Object.keys(t).reduce(function(e,i){return n.includes(i)&&(e[i]=t[i]),e},{}):t}function Dd(e){if(0===e.type)return Hd;if(e=e.stream){var t=e.type;if("video"==t)return e.codecs&&e.codecs.includes(",")?Gd:jd;if("audio"==t)return Vd;if("text"==t)return"application/mp4"===e.mimeType?Kd:zd}}function Ld(e,t){if(t=e.h.yb()[t],!t.length)return NaN;var n=e.h.getCurrentTime();return(e=t.find(function(e){return e.start<=n&&e.end>=n}))?1e3*(e.end-n):NaN}function Pd(e,t){if(t=e.h.yb()[t],!t.length)return 0;var n=e.h.getCurrentTime();return(e=t.find(function(e){return e.start<=n&&e.end>=n}))?1e3*(e.end-n):0}function Od(e,t){var n=e.h.oc();if(!n.length)return NaN;e=n[0],n=c(n);for(var i=n.next();!i.done;i=n.next())i=i.value,"variant"===i.type&&i.bandwidth>e.bandwidth&&(e=i);switch(t){case jd:return e.videoBandwidth||NaN;case Vd:return e.audioBandwidth||NaN;default:return e.bandwidth}}function Nd(e){function t(e){return 100*n(e/100)}function n(e){return Math.round(e)}function i(e){return!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e}var r=[],a={br:n,d:n,bl:t,dl:t,mtp:t,nor:function(e){return encodeURIComponent(e)},rtp:t,tb:n},s=Object.keys(e||{}).sort();s=c(s);for(var o=s.next();!o.done;o=s.next()){o=o.value;var l=e[o];if(i(l)&&("v"!==o||1!==l)&&("pr"!=o||1!==l)){var u=a[o];u&&(l=u(l)),u=typeof l;var d=void 0;d="string"===u&&"ot"!==o&&"sf"!==o&&"st"!==o?o+"="+JSON.stringify(l):"boolean"===u?o:"symbol"===u?o+"="+l.description:o+"="+l,r.push(d)}}return r.join(",")}function Ud(e){var t=Object.keys(e),n={},i=["Object","Request","Session","Status"],r=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};t=c(t);for(var s=t.next();!s.done;s=t.next())s=s.value,r[null!=a[s]?a[s]:1][s]=e[s];for(e=0;e<r.length;e++)(a=Nd(r[e]))&&(n["CMCD-"+i[e]]=a);return n}function Fd(e,t){return!t||e.includes("offline:")?e:(e=new ht(e),e.g.set("CMCD",t),e.toString())}i=dd.prototype,i.configure=function(){},i.remove=function(e,t){return!!this.g&&(hd(this.g,function(n){return n.startTime<t&&n.endTime>e}),!0)},i.append=function(e){var t=ld(e),n=[];e=this.g.cues?Array.from(this.g.cues):[];var i={};t=c(t);for(var r=t.next();!r.done;i={Cc:i.Cc},r=t.next())i.Cc=r.value,e.some(function(e){return function(t){return t.startTime==e.Cc.startTime&&t.endTime==e.Cc.endTime&&t.text==e.Cc.payload}}(i))||(r=cd(i.Cc))&&n.push(r);for(e=n.slice().sort(function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime!=t.endTime?e.endTime-t.startTime:"line"in VTTCue.prototype?n.indexOf(t)-n.indexOf(e):n.indexOf(e)-n.indexOf(t)}),e=c(e),i=e.next();!i.done;i=e.next())this.g.addCue(i.value)},i.destroy=function(){return this.g&&(hd(this.g,function(){return!0}),this.g.mode="disabled"),this.g=null,Promise.resolve()},i.isTextVisible=function(){return"showing"==this.g.mode},i.setTextVisibility=function(e){this.g.mode=e?"showing":"hidden"},z("shaka.text.SimpleTextDisplayer",dd),dd.prototype.setTextVisibility=dd.prototype.setTextVisibility,dd.prototype.isTextVisible=dd.prototype.isTextVisible,dd.prototype.destroy=dd.prototype.destroy,dd.prototype.append=dd.prototype.append,dd.prototype.remove=dd.prototype.remove,dd.prototype.configure=dd.prototype.configure,i=fd.prototype,i.configure=function(){},i.remove=function(){},i.append=function(){},i.destroy=function(){},i.isTextVisible=function(){return!1},i.setTextVisibility=function(){},z("shaka.text.StubTextDisplayer",fd),fd.prototype.setTextVisibility=fd.prototype.setTextVisibility,fd.prototype.isTextVisible=fd.prototype.isTextVisible,fd.prototype.destroy=fd.prototype.destroy,fd.prototype.append=fd.prototype.append,fd.prototype.remove=fd.prototype.remove,fd.prototype.configure=fd.prototype.configure,z("shaka.util.Dom",pd),pd.removeAllChildren=gd,i=md.prototype,i.configure=function(e){this.C&&this.C.Sa(e.captionsUpdatePeriod)},i.append=function(e){var t=[].concat(d(this.h)),n={};e=c(ud(e));for(var i=e.next();!i.done;n={Td:n.Td},i=e.next())n.Td=i.value,t.some(function(e){return function(t){return je(t,e.Td)}}(n))||this.h.push(n.Td);bd(this)},i.destroy=function(){return this.g?(this.s.removeChild(this.g),this.g=null,this.m=!1,this.h=[],this.C&&this.C.stop(),this.i.clear(),this.j&&(this.j.release(),this.j=null),this.o&&(this.o.disconnect(),this.o=null),Promise.resolve()):Promise.resolve()},i.remove=function(e,t){if(!this.g)return!1;var n=this.h.length;return this.h=this.h.filter(function(n){return n.startTime<e||n.endTime>=t}),bd(this,n>this.h.length),!0},i.isTextVisible=function(){return this.m},i.setTextVisibility=function(e){this.m=e},z("shaka.text.UITextDisplayer",md),md.prototype.setTextVisibility=md.prototype.setTextVisibility,md.prototype.isTextVisible=md.prototype.isTextVisible,md.prototype.remove=md.prototype.remove,md.prototype.destroy=md.prototype.destroy,md.prototype.append=md.prototype.append,md.prototype.configure=md.prototype.configure,z("shaka.text.WebVttGenerator",function(){}),Ad.prototype.configure=function(e){this.g=e};var Bd="m",Vd="a",jd="v",Gd="av",Hd="i",zd="c",Kd="tt";function $d(e){this.h=e,this.g=null}function Wd(e){return!e||"false"!==e.toLowerCase()&&(/^[-0-9]/.test(e)?parseInt(e,10):e.replace(/["]+/g,""))}z("shaka.util.CmcdManager.StreamingFormat",{DASH:"d",HLS:"h",yh:"s",OTHER:"o"}),i=$d.prototype,i.configure=function(e){this.h=e},i.Ng=function(){return this.h.enabled&&this.h.applyMaximumSuggestedBitrate&&this.g&&this.g.has(Yd)?1e3*this.g.get(Yd):null},i.Lg=function(){return this.h.enabled&&this.g&&this.g.has(qd)?1e3*this.g.get(qd):null},i.ei=function(){return this.h.enabled&&this.g&&this.g.has(Xd)?this.g.get(Xd):null},i.fi=function(){return this.h.enabled&&this.g&&this.g.has(Qd)?this.g.get(Qd):null},i.getBandwidthEstimate=function(e){var t=this.Lg();if(!t)return e;var n=this.h.estimatedThroughputWeightRatio;return 0<n&&1>=n?e*(1-n)+t*n:e},z("shaka.util.CmsdManager",$d),$d.prototype.getBandwidthEstimate=$d.prototype.getBandwidthEstimate,$d.prototype.getRoundTripTime=$d.prototype.fi,$d.prototype.getResponseDelay=$d.prototype.ei,$d.prototype.getEstimatedThroughput=$d.prototype.Lg,$d.prototype.getMaxBitrate=$d.prototype.Ng;var qd="etp",Yd="mb",Xd="rd",Qd="rtt";function Zd(){this.g=null,this.h=[]}function Jd(e,t){return N(function(n){if(1==n.g)return e.g?_(n,new Promise(function(t){return e.h.push(t)}),2):n.u(2);e.g=t,w(n)})}function eh(t,n){Br.call(this);var i=this;this.l=gf,this.ze=this.h=null,this.pa=!1,this.Je=new ae,this.zd=new ae,this.m=new ae,this.Fa=new ae,this.wb=new ae,this.C=this.G=this.B=this.H=null,this.Le=0,this.Z=new Zd,this.qa=this.pg=this.da=this.i=this.bb=this.F=this.j=this.rd=this.K=this.tg=this.ea=this.N=this.wd=this.L=this.Ce=this.I=this.Hb=null,this.Ea=!1,this.xa=this.o=null,this.rg=1e9,this.Hd=[],this.U=NaN,this.g=Bh(this),this.R=null,this.Ne=-1,this.Da=null,this.fa={width:1/0,height:1/0},this.xe=new Ns(this.g,this.fa,null),this.Fe=[],this.s=null,this.za=new dr(this.g.preferredAudioLanguage,this.g.preferredVariantRole,this.g.preferredAudioChannelCount,this.g.preferredVideoHdrLevel,this.g.preferSpatialAudio,this.g.preferredVideoLayout,this.g.preferredAudioLabel,this.g.preferredVideoLabel,this.g.mediaSource.codecSwitchingStrategy,this.g.manifest.dash.enableAudioGroups),this.Fb=this.g.preferredTextLanguage,this.Gd=this.g.preferredTextRole,this.Fd=this.g.preferForcedSubs,this.Ed=[],n&&n(this),this.N=Ih(this),this.ea=new $d(this.g.cmsd),this.H=_h(this),this.H.fg(this.g.streaming.forceHTTP),this.H.gg(this.g.streaming.forceHTTPS),this.Ib=this.aa=this.A=null,this.Ye=!1,this.sg=new Ut(function(){return N(function(e){return 1==e.g?i.aa?_(e,i.Ub(i.Ib,!0),3):e.u(0):4!=e.g?_(e,i.load(i.aa),4):(i.Ye?i.Ib.pause():i.Ib.play(),i.aa=null,i.Ye=!1,void w(e))})}),Sf&&(this.A=Sf(),this.A.configure(this.g.ads),this.wb.D(this.A,"ad-content-pause-requested",function(e){var t,n;return N(function(r){if(1==r.g)return i.sg.stop(),i.aa?r.u(0):(i.Ib=i.h,i.Ye=i.h.ended,t=e.saveLivePosition||!1,n=i,_(r,i.Eg(!0,t),3));n.aa=r.h,w(r)})}),this.wb.D(this.A,"ad-content-resume-requested",function(e){if(e=e.offset||0,i.aa){var t=i.aa;t.A&&e&&(t.A+=e)}i.sg.Y(.1)}),this.wb.D(this.A,"ad-content-attach-requested",function(){return N(function(e){return i.h||!i.Ib?e.u(0):_(e,i.Ub(i.Ib,!0),0)})})),this.Je.D(e,"online",function(){af(i),i.Zf()}),this.Ee=new Ut(function(){for(var e=Date.now()/1e3,t=!1,n=!0,r=c(i.i.variants),a=r.next();!a.done;a=r.next())a=a.value,0<a.disabledUntilTime&&a.disabledUntilTime<=e&&(a.disabledUntilTime=0,t=!0),0<a.disabledUntilTime&&(n=!1);n&&i.Ee.stop(),t&&Yh(i,!1,void 0,!1,!1)}),this.ra=null,t&&(pe("Player w/ mediaElement","Please migrate from initializing Player with a mediaElement; use the attach method instead."),this.Ub(t,!0))}function th(e){null!=e.K&&(Ko(e.K),e.K.release(),e.K=null)}function nh(e,t){t.lcevc.enabled?(th(e),null==e.K&&(e.K=new zo(e.h,e.tg,t.lcevc),e.G&&(e.G.Z=e.K))):th(e)}function ih(e,t){return new Nr(e,t)}function rh(e,t){e.dispatchEvent(ih("onstatechange",(new Map).set("state",t)))}function ah(e,t){var n;return N(function(i){return 1==i.g?(n=++e.Le,_(i,Jd(e.Z,t),2)):n!=e.Le?(e.Z.release(),i.return(!0)):i.return(!1)})}function sh(e){for(var t=c(e.i.variants),n=t.next();!n.done;n=t.next())n=n.value,n.video&&(n.video.closeSegmentIndex(),n.video=null),n.bandwidth=n.audio&&n.audio.bandwidth?n.audio.bandwidth:0;e.i.variants=e.i.variants.filter(function(e){return e.audio})}function oh(e,t){var n,i;return t=void 0!==t&&t,N(function(r){if(1==r.g)return n=null,e.i&&e.F&&e.bb&&e.da?(i=e.h.currentTime,e.V()&&!t&&(i=null),_(r,uh(e,e.da,i,e.pg,!0,!1,!1),3)):r.u(2);if(2!=r.g){n=r.h,e.Fe.push(n),e.F&&e.F.setMediaElement&&e.F.setMediaElement(null);var a=n,s=e.F,o=e.bb;a.h=e.i,a.j=s,a.F=o,a=n,s=e.xa,a.i=e.o,a.B=s,n.o=e.za,n.start(),e.i=null,e.F=null,e.bb=null,e.o=null,e.xa=null}return r.return(n)})}function lh(e,t,n,i,r){var a,s,o;return r=void 0!==r&&r,N(function(l){return 1==l.g?i?l.u(2):_(l,ch(e,t),3):(2!=l.g&&(i=l.h),dh(e,i)?l.return(null):(a=!1,s=!0,r&&(e.o&&e.xa==e.g.abrFactory&&(s=!1),e.h&&"AUDIO"===e.h.nodeName&&(a=!0)),o=uh(e,t,n,i||null,!r,a,s),r||(o=o.then(function(t){return e.Fe.push(t),t})),l.return(o)))})}function uh(e,t,n,i,r,a,s){var o,l,u,d,h,f,p,g,m,v,y,b,S,T,E;return r=void 0===r||r,a=void 0!==a&&a,s=void 0===s||s,N(function(x){return 1==x.g?(o=null,l=yi(e.g),a&&(l.manifest.disableVideo=!0),u=function(){return o.R&&o.s?null:o},d=function(){return u()?u().getConfiguration():e.g},h=function(t,n){u()?o.configure(t,n):e.configure(t,n)},1/0!=e.fa.width||1/0!=e.fa.height?x.u(2):_(x,ln(),3)):(2!=x.g&&(f=x.h,e.fa.width=f.width,e.fa.height=f.height),p=new Ns(l,e.fa,null),g={networkingEngine:e.H,filter:function(e){var t,n;return N(function(i){return 1==i.g?_(i,Us(p,e),2):4!=i.g?(t=i.h,t?(n=ih("trackschanged"),_(i,Promise.resolve(),4)):i.u(0)):(o.dispatchEvent(n),void w(i))})},makeTextStreamsForClosedCaptions:function(t){return Vh(e,t)},onTimelineRegionAdded:function(e){var t=o.G;e:{for(var n=c(t.g),i=n.next();!i.done;i=n.next())if(i=i.value,i.schemeIdUri==e.schemeIdUri&&i.id==e.id&&i.startTime==e.startTime&&i.endTime==e.endTime){n=i;break e}n=null}null==n&&(t.g.add(e),e=new Nr("regionadd",new Map([["region",e]])),t.dispatchEvent(e))},onEvent:function(e){return o.dispatchEvent(e)},onError:function(e){return o.onError(e)},isLowLatencyMode:function(){return d().streaming.lowLatencyMode},isAutoLowLatencyMode:function(){return d().streaming.autoLowLatencyMode},enableLowLatencyMode:function(){h("streaming.lowLatencyMode",!0)},updateDuration:function(){e.j&&o.R&&e.j.updateDuration()},newDrmInfo:function(e){var t=o.l,n=t?t.g:null;n&&t.s&&Bs(p,n.keySystem,e)},onManifestUpdated:function(){var t=(new Map).set("isLive",e.V());o.dispatchEvent(ih("manifestupdated",t)),Bc(o,!1,function(){e.A&&e.A.onManifestUpdated(e.V())})},getBandwidthEstimate:function(){return e.o.getBandwidthEstimate()},onMetadata:function(t,n,i,r){var a=t;"com.apple.hls.interstitial"==t&&(a="com.apple.quicktime.HLS",t={startTime:n,endTime:i,values:r},e.A)&&e.A.onInterstitialMetadata(e,e.h,t),t={},r=c(r);for(var s=r.next();!s.done;t={Re:t.Re},s=r.next())t.Re=s.value,Bc(o,!1,function(t){return function(){Sh(e,n,i,a,t.Re)}}(t))},disableStream:function(t){return e.disableStream(t,e.g.streaming.maxDisabledTime)}},m=new ku(function(){return e.Qb()}),m.addEventListener("regionadd",function(t){var n=t.region;of(e,"timelineregionadded",n,o),Bc(o,!1,function(){e.A&&e.A.onDashTimedMetadata(n)})}),v=null,l.streaming.observeQualityChanges&&(v=new Iu(function(){return e.yb()}),v.addEventListener("qualitychange",function(t){lf(e,t.quality,t.position)}),v.addEventListener("audiotrackchange",function(t){lf(e,t.quality,t.position,!0)})),y=!0,b={Nb:e.H,onError:function(e){return o.onError(e)},Ae:function(t){Bc(o,!0,function(){var n=t,i=ih("keystatuschanged");e.dispatchEvent(i);var r=Object.keys(n);1==r.length&&""==r[0]&&(r=["00"],n={"00":n[""]}),i=1==r.length&&"00"==r[0];var a=!1;if(r.length){r=c(e.i.variants);for(var s=r.next();!s.done;s=r.next()){s=s.value;var o=[];s.audio&&o.push(s.audio),s.video&&o.push(s.video),o=c(o);for(var l=o.next();!l.done;l=o.next()){var u=l.value;if(l=s.allowedByKeySystem,u.keyIds.size){s.allowedByKeySystem=!0,u=c(u.keyIds);for(var d=u.next();!d.done;d=u.next())d=d.value,((d=n[i?"00":d])||e.B.F)&&(s.allowedByKeySystem=s.allowedByKeySystem&&!!d&&!js.includes(d))}l!=s.allowedByKeySystem&&(a=!0)}}}a&&(Jh(e),!Wh(e))||(n=e.j.j)&&!n.allowedByKeySystem&&Yh(e)})},onExpirationUpdated:function(e,t){var n=ih("expirationupdated");o.dispatchEvent(n),(n=o.j)&&n.onExpirationUpdated&&n.onExpirationUpdated(e,t)},onEvent:function(t){o.dispatchEvent(t),"drmsessionupdate"==t.type&&y&&(y=!1,t=Date.now()/1e3-o.ra,(e.s||o.getStats()).j=t,e.K&&Ko(e.K))}},S=_h(e,u),zr(e.H,S),T=function(){return e.Dc(b)},E={config:l,Di:g,Mi:m,Li:v,Dc:T,Ci:p,networkingEngine:S,Fh:r,Eh:s},o=new Fc(t,i,n,E),x.return(o))})}function ch(e,t){var n,i;return N(function(r){return 1==r.g?(n=e.g.manifest.retryParameters,_(r,rd(t,e.H,n),2)):(i=r.h,"application/x-mpegurl"==i&&Yt()&&(i="application/vnd.apple.mpegurl"),r.return(i))})}function dh(e,t){if(!Ft())return!0;if(t){if(""==(e.h||sn()).canPlayType(t))return!1;if(!(Ft()&&t in zs))return!0;if(Wn(t))return Yt()&&(e.g.drm.servers["com.apple.fps"]||e.g.drm.servers["com.apple.fps.1_0"])?e.g.streaming.useNativeHlsForFairPlay:e.g.streaming.preferNativeHls}return!1}function hh(e){var t,n,i,r,a;return N(function(s){if(1==s.g)return rh(e,"media-source"),t=e.g.textDisplayFactory,n=t(),n.configure?n.configure(e.g.textDisplayer):pe("Text displayer w/ configure",'Text displayer should have a "configure" method!'),e.qg=t,i=kh(e.h,n,{Xh:function(){return e.keySystem()},onMetadata:function(t,n,i){bh(e,t,n,i)}},e.K),i.configure(e.g.mediaSource),r=e.g.manifest,a=r.segmentRelativeVttTiming,i.fa=a,_(s,i.L,2);e.G=i,w(s)})}function fh(e,t,n,i){var r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,E,x,A,k,I;return N(function(C){switch(C.g){case 1:rh(e,"load"),r=e.h,e.I=new au({ie:function(){return r.playbackRate},nc:function(){return r.defaultPlaybackRate},hg:function(e){r.playbackRate=e},Yg:function(e){r.currentTime+=e}}),a=function(){return zh(e)},s=function(){return Hh(e)},e.m.D(r,"playing",a),e.m.D(r,"pause",a),e.m.D(r,"ended",a),e.m.D(r,"ratechange",s),nh(e,e.g),e.Fb=e.g.preferredTextLanguage,e.Gd=e.g.preferredTextRole,e.Fd=e.g.preferForcedSubs,cf(e.i.presentationTimeline,e.g.playRangeStart,e.g.playRangeEnd),e.o.init(function(t,n,i){e.i&&e.j&&t!=e.j.j&&Xh(e,t,!0,void 0!==n&&n,void 0===i?0:i)}),e.o.setMediaElement(r),e.o.setCmsdManager(e.ea),e.j=Ch(e),e.j.configure(e.g.streaming),e.l=mf,r.textTracks&&e.m.D(r.textTracks,"addtrack",function(t){if(t.track)switch(t=t.track,t.kind){case"chapters":Th(e,t)}}),e.dispatchEvent(ih("streaming")),o=n;case 2:for((u=e.j.j)||o||(o=qh(e,!0)),d=[],l=u||o,h=c([l.video,l.audio]),f=h.next();!f.done;f=h.next())(p=f.value)&&!p.segmentIndex&&d.push(p.createSegmentIndex());if(!(0<d.length)){C.u(4);break}return _(C,Promise.all(d),4);case 4:if(!l||0!=l.disabledUntilTime){C.u(2);break}if(e.F&&e.F.onInitialVariantChosen&&e.F.onInitialVariantChosen(l),e.i.isLowLatency&&!e.g.streaming.lowLatencyMode&&Z("Low-latency live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."),cf(e.i.presentationTimeline,e.g.playRangeStart,e.g.playRangeEnd),Hu(e.j,e.g.playRangeStart,e.g.playRangeEnd),g=function(t){e.C=wh(e,t),e.Hb=Eh(e,t),xh(e,r,Math.max(e.i.minBufferTime,e.g.streaming.rebufferingGoal))},e.g.streaming.startAtSegmentBoundary||g(e.qa),u){C.u(7);break}if(!e.g.streaming.startAtSegmentBoundary){C.u(8);break}return m=e.i.presentationTimeline,v=e.qa||e.h.currentTime,y=m.Yb(),b=m.Ab(),v<y?v=y:v>b&&(v=b),_(C,jh(o,v),9);case 9:S=C.h,g(S);case 8:Xh(e,o,!0,!1,0);case 7:return e.C.$e(),T=e.Hc().find(function(e){return e.active}),T||((E=qi(e.i.textStreams,e.Fb,e.Gd,e.Fd)[0]||null)&&fu(e.s.h,E,!0),o&&(E?(Zh(e,o.audio,E)&&(e.pa=!0),e.pa&&e.G.F.setTextVisibility(!0),nf(e)):e.pa=!1),E&&(e.g.streaming.alwaysStreamText||e.Kf())&&qu(e.j,E)),_(C,e.j.start(i),10);case 10:e.g.abr.enabled&&(e.o.enable(),rf(e)),Jh(e),Wh(e),e.i.variants.some(function(e){return e.primary}),((x=e.V())&&(e.g.streaming.liveSync&&e.g.streaming.liveSync.enabled||e.i.serviceDescription||e.g.streaming.liveSync.panicMode)||e.g.streaming.vodDynamicPlaybackRate)&&(A=function(){return Kh(e)},e.m.D(r,"timeupdate",A)),x||(k=function(){return $h(e)},e.m.D(r,"timeupdate",k),$h(e),e.i.nextUrl&&(0<e.g.streaming.preloadNextUrlWindow&&(I=function(){var t,n;return N(function(i){if(1==i.g)return t=e.h.duration-e.h.currentTime,!isNaN(t)&&t<=e.g.streaming.preloadNextUrlWindow?(e.m.lb(r,"timeupdate",I),n=e,_(i,e.preload(e.i.nextUrl),4)):i.u(0);n.ra=i.h,w(i)})},e.m.D(r,"timeupdate",I)),e.m.D(r,"ended",function(){e.load(e.ra||e.i.nextUrl)}))),e.A&&e.A.onManifestUpdated(x),e.Ea=!0,e.m.ha(r,"loadedmetadata",function(){e.s.m=Date.now()/1e3-t}),w(C)}})}function ph(e,t){var n,i,r,a,s;return N(function(o){return 1==o.g?(n=Pn,i=Date.now()/1e3,r=!0,e.B=e.Dc({Nb:e.H,onError:function(t){sf(e,t)},Ae:function(){},onExpirationUpdated:function(){var t=ih("expirationupdated");e.dispatchEvent(t)},onEvent:function(t){e.dispatchEvent(t),"drmsessionupdate"==t.type&&r&&(r=!1,e.s.j=Date.now()/1e3-i)}}),e.B.configure(e.g.drm),a={id:0,language:"und",disabledUntilTime:0,primary:!1,audio:null,video:null,bandwidth:100,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},s={id:0,originalId:null,groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:t?Kn(t):"",codecs:t?$n(t):"",encrypted:!0,drmInfos:[],keyIds:new Set,language:"und",originalLanguage:null,label:null,type:n.ga,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,accessibilityPurpose:null,external:!1,fastSwitching:!1,fullMimeTypes:new Set},s.fullMimeTypes.add(Fn(s.mimeType,s.codecs)),t.startsWith("audio/")?(s.type=n.X,a.audio=s):a.video=s,e.B.aa=!0,_(o,ns(e.B,[a],[]),2)):_(o,e.B.Ub(e.h),0)})}function gh(e,t,n){var i,r,a,s,o,l,u,c,d,h,f;return N(function(p){if(1==p.g)return rh(e,"src-equals"),i=e.h,e.C=new Yl(i),r=!1,e.Ed.push(function(){r=!0}),null!=e.qa&&e.C.af(e.qa),e.I=new au({ie:function(){return i.playbackRate},nc:function(){return i.defaultPlaybackRate},hg:function(e){i.playbackRate=e},Yg:function(e){i.currentTime+=e}}),a=e.g.streaming.rebufferingGoal,xh(e,i,a),s=function(){return zh(e)},o=function(){return Hh(e)},e.m.D(i,"playing",s),e.m.D(i,"pause",s),e.m.D(i,"ended",s),e.m.D(i,"ratechange",o),"none"!=i.preload&&e.m.ha(i,"loadedmetadata",function(){e.s.m=Date.now()/1e3-t}),i.audioTracks&&(e.m.D(i.audioTracks,"addtrack",function(){return Jh(e)}),e.m.D(i.audioTracks,"removetrack",function(){return Jh(e)}),e.m.D(i.audioTracks,"change",function(){return Jh(e)})),i.textTracks&&(e.m.D(i.textTracks,"addtrack",function(t){if(t.track)switch(t=t.track,t.kind){case"metadata":yh(e,t);break;case"chapters":Th(e,t);break;default:Jh(e)}}),e.m.D(i.textTracks,"removetrack",function(){return Jh(e)}),e.m.D(i.textTracks,"change",function(){return Jh(e)})),i.src=Id(e.N,e.da,n),(Gt()||Kt())&&i.load(),"none"!=i.preload&&!i.autoplay&&Wn(n)&&en()&&i.load(),e.l=vf,e.dispatchEvent(ih("streaming")),l=new Ir,Vl(i,HTMLMediaElement.HAVE_METADATA,e.m,function(){e.C.$e(),l.resolve()}),Vl(i,HTMLMediaElement.HAVE_CURRENT_DATA,e.m,function(){var t;return N(function(n){return 1==n.g?(mh(e),t=Dh(e),t.find(function(e){return"disabled"!=e.mode})?(0<t.length&&(e.pa=!0),n.u(2)):_(n,new Promise(function(t){e.m.ha(i.textTracks,"change",t),new Ut(t).Y(1)}),2)):r?n.return():(vh(e),void w(n))})}),i.error?l.reject(uf(e)):"none"==i.preload&&(Z('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),l.resolve()),e.m.ha(i,"error",function(){l.reject(uf(e))}),u=new Promise(function(t,n){new Ut(n).Y(e.g.streaming.loadTimeout)}),_(p,Promise.race([l,u]),2);((c=e.V())&&(e.g.streaming.liveSync&&e.g.streaming.liveSync.enabled||e.g.streaming.liveSync.panicMode)||e.g.streaming.vodDynamicPlaybackRate)&&(d=function(){return Kh(e)},e.m.D(i,"timeupdate",d)),c||(h=function(){return $h(e)},e.m.D(i,"timeupdate",h),$h(e)),e.A&&(e.A.onManifestUpdated(c),c&&(f=e.Qb().end,e.m.D(i,"progress",function(){var t=e.Qb().end;f!=t&&(e.A.onManifestUpdated(e.V()),f=t)}))),e.Ea=!0,w(p)})}function mh(e){var t=e.g.preferredAudioLanguage;""!=t&&e.gh(t,e.g.preferredVariantRole)}function vh(e){var t=e.g.preferredTextLanguage;""!=t&&e.bg(t,e.g.preferredTextRole,e.g.preferForcedSubs)}function yh(e,t){if("metadata"==t.kind){t.mode="hidden",e.m.D(t,"cuechange",function(){if(t.activeCues){for(var n=[],i={},r=c(t.activeCues),a=r.next();!a.done;i={Ma:i.Ma},a=r.next())i.Ma=a.value,Sh(e,i.Ma.startTime,i.Ma.endTime,i.Ma.type,i.Ma.value),e.A&&e.A.onCueMetadataChange(i.Ma.value),"com.apple.quicktime.HLS"==i.Ma.type&&null!=i.Ma.startTime&&(a=n.find(function(e){return function(t){return t.startTime==e.Ma.startTime&&t.endTime==e.Ma.endTime}}(i)),a||(a={startTime:i.Ma.startTime,endTime:i.Ma.endTime,values:[]},n.push(a)),a.values.push(i.Ma.value));for(n=c(n),i=n.next();!i.done;i=n.next())i=i.value,i.values.some(function(e){return"X-ASSET-URI"==e.key||"X-ASSET-LIST"==e.key})&&e.A&&(i.values.push({key:"CUE",description:"",data:"ONCE",mimeType:null,pictureType:null}),e.A.onInterstitialMetadata(e,e.h,i))}});var n=new Ut(function(){var t=Lh(e);t=c(t);for(var n=t.next();!n.done;n=t.next())n.value.mode="hidden"}).xc().Y(.5);e.Ed.push(function(){n.stop()})}}function bh(e,t,n,i){t=c(t);for(var r=t.next();!r.done;r=t.next())if(r=r.value,r.data&&"number"==typeof r.cueTime&&r.frames){var a=r.cueTime+n,s=i;s&&a>s&&(s=a);for(var o=c(r.frames),l=o.next();!l.done;l=o.next())Sh(e,a,s,"org.id3",l.value);e.A&&e.A.onHlsTimedMetadata(r,a)}}function Sh(e,t,n,i,r){t=(new Map).set("startTime",t).set("endTime",n).set("metadataType",i).set("payload",r),e.dispatchEvent(ih("metadata",t))}function Th(e,t){if(t&&"chapters"==t.kind){t.mode="hidden";var n=new Ut(function(){t.mode="hidden"}).xc().Y(.5);e.Ed.push(function(){n.stop()})}}function _h(e,t){function n(n){t()?t().dispatchEvent(n):e.dispatchEvent(n)}function i(e){t()?Bc(t(),!0,e):e()}return t||(t=function(){return null}),new Gr(function(n,i,r,a){var s=t()?t().i:e.o;s&&s.segmentDownloaded(n,i,r,a)},function(t,r,a){r=(new Map).set("headers",t).set("request",r).set("requestType",a),n(ih("downloadheadersreceived",r)),i(function(){if(e.ea){var n=e.ea;if(n.h.enabled){var i=t["cmsd-static"];if(i)try{var r=new Map,a=i.split(",");for(i=0;i<a.length;i++){var s=a[i].split("=");r.set(s[0],Wd(s[1]))}}catch(e){}if(r=t["cmsd-dynamic"]){try{var o=new Map,l=r.split(";");for(r=1;r<l.length;r++){var u=l[r].split("=");o.set(u[0],Wd(u[1]))}var c=o}catch(e){c=null}c&&(n.g=c)}}}})},function(e,t,i,r){e=(new Map).set("request",e).set("error",t).set("httpResponseCode",i).set("aborted",r),n(ih("downloadfailed",e))},function(t,n,r){i(function(){var i=e.N,a=r;if(a=void 0===a?{}:a,i.g.enabled)if("HEAD"===n.method)Rd(i,n);else switch(t){case 0:try{if(i.g.enabled){if(a.type){e:{switch(a.type){case 4:var s="d";break e;case 3:case 2:s="h";break e;case 5:s="s";break e}s=void 0}i.m=s}Rd(i,n,{ot:Bd,su:!i.i})}}catch(e){J("CMCD_MANIFEST_ERROR","Could not generate manifest CMCD data.",e)}break;case Zr:try{if(i.g.enabled){var o=a.segment;s=0,o&&(s=o.endTime-o.startTime);var l={d:1e3*s,st:i.h.V()?"l":"v"};l.ot=Dd(a);var u=l.ot===jd||l.ot===Vd||l.ot===Gd||l.ot===Kd,c=a.stream;if(c){var d=i.h.fb();if(u&&(l.bl=Ld(i,c.type),l.ot!==Kd)){var h=Pd(i,c.type);l.dl=d?h/Math.abs(d):h}if(c.bandwidth&&(l.br=c.bandwidth/1e3),c.segmentIndex&&o){var f=c.segmentIndex.Kb(o.endTime,!0,0>d);if(f){var p=f.next().value;if(p&&p!=o){if(!Fe(o.M(),p.M())){var g=p.M()[0],m=n.uris[0],v=new URL(g),y=new URL(m);if(v.origin!==y.origin)var b=g;else{for(var S=v.pathname.split("/").slice(1),T=y.pathname.split("/").slice(1,-1);S[0]===T[0];)S.shift(),T.shift();for(;T.length;)T.shift(),S.unshift("..");b=S.join("/")}l.nor=b}if((p.Ha||p.sa)&&(o.Ha!=p.Ha||o.sa!=p.sa)){var _=p.Ha+"-";p.sa&&(_+=p.sa),l.nrr=_}}}var w=i.h.fb()||1,E=Pd(i,c.type)||500,x=c.bandwidth,A=x?x*(o.endTime-o.startTime)/1e3/(E/w/1e3)*i.g.rtpSafetyFactor:NaN;isNaN(A)||(l.rtp=A)}}u&&l.ot!==Kd&&(l.tb=Od(i,l.ot)/1e3),Rd(i,n,l)}}catch(e){J("CMCD_SEGMENT_ERROR","Could not generate segment CMCD data.",e)}break;case 2:case 5:case 6:Rd(i,n,{ot:"k"});break;case 4:Rd(i,n,{ot:"o"})}})},function(n,i,r,a){(n=t()?t().j:e.F)&&n.banLocation&&n.banLocation(a)},function(n,i){if(i.data){i=i.data.byteLength;var r=t()?t().getStats():e.s;r&&(r.ae=isNaN(r.ae)?i:r.ae+i,0===n&&(r.Ug=i))}})}function wh(e,t){return new Xl(e.h,e.i,e.g.streaming,t,function(){e.Hb&&lu(e.Hb,!0),e.j&&e.j.Nd(),e.L&&Ah(e)},function(t){return e.dispatchEvent(t)})}function Eh(e,t){t=new Jc(e.wd,e.V()||0<t),t.addEventListener("enter",function(t){of(e,"timelineregionenter",t.region)}),t.addEventListener("exit",function(t){of(e,"timelineregionexit",t.region)}),t.addEventListener("skip",function(t){var n=t.region;t.seeking||(of(e,"timelineregionenter",n),of(e,"timelineregionexit",n))});var n=new ou(e.h);return n.g.add(t),e.rd&&n.g.add(e.rd),n}function xh(e,t,n){e.L=new Tr,e.L.g=wr,_r(e.L,n,Math.min(.5,n/2)),Gh(e),e.Ce=new Ut(function(){Ah(e)}).Sa(.25),e.m.D(t,"waiting",function(){return Ah(e)}),e.m.D(t,"stalled",function(){return Ah(e)}),e.m.D(t,"canplaythrough",function(){return Ah(e)}),e.m.D(t,"progress",function(){return Ah(e)})}function Ah(e){switch(e.l){case vf:if(e.h.ended)var t=!0;else{var n=no(e.h.buffered);t=null!=n&&n>=e.h.duration-1}break;case mf:e:if(e.h.ended||al(e.G))t=!0;else{if(e.i.presentationTimeline.V()){n=e.i.presentationTimeline.Zb();var i=no(e.h.buffered);if(null!=i&&i>=n){t=!0;break e}}t=!1}break;default:t=!1}i=ro(e.h.buffered,e.h.currentTime),n=e.L;var r=t,a=n.i.get(n.g);t=n.g,i=r||i>=a?Er:wr,n.g=i,(t=t!=i)&&i===Er&&(n.h=Date.now()),t&&Gh(e)}function kh(e,t,n,i){return new Jo(e,t,n,i)}function Ih(e){return new Ad({getBandwidthEstimate:function(){return e.o?e.o.getBandwidthEstimate():NaN},yb:function(){return e.yb()},getCurrentTime:function(){return e.h?e.h.currentTime:0},fb:function(){return e.fb()},zb:function(){return e.zb()},oc:function(){return e.oc()},V:function(){return e.V()}},e.g.cmcd)}function Ch(e){return new ju(e.i,{he:function(){return e.C?e.C.$d():0},getBandwidthEstimate:function(){return e.o.getBandwidthEstimate()},fb:function(){return e.fb()},ca:e.G,Nb:e.H,onError:function(t){return sf(e,t)},onEvent:function(t){return e.dispatchEvent(t)},Ii:function(){e.F&&e.F.update&&e.F.update()},Sf:function(t,n){var i=t.startTime,r=t.endTime,a=n.type,s=n.codecs.includes(",");if(e.C){e.C.Zg();var o=sl(e.G,a);!e.V()&&e.h.paused&&null!=o&&0<o&&e.C.$d()<o&&e.C.af(o)}Ah(e),i=(new Map).set("start",i).set("end",r).set("contentType",a).set("isMuxed",s),e.dispatchEvent(ih("segmentappended",i)),e.o&&n.fastSwitching&&t.Kd&&t.pe&&e.o.trySuggestStreams()},Hi:function(t,n){(n=n.Lc)&&e.rd&&Ru(e.rd,n,t)},yg:function(t,n){var i=e.B;if(i.h.parseInbandPsshEnabled&&!i.F&&["audio","video"].includes(t)){n=new Ta(Ee(n));var r=0,a=c(n.data);for(t=a.next();!t.done;t=a.next())r+=t.value.length;if(0==r)i=Promise.resolve();else{for(r=new Uint8Array(r),a=0,n=c(n.data),t=n.next();!t.done;t=n.next())t=t.value,r.set(t,a),a+=t.length;cs(i,"cenc",r),i=i.l}}else i=Promise.resolve();return i},onMetadata:function(t,n,i){bh(e,t,n,i)},disableStream:function(t,n){return e.disableStream(t,n)}})}function Rh(e){if(e.xe=new Ns(e.g,e.fa,e.B),e.F){var t=yi(e.g.manifest);e.h&&"AUDIO"===e.h.nodeName&&(t.disableVideo=!0),e.F.configure(t)}if(e.B&&e.B.configure(e.g.drm),e.j){e.j.configure(e.g.streaming);try{e.l!=pf&&Fs(e.xe,e.i)&&Jh(e)}catch(t){sf(e,t)}e.o&&Wh(e),t=e.j.j,!t||t.allowedByApplication&&t.allowedByKeySystem||Yh(e)}if(e.H&&(e.H.fg(e.g.streaming.forceHTTP),e.H.gg(e.g.streaming.forceHTTPS)),e.G)if(e.G.configure(e.g.mediaSource),e.G.fa=e.g.manifest.segmentRelativeVttTiming,t=e.g.textDisplayFactory,e.qg!=t){var n=t();n.configure?n.configure(e.g.textDisplayer):pe("Text displayer w/ configure",'Text displayer should have a "configure" method!');var i=e.G,r=i.F;i.F=n,r&&(n.setTextVisibility(r.isTextVisible()),r.destroy()),i.g&&(i.g.j=n),e.qg=t,e.j&&(t=e.j,(n=t.i.get(Ln))&&Yu(t,n.stream,!0,0,!0))}else t=e.G.F,t.configure&&t.configure(e.g.textDisplayer);e.o&&(e.o.configure(e.g.abr),e.g.abr.enabled?e.o.enable():e.o.disable(),rf(e)),e.L&&(t=e.g.streaming.rebufferingGoal,e.i&&(t=Math.max(t,e.i.minBufferTime)),_r(e.L,t,Math.min(.5,t/2))),e.i&&cf(e.i.presentationTimeline,e.g.playRangeStart,e.g.playRangeEnd),e.A&&e.A.configure(e.g.ads),e.N&&e.N.configure(e.g.cmcd),e.ea&&e.ea.configure(e.g.cmsd)}function Mh(e){return e&&(e=/(\d+)x(\d+)/.exec(e))?{kc:parseInt(e[1],10),rows:parseInt(e[2],10)}:null}function Dh(e){return Array.from(e.h.textTracks).filter(function(e){return"metadata"!=e.kind&&"chapters"!=e.kind&&"Shaka Player TextTrack"!=e.label})}function Lh(e){return Array.from(e.h.textTracks).filter(function(e){return"metadata"==e.kind})}function Ph(e){return Array.from(e.h.textTracks).filter(function(e){return"chapters"==e.kind})}function Oh(e,t){var n;return N(function(i){switch(i.g){case 1:return E(i,2),_(i,rd(t,e.H,e.g.streaming.retryParameters),4);case 4:n=i.h,A(i,3);break;case 2:k(i);case 3:if(n)return i.return(n);throw new It(1,2,2011,t)}})}function Nh(e,t,n,i,r,a,s){var o,l,u,c;return N(function(d){if(1==d.g)return"text/vtt"!=r||s.length?_(d,Uh(e,t,e.H,e.g.streaming.retryParameters),3):d.u(2);2!=d.g&&(o=d.h,l=Fh(e,o,r,s),u=new Blob([l],{type:"text/vtt"}),t=Ml(u),r="text/vtt"),c=document.createElement("track");var h=e.N,f=t;try{if(h.g.enabled){var p=Cd(h);p.ot=zd,p.su=!0;var g=Nd(p),m=Fd(f,g)}else m=f}catch(e){J("CMCD_TEXT_TRACK_ERROR","Could not generate text track CMCD data.",e),m=f}return c.src=m,c.label=a,c.kind=i,c.srclang=n,e.h.getAttribute("crossorigin")||e.h.setAttribute("crossorigin","anonymous"),e.h.appendChild(c),d.return(c)})}function Uh(e,t,n,i){var r,a,s;return N(function(o){if(1==o.g){r=Zr,a=Kr([t],i),a.method="GET";var l=e.N;try{l.g.enabled&&Rd(l,a,{ot:zd,su:!0})}catch(e){J("CMCD_TEXT_ERROR","Could not generate text CMCD data.",e)}return _(o,n.request(r,a).promise,2)}return s=o.h,o.return(s.data)})}function Fh(e,t,n,i){var r=ri[n];if(r)return n=r(),e={periodStart:0,segmentStart:0,segmentEnd:e.h.duration,vttOffset:0},t=Ee(t),t=n.parseMedia(t,e,null),xd(t,i);throw new It(2,2,2014,n)}function Bh(e){var t=Lc();return t.streaming.failureCallback=function(t){if(e.V()){var n=null;1001==t.code||1002==t.code?(n=1,e.g.streaming.lowLatencyMode&&(n=.1)):1003==t.code&&(n=.1),null!=n&&(t.severity=1,e.Zf(n))}},t.textDisplayFactory=function(){if(e.ze){var t=e.getConfiguration();return new md(e.h,e.ze,t.textDisplayer)}return HTMLMediaElement.prototype.addTextTrack?new dd(e.h,"Shaka Player TextTrack"):new fd},t}function Vh(e,t){for(var n=new Set,i=c(t.textStreams),r=i.next();!r.done;r=i.next())r=r.value,"application/cea-608"!=r.mimeType&&"application/cea-708"!=r.mimeType||n.add(r.originalId);for(i=c(t.variants),r=i.next();!r.done;r=i.next())if((r=r.value.video)&&r.closedCaptions)for(var a=c(r.closedCaptions.keys()),s=a.next();!s.done;s=a.next())if(s=s.value,!n.has(s)){var o=s.startsWith("CC")?"application/cea-608":"application/cea-708",l=new ru,u=r.closedCaptions.get(s);o={id:e.rg++,originalId:s,groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:l,mimeType:o,codecs:"",kind:"caption",encrypted:!1,drmInfos:[],keyIds:new Set,language:u,originalLanguage:u,label:null,type:Ln,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:r.roles,forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,accessibilityPurpose:null,external:!1,fastSwitching:!1,fullMimeTypes:new Set([Fn(o,"")])},t.textStreams.push(o),n.add(s)}}function jh(e,t){var n,i,r,a,s;return N(function(o){return 1==o.g?(n=e.audio,i=e.video,r=function(e,t){var n,i,r;return N(function(a){return 1==a.g?e?_(a,e.createSegmentIndex(),2):a.return(null):(i=(n=e.segmentIndex.Kb(t))?n.next().value:null,i?(r=i.startTime,a.return(r)):a.return(null))})},_(o,r(n,t),2)):3!=o.g?(a=o.h,_(o,r(i,t),3)):(s=o.h,null!=s&&null!=a?o.return(Math.max(s,a)):null!=s?o.return(s):null!=a?o.return(a):o.return(t))})}function Gh(e){var t=e.Jf();if(e.s&&e.L&&e.C){var n=e.I;if(n.j=t,su(n),e.N&&(n=e.N,t||n.i||(n.i=!0),n.i&&t&&(n.j=!0),n.l=t),zh(e),n=e.g.streaming.liveSync.dynamicTargetLatency.maxAttempts,e.g.streaming.liveSync.dynamicTargetLatency.enabled&&t&&e.Ne<n){n=e.g.streaming.liveSync.dynamicTargetLatency.maxLatency;var i=e.g.streaming.liveSync.targetLatencyTolerance,r=e.g.streaming.liveSync.dynamicTargetLatency.rebufferIncrement;e.R&&(e.R=Math.min(e.R+ ++e.Ne*r,n-i))}}t=(new Map).set("buffering",t),e.dispatchEvent(ih("buffering",t))}function Hh(e){var t=e.h.playbackRate;0!=t&&(e.I&&e.I.set(t),t=ih("ratechange"),e.dispatchEvent(t))}function zh(e){if(e.s&&e.L){var t=e.s.g,n="playing";e.L.g==wr?n="buffering":e.h.paused?n="paused":e.h.ended&&(n="ended");var i=n;if(null==t.g)t.g={timestamp:Date.now()/1e3,state:i,duration:0},t=!0;else{var r=Date.now()/1e3;t.g.duration=r-t.g.timestamp,t.g.state==i?t=!1:(t.h.push(t.g),t.g={timestamp:r,state:i,duration:0},t=!0)}t&&(n=(new Map).set("newstate",n),e.dispatchEvent(ih("statechanged",n)))}}function Kh(e){var t=e.h.playbackRate,n=e.V();if(e.g.streaming.vodDynamicPlaybackRate&&!n){var i=e.g.streaming.vodDynamicPlaybackRateLowBufferRate,r=e.Jg();r<=e.g.streaming.vodDynamicPlaybackRateBufferRatio?t!=i&&e.Pd(i):1==r&&t!==e.I.nc()&&e.md()}if(n&&(n=e.Qb(),Number.isFinite(n.end)&&!(e.h.currentTime<n.start))){i=e.g.streaming.liveSync.targetLatencyTolerance,r=e.g.streaming.liveSync.dynamicTargetLatency.enabled;var a=e.g.streaming.liveSync.dynamicTargetLatency.stabilityThreshold;if(e.g.streaming.liveSync&&e.g.streaming.liveSync.enabled)var s=e.g.streaming.liveSync.targetLatency,o=s+i,l=Math.max(0,s-i),u=e.g.streaming.liveSync.maxPlaybackRate,c=e.g.streaming.liveSync.minPlaybackRate;else e.i&&e.i.serviceDescription&&(s=e.i.serviceDescription.targetLatency,null!=e.i.serviceDescription.targetLatency?o=e.i.serviceDescription.targetLatency+i:null!=e.i.serviceDescription.maxLatency&&(o=e.i.serviceDescription.maxLatency),null!=e.i.serviceDescription.targetLatency?l=Math.max(0,e.i.serviceDescription.targetLatency-i):null!=e.i.serviceDescription.minLatency&&(l=e.i.serviceDescription.minLatency),u=e.i.serviceDescription.maxPlaybackRate||e.g.streaming.liveSync.maxPlaybackRate,c=e.i.serviceDescription.minPlaybackRate||e.g.streaming.liveSync.minPlaybackRate);e.R||"number"!==typeof s||(e.R=s);var d=e.g.streaming.liveSync.dynamicTargetLatency.maxAttempts;r&&e.Da&&null!==e.R&&"number"===typeof s&&e.Ne<d&&Date.now()-e.Da>1e3*a&&(a=e.g.streaming.liveSync.dynamicTargetLatency.minLatency,e.R=Math.max(e.R-(s-a)/2,a+i),e.Da=Date.now()),r&&null!==e.R&&(o=e.R+i,l=e.R-i),s=n.end-e.h.currentTime,i=0,e.l==vf&&(r=e.h.buffered,0<r.length&&(i=r.end(r.length-1),i=Math.max(u,i-n.end))),n=e.g.streaming.liveSync.panicMode,r=1e3*e.g.streaming.liveSync.panicThreshold,a=Date.now()-e.L.h,n&&!c&&(c=e.g.streaming.liveSync.minPlaybackRate),n&&c&&a<=r?t!=c&&e.Pd(c):o&&u&&s-i>o?(t!=u&&e.Pd(u),e.Da=null):l&&c&&s-i<l?(t!=c&&e.Pd(c),e.Da=null):t!==e.I.nc()&&(e.md(),e.Da=Date.now())}}function $h(e){if(e.h){var t,n=!1,i=e.h.currentTime/e.h.duration;if(isNaN(i)||(i=Math.round(100*i),isNaN(e.U)?(e.U=i,n=!0):(i=Math.max(e.U,i),e.U!=i&&(e.U=i,n=!0))),n)0==e.U?t=ih("started"):25==e.U?t=ih("firstquartile"):50==e.U?t=ih("midpoint"):75==e.U?t=ih("thirdquartile"):100==e.U&&(t=ih("complete")),t&&e.dispatchEvent(t)}}function Wh(e){try{Vs(e.xe,e.i)}catch(t){return sf(e,t),!1}var t=Wi(e.i.variants);return t=e.za.create(t),e.o.setVariants(Array.from(t.values())),!0}function qh(e,t){return t=void 0!==t&&t,Wh(e)?e.o.chooseVariant(t):null}function Yh(e,t,n,i,r){t=void 0===t||t,n=void 0===n?0:n,i=void 0!==i&&i,r=void 0===r||r;var a=qh(e);a&&Xh(e,a,r,t,n,i)}function Xh(e,t,n,i,r,a){a=void 0!==a&&a;var s=e.j.j;if(t==s)i&&Wu(e.j,t,i,r,!0);else{var o=e.s.h;o.h!=t&&(o.h=t,o.g.push({timestamp:Date.now()/1e3,id:t.id,type:"variant",fromAdaptation:n,bandwidth:t.bandwidth})),Wu(e.j,t,i,r,a,n),i=null,s&&(i=Bi(s)),t=Bi(t),n?(n=(new Map).set("oldTrack",i).set("newTrack",t),e.K&&$o(e.K,t,e.Ff()),n=ih("adaptation",n),df(e,n)):ef(e,i,t)}}function Qh(e,t){var n=Array.from(e.h.audioTracks).find(function(e){return e.enabled});t.enabled=!0,n&&(t.id!==n.id&&(n.enabled=!1),n=zi(n),t=zi(t),ef(e,n,t))}function Zh(e,t,n){if(0==e.g.autoShowText)return!1;if(1==e.g.autoShowText)return!0;var i=hi(e.g.preferredTextLanguage);return n=hi(n.language),2==e.g.autoShowText?ui(n,i):3==e.g.autoShowText?!!t&&(e=hi(t.language),ui(n,i)&&!ui(e,n)):(Z("Invalid autoShowText setting!"),!1)}function Jh(e){var t=ih("trackschanged");df(e,t)}function ef(e,t,n){t=(new Map).set("oldTrack",t).set("newTrack",n),e.K&&$o(e.K,n,e.Ff()),n=ih("variantchanged",t),df(e,n)}function tf(e){var t=ih("textchanged");df(e,t)}function nf(e){var t=ih("texttrackvisibility");df(e,t)}function rf(e){e.g.abr.enabled||af(e);var t=(new Map).set("newStatus",e.g.abr.enabled);df(e,ih("abrstatuschanged",t))}function af(e,t){if(t=void 0===t||t,e.l==mf){e.Ee.stop();for(var n=c(e.i.variants),i=n.next();!i.done;i=n.next())i.value.disabledUntilTime=0;t&&Wh(e)}}function sf(e,t){var n,i,r;return N(function(a){switch(a.g){case 1:if(e.l==pf)return a.return();if(1===t.severity&&e.s.K++,n=!0,!(e.Ea&&e.i&&e.j)||3016!=t.code&&3014!=t.code&&3015!=t.code&&3018!=t.code){a.u(2);break}return E(a,3),_(a,Sc(e.j),5);case 5:i=a.h,n=!i,A(a,2);break;case 3:k(a),n=!0;case 2:if(!n)return a.return();2===t.severity&&af(e,!1),r=ih("error",(new Map).set("detail",t)),e.dispatchEvent(r),r.defaultPrevented&&(t.handled=!0),w(a)}})}function of(e,t,n,i){i=void 0===i?e:i,e=(new Map).set("detail",{schemeIdUri:n.schemeIdUri,value:n.value,startTime:n.startTime,endTime:n.endTime,id:n.id,eventElement:n.eventElement,eventNode:n.eventNode}),i.dispatchEvent(ih(t,e))}function lf(e,t,n,i){i=void 0!==i&&i,t=(new Map).set("mediaQuality",{bandwidth:t.bandwidth,audioSamplingRate:t.audioSamplingRate,codecs:t.codecs,contentType:t.contentType,frameRate:t.frameRate,height:t.height,mimeType:t.mimeType,channelsCount:t.channelsCount,pixelAspectRatio:t.pixelAspectRatio,width:t.width,label:t.label,roles:t.roles,language:t.language}).set("position",n),e.dispatchEvent(ih(i?"audiotrackchanged":"mediaqualitychanged",t))}function uf(e){if(!e.h.error)return null;var t=e.h.error.code;if(1==t)return null;var n=e.h.error.msExtendedCode;return n&&(0>n&&(n+=Math.pow(2,32)),n=n.toString(16)),new It(2,3,3016,t,n,e.h.error.message)}function cf(e,t,n){0<t&&(e.V()||e.qh(t)),t=e.getDuration(),n<t&&(e.V()||e.$a(n))}function df(e,t){N(function(n){if(1==n.g)return _(n,Promise.resolve(),2);e.l!=pf&&e.dispatchEvent(t),w(n)})}function hf(e){var t=new Set;e=c(e);for(var n=e.next();!n.done;n=e.next())n=n.value,n.language?t.add(hi(n.language)):t.add("und");return t}function ff(e){var t=new Map,n=new Map;e=c(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;var r="und",a=[];i.language&&(r=hi(i.language)),a="variant"==i.type?i.audioRoles:i.roles,a&&a.length||(a=[""]),t.has(r)||t.set(r,new Set),a=c(a);for(var s=a.next();!s.done;s=a.next())s=s.value,t.get(r).add(s),i.label&&(n.has(r)||n.set(r,new Map),n.get(r).set(s,i.label))}var o=[];return t.forEach(function(e,t){e=c(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;var r=null;n.has(t)&&n.get(t).has(i)&&(r=n.get(t).get(i)),o.push({language:t,role:i,label:r})}}),o}Zd.prototype.release=function(){0<this.h.length?this.h.shift()():this.g=null},y(eh,Br),i=eh.prototype,i.destroy=function(){var e,t=this;return N(function(n){switch(n.g){case 1:return t.l==pf?n.return():(th(t),e=t.detach(),t.l=pf,_(n,e,2));case 2:return _(n,t.lf(),3);case 3:if(t.Je&&(t.Je.release(),t.Je=null),t.zd&&(t.zd.release(),t.zd=null),t.m&&(t.m.release(),t.m=null),t.Fa&&(t.Fa.release(),t.Fa=null),t.wb&&(t.wb.release(),t.wb=null),t.xa=null,t.g=null,t.s=null,t.ze=null,t.N=null,t.ea=null,!t.H){n.u(4);break}return _(n,t.H.destroy(),5);case 5:t.H=null;case 4:t.o&&(t.o.release(),t.o=null),Br.prototype.release.call(t),w(n)}})},i.Ub=function(e,t){t=void 0===t||t;var n,i,r,a=this;return N(function(s){switch(s.g){case 1:if(a.l==pf)throw new It(2,7,7e3);if(n=a.h&&a.h==e,!a.h||a.h==e){s.u(2);break}return _(s,a.detach(),2);case 2:return _(s,ah(a,"attach"),4);case 4:if(s.h)return s.return();if(E(s,5,6),n||(rh(a,"attach"),i=function(){var e=uf(a);e&&sf(a,e)},a.zd.D(e,"error",i),a.h=e),!t||!Ft()||a.G){s.u(6);break}return _(s,hh(a),6);case 6:I(s),a.Z.release(),C(s,0);break;case 5:return r=k(s),_(s,a.detach(),10);case 10:throw r}})},i.Gh=function(e){this.tg=e},i.detach=function(e){e=void 0!==e&&e;var t=this;return N(function(n){if(1==n.g){if(t.l==pf)throw new It(2,7,7e3);return _(n,t.dc(!1,e),2)}if(3!=n.g)return _(n,ah(t,"detach"),3);if(n.h)return n.return();try{t.h&&(t.zd.Ra(),t.h=null),rh(t,"detach"),t.A&&!e&&t.A.release()}finally{t.Z.release()}w(n)})},i.dc=function(e,t){e=void 0===e||e,t=void 0!==t&&t;var n,i,r,a,s,o,l,u,d,h=this;return N(function(f){switch(f.g){case 1:return h.l!=pf&&(h.l=gf),_(f,ah(h,"unload"),2);case 2:return f.h?f.return():(x(f,3),h.Ea=!1,rh(h,"unload"),e&&!Ft()&&(e=!1),th(h),n=h.Ed.map(function(e){return e()}),h.Ed=[],_(f,Promise.all(n),5));case 5:if(h.dispatchEvent(ih("unloading")),h.wd&&(h.wd.release(),h.wd=null),h.h&&(h.m.Ra(),h.Fa.Ra()),h.Ee.stop(),h.Hb&&(h.Hb.release(),h.Hb=null),h.Ce&&(h.Ce.stop(),h.Ce=null),!h.F){f.u(6);break}return _(f,h.F.stop(),7);case 7:h.F=null,h.bb=null;case 6:if(!h.o){f.u(8);break}return _(f,h.o.stop(),8);case 8:if(!h.j){f.u(10);break}return _(f,h.j.destroy(),11);case 11:h.j=null;case 10:if(h.I&&(h.I.release(),h.I=null),h.C&&(h.C.release(),h.C=null),!on("webkit")||!h.B){f.u(12);break}return _(f,h.B.destroy(),13);case 13:h.B=null;case 12:if(!h.G){f.u(14);break}return _(f,h.G.destroy(),15);case 15:h.G=null;case 14:if(h.A&&!t&&h.A.onAssetUnload(),h.aa&&!t&&(h.aa.destroy(),h.aa=null),t||h.sg.stop(),h.N&&kd(h.N),h.ea&&(h.ea.g=null),h.h&&gd(h.h),!h.h||!h.h.src){f.u(16);break}return _(f,new Promise(function(e){return new Ut(e).Y(.1)}),17);case 17:h.h.removeAttribute("src"),h.h.load();case 16:if(!h.B){f.u(18);break}return _(f,h.B.destroy(),19);case 19:h.B=null;case 18:if(h.ra&&h.da!=h.ra.Gc()&&(h.ra.s||h.ra.destroy(),h.ra=null),h.da=null,h.pg=null,h.L=null,h.i){for(i=c(h.i.variants),r=i.next();!r.done;r=i.next())for(a=r.value,s=c([a.audio,a.video]),o=s.next();!o.done;o=s.next())(l=o.value)&&l.segmentIndex&&l.segmentIndex.release();for(u=c(h.i.textStreams),o=u.next();!o.done;o=u.next())d=o.value,d.segmentIndex&&d.segmentIndex.release()}h.g.streaming.clearDecodingCache&&(Qi={},Ot.clear()),h.i=null,h.s=new pu,h.qg=null,h.Da=null,h.R=null,h.Ne=-1,h.Hd=[],h.U=NaN,Gh(h);case 3:I(f),h.Z.release(),C(f,4);break;case 4:if(e&&Ft()&&!h.G&&h.h)return _(f,hh(h),0);f.u(0)}})},i.lj=function(e){this.qa=e},i.load=function(e,t,n){t=void 0===t?null:t;var i,r,a,s,o,l,u,c,d,h,f,p,g,m=this;return N(function(v){switch(v.g){case 1:if(m.l==pf)throw new It(2,7,7e3);return i=null,r="",e instanceof Fc?(i=e,r=i.Gc()||""):r=e||"",_(v,Jd(m.Z,"load"),2);case 2:if(m.Z.release(),!m.h)throw new It(2,7,7002);if(!m.da){v.u(3);break}return m.da=r,_(v,m.dc(!1),3);case 3:if(a=++m.Le,s=function(){return N(function(e){if(1==e.g)return m.Le==a?e.u(0):i?_(e,i.destroy(),3):e.u(3);throw new It(2,7,7e3)})},o=function(e,t){return N(function(n){switch(n.g){case 1:return x(n,2),_(n,Jd(m.Z,t),4);case 4:return _(n,s(),5);case 5:return _(n,e(),6);case 6:return _(n,s(),7);case 7:i&&m.g&&(i.g=m.g);case 2:I(n),m.Z.release(),C(n,0)}})},E(v,5,6),null==t&&i&&(t=i.getStartTime()),m.qa=t,m.Ea=!1,m.dispatchEvent(ih("loading")),i){n=i.U,v.u(8);break}if(n){v.u(8);break}return _(v,o(function(){return N(function(e){if(1==e.g)return _(e,ch(m,r),2);n=e.h,w(e)})},"guessMimeType_"),8);case 8:if(l=!!i,i){jc(i,m),m.s=i.getStats(),v.u(11);break}return _(v,lh(m,r,t,n,!0),12);case 12:(i=v.h)?(jc(i,m),m.s=i.getStats(),i.start(),i.m.catch(function(){})):m.s=new pu;case 11:if(u=!i,c=Date.now()/1e3,m.s=i?i.getStats():new pu,m.da=r,m.pg=n||null,u)return _(v,o(function(){return N(function(e){return _(e,ph(m,n),0)})},"initializeSrcEqualsDrmInner_"),20);if(m.G){v.u(15);break}return _(v,o(function(){return N(function(e){return _(e,hh(m),0)})},"initializeMediaSourceEngineInner_"),15);case 15:return _(v,o(function(){return N(function(e){return _(e,i.m,0)})},"waitForFinish"),17);case 17:return m.g=i.getConfiguration(),m.xe=i.C,m.bb=i.F,m.F=Hc(i),m.F&&m.F.setMediaElement&&m.h&&m.F.setMediaElement(m.h),m.wd=zc(i),m.rd=i.za,m.i=i.Ef(),(d=i.o)&&(m.za=d),l&&m.h&&"AUDIO"===m.h.nodeName&&(sh(m),m.configure("manifest.disableVideo",!0)),m.B=Kc(i),_(v,o(function(){return N(function(e){return _(e,m.B.Ub(m.h),0)})},"drmEngine_.attach"),18);case 18:return!(h=i.B)||m.xa&&m.xa==h||(m.o=Gc(i),m.xa=i.B,"function"!=typeof m.o.setMediaElement&&(pe("AbrManager w/o setMediaElement","Please use an AbrManager with setMediaElement function."),m.o.setMediaElement=function(){}),"function"!=typeof m.o.setCmsdManager&&(pe("AbrManager w/o setCmsdManager","Please use an AbrManager with setCmsdManager function."),m.o.setCmsdManager=function(){}),"function"!=typeof m.o.trySuggestStreams&&(pe("AbrManager w/o trySuggestStreams","Please use an AbrManager with trySuggestStreams function."),m.o.trySuggestStreams=function(){})),f=$c(i),p=i.fa,_(v,o(function(){return N(function(e){return _(e,fh(m,c,p,f),0)})},"loadInner_"),19);case 19:Vc(i),v.u(14);break;case 20:return _(v,o(function(){return N(function(e){return _(e,gh(m,c,n),0)})},"srcEqualsInner_"),14);case 14:m.dispatchEvent(ih("loaded"));case 6:if(I(v),!i){v.u(22);break}return _(v,i.destroy(),22);case 22:m.ra=null,C(v,0);break;case 5:if(g=k(v),7e3==g.code){v.u(24);break}return _(v,m.dc(!1),24);case 24:throw g}})},i.hj=function(e,t){e=void 0===e||e,t=void 0!==t&&t;var n,i=this;return N(function(r){return 1==r.g?_(r,oh(i),2):3!=r.g?(n=r.h,_(r,i.dc(e,t),3)):r.return(n)})},i.Eg=function(e,t){e=void 0!==e&&e,t=void 0!==t&&t;var n,i=this;return N(function(r){return 1==r.g?_(r,oh(i,t),2):3!=r.g?(n=r.h,_(r,i.detach(e),3)):r.return(n)})},i.preload=function(e,t,n){t=void 0===t?null:t;var i,r=this;return N(function(a){return 1==a.g?_(a,lh(r,e,t,n),2):((i=a.h)?i.start():sf(r,new It(2,7,7005)),a.return(i))})},i.lf=function(){var e,t,n,i,r=this;return N(function(a){for(e=[],t=c(r.Fe),n=t.next();!n.done;n=t.next())i=n.value,i.s||e.push(i.destroy());return r.Fe=[],_(a,Promise.all(e),0)})},i.Qi=function(){for(var e=this.Z;e.g;)e.release()},i.Dc=function(e){return new Ja(e)},i.configure=function(e,t){if(2==arguments.length&&"string"==typeof e&&(e=Ec(e,t)),e.streaming&&"forceTransmuxTS"in e.streaming&&(pe("streaming.forceTransmuxTS configuration","Please Use mediaSource.forceTransmux instead."),e.mediaSource.mediaSource=e.streaming.forceTransmuxTS,delete e.streaming.forceTransmuxTS),e.streaming&&"forceTransmux"in e.streaming&&(pe("streaming.forceTransmux configuration","Please Use mediaSource.forceTransmux instead."),e.mediaSource.mediaSource=e.streaming.forceTransmux,delete e.streaming.forceTransmux),e.streaming&&"useNativeHlsOnSafari"in e.streaming&&(pe("streaming.useNativeHlsOnSafari configuration","Please Use streaming.useNativeHlsForFairPlay or streaming.preferNativeHls instead."),e.streaming.preferNativeHls=e.streaming.useNativeHlsOnSafari&&Yt(),delete e.streaming.useNativeHlsOnSafari),e.streaming&&"boolean"==typeof e.streaming.liveSync){pe("streaming.liveSync","Please Use streaming.liveSync.enabled instead.");var n=e.streaming.liveSync;e.streaming.liveSync={},e.streaming.liveSync.enabled=n}if(e.streaming&&!(e.streaming.liveSync&&"targetLatency"in e.streaming.liveSync)&&("liveSyncMinLatency"in e.streaming||"liveSyncMaxLatency"in e.streaming)){n=e.streaming.liveSyncMinLatency||0;var i=Math.abs((e.streaming.liveSyncMaxLatency||1)-n)/2;e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.targetLatency=n+i,e.streaming.liveSync.targetLatencyTolerance=i}if(e.streaming&&"liveSyncMaxLatency"in e.streaming&&(pe("streaming.liveSyncMaxLatency","Please Use streaming.liveSync.targetLatency and streaming.liveSync.targetLatencyTolerance instead. Or, set the values in your DASH manifest"),delete e.streaming.liveSyncMaxLatency),e.streaming&&"liveSyncMinLatency"in e.streaming&&(pe("streaming.liveSyncMinLatency","Please Use streaming.liveSync.targetLatency and streaming.liveSync.targetLatencyTolerance instead. Or, set the values in your DASH manifest"),delete e.streaming.liveSyncMinLatency),e.streaming&&"liveSyncTargetLatency"in e.streaming&&(pe("streaming.liveSyncTargetLatency","Please Use streaming.liveSync.targetLatency instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.targetLatency=e.streaming.liveSyncTargetLatency,delete e.streaming.liveSyncTargetLatency),e.streaming&&"liveSyncTargetLatencyTolerance"in e.streaming&&(pe("streaming.liveSyncTargetLatencyTolerance","Please Use streaming.liveSync.targetLatencyTolerance instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.targetLatencyTolerance=e.streaming.liveSyncTargetLatencyTolerance,delete e.streaming.liveSyncTargetLatencyTolerance),e.streaming&&"liveSyncPlaybackRate"in e.streaming&&(pe("streaming.liveSyncPlaybackRate","Please Use streaming.liveSync.maxPlaybackRate instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.maxPlaybackRate=e.streaming.liveSyncPlaybackRate,delete e.streaming.liveSyncPlaybackRate),e.streaming&&"liveSyncMinPlaybackRate"in e.streaming&&(pe("streaming.liveSyncMinPlaybackRate","Please Use streaming.liveSync.minPlaybackRate instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.minPlaybackRate=e.streaming.liveSyncMinPlaybackRate,delete e.streaming.liveSyncMinPlaybackRate),e.streaming&&"liveSyncPanicMode"in e.streaming&&(pe("streaming.liveSyncPanicMode","Please Use streaming.liveSync.panicMode instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.panicMode=e.streaming.liveSyncPanicMode,delete e.streaming.liveSyncPanicMode),e.streaming&&"liveSyncPanicThreshold"in e.streaming&&(pe("streaming.liveSyncPanicThreshold","Please Use streaming.liveSync.panicThreshold instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.panicThreshold=e.streaming.liveSyncPanicThreshold,delete e.streaming.liveSyncPanicThreshold),e.mediaSource&&"sourceBufferExtraFeatures"in e.mediaSource){pe("mediaSource.sourceBufferExtraFeatures configuration","Please Use mediaSource.addExtraFeaturesToSourceBuffer() instead.");var r=e.mediaSource.sourceBufferExtraFeatures;e.mediaSource.addExtraFeaturesToSourceBuffer=function(){return r},delete e.mediaSource.sourceBufferExtraFeatures}return e.streaming&&e.streaming.lowLatencyMode&&(void 0==e.streaming.inaccurateManifestTolerance&&(e.streaming.inaccurateManifestTolerance=0),void 0==e.streaming.rebufferingGoal&&(e.streaming.rebufferingGoal=.01),void 0==e.streaming.segmentPrefetchLimit&&(e.streaming.segmentPrefetchLimit=2),void 0==e.streaming.updateIntervalSeconds&&(e.streaming.updateIntervalSeconds=.1),void 0==e.streaming.maxDisabledTime&&(e.streaming.maxDisabledTime=1),void 0==e.streaming.retryParameters&&(e.streaming.retryParameters={}),void 0==e.streaming.retryParameters.baseDelay&&(e.streaming.retryParameters.baseDelay=100),void 0==e.manifest&&(e.manifest={}),void 0==e.manifest.dash&&(e.manifest.dash={}),void 0==e.manifest.dash.autoCorrectDrift&&(e.manifest.dash.autoCorrectDrift=!1),void 0==e.manifest.retryParameters&&(e.manifest.retryParameters={}),void 0==e.manifest.retryParameters.baseDelay&&(e.manifest.retryParameters.baseDelay=100),void 0==e.drm&&(e.drm={}),void 0==e.drm.retryParameters&&(e.drm.retryParameters={}),void 0==e.drm.retryParameters.baseDelay&&(e.drm.retryParameters.baseDelay=100)),n=Pc(this.g,e,Bh(this)),Rh(this),n},i.getConfiguration=function(){var e=Bh(this);return Pc(e,this.g,Bh(this)),e},i.Og=function(){var e=Bh(this);return Pc(e,this.g,Bh(this)),Ac(this.g,Bh(this))},i.Jg=function(){if(this.h){var e=this.h.buffered.length;e=e?this.h.buffered.end(e-1):0;var t=this.getConfiguration().streaming.bufferingGoal;if(t=Math.min(this.h.currentTime+t,this.Qb().end),e>=t)return 1;if(!(e<=this.h.currentTime)&&e<t)return(e-this.h.currentTime)/(t-this.h.currentTime)}return 0},i.Ui=function(){for(var e in this.g)delete this.g[e];Pc(this.g,Bh(this),Bh(this)),Rh(this)},i.Mg=function(){return this.l},i.Ff=function(){return this.i?this.i.type:null},i.ai=function(){return this.h},i.zb=function(){return this.H},i.Gc=function(){return this.da},i.Ig=function(){return this.A?this.A:null},i.V=function(){return this.i?this.i.presentationTimeline.V():!(!this.h||!this.h.src)&&1/0==this.h.duration},i.qc=function(){return!!this.i&&this.i.presentationTimeline.qc()},i.si=function(){if(this.i){var e=this.i.variants;return!!e.length&&!e[0].video}return!(!this.h||!this.h.src)&&(this.h.videoTracks?0==this.h.videoTracks.length:0==this.h.videoHeight)},i.Qb=function(){if(this.i){if(!this.Ea&&"HLS"==this.i.type)return{start:0,end:0};var e=this.i.presentationTimeline;return{start:e.Yb(),end:e.Ab()}}return this.h&&this.h.src&&(e=this.h.seekable,e.length)?{start:e.start(0),end:e.end(e.length-1)}:{start:0,end:0}},i.oi=function(){this.V()&&(this.h.currentTime=this.Qb().end)},i.ti=function(){return this.Ea},i.keySystem=function(){var e=this.drmInfo();return e?e.keySystem:""},i.drmInfo=function(){return this.B?this.B.g:null},i.td=function(){return this.B?this.B.td():1/0},i.Df=function(){return this.B?this.B.Df():[]},i.ge=function(){return this.B?this.B.ge():{}},i.Jf=function(){return!!this.L&&this.L.g==wr},i.fb=function(){return this.h?this.I?this.I.i:1:0},i.Pd=function(e){var t=this;0==e?Z("A trick play rate of 0 is unsupported!"):(this.Fa.Ra(),this.h.paused&&this.h.play(),this.I.set(e),this.l==mf&&(this.o.playbackRateChanged(e),$u(this.j,1<Math.abs(e))),this.V()&&this.Fa.D(this.h,"timeupdate",function(){var n=t.h.currentTime,i=t.Qb(),r=t.g.streaming.safeSeekOffset;0<e?Math.floor(n)>=Math.floor(i.end)&&t.md():Math.floor(n)<=Math.floor(i.start+r)&&t.md()}))},i.md=function(){var e=this.I.nc();this.l==vf&&this.I.set(e),this.l==mf&&(this.I.set(e),this.o.playbackRateChanged(e),$u(this.j,!1)),this.Fa.Ra()},i.oc=function(){if(this.i){for(var e=this.j?this.j.j:null,t=[],n=0,i=c(this.i.variants),r=i.next();!r.done;r=i.next())if(r=r.value,$i(r)){var a=Bi(r);a.active=r==e,a.active||1==n||null==e||r.video!=e.video||r.audio!=e.audio||(a.active=!0),a.active&&n++,t.push(a)}return t}return this.h&&this.h.audioTracks?Array.from(this.h.audioTracks).map(function(e){return zi(e)}):[]},i.Hc=function(){if(this.i){for(var e=this.j?this.j.s:null,t=[],n=c(this.i.textStreams),i=n.next();!i.done;i=n.next()){i=i.value;var r=Vi(i);r.active=i==e,t.push(r)}return t}return this.h&&this.h.src&&this.h.textTracks?Dh(this).map(function(e){return Hi(e)}):[]},i.Vh=function(){var e=this.Hd;return this.i&&(e=this.i.imageStreams),e.map(function(e){return ji(e)})},i.Nh=function(e){var t,n,i,r,a=this;return N(function(s){return 1==s.g?a.l!=mf&&a.l!=vf?s.return(null):(t=a.Hd,a.i&&(t=a.i.imageStreams),(n=t.find(function(t){return t.id==e}))?n.segmentIndex?s.u(2):_(s,n.createSegmentIndex(),2):s.return(null)):4!=s.g?(i=[],n.segmentIndex.Jb(function(t){var r=Mh(t.tilesLayout||n.tilesLayout);if(r){r=r.rows*r.kc;for(var s=t.j-t.startTime,o=0;o<r;o++)i.push(a.Qg(e,t.startTime+s*o/r))}}),_(s,Promise.all(i),4)):(r=s.h,s.return(r.filter(function(e){return e})))})},i.Qg=function(e,t){var n,i,r,a,s,o,l,u,c,d,h,f,p,g,m,v,y,b,S=this;return N(function(T){return 1==T.g?S.l!=mf&&S.l!=vf?T.return(null):(n=S.Hd,S.i&&(n=S.i.imageStreams),(i=n.find(function(t){return t.id==e}))?i.segmentIndex?T.u(2):_(T,i.createSegmentIndex(),2):T.return(null)):(r=i.segmentIndex.find(t),null==r?T.return(null):(a=i.segmentIndex.get(r),s=Mh(a.tilesLayout||i.tilesLayout),s?(o=i.width||0,l=i.height||0,u=o/s.kc,c=l/s.rows,d=s.kc*s.rows,h=a.j-a.startTime,f=a.A||h/d,p=a.startTime,m=g=0,1<d&&(v=Math.floor((t-a.startTime)/f),p=a.startTime+v*f,g=v%s.kc*u,m=Math.floor(v/s.kc)*c),y=!1,(b=a.s)&&(y=!0,c=b.height,g=b.positionX,m=b.positionY,u=b.width),T.return({segment:a,imageHeight:l,imageWidth:o,height:c,positionX:g,positionY:m,startTime:p,duration:f,uris:a.M(),width:u,sprite:y})):T.return(null)))})},i.hh=function(e){if(this.i&&this.j){var t=this.i.textStreams.find(function(t){return t.id==e.id});t&&t!=this.j.s&&(fu(this.s.h,t,!1),qu(this.j,t),tf(this),this.Fb=t.language)}else if(this.h&&this.h.src&&this.h.textTracks){t=Dh(this),t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value,Gi(n)==e.id?n.mode=this.pa?"showing":"hidden":n.mode="disabled";tf(this)}},i.cg=function(e,t,n){if(t=void 0!==t&&t,n=void 0===n?0:n,this.i&&this.j){var i=this.i.variants.find(function(t){return t.id==e.id});if(i&&$i(i)){var r=this.j.j;this.g.abr.enabled&&(r.video!=i.video||r.audio&&i.audio&&r.audio.language==i.audio.language&&r.audio.channelsCount==i.audio.channelsCount)&&Z("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack()."),Xh(this,i,!1,t,n),this.za=new cr(i,this.g.mediaSource.codecSwitchingStrategy,this.g.manifest.dash.enableAudioGroups),Wh(this)}}else if(this.h&&this.h.audioTracks)for(t=Array.from(this.h.audioTracks),t=c(t),n=t.next();!n.done;n=t.next())if(n=n.value,Gi(n)==e.id){Qh(this,n);break}},i.Ph=function(){return ff(this.oc())},i.hi=function(){return ff(this.Hc())},i.Oh=function(){return Array.from(hf(this.oc()))},i.gi=function(){return Array.from(hf(this.Hc()))},i.gh=function(e,t,n,i,r){if(n=void 0===n?0:n,i=void 0===i?0:i,r=void 0===r?"":r,this.i&&this.C){this.za=new dr(e,t||"",n,"",!1,"","","",this.g.mediaSource.codecSwitchingStrategy,this.g.manifest.dash.enableAudioGroups,r),e=function(e,t){return e.video||t.video?e.video&&t.video?Math.abs((e.video.height||0)-(t.video.height||0))+Math.abs((e.video.width||0)-(t.video.width||0)):1/0:0},t=this.j.j,r=this.za.create(this.i.variants),n=null,r=c(r.values());for(var a=r.next();!a.done;a=r.next())a=a.value,$i(a)&&(!n||e(n,t)>e(a,t))&&(n=a);n!=t&&(n?(e=Bi(n),this.cg(e,!0,i)):Yh(this))}else this.h&&this.h.audioTracks&&(i=qi(this.oc(),e,t||"",!1)[0])&&this.cg(i)},i.bg=function(e,t,n){n=void 0!==n&&n,this.i&&this.C?(this.Fb=e,this.Gd=t||"",this.Fd=n,(e=qi(this.i.textStreams,this.Fb,this.Gd,this.Fd)[0]||null)&&e!=this.j.s&&(fu(this.s.h,e,!1),this.g.streaming.alwaysStreamText||this.Kf())&&(qu(this.j,e),tf(this))):(e=qi(this.Hc(),e,t||"",n)[0])&&this.hh(e)},i.$i=function(e,t,n){if(t=void 0===t||t,n=void 0===n?0:n,this.i&&this.C){for(var i=null,r=c(this.i.variants),a=r.next();!a.done;a=r.next())if(a=a.value,a.audio.label==e){i=a;break}null!=i&&(this.za=new dr(i.language,"",0,"",!1,"",e,"",this.g.mediaSource.codecSwitchingStrategy,this.g.manifest.dash.enableAudioGroups),Yh(this,t,n))}else if(this.h&&this.h.audioTracks){for(n=Array.from(this.h.audioTracks),t=null,n=c(n),i=n.next();!i.done;i=n.next())i=i.value,i.label==e&&(t=i);t&&Qh(this,t)}},i.Kf=function(){var e=this.pa;return this.G&&this.l==mf?this.G.F.isTextVisible():this.h&&this.h.src&&this.h.textTracks?Dh(this).some(function(e){return"showing"==e.mode}):e},i.Kg=function(){return this.h&&this.h.src&&this.h.textTracks?Ph(this).map(function(e){return Hi(e)}):[]},i.Rh=function(e){if(!this.h||!this.h.src||!this.h.textTracks)return[];var t=hi(e),n=Ph(this).filter(function(e){return hi(e.language)==t});if(!n||!n.length)return[];e=[];var i=new Set;n=c(n);for(var r=n.next();!r.done;r=n.next())if((r=r.value)&&r.cues){r=c(r.cues);for(var a=r.next();!a.done;a=r.next()){var s=a.value;(a=s.id)&&""!=a||(a=s.startTime+"-"+s.endTime+"-"+s.text),s={id:a,title:s.text,startTime:s.startTime,endTime:s.endTime},i.has(a)||(e.push(s),i.add(a))}}return e},i.nh=function(e){if(e=!!e,this.pa!=e){if(this.pa=e,this.l==mf)this.G.F.setTextVisibility(e),this.g.streaming.alwaysStreamText||(e?this.j.s||(e=qi(this.i.textStreams,this.Fb,this.Gd,this.Fd),0<e.length&&(qu(this.j,e[0]),tf(this))):Ku(this.j));else if(this.h&&this.h.src&&this.h.textTracks){var t=Dh(this);t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value,"disabled"!=n.mode&&(n.mode=e?"showing":"hidden")}nf(this)}},i.ci=function(){if(this.C)var e=this.C.$d();else{if(null==this.qa)return new Date;e=this.qa}if(this.i){var t=this.i.presentationTimeline;return new Date(1e3*((t.m||t.i)+e))}return this.h&&this.h.getStartDate?(t=this.h.getStartDate(),isNaN(t.getTime())?null:new Date(t.getTime()+1e3*e)):null},i.Pg=function(){if(this.i){var e=this.i.presentationTimeline;return new Date(1e3*(e.m||e.i))}return this.h&&this.h.getStartDate?(e=this.h.getStartDate(),isNaN(e.getTime())?null:e):null},i.je=function(){return this.V()&&this.i?this.i.presentationTimeline.je():null},i.yb=function(){if(this.l==mf)return this.G.yb();var e={total:[],audio:[],video:[],text:[]};return this.l==vf&&(e.total=so(this.h.buffered)),e},i.getStats=function(){if(this.l!=mf&&this.l!=vf)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,stallsDetected:NaN,gapsJumped:NaN,estimatedBandwidth:NaN,completionPercent:NaN,loadLatency:NaN,manifestTimeSeconds:NaN,drmTimeSeconds:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,liveLatency:NaN,maxSegmentDuration:NaN,manifestSizeBytes:NaN,bytesDownloaded:NaN,nonFatalErrorCount:NaN,manifestPeriodCount:NaN,manifestGapCount:NaN,switchHistory:[],stateHistory:[]};zh(this);var e=this.h,t=e.currentTime/e.duration;if(!isNaN(t)&&!this.V()){var n=this.s;t=Math.round(100*t),n.i=isNaN(n.i)?t:Math.max(n.i,t)}if(this.C&&(this.s.U=this.C.ug(),this.s.Z=this.C.vg()),e.getVideoPlaybackQuality){n=e.getVideoPlaybackQuality(),t=this.s;var i=Number(n.totalVideoFrames);t.R=Number(n.droppedVideoFrames),t.N=i,this.s.L=Number(n.corruptedVideoFrames)}if(this.B?(n=this.B,n=n.I?n.I:NaN):n=NaN,this.s.s=n,this.l==mf){if(n=this.j.j,t=this.j.s,n){i=this.I?this.I.i:1;var r=i*n.bandwidth;t&&t.bandwidth&&(r+=i*t.bandwidth),this.s.B=r}n&&n.video&&(t=this.s,i=n.video.height||NaN,t.o=n.video.width||NaN,t.l=i),this.V()&&(n=this.Pg().valueOf()+1e3*e.currentTime,this.s.C=(Date.now()-n)/1e3),this.i&&(this.s.G=this.i.periodCount,this.s.F=this.i.gapCount,this.i.presentationTimeline&&(this.s.I=this.i.presentationTimeline.g)),n=this.o.getBandwidthEstimate(),this.s.A=n}this.l==vf&&(n=this.s,t=e.videoHeight||NaN,n.o=e.videoWidth||NaN,n.l=t);var a=this.s;e=a.o,n=a.l,t=a.B,i=a.N,r=a.R;var s=a.L,o=a.Z,l=a.U,u=a.A,d=a.i,h=a.m,f=a.H,p=a.j,g=cu(a.g,"playing"),m=cu(a.g,"paused"),v=cu(a.g,"buffering"),y=a.s,b=a.C,S=a.I,T=a.Ug,_=a.ae,w=a.K,E=a.G,x=a.F,A=du(a.g),k=[];a=c(a.h.g);for(var I=a.next();!I.done;I=a.next())I=I.value,k.push({timestamp:I.timestamp,id:I.id,type:I.type,fromAdaptation:I.fromAdaptation,bandwidth:I.bandwidth});return{width:e,height:n,streamBandwidth:t,decodedFrames:i,droppedFrames:r,corruptedFrames:s,stallsDetected:o,gapsJumped:l,estimatedBandwidth:u,completionPercent:d,loadLatency:h,manifestTimeSeconds:f,drmTimeSeconds:p,playTime:g,pauseTime:m,bufferingTime:v,licenseTime:y,liveLatency:b,maxSegmentDuration:S,manifestSizeBytes:T,bytesDownloaded:_,nonFatalErrorCount:w,manifestPeriodCount:E,manifestGapCount:x,stateHistory:A,switchHistory:k}},i.Bh=function(e,t,n,i,r,a,s){s=void 0!==s&&s;var o,l,u,c,d,h,f,p,g,m,v,y,b=this;return N(function(S){switch(S.g){case 1:if(b.l!=mf&&b.l!=vf)throw new It(1,7,7004);if("subtitles"!=n&&"captions"!=n&&Z("Using a kind value different of `subtitles` or `captions` can cause unwanted issues."),i){S.u(2);break}return _(S,Oh(b,e),3);case 3:i=S.h;case 2:if(o=[],b.A&&(o=b.A.getCuePoints()),b.l!=vf){S.u(4);break}return s&&(n="forced"),_(S,Nh(b,e,t,n,i,a||"",o),5);case 5:if(l=hi(t),u=b.Hc(),c=u.find(function(e){return hi(e.language)==l&&e.label==(a||"")&&e.kind==n}))return Jh(b),S.return(c);throw new It(1,2,2012);case 4:if(d=Pn,h=b.h.duration,b.i&&(h=b.i.presentationTimeline.getDuration()),1/0==h)throw new It(1,4,4033);if(!o.length){S.u(6);break}return _(S,Uh(b,e,b.H,b.g.streaming.retryParameters),7);case 7:f=S.h,p=Fh(b,f,i,o),g=new Blob([p],{type:"text/vtt"}),e=Ml(g),i="text/vtt";case 6:if(m={id:b.rg++,originalId:null,groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:nu(0,h,[e]),mimeType:i||"",codecs:r||"",kind:n,encrypted:!1,drmInfos:[],keyIds:new Set,language:t,originalLanguage:t,label:a||null,type:d.ta,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!!s,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,accessibilityPurpose:null,external:!0,fastSwitching:!1,fullMimeTypes:new Set([Fn(i||"",r||"")])},v=Fn(m.mimeType,m.codecs),y=Zn(v),!y)throw new It(2,2,2014,i);return b.i.textStreams.push(m),Jh(b),S.return(Vi(m))}})},i.Ch=function(e,t){var n,i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b=this;return N(function(S){switch(S.g){case 1:if(b.l!=mf&&b.l!=vf)throw new It(1,7,7004);if(t){S.u(2);break}return _(S,Oh(b,e),3);case 3:t=S.h;case 2:if("text/vtt"!=t)throw new It(1,2,2017,e);if(n=Pn,i=b.h.duration,b.i&&(i=b.i.presentationTimeline.getDuration()),1/0==i)throw new It(1,4,4045);return _(S,Uh(b,e,b.H,b.g.streaming.retryParameters),4);case 4:if(r=S.h,a=ri[t],!a)throw new It(2,2,2014,t);for(s=a(),o={periodStart:0,segmentStart:0,segmentEnd:i,vttOffset:0},l=Ee(r),u=s.parseMedia(l,o,e),d=[],h={},f=c(u),p=f.next();!p.done;h={hd:h.hd,hc:h.hc},p=f.next())h.hc=p.value,h.hd=null,g=function(t){return function(){return null==t.hd&&(t.hd=kn([e],[t.hc.payload])),t.hd||[]}}(h),m=new Qs(h.hc.startTime,h.hc.endTime,g,0,null,null,0,0,1/0),h.hc.payload.includes("#xywh")&&(v=h.hc.payload.split("#xywh=")[1].split(","),4===v.length&&m.oh({height:parseInt(v[3],10),positionX:parseInt(v[0],10),positionY:parseInt(v[1],10),width:parseInt(v[2],10)})),d.push(m);return y={id:b.rg++,originalId:null,groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new tu(d),mimeType:t||"",codecs:"",kind:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"und",originalLanguage:null,label:null,type:n.Ze,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,tilesLayout:"1x1",accessibilityPurpose:null,external:!0,fastSwitching:!1,fullMimeTypes:new Set([Fn(t||"","")])},b.l==vf?b.Hd.push(y):b.i.imageStreams.push(y),Jh(b),S.return(ji(y))}})},i.Ah=function(e,t,n){var i,r,a,s,o=this;return N(function(l){switch(l.g){case 1:if(o.l!=mf&&o.l!=vf)throw new It(1,7,7004);if(n){l.u(2);break}return _(l,Oh(o,e),3);case 3:n=l.h;case 2:return i=[],o.A&&(i=o.A.getCuePoints()),_(l,Nh(o,e,t,"chapters",n,"",i),4);case 4:if(r=l.h,a=o.Kg(),s=a.find(function(e){return e.language==t}),!s){l.u(5);break}return _(l,new Promise(function(e,t){o.m.ha(r,"load",e),o.m.ha(r,"error",function(){t(new It(1,2,2015))})}),6);case 6:return Jh(o),l.return(s);case 5:throw new It(1,2,2012)}})},i.ej=function(e,t){this.fa.width=e,this.fa.height=t},i.Zf=function(e){if(this.l==mf){var t=this.j;if(e=void 0===e?.1:e,t.m.g)t=!1;else if(t.A)t=!1;else{for(var n=c(t.i.values()),i=n.next();!i.done;i=n.next())i=i.value,!i.yd||i.Qa||i.ub||(i.yd=!1,mc(t,i,e));t=!0}}else t=!1;return t},i.Ef=function(){return Z("Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for."),this.i},i.Yh=function(){return this.bb},i.rh=function(e){this.ze=e},i.disableStream=function(e,t){if(!this.g.abr.enabled||this.l===pf||!navigator.onLine||0==t)return!1;if(this.i.variants.some(function(t){var n=t[e.type];return!(!n||n.id===e.id||t.disabledUntilTime)&&("audio"!=e.type||e.language===n.language)})){for(var n=c(this.i.variants),i=n.next();!i.done;i=n.next()){i=i.value;var r=i[e.type];r&&r.id===e.id&&(i.disabledUntilTime=Date.now()/1e3+t)}return this.Ee.Sa(1),t=this.yb().video.reduce(function(e,t){return e+t.end-t.start},0),Yh(this,!1,t,!0,!1),!0}return!1},z("shaka.Player",eh),eh.prototype.setVideoContainer=eh.prototype.rh,eh.prototype.getManifestParserFactory=eh.prototype.Yh,eh.prototype.getManifest=eh.prototype.Ef,eh.prototype.retryStreaming=eh.prototype.Zf,eh.prototype.setMaxHardwareResolution=eh.prototype.ej,eh.prototype.addChaptersTrack=eh.prototype.Ah,eh.prototype.addThumbnailsTrack=eh.prototype.Ch,eh.prototype.addTextTrackAsync=eh.prototype.Bh,eh.prototype.getStats=eh.prototype.getStats,eh.prototype.getBufferedInfo=eh.prototype.yb,eh.prototype.getSegmentAvailabilityDuration=eh.prototype.je,eh.prototype.getPresentationStartTimeAsDate=eh.prototype.Pg,eh.prototype.getPlayheadTimeAsDate=eh.prototype.ci,eh.prototype.setTextTrackVisibility=eh.prototype.nh,eh.prototype.getChapters=eh.prototype.Rh,eh.prototype.getChaptersTracks=eh.prototype.Kg,eh.prototype.isTextTrackVisible=eh.prototype.Kf,eh.prototype.selectVariantsByLabel=eh.prototype.$i,eh.prototype.selectTextLanguage=eh.prototype.bg,eh.prototype.selectAudioLanguage=eh.prototype.gh,eh.prototype.getTextLanguages=eh.prototype.gi,eh.prototype.getAudioLanguages=eh.prototype.Oh,eh.prototype.getTextLanguagesAndRoles=eh.prototype.hi,eh.prototype.getAudioLanguagesAndRoles=eh.prototype.Ph,eh.prototype.selectVariantTrack=eh.prototype.cg,eh.prototype.selectTextTrack=eh.prototype.hh,eh.prototype.getThumbnails=eh.prototype.Qg,eh.prototype.getAllThumbnails=eh.prototype.Nh,eh.prototype.getImageTracks=eh.prototype.Vh,eh.prototype.getTextTracks=eh.prototype.Hc,eh.prototype.getVariantTracks=eh.prototype.oc,eh.prototype.cancelTrickPlay=eh.prototype.md,eh.prototype.trickPlay=eh.prototype.Pd,eh.prototype.getPlaybackRate=eh.prototype.fb,eh.prototype.isBuffering=eh.prototype.Jf,eh.prototype.getKeyStatuses=eh.prototype.ge,eh.prototype.getActiveSessionsMetadata=eh.prototype.Df,eh.prototype.getExpiration=eh.prototype.td,eh.prototype.drmInfo=eh.prototype.drmInfo,eh.prototype.keySystem=eh.prototype.keySystem,eh.prototype.isFullyLoaded=eh.prototype.ti,eh.prototype.goToLive=eh.prototype.oi,eh.prototype.seekRange=eh.prototype.Qb,eh.prototype.isAudioOnly=eh.prototype.si,eh.prototype.isInProgress=eh.prototype.qc,eh.prototype.isLive=eh.prototype.V,eh.prototype.getAdManager=eh.prototype.Ig,eh.prototype.getAssetUri=eh.prototype.Gc,eh.prototype.getNetworkingEngine=eh.prototype.zb,eh.prototype.getMediaElement=eh.prototype.ai,eh.prototype.getManifestType=eh.prototype.Ff,eh.prototype.getLoadMode=eh.prototype.Mg,eh.prototype.resetConfiguration=eh.prototype.Ui,eh.prototype.getBufferFullness=eh.prototype.Jg,eh.prototype.getNonDefaultConfiguration=eh.prototype.Og,eh.prototype.getConfiguration=eh.prototype.getConfiguration,eh.prototype.configure=eh.prototype.configure,eh.prototype.releaseAllMutexes=eh.prototype.Qi,eh.prototype.destroyAllPreloads=eh.prototype.lf,eh.prototype.preload=eh.prototype.preload,eh.prototype.detachAndSavePreload=eh.prototype.Eg,eh.prototype.unloadAndSavePreload=eh.prototype.hj,eh.prototype.load=eh.prototype.load,eh.prototype.updateStartTime=eh.prototype.lj,eh.prototype.unload=eh.prototype.dc,eh.prototype.detach=eh.prototype.detach,eh.prototype.attachCanvas=eh.prototype.Gh,eh.prototype.attach=eh.prototype.Ub,eh.probeSupport=function(e){var t,n,i,r,a,s,o;return e=void 0===e||e,N(function(l){switch(l.g){case 1:if(t={},!e){l.u(2);break}return _(l,ws(),3);case 3:t=l.h;case 2:var u={};if(Ft())for(var h in zs)u[h]=!0;h=c(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"]);for(var f=h.next();!f.done;f=h.next())f=f.value,u[f]=Ft()?!!zs[f]:Bt(f);for(n=u,h='video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",video/mp4; codecs="dvh1.20.01",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="ac-4.02.01.01",audio/mp4; codecs="opus",audio/mp4; codecs="flac",audio/mp4; codecs="dtsc",audio/mp4; codecs="dtse",audio/mp4; codecs="dtsx",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",").concat(d(Xn)),u={},h=c(h),f=h.next();!f.done;f=h.next()){f=f.value,u[f]=!!Zn(f)||(Ft()?ce(f)||!!at(f):Bt(f));var p=f.split(";")[0];u[p]=u[p]||u[f]}return i=u,_(l,ln(),4);case 4:for(o in r=l.h,a={manifest:n,media:i,drm:t,hardwareResolution:r},s=bf,s)a[o]=s[o]();return l.return(a)}})},eh.isBrowserSupported=function(){if(e.Promise||Z("A Promise implementation or polyfill is required"),!(e.Promise&&e.Uint8Array&&Array.prototype.forEach)||an("Trident/"))return!1;var t=en();return!(t&&9>t||!(e.MediaKeys&&e.navigator&&e.navigator.requestMediaKeySystemAccess&&e.MediaKeySystemAccess&&e.MediaKeySystemAccess.prototype.getConfiguration))&&(!!Ft()||Bt("application/x-mpegurl"))},eh.setAdManagerFactory=function(e){Sf=e},eh.registerSupportPlugin=function(e,t){bf[e]=t},eh.prototype.destroy=eh.prototype.destroy;var pf=0,gf=1,mf=2,vf=3;eh.LoadMode={DESTROYED:pf,NOT_LOADED:gf,MEDIA_SOURCE:mf,SRC_EQUALS:vf},eh.version="v4.10.9";var yf=["4","10"];ve=new function(e){this.g=e,this.i=ge,this.h=me}(new fe(Number(yf[0]),Number(yf[1])));var bf={},Sf=null;function Tf(){this.g=[],this.i=this.l=this.j=this.h=0}function _f(e){return e.g.length?e.g.reduce(function(e,t){return e+t},0)/e.g.length:0}function wf(e,t,n){var i=this;this.g=e,this.h=t,this.j=n,this.i=!1,this.l=this.h.getVolume(),this.m=new ae,this.m.D(this.h,google.ima.AdEvent.Type.PAUSED,function(){i.i=!0}),this.m.D(this.h,google.ima.AdEvent.Type.RESUMED,function(){i.i=!1})}function Ef(){}function xf(e,t,n,i,r){var a=this;this.s=e,this.i=t,this.F=!1,this.A=this.o=null,this.G=NaN,this.l=r,this.j=null,this.h=new ae,google.ima.settings.setLocale(n),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),this.C=new google.ima.AdDisplayContainer(this.s,this.i),this.C.initialize(),this.m=new google.ima.AdsLoader(this.C),this.m.getSettings().setPlayerType("shaka-player"),this.m.getSettings().setPlayerVersion("v4.10.9"),this.g=null,this.B=i||new google.ima.AdsRenderingSettings,this.h.D(this.m,google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(e){kf(a,e)}),this.h.D(this.m,google.ima.AdErrorEvent.Type.AD_ERROR,function(e){Af(a,e)}),this.h.D(this.i,"ended",function(){a.m.contentComplete()}),this.h.ha(this.i,"play",function(){a.F=!0})}function Af(e,t){t.getError(),t=(new Map).set("originalEvent",t),e.l(new Nr("ad-error",t)),Mf(e,null),e.l(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",[])))}function kf(t,n){if(t.l(new Nr("ads-loaded",(new Map).set("loadTime",Date.now()/1e3-t.G))),t.o.customPlayheadTracker){var i={currentTime:t.i.currentTime};t.g=n.getAdsManager(i,t.B),t.i.muted?t.g.setVolume(0):t.g.setVolume(t.i.volume),t.h.D(t.i,"timeupdate",function(){t.i.duration&&(i.currentTime=t.i.currentTime)}),t.h.D(t.i,"volumechange",function(){t.j&&(t.j.setVolume(t.i.volume),t.i.muted&&t.j.setMuted(!0))})}else t.g=n.getAdsManager(t.i,t.B);t.l(new Nr("ima-ad-manager-loaded",(new Map).set("imaAdManager",t.g)));var r=t.g.getCuePoints();if(r.length){n=[],r=c(r);for(var a=r.next();!a.done;a=r.next())n.push({start:a.value,end:null});t.l(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",n)))}Cf(t);try{t.g.init(t.i.offsetWidth,t.i.offsetHeight,If(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),t.h.D(t.i,"loadeddata",function(){t.g.resize(t.i.offsetWidth,t.i.offsetHeight,If(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),"ResizeObserver"in e?(t.A=new ResizeObserver(function(){t.g.resize(t.i.offsetWidth,t.i.offsetHeight,If(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),t.A.observe(t.i)):t.h.D(document,"fullscreenchange",function(){t.g.resize(t.i.offsetWidth,t.i.offsetHeight,If(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),t.F||t.o.skipPlayDetection?t.g.start():t.h.ha(t.i,"play",function(){t.F=!0,t.g.start()})}catch(e){Mf(t,null)}}function If(e){return document.fullscreenEnabled?!!document.fullscreenElement:(e=e.i,!!e.webkitSupportsFullscreen&&e.webkitDisplayingFullscreen)}function Cf(e){function t(t,n){t=(new Map).set("originalEvent",t),e.l(new Nr(n,t))}e.h.D(e.g,google.ima.AdErrorEvent.Type.AD_ERROR,function(t){Af(e,t)}),e.h.D(e.g,google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(t){Rf(e,t)}),e.h.D(e.g,google.ima.AdEvent.Type.STARTED,function(t){Rf(e,t)}),e.h.D(e.g,google.ima.AdEvent.Type.FIRST_QUARTILE,function(e){t(e,"ad-first-quartile")}),e.h.D(e.g,google.ima.AdEvent.Type.MIDPOINT,function(e){t(e,"ad-midpoint")}),e.h.D(e.g,google.ima.AdEvent.Type.THIRD_QUARTILE,function(e){t(e,"ad-third-quartile")}),e.h.D(e.g,google.ima.AdEvent.Type.COMPLETE,function(e){t(e,"ad-complete")}),e.h.D(e.g,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(t){Mf(e,t)}),e.h.D(e.g,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(t){Mf(e,t)}),e.h.D(e.g,google.ima.AdEvent.Type.SKIPPED,function(e){t(e,"ad-skipped")}),e.h.D(e.g,google.ima.AdEvent.Type.VOLUME_CHANGED,function(e){t(e,"ad-volume-changed")}),e.h.D(e.g,google.ima.AdEvent.Type.VOLUME_MUTED,function(e){t(e,"ad-muted")}),e.h.D(e.g,google.ima.AdEvent.Type.PAUSED,function(n){e.j&&(e.j.i=!0,t(n,"ad-paused"))}),e.h.D(e.g,google.ima.AdEvent.Type.RESUMED,function(n){e.j&&(e.j.i=!1,t(n,"ad-resumed"))}),e.h.D(e.g,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,function(n){e.j&&t(n,"ad-skip-state-changed")}),e.h.D(e.g,google.ima.AdEvent.Type.CLICK,function(e){t(e,"ad-clicked")}),e.h.D(e.g,google.ima.AdEvent.Type.AD_PROGRESS,function(e){t(e,"ad-progress")}),e.h.D(e.g,google.ima.AdEvent.Type.AD_BUFFERING,function(e){t(e,"ad-buffering")}),e.h.D(e.g,google.ima.AdEvent.Type.IMPRESSION,function(e){t(e,"ad-impression")}),e.h.D(e.g,google.ima.AdEvent.Type.DURATION_CHANGE,function(e){t(e,"ad-duration-changed")}),e.h.D(e.g,google.ima.AdEvent.Type.USER_CLOSE,function(e){t(e,"ad-closed")}),e.h.D(e.g,google.ima.AdEvent.Type.LOADED,function(e){t(e,"ad-loaded")}),e.h.D(e.g,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(e){t(e,"all-ads-completed")}),e.h.D(e.g,google.ima.AdEvent.Type.LINEAR_CHANGED,function(e){t(e,"ad-linear-changed")}),e.h.D(e.g,google.ima.AdEvent.Type.AD_METADATA,function(e){t(e,"ad-metadata")}),e.h.D(e.g,google.ima.AdEvent.Type.LOG,function(e){t(e,"ad-recoverable-error")}),e.h.D(e.g,google.ima.AdEvent.Type.AD_BREAK_READY,function(e){t(e,"ad-break-ready")}),e.h.D(e.g,google.ima.AdEvent.Type.INTERACTION,function(e){t(e,"ad-interaction")})}function Rf(e,t){var n=t.getAd();n?(e.j=new wf(n,e.g,e.i),t.type!=google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED||e.o.supportsMultipleMediaElements||e.l(new Nr("ad-content-pause-requested")),t=(new Map).set("ad",e.j).set("sdkAdObject",n).set("originalEvent",t),e.l(new Nr("ad-started",t)),e.j.isLinear()&&(e.s.setAttribute("ad-active","true"),e.o.customPlayheadTracker||e.i.pause(),e.i.muted?(t=e.j,t.l=e.i.volume,t.h.setVolume(0)):e.j.setVolume(e.i.volume))):Z("The IMA SDK fired a "+t.type+" event with no associated ad. Unable to play ad!")}function Mf(e,t){t&&t.type==google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED&&!e.o.supportsMultipleMediaElements&&e.l(new Nr("ad-content-resume-requested")),e.l(new Nr("ad-stopped",(new Map).set("originalEvent",t))),e.j&&e.j.isLinear()&&(e.s.removeAttribute("ad-active"),e.o.customPlayheadTracker||e.i.ended||e.i.play())}function Df(e,t,n,i,r){this.g=e,this.h=t,this.j=n,this.l=i,this.i=r}function Lf(e,t,n,i){var r=this;this.F=e,this.B=t,this.i=n,this.C=null,this.m=!0,this.s=this.i,this.g=i,this.G=new Set,this.A=new Set,this.o=new Map,this.h=new eh,Bf(this),this.I=new ae,this.j=new ae,this.H=!1,this.l=null,this.I.D(this.i,"timeupdate",function(){if(!r.H){var e=null==r.l||0==r.l;r.l=r.i.currentTime,(e=Of(r,e))&&Nf(r,e,1,1,Date.now())}}),new Ut(function(){var e,t,n,i,a,s,o,l,u,d;return N(function(h){switch(h.g){case 1:if(!r.A.size||r.H||null==r.l){h.u(0);break}e=!1,t=Array.from(r.A),n=r.B.Qb(),i=c(t),a=i.next();case 3:if(a.done){h.u(5);break}if(s=a.value,o=s.endTime||s.startTime,!(1<=n.start-o)){l=s.startTime-r.l,0<l&&10>=l&&(r.o.has(s)||r.o.set(s,r.h.preload(s.uri))),h.u(4);break}if(!r.o.has(s)){h.u(7);break}return _(h,r.o.get(s),8);case 8:(u=h.h)&&u.destroy(),r.o.delete(s);case 7:d=JSON.stringify(s),r.G.has(d)&&r.G.delete(d),r.A.delete(s),e=!0;case 4:a=i.next(),h.u(3);break;case 5:e&&Ff(r),w(h)}})}).Sa(1)}function Pf(e,t){var n,i,r,a,s,o,l,u;N(function(d){if(1==d.g)return e.B.Mg()==vf&&e.m?(Z("Unsupported interstitial when using single media element",t),d.return()):(Bf(e),n=!1,_(d,Uf(e,t),2));if(i=d.h,i.length)for(r=c(i),a=r.next();!a.done;a=r.next())s=a.value,o=JSON.stringify(s),e.G.has(o)||(n=!0,e.G.add(o),e.A.add(s),l=!1,t.Cb&&null==e.l?l=!0:0!=s.startTime||s.ef?null!=e.l&&(u=t.startTime-e.l,0<u&&10>=u&&(l=!0)):l=!0,l&&(e.o.has(s)||e.o.set(s,e.h.preload(s.uri))));else Z("Unsupported interstitial",t);n&&Ff(e),w(d)})}function Of(e,t,n){n=void 0===n?0:n;var i=0,r=null;if(e.A.size&&null!=e.l){var a=e.i.ended,s=Array.from(e.A).sort(function(e,t){return t.startTime-e.startTime});s=c(s);for(var o=s.next();!o.done;o=s.next()){o=o.value;var l=!1;if(t?l=o.Cb:a?l=o.sc:o.Cb||o.sc||(l=e.l-Math.round(1e3*o.startTime)/1e3,l=0<l&&(1>=l||!o.ef)),l){if(i==n){r=o;break}i++}}}return r}function Nf(e,t,n,i,r,a){var s,o,l,u,c,d,h,f,p,g,m,v,y,b;a=void 0===a?0:a,N(function(S){switch(S.g){case 1:if(s=Date.now(),!e.s.parentElement&&e.F&&e.F.appendChild(e.s),1==i&&1==n&&(n=Array.from(e.A).filter(function(e){return t.Cb?e.Cb==t.Cb:t.sc?e.sc==t.sc:.001>Math.abs(e.startTime-t.startTime)}).length),(t.once||t.Cb)&&(a++,e.A.delete(t),Ff(e)),e.H=!0,!e.m||1!=i){S.u(2);break}return e.g(new Nr("ad-content-pause-requested",(new Map).set("saveLivePosition",!0))),o=new Ir,l=function(t){return N(function(n){if(1==n.g)return"detach"!=t.state?n.u(0):rn()?_(n,new Promise(function(e){return new Ut(e).Y(.1)}),3):n.u(3);o.resolve(),e.j.lb(e.B,"onstatechange",l),w(n)})},e.j.D(e.B,"onstatechange",l),_(S,o,2);case 2:return e.m||(e.i.pause(),null!=t.Rc&&0!=t.Rc&&(e.i.currentTime+=t.Rc)),u=!1,c=null,d=function(){if(!e.m&&null==t.Rc)if(t.Ke&&t.endTime&&1/0!=t.endTime)e.i.currentTime!=t.endTime&&(e.i.currentTime=t.endTime);else{var n=Date.now();e.i.currentTime+=(n-r)/1e3,r=n}},h=function(){var s,o;return N(function(l){if(1==l.g)return d(),c&&c.stop(),(s=Of(e,t.Cb,i-a))?(e.g(new Nr("ad-stopped")),e.j.Ra(),Nf(e,s,n,++i,r,a),l.u(0)):e.m?_(l,e.h.detach(),4):_(l,e.h.dc(),4);e.m&&(o=t.Rc,null==o&&(o=t.Ke&&t.endTime&&1/0!=t.endTime?t.endTime-(e.l||0):(Date.now()-r)/1e3),e.g(new Nr("ad-content-resume-requested",(new Map).set("offset",o)))),e.g(new Nr("ad-stopped")),e.j.Ra(),e.H=!1,e.m||(d(),e.i.ended||e.i.play()),w(l)})},f=function(t){return N(function(n){return u?n.return():(u=!0,e.g(new Nr("ad-error",(new Map).set("originalEvent",t))),_(n,h(),0))})},p=function(){return N(function(t){if(1==t.g)return u?t.return():(u=!0,_(t,h(),2));e.g(new Nr("ad-complete")),w(t)})},g=function(){return N(function(t){return u?t.return():(u=!0,e.g(new Nr("ad-skipped")),_(t,h(),0))})},m=new Df(e.s,t.isSkippable,g,n,i),e.m||(m.setMuted(e.i.muted),m.setVolume(e.i.volume)),e.g(new Nr("ad-started",(new Map).set("ad",m))),m.canSkipNow()&&e.g(new Nr("ad-skip-state-changed")),e.j.ha(e.h,"error",f),e.j.ha(e.h,"firstquartile",function(){d(),e.g(new Nr("ad-first-quartile"))}),e.j.ha(e.h,"midpoint",function(){d(),e.g(new Nr("ad-midpoint"))}),e.j.ha(e.h,"thirdquartile",function(){d(),e.g(new Nr("ad-third-quartile"))}),e.j.ha(e.h,"complete",p),e.j.D(e.s,"play",function(){e.g(new Nr("ad-resumed"))}),e.j.D(e.s,"pause",function(){e.g(new Nr("ad-paused"))}),e.j.D(e.s,"volumechange",function(){e.s.muted?e.g(new Nr("ad-muted")):e.g(new Nr("ad-volume-changed"))}),E(S,4),t.Wf&&(c=new Ut(function(){m.skip()}).Y(t.Wf)),Bf(e),_(S,e.h.Ub(e.s),6);case 6:return e.o.has(t)?_(S,e.o.get(t),10):_(S,e.h.load(t.uri),8);case 10:return v=S.h,e.o.delete(t),_(S,v?e.h.load(v):e.h.load(t.uri),8);case 8:y=(Date.now()-s)/1e3,e.g(new Nr("ads-loaded",(new Map).set("loadTime",y))),e.m&&e.i.play(),A(S,0);break;case 4:b=k(S),f(b),w(S)}})}function Uf(e,t){var n,i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,w,x,I,C,R,M,D,L,P,O,U,F;return N(function(N){switch(N.g){case 1:if(n=[],!t)return N.return(n);if(i=t.values.find(function(e){return"X-ASSET-URI"==e.key}),r=t.values.find(function(e){return"X-ASSET-LIST"==e.key}),!i&&!r)return N.return(n);if(a=t.values.find(function(e){return"X-RESTRICT"==e.key}),o=s=!0,a&&a.data&&(l=a.data,s=!l.includes("SKIP"),o=!l.includes("JUMP")),u=null,(d=t.values.find(function(e){return"X-RESUME-OFFSET"==e.key}))&&(h=d.data,u=parseFloat(h),isNaN(u)&&(u=null)),f=null,(p=t.values.find(function(e){return"X-PLAYOUT-LIMIT"==e.key}))&&(g=p.data,f=parseFloat(g),isNaN(f)&&(f=null)),y=v=m=!1,(b=t.values.find(function(e){return"CUE"==e.key}))&&(S=b.data,m=S.includes("ONCE"),v=S.includes("PRE"),y=S.includes("POST")),T=!1,(w=t.values.find(function(e){return"X-TIMELINE-OCCUPIES"==e.key}))?(x=w.data,T=x.includes("RANGE")):!d&&e.B.V()&&(T=!v&&!y),i){if(I=i.data,!I)return N.return(n);n.push({startTime:t.startTime,endTime:t.endTime,uri:I,isSkippable:s,ef:o,Rc:u,Wf:f,once:m,Cb:v,sc:y,Ke:T}),N.u(2);break}if(!r){N.u(2);break}return C=r.data,C?(R=Kr([C],kr()),M=e.B.zb().request(7,R),E(N,4),_(N,M.promise,6)):N.return(n);case 6:for(D=N.h,L=hn(D.data),P=JSON.parse(L),O=c(P.ASSETS),U=O.next();!U.done;U=O.next())F=U.value,F.URI&&n.push({startTime:t.startTime,endTime:t.endTime,uri:F.URI,isSkippable:s,ef:o,Rc:u,Wf:f,once:m,Cb:v,sc:y,Ke:T});A(N,2);break;case 4:k(N);case 2:return N.return(n)}})}function Ff(e){for(var t=[],n={},i=c(e.A),r=i.next();!r.done;n={vb:n.vb},r=i.next())r=r.value,n.vb={start:r.startTime,end:null},r.Cb?(n.vb.start=0,n.vb.end=null):r.sc?(n.vb.start=-1,n.vb.end=null):r.Ke&&(n.vb.end=r.endTime),t.find(function(e){return function(t){return e.vb.start==t.start&&e.vb.end==t.end}}(n))||t.push(n.vb);e.g(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",t)))}function Bf(e){e.h.configure(e.B.Og());var t=e.h.zb();t.Ag(),t.Bg(),zr(e.B.zb(),t)}function Vf(e){this.h=e||"",this.g=0}function jf(e){Gf(e,/[ \t]+/gm)}function Gf(e,t){return t.lastIndex=e.g,t=t.exec(e.h),t=null==t?null:{position:t.index,length:t[0].length,results:t},e.g==e.h.length||null==t||t.position!=e.g?null:(e.g+=t.length,t.results)}function Hf(e){return e.g==e.h.length?null:(e=Gf(e,/[^ \t\n]*/gm))?e[0]:null}function zf(e,t,n,i,r){if(this.h=e,e=this.h.skipOffset)if(e=Gf(new Vf(e),Kf),null==e)e=null;else{var a=Number(e[2]),s=Number(e[3]);e=59<a||59<s?null:(Number(e[4])||0)/1e3+s+60*a+3600*(Number(e[1])||0)}else e=null;this.j=e,this.g=r,this.i=t,this.l=n,this.o=i,this.m=!1}i=wf.prototype,i.needsSkipUI=function(){return!1},i.getDuration=function(){return this.g.getDuration()},i.getMinSuggestedDuration=function(){return this.g.getMinSuggestedDuration()},i.getRemainingTime=function(){return this.h.getRemainingTime()},i.isPaused=function(){return this.i},i.isSkippable=function(){return 0<=this.g.getSkipTimeOffset()},i.getTimeUntilSkippable=function(){var e=this.g.getSkipTimeOffset();return e=this.getRemainingTime()-e,Math.max(e,0)},i.canSkipNow=function(){return this.h.getAdSkippableState()},i.skip=function(){return this.h.skip()},i.pause=function(){return this.h.pause()},i.play=function(){return this.h.resume()},i.getVolume=function(){return this.h.getVolume()},i.setVolume=function(e){return this.j.volume=e,this.h.setVolume(e)},i.isMuted=function(){return 0==this.h.getVolume()},i.isLinear=function(){return this.g.isLinear()},i.resize=function(e,t){var n=!1,i=this.j;document.fullscreenEnabled?n=!!document.fullscreenElement:i.webkitSupportsFullscreen&&(n=i.webkitDisplayingFullscreen),this.h.resize(e,t,n?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},i.setMuted=function(e){(this.j.muted=e)?(this.l=this.getVolume(),this.h.setVolume(0)):this.h.setVolume(this.l)},i.getSequenceLength=function(){var e=this.g.getAdPodInfo();return null==e?1:e.getTotalAds()},i.getPositionInSequence=function(){var e=this.g.getAdPodInfo();return null==e?1:e.getAdPosition()},i.getTitle=function(){return this.g.getTitle()},i.getDescription=function(){return this.g.getDescription()},i.getVastMediaBitrate=function(){return this.g.getVastMediaBitrate()},i.getVastMediaHeight=function(){return this.g.getVastMediaHeight()},i.getVastMediaWidth=function(){return this.g.getVastMediaWidth()},i.getAdId=function(){return this.g.getAdId()},i.getCreativeAdId=function(){return this.g.getCreativeAdId()},i.getAdvertiserName=function(){return this.g.getAdvertiserName()},i.getMediaUrl=function(){return this.g.getMediaUrl()},i.getTimeOffset=function(){var e=this.g.getAdPodInfo();return null==e?0:e.getTimeOffset()},i.getPodIndex=function(){var e=this.g.getAdPodInfo();return null==e?0:e.getPodIndex()},i.release=function(){this.h=this.g=null},z("shaka.ads.ClientSideAd",wf),wf.prototype.release=wf.prototype.release,wf.prototype.getPodIndex=wf.prototype.getPodIndex,wf.prototype.getTimeOffset=wf.prototype.getTimeOffset,wf.prototype.getMediaUrl=wf.prototype.getMediaUrl,wf.prototype.getAdvertiserName=wf.prototype.getAdvertiserName,wf.prototype.getCreativeAdId=wf.prototype.getCreativeAdId,wf.prototype.getAdId=wf.prototype.getAdId,wf.prototype.getVastMediaWidth=wf.prototype.getVastMediaWidth,wf.prototype.getVastMediaHeight=wf.prototype.getVastMediaHeight,wf.prototype.getVastMediaBitrate=wf.prototype.getVastMediaBitrate,wf.prototype.getDescription=wf.prototype.getDescription,wf.prototype.getTitle=wf.prototype.getTitle,wf.prototype.getPositionInSequence=wf.prototype.getPositionInSequence,wf.prototype.getSequenceLength=wf.prototype.getSequenceLength,wf.prototype.setMuted=wf.prototype.setMuted,wf.prototype.resize=wf.prototype.resize,wf.prototype.isLinear=wf.prototype.isLinear,wf.prototype.isMuted=wf.prototype.isMuted,wf.prototype.setVolume=wf.prototype.setVolume,wf.prototype.getVolume=wf.prototype.getVolume,wf.prototype.play=wf.prototype.play,wf.prototype.pause=wf.prototype.pause,wf.prototype.skip=wf.prototype.skip,wf.prototype.canSkipNow=wf.prototype.canSkipNow,wf.prototype.getTimeUntilSkippable=wf.prototype.getTimeUntilSkippable,wf.prototype.isSkippable=wf.prototype.isSkippable,wf.prototype.isPaused=wf.prototype.isPaused,wf.prototype.getRemainingTime=wf.prototype.getRemainingTime,wf.prototype.getMinSuggestedDuration=wf.prototype.getMinSuggestedDuration,wf.prototype.getDuration=wf.prototype.getDuration,wf.prototype.needsSkipUI=wf.prototype.needsSkipUI,z("shaka.ads.Utils",Ef),Ef.ADS_LOADED="ads-loaded",Ef.AD_STARTED="ad-started",Ef.AD_FIRST_QUARTILE="ad-first-quartile",Ef.AD_MIDPOINT="ad-midpoint",Ef.AD_THIRD_QUARTILE="ad-third-quartile",Ef.AD_COMPLETE="ad-complete",Ef.AD_STOPPED="ad-stopped",Ef.AD_SKIPPED="ad-skipped",Ef.AD_VOLUME_CHANGED="ad-volume-changed",Ef.AD_MUTED="ad-muted",Ef.AD_PAUSED="ad-paused",Ef.AD_RESUMED="ad-resumed",Ef.AD_SKIP_STATE_CHANGED="ad-skip-state-changed",Ef.CUEPOINTS_CHANGED="ad-cue-points-changed",Ef.IMA_AD_MANAGER_LOADED="ima-ad-manager-loaded",Ef.IMA_STREAM_MANAGER_LOADED="ima-stream-manager-loaded",Ef.AD_CLICKED="ad-clicked",Ef.AD_PROGRESS="ad-progress",Ef.AD_BUFFERING="ad-buffering",Ef.AD_IMPRESSION="ad-impression",Ef.AD_DURATION_CHANGED="ad-duration-changed",Ef.AD_CLOSED="ad-closed",Ef.AD_LOADED="ad-loaded",Ef.ALL_ADS_COMPLETED="all-ads-completed",Ef.AD_LINEAR_CHANGED="ad-linear-changed",Ef.AD_METADATA="ad-metadata",Ef.AD_RECOVERABLE_ERROR="ad-recoverable-error",Ef.AD_ERROR="ad-error",Ef.AD_BREAK_READY="ad-break-ready",Ef.AD_INTERACTION="ad-interaction",Ef.AD_CONTENT_PAUSE_REQUESTED="ad-content-pause-requested",Ef.AD_CONTENT_RESUME_REQUESTED="ad-content-resume-requested",Ef.AD_CONTENT_ATTACH_REQUESTED="ad-content-attach-requested",xf.prototype.configure=function(e){this.o=e},xf.prototype.stop=function(){this.g&&this.g.stop(),this.s&&gd(this.s)},xf.prototype.release=function(){this.stop(),this.A&&this.A.disconnect(),this.h&&this.h.release(),this.g&&this.g.destroy(),this.m.destroy(),this.C.destroy()},i=Df.prototype,i.needsSkipUI=function(){return!0},i.getDuration=function(){var e=this.g.duration;return isNaN(e)?-1:e},i.getMinSuggestedDuration=function(){return this.getDuration()},i.getRemainingTime=function(){var e=this.g.duration;return isNaN(e)?-1:e-this.g.currentTime},i.isPaused=function(){return this.g.paused},i.isSkippable=function(){return this.h},i.getTimeUntilSkippable=function(){return this.h?0:Math.max(this.getRemainingTime(),0)},i.canSkipNow=function(){return 0==this.getTimeUntilSkippable()},i.skip=function(){this.j()},i.pause=function(){return this.g.pause()},i.play=function(){return this.g.play()},i.getVolume=function(){return this.g.volume},i.setVolume=function(e){this.g.volume=e},i.isMuted=function(){return this.g.muted},i.isLinear=function(){return!0},i.resize=function(){},i.setMuted=function(e){this.g.muted=e},i.getSequenceLength=function(){return this.l},i.getPositionInSequence=function(){return this.i},i.getTitle=function(){return""},i.getDescription=function(){return""},i.getVastMediaBitrate=function(){return 0},i.getVastMediaHeight=function(){return 0},i.getVastMediaWidth=function(){return 0},i.getAdId=function(){return""},i.getCreativeAdId=function(){return""},i.getAdvertiserName=function(){return""},i.getMediaUrl=function(){return null},i.getTimeOffset=function(){return 0},i.getPodIndex=function(){return 0},i.release=function(){this.g=null},z("shaka.ads.InterstitialAd",Df),Df.prototype.release=Df.prototype.release,Df.prototype.getPodIndex=Df.prototype.getPodIndex,Df.prototype.getTimeOffset=Df.prototype.getTimeOffset,Df.prototype.getMediaUrl=Df.prototype.getMediaUrl,Df.prototype.getAdvertiserName=Df.prototype.getAdvertiserName,Df.prototype.getCreativeAdId=Df.prototype.getCreativeAdId,Df.prototype.getAdId=Df.prototype.getAdId,Df.prototype.getVastMediaWidth=Df.prototype.getVastMediaWidth,Df.prototype.getVastMediaHeight=Df.prototype.getVastMediaHeight,Df.prototype.getVastMediaBitrate=Df.prototype.getVastMediaBitrate,Df.prototype.getDescription=Df.prototype.getDescription,Df.prototype.getTitle=Df.prototype.getTitle,Df.prototype.getPositionInSequence=Df.prototype.getPositionInSequence,Df.prototype.getSequenceLength=Df.prototype.getSequenceLength,Df.prototype.setMuted=Df.prototype.setMuted,Df.prototype.resize=Df.prototype.resize,Df.prototype.isLinear=Df.prototype.isLinear,Df.prototype.isMuted=Df.prototype.isMuted,Df.prototype.setVolume=Df.prototype.setVolume,Df.prototype.getVolume=Df.prototype.getVolume,Df.prototype.play=Df.prototype.play,Df.prototype.pause=Df.prototype.pause,Df.prototype.skip=Df.prototype.skip,Df.prototype.canSkipNow=Df.prototype.canSkipNow,Df.prototype.getTimeUntilSkippable=Df.prototype.getTimeUntilSkippable,Df.prototype.isSkippable=Df.prototype.isSkippable,Df.prototype.isPaused=Df.prototype.isPaused,Df.prototype.getRemainingTime=Df.prototype.getRemainingTime,Df.prototype.getMinSuggestedDuration=Df.prototype.getMinSuggestedDuration,Df.prototype.getDuration=Df.prototype.getDuration,Df.prototype.needsSkipUI=Df.prototype.needsSkipUI,Lf.prototype.configure=function(e){this.F&&this.m==e.supportsMultipleMediaElements&&((this.m=!e.supportsMultipleMediaElements)?(this.s=this.i,this.C&&(this.C.parentElement&&this.F.removeChild(this.C),this.C=null)):(this.C||(e=document.createElement(this.i.tagName),e.autoplay=!0,e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgb(0, 0, 0)",e.setAttribute("playsinline",""),this.C=e),this.s=this.C))},Lf.prototype.stop=function(){this.j&&this.j.Ra(),this.G.clear(),this.A.clear(),this.h.lf(),this.o.clear(),this.h.detach(),this.H=!1,this.l=null},Lf.prototype.release=function(){this.stop(),this.I&&this.I.release(),this.j&&this.j.release(),this.F&&gd(this.F),this.h.destroy()},i=zf.prototype,i.needsSkipUI=function(){return!0},i.getDuration=function(){return this.h.durationInSeconds},i.getMinSuggestedDuration=function(){return this.getDuration()},i.getRemainingTime=function(){return this.h.startTimeInSeconds+this.h.durationInSeconds-this.g.currentTime},i.isPaused=function(){return this.g.paused},i.isSkippable=function(){return"number"==typeof this.j},i.getTimeUntilSkippable=function(){if("number"!=typeof this.j)return this.getRemainingTime();var e=this.getRemainingTime()+this.j-this.getDuration();return Math.max(e,0)},i.canSkipNow=function(){return 0==this.getTimeUntilSkippable()},i.skip=function(){this.m=!0,this.g.currentTime+=this.getRemainingTime()},i.pause=function(){return this.g.pause()},i.play=function(){return this.g.play()},i.getVolume=function(){return this.g.volume},i.setVolume=function(e){this.g.volume=e},i.isMuted=function(){return this.g.muted},i.isLinear=function(){return this.o},i.resize=function(){},i.setMuted=function(e){this.g.muted=e},i.getSequenceLength=function(){return this.l?this.l:1},i.getPositionInSequence=function(){return this.i?this.i:1},i.getTitle=function(){return this.h.adTitle},i.getDescription=function(){return""},i.getVastMediaBitrate=function(){return 0},i.getVastMediaHeight=function(){return 0},i.getVastMediaWidth=function(){return 0},i.getAdId=function(){return this.h.adId},i.getCreativeAdId=function(){return this.h.creativeId},i.getAdvertiserName=function(){return""},i.getMediaUrl=function(){return null},i.getTimeOffset=function(){return 0},i.getPodIndex=function(){return 0},i.release=function(){this.l=this.i=this.g=this.h=null},z("shaka.ads.MediaTailorAd",zf),zf.prototype.release=zf.prototype.release,zf.prototype.getPodIndex=zf.prototype.getPodIndex,zf.prototype.getTimeOffset=zf.prototype.getTimeOffset,zf.prototype.getMediaUrl=zf.prototype.getMediaUrl,zf.prototype.getAdvertiserName=zf.prototype.getAdvertiserName,zf.prototype.getCreativeAdId=zf.prototype.getCreativeAdId,zf.prototype.getAdId=zf.prototype.getAdId,zf.prototype.getVastMediaWidth=zf.prototype.getVastMediaWidth,zf.prototype.getVastMediaHeight=zf.prototype.getVastMediaHeight,zf.prototype.getVastMediaBitrate=zf.prototype.getVastMediaBitrate,zf.prototype.getDescription=zf.prototype.getDescription,zf.prototype.getTitle=zf.prototype.getTitle,zf.prototype.getPositionInSequence=zf.prototype.getPositionInSequence,zf.prototype.getSequenceLength=zf.prototype.getSequenceLength,zf.prototype.setMuted=zf.prototype.setMuted,zf.prototype.resize=zf.prototype.resize,zf.prototype.isLinear=zf.prototype.isLinear,zf.prototype.isMuted=zf.prototype.isMuted,zf.prototype.setVolume=zf.prototype.setVolume,zf.prototype.getVolume=zf.prototype.getVolume,zf.prototype.play=zf.prototype.play,zf.prototype.pause=zf.prototype.pause,zf.prototype.skip=zf.prototype.skip,zf.prototype.canSkipNow=zf.prototype.canSkipNow,zf.prototype.getTimeUntilSkippable=zf.prototype.getTimeUntilSkippable,zf.prototype.isSkippable=zf.prototype.isSkippable,zf.prototype.isPaused=zf.prototype.isPaused,zf.prototype.getRemainingTime=zf.prototype.getRemainingTime,zf.prototype.getMinSuggestedDuration=zf.prototype.getMinSuggestedDuration,zf.prototype.getDuration=zf.prototype.getDuration,zf.prototype.needsSkipUI=zf.prototype.needsSkipUI;var Kf=/(?:(\d{1,}):)?(\d{2}):(\d{2})((\.(\d{1,3})))?/g;function $f(e,t,n,i){this.B=e,this.K=t,this.h=n,this.l=null,this.U=NaN,this.i=i,this.I=!1,this.A=null,this.j=[],this.N=[],this.L=this.C=this.g=null,this.F=new Map,this.m=[],this.s=[],this.G="",this.R=!0,this.H="",this.o=new ae}function Wf(e,t,n){var i,r,a,s,o,l,u,c,d,h,f;N(function(p){if(1==p.g)return i=Kr([t],kr()),i.method="POST",n&&(r=JSON.stringify(n),i.body=gn(r)),a=e.K.request(7,i),E(p,2),_(p,a.promise,4);if(2!=p.g){if(s=p.h,o=hn(s.data),l=JSON.parse(o),!l.manifestUrl||!l.trackingUrl)throw Error("Insufficient data from MediaTailor.");return u=new ht(t),c=new ht(l.trackingUrl),e.G=u.resolve(c).toString(),d=Date.now()/1e3,h=d-e.U,e.i(new Nr("ads-loaded",(new Map).set("loadTime",h))),f=new ht(l.manifestUrl),e.l.resolve(u.resolve(f).toString()),e.l=null,A(p,0)}if(k(p),!e.H.length)return e.l.reject("MediaTailor request returned an error and there was no backup asset uri provided."),e.l=null,p.return();e.l.resolve(e.H),e.l=null,w(p)})}function qf(e,t,n){var i,r,a,s,o,l,u,d,h,f,p,g,m,v,y;N(function(b){if(1==b.g)return i=Kr([t],kr()),r=e.K.request(7,i),E(b,2),_(b,r.promise,4);if(2!=b.g){if(a=b.h,s=[],o=hn(a.data),l=JSON.parse(o),0<l.avails.length){if(JSON.stringify(e.j)!=JSON.stringify(l.avails)){for(e.j=l.avails,u=c(e.j),d=u.next();!d.done;d=u.next())for(h=d.value,f=c(h.nonLinearAdsList),p=f.next();!p.done;p=f.next())for(g=p.value,m=c(g.nonLinearAdList),v=m.next();!v.done;v=m.next())y=v.value,Yf(e,y);s=e.getCuePoints(),e.i(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",s)))}}else e.j.length&&e.i(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",s))),ep(e),e.j=[];return n&&(e.I||0<s.length)&&Qf(e),A(b,0)}k(b),w(b)})}function Yf(e,t){var n,i,r,a,s,o,l;N(function(u){return 1==u.g?t.staticResource?(n=Xf(t),e.F.get(n)?u.return():(i=Kr([t.staticResource],kr()),r=e.K.request(7,i),E(u,2),e.F.set(n,[]),_(u,r.promise,4))):u.return():2!=u.g?(a=u.h,s=hn(a.data),o=JSON.parse(s),l=o.apps,e.F.set(n,l),A(u,0)):(k(u),e.F.delete(n),void w(u))})}function Xf(e){return[e.adId,e.adParameters,e.adSystem,e.adTitle,e.creativeAdId,e.creativeId,e.creativeSequence,e.height,e.width,e.staticResource].join("")}function Qf(e){Jf(e),e.I||(Zf(e),e.o.D(e.h,"seeked",function(){Zf(e)}),e.o.D(e.h,"ended",function(){ep(e)})),e.o.D(e.h,"timeupdate",function(){Jf(e)})}function Zf(e){var t=e.h.currentTime;if(0!=t&&null==e.A){for(var n,i,r=c(e.j),a=r.next();!a.done;a=r.next()){a=a.value;for(var s=c(a.ads),o=s.next();!o.done;o=s.next())if(o=o.value,i){if(o.startTimeInSeconds<t&&o.startTimeInSeconds>i.startTimeInSeconds+i.durationInSeconds){i=o,n=a;break}}else o.startTimeInSeconds<t&&(i=o,n=a)}n&&i&&!e.N.includes(i.adId)&&(e.A=t,e.h.currentTime=n.startTimeInSeconds)}}function Jf(e){if(e.h.duration&&(e.g||e.j.length)){var t=e.h.currentTime,n=!1;if(e.g){n=!0;var i=e.C,r=i.startTimeInSeconds+.5*i.durationInSeconds,a=i.startTimeInSeconds+.75*i.durationInSeconds;t>=i.startTimeInSeconds+.25*i.durationInSeconds&&!e.s.includes("firstQuartile")?(e.s.push("firstQuartile"),np(e,"firstQuartile")):t>=r&&!e.s.includes("midpoint")?(e.s.push("midpoint"),np(e,"midpoint")):t>=a&&!e.s.includes("thirdQuartile")&&(e.s.push("thirdQuartile"),np(e,"thirdQuartile")),i=e.g.getRemainingTime(),r=e.g.getDuration(),e.g.canSkipNow()&&0<i&&0<r&&np(e,"skipStateChanged"),0<r&&(0>=i||i>r)&&ep(e)}if(!e.g||!e.g.isLinear()){e:for(i=c(e.j),r=i.next();!r.done;r=i.next()){if(r=r.value,e.g&&e.g.isLinear())break;for(a=0;a<r.ads.length;a++){var s=r.ads[a],o=s.startTimeInSeconds+s.durationInSeconds;if(s.startTimeInSeconds<=t&&o>t){if(e.N.includes(s.adId)){if(e.h.ended)continue;e.h.currentTime=o;break e}ep(e),e.L=r,e.g=new zf(s,a+1,r.ads.length,!0,e.h),e.C=s,0===a&&np(e,"breakStart"),tp(e);break}}}if(!e.g)for(i=c(e.j),r=i.next();!r.done;r=i.next()){if(r=r.value,e.g)break;for(a=0;a<r.nonLinearAdsList.length;a++)if(s=r.nonLinearAdsList[a],s.nonLinearAdList.length){o=r.startTimeInSeconds;var l=e.F.get(Xf(s.nonLinearAdList[0]));if(o<=t&&l&&l.length){ep(e),o=e,l=c(l);for(var u=l.next();!u.done;u=l.next())if(u=u.value,u.data.source.length){var d=document.createElement("img");d.src=u.data.source[0].url,d.style.top=(u.placeholder.top||0)+"%",d.style.height=100-(u.placeholder.top||0)+"%",d.style.left=(u.placeholder.left||0)+"%",d.style.maxWidth=100-(u.placeholder.left||0)+"%",d.style.objectFit="contain",d.style.position="absolute",o.B.appendChild(d)}e.L=r,e.g=new zf(s,a+1,r.ads.length,!1,e.h),e.C=s,0===a&&np(e,"breakStart"),tp(e);break}}}n&&!e.g&&(t=e.h.currentTime,e.A&&e.A>t&&(e.h.currentTime=e.A),e.A=null)}}}function ep(e){if(e.g){for(;e.B.lastChild;)e.B.removeChild(e.B.firstChild);e.I||e.N.push(e.C.adId);var t=e.g.m;np(e,void 0!==t&&t?"skip":"complete"),t=c(e.m);for(var n=t.next();!n.done;n=t.next())n=n.value,e.o.lb(n.target,n.type,n.listener);e.m=[],e.s=[],t=e.g.getPositionInSequence(),n=e.g.getSequenceLength(),t===n&&np(e,"breakEnd"),e.g=null,e.C=null,e.L=null}}function tp(e){var t=!1;e.h.paused?t=!0:(np(e,"impression"),np(e,"start")),e.m.push({target:e.h,type:"volumechange",listener:function(){e.h.muted&&np(e,"mute")}}),e.m.push({target:e.h,type:"volumechange",listener:function(){e.h.muted||np(e,"unmute")}}),e.m.push({target:e.h,type:"play",listener:function(){t?(np(e,"impression"),np(e,"start"),t=!1):np(e,"resume")}}),e.m.push({target:e.h,type:"pause",listener:function(){np(e,"pause")}});for(var n=c(e.m),i=n.next();!i.done;i=n.next())i=i.value,e.o.D(i.target,i.type,i.listener)}function np(e,t){var n=e.C.trackingEvents.find(function(e){return e.eventType==t});if(n||(n=e.L.adBreakTrackingEvents.find(function(e){return e.eventType==t})),n){n=c(n.beaconUrls);for(var i=n.next();!i.done;i=n.next())(i=i.value)&&""!=i&&(i=Kr([i],kr()),i.method="POST",e.K.request(7,i))}switch(t){case"impression":e.i(new Nr("ad-impression"));break;case"start":e.i(new Nr("ad-started",(new Map).set("ad",e.g)));break;case"mute":e.i(new Nr("ad-muted"));break;case"unmute":e.i(new Nr("ad-volume-changed"));break;case"resume":e.i(new Nr("ad-resumed"));break;case"pause":e.i(new Nr("ad-paused"));break;case"firstQuartile":e.i(new Nr("ad-first-quartile"));break;case"midpoint":e.i(new Nr("ad-midpoint"));break;case"thirdQuartile":e.i(new Nr("ad-third-quartile"));break;case"complete":e.i(new Nr("ad-complete")),e.i(new Nr("ad-stopped"));break;case"skip":e.i(new Nr("ad-skipped")),e.i(new Nr("ad-stopped"));break;case"breakStart":e.B.setAttribute("ad-active","true");break;case"breakEnd":e.B.removeAttribute("ad-active");break;case"skipStateChanged":e.i(new Nr("ad-skip-state-changed"))}}function ip(e,t){this.g=e,this.i=null,this.h=t}function rp(e,t,n,i){var r=this;this.s=e,this.l=t,this.j=null,this.F=NaN,this.i=i,this.G=!1,this.A=this.m=this.o=null,this.B="",this.C=[],this.h=new ae,e=new google.ima.dai.api.UiSettings,e.setLocale(n),this.g=new google.ima.dai.api.StreamManager(this.l,this.s,e),this.i(new Nr("ima-stream-manager-loaded",(new Map).set("imaStreamManager",this.g))),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.LOADED,function(e){ap(r,e)}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.ERROR,function(){r.B.length?r.j.resolve(r.B):r.j.reject("IMA Stream request returned an error and there was no backup asset uri provided."),r.j=null}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,function(){}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.STARTED,function(e){e=e.getAd(),r.m=new ip(e,r.l),r.A&&(r.m.i=r.A),r.i(new Nr("ad-started",(new Map).set("ad",r.m))),r.s.setAttribute("ad-active","true")}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,function(){r.s.removeAttribute("ad-active");var e=r.l.currentTime;r.o&&r.o>e&&(r.l.currentTime=r.o,r.o=null)}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,function(e){r.A=e.getStreamData().adProgressData,r.m&&(r.m.i=r.A)}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,function(){r.i(new Nr("ad-first-quartile"))}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.MIDPOINT,function(){r.i(new Nr("ad-midpoint"))}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE,function(){r.i(new Nr("ad-third-quartile"))}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.COMPLETE,function(){r.i(new Nr("ad-complete")),r.i(new Nr("ad-stopped")),r.s.removeAttribute("ad-active"),r.m=null}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.SKIPPED,function(){r.i(new Nr("ad-skipped")),r.i(new Nr("ad-stopped"))}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED,function(e){var t=e.getStreamData();e=[],t=c(t.cuepoints);for(var n=t.next();!n.done;n=t.next())n=n.value,e.push({start:n.start,end:n.end});r.C=e,r.i(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",e)))})}function ap(e,t){e.i(new Nr("ads-loaded",(new Map).set("loadTime",Date.now()/1e3-e.F))),t=t.getStreamData().url,e.j.resolve(t),e.j=null,e.G||e.h.D(e.l,"seeked",function(){var t=e.l.currentTime;if(0!=t){e.g.streamTimeForContentTime(t);var n=e.g.previousCuePointForStreamTime(t);n&&!n.played&&(e.o=t,e.l.currentTime=n.start)}})}function sp(){Br.call(this),this.g=this.h=this.i=this.j=null,this.m=new Tf,this.o=navigator.language,this.l=null}function op(e,t){if(t&&t.type)switch(t.type){case"ads-loaded":e.m.g.push(t.loadTime);break;case"ad-started":e.m.h++;break;case"ad-complete":e.m.j++;break;case"ad-skipped":e.m.l++;break;case"ad-error":e.m.i++}e.dispatchEvent(t)}function lp(e){return JSON.stringify(e,function(e,t){if("function"!=typeof t){if(t instanceof Event||t instanceof Nr){var n={};for(i in t)(e=t[i])&&"object"==typeof e?"detail"==i&&(n[i]=e):i in Event||(n[i]=e);return n}if(t instanceof Error){var i=new Set(["name","message","stack"]);for(n in t)i.add(n);for(e=c(Object.getOwnPropertyNames(t)),n=e.next();!n.done;n=e.next())i.add(n.value);for(e={},i=c(i),n=i.next();!n.done;n=i.next())n=n.value,e[n]=t[n];t={__type__:"Error",contents:e}}else if(t instanceof TimeRanges){for(i={__type__:"TimeRanges",length:t.length,start:[],end:[]},t=c(so(t)),n=t.next();!n.done;n=t.next())n=n.value,e=n.end,i.start.push(n.start),i.end.push(e);t=i}else t=t instanceof Uint8Array?{__type__:"Uint8Array",entries:Array.from(t)}:"number"==typeof t?isNaN(t)?"NaN":isFinite(t)?t:0>t?"-Infinity":"Infinity":t;return t}})}function up(e){return JSON.parse(e,function(e,t){if("NaN"==t)var n=NaN;else if("-Infinity"==t)n=-1/0;else if("Infinity"==t)n=1/0;else if(t&&"object"==typeof t&&"TimeRanges"==t.__type__)n=cp(t);else if(t&&"object"==typeof t&&"Uint8Array"==t.__type__)n=new Uint8Array(t.entries);else if(t&&"object"==typeof t&&"Error"==t.__type__){for(n in e=t.contents,t=Error(e.message),e)t[n]=e[n];n=t}else n=t;return n})}function cp(e){return{length:e.length,start:function(t){return e.start[t]},end:function(t){return e.end[t]}}}$f.prototype.stop=function(){for(var e=c(this.m),t=e.next();!t.done;t=e.next())t=t.value,this.o.lb(t.target,t.type,t.listener);ep(this),this.m=[],this.s=[],this.G="",this.R=!0,this.H="",this.A=null,this.j=[],this.N=[],this.F.clear()},$f.prototype.release=function(){this.stop(),this.o&&this.o.release()},$f.prototype.onManifestUpdated=function(e){this.I=e,""!=this.G&&(qf(this,this.G,this.R),this.R=!1)},$f.prototype.getCuePoints=function(){for(var e=[],t=c(this.j),n=t.next();!n.done;n=t.next()){n=c(n.value.ads);for(var i=n.next();!i.done;i=n.next())i=i.value,e.push({start:i.startTimeInSeconds,end:i.startTimeInSeconds+i.durationInSeconds})}return e},i=ip.prototype,i.needsSkipUI=function(){return!0},i.getDuration=function(){return this.i?this.i.duration:-1},i.getMinSuggestedDuration=function(){return this.getDuration()},i.getRemainingTime=function(){return this.i?this.i.duration-this.i.currentTime:-1},i.isPaused=function(){return this.h.paused},i.isSkippable=function(){return this.g.isSkippable()},i.getTimeUntilSkippable=function(){var e=this.g.getSkipTimeOffset();return e=this.getRemainingTime()-e,Math.max(e,0)},i.canSkipNow=function(){return 0==this.getTimeUntilSkippable()},i.skip=function(){this.h.currentTime+=this.getRemainingTime()},i.pause=function(){return this.h.pause()},i.play=function(){return this.h.play()},i.getVolume=function(){return this.h.volume},i.setVolume=function(e){this.h.volume=e},i.isMuted=function(){return this.h.muted},i.isLinear=function(){return!0},i.resize=function(){},i.setMuted=function(e){this.h.muted=e},i.getSequenceLength=function(){var e=this.g.getAdPodInfo();return null==e?1:e.getTotalAds()},i.getPositionInSequence=function(){var e=this.g.getAdPodInfo();return null==e?1:e.getAdPosition()},i.getTitle=function(){return this.g.getTitle()},i.getDescription=function(){return this.g.getDescription()},i.getVastMediaBitrate=function(){return 0},i.getVastMediaHeight=function(){return this.g.getVastMediaHeight()},i.getVastMediaWidth=function(){return this.g.getVastMediaWidth()},i.getAdId=function(){return this.g.getAdId()},i.getCreativeAdId=function(){return this.g.getCreativeAdId()},i.getAdvertiserName=function(){return this.g.getAdvertiserName()},i.getMediaUrl=function(){return null},i.getTimeOffset=function(){var e=this.g.getAdPodInfo();return null==e?0:e.getTimeOffset()},i.getPodIndex=function(){var e=this.g.getAdPodInfo();return null==e?0:e.getPodIndex()},i.release=function(){this.h=this.i=this.g=null},z("shaka.ads.ServerSideAd",ip),ip.prototype.release=ip.prototype.release,ip.prototype.getPodIndex=ip.prototype.getPodIndex,ip.prototype.getTimeOffset=ip.prototype.getTimeOffset,ip.prototype.getMediaUrl=ip.prototype.getMediaUrl,ip.prototype.getAdvertiserName=ip.prototype.getAdvertiserName,ip.prototype.getCreativeAdId=ip.prototype.getCreativeAdId,ip.prototype.getAdId=ip.prototype.getAdId,ip.prototype.getVastMediaWidth=ip.prototype.getVastMediaWidth,ip.prototype.getVastMediaHeight=ip.prototype.getVastMediaHeight,ip.prototype.getVastMediaBitrate=ip.prototype.getVastMediaBitrate,ip.prototype.getDescription=ip.prototype.getDescription,ip.prototype.getTitle=ip.prototype.getTitle,ip.prototype.getPositionInSequence=ip.prototype.getPositionInSequence,ip.prototype.getSequenceLength=ip.prototype.getSequenceLength,ip.prototype.setMuted=ip.prototype.setMuted,ip.prototype.resize=ip.prototype.resize,ip.prototype.isLinear=ip.prototype.isLinear,ip.prototype.isMuted=ip.prototype.isMuted,ip.prototype.setVolume=ip.prototype.setVolume,ip.prototype.getVolume=ip.prototype.getVolume,ip.prototype.play=ip.prototype.play,ip.prototype.pause=ip.prototype.pause,ip.prototype.skip=ip.prototype.skip,ip.prototype.canSkipNow=ip.prototype.canSkipNow,ip.prototype.getTimeUntilSkippable=ip.prototype.getTimeUntilSkippable,ip.prototype.isSkippable=ip.prototype.isSkippable,ip.prototype.isPaused=ip.prototype.isPaused,ip.prototype.getRemainingTime=ip.prototype.getRemainingTime,ip.prototype.getMinSuggestedDuration=ip.prototype.getMinSuggestedDuration,ip.prototype.getDuration=ip.prototype.getDuration,ip.prototype.needsSkipUI=ip.prototype.needsSkipUI,i=rp.prototype,i.configure=function(){},i.stop=function(){this.B="",this.o=null,this.C=[]},i.release=function(){this.stop(),this.h&&this.h.release()},i.onCueMetadataChange=function(e){if(e.key&&e.data){var t={};t[e.key]=e.data,this.g.onTimedMetadata(t)}},i.getCuePoints=function(){return this.C},y(sp,Br),i=sp.prototype,i.setLocale=function(e){this.o=e},i.configure=function(e){this.l=e,this.j&&this.j.configure(this.l),this.i&&this.i.configure(this.l),this.g&&this.g.configure(this.l)},i.initInterstitial=function(e,t,n){var i=this;this.j&&this.j.release(),this.j=new Lf(e,t,n,function(e){return op(i,e)}),this.j.configure(this.l)},i.initClientSide=function(t,n,i){var r=this;if(!e.google||!google.ima||!google.ima.AdsLoader)throw new It(2,10,1e4);this.i&&this.i.release(),this.i=new xf(t,n,this.o,i,function(e){return op(r,e)}),this.i.configure(this.l)},i.release=function(){this.j&&(this.j.release(),this.j=null),this.i&&(this.i.release(),this.i=null),this.h&&(this.h.release(),this.h=null),this.g&&(this.g.release(),this.g=null),Br.prototype.release.call(this)},i.onAssetUnload=function(){this.j&&this.j.stop(),this.i&&this.i.stop(),this.h&&this.h.stop(),this.g&&this.g.stop(),this.dispatchEvent(new Nr("ad-stopped")),this.dispatchEvent(new Nr("ad-content-attach-requested")),this.m=new Tf},i.requestClientSideAds=function(e){if(!this.i)throw new It(1,10,10001);var t=this.i;t.g&&t.g.destroy(),t.m&&t.m.contentComplete(),t.G=Date.now()/1e3,t.m.requestAds(e)},i.updateClientSideAdsRenderingSettings=function(e){if(!this.i)throw new It(1,10,10001);var t=this.i;t.B=e,t.g&&t.g.updateAdsRenderingSettings(t.B)},i.initMediaTailor=function(e,t,n){var i=this;this.h&&this.h.release(),this.h=new $f(e,t,n,function(e){return op(i,e)})},i.requestMediaTailorStream=function(e,t,n){if(!this.h)throw new It(1,10,10005);var i=this.h;return n=void 0===n?"":n,i.l?e=Promise.reject(new It(1,10,10004)):(i.l=new Ir,Wf(i,e,t),i.H=n||"",i.U=Date.now()/1e3,e=i.l),e},i.addMediaTailorTrackingUrl=function(e){if(!this.h)throw new It(1,10,10005);var t=this.h;t.G=e,t.i(new Nr("ads-loaded",(new Map).set("loadTime",0)))},i.initServerSide=function(t,n){var i=this;if(!e.google||!google.ima||!google.ima.dai)throw new It(2,10,10002);this.g&&this.g.release(),this.g=new rp(t,n,this.o,function(e){return op(i,e)}),this.g.configure(this.l)},i.requestServerSideStream=function(e,t){if(t=void 0===t?"":t,!this.g)throw new It(1,10,10003);e.adTagParameters||(e.adTagParameters={});var n=e.adTagParameters;return(n.mpt||n.mpv)&&Z('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),e.adTagParameters.mpt="shaka-player",e.adTagParameters.mpv="v4.10.9",n=this.g,n.j?e=Promise.reject(new It(1,10,10004)):(e instanceof google.ima.dai.api.LiveStreamRequest&&(n.G=!0),n.j=new Ir,n.g.requestStream(e),n.B=t||"",n.F=Date.now()/1e3,e=n.j),e},i.replaceServerSideAdTagParameters=function(e){if(!this.g)throw new It(1,10,10003);(e.mpt||e.mpv)&&Z('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),e.mpt="Shaka Player",e.mpv="v4.10.9",this.g.g.replaceAdTagParameters(e)},i.getServerSideCuePoints=function(){return pe("AdManager.getServerSideCuePoints","Please use getCuePoints function."),this.getCuePoints()},i.getCuePoints=function(){var e=[];return this.g&&(e=e.concat(this.g.getCuePoints())),this.h&&(e=e.concat(this.h.getCuePoints())),e},i.getStats=function(){var e=this.m;return{loadTimes:e.g,averageLoadTime:_f(e),started:e.h,playedCompletely:e.j,skipped:e.l,errors:e.i}},i.onManifestUpdated=function(e){this.h&&this.h.onManifestUpdated(e)},i.onDashTimedMetadata=function(e){this.g&&"urn:google:dai:2018"==e.schemeIdUri&&this.g.g.processMetadata(e.schemeIdUri,e.eventNode?e.eventNode.attributes.messageData:null,e.startTime)},i.onHlsTimedMetadata=function(e,t){this.g&&this.g.g.processMetadata("ID3",e.data,t)},i.onCueMetadataChange=function(e){this.g&&this.g.onCueMetadataChange(e)},i.onInterstitialMetadata=function(e,t,n){this.j||this.initInterstitial(null,e,t),this.j&&Pf(this.j,n)},z("shaka.ads.AdManager",sp),sp.prototype.onInterstitialMetadata=sp.prototype.onInterstitialMetadata,sp.prototype.onCueMetadataChange=sp.prototype.onCueMetadataChange,sp.prototype.onHlsTimedMetadata=sp.prototype.onHlsTimedMetadata,sp.prototype.onDashTimedMetadata=sp.prototype.onDashTimedMetadata,sp.prototype.onManifestUpdated=sp.prototype.onManifestUpdated,sp.prototype.getStats=sp.prototype.getStats,sp.prototype.getCuePoints=sp.prototype.getCuePoints,sp.prototype.getServerSideCuePoints=sp.prototype.getServerSideCuePoints,sp.prototype.replaceServerSideAdTagParameters=sp.prototype.replaceServerSideAdTagParameters,sp.prototype.requestServerSideStream=sp.prototype.requestServerSideStream,sp.prototype.initServerSide=sp.prototype.initServerSide,sp.prototype.addMediaTailorTrackingUrl=sp.prototype.addMediaTailorTrackingUrl,sp.prototype.requestMediaTailorStream=sp.prototype.requestMediaTailorStream,sp.prototype.initMediaTailor=sp.prototype.initMediaTailor,sp.prototype.updateClientSideAdsRenderingSettings=sp.prototype.updateClientSideAdsRenderingSettings,sp.prototype.requestClientSideAds=sp.prototype.requestClientSideAds,sp.prototype.onAssetUnload=sp.prototype.onAssetUnload,sp.prototype.release=sp.prototype.release,sp.prototype.initClientSide=sp.prototype.initClientSide,sp.prototype.initInterstitial=sp.prototype.initInterstitial,sp.prototype.configure=sp.prototype.configure,sp.prototype.setLocale=sp.prototype.setLocale,sp.ADS_LOADED="ads-loaded",sp.AD_STARTED="ad-started",sp.AD_FIRST_QUARTILE="ad-first-quartile",sp.AD_MIDPOINT="ad-midpoint",sp.AD_THIRD_QUARTILE="ad-third-quartile",sp.AD_COMPLETE="ad-complete",sp.AD_STOPPED="ad-stopped",sp.AD_SKIPPED="ad-skipped",sp.AD_VOLUME_CHANGED="ad-volume-changed",sp.AD_MUTED="ad-muted",sp.AD_PAUSED="ad-paused",sp.AD_RESUMED="ad-resumed",sp.AD_SKIP_STATE_CHANGED="ad-skip-state-changed",sp.CUEPOINTS_CHANGED="ad-cue-points-changed",sp.IMA_AD_MANAGER_LOADED="ima-ad-manager-loaded",sp.IMA_STREAM_MANAGER_LOADED="ima-stream-manager-loaded",sp.AD_CLICKED="ad-clicked",sp.AD_PROGRESS="ad-progress",sp.AD_BUFFERING="ad-buffering",sp.AD_IMPRESSION="ad-impression",sp.AD_DURATION_CHANGED="ad-duration-changed",sp.AD_CLOSED="ad-closed",sp.AD_LOADED="ad-loaded",sp.ALL_ADS_COMPLETED="all-ads-completed",sp.AD_LINEAR_CHANGED="ad-linear-changed",sp.AD_METADATA="ad-metadata",sp.AD_RECOVERABLE_ERROR="ad-recoverable-error",sp.AD_ERROR="ad-error",sp.AD_BREAK_READY="ad-break-ready",sp.AD_INTERACTION="ad-interaction",sp.AD_CONTENT_PAUSE_REQUESTED="ad-content-pause-requested",sp.AD_CONTENT_RESUME_REQUESTED="ad-content-resume-requested",sp.AD_CONTENT_ATTACH_REQUESTED="ad-content-attach-requested",Sf=function(){return new sp};var dp="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),hp="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),fp=["loop","playbackRate"],pp=["pause","play"],gp={getAssetUri:2,getAudioLanguages:4,getAudioLanguagesAndRoles:4,getBufferFullness:1,getBufferedInfo:2,getExpiration:2,getKeyStatuses:2,getPlaybackRate:2,getTextLanguages:4,getTextLanguagesAndRoles:4,getImageTracks:2,getThumbnails:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,getLoadMode:10,getManifestType:10,isFullyLoaded:1},mp={getConfiguration:4,getStats:5,getTextTracks:2,getVariantTracks:2},vp={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20,getSegmentAvailabilityDuration:20},yp=[["getConfiguration","configure"]],bp=[["isTextTrackVisible","setTextTrackVisibility"]],Sp="addChaptersTrack addTextTrackAsync addThumbnailsTrack cancelTrickPlay configure getChapters getChaptersTracks resetConfiguration retryStreaming selectAudioLanguage selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay updateStartTime goToLive".split(" "),Tp=["attach","attachCanvas","detach","load","unload"];function _p(e,t,n,i,r,a,s){var o=this;this.G=e,this.K=s,this.l=new Ut(t),this.L=n,this.s=!1,this.A=i,this.F=r,this.N=a,this.h=this.m=!1,this.I="",this.o=null,this.B=function(){return kp(o)},this.C=function(e,t){switch(e=up(t),e.type){case"event":var n=e.targetName,i=Ur(e.event);o.A(n,i);break;case"update":for(i in n=e.update,n)for(var r in e=o.g[i]||{},n[i])e[r]=n[i][r];o.s&&(o.L(),o.s=!1);break;case"asyncComplete":if(i=e.id,r=e.error,e=o.i[i],delete o.i[i],e)if(r){for(n in i=new It(r.severity,r.category,r.code),r)i[n]=r[n];e.reject(i)}else e.resolve()}},this.g={video:{},player:{}},this.H=0,this.i={},this.j=null,Pp.add(this)}function wp(e){e.h&&chrome.cast.requestSession(function(t){return Ep(e,t)},function(t){return xp(e,t)})}function Ep(e,t){var n=e.N();Dp=t,t.addUpdateListener(e.B),t.addMessageListener("urn:x-cast:com.google.shaka.v2",e.C),kp(e),Cp(e,{type:"init",initState:n,appData:e.o}),e.j.resolve()}function xp(e,t){var n=8003;switch(t.code){case"cancel":n=8004;break;case"timeout":n=8005;break;case"receiver_unavailable":n=8006}e.j.reject(new It(2,8,n,t))}function Ap(e){var t=Dp;t.removeUpdateListener(e.B),t.removeMessageListener("urn:x-cast:com.google.shaka.v2",e.C)}function kp(e){var t=!!Dp&&"connected"==Dp.status;if(e.h&&!t){for(var n in e.F(),e.g)e.g[n]={};Ip(e)}e.h=t,e.I=t?Dp.receiver.friendlyName:"",e.l.xc()}function Ip(e){for(var t in e.i){var n=e.i[t];delete e.i[t],n.reject(new It(1,7,7e3))}}function Cp(e,t){t=lp(t);var n=Dp;try{n.sendMessage("urn:x-cast:com.google.shaka.v2",t,function(){},ee)}catch(i){throw t=new It(2,8,8005,i),n=new Nr("error",(new Map).set("detail",t)),e.A("player",n),e.Fc(),t}}i=_p.prototype,i.destroy=function(){return Pp.delete(this),Ip(this),Dp&&Ap(this),this.l&&(this.l.stop(),this.l=null),this.F=this.A=null,this.h=this.m=!1,this.C=this.B=this.j=this.i=this.g=this.o=null,Promise.resolve()},i.gb=function(){return this.h},i.Xf=function(){return this.I},i.init=function(){if(this.G.length)if(e.chrome&&chrome.cast&&chrome.cast.isAvailable){this.m=!0,this.l.xc();var t=new chrome.cast.SessionRequest(this.G,[],null,this.K,null);t=new chrome.cast.ApiConfig(t,function(e){for(var t=c(Pp),n=t.next();!n.done;n=t.next()){n=n.value;var i=e;n.j=new Ir,n.s=!0,Ep(n,i)}},function(e){for(var t=c(Pp),n=t.next();!n.done;n=t.next())n=n.value,Mp="available"==e,n.l.xc()},"origin_scoped"),chrome.cast.initialize(t,function(){},function(){}),Mp&&this.l.Y(Rp),(t=Dp)&&t.status!=chrome.cast.SessionStatus.STOPPED?(this.j=new Ir,this.s=!0,Ep(this,t)):Dp=null}else e.__onGCastApiAvailable!==Op&&(Lp=e.__onGCastApiAvailable||null,e.__onGCastApiAvailable=Op)},i.dg=function(e){this.o=e,this.h&&Cp(this,{type:"appData",appData:this.o})},i.cast=function(){var e=this;return N(function(t){if(!e.m)throw new It(1,8,8e3);if(!Mp)throw new It(1,8,8001);if(e.h)throw new It(1,8,8002);return e.j=new Ir,chrome.cast.requestSession(function(t){return Ep(e,t)},function(t){return xp(e,t)}),_(t,e.j,0)})},i.Fc=function(){if(this.h){if(Ip(this),Dp){Ap(this);try{Dp.stop(function(){},function(){})}catch(e){}Dp=null}kp(this)}},i.get=function(e,t){var n=this;if("video"==e){if(pp.includes(t))return function(){return n.eh.apply(n,[e,t].concat(d(U.apply(0,arguments))))}}else if("player"==e){if(vp[t]&&!this.get("player","isLive")())return function(){};if(Sp.includes(t))return function(){return n.eh.apply(n,[e,t].concat(d(U.apply(0,arguments))))};if(Tp.includes(t))return function(){return n.Ri.apply(n,[e,t].concat(d(U.apply(0,arguments))))};if(gp[t]||mp[t])return function(){return n.g[e][t]}}return this.g[e][t]},i.set=function(e,t,n){this.g[e][t]=n,Cp(this,{type:"set",targetName:e,property:t,value:n})},i.eh=function(e,t){Cp(this,{type:"call",targetName:e,methodName:t,args:U.apply(2,arguments)})},i.Ri=function(e,t){var n=U.apply(2,arguments),i=new Ir,r=this.H.toString();this.H++,this.i[r]=i;try{Cp(this,{type:"asyncCall",targetName:e,methodName:t,args:n,id:r})}catch(e){i.reject(e)}return i};var Rp=.02,Mp=!1,Dp=null,Lp=null,Pp=new Set;function Op(t){if(Lp?e.__onGCastApiAvailable=Lp:delete e.__onGCastApiAvailable,Lp=null,t)for(var n=c(Pp),i=n.next();!i.done;i=n.next())i.value.init();"function"===typeof e.__onGCastApiAvailable&&e.__onGCastApiAvailable(t)}function Np(e,t,n,i){i=void 0!==i&&i,Br.call(this);var r=this;this.i=e,this.h=t,this.m=this.o=this.j=this.s=this.l=null,this.C=n,this.B=i,this.A=new Map,this.g=new _p(n,function(){return jp(r)},function(){return Gp(r)},function(e,t){return $p(r,e,t)},function(){return Hp(r)},function(){return Vp(r)},i),Up(this)}function Up(e){e.g.init(),e.m=new ae;for(var t=c(dp),n=t.next();!n.done;n=t.next())e.m.D(e.i,n.value,function(t){e.g.gb()||(t=Ur(t),e.j.dispatchEvent(t))});for(var i in Fr)e.m.D(e.h,Fr[i],function(t){e.g.gb()||e.o.dispatchEvent(t)});for(var r in e.l={},t={},e.i)t.$c=r,Object.defineProperty(e.l,t.$c,{configurable:!1,enumerable:!0,get:function(t){return function(){return zp(e,t.$c)}}(t),set:function(t){return function(n){var i=t.$c;e.g.gb()?e.g.set("video",i,n):e.i[i]=n}}(t)}),t={$c:t.$c};e.s={},Bp(e,function(t){Object.defineProperty(e.s,t,{configurable:!1,enumerable:!0,get:function(){return Kp(e,t)}})}),Fp(e),e.j=new Br,e.j.Ge=e.l,e.o=new Br,e.o.Ge=e.s}function Fp(e){var t=new Map;Bp(e,function(n,i){t.has(i)?(i=t.get(i),n.length<i.length?e.A.set(n,i):e.A.set(i,n)):t.set(i,n)})}function Bp(e,t){function n(e){return"constructor"!=e&&"function"==typeof r[e]&&!a.has(e)}var i,r=e.h,a=new Set;for(i in r)n(i)&&(a.add(i),t(i,r[i]));for(e=Object.getPrototypeOf(r),i=Object.getPrototypeOf({});e&&e!=i;){for(var s=c(Object.getOwnPropertyNames(e)),o=s.next();!o.done;o=s.next())o=o.value,n(o)&&(a.add(o),t(o,r[o]));e=Object.getPrototypeOf(e)}}function Vp(e){var t={video:{},player:{},playerAfterLoad:{},manifest:e.h.Gc(),startTime:null};e.i.pause();for(var n=c(fp),i=n.next();!i.done;i=n.next())i=i.value,t.video[i]=e.i[i];for(e.i.ended||(t.startTime=e.i.currentTime),n=c(yp),i=n.next();!i.done;i=n.next()){var r=i.value;i=r[1],r=e.h[r[0]](),t.player[i]=r}for(n=c(bp),i=n.next();!i.done;i=n.next())r=i.value,i=r[1],r=e.h[r[0]](),t.playerAfterLoad[i]=r;return t}function jp(e){var t=new Nr("caststatuschanged");e.dispatchEvent(t)}function Gp(e){var t=new Nr(e.l.paused?"pause":"play");e.j.dispatchEvent(t)}function Hp(e){for(var t=c(yp),n=t.next();!n.done;n=t.next()){var i=n.value;n=i[1],i=e.g.get("player",i[0])(),e.h[n](i)}var r=e.g.get("player","getAssetUri")();i=e.g.get("video","ended"),t=Promise.resolve();var a,s=e.i.autoplay;n=null,i||(n=e.g.get("video","currentTime")),(i=e.g.get("player","getTextTracks")())&&i.length&&(a=i.find(function(e){return e.active}));var o=e.g.get("player","isTextTrackVisible")();r&&(e.i.autoplay=!1,t=e.h.load(r,n));var l={};for(n=c(fp),i=n.next();!i.done;i=n.next())i=i.value,l[i]=e.g.get("video",i);t.then(function(){if(e.i){for(var t=c(fp),n=t.next();!n.done;n=t.next())n=n.value,e.i[n]=l[n];for(t=c(bp),n=t.next();!n.done;n=t.next()){var i=n.value;n=i[1],i=e.g.get("player",i[0])(),e.h[n](i)}e.h.nh(o),a&&e.h.bg(a.language,a.roles,a.forced),e.i.autoplay=s,r&&e.i.play()}},function(t){t=(new Map).set("detail",t),t=new Nr("error",t),e.h.dispatchEvent(t)})}function zp(e,t){if("addEventListener"==t)return function(t,n,i){return e.j.addEventListener(t,n,i)};if("removeEventListener"==t)return function(t,n,i){return e.j.removeEventListener(t,n,i)};if(e.g.gb()&&0==Object.keys(e.g.g.video).length){var n=e.i[t];if("function"!=typeof n)return n}return e.g.gb()?e.g.get("video",t):(t=e.i[t],"function"==typeof t&&(t=t.bind(e.i)),t)}function Kp(e,t){if(e.A.has(t)&&(t=e.A.get(t)),"addEventListener"==t)return function(t,n,i){return e.o.addEventListener(t,n,i)};if("removeEventListener"==t)return function(t,n,i){return e.o.removeEventListener(t,n,i)};if("getMediaElement"==t)return function(){return e.l};if("getSharedConfiguration"==t)return e.g.get("player","getConfiguration");if("getNetworkingEngine"==t)return function(){return e.h.zb()};if("getDrmEngine"==t)return function(){return e.h.B};if("getAdManager"==t)return function(){return e.h.Ig()};if("setVideoContainer"==t)return function(t){return e.h.rh(t)};if(e.g.gb()){if("getManifest"==t||"drmInfo"==t)return function(){return Z(t+"() does not work while casting!"),null};if("attach"==t||"detach"==t)return function(){return Z(t+"() does not work while casting!"),Promise.resolve()}}return e.g.gb()&&0==Object.keys(e.g.g.video).length&&(gp[t]||mp[t])||!e.g.gb()?e.h[t].bind(e.h):e.g.get("player",t)}function $p(e,t,n){e.g.gb()&&("video"==t?e.j.dispatchEvent(n):"player"==t&&e.o.dispatchEvent(n))}function Wp(e,t,n,i){Br.call(this);var r=this;this.g=e,this.h=t,this.j=new ae,this.H={video:e,player:t},this.F=n||function(){},this.I=i||function(e){return e},this.i=null,this.G=!1,this.o=!0,this.m=0,this.B=!1,this.A=!0,this.s=this.l=null,this.C=new Ut(function(){Jp(r)}),qp(this)}function qp(e){var t=cast.receiver.CastReceiverManager.getInstance();t.onSenderConnected=function(){return Yp(e)},t.onSenderDisconnected=function(){return Yp(e)},t.onSystemVolumeChanged=function(){var t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();t&&ag(e,{type:"update",update:{video:{volume:t.level,muted:t.muted}}},e.l),ag(e,{type:"event",targetName:"video",event:{type:"volumechange"}},e.l)},e.s=t.getCastMessageBus("urn:x-cast:com.google.cast.media"),e.s.onMessage=function(t){return ig(e,t)},e.l=t.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),e.l.onMessage=function(t){return ng(e,t)},t.start(),t=c(dp);for(var n=t.next();!n.done;n=t.next())e.j.D(e.g,n.value,function(t){return Zp(e,"video",t)});for(var i in Fr)e.j.D(e.h,Fr[i],function(t){return Zp(e,"player",t)});e.j.D(e.g,"loadeddata",function(){e.B=!0}),e.j.D(e.h,"loading",function(){e.o=!1,Xp(e)}),e.j.D(e.g,"playing",function(){e.o=!1,Xp(e)}),e.j.D(e.g,"pause",function(){Xp(e)}),e.j.D(e.h,"unloading",function(){e.o=!0,Xp(e)}),e.j.D(e.g,"ended",function(){new Ut(function(){e.g&&e.g.ended&&(e.o=!0,Xp(e))}).Y(lg)})}function Yp(e){e.m=0,e.A=!0,e.G=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,Xp(e)}function Xp(e){var t;N(function(n){return 1==n.g?_(n,Promise.resolve(),2):e.h?(t=new Nr("caststatuschanged"),e.dispatchEvent(t),eg(e)||sg(e),void w(n)):n.return()})}function Qp(e,t,n){var i,r,a,s,o,l,u,c,d,h;N(function(f){switch(f.g){case 1:for(i in t.player)r=t.player[i],e.h[i](r);return e.F(n),a=e.g.autoplay,t.manifest?(e.g.autoplay=!1,E(f,5),_(f,e.h.load(t.manifest,t.startTime),7)):_(f,Promise.resolve(),3);case 7:A(f,3);break;case 5:return s=k(f),o=(new Map).set("detail",s),l=new Nr("error",o),e.h&&e.h.dispatchEvent(l),f.return();case 3:if(!e.h)return f.return();for(u in t.video)c=t.video[u],e.g[u]=c;for(d in t.playerAfterLoad)h=t.playerAfterLoad[d],e.h[d](h);e.g.autoplay=a,t.manifest&&(e.g.play(),sg(e)),w(f)}})}function Zp(e,t,n){e.h&&(Jp(e),ag(e,{type:"event",targetName:t,event:n},e.l))}function Jp(e){e.C.Y(og);for(var t={video:{},player:{}},n=c(hp),i=n.next();!i.done;i=n.next())i=i.value,t.video[i]=e.g[i];if(e.h.V())for(var r in vp)0==e.m%vp[r]&&(t.player[r]=e.h[r]());for(var a in gp)0==e.m%gp[a]&&(t.player[a]=e.h[a]());for(var s in(n=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(t.video.volume=n.level,t.video.muted=n.muted),ag(e,{type:"update",update:t},e.l),mp)0==e.m%mp[s]&&(t={player:{}},t.player[s]=e.h[s](),ag(e,{type:"update",update:t},e.l));e.B&&(e.m+=1),eg(e)}function eg(e){return!(!e.A||!e.g.duration&&!e.h.V())&&(tg(e),e.A=!1,!0)}function tg(e,t){var n={contentId:e.h.Gc(),streamType:e.h.V()?"LIVE":"BUFFERED",contentType:""};e.h.V()||(n.duration=e.g.duration),e.i&&(n.metadata=e.i),sg(e,void 0===t?0:t,n)}function ng(e,t){var n=up(t.data);switch(n.type){case"init":e.m=0,e.B=!1,e.A=!0,Qp(e,n.initState,n.appData),Jp(e);break;case"appData":e.F(n.appData);break;case"set":var i=n.targetName,r=n.property;if(n=n.value,"video"==i){if(t=cast.receiver.CastReceiverManager.getInstance(),"volume"==r){t.setSystemVolumeLevel(n);break}if("muted"==r){t.setSystemVolumeMuted(n);break}}e.H[i][r]=n;break;case"call":i=e.H[n.targetName],i[n.methodName].apply(i,n.args);break;case"asyncCall":i=n.targetName,r=n.methodName,"player"==i&&"load"==r&&(e.m=0,e.B=!1);var a=n.id,s=t.senderId;t=e.H[i],n=t[r].apply(t,n.args),"player"==i&&"load"==r&&(n=n.then(function(){e.A=!0})),n.then(function(){return rg(e,s,a,null)},function(t){return rg(e,s,a,t)})}}function ig(e,t){var n=up(t.data);switch(n.type){case"PLAY":e.g.play(),sg(e);break;case"PAUSE":e.g.pause(),sg(e);break;case"SEEK":t=n.currentTime;var i=n.resumeState;null!=t&&(e.g.currentTime=Number(t)),i&&"PLAYBACK_START"==i?(e.g.play(),sg(e)):i&&"PLAYBACK_PAUSE"==i&&(e.g.pause(),sg(e));break;case"STOP":e.h.dc().then(function(){e.h&&sg(e)});break;case"GET_STATUS":tg(e,Number(n.requestId));break;case"VOLUME":i=n.volume,t=i.level,i=i.muted;var r=e.g.volume,a=e.g.muted;null!=t&&(e.g.volume=Number(t)),null!=i&&(e.g.muted=i),r==e.g.volume&&a==e.g.muted||sg(e);break;case"LOAD":e.m=0,e.B=!1,e.A=!1,t=n.media,i=n.currentTime,r=e.I(t.contentId),a=n.autoplay||!0,e.F(t.customData),a&&(e.g.autoplay=!0),e.h.load(r,i).then(function(){e.h&&tg(e)}).catch(function(t){var i="LOAD_FAILED";7==t.category&&7e3==t.code&&(i="LOAD_CANCELLED"),ag(e,{requestId:Number(n.requestId),type:i},e.s)});break;default:ag(e,{requestId:Number(n.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},e.s)}}function rg(e,t,n,i){e.h&&ag(e,{type:"asyncComplete",id:n,error:i},e.l,t)}function ag(e,t,n,i){e.G&&(e=lp(t),i?n.getCastChannel(i).send(e):n.broadcast(e))}function sg(e,t,n){n=void 0===n?null:n;var i={mediaSessionId:0,playbackRate:e.g.playbackRate,playerState:e.o?ug:e.h.Jf()?dg:e.g.paused?hg:cg,currentTime:e.g.currentTime,supportedMediaCommands:63,volume:{level:e.g.volume,muted:e.g.muted}};n&&(i.media=n),ag(e,{requestId:void 0===t?0:t,type:"MEDIA_STATUS",status:[i]},e.s)}y(Np,Br),i=Np.prototype,i.destroy=function(e){return e&&this.g.Fc(),this.m&&(this.m.release(),this.m=null),e=[],this.h&&(e.push(this.h.destroy()),this.h=null),this.g&&(e.push(this.g.destroy()),this.g=null),this.s=this.l=this.i=null,Br.prototype.release.call(this),Promise.all(e)},i.mi=function(){return this.l},i.bi=function(){return this.s},i.Hh=function(){return this.g.m&&Mp},i.gb=function(){return this.g.gb()},i.Xf=function(){return this.g.Xf()},i.cast=function(){var e=this;return N(function(t){return 1==t.g?_(t,e.g.cast(),2):e.h?_(t,e.h.dc(),0):t.return()})},i.dg=function(e){this.g.dg(e)},i.gj=function(){wp(this.g)},i.Fc=function(){this.g.Fc()},i.Ih=function(e,t){t=void 0!==t&&t;var n=this;return N(function(i){if(1==i.g)return e==n.C&&t==n.B?i.return():(n.C=e,n.B=t,n.g.Fc(),_(i,n.g.destroy(),2));n.g=null,n.g=new _p(e,function(){return jp(n)},function(){return Gp(n)},function(e,t){return $p(n,e,t)},function(){return Hp(n)},function(){return Vp(n)},t),n.g.init(),w(i)})},z("shaka.cast.CastProxy",Np),Np.prototype.changeReceiverId=Np.prototype.Ih,Np.prototype.forceDisconnect=Np.prototype.Fc,Np.prototype.suggestDisconnect=Np.prototype.gj,Np.prototype.setAppData=Np.prototype.dg,Np.prototype.cast=Np.prototype.cast,Np.prototype.receiverName=Np.prototype.Xf,Np.prototype.isCasting=Np.prototype.gb,Np.prototype.canCast=Np.prototype.Hh,Np.prototype.getPlayer=Np.prototype.bi,Np.prototype.getVideo=Np.prototype.mi,Np.prototype.destroy=Np.prototype.destroy,y(Wp,Br),i=Wp.prototype,i.isConnected=function(){return this.G},i.ui=function(){return this.o},i.cj=function(e){this.i=e},i.Kh=function(){this.i=null},i.dj=function(e){this.i||(this.i={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.i.title=e},i.bj=function(e){this.i||(this.i={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.i.images=[{url:e}]},i.aj=function(e){this.i||(this.i={}),this.i.artist=e,this.i.metadataType=cast.receiver.media.MetadataType.MUSIC_TRACK},i.destroy=function(){var e,t,n=this;return N(function(i){if(1==i.g)return n.j&&(n.j.release(),n.j=null),e=[],n.h&&(e.push(n.h.destroy()),n.h=null),n.C&&(n.C.stop(),n.C=null),n.g=null,n.H=null,n.F=null,n.G=!1,n.o=!0,n.l=null,n.s=null,Br.prototype.release.call(n),_(i,Promise.all(e),2);t=cast.receiver.CastReceiverManager.getInstance(),t.stop(),w(i)})},z("shaka.cast.CastReceiver",Wp),Wp.prototype.destroy=Wp.prototype.destroy,Wp.prototype.setContentArtist=Wp.prototype.aj,Wp.prototype.setContentImage=Wp.prototype.bj,Wp.prototype.setContentTitle=Wp.prototype.dj,Wp.prototype.clearContentMetadata=Wp.prototype.Kh,Wp.prototype.setContentMetadata=Wp.prototype.cj,Wp.prototype.isIdle=Wp.prototype.ui,Wp.prototype.isConnected=Wp.prototype.isConnected;var og=.5,lg=5,ug="IDLE",cg="PLAYING",dg="BUFFERING",hg="PAUSED";function fg(e,t,n,i,r){if(i>=r)return null;for(var a=-1,s=-1,o=0;o<n.length;o++)if(n[o].some(function(e){return null!=e&&""!=e.g.trim()})){a=o;break}for(o=n.length-1;0<=o;o--)if(n[o].some(function(e){return null!=e&&""!=e.g.trim()})){s=o;break}if(-1===a||-1===s)return null;for(var l=o=!1,u="white",c="black",d=pg(i,r,o,l,u,c);a<=s;a++){for(var h=n[a],f=-1,p=-1,g=0;g<h.length;g++)if(null!=h[g]&&""!==h[g].g.trim()){f=g;break}for(g=h.length-1;0<=g;g--)if(null!=h[g]&&""!==h[g].g.trim()){p=g;break}if(-1===f||-1===p)h=gg(i,r),e.nestedCues.push(h);else{for(;f<=p;f++)if(g=h[f]){var m=g.l,v=g.i,y=g.j,b=g.h;m==o&&v==l&&y==u&&b==c||(d.payload&&e.nestedCues.push(d),d=pg(i,r,m,v,y,b),o=m,l=v,u=y,c=b),d.payload+=g.g}else d.payload+=" ";d.payload&&e.nestedCues.push(d),a!==s&&(d=gg(i,r),e.nestedCues.push(d)),d=pg(i,r,o,l,u,c)}}return e.nestedCues.length?{cue:e,stream:t}:null}function pg(e,t,n,i,r,a){return e=new Be(e,t,""),n&&e.textDecoration.push("underline"),i&&(e.fontStyle="italic"),e.color=r,e.backgroundColor=a,e}function gg(e,t){return e=new Be(e,t,""),e.lineBreak=!0,e}function mg(e,t,n,i,r){this.g=e,this.l=t,this.i=n,this.h=i,this.j=r}function vg(e,t){this.i=[],this.g=1,this.h=0,this.A=e,this.s=t,this.j=this.m=!1,this.l="white",this.o="black",bg(this)}function yg(e,t,n){var i="CC"+(1+(e.A<<1|e.s)),r=new Be(t,n,"");r.lineInterpretation=1;var a=Mg.get(e.g);return a&&(r.line=a),(t=fg(r,i,e.i,t,n))&&15<e.g+t.cue.nestedCues.length-3&&(a=Mg.get(e.g+3-t.cue.nestedCues.length))&&(r.line=a),t}function bg(e){_g(e,0,15),e.g=1}function Sg(e,t,n){if(!(32>n||127<n)){var i="";switch(t){case wg:i=kg.has(n)?kg.get(n):String.fromCharCode(n);break;case Eg:i=Ig.get(n);break;case xg:e.i[e.g].pop(),i=Cg.get(n);break;case Ag:e.i[e.g].pop(),i=Rg.get(n)}i&&e.i[e.g].push(new mg(i,e.m,e.j,e.o,e.l))}}function Tg(e,t,n,i){if(!(0>n||0>t))if(t>=n)for(--i;0<=i;i--)e.i[t+i]=e.i[n+i].map(function(e){return e});else for(var r=0;r<i;r++)e.i[t+r]=e.i[n+r].map(function(e){return e})}function _g(e,t,n){for(var i=0;i<=n;i++)e.i[t+i]=[]}var wg=0,Eg=1,xg=2,Ag=3,kg=new Map([[39,"’"],[42,"á"],[92,"é"],[92,"é"],[94,"í"],[95,"ó"],[96,"ú"],[123,"ç"],[124,"÷"],[125,"Ñ"],[126,"ñ"],[127,"█"]]),Ig=new Map([[48,"®"],[49,"°"],[50,"½"],[51,"¿"],[52,"™"],[53,"¢"],[54,"£"],[55,"♪"],[56,"à"],[57," "],[58,"è"],[59,"â"],[60,"ê"],[61,"î"],[62,"ô"],[63,"û"]]),Cg=new Map([[32,"Á"],[33,"É"],[34,"Ó"],[35,"Ú"],[36,"Ü"],[37,"ü"],[38,"‘"],[39,"¡"],[40,"*"],[41,"'"],[42,"─"],[43,"©"],[44,"℠"],[45,"·"],[46,"“"],[47,"”"],[48,"À"],[49,"Â"],[50,"Ç"],[51,"È"],[52,"Ê"],[53,"Ë"],[54,"ë"],[55,"Î"],[56,"Ï"],[57,"ï"],[58,"Ô"],[59,"Ù"],[60,"ù"],[61,"Û"],[62,"«"],[63,"»"]]),Rg=new Map([[32,"Ã"],[33,"ã"],[34,"Í"],[35,"Ì"],[36,"ì"],[37,"Ò"],[38,"ò"],[39,"Õ"],[40,"õ"],[41,"{"],[42,"}"],[43,"\\"],[44,"^"],[45,"_"],[46,"|"],[47,"~"],[48,"Ä"],[49,"ä"],[50,"Ö"],[51,"ö"],[52,"ß"],[53,"¥"],[54,"¤"],[55,"│"],[56,"Å"],[57,"å"],[58,"Ø"],[59,"ø"],[60,"┌"],[61,"┐"],[62,"└"],[63,"┘"]]),Mg=new Map([[1,10],[2,15.33],[3,20.66],[4,26],[5,31.33],[6,36.66],[7,42],[8,47.33],[9,52.66],[10,58],[11,63.33],[12,68.66],[13,74],[14,79.33],[15,84.66]]);function Dg(e,t){this.h=Ng,this.o=new vg(e,t),this.i=new vg(e,t),this.g=this.j=new vg(e,t),this.l=0,this.m=null}function Lg(e,t,n){e.g=e.i;var i=e.g,r=null;return e.h!==Fg&&e.h!==Bg&&(r=yg(i,e.l,n),n=e.i,n.g=0<n.h?n.h:0,_g(n,0,15),n=e.j,n.g=0<n.h?n.h:0,_g(n,0,15),i.g=15),e.h=Fg,i.h=t,r}function Pg(e){e.h=Ug,e.g=e.j,e.g.h=0}function Og(e){J("Cea608DataChannel","CEA-608 text mode entered, but is unsupported"),e.g=e.o,e.h=Bg}var Ng=0,Ug=1,Fg=3,Bg=4,Vg="black green blue cyan red yellow magenta black".split(" "),jg="white green blue cyan red yellow magenta white_italics".split(" ");function Gg(e,t){this.I=t,this.N=e,this.K=this.l=!1,this.m=this.o=this.G=this.L=this.H=0,this.F=Xg,this.i=[],this.g=this.h=this.j=0,this.C=this.A=!1,this.B="white",this.s="black",Hg(this)}function Hg(e){e.i=[];for(var t=0;16>t;t++)e.i.push(zg())}function zg(){for(var e=[],t=0;42>t;t++)e.push(null);return e}function Kg(e,t){$g(e)&&(e.i[e.h][e.g]=new mg(t,e.C,e.A,e.s,e.B),e.g++)}function $g(e){var t=e.g<e.m&&0<=e.g;return e.h<e.o&&0<=e.h&&t}function Wg(e,t,n){var i=new Be(e.j,t,"");i.textAlign=e.F===qg?"left":e.F===Yg?"right":He;var r=i.region;switch(e.I&&(r.id+="svc"+e.I),r.id+="win"+e.N,r.height=e.o,r.width=e.m,r.heightUnits=2,r.widthUnits=2,r.viewportAnchorX=e.H,r.viewportAnchorY=e.L,r.viewportAnchorUnits=e.K?Le:2,e.G){case Qg:r.regionAnchorX=0,r.regionAnchorY=0;break;case Zg:r.regionAnchorX=50,r.regionAnchorY=0;break;case Jg:r.regionAnchorX=100,r.regionAnchorY=0;break;case em:r.regionAnchorX=0,r.regionAnchorY=50;break;case tm:r.regionAnchorX=50,r.regionAnchorY=50;break;case nm:r.regionAnchorX=100,r.regionAnchorY=50;break;case im:r.regionAnchorX=0,r.regionAnchorY=100;break;case rm:r.regionAnchorX=50,r.regionAnchorY=100;break;case am:r.regionAnchorX=100,r.regionAnchorY=100}return(n=fg(i,"svc"+n,e.i,e.j,t))&&(e.j=t),n}Gg.prototype.isVisible=function(){return this.l};var qg=0,Yg=1,Xg=2,Qg=0,Zg=1,Jg=2,em=3,tm=4,nm=5,im=6,rm=7,am=8;function sm(){this.i=[],this.h=null,this.g=0}function om(e,t){3===t.type?(e.g=2*(63&t.value)-1,e.h=[]):e.h&&(0<e.g&&(e.h.push(t),e.g--),0===e.g&&(e.i.push(new lm(e.h)),e.h=null,e.g=0))}function lm(e){this.g=0,this.h=e}function um(e){if(!e.oa())throw new It(2,2,3e3);return e.h[e.g++]}function cm(e){this.i=e,this.h=[null,null,null,null,null,null,null,null],this.g=null}function dm(e,t,n,i){if(128<=n&&135>=n)i=7&n,e.h[i]&&(e.g=e.h[i]);else{if(136===n){n=um(t).value,t=null,n=c(hm(e,n));for(var r=n.next();!r.done;r=n.next())r=e.h[r.value],r.isVisible()&&(t=Wg(r,i,e.i)),Hg(r);return t}if(137===n)for(t=um(t).value,t=c(hm(e,t)),n=t.next();!n.done;n=t.next())n=e.h[n.value],n.isVisible()||(n.j=i),n.l=!0;else{if(138===n){for(n=um(t).value,t=null,n=c(hm(e,n)),r=n.next();!r.done;r=n.next())r=e.h[r.value],r.isVisible()&&(t=Wg(r,i,e.i)),r.l=!1;return t}if(139===n){for(n=um(t).value,t=null,n=c(hm(e,n)),r=n.next();!r.done;r=n.next())r=e.h[r.value],r.isVisible()?t=Wg(r,i,e.i):r.j=i,r.l=!r.l;return t}if(140===n)return t=um(t).value,fm(e,t,i);if(143===n)return i=fm(e,255,i),pm(e),i;if(144===n)t.skip(1),i=um(t).value,e.g&&(e.g.A=0<(128&i),e.g.C=0<(64&i));else if(145===n)i=um(t).value,n=um(t).value,t.skip(1),e.g&&(t=gm((48&n)>>4,(12&n)>>2,3&n),e.g.B=gm((48&i)>>4,(12&i)>>2,3&i),e.g.s=t);else if(146===n)i=um(t).value,t=um(t).value,e.g&&(e=e.g,e.h=15&i,e.g=63&t);else if(151===n)t.skip(1),t.skip(1),i=um(t).value,t.skip(1),e.g&&(e.g.F=3&i);else if(152<=n&&159>=n){if(n=(15&n)-8,r=null!==e.h[n],!r){var a=new Gg(n,e.i);a.j=i,e.h[n]=a}i=um(t).value,a=um(t).value;var s=um(t).value,o=um(t).value,l=um(t).value;t=um(t).value,r&&0===(7&t)||(t=e.h[n],t.h=0,t.g=0,t.C=!1,t.A=!1,t.B="white",t.s="black"),t=e.h[n],t.l=0<(32&i),t.L=127&a,t.H=s,t.G=(240&o)>>4,t.K=0<(128&a),t.o=1+(15&o),t.m=1+(63&l),e.g=e.h[n]}}}return null}function hm(e,t){for(var n=[],i=0;8>i;i++)1===(1&t)&&e.h[i]&&n.push(i),t>>=1;return n}function fm(e,t,n){var i=null;t=c(hm(e,t));for(var r=t.next();!r.done;r=t.next()){r=r.value;var a=e.h[r];a.isVisible()&&(i=Wg(a,n,e.i)),e.h[r]=null}return i}function pm(e){e.g=null,e.h=[null,null,null,null,null,null,null,null]}function gm(e,t,n){var i={0:0,1:0,2:1,3:1};return e=i[e],t=i[t],n=i[n],vm[e<<2|t<<1|n]}lm.prototype.oa=function(){return this.g<this.h.length},lm.prototype.ua=function(){return this.g},lm.prototype.skip=function(e){if(this.g+e>this.h.length)throw new It(2,2,3e3);this.g+=e};var mm=new Map([[32," "],[33," "],[37,"…"],[42,"Š"],[44,"Œ"],[48,"█"],[49,"‘"],[50,"’"],[51,"“"],[52,"”"],[53,"•"],[57,"™"],[58,"š"],[60,"œ"],[61,"℠"],[63,"Ÿ"],[118,"⅛"],[119,"⅜"],[120,"⅝"],[121,"⅞"],[122,"│"],[123,"┐"],[124,"└"],[125,"─"],[126,"┘"],[127,"┌"]]),vm="black blue green cyan red magenta yellow white".split(" ");function ym(){this.h=[],this.g=[],this.i=new sm,this.l=0,this.m=new Map([["CC1",new Dg(0,0)],["CC2",new Dg(0,1)],["CC3",new Dg(1,0)],["CC4",new Dg(1,1)]]),this.s=this.o=0,this.j=new Map,this.B=!0,this.A=new Set,bm(this)}function bm(e){e.o=0,e.s=0;for(var t=c(e.m.values()),n=t.next();!n.done;n=t.next())n=n.value,n.h=Ng,n.g=n.j,n.m=null,bg(n.i),bg(n.j),bg(n.o);e.B=!0}function Sm(e,t){var n=t.type;if(16===(112&t.cb)){var i=t.cb>>3&1;0===n?e.o=i:e.s=i}if(i="CC"+(1+(n<<1|(n?e.s:e.o))),n=e.m.get(i),255===t.cb&&255===t.Eb||!t.cb&&!t.Eb||!_m(t.cb)||!_m(t.Eb))return 45<=++e.l&&bm(e),null;e.l=0,t.cb&=127,t.Eb&=127;var r=t.cb;if(1<=r&&15>=r||!t.cb&&!t.Eb)return null;if(r=null,16===(112&t.cb))e:{if(e.A.add(i),i=t.cb,e=t.Eb,n.m===(i<<8|e))n.m=null;else if(n.m=i<<8|e,16===(240&i)&&64===(192&e)){t=[11,11,1,2,3,4,12,13,14,15,5,6,7,8,9,10][(7&i)<<1|e>>5&1];var a=(30&e)>>1;i="white",r=!1,7>a?i=jg[a]:7===a&&(r=!0),e=1===(1&e),n.h!==Bg&&(a=n.g,n.h===Fg&&t!==a.g&&(n=1+t-a.h,Tg(a,n,1+a.g-a.h,a.h),_g(a,0,n-1),_g(a,t+1,15-t)),a.g=t,a.m=e,a.j=r,a.l=i,a.o="black")}else if(17===(247&i)&&32===(240&e))n.g.m=!1,n.g.j=!1,n.g.l="white",Sg(n.g,wg,32),i=!1,t=jg[(14&e)>>1],"white_italics"===t&&(t="white",i=!0),n.g.m=1===(1&e),n.g.j=i,n.g.l=t;else if(16===(247&i)&&32===(240&e)||23===(247&i)&&45===(255&e))t="black",0===(7&i)&&(t=Vg[(14&e)>>1]),n.g.o=t;else if(17===(247&i)&&48===(240&e))Sg(n.g,Eg,e);else if(18===(246&i)&&32===(224&e))Sg(n.g,1&i?Ag:xg,e);else if(20===(246&i)&&32===(240&e)){switch(e=t.pts,i=null,t.Eb){case 32:Pg(n);break;case 33:n=n.g,n.i[n.g].pop();break;case 37:i=Lg(n,2,e);break;case 38:i=Lg(n,3,e);break;case 39:i=Lg(n,4,e);break;case 40:Sg(n.g,wg,32);break;case 41:n.h=2,n.g=n.i,n.g.h=0,n.l=e;break;case 42:bg(n.o),Og(n);break;case 43:Og(n);break;case 44:t=n.i,i=null,n.h!==Bg&&(i=yg(t,n.l,e)),_g(t,0,15);break;case 45:t=n.g,n.h!==Fg?i=null:(i=yg(t,n.l,e),r=t.g-t.h+1,Tg(t,r-1,r,t.h),_g(t,0,r-1),_g(t,t.g,15-t.g),n.l=e);break;case 46:_g(n.j,0,15);break;case 47:t=null,n.h!==Bg&&(t=yg(n.i,n.l,e)),i=n.j,n.j=n.i,n.i=i,Pg(n),n.l=e,i=t}r=i;break e}r=null}else e=t.Eb,Sg(n.g,wg,t.cb),Sg(n.g,wg,e);return r}function Tm(e,t){var n=[];try{for(;t.oa();){var i=um(t).value,r=(224&i)>>5,a=31&i;if(7===r&&0!=a&&(r=63&um(t).value),0!=r){e.A.add("svc"+r),e.j.has(r)||e.j.set(r,new cm(r));for(var s=e.j.get(r),o=t.ua();t.ua()-o<a;){r=t;var l=um(r),u=l.value,c=l.pts;if(16===u){var d=um(r);u=u<<16|d.value}if(0<=u&&31>=u){var h=c;if(s.g){var f=s.g;switch(r=null,u){case 8:!$g(f)||0>=f.g&&0>=f.h||(0>=f.g?(f.g=f.m-1,f.h--):f.g--,f.i[f.h][f.g]=null);break;case 13:if(f.isVisible()&&(r=Wg(f,h,s.i)),f.h+1>=f.o){h=f;for(var p=0,g=1;16>g;g++,p++)h.i[p]=h.i[g];for(g=0;1>g;g++,p++)h.i[p]=zg()}else f.h++;f.g=0;break;case 14:f.isVisible()&&(r=Wg(f,h,s.i)),f.i[f.h]=zg(),f.g=0;break;case 12:f.isVisible()&&(r=Wg(f,h,s.i)),Hg(f),h=f,h.h=0,h.g=0}var m=r}else m=null}else if(128<=u&&159>=u)m=dm(s,r,u,c);else{if(4096<=u&&4127>=u)h=255&u,8<=h&&15>=h?r.skip(1):16<=h&&23>=h?r.skip(2):24<=h&&31>=h&&r.skip(3);else if(4224<=u&&4255>=u)h=255&u,128<=h&&135>=h?r.skip(4):136<=h&&143>=h&&r.skip(5);else if(32<=u&&127>=u)r=u,s.g&&Kg(s.g,127===r?"♪":String.fromCharCode(r));else if(160<=u&&255>=u)s.g&&Kg(s.g,String.fromCharCode(u));else if(4128<=u&&4223>=u){if(r=255&u,s.g)if(mm.has(r)){var v=mm.get(r);Kg(s.g,v)}else Kg(s.g,"_")}else 4256<=u&&4351>=u&&s.g&&Kg(s.g,160!=(255&u)?"_":"[CC]");m=null}(r=m)&&n.push(r)}}}}catch(e){if(!(e instanceof It&&3e3===e.code))throw e;J("CEA708_INVALID_DATA","Buffer read out of bounds / invalid CEA-708 Data.")}return n}function _m(e){for(var t=0;e;)t^=1&e,e>>=1;return 1===t}function wm(e){for(var t=[],n=e,i=e=0;i<n.length;)2==e&&3==n[i]?(e=0,n=[].concat(d(n)),n.splice(i,1),n=new Uint8Array(n)):0==n[i]?e++:e=0,i++;for(e=n,i=0;i<e.length;){for(n=0;255==e[i];)n+=255,i++;n+=e[i++];for(var r=0;255==e[i];)r+=255,i++;r+=e[i++],4==n&&t.push(e.subarray(i,i+r)),i+=r}return t}function Em(){this.j=new Map,this.i=this.h=0,this.g=Am}function xm(e,t,n,i,r,a,s,o,l){var u=0,h=a,f=o.map(function(e){return e.fh});for(f=[].concat.apply([],d(f)),f.length&&(h=f[0].sampleSize||a),t.skip(s+o[0].Mh);t.oa();){s=t.P();var p=t.T(),g=null;switch(g=!1,o=1,e.g){case km:g=31&p,g=6==g;break;case Im:o=2,t.skip(1),g=p>>1&63,g=39==g||40==g;break;case Cm:o=2,t.skip(1),g=p>>1&63,g=23==g||24==g;break;default:return}if(g)for(p=0,u<f.length&&(p=f[u].He||0),p=(n+p)/i,o=c(wm(t.rb(s-o))),g=o.next();!g.done;g=o.next())l.push({packet:g.value,pts:p});else try{t.skip(s-o)}catch(e){break}h-=s+4,0==h&&(n=u<f.length?n+(f[u].$f||r):n+r,u++,h=u<f.length&&f[u].sampleSize||a)}}ym.prototype.clear=function(){this.l=0,this.h=[],this.g=[];var e=this.i;e.i=[],e.h=[],e.g=0,bm(this),e=c(this.j.values());for(var t=e.next();!t.done;t=e.next())pm(t.value)},ym.prototype.extract=function(e,t){if(this.B){for(var n=c(this.m.values()),i=n.next();!i.done;i=n.next())i.value.l=t;this.B=!1}if(e=new oa(e,0),!(8>e.getLength())&&181===e.T()&&49===e.ka()&&1195456820===e.P()&&3===e.T()&&(n=e.T(),0!==(64&n)))for(n&=31,e.skip(1),i=0;i<n;i++){var r=e.T(),a=(4&r)>>2,s=e.T(),o=e.T();a&&(r&=3,0===r||1===r?this.h.push({pts:t,type:r,cb:s,Eb:o,order:this.h.length}):(this.g.push({pts:t,type:r,value:s,order:this.g.length}),this.g.push({pts:t,type:2,value:o,order:this.g.length})))}},ym.prototype.decode=function(){function e(e,t){return e.pts-t.pts||e.order-t.order}var t=[];this.h.sort(e),this.g.sort(e);for(var n=c(this.h),i=n.next();!i.done;i=n.next())(i=Sm(this,i.value))&&t.push(i);for(n=c(this.g),i=n.next();!i.done;i=n.next())om(this.i,i.value);for(n=c(this.i.i),i=n.next();!i.done;i=n.next())i=Tm(this,i.value),t.push.apply(t,d(i));return this.i.i=[],this.h=[],this.g=[],t},ym.prototype.getStreams=function(){return Array.from(this.A)},z("shaka.cea.CeaDecoder",ym),Me=function(){return new ym},Em.prototype.init=function(e){function t(e){e=e.name,e in Rm&&(n.g=Rm[e])}var n=this,i=[],r=[];if((new ca).box("moov",da).box("mvex",da).S("trex",function(e){var t=e.reader;t.skip(4),t.skip(4),e=t.P(),t=t.P(),n.h=e,n.i=t}).box("trak",da).S("tkhd",function(e){var t=e.reader;e=e.version,1==e?(t.skip(8),t.skip(8)):(t.skip(4),t.skip(4));var n=t.P();1==e?t.skip(8):t.skip(4),t.skip(4),t.skip(8),t.skip(2),t.skip(2),t.skip(2),t.skip(2),t.skip(36),t.ka(),t.ka(),t.ka(),t.ka(),i.push(n)}).box("mdia",da).S("mdhd",function(e){e=vo(e.reader,e.version),r.push(e.timescale)}).box("minf",da).box("stbl",da).S("stsd",ha).box("avc1",t).box("avc3",t).box("hev1",t).box("hvc1",t).box("dvav",t).box("dva1",t).box("dvh1",t).box("dvhe",t).box("vvc1",t).box("vvi1",t).box("encv",fa).box("sinf",da).box("frma",function(e){e=So(e.reader).Na,e in Rm&&(n.g=Rm[e])}).parse(e,!0),!i.length||!r.length||i.length!=r.length)throw new It(2,2,2010);this.g==Am&&Z("Unable to determine bitstream format for CEA parsing!"),i.forEach(function(e,t){n.j.set(e,r[t])})},Em.prototype.parse=function(e){var t=this;if(this.g==Am)return[];var n=[],i=0,r=[];return(new ca).box("moof",function(e){i=e.start,r=[],da(e)}).box("traf",function(e){r.push({baseMediaDecodeTime:null,qd:t.h,fe:t.i,ah:[],timescale:9e4}),da(e)}).S("trun",function(e){var t=r[r.length-1];e=yo(e.reader,e.version,e.flags),t.ah.push(e)}).S("tfhd",function(e){var n=r[r.length-1];e=go(e.reader,e.flags),n.qd=e.qd||t.h,n.fe=e.fe||t.i,e=e.trackId,t.j.has(e)&&(n.timescale=t.j.get(e))}).S("tfdt",function(e){var t=r[r.length-1];e=mo(e.reader,e.version),t.baseMediaDecodeTime=e.baseMediaDecodeTime}).box("mdat",function(e){for(var a=i-e.start-8,s=e.reader.ua(),o=c(r),l=o.next();!l.done;l=o.next()){if(l=l.value,null===l.baseMediaDecodeTime)throw Z("Unable to find base media decode time for CEA captions!"),new It(2,2,2010);e.reader.seek(s),xm(t,e.reader,l.baseMediaDecodeTime,l.timescale,l.qd,l.fe,a,l.ah,n)}}).parse(e,!1),n},z("shaka.cea.Mp4CeaParser",Em);var Am=0,km=1,Im=2,Cm=3,Rm={avc1:km,avc3:km,hev1:Im,hvc1:Im,dvav:km,dva1:km,dvh1:Im,dvhe:Im,vvc1:Cm,vvi1:Cm};function Mm(){this.g=null}function Dm(e,t,n){var i=Fm(e),r=null;e=[];var a=[],s=null,o=new Set(i.map(function(e){return e.keyId}));o.delete(null);var l="cenc";if(1<o.size)throw new It(2,4,4010);if(!t){if(a=i.filter(function(e){return"urn:mpeg:dash:sea:2012"==e.Sc}),1<a.length)throw new It(2,4,4050);a.length&&(s=Vm(a[0])),(a=i.find(function(e){return"urn:mpeg:dash:mp4protection:2011"==e.Sc}))&&a.encryptionScheme&&(l=a.encryptionScheme),a=i.filter(function(e){return"urn:mpeg:dash:mp4protection:2011"==e.Sc?(r=e.init||r,!1):"urn:mpeg:dash:sea:2012"!=e.Sc}),a.length&&(e=Um(r,l,a,n,o),0==e.length&&(e=[In("",l,r)]))}if(i.length&&!s&&(t||!a.length))for(e=[],t=c(Object.values(n)),n=t.next();!n.done;n=t.next())n=n.value,"org.w3.clearkey"!=n&&e.push(In(n,l,r));if(o=Array.from(o)[0]||null)for(l=c(e),t=l.next();!t.done;t=l.next())for(t=c(t.value.initData),n=t.next();!n.done;n=t.next())n.value.keyId=o;return{Dg:o,kk:r,drmInfos:e,bf:s,Hg:!0}}function Lm(e,t,n,i){var r=Dm(e,n,i);if(t.Hg)e=1==t.drmInfos.length&&!t.drmInfos[0].keySystem,n=0==r.drmInfos.length,(0==t.drmInfos.length||e&&!n)&&(t.drmInfos=r.drmInfos),t.Hg=!1;else if(0<r.drmInfos.length&&(t.drmInfos=t.drmInfos.filter(function(e){return r.drmInfos.some(function(t){return t.keySystem==e.keySystem})}),0==t.drmInfos.length))throw new It(2,4,4008);return r.Dg||t.Dg}function Pm(e){var t=0,n=Ae(e),i=n.getUint32(t,!0);if(i!=e.byteLength)return[];e:{for(e=t+6,t=[];e<n.byteLength-1;){i=n.getUint16(e,!0),e+=2;var r=n.getUint16(e,!0);if(e+=2,0!=(1&r)||r+e>n.byteLength){n=[];break e}var a=Ee(n,e,r);t.push({type:i,value:a}),e+=r}n=t}return n}function Om(e){e=c(Da(e,"DATA"));for(var t=e.next();!t.done;t=e.next())if(t=t.value,t.children){t=c(t.children);for(var n=t.next();!n.done;n=t.next())if(n=n.value,"LA_URL"==n.tagName)return Ra(n)}return""}function Nm(e){var t=Pa(e.node,"https://dashif.org/CPS","Laurl");return t&&(t=Ra(t))?t:(e=Pa(e.node,"urn:microsoft:playready","pro"),e&&Ra(e)?(e=Ra(e),e=wn(e),e=Pm(e).filter(function(e){return e.type===jm})[0],e?(e=fn(e.value,!0),(e=Ea(e,"WRMHEADER"))?Om(e):""):""):"")}function Um(e,t,n,i,r){var a=[];n=c(n);for(var s=n.next();!s.done;s=n.next()){s=s.value;var o=i[s.Sc];if(o){var l;if((l=Pa(s.node,"urn:microsoft:playready","pro"))&&Ra(l)){l=Ra(l),l=wn(l);var u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);l=[{initData:_a(l,u,new Set,0),initDataType:"cenc",keyId:s.keyId}]}else l=null;if(u=null,"urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e"===s.Sc)if(u=r,0==u.size)u=null;else{var d=new Uint8Array([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75]),h=new Uint8Array([]);u=[{initData:_a(h,d,u,1),initDataType:"cenc",keyId:s.keyId}]}l=In(o,t,s.init||e||l||u),(o=Gm.get(o))&&(l.licenseServerUri=o(s)),a.push(l)}}return a}function Fm(e){var t=[];e=c(e);for(var n=e.next();!n.done;n=e.next())(n=Bm(n.value))&&t.push(n);return t}function Bm(e){var t=e.attributes.schemeIdUri,n=Na(e,"urn:mpeg:cenc:2013","default_KID"),i=Ua(e,"urn:mpeg:cenc:2013","pssh").map(Ma),r=e.attributes.value;if(!t)return null;if(t=t.toLowerCase(),n&&(n=n.replace(/-/g,"").toLowerCase(),n.includes(" ")))throw new It(2,4,4009);var a=[];try{a=i.map(function(e){return{initDataType:"cenc",initData:wn(e),keyId:null}})}catch(e){throw new It(2,4,4007)}return{node:e,Sc:t,keyId:n,init:0<a.length?a:null,encryptionScheme:r}}function Vm(t){if(!e.crypto||!e.crypto.subtle)throw Z("Web Crypto API is not available to decrypt AES-128. (Web Crypto only exists in secure origins like https)"),new It(2,4,4042);var n=Pa(t.node,"urn:mpeg:dash:schema:sea:2012","SegmentEncryption");if(!n)throw new It(2,4,4051);if("urn:mpeg:dash:sea:aes128-cbc:2013"!=n.attributes.schemeIdUri)throw new It(2,4,4051);if(n=Pa(t.node,"urn:mpeg:dash:schema:sea:2012","CryptoPeriod"),!n)throw new It(2,4,4051);if(t=n.attributes.IV,n=yn(n.attributes.keyUriTemplate),!t||!n)throw new It(2,4,4051);if(t=En(t.substr(2)),16!=t.byteLength)throw new It(2,4,4048);return{Ai:n,iv:t}}Re["video/mp4"]=function(){return new Em},Mm.prototype.init=function(){},Mm.prototype.parse=function(e){this.g?this.g.clearData():this.g=new No;var t=[];if(e=Ee(e),!jo(e))return t;e=this.g.parse(e);var n=e.sd(),i=e.ke();switch(e=[],n.video){case"avc":e.push(6);break;case"hvc":e.push(39),e.push(40)}if(!e.length)return t;for(n=c(i),i=n.next();!i.done;i=n.next())if(i=i.value,e.includes(i.type)&&null!=i.time)for(var r=c(wm(i.data)),a=r.next();!a.done;a=r.next())t.push({packet:a.value,pts:i.time});return t},z("shaka.cea.TsCeaParser",Mm),Re["video/mp2t"]=function(){return new Mm};var jm=1,Gm=(new Map).set("com.widevine.alpha",function(e){var t=Pa(e.node,"https://dashif.org/CPS","Laurl");return t&&(t=Ra(t))?t:(e=Pa(e.node,"urn:microsoft","laurl"))&&yn(e.attributes.licenseUrl)||""}).set("com.microsoft.playready",Nm).set("com.microsoft.playready.recommendation",Nm).set("com.microsoft.playready.software",Nm).set("com.microsoft.playready.hardware",Nm).set("org.w3.clearkey",function(e){var t=Pa(e.node,"https://dashif.org/CPS","Laurl");return t&&(t=Ra(t))?t:(e=Pa(e.node,"http://dashif.org/guidelines/clearKey","Laurl"))&&"EME-1.0"===e.attributes.Lic_type&&e&&(e=Ra(e))?e:""});function Hm(t,n,i,r,a,s){var o={RepresentationID:n,Number:i,SubNumber:r,Bandwidth:a,Time:s};return t.replace(/\$(RepresentationID|Number|SubNumber|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(t,n,i,r){if("$$"==t)return"$";var a=o[n];if(null==a)return t;switch("RepresentationID"==n&&i&&(i=void 0),"Time"==n&&"bigint"!=typeof a&&(.2<=Math.abs(a-Math.round(a))&&Z("Calculated $Time$ values must be close to integers"),a=Math.round(a)),r){case void 0:case"d":case"i":case"u":t=a.toString();break;case"o":t=a.toString(8);break;case"x":t=a.toString(16);break;case"X":t=a.toString(16).toUpperCase();break;default:t=a.toString()}return i=e.parseInt(i,10)||1,Array(Math.max(0,i-t.length)+1).join("0")+t})}function zm(e,t){var n=$m(e,t,"timescale"),i=1;n&&(i=Ha(n)||1),n=$m(e,t,"duration"),(n=Ha(n||""))&&(n/=i);var r=$m(e,t,"startNumber"),a=Number($m(e,t,"presentationTimeOffset"))||0,s=za(r||"");if(null!=r&&null!=s||(s=1),r=null,t=Wm(e,t,"SegmentTimeline")){t=Ca(t,"S"),r=i,e=e.ja.duration||1/0;for(var o=s,l=[],u=-a,c=0;c<t.length;++c){var d=t[c],h=t[c+1],f=Oa(d,"t",za),p=Oa(d,"d",za),g=Oa(d,"r",Ga);if(d=Oa(d,"k",Ga)||0,null!=f&&(f-=a),p){if(f=null!=f?f:u,g=g||0,0>g)if(h){if(h=Oa(h,"t",za),null==h)break;if(f>=h)break;g=Math.ceil((h-f)/p)-1}else{if(1/0==e)break;if(f/r>=e)break;g=Math.ceil((e*r-f)/p)-1}for(0<l.length&&f!=u&&(l[l.length-1].end=f/r),h=0;h<=g;++h)u=f+p,l.push({start:f/r,end:u/r,og:f,Bb:d,Zi:l.length+o}),f=u}}r=l}return{timescale:i,La:n,Od:s,Pb:a/i||0,ng:a,timeline:r}}function Km(e,t){return[t(e.J),t(e.la),t(e.va)].filter(oi)}function $m(e,t,n){t=Km(e,t),e=null,t=c(t);for(var i=t.next();!i.done&&!(e=i.value.attributes[n]);i=t.next());return e}function Wm(e,t,n){t=Km(e,t),e=null,t=c(t);for(var i=t.next();!i.done&&!(e=La(i.value,n));i=t.next());return e}function qm(e,t,n,i,r,a){for(var s=Na(e,"http://www.w3.org/1999/xlink","href"),o=Na(e,"http://www.w3.org/1999/xlink","actuate")||"onRequest",l=c(Object.keys(e.attributes)),u=l.next();!u.done;u=l.next()){u=u.value;var d=u.split(":"),h=xa("http://www.w3.org/1999/xlink");d[0]==h&&delete e.attributes[u]}if(5<=a)return Rr(new It(2,4,4028));if("onLoad"!=o)return Rr(new It(2,4,4027));var f=kn([i],[s]);return r.request(0,Kr(f,t)).Aa(function(i){if(i=wa(i.data,e.tagName),!i)return Rr(new It(2,4,4001,s));for(e.children=[];i.children.length;){var o=i.children.shift();o.tagName&&(o.parent=e),e.children.push(o)}o=c(Object.keys(i.attributes));for(var l=o.next();!l.done;l=o.next())l=l.value,e.attributes[l]=i.attributes[l];return Ym(e,t,n,f[0],r,a+1)})}function Ym(e,t,n,i,r,a){if(a=void 0===a?0:a,Na(e,"http://www.w3.org/1999/xlink","href")){var s=qm(e,t,n,i,r,a);return n&&(s=s.Aa(void 0,function(){return Ym(e,t,n,i,r,a)})),s}s=[];for(var o={},l=c(Ia(e)),u=l.next();!u.done;o={Bc:o.Bc},u=l.next())o.Bc=u.value,"urn:mpeg:dash:resolve-to-zero:2013"==Na(o.Bc,"http://www.w3.org/1999/xlink","href")?e.children=e.children.filter(function(e){return function(t){return t!==e.Bc}}(o)):"SegmentTimeline"!=o.Bc.tagName&&s.push(Ym(o.Bc,t,n,i,r,a));return Pr(s).Aa(function(){return e})}function Xm(e,t,n,i,r,a,s){var o,l=(new ca).S("sidx",function(e){o=Qm(t,i,r,a,s,n,e)});if(e&&l.parse(e),o)return o;throw new It(2,3,3004)}function Qm(e,t,n,i,r,a,s){var o=[];s.reader.skip(4);var l=s.reader.P();if(0==l)throw new It(2,3,3005);if(0==s.version)var u=s.reader.P(),c=s.reader.P();else u=s.reader.Qc(),c=s.reader.Qc();s.reader.skip(2);var d=s.reader.ka();for(e=e+s.size+c,c=0;c<d;c++){var h=s.reader.P(),f=(2147483648&h)>>>31;h&=2147483647;var p=s.reader.P();if(s.reader.skip(4),1==f)throw new It(2,3,3006);o.push(new Qs(u/l+n,(u+p)/l+n,function(){return a},e,e+h-1,t,n,i,r)),u+=p,e+=h}return s.parser.stop(),o}function Zm(e){this.h=Ae(e),this.g=new oa(this.h,0)}function Jm(e){var t=ev(e);if(7<t.length)throw new It(2,3,3002);var n=0;t=c(t);for(var i=t.next();!i.done;i=t.next())n=256*n+i.value;t=ev(e);e:{i=c(tv);for(var r=i.next();!r.done;r=i.next())if(Te(t,new Uint8Array(r.value))){i=!0;break e}i=!1}if(i)t=e.h.byteLength-e.g.ua();else{if(8==t.length&&224&t[1])throw new It(2,3,3001);for(r=i=0;r<t.length;r++){var a=t[r];i=0==r?a&(1<<8-t.length)-1:256*i+a}t=i}return t=e.g.ua()+t<=e.h.byteLength?t:e.h.byteLength-e.g.ua(),i=Ae(e.h,e.g.ua(),t),e.g.skip(t),new nv(n,i)}function ev(e){var t=e.g.ua(),n=e.g.T();if(0==n)throw new It(2,3,3002);return n=8-Math.floor(Math.log2(n)),e.g.skip(n-1),Ee(e.h,t,n)}Zm.prototype.oa=function(){return this.g.oa()};var tv=[[255],[127,255],[63,255,255],[31,255,255,255],[15,255,255,255,255],[7,255,255,255,255,255],[3,255,255,255,255,255,255],[1,255,255,255,255,255,255,255]];function nv(e,t){this.id=e,this.g=t}function iv(e){if(8<e.g.byteLength)throw new It(2,3,3002);if(8==e.g.byteLength&&224&e.g.getUint8(0))throw new It(2,3,3001);for(var t=0,n=0;n<e.g.byteLength;n++){var i=e.g.getUint8(n);t=256*t+i}return t}function rv(e,t,n,i,r,a,s,o,l){function u(){return r}var c=[];e=new Zm(e.g);for(var d=null,h=null;e.oa();){var f=Jm(e);if(187==f.id){var p=av(f);p&&(f=n*p.kj,p=t+p.Pi,null!=d&&c.push(new Qs(d+s,f+s,u,h,p-1,a,s,o,l)),d=f,h=p)}}return null!=d&&c.push(new Qs(d+s,i+s,u,h,null,a,s,o,l)),c}function av(e){var t=new Zm(e.g);if(e=Jm(t),179!=e.id)throw new It(2,3,3013);if(e=iv(e),t=Jm(t),183!=t.id)throw new It(2,3,3012);t=new Zm(t.g);for(var n=0;t.oa();){var i=Jm(t);if(241==i.id){n=iv(i);break}}return{kj:e,Pi:n}}function sv(e,t,n){if(t=Wm(e,t,"Initialization"),!t)return null;var i=e.J.Ga(),r=t.attributes.sourceURL;r&&(i=kn(i,[yn(r)])),r=0;var a=null;return(t=Oa(t,"range",ja))&&(r=t.start,a=t.end),n=new Ys(function(){return i},r,a,fv(e),null,null,n),n.codecs=e.J.codecs,n.mimeType=e.J.mimeType,n}function ov(e,t,n){var i=Number($m(e,uv,"presentationTimeOffset"))||0,r=$m(e,uv,"timescale"),a=1;r&&(a=Ha(r)||1);var s=i/a||0,o=sv(e,uv,n);dv(e,o);var l=bi(e);return{mc:function(){var e=Wm(l,uv,"RepresentationIndex"),n=l.J.Ga();return e&&(e=yn(e.attributes.sourceURL))&&(n=kn(n,[e])),e=cv(l),lv(l,t,o,n,e.start,e.end,s)}}}function lv(e,t,n,i,r,a,s){var o,l,u,d,h,f,p,g,m,v,y,b,S,T,w,E,x,A;return N(function(k){if(1==k.g)return o=e.presentationTimeline,l=!e.xb||!e.ja.Dd,u=e.ja.start,d=e.ja.duration,h=e.J.mimeType.split("/")[1],f=t,p=null,g=[f(i,r,a,!1),"webm"==h?f(n.M(),n.Ha,n.sa,!0):null],f=null,_(k,Promise.all(g),2);if(m=k.h,v=m[0],y=m[1]||null,b=null,S=u-s,T=u,w=d?u+d:1/0,"mp4"==h)var I=Xm(v,r,i,n,S,T,w);else{if(I=new Zm(y),440786851!=Jm(I).id)throw new It(2,3,3008);var C=Jm(I);if(408125543!=C.id)throw new It(2,3,3009);I=C.g.byteOffset,C=new Zm(C.g);for(var R=null;C.oa();){var M=Jm(C);if(357149030==M.id){R=M;break}}if(!R)throw new It(2,3,3010);for(R=new Zm(R.g),M=1e6,C=null;R.oa();){var D=Jm(R);if(2807729==D.id)M=iv(D);else if(17545==D.id)if(4==D.g.byteLength)C=D.g.getFloat32(0);else{if(8!=D.g.byteLength)throw new It(2,3,3003);C=D.g.getFloat64(0)}}if(null==C)throw new It(2,3,3011);if(R=M/1e9,C*=R,M=Jm(new Zm(v)),475249515!=M.id)throw new It(2,3,3007);I=rv(M,I,R,C,i,n,S,T,w)}for(b=I,E=c(b),x=E.next();!x.done;x=E.next())A=x.value,A.codecs=e.J.codecs,A.mimeType=e.J.mimeType;return o.Jd(b),p=new tu(b),l&&p.Ec(T,w,!0),k.return(p)})}function uv(e){return e.Tc}function cv(e){var t=Wm(e,uv,"RepresentationIndex");return e=$m(e,uv,"indexRange"),e=ja(e||""),t&&(e=Oa(t,"range",ja,e)),e}function dv(e,t){if(hv(e,t),!cv(e))throw new It(2,4,4002)}function hv(e,t){var n=e.J.mimeType.split("/")[1];if(e.J.contentType!=Ln&&"mp4"!=n&&"webm"!=n)throw new It(2,4,4006);if("webm"==n&&!t)throw new It(2,4,4005)}function fv(e){var t=e.J;return{bandwidth:e.bandwidth,audioSamplingRate:t.audioSamplingRate,codecs:t.codecs,contentType:t.contentType,frameRate:t.frameRate||null,height:t.height||null,mimeType:t.mimeType,channelsCount:t.Nc,pixelAspectRatio:t.pixelAspectRatio||null,width:t.width||null,label:e.la.label||null,roles:e.roles||null,language:e.la.language||null}}function pv(e,t,n){var i=sv(e,gv,n),r=mv(e);if(!r.La&&!r.timeline&&1<r.Mc.length)throw new It(2,4,4002);if(!r.La&&!e.ja.duration&&!r.timeline&&1==r.Mc.length)throw new It(2,4,4002);if(r.timeline&&0==r.timeline.length)throw new It(2,4,4002);var a=null,s=null;e.va.id&&e.J.id&&(s=t[e.va.id+","+e.J.id])&&(a=s.segmentIndex);var o=vv(e.ja.start,e.ja.duration,e.J.Ga,r,i,n,e.J.mimeType,e.J.codecs);return t=!a,a?a.Id(o,e.presentationTimeline.nb()):a=new tu(o),e.presentationTimeline.Jd(o),e.xb&&e.ja.Dd||a.Ec(e.ja.start,e.ja.duration?e.ja.start+e.ja.duration:1/0,t),s&&(s.segmentIndex=a),{mc:function(){return a&&0!=a.getNumReferences()||a.ue(o),Promise.resolve(a)}}}function gv(e){return e.Rb}function mv(e){var t=yv(e);e=zm(e,gv);var n=e.Od;0==n&&(n=1);var i=0;return e.La?i=e.La*(n-1):e.timeline&&0<e.timeline.length&&(i=e.timeline[0].start),{La:e.La,startTime:i,Od:n,Pb:e.Pb,timeline:e.timeline,Mc:t}}function vv(e,t,n,i,r,a,s,o){var l=i.Mc.length;i.timeline&&i.timeline.length!=i.Mc.length&&(l=Math.min(i.timeline.length,i.Mc.length));for(var u=e-i.Pb,c=t?e+t:1/0,d=[],h=i.startTime,f={},p=0;p<l;f={jd:f.jd,ed:f.ed},p++){f.ed=i.Mc[p];var g=h;h=void 0,h=null!=i.La?g+i.La:i.timeline?i.timeline[p].end:g+t,f.jd=null,g=new Qs(e+g,e+h,function(e){return function(){return null==e.jd&&(e.jd=kn(n(),[e.ed.Gi])),e.jd}}(f),f.ed.start,f.ed.end,r,u,e,c,[],"",null,null,Js,a),g.codecs=o,g.mimeType=s,d.push(g)}return d}function yv(e){return[e.J.Rb,e.la.Rb,e.va.Rb].filter(oi).map(function(e){return Ca(e,"SegmentURL")}).reduce(function(e,t){return 0<e.length?e:t}).map(function(t){t.attributes.indexRange&&!e.If&&(e.If=!0);var n=yn(t.attributes.media);return t=Oa(t,"mediaRange",ja,{start:0,end:null}),{Gi:n,start:t.start,end:t.end}})}function bv(e,t,n,i,r,a,s,o,l){l||e.J.Jc||(e.J.Jc=$m(e,Sv,"initialization"));var u=e.J.Jc?Ev(e,s):null,c=Tv(e);_v(c);var d=bi(e);if(c.Bd)return hv(e,u),{mc:function(){var e=Hm(c.Bd,d.J.id,null,null,d.bandwidth||null,null);return e=kn(d.J.Ga(),[e]),lv(d,t,u,e,0,null,c.Pb)}};if(c.La)return i||"image"===e.la.contentType||(e.presentationTimeline.Pf(c.La),e.presentationTimeline.ye(e.ja.start)),{mc:function(){return wv(d,c,r,u,a,s,o)}};var h=null;i=i=null,e.va.id&&e.J.id&&(i=e.va.id+","+e.J.id,i=n[i])&&(h=i.segmentIndex);var f=e.ja.start,p=e.ja.duration?f+e.ja.duration:1/0,g=!(e.xb&&e.ja.Dd);return h?(n=h,Av(n,c,f,p,g,u),n.Oa(e.presentationTimeline.nb())):h=new xv(c,e.J.id,e.bandwidth,e.J.Ga,f,p,u,g,s,e.J.ag),c.timeline&&"image"!==e.la.contentType&&e.presentationTimeline.$g(c.timeline,f),i&&e.xb&&(i.segmentIndex=h),{mc:function(){return h instanceof xv&&0==h.getNumReferences()&&Av(h,c,f,p,g,u),Promise.resolve(h)}}}function Sv(e){return e.cc}function Tv(e){var t=zm(e,Sv),n=$m(e,Sv,"media"),i=$m(e,Sv,"index");return{La:t.La,timescale:t.timescale,Od:t.Od,Pb:t.Pb,ng:t.ng,timeline:t.timeline,bc:n&&yn(n),Bd:i,mimeType:e.J.mimeType,codecs:e.J.codecs}}function _v(e){var t=e.Bd?1:0;if(t+=e.timeline?1:0,t+=e.La?1:0,0==t)throw new It(2,4,4002);if(1!=t&&(e.Bd&&(e.timeline=null),e.La=null),!e.Bd&&!e.bc)throw new It(2,4,4002)}function wv(t,n,i,r,a,s,o){function l(i){var a=(i-v)*m,o=a+n.Pb,l=a+f;a=l+m;var u=Math.min(a,d());return l=new Qs(l,u,function(){var t=o*y;return"BigInt"in e&&t>Number.MAX_SAFE_INTEGER&&(t=BigInt(o)*BigInt(y)),t=Hm(b,T,i,null,S,t),kn(_(),[t])},0,null,r,w,f,d(),[],"",null,null,Js,s),l.codecs=t.J.codecs,l.mimeType=t.J.mimeType,l.j=a,l}function u(){var e=[Math.max(h.nb(),f),Math.min(h.Zb(),d())].map(function(e){return e-f});return e=[Math.ceil(e[0]/m),Math.ceil(e[1]/m)-1],t.J.Ia&&e[1]++,e.map(function(e){return e+v})}function d(){var e=null!=p&&a[p]||g;return e?f+e:1/0}var h=t.presentationTimeline,f=t.ja.start,p=t.va.id,g=t.ja.duration,m=n.La,v=n.Od,y=n.timescale,b=n.bc,S=t.bandwidth||null,T=t.J.id,_=t.J.Ga,w=f-n.Pb,E=u();i=t.xb?Math.max(E[0],E[1]-i+1):E[0],o=o||E[1],E=[];for(var x=i;x<=o;++x){var A=l(x);E.push(A)}var k=new tu(E);if(E=h.Zb()<d(),x=h.V(),E||x){var I=Math.max(i,o+1);i=m,t.J.Ia&&(i=.1),k.Me(i,function(){var e=h.nb();k.Oa(e);var t=c(u());t.next(),t=t.next().value;for(var n=[];I<=t;){var i=l(I);n.push(i),I++}return e>d()&&!n.length?null:n})}return Promise.resolve(k)}function Ev(e,t){var n=e.J.Jc;if(n||(n=$m(e,Sv,"initialization")),!n)return null;n=yn(n);var i=e.J.id,r=e.bandwidth||null,a=e.J.Ga;return t=new Ys(function(){var e=Hm(n,i,null,null,r,null);return kn(a(),[e])},0,null,fv(e),null,null,t),t.codecs=e.J.codecs,t.mimeType=e.J.mimeType,t}function xv(e,t,n,i,r,a,s,o,l,u){tu.call(this,[]),this.g=e,this.C=t,this.A=n,this.B=i,this.h=r,this.j=a,this.o=s,this.s=l,this.F=u,o&&Iv(this)}function Av(e,t,n,i,r,a){if(kv(e,a),e.g){if(n=e.g.timeline,e.g.bc!==t.bc&&(e.g.bc=t.bc),n.length){var s=n[n.length-1];t=t.timeline.filter(function(e){return e.start>=s.end})}else t=t.timeline.slice();0<t.length&&e.g.timeline.push.apply(e.g.timeline,d(t)),e.j!==i&&(e.j=i)}else e.g=t,e.h=n,e.j=i;r&&Iv(e)}function kv(e,t){if(e.o!==t){e.o=t,e=c(e.O);for(var n=e.next();!n.done;n=e.next())(n=n.value)&&Zs(n,t)}}function Iv(e){if(!e.m){for(var t=e.g.timeline;t.length;){if(!(t[t.length-1].start>=e.j))break;t.pop()}e.Oa(e.h)}}function Cv(e,t,n,i,r,a,s){return e=Hm(e,t,n,a,i||null,r),kn(s(),[e]).map(function(e){return e.toString()})}function Rv(e){this.o=null,this.A=e,this.G=new Vr,this.i=[],this.h=null,this.m=[],this.B=null,this.F=[],this.C=300,this.l=new Map,this.j=new Map,this.g=null,this.s="UNKNOWN"}function Mv(e,t){var n,i,r,a,s,o,l;return N(function(u){return 1==u.g?(n=kn(e.i,[Dv(e,t)]),i=Kr(n,e.o.retryParameters),r=e.A.networkingEngine.request(8,i),jr(e.G,r),E(u,2),_(u,r.promise,4)):2!=u.g?(a=u.h,s=hn(a.data),o=JSON.parse(s),1==o.VERSION&&Lv(e,o,a.uri),A(u,0)):(l=k(u))&&7001==l.code?u.return():(null!=e.g&&(e.g.stop(),e.g=null),e.g=new Ut(function(){Mv(e,t)}),e.g.Y(e.C),void w(u))})}function Dv(e,t){if(!e.m.length)return t;t=new ht(t);var n=e.B||e.m[0],i=Math.round(e.A.getBandwidthEstimate()),r=t.g;return"DASH"==e.s?(r.add("_DASH_pathway",n),r.add("_DASH_throughput",String(i))):"HLS"==e.s&&(r.add("_HLS_pathway",n),r.add("_HLS_throughput",String(i))),kt(r)&&mt(t,r),t.toString()}function Lv(e,t,n){null!=e.g&&(e.g.stop(),e.g=null);var i=t["RELOAD-URI"]||n;e.g=new Ut(function(){Mv(e,i)}),(n=t.TTL)&&(e.C=n),e.g.Y(e.C),e.m=t["PATHWAY-PRIORITY"]||[],e.F=t["PATHWAY-CLONES"]||[]}function Pv(e,t,n,i){var r=e.l.get(t);r||(r=new Map),r.set(n,i),e.l.set(t,r)}function Ov(e,t,n){n=void 0!==n&&n,t=e.l.get(t)||new Map;for(var i=[],r={},a=c(e.m),s=a.next();!s.done;r={jc:r.jc},s=a.next())if(r.jc=s.value,s=t.get(r.jc))i.push({Vf:r.jc,location:s});else if(s=e.F.find(function(e){return function(t){return t.Dj==e.jc}}(r))){var o=t.get(s["BASE-ID"]);o&&(s["URI-REPLACEMENT"].xh?(o=new ht(o),pt(o,s["URI-REPLACEMENT"].xh),i.push({Vf:r.jc,location:o.toString()})):i.push({Vf:r.jc,location:o}))}for(r=Date.now(),a=c(e.j.keys()),s=a.next();!s.done;s=a.next())s=s.value,o=e.j.get(s),r>o&&e.j.delete(s);if(i=i.filter(function(t){for(var n=c(e.j.keys()),i=n.next();!i.done;i=n.next())if(i.value.includes(new ht(t.location).Gb))return!1;return!0}),i.length&&(e.B=i[0].Vf),i=i.map(function(e){return e.location}),!i.length&&e.h)for(r=c(e.h.split(",")),s=r.next();!s.done;s=r.next())(a=t.get(s.value))&&(e.B=e.h,i.push(a));if(!i.length)for(t=c(t.values()),r=t.next();!r.done;r=t.next())i.push(r.value);return n?i:kn(e.i,i)}function Nv(){this.j=[],this.h=[],this.g=[],this.l=[],this.i=[],this.s=this.o=!1,this.m=new Set}function Uv(e,t){var n=[],i=[],r=[],a=[];e=c(e);for(var s=e.next();!s.done;s=e.next()){var o=s.value;s=new Map(o.audioStreams.map(function(e){return[cy(e),e]}));var l=new Map(o.videoStreams.map(function(e){return[uy(e),e]})),u=new Map(o.textStreams.map(function(e){return[dy(e),e]}));if(o=new Map(o.imageStreams.map(function(e){return[hy(e),e]})),t){var d=ay(Ln);u.set(dy(d),d),d=ay("image"),o.set(hy(d),d)}n.push(s),i.push(l),r.push(u),a.push(o)}return{xg:n,vh:i,sh:r,Sg:a}}function Fv(e){var t,n,i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,w,E,x,A,k,I,C,R,M,D;return N(function(L){switch(L.g){case 1:if(t=Pn,1==e.length)return L.return(e[0]);for(n=e.map(function(e){return new Map(e.filter(function(e){return e.type===t.X}).map(function(e){return[cy(e),e]}))}),i=e.map(function(e){return new Map(e.filter(function(e){return e.type===t.ga}).map(function(e){return[uy(e),e]}))}),r=e.map(function(e){return new Map(e.filter(function(e){return e.type===t.ta}).map(function(e){return[dy(e),e]}))}),a=e.map(function(e){return new Map(e.filter(function(e){return e.type===t.Ze}).map(function(e){return[hy(e),e]}))}),s=c(r),o=s.next();!o.done;o=s.next())l=o.value,u=ry(t.ta),l.set(dy(u),u);for(d=c(a),h=d.next();!h.done;h=d.next())f=h.value,p=ry(t.Ze),f.set(hy(p),p);return g=new Nv,_(L,Bv(g,[],n,0,Kv,Wv,0),2);case 2:return m=L.h,_(L,Bv(g,[],i,0,Kv,Wv,0),3);case 3:return v=L.h,_(L,Bv(g,[],r,0,Kv,Wv,0),4);case 4:return y=L.h,_(L,Bv(g,[],a,0,Kv,Wv,0),5);case 5:if(b=L.h,S=0,v.length&&m.length)for(A=c(m),k=A.next();!k.done;k=A.next())for(I=k.value,C=c(v),R=C.next();!R.done;R=C.next())M=R.value,D=S++,M.variantIds.push(D),I.variantIds.push(D);else for(T=v.concat(m),w=c(T),E=w.next();!E.done;E=w.next())x=E.value,x.variantIds=[S++];return L.return(v.concat(m).concat(y).concat(b))}})}function Bv(e,t,n,i,r,a,s){var o,l,u,d,h,f,p,g,m,v,y,b,S,T,w,E,x;return N(function(A){switch(A.g){case 1:for(o=[],l=0;l<n.length;l++)l>=i?o.push(new Set(n[l].values())):o.push(new Set);u=c(t),d=u.next();case 2:if(d.done){A.u(4);break}return h=d.value,_(A,Vv(e,h,n,i,a,o,s),5);case 5:if(f=A.h,!f)throw new It(2,4,4037);d=u.next(),A.u(2);break;case 4:for(p=c(o),g=p.next();!g.done;g=p.next())for(m=g.value,v=c(m),y=v.next();!y.done;y=v.next())b=y.value,(S=Gv(e,b,n,r,a,o))&&t.push(S);for(T=c(o),g=T.next();!g.done;g=T.next())for(w=g.value,E={},x=c(w),y=x.next();!y.done;E={Yd:E.Yd},y=x.next())if(E.Yd=y.value,!ly(E.Yd)&&t.some(function(t){return function(n){return Qv(e,t.Yd,n)}}(E)))throw new It(2,4,4037);return A.return(t)}})}function Vv(e,t,n,i,r,a,s){return N(function(o){return 1==o.g?(qv(e,n,t,0<s),t.matchedStreams?t.segmentIndex?_(o,jv(t,i+s),2):o.u(2):o.return(!1)):(Hv(t,i,r,a,s),o.return(!0))})}function jv(e,t){var n,i,r,a,s,o,l;return N(function(u){if(1==u.g){for(n=[],i=e.matchedStreams,r=c(i),a=r.next();!a.done;a=r.next())s=a.value,n.push(s.createSegmentIndex()),s.trickModeVideo&&!s.trickModeVideo.segmentIndex&&n.push(s.trickModeVideo.createSegmentIndex());return _(u,Promise.all(n),2)}if(e.segmentIndex instanceof ru)for(o=t;o<i.length;o++)l=i[o],l.segmentIndex&&e.segmentIndex.g.push(l.segmentIndex);w(u)})}function Gv(e,t,n,i,r,a){if(ly(t))return null;var s=i(t);return qv(e,n,s),s.createSegmentIndex&&(s.createSegmentIndex=function(){return N(function(e){return s.segmentIndex?e.u(0):(s.segmentIndex=new ru,_(e,jv(s,0),0))})}),s.matchedStreams&&s.matchedStreams.length?(Hv(s,0,r,a,0),s):null}function Hv(e,t,n,i,r){var a=e.matchedStreams;for(t+=r;t<a.length;t++){var s=a[t];n(e,s);var o=!0;if("audio"==e.type&&0==fi(e.language,s.language)&&(o=!1),o&&(i[t-r].delete(s),s.fullMimeTypes))for(s=c(s.fullMimeTypes.values()),o=s.next();!o.done;o=s.next())e.fullMimeTypes.add(o.value)}}function zv(e){var t=Object.assign({},e);return t.originalId=null,t.createSegmentIndex=function(){return Promise.resolve()},t.closeSegmentIndex=function(){if(t.segmentIndex&&(t.segmentIndex.release(),t.segmentIndex=null),t.matchedStreams)for(var e=c(t.matchedStreams),n=e.next();!n.done;n=e.next())n=n.value,n.segmentIndex&&(n.segmentIndex.release(),n.segmentIndex=null)},t.roles=t.roles.slice(),t.segmentIndex=null,t.emsgSchemeIdUris=[],t.keyIds=new Set,t.closedCaptions=null,t.trickModeVideo=null,t}function Kv(e){return e=Object.assign({},e),e.roles=e.roles.slice(),e.keyIds=new Set,e.segments=[],e.variantIds=[],e.closedCaptions=null,e}function $v(e,t){function n(e,t){e||(e=[]),t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value,e.includes(n)||e.push(n);return e}e.roles=n(e.roles,t.roles),t.emsgSchemeIdUris&&(e.emsgSchemeIdUris=n(e.emsgSchemeIdUris,t.emsgSchemeIdUris));for(var i=c(t.keyIds),r=i.next();!r.done;r=i.next())e.keyIds.add(r.value);if(null==e.originalId?e.originalId=t.originalId:e.originalId+=","+(t.originalId||""),i=Dt(e.drmInfos,t.drmInfos),t.drmInfos.length&&e.drmInfos.length&&!i.length)throw new It(2,4,4038);if(e.drmInfos=i,e.encrypted=e.encrypted||t.encrypted,t.closedCaptions)for(e.closedCaptions||(e.closedCaptions=new Map),i=c(t.closedCaptions),r=i.next();!r.done;r=i.next()){var a=c(r.value);r=a.next().value,a=a.next().value,e.closedCaptions.set(r,a)}e.bandwidth&&t.bandwidth&&(e.bandwidth=Math.max(e.bandwidth,t.bandwidth)),t.trickModeVideo?(e.trickModeVideo||(e.trickModeVideo=zv(t.trickModeVideo),e.trickModeVideo.createSegmentIndex=function(){return e.trickModeVideo.segmentIndex=e.segmentIndex.clone(),Promise.resolve()}),$v(e.trickModeVideo,t.trickModeVideo)):e.trickModeVideo&&$v(e.trickModeVideo,t)}function Wv(e,t){var n=e.roles;n||(n=[]);for(var i=c(t.roles),r=i.next();!r.done;r=i.next())r=r.value,n.includes(r)||n.push(r);for(e.roles=n,n=c(t.keyIds),i=n.next();!i.done;i=n.next())e.keyIds.add(i.value);if(e.encrypted=e.encrypted&&t.encrypted,e.segments.push.apply(e.segments,d(t.segments)),t.closedCaptions)for(e.closedCaptions||(e.closedCaptions=new Map),t=c(t.closedCaptions),n=t.next();!n.done;n=t.next())i=c(n.value),n=i.next().value,i=i.next().value,e.closedCaptions.set(n,i)}function qv(e,t,n,i){i=void 0!==i&&i?n.matchedStreams:[],t=c(t);for(var r=t.next();!r.done;r=t.next()){if(r=Yv(e,r.value,n),!r)return;i.push(r)}n.matchedStreams=i}function Yv(e,t,n){var i={audio:cy,video:uy,text:dy,image:hy}[n.type],r=null,a=i(n);if(t.has(a))r=t.get(a);else{a={audio:function(t,n){return Qv(e,t,n)},video:function(t,n){return Qv(e,t,n)},text:Zv,image:Jv}[n.type];for(var s={audio:ey,video:ty,text:ny,image:iy}[n.type],o=c(t.values()),l=o.next();!l.done;l=o.next())l=l.value,!a(n,l)||n.fastSwitching!=l.fastSwitching||r&&!s(n,r,l)||(r=l)}return e.s&&!ly(r)&&t.delete(i(r)),r}function Xv(e,t){return e.mimeType==t.mimeType&&fy(e.codecs)===fy(t.codecs)}function Qv(e,t,n){return!(!Xv(t,n)&&!e.o||t.drmInfos&&!Mt(t.drmInfos,n.drmInfos))}function Zv(e,t){return!t.language||e.forced===t.forced&&0!=fi(e.language,t.language)&&t.kind==e.kind}function Jv(){return!0}function ey(e,t,n){var i=Xv(e,t),r=Xv(e,n);if(i&&!r)return!1;if(!i&&r)return!0;if(i=fi(e.language,t.language),r=fi(e.language,n.language),r>i)return!0;if(r<i)return!1;if(t.label!==n.label){if(e.label===t.label)return!1;if(e.label===n.label)return!0}if(e.roles.length){if(i=t.roles.filter(function(t){return e.roles.includes(t)}),r=n.roles.filter(function(t){return e.roles.includes(t)}),r.length>i.length)return!0;if(r.length<i.length)return!1;if(n.roles.length!==t.roles.length)return n.roles.length<t.roles.length}else{if(!n.roles.length&&t.roles.length)return!0;if(n.roles.length&&!t.roles.length)return!1}return!(t.primary||!n.primary)||!(t.primary&&!n.primary)&&(i=sy(e.channelsCount,t.channelsCount,n.channelsCount),i==py||i!=my&&(i=sy(e.audioSamplingRate,t.audioSamplingRate,n.audioSamplingRate),i==py||i!=my&&!(!e.bandwidth||oy(e.bandwidth,t.bandwidth,n.bandwidth)!=py)))}function ty(e,t,n){var i=Xv(e,t),r=Xv(e,n);if(i&&!r)return!1;if(!i&&r)return!0;if(i=sy(e.width*e.height,t.width*t.height,n.width*n.height),i==py)return!0;if(i==my)return!1;if(e.frameRate){if(i=sy(e.frameRate,t.frameRate,n.frameRate),i==py)return!0;if(i==my)return!1}return!(!e.bandwidth||oy(e.bandwidth,t.bandwidth,n.bandwidth)!=py)}function ny(e,t,n){var i=fi(e.language,t.language),r=fi(e.language,n.language);if(r>i)return!0;if(r<i)return!1;if(!t.primary&&n.primary)return!0;if(t.primary&&!n.primary)return!1;if(t.label!==n.label){if(e.label===t.label)return!1;if(e.label===n.label)return!0}if(e.roles.length){if(i=t.roles.filter(function(t){return e.roles.includes(t)}),r=n.roles.filter(function(t){return e.roles.includes(t)}),r.length>i.length)return!0;if(r.length<i.length)return!1}else{if(!n.roles.length&&t.roles.length)return!0;if(n.roles.length&&!t.roles.length)return!1}return n.mimeType==e.mimeType&&n.codecs==e.codecs&&(t.mimeType!=e.mimeType||t.codecs!=e.codecs)}function iy(e,t,n){return sy(e.width*e.height,t.width*t.height,n.width*n.height)==py}function ry(e){return{id:0,originalId:"",groupId:null,primary:!1,type:e,mimeType:"",codecs:"",language:"",originalLanguage:null,label:null,width:null,height:null,encrypted:!1,keyIds:new Set,segments:[],variantIds:[],roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,external:!1,fastSwitching:!1}}function ay(e){return{id:0,originalId:"",groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new tu([]),mimeType:"",codecs:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"",originalLanguage:null,label:null,type:e,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,accessibilityPurpose:null,external:!1,fastSwitching:!1,fullMimeTypes:new Set}}function sy(e,t,n){if(t==e&&e!=n)return my;if(n==e&&e!=t)return py;if(t>e){if(n<=e||n-e<t-e)return py;if(n-e>t-e)return my}else{if(n>e)return my;if(e-n<e-t)return py;if(e-n>e-t)return my}return gy}function oy(e,t,n){return t=Math.abs(e-t),e=Math.abs(e-n),e<t?py:t<e?my:gy}function ly(e){switch(e.type){case Ln:return!e.language;case"image":return!e.tilesLayout;default:return!1}}function uy(e){return JSON.stringify([e.fastSwitching,e.width,e.frameRate,fy(e.codecs),e.mimeType,e.label,e.roles,e.closedCaptions?Array.from(e.closedCaptions.entries()):null,e.bandwidth])}function cy(e){return JSON.stringify([e.fastSwitching,e.channelsCount,e.language,e.bandwidth,e.label,fy(e.codecs),e.mimeType,e.roles,e.audioSamplingRate,e.primary])}function dy(e){return JSON.stringify([e.language,e.label,e.codecs,e.mimeType,e.bandwidth,e.roles])}function hy(e){return JSON.stringify([e.width,e.codecs,e.mimeType])}function fy(e){if(!vy.has(e)){var t=Hn(e);vy.set(e,t)}return vy.get(e)}y(xv,tu),i=xv.prototype,i.getNumReferences=function(){return this.g?this.g.timeline.length:0},i.release=function(){tu.prototype.release.call(this),this.g=null},i.Oa=function(e){if(this.g){for(var t=0,n=this.g.timeline,i=0;i<n.length;i+=1){if(!(n[i].end+this.h<=e))break;t+=1}0<t&&(this.g.timeline=n.slice(t),this.O.length>=t&&(this.O=this.O.slice(t)),this.i+=t,0===this.getNumReferences()&&this.release())}},i.find=function(e){if(this.g&&this.g.timeline&&this.g.timeline.length&&e<this.g.timeline[0].start+this.h)return this.i;if(!this.g)return null;var t=this.g.timeline;if(e<this.h||e>=this.j)return null;for(var n=t.length-1,i=0;i<t.length;i++){var r=t[i],a=r.start+this.h;if(r=i<n?t[i+1].start+this.h:1/0===this.j?r.end+this.h:this.j,e>=a&&e<r)return i+this.i}return null},i.get=function(e){var t=this;if(e-=this.i,0>e||e>=this.getNumReferences()||!this.g)return null;var n=this.O[e];if(!n){var i=this.g.timeline[e],r=i.Zi,a=this.g.ng+i.og;n=this.h-this.g.Pb;var s=this.h+i.end,o=s;e===this.getNumReferences()-1&&1/0!==this.j&&(o=this.j);for(var l=this.g.codecs,u=this.g.mimeType,c=[],d=(i.end-i.start)/i.Bb,h={},f=0;f<i.Bb;h={kd:h.kd,We:h.We},f++){var p=i.start+d*f,g=p+d;h.We=f+1,h.kd=null,p=new Qs(this.h+p,this.h+g,function(e){return function(){return t.g?(null==e.kd&&(e.kd=Cv(t.g.bc,t.C,r,t.A,a,e.We,t.B)),e.kd):[]}}(h),0,null,this.o,n,this.h,this.j,[],"",null,null,Js,this.s),p.codecs=l,p.mimeType=u,0==this.F?0<f&&p.se():0!=f%this.F&&p.se(),c.push(p)}n=new Qs(this.h+i.start,o,function(){return 0<i.Bb||!t.g?[]:Cv(t.g.bc,t.C,r,t.A,a,null,t.B)},0,null,this.o,n,this.h,this.j,c,"",null,null,Js,this.s,0<i.Bb),n.codecs=l,n.mimeType=u,n.j=s,this.O[e]=n}return n},Rv.prototype.configure=function(e){this.o=e},Rv.prototype.destroy=function(){return this.A=this.o=null,this.i=[],this.h=null,this.m=[],this.F=[],this.l.clear(),null!=this.g&&(this.g.stop(),this.g=null),this.G.destroy()},Rv.prototype.setManifestType=function(e){this.s=e},Rv.prototype.banLocation=function(e){this.j.set(e,Date.now()+6e4)},i=Nv.prototype,i.release=function(){for(var e=c(this.h.concat(this.g,this.l,this.i)),t=e.next();!t.done;t=e.next())t=t.value,t.segmentIndex&&t.segmentIndex.release();this.h=[],this.g=[],this.l=[],this.i=[],this.j=[]},i.li=function(){return this.j},i.Gf=function(){return this.l.slice()},i.Uh=function(){return this.i},i.gf=function(e,t,n){n=void 0!==n&&n;var i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,E,x,A,k,I,C,R,M,D,L,P,O,U=this;return N(function(N){if(1==N.g){if(i=Pn,!t&&1==e.length)return r=Uv(e,!1),a=r.xg,s=r.vh,o=r.sh,l=r.Sg,U.h=Array.from(a[0].values()),U.g=Array.from(s[0].values()),U.l=Array.from(o[0].values()),U.i=Array.from(l[0].values()),N.u(2);for(u=n?U.m.size:0,d=-1,h=0;h<e.length;h++)f=e[h],U.m.has(f.id)||(U.m.add(f.id),-1==d&&(d=h));return-1==d?N.return():(p=Uv(e,!0),g=p.xg,m=p.vh,v=p.sh,y=p.Sg,_(N,Promise.all([Bv(U,U.h,g,d,zv,$v,u),Bv(U,U.g,m,d,zv,$v,u),Bv(U,U.l,v,d,zv,$v,u),Bv(U,U.i,y,d,zv,$v,u)]),2))}if(b=0,S=[],U.g.length&&U.h.length)for(I=c(U.h),C=I.next();!C.done;C=I.next())for(R=C.value,M=c(U.g),D=M.next();!D.done;D=M.next())L=D.value,P=Dt(R.drmInfos,L.drmInfos),R.drmInfos.length&&L.drmInfos.length&&!P.length||(O=b++,S.push({id:O,language:R.language,disabledUntilTime:0,primary:R.primary,audio:R,video:L,bandwidth:(R.bandwidth||0)+(L.bandwidth||0),drmInfos:P,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]}));else for(T=U.g.length?U.g:U.h,E=c(T),x=E.next();!x.done;x=E.next())A=x.value,k=b++,S.push({id:k,language:A.language,disabledUntilTime:0,primary:A.primary,audio:A.type==i.X?A:null,video:A.type==i.ga?A:null,bandwidth:A.bandwidth||0,drmInfos:A.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});U.j=S,w(N)})},i.ih=function(e){this.o=e},i.ph=function(e){this.s=e},z("shaka.util.PeriodCombiner",Nv),Nv.prototype.setUseStreamOnce=Nv.prototype.ph,Nv.prototype.setAllowMultiTypeVariants=Nv.prototype.ih,Nv.prototype.combinePeriods=Nv.prototype.gf,Nv.prototype.getImageStreams=Nv.prototype.Uh,Nv.prototype.getTextStreams=Nv.prototype.Gf,Nv.prototype.getVariants=Nv.prototype.li;var py=1,gy=0,my=-1,vy=new Map;function yy(e,t){var n=new DOMParser,i=Sy.value()(e);e=null;try{e=n.parseFromString(i,"text/xml")}catch(e){return null}if(n=e.documentElement,!n||n.getElementsByTagName("parsererror").length||n.tagName!=t)return null;if(!("createNodeIterator"in document))return n;for(t=document.createNodeIterator(e,NodeFilter.SHOW_ALL);e=t.nextNode();)if(e instanceof HTMLElement||e instanceof SVGElement)return null;return n}function by(e,t){try{var n=pn(e);return yy(n,t)}catch(e){return null}}var Sy=new Rt(function(){if("undefined"!==typeof trustedTypes){var e=trustedTypes.createPolicy("shaka-player#xml",{createHTML:function(e){return e}});return function(t){return e.createHTML(t)}}return function(e){return e}});function Ty(){var e=this;this.j=this.g=null,this.A=[],this.i=null,this.ea=1,this.B=[],this.l={we:"",type:"",profiles:[],Mb:null,Ia:0,Ga:null,Ld:0},this.o=new Map,this.s={},this.aa={},this.m=new Nv,this.H=0,this.da=new W(5),this.I=new Ut(function(){e.G&&!e.g.continueLoadingWhenPaused&&(e.C.lb(e.G,"timeupdate"),e.G.paused)?e.C.ha(e.G,"timeupdate",function(){return Uy(e)}):Uy(e)}),this.N=new Vr,this.L=null,this.fa=[],this.R=1/0,this.F=!1,this.h=null,this.K=0,this.U=!1,this.C=new ae,this.G=null,this.Z=!1}function _y(e){var t,n,i,r,a,s,o,l,u,c;return N(function(d){return 1==d.g?(t=4,n="MPD",i=Yy(e),r=e.A,i.length?(r=i,n="Patch",t=6):1<e.A.length&&e.h&&(a=Ov(e.h,"Location",!0),a.length&&(r=a)),s=Kr(r,e.g.retryParameters),o=Date.now(),_(d,qy(e,s,0,{type:t}),2)):3!=d.g?(l=d.h,e.j?(l.uri&&l.uri!=l.originalUri&&!e.A.includes(l.uri)&&e.A.unshift(l.uri),_(d,wy(e,l.data,l.uri,n),3)):d.return(0)):(u=Date.now(),c=(u-o)/1e3,e.da.sample(1,c),d.return(c))})}function wy(e,t,n,i){var r,a,s,o,l,u,c,d,h,f;return N(function(p){if(1==p.g){if(r=t,a=e.g.dash.manifestPreprocessor,s=Nc,a!=s){if(pe("manifest.dash.manifestPreprocessor configuration","Please Use manifest.dash.manifestPreprocessorTXml instead."),o=by(r,i),!o)throw new It(2,4,4001,n);a(o),r=gn(o.outerHTML)}if(l=wa(r,i),!l)throw new It(2,4,4001,n);return u=e.g.dash.manifestPreprocessorTXml,c=Uc,u!=c&&u(l),"Patch"===i?p.return(Ay(e,l)):e.g.dash.disableXlinkProcessing?p.return(Ey(e,l,n)):(d=e.g.dash.xlinkFailGracefully,h=Ym(l,e.g.retryParameters,d,n,e.j.networkingEngine),jr(e.N,h),_(p,h.promise,2))}return f=p.h,p.return(Ey(e,f,n))})}function Ey(e,t,n){var i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,E,x,A,k,I,C,R,M,D,L,P,O,U,F,B,V,j,G,H,z,K,$,W,q,Y,X,Q,Z,J,ee,te,ne,ie,re,ae;return N(function(N){switch(N.g){case 1:for(e.h&&e.h.l.clear(),i=[n],r=[],a=new Map,s=Ca(t,"Location"),o=c(s),l=o.next();!l.done;l=o.next())u=l.value,d=u.attributes.serviceLocation,(h=Ma(u))&&(f=kn(i,[h])[0],d&&(e.h?Pv(e.h,"Location",d,f):a.set(d,f)),r.push(f));if(e.h?(p=Ov(e.h,"Location",!0),0<p.length&&(i=e.A=p)):r.length&&(i=e.A=r),e.l.we=t.attributes.id||"",e.l.Ld=Oa(t,"publishTime",Ba)||0,e.B=Ca(t,"PatchLocation"),g=Promise.resolve(),(m=La(t,"ContentSteering"))&&e.j)for(v=m.attributes.defaultServiceLocation,e.h?(e.h.i=i,e.h.h=v):(e.h=new Rv(e.j),e.h.configure(e.g),e.h.setManifestType("DASH"),e.h.i=i,e.h.h=v,(y=Ma(m))&&(Oa(m,"queryBeforeStart",$a,!1)?g=Mv(e.h,y):Mv(e.h,y))),b=c(a.keys()),S=b.next();!S.done;S=b.next())T=S.value,E=a.get(T),Pv(e.h,"Location",T,E);if(x=Ca(t,"BaseURL"),k=!1,e.h)for(I=c(x),C=I.next();!C.done;C=I.next())R=C.value,M=R.attributes.serviceLocation,D=Ma(R),M&&D&&(Pv(e.h,"BaseURL",M,D),k=!0);if(k&&e.h||(L=x.map(Ma),A=kn(i,L)),P=function(){return e.h&&k?Ov(e.h,"BaseURL"):A||[]},e.l.Ga=P,O=0,x&&x.length&&(O=Oa(x[0],"availabilityTimeOffset",Ka)||0),e.l.Ia=O,U=e.g.dash.ignoreMinBufferTime,F=0,U||(F=Oa(t,"minBufferTime",Va)||0),e.H=Oa(t,"minimumUpdatePeriod",Va,-1),B=Oa(t,"availabilityStartTime",Ba),V=Oa(t,"timeShiftBufferDepth",Va),j=e.g.dash.ignoreSuggestedPresentationDelay,G=null,j||(G=Oa(t,"suggestedPresentationDelay",Va)),H=e.g.dash.ignoreMaxSegmentDuration,z=null,H||(z=Oa(t,"maxSegmentDuration",Va)),K=t.attributes.type||"static",e.i&&e.i.presentationTimeline&&(e.Z=e.i.presentationTimeline.V()&&"static"==K),e.l.type=K,e.i)for($=e.i.presentationTimeline,W=c(Object.values(e.s)),q=W.next();!q.done;q=W.next())Y=q.value,Y.segmentIndex&&Y.segmentIndex.Oa($.nb());else X=e.g.defaultPresentationDelay||1.5*F,Q=null!=G?G:X,$=new Ll(B,Q,e.g.dash.autoCorrectDrift);return $.wc("static"==K),$.V()&&!isNaN(e.g.availabilityWindowOverride)&&(V=e.g.availabilityWindowOverride),null==V&&(V=1/0),$.Ie(V),Z=t.attributes.profiles||"",e.l.profiles=Z.split(","),J={xb:"static"!=K,presentationTimeline:$,va:null,ja:null,la:null,J:null,bandwidth:0,If:!1,Ia:O,Mb:null,profiles:Z.split(","),roles:null},e.K=0,ee=My(e,J,P,t),te=ee.duration,ne=ee.periods,("static"!=K||e.Z)&&ee.Fg||$.$a(te||1/0),e.U&&!e.F&&e.j.isAutoLowLatencyMode()&&(e.j.enableLowLatencyMode(),e.F=e.j.isLowLatencyMode()),e.F&&$.jh(e.R),$.Pf(z||1),_(N,g,2);case 2:return e.F&&(F=0,ie=null!=G?G:e.g.defaultPresentationDelay,$.eg(ie)),e.i?(e.i.periodCount=ne.length,e.i.gapCount=e.K,_(N,xy(e,ne,!1),4)):_(N,e.m.gf(ne,J.xb),6);case 6:if(e.i={presentationTimeline:$,variants:e.m.j,textStreams:e.m.Gf(),imageStreams:e.m.i,offlineSessionIds:[],minBufferTime:F||0,sequenceMode:e.g.dash.sequenceMode,ignoreManifestTimestampsInSegmentsMode:!1,type:"DASH",serviceDescription:Cy(t),nextUrl:Ry(t),periodCount:ne.length,gapCount:e.K,isLowLatency:e.U},!$.uh()){N.u(7);break}return re=Ca(t,"UTCTiming"),_(N,zy(e,P,re),8);case 8:if(ae=N.h,!e.j)return N.return();$.kh(ae);case 7:$.re();case 4:e.j.makeTextStreamsForClosedCaptions(e.i),w(N)}})}function xy(e,t,n){var i;return N(function(r){if(1==r.g)return _(r,e.m.gf(t,!0,n),2);e.i.variants=e.m.j,i=e.m.Gf(),0<i.length&&(e.i.textStreams=i),e.i.imageStreams=e.m.i,e.j.filter(e.i),w(r)})}function Ay(e,t){var n,i,r,a,s,o,l,u,h,f,p,g,m,v,y,b,S,T,E,x,A,k,I,C,R;return N(function(M){if(1==M.g){if(n=t.attributes.mpdId,i=Oa(t,"originalPublishTime",Ba),!n||n!==e.l.we||i!==e.l.Ld)throw e.B=[],new It(1,4,4052);for(r=[],a=[],s=new Set,o=c(Ia(t)),l=o.next();!l.done;l=o.next())if(u=l.value,h=qa(u.attributes.sel||""),f=h[h.length-1],p=Ma(u)||"","MPD"===f.name)if("mediaPresentationDuration"===f.Vb){g=Ma(u)||"";var D=Va(g);if(null!=D){e.l.Mb=D;for(var L=c(e.o.values()),P=L.next();!P.done;P=L.next())P.value.Mb=D}}else if("type"===f.Vb){for(e.i.presentationTimeline.wc("static"==p),e.l.type=p,D=c(e.o.values()),L=D.next();!L.done;L=D.next())L.value.xb="dynamic"==p;"static"==p&&(e.H=-1)}else"publishTime"===f.Vb?e.l.Ld=Ba(p)||0:null===f.Vb&&"add"===u.tagName&&a.push(u);else if("PatchLocation"===f.name)Ya(e.B,u);else if("Period"===f.name){if("add"===u.tagName)a.push(u);else if("remove"===u.tagName&&f.id)for(D=f.id,e.i.periodCount--,L=c(e.o.keys()),P=L.next();!P.done;P=L.next())if(P=P.value,P.startsWith(D)){var O=e.o.get(P);Wm(O,Sv,"SegmentTimeline").children=[],Iy(e,P),e.o.delete(P)}}else if("SegmentTemplate"===f.name){if(L=qa(u.attributes.sel||""),D=L[L.length-1],D.Vb){L=ky(e,L),P=Ma(u)||"",O=c(L);for(var N=O.next();!N.done;N=O.next())N=e.o.get(N.value),Xa(N.J.cc,u.tagName,D.Vb,P);D=L}else D=[];for(m=D,v=c(m),y=v.next();!y.done;y=v.next())b=y.value,s.add(b)}else if("SegmentTimeline"===f.name||"S"===f.name){for(D=qa(u.attributes.sel||""),D=ky(e,D),L=c(D),P=L.next();!P.done;P=L.next())P=e.o.get(P.value),P=Wm(P,Sv,"SegmentTimeline"),O=Ca(P,"S"),Ya(O,u),P.children=O;for(S=D,T=c(S),y=T.next();!y.done;y=T.next())E=y.value,s.add(E)}for(x=c(s),y=x.next();!y.done;y=x.next())A=y.value,Iy(e,A);for(k=c(a),I=k.next();!I.done;I=k.next())C=I.value,r.push.apply(r,d(My(e,{xb:"dynamic"==e.l.type,presentationTimeline:e.i.presentationTimeline,va:null,ja:null,la:null,J:null,bandwidth:0,If:!1,Ia:e.l.Ia,profiles:e.l.profiles,Mb:e.l.Mb,roles:null},e.l.Ga,C).periods));return r.length?(e.i.periodCount+=r.length,e.i.gapCount=e.K,_(M,xy(e,r,!0),2)):M.u(2)}"static"==e.l.type&&(R=e.l.Mb,e.i.presentationTimeline.$a(R||1/0)),w(M)})}function ky(e,t){var n="",i="",r="";t=c(t);for(var a=t.next();!a.done;a=t.next())a=a.value,"Period"===a.name?n=a.id:"AdaptationSet"===a.name?i=a.id:"Representation"===a.name&&(r=a.id);if(t=[],r)t.push(n+","+r);else for(e=c(e.o.values()),r=e.next();!r.done;r=e.next())r=r.value,r.va.id===n&&r.la.id===i&&r.J.id&&t.push(n+","+r.J.id);return t}function Iy(e,t){var n=e.o.get(t),i=e.s[t];i.segmentIndex&&i.segmentIndex.Oa(e.i.presentationTimeline.nb());try{var r=bv(n,function(t,n,i,r){return $y(e,t,n,i,r)},e.s,!0,e.g.dash.initialSegmentLimit,e.aa,n.J.aesKey,null,!0);i.createSegmentIndex=function(){var e;return N(function(t){if(1==t.g)return i.segmentIndex?t.u(0):(e=i,_(t,r.mc(),3));e.segmentIndex=t.h,w(t)})}}catch(e){if(t=n.J.contentType,t!=Ln&&"application"!=t&&"image"!=t||4002!=e.code)throw e}}function Cy(e){var t=La(e,"ServiceDescription");if(!t)return null;if(e=La(t,"Latency"),t=La(t,"PlaybackRate"),!e&&!t)return null;var n={};return e&&("target"in e.attributes&&(n.targetLatency=parseInt(e.attributes.target,10)/1e3),"max"in e.attributes&&(n.maxLatency=parseInt(e.attributes.max,10)/1e3),"min"in e.attributes&&(n.minLatency=parseInt(e.attributes.min,10)/1e3)),t&&("max"in t.attributes&&(n.maxPlaybackRate=parseFloat(t.attributes.max)),"min"in t.attributes&&(n.minPlaybackRate=parseFloat(t.attributes.min))),n}function Ry(e){if(e=Ca(e,"SupplementalProperty"),!e.length)return null;e=c(e);for(var t=e.next();!t.done;t=e.next())if(t=t.value,"urn:mpeg:dash:chaining:2016"==t.attributes.schemeIdUri)return t.attributes.value;return null}function My(e,t,n,i){var r=t.Mb;r||(r=Oa(i,"mediaPresentationDuration",Va),e.l.Mb=r);var a=0;e.i&&e.i.presentationTimeline&&e.Z&&(a=e.i.presentationTimeline.Yb());var s=[],o=a;i=Ca(i,"Period");for(var l=0;l<i.length;l++){var u=i[l],c=i[l+1],d=Oa(u,"start",Va,o),h=u.attributes.id,f=Oa(u,"duration",Va),p=null;if(c){var g=Oa(c,"start",Va);null!=g&&(p=g-d)}else null!=r&&(p=r-d+a);if(g=On,p&&f&&Math.abs(p-f)>g&&p>f&&e.K++,null==p&&(p=f),!(null!==e.L&&null!==h&&null!==d&&d<e.L)||e.fa.includes(h)||l+1==i.length){if(null!==d&&(null===e.L||d>e.L)&&(e.L=d),o=Dy(e,t,n,{start:d,duration:p,node:u,Dd:null==p||!c}),s.push(o),t.va.id&&p&&(e.aa[t.va.id]=p),null==p){o=null;break}o=d+p}}return e.fa=s.map(function(e){return e.id}),null!=r?{periods:s,duration:r+a,Fg:!1}:{periods:s,duration:o,Fg:!0}}function Dy(e,t,n,i){t.va=By(e,i.node,null,n),t.ja=i,t.va.Ia=t.Ia,t.va.id||(t.va.id="__shaka_period_"+i.start);var r=Ca(i.node,"EventStream");n=t.presentationTimeline.nb(),r=c(r);for(var a=r.next();!a.done;a=r.next())Ky(e,i.start,i.duration,a.value,n);if(n=Ca(i.node,"AdaptationSet").map(function(n){return Py(e,t,n)}).filter(oi),t.xb){for(i=[],r=c(n),a=r.next();!a.done;a=r.next()){a=c(a.value.Ti);for(var s=a.next();!s.done;s=a.next())i.push(s.value)}if(i.length!=new Set(i).size)throw new It(2,4,4018)}for(i=n.filter(function(e){return!e.mg}),n=n.filter(function(e){return e.mg}),n=c(n),r=n.next();!r.done;r=n.next()){r=r.value,a=r.mg.split(" "),s=c(i);for(var o=s.next();!o.done;o=s.next()){var l=o.value;if(a.includes(l.id)){o={},l=c(l.streams);for(var u=l.next();!u.done;o={Zd:o.Zd},u=l.next())o.Zd=u.value,o.Zd.trickModeVideo=r.streams.find(function(e){return function(t){return Hn(e.Zd.codecs)==Hn(t.codecs)}}(o))}}}if(n=Ly(e.g.disableAudio,i,"audio"),r=Ly(e.g.disableVideo,i,"video"),a=Ly(e.g.disableText,i,Ln),i=Ly(e.g.disableThumbnails,i,"image"),0===r.length&&0===n.length)throw new It(2,4,4004);return{id:t.va.id,audioStreams:n,videoStreams:r,textStreams:a,imageStreams:i}}function Ly(e,t,n){return e||!t.length?[]:t.reduce(function(e,t){return t.contentType!=n?e:(e.push.apply(e,d(t.streams)),e)},[])}function Py(e,t,n){function i(e){switch(e){case 1:case 5:case 6:case 7:return"srgb";case 9:return"rec2020";case 11:case 12:return"p3"}}function r(e){switch(e){case 1:case 6:case 13:case 14:case 15:return"SDR";case 16:return"PQ";case 18:return"HLG"}}t.la=By(e,n,t.va,null);var a,s,o=!1,l=Ca(n,"Role"),u=l.map(function(e){return e.attributes.value}).filter(oi),h=void 0,f=t.la.contentType==Ln;f&&(h="subtitle"),l=c(l);for(var p=l.next();!p.done;p=l.next()){p=p.value;var g=p.attributes.schemeIdUri;if(null==g||"urn:mpeg:dash:role:2011"==g)switch(p=p.attributes.value,p){case"main":o=!0;break;case"caption":case"subtitle":h=p}}g=Ca(n,"EssentialProperty"),l=null;var m=!1;p=!1,g=c(g);for(var v=g.next();!v.done;v=g.next()){v=v.value;var y=v.attributes.schemeIdUri;"http://dashif.org/guidelines/trickmode"==y?l=v.attributes.value:"urn:mpeg:mpegB:cicp:TransferCharacteristics"==y?a=r(parseInt(v.attributes.value,10)):"urn:mpeg:mpegB:cicp:ColourPrimaries"==y?s=i(parseInt(v.attributes.value,10)):"urn:mpeg:mpegB:cicp:MatrixCoefficients"!=y&&("urn:mpeg:dash:ssr:2023"==y&&e.g.dash.enableFastSwitching?m=!0:p=!0)}var b=null;for(g=Ca(n,"SupplementalProperty"),g=c(g),v=g.next();!v.done;v=g.next())v=v.value,y=v.attributes.schemeIdUri,"http://dashif.org/guidelines/last-segment-number"==y?b=parseInt(v.attributes.value,10)-1:"urn:mpeg:mpegB:cicp:TransferCharacteristics"==y?a=r(parseInt(v.attributes.value,10)):"urn:mpeg:mpegB:cicp:ColourPrimaries"==y&&(s=i(parseInt(v.attributes.value,10)));g=Ca(n,"Accessibility");var S,T=new Map;for(g=c(g),v=g.next();!v.done;v=g.next())if(y=v.value,v=y.attributes.schemeIdUri,y=y.attributes.value,"urn:scte:dash:cc:cea-608:2015"!=v||e.g.disableText)if("urn:scte:dash:cc:cea-708:2015"!=v||e.g.disableText)"urn:mpeg:dash:role:2011"==v?null!=y&&(u.push(y),"captions"==y&&(h="caption")):"urn:tva:metadata:cs:AudioPurposeCS:2007"==v&&("1"==y?S="visually impaired":"2"==y&&(S="hard of hearing"));else if(v=1,null!=y)for(y=c(y.split(";")),E=y.next();!E.done;E=y.next()){E=E.value;var _=void 0,w=void 0;E.includes("=")?(E=E.split("="),_="svc"+E[0],w=E[1].split(",")[0].split(":").pop()):(_="svc"+v,v++,w=E),T.set(_,hi(w))}else T.set("svc1","und");else if(v=1,null!=y){y=y.split(";"),_=c(y);for(var E=_.next();!E.done;E=_.next()){w=E.value;var x=E=void 0;w.includes("=")?(w=w.split("="),E=w[0].startsWith("CC")?w[0]:"CC"+w[0],x=w[1]||"und"):(E="CC"+v,2==y.length?v+=2:v++,x=w),T.set(E,hi(x))}}else T.set("CC1","und");if(p)return null;p=Ca(n,"ContentProtection");var A=Dm(p,e.g.dash.ignoreDrmInfo,e.g.dash.keySystemsByURI),k=hi(t.la.language||"und"),I=t.la.label;if(p=Ca(n,"Representation"),n=p.map(function(n){return(n=Oy(e,t,A,h,k,I,o,u,T,n,S,b))&&(n.hdr=n.hdr||a,n.colorGamut=n.colorGamut||s,n.fastSwitching=m),n}).filter(function(e){return!!e}),0==n.length){if(l="image"==t.la.contentType,e.g.dash.ignoreEmptyAdaptationSet||f||l)return null;throw new It(2,4,4003)}if(!t.la.contentType||"application"==t.la.contentType)for(t.la.contentType=Wy(n[0].mimeType,n[0].codecs),f=c(n),v=f.next();!v.done;v=f.next())v.value.type=t.la.contentType;for(f=t.la.id||"__fake__"+e.ea++,g=c(n),v=g.next();!v.done;v=g.next()){for(v=v.value,y=c(A.drmInfos),_=y.next();!_.done;_=y.next())_=_.value,_.keyIds=_.keyIds&&v.keyIds?new Set([].concat(d(_.keyIds),d(v.keyIds))):_.keyIds||v.keyIds;e.g.dash.enableAudioGroups&&(v.groupId=f)}return p=p.map(function(e){return e.attributes.id}).filter(oi),{id:f,contentType:t.la.contentType,language:k,lk:o,streams:n,drmInfos:A.drmInfos,mg:l,Ti:p}}function Oy(t,n,i,r,a,s,o,l,u,c,d,h){n.J=By(t,c,n.la,null);var f=n.J.id;if(t.R=Math.min(t.R,n.J.Ia),t.U=0<t.R,!Gy(n.J))return null;var p=n.ja.start;n.bandwidth=Oa(c,"bandwidth",Ha)||0,n.roles=l;var g,m,v=n.J.contentType,y=v==Ln||"application"==v;v="image"==v;try{var b=void 0;if(i.bf){var S=n.J.Ga,T=kn(S(),[i.bf.Ai]),E=Kr(T,t.g.retryParameters);b={bitsKey:128,blockCipherMode:"CBC",iv:i.bf.iv,firstMediaSequenceNumber:0,fetchKey:function(){var n,i,r;return N(function(a){if(1==a.g)return _(a,qy(t,E,6),2);if(3!=a.g){if(n=a.h,!n.data||16!=n.data.byteLength)throw new It(2,4,4049);return i={name:"AES-CBC"},r=b,_(a,e.crypto.subtle.importKey("raw",n.data,i,!0,["decrypt"]),3)}r.cryptoKey=a.h,b.fetchKey=void 0,w(a)})}}}if(n.J.aesKey=b,S=function(e,n,i,r){return $y(t,e,n,i,r)},n.J.Tc)var x=ov(n,S,b);else if(n.J.Rb)x=pv(n,t.s,b);else if(n.J.cc)x=bv(n,S,t.s,!!t.i,t.g.dash.initialSegmentLimit,t.aa,b,h,!1);else{var A=n.ja.duration||0,k=n.J.Ga,I=n.J.mimeType,C=n.J.codecs;x={mc:function(){var e=nu(p,A,k());return e.Jb(function(e){e.mimeType=I,e.codecs=C}),Promise.resolve(e)}}}}catch(e){if((y||v)&&4002==e.code)return null;throw e}if(h=Ca(c,"ContentProtection"),h=Lm(h,i,t.g.dash.ignoreDrmInfo,t.g.dash.keySystemsByURI),h=new Set(h?[h]:[]),S=!1,Ca(c,"SupplementalProperty").some(function(e){return"tag:dolby.com,2018:dash:EC3_ExtensionType:2018"==e.attributes.schemeIdUri&&"JOC"==e.attributes.value})&&(S=!0),T=!1,y&&(T=l.includes("forced_subtitle")||l.includes("forced-subtitle")),v&&((c=Ca(c,"EssentialProperty").find(function(e){return["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"].includes(e.attributes.schemeIdUri)}))&&(g=c.attributes.value),!g))return null;c=n.J.codecs,n.profiles.includes("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10")&&(c.includes("hvc1.2.4.L153.B0")||c.includes("hev1.2.4.L153.B0"))&&(m="PQ"),y=n.J.id?n.va.id+","+n.J.id:"",t.B.length&&f&&t.o.set(n.va.id+","+f,Ny(n));var R=y&&t.s[y]?t.s[y]:{id:t.ea++,originalId:n.J.id,groupId:null,createSegmentIndex:function(){return Promise.resolve()},closeSegmentIndex:function(){R.segmentIndex&&(R.segmentIndex.release(),R.segmentIndex=null)},segmentIndex:null,mimeType:n.J.mimeType,codecs:c,frameRate:n.J.frameRate,pixelAspectRatio:n.J.pixelAspectRatio,bandwidth:n.bandwidth,width:n.J.width,height:n.J.height,kind:r,encrypted:0<i.drmInfos.length,drmInfos:i.drmInfos,keyIds:h,language:a,originalLanguage:n.la.language,label:s,type:n.la.contentType,primary:o,trickModeVideo:null,emsgSchemeIdUris:n.J.emsgSchemeIdUris,roles:l,forced:T,channelsCount:n.J.Nc,audioSamplingRate:n.J.audioSamplingRate,spatialAudio:S,closedCaptions:u,hdr:m,colorGamut:void 0,videoLayout:void 0,tilesLayout:g,accessibilityPurpose:d,external:!1,fastSwitching:!1,fullMimeTypes:new Set([Fn(n.J.mimeType,n.J.codecs)])};return R.createSegmentIndex=function(){var e;return N(function(t){if(1==t.g)return R.segmentIndex?t.u(0):(e=R,_(t,x.mc(),3));e.segmentIndex=t.h,w(t)})},y&&n.xb&&!t.s[y]&&(t.s[y]=R),R}function Ny(e){for(var t={},n=c(Object.keys(e)),i=n.next();!i.done;i=n.next())if(i=i.value,["period","adaptationSet","representation"].includes(i)){var r=e[i];t[i]={Tc:null,Rb:null,cc:r.cc,Ga:r.Ga,width:r.width,height:r.height,contentType:r.contentType,mimeType:r.mimeType,language:r.language,codecs:r.codecs,frameRate:r.frameRate,pixelAspectRatio:r.pixelAspectRatio,emsgSchemeIdUris:r.emsgSchemeIdUris,id:r.id,Nc:r.Nc,audioSamplingRate:r.audioSamplingRate,Ia:r.Ia,Jc:r.Jc}}else"periodInfo"==i?(r=e[i],t[i]={start:r.start,duration:r.duration,node:null,Dd:r.Dd}):t[i]=e[i];return t}function Uy(e){var t,n;return N(function(i){switch(i.g){case 1:return t=0,E(i,2),_(i,_y(e),4);case 4:t=i.h,A(i,3);break;case 2:if(n=k(i),e.j){if(e.g.raiseFatalErrorOnManifestUpdateRequestFailure)return e.j.onError(n),i.return();n.severity=1,e.j.onError(n)}case 3:if(!e.j)return i.return();e.j.onManifestUpdated(),Fy(e,t),w(i)}})}function Fy(e,t){if(!(0>e.H)){var n=e.H;0<=e.g.dash.updatePeriod&&(n=e.g.dash.updatePeriod),e.I.Y(Math.max(n-t,q(e.da)))}}function By(e,t,n,i){n=n||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,pixelAspectRatio:void 0,Nc:null,audioSamplingRate:null,Ia:0,ag:0},i=i||n.Ga;var r,a=t.attributes.id,s=Ca(t,"BaseURL"),o=!1;if(e.h)for(var l=c(s),u=l.next();!u.done;u=l.next()){var d=u.value;u=d.attributes.serviceLocation,d=Ma(d),u&&d&&(Pv(e.h,a,u,d),o=!0)}o&&e.h||(r=s.map(Ma)),l=t.attributes.contentType||n.contentType,u=t.attributes.mimeType||n.mimeType,d=[t.attributes.codecs||n.codecs];var h=Na(t,"urn:scte:dash:scte214-extensions","supplementalCodecs");h&&d.push(h),d=Nu(d).join(","),h=Oa(t,"frameRate",Wa)||n.frameRate;var f=t.attributes.sar||n.pixelAspectRatio,p=Vy(Ca(t,"InbandEventStream"),n.emsgSchemeIdUris),g=Ca(t,"AudioChannelConfiguration");g=jy(g)||n.Nc;var m=Oa(t,"audioSamplingRate",za)||n.audioSamplingRate;l||(l=Wy(u,d));var v=La(t,"SegmentBase"),y=La(t,"SegmentTemplate"),b=v&&Oa(v,"availabilityTimeOffset",Ka)||0,S=y&&Oa(y,"availabilityTimeOffset",Ka)||0,T=s&&s.length&&Oa(s[0],"availabilityTimeOffset",Ka)||0;b=n.Ia+T+b+S,S=null,(T=La(t,"SegmentSequenceProperties"))&&(T=La(T,"SAP"))&&(S=Oa(T,"cadence",Ga)),T=t.attributes.label;var _=Ca(t,"Label");return _&&_.length&&(_=_[0],Ra(_)&&(T=Ra(_))),{Ga:function(){return kn(i(),s.length?e.h&&o?Ov(e.h,a):r||[]:[])},Tc:v||n.Tc,Rb:La(t,"SegmentList")||n.Rb,cc:y||n.cc,width:Oa(t,"width",za)||n.width,height:Oa(t,"height",za)||n.height,contentType:l,mimeType:u,codecs:d,frameRate:h,pixelAspectRatio:f,emsgSchemeIdUris:p,id:a,language:t.attributes.lang,Nc:g,audioSamplingRate:m,Ia:b,Jc:null,ag:S||n.ag,label:T||null}}function Vy(e,t){t=t.slice(),e=c(e);for(var n=e.next();!n.done;n=e.next())n=n.value.attributes.schemeIdUri,t.includes(n)||t.push(n);return t}function jy(e){e=c(e);for(var t=e.next();!t.done;t=e.next()){var n=t.value;if((t=n.attributes.schemeIdUri)&&(n=n.attributes.value))switch(t){case"urn:mpeg:dash:outputChannelPositionList:2012":return n.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":if(t=parseInt(n,10),!t)continue;return t;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(t=parseInt(n,16),!t)continue;for(e=0;t;)1&t&&++e,t>>=1;return e;case"urn:mpeg:mpegB:cicp:ChannelConfiguration":if(t=[0,1,2,3,4,5,6,8,2,3,4,7,8,24,8,12,10,12,14,12,14],(n=parseInt(n,10))&&0<n&&n<t.length)return t[n]}}return null}function Gy(e){var t=e.Tc?1:0;return t+=e.Rb?1:0,t+=e.cc?1:0,0==t?e.contentType==Ln||"application"==e.contentType:(1!=t&&(e.Tc&&(e.Rb=null),e.cc=null),!0)}function Hy(e,t,n,i){var r,a,s,o,l,u,c;return N(function(d){if(1==d.g)return r=[yn(n)],a=kn(t(),r),s=Kr(a,e.g.retryParameters),s.method=i,o=e.j.networkingEngine.request(4,s),jr(e.N,o),_(d,o.promise,2);if(l=d.h,"HEAD"==i){if(!l.headers||!l.headers.date)return d.return(0);u=l.headers.date}else u=hn(l.data);return c=Date.parse(u),isNaN(c)?d.return(0):d.return(c-Date.now())})}function zy(e,t,n){var i,r,a,s,o,l,u,d;return N(function(h){switch(h.g){case 1:i=n.map(function(e){return{scheme:e.attributes.schemeIdUri,value:e.attributes.value}}),r=e.g.dash.clockSyncUri,!i.length&&r&&i.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:r}),a=c(i),s=a.next();case 2:if(s.done){h.u(4);break}switch(o=s.value,E(h,5),l=o.scheme,u=o.value,l){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return h.u(7);case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return h.u(8);case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return d=Date.parse(u),h.return(isNaN(d)?0:d-Date.now());case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":Z("NTP UTCTiming scheme is not supported");break;default:Z("Unrecognized scheme in UTCTiming element",l)}h.u(9);break;case 7:return _(h,Hy(e,t,u,"HEAD"),10);case 10:return h.return(h.h);case 8:return _(h,Hy(e,t,u,"GET"),11);case 11:return h.return(h.h);case 9:A(h,3);break;case 5:k(h);case 3:s=a.next(),h.u(2);break;case 4:return Z("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),h.return(0)}})}function Ky(e,t,n,i,r){var a=i.attributes.schemeIdUri||"",s=i.attributes.value||"",o=Oa(i,"timescale",za)||1;i=c(Ca(i,"Event"));for(var l=i.next();!l.done;l=i.next()){l=l.value;var u=Oa(l,"presentationTime",za)||0,d=Oa(l,"duration",za)||0;u=u/o+t,d=u+d/o,null!=n&&(u=Math.min(u,t+n),d=Math.min(d,t+n)),d<r||(l={schemeIdUri:a,value:s,startTime:u,endTime:d,id:l.attributes.id||"",eventElement:Qa(l),eventNode:l},e.j.onTimelineRegionAdded(l))}}function $y(e,t,n,i,r){var a,s,o,l;return N(function(u){return 1==u.g?(a=Zr,s=r?0:1,o=Vu(t,n,i,e.g.retryParameters),_(u,qy(e,o,a,{type:s}),2)):(l=u.h,u.return(l.data))})}function Wy(e,t){return t=Fn(e,t),Zn(t)?Ln:e.split("/")[0]}function qy(e,t,n,i){return t=e.j.networkingEngine.request(n,t,i),jr(e.N,t),t.promise}function Yy(e){var t=e.l.Ld;if(!e.l.we||!t||!e.B.length)return[];var n=Date.now()/1e3,i=e.B.filter(function(e){return e=za(e.attributes.ttl),!e||t+e>n}).map(Ma).filter(oi);return i.length?kn(e.A,i):[]}function Xy(){}i=Ty.prototype,i.configure=function(e){var t=this.j&&e.dash.updatePeriod!=this.g.dash.updatePeriod&&0<=e.dash.updatePeriod;this.g=e,t&&this.i&&this.i.presentationTimeline.V()&&this.I.xc(),this.h&&this.h.configure(this.g),this.m&&(this.m.ih(this.g.dash.multiTypeVariantsAllowed&&de()),this.m.ph(this.g.dash.useStreamOnceInPeriodFlattening))},i.start=function(e,t){var n,i=this;return N(function(r){if(1==r.g)return i.F=t.isLowLatencyMode(),i.A=[e],i.j=t,_(r,_y(i),2);if(n=r.h,i.j&&Fy(i,n),!i.j)throw new It(2,7,7001);return r.return(i.i)})},i.stop=function(){for(var e=c(Object.values(this.s)),t=e.next();!t.done;t=e.next())t=t.value,t.segmentIndex&&t.segmentIndex.release();return this.m&&this.m.release(),this.g=this.j=null,this.A=[],this.i=null,this.s={},this.o.clear(),this.l={we:"",type:"",profiles:[],Mb:null,Ia:0,Ga:null,Ld:0},this.m=null,null!=this.I&&(this.I.stop(),this.I=null),this.h&&this.h.destroy(),this.C&&(this.C.release(),this.C=null),this.N.destroy()},i.update=function(){var e,t=this;return N(function(n){return 1==n.g?(E(n,2),_(n,_y(t),4)):2!=n.g?A(n,0):(e=k(n),t.j&&e?(t.j.onError(e),void w(n)):n.return())})},i.onExpirationUpdated=function(){},i.onInitialVariantChosen=function(e){if(this.i&&this.i.presentationTimeline.V()){var t=e.video||e.audio;if(t&&t.segmentIndex){e=this.i.presentationTimeline.Zb();var n=t.segmentIndex.find(e);null!=n&&(t=t.segmentIndex.get(n))&&(this.H=t.endTime-e,Fy(this,0))}}},i.banLocation=function(e){this.h&&this.h.banLocation(e)},i.setMediaElement=function(e){this.G=e},z("shaka.dash.DashParser",Ty),zs["application/dash+xml"]=function(){return new Ty},zs["video/vnd.mpeg.dash.mpd"]=function(){return new Ty},z("shaka.dependencies",Xy),Xy.has=function(e){return Jy.has(e)},Xy.add=function(e,t){if(!Zy[e])throw Error(e+" is not supported");e==Qy?pe("mux.js","mux.js is no longer used in Shaka Player."):Jy.set(e,function(){return t})};var Qy="muxjs",Zy={mk:Qy,ISOBoxer:"ISOBoxer"};Xy.Allowed=Zy;var Jy=new Map([["ISOBoxer",function(){return e.ISOBoxer}]]);function eb(e,t,n){this.type=e,this.g=t,this.segments=n||null}function tb(e,t,n,i){this.id=e,this.name=t,this.attributes=n,this.value=void 0===i?null:i}function nb(e){var t=(new Set).add("AUDIO").add("VIDEO").add("SUBTITLES").add("PATHWAY-ID").add("GROUP-ID").add("URI");return e.toString(t)}function ib(e,t){return e=e.attributes.filter(function(e){return e.name==t}),e.length?e[0]:null}function rb(e,t,n){return(e=ib(e,t))?e.value:n||null}function ab(e,t){if(e=ib(e,t),!e)throw new It(2,4,4023,t);return e.value}function sb(e,t,n){n=void 0===n?[]:n,this.g=t,this.h=e,this.Bb=n}function ob(e,t){this.name=e,this.value=t}function lb(e,t){return e.filter(function(e){return e.name==t})}function ub(e,t){return e.filter(function(e){return ab(e,"TYPE")==t})}function cb(e,t){e=c(e);for(var n=e.next();!n.done;n=e.next())if(n=n.value,n.name===t)return n;return null}function db(e,t,n){return n=void 0===n?0:n,(e=cb(e,t))?Number(e.value):n}function hb(e,t,n){return t?fb(e,[t],n):[]}function fb(e,t,n){if(!t.length)return[];t=kn(e,t),e=[],t=c(t);for(var i=t.next();!i.done;i=t.next())e.push(pb(i.value,n));return e}function pb(e,t){if(!t||!t.size)return e;e=String(e).replace(/%7B/g,"{").replace(/%7D/g,"}");var n=e.match(/{\$\w*}/g);if(n){n=c(n);for(var i=n.next();!i.done;i=n.next()){i=i.value;var r=i.slice(2,i.length-1),a=t.get(r);if(!a)throw new It(2,4,4039,r);e=e.replace(i,a)}}return e}function gb(){this.g=0}function mb(e,t){t=hn(t),t=t.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim();var n=t.split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(n[0]))throw new It(2,4,4015);t=0;for(var i=!0,r=c(n),a=r.next();!a.done;a=r.next())if(a=a.value,/^#(?!EXT)/m.test(a)||i)i=!1;else{if(a=vb(e,a),--e.g,yb.includes(a.name)){t=1;break}"EXT-X-STREAM-INF"==a.name&&(i=!0)}for(r=[],i=!0,a=0;a<n.length;a++){var s=n[a],o=n[a+1];if(/^#(?!EXT)/m.test(s)||i)i=!1;else{if(s=vb(e,s),bb.includes(s.name)){if(1!=t)throw new It(2,4,4017);s=n.splice(a,n.length-a),n=[],i=[],a=[],o=null,s=c(s);for(var l=s.next();!l.done;l=s.next())l=l.value,/^(#EXT)/.test(l)?(l=vb(e,l),yb.includes(l.name)?r.push(l):"EXT-X-MAP"==l.name?o=l:"EXT-X-PART"==l.name?a.push(l):"EXT-X-PRELOAD-HINT"==l.name?"PART"==rb(l,"TYPE")?a.push(l):"MAP"==rb(l,"TYPE")&&(l.name="EXT-X-MAP",o=l):i.push(l)):/^#(?!EXT)/m.test(l)||(l=l.trim(),o&&i.push(o),n.push(new sb(l,i,a)),i=[],a=[]);return a.length&&(o&&i.push(o),n.push(new sb("",i,a))),new eb(t,r,n)}r.push(s),"EXT-X-STREAM-INF"==s.name&&(s.attributes.push(new ob("URI",o)),i=!0)}}return new eb(t,r)}function vb(e,t){e=e.g++;var n=t.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!n)throw new It(2,4,4016,t);t=n[1];var i,r=n[2];if(n=[],r){var a;r=new Vf(r),(a=Gf(r,/^([^,=]+)(?:,|$)/g))&&(i=a[1]);for(var s=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;a=Gf(r,s);)n.push(new ob(a[1],a[2]||a[3])),jf(r)}return new tb(e,t,n,i)}tb.prototype.toString=function(e){function t(e){return e.name+"="+(isNaN(Number(e.value))?'"'+e.value+'"':e.value)}var n="#"+this.name,i=this.attributes?this.attributes.filter(function(t){return!e||!e.has(t.name)}).map(t):[];return this.value&&i.unshift(this.value),0<i.length&&(n+=":"+i.join(",")),n};var yb="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP EXT-X-PART-INF EXT-X-DATERANGE".split(" "),bb="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP EXT-X-GAP".split(" ");function Sb(){}function Tb(e){try{var t=_b(e);return Dr({uri:e,originalUri:e,data:t.data,headers:{"content-type":t.contentType}})}catch(e){return Rr(e)}}function _b(t){var n=t.split(":");if(2>n.length||"data"!=n[0])throw new It(2,1,1004,t);if(n=n.slice(1).join(":").split(","),2>n.length)throw new It(2,1,1004,t);var i=n[0];t=e.decodeURIComponent(n.slice(1).join(",")),n=i.split(";"),i=n[0];var r,a=!1;return 1<n.length&&"base64"==n[n.length-1]&&(a=!0,n.pop()),r=a?wn(t):gn(t),{data:r,contentType:i}}function wb(){var e=this;this.g=this.h=null,this.B=1,this.s=new Map,this.G=new Map,this.N=new Map,this.N.set("video",new Map),this.N.set("audio",new Map),this.N.set(Ln,new Map),this.N.set("image",new Map),this.wb=new Set,this.i=new Map,this.j=null,this.L="",this.Fa=new gb,this.H=-1,this.fa=1/0,this.ea=this.Ib=!1,this.A=new Ut(function(){e.aa&&!e.g.continueLoadingWhenPaused&&(e.Z.lb(e.aa,"timeupdate"),e.aa.paused)?e.Z.ha(e.aa,"timeupdate",function(){return wS(e)}):wS(e)}),this.xa=LS,this.m=null,this.bb=0,this.o=1/0,this.Da=this.za=this.U=0,this.da=new Vr,this.C=new Map,this.F=new Map,this.ra=new Map,this.pa=new Map,this.K=new Map,this.qa=new Map,this.ya=new Map,this.Hb=this.I=!1,this.Fb=new W(5),this.l=null,this.R=!0,this.Ea=new Set,this.Z=new ae,this.aa=null}function Eb(e,t){return ES(e)?e.N.get(t.type):t.te}function xb(e,t){var n,i,r,a,s,o,l,u,h,f,p,g,m,v,y,b,S,T,x,I,C,R,M,D,L,P,O,U,F,B,V,j,G,H;return N(function(N){switch(N.g){case 1:for(n=[],i=c(t.M()),r=i.next();!r.done;r=i.next())a=r.value,s=new ht(a),o=s.g,t.ce&&(0<=t.pb&&o.add("_HLS_msn",String(t.pb)),0<=t.qb&&o.add("_HLS_part",String(t.qb))),t.de&&o.add("_HLS_skip","YES"),kt(o)&&mt(s,o),n.push(s.toString());return E(N,2),_(N,_S(e,n,!0),4);case 4:l=N.h,A(N,3);break;case 2:throw u=k(N),e.h&&e.h.disableStream(t.stream),u;case 3:if(!t.stream.segmentIndex)return N.return();if(h=mb(e.Fa,l.data),1!=h.type)throw new It(2,4,4017);return f=l.uri,f==l.originalUri||t.M().includes(f)||t.dh.push(f),p=lb(h.g,"EXT-X-DEFINE"),g=Lb(e,p,f),m=t.stream,v=Eb(e,t),_(N,oS(e,h,m.mimeType,t.M,g),5);case 5:for(y=N.h,b=y.keyIds,S=y.drmInfos,T=function(e,t){return e.size===t.size&&[].concat(d(e)).every(function(e){return t.has(e)})},T(m.keyIds,b)||(m.keyIds=b,m.drmInfos=S,e.h.newDrmInfo(m)),x=mS(e,h,v,g,t.M,t.type),I=x.segments,(C=x.bandwidth)&&(m.bandwidth=C),R=Lu(m),M=c(I),D=M.next();!D.done;D=M.next())L=D.value,L.$&&(L.$.Lc=R);m.segmentIndex.Id(I,e.j.nb()),I.length&&(P=db(h.g,"EXT-X-MEDIA-SEQUENCE",0),U=(O=cb(h.g,"EXT-X-SKIP"))?Number(rb(O,"SKIPPED-SEGMENTS")):0,F=aS(P,I),B=F.pb,V=F.qb,t.pb=B+U,t.qb=V,j=v.get(P),m.segmentIndex.Oa(j)),(G=m.segmentIndex.O[0]||null)&&(t.rc=G.startTime,H=I[I.length-1],t.Lb=H.endTime),cb(h.g,"EXT-X-ENDLIST")&&(t.xd=!0),uS(e,h),gS(e,h.g,m.type,g,t.M),w(N)}})}function Ab(e,t){for(var n=-1==e.H,i=c(t),r=i.next();!r.done;r=i.next()){r=r.value;var a=r.stream.segmentIndex,s=Eb(e,r);if(a=a.O[0]||null){s=c(s);for(var o=s.next();!o.done;o=s.next()){o=c(o.value);var l=o.next().value;if(o.next().value==a.startTime){n&&(e.H=Math.max(e.H,l)),r.mf=l;break}}}}if(!(0>e.H))for(t=c(t),r=t.next();!r.done;r=t.next())n=r.value,nS(e,n.type)&&(i=n.stream.segmentIndex)&&(r=e.H-n.mf,0<r&&(i.O.splice(0,r),i=i.O[0]||null)&&(i=-i.startTime,n.stream.segmentIndex.offset(i),Ib(e,n,i)))}function kb(e,t){if(1/0==e.fa){t=c(t);for(var n=t.next();!n.done;n=t.next()){var i=n.value.stream.segmentIndex.O[0]||null;null!=i&&null!=i.h&&(e.fa=Math.min(e.fa,i.h))}}if(t=e.fa,1/0!=t)for(i=c(e.i.values()),n=i.next();!n.done;n=i.next())if(n=n.value,!nS(e,n.type)){var r=n.stream.segmentIndex;if(null!=r){var a=r.O[0]||null;if(null==a.h)Q("Missing EXT-X-PROGRAM-DATE-TIME for stream",n.M(),"Expect AV sync issues!");else for(Ib(e,n,a.h-t-a.startTime),n=c(r),r=n.next();!r.done;r=n.next())r.value.jg(t)}}}function Ib(e,t,n){t.rc+=n,t.Lb+=n,e=Eb(e,t);for(var i=c(e),r=i.next();!r.done;r=i.next()){var a=c(r.value);r=a.next().value,a=a.next().value,e.set(r,a+n)}t.M()}function Cb(e,t,n){var i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,w,E,x,A,k,I,C,R,M,D,L,P,O,U;return N(function(N){switch(N.g){case 1:return i=Pn,r=mb(e.Fa,t),a=lb(r.g,"EXT-X-DEFINE"),s=[],o=[],l=[],e.j=new Ll(null,0),e.j.wc(!0),u=function(){return[n]},d=null,h=new Map,1==r.type?(e.R=!1,S=lb(r.g,"EXT-X-DEFINE"),h=Lb(e,S,e.L),d=i.ga,T="",w=new Map,_(N,rS(e,e.B++,h,r,u,"",d,T,!0,"Media Playlist",null,w,null,!1,null,!1),7)):(Db(e,a),f=lb(r.g,"EXT-X-MEDIA"),p=lb(r.g,"EXT-X-STREAM-INF"),g=lb(r.g,"EXT-X-IMAGE-STREAM-INF"),m=lb(r.g,"EXT-X-I-FRAME-STREAM-INF"),v=lb(r.g,"EXT-X-SESSION-KEY"),y=lb(r.g,"EXT-X-SESSION-DATA"),b=lb(r.g,"EXT-X-CONTENT-STEERING"),Ob(e,y),_(N,Nb(e,b),4));case 4:return Pb(e,p),qb(e,f),_(N,jb(e,p,v,f,u,e.s),5);case 5:return s=N.h,o=Ub(e,f),_(N,Bb(e,g,m),6);case 6:l=N.h,N.u(3);break;case 7:E=N.h,e.i.set(n,E),E.stream&&(x=Lu(E.stream),E.stream.segmentIndex.Jb(function(e){e.$&&(e.$.Lc=x)})),d=E.stream.type,s.push({id:0,language:hi(T||"und"),disabledUntilTime:0,primary:!0,audio:"audio"==d?E.stream:null,video:"video"==d?E.stream:null,bandwidth:E.stream.bandwidth||0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});case 3:if(!e.h)throw new It(2,7,7001);if(1==r.type&&(ES(e)&&(cS(e,r),A=e.o,e.A.Y(A)),k=Array.from(e.i.values()),tS(e,k),Mb(e),gS(e,r.g,d,h,u)),e.m={presentationTimeline:e.j,variants:s,textStreams:o,imageStreams:l,offlineSessionIds:[],minBufferTime:0,sequenceMode:e.g.hls.sequenceMode,ignoreManifestTimestampsInSegmentsMode:e.g.hls.ignoreManifestTimestampsInSegmentsMode,type:"HLS",serviceDescription:null,nextUrl:null,periodCount:1,gapCount:0,isLowLatency:!1},e.ea||!e.g.hls.disableCodecGuessing){N.u(8);break}for(I=[],C=c(e.m.variants),R=C.next();!R.done;R=C.next())M=R.value,M.audio&&""===M.audio.codecs&&I.push(M.audio.createSegmentIndex()),M.video&&""===M.video.codecs&&I.push(M.video.createSegmentIndex());return _(N,Promise.all(I),8);case 8:if(e.h.makeTextStreamsForClosedCaptions(e.m),1==s.length){for(D=[],L=s[0],P=c([L.video,L.audio]),O=P.next();!O.done;O=P.next())(U=O.value)&&!U.segmentIndex&&D.push(U.createSegmentIndex());if(0<D.length)return _(N,Promise.all(D),0)}N.u(0)}})}function Rb(e,t){var n,i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,w,E,x,A;return N(function(k){switch(k.g){case 1:if(n=Pu(e.g.hls.mediaPlaylistFullMimeType),!t.length)return k.return(n);if(i=bS(e,t),r=i.segment,a=i.segmentIndex,s=r.M(),o=s[0],l=new ht(o),u=l.Pa.split(".").pop(),d=CS[u])return k.return(Pu(d));if(h=Zr,p=f=null,g=r.$,!g){k.u(2);break}return m=Vu(g.M(),g.$b(),g.Xb(),e.g.retryParameters),_(k,AS(e,m,h,{type:0}),3);case 3:if(v=k.h,f=v.data,!g.aesKey){k.u(4);break}return _(k,Bu(f,g.aesKey,0),5);case 5:f=k.h;case 4:(p=v.headers["content-type"])&&(p=p.split(";")[0].toLowerCase());case 2:return y=Vu(r.M(),r.$b(),r.Xb(),e.g.retryParameters),_(k,AS(e,y,h,{type:1}),6);case 6:if(b=k.h,S=b.data,!r.aesKey){k.u(7);break}return _(k,Bu(S,r.aesKey,a),8);case 8:S=k.h;case 7:if((T=b.headers["content-type"])&&(T=T.split(";")[0].toLowerCase()),w="mp4 mp4a m4s m4i m4a m4f cmfa mp4v m4v cmfv fmp4".split(" "),E=["audio/mp4","video/mp4","video/iso.segment"],jo(Ee(S))){var I=S,C=Ee(I);C=(new No).parse(C);var R=C.sd();C=C.Hf();var M=[],D=!1,L=!1;switch(R.audio){case"aac":case"aac-loas":M.push("mp4a.40.2"),D=!0;break;case"mp3":M.push("mp4a.40.34"),D=!0;break;case"ac3":M.push("ac-3"),D=!0;break;case"ec3":M.push("ec-3"),D=!0;break;case"opus":M.push("opus"),D=!0}switch(R.video){case"avc":C.Na?M.push(C.Na):M.push("avc1.42E01E"),L=!0;break;case"hvc":C.Na?M.push(C.Na):M.push("hvc1.1.6.L93.90"),L=!0;break;case"av1":M.push("av01.0.01M.08"),L=!0}if(M.length){if(R=D&&!L,D=new Map,L){L=new Ce("video/mp2t"),L.i(I),I=c(L.j());for(var P=I.next();!P.done;P=I.next())P=P.value,D.set(P,P);L.g()}C={type:R?"audio":"video",mimeType:"video/mp2t",codecs:M.join(", "),language:null,height:C.height,width:C.width,channelCount:null,sampleRate:null,closedCaptions:D,Qd:null,colorGamut:null}}else C=null;if(x=C)return k.return(x)}else if((w.includes(u)||E.includes(T)||p&&E.includes(p))&&(A=Ou(f,S)))return k.return(A);return T?k.return(Pu(T)):p?k.return(Pu(p)):k.return(n)}})}function Mb(e){if(ES(e)){if(e.xa==OS){for(var t,n=t=1/0,i=c(e.i.values()),r=i.next();!r.done;r=i.next())r=r.value,r.stream.segmentIndex&&"text"!=r.stream.type&&(t=Math.min(t,r.Lb),n=Math.min(n,r.rc));t-=n,e.g.hls.useSafariBehaviorForLive&&(t=e.j.A),isNaN(e.g.availabilityWindowOverride)||(t=e.g.availabilityWindowOverride),e.j.Ie(t)}}else e.j.$a(Jb(e));if(!e.j.s)for(t=c(e.i.values()),n=t.next();!n.done;n=t.next())n=n.value,!n.stream.segmentIndex||"audio"!=n.type&&"video"!=n.type||(n=n.stream.segmentIndex.get(0))&&n.h&&e.j.lh(n.h);e.j.re()}function Db(e,t){var n=new ht(e.L).g;t=c(t);for(var i=t.next();!i.done;i=t.next()){var r=i.value;i=rb(r,"NAME");var a=rb(r,"VALUE");r=rb(r,"QUERYPARAM"),i&&a&&(e.s.has(i)||e.s.set(i,a)),r&&(i=n.get(r)[0])&&!e.s.has(i)&&e.s.set(r,i)}}function Lb(e,t,n){n=new ht(n).g;var i=new Map;t=c(t);for(var r=t.next();!r.done;r=t.next()){var a=r.value,s=rb(a,"NAME"),o=rb(a,"VALUE");r=rb(a,"QUERYPARAM"),a=rb(a,"IMPORT"),s&&o&&(i.has(s)||i.set(s,o)),r&&(s=n.get(r)[0])&&!i.has(s)&&i.set(r,s),a&&(r=e.s.get(a))&&i.set(a,r)}return i}function Pb(e,t){t=c(t);for(var n=t.next();!n.done;n=t.next()){var i=n.value,r=rb(i,"AUDIO");n=rb(i,"VIDEO");var a=rb(i,"SUBTITLES");if(i=Hb(e,i),a){var s=Mn(Ln,i);e.F.set(a,s),Ne(i,s)}r&&(a=Mn("audio",i),a||(a=e.g.hls.defaultAudioCodec),e.F.set(r,a)),n&&(r=Mn("video",i),r||(r=e.g.hls.defaultVideoCodec),e.F.set(n,r))}}function Ob(e,t){t=c(t);for(var n=t.next();!n.done;n=t.next()){var i=n.value,r=rb(i,"DATA-ID");n=rb(i,"URI");var a=rb(i,"LANGUAGE");i=rb(i,"VALUE"),r=(new Map).set("id",r),n&&r.set("uri",hb([e.L],n,e.s)[0]),a&&r.set("language",a),i&&r.set("value",i),n=new Nr("sessiondata",r),e.h&&e.h.onEvent(n)}}function Nb(e,t){var n,i,r,a,s,o;return N(function(l){if(!e.h||!e.g)return l.return();for(i=c(t),r=i.next();!r.done;r=i.next())if(a=r.value,s=rb(a,"PATHWAY-ID"),o=rb(a,"SERVER-URI"),s&&o){e.l=new Rv(e.h),e.l.configure(e.g),e.l.i=[e.L],e.l.setManifestType("HLS"),e.l.h=s,n=Mv(e.l,o);break}return _(l,n,0)})}function Ub(e,t){var n=ub(t,"SUBTITLES");t=n.map(function(t){if(e.g.disableText)return null;try{return Yb(e,[t],new Map).stream}catch(t){if(e.g.hls.ignoreTextStreamFailures)return null;throw t}}),n=c(n);for(var i=n.next();!i.done;i=n.next()){var r=ab(i.value,"GROUP-ID");if((i=e.F.get(r))&&(r=e.G.get(r))){r=c(r);for(var a=r.next();!a.done;a=r.next())a=a.value,a.stream.codecs=i,a.stream.mimeType=vS(Ln,i)||yS(Ln),Fb(a.stream)}}return t.filter(function(e){return e})}function Fb(e){var t=new Set([Fn(e.mimeType,e.codecs)]);e.segmentIndex&&e.segmentIndex.Jb(function(n){n.mimeType&&t.add(Fn(n.mimeType,e.codecs))}),e.fullMimeTypes=t}function Bb(e,t,n){var i,r;return N(function(a){return 1==a.g?(i=t.map(function(t){var n,i;return N(function(r){if(1==r.g)return e.g.disableThumbnails?r.return(null):(E(r,2),_(r,Xb(e,t),4));if(2!=r.g)return n=r.h,r.return(n.stream);if(i=k(r),e.g.hls.ignoreImageStreamFailures)return r.return(null);throw i})}).concat(n.map(function(t){if(e.g.disableThumbnails)return null;try{var n=ab(t,"URI"),i=rb(t,"CODECS")||"";if(e.i.has(n))var r=e.i.get(n);else{var a=rb(t,"LANGUAGE"),s=rb(t,"NAME"),o=rb(t,"CHARACTERISTICS"),l=Zb(e,e.B++,[n],i,"image",a,!1,s,null,null,o,!1,null,!1),u=rb(t,"RESOLUTION"),d=c(u?u.split("x"):[null,null]),h=d.next().value,f=d.next().value;l.stream.width=Number(h)||void 0,l.stream.height=Number(f)||void 0;var p=rb(t,"BANDWIDTH");p&&(l.stream.bandwidth=Number(p)),e.i.set(n,l),r=l}return t=r,"mjpg"!==t.stream.codecs?null:t.stream}catch(t){if(e.g.hls.ignoreImageStreamFailures)return null;throw t}})),_(a,Promise.all(i),2)):(r=a.h,a.return(r.filter(function(e){return e})))})}function Vb(e,t,n){t=t.filter(function(e){var t=rb(e,"URI")||"";return"SUBTITLES"!=rb(e,"TYPE")&&""!=t});var i={};t=c(t);for(var r=t.next();!r.done;r=t.next()){r=r.value;var a=nb(r);i[a]?i[a].push(r):i[a]=[r]}for(var s in i)Yb(e,i[s],n)}function jb(e,t,n,i,r,a){var s,o,l,u,h,f,p,g,m,v,y,b,S,T,w,E,x,A,k,I,C,R,M,D,L,P,O,U,F,B,V,j,G,H,z;return N(function(N){switch(N.g){case 1:if(s=[],o=new Set,!(0<n.length)){N.u(2);break}l=c(n),u=l.next();case 3:if(u.done){N.u(2);break}if(h=u.value,f=ab(h,"METHOD"),p=rb(h,"KEYFORMAT")||"identity",g=null,"NONE"==f){N.u(4);break}if(kS(f)){m=hb(r(),ab(h,"URI"),a),v=m.sort().join(""),e.K.has(v)||(y=Kr(m,e.g.retryParameters),b=AS(e,y,6),e.K.set(v,b)),N.u(4);break}if("identity"!=p){g=(S=DS[p])?S(h,""):null,N.u(6);break}return _(N,IS(e,h,"",r,null,a),9);case 9:g=N.h;case 6:if(g){if(g.keyIds)for(T=c(g.keyIds),w=T.next();!w.done;w=T.next())E=w.value,o.add(E);s.push(g)}case 4:u=l.next(),N.u(3);break;case 2:for(x={},A=c(t),k=A.next();!k.done;k=A.next())I=k.value,C=nb(I),x[C]?x[C].push(I):x[C]=[I];for(M in R=[],x)D=x[M],L=D[0],P=rb(L,"FRAME-RATE"),O=Number(rb(L,"AVERAGE-BANDWIDTH"))||Number(ab(L,"BANDWIDTH")),U=rb(L,"RESOLUTION"),F=c(U?U.split("x"):[null,null]),B=F.next().value,V=F.next().value,j=rb(L,"VIDEO-RANGE"),(G=rb(L,"REQ-VIDEO-LAYOUT"))&&G.includes(",")&&(H=G.split(",").filter(function(e){return"CH-STEREO"==e||"CH-MONO"==e}),G=H[0]),G=G||"CH-MONO",z=Gb(e,D,i),R.push.apply(R,d(Wb(e,z.audio,z.video,O,B,V,P,j,G,s,o)));return N.return(R.filter(function(e){return null!=e}))}})}function Gb(e,t,n){for(var i={audio:[],video:[]},r=new Map,a=[],s=!1,o=!1,l=c(t),u=l.next();!u.done;u=l.next()){var h=u.value;u=rb(h,"AUDIO");var f=rb(h,"VIDEO"),p=u||f;p&&(a.includes(p)||a.push(p),(h=rb(h,"PATHWAY-ID"))&&r.set(p,h),u?s=!0:f&&(o=!0))}a.length&&n.length&&(l=n.filter(function(e){return a.includes(ab(e,"GROUP-ID"))}),Vb(e,l,r)),l=(r=a.sort().join(","))&&e.G.has(r)?e.G.get(r):[],s?i.audio.push.apply(i.audio,d(l)):o&&i.video.push.apply(i.video,d(l)),u=!1;var g=t.map(function(e){return ab(e,"URI")});if(o=i.audio.find(function(e){return e&&e.M().find(function(e){return g.includes(e)})}),s=Hb(e,t[0]),f=Mn("video",s),(p=Mn("audio",s))&&!f?(o="audio",u=0<i.audio.length):!i.audio.length&&!i.video.length&&p&&f?(o="video",s=[[f,p].join()]):i.audio.length&&o?(o="audio",u=!0):o=i.video.length&&!i.audio.length?"audio":"video",!u){var m=h=p=f=u=null;!l.length&&(n=n.find(function(e){var t=rb(e,"URI")||"",n=rb(e,"TYPE");return e=ab(e,"GROUP-ID"),"SUBTITLES"!=n&&""==t&&a.includes(e)}))&&(u=rb(n,"LANGUAGE"),f=rb(n,"NAME"),p=zb(n),$b(n),h=rb(n,"CHARACTERISTICS"),m=Kb(n)),e=Qb(e,t,s,o,u,f,p,h,m),r&&(e.stream.groupId=r),i[e.stream.type]=[e]}return i}function Hb(e,t){var n=rb(t,"CODECS")||"";return t=rb(t,"SUPPLEMENTAL-CODECS"),e.ea=0<n.length,e.ea||e.g.hls.disableCodecGuessing||(n=[],e.g.disableVideo||n.push(e.g.hls.defaultVideoCodec),e.g.disableAudio||n.push(e.g.hls.defaultAudioCodec),n=n.join(",")),e=n.split(/\s*,\s*/),t&&(t=t.split(/\s*,\s*/).map(function(e){return e.split("/")[0]}),e.push.apply(e,d(t))),Nu(e)}function zb(e){return(e=rb(e,"CHANNELS"))?parseInt(e.split("/")[0],10):null}function Kb(e){return(e=rb(e,"SAMPLE-RATE"))?parseInt(e,10):null}function $b(e){return!!(e=rb(e,"CHANNELS"))&&e.includes("/JOC")}function Wb(e,t,n,i,r,a,s,o,l,u,d){for(var h=c(n),f=h.next();!f.done;f=h.next())TS(f.value.stream,r,a,s,o,l,null);for(r=e.g.disableAudio,t.length&&!r||(t=[null]),r=e.g.disableVideo,n.length&&!r||(n=[null]),r=[],t=c(t),a=t.next();!a.done;a=t.next())for(a=a.value,s=c(n),o=s.next();!o.done;o=s.next()){var p=o.value;(o=a?a.stream:null)&&(o.drmInfos=u,o.keyIds=d),(l=p?p.stream:null)&&(l.drmInfos=u,l.keyIds=d),l&&!o&&(l.bandwidth=i),!l&&o&&(o.bandwidth=i),h=a?a.stream.drmInfos:null,f=p?p.stream.drmInfos:null,p=p?p.M().sort().join(","):"";var g=a?a.M().sort().join(","):"";p=p+" - "+g,o&&l&&!Mt(h,f)||e.wb.has(p)||(o={id:e.B++,language:o?o.language:"und",disabledUntilTime:0,primary:!!o&&o.primary||!!l&&l.primary,audio:o,video:l,bandwidth:i,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},r.push(o),e.wb.add(p))}return r}function qb(e,t){t=ub(t,"CLOSED-CAPTIONS"),e.R=0==t.length,t=c(t);for(var n=t.next();!n.done;n=t.next()){var i=n.value,r=rb(i,"LANGUAGE");n=hi(r||"und"),r||(r=rb(i,"NAME"))&&(n=r),r=ab(i,"GROUP-ID"),i=ab(i,"INSTREAM-ID").replace("SERVICE","svc"),e.C.get(r)||e.C.set(r,new Map),e.C.get(r).set(i,n)}}function Yb(e,t,n){for(var i=[],r=[],a=new Map,s=c(t),o=s.next();!o.done;o=s.next()){var l=o.value;o=ab(l,"URI"),l=ab(l,"GROUP-ID"),i.push(o),r.push(l),a.set(l,o)}if(s=r.sort().join(","),o=t[0],t="",l=ab(o,"TYPE").toLowerCase(),"subtitles"==l&&(l=Ln),l==Ln)t=rb(o,"CODECS")||"";else{r=c(r);for(var u=r.next();!u.done;u=r.next())if(u=u.value,e.F.has(u)){t=e.F.get(u);break}}if(r=i.sort().join(","),e.i.has(r))return e.i.get(r);if(u=e.B++,e.l){a=c(a);for(var d=a.next();!d.done;d=a.next()){var h=c(d.value);d=h.next().value,h=h.next().value,(d=n.get(d))&&Pv(e.l,u,d,h)}}n=rb(o,"LANGUAGE"),a=rb(o,"NAME"),d="YES"==rb(o,"DEFAULT"),h="audio"==l?zb(o):null;var f="audio"==l&&$b(o),p=rb(o,"CHARACTERISTICS"),g="YES"==rb(o,"FORCED");return o="audio"==l?Kb(o):null,i=Zb(e,u,i,t,l,n,d,a,h,null,p,g,o,f),i.stream&&(i.stream.groupId=s),e.G.has(s)?e.G.get(s).push(i):e.G.set(s,[i]),e.i.set(r,i),i}function Xb(e,t){var n,i,r,a,s,o,l,u,c,d;return N(function(h){return 1==h.g?(n=ab(t,"URI"),i=rb(t,"CODECS","jpeg")||"",e.i.has(n)?h.return(e.i.get(n)):(r=rb(t,"LANGUAGE"),a=rb(t,"NAME"),s=rb(t,"CHARACTERISTICS"),o=Zb(e,e.B++,[n],i,"image",r,!1,a,null,null,s,!1,null,!1),(l=rb(t,"RESOLUTION"))?_(h,o.stream.createSegmentIndex(),3):h.u(2))):(2!=h.g&&(u=o.stream.segmentIndex.get(0),c=u.tilesLayout)&&(o.stream.width=Number(l.split("x")[0])*Number(c.split("x")[0]),o.stream.height=Number(l.split("x")[1])*Number(c.split("x")[1])),(d=rb(t,"BANDWIDTH"))&&(o.stream.bandwidth=Number(d)),e.i.set(n,o),h.return(o))})}function Qb(e,t,n,i,r,a,s,o,l){for(var u=e.B++,d=[],h=c(t),f=h.next();!f.done;f=h.next()){var p=f.value;f=ab(p,"URI"),p=rb(p,"PATHWAY-ID"),e.l&&p&&Pv(e.l,u,p,f),d.push(f)}if(h=d.sort().join(","),e.i.has(h))return e.i.get(h);e:{if(t=rb(t[0],"CLOSED-CAPTIONS"),"video"==i){if(e.g.disableText){e.R=!1,t=null;break e}if(t){if("NONE"!=t){t=e.C.get(t);break e}e.R=!1}else if(!t&&e.C.size)for(t=c(e.C.keys()).next();!t.done;){t=e.C.get(t.value);break e}}t=null}return n=Rn(i,n),i=Zb(e,u,d,n,i,r,!1,a,s,t,o,!1,l,!1),e.i.set(h,i),i}function Zb(e,t,n,i,r,a,s,o,l,u,d,h,f,p){function g(t){var n,g,S,T,x,I,C,R,M,D,L,P,O,U,F,B,V,j,G,H,z,K;return N(function(N){switch(N.g){case 1:return n=Pn,g=b.M(),E(N,2),_(N,_S(e,b.M(),!0),4);case 4:S=N.h,A(N,3);break;case 2:if(T=k(N),v.closeSegmentIndex(),e.h.disableStream(v))return N.return();throw T;case 3:if(t.aborted)return N.return();if(x=S.uri,x==S.originalUri||g.includes(x)||y.push(x),I=mb(e.Fa,S.data),1!=I.type)throw new It(2,4,4017);return C=lb(I.g,"EXT-X-DEFINE"),R=Lb(e,C,x),M=!1,(!e.ea&&e.g.hls.disableCodecGuessing||e.R&&r==n.ga&&!e.g.hls.disableClosedCaptionsDetection)&&0<I.segments.length&&(e.R=!1,M=!0),D=!e.ea&&e.g.hls.disableCodecGuessing,L=ES(e),_(N,rS(e,0,R,I,m,i,r,a,s,o,l,u,d,h,f,p,void 0,M,D),5);case 5:if(P=N.h,t.aborted)return N.return();if(O=P.stream,ES(e)&&!L&&cS(e,I),b.rc=P.rc,b.Lb=P.Lb,b.de=P.de,b.ce=P.ce,b.xd=P.xd,b.te=P.te,b.pb=P.pb,b.qb=P.qb,b.Nf=!0,v.segmentIndex=O.segmentIndex,v.encrypted=O.encrypted,v.drmInfos=O.drmInfos,v.keyIds=O.keyIds,v.mimeType=O.mimeType,v.bandwidth=v.bandwidth||O.bandwidth,v.codecs=v.codecs||O.codecs,v.closedCaptions=v.closedCaptions||O.closedCaptions,v.width=v.width||O.width,v.height=v.height||O.height,v.hdr=v.hdr||O.hdr,v.colorGamut=v.colorGamut||O.colorGamut,"und"==v.language&&"und"!=O.language&&(v.language=O.language),v.language=v.language||O.language,v.channelsCount=v.channelsCount||O.channelsCount,v.audioSamplingRate=v.audioSamplingRate||O.audioSamplingRate,Fb(v),v.drmInfos.length&&e.h.newDrmInfo(v),U=!1,(!u&&v.closedCaptions||u&&v.closedCaptions&&u.size!=v.closedCaptions.size)&&(U=!0),e.m&&U&&e.h.makeTextStreamsForClosedCaptions(e.m),r==n.ga||r==n.X)for(F=c(e.i.values()),B=F.next();!B.done;B=F.next())V=B.value,V.Nf||V.type!=r||(V.stream.mimeType=O.mimeType,Fb(V.stream));r==n.ta&&(j=O.segmentIndex.get(0))&&j.$&&(v.mimeType="application/mp4",Fb(v)),G=Lu(v),v.segmentIndex.Jb(function(e){e.$&&(e.$.Lc=G)}),iS(e)&&(e.Ib?tS(e,[b]):(e.Ib=!0,H=Array.from(e.i.values()),z=H.filter(function(e){return e.stream.segmentIndex}),tS(e,z),Mb(e),K=e.o,0<K&&e.A.Y(K))),gS(e,I.g,v.type,R,m),w(N)}})}function m(){return e.l&&1<n.length?Ov(e.l,t):y.concat(fb([e.L],n,e.s))}var v=sS(e,i,r,a,s,o,l,u,d,h,f,p),y=[],b={stream:v,type:r,dh:y,M:m,rc:0,Lb:0,te:new Map,de:!1,ce:!1,xd:!1,mf:-1,pb:-1,qb:-1,Nf:!1},S=null,T=new AbortController;return v.createSegmentIndex=function(){return S||(T=new AbortController,S=new Promise(function(e){e(g(T.signal))}))},v.closeSegmentIndex=function(){S&&!v.segmentIndex&&T.abort(),v.segmentIndex&&(v.segmentIndex.release(),v.segmentIndex=null),S=null},b}function Jb(e){var t=1/0;e=c(e.i.values());for(var n=e.next();!n.done;n=e.next())n=n.value,n.stream.segmentIndex&&"text"!=n.stream.type&&(t=Math.min(t,n.Lb));return t}function eS(e,t){var n=[];t=c(t);for(var i=t.next();!i.done;i=t.next())i=i.value,i.segmentIndex&&i.segmentIndex.Jb(function(e){n.push(e)});e.j.Jd(n)}function tS(e,t){if(!ES(e))for(var n=Jb(e),i=c(t),r=i.next();!r.done;r=i.next())r.value.stream.segmentIndex.Ec(0,n);eS(e,t.map(function(e){return e.stream})),e.g.hls.ignoreManifestProgramDateTime?Ab(e,t):(kb(e,t),0<e.g.hls.ignoreManifestProgramDateTimeForTypes.length&&Ab(e,t))}function nS(e,t){return!!e.g.hls.ignoreManifestProgramDateTime||e.g.hls.ignoreManifestProgramDateTimeForTypes.includes(t)}function iS(e){if(!e.m)return!1;var t=[],n=[];e=c(e.m.variants);for(var i=e.next();!i.done;i=e.next())i=i.value,i.video&&t.push(i.video),i.audio&&n.push(i.audio);return!(0<t.length&&!t.some(function(e){return e.segmentIndex})||0<n.length&&!n.some(function(e){return e.segmentIndex}))}function rS(e,t,n,i,r,a,s,o,l,u,c,d,h,f,p,g,m,v,y){var b,S,T,w,E,x,A,k,I,C,R,M,D,L,P,O,U,F,B,V,j,G,H,z,K,$;return v=void 0===v||v,y=void 0===y||y,N(function(t){switch(t.g){case 1:var N=cb(i.g,"EXT-X-PLAYLIST-TYPE"),W=cb(i.g,"EXT-X-ENDLIST");if(W=N&&"VOD"==N.value||W,N=N&&"EVENT"==N.value&&!W,N=!W&&!N,xS(e,W?LS:N?OS:PS),ES(e)&&uS(e,i),b=ES(e)?e.N.get(s):new Map,S=mS(e,i,b,n,r,s),T=S.segments,w=S.bandwidth,k=A=x=E=null,!(0<T.length&&v)){t.u(2);break}return _(t,Rb(e,T),3);case 3:I=t.h,s=I.type,o=I.language,c=I.channelCount,p=I.sampleRate,e.g.disableText||(d=I.closedCaptions),x=I.height,E=I.width,A=I.Qd,k=I.colorGamut,y&&(m=I.mimeType,a=I.codecs);case 2:if(m){t.u(4);break}return _(t,SS(e,s,a,T),5);case 5:m=t.h;case 4:return _(t,oS(e,i,m,r,n),6);case 6:if(C=t.h,R=C.drmInfos,M=C.keyIds,D=C.encrypted,L=C.Dh,D&&!R.length&&!L)throw new It(2,4,4026);return P=sS(e,a,s,o,l,u,c,d,h,f,p,g),P.encrypted=D,P.drmInfos=R,P.keyIds=M,P.mimeType=m,w&&(P.bandwidth=w),Fb(P),"video"==s&&(E||x||A||k)&&TS(P,E,x,null,A,null,k),ES(e)&&uS(e,i),O=T[0].startTime,U=T[T.length-1],F=U.endTime,B=new tu(T),P.segmentIndex=B,j=!!(V=cb(i.g,"EXT-X-SERVER-CONTROL"))&&null!=ib(V,"CAN-SKIP-UNTIL"),G=!!V&&null!=ib(V,"CAN-BLOCK-RELOAD"),H=db(i.g,"EXT-X-MEDIA-SEQUENCE",0),z=aS(H,T),K=z.pb,$=z.qb,t.return({stream:P,type:s,dh:[],M:r,rc:O,Lb:F,de:j,ce:G,xd:!1,mf:-1,pb:K,qb:$,te:b,Nf:!1})}})}function aS(e,t){e=e+t.length-1;var n=-1;if(!t.length)return e++,{pb:e,qb:n};t=t[t.length-1];var i=t.g;return t.g.length?(n=i.length-1,i[i.length-1].preload||(e++,n=0),{pb:e,qb:n}):(e++,t.m&&(n=0),{pb:e,qb:n})}function sS(e,t,n,i,r,a,s,o,l,u,d,h){var f=vS(n,t)||yS(n),p=[];if(l){l=c(l.split(","));for(var g=l.next();!g.done;g=l.next())p.push(g.value)}return l=void 0,g=null,n==Ln?l=p.includes("public.accessibility.transcribes-spoken-dialog")&&p.includes("public.accessibility.describes-music-and-sound")?"caption":"subtitle":p.includes("public.accessibility.describes-video")&&(g="visually impaired"),p.length||"subtitle"!==l||p.push("subtitle"),e={id:e.B++,originalId:a,groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:f,codecs:t,kind:n==Ln?"subtitle":void 0,encrypted:!1,drmInfos:[],keyIds:new Set,language:hi(i||"und"),originalLanguage:i,label:a,type:n,primary:r,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:p,forced:u,channelsCount:s,audioSamplingRate:d,spatialAudio:h,closedCaptions:o,hdr:void 0,colorGamut:void 0,videoLayout:void 0,tilesLayout:void 0,accessibilityPurpose:g,external:!1,fastSwitching:!1,fullMimeTypes:new Set},Fb(e),e}function oS(e,t,n,i,r){var a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,w,E,x,A,k,I,C,R,M,D,L,P;return N(function(O){switch(O.g){case 1:if(a=new Map,t.segments)for(s=c(t.segments),o=s.next();!o.done;o=s.next())if(l=o.value,u=lb(l.g,"EXT-X-KEY"),d=null,u.length)for(d=dS(e,t,l.g,i,r),h=c(u),f=h.next();!f.done;f=h.next())p=f.value,a.set(p,d);m=g=!1,v=[],y=new Set,b=c(a),S=b.next();case 2:if(S.done){O.u(4);break}if(T=S.value,w=c(T),E=w.next().value,x=w.next().value,A=E,k=x,I=ab(A,"METHOD"),"NONE"==I){O.u(3);break}if(g=!0,C=rb(A,"KEYFORMAT")||"identity",R=null,kS(I)){m=!0,O.u(3);break}if("identity"!=C){R=(M=DS[C])?M(A,n):null,O.u(6);break}return _(O,IS(e,A,n,i,k,r),8);case 8:R=O.h;case 6:if(R){if(R.keyIds)for(D=c(R.keyIds),L=D.next();!L.done;L=D.next())P=L.value,y.add(P);v.push(R)}case 3:S=b.next(),O.u(2);break;case 4:return O.return({drmInfos:v,keyIds:y,encrypted:g,Dh:m})}})}function lS(t,n,i,r,a){if(!e.crypto||!e.crypto.subtle)throw Z("Web Crypto API is not available to decrypt AES. (Web Crypto only exists in secure origins like https)"),new It(2,4,4042);var s=0,o=rb(n,"IV","");if(o){var l=En(o.substr(2));if(16!=l.byteLength)throw new It(2,4,4048)}else s=db(i.g,"EXT-X-MEDIA-SEQUENCE",0);if(i=n.toString()+"-"+s,!t.pa.has(i)){var u={bitsKey:128,blockCipherMode:"CBC",iv:l,firstMediaSequenceNumber:s};switch(ab(n,"METHOD")){case"AES-256":u.bitsKey=256;break;case"AES-256-CTR":u.bitsKey=256,u.blockCipherMode="CTR"}u.fetchKey=function(){var i,s,o,l,c,d,h;return N(function(f){if(1==f.g)return i=hb(r(),ab(n,"URI"),a),s=i.sort().join(""),t.K.has(s)||(o=Kr(i,t.g.retryParameters),l=AS(t,o,6),t.K.set(s,l)),_(f,t.K.get(s),2);if(3!=f.g){if(c=f.h,!c.data||c.data.byteLength!=u.bitsKey/8)throw new It(2,4,4049);return d={name:"CTR"==u.blockCipherMode?"AES-CTR":"AES-CBC",length:u.bitsKey},h=u,_(f,e.crypto.subtle.importKey("raw",c.data,d,!0,["decrypt"]),3)}h.cryptoKey=f.h,u.fetchKey=void 0,w(f)})},t.pa.set(i,u)}return t.pa.get(i)}function uS(e,t){var n=1/0,i=t.segments;if(i.length)for(var r=i.length-1;0<=r;){var a=cb(i[r].g,"EXTINF");if(a){n=Number(a.value.split(",")[0]);break}r--}if(i=cb(t.g,"EXT-X-TARGETDURATION"),!i)throw new It(2,4,4024,"EXT-X-TARGETDURATION");i=Number(i.value),(r=cb(t.g,"EXT-X-PART-INF"))&&(e.U=Number(ab(r,"PART-TARGET"))),t=cb(t.g,"EXT-X-SERVER-CONTROL"),e.I&&e.U?(e.o=e.Hb?5*e.U<=n?Math.min(e.U,e.o):Math.min(n,e.o):Math.min(e.U,e.o),e.Da=t?Number(ab(t,"PART-HOLD-BACK")):0):(e.o=Math.min(n,e.o),n=t?ib(t,"HOLD-BACK"):null,e.za=n?Number(n.value):0),e.bb=Math.max(i,e.bb)}function cS(e,t){if(e.g.defaultPresentationDelay)t=e.g.defaultPresentationDelay;else if(e.Da)t=e.Da;else if(e.za)t=e.za;else{t=t.segments.length;var n=e.g.hls.liveSegmentsDelay;n>t-2&&(n=Math.max(1,t-2)),t=e.bb*n}e.j.mh(0),e.j.eg(t),e.j.wc(!1)}function dS(e,t,n,i,r){var a=cb(n,"EXT-X-MAP");if(!a)return null;var s=ab(a,"URI"),o=hb(i(),s,r);if(s=[o.toString(),rb(a,"BYTERANGE","")].join("-"),!e.ra.has(s)){var l=void 0,u=null;n=c(n);for(var d=n.next();!d.done;d=n.next())d=d.value,"EXT-X-KEY"==d.name?kS(ab(d,"METHOD"))&&d.id<a.id&&(l=lS(e,d,t,i,r)):"EXT-X-BYTERANGE"==d.name&&d.id<a.id&&(u=d);t=hS(o,a,u,l),e.ra.set(s,t)}return e.ra.get(s)}function hS(e,t,n,i){var r=0,a=null;return t=rb(t,"BYTERANGE"),!t&&n&&(t=n.value),t&&(r=t.split("@"),a=Number(r[0]),r=Number(r[1]),a=r+a-1,i&&(n=a+1-r,n%16&&(a+=16-n%16))),new Ys(function(){return e},r,a,null,null,null,i)}function fS(t,n,i,r,a,s,o,l,u){function d(e){e=new ht(e).Pa.split(".").pop();var t=RS[o][e];return t||(t=CS[e]),t}var h=r.g,f=cb(h,"EXTINF"),p=0,g=0,m=null;r.Bb.length&&(t.m.isLowLatency=!0);var v=null;if(!t.g.hls.ignoreManifestProgramDateTime){var y=cb(h,"EXT-X-PROGRAM-DATE-TIME");y&&y.value&&(v=Ba(y.value))}var b=Js;if(cb(h,"EXT-X-GAP")&&(t.m.gapCount++,b=2),!f){if(0==r.Bb.length)throw new It(2,4,4024,"EXTINF");if(!t.I)return null}var S=[];y=!1;var T=null,_=!1,w=!1;if(t.I&&r.Bb.length){p=n&&e.ReadableStream&&t.g.hls.allowLowLatencyByteRangeOptimization;for(var E=v,x={},A=0;A<r.Bb.length;x={gd:x.gd,bd:x.bd},A++){var k=r.Bb[A],I=0==A?i:S[S.length-1],C=0==A?a:I.endTime,R=Number(rb(k,"DURATION"))||t.U;if(R){var M=C+R,D=0,L=null;if("EXT-X-PRELOAD-HINT"==k.name?(D=(D=rb(k,"BYTERANGE-START"))?Number(D):0,(I=rb(k,"BYTERANGE-LENGTH"))?L=D+Number(I)-1:D&&(L=Number.MAX_SAFE_INTEGER)):(D=rb(k,"BYTERANGE"),L=c(pS(I,D)),D=L.next().value,L=L.next().value),x.bd=rb(k,"URI"),x.bd){I=Js,"YES"==rb(k,"GAP")&&(t.m.gapCount++,I=2,_=!0),x.gd=null;var P=function(e){return function(){return null==e.gd&&(e.gd=hb(l(),e.bd,s)),e.gd}}(x);p&&0<=D&&null!=L&&(T=P,y=!0),C=new Qs(C,M,P,D,L,n,0,0,1/0,[],"",null,E,I,u),"EXT-X-PRELOAD-HINT"==k.name&&(C.Of(),w=!0),"YES"!=rb(k,"INDEPENDENT")&&0<A&&C.se(),(k=d(x.bd))&&(C.mimeType=k,MS.has(k)&&(C.$=null)),S.push(C),E&&(E+=R)}}}}if(f){if(f=Number(f.value.split(",")[0]),0==f)return null;p=a+f}else{if(!S.length)return null;p=S[S.length-1].endTime}y&&(_||0!=S[0].Ha?(y=!1,T=null):S=[]),(f=cb(h,"EXT-X-BYTERANGE"))?(m=c(pS(i,f.value)),g=m.next().value,m=m.next().value):S.length&&(g=S[0].Ha,m=S[S.length-1].sa),i="",f=null,"image"==o&&(i="1x1",h=cb(h,"EXT-X-TILES"))&&(i=ab(h,"LAYOUT"),(h=rb(h,"DURATION"))&&(f=Number(h)));var O=null;return n=new Qs(a,p,function(){return T?T():(null==O&&(O=hb(l(),r.h,s)),O||[])},g,m,n,0,0,1/0,S,i,f,v,b,u,0<S.length&&!!r.h),(a=d(r.h))&&(n.mimeType=a,MS.has(a)&&(n.$=null)),y&&(t.Hb=!0,n.Vg(),w&&n.Of()),n}function pS(e,t){var n=0,i=null;return t&&(n=t.split("@"),t=Number(n[0]),n=n[1]?Number(n[1]):e.sa+1,i=n+t-1),[n,i]}function gS(e,t,n,i,r){if("video"==n||"audio"==n){var a=e.j.m;if(a&&!nS(e,n))for(t=lb(t,"EXT-X-DATERANGE"),t=t.sort(function(e,t){return e=ab(e,"START-DATE"),t=ab(t,"START-DATE"),e<t?-1:e>t?1:0}),n=0;n<t.length;n++){var s=t[n],o=ab(s,"ID");if(!e.Ea.has(o)){var l=ab(s,"START-DATE"),u=Ba(l);if(!isNaN(u)){l=Math.max(0,u-a);var d=null,h=rb(s,"END-DATE");if(h&&(h=Ba(h),!isNaN(h)&&(d=h-a,0>d)))continue;if(null==d&&(h=rb(s,"DURATION")||rb(s,"PLANNED-DURATION"))&&(h=parseFloat(h),isNaN(h)||(d=l+h),0>u-a+h))continue;h=rb(s,"CLASS")||"com.apple.quicktime.HLS";var f="YES"==rb(s,"END-ON-NEXT");if(null==d&&f){for(f=n+1;f<t.length;f++){var p=rb(t[f],"CLASS")||"com.apple.quicktime.HLS";if(h==p&&(p=ab(t[f],"START-DATE"),p=Ba(p),!isNaN(p)&&p&&p>u)){d=Math.max(0,p-a);break}}if(null==d)continue}for(u="ID CLASS START-DATE END-DATE DURATION END-ON-NEXT".split(" "),f=[],s=c(s.attributes),p=s.next();!p.done;p=s.next())if(p=p.value,!u.includes(p.name)){var g=pb(p.value,i);"X-ASSET-URI"!=p.name&&"X-ASSET-LIST"!=p.name||(g=hb(r(),p.value,i)[0]),f.push({key:p.name,description:"",data:g,mimeType:null,pictureType:null})}f.length&&e.h.onMetadata(h,l,d,f),e.Ea.add(o)}}}}}function mS(e,t,n,i,r,a){var s=t.segments,o=void 0,l=db(t.g,"EXT-X-DISCONTINUITY-SEQUENCE",0),u=db(t.g,"EXT-X-MEDIA-SEQUENCE",0),d=cb(t.g,"EXT-X-SKIP"),h=d?Number(rb(d,"SKIPPED-SEGMENTS")):0,f=u+h,p=0;ES(e)&&n.has(f)&&(p=n.get(f)),0===p&&e.xa==OS&&0<n.size&&!n.has(f)&&(p=e.j.nb());var g=[],m=null;d=[];for(var v=0;v<s.length;v++){var y=s[v],b=0==v?p:m.endTime;f=u+h+v,cb(y.g,"EXT-X-DISCONTINUITY")&&l++;for(var S=c(y.g),T=S.next();!T.done;T=S.next())T=T.value,"EXT-X-KEY"==T.name&&(o=kS(ab(T,"METHOD"))?lS(e,T,t,r,i):void 0);n.set(f,b),S=dS(e,t,y.g,r,i),!e.I&&e.h.isAutoLowLatencyMode()&&(e.h.enableLowLatencyMode(),e.I=e.h.isLowLatencyMode()),(b=fS(e,S,m,y,b,i,a,r,o))&&((m=db(y.g,"EXT-X-BITRATE"))?d.push({bitrate:m,duration:b.endTime-b.startTime}):d.length&&(m=d.pop(),m.duration+=b.endTime-b.startTime,d.push(m)),m=b,b.i=l,nS(e,a)&&null!=e.H&&f<e.H||g.push(b))}if(t=void 0,d.length&&(t=d.reduce(function(e,t){return e+t.duration},0),t=Math.round(d.reduce(function(e,t){return e+t.bitrate*t.duration},0)/t*1e3)),d=g.some(function(e){return null!=e.h}))for(n={},i=0;i<g.length;n={Zc:n.Zc,Yc:n.Yc,Rd:n.Rd,Sb:n.Sb,Vc:n.Vc},i++)if(n.Sb=g[i],null==n.Sb.h)for(n.Yc=0,n.Zc=i,r=function(e){return function(){var t=g[e.Zc];if(t){if(null!=t.h)return t.h+e.Yc;e.Yc-=t.endTime-t.startTime,e.Zc+=1}return null}}(n),n.Vc=0,n.Rd=i,s=function(e){return function(){var t=g[e.Rd];if(t){if(t!=e.Sb&&(e.Vc+=t.endTime-t.startTime),null!=t.h)return t.h+e.Vc;--e.Rd}return null}}(n);null==n.Sb.h;)n.Sb.h=s(),null==n.Sb.h&&(n.Sb.h=r());if(d)for(n=c(g),i=n.next();!i.done;i=n.next())for(r=i.value,i=r.h,r=c(r.g),s=r.next();!s.done;s=r.next())s=s.value,s.h=i,i+=s.endTime-s.startTime;if(n=e.fa,d&&1/0!=n&&!nS(e,a))for(e=c(g),i=e.next();!i.done;i=e.next())i.value.jg(n);return{segments:g,bandwidth:t}}function vS(e,t){if(e==Ln){if("vtt"==t||"wvtt"==t)return"text/vtt";if(t&&""!==t)return"application/mp4"}return"image"!=e||t&&"jpeg"!=t?"audio"==e&&"mp4a.40.34"==t?"audio/mpeg":"mjpg"==t?"application/mp4":null:"image/jpeg"}function yS(e){return e==Ln?"text/vtt":RS[e].mp4}function bS(e,t){e=ES(e)?Math.trunc((t.length-1)/2):0;for(var n=t[e];2==n.ac()&&e+1<t.length;)e++,n=t[e];return{segment:n,segmentIndex:e}}function SS(e,t,n,i){var r,a,s,o,l,u,c,d,h,f,p,g,m,v;return N(function(y){switch(y.g){case 1:return r=Zr,a=bS(e,i),s=a.segment,2==s.status?y.return(yS(t)):(o=s.M(),l=new ht(o[0]),u=l.Pa.split(".").pop(),c=RS[t],(d=c[u])||(d=CS[u])||(d=vS(t,n))?y.return(d):(f=1,p=Kr(o,e.g.retryParameters),E(y,2),p.method="HEAD",_(y,AS(e,p,r,{type:f}),4)));case 4:g=y.h,h=g.headers["content-type"],A(y,3);break;case 2:if(m=k(y),!m||1002!=m.code&&1001!=m.code){y.u(3);break}return p.method="GET",_(y,AS(e,p,r,{type:f}),6);case 6:v=y.h,h=v.headers["content-type"];case 3:return h?y.return(h.toLowerCase().split(";")[0]):y.return(yS(t))}})}function TS(e,t,n,i,r,a,s){e&&(e.width=Number(t)||void 0,e.height=Number(n)||void 0,e.frameRate=Number(i)||void 0,e.hdr=r||void 0,e.videoLayout=a||void 0,e.colorGamut=s||void 0)}function _S(e,t,n){return AS(e,Kr(t,e.g.retryParameters),0,{type:n?2:3})}function wS(e){var t,n,i,r,a,s;return N(function(o){switch(o.g){case 1:return e.h?(E(o,2),t=Date.now(),_(o,e.update(),4)):o.return();case 4:n=Date.now(),ES(e)&&(i=(n-t)/1e3,e.Fb.sample(1,i),r=e.o,a=Math.max(0,r-q(e.Fb)),e.A.Y(a)),A(o,3);break;case 2:if(s=k(o),!e.h)return o.return();if(e.g.raiseFatalErrorOnManifestUpdateRequestFailure)return e.h.onError(s),o.return();s.severity=1,e.h.onError(s),e.A.Y(.1);case 3:if(!e.h)return o.return();e.h.onManifestUpdated(),w(o)}})}function ES(e){return e.xa!=LS}function xS(e,t){e.xa=t,e.j&&e.j.wc(!ES(e)),ES(e)||e.A.stop()}function AS(e,t,n,i){if(!e.da)throw new It(2,7,7001);return t=e.h.networkingEngine.request(n,t,i),jr(e.da,t),t.promise}function kS(e){return"AES-128"==e||"AES-256"==e||"AES-256-CTR"==e}function IS(e,t,n,i,r,a){var s,o,l,u,c,d,h,f,p,g,m,v,y,b,S;return N(function(T){switch(T.g){case 1:if("video/mp2t"==n)throw new It(2,4,4040);if(on())throw new It(2,4,4041);if(s=ab(t,"METHOD"),o=["SAMPLE-AES","SAMPLE-AES-CTR"],!o.includes(s))return T.return(null);if(l=hb(i(),ab(t,"URI"),a),l[0].startsWith("data:text/plain;base64,")){u=xn(wn(l[0].split("data:text/plain;base64,").pop())),T.u(2);break}return c=l.sort().join(""),e.qa.has(c)||(d=Kr(l,e.g.retryParameters),h=AS(e,d,6),e.qa.set(c,h)),_(T,e.qa.get(c),3);case 3:f=T.h,u=xn(f.data);case 2:if(p="00000000000000000000000000000000",!r){T.u(4);break}if(e.ya.has(r)){g=e.ya.get(r),T.u(5);break}return m=Vu(r.M(),r.$b(),r.Xb(),e.g.retryParameters),v=Zr,_(T,AS(e,m,v,{type:0}),6);case 6:y=T.h,g=Fu(y.data),e.ya.set(r,g);case 5:g&&(p=g);case 4:return b=new Map,b.set(p,u),S="cenc","SAMPLE-AES"==s&&(S="cbcs"),T.return(Cn(b,S))}})}z("shaka.net.DataUriPlugin",Sb),Sb.parse=Tb,Hr("data",Tb),i=wb.prototype,i.configure=function(e){this.g=e,this.l&&this.l.configure(this.g)},i.start=function(e,t){var n,i=this;return N(function(r){return 1==r.g?(i.h=t,i.I=t.isLowLatencyMode(),_(r,_S(i,[e]),2)):3!=r.g?(n=r.h,i.L=n.uri,_(r,Cb(i,n.data,e),3)):r.return(i.m)})},i.stop=function(){this.A&&(this.A.stop(),this.A=null);var e=[];return this.da&&(e.push(this.da.destroy()),this.da=null),this.g=this.h=null,this.wb.clear(),this.m=null,this.i.clear(),this.G.clear(),this.F.clear(),this.s.clear(),this.ra.clear(),this.pa.clear(),this.K.clear(),this.qa.clear(),this.ya.clear(),this.Ea.clear(),this.l&&this.l.destroy(),this.Z&&(this.Z.release(),this.Z=null),Promise.all(e)},i.update=function(){var e,t,n,i,r,a,s,o,l,u,h,f=this;return N(function(p){if(1==p.g){if(!ES(f))return p.return();for(e=[],t=Array.from(f.i.values()),f.o=1/0,f.m.gapCount=0,n=t.filter(function(e){return e.stream.segmentIndex}),i=c(n),r=i.next();!r.done;r=i.next())a=r.value,e.push(xb(f,a));return _(p,Promise.all(e),2)}for(eS(f,n.map(function(e){return e.stream})),s=n.some(function(e){return 0==e.xd}),n.length&&!s&&(o=NS,xS(f,o.zh),l=n.map(function(e){return e.Lb}),f.j.$a(Math.min.apply(Math,d(l))),f.h.updateDuration()),s&&Mb(f),u=c(n),r=u.next();!r.done;r=u.next())h=r.value,h.stream.segmentIndex&&!h.stream.segmentIndex.O[0]&&f.h.disableStream(h.stream);w(p)})},i.onExpirationUpdated=function(){},i.onInitialVariantChosen=function(){},i.banLocation=function(e){this.l&&this.l.banLocation(e)},i.setMediaElement=function(e){this.aa=e},z("shaka.hls.HlsParser",wb);var CS={aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},RS={audio:{mp4:"audio/mp4",mp4a:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",m4f:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",tsa:"video/mp2t"},video:{mp4:"video/mp4",mp4v:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",m4f:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t",tsv:"video/mp2t"},text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",m4f:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml"},image:{jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml",webp:"image/webp",avif:"image/avif"}},MS=new Set(["video/mp2t"].concat(d(Xn))),DS={"com.apple.streamingkeydelivery":function(e,t){if("video/mp2t"==t)throw new It(2,4,4040);if(on())throw new It(2,4,4041);if(t=ab(e,"METHOD"),!["SAMPLE-AES","SAMPLE-AES-CTR"].includes(t))return null;var n="cenc";return"SAMPLE-AES"==t&&(n="cbcs"),In("com.apple.fps",n,[{initDataType:"sinf",initData:new Uint8Array(0),keyId:null}],ab(e,"URI"))},"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(e){var t=ab(e,"METHOD");if(!["SAMPLE-AES","SAMPLE-AES-CTR"].includes(t))return null;var n="cenc";return"SAMPLE-AES"==t&&(n="cbcs"),t=ab(e,"URI"),t=_b(t.split("?")[0]),t=Ee(t.data),n=In("com.widevine.alpha",n,[{initDataType:"cenc",initData:t}]),(e=rb(e,"KEYID"))&&(n.keyIds=new Set([e.toLowerCase().substr(2)])),n},"com.microsoft.playready":function(e){var t=ab(e,"METHOD");if(!["SAMPLE-AES","SAMPLE-AES-CTR"].includes(t))return null;var n="cenc";return"SAMPLE-AES"==t&&(n="cbcs"),e=ab(e,"URI"),e=_b(e.split("?")[0]),e=Ee(e.data),t=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),e=_a(e,t,new Set,0),In("com.microsoft.playready",n,[{initDataType:"cenc",initData:e}])}},LS="VOD",PS="EVENT",OS="LIVE",NS={zh:LS,xj:PS,Fj:OS};function US(e){var t=0,n=Ae(e),i=n.getUint32(t,!0);if(i!=e.byteLength)return[];e:{for(e=t+6,t=[];e<n.byteLength-1;){i=n.getUint16(e,!0),e+=2;var r=n.getUint16(e,!0);if(e+=2,0!=(1&r)||r+e>n.byteLength){n=[];break e}var a=Ee(n,e,r);t.push({type:i,value:a}),e+=r}n=t}return n}function FS(e){if(e=BS(e))e:{e=c(Da(e,"DATA"));for(var t=e.next();!t.done;t=e.next())if(t=La(t.value,"LA_URL")){e=Ra(t);break e}e=""}else e="";return e}function BS(e){return e=wn(Ra(e)),e=US(e).filter(function(e){return e.type===VS})[0],e?(e=fn(e.value,!0),(e=Ea(e,"WRMHEADER"))?e:null):null}zs["application/x-mpegurl"]=function(){return new wb},zs["application/vnd.apple.mpegurl"]=function(){return new wb};var VS=1,jS=(new Map).set("com.microsoft.playready",FS).set("com.microsoft.playready.recommendation",FS).set("com.microsoft.playready.software",FS).set("com.microsoft.playready.hardware",FS);function GS(e){if(!JS){JS=!0;var t=new Uint8Array([105,115,111,109]),n=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);dT=ZS("ftyp",t,i,t,n),t=ZS("dref",hT),fT=ZS("dinf",t)}this.g=e}function HS(e){for(var t=[],n=c(e.g),i=n.next();!i.done;i=n.next()){var r=t,a=r.push,s=i.value;i=ZS;var o=s.id+1,l=s.stream.width||0,u=s.stream.height||0;"audio"==s.type&&(u=l=0);var h=s.duration*s.timescale,f=Math.floor(h/(eT+1));switch(h=Math.floor(h%(eT+1)),o=new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3].concat(d(XS(o,4)),[0,0,0,0],d(XS(f,4)),d(XS(h,4)),[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0],d(XS(l,2)),[0,0],d(XS(u,2)),[0,0])),o=ZS("tkhd",o),l=ZS,f=s.duration*s.timescale,u=Math.floor(f/(eT+1)),f=Math.floor(f%(eT+1)),h=s.stream.language,h=h.charCodeAt(0)-96<<10|h.charCodeAt(1)-96<<5|h.charCodeAt(2)-96,u=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3].concat(d(XS(s.timescale,4)),d(XS(u,4)),d(XS(f,4)),d(XS(h,2)),[0,0])),u=ZS("mdhd",u),f=s,h=new Uint8Array([]),f.type){case"video":h=nT;break;case"audio":h=iT}f=ZS("hdlr",h);e:{switch(s.type){case"video":s=ZS("minf",ZS("vmhd",lT),fT,zS(s));break e;case"audio":s=ZS("minf",ZS("smhd",uT),fT,zS(s));break e}s=new Uint8Array([])}s=l("mdia",u,f,s),i=i("trak",o,s),a.call(r,i)}for(t=An.apply(Sn,d(t)),a=e.g[0],n=ZS,i=a.duration*a.timescale,r=Math.floor(i/(eT+1)),i=Math.floor(i%(eT+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3].concat(d(XS(a.timescale,4)),d(XS(r,4)),d(XS(i,4)),[0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255])),r=ZS("mvhd",r),i=[],e=c(e.g),l=e.next();!l.done;l=e.next())s=i,o=s.push,l=new Uint8Array([0,0,0,0].concat(d(XS(l.value.id+1,4)),[0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1])),l=ZS("trex",l),o.call(s,l);if(e=An.apply(Sn,d(i)),e=ZS("mvex",e),i=[],a.encrypted){for(a=c(a.stream.drmInfos),s=a.next();!s.done;s=a.next())if(s=s.value,s.initData)for(s=c(s.initData),o=s.next();!o.done;o=s.next())i.push(o.value.initData);a=An.apply(Sn,d(i))}else a=new Uint8Array([]);return e=n("moov",r,t,e,a),t=new Uint8Array(dT.byteLength+e.byteLength),t.set(dT),t.set(e,dT.byteLength),t}function zS(e){var t=ZS,n=new Uint8Array([]);switch(e.type){case"video":if(e.codecs.includes("avc1")){n=e.stream.width||0;var i=e.stream.height||0;if(0<e.wa.byteLength)var r=ZS("avcC",e.wa);else{r=ZS;for(var a=7,s=[],o=[],l=0,u=0,c=0,h=0;h<e.ab.length;h++){var f=QS(e.ab[h]);switch(31&f[0]){case 7:s.push(f),a+=f.length+2;break;case 8:o.push(f),a+=f.length+2}}for(0<s.length&&(l=s[0][1],c=s[0][2],u=s[0][3]),a=new Uint8Array(a),h=0,a[h++]=1,a[h++]=l,a[h++]=c,a[h++]=u,a[h++]=255,a[h++]=224|s.length,l=0;l<s.length;l++)a[h++]=(65280&s[l].length)>>8,a[h++]=255&s[l].length,a.set(s[l],h),h+=s[l].length;for(a[h++]=o.length,s=0;s<o.length;s++)a[h++]=(65280&o[s].length)>>8,a[h++]=255&o[s].length,a.set(o[s],h),h+=o[s].length;r=r("avcC",a)}n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].concat(d(XS(n,2)),d(XS(i,2)),[0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17])),i="avc1",o=KS(e),s=new Uint8Array([]),e.encrypted&&(s=WS(e),i="encv"),n=ZS(i,n,r,o,s)}else e.codecs.includes("hvc1")&&(i=e.stream.width||0,r=e.stream.height||0,n=new Uint8Array([]),0<e.wa.byteLength&&(n=ZS("hvcC",e.wa)),i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].concat(d(XS(i,2)),d(XS(r,2)),[0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17])),r="hvc1",o=KS(e),s=new Uint8Array([]),e.encrypted&&(s=WS(e),r="encv"),n=ZS(r,i,n,o,s));break;case"audio":e.codecs.includes("mp3")?e=ZS(".mp3",$S(e)):e.codecs.includes("ac-3")?(n=ZS("dac3",e.ma),i="ac-3",r=new Uint8Array([]),e.encrypted&&(r=WS(e),i="enca"),e=ZS(i,$S(e),n,r)):e.codecs.includes("ec-3")?(n=ZS("dec3",e.ma),i="ec-3",r=new Uint8Array([]),e.encrypted&&(r=WS(e),i="enca"),e=ZS(i,$S(e),n,r)):e.codecs.includes("opus")?(n=ZS("dOps",e.ma),i="Opus",r=new Uint8Array([]),e.encrypted&&(r=WS(e),i="enca"),e=ZS(i,$S(e),n,r)):(0<e.ma.byteLength?n=ZS("esds",e.ma):(n=ZS,i=e.id+1,r=e.stream.channelsCount||2,s=e.stream.audioSamplingRate||44100,l=Rn("audio",e.codecs.split(",")),u={96000:0,88200:1,64000:2,48000:3,44100:4,32000:5,24000:6,22050:7,16000:8,12000:9,11025:10,8000:11,7350:12},o=u[s],"mp4a.40.5"!==l&&"mp4a.40.29"!==l||(o=u[2*s]),s=parseInt(l.split(".").pop(),10),i=new Uint8Array([0,0,0,0,3,25].concat(d(XS(i,2)),[0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,s<<3|o>>>1,o<<7|r<<3,6,1,2])),n=n("esds",i)),i="mp4a",r=new Uint8Array([]),e.encrypted&&(r=WS(e),i="enca"),e=ZS(i,$S(e),n,r)),n=e}return e=ZS("stsd",cT,n),t("stbl",e,ZS("stts",rT),ZS("stsc",aT),ZS("stsz",oT),ZS("stco",sT))}function KS(e){if(!e.Ba&&!e.Ca)return new Uint8Array([]);var t=e.Ca;return e=new Uint8Array([].concat(d(XS(e.Ba,4)),d(XS(t,4)))),ZS("pasp",e)}function $S(e){return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.stream.channelsCount||2,0,16,0,0,0,0].concat(d(XS(e.stream.audioSamplingRate||44100,2)),[0,0]))}function WS(e){for(var t=ZS,n=e.codecs.substring(0,e.codecs.indexOf(".")),i=0,r=0;r<n.length;r+=1)i|=n.charCodeAt(r)<<8*(n.length-r-1);n=new Uint8Array([].concat(d(XS(i,4)))),n=ZS("frma",n),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),i=ZS("schm",i),r=ZS;var a=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);e=c(e.stream.drmInfos);for(var s=e.next();!s.done;s=e.next())if((s=s.value)&&s.keyIds&&s.keyIds.size){s=c(s.keyIds);for(var o=s.next();!o.done;o=s.next())a=QS(o.value)}return e=new Uint8Array([0,0,0,0,0,0,1,8]),a=ZS("tenc",e,a),t("sinf",n,i,r("schi",a))}function qS(e){var t=[];e=c(e.g);for(var n=e.next();!n.done;n=e.next()){n=n.value;var i,r=t.push,a=r.apply,s=ZS,o=new Uint8Array([0,0,0,0].concat(d(XS(n.data?n.data.sb:0,4))));o=ZS("mfhd",o);var l=n.data?n.data.Za:[],u=new Uint8Array(4+l.length);for(i=0;i<l.length;i++){var h=l[i].flags;u[i+4]=h.Va<<4|h.Xa<<2|h.Wa}l=ZS("sdtp",u);var f=l.length+92;u=ZS,i=new Uint8Array([0,0,0,58].concat(d(XS(n.id+1,4)),[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),i=ZS("tfhd",i),h=n.data?n.data.baseMediaDecodeTime:0;var p=Math.floor(h%(eT+1));h=new Uint8Array([1,0,0,0].concat(d(XS(Math.floor(h/(eT+1)),4)),d(XS(p,4)))),h=ZS("tfdt",h);var g=f;f=n.data?n.data.Za:[],p=f.length;var m=12+16*p,v=new Uint8Array(m);for(g+=8+m,v.set(["video"===n.type?1:0,0,15,1].concat(d(XS(p,4)),d(XS(g,4))),0),g=0;g<p;g++){var y=f[g];m=XS(y.duration,4);var b=XS(y.size,4),S=y.flags;y=XS(y.eb,4),v.set([].concat(d(m),d(b),[S.hb<<2|S.Va,S.Xa<<6|S.Wa<<4|S.ib,61440&S.Ua,15&S.Ua],d(y)),12+16*g)}f=ZS("trun",v),l=u("traf",i,h,f,l),s=s("moof",o,l),a.call(r,t,[s,YS(n)])}return An.apply(Sn,d(t))}function YS(e){return e=(e.data?e.data.Za:[]).map(function(e){return e.data}),e=An.apply(Sn,d(e)),ZS("mdat",e)}function XS(e,t){var n=[];for(--t;0<=t;t--)n.push(e>>8*t&255);return n}function QS(e){for(var t=new Uint8Array(e.length/2),n=0;n<e.length/2;n+=1)t[n]=parseInt(String(e[2*n]+e[2*n+1]),16);return t}function ZS(e){var t=U.apply(1,arguments),n=tT[e];n||(n=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)],tT[e]=n);for(var i=8,r=t.length-1;0<=r;r--)i+=t[r].byteLength;for(r=new Uint8Array(i),r[0]=i>>24&255,r[1]=i>>16&255,r[2]=i>>8&255,r[3]=255&i,r.set(n,4),n=0,i=8;n<t.length;n++)r.set(t[n],i),i+=t[n].byteLength;return r}var JS=!1,eT=Math.pow(2,32)-1,tT={},nT=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),iT=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),rT=new Uint8Array([0,0,0,0,0,0,0,0]),aT=new Uint8Array([0,0,0,0,0,0,0,0]),sT=new Uint8Array([0,0,0,0,0,0,0,0]),oT=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),lT=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),uT=new Uint8Array([0,0,0,0,0,0,0,0]),cT=new Uint8Array([0,0,0,0,0,0,0,1]),dT=new Uint8Array([]),hT=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),fT=new Uint8Array([]);function pT(){var e=this;this.h=this.g=null,this.l=[],this.j=null,this.s=1,this.i=null,this.B=new W(5),this.o=new Ut(function(){gT(e)}),this.A=new Vr,this.m=new Map}function gT(e){var t;N(function(n){switch(n.g){case 1:return E(n,2),_(n,mT(e),4);case 4:A(n,3);break;case 2:t=k(n),e.h&&(t.severity=1,e.h.onError(t));case 3:if(!e.h)return n.return();w(n)}})}function mT(e){var t,n,i,r,a,s,o;return N(function(l){if(1==l.g)return t=Kr(e.l,e.g.retryParameters),n=e.h.networkingEngine,i=Date.now(),r=n.request(0,t,{type:5}),jr(e.A,r),_(l,r.promise,2);if(a=l.h,!e.h)return l.return();a.uri&&!e.l.includes(a.uri)&&e.l.unshift(a.uri);var u=a.uri,h=a.data,f=e.g.mss.manifestPreprocessor;if(f!=Nc){if(pe("manifest.mss.manifestPreprocessor configuration","Please Use manifest.mss.manifestPreprocessorTXml instead."),h=by(h,"SmoothStreamingMedia"),!h)throw new It(2,4,4046,u);f(h),h=gn(h.outerHTML)}var p=wa(h,"SmoothStreamingMedia");if(!p)throw new It(2,4,4046,u);if(u=e.g.mss.manifestPreprocessorTXml,u!=Uc&&u(p),e.i||(e.i=new Ll(null,0)),u=Oa(p,"IsLive",$a,!1))throw new It(2,4,4047);e.i.wc(!u),f=Oa(p,"TimeScale",za,1e7),h=Oa(p,"DVRWindowLength",za),u&&(0===h||isNaN(h))&&(h=1/0);var g,m=Oa(p,"CanSeek",$a,!1);for(0===h&&m&&(h=1/0),m=null,h&&0<h&&(m=h/f),u&&!isNaN(e.g.availabilityWindowOverride)&&(m=e.g.availabilityWindowOverride),null==m&&(m=1/0),e.i.Ie(m),h=Oa(p,"Duration",za,1/0),u||e.i.$a(h/f),u={variants:[],textStreams:[],timescale:f,duration:h/f},m=Ca(p,"Protection"),f=e.g.mss.keySystemsBySystemId,h=[],m=c(m),g=m.next();!g.done;g=m.next())h=h.concat(Ca(g.value,"ProtectionHeader"));if(h.length){for(m=[],g=0;g<h.length;g++){var v=h[g],y=v.attributes.SystemID.toLowerCase(),b=f[y];if(b){var S=BS(v);if(S)e:{S=c(Da(S,"DATA"));for(var T=S.next();!T.done;T=S.next())if(T=La(T.value,"KID")){S=wn(Ra(T)),S=new Uint8Array([S[3],S[2],S[1],S[0],S[5],S[4],S[7],S[6]].concat(d(S.slice(8)))),S=xn(S);break e}S=null}else S=null;T=wn(Ra(v)),y=En(y.replace(/-/g,"")),y=[{initData:_a(T,y,new Set,0),initDataType:"cenc",keyId:S}],y=In(b,"cenc",y),S&&y.keyIds.add(S),(b=jS.get(b))&&(y.licenseServerUri=b(v)),m.push(y)}}f=m}else f=[];for(g=f,m=[],f=[],h=[],p=Ca(p,"StreamIndex"),p=c(p),v=p.next();!v.done;v=p.next()){v=v.value,b=Ca(v,"QualityLevel"),y=u.timescale,S=u.duration,T=Ca(v,"c");for(var E=[],x=0,A=0;A<T.length;++A){var k=T[A],I=T[A+1],C=Oa(k,"t",za),R=Oa(k,"d",za);if(k=Oa(k,"r",Ga),!R)break;if(C=null!=C?C:x,k=k||0,0>k)if(I){if(I=Oa(I,"t",za),null==I)break;if(C>=I)break;k=Math.ceil((I-C)/R)-1}else{if(1/0==S)break;if(C/y>=S)break;k=Math.ceil((S*y-C)/R)-1}for(I=0;I<=k;++I)x=C+R,E.push({start:C/y,end:x/y,og:C}),C=x}for(y=E,b=c(b),S=b.next();!S.done;S=b.next())(S=vT(e,v,S.value,y,g,u))&&("audio"!=S.type||e.g.disableAudio?"video"!=S.type||e.g.disableVideo?S.type!=Ln||e.g.disableText||h.push(S):f.push(S):m.push(S))}for(p=[],m=c(0<m.length?m:[null]),g=m.next();!g.done;g=m.next())for(g=g.value,v=c(0<f.length?f:[null]),S=v.next();!S.done;S=v.next())b=p,y=b.push,S=S.value,T=0,g&&g.bandwidth&&0<g.bandwidth&&(T+=g.bandwidth),S&&S.bandwidth&&0<S.bandwidth&&(T+=S.bandwidth),S={id:e.s++,language:g?g.language:"und",disabledUntilTime:0,primary:!!g&&g.primary||!!S&&S.primary,audio:g,video:S,bandwidth:T,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},y.call(b,S);u.variants=p,u.textStreams=h,e.j?(e.j.variants=u.variants,e.j.textStreams=u.textStreams,e.h.filter(e.j)):(e.j={presentationTimeline:e.i,variants:u.variants,textStreams:u.textStreams,imageStreams:[],offlineSessionIds:[],minBufferTime:0,sequenceMode:e.g.mss.sequenceMode,ignoreManifestTimestampsInSegmentsMode:!1,type:"MSS",serviceDescription:null,nextUrl:null,periodCount:1,gapCount:0,isLowLatency:!1},e.i.re()),Promise.resolve(),s=Date.now(),o=(s-i)/1e3,e.B.sample(1,o),w(l)})}function vT(e,t,n,i,r,a){var s=t.attributes.Type;if("audio"!==s&&"video"!==s&&"text"!==s)return Z("Ignoring unrecognized type:",s),null;var o=t.attributes.Language,l=e.s++,u=Oa(n,"Bitrate",Ha),c=Oa(n,"MaxWidth",Ha),d=Oa(n,"MaxHeight",Ha),h=Oa(n,"Channels",Ha),f=Oa(n,"SamplingRate",Ha),p=a.duration;i.length&&(p=i[i.length-1].end-i[0].start);var g=e.i.getDuration();e.i.$a(Math.min(p,g));var m={id:l,originalId:t.attributes.Name||String(l),groupId:null,createSegmentIndex:function(){return Promise.resolve()},closeSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:"",codecs:"",frameRate:void 0,pixelAspectRatio:void 0,bandwidth:u||0,width:c||void 0,height:d||void 0,kind:"",encrypted:0<r.length,drmInfos:r,keyIds:new Set,language:hi(o||"und"),originalLanguage:o,label:"",type:"",primary:!1,trickModeVideo:null,emsgSchemeIdUris:[],roles:[],forced:!1,channelsCount:h,audioSamplingRate:f,spatialAudio:!1,closedCaptions:null,hdr:void 0,colorGamut:void 0,videoLayout:void 0,tilesLayout:void 0,matchedStreams:[],mssPrivateData:{duration:p,timescale:a.timescale,codecPrivateData:null},accessibilityPurpose:null,external:!1,fastSwitching:!1,fullMimeTypes:new Set};if((r=t.attributes.Subtype)&&((r=wT[r])&&m.roles.push(r),"main"===r&&(m.primary=!0)),r=n.attributes.FourCC,null!==r&&""!==r||(r=t.attributes.FourCC),!r)if("audio"===s)r="AAC";else if("video"===s)return Z('FourCC is not defined whereas it is required for a QualityLevel element for a StreamIndex of type "video"'),null;if(!_T.includes(r.toUpperCase()))return Z("Codec not supported:",r),null;switch(n=yT(n,s,r,m),m.mssPrivateData.codecPrivateData=n,s){case"audio":if(!n)return Z("Quality unsupported without CodecPrivateData",s),null;m.type="audio",m.mimeType="mss/audio/mp4",m.codecs=bT(r,n);break;case"video":if(!n)return Z("Quality unsupported without CodecPrivateData",s),null;m.type="video",m.mimeType="mss/video/mp4",m.codecs=ST(n);break;case"text":m.type=Ln,m.mimeType="application/mp4",("TTML"===r||"DFXP"===r)&&(m.codecs="stpp")}return m.fullMimeTypes.add(Fn(m.mimeType,m.codecs)),m.createSegmentIndex=function(){if(m.segmentIndex)return Promise.resolve();if(e.m.has(m.id))var n=e.m.get(m.id);else n=[],"video"==m.type&&(n=m.mssPrivateData.codecPrivateData.split("00000001").slice(1)),n={id:m.id,type:m.type,codecs:m.codecs,encrypted:m.encrypted,timescale:m.mssPrivateData.timescale,duration:m.mssPrivateData.duration,ab:n,ma:new Uint8Array([]),wa:new Uint8Array([]),Ba:0,Ca:0,data:null,stream:m},n=HS(new GS([n])),e.m.set(m.id,n);return n=TT(e,new Ys(function(){return[]},0,null,Lu(m),m.mssPrivateData.timescale,n),m,t,i),m.segmentIndex=new tu(n),Promise.resolve()},m.closeSegmentIndex=function(){m.segmentIndex&&(m.segmentIndex.release(),m.segmentIndex=null)},m}function yT(e,t,n,i){if(e=e.attributes.CodecPrivateData)return e;if("audio"!==t)return null;t=i.channelsCount||2,e=i.audioSamplingRate||44100;var r={96000:0,88200:1,64000:2,48000:3,44100:4,32000:5,24000:6,22050:7,16000:8,12000:9,11025:10,8000:11,7350:12};return i=r[e],"AACH"===n?(n=new Uint8Array(4),e=r[2*e],n[0]=40|i>>1,n[1]=i<<7|t<<3|e>>1,n[2]=e<<7|8,n[3]=0,t=new Uint16Array(2),t[0]=(n[0]<<8)+n[1],t[1]=(n[2]<<8)+n[3],t[0].toString(16)+t[1].toString(16)):(n=new Uint8Array(2),n[0]=16|i>>1,n[1]=i<<7|t<<3,t=new Uint16Array(1),t[0]=(n[0]<<8)+n[1],t[0].toString(16))}function bT(e,t){var n=0;return"AACH"===e&&(n=5),t?0===n&&(n=(248&parseInt(t.substr(0,2),16))>>3):(n=2,"AACH"===e&&(n=5)),"mp4a.40."+n}function ST(e){var t=/00000001[0-9]7/.exec(e);return t.length&&e?"avc1."+e.substr(e.indexOf(t[0])+10,6):""}function TT(e,t,n,i,r){var a=i.attributes.Url.replace("{bitrate}",String(n.bandwidth));i=[];var s={};r=c(r);for(var o=r.next();!o.done;s={fd:s.fd},o=r.next())s.fd=o.value,i.push(new Qs(s.fd.start,s.fd.end,function(t){return function(){return kn(e.l,[a.replace("{start time}",String(t.fd.og))])}}(s),0,null,t,0,0,n.mssPrivateData.duration));return i}i=pT.prototype,i.configure=function(e){this.g=e},i.start=function(e,t){var n=this;return N(function(i){if(1==i.g)return n.l=[e],n.h=t,_(i,mT(n),2);if(!n.h)throw new It(2,7,7001);return i.return(n.j)})},i.stop=function(){return this.g=this.h=null,this.l=[],this.j=null,null!=this.o&&(this.o.stop(),this.o=null),this.m.clear(),this.A.destroy()},i.update=function(){var e,t=this;return N(function(n){return 1==n.g?(E(n,2),_(n,mT(t),4)):2!=n.g?A(n,0):(e=k(n),t.h&&e?(t.h.onError(e),void w(n)):n.return())})},i.onExpirationUpdated=function(){},i.onInitialVariantChosen=function(){},i.banLocation=function(){},i.setMediaElement=function(){},z("shaka.mss.MssParser",pT);var _T="AAC AACL AACH AACP AVC1 H264 TTML DFXP".split(" "),wT={CAPT:"main",SUBT:"alternate",DESC:"main"};function ET(e,t,n,i,r,a){if(200<=n&&299>=n&&202!=n)return{uri:r||i,originalUri:i,data:t,status:n,headers:e,fromCache:!!e["x-shaka-from-cache"]};var s=null;try{s=pn(t)}catch(e){}throw new It(401==n||403==n?2:1,1,1001,i,n,s,e,a,r||i)}function xT(){}function AT(e,t,n,i,r){var a=new LT;aa(t.headers).forEach(function(e,t){a.append(t,e)});var s=new MT,o={zg:!1,th:!1};if(e=kT(e,n,{body:t.body||void 0,headers:a,method:t.method,signal:s.signal,credentials:t.allowCrossSiteCredentials?"include":void 0},o,i,r,t.streamDataCallback),e=new Cr(e,function(){return o.zg=!0,s.abort(),Promise.resolve()}),t=t.retryParameters.timeout){var l=new Ut(function(){o.th=!0,s.abort()});l.Y(t/1e3),e.finally(function(){l.stop()})}return e}function kT(e,t,n,i,r,a,s){var o,l,u,c,d,h,f,p,g,m,v,y,b;return N(function(S){switch(S.g){case 1:return o=RT,l=DT,h=d=0,f=Date.now(),E(S,2),_(S,o(e,n),4);case 4:if(u=S.h,a(IT(u.headers)),"HEAD"==n.method){S.u(5);break}return p=u.clone().body.getReader(),m=(g=u.headers.get("Content-Length"))?parseInt(g,10):0,v=function(e){function t(){var n,i,a;return N(function(o){switch(o.g){case 1:return E(o,2),_(o,p.read(),4);case 4:n=o.h,A(o,3);break;case 2:return k(o),o.return();case 3:if(n.done){o.u(5);break}if(d+=n.value.byteLength,!s){o.u(5);break}return _(o,s(n.value),5);case 5:i=Date.now(),(100<i-f||n.done)&&(a=n.done?0:m-d,r(i-f,d-h,a),h=d,f=i),n.done?e.close():(e.enqueue(n.value),t()),w(o)}})}t()},new l({start:v}),_(S,u.arrayBuffer(),6);case 6:c=S.h;case 5:A(S,3);break;case 2:if(y=k(S),i.zg)throw new It(1,1,7001,e,t);if(i.th)throw new It(1,1,1003,e,t);throw new It(1,1,1002,e,y,t);case 3:return b=IT(u.headers),S.return(ET(b,c,u.status,e,u.url,t))}})}function IT(e){var t={};return e.forEach(function(e,n){t[n.trim()]=e}),t}function CT(){if(!e.ReadableStream)return!1;try{new ReadableStream({})}catch(e){return!1}return!!e.Response&&(!!new Response("").body&&!(!e.fetch||"polyfill"in e.fetch||!e.AbortController))}zs["application/vnd.ms-sstr+xml"]=function(){return new pT},z("shaka.net.HttpFetchPlugin",xT),xT.isSupported=CT,xT.parse=AT;var RT=e.fetch,MT=e.AbortController,DT=e.ReadableStream,LT=e.Headers;function PT(){}function OT(e,t,n,i,r){var a=new UT,s=Date.now(),o=0,l=new Promise(function(l,u){a.open(t.method,e,!0),a.responseType="arraybuffer",a.timeout=t.retryParameters.timeout,a.withCredentials=t.allowCrossSiteCredentials,a.onabort=function(){u(new It(1,1,7001,e,n))};var c=!1;for(var d in a.onreadystatechange=function(){if(2==a.readyState&&!c){var e=NT(a);r(e),c=!0}},a.onload=function(t){var r=NT(a),c=a.response;try{i(Date.now()-s,t.loaded-o,0);var d=ET(r,c,a.status,e,a.responseURL,n);l(d)}catch(e){u(e)}},a.onerror=function(t){u(new It(1,1,1002,e,t,n))},a.ontimeout=function(){u(new It(1,1,1003,e,n))},a.onprogress=function(e){var t=Date.now();(100<t-s||e.lengthComputable&&e.loaded==e.total)&&(i(t-s,e.loaded-o,4==a.readyState?0:e.total-e.loaded),o=e.loaded,s=t)},t.headers)a.setRequestHeader(d.toLowerCase(),t.headers[d]);a.send(t.body)});return new Cr(l,function(){return a.abort(),Promise.resolve()})}function NT(e){var t=e.getAllResponseHeaders().trim().split("\r\n");e={},t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value.split(": "),e[n[0].toLowerCase()]=n.slice(1).join(": ");return e}CT()&&(Hr("http",AT,2,!0),Hr("https",AT,2,!0),Hr("blob",AT,2,!0)),z("shaka.net.HttpXHRPlugin",PT),PT.parse=OT;var UT=e.XMLHttpRequest;function FT(e,t,n,i){this.g=e,this.i=t,this.groupId=n,this.h=i}function BT(e){return e.M().map(function(e){return"{"+encodeURI(e)+"}"}).join("")+":"+e.Ha+":"+e.sa}function VT(e,t){return Vu(e.g.M(),e.g.Ha,e.g.sa,t.streaming.retryParameters)}function jT(){this.h=this.j=this.i=0,this.g=new Map,this.l=0}function GT(e,t){e.i+=t;var n=e.l;return e.l++,e.g.set(n,t),n}function HT(e){var t=this;this.o=e,this.j=new Map,this.i=new ta(function(){return KT(t).catch(function(){})}),this.h=[],this.m=function(){},this.l=function(){},this.g=new jT}function zT(e,t,n){e.m=t,e.l=n}function KT(e){var t=e.h.map(function(e){return e()});return e.h=[],Promise.all(t)}function $T(e,t,n,i,r,a){na(e.i);var s=(e.j.get(t)||Promise.resolve()).then(function(){var t,s,o,l,u,c,d;return N(function(h){if(1==h.g)return _(h,qT(e,n),2);if(t=h.h,e.i.g)throw new It(2,9,7001);if(r)for(l in s=Ee(t),o=new Ta(s),o.data)u=Number(l),c=o.data[u],d=o.g[u],e.l(c,d);e.g.close(i,t.byteLength);var f=e.g;return e.m(0==f.i?0:f.j/f.i,e.g.h),h.return(a(t))})});e.j.set(t,s)}function WT(e){return N(function(t){return 1==t.g?_(t,Promise.all(e.j.values()),2):t.return(e.g.h)})}function qT(e,t){var n,i,r,a;return N(function(s){return 1==s.g?(n=Zr,i=e.o.request(n,t),r=function(){return i.abort()},e.h.push(r),_(s,i.promise,2)):(a=s.h,Ne(e.h,r),s.return(a.data))})}function YT(e,t){var n=this;this.i=e,this.h=e.objectStore(t),this.g=new Ir,e.onabort=function(e){e.preventDefault(),n.g.reject()},e.onerror=function(e){e.preventDefault(),n.g.reject()},e.oncomplete=function(){n.g.resolve()}}function XT(e,t){return new Promise(function(n,i){var r=e.h.openCursor();r.onerror=i,r.onsuccess=function(){var e;return N(function(i){if(1==i.g)return null==r.result?(n(),i.return()):(e=r.result,_(i,t(e.key,e.value,e),2));e.continue(),w(i)})}})}function QT(e){this.h=e,this.g=[]}function ZT(e,t){return JT(e,t,"readwrite")}function JT(e,t,n){n=e.h.transaction([t],n);var i=new YT(n,t);return e.g.push(i),i.promise().then(function(){Ne(e.g,i)},function(){Ne(e.g,i)}),i}function e_(e,t,n){this.h=new QT(e),this.i=t,this.g=n}function t_(e,t,n){e=ZT(e.h,e.g);var i=e.store();return i.get(t).onsuccess=function(){i.put(n,t)},e.promise()}function n_(e){return Promise.reject(new It(2,9,9011,"Cannot add new value to "+e))}function i_(e,t,n,i){e=ZT(e.h,t),t=e.store();var r={};n=c(n);for(var a=n.next();!a.done;r={Wd:r.Wd},a=n.next())r.Wd=a.value,t.delete(r.Wd).onsuccess=function(e){return function(){return i(e.Wd)}}(r);return e.promise()}function r_(e,t,n){var i,r,a,s,o,l,u;return N(function(d){if(1==d.g){for(i=JT(e.h,t,"readonly"),r=i.store(),a={},s=[],o={},l=c(n),u=l.next();!u.done;o={dd:o.dd,ad:o.ad},u=l.next())o.ad=u.value,o.dd=r.get(o.ad),o.dd.onsuccess=function(e){return function(){void 0==e.dd.result&&s.push(e.ad),a[e.ad]=e.dd.result}}(o);return _(d,i.promise(),2)}if(s.length)throw new It(2,9,9012,"Could not find values for "+s);return d.return(n.map(function(e){return a[e]}))})}function a_(e){this.g=new QT(e)}function s_(){this.g=new Map}function o_(e){var t=null;if(e.g.forEach(function(e,n){e.getCells().forEach(function(e,i){e.hasFixedKeySpace()||t||(t={path:{ob:n,Ja:i},Ja:e})})}),t)return t;throw new It(2,9,9013,"Could not find a cell that supports add-operations")}function l_(e,t){e.g.forEach(function(e,n){e.getCells().forEach(function(e,i){t({ob:n,Ja:i},e)})})}function u_(e,t,n){if(e=e.g.get(t),!e)throw new It(2,9,9013,"Could not find mechanism with name "+t);if(t=e.getCells().get(n),!t)throw new It(2,9,9013,"Could not find cell with name "+n);return t}function c_(e,t){e.g.forEach(function(e){t(e.getEmeSessionCell())})}function d_(e){var t=Array.from(e.g.keys());if(!t.length)throw new It(2,9,9e3,"No supported storage mechanisms found");return e.g.get(t[0]).getEmeSessionCell()}function h_(e){var t,n,i;return N(function(r){return 1==r.g?(t=Array.from(e.g.values()),n=0<t.length,n||(i=p_,i.forEach(function(e){(e=e())&&t.push(e)})),_(r,Promise.all(t.map(function(e){return e.erase()})),2)):n?r.u(0):_(r,Promise.all(t.map(function(e){return e.destroy()})),0)})}function f_(e,t){p_.set(e,t)}Hr("http",OT,1,!0),Hr("https",OT,1,!0),Hr("blob",OT,1,!0),jT.prototype.close=function(e,t){if(this.g.has(e)){var n=this.g.get(e);this.g.delete(e),this.j+=n,this.h+=t}},HT.prototype.destroy=function(){return this.i.destroy()},YT.prototype.abort=function(){var e=this;return N(function(t){if(1==t.g){try{e.i.abort()}catch(e){}return E(t,2),_(t,e.g,4)}if(2!=t.g)return A(t,0);k(t),w(t)})},YT.prototype.store=function(){return this.h},YT.prototype.promise=function(){return this.g},QT.prototype.destroy=function(){return Promise.all(this.g.map(function(e){return e.abort()}))},i=e_.prototype,i.destroy=function(){return this.h.destroy()},i.hasFixedKeySpace=function(){return!0},i.addSegments=function(){return n_(this.i)},i.removeSegments=function(e,t){return i_(this,this.i,e,t)},i.getSegments=function(e){var t,n=this;return N(function(i){return 1==i.g?_(i,r_(n,n.i,e),2):(t=i.h,i.return(t.map(function(e){return n.Cg(e)})))})},i.addManifests=function(){return n_(this.g)},i.updateManifest=function(){return Promise.reject(new It(2,9,9016,"Cannot modify values in "+this.g))},i.updateManifestExpiration=function(e,t){var n=ZT(this.h,this.g),i=n.store();return i.get(e).onsuccess=function(n){(n=n.target.result)&&(n.expiration=t,i.put(n,e))},n.promise()},i.removeManifests=function(e,t){return i_(this,this.g,e,t)},i.getManifests=function(e){var t,n=this;return N(function(i){return 1==i.g?_(i,r_(n,n.g,e),2):(t=i.h,i.return(Promise.all(t.map(function(e){return n.od(e)}))))})},i.getAllManifests=function(){var e,t,n=this;return N(function(i){return 1==i.g?(e=JT(n.h,n.g,"readonly"),t=new Map,_(i,XT(e,function(e,i){var r;return N(function(a){if(1==a.g)return _(a,n.od(i),2);r=a.h,t.set(e,r),w(a)})}),2)):3!=i.g?_(i,e.promise(),3):i.return(t)})},i.Cg=function(e){return e},i.od=function(e){return Promise.resolve(e)},i.add=function(e,t){var n,i,r,a,s,o,l,u=this;return N(function(d){if(1==d.g){for(n=ZT(u.h,e),i=n.store(),r=[],a={},s=c(t),o=s.next();!o.done;a={Xd:a.Xd},o=s.next())l=o.value,a.Xd=i.add(l),a.Xd.onsuccess=function(e){return function(){r.push(e.Xd.result)}}(a);return _(d,n.promise(),2)}return d.return(r)})},a_.prototype.destroy=function(){return this.g.destroy()},a_.prototype.getAll=function(){var e,t,n=this;return N(function(i){return 1==i.g?(e=JT(n.g,"session-ids","readonly"),t=[],_(i,XT(e,function(e,n){t.push(n)}),2)):3!=i.g?_(i,e.promise(),3):i.return(t)})},a_.prototype.add=function(e){var t=ZT(this.g,"session-ids"),n=t.store();e=c(e);for(var i=e.next();!i.done;i=e.next())n.add(i.value);return t.promise()},a_.prototype.remove=function(e){var t,n=this;return N(function(i){return 1==i.g?(t=ZT(n.g,"session-ids"),_(i,XT(t,function(t,n,i){e.includes(n.sessionId)&&i.delete()}),2)):_(i,t.promise(),0)})},s_.prototype.destroy=function(){for(var e=[],t=c(this.g.values()),n=t.next();!n.done;n=t.next())e.push(n.value.destroy());return this.g.clear(),Promise.all(e)},s_.prototype.init=function(){var e=this;p_.forEach(function(t,n){(t=t())&&e.g.set(n,t)});for(var t=[],n=c(this.g.values()),i=n.next();!i.done;i=n.next())t.push(i.value.init());return Promise.all(t)},z("shaka.offline.StorageMuxer",s_),s_.unregister=function(e){p_.delete(e)},s_.register=f_,s_.prototype.destroy=s_.prototype.destroy;var p_=new Map;function g_(){e_.apply(this,arguments)}function m_(e,t){b_(e);for(var n=c(e.streams),i=n.next();!i.done;i=n.next());return e.streams.map(function(n){return v_(n,e.startTime,t)})}function v_(e,t,n){var i=e.initSegmentUri?y_(e.initSegmentUri):null,r=t+e.presentationTimeOffset,a=t+n;return{id:e.id,originalId:null,groupId:null,primary:e.primary,type:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:void 0,hdr:void 0,colorGamut:void 0,videoLayout:void 0,kind:e.kind,language:e.language,originalLanguage:e.language||null,label:e.label,width:e.width,height:e.height,initSegmentKey:i,encrypted:e.encrypted,keyIds:new Set([e.keyId]),segments:e.segments.map(function(e){var n=y_(e.uri);return{startTime:t+e.startTime,endTime:t+e.endTime,dataKey:n,initSegmentKey:i,appendWindowStart:t,appendWindowEnd:a,timestampOffset:r,tilesLayout:"",mimeType:null,codecs:null}}),variantIds:e.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0,external:!1,fastSwitching:!1}}function y_(e){var t;if((t=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e))||(t=/^offline:segment\/([0-9]+)$/.exec(e)))return Number(t[1]);throw new It(2,9,9004,"Could not parse uri "+e)}function b_(e){var t=e.streams.filter(function(e){return"audio"==e.contentType});if(e=e.streams.filter(function(e){return"video"==e.contentType}),!t.every(function(e){return e.variantIds})||!e.every(function(e){return e.variantIds})){for(var n=c(t),i=n.next();!i.done;i=n.next())i.value.variantIds=[];for(n=c(e),i=n.next();!i.done;i=n.next())i.value.variantIds=[];if(n=0,e.length&&!t.length){var r=n++,a=c(e);for(i=a.next();!i.done;i=a.next())i.value.variantIds.push(r)}if(!e.length&&t.length)for(r=n++,a=c(t),i=a.next();!i.done;i=a.next())i.value.variantIds.push(r);if(e.length&&t.length)for(t=c(t),i=t.next();!i.done;i=t.next())for(i=i.value,r=c(e),a=r.next();!a.done;a=r.next()){a=a.value;var s=n++;i.variantIds.push(s),a.variantIds.push(s)}}}function S_(){e_.apply(this,arguments)}function T_(e,t,n){return{id:e.id,originalId:e.originalId,groupId:null,primary:e.primary,type:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:e.pixelAspectRatio,hdr:void 0,colorGamut:void 0,videoLayout:void 0,kind:e.kind,language:e.language,originalLanguage:e.language||null,label:e.label,width:e.width,height:e.height,encrypted:e.encrypted,keyIds:new Set([e.keyId]),segments:e.segments.map(function(i){return{startTime:t+i.startTime,endTime:t+i.endTime,initSegmentKey:e.initSegmentKey,appendWindowStart:t,appendWindowEnd:n,timestampOffset:t-e.presentationTimeOffset,dataKey:i.dataKey,tilesLayout:"",mimeType:null,codecs:null}}),variantIds:e.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0,external:!1,fastSwitching:!1}}function __(){e_.apply(this,arguments)}function w_(){this.m=this.j=this.i=this.h=this.g=this.l=null}function E_(){var t=new Ir,n=e.indexedDB.deleteDatabase("shaka_offline_db");return n.onblocked=function(){},n.onsuccess=function(){t.resolve()},n.onerror=function(e){t.reject(new It(2,9,9001,n.error)),e.preventDefault()},t}function x_(e,t,n,i){this.g=e,this.i=t,this.h=n,this.l=i,this.j=["offline:",e,"/",t,"/",n,"/",i].join("")}function A_(e){if(e=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e),null==e)return null;var t=e[1];if("manifest"!=t&&"segment"!=t)return null;var n=e[2];if(!n)return null;var i=e[3];return i&&null!=t?new x_(t,n,i,Number(e[4])):null}function k_(e,t){this.h=e,this.g=t}function I_(e,t){var n=new Ll(null,0);n.$a(t.duration);var i=t.streams.filter(function(e){return"audio"==e.type}),r=t.streams.filter(function(e){return"video"==e.type});i=C_(e,i,r,n),r=t.streams.filter(function(e){return e.type==Ln}).map(function(t){return R_(e,t,n)});var a=t.streams.filter(function(e){return"image"==e.type}).map(function(t){return R_(e,t,n)}),s=t.drmInfo?[t.drmInfo]:[];if(t.drmInfo)for(var o=c(i.values()),l=o.next();!l.done;l=o.next())l=l.value,l.audio&&l.audio.encrypted&&(l.audio.drmInfos=s),l.video&&l.video.encrypted&&(l.video.drmInfos=s);return{presentationTimeline:n,minBufferTime:2,offlineSessionIds:t.sessionIds,variants:Array.from(i.values()),textStreams:r,imageStreams:a,sequenceMode:t.sequenceMode||!1,ignoreManifestTimestampsInSegmentsMode:!1,type:t.type||"UNKNOWN",serviceDescription:null,nextUrl:null,periodCount:1,gapCount:0,isLowLatency:!1}}function C_(e,t,n,i){for(var r=new Set,a=c(t),s=a.next();!s.done;s=a.next()){var o=c(s.value.variantIds);for(s=o.next();!s.done;s=o.next())r.add(s.value)}for(a=c(n),s=a.next();!s.done;s=a.next())for(o=c(s.value.variantIds),s=o.next();!s.done;s=o.next())r.add(s.value);for(a=new Map,r=c(r),s=r.next();!s.done;s=r.next())s=s.value,a.set(s,{id:s,language:"",disabledUntilTime:0,primary:!1,audio:null,video:null,bandwidth:0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});for(t=c(t),r=t.next();!r.done;r=t.next())for(r=r.value,s=R_(e,r,i),o=c(r.variantIds),r=o.next();!r.done;r=o.next())r=a.get(r.value),r.language=s.language,r.primary=r.primary||s.primary,r.audio=s;for(n=c(n),t=n.next();!t.done;t=n.next())for(r=t.value,t=R_(e,r,i),s=c(r.variantIds),r=s.next();!r.done;r=s.next())r=a.get(r.value),r.primary=r.primary||t.primary,r.video=t;return a}function R_(e,t,n){var i=t.segments.map(function(n){return M_(e,n,t)});return n.Jd(i),{id:t.id,originalId:t.originalId,groupId:t.groupId,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new tu(i),mimeType:t.mimeType,codecs:t.codecs,width:t.width||void 0,height:t.height||void 0,frameRate:t.frameRate,pixelAspectRatio:t.pixelAspectRatio,hdr:t.hdr,colorGamut:t.colorGamut,videoLayout:t.videoLayout,kind:t.kind,encrypted:t.encrypted,drmInfos:[],keyIds:t.keyIds,language:t.language,originalLanguage:t.originalLanguage||null,label:t.label,type:t.type,primary:t.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:t.roles,forced:t.forced,channelsCount:t.channelsCount,audioSamplingRate:t.audioSamplingRate,spatialAudio:t.spatialAudio,closedCaptions:t.closedCaptions,tilesLayout:t.tilesLayout,accessibilityPurpose:null,external:t.external,fastSwitching:t.fastSwitching,fullMimeTypes:new Set([Fn(t.mimeType,t.codecs)])}}function M_(e,t,n){var i=new x_("segment",e.h,e.g,t.dataKey);return e=new Qs(t.startTime,t.endTime,function(){return[i.toString()]},0,null,null!=t.initSegmentKey?D_(e,t.initSegmentKey):null,t.timestampOffset,t.appendWindowStart,t.appendWindowEnd,[],t.tilesLayout||""),e.mimeType=t.mimeType||n.mimeType||"",e.codecs=t.codecs||n.codecs||"",e}function D_(e,t){var n=new x_("segment",e.h,e.g,t);return new Ys(function(){return[n.toString()]},0,null)}function L_(){this.g=null}function P_(){}function O_(e){var t=A_(e);return t&&"manifest"==t.g?(e={uri:e,originalUri:e,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}},e=Dr(e)):e=t&&"segment"==t.g?N_(t.key(),t):Rr(new It(2,1,9004,e)),e}function N_(e,t){var n=new s_;return Dr(void 0).Aa(function(){return n.init()}).Aa(function(){return u_(n,t.ob(),t.Ja())}).Aa(function(e){return e.getSegments([t.key()])}).Aa(function(e){return{uri:t,data:e[0].data,headers:{}}}).finally(function(){return n.destroy()})}function U_(e,t,n){var i,r,a,s,o,l;return N(function(u){switch(u.g){case 1:i=[];for(var d=[],h=c(n),f=h.next();!f.done;f=h.next()){f=f.value;for(var p=!1,g=c(d),m=g.next();!m.done;m=g.next())if(m=m.value,B_(m.info,f)){m.sessionIds.push(f.sessionId),p=!0;break}p||d.push({info:f,sessionIds:[f.sessionId]})}r=c(d),a=r.next();case 2:if(a.done){u.u(4);break}return s=a.value,o=F_(e,t,s),_(u,o,5);case 5:l=u.h,i=i.concat(l),a=r.next(),u.u(2);break;case 4:return u.return(i)}})}function F_(e,t,n){var i,r;return N(function(a){switch(a.g){case 1:return i=new Ja({Nb:t,onError:function(){},Ae:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),E(a,2),i.configure(e),_(a,is(i,n.info.keySystem,n.info.licenseUri,n.info.serverCertificate,n.info.audioCapabilities,n.info.videoCapabilities),4);case 4:A(a,3);break;case 2:return k(a),_(a,i.destroy(),5);case 5:return a.return([]);case 3:return r=[],_(a,Promise.all(n.sessionIds.map(function(e){return N(function(t){return 1==t.g?(E(t,2),_(t,ls(i,e),4)):2!=t.g?(r.push(e),A(t,0)):(k(t),void w(t))})})),6);case 6:return _(a,i.destroy(),7);case 7:return a.return(r)}})}function B_(e,t){function n(e,t){return e.robustness==t.robustness&&e.contentType==t.contentType}return e.keySystem==t.keySystem&&e.licenseUri==t.licenseUri&&Ue(e.audioCapabilities,t.audioCapabilities,n)&&Ue(e.videoCapabilities,t.videoCapabilities,n)}function V_(e,t,n){var i=t.presentationTimeline.getDuration();return t=G_(t),{offlineUri:null,originalManifestUri:e,duration:i,size:0,expiration:1/0,tracks:t,appMetadata:n,isIncomplete:!1}}function j_(e,t){var n=I_(new k_(e.ob(),e.Ja()),t),i=t.appMetadata||{};return n=G_(n),{offlineUri:e.toString(),originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:t.expiration,tracks:n,appMetadata:i,isIncomplete:t.isIncomplete||!1}}function G_(e){var t=[],n=Wi(e.variants);n=c(n);for(var i=n.next();!i.done;i=n.next())t.push(Bi(i.value));for(e=c(e.textStreams),n=e.next();!n.done;n=e.next())t.push(Vi(n.value));return t}function H_(){this.g={}}function z_(e,t){var n=t.audio,i=t.video;if(n&&!i&&(e.g[n.id]=n.bandwidth||t.bandwidth),!n&&i&&(e.g[i.id]=i.bandwidth||t.bandwidth),n&&i){var r=n.bandwidth||393216,a=i.bandwidth||t.bandwidth-r;0>=a&&(a=t.bandwidth),e.g[n.id]=r,e.g[i.id]=a}}function K_(e,t){e.g[t.id]=t.bandwidth||2048}function $_(e,t){return e=e.g[t],null==e&&(e=0),e}function W_(e){var t=this;if(e&&e.constructor!=eh)throw new It(2,9,9008);this.g=this.h=null,e?(this.h=e.g,this.g=e.zb()):(this.h=Lc(),this.g=new Gr),this.i=[],this.j=[];var n=!e;this.l=new ta(function(){var e,i,r,a,s;return N(function(o){switch(o.g){case 1:return _(o,Promise.all(t.j.map(function(e){return KT(e)})),2);case 2:for(e=function(){},i=[],r=c(t.i),a=r.next();!a.done;a=r.next())s=a.value,i.push(s.then(e,e));return _(o,Promise.all(i),3);case 3:if(!n){o.u(4);break}return _(o,t.g.destroy(),4);case 4:t.h=null,t.g=null,w(o)}})})}function q_(){if(Ft())e:{for(var e=c(p_.values()),t=e.next();!t.done;t=e.next())if(t=t.value,t=t()){t.destroy(),e=!0;break e}e=!1}else e=!1;return e}function Y_(e,t,n,i,r,a){var s,o,l,u,c,d,h,f,p,g,m,v,y,b;return N(function(S){switch(S.g){case 1:return gw(),o=s=null,l=new s_,d=c=u=null,E(S,2,3),_(S,i(),5);case 5:return s=S.h,_(S,cw(e,t,s,r),6);case 6:if(h=S.h,pw(e),f=!h.presentationTimeline.V()&&!h.presentationTimeline.qc(),!f)throw new It(2,9,9005,t);return _(S,e.Dc(h,function(e){d=d||e},r),7);case 7:if(o=S.h,pw(e),d)throw d;return _(S,J_(h,o,r),8);case 8:return _(S,l.init(),9);case 9:return pw(e),_(S,o_(l),10);case 10:return u=S.h,pw(e),p=ew(o,h,t,n,r,a),g=p.Bi,m=p.lg,_(S,u.Ja.addManifests([g]),11);case 11:if(v=S.h,pw(e),c=v[0],pw(e),d)throw d;return _(S,X_(e,m,c,g,a,r,u.Ja,h,o),12);case 12:return pw(e),iw(h,g,o,r),_(S,u.Ja.updateManifest(c,g),13);case 13:return pw(e),y=new x_("manifest",u.path.ob,u.path.Ja,c),S.return(j_(y,g));case 3:return I(S),_(S,l.destroy(),14);case 14:if(!s){S.u(15);break}return _(S,s.stop(),15);case 15:if(!o){S.u(17);break}return _(S,o.destroy(),17);case 17:C(S,0);break;case 2:if(b=k(S),null==c){S.u(19);break}return _(S,Q_(c),19);case 19:throw d||b}})}function X_(e,t,n,i,r,a,s,o,l){var u,d,h,f,p,g,m,v,y,b;return N(function(S){switch(S.g){case 1:if(u={},d=0,h=function(t,h){var f,p,g,m,v,y,b;return N(function(S){if(1==S.g){for(f={},p=c(t),g=p.next();!g.done;f={ic:f.ic},g=p.next())f.ic=g.value,m=VT(f.ic,a),v=f.ic.i,y=f.ic.h,b=function(t){return function(n){var i,r,a;return N(function(o){if(1==o.g)return _(o,s.addSegments([{data:n}]),2);i=o.h,pw(e),r=t.ic.g,a=BT(r),u[a]=i[0],d+=n.byteLength,w(o)})}}(f),$T(r,f.ic.groupId,m,v,y,b);return _(S,WT(r),2)}return h?(pw(e),iw(o,i,l,a),_(S,s.updateManifest(n,i),0)):S.u(0)})},f=!1,E(S,2),!tw(o)||!f||nw(o)){S.u(4);break}return _(S,h(t.filter(function(e){return e.h}),!0),5);case 5:return pw(e),t=t.filter(function(e){return!e.h}),p=u,g=d,u={},d=0,_(S,Z_(s,n,i,p,g,function(){return pw(e)}),6);case 6:pw(e);case 4:if(f){S.u(7);break}return _(S,h(t,!1),8);case 8:return pw(e),m=u,v=d,u={},d=0,_(S,Z_(s,n,i,m,v,function(){return pw(e)}),9);case 9:pw(e);case 7:A(S,0);break;case 2:return y=k(S),b=Object.values(u),_(S,s.removeSegments(b,function(){}),10);case 10:throw y}})}function Q_(e){var t,n,i,r;return N(function(a){switch(a.g){case 1:return t=new s_,_(a,t.init(),2);case 2:return _(a,o_(t),3);case 3:return n=a.h,i=new x_("manifest",n.path.ob,n.path.Ja,e),_(a,t.destroy(),4);case 4:return r=new W_,_(a,r.remove(i.toString()),0)}})}function Z_(e,t,n,i,r,a){var s,o,l,u,d,h,f,p,g,m,v;return N(function(y){switch(y.g){case 1:for(s=!1,E(y,2),o=!0,l=c(n.streams),u=l.next();!u.done;u=l.next())for(d=u.value,h=c(d.segments),f=h.next();!f.done;f=h.next())p=f.value,g=p.pendingSegmentRefId?i[p.pendingSegmentRefId]:null,null!=g&&(p.dataKey=g,p.pendingSegmentRefId=void 0),g=p.pendingInitSegmentRefId?i[p.pendingInitSegmentRefId]:null,null!=g&&(p.initSegmentKey=g,p.pendingInitSegmentRefId=void 0),p.pendingSegmentRefId&&(o=!1),p.pendingInitSegmentRefId&&(o=!1);return n.size+=r,o&&(n.isIncomplete=!1),_(y,e.updateManifest(t,n),4);case 4:s=!0,a(),A(y,0);break;case 2:return m=k(y),_(y,Q_(t),5);case 5:if(s){y.u(6);break}return v=Object.values(i),_(y,e.removeSegments(v,function(){}),6);case 6:throw m}})}function J_(e,t,n){var i,r,a,s,o,l,u,d,h,f,p,g,m,v,y,b,S,T,x,I,C,R,M,D,L,P,O,U;return N(function(N){switch(N.g){case 1:return i={width:1/0,height:1/0},wi(e,n.restrictions,i),_(N,ki(t,e,n.offline.usePersistentLicense,n.drm.preferredKeySystems),2);case 2:for(r=[],a=n.preferredDecodingAttributes,s=n.preferredVideoCodecs,o=n.preferredAudioCodecs,Ti(e,s,o,a),l=c(e.variants),u=l.next();!u.done;u=l.next())d=u.value,r.push(Bi(d));for(h=c(e.textStreams),f=h.next();!f.done;f=h.next())p=f.value,r.push(Vi(p));for(g=c(e.imageStreams),m=g.next();!m.done;m=g.next())v=m.value,r.push(ji(v));return _(N,n.offline.trackSelectionCallback(r),3);case 3:for(y=N.h,b=e.presentationTimeline.getDuration(),S=0,T=c(y),x=T.next();!x.done;x=T.next())I=x.value,C=I.bandwidth*b/8,S+=C;return E(N,4),_(N,n.offline.downloadSizeCallback(S),6);case 6:if(R=N.h,!R)throw new It(2,9,9014);A(N,5);break;case 4:if(M=k(N),M instanceof It)throw M;throw new It(2,9,9015);case 5:for(D=new Set,L=new Set,P=new Set,O=c(y),x=O.next();!x.done;x=O.next())U=x.value,"variant"==U.type&&D.add(U.id),"text"==U.type&&L.add(U.id),"image"==U.type&&P.add(U.id);e.variants=e.variants.filter(function(e){return D.has(e.id)}),e.textStreams=e.textStreams.filter(function(e){return L.has(e.id)}),e.imageStreams=e.imageStreams.filter(function(e){return P.has(e.id)}),Tw(e),w(N)}})}function ew(e,t,n,i,r,a){var s=V_(n,t,i),o=r.offline.progressCallback;zT(a,function(e,t){s.size=t,o(s,e)},function(t,n){l&&r.offline.usePersistentLicense&&u==n&&cs(e,"cenc",t)});var l=tw(t)&&!nw(t),u=null;l&&(u=_w.get(e.g.keySystem));for(var d=new H_,h=c(t.textStreams),f=h.next();!f.done;f=h.next())d.g[f.value.id]=52;for(h=c(t.imageStreams),f=h.next();!f.done;f=h.next())K_(d,f.value);for(f=c(t.variants),h=f.next();!h.done;h=f.next())z_(d,h.value);return d=dw(a,d,t,r),a=d.streams,d=d.lg,f=e.g,h=r.offline.usePersistentLicense,f&&h&&(f.initData=[]),{Bi:{creationTime:Date.now(),originalManifestUri:n,duration:t.presentationTimeline.getDuration(),size:0,expiration:e.td(),streams:a,sessionIds:h?ds(e):[],drmInfo:f,appMetadata:i,isIncomplete:!0,sequenceMode:t.sequenceMode,type:t.type},lg:d}}function tw(e){return e.variants.some(function(e){var t=e.audio&&e.audio.encrypted;return e.video&&e.video.encrypted||t})}function nw(e){return e.variants.some(function(e){return(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[]).some(function(e){return e.initData&&e.initData.length})})}function iw(e,t,n,i){if(t.expiration=n.td(),n=ds(n),t.sessionIds=i.offline.usePersistentLicense?n:[],tw(e)&&i.offline.usePersistentLicense&&!n.length)throw new It(2,9,9007)}function rw(e,t){var n,i,r,a,s,o;return N(function(l){switch(l.g){case 1:if(gw(),n=A_(t),null==n||"manifest"!=n.g)throw new It(2,9,9004,t);return i=n,r=new s_,x(l,2),_(l,r.init(),4);case 4:return _(l,u_(r,i.ob(),i.Ja()),5);case 5:return a=l.h,_(l,a.getManifests([i.key()]),6);case 6:return s=l.h,o=s[0],_(l,Promise.all([sw(e,o,r),ow(a,i,o)]),2);case 2:return I(l),_(l,r.destroy(),8);case 8:C(l,0)}})}function aw(e,t){for(var n=[],i=c(e.streams),r=i.next();!r.done;r=i.next())r=r.value,t&&"video"==r.type?n.push({contentType:Fn(r.mimeType,r.codecs),robustness:e.drmInfo.videoRobustness}):t||"audio"!=r.type||n.push({contentType:Fn(r.mimeType,r.codecs),robustness:e.drmInfo.audioRobustness});return n}function sw(e,t,n){return N(function(i){return _(i,bw(e.g,e.h.drm,n,t),0)})}function ow(e,t,n){function i(){}var r=yw(n);return j_(t,n),Promise.all([e.removeSegments(r,i),e.removeManifests([t.key()],i)])}function lw(e){var t,n,i,r,a,s,o,l,u,d;return N(function(h){switch(h.g){case 1:return gw(),t=e.g,n=e.h.drm,i=new s_,r=!1,x(h,2),_(h,i.init(),4);case 4:a=[],c_(i,function(e){return a.push(e)}),s=c(a),o=s.next();case 5:if(o.done){h.u(2);break}return l=o.value,_(h,l.getAll(),8);case 8:return u=h.h,_(h,U_(n,t,u),9);case 9:return d=h.h,_(h,l.remove(d),10);case 10:d.length!=u.length&&(r=!0),o=s.next(),h.u(5);break;case 2:return I(h),_(h,i.destroy(),11);case 11:C(h,3);break;case 3:return h.return(!r)}})}function uw(){var e,t,n;return N(function(i){switch(i.g){case 1:return gw(),e=[],t=new s_,x(i,2),_(i,t.init(),4);case 4:return n=Promise.resolve(),l_(t,function(t,i){n=n.then(function(){var n;return N(function(r){if(1==r.g)return _(r,i.getAllManifests(),2);n=r.h,n.forEach(function(n,i){n=j_(new x_("manifest",t.ob,t.Ja,i),n),e.push(n)}),w(r)})})}),_(i,n,2);case 2:return I(i),_(i,t.destroy(),6);case 6:C(i,3);break;case 3:return i.return(e)}})}function cw(e,t,n,i){var r,a,s,o,l;return N(function(u){if(1==u.g)return r=null,a=e.g,s={networkingEngine:a,filter:function(){return Promise.resolve()},makeTextStreamsForClosedCaptions:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(e){r=e},isLowLatencyMode:function(){return!1},isAutoLowLatencyMode:function(){return!1},enableLowLatencyMode:function(){},updateDuration:function(){},newDrmInfo:function(){},onManifestUpdated:function(){},getBandwidthEstimate:function(){return i.abr.defaultBandwidthEstimate},onMetadata:function(){},disableStream:function(){}},n.configure(i.manifest),pw(e),_(u,n.start(t,s),2);if(3!=u.g)return o=u.h,pw(e),l=Sw(o),_(u,Promise.all(ia(l,function(e){return e.createSegmentIndex()})),3);if(pw(e),r)throw r;return u.return(o)})}function dw(e,t,n,i){var r=new Map,a=Sw(n),s=new Map;a=c(a);for(var o=a.next();!o.done;o=a.next()){o=o.value;var l=hw(e,t,n,o,i,r);s.set(o.id,l)}for(e=c(n.variants),t=e.next();!t.done;t=e.next())t=t.value,t.audio&&s.get(t.audio.id).variantIds.push(t.id),t.video&&s.get(t.video.id).variantIds.push(t.id);return{streams:Array.from(s.values()),lg:Array.from(r.values())}}function hw(e,t,n,i,r,a){var s={id:i.id,originalId:i.originalId,groupId:i.groupId,primary:i.primary,type:i.type,mimeType:i.mimeType,codecs:i.codecs,frameRate:i.frameRate,pixelAspectRatio:i.pixelAspectRatio,hdr:i.hdr,colorGamut:i.colorGamut,videoLayout:i.videoLayout,kind:i.kind,language:i.language,originalLanguage:i.originalLanguage,label:i.label,width:i.width||null,height:i.height||null,encrypted:i.encrypted,keyIds:i.keyIds,segments:[],variantIds:[],roles:i.roles,forced:i.forced,channelsCount:i.channelsCount,audioSamplingRate:i.audioSamplingRate,spatialAudio:i.spatialAudio,closedCaptions:i.closedCaptions,tilesLayout:i.tilesLayout,external:i.external,fastSwitching:i.fastSwitching},o=r.offline.numberOfParallelDownloads,l=0;return fw(i,n.presentationTimeline.nb(),function(n){var r=BT(n),u=void 0;if(!a.has(r)){var c=n.endTime-n.startTime;c=$_(t,i.id)*c,c=GT(e.g,c),a.set(r,new FT(n,c,l,!1))}n.$&&(u=BT(n.$),a.has(u)||(c=.5*$_(t,i.id),c=GT(e.g,c),a.set(u,new FT(n.$,c,l,!0)))),s.segments.push({pendingInitSegmentRefId:u,initSegmentKey:u?0:null,startTime:n.startTime,endTime:n.endTime,appendWindowStart:n.appendWindowStart,appendWindowEnd:n.appendWindowEnd,timestampOffset:n.timestampOffset,tilesLayout:n.tilesLayout,pendingSegmentRefId:r,dataKey:0,mimeType:n.mimeType,codecs:n.codecs}),l=(l+1)%o}),s}function fw(e,t,n){if(t=e.segmentIndex.find(t),null!=t)for(var i=e.segmentIndex.get(t);i;)n(i),i=e.segmentIndex.get(++t)}function pw(e){if(e.l.g)throw new It(2,9,7001)}function gw(){if(!q_())throw new It(2,9,9e3)}function mw(e,t){return N(function(n){return 1==n.g?(e.i.push(t),x(n,2),_(n,t,4)):2!=n.g?n.return(n.h):(I(n),Ne(e.i,t),C(n,0))})}function vw(e,t){var n=t.promise;return e.i.push(n),t.finally(function(){Ne(e.i,n)})}function yw(e){var t=new Set;e=c(e.streams);for(var n=e.next();!n.done;n=e.next()){n=c(n.value.segments);for(var i=n.next();!i.done;i=n.next())i=i.value,null!=i.initSegmentKey&&t.add(i.initSegmentKey),t.add(i.dataKey)}return Array.from(t)}function bw(e,t,n,i){var r,a,s;return N(function(o){return 1==o.g?i.drmInfo?(r=d_(n),a=i.sessionIds.map(function(e){return{sessionId:e,keySystem:i.drmInfo.keySystem,licenseUri:i.drmInfo.licenseServerUri,serverCertificate:i.drmInfo.serverCertificate,audioCapabilities:aw(i,!1),videoCapabilities:aw(i,!0)}}),_(o,U_(t,e,a),2)):o.return():3!=o.g?(s=o.h,_(o,r.remove(s),3)):_(o,r.add(a.filter(function(e){return!s.includes(e.sessionId)})),0)})}function Sw(e){for(var t=new Set,n=c(e.textStreams),i=n.next();!i.done;i=n.next())t.add(i.value);for(n=c(e.imageStreams),i=n.next();!i.done;i=n.next())t.add(i.value);for(e=c(e.variants),n=e.next();!n.done;n=e.next())n=n.value,n.audio&&t.add(n.audio),n.video&&t.add(n.video);return t}function Tw(e){e.variants.map(function(e){return e.video});var t=new Set(e.variants.map(function(e){return e.audio}));e=e.textStreams;for(var n=c(t),i=n.next();!i.done;i=n.next()){i=c(t);for(var r=i.next();!r.done;r=i.next());}for(t=c(e),n=t.next();!n.done;n=t.next())for(n=c(e),i=n.next();!i.done;i=n.next());}y(g_,e_),g_.prototype.updateManifestExpiration=function(e,t){var n,i,r,a=this;return N(function(s){return n=ZT(a.h,a.g),i=n.store(),r=new Ir,i.get(e).onsuccess=function(n){(n=n.target.result)?(n.expiration=t,i.put(n),r.resolve()):r.reject(new It(2,9,9012,"Could not find values for "+e))},_(s,Promise.all([n.promise(),r]),0)})},g_.prototype.od=function(e){var t,n,i,r,a,s;return N(function(o){if(1==o.g){for(t=[],n=0;n<e.periods.length;++n)i=n==e.periods.length-1?e.duration:e.periods[n+1].startTime,r=i-e.periods[n].startTime,a=m_(e.periods[n],r),t.push(a);return _(o,Fv(t),2)}return s=o.h,o.return({creationTime:0,originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:null==e.expiration?1/0:e.expiration,streams:s,sessionIds:e.sessionIds,drmInfo:e.drmInfo,appMetadata:e.appMetadata,sequenceMode:!1})})},g_.prototype.Cg=function(e){return{data:e.data}},y(S_,e_),S_.prototype.od=function(e){var t,n,i,r,a,s;return N(function(o){if(1==o.g){for(t=[],n=0;n<e.periods.length;++n){i=n==e.periods.length-1?e.duration:e.periods[n+1].startTime,r=i-e.periods[n].startTime;for(var l=e.periods[n],u=[],d=c(l.streams),h=d.next();!h.done;h=d.next())h=h.value,0!=h.variantIds.length&&u.push(T_(h,l.startTime,l.startTime+r));a=u,t.push(a)}return _(o,Fv(t),2)}return s=o.h,o.return({appMetadata:e.appMetadata,creationTime:0,drmInfo:e.drmInfo,duration:e.duration,expiration:null==e.expiration?1/0:e.expiration,originalManifestUri:e.originalManifestUri,sessionIds:e.sessionIds,size:e.size,streams:s,sequenceMode:!1})})},y(__,e_),i=__.prototype,i.hasFixedKeySpace=function(){return!1},i.addSegments=function(e){return this.add(this.i,e)},i.addManifests=function(e){return this.add(this.g,e)},i.updateManifest=function(e,t){return t_(this,e,t)},i.od=function(e){return null==e.expiration&&(e.expiration=1/0),Promise.resolve(e)},i=w_.prototype,i.init=function(){var t=this,n=new Ir,i=!1,r=new Ut(function(){i=!0,n.reject(new It(2,9,9017))});r.Y(5);var a=e.indexedDB.open("shaka_offline_db",5);return a.onsuccess=function(){if(!i){var e=a.result;t.l=e;var s=e.objectStoreNames;s=s.contains("manifest")&&s.contains("segment")?new g_(e,"segment","manifest"):null,t.g=s,s=e.objectStoreNames,s=s.contains("manifest-v2")&&s.contains("segment-v2")?new S_(e,"segment-v2","manifest-v2"):null,t.h=s,s=e.objectStoreNames,s=s.contains("manifest-v3")&&s.contains("segment-v3")?new S_(e,"segment-v3","manifest-v3"):null,t.i=s,s=e.objectStoreNames,s=s.contains("manifest-v5")&&s.contains("segment-v5")?new __(e,"segment-v5","manifest-v5"):null,t.j=s,e=e.objectStoreNames.contains("session-ids")?new a_(e):null,t.m=e,r.stop(),n.resolve()}},a.onupgradeneeded=function(){for(var e=a.result,t=c(["segment-v5","manifest-v5","session-ids"]),n=t.next();!n.done;n=t.next())n=n.value,e.objectStoreNames.contains(n)||e.createObjectStore(n,{autoIncrement:!0})},a.onerror=function(e){i||(n.reject(new It(2,9,9001,a.error)),r.stop(),e.preventDefault())},n},i.destroy=function(){var e=this;return N(function(t){switch(t.g){case 1:if(!e.g){t.u(2);break}return _(t,e.g.destroy(),2);case 2:if(!e.h){t.u(4);break}return _(t,e.h.destroy(),4);case 4:if(!e.i){t.u(6);break}return _(t,e.i.destroy(),6);case 6:if(!e.j){t.u(8);break}return _(t,e.j.destroy(),8);case 8:if(!e.m){t.u(10);break}return _(t,e.m.destroy(),10);case 10:e.l&&e.l.close(),w(t)}})},i.getCells=function(){var e=new Map;return this.g&&e.set("v1",this.g),this.h&&e.set("v2",this.h),this.i&&e.set("v3",this.i),this.j&&e.set("v5",this.j),e},i.getEmeSessionCell=function(){return this.m},i.erase=function(){var e=this;return N(function(t){switch(t.g){case 1:if(!e.g){t.u(2);break}return _(t,e.g.destroy(),2);case 2:if(!e.h){t.u(4);break}return _(t,e.h.destroy(),4);case 4:if(!e.i){t.u(6);break}return _(t,e.i.destroy(),6);case 6:if(!e.j){t.u(8);break}return _(t,e.j.destroy(),8);case 8:return e.l&&e.l.close(),_(t,E_(),10);case 10:return e.l=null,e.g=null,e.h=null,e.i=null,e.j=null,_(t,e.init(),0)}})},f_("idb",function(){return Wt()||jt()||!e.indexedDB?null:new w_}),x_.prototype.ob=function(){return this.i},x_.prototype.Ja=function(){return this.h},x_.prototype.key=function(){return this.l},x_.prototype.toString=function(){return this.j},i=L_.prototype,i.configure=function(){},i.start=function(e,t){var n,i,r,a,s,o,l,u=this;return N(function(c){switch(c.g){case 1:if(n=A_(e),u.g=n,null==n||"manifest"!=n.g)throw new It(2,1,9004,e);return i=new s_,x(c,2),_(c,i.init(),4);case 4:return _(c,u_(i,n.ob(),n.Ja()),5);case 5:return r=c.h,_(c,r.getManifests([n.key()]),6);case 6:return a=c.h,s=a[0],o=new k_(n.ob(),n.Ja()),l=I_(o,s),t.makeTextStreamsForClosedCaptions(l),c.return(l);case 2:return I(c),_(c,i.destroy(),7);case 7:C(c,0)}})},i.stop=function(){return Promise.resolve()},i.update=function(){},i.onExpirationUpdated=function(e,t){var n,i,r,a,s,o,l,u=this;return N(function(c){switch(c.g){case 1:return n=u.g,i=new s_,E(c,2,3),_(c,i.init(),5);case 5:return _(c,u_(i,n.ob(),n.Ja()),6);case 6:return r=c.h,_(c,r.getManifests([n.key()]),7);case 7:if(a=c.h,s=a[0],o=s.sessionIds.includes(e),l=void 0==s.expiration||s.expiration>t,!o||!l){c.u(3);break}return _(c,r.updateManifestExpiration(n.key(),t),3);case 3:return I(c),_(c,i.destroy(),10);case 10:C(c,0);break;case 2:k(c),c.u(3)}})},i.onInitialVariantChosen=function(){},i.banLocation=function(){},i.setMediaElement=function(){},zs["application/x-offline-manifest"]=function(){return new L_},z("shaka.offline.OfflineScheme",P_),P_.plugin=O_,Hr("offline",O_),i=W_.prototype,i.destroy=function(){return this.l.destroy()},i.configure=function(e,t){return 2==arguments.length&&"string"==typeof e&&(e=Ec(e,t)),Pc(this.h,e)},i.getConfiguration=function(){var e=Lc();return Pc(e,this.h,Lc()),e},i.zb=function(){return this.g},i.store=function(e,t,n){var i=this,r=this.getConfiguration(),a=new HT(this.g);return this.j.push(a),t=Y_(this,e,t||{},function(){var t;return N(function(a){return 1==a.g?n?a.u(2):_(a,rd(e,i.g,r.manifest.retryParameters),3):(2!=a.g&&(n=a.h),t=Hs(e,n||null),a.return(t()))})},r,a),t=new Cr(t,function(){return KT(a)}),t.finally(function(){Ne(i.j,a)}),vw(this,t)},i.remove=function(e){return mw(this,rw(this,e))},i.Si=function(){return mw(this,lw(this))},i.list=function(){return mw(this,uw())},i.Dc=function(e,t,n){var i,r=this;return N(function(a){return 1==a.g?(i=new Ja({Nb:r.g,onError:t,Ae:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),i.configure(n.drm),_(a,ts(i,e.variants,n.offline.usePersistentLicense),2)):3!=a.g?_(a,us(i),3):a.return(i)})},z("shaka.offline.Storage",W_),W_.deleteAll=function(){var e;return N(function(t){return 1==t.g?(e=new s_,x(t,2),_(t,h_(e),2)):5!=t.g?(I(t),_(t,e.destroy(),5)):C(t,0)})},W_.prototype.list=W_.prototype.list,W_.prototype.removeEmeSessions=W_.prototype.Si,W_.prototype.remove=W_.prototype.remove,W_.prototype.store=W_.prototype.store,W_.prototype.getNetworkingEngine=W_.prototype.zb,W_.prototype.getConfiguration=W_.prototype.getConfiguration,W_.prototype.configure=W_.prototype.configure,W_.prototype.destroy=W_.prototype.destroy,W_.support=q_;var _w=(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.recommendation","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.software","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.hardware","9a04f07998404286ab92e65be0885f95");function ww(){}function Ew(e,t){for(e={priority:t||0,callback:e},t=0;t<xw.length;t++)if(xw[t].priority<e.priority)return void xw.splice(t,0,e);xw.push(e)}bf.offline=q_,z("shaka.polyfill",ww),ww.register=Ew,ww.installAll=function(){for(var e=c(xw),t=e.next();!t.done;t=e.next()){t=t.value;try{t.callback()}catch(e){Z("Error installing polyfill!",e)}}};var xw=[];function Aw(){this.g=new Iw}function kw(){e.AbortController||(e.AbortController=Aw,e.AbortSignal=Iw)}function Iw(){Br.call(this),this.h=!1,this.g=void 0,this.onabort=null}function Cw(){}function Rw(){if(!Object.getOwnPropertyDescriptor(Element.prototype,"ariaHidden"))for(var e=c(["ariaHidden","ariaLabel","ariaPressed","ariaSelected"]),t=e.next();!t.done;t=e.next())Mw(t.value)}function Mw(e){var t="aria-"+e.toLowerCase().replace(/^aria/,"");Object.defineProperty(Element.prototype,e,{get:function(){return this.getAttribute(t)},set:function(e){null==e||void 0==e?this.removeAttribute(t):this.setAttribute(t,e)}})}function Dw(){}function Lw(){gk()}function Pw(){}function Ow(){if(e.Document){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,t=Document.prototype,t.exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",Nw),document.addEventListener("webkitfullscreenerror",Nw),document.addEventListener("mozfullscreenchange",Nw),document.addEventListener("mozfullscreenerror",Nw),document.addEventListener("MSFullscreenChange",Nw),document.addEventListener("MSFullscreenError",Nw)}}function Nw(e){var t=e.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),n=document.createEvent("Event");n.initEvent(t,e.bubbles,e.cancelable),e.target.dispatchEvent(n)}function Uw(){}function Fw(){var e=!0;!Wt()||Wt()&&nn()||Wt()&&an("Fuchsia")||(e=!1),(Yt()||Xt()||Qt()||Kt()||Gt()||an("PC=EOS")||Zt())&&(e=!1),e&&navigator.mediaCapabilities||(navigator.mediaCapabilities||(navigator.mediaCapabilities={}),Hw=navigator.mediaCapabilities,navigator.mediaCapabilities.decodingInfo=Bw)}function Bw(e){var t,n,i,r,a,s,o,l,u,c,d;return N(function(h){switch(h.g){case 1:if(t={supported:!1,powerEfficient:!0,smooth:!0,keySystemAccess:null,configuration:e},n=e.video,i=e.audio,"media-source"!=e.type){if("file"!=e.type)return h.return(t);if(n&&(r=n.contentType,a=Bt(r),!a)||i&&(s=i.contentType,o=Bt(s),!o))return h.return(t);h.u(2);break}if(!Ft())return h.return(t);if(!n){h.u(3);break}return _(h,Vw(n),4);case 4:if(l=h.h,!l)return h.return(t);case 3:if(i){var f=i.contentType;if(Wt()&&i.spatialRendering&&(f+="; spatialRendering=true"),u=ce(f),!u)return h.return(t)}case 2:return e.keySystemConfiguration?(c=e.keySystemConfiguration,_(h,jw(n,i,c),6)):(t.supported=!0,h.return(t));case 6:(d=h.h)&&(t.supported=!0,t.keySystemAccess=d);case 5:return h.return(t)}})}function Vw(e){var t,n;return N(function(i){return 1==i.g?Wt()?_(i,Gw(e),3):Gt()?(t=e.contentType,e.width&&e.height&&(t+="; width="+e.width,t+="; height="+e.height),e.framerate&&(t+="; framerate="+e.framerate),e.bitrate&&(t+="; bitrate="+e.bitrate),i.return(ce(t))):i.u(2):2!=i.g?(n=i.h,i.return(n)):i.return(ce(e.contentType))})}function jw(e,t,n){var i,r,a,s,o,l,u,c,d;return N(function(h){switch(h.g){case 1:if(i=[],r=[],n.audio&&(a={robustness:n.audio.robustness||"",contentType:t.contentType},Gt()&&t.contentType.includes('codecs="ac-3"')&&(a.contentType='audio/mp4; codecs="ec-3"'),n.audio.encryptionScheme&&(a.encryptionScheme=n.audio.encryptionScheme),i.push(a)),n.video&&(s={robustness:n.video.robustness||"",contentType:e.contentType},n.video.encryptionScheme&&(s.encryptionScheme=n.video.encryptionScheme),r.push(s)),o={initDataTypes:[n.initDataType],distinctiveIdentifier:n.distinctiveIdentifier,persistentState:n.persistentState,sessionTypes:n.sessionTypes},i.length&&(o.audioCapabilities=i),r.length&&(o.videoCapabilities=r),l=e?e.contentType:"",u=t?t.contentType:"",c=n.keySystem,d=null,E(h,2),Ot.has(l+"#"+u+"#"+c)){d=Ot.get(l+"#"+u+"#"+c)||null,h.u(4);break}return _(h,navigator.requestMediaKeySystemAccess(n.keySystem,[o]),5);case 5:d=h.h,Ot.set(l+"#"+u+"#"+c,d);case 4:A(h,3);break;case 2:k(h);case 3:return h.return(d)}})}function Gw(t){var n,i;return N(function(r){return 1==r.g?e.cast&&cast.__platform__&&cast.__platform__.canDisplayType?(n=t.contentType,t.width&&t.height&&(n+="; width="+t.width+"; height="+t.height),t.framerate&&(n+="; framerate="+t.framerate),"pq"===t.transferFunction&&(n+="; eotf=smpte2084"),i=!1,n in Xw?(i=Xw[n],r.u(2)):_(r,cast.__platform__.canDisplayType(n),3)):r.return(ce(t.contentType)):(2!=r.g&&(i=r.h,Xw[n]=i),r.return(i))})}Aw.prototype.abort=function(e){var t=this.g;t.h||(t.h=!0,t.g=e,void 0===t.g&&(t.g=new DOMException("signal is aborted without reason","AbortError")),e=new Nr("abort"),t.onabort&&t.onabort(e),t.dispatchEvent(e))},o.Object.defineProperties(Aw.prototype,{signal:{configurable:!0,enumerable:!0,get:function(){return this.g}}}),ww.AbortController=Aw,Aw.install=kw,y(Iw,Br),o.Object.defineProperties(Iw.prototype,{aborted:{configurable:!0,enumerable:!0,get:function(){return this.h}},reason:{configurable:!0,enumerable:!0,get:function(){return this.g}}}),Ew(kw),ww.Aria=Cw,Cw.install=Rw,Ew(Rw),ww.EncryptionScheme=Dw,Dw.install=Lw,Ew(Lw,-2),ww.Fullscreen=Pw,Pw.install=Ow,Ew(Ow),ww.MediaCapabilities=Uw,Uw.install=Fw;var Hw=null;Uw.originalMcap=Hw;var zw,Kw,$w,Ww,qw,Yw,Xw={};function Qw(){}function Zw(){var t=en();(e.MediaSource||e.ManagedMediaSource)&&(t&&e.MediaSource?10>=t?e.MediaSource=null:12>=t?(Jw(),eE()):15>=t&&Jw():an("DT_STB_BCM")?(Jw(),eE()):(zt()||Ht()||an("Tizen 4"))&&nE()),(e.MediaSource||e.ManagedMediaSource)&&tE(),e.MediaSource&&MediaSource.isTypeSupported('video/webm; codecs="vp9"')&&!MediaSource.isTypeSupported('video/webm; codecs="vp09.00.10.08"')&&iE()}function Jw(){var e=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(){var t=e.apply(this,U.apply(0,arguments));return t.abort=function(){},t}}function eE(){var e=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(t,n){return e.call(this,t,n-.001)}}function tE(){if(e.MediaSource){var t=MediaSource.isTypeSupported.bind(MediaSource);MediaSource.isTypeSupported=function(e){return"mp2t"!=Gn(e)&&t(e)}}if(e.ManagedMediaSource){var n=ManagedMediaSource.isTypeSupported.bind(ManagedMediaSource);e.ManagedMediaSource.isTypeSupported=function(e){return"mp2t"!=Gn(e)&&n(e)}}}function nE(){var t=MediaSource.isTypeSupported.bind(MediaSource);if(MediaSource.isTypeSupported=function(e){return"opus"!=zn(e)&&t(e)},e.ManagedMediaSource){var n=ManagedMediaSource.isTypeSupported.bind(ManagedMediaSource);e.ManagedMediaSource.isTypeSupported=function(e){return"opus"!=zn(e)&&n(e)}}}function iE(){var e=MediaSource.isTypeSupported;Kt()||(MediaSource.isTypeSupported=function(t){var n=t.split(/ *; */),i=n.findIndex(function(e){return e.startsWith("codecs=")});if(0>i)return e(t);var r=n[i].replace("codecs=","").replace(/"/g,"").split(/\s*,\s*/),a=r.findIndex(function(e){return e.startsWith("vp09")});return 0<=a&&(r[a]="vp9",n[i]='codecs="'+r.join(",")+'"',t=n.join("; ")),e(t)})}function rE(){}function aE(){screen.orientation&&screen.orientation.unlock||(void 0!=screen.orientation?sE():void 0!=e.orientation&&oE())}function sE(){void 0===screen.orientation.lock&&(screen.orientation.lock=function(){return Promise.resolve()}),void 0===screen.orientation.unlock&&(screen.orientation.unlock=function(){})}function oE(){function t(){switch(e.orientation){case-90:n.type="landscape-secondary",n.angle=270;break;case 0:n.type="portrait-primary",n.angle=0;break;case 90:n.type="landscape-primary",n.angle=90;break;case 180:n.type="portrait-secondary",n.angle=180}}var n=new lE;screen.orientation=n,t(),e.addEventListener("orientationchange",function(){t();var e=new Nr("change");n.dispatchEvent(e)})}function lE(){Br.call(this),this.type="",this.angle=0}function uE(){}function cE(e,t){try{var n=new fE(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function dE(e){var t=this.mediaKeys;return t&&t!=e&&gE(t,null),delete this.mediaKeys,(this.mediaKeys=e)?gE(e,this):Promise.resolve()}function hE(e){if(e=Ee(e.initData),Ae(e).getUint32(0,!0)+4!=e.byteLength)throw new RangeError("Malformed FairPlay init data");e=fn(e.subarray(4),!0),e=gn(e);var t=new Event("encrypted");t.initDataType="skd",t.initData=we(e),this.dispatchEvent(t)}function fE(e,t){if(this.keySystem=e,e.startsWith("com.apple.fps"))for(e=c(t),t=e.next();!t.done;t=e.next()){var n=t.value;if("required"==n.persistentState)t=null;else{t={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:n.initDataTypes,sessionTypes:["temporary"],label:n.label};var i=!1,r=!1;if(n.audioCapabilities)for(var a=c(n.audioCapabilities),s=a.next();!s.done;s=a.next())s=s.value,s.contentType&&(i=!0,WebKitMediaKeys.isTypeSupported(this.keySystem,s.contentType.split(";")[0])&&(t.audioCapabilities.push(s),r=!0));if(n.videoCapabilities)for(n=c(n.videoCapabilities),s=n.next();!s.done;s=n.next())a=s.value,a.contentType&&(i=!0,WebKitMediaKeys.isTypeSupported(this.keySystem,a.contentType.split(";")[0])&&(t.videoCapabilities.push(a),r=!0));i||(r=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),t=r?t:null}if(t)return void(this.g=t)}throw e=Error("Unsupported keySystem"),e.name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e}function pE(e){this.h=new WebKitMediaKeys(e),this.g=new ae}function gE(e,t){if(e.g.Ra(),!t)return Promise.resolve();e.g.D(t,"webkitneedkey",hE);try{return Vl(t,HTMLMediaElement.HAVE_METADATA,e.g,function(){t.webkitSetMediaKeys(e.h)}),Promise.resolve()}catch(e){return Promise.reject(e)}}function mE(e){Br.call(this),this.i=null,this.l=e,this.g=this.h=null,this.j=new ae,this.sessionId="",this.expiration=NaN,this.closed=new Ir,this.keyStatuses=new yE}function vE(e,t){var n=e.keyStatuses;n.size=void 0==t?0:1,n.g=t,t=new Nr("keystatuseschange"),e.dispatchEvent(t)}function yE(){this.size=0,this.g=void 0}Uw.memoizedCanDisplayTypeRequests_=Xw,Ew(Fw,-1),ww.MediaSource=Qw,Qw.install=Zw,Ew(Zw),ww.Orientation=rE,rE.install=aE,y(lE,Br),lE.prototype.lock=function(e){function t(e){return screen.lockOrientation?screen.lockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):!!screen.msLockOrientation&&screen.msLockOrientation(e)}var n=!1;switch(e){case"natural":n=t("default");break;case"any":n=!0,this.unlock();break;default:n=t(e)}return n?Promise.resolve():(e=Error("screen.orientation.lock() is not available on this device"),e.name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,Promise.reject(e))},lE.prototype.unlock=function(){screen.unlockOrientation?screen.unlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},Ew(aE),ww.PatchedMediaKeysApple=uE,uE.uninstall=function(){zw&&(zw=!1,Object.defineProperty(HTMLMediaElement.prototype,"mediaKeys",Kw),HTMLMediaElement.prototype.setMediaKeys=$w,e.MediaKeys=Ww,e.MediaKeySystemAccess=qw,navigator.requestMediaKeySystemAccess=Yw,Kw=Yw=$w=qw=Ww=null,e.shakaMediaKeysPolyfill="")},uE.install=function(t){e.HTMLVideoElement&&e.WebKitMediaKeys&&(void 0!==t&&t&&(zw=!0,Kw=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"mediaKeys"),$w=HTMLMediaElement.prototype.setMediaKeys,Ww=e.MediaKeys,qw=e.MediaKeySystemAccess,Yw=navigator.requestMediaKeySystemAccess),delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=dE,e.MediaKeys=pE,e.MediaKeySystemAccess=fE,navigator.requestMediaKeySystemAccess=cE,e.shakaMediaKeysPolyfill=bE)},fE.prototype.createMediaKeys=function(){var e=new pE(this.keySystem);return Promise.resolve(e)},fE.prototype.getConfiguration=function(){return this.g},pE.prototype.createSession=function(e){if(e=e||"temporary","temporary"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");return new mE(this.h,e)},pE.prototype.setServerCertificate=function(){return Promise.resolve(!1)},pE.prototype.getStatusForPolicy=function(){return Promise.resolve("usable")},y(mE,Br),i=mE.prototype,i.generateRequest=function(e,t){var n=this;this.h=new Ir;try{var i=this.l.createSession("video/mp4",Ee(t));this.i=i,this.sessionId=i.sessionId||"",this.j.D(this.i,"webkitkeymessage",function(e){n.h&&(n.h.resolve(),n.h=null),e=(new Map).set("messageType",void 0==n.keyStatuses.ac()?"license-request":"license-renewal").set("message",we(e.message)),e=new Nr("message",e),n.dispatchEvent(e)}),this.j.D(i,"webkitkeyadded",function(){n.g&&(vE(n,"usable"),n.g.resolve(),n.g=null)}),this.j.D(i,"webkitkeyerror",function(){var e=Error("EME PatchedMediaKeysApple key error");if(e.errorCode=n.i.error,null!=n.h)n.h.reject(e),n.h=null;else if(null!=n.g)n.g.reject(e),n.g=null;else switch(n.i.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:vE(n,"output-not-allowed");break;default:vE(n,"internal-error")}}),vE(this,"status-pending")}catch(e){this.h.reject(e)}return this.h},i.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},i.update=function(e){this.g=new Ir;try{this.i.update(Ee(e))}catch(e){this.g.reject(e)}return this.g},i.close=function(){try{this.i.close(),this.closed.resolve(),this.j.Ra()}catch(e){this.closed.reject(e)}return this.closed},i.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},i=yE.prototype,i.ac=function(){return this.g},i.forEach=function(e){this.g&&e(this.g,Pt.value())},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=Pt.value();return!(!this.g||!Te(e,t))},i.entries=function(){},i.keys=function(){},i.values=function(){};var bE="apple";function SE(){}function TE(){e.MediaKeys&&(!MediaKeys.prototype.setServerCertificate||Ht()||an("Tizen 4")||an("Tizen 5.0")||$t())&&(MediaKeys.prototype.setServerCertificate=_E)}function _E(){return Promise.resolve(!1)}function wE(){}function EE(){!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(navigator.requestMediaKeySystemAccess=xE,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=AE,e.MediaKeys=kE,e.MediaKeySystemAccess=IE,e.shakaMediaKeysPolyfill=CE)}function xE(){return Promise.reject(Error("The key system specified is not supported."))}function AE(e){return null==e?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function kE(){throw new TypeError("Illegal constructor.")}function IE(){throw this.keySystem="",new TypeError("Illegal constructor.")}ww.PatchedMediaKeysCert=SE,SE.install=TE,Ew(TE),ww.PatchedMediaKeysNop=wE,wE.install=EE,kE.prototype.createSession=function(){},kE.prototype.setServerCertificate=function(){},kE.prototype.getStatusForPolicy=function(){return Promise.resolve("usable")},IE.prototype.getConfiguration=function(){},IE.prototype.createMediaKeys=function(){};var CE="nop";function RE(){}function ME(){if(!(!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)zE="webkit";else if(!HTMLMediaElement.prototype.generateKeyRequest)return;navigator.requestMediaKeySystemAccess=LE,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=PE,e.MediaKeys=NE,e.MediaKeySystemAccess=OE,e.shakaMediaKeysPolyfill=KE}}function DE(e){var t=zE;return t?t+e.charAt(0).toUpperCase()+e.slice(1):e}function LE(e,t){try{var n=new OE(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function PE(e){var t=this.mediaKeys;return t&&t!=e&&UE(t,null),delete this.mediaKeys,(this.mediaKeys=e)&&UE(e,this),Promise.resolve()}function OE(e,t){this.g=this.keySystem=e;var n=!1;"org.w3.clearkey"==e&&(this.g="webkit-org.w3.clearkey",n=!1);var i=!1,r=document.getElementsByTagName("video");r=r.length?r[0]:document.createElement("video"),t=c(t);for(var a=t.next();!a.done;a=t.next()){a=a.value;var s={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:a.initDataTypes,sessionTypes:["temporary"],label:a.label},o=!1;if(a.audioCapabilities)for(var l=c(a.audioCapabilities),u=l.next();!u.done;u=l.next())u=u.value,u.contentType&&(o=!0,r.canPlayType(u.contentType.split(";")[0],this.g)&&(s.audioCapabilities.push(u),i=!0));if(a.videoCapabilities)for(l=c(a.videoCapabilities),u=l.next();!u.done;u=l.next())u=u.value,u.contentType&&(o=!0,r.canPlayType(u.contentType,this.g)&&(s.videoCapabilities.push(u),i=!0));if(o||(i=r.canPlayType("video/mp4",this.g)||r.canPlayType("video/webm",this.g)),"required"==a.persistentState&&(n?(s.persistentState="required",s.sessionTypes=["persistent-license"]):i=!1),i)return void(this.h=s)}throw n="Unsupported keySystem","org.w3.clearkey"!=e&&"com.widevine.alpha"!=e||(n="None of the requested configurations were supported."),e=Error(n),e.name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e}function NE(e){this.l=e,this.h=null,this.g=new ae,this.i=[],this.j=new Map}function UE(e,t){e.h=t,e.g.Ra();var n=zE;t&&(e.g.D(t,n+"needkey",function(t){var n=new CustomEvent("encrypted");n.initDataType="cenc",n.initData=we(t.initData),e.h.dispatchEvent(n)}),e.g.D(t,n+"keymessage",function(t){var n=FE(e,t.sessionId);n&&(t=(new Map).set("messageType",void 0==n.keyStatuses.ac()?"licenserequest":"licenserenewal").set("message",t.message),t=new Nr("message",t),n.h&&(n.h.resolve(),n.h=null),n.dispatchEvent(t))}),e.g.D(t,n+"keyadded",function(t){(t=FE(e,t.sessionId))&&(GE(t,"usable"),t.g&&t.g.resolve(),t.g=null)}),e.g.D(t,n+"keyerror",function(t){var n=FE(e,t.sessionId);if(n){var i=Error("EME v0.1b key error"),r=t.errorCode;r.systemCode=t.systemCode,i.errorCode=r,!t.sessionId&&n.h?(45==t.systemCode&&(i.message="Unsupported session type."),n.h.reject(i),n.h=null):t.sessionId&&n.g?(n.g.reject(i),n.g=null):(i=t.systemCode,t.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?GE(n,"output-restricted"):GE(n,1==i?"expired":"internal-error"))}}))}function FE(e,t){var n=e.j.get(t);return n||((n=e.i.shift())?(n.sessionId=t,e.j.set(t,n),n):null)}function BE(e,t,n){Br.call(this),this.j=e,this.m=!1,this.g=this.h=null,this.i=t,this.l=n,this.sessionId="",this.expiration=NaN,this.closed=new Ir,this.keyStatuses=new HE}function VE(e,t,n){if(e.m)return Promise.reject(Error("The session is already initialized."));e.m=!0;try{if("persistent-license"==e.l)if(n)var i=Ee(gn("LOAD_SESSION|"+n));else{var r=gn("PERSISTENT|");i=An(r,t)}else i=Ee(t)}catch(e){return Promise.reject(e)}e.h=new Ir;var a=DE("generateKeyRequest");try{e.j[a](e.i,i)}catch(t){if("InvalidStateError"!=t.name)return e.h=null,Promise.reject(t);new Ut(function(){try{e.j[a](e.i,i)}catch(t){e.h.reject(t),e.h=null}}).Y(.01)}return e.h}function jE(e,t,n){if(e.g)e.g.then(function(){return jE(e,t,n)}).catch(function(){return jE(e,t,n)});else{if(e.g=t,"webkit-org.w3.clearkey"==e.i){var i=hn(n),r=JSON.parse(i);"oct"!=r.keys[0].kty&&(e.g.reject(Error("Response is not a valid JSON Web Key Set.")),e.g=null),i=wn(r.keys[0].k),r=wn(r.keys[0].kid)}else i=Ee(n),r=null;var a=DE("addKey");try{e.j[a](e.i,i,r,e.sessionId)}catch(t){e.g.reject(t),e.g=null}}}function GE(e,t){var n=e.keyStatuses;n.size=void 0==t?0:1,n.g=t,t=new Nr("keystatuseschange"),e.dispatchEvent(t)}function HE(){this.size=0,this.g=void 0}Ew(EE,-10),ww.PatchedMediaKeysWebkit=RE,RE.install=ME,OE.prototype.createMediaKeys=function(){var e=new NE(this.g);return Promise.resolve(e)},OE.prototype.getConfiguration=function(){return this.h},NE.prototype.createSession=function(e){if(e=e||"temporary","temporary"!=e&&"persistent-license"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");var t=this.h||document.createElement("video");return t.src||(t.src="about:blank"),e=new BE(t,this.l,e),this.i.push(e),e},NE.prototype.setServerCertificate=function(){return Promise.resolve(!1)},NE.prototype.getStatusForPolicy=function(){return Promise.resolve("usable")},y(BE,Br),i=BE.prototype,i.generateRequest=function(e,t){return VE(this,t,null)},i.load=function(e){return"persistent-license"==this.l?VE(this,null,e):Promise.reject(Error("Not a persistent session."))},i.update=function(e){var t=new Ir;return jE(this,t,e),t},i.close=function(){if("persistent-license"!=this.l){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var e=DE("cancelKeyRequest");try{this.j[e](this.i,this.sessionId)}catch(e){}}return this.closed.resolve(),this.closed},i.remove=function(){return"persistent-license"!=this.l?Promise.reject(Error("Not a persistent session.")):this.close()},i=HE.prototype,i.ac=function(){return this.g},i.forEach=function(e){this.g&&e(this.g,Pt.value())},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=Pt.value();return!(!this.g||!Te(e,t))},i.entries=function(){},i.keys=function(){},i.values=function(){};var zE="",KE="webkit";function $E(){}function WE(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;t.requestPictureInPicture&&document.exitPictureInPicture||!t.webkitSupportsPresentationMode||(document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,t.requestPictureInPicture=YE,Object.defineProperty(t,"disablePictureInPicture",{get:QE,set:ZE,enumerable:!0,configurable:!0}),document.exitPictureInPicture=XE,document.addEventListener("webkitpresentationmodechanged",qE,!0))}}function qE(e){if(e=e.target,"picture-in-picture"==e.webkitPresentationMode){document.pictureInPictureElement=e;var t=new Event("enterpictureinpicture");e.dispatchEvent(t)}else document.pictureInPictureElement==e&&(document.pictureInPictureElement=null),t=new Event("leavepictureinpicture"),e.dispatchEvent(t)}function YE(){return this.webkitSupportsPresentationMode("picture-in-picture")?(this.webkitSetPresentationMode("picture-in-picture"),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))}function XE(){var e=document.pictureInPictureElement;return e?(e.webkitSetPresentationMode("inline"),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))}function QE(){return!!this.hasAttribute("disablePictureInPicture")||!this.webkitSupportsPresentationMode("picture-in-picture")}function ZE(e){e?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")}function JE(){}function ex(){e.crypto&&("randomUUID"in e.crypto||(e.crypto.randomUUID=tx))}function tx(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.substr(t.lastIndexOf("/")+1)}function nx(){}function ix(){var e=Symbol.prototype;"description"in e||Object.defineProperty(e,"description",{get:rx})}function rx(){var e=/\((.*)\)/.exec(this.toString());return e?e[1]:void 0}function ax(){}function sx(){if(e.HTMLMediaElement){var t=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var e=t.apply(this);return e&&e.catch(function(){}),e}}}function ox(){}function lx(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&("webkitDroppedFrameCount"in t||$t())&&(t.getVideoPlaybackQuality=ux)}}function ux(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function cx(){}function dx(){if(!e.VTTCue&&e.TextTrackCue){var t=null,n=TextTrackCue.length;if(3==n)t=hx;else if(6==n)t=fx;else{try{var i=!!hx(1,2,"")}catch(e){i=!1}i&&(t=hx)}t&&(e.VTTCue=function(e,n,i){return t(e,n,i)})}}function hx(t,n,i){return new e.TextTrackCue(t,n,i)}function fx(t,n,i){return new e.TextTrackCue(t+"-"+n+"-"+i,t,n,i)}function px(){}Ew(ME),ww.PiPWebkit=$E,$E.install=WE,Ew(WE),ww.RandomUUID=JE,JE.install=ex,Ew(ex),ww.Symbol=nx,nx.install=ix,Ew(ix),ww.VideoPlayPromise=ax,ax.install=sx,Ew(sx),ww.VideoPlaybackQuality=ox,ox.install=lx,Ew(lx),ww.VTTCue=cx,cx.install=dx,Ew(dx),px.prototype.parseInit=function(){},px.prototype.setSequenceMode=function(){},px.prototype.setManifestType=function(){},px.prototype.parseMedia=function(e,t){var n=null,i=[];e=hn(e).split(/\r?\n/),e=c(e);for(var r=e.next();!r.done;r=e.next())if((r=r.value)&&!/^\s+$/.test(r)&&(r=gx.exec(r))){var a=mx.exec(r[1]);a=60*parseInt(a[1],10)+parseFloat(a[2].replace(",",".")),r=new Be(a,t.segmentEnd?t.segmentEnd:a+2,r[2]),n&&(n.endTime=a,i.push(n)),n=r}return n&&i.push(n),i},z("shaka.text.LrcTextParser",px),px.prototype.parseMedia=px.prototype.parseMedia,px.prototype.setManifestType=px.prototype.setManifestType,px.prototype.setSequenceMode=px.prototype.setSequenceMode,px.prototype.parseInit=px.prototype.parseInit;var gx=/^\[(\d{1,2}:\d{1,2}(?:[.,]\d{1,3})?)\](.*)/,mx=/^(\d+):(\d{1,2}(?:[.,]\d{1,3})?)$/;function vx(){}function yx(e,t,n,i,r,a,s,o,l,u,d,h){var f=u;if(ka(e)){if(!d)return null;var p={tagName:"span",children:[Ra(e)],attributes:{},parent:null}}else p=e;for(var g=null,m=c(Kx),v=m.next();!v.done&&!(g=xx(p,"backgroundImage",i,"#",v.value)[0]);v=m.next());m=null;var y=Fa(p,Kx,"backgroundImage");if(h&&y&&!y.startsWith("#")&&(v=new ht(h),y=new ht(y),(v=v.resolve(y).toString())&&(m=v)),("p"==e.tagName||g||m)&&(d=!0),e=d,v="default"==(p.attributes["xml:space"]||(o?"default":"preserve")),y=p.children.every(ka),o=[],!y)for(var b=c(p.children),S=b.next();!S.done;S=b.next())(S=yx(S.value,t,n,i,r,a,s,v,l,p,d,h))&&o.push(S);if(i=null!=u,h=Ra(p),h=p.children.length&&h&&/\S/.test(h),S=p.attributes.begin||p.attributes.end||p.attributes.dur,!(S||h||"br"==p.tagName||0!=o.length||i&&!v))return null;for(b=kx(p,n),h=b.start,b=b.end;f&&f.tagName&&"tt"!=f.tagName;)b=Ax(f,n,h,b),h=b.start,b=b.end,f=f.parent;if(null==h&&(h=0),h+=t.periodStart,b=null==b?1/0:b+t.periodStart,h=Math.max(h,t.segmentStart),b=Math.min(b,t.segmentEnd),!S&&0<o.length)for(h=1/0,b=0,t=c(o),n=t.next();!n.done;n=t.next())n=n.value,h=Math.min(h,n.startTime),b=Math.max(b,n.endTime);if("br"==p.tagName)return r=new Be(h,b,""),r.lineBreak=!0,r;if(t="",y&&(t=yn(Ra(p)||""),v&&(t=t.replace(/\s+/g," "))),t=new Be(h,b,t),t.nestedCues=o,d||(t.isContainer=!0),l&&(t.cellResolution=l),l=xx(p,"region",a,"")[0],p.attributes.region&&l&&l.attributes["xml:id"]){var T=l.attributes["xml:id"];t.region=s.filter(function(e){return e.id==T})[0]}return s=l,u&&i&&!p.attributes.region&&!p.attributes.style&&(s=xx(u,"region",a,"")[0]),bx(t,p,s,g,m,r,e,0==o.length),t}function bx(e,t,n,i,r,a,s,o){if(s=s||o,"rtl"==Tx(t,n,a,"direction",s)&&(e.direction="rtl"),o=Tx(t,n,a,"writingMode",s),"tb"==o||"tblr"==o?e.writingMode="vertical-lr":"tbrl"==o?e.writingMode="vertical-rl":"rltb"==o||"rl"==o?e.direction="rtl":o&&(e.direction=We),(o=Tx(t,n,a,"textAlign",!0))?(e.positionAlign=Gx[o],e.lineAlign=jx[o],e.textAlign=ze[o.toUpperCase()]):e.textAlign=He,(o=Tx(t,n,a,"displayAlign",!0))&&(e.displayAlign=$e[o.toUpperCase()]),(o=Tx(t,n,a,"color",s))&&(e.color=o),(o=Tx(t,n,a,"backgroundColor",s))&&(e.backgroundColor=o),(o=Tx(t,n,a,"border",s))&&(e.border=o),o=Tx(t,n,a,"fontFamily",s))switch(o){case"monospaceSerif":e.fontFamily="Courier New,Liberation Mono,Courier,monospace";break;case"proportionalSansSerif":e.fontFamily="Arial,Helvetica,Liberation Sans,sans-serif";break;case"sansSerif":e.fontFamily="sans-serif";break;case"monospaceSansSerif":e.fontFamily="Consolas,monospace";break;case"proportionalSerif":e.fontFamily="serif";break;default:e.fontFamily=o.split(",").filter(function(e){return"default"!=e}).join(",")}switch((o=Tx(t,n,a,"fontWeight",s))&&"bold"==o&&(e.fontWeight=700),o=Tx(t,n,a,"wrapOption",s),e.wrapLine=!o||"noWrap"!=o,(o=Tx(t,n,a,"lineHeight",s))&&o.match(Lx)&&(e.lineHeight=o),(o=Tx(t,n,a,"fontSize",s))&&(o.match(Lx)||o.match(Dx))&&(e.fontSize=o),(o=Tx(t,n,a,"fontStyle",s))&&(e.fontStyle=nt[o.toUpperCase()]),i?(r=i.attributes.imageType||i.attributes.imagetype,o=i.attributes.encoding,i=Ra(i).trim(),"PNG"==r&&"Base64"==o&&i&&(e.backgroundImage="data:image/png;base64,"+i)):r&&(e.backgroundImage=r),(i=Tx(t,n,a,"textOutline",s))&&(i=i.split(" "),i[0].match(Lx)?e.textStrokeColor=e.color:(e.textStrokeColor=i[0],i.shift()),i[0]&&i[0].match(Lx)?e.textStrokeWidth=i[0]:e.textStrokeColor=""),(i=Tx(t,n,a,"letterSpacing",s))&&i.match(Lx)&&(e.letterSpacing=i),(i=Tx(t,n,a,"linePadding",s))&&i.match(Lx)&&(e.linePadding=i),(i=Tx(t,n,a,"opacity",s))&&(e.opacity=parseFloat(i)),(i=_x(n,a,"textDecoration"))&&Sx(e,i),(i=wx(t,a,"textDecoration"))&&Sx(e,i),(i=Tx(t,n,a,"textCombine",s))&&(e.textCombineUpright=i),Tx(t,n,a,"ruby",s)){case"container":e.rubyTag="ruby";break;case"text":e.rubyTag="rt"}}function Sx(e,t){t=c(t.split(" "));for(var n=t.next();!n.done;n=t.next())switch(n.value){case"underline":e.textDecoration.includes("underline")||e.textDecoration.push("underline");break;case"noUnderline":e.textDecoration.includes("underline")&&Ne(e.textDecoration,"underline");break;case"lineThrough":e.textDecoration.includes("lineThrough")||e.textDecoration.push("lineThrough");break;case"noLineThrough":e.textDecoration.includes("lineThrough")&&Ne(e.textDecoration,"lineThrough");break;case"overline":e.textDecoration.includes("overline")||e.textDecoration.push("overline");break;case"noOverline":e.textDecoration.includes("overline")&&Ne(e.textDecoration,"overline")}}function Tx(e,t,n,i,r){return r=void 0===r||r,(e=wx(e,n,i))?e:r?_x(t,n,i):null}function _x(e,t,n){if(!e)return null;var i=Fa(e,zx,n);return i||Ex(e,t,n)}function wx(e,t,n){var i=Fa(e,zx,n);return i||Ex(e,t,n)}function Ex(e,t,n){e=xx(e,"style",t,"");for(var i=null,r=0;r<e.length;r++){var a=Na(e[r],"urn:ebu:tt:style",n);a||(a=Fa(e[r],zx,n)),a||(a=wx(e[r],t,n)),a&&(i=a)}return i}function xx(e,t,n,i,r){var a=[];if(!e||1>n.length)return a;var s=e;for(e=null;!e&&!(e=r?Na(s,r,t):s.attributes[t])&&(s=s.parent,s););if(t=e)for(t=c(t.split(" ")),r=t.next();!r.done;r=t.next())for(r=r.value,e=c(n),s=e.next();!s.done;s=e.next())if(s=s.value,i+s.attributes["xml:id"]==r){a.push(s);break}return a}function Ax(e,t,n,i){return e=kx(e,t),null==n?n=e.start:null!=e.start&&(n+=e.start),null==i?i=e.end:null!=e.start&&(i+=e.start),{start:n,end:i}}function kx(e,t){var n=Ix(e.attributes.begin,t),i=Ix(e.attributes.end,t);return e=Ix(e.attributes.dur,t),null==i&&null!=e&&(i=n+e),{start:n,end:i}}function Ix(e,t){var n=null;if(Ox.test(e)){e=Ox.exec(e),n=Number(e[1]);var i=Number(e[2]),r=Number(e[3]),a=Number(e[4]);a+=(Number(e[5])||0)/t.h,r+=a/t.frameRate,n=r+60*i+3600*n}else if(Nx.test(e))n=Cx(Nx,e);else if(Ux.test(e))n=Cx(Ux,e);else if(Fx.test(e))e=Fx.exec(e),n=Number(e[1])/t.frameRate;else if(Bx.test(e))e=Bx.exec(e),n=Number(e[1])/t.g;else if(Vx.test(e))n=Cx(Vx,e);else if(e)throw new It(2,2,2001,"Could not parse cue time range in TTML");return n}function Cx(e,t){return e=e.exec(t),null==e||""==e[0]?null:(Number(e[4])||0)/1e3+(Number(e[3])||0)+60*(Number(e[2])||0)+3600*(Number(e[1])||0)}function Rx(e,t,n,i){this.frameRate=Number(e)||30,this.h=Number(t)||1,this.g=Number(i),0==this.g&&(this.g=e?this.frameRate*this.h:1),n&&(e=/^(\d+) (\d+)$/g.exec(n))&&(this.frameRate*=Number(e[1])/Number(e[2]))}ri["application/x-subtitle-lrc"]=function(){return new px},vx.prototype.parseInit=function(){},vx.prototype.setSequenceMode=function(){},vx.prototype.setManifestType=function(){},vx.prototype.parseMedia=function(e,t,n){var i=hn(e);if(e=[],""==i)return e;var r=Ea(i,"tt");if(!r)throw new It(2,2,2005,"Failed to parse TTML.");if(i=Da(r,"body")[0],!i)return[];var a=Fa(r,Hx,"frameRate"),s=Fa(r,Hx,"subFrameRate"),o=Fa(r,Hx,"frameRateMultiplier"),l=Fa(r,Hx,"tickRate"),u=Fa(r,Hx,"cellResolution"),d=r.attributes["xml:space"]||"default",h=Fa(r,zx,"extent");if("default"!=d&&"preserve"!=d)throw new It(2,2,2005,"Invalid xml:space value: "+d);d="default"==d,a=new Rx(a,s,o,l),u=u&&(u=/^(\d+) (\d+)$/.exec(u))?{kc:parseInt(u[1],10),rows:parseInt(u[2],10)}:null,s=(s=Da(r,"metadata")[0])?s.children:[],o=Da(r,"style"),r=Da(r,"region"),l=[];for(var f=c(r),p=f.next();!p.done;p=f.next()){var g=p.value;p=new De;var m=g.attributes["xml:id"];if(m){p.id=m;var v=null;h&&(v=Mx.exec(h)||Px.exec(h)),m=v?Number(v[1]):null,v=v?Number(v[2]):null;var y,b=_x(g,o,"extent");if(b){var S=(y=Mx.exec(b))||Px.exec(b);null!=S&&(p.width=Number(S[1]),p.height=Number(S[2]),y||(null!=m&&(p.width=100*p.width/m),null!=v&&(p.height=100*p.height/v)),p.widthUnits=y||null!=m?Le:0,p.heightUnits=y||null!=v?Le:0)}(g=_x(g,o,"origin"))&&(S=(y=Mx.exec(g))||Px.exec(g),null!=S&&(p.viewportAnchorX=Number(S[1]),p.viewportAnchorY=Number(S[2]),y?b||(p.width=100-p.viewportAnchorX,p.widthUnits=Le,p.height=100-p.viewportAnchorY,p.heightUnits=Le):(null!=v&&(p.viewportAnchorY=100*p.viewportAnchorY/v),null!=m&&(p.viewportAnchorX=100*p.viewportAnchorX/m)),p.viewportAnchorUnits=y||null!=m?Le:0))}else p=null;p&&l.push(p)}if(Ca(i,"p").length)throw new It(2,2,2001,"<p> can only be inside <div> in TTML");for(h=c(Ca(i,"div")),f=h.next();!f.done;f=h.next())if(Ca(f.value,"span").length)throw new It(2,2,2001,"<span> can only be inside <p> in TTML");return(t=yx(i,t,a,s,o,r,l,d,u,null,!1,n))&&(t.backgroundColor||(t.backgroundColor="transparent"),e.push(t)),e},z("shaka.text.TtmlTextParser",vx),vx.prototype.parseMedia=vx.prototype.parseMedia,vx.prototype.setManifestType=vx.prototype.setManifestType,vx.prototype.setSequenceMode=vx.prototype.setSequenceMode,vx.prototype.parseInit=vx.prototype.parseInit;var Mx=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,Dx=/^(\d{1,4}(?:\.\d+)?|100)%$/,Lx=/^(\d+px|\d+em|\d*\.?\d+c)$/,Px=/^(\d+)px (\d+)px$/,Ox=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Nx=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,Ux=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d+)$/,Fx=/^(\d*(?:\.\d*)?)f$/,Bx=/^(\d*(?:\.\d*)?)t$/,Vx=RegExp("^(?:(\\d*(?:\\.\\d*)?)h)?(?:(\\d*(?:\\.\\d*)?)m)?(?:(\\d*(?:\\.\\d*)?)s)?(?:(\\d*(?:\\.\\d*)?)ms)?$"),jx={left:Xe,center:"center",right:"end",start:Xe,end:"end"},Gx={left:"line-left",center:"center",right:"line-right"},Hx=["http://www.w3.org/ns/ttml#parameter","http://www.w3.org/2006/10/ttaf1#parameter"],zx=["http://www.w3.org/ns/ttml#styling","http://www.w3.org/2006/10/ttaf1#styling"],Kx=["http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt","http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"];function $x(){this.g=new vx}function Wx(){this.h=!1,this.g="UNKNOWN"}function qx(e){for(var t=c(Object.entries(Ze)),n=t.next();!n.done;n=t.next()){var i=c(n.value);n=i.next().value,i=i.next().value;var r=new Be(0,0,"");r.color=i,e.set("."+n,r)}for(t=c(Object.entries(Je)),n=t.next();!n.done;n=t.next())i=c(n.value),n=i.next().value,i=i.next().value,r=new Be(0,0,""),r.backgroundColor=i,e.set("."+n,r)}function Yx(e,t,n){if(e.includes("<")){0===n.size&&qx(n);var i=e;e=[];for(var r=-1,a=0;a<i.length;a++)"<"===i[a]?r=a+1:">"===i[a]&&0<r&&(r=i.substr(r,a-r),r.match(nA)&&e.push(r),r=-1);for(e=c(e),a=e.next();!a.done;a=e.next())a=a.value,i=i.replace("<"+a+">",'<div time="'+a+'">'),i+="</div>";e=i;e:{a=e,r=[];var s=-1;e="",i=!1;for(var o=0;o<a.length;o++)if("/"===a[o]){var l=a.indexOf(">",o);if(-1===l){e=a;break e}if((l=a.substring(o+1,l))&&"v"==l){i=!0;var u=null;if(r.length&&(u=r[r.length-1]),u){if(u===l)e+="/"+l+">";else{if(!u.startsWith("v")){e+=a[o];continue}e+="/"+u+">"}o+=l.length+1}else e+=a[o]}else e+=a[o]}else"<"===a[o]?(s=o+1,"v"!=a[s]&&(s=-1)):">"===a[o]&&0<s&&(r.push(a.substr(s,o-s)),s=-1),e+=a[o];for(a=c(r),r=a.next();!r.done;r=a.next())r=r.value,s=r.replace(" ",".voice-"),e=e.replace("<"+r+">","<"+s+">"),e=e.replace("</"+r+">","</"+s+">"),i||(e+="</"+s+">")}e=Xx(e);try{var d=Ea("<span>"+e+"</span>","span")}catch(e){}if(d)if(d=d.children,1!=d.length||d[0].tagName)for(d=c(d),e=d.next();!e.done;e=d.next())Zx(e.value,t,n);else t.payload=yn(e);else t.payload=yn(e)}else t.payload=yn(e)}function Xx(e){var t={"< ":""," >":" &gt;"},n=/(< +>|<\s|\s>)/g,i=RegExp(n.source);return e&&i.test(e)?e.replace(n,function(e){return t[e]||""}):e||""}function Qx(e,t){return e&&0<e.length?e:t}function Zx(e,t,n){var i=t.clone();if(i.nestedCues=[],i.payload="",i.rubyTag="",i.line=null,i.region=new De,i.position=null,i.size=0,e.tagName)for(var r=c(e.tagName.split(/(?=[ .])+/g)),a=r.next();!a.done;a=r.next()){var s=a=a.value;if(s.startsWith(".voice-")){var o=s.split("-").pop();s='v[voice="'+o+'"]',n.has(s)||(s="v[voice="+o+"]")}switch(n.has(s)&&(s=n.get(s))&&(i.backgroundColor=Qx(s.backgroundColor,i.backgroundColor),i.color=Qx(s.color,i.color),i.fontFamily=Qx(s.fontFamily,i.fontFamily),i.fontSize=Qx(s.fontSize,i.fontSize),i.textShadow=Qx(s.textShadow,i.textShadow),i.fontWeight=s.fontWeight,i.fontStyle=s.fontStyle,i.opacity=s.opacity,i.rubyTag=s.rubyTag,i.textCombineUpright=s.textCombineUpright,i.wrapLine=s.wrapLine),a){case"br":return i=Ve(i.startTime,i.endTime),void t.nestedCues.push(i);case"b":i.fontWeight=700;break;case"i":i.fontStyle="italic";break;case"u":i.textDecoration.push("underline");break;case"font":(a=e.attributes.color)&&(i.color=a);break;case"div":if(a=e.attributes.time,!a)break;(a=tA(new Vf(a)))&&(i.startTime=a);break;case"ruby":case"rp":case"rt":i.rubyTag=a}}if(r=e.children,ka(e)||1==r.length&&ka(r[0]))for(n=Ra(e).split("\n"),e=!0,n=c(n),r=n.next();!r.done;r=n.next())r=r.value,e||(e=Ve(i.startTime,i.endTime),t.nestedCues.push(e)),0<r.length&&(e=i.clone(),e.payload=yn(r),t.nestedCues.push(e)),e=!1;else for(t.nestedCues.push(i),t=c(r),e=t.next();!e.done;e=t.next())Zx(e.value,i,n)}function Jx(e,t,n){var i;(i=/^align:(start|middle|center|end|left|right)$/.exec(t))?(t=i[1],e.textAlign="middle"==t?He:ze[t.toUpperCase()]):(i=/^vertical:(lr|rl)$/.exec(t))?e.writingMode="lr"==i[1]?"vertical-lr":"vertical-rl":(i=/^size:([\d.]+)%$/.exec(t))?e.size=Number(i[1]):(i=/^position:([\d.]+)%(?:,(line-left|line-right|middle|center|start|end|auto))?$/.exec(t))?(e.position=Number(i[1]),i[2]&&(t=i[2],e.positionAlign="line-left"==t||"start"==t?"line-left":"line-right"==t||"end"==t?"line-right":"center"==t||"middle"==t?"center":Ge)):(i=/^region:(.*)$/.exec(t))?(t=eA(n,i[1]))&&(e.region=t):(n=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))?(e.lineInterpretation=1,e.line=Number(n[1]),n[2]&&(e.lineAlign=Qe[n[2].toUpperCase()])):(n=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(t))&&(e.lineInterpretation=Ye,e.line=Number(n[1]),n[2]&&(e.lineAlign=Qe[n[2].toUpperCase()]))}function eA(e,t){return e=e.filter(function(e){return e.id==t}),e.length?e[0]:null}function tA(e){if(e=Gf(e,nA),null==e)return null;var t=Number(e[2]),n=Number(e[3]);return 59<t||59<n?null:Number(e[4])/1e3+n+60*t+3600*(Number(e[1])||0)}ri["application/ttml+xml"]=function(){return new vx},$x.prototype.parseInit=function(e){var t=!1;if((new ca).box("moov",da).box("trak",da).box("mdia",da).box("minf",da).box("stbl",da).S("stsd",ha).box("stpp",function(e){t=!0,e.parser.stop()}).parse(e),!t)throw new It(2,2,2007)},$x.prototype.setSequenceMode=function(){},$x.prototype.setManifestType=function(){},$x.prototype.parseMedia=function(e,t,n){var i=this,r=!1,a=[];if((new ca).box("mdat",ga(function(e){r=!0,a=a.concat(i.g.parseMedia(e,t,n))})).parse(e,!1),!r)throw new It(2,2,2007);return a},z("shaka.text.Mp4TtmlParser",$x),$x.prototype.parseMedia=$x.prototype.parseMedia,$x.prototype.setManifestType=$x.prototype.setManifestType,$x.prototype.setSequenceMode=$x.prototype.setSequenceMode,$x.prototype.parseInit=$x.prototype.parseInit,ri['application/mp4; codecs="stpp"']=function(){return new $x},ri['application/mp4; codecs="stpp.ttml"']=function(){return new $x},ri['application/mp4; codecs="stpp.ttml.im1t"']=function(){return new $x},ri['application/mp4; codecs="stpp.ttml.im2t"']=function(){return new $x},ri['application/mp4; codecs="stpp.ttml.etd1"']=function(){return new $x},ri['application/mp4; codecs="stpp.ttml.etd1|im1t"']=function(){return new $x},ri['application/mp4; codecs="stpp.ttml.im1t|etd1"']=function(){return new $x},ri['application/mp4; codecs="stpp.TTML.im1t"']=function(){return new $x},Wx.prototype.parseInit=function(){},Wx.prototype.setSequenceMode=function(e){this.h=e},Wx.prototype.setManifestType=function(e){this.g=e},Wx.prototype.parseMedia=function(e,t){e=hn(e),e=e.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n");var n=e.split(/\n{2,}/m);if(!/^WEBVTT($|[ \t\n])/m.test(n[0]))throw new It(2,2,2e3);if(e=t.vttOffset,n[0].includes("X-TIMESTAMP-MAP")&&"HLS"==this.g)if(this.h){var i=n[0];if(e=i.match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),i=i.match(/MPEGTS:(\d+)/m),!e||!i)throw new It(2,2,2e3);if(e=tA(new Vf(e[1])),null==e)throw new It(2,2,2e3);e=t.periodStart+Number(i[1])/9e4-e}else e=t.segmentStart;t=[],i=c(n[0].split("\n"));for(var r=i.next();!r.done;r=i.next())if(r=r.value,/^Region:/.test(r)){r=new Vf(r);var a=new De;Hf(r),jf(r);for(var s=Hf(r);s;){var o=a,l=s;(s=/^id=(.*)$/.exec(l))?o.id=s[1]:(s=/^width=(\d{1,2}|100)%$/.exec(l))?o.width=Number(s[1]):(s=/^lines=(\d+)$/.exec(l))?(o.height=Number(s[1]),o.heightUnits=2):(s=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(l))?(o.regionAnchorX=Number(s[1]),o.regionAnchorY=Number(s[2])):(s=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(l))?(o.viewportAnchorX=Number(s[1]),o.viewportAnchorY=Number(s[2])):/^scroll=up$/.exec(l)&&(o.scroll="up"),jf(r),s=Hf(r)}t.push(a)}for(i=new Map,qx(i),r=[],n=c(n.slice(1)),a=n.next();!a.done;a=n.next()){if(a=a.value.split("\n"),(1!=a.length||a[0])&&!/^NOTE($|[ \t])/.test(a[0])&&"STYLE"==a[0]){for(o=[],s=-1,l=1;l<a.length;l++)a[l].includes("::cue")&&(o.push([]),s=o.length-1),-1!=s&&(o[s].push(a[l]),a[l].includes("}")&&(s=-1));for(o=c(o),s=o.next();!s.done;s=o.next()){var u=s.value;s="global",(l=u[0].match(/\((.*)\)/))&&(s=l.pop()),l=u.slice(1,-1),u[0].includes("}")&&(u=/\{(.*?)\}/.exec(u[0]))&&(l=u[1].split(";")),(u=i.get(s))||(u=new Be(0,0,""));for(var d=!1,h=0;h<l.length;h++){var f=/^\s*([^:]+):\s*(.*)/.exec(l[h]);if(f){var p=f[2].trim().replace(";","");switch(f[1].trim()){case"background-color":case"background":d=!0,u.backgroundColor=p;break;case"color":d=!0,u.color=p;break;case"font-family":d=!0,u.fontFamily=p;break;case"font-size":d=!0,u.fontSize=p;break;case"font-weight":(700<=parseInt(p,10)||"bold"==p)&&(d=!0,u.fontWeight=700);break;case"font-style":switch(p){case"normal":d=!0,u.fontStyle=tt;break;case"italic":d=!0,u.fontStyle="italic";break;case"oblique":d=!0,u.fontStyle="oblique"}break;case"opacity":d=!0,u.opacity=parseFloat(p);break;case"text-combine-upright":d=!0,u.textCombineUpright=p;break;case"text-shadow":d=!0,u.textShadow=p;break;case"white-space":d=!0,u.wrapLine="noWrap"!=p}}}d&&i.set(s,u)}}if(d=e,1==a.length&&!a[0]||/^NOTE($|[ \t])/.test(a[0])||"STYLE"==a[0]||"REGION"==a[0])a=null;else if(o=null,a[0].includes("--\x3e")||(o=a[0],a.splice(0,1)),s=new Vf(a[0]),l=tA(s),h=Gf(s,/[ \t]+--\x3e[ \t]+/g),u=tA(s),null==l||null==h||null==u)Z("Failed to parse VTT time code. Cue skipped:",o,a),a=null;else{for(l+=d,u+=d,a=a.slice(1).join("\n").trim(),i.has("global")?(d=i.get("global").clone(),d.startTime=l,d.endTime=u,d.payload=""):d=new Be(l,u,""),jf(s),l=Hf(s);l;)Jx(d,l,t),jf(s),l=Hf(s);Yx(a,d,i),null!=o&&(d.id=o),a=d}a&&r.push(a)}return r},z("shaka.text.VttTextParser",Wx),Wx.prototype.parseMedia=Wx.prototype.parseMedia,Wx.prototype.setManifestType=Wx.prototype.setManifestType,Wx.prototype.setSequenceMode=Wx.prototype.setSequenceMode,Wx.prototype.parseInit=Wx.prototype.parseInit;var nA=/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g;function iA(){this.g=null}function rA(e,t,n){var i,r,a;return(new ca).box("payl",ga(function(e){i=hn(e)})).box("iden",ga(function(e){r=hn(e)})).box("sttg",ga(function(e){a=hn(e)})).parse(e),i?aA(i,r,a,t,n):null}function aA(e,t,n,i,r){if(i=new Be(i,r,""),Yx(e,i,new Map),t&&(i.id=t),n)for(e=new Vf(n),t=Hf(e);t;)Jx(i,t,[]),jf(e),t=Hf(e);return i}function sA(){}function oA(e){if(e=Gf(e,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g),null==e)return null;var t=Number(e[2]),n=Number(e[3]);return 59<t||59<n?null:Number(e[4])/1e3+n+60*t+3600*(Number(e[1])||0)}function lA(){this.g=new Wx}function uA(e){var t="WEBVTT\n\n";if(""==e)return t;e=e.replace(/\r+/g,""),e=e.trim(),e=c(e.split("\n\n"));for(var n=e.next();!n.done;n=e.next())n=n.value.split(/\n/),n[0].match(/\d+/)&&n.shift(),n[0]=n[0].replace(/,/g,"."),t+=n.join("\n").replace(/{b}/g,"<b>").replace(/{\/b}/g,"</b>").replace(/{i}/g,"<i>").replace(/{\/i}/g,"</i>").replace(/{u}/g,"<u>").replace(/{\/u}/g,"</u>")+"\n\n";return t}function cA(){}function dA(e,t){var n=t.Fontname;if(n&&(e.fontFamily=n),(n=t.Fontsize)&&(e.fontSize=n+"px"),(n=t.PrimaryColour)&&(n=hA(n))&&(e.color=n),(n=t.BackColour)&&(n=hA(n))&&(e.backgroundColor=n),t.Bold&&(e.fontWeight=700),t.Italic&&(e.fontStyle="italic"),t.Underline&&e.textDecoration.push("underline"),(n=t.Spacing)&&(e.letterSpacing=n+"px"),n=t.Alignment)switch(parseInt(n,10)){case 1:e.displayAlign=Ke,e.textAlign="start";break;case 2:e.displayAlign=Ke,e.textAlign=He;break;case 3:e.displayAlign=Ke,e.textAlign="end";break;case 5:e.displayAlign="before",e.textAlign="start";break;case 6:e.displayAlign="before",e.textAlign=He;break;case 7:e.displayAlign="before",e.textAlign="end";break;case 9:e.displayAlign="center",e.textAlign="start";break;case 10:e.displayAlign="center",e.textAlign=He;break;case 11:e.displayAlign="center",e.textAlign="end"}(t=t.AlphaLevel)&&(e.opacity=parseFloat(t))}function hA(e){return e=parseInt(e.replace("&H",""),16),0<=e?"rgba("+(255&e)+","+(e>>8&255)+","+(e>>16&255)+","+(e>>24&255^255)/255+")":null}function fA(e){return e=vA.exec(e),3600*(e[1]?parseInt(e[1].replace(":",""),10):0)+60*parseInt(e[2],10)+parseFloat(e[3])}ri["text/vtt"]=function(){return new Wx},ri['text/vtt; codecs="vtt"']=function(){return new Wx},ri['text/vtt; codecs="wvtt"']=function(){return new Wx},iA.prototype.parseInit=function(e){var t=this,n=!1;if((new ca).box("moov",da).box("trak",da).box("mdia",da).S("mdhd",function(e){e=vo(e.reader,e.version),t.g=e.timescale}).box("minf",da).box("stbl",da).S("stsd",ha).box("wvtt",function(){n=!0}).parse(e),!this.g)throw new It(2,2,2008);if(!n)throw new It(2,2,2008)},iA.prototype.setSequenceMode=function(){},iA.prototype.setManifestType=function(){},iA.prototype.parseMedia=function(e,t){if(!e.length)return[];if(!this.g)throw new It(2,2,2008);var n,i=0,r=[],a=[],s=!1,o=!1,l=!1,u=null;if((new ca).box("moof",da).box("traf",da).S("tfdt",function(e){s=!0,i=mo(e.reader,e.version).baseMediaDecodeTime}).S("tfhd",function(e){u=go(e.reader,e.flags).qd}).S("trun",function(e){o=!0,r=yo(e.reader,e.version,e.flags).fh}).box("mdat",ga(function(e){l=!0,n=e})).parse(e,!1),!l&&!s&&!o)throw new It(2,2,2008);e=i;for(var d=new oa(n,0),h=c(r),f=h.next();!f.done;f=h.next()){f=f.value;var p=f.$f||u,g=f.He?i+f.He:e;e=g+(p||0);var m=0;do{var v=d.P();m+=v;var y=d.P(),b=null;"vttc"==va(y)?8<v&&(b=d.rb(v-8)):d.skip(v-8),p&&b&&(v=rA(b,t.periodStart+g/this.g,t.periodStart+e/this.g),a.push(v))}while(f.sampleSize&&m<f.sampleSize)}return a.filter(oi)},z("shaka.text.Mp4VttParser",iA),iA.prototype.parseMedia=iA.prototype.parseMedia,iA.prototype.setManifestType=iA.prototype.setManifestType,iA.prototype.setSequenceMode=iA.prototype.setSequenceMode,iA.prototype.parseInit=iA.prototype.parseInit,ri['application/mp4; codecs="wvtt"']=function(){return new iA},sA.prototype.parseInit=function(){},sA.prototype.setSequenceMode=function(){},sA.prototype.setManifestType=function(){},sA.prototype.parseMedia=function(e){var t=hn(e).replace(/\r+/g,"");if(t=t.trim(),e=[],""==t)return e;t=c(t.split("\n\n"));for(var n=t.next();!n.done;n=t.next()){n=n.value.split("\n");var i=new Vf(n[0]),r=oA(i),a=Gf(i,/,/g);if(i=oA(i),null==r||null==a||null==i)throw new It(2,2,2001,"Could not parse cue time range in SubViewer");e.push(new Be(r,i,n.slice(1).join("\n").trim()))}return e},z("shaka.text.SbvTextParser",sA),sA.prototype.parseMedia=sA.prototype.parseMedia,sA.prototype.setManifestType=sA.prototype.setManifestType,sA.prototype.setSequenceMode=sA.prototype.setSequenceMode,sA.prototype.parseInit=sA.prototype.parseInit,ri["text/x-subviewer"]=function(){return new sA},lA.prototype.parseInit=function(){},lA.prototype.setSequenceMode=function(){},lA.prototype.setManifestType=function(){},lA.prototype.parseMedia=function(e,t,n){return e=hn(e),e=uA(e),e=Ee(gn(e)),this.g.parseMedia(e,t,n)},z("shaka.text.SrtTextParser",lA),lA.srt2webvtt=uA,lA.prototype.parseMedia=lA.prototype.parseMedia,lA.prototype.setManifestType=lA.prototype.setManifestType,lA.prototype.setSequenceMode=lA.prototype.setSequenceMode,lA.prototype.parseInit=lA.prototype.parseInit,ri["text/srt"]=function(){return new lA},cA.prototype.parseInit=function(){},cA.prototype.setSequenceMode=function(){},cA.prototype.setManifestType=function(){},cA.prototype.parseMedia=function(e){var t="",n="",i=null,r=null;for(r=hn(e).split(/\r?\n\s*\r?\n/),e=c(r),r=e.next();!r.done;r=e.next()){var a=r.value;r=a,(a=pA.exec(a))&&(i=a[1],r=a[2]),"V4 Styles"==i||"V4+ Styles"==i?(t=r,t=n?t+"\n"+r:r):"Events"==i&&(n=n?n+"\n"+r:r)}for(i=[],r=null,t=c(t.split(/\r?\n/)),a=t.next();!a.done;a=t.next())if(e=a.value,!/^\s*;/.test(e)&&(a=gA.exec(e)))if(e=a[1].trim(),a=a[2].trim(),"Format"==e)r=a.split(mA);else if("Style"==e){e=a.split(mA),a={};for(var s=0;s<r.length&&s<e.length;s++)a[r[s]]=e[s];i.push(a)}for(r=[],t=null,e={},n=c(n.split(/\r?\n/)),a=n.next();!a.done;e={Ve:e.Ve},a=n.next())if(a=a.value,!/^\s*;/.test(a)&&(s=gA.exec(a)))if(a=s[1].trim(),s=s[2].trim(),"Format"==a)t=s.split(mA);else if("Dialogue"==a){s=s.split(mA),a={};for(var o=0;o<t.length&&o<s.length;o++)a[t[o]]=s[o];o=fA(a.Start);var l=fA(a.End);s=new Be(o,l,s.slice(t.length-1).join(",").replace(/\\N/g,"\n").replace(/\{[^}]+\}/g,"")),e.Ve=a.Style,(a=i.find(function(e){return function(t){return t.Name==e.Ve}}(e)))&&dA(s,a),r.push(s)}return r},z("shaka.text.SsaTextParser",cA),cA.prototype.parseMedia=cA.prototype.parseMedia,cA.prototype.setManifestType=cA.prototype.setManifestType,cA.prototype.setSequenceMode=cA.prototype.setSequenceMode,cA.prototype.parseInit=cA.prototype.parseInit;var pA=/^\s*\[([^\]]+)\]\r?\n([\s\S]*)/,gA=/^\s*([^:]+):\s*(.*)/,mA=/\s*,\s*/,vA=/^(\d+:)?(\d{1,2}):(\d{1,2}(?:[.]\d{1,3})?)?$/;function yA(e,t){var n=1&e[t+1]?7:9;return t+n<=e.length&&(e=((3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5)-n,0<e)?{le:n,ba:e}:null}function bA(e,t){var n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=(60&e[t+2])>>>2;if(i>n.length-1)return null;var r=1+((192&e[t+2])>>>6),a=(1&e[t+2])<<2;return a|=(192&e[t+3])>>>6,{sampleRate:n[i],channelCount:a,Na:"mp4a.40."+r}}function SA(e,t){if(t+1<e.length&&255===e[t]&&240===(246&e[t+1])){var n=1&e[t+1]?7:9;if(t+n>=e.length)return!1;var i=(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5;return!(i<=n)&&(t+=i,t===e.length||t+1<e.length&&255===e[t]&&240===(246&e[t+1]))}return!1}function TA(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t||3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}function _A(e){this.i=e,this.h=0,this.g=new Map}function wA(e,t){if(t+8>e.length||11!==e[t]||119!==e[t+1])return null;var n=e[t+4]>>6;if(3<=n)return null;var i=63&e[t+4],r=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*i+n];if(t+r>e.length)return null;var a=e[t+6]>>5,s=0;2===a?s+=2:(1&a&&1!==a&&(s+=2),4&a&&(s+=2)),s=(e[t+6]<<8|e[t+7])>>12-s&1;var o=7&e[t+5];return e=new Uint8Array([n<<6|e[t+5]>>3<<1|o>>2,(3&o)<<6|a<<3|s<<2|i>>4,i<<4&224]),{sampleRate:[48e3,44100,32e3][n],channelCount:[2,1,2,3,3,4,4,5][a]+s,ma:e,ba:r}}function EA(e,t){if(11===e[t]&&119===e[t+1]){var n,i,r=0,a=5;for(t+=a;0<a;){i=e[t];var s=Math.min(a,8),o=8-s;n=4278190080>>>24+o<<o,n=(i&n)>>o,r=r?r<<s|n:n,t+=1,a-=s}if(16>r)return!0}return!1}function xA(e){this.i=e,this.h=0,this.g=new Map}function AA(e,t){if(t+8>e.length||2935!==(e[t]<<8|e[t+1]<<0))return null;var n=new Eo(e.subarray(t+2));Ao(n,2),Ao(n,3);var i=ko(n,11)+1<<1,r=ko(n,2);if(3==r){r=ko(n,2),r=[24e3,22060,16e3][r];var a=3}else r=[48e3,44100,32e3][r],a=ko(n,2);var s=ko(n,3),o=ko(n,1);return n=ko(n,5),t+i>e.byteLength?null:(e=Math.floor(i*r/(16*[1,2,3,6][a])),e=new Uint8Array([(8160&e)>>5,(31&e)<<3,r<<6|n<<1|0,0|s<<1|o<<0,0]),{sampleRate:r,channelCount:[2,1,2,3,3,4,4,5][s]+o,ma:e,ba:i})}function kA(e){this.i=e,this.h=0,this.g=new Map}function IA(e){if(!e.length)return null;var t=e.find(function(e){return 7==e.type});if(e=e.find(function(e){return 8==e.type}),!t||!e)return null;var n=new Eo(t.data),i=Lo(n);if(Lo(n),Lo(n),Co(n),RA.includes(i)&&(i=Ro(n),3===i&&Ao(n,1),Co(n),Co(n),Ao(n,1),Do(n))){i=3!==i?8:12;for(var r=0;r<i;r++)Do(n)&&Po(n,6>r?16:64)}if(Co(n),i=Ro(n),0===i)Ro(n);else if(1===i)for(Ao(n,1),Co(n),Co(n),i=Ro(n),r=0;r<i;r++)Co(n);Co(n),Ao(n,1);var a=Ro(n),s=Ro(n),o=ko(n,1);0===o&&Ao(n,1),Ao(n,1);var l=0,u=0,c=0,h=0;if(Do(n)&&(l=Ro(n),u=Ro(n),c=Ro(n),h=Ro(n)),r=i=1,Do(n)&&Do(n)){var f=Lo(n),p=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],g=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];0<f&&16>=f?(i=p[f-1],r=g[f-1]):255===f&&(i=ko(n,16),r=ko(n,16))}return n=(2-o)*(s+1)*16-2*c-2*h,a=16*(a+1)-2*l-2*u,l=[],t=t.fullData,l.push(t.byteLength>>>8&255),l.push(255&t.byteLength),l=l.concat.apply(l,d(t)),t=[],e=e.fullData,t.push(e.byteLength>>>8&255),t.push(255&e.byteLength),t=t.concat.apply(t,d(e)),e=new Uint8Array([1,l[3],l[4],l[5],255,225].concat(l,[1],t)),{height:n,width:a,wa:e,Ba:i,Ca:r}}function CA(e){var t=!1,n=[],i=e.find(function(e){return 7==e.type}),r=!1;e=c(e);for(var a=e.next();!a.done;a=e.next()){a=a.value;var s=!1;switch(a.type){case 1:s=r=!0;var o=a.data;i&&4<o.length&&(o=Oo(new Eo(o)),2===o||4===o||7===o||9===o)&&(t=!0);break;case 5:t=s=r=!0;break;case 6:s=!0;break;case 7:s=!0;break;case 8:s=!0;break;case 9:r=s=!0;break;case 12:s=!0;break;default:s=!1}r&&s&&(s=a.fullData.byteLength,o=new Uint8Array(4),o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=255&s,n.push(o),n.push(a.fullData))}return n.length?{data:An.apply(Sn,d(n)),Cd:t}:null}ri["text/x-ssa"]=function(){return new cA},i=_A.prototype,i.destroy=function(){this.g.clear()},i.isSupported=function(e){return"audio/aac"==e.toLowerCase().split(";")[0]&&ce(this.convertCodecs("audio",e))},i.convertCodecs=function(e,t){return"audio/aac"==t.toLowerCase().split(";")[0]?'audio/mp4; codecs="'+($n(t)||"mp4a.40.2")+'"':t},i.getOriginalMimeType=function(){return this.i},i.transmux=function(e,t,n,i){for(var r=Ee(e),a=po(r),s=a.length;s<r.length&&!SA(r,s);s++);if(e=1e3*n.endTime,a=fo(a),a.length&&n&&(a=a.find(function(e){return"com.apple.streaming.transportStreamTimestamp"===e.description}))&&(e=a.data),a=bA(r,s),!a)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));t.audioSamplingRate=a.sampleRate,t.channelsCount=a.channelCount;for(var o=[];s<r.length;){var l=yA(r,s);if(!l)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));var u=l.le+l.ba;s+u<=r.length&&o.push({data:r.subarray(s+l.le,s+u),size:l.ba,duration:1024,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),s+=u}return r=a.sampleRate,e=Math.floor(e*r/1e3),i={id:t.id,type:"audio",codecs:a.Na,encrypted:t.encrypted&&0<t.drmInfos.length,timescale:r,duration:i,ab:[],ma:new Uint8Array([]),wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.h,baseMediaDecodeTime:e,Za:o},stream:t},i=new GS([i]),n=t.id+"_"+n.i,this.g.has(n)?t=this.g.get(n):(t=HS(i),this.g.set(n,t)),n=qS(i),this.h++,t=An(t,n),Promise.resolve(t)},z("shaka.transmuxer.AacTransmuxer",_A),_A.prototype.transmux=_A.prototype.transmux,_A.prototype.getOriginalMimeType=_A.prototype.getOriginalMimeType,_A.prototype.convertCodecs=_A.prototype.convertCodecs,_A.prototype.isSupported=_A.prototype.isSupported,_A.prototype.destroy=_A.prototype.destroy,rt("audio/aac",function(){return new _A("audio/aac")},ot),i=xA.prototype,i.destroy=function(){this.g.clear()},i.isSupported=function(e){return"audio/ac3"==e.toLowerCase().split(";")[0]&&ce(this.convertCodecs("audio",e))},i.convertCodecs=function(e,t){return"audio/ac3"==t.toLowerCase().split(";")[0]?'audio/mp4; codecs="ac-3"':t},i.getOriginalMimeType=function(){return this.i},i.transmux=function(e,t,n,i){e=Ee(e);for(var r=po(e),a=r.length;a<e.length&&!EA(e,a);a++);var s=1e3*n.endTime;r=fo(r),r.length&&n&&(r=r.find(function(e){return"com.apple.streaming.transportStreamTimestamp"===e.description}))&&(s=r.data),r=0;for(var o=new Uint8Array([]),l=[];a<e.length;){var u=wA(e,a);if(!u)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));t.audioSamplingRate=u.sampleRate,t.channelsCount=u.channelCount,r=u.sampleRate,o=u.ma,l.push({data:e.subarray(a,a+u.ba),size:u.ba,duration:1536,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),a+=u.ba}return e=Math.floor(s*r/1e3),i={id:t.id,type:"audio",codecs:"ac-3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:r,duration:i,ab:[],ma:o,wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.h,baseMediaDecodeTime:e,Za:l},stream:t},i=new GS([i]),n=t.id+"_"+n.i,this.g.has(n)?t=this.g.get(n):(t=HS(i),this.g.set(n,t)),n=qS(i),this.h++,t=An(t,n),Promise.resolve(t)},z("shaka.transmuxer.Ac3Transmuxer",xA),xA.prototype.transmux=xA.prototype.transmux,xA.prototype.getOriginalMimeType=xA.prototype.getOriginalMimeType,xA.prototype.convertCodecs=xA.prototype.convertCodecs,xA.prototype.isSupported=xA.prototype.isSupported,xA.prototype.destroy=xA.prototype.destroy,rt("audio/ac3",function(){return new xA("audio/ac3")},ot),i=kA.prototype,i.destroy=function(){this.g.clear()},i.isSupported=function(e){return"audio/ec3"==e.toLowerCase().split(";")[0]&&ce(this.convertCodecs("audio",e))},i.convertCodecs=function(e,t){return"audio/ec3"==t.toLowerCase().split(";")[0]?'audio/mp4; codecs="ec-3"':t},i.getOriginalMimeType=function(){return this.i},i.transmux=function(e,t,n,i){e=Ee(e);for(var r=po(e),a=r.length;a<e.length&&2935!==(e[a]<<8|e[a+1]<<0);a++);var s=1e3*n.endTime;r=fo(r),r.length&&n&&(r=r.find(function(e){return"com.apple.streaming.transportStreamTimestamp"===e.description}))&&(s=r.data),r=0;for(var o=new Uint8Array([]),l=[];a<e.length;){var u=AA(e,a);if(!u)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));t.audioSamplingRate=u.sampleRate,t.channelsCount=u.channelCount,r=u.sampleRate,o=u.ma,l.push({data:e.subarray(a,a+u.ba),size:u.ba,duration:1536,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),a+=u.ba}return e=Math.floor(s*r/1e3),i={id:t.id,type:"audio",codecs:"ec-3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:r,duration:i,ab:[],ma:o,wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.h,baseMediaDecodeTime:e,Za:l},stream:t},i=new GS([i]),n=t.id+"_"+n.i,this.g.has(n)?t=this.g.get(n):(t=HS(i),this.g.set(n,t)),n=qS(i),this.h++,t=An(t,n),Promise.resolve(t)},z("shaka.transmuxer.Ec3Transmuxer",kA),kA.prototype.transmux=kA.prototype.transmux,kA.prototype.getOriginalMimeType=kA.prototype.getOriginalMimeType,kA.prototype.convertCodecs=kA.prototype.convertCodecs,kA.prototype.isSupported=kA.prototype.isSupported,kA.prototype.destroy=kA.prototype.destroy,rt("audio/ec3",function(){return new kA("audio/ec3")},ot);var RA=[100,110,122,244,44,83,86,118,128,138,139,134];function MA(e){if(!e.length)return null;var t=e.find(function(e){return 32==e.type}),n=e.find(function(e){return 33==e.type}),i=e.find(function(e){return 34==e.type});if(!t||!n||!i)return null;var r=DA(t.fullData);e=LA(n.fullData);var a=PA(i.fullData);return t=OA(t.fullData,n.fullData,i.fullData,{Qf:r.Qf,kg:r.kg,Bf:e.Bf,Cf:e.Cf,vf:e.vf,Af:e.Af,wf:e.wf,xf:e.xf,yf:e.yf,zf:e.zf,nf:e.nf,pf:e.pf,qf:e.qf,rf:e.rf,tf:e.tf,uf:e.uf,hf:e.hf,ve:e.ve,ff:e.ff,df:e.df,cf:e.cf,Tf:a.Tf}),{height:e.height,width:e.width,wa:t,Ba:e.Yi,Ca:e.Xi}}function DA(e){var t=new Eo(e,!0);return Lo(t),Lo(t),ko(t,4),ko(t,2),ko(t,6),e=ko(t,3),t=Do(t),{Qf:e+1,kg:t}}function LA(e){e=new Eo(e,!0),Lo(e),Lo(e);var t=0,n=0,i=0,r=0;ko(e,4);var a=ko(e,3);Do(e);for(var s=ko(e,2),o=ko(e,1),l=ko(e,5),u=Lo(e),c=Lo(e),d=Lo(e),h=Lo(e),f=Lo(e),p=Lo(e),g=Lo(e),m=Lo(e),v=Lo(e),y=Lo(e),b=Lo(e),S=[],T=[],_=0;_<a;_++)S.push(Do(e)),T.push(Do(e));if(0<a)for(_=a;8>_;_++)ko(e,2);for(_=0;_<a;_++)S[_]&&ko(e,88),T[_]&&Lo(e);Ro(e),S=Ro(e),3==S&&ko(e,1),T=Ro(e),_=Ro(e),Do(e)&&(t+=Ro(e),n+=Ro(e),i+=Ro(e),r+=Ro(e));var w=Ro(e),E=Ro(e),x=Ro(e);if(Do(e))for(var A=0;A<=a;A++)Ro(e),Ro(e),Ro(e);else Ro(e),Ro(e),Ro(e);if(Ro(e),Ro(e),Ro(e),Ro(e),Ro(e),Ro(e),Do(e)&&Do(e))for(A=0;4>A;A++)for(var k=0;k<(3===A?2:6);k++)if(Do(e)){var I=Math.min(64,1<<4+(A<<1));1<A&&Mo(e);for(var C=0;C<I;C++)Mo(e)}else Ro(e);for(Do(e),Do(e),Do(e)&&(Lo(e),Ro(e),Ro(e),Do(e)),A=Ro(e),I=k=0;I<A;I++)if(C=!1,0!==I&&(C=Do(e)),C){I===A&&Ro(e),Do(e),Ro(e);for(var R=C=0;R<=k;R++){var M=Do(e),D=!1;M||(D=Do(e)),(M||D)&&C++}k=C}else{for(R=Ro(e),C=Ro(e),k=R+C,M=0;M<R;M++)Ro(e),Do(e);for(R=0;R<C;R++)Ro(e),Do(e)}if(Do(e))for(A=Ro(e),k=0;k<A;k++){for(I=0;I<x+4;I++)ko(e,1);ko(e,1)}if(A=x=1,k=0,Do(e),Do(e),Do(e)){if(Do(e)&&(I=Lo(e),C=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],R=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1],0<I&&16>=I?(x=C[I-1],A=R[I-1]):255===I&&(x=ko(e,16),A=ko(e,16))),Do(e)&&Do(e),Do(e)&&(ko(e,3),Do(e),Do(e)&&(Lo(e),Lo(e),Lo(e))),Do(e)&&(Ro(e),Ro(e)),Do(e),Do(e),Do(e),(I=Do(e))&&(Ro(e),Ro(e),Ro(e),Ro(e)),Do(e)&&(ko(e,32),ko(e,32),Do(e)&&Ro(e),Do(e)))for(R=!1,I=Do(e),C=Do(e),(I||C)&&((R=Do(e))&&(Lo(e),ko(e,5),Do(e),ko(e,5)),ko(e,4),ko(e,4),R&&ko(e,4),ko(e,5),ko(e,5),ko(e,5)),M=0;M<=a;M++){var L=!0;D=1,Do(e)||(L=Do(e));var P=!1;if(L?Ro(e):P=Do(e),P||(D=Ro(e)+1),I){for(L=0;L<D;L++)Ro(e),Ro(e),R&&(Ro(e),Ro(e));Do(e)}if(C){for(L=0;L<D;L++)Ro(e),Ro(e),R&&(Ro(e),Ro(e));Do(e)}}Do(e)&&(Do(e),Do(e),Do(e),k=Ro(e),Ro(e),Ro(e),Ro(e),Ro(e))}return{vf:b,Bf:s,Cf:o,Af:l,wf:u,xf:c,yf:d,zf:h,nf:f,pf:p,qf:g,rf:m,tf:v,uf:y,ve:k,hf:0,ff:S,df:w,cf:E,width:T-(t+n)*(1===S||2===S?2:1),height:_-(i+r)*(1===S?2:1),Yi:x,Xi:A}}function PA(e){var t=new Eo(e,!0);Lo(t),Lo(t),Ro(t),Ro(t),Do(t),Do(t),ko(t,3),Do(t),Do(t),Ro(t),Ro(t),Mo(t),Do(t),Do(t),Do(t)&&Ro(t),Mo(t),Mo(t),Do(t),Do(t),Do(t),Do(t),e=Do(t),t=Do(t);var n=1;return t&&e?n=0:t?n=3:e&&(n=2),{Tf:n}}function OA(e,t,n,i){var r=new Uint8Array(23+(5+e.byteLength)+(5+t.byteLength)+(5+n.byteLength));return r[0]=1,r[1]=(3&i.Bf)<<6|(i.Cf?1:0)<<5|31&i.Af,r[2]=i.wf,r[3]=i.xf,r[4]=i.yf,r[5]=i.zf,r[6]=i.nf,r[7]=i.pf,r[8]=i.qf,r[9]=i.rf,r[10]=i.tf,r[11]=i.uf,r[12]=i.vf,r[13]=240|(3840&i.ve)>>8,r[14]=255&i.ve,r[15]=252|3&i.Tf,r[16]=252|3&i.ff,r[17]=248|7&i.df,r[18]=248|7&i.cf,r[19]=0,r[20]=0,r[21]=(3&i.hf)<<6|(7&i.Qf)<<3|(i.kg?1:0)<<2|3,r[22]=3,r[23]=160,r[24]=0,r[25]=1,r[26]=(65280&e.byteLength)>>8,r[27]=(255&e.byteLength)>>0,r.set(e,28),r[23+(5+e.byteLength)]=161,r[e.byteLength+29]=0,r[e.byteLength+30]=1,r[e.byteLength+31]=(65280&t.byteLength)>>8,r[e.byteLength+32]=(255&t.byteLength)>>0,r.set(t,e.byteLength+33),r[23+(e.byteLength+10+t.byteLength)]=162,r[e.byteLength+10+t.byteLength+24]=0,r[e.byteLength+10+t.byteLength+25]=1,r[e.byteLength+10+t.byteLength+26]=(65280&n.byteLength)>>8,r[e.byteLength+10+t.byteLength+27]=(255&n.byteLength)>>0,r.set(n,e.byteLength+10+t.byteLength+28),r}function NA(e,t){var n=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==n&&0!==r&&15!==r&&3!==a){var s=e[t+3]>>6;r=1e3*BA[14*(3===n?3-i:3===i?3:4)+r-1],a=VA[3*(3===n?0:2===n?1:2)+a],n=jA[n][i];var o=GA[i],l=Math.floor(n*r/a+(e[t+2]>>1&1))*o,u=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);return(u=u?parseInt(u[1],10):0)&&87>=u&&2===i&&224e3<=r&&0===s&&(e[t+3]|=128),{sampleRate:a,channelCount:3===s?1:2,ba:l,Wi:8*n*o}}return null}function UA(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function FA(e,t){if(t+1<e.length&&UA(e,t)){var n=NA(e,t),i=4;return n&&n.ba&&(i=n.ba),t+=i,t===e.length||t+1<e.length&&UA(e,t)}return!1}var BA=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],VA=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],jA=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],GA=[0,1,1,4];function HA(e){this.i=e,this.h=0,this.g=new Map}function zA(e){this.h=e,this.g=null}
/*
 @license
 MSS Transmuxer
 Copyright 2015 Dash Industry Forum
 SPDX-License-Identifier: BSD-3-Clause
*/
function KA(e){this.h=e,(this.g=Jy.get("ISOBoxer")())&&$A(this)}function $A(e){function t(){this._procFullBox(),1&this.flags&&(this._procField("AlgorithmID","uint",24),this._procField("IV_size","uint",8),this._procFieldArray("KID",16,"uint",8)),this._procField("sample_count","uint",32),this._procEntries("entry",this.sample_count,function(e){this._procEntryField(e,"InitializationVector","data",8),2&this.flags&&(this._procEntryField(e,"NumberOfEntries","uint",16),this._procSubEntries(e,"clearAndCryptedData",e.NumberOfEntries,function(e){this._procEntryField(e,"BytesOfClearData","uint",16),this._procEntryField(e,"BytesOfEncryptedData","uint",32)}))})}e.g.addBoxProcessor("saio",function(){this._procFullBox(),1&this.flags&&(this._procField("aux_info_type","uint",32),this._procField("aux_info_type_parameter","uint",32)),this._procField("entry_count","uint",32),this._procFieldArray("offset",this.entry_count,"uint",1===this.version?64:32)}),e.g.addBoxProcessor("saiz",function(){this._procFullBox(),1&this.flags&&(this._procField("aux_info_type","uint",32),this._procField("aux_info_type_parameter","uint",32)),this._procField("default_sample_info_size","uint",8),this._procField("sample_count","uint",32),0===this.default_sample_info_size&&this._procFieldArray("sample_info_size",this.sample_count,"uint",8)}),e.g.addBoxProcessor("senc",t),e.g.addBoxProcessor("uuid",function(){for(var e=!0,n=0;16>n;n++)this.usertype[n]!==qA[n]&&(e=!1);e&&(this._parsing&&(this.type="sepiff"),t.call(this))})}function WA(e,t){for(var n=8,i=0;i<e.boxes.length&&e.boxes[i].type!==t;i++)n+=e.boxes[i].size;return n}i=HA.prototype,i.destroy=function(){this.g.clear()},i.isSupported=function(e){return"audio/mpeg"==e.toLowerCase().split(";")[0]&&ce(this.convertCodecs("audio",e))},i.convertCodecs=function(e,t){return"audio/mpeg"==t.toLowerCase().split(";")[0]?'audio/mp4; codecs="mp3"':t},i.getOriginalMimeType=function(){return this.i},i.transmux=function(e,t,n,i){for(var r=Ee(e),a=po(r).length;a<r.length&&!FA(r,a);a++);var s;for(e=[];a<r.length;){var o=NA(r,a);if(!o)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));s||(s=o),a+o.ba<=r.length&&e.push({data:r.subarray(a,a+o.ba),size:o.ba,duration:1152,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),a+=o.ba}return s?(r=9e4*s.Wi/s.sampleRate*this.h,i={id:t.id,type:"audio",codecs:"mp3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:s.sampleRate,duration:i,ab:[],ma:new Uint8Array([]),wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.h,baseMediaDecodeTime:r,Za:e},stream:t},i=new GS([i]),n=t.id+"_"+n.i,this.g.has(n)?t=this.g.get(n):(t=HS(i),this.g.set(n,t)),n=qS(i),this.h++,t=An(t,n),Promise.resolve(t)):Promise.reject(new It(2,3,3018,n?n.M()[0]:null))},z("shaka.transmuxer.Mp3Transmuxer",HA),HA.prototype.transmux=HA.prototype.transmux,HA.prototype.getOriginalMimeType=HA.prototype.getOriginalMimeType,HA.prototype.convertCodecs=HA.prototype.convertCodecs,HA.prototype.isSupported=HA.prototype.isSupported,HA.prototype.destroy=HA.prototype.destroy,rt("audio/mpeg",function(){return new HA("audio/mpeg")},ot),i=zA.prototype,i.destroy=function(){},i.isSupported=function(e){if("video/mp2t"!=e.toLowerCase().split(";")[0])return!1;var t=$n(e).split(","),n=Mn("audio",t);return t=Mn("video",t),!(!n||t||"mp3"!=Hn(n))&&ce(this.convertCodecs("audio",e))},i.convertCodecs=function(e,t){return"video/mp2t"==t.toLowerCase().split(";")[0]?"audio/mpeg":t},i.getOriginalMimeType=function(){return this.h},i.transmux=function(e,t,n,i,r){if(this.g?this.g.clearData():this.g=new No,e=Ee(e),e=this.g.parse(e),"mp3"!=e.sd().audio||"audio"!=r)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));for(n=new Uint8Array([]),r=c(e.Wb()),e=r.next();!e.done;e=r.next())if(e=e.value.data)for(t=0;t<e.length;)(i=NA(e,t))?(t+i.ba<=e.length&&(n=An(n,e.subarray(t,t+i.ba))),t+=i.ba):t++;return Promise.resolve(n)},z("shaka.transmuxer.MpegTsTransmuxer",zA),zA.prototype.transmux=zA.prototype.transmux,zA.prototype.getOriginalMimeType=zA.prototype.getOriginalMimeType,zA.prototype.convertCodecs=zA.prototype.convertCodecs,zA.prototype.isSupported=zA.prototype.isSupported,zA.prototype.destroy=zA.prototype.destroy,rt("video/mp2t",function(){return new zA("video/mp2t")},lt),i=KA.prototype,i.destroy=function(){},i.isSupported=function(e,t){var n=e.startsWith("mss/");return!(!this.g||!n)&&(t?ce(this.convertCodecs(t,e)):(t=this.convertCodecs("audio",e),e=this.convertCodecs("video",e),ce(t)||ce(e)))},i.convertCodecs=function(e,t){return t.replace("mss/","")},i.getOriginalMimeType=function(){return this.h},i.transmux=function(e,t,n){if(!n)return Promise.resolve(Ee(e));if(!t.mssPrivateData)return Promise.reject(new It(2,3,3020,n?n.M()[0]:null));try{var i,r=this.g.parseBuffer(e),a=r.fetch("tfhd");a.track_ID=t.id+1;var s=r.fetch("tfdt"),o=r.fetch("traf");null===s&&(s=this.g.createFullBox("tfdt",o,a),s.version=1,s.flags=0,s.baseMediaDecodeTime=Math.floor(n.startTime*t.mssPrivateData.timescale));var l=r.fetch("trun"),u=r.fetch("tfxd");u&&u._parent.boxes.splice(u._parent.boxes.indexOf(u),1);var c=r.fetch("tfrf");c&&c._parent.boxes.splice(c._parent.boxes.indexOf(c),1);var d=r.fetch("sepiff");if(null!==d){d.type="senc",d.usertype=void 0;var h=r.fetch("saio");if(null===h){h=this.g.createFullBox("saio",o),h.version=0,h.flags=0,h.entry_count=1,h.offset=[0];var f=this.g.createFullBox("saiz",o);if(f.version=0,f.flags=0,f.sample_count=d.sample_count,f.default_sample_info_size=0,f.sample_info_size=[],2&d.flags)for(i=0;i<d.sample_count;i+=1)f.sample_info_size[i]=10+6*d.entry[i].NumberOfEntries;else f.default_sample_info_size=8}}a.flags&=16777214,a.flags|=131072,l.flags|=1;var p=r.fetch("moof");l.data_offset=p.getLength()+8;var g=r.fetch("saio");null!==g&&(g.offset[0]=WA(p,"traf")+WA(o,"senc")+16);var m=Ee(r.write());return Promise.resolve(m)}catch(e){return e instanceof It?Promise.reject(e):Promise.reject(new It(2,3,3022,n?n.M()[0]:null))}},z("shaka.transmuxer.MssTransmuxer",KA),KA.prototype.transmux=KA.prototype.transmux,KA.prototype.getOriginalMimeType=KA.prototype.getOriginalMimeType,KA.prototype.convertCodecs=KA.prototype.convertCodecs,KA.prototype.isSupported=KA.prototype.isSupported,KA.prototype.destroy=KA.prototype.destroy;var qA=new Uint8Array([162,57,79,82,90,155,79,20,162,68,108,66,124,100,141,244]);function YA(e){this.l=e,this.g=0,this.i=new Map,this.h=this.j=null}rt("mss/audio/mp4",function(){return new KA("mss/audio/mp4")},ot),rt("mss/video/mp4",function(){return new KA("mss/video/mp4")},ot),i=YA.prototype,i.destroy=function(){this.i.clear(),this.h&&this.h.destroy()},i.isSupported=function(e,t){if("video/mp2t"!=e.toLowerCase().split(";")[0])return!1;var n=e;t&&(n=this.convertCodecs(t,e));var i=$n(n).split(",");return n=Mn("audio",i),i=Mn("video",i),!(n&&(n=Hn(n),!ZA.includes(n))||i&&(n=Hn(i),!JA.includes(n)))&&(t?ce(this.convertCodecs(t,e)):(t=this.convertCodecs("audio",e),e=this.convertCodecs("video",e),ce(t)||ce(e)))},i.convertCodecs=function(e,t){return"video/mp2t"==t.toLowerCase().split(";")[0]?(t=$n(t).replace("mp4a.40.34","mp3").split(",").map(function(e){return Pi(e,"audio/mp4")}).map(Oi).join(","),"audio"==e?'audio/mp4; codecs="'+t+'"':'video/mp4; codecs="'+t+'"'):t},i.getOriginalMimeType=function(){return this.l},i.transmux=function(e,t,n,i,r){var a=Ee(e);if("audio"==r&&!jo(a)){for(var s=po(a),o=s.length;o<a.length;o++)if(FA(a,o))return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));for(o=s.length;o<a.length;o++)if(SA(a,o))return this.h||(this.h=new _A("audio/aac")),this.h.transmux(e,t,n,i,r);return Promise.reject(new It(2,3,3018,n?n.M()[0]:null))}this.j?this.j.clearData():this.j=new No;var l=this.j.parse(a),u=[],h=l.sd();try{var f=null;if("video"==r){switch(h.video){case"avc":var p=[],g=null,m=[],v=l.Ic();if(!v.length)throw new It(2,3,3023,n?n.M()[0]:null);for(var y=0;y<v.length;y++){var b=v[y],S=b.nalus;m.push.apply(m,d(S));var T=CA(S);if(T){null==g&&(g=b.dts);var _=void 0;_=y+1<v.length?(v[y+1].dts||0)-(b.dts||0):1<v.length?(b.dts||0)-(v[y-1].dts||0):9e4*(n.endTime-n.startTime),p.push({data:T.data,size:T.data.byteLength,duration:_,eb:Math.round((b.pts||0)-(b.dts||0)),flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:T.Cd?2:1,ib:T.Cd?0:1}})}}var w=IA(m);if(!w||null==g)throw new It(2,3,3018,n?n.M()[0]:null);t.height=w.height,t.width=w.width,f={id:t.id,type:"video",codecs:"avc1",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:9e4,duration:i,ab:[],ma:new Uint8Array([]),wa:w.wa,Ba:w.Ba,Ca:w.Ca,data:{sb:this.g,baseMediaDecodeTime:g,Za:p},stream:t};break;case"hvc":var E=[],x=null,A=[],k=l.Ic();if(!k.length)throw new It(2,3,3023,n?n.M()[0]:null);for(var I=0;I<k.length;I++){var C=k[I],R=C.nalus;A.push.apply(A,d(R));for(var M=!1,D=[],L=!1,P=c(R),O=P.next();!O.done;O=P.next()){var N=O.value;switch(N.type){case 1:case 0:var U=L=!0;break;case 19:case 20:case 21:M=U=L=!0;break;case 32:U=!0;break;case 33:U=!0;break;case 34:U=!0;break;case 35:L=U=!0;break;case 39:case 40:U=!0;break;default:U=!1}if(L&&U){var F=N.fullData.byteLength,B=new Uint8Array(4);B[0]=F>>24&255,B[1]=F>>16&255,B[2]=F>>8&255,B[3]=255&F,D.push(B),D.push(N.fullData)}}var V=D.length?{data:An.apply(Sn,d(D)),Cd:M}:null;if(V){null==x&&null!=C.dts&&(x=C.dts);var j=void 0;j=I+1<k.length?(k[I+1].dts||0)-(C.dts||0):1<k.length?(C.dts||0)-(k[I-1].dts||0):9e4*(n.endTime-n.startTime),E.push({data:V.data,size:V.data.byteLength,duration:j,eb:Math.round((C.pts||0)-(C.dts||0)),flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:V.Cd?2:1,ib:V.Cd?0:1}})}}var G=MA(A);if(!G||null==x)throw new It(2,3,3018,n?n.M()[0]:null);t.height=G.height,t.width=G.width,f={id:t.id,type:"video",codecs:"hvc1",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:9e4,duration:i,ab:[],ma:new Uint8Array([]),wa:G.wa,Ba:G.Ba,Ca:G.Ca,data:{sb:this.g,baseMediaDecodeTime:x,Za:E},stream:t}}f&&(u.push(f),f=null)}if("audio"==r){switch(h.audio){case"aac":for(var H,z=[],K=null,$=c(l.Wb()),W=$.next();!W.done;W=$.next()){var q=W.value,Y=q.data;if(Y){var X=0;if(H=bA(Y,X),!H)throw new It(2,3,3018,n?n.M()[0]:null);for(t.audioSamplingRate=H.sampleRate,t.channelsCount=H.channelCount,null==K&&null!==q.pts&&(K=q.pts);X<Y.length;){var Q=yA(Y,X);if(Q){var Z=Q.le+Q.ba;X+Z<=Y.length&&z.push({data:Y.subarray(X+Q.le,X+Z),size:Q.ba,duration:1024,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),X+=Z}else X++}}}if(!H||null==K){if(!l.Ic().length)throw new It(2,3,3018,n?n.M()[0]:null);K=9e4*n.startTime;var J=Mn("audio",t.codecs.split(","));if(!J||!t.channelsCount||!t.audioSamplingRate)throw new It(2,3,3018,n?n.M()[0]:null);H={sampleRate:t.audioSamplingRate,channelCount:t.channelsCount,Na:J};var ee=TA(J,t.channelsCount);if(!ee)throw new It(2,3,3018,n?n.M()[0]:null);for(var te=K+9e4*(n.endTime-n.startTime),ne=K;ne<te;)z.push({data:ee,size:ee.byteLength,duration:1024,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),ne+=1024/H.sampleRate*9e4}var ie=H.sampleRate,re=K/9e4*ie;f={id:t.id,type:"audio",codecs:H.Na,encrypted:t.encrypted&&0<t.drmInfos.length,timescale:ie,duration:i,ab:[],ma:new Uint8Array([]),wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.g,baseMediaDecodeTime:re,Za:z},stream:t};break;case"ac3":for(var ae=[],se=0,oe=new Uint8Array([]),le=null,ue=c(l.Wb()),ce=ue.next();!ce.done;ce=ue.next()){var de=ce.value,he=de.data;null==le&&null!==de.pts&&(le=de.pts);for(var fe=0;fe<he.length;){var pe=wA(he,fe);pe?(t.audioSamplingRate=pe.sampleRate,t.channelsCount=pe.channelCount,se=pe.sampleRate,oe=pe.ma,ae.push({data:he.subarray(fe,fe+pe.ba),size:pe.ba,duration:1536,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),fe+=pe.ba):fe++}}if(0==se||0==oe.byteLength||null==le)throw new It(2,3,3018,n?n.M()[0]:null);var ge=le/9e4*se;f={id:t.id,type:"audio",codecs:"ac-3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:se,duration:i,ab:[],ma:oe,wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.g,baseMediaDecodeTime:ge,Za:ae},stream:t};break;case"ec3":for(var me=[],ve=0,ye=new Uint8Array([]),be=null,Se=c(l.Wb()),Te=Se.next();!Te.done;Te=Se.next()){var _e=Te.value,we=_e.data;null==be&&null!==_e.pts&&(be=_e.pts);for(var xe=0;xe<we.length;){var Ae=AA(we,xe);Ae?(t.audioSamplingRate=Ae.sampleRate,t.channelsCount=Ae.channelCount,ve=Ae.sampleRate,ye=Ae.ma,me.push({data:we.subarray(xe,xe+Ae.ba),size:Ae.ba,duration:1536,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),xe+=Ae.ba):xe++}}if(0==ve||0==ye.byteLength||null==be)throw new It(2,3,3018,n?n.M()[0]:null);var ke=be/9e4*ve;f={id:t.id,type:"audio",codecs:"ec-3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:ve,duration:i,ab:[],ma:ye,wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.g,baseMediaDecodeTime:ke,Za:me},stream:t};break;case"mp3":for(var Ie,Ce=[],Re=null,Me=c(l.Wb()),De=Me.next();!De.done;De=Me.next()){var Le=De.value,Pe=Le.data;if(Pe){null==Re&&null!==Le.pts&&(Re=Le.pts);for(var Oe=0;Oe<Pe.length;){var Ne=NA(Pe,Oe);Ne?(Ie||(Ie=Ne),Oe+Ne.ba<=Pe.length&&Ce.push({data:Pe.subarray(Oe,Oe+Ne.ba),size:Ne.ba,duration:1152,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),Oe+=Ne.ba):Oe++}}}if(!Ie||null==Re)throw new It(2,3,3018,n?n.M()[0]:null);var Ue=Ie.sampleRate,Fe=Re/9e4*Ue;f={id:t.id,type:"audio",codecs:"mp3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:Ue,duration:i,ab:[],ma:new Uint8Array([]),wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.g,baseMediaDecodeTime:Fe,Za:Ce},stream:t};break;case"opus":var Be=[],Ve=null,je=l.F;if(!je)throw new It(2,3,3018,n?n.M()[0]:null);var Ge=[];switch(je.Jh){case 1:case 2:Ge=[0];break;case 0:Ge=[255,1,1,0,1];break;case 128:Ge=[255,2,0,0,1];break;case 3:Ge=[1,2,1,0,2,1];break;case 4:Ge=[1,2,2,0,1,2,3];break;case 5:Ge=[1,3,2,0,4,1,2,3];break;case 6:Ge=[1,4,2,0,4,1,2,3,5];break;case 7:Ge=[1,4,2,0,4,1,2,3,5,6];break;case 8:Ge=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:Ge=[1,1,2,0,1];break;case 131:Ge=[1,1,3,0,1,2];break;case 132:Ge=[1,1,4,0,1,2,3];break;case 133:Ge=[1,1,5,0,1,2,3,4];break;case 134:Ge=[1,1,6,0,1,2,3,4,5];break;case 135:Ge=[1,1,7,0,1,2,3,4,5,6];break;case 136:Ge=[1,1,8,0,1,2,3,4,5,6,7]}for(var He=new Uint8Array([0,je.channelCount,0,0,je.sampleRate>>>24&255,je.sampleRate>>>17&255,je.sampleRate>>>8&255,je.sampleRate>>>0&255,0,0].concat(d(Ge))),ze=je.sampleRate,Ke=c(l.Wb()),$e=Ke.next();!$e.done;$e=Ke.next()){var We=$e.value,qe=We.data;null==Ve&&null!==We.pts&&(Ve=We.pts);for(var Ye=0;Ye<qe.length;){for(var Xe=0!==(16&qe[Ye+1]),Qe=0!==(8&qe[Ye+1]),Ze=Ye+2,Je=0;255===qe[Ze];)Je+=255,Ze+=1;Je+=qe[Ze],Ze+=1,Ze+=Xe?2:0,Ze+=Qe?2:0;var et=qe.slice(Ze,Ze+Je);Be.push({data:et,size:et.byteLength,duration:960,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),Ye=Ze+Je}}if(0==He.byteLength||null==Ve)throw new It(2,3,3018,n?n.M()[0]:null);t.audioSamplingRate=je.sampleRate,t.channelsCount=je.channelCount;var tt=Ve/9e4*ze;f={id:t.id,type:"audio",codecs:"opus",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:ze,duration:i,ab:[],ma:He,wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.g,baseMediaDecodeTime:tt,Za:Be},stream:t}}f&&(u.push(f),f=null)}}catch(e){return e&&3023==e.code?Promise.resolve(new Uint8Array([])):Promise.reject(e)}if(!u.length)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));var nt=new GS(u),it=t.id+"_"+n.i;if(this.i.has(it))var rt=this.i.get(it);else rt=HS(nt),this.i.set(it,rt);var at=qS(nt);this.g++;var st=An(rt,at);return Promise.resolve(st)},z("shaka.transmuxer.TsTransmuxer",YA),YA.prototype.transmux=YA.prototype.transmux,YA.prototype.getOriginalMimeType=YA.prototype.getOriginalMimeType,YA.prototype.convertCodecs=YA.prototype.convertCodecs,YA.prototype.isSupported=YA.prototype.isSupported,YA.prototype.destroy=YA.prototype.destroy;var XA,QA,ZA=["aac","ac-3","ec-3","mp3","opus"],JA=["avc","hevc"];
/*
 @license
 EME Encryption Scheme Polyfill
 Copyright 2019 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
function ek(){}function tk(){XA||navigator.emeEncryptionSchemePolyfilled?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(XA=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=nk,navigator.emeEncryptionSchemePolyfilled=!0):console.debug("EmeEncryptionSchemePolyfill: EME not found")}function nk(e,t){var n,i=this;return N(function(r){return 1==r.g?(console.assert(i==navigator,'bad "this" for requestMediaKeySystemAccess'),_(r,XA.call(i,e,t),2)):(n=r.h,hk(n)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=XA,r.return(n)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=ik,r.return(ik.call(i,e,t))))})}function ik(e,t){var n,i,r,a,s,o,l,u,d,h,f,p,g=this;return N(function(m){if(1==m.g){for(console.assert(g==navigator,'bad "this" for requestMediaKeySystemAccess'),n=dk(e),i=[],r=c(t),a=r.next();!a.done;a=r.next())s=a.value,o=rk(s.videoCapabilities,n),l=rk(s.audioCapabilities,n),s.videoCapabilities&&s.videoCapabilities.length&&!o.length||s.audioCapabilities&&s.audioCapabilities.length&&!l.length||(u=Object.assign({},s),u.videoCapabilities=o,u.audioCapabilities=l,i.push(u));if(!i.length)throw d=Error("Unsupported keySystem or supportedConfigurations."),d.name="NotSupportedError",d.code=DOMException.NOT_SUPPORTED_ERR,d;return _(m,XA.call(g,e,i),2)}return h=m.h,p=f=null,i[0]&&(i[0].videoCapabilities&&(f=i[0].videoCapabilities[0].encryptionScheme),i[0].audioCapabilities&&(p=i[0].audioCapabilities[0].encryptionScheme)),m.return(new ck(h,f,p))})}function rk(e,t){return e?e.filter(function(e){return fk(e.encryptionScheme,t)}):e}function ak(){}function sk(){QA||navigator.mediaCapabilitiesEncryptionSchemePolyfilled?console.debug("McEncryptionSchemePolyfill: Already installed."):navigator.mediaCapabilities?(QA=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=ok,navigator.mediaCapabilitiesEncryptionSchemePolyfilled=!0):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")}function ok(e){var t,n,i,r=this;return N(function(a){switch(a.g){case 1:return console.assert(r==navigator.mediaCapabilities,'bad "this" for decodingInfo'),_(a,QA.call(r,e),2);case 2:if(t=a.h,!e.keySystemConfiguration)return a.return(t);if((n=t.keySystemAccess)&&hk(n))return console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=QA,a.return(t);if(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=lk,n){a.u(3);break}return i=t,_(a,uk(e),4);case 4:return i.keySystemAccess=a.h,a.return(t);case 3:return a.return(lk.call(r,e))}})}function lk(e){var t,n,i,r,a,s,o,l,u=this;return N(function(c){switch(c.g){case 1:return console.assert(u==navigator.mediaCapabilities,'bad "this" for decodingInfo'),n=t=null,!e.keySystemConfiguration||(i=e.keySystemConfiguration,r=i.keySystem,n=i.audio&&i.audio.encryptionScheme,t=i.video&&i.video.encryptionScheme,a=dk(r),s={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:e},fk(n,a)&&fk(t,a))?_(c,QA.call(u,e),2):c.return(s);case 2:if(o=c.h,o.keySystemAccess){o.keySystemAccess=new ck(o.keySystemAccess,t,n),c.u(3);break}if(!e.keySystemConfiguration){c.u(3);break}return l=o,_(c,uk(e),5);case 5:l.keySystemAccess=c.h;case 3:return c.return(o)}})}function uk(e){var t,n;return N(function(i){if(1==i.g){var r=e.keySystemConfiguration,a=[],s=[];return r.audio&&a.push({robustness:r.audio.robustness||"",contentType:e.audio.contentType,encryptionScheme:r.audio.encryptionScheme}),r.video&&s.push({robustness:r.video.robustness||"",contentType:e.video.contentType,encryptionScheme:r.video.encryptionScheme}),r={initDataTypes:r.initDataType?[r.initDataType]:[],distinctiveIdentifier:r.distinctiveIdentifier,persistentState:r.persistentState,sessionTypes:r.sessionTypes},a.length&&(r.audioCapabilities=a),s.length&&(r.videoCapabilities=s),t=r,_(i,navigator.requestMediaKeySystemAccess(e.keySystemConfiguration.keySystem,[t]),2)}return n=i.h,i.return(n)})}function ck(e,t,n){this.g=e,this.i=t||null,this.h=n||null,this.keySystem=e.keySystem}function dk(e){return e.startsWith("com.widevine")||e.startsWith("com.microsoft")||e.startsWith("com.chromecast")||e.startsWith("com.adobe")||e.startsWith("org.w3")?"cenc":e.startsWith("com.apple")?"cbcs":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",e,"Please contribute!"),null)}function hk(e){e=e.getConfiguration();var t=e.audioCapabilities&&e.audioCapabilities[0];return!(!(e=e.videoCapabilities&&e.videoCapabilities[0]||t)||void 0===e.encryptionScheme)}function fk(e,t){return!e||e==t||!("cbcs"!=e&&"cbcs-1-9"!=e||!vk&&!mk)}function pk(){}function gk(){tk(),sk()}rt("video/mp2t",function(){return new YA("video/mp2t")},ut),z("EmeEncryptionSchemePolyfill",ek),ek.install=tk,z("McEncryptionSchemePolyfill",ak),ak.install=sk,ck.prototype.getConfiguration=function(){var e=this.g.getConfiguration();if(e.videoCapabilities)for(var t=c(e.videoCapabilities),n=t.next();!n.done;n=t.next())n.value.encryptionScheme=this.i;if(e.audioCapabilities)for(t=c(e.audioCapabilities),n=t.next();!n.done;n=t.next())n.value.encryptionScheme=this.h;return e},ck.prototype.createMediaKeys=function(){return this.g.createMediaKeys()},z("EncryptionSchemePolyfills",pk),pk.install=gk;var mk=navigator.userAgent.includes("CrKey"),vk=100<=parseInt(navigator.userAgent.split("Firefox/").pop(),10);"undefined"!==typeof n&&n.exports&&(n.exports=pk)}.call(i,n,n,void 0),i.shaka)t[r]=i.shaka[r]})()}).call(this,n("c8ba"))},4573:function(e,t,n){var i=n("cbe5"),r=i.extend({type:"ring",shape:{cx:0,cy:0,r:0,r0:0},buildPath:function(e,t){var n=t.cx,i=t.cy,r=2*Math.PI;e.moveTo(n+t.r,i),e.arc(n,i,t.r,0,r,!1),e.moveTo(n+t.r0,i),e.arc(n,i,t.r0,0,r,!0)}});e.exports=r},4588:function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},"45c1":function(e,t,n){"use strict";(function(e){var i=n("d708"),r=n("01e1");let a;a=r["a"]?self:i["a"]?e:window,t["a"]=a}).call(this,n("c8ba"))},4630:function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},4650:function(e,t,n){var i=n("3eba"),r=n("6d8b");function a(e,t,n){var i,a={},s="toggleSelected"===e;return n.eachComponent("legend",function(n){s&&null!=i?n[i?"select":"unSelect"](t.name):(n[e](t.name),i=n.isSelected(t.name));var o=n.getData();r.each(o,function(e){var t=e.get("name");if("\n"!==t&&""!==t){var i=n.isSelected(t);a.hasOwnProperty(t)?a[t]=a[t]&&i:a[t]=i}})}),{name:t.name,selected:a}}i.registerAction("legendToggleSelect","legendselectchanged",r.curry(a,"toggleSelected")),i.registerAction("legendSelect","legendselected",r.curry(a,"select")),i.registerAction("legendUnSelect","legendunselected",r.curry(a,"unSelect"))},"48a9":function(e,t,n){var i=n("6d8b"),r=n("42e5"),a=function(e,t,n,i,a,s){this.x=null==e?0:e,this.y=null==t?0:t,this.x2=null==n?1:n,this.y2=null==i?0:i,this.type="linear",this.global=s||!1,r.call(this,a)};a.prototype={constructor:a},i.inherits(a,r);var s=a;e.exports=s},"48ac":function(e,t,n){var i=n("3eba"),r=i.extendComponentModel({type:"axisPointer",coordSysAxesInfo:null,defaultOption:{show:"auto",triggerOn:null,zlevel:0,z:50,type:"line",snap:!1,triggerTooltip:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:"#aaa",width:1,type:"solid"},shadowStyle:{color:"rgba(150,150,150,0.3)"},label:{show:!0,formatter:null,precision:"auto",margin:3,color:"#fff",padding:[5,7,5,7],backgroundColor:"auto",borderColor:null,borderWidth:0,shadowBlur:3,shadowColor:"#aaa"},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:"#333",shadowBlur:3,shadowColor:"#aaa",shadowOffsetX:0,shadowOffsetY:2,throttle:40}}}),a=r;e.exports=a},"48c7":function(e,t,n){var i=n("6d8b"),r=n("6cb7"),a=n("9e47"),s=n("2023"),o=r.extend({type:"cartesian2dAxis",axis:null,init:function(){o.superApply(this,"init",arguments),this.resetRange()},mergeOption:function(){o.superApply(this,"mergeOption",arguments),this.resetRange()},restoreData:function(){o.superApply(this,"restoreData",arguments),this.resetRange()},getCoordSysModel:function(){return this.ecModel.queryComponents({mainType:"grid",index:this.option.gridIndex,id:this.option.gridId})[0]}});function l(e,t){return t.type||(t.data?"category":"value")}i.merge(o.prototype,s);var u={offset:0};a("x",o,l,u),a("y",o,l,u);var c=o;e.exports=c},4917:function(e,t,n){n("214f")("match",1,function(e,t,n){return[function(n){"use strict";var i=e(this),r=void 0==n?void 0:n[t];return void 0!==r?r.call(n,i):new RegExp(n)[t](String(i))},n]})},4942:function(e,t,n){var i=n("2cf4"),r=i.debugMode,a=function(){};1===r?a=function(){for(var e in arguments)throw new Error(arguments[e])}:r>1&&(a=function(){for(var e in arguments)console.log(arguments[e])});var s=a;e.exports=s},"4a3f":function(e,t,n){var i=n("401b"),r=i.create,a=i.distSquare,s=Math.pow,o=Math.sqrt,l=1e-8,u=1e-4,c=o(3),d=1/3,h=r(),f=r(),p=r();function g(e){return e>-l&&e<l}function m(e){return e>l||e<-l}function v(e,t,n,i,r){var a=1-r;return a*a*(a*e+3*r*t)+r*r*(r*i+3*a*n)}function y(e,t,n,i,r){var a=1-r;return 3*(((t-e)*a+2*(n-t)*r)*a+(i-n)*r*r)}function b(e,t,n,i,r,a){var l=i+3*(t-n)-e,u=3*(n-2*t+e),h=3*(t-e),f=e-r,p=u*u-3*l*h,m=u*h-9*l*f,v=h*h-3*u*f,y=0;if(g(p)&&g(m))if(g(u))a[0]=0;else{var b=-h/u;b>=0&&b<=1&&(a[y++]=b)}else{var S=m*m-4*p*v;if(g(S)){var T=m/p,_=(b=-u/l+T,-T/2);b>=0&&b<=1&&(a[y++]=b),_>=0&&_<=1&&(a[y++]=_)}else if(S>0){var w=o(S),E=p*u+1.5*l*(-m+w),x=p*u+1.5*l*(-m-w);E=E<0?-s(-E,d):s(E,d),x=x<0?-s(-x,d):s(x,d);b=(-u-(E+x))/(3*l);b>=0&&b<=1&&(a[y++]=b)}else{var A=(2*p*u-3*l*m)/(2*o(p*p*p)),k=Math.acos(A)/3,I=o(p),C=Math.cos(k),R=(b=(-u-2*I*C)/(3*l),_=(-u+I*(C+c*Math.sin(k)))/(3*l),(-u+I*(C-c*Math.sin(k)))/(3*l));b>=0&&b<=1&&(a[y++]=b),_>=0&&_<=1&&(a[y++]=_),R>=0&&R<=1&&(a[y++]=R)}}return y}function S(e,t,n,i,r){var a=6*n-12*t+6*e,s=9*t+3*i-3*e-9*n,l=3*t-3*e,u=0;if(g(s)){if(m(a)){var c=-l/a;c>=0&&c<=1&&(r[u++]=c)}}else{var d=a*a-4*s*l;if(g(d))r[0]=-a/(2*s);else if(d>0){var h=o(d),f=(c=(-a+h)/(2*s),(-a-h)/(2*s));c>=0&&c<=1&&(r[u++]=c),f>=0&&f<=1&&(r[u++]=f)}}return u}function T(e,t,n,i,r,a){var s=(t-e)*r+e,o=(n-t)*r+t,l=(i-n)*r+n,u=(o-s)*r+s,c=(l-o)*r+o,d=(c-u)*r+u;a[0]=e,a[1]=s,a[2]=u,a[3]=d,a[4]=d,a[5]=c,a[6]=l,a[7]=i}function _(e,t,n,i,r,s,l,c,d,g,m){var y,b,S,T,_,w=.005,E=1/0;h[0]=d,h[1]=g;for(var x=0;x<1;x+=.05)f[0]=v(e,n,r,l,x),f[1]=v(t,i,s,c,x),T=a(h,f),T<E&&(y=x,E=T);E=1/0;for(var A=0;A<32;A++){if(w<u)break;b=y-w,S=y+w,f[0]=v(e,n,r,l,b),f[1]=v(t,i,s,c,b),T=a(f,h),b>=0&&T<E?(y=b,E=T):(p[0]=v(e,n,r,l,S),p[1]=v(t,i,s,c,S),_=a(p,h),S<=1&&_<E?(y=S,E=_):w*=.5)}return m&&(m[0]=v(e,n,r,l,y),m[1]=v(t,i,s,c,y)),o(E)}function w(e,t,n,i){var r=1-i;return r*(r*e+2*i*t)+i*i*n}function E(e,t,n,i){return 2*((1-i)*(t-e)+i*(n-t))}function x(e,t,n,i,r){var a=e-2*t+n,s=2*(t-e),l=e-i,u=0;if(g(a)){if(m(s)){var c=-l/s;c>=0&&c<=1&&(r[u++]=c)}}else{var d=s*s-4*a*l;if(g(d)){c=-s/(2*a);c>=0&&c<=1&&(r[u++]=c)}else if(d>0){var h=o(d),f=(c=(-s+h)/(2*a),(-s-h)/(2*a));c>=0&&c<=1&&(r[u++]=c),f>=0&&f<=1&&(r[u++]=f)}}return u}function A(e,t,n){var i=e+n-2*t;return 0===i?.5:(e-t)/i}function k(e,t,n,i,r){var a=(t-e)*i+e,s=(n-t)*i+t,o=(s-a)*i+a;r[0]=e,r[1]=a,r[2]=o,r[3]=o,r[4]=s,r[5]=n}function I(e,t,n,i,r,s,l,c,d){var g,m=.005,v=1/0;h[0]=l,h[1]=c;for(var y=0;y<1;y+=.05){f[0]=w(e,n,r,y),f[1]=w(t,i,s,y);var b=a(h,f);b<v&&(g=y,v=b)}v=1/0;for(var S=0;S<32;S++){if(m<u)break;var T=g-m,_=g+m;f[0]=w(e,n,r,T),f[1]=w(t,i,s,T);b=a(f,h);if(T>=0&&b<v)g=T,v=b;else{p[0]=w(e,n,r,_),p[1]=w(t,i,s,_);var E=a(p,h);_<=1&&E<v?(g=_,v=E):m*=.5}}return d&&(d[0]=w(e,n,r,g),d[1]=w(t,i,s,g)),o(v)}t.cubicAt=v,t.cubicDerivativeAt=y,t.cubicRootAt=b,t.cubicExtrema=S,t.cubicSubdivide=T,t.cubicProjectPoint=_,t.quadraticAt=w,t.quadraticDerivativeAt=E,t.quadraticRootAt=x,t.quadraticExtremum=A,t.quadraticSubdivide=k,t.quadraticProjectPoint=I},"4a59":function(e,t,n){var i=n("9b43"),r=n("1fa8"),a=n("33a4"),s=n("cb7c"),o=n("9def"),l=n("27ee"),u={},c={};t=e.exports=function(e,t,n,d,h){var f,p,g,m,v=h?function(){return e}:l(e),y=i(n,d,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(a(v)){for(f=o(e.length);f>b;b++)if(m=t?y(s(p=e[b])[0],p[1]):y(e[b]),m===u||m===c)return m}else for(g=v.call(e);!(p=g.next()).done;)if(m=r(g,y,p.value,t),m===u||m===c)return m};t.BREAK=u,t.RETURN=c},"4a9d":function(e,t,n){var i=n("2306"),r=n("dcb3"),a=n("ff2e"),s=n("0156"),o=n("6679"),l=r.extend({makeElOption:function(e,t,n,i,r){var o=n.axis,l=o.grid,d=i.get("type"),h=u(l,o).getOtherAxis(o).getGlobalExtent(),f=o.toGlobalCoord(o.dataToCoord(t,!0));if(d&&"none"!==d){var p=a.buildElStyle(i),g=c[d](o,f,h,p);g.style=p,e.graphicKey=g.type,e.pointer=g}var m=s.layout(l.model,n);a.buildCartesianSingleLabelElOption(t,e,m,n,i,r)},getHandleTransform:function(e,t,n){var i=s.layout(t.axis.grid.model,t,{labelInside:!1});return i.labelMargin=n.get("handle.margin"),{position:a.getTransformedPosition(t.axis,e,i),rotation:i.rotation+(i.labelDirection<0?Math.PI:0)}},updateHandleTransform:function(e,t,n,i){var r=n.axis,a=r.grid,s=r.getGlobalExtent(!0),o=u(a,r).getOtherAxis(r).getGlobalExtent(),l="x"===r.dim?0:1,c=e.position;c[l]+=t[l],c[l]=Math.min(s[1],c[l]),c[l]=Math.max(s[0],c[l]);var d=(o[1]+o[0])/2,h=[d,d];h[l]=c[l];var f=[{verticalAlign:"middle"},{align:"center"}];return{position:c,rotation:e.rotation,cursorPoint:h,tooltipOption:f[l]}}});function u(e,t){var n={};return n[t.dim+"AxisIndex"]=t.index,e.getCartesian(n)}var c={line:function(e,t,n,r){var s=a.makeLineShape([t,n[0]],[t,n[1]],d(e));return i.subPixelOptimizeLine({shape:s,style:r}),{type:"Line",shape:s}},shadow:function(e,t,n,i){var r=Math.max(1,e.getBandWidth()),s=n[1]-n[0];return{type:"Rect",shape:a.makeRectShape([t-r/2,n[0]],[r,s],d(e))}}};function d(e){return"x"===e.dim?0:1}o.registerAxisPointerClass("CartesianAxisPointer",l);var h=l;e.exports=h},"4aa2":function(e,t,n){var i=n("cbe5"),r=n("897a"),a=i.extend({type:"sector",shape:{cx:0,cy:0,r0:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},brush:r(i.prototype.brush),buildPath:function(e,t){var n=t.cx,i=t.cy,r=Math.max(t.r0||0,0),a=Math.max(t.r,0),s=t.startAngle,o=t.endAngle,l=t.clockwise,u=Math.cos(s),c=Math.sin(s);e.moveTo(u*r+n,c*r+i),e.lineTo(u*a+n,c*a+i),e.arc(n,i,a,s,o,!l),e.lineTo(Math.cos(o)*r+n,Math.sin(o)*r+i),0!==r&&e.arc(n,i,r,o,s,l),e.closePath()}});e.exports=a},"4b08":function(e,t,n){var i=n("7dcf"),r=i.extend({type:"dataZoom.select"});e.exports=r},"4bf8":function(e,t,n){var i=n("be13");e.exports=function(e){return Object(i(e))}},"4e08":function(e,t,n){(function(e){var n;"undefined"!==typeof window?n=window.__DEV__:"undefined"!==typeof e&&(n=e.__DEV__),"undefined"===typeof n&&(n=!0);var i=n;t.__DEV__=i}).call(this,n("c8ba"))},"4e9f":function(e,t,n){var i=n("22d1"),r=n("29a8"),a=n("2145"),s=r.toolbox.saveAsImage;function o(e){this.model=e}o.defaultOption={show:!0,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:s.title,type:"png",name:"",excludeComponents:["toolbox"],pixelRatio:1,lang:s.lang.slice()},o.prototype.unusable=!i.canvasSupported;var l=o.prototype;l.onclick=function(e,t){var n=this.model,r=n.get("name")||e.get("title.0.text")||"echarts",a=document.createElement("a"),s=n.get("type",!0)||"png";a.download=r+"."+s,a.target="_blank";var o=t.getConnectedDataURL({type:s,backgroundColor:n.get("backgroundColor",!0)||e.get("backgroundColor")||"#fff",excludeComponents:n.get("excludeComponents"),pixelRatio:n.get("pixelRatio")});if(a.href=o,"function"!==typeof MouseEvent||i.browser.ie||i.browser.edge)if(window.navigator.msSaveOrOpenBlob){var l=atob(o.split(",")[1]),u=l.length,c=new Uint8Array(u);while(u--)c[u]=l.charCodeAt(u);var d=new Blob([c]);window.navigator.msSaveOrOpenBlob(d,r+"."+s)}else{var h=n.get("lang"),f='<body style="margin:0;"><img src="'+o+'" style="max-width:100%;" title="'+(h&&h[0]||"")+'" /></body>',p=window.open();p.document.write(f)}else{var g=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});a.dispatchEvent(g)}},a.register("saveAsImage",o);var u=o;e.exports=u},"4f85":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=n("22d1"),s=n("eda2"),o=s.formatTime,l=s.encodeHTML,u=s.addCommas,c=s.getTooltipMarker,d=n("e0d3"),h=n("6cb7"),f=n("e47b"),p=n("38a2"),g=n("f934"),m=g.getLayoutParams,v=g.mergeLayoutParam,y=n("f47d"),b=y.createTask,S=n("0f99"),T=S.prepareSource,_=S.getSource,w=n("2b17"),E=w.retrieveRawValue,x=d.makeInner(),A=h.extend({type:"series.__base__",seriesIndex:0,coordinateSystem:null,defaultOption:null,legendDataProvider:null,visualColorAccessPath:"itemStyle.color",layoutMode:null,init:function(e,t,n,i){this.seriesIndex=this.componentIndex,this.dataTask=b({count:C,reset:R}),this.dataTask.context={model:this},this.mergeDefaultAndTheme(e,n),T(this);var r=this.getInitialData(e,n);D(r,this),this.dataTask.context.data=r,x(this).dataBeforeProcessed=r,k(this)},mergeDefaultAndTheme:function(e,t){var n=this.layoutMode,i=n?m(e):{},a=this.subType;h.hasClass(a)&&(a+="Series"),r.merge(e,t.getTheme().get(this.subType)),r.merge(e,this.getDefaultOption()),d.defaultEmphasis(e,"label",["show"]),this.fillDataTextStyle(e.data),n&&v(e,i,n)},mergeOption:function(e,t){e=r.merge(this.option,e,!0),this.fillDataTextStyle(e.data);var n=this.layoutMode;n&&v(this.option,e,n),T(this);var i=this.getInitialData(e,t);D(i,this),this.dataTask.dirty(),this.dataTask.context.data=i,x(this).dataBeforeProcessed=i,k(this)},fillDataTextStyle:function(e){if(e&&!r.isTypedArray(e))for(var t=["show"],n=0;n<e.length;n++)e[n]&&e[n].label&&d.defaultEmphasis(e[n],"label",t)},getInitialData:function(){},appendData:function(e){var t=this.getRawData();t.appendData(e.data)},getData:function(e){var t=P(this);if(t){var n=t.context.data;return null==e?n:n.getLinkedData(e)}return x(this).data},setData:function(e){var t=P(this);if(t){var n=t.context;n.data!==e&&t.modifyOutputEnd&&t.setOutputEnd(e.count()),n.outputData=e,t!==this.dataTask&&(n.data=e)}x(this).data=e},getSource:function(){return _(this)},getRawData:function(){return x(this).dataBeforeProcessed},getBaseAxis:function(){var e=this.coordinateSystem;return e&&e.getBaseAxis&&e.getBaseAxis()},formatTooltip:function(e,t,n){function i(n){var i=r.reduce(n,function(e,t,n){var i=s.getDimensionInfo(n);return e|(i&&!1!==i.tooltip&&null!=i.displayName)},0),a=[];function d(e,n){var r=s.getDimensionInfo(n);if(r&&!1!==r.otherDims.tooltip){var d=r.type,h=c({color:m,type:"subItem"}),f=(i?h+l(r.displayName||"-")+": ":"")+l("ordinal"===d?e+"":"time"===d?t?"":o("yyyy/MM/dd hh:mm:ss",e):u(e));f&&a.push(f)}}return h.length?r.each(h,function(t){d(E(s,e,t),t)}):r.each(n,d),(i?"<br/>":"")+a.join(i?"<br/>":", ")}function a(e){return l(u(e))}var s=this.getData(),h=s.mapDimension("defaultedTooltip",!0),f=h.length,p=this.getRawValue(e),g=r.isArray(p),m=s.getItemVisual(e,"color");r.isObject(m)&&m.colorStops&&(m=(m.colorStops[0]||{}).color),m=m||"transparent";var v=f>1||g&&!f?i(p):a(f?E(s,e,h[0]):g?p[0]:p),y=c(m),b=s.getName(e),S=this.name;return d.isNameSpecified(this)||(S=""),S=S?l(S)+(t?": ":"<br/>"):"",t?y+S+v:S+y+(b?l(b)+": "+v:v)},isAnimationEnabled:function(){if(a.node)return!1;var e=this.getShallow("animation");return e&&this.getData().count()>this.getShallow("animationThreshold")&&(e=!1),e},restoreData:function(){this.dataTask.dirty()},getColorFromPalette:function(e,t,n){var i=this.ecModel,r=f.getColorFromPalette.call(this,e,t,n);return r||(r=i.getColorFromPalette(e,t,n)),r},coordDimToDataDim:function(e){return this.getRawData().mapDimension(e,!0)},getProgressive:function(){return this.get("progressive")},getProgressiveThreshold:function(){return this.get("progressiveThreshold")},getAxisTooltipData:null,getTooltipPosition:null,pipeTask:null,preventIncremental:null,pipelineContext:null});function k(e){var t=e.name;d.isNameSpecified(e)||(e.name=I(e)||t)}function I(e){var t=e.getRawData(),n=t.mapDimension("seriesName",!0),i=[];return r.each(n,function(e){var n=t.getDimensionInfo(e);n.displayName&&i.push(n.displayName)}),i.join(" ")}function C(e){return e.model.getRawData().count()}function R(e){var t=e.model;return t.setData(t.getRawData().cloneShallow()),M}function M(e,t){e.end>t.outputData.count()&&t.model.getRawData().cloneShallow(t.outputData)}function D(e,t){r.each(e.CHANGABLE_METHODS,function(n){e.wrapMethod(n,r.curry(L,t))})}function L(e){var t=P(e);t&&t.setOutputEnd(this.count())}function P(e){var t=(e.ecModel||{}).scheduler,n=t&&t.getPipeline(e.uid);if(n){var i=n.currentTask;if(i){var r=i.agentStubMap;r&&(i=r.get(e.uid))}return i}}r.mixin(A,p),r.mixin(A,f);var O=A;e.exports=O},"4fac":function(e,t,n){var i=n("620b"),r=n("9c2c");function a(e,t,n){var a=t.points,s=t.smooth;if(a&&a.length>=2){if(s&&"spline"!==s){var o=r(a,s,n,t.smoothConstraint);e.moveTo(a[0][0],a[0][1]);for(var l=a.length,u=0;u<(n?l:l-1);u++){var c=o[2*u],d=o[2*u+1],h=a[(u+1)%l];e.bezierCurveTo(c[0],c[1],d[0],d[1],h[0],h[1])}}else{"spline"===s&&(a=i(a,n)),e.moveTo(a[0][0],a[0][1]);u=1;for(var f=a.length;u<f;u++)e.lineTo(a[u][0],a[u][1])}n&&e.closePath()}}t.buildPath=a},"50e5":function(e,t,n){var i=n("6d8b"),r=n("eda2"),a=["x","y","z","radius","angle","single"],s=["cartesian2d","polar","singleAxis"];function o(e){return i.indexOf(s,e)>=0}function l(e,t){e=e.slice();var n=i.map(e,r.capitalFirst);t=(t||[]).slice();var a=i.map(t,r.capitalFirst);return function(r,s){i.each(e,function(e,i){for(var o={name:e,capital:n[i]},l=0;l<t.length;l++)o[t[l]]=e+a[l];r.call(s,o)})}}var u=l(a,["axisIndex","axis","index","id"]);function c(e,t,n){return function(n){var i,o={nodes:[],records:{}};if(t(function(e){o.records[e.name]={}}),!n)return o;s(n,o);do{i=!1,e(l)}while(i);function l(e){!r(e,o)&&a(e,o)&&(s(e,o),i=!0)}return o};function r(e,t){return i.indexOf(t.nodes,e)>=0}function a(e,r){var a=!1;return t(function(t){i.each(n(e,t)||[],function(e){r.records[t.name][e]&&(a=!0)})}),a}function s(e,r){r.nodes.push(e),t(function(t){i.each(n(e,t)||[],function(e){r.records[t.name][e]=!0})})}}t.isCoordSupported=o,t.createNameEach=l,t.eachAxisDim=u,t.createLinkedNodesFinder=c},5147:function(e,t,n){var i=n("2b4c")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[i]=!1,!"/./"[e](t)}catch(e){}}return!0}},"52a7":function(e,t){t.f={}.propertyIsEnumerable},"551c":function(e,t,n){"use strict";var i,r,a,s,o=n("2d00"),l=n("7726"),u=n("9b43"),c=n("23c6"),d=n("5ca1"),h=n("d3f4"),f=n("d8e8"),p=n("f605"),g=n("4a59"),m=n("ebd6"),v=n("1991").set,y=n("8079")(),b=n("a5b8"),S=n("9c80"),T=n("a25f"),_=n("bcaa"),w="Promise",E=l.TypeError,x=l.process,A=x&&x.versions,k=A&&A.v8||"",I=l[w],C="process"==c(x),R=function(){},M=r=b.f,D=!!function(){try{var e=I.resolve(1),t=(e.constructor={})[n("2b4c")("species")]=function(e){e(R,R)};return(C||"function"==typeof PromiseRejectionEvent)&&e.then(R)instanceof t&&0!==k.indexOf("6.6")&&-1===T.indexOf("Chrome/66")}catch(e){}}(),L=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},P=function(e,t){if(!e._n){e._n=!0;var n=e._c;y(function(){var i=e._v,r=1==e._s,a=0,s=function(t){var n,a,s,o=r?t.ok:t.fail,l=t.resolve,u=t.reject,c=t.domain;try{o?(r||(2==e._h&&U(e),e._h=1),!0===o?n=i:(c&&c.enter(),n=o(i),c&&(c.exit(),s=!0)),n===t.promise?u(E("Promise-chain cycle")):(a=L(n))?a.call(n,l,u):l(n)):u(i)}catch(e){c&&!s&&c.exit(),u(e)}};while(n.length>a)s(n[a++]);e._c=[],e._n=!1,t&&!e._h&&O(e)})}},O=function(e){v.call(l,function(){var t,n,i,r=e._v,a=N(e);if(a&&(t=S(function(){C?x.emit("unhandledRejection",r,e):(n=l.onunhandledrejection)?n({promise:e,reason:r}):(i=l.console)&&i.error&&i.error("Unhandled promise rejection",r)}),e._h=C||N(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},N=function(e){return 1!==e._h&&0===(e._a||e._c).length},U=function(e){v.call(l,function(){var t;C?x.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})})},F=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),P(t,!0))},B=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw E("Promise can't be resolved itself");(t=L(e))?y(function(){var i={_w:n,_d:!1};try{t.call(e,u(B,i,1),u(F,i,1))}catch(e){F.call(i,e)}}):(n._v=e,n._s=1,P(n,!1))}catch(e){F.call({_w:n,_d:!1},e)}}};D||(I=function(e){p(this,I,w,"_h"),f(e),i.call(this);try{e(u(B,this,1),u(F,this,1))}catch(e){F.call(this,e)}},i=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},i.prototype=n("dcbc")(I.prototype,{then:function(e,t){var n=M(m(this,I));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=C?x.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&P(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new i;this.promise=e,this.resolve=u(B,e,1),this.reject=u(F,e,1)},b.f=M=function(e){return e===I||e===s?new a(e):r(e)}),d(d.G+d.W+d.F*!D,{Promise:I}),n("7f20")(I,w),n("7a56")(w),s=n("8378")[w],d(d.S+d.F*!D,w,{reject:function(e){var t=M(this),n=t.reject;return n(e),t.promise}}),d(d.S+d.F*(o||!D),w,{resolve:function(e){return _(o&&this===s?I:this,e)}}),d(d.S+d.F*!(D&&n("5cc5")(function(e){I.all(e)["catch"](R)})),w,{all:function(e){var t=this,n=M(t),i=n.resolve,r=n.reject,a=S(function(){var n=[],a=0,s=1;g(e,!1,function(e){var o=a++,l=!1;n.push(void 0),s++,t.resolve(e).then(function(e){l||(l=!0,n[o]=e,--s||i(n))},r)}),--s||i(n)});return a.e&&r(a.v),n.promise},race:function(e){var t=this,n=M(t),i=n.reject,r=S(function(){g(e,!1,function(e){t.resolve(e).then(n.resolve,i)})});return r.e&&i(r.v),n.promise}})},"551f":function(e,t,n){var i=n("282b"),r=i([["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["textPosition"],["textAlign"]]),a={getItemStyle:function(e,t){var n=r(this,e,t),i=this.getBorderLineDash();return i&&(n.lineDash=i),n},getBorderLineDash:function(){var e=this.get("borderType");return"solid"===e||null==e?null:"dashed"===e?[5,5]:[1,1]}};e.exports=a},5537:function(e,t,n){var i=n("8378"),r=n("7726"),a="__core-js_shared__",s=r[a]||(r[a]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:i.version,mode:n("2d00")?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},5693:function(e,t){function n(e,t){var n,i,r,a,s,o=t.x,l=t.y,u=t.width,c=t.height,d=t.r;u<0&&(o+=u,u=-u),c<0&&(l+=c,c=-c),"number"===typeof d?n=i=r=a=d:d instanceof Array?1===d.length?n=i=r=a=d[0]:2===d.length?(n=r=d[0],i=a=d[1]):3===d.length?(n=d[0],i=a=d[1],r=d[2]):(n=d[0],i=d[1],r=d[2],a=d[3]):n=i=r=a=0,n+i>u&&(s=n+i,n*=u/s,i*=u/s),r+a>u&&(s=r+a,r*=u/s,a*=u/s),i+r>c&&(s=i+r,i*=c/s,r*=c/s),n+a>c&&(s=n+a,n*=c/s,a*=c/s),e.moveTo(o+n,l),e.lineTo(o+u-i,l),0!==i&&e.arc(o+u-i,l+i,i,-Math.PI/2,0),e.lineTo(o+u,l+c-r),0!==r&&e.arc(o+u-r,l+c-r,r,0,Math.PI/2),e.lineTo(o+a,l+c),0!==a&&e.arc(o+a,l+c-a,a,Math.PI/2,Math.PI),e.lineTo(o,l+n),0!==n&&e.arc(o+n,l+n,n,Math.PI,1.5*Math.PI)}t.buildPath=n},"5aa9":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=r.isObject,s=r.each,o=r.map,l=r.indexOf,u=(r.retrieve,n("f934")),c=u.getLayoutRect,d=n("697e"),h=d.createScaleByModel,f=d.ifAxisCrossZero,p=d.niceScaleExtent,g=d.estimateLabelUnionRect,m=n("cbe9"),v=n("ec02"),y=n("2039"),b=n("ee1a"),S=b.getStackedDimension;function T(e,t,n){return e.getCoordSysModel()===t}function _(e,t,n){this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this._initCartesian(e,t,n),this.model=e}n("8ed2");var w=_.prototype;function E(e,t,n){n.getAxesOnZeroOf=function(){return i?[i]:[]};var i,r=e[t],a=n.model,s=a.get("axisLine.onZero"),o=a.get("axisLine.onZeroAxisIndex");if(s)if(null==o){for(var l in r)if(r.hasOwnProperty(l)&&x(r[l])){i=r[l];break}}else x(r[o])&&(i=r[o])}function x(e){return e&&"category"!==e.type&&"time"!==e.type&&f(e)}function A(e,t){var n=e.getExtent(),i=n[0]+n[1];e.toGlobalCoord="x"===e.dim?function(e){return e+t}:function(e){return i-e+t},e.toLocalCoord="x"===e.dim?function(e){return e-t}:function(e){return i-e+t}}w.type="grid",w.axisPointerEnabled=!0,w.getRect=function(){return this._rect},w.update=function(e,t){var n=this._axesMap;this._updateScale(e,this.model),s(n.x,function(e){p(e.scale,e.model)}),s(n.y,function(e){p(e.scale,e.model)}),s(n.x,function(e){E(n,"y",e)}),s(n.y,function(e){E(n,"x",e)}),this.resize(this.model,t)},w.resize=function(e,t,n){var i=c(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()});this._rect=i;var r=this._axesList;function a(){s(r,function(e){var t=e.isHorizontal(),n=t?[0,i.width]:[0,i.height],r=e.inverse?1:0;e.setExtent(n[r],n[1-r]),A(e,t?i.x:i.y)})}a(),!n&&e.get("containLabel")&&(s(r,function(e){if(!e.model.get("axisLabel.inside")){var t=g(e);if(t){var n=e.isHorizontal()?"height":"width",r=e.model.get("axisLabel.margin");i[n]-=t[n]+r,"top"===e.position?i.y+=t.height+r:"left"===e.position&&(i.x+=t.width+r)}}}),a())},w.getAxis=function(e,t){var n=this._axesMap[e];if(null!=n){if(null==t)for(var i in n)if(n.hasOwnProperty(i))return n[i];return n[t]}},w.getAxes=function(){return this._axesList.slice()},w.getCartesian=function(e,t){if(null!=e&&null!=t){var n="x"+e+"y"+t;return this._coordsMap[n]}a(e)&&(t=e.yAxisIndex,e=e.xAxisIndex);for(var i=0,r=this._coordsList;i<r.length;i++)if(r[i].getAxis("x").index===e||r[i].getAxis("y").index===t)return r[i]},w.getCartesians=function(){return this._coordsList.slice()},w.convertToPixel=function(e,t,n){var i=this._findConvertTarget(e,t);return i.cartesian?i.cartesian.dataToPoint(n):i.axis?i.axis.toGlobalCoord(i.axis.dataToCoord(n)):null},w.convertFromPixel=function(e,t,n){var i=this._findConvertTarget(e,t);return i.cartesian?i.cartesian.pointToData(n):i.axis?i.axis.coordToData(i.axis.toLocalCoord(n)):null},w._findConvertTarget=function(e,t){var n,i,r=t.seriesModel,a=t.xAxisModel||r&&r.getReferringComponents("xAxis")[0],s=t.yAxisModel||r&&r.getReferringComponents("yAxis")[0],o=t.gridModel,u=this._coordsList;if(r)n=r.coordinateSystem,l(u,n)<0&&(n=null);else if(a&&s)n=this.getCartesian(a.componentIndex,s.componentIndex);else if(a)i=this.getAxis("x",a.componentIndex);else if(s)i=this.getAxis("y",s.componentIndex);else if(o){var c=o.coordinateSystem;c===this&&(n=this._coordsList[0])}return{cartesian:n,axis:i}},w.containPoint=function(e){var t=this._coordsList[0];if(t)return t.containPoint(e)},w._initCartesian=function(e,t,n){var i={left:!1,right:!1,top:!1,bottom:!1},r={x:{},y:{}},a={x:0,y:0};if(t.eachComponent("xAxis",o("x"),this),t.eachComponent("yAxis",o("y"),this),!a.x||!a.y)return this._axesMap={},void(this._axesList=[]);function o(n){return function(s,o){if(T(s,e,t)){var l=s.get("position");"x"===n?"top"!==l&&"bottom"!==l&&(l="bottom",i[l]&&(l="top"===l?"bottom":"top")):"left"!==l&&"right"!==l&&(l="left",i[l]&&(l="left"===l?"right":"left")),i[l]=!0;var u=new v(n,h(s),[0,0],s.get("type"),l),c="category"===u.type;u.onBand=c&&s.get("boundaryGap"),u.inverse=s.get("inverse"),s.axis=u,u.model=s,u.grid=this,u.index=o,this._axesList.push(u),r[n][o]=u,a[n]++}}}this._axesMap=r,s(r.x,function(t,n){s(r.y,function(i,r){var a="x"+n+"y"+r,s=new m(a);s.grid=this,s.model=e,this._coordsMap[a]=s,this._coordsList.push(s),s.addAxis(t),s.addAxis(i)},this)},this)},w._updateScale=function(e,t){function n(e,t,n){s(e.mapDimension(t.dim,!0),function(n){t.scale.unionExtentFromData(e,S(e,n))})}s(this._axesList,function(e){e.scale.setExtent(1/0,-1/0)}),e.eachSeries(function(i){if(C(i)){var r=I(i,e),a=r[0],s=r[1];if(!T(a,t,e)||!T(s,t,e))return;var o=this.getCartesian(a.componentIndex,s.componentIndex),l=i.getData(),u=o.getAxis("x"),c=o.getAxis("y");"list"===l.type&&(n(l,u,i),n(l,c,i))}},this)},w.getTooltipAxes=function(e){var t=[],n=[];return s(this.getCartesians(),function(i){var r=null!=e&&"auto"!==e?i.getAxis(e):i.getBaseAxis(),a=i.getOtherAxis(r);l(t,r)<0&&t.push(r),l(n,a)<0&&n.push(a)}),{baseAxes:t,otherAxes:n}};var k=["xAxis","yAxis"];function I(e,t){return o(k,function(t){var n=e.getReferringComponents(t)[0];return n})}function C(e){return"cartesian2d"===e.get("coordinateSystem")}_.create=function(e,t){var n=[];return e.eachComponent("grid",function(i,r){var a=new _(i,e,t);a.name="grid_"+r,a.resize(i,t,!0),i.coordinateSystem=a,n.push(a)}),e.eachSeries(function(t){if(C(t)){var n=I(t,e),i=n[0],r=n[1],a=i.getCoordSysModel(),s=a.coordinateSystem;t.coordinateSystem=s.getCartesian(i.componentIndex,r.componentIndex)}}),n},_.dimensions=_.prototype.dimensions=m.prototype.dimensions,y.register("cartesian2d",_);var R=_;e.exports=R},"5ca1":function(e,t,n){var i=n("7726"),r=n("8378"),a=n("32e9"),s=n("2aba"),o=n("9b43"),l="prototype",u=function(e,t,n){var c,d,h,f,p=e&u.F,g=e&u.G,m=e&u.S,v=e&u.P,y=e&u.B,b=g?i:m?i[t]||(i[t]={}):(i[t]||{})[l],S=g?r:r[t]||(r[t]={}),T=S[l]||(S[l]={});for(c in g&&(n=t),n)d=!p&&b&&void 0!==b[c],h=(d?b:n)[c],f=y&&d?o(h,i):v&&"function"==typeof h?o(Function.call,h):h,b&&s(b,c,h,e&u.U),S[c]!=h&&a(S,c,f),v&&T[c]!=h&&(T[c]=h)};i.core=r,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},"5cc5":function(e,t,n){var i=n("2b4c")("iterator"),r=!1;try{var a=[7][i]();a["return"]=function(){r=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var a=[7],s=a[i]();s.next=function(){return{done:n=!0}},a[i]=function(){return s},e(a)}catch(e){}return n}},"5dbc":function(e,t,n){var i=n("d3f4"),r=n("8b97").set;e.exports=function(e,t,n){var a,s=t.constructor;return s!==n&&"function"==typeof s&&(a=s.prototype)!==n.prototype&&i(a)&&r&&r(e,a),e}},"5e68":function(e,t,n){var i=n("6d8b"),r=n("2cf4"),a=r.devicePixelRatio,s=n("2b61"),o=n("dc2f");function l(){return!1}function u(e,t,n){var r=i.createCanvas(),a=t.getWidth(),s=t.getHeight(),o=r.style;return o&&(o.position="absolute",o.left=0,o.top=0,o.width=a+"px",o.height=s+"px",r.setAttribute("data-zr-dom-id",e)),r.width=a*n,r.height=s*n,r}var c=function(e,t,n){var r;n=n||a,"string"===typeof e?r=u(e,t,n):i.isObject(e)&&(r=e,e=r.id),this.id=e,this.dom=r;var s=r.style;s&&(r.onselectstart=l,s["-webkit-user-select"]="none",s["user-select"]="none",s["-webkit-touch-callout"]="none",s["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",s["padding"]=0,s["margin"]=0,s["border-width"]=0),this.domBack=null,this.ctxBack=null,this.painter=t,this.config=null,this.clearColor=0,this.motionBlur=!1,this.lastFrameAlpha=.7,this.dpr=n};c.prototype={constructor:c,__dirty:!0,__used:!1,__drawIndex:0,__startIndex:0,__endIndex:0,incremental:!1,getElementCount:function(){return this.__endIndex-this.__startIndex},initContext:function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},createBackBuffer:function(){var e=this.dpr;this.domBack=u("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),1!=e&&this.ctxBack.scale(e,e)},resize:function(e,t){var n=this.dpr,i=this.dom,r=i.style,a=this.domBack;r&&(r.width=e+"px",r.height=t+"px"),i.width=e*n,i.height=t*n,a&&(a.width=e*n,a.height=t*n,1!=n&&this.ctxBack.scale(n,n))},clear:function(e,t){var n,i=this.dom,r=this.ctx,a=i.width,l=i.height,u=(t=t||this.clearColor,this.motionBlur&&!e),c=this.lastFrameAlpha,d=this.dpr;(u&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(i,0,0,a/d,l/d)),r.clearRect(0,0,a,l),t&&"transparent"!==t)&&(t.colorStops?(n=t.__canvasGradient||s.getGradient(r,t,{x:0,y:0,width:a,height:l}),t.__canvasGradient=n):t.image&&(n=o.prototype.getCanvasPattern.call(t,r)),r.save(),r.fillStyle=n||t,r.fillRect(0,0,a,l),r.restore());if(u){var h=this.domBack;r.save(),r.globalAlpha=c,r.drawImage(h,0,0,a,l),r.restore()}}};var d=c;e.exports=d},"5e76":function(e,t,n){var i=n("d51b"),r=new i(50);function a(e){if("string"===typeof e){var t=r.get(e);return t&&t.image}return e}function s(e,t,n,i,a){if(e){if("string"===typeof e){if(t&&t.__zrImageSrc===e||!n)return t;var s=r.get(e),u={hostEl:n,cb:i,cbPayload:a};return s?(t=s.image,!l(t)&&s.pending.push(u)):(!t&&(t=new Image),t.onload=o,r.put(e,t.__cachedImgObj={image:t,pending:[u]}),t.src=t.__zrImageSrc=e),t}return e}return t}function o(){var e=this.__cachedImgObj;this.onload=this.__cachedImgObj=null;for(var t=0;t<e.pending.length;t++){var n=e.pending[t],i=n.cb;i&&i(this,n.cbPayload),n.hostEl.dirty()}e.pending.length=0}function l(e){return e&&e.width&&e.height}t.findExistImage=a,t.createOrUpdateImage=s,t.isImageReady=l},"5e97":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("3eba")),a=n("6d8b"),s=n("a15a"),o=s.createSymbol,l=n("2306"),u=n("7919"),c=u.makeBackground,d=n("f934"),h=a.curry,f=a.each,p=l.Group,g=r.extendComponentView({type:"legend.plain",newlineDisabled:!1,init:function(){this.group.add(this._contentGroup=new p),this._backgroundEl},getContentGroup:function(){return this._contentGroup},render:function(e,t,n){if(this.resetInner(),e.get("show",!0)){var i=e.get("align");i&&"auto"!==i||(i="right"===e.get("left")&&"vertical"===e.get("orient")?"right":"left"),this.renderInner(i,e,t,n);var r=e.getBoxLayoutParams(),s={width:n.getWidth(),height:n.getHeight()},o=e.get("padding"),l=d.getLayoutRect(r,s,o),u=this.layoutInner(e,i,l),h=d.getLayoutRect(a.defaults({width:u.width,height:u.height},r),s,o);this.group.attr("position",[h.x-u.x,h.y-u.y]),this.group.add(this._backgroundEl=c(u,e))}},resetInner:function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl)},renderInner:function(e,t,n,i){var r=this.getContentGroup(),s=a.createHashMap(),o=t.get("selectedMode"),l=[];n.eachRawSeries(function(e){!e.get("legendHoverLink")&&l.push(e.id)}),f(t.getData(),function(a,u){var c=a.get("name");if(this.newlineDisabled||""!==c&&"\n"!==c){var d=n.getSeriesByName(c)[0];if(!s.get(c))if(d){var f=d.getData(),g=f.getVisual("color");"function"===typeof g&&(g=g(d.getDataParams(0)));var b=f.getVisual("legendSymbol")||"roundRect",S=f.getVisual("symbol"),T=this._createItem(c,u,a,t,b,S,e,g,o);T.on("click",h(m,c,i)).on("mouseover",h(v,d,null,i,l)).on("mouseout",h(y,d,null,i,l)),s.set(c,!0)}else n.eachRawSeries(function(n){if(!s.get(c)&&n.legendDataProvider){var r=n.legendDataProvider(),d=r.indexOfName(c);if(d<0)return;var f=r.getItemVisual(d,"color"),p="roundRect",g=this._createItem(c,u,a,t,p,null,e,f,o);g.on("click",h(m,c,i)).on("mouseover",h(v,n,c,i,l)).on("mouseout",h(y,n,c,i,l)),s.set(c,!0)}},this)}else r.add(new p({newline:!0}))},this)},_createItem:function(e,t,n,i,r,s,u,c,d){var h=i.get("itemWidth"),f=i.get("itemHeight"),g=i.get("inactiveColor"),m=i.get("symbolKeepAspect"),v=i.isSelected(e),y=new p,b=n.getModel("textStyle"),S=n.get("icon"),T=n.getModel("tooltip"),_=T.parentModel;if(r=S||r,y.add(o(r,0,0,h,f,v?c:g,null==m||m)),!S&&s&&(s!==r||"none"==s)){var w=.8*f;"none"===s&&(s="circle"),y.add(o(s,(h-w)/2,(f-w)/2,w,w,v?c:g,null==m||m))}var E="left"===u?h+5:-5,x=u,A=i.get("formatter"),k=e;"string"===typeof A&&A?k=A.replace("{name}",null!=e?e:""):"function"===typeof A&&(k=A(e)),y.add(new l.Text({style:l.setTextStyle({},b,{text:k,x:E,y:f/2,textFill:v?b.getTextColor():g,textAlign:x,textVerticalAlign:"middle"})}));var I=new l.Rect({shape:y.getBoundingRect(),invisible:!0,tooltip:T.get("show")?a.extend({content:e,formatter:_.get("formatter",!0)||function(){return e},formatterParams:{componentType:"legend",legendIndex:i.componentIndex,name:e,$vars:["name"]}},T.option):null});return y.add(I),y.eachChild(function(e){e.silent=!0}),I.silent=!d,this.getContentGroup().add(y),l.setHoverStyle(y),y.__legendDataIndex=t,y},layoutInner:function(e,t,n){var i=this.getContentGroup();d.box(e.get("orient"),i,e.get("itemGap"),n.width,n.height);var r=i.getBoundingRect();return i.attr("position",[-r.x,-r.y]),this.group.getBoundingRect()}});function m(e,t){t.dispatchAction({type:"legendToggleSelect",name:e})}function v(e,t,n,i){var r=n.getZr().storage.getDisplayList()[0];r&&r.useHoverLayer||n.dispatchAction({type:"highlight",seriesName:e.name,name:t,excludeSeriesId:i})}function y(e,t,n,i){var r=n.getZr().storage.getDisplayList()[0];r&&r.useHoverLayer||n.dispatchAction({type:"downplay",seriesName:e.name,name:t,excludeSeriesId:i})}e.exports=g},"607d":function(e,t,n){var i=n("1fab");t.Dispatcher=i;var r=n("22d1"),a="undefined"!==typeof window&&!!window.addEventListener,s=/^(?:mouse|pointer|contextmenu|drag|drop)|click/;function o(e){return e.getBoundingClientRect?e.getBoundingClientRect():{left:0,top:0}}function l(e,t,n,i){return n=n||{},i||!r.canvasSupported?u(e,t,n):r.browser.firefox&&null!=t.layerX&&t.layerX!==t.offsetX?(n.zrX=t.layerX,n.zrY=t.layerY):null!=t.offsetX?(n.zrX=t.offsetX,n.zrY=t.offsetY):u(e,t,n),n}function u(e,t,n){var i=o(e);n.zrX=t.clientX-i.left,n.zrY=t.clientY-i.top}function c(e,t,n){if(t=t||window.event,null!=t.zrX)return t;var i=t.type,r=i&&i.indexOf("touch")>=0;if(r){var a="touchend"!=i?t.targetTouches[0]:t.changedTouches[0];a&&l(e,a,t,n)}else l(e,t,t,n),t.zrDelta=t.wheelDelta?t.wheelDelta/120:-(t.detail||0)/3;var o=t.button;return null==t.which&&void 0!==o&&s.test(t.type)&&(t.which=1&o?1:2&o?3:4&o?2:0),t}function d(e,t,n){a?e.addEventListener(t,n):e.attachEvent("on"+t,n)}function h(e,t,n){a?e.removeEventListener(t,n):e.detachEvent("on"+t,n)}var f=a?function(e){e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0}:function(e){e.returnValue=!1,e.cancelBubble=!0};function p(e){return e.which>1}t.clientToLocal=l,t.normalizeEvent=c,t.addEventListener=d,t.removeEventListener=h,t.stop=f,t.notLeftMouse=p},"613b":function(e,t,n){var i=n("5537")("keys"),r=n("ca5a");e.exports=function(e){return i[e]||(i[e]=r(e))}},6179:function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=n("4319"),s=n("80f0"),o=n("ec6f"),l=n("2b17"),u=l.defaultDimValueGetters,c=l.DefaultDataProvider,d=n("2f45"),h=d.summarizeDimensions,f=r.isObject,p="undefined",g="e\0\0",m={float:typeof Float64Array===p?Array:Float64Array,int:typeof Int32Array===p?Array:Int32Array,ordinal:Array,number:Array,time:Array},v=typeof Uint32Array===p?Array:Uint32Array,y=typeof Uint16Array===p?Array:Uint16Array;function b(e){return e._rawCount>65535?v:y}function S(e){var t=e.constructor;return t===Array?e.slice():new t(e)}var T=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_rawData","_chunkSize","_chunkCount","_dimValueGetter","_count","_rawCount","_nameDimIdx","_idDimIdx"],_=["_extent","_approximateExtent","_rawExtent"];function w(e,t){r.each(T.concat(t.__wrappedMethods||[]),function(n){t.hasOwnProperty(n)&&(e[n]=t[n])}),e.__wrappedMethods=t.__wrappedMethods,r.each(_,function(n){e[n]=r.clone(t[n])}),e._calculationInfo=r.extend(t._calculationInfo)}var E=function(e,t){e=e||["x","y"];for(var n={},i=[],a={},s=0;s<e.length;s++){var o=e[s];r.isString(o)&&(o={name:o});var l=o.name;o.type=o.type||"float",o.coordDim||(o.coordDim=l,o.coordDimIndex=0),o.otherDims=o.otherDims||{},i.push(l),n[l]=o,o.index=s,o.createInvertedIndices&&(a[l]=[])}this.dimensions=i,this._dimensionInfos=n,this.hostModel=t,this.dataType,this._indices=null,this._count=0,this._rawCount=0,this._storage={},this._nameList=[],this._idList=[],this._optionModels=[],this._visual={},this._layout={},this._itemVisuals=[],this.hasItemVisual={},this._itemLayouts=[],this._graphicEls=[],this._chunkSize=1e5,this._chunkCount=0,this._rawData,this._rawExtent={},this._extent={},this._approximateExtent={},this._dimensionsSummary=h(this),this._invertedIndicesMap=a,this._calculationInfo={}},x=E.prototype;function A(e){var t=e._invertedIndicesMap;r.each(t,function(n,i){var r=e._dimensionInfos[i],a=r.ordinalMeta;if(a){n=t[i]=new v(a.categories.length);for(var s=0;s<n.length;s++)n[s]=NaN;for(s=0;s<e._count;s++)n[e.get(i,s)]=s}})}function k(e,t,n){var i;if(null!=t){var r=e._chunkSize,a=Math.floor(n/r),s=n%r,o=e.dimensions[t],l=e._storage[o][a];if(l){i=l[s];var u=e._dimensionInfos[o].ordinalMeta;u&&u.categories.length&&(i=u.categories[i])}}return i}function I(e){return e}function C(e){return e<this._count&&e>=0?this._indices[e]:-1}function R(e,t){var n=e._idList[t];return null==n&&(n=k(e,e._idDimIdx,t)),null==n&&(n=g+t),n}function M(e){return r.isArray(e)||(e=[e]),e}function D(e,t){var n=e.dimensions,i=new E(r.map(n,e.getDimensionInfo,e),e.hostModel);w(i,e);for(var a=i._storage={},s=e._storage,o=0;o<n.length;o++){var l=n[o];s[l]&&(r.indexOf(t,l)>=0?(a[l]=L(s[l]),i._rawExtent[l]=P(),i._extent[l]=null):a[l]=s[l])}return i}function L(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=S(e[n]);return t}function P(){return[1/0,-1/0]}x.type="list",x.hasItemOption=!0,x.getDimension=function(e){return isNaN(e)||(e=this.dimensions[e]||e),e},x.getDimensionInfo=function(e){return this._dimensionInfos[this.getDimension(e)]},x.getDimensionsOnCoord=function(){return this._dimensionsSummary.dataDimsOnCoord.slice()},x.mapDimension=function(e,t){var n=this._dimensionsSummary;if(null==t)return n.encodeFirstDimNotExtra[e];var i=n.encode[e];return!0===t?(i||[]).slice():i&&i[t]},x.initData=function(e,t,n){var i=o.isInstance(e)||r.isArrayLike(e);i&&(e=new c(e,this.dimensions.length)),this._rawData=e,this._storage={},this._indices=null,this._nameList=t||[],this._idList=[],this._nameRepeatCount={},n||(this.hasItemOption=!1),this.defaultDimValueGetter=u[this._rawData.getSource().sourceFormat],this._dimValueGetter=n=n||this.defaultDimValueGetter,this._rawExtent={},this._initDataFromProvider(0,e.count()),e.pure&&(this.hasItemOption=!1)},x.getProvider=function(){return this._rawData},x.appendData=function(e){var t=this._rawData,n=this.count();t.appendData(e);var i=t.count();t.persistent||(i+=n),this._initDataFromProvider(n,i)},x._initDataFromProvider=function(e,t){if(!(e>=t)){for(var n,i=this._chunkSize,r=this._rawData,a=this._storage,s=this.dimensions,o=s.length,l=this._dimensionInfos,u=this._nameList,c=this._idList,d=this._rawExtent,h=this._nameRepeatCount={},f=this._chunkCount,p=f-1,g=0;g<o;g++){var v=s[g];d[v]||(d[v]=P());var y=l[v];0===y.otherDims.itemName&&(n=this._nameDimIdx=g),0===y.otherDims.itemId&&(this._idDimIdx=g);var b=m[y.type];a[v]||(a[v]=[]);var S=a[v][p];if(S&&S.length<i){for(var T=new b(Math.min(t-p*i,i)),_=0;_<S.length;_++)T[_]=S[_];a[v][p]=T}for(var w=f*i;w<t;w+=i)a[v].push(new b(Math.min(t-w,i)));this._chunkCount=a[v].length}for(var E=new Array(o),x=e;x<t;x++){E=r.getItem(x,E);var k=Math.floor(x/i),I=x%i;for(w=0;w<o;w++){v=s[w];var C=a[v][k],R=this._dimValueGetter(E,v,x,w);C[I]=R;var M=d[v];R<M[0]&&(M[0]=R),R>M[1]&&(M[1]=R)}if(!r.pure){var D=u[x];if(E&&null==D)if(null!=E.name)u[x]=D=E.name;else if(null!=n){var L=s[n],O=a[L][k];if(O){D=O[I];var N=l[L].ordinalMeta;N&&N.categories.length&&(D=N.categories[D])}}var U=null==E?null:E.id;null==U&&null!=D&&(h[D]=h[D]||0,U=D,h[D]>0&&(U+="__ec__"+h[D]),h[D]++),null!=U&&(c[x]=U)}}!r.persistent&&r.clean&&r.clean(),this._rawCount=this._count=t,this._extent={},A(this)}},x.count=function(){return this._count},x.getIndices=function(){var e=this._indices;if(e){var t=e.constructor,n=this._count;if(t===Array){r=new t(n);for(var i=0;i<n;i++)r[i]=e[i]}else r=new t(e.buffer,0,n)}else{t=b(this);var r=new t(this.count());for(i=0;i<r.length;i++)r[i]=i}return r},x.get=function(e,t){if(!(t>=0&&t<this._count))return NaN;var n=this._storage;if(!n[e])return NaN;t=this.getRawIndex(t);var i=Math.floor(t/this._chunkSize),r=t%this._chunkSize,a=n[e][i],s=a[r];return s},x.getByRawIndex=function(e,t){if(!(t>=0&&t<this._rawCount))return NaN;var n=this._storage[e];if(!n)return NaN;var i=Math.floor(t/this._chunkSize),r=t%this._chunkSize,a=n[i];return a[r]},x._getFast=function(e,t){var n=Math.floor(t/this._chunkSize),i=t%this._chunkSize,r=this._storage[e][n];return r[i]},x.getValues=function(e,t){var n=[];r.isArray(e)||(t=e,e=this.dimensions);for(var i=0,a=e.length;i<a;i++)n.push(this.get(e[i],t));return n},x.hasValue=function(e){for(var t=this._dimensionsSummary.dataDimsOnCoord,n=this._dimensionInfos,i=0,r=t.length;i<r;i++)if("ordinal"!==n[t[i]].type&&isNaN(this.get(t[i],e)))return!1;return!0},x.getDataExtent=function(e){e=this.getDimension(e);var t=this._storage[e],n=P();if(!t)return n;var i,r=this.count(),a=!this._indices;if(a)return this._rawExtent[e].slice();if(i=this._extent[e],i)return i.slice();i=n;for(var s=i[0],o=i[1],l=0;l<r;l++){var u=this._getFast(e,this.getRawIndex(l));u<s&&(s=u),u>o&&(o=u)}return i=[s,o],this._extent[e]=i,i},x.getApproximateExtent=function(e){return e=this.getDimension(e),this._approximateExtent[e]||this.getDataExtent(e)},x.setApproximateExtent=function(e,t){t=this.getDimension(t),this._approximateExtent[t]=e.slice()},x.getCalculationInfo=function(e){return this._calculationInfo[e]},x.setCalculationInfo=function(e,t){f(e)?r.extend(this._calculationInfo,e):this._calculationInfo[e]=t},x.getSum=function(e){var t=this._storage[e],n=0;if(t)for(var i=0,r=this.count();i<r;i++){var a=this.get(e,i);isNaN(a)||(n+=a)}return n},x.getMedian=function(e){var t=[];this.each(e,function(e,n){isNaN(e)||t.push(e)});var n=[].concat(t).sort(function(e,t){return e-t}),i=this.count();return 0===i?0:i%2===1?n[(i-1)/2]:(n[i/2]+n[i/2-1])/2},x.rawIndexOf=function(e,t){var n=e&&this._invertedIndicesMap[e],i=n[t];return null==i||isNaN(i)?-1:i},x.indexOfName=function(e){for(var t=0,n=this.count();t<n;t++)if(this.getName(t)===e)return t;return-1},x.indexOfRawIndex=function(e){if(!this._indices)return e;if(e>=this._rawCount||e<0)return-1;var t=this._indices,n=t[e];if(null!=n&&n<this._count&&n===e)return e;var i=0,r=this._count-1;while(i<=r){var a=(i+r)/2|0;if(t[a]<e)i=a+1;else{if(!(t[a]>e))return a;r=a-1}}return-1},x.indicesOfNearest=function(e,t,n){var i=this._storage,r=i[e],a=[];if(!r)return a;null==n&&(n=1/0);for(var s=Number.MAX_VALUE,o=-1,l=0,u=this.count();l<u;l++){var c=t-this.get(e,l),d=Math.abs(c);c<=n&&d<=s&&((d<s||c>=0&&o<0)&&(s=d,o=c,a.length=0),a.push(l))}return a},x.getRawIndex=I,x.getRawDataItem=function(e){if(this._rawData.persistent)return this._rawData.getItem(this.getRawIndex(e));for(var t=[],n=0;n<this.dimensions.length;n++){var i=this.dimensions[n];t.push(this.get(i,e))}return t},x.getName=function(e){var t=this.getRawIndex(e);return this._nameList[t]||k(this,this._nameDimIdx,t)||""},x.getId=function(e){return R(this,this.getRawIndex(e))},x.each=function(e,t,n,i){"use strict";if(this._count){"function"===typeof e&&(i=n,n=t,t=e,e=[]),n=n||i||this,e=r.map(M(e),this.getDimension,this);for(var a=e.length,s=0;s<this.count();s++)switch(a){case 0:t.call(n,s);break;case 1:t.call(n,this.get(e[0],s),s);break;case 2:t.call(n,this.get(e[0],s),this.get(e[1],s),s);break;default:for(var o=0,l=[];o<a;o++)l[o]=this.get(e[o],s);l[o]=s,t.apply(n,l)}}},x.filterSelf=function(e,t,n,i){"use strict";if(this._count){"function"===typeof e&&(i=n,n=t,t=e,e=[]),n=n||i||this,e=r.map(M(e),this.getDimension,this);for(var a=this.count(),s=b(this),o=new s(a),l=[],u=e.length,c=0,d=e[0],h=0;h<a;h++){var f,p=this.getRawIndex(h);if(0===u)f=t.call(n,h);else if(1===u){var g=this._getFast(d,p);f=t.call(n,g,h)}else{for(var m=0;m<u;m++)l[m]=this._getFast(d,p);l[m]=h,f=t.apply(n,l)}f&&(o[c++]=p)}return c<a&&(this._indices=o),this._count=c,this._extent={},this.getRawIndex=this._indices?C:I,this}},x.selectRange=function(e){"use strict";if(this._count){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);var i=t.length;if(i){var r=this.count(),a=b(this),s=new a(r),o=0,l=t[0],u=e[l][0],c=e[l][1],d=!1;if(!this._indices){var h=0;if(1===i){for(var f=this._storage[t[0]],p=0;p<this._chunkCount;p++)for(var g=f[p],m=Math.min(this._count-p*this._chunkSize,this._chunkSize),v=0;v<m;v++){var y=g[v];(y>=u&&y<=c||isNaN(y))&&(s[o++]=h),h++}d=!0}else if(2===i){f=this._storage[l];var S=this._storage[t[1]],T=e[t[1]][0],_=e[t[1]][1];for(p=0;p<this._chunkCount;p++){g=f[p];var w=S[p];for(m=Math.min(this._count-p*this._chunkSize,this._chunkSize),v=0;v<m;v++){y=g[v];var E=w[v];(y>=u&&y<=c||isNaN(y))&&(E>=T&&E<=_||isNaN(E))&&(s[o++]=h),h++}}d=!0}}if(!d)if(1===i)for(v=0;v<r;v++){var x=this.getRawIndex(v);y=this._getFast(l,x);(y>=u&&y<=c||isNaN(y))&&(s[o++]=x)}else for(v=0;v<r;v++){var A=!0;for(x=this.getRawIndex(v),p=0;p<i;p++){var k=t[p];y=this._getFast(n,x);(y<e[k][0]||y>e[k][1])&&(A=!1)}A&&(s[o++]=this.getRawIndex(v))}return o<r&&(this._indices=s),this._count=o,this._extent={},this.getRawIndex=this._indices?C:I,this}}},x.mapArray=function(e,t,n,i){"use strict";"function"===typeof e&&(i=n,n=t,t=e,e=[]),n=n||i||this;var r=[];return this.each(e,function(){r.push(t&&t.apply(this,arguments))},n),r},x.map=function(e,t,n,i){"use strict";n=n||i||this,e=r.map(M(e),this.getDimension,this);var a=D(this,e);a._indices=this._indices,a.getRawIndex=a._indices?C:I;for(var s=a._storage,o=[],l=this._chunkSize,u=e.length,c=this.count(),d=[],h=a._rawExtent,f=0;f<c;f++){for(var p=0;p<u;p++)d[p]=this.get(e[p],f);d[u]=f;var g=t&&t.apply(n,d);if(null!=g){"object"!==typeof g&&(o[0]=g,g=o);for(var m=this.getRawIndex(f),v=Math.floor(m/l),y=m%l,b=0;b<g.length;b++){var S=e[b],T=g[b],_=h[S],w=s[S];w&&(w[v][y]=T),T<_[0]&&(_[0]=T),T>_[1]&&(_[1]=T)}}}return a},x.downSample=function(e,t,n,i){for(var r=D(this,[e]),a=r._storage,s=[],o=Math.floor(1/t),l=a[e],u=this.count(),c=this._chunkSize,d=r._rawExtent[e],h=new(b(this))(u),f=0,p=0;p<u;p+=o){o>u-p&&(o=u-p,s.length=o);for(var g=0;g<o;g++){var m=this.getRawIndex(p+g),v=Math.floor(m/c),y=m%c;s[g]=l[v][y]}var S=n(s),T=this.getRawIndex(Math.min(p+i(s,S)||0,u-1)),_=Math.floor(T/c),w=T%c;l[_][w]=S,S<d[0]&&(d[0]=S),S>d[1]&&(d[1]=S),h[f++]=T}return r._count=f,r._indices=h,r.getRawIndex=C,r},x.getItemModel=function(e){var t=this.hostModel;return new a(this.getRawDataItem(e),t,t&&t.ecModel)},x.diff=function(e){var t=this;return new s(e?e.getIndices():[],this.getIndices(),function(t){return R(e,t)},function(e){return R(t,e)})},x.getVisual=function(e){var t=this._visual;return t&&t[e]},x.setVisual=function(e,t){if(f(e))for(var n in e)e.hasOwnProperty(n)&&this.setVisual(n,e[n]);else this._visual=this._visual||{},this._visual[e]=t},x.setLayout=function(e,t){if(f(e))for(var n in e)e.hasOwnProperty(n)&&this.setLayout(n,e[n]);else this._layout[e]=t},x.getLayout=function(e){return this._layout[e]},x.getItemLayout=function(e){return this._itemLayouts[e]},x.setItemLayout=function(e,t,n){this._itemLayouts[e]=n?r.extend(this._itemLayouts[e]||{},t):t},x.clearItemLayouts=function(){this._itemLayouts.length=0},x.getItemVisual=function(e,t,n){var i=this._itemVisuals[e],r=i&&i[t];return null!=r||n?r:this.getVisual(t)},x.setItemVisual=function(e,t,n){var i=this._itemVisuals[e]||{},r=this.hasItemVisual;if(this._itemVisuals[e]=i,f(t))for(var a in t)t.hasOwnProperty(a)&&(i[a]=t[a],r[a]=!0);else i[t]=n,r[t]=!0},x.clearAllVisual=function(){this._visual={},this._itemVisuals=[],this.hasItemVisual={}};var O=function(e){e.seriesIndex=this.seriesIndex,e.dataIndex=this.dataIndex,e.dataType=this.dataType};x.setItemGraphicEl=function(e,t){var n=this.hostModel;t&&(t.dataIndex=e,t.dataType=this.dataType,t.seriesIndex=n&&n.seriesIndex,"group"===t.type&&t.traverse(O,t)),this._graphicEls[e]=t},x.getItemGraphicEl=function(e){return this._graphicEls[e]},x.eachItemGraphicEl=function(e,t){r.each(this._graphicEls,function(n,i){n&&e&&e.call(t,n,i)})},x.cloneShallow=function(e){if(!e){var t=r.map(this.dimensions,this.getDimensionInfo,this);e=new E(t,this.hostModel)}if(e._storage=this._storage,w(e,this),this._indices){var n=this._indices.constructor;e._indices=new n(this._indices)}else e._indices=null;return e.getRawIndex=e._indices?C:I,e},x.wrapMethod=function(e,t){var n=this[e];"function"===typeof n&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(e),this[e]=function(){var e=n.apply(this,arguments);return t.apply(this,[e].concat(r.slice(arguments)))})},x.TRANSFERABLE_METHODS=["cloneShallow","downSample","map"],x.CHANGABLE_METHODS=["filterSelf","selectRange"];var N=E;e.exports=N},"620b":function(e,t,n){var i=n("401b"),r=i.distance;function a(e,t,n,i,r,a,s){var o=.5*(n-e),l=.5*(i-t);return(2*(t-n)+o+l)*s+(-3*(t-n)-2*o-l)*a+o*r+t}function s(e,t){for(var n=e.length,i=[],s=0,o=1;o<n;o++)s+=r(e[o-1],e[o]);var l=s/2;l=l<n?n:l;for(o=0;o<l;o++){var u,c,d,h=o/(l-1)*(t?n:n-1),f=Math.floor(h),p=h-f,g=e[f%n];t?(u=e[(f-1+n)%n],c=e[(f+1)%n],d=e[(f+2)%n]):(u=e[0===f?f:f-1],c=e[f>n-2?n-1:f+1],d=e[f>n-3?n-1:f+2]);var m=p*p,v=p*m;i.push([a(u[0],g[0],c[0],d[0],p,m,v),a(u[1],g[1],c[1],d[1],p,m,v)])}return i}e.exports=s},"625e":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=".",s="___EC__COMPONENT__CONTAINER___";function o(e){var t={main:"",sub:""};return e&&(e=e.split(a),t.main=e[0]||"",t.sub=e[1]||""),t}function l(e){r.assert(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(e),'componentType "'+e+'" illegal')}function u(e,t){e.$constructor=e,e.extend=function(e){var t=this,n=function(){e.$constructor?e.$constructor.apply(this,arguments):t.apply(this,arguments)};return r.extend(n.prototype,e),n.extend=this.extend,n.superCall=h,n.superApply=f,r.inherits(n,this),n.superClass=t,n}}var c=0;function d(e){var t=["__\0is_clz",c++,Math.random().toFixed(3)].join("_");e.prototype[t]=!0,e.isInstance=function(e){return!(!e||!e[t])}}function h(e,t){var n=r.slice(arguments,2);return this.superClass.prototype[t].apply(e,n)}function f(e,t,n){return this.superClass.prototype[t].apply(e,n)}function p(e,t){t=t||{};var n={};function i(e){var t=n[e.main];return t&&t[s]||(t=n[e.main]={},t[s]=!0),t}if(e.registerClass=function(e,t){if(t)if(l(t),t=o(t),t.sub){if(t.sub!==s){var r=i(t);r[t.sub]=e}}else n[t.main]=e;return e},e.getClass=function(e,t,i){var r=n[e];if(r&&r[s]&&(r=t?r[t]:null),i&&!r)throw new Error(t?"Component "+e+"."+(t||"")+" not exists. Load it first.":e+".type should be specified.");return r},e.getClassesByMainType=function(e){e=o(e);var t=[],i=n[e.main];return i&&i[s]?r.each(i,function(e,n){n!==s&&t.push(e)}):t.push(i),t},e.hasClass=function(e){return e=o(e),!!n[e.main]},e.getAllClassMainTypes=function(){var e=[];return r.each(n,function(t,n){e.push(n)}),e},e.hasSubTypes=function(e){e=o(e);var t=n[e.main];return t&&t[s]},e.parseClassType=o,t.registerWhenExtend){var a=e.extend;a&&(e.extend=function(t){var n=a.call(this,t);return e.registerClass(n,t.type)})}return e}function g(e,t){}t.parseClassType=o,t.enableClassExtend=u,t.enableClassCheck=d,t.enableClassManagement=p,t.setReadOnly=g},"626a":function(e,t,n){var i=n("2d95");e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},6679:function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("3eba")),a=n("cd33"),s=r.extendComponentView({type:"axis",_axisPointer:null,axisPointerClass:null,render:function(e,t,n,i){this.axisPointerClass&&a.fixValue(e),s.superApply(this,"render",arguments),o(this,e,t,n,i,!0)},updateAxisPointer:function(e,t,n,i,r){o(this,e,t,n,i,!1)},remove:function(e,t){var n=this._axisPointer;n&&n.remove(t),s.superApply(this,"remove",arguments)},dispose:function(e,t){l(this,t),s.superApply(this,"dispose",arguments)}});function o(e,t,n,i,r,o){var u=s.getAxisPointerClass(e.axisPointerClass);if(u){var c=a.getAxisPointerModel(t);c?(e._axisPointer||(e._axisPointer=new u)).render(t,c,i,o):l(e,i)}}function l(e,t,n){var i=e._axisPointer;i&&i.dispose(t,n),e._axisPointer=null}var u=[];s.registerAxisPointerClass=function(e,t){u[e]=t},s.getAxisPointerClass=function(e){return e&&u[e]};var c=s;e.exports=c},"67cc":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("3eba")),a=n("6d8b"),s=n("2306"),o=n("e7aa"),l=o.setLabel,u=n("4319"),c=n("b5c7"),d=n("cbe5"),h=["itemStyle","barBorderWidth"];a.extend(u.prototype,c);var f=r.extendChartView({type:"bar",render:function(e,t,n){this._updateDrawMode(e);var i=e.get("coordinateSystem");return"cartesian2d"!==i&&"polar"!==i||(this._isLargeDraw?this._renderLarge(e,t,n):this._renderNormal(e,t,n)),this.group},incrementalPrepareRender:function(e,t,n){this._clear(),this._updateDrawMode(e)},incrementalRender:function(e,t,n,i){this._incrementalRenderLarge(e,t)},_updateDrawMode:function(e){var t=e.pipelineContext.large;(null==this._isLargeDraw||t^this._isLargeDraw)&&(this._isLargeDraw=t,this._clear())},_renderNormal:function(e,t,n){var i,r=this.group,a=e.getData(),o=this._data,l=e.coordinateSystem,u=l.getBaseAxis();"cartesian2d"===l.type?i=u.isHorizontal():"polar"===l.type&&(i="angle"===u.dim);var c=e.isAnimationEnabled()?e:null;a.diff(o).add(function(t){if(a.hasValue(t)){var n=a.getItemModel(t),s=v[l.type](a,t,n),o=p[l.type](a,t,n,s,i,c);a.setItemGraphicEl(t,o),r.add(o),y(o,a,t,n,s,e,i,"polar"===l.type)}}).update(function(t,n){var u=o.getItemGraphicEl(n);if(a.hasValue(t)){var d=a.getItemModel(t),h=v[l.type](a,t,d);u?s.updateProps(u,{shape:h},c,t):u=p[l.type](a,t,d,h,i,c,!0),a.setItemGraphicEl(t,u),r.add(u),y(u,a,t,d,h,e,i,"polar"===l.type)}else r.remove(u)}).remove(function(e){var t=o.getItemGraphicEl(e);"cartesian2d"===l.type?t&&g(e,c,t):t&&m(e,c,t)}).execute(),this._data=a},_renderLarge:function(e,t,n){this._clear(),T(e,this.group)},_incrementalRenderLarge:function(e,t){T(t,this.group,!0)},dispose:a.noop,remove:function(e){this._clear(e)},_clear:function(e){var t=this.group,n=this._data;e&&e.get("animation")&&n&&!this._isLargeDraw?n.eachItemGraphicEl(function(t){"sector"===t.type?m(t.dataIndex,e,t):g(t.dataIndex,e,t)}):t.removeAll(),this._data=null}}),p={cartesian2d:function(e,t,n,i,r,o,l){var u=new s.Rect({shape:a.extend({},i)});if(o){var c=u.shape,d=r?"height":"width",h={};c[d]=0,h[d]=i[d],s[l?"updateProps":"initProps"](u,{shape:h},o,t)}return u},polar:function(e,t,n,i,r,o,l){var u=i.startAngle<i.endAngle,c=new s.Sector({shape:a.defaults({clockwise:u},i)});if(o){var d=c.shape,h=r?"r":"endAngle",f={};d[h]=r?0:i.startAngle,f[h]=i[h],s[l?"updateProps":"initProps"](c,{shape:f},o,t)}return c}};function g(e,t,n){n.style.text=null,s.updateProps(n,{shape:{width:0}},t,e,function(){n.parent&&n.parent.remove(n)})}function m(e,t,n){n.style.text=null,s.updateProps(n,{shape:{r:n.shape.r0}},t,e,function(){n.parent&&n.parent.remove(n)})}var v={cartesian2d:function(e,t,n){var i=e.getItemLayout(t),r=b(n,i),a=i.width>0?1:-1,s=i.height>0?1:-1;return{x:i.x+a*r/2,y:i.y+s*r/2,width:i.width-a*r,height:i.height-s*r}},polar:function(e,t,n){var i=e.getItemLayout(t);return{cx:i.cx,cy:i.cy,r0:i.r0,r:i.r,startAngle:i.startAngle,endAngle:i.endAngle}}};function y(e,t,n,i,r,o,u,c){var d=t.getItemVisual(n,"color"),h=t.getItemVisual(n,"opacity"),f=i.getModel("itemStyle"),p=i.getModel("emphasis.itemStyle").getBarItemStyle();c||e.setShape("r",f.get("barBorderRadius")||0),e.useStyle(a.defaults({fill:d,opacity:h},f.getBarItemStyle()));var g=i.getShallow("cursor");g&&e.attr("cursor",g);var m=u?r.height>0?"bottom":"top":r.width>0?"left":"right";c||l(e.style,p,i,d,o,n,m),s.setHoverStyle(e,p)}function b(e,t){var n=e.get(h)||0;return Math.min(n,Math.abs(t.width),Math.abs(t.height))}var S=d.extend({type:"largeBar",shape:{points:[]},buildPath:function(e,t){for(var n=t.points,i=this.__startPoint,r=this.__valueIdx,a=0;a<n.length;a+=2)i[this.__valueIdx]=n[a+r],e.moveTo(i[0],i[1]),e.lineTo(n[a],n[a+1])}});function T(e,t,n){var i=e.getData(),r=[],a=i.getLayout("valueAxisHorizontal")?1:0;r[1-a]=i.getLayout("valueAxisStart");var s=new S({shape:{points:i.getLayout("largePoints")},incremental:!!n,__startPoint:r,__valueIdx:a});t.add(s),_(s,e,i)}function _(e,t,n){var i=n.getVisual("borderColor")||n.getVisual("color"),r=t.getModel("itemStyle").getItemStyle(["color","borderColor"]);e.useStyle(r),e.style.fill=null,e.style.stroke=i,e.style.lineWidth=n.getLayout("barWidth")}e.exports=f},6821:function(e,t,n){var i=n("626a"),r=n("be13");e.exports=function(e){return i(r(e))}},"68ab":function(e,t,n){var i=n("4a3f"),r=i.quadraticProjectPoint;function a(e,t,n,i,a,s,o,l,u){if(0===o)return!1;var c=o;if(u>t+c&&u>i+c&&u>s+c||u<t-c&&u<i-c&&u<s-c||l>e+c&&l>n+c&&l>a+c||l<e-c&&l<n-c&&l<a-c)return!1;var d=r(e,t,n,i,a,s,l,u,null);return d<=c/2}t.containStroke=a},6932:function(e,t,n){var i=n("6cb7");i.registerSubTypeDefaulter("dataZoom",function(){return"slider"})},"697e":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=n("18c0"),s=n("89e3"),o=n("e0d8"),l=n("3842"),u=n("9d57"),c=u.prepareLayoutBarSeries,d=u.makeColumnLayout,h=u.retrieveColumnLayout,f=n("9850");function p(e,t){var n,i,a,s=e.type,o=t.getMin(),u=t.getMax(),h=null!=o,f=null!=u,p=e.getExtent();"ordinal"===s?n=t.getCategories().length:(i=t.get("boundaryGap"),r.isArray(i)||(i=[i||0,i||0]),"boolean"===typeof i[0]&&(i=[0,0]),i[0]=l.parsePercent(i[0],1),i[1]=l.parsePercent(i[1],1),a=p[1]-p[0]||Math.abs(p[0])),null==o&&(o="ordinal"===s?n?0:NaN:p[0]-i[0]*a),null==u&&(u="ordinal"===s?n?n-1:NaN:p[1]+i[1]*a),"dataMin"===o?o=p[0]:"function"===typeof o&&(o=o({min:p[0],max:p[1]})),"dataMax"===u?u=p[1]:"function"===typeof u&&(u=u({min:p[0],max:p[1]})),(null==o||!isFinite(o))&&(o=NaN),(null==u||!isFinite(u))&&(u=NaN),e.setBlank(r.eqNaN(o)||r.eqNaN(u)||"ordinal"===s&&!e.getOrdinalMeta().categories.length),t.getNeedCrossZero()&&(o>0&&u>0&&!h&&(o=0),o<0&&u<0&&!f&&(u=0));var m=t.ecModel;if(m&&"time"===s){var v,y=c("bar",m);if(r.each(y,function(e){v|=e.getBaseAxis()===t.axis}),v){var b=d(y),S=g(o,u,t,b);o=S.min,u=S.max}}return[o,u]}function g(e,t,n,i){var a=n.axis.getExtent(),s=a[1]-a[0],o=h(i,n.axis);if(void 0===o)return{min:e,max:t};var l=1/0;r.each(o,function(e){l=Math.min(e.offset,l)});var u=-1/0;r.each(o,function(e){u=Math.max(e.offset+e.width,u)}),l=Math.abs(l),u=Math.abs(u);var c=l+u,d=t-e,f=1-(l+u)/s,p=d/f-d;return t+=p*(u/c),e-=p*(l/c),{min:e,max:t}}function m(e,t){var n=p(e,t),i=null!=t.getMin(),r=null!=t.getMax(),a=t.get("splitNumber");"log"===e.type&&(e.base=t.get("logBase"));var s=e.type;e.setExtent(n[0],n[1]),e.niceExtent({splitNumber:a,fixMin:i,fixMax:r,minInterval:"interval"===s||"time"===s?t.get("minInterval"):null,maxInterval:"interval"===s||"time"===s?t.get("maxInterval"):null});var o=t.get("interval");null!=o&&e.setInterval&&e.setInterval(o)}function v(e,t){if(t=t||e.get("type"),t)switch(t){case"category":return new a(e.getOrdinalMeta?e.getOrdinalMeta():e.getCategories(),[1/0,-1/0]);case"value":return new s;default:return(o.getClass(t)||s).create(e)}}function y(e){var t=e.scale.getExtent(),n=t[0],i=t[1];return!(n>0&&i>0||n<0&&i<0)}function b(e){var t=e.getLabelModel().get("formatter"),n="category"===e.type?e.scale.getExtent()[0]:null;return"string"===typeof t?(t=function(e){return function(t){return e.replace("{value}",null!=t?t:"")}}(t),t):"function"===typeof t?function(i,r){return null!=n&&(r=i-n),t(S(e,i),r)}:function(t){return e.scale.getLabel(t)}}function S(e,t){return"category"===e.type?e.scale.getLabel(t):t}function T(e){var t=e.model,n=e.scale;if(t.get("axisLabel.show")&&!n.isBlank()){var i,r,a="category"===e.type,s=n.getExtent();a?r=n.count():(i=n.getTicks(),r=i.length);var o,l=e.getLabelModel(),u=b(e),c=1;r>40&&(c=Math.ceil(r/40));for(var d=0;d<r;d+=c){var h=i?i[d]:s[0]+d,f=u(h),p=l.getTextRect(f),g=_(p,l.get("rotate")||0);o?o.union(g):o=g}return o}}function _(e,t){var n=t*Math.PI/180,i=e.plain(),r=i.width,a=i.height,s=r*Math.cos(n)+a*Math.sin(n),o=r*Math.sin(n)+a*Math.cos(n),l=new f(i.x,i.y,s,o);return l}n("216a"),n("8c2a"),t.getScaleExtent=p,t.niceScaleExtent=m,t.createScaleByModel=v,t.ifAxisCrossZero=y,t.makeLabelFormatter=b,t.getAxisRawValue=S,t.estimateLabelUnionRect=T},"697e7":function(e,t,n){var i=n("de00"),r=n("22d1"),a=n("6d8b"),s=n("d2cf"),o=n("afa0"),l=n("ed21"),u=n("30a3"),c=n("cdaa"),d=!r.canvasSupported,h={canvas:l},f={},p="4.0.4";function g(e,t){var n=new S(i(),e,t);return f[n.id]=n,n}function m(e){if(e)e.dispose();else{for(var t in f)f.hasOwnProperty(t)&&f[t].dispose();f={}}return this}function v(e){return f[e]}function y(e,t){h[e]=t}function b(e){delete f[e]}var S=function(e,t,n){n=n||{},this.dom=t,this.id=e;var i=this,l=new o,f=n.renderer;if(d){if(!h.vml)throw new Error("You need to require 'zrender/vml/vml' to support IE8");f="vml"}else f&&h[f]||(f="canvas");var p=new h[f](t,l,n,e);this.storage=l,this.painter=p;var g=r.node||r.worker?null:new c(p.getViewportRoot());this.handler=new s(l,p,g,p.root),this.animation=new u({stage:{update:a.bind(this.flush,this)}}),this.animation.start(),this._needsRefresh;var m=l.delFromStorage,v=l.addToStorage;l.delFromStorage=function(e){m.call(l,e),e&&e.removeSelfFromZr(i)},l.addToStorage=function(e){v.call(l,e),e.addSelfToZr(i)}};S.prototype={constructor:S,getId:function(){return this.id},add:function(e){this.storage.addRoot(e),this._needsRefresh=!0},remove:function(e){this.storage.delRoot(e),this._needsRefresh=!0},configLayer:function(e,t){this.painter.configLayer&&this.painter.configLayer(e,t),this._needsRefresh=!0},setBackgroundColor:function(e){this.painter.setBackgroundColor&&this.painter.setBackgroundColor(e),this._needsRefresh=!0},refreshImmediately:function(){this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},refresh:function(){this._needsRefresh=!0},flush:function(){var e;this._needsRefresh&&(e=!0,this.refreshImmediately()),this._needsRefreshHover&&(e=!0,this.refreshHoverImmediately()),e&&this.trigger("rendered")},addHover:function(e,t){this.painter.addHover&&(this.painter.addHover(e,t),this.refreshHover())},removeHover:function(e){this.painter.removeHover&&(this.painter.removeHover(e),this.refreshHover())},clearHover:function(){this.painter.clearHover&&(this.painter.clearHover(),this.refreshHover())},refreshHover:function(){this._needsRefreshHover=!0},refreshHoverImmediately:function(){this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.refreshHover()},resize:function(e){e=e||{},this.painter.resize(e.width,e.height),this.handler.resize()},clearAnimation:function(){this.animation.clear()},getWidth:function(){return this.painter.getWidth()},getHeight:function(){return this.painter.getHeight()},pathToImage:function(e,t){return this.painter.pathToImage(e,t)},setCursorStyle:function(e){this.handler.setCursorStyle(e)},findHover:function(e,t){return this.handler.findHover(e,t)},on:function(e,t,n){this.handler.on(e,t,n)},off:function(e,t){this.handler.off(e,t)},trigger:function(e,t){this.handler.trigger(e,t)},clear:function(){this.storage.delRoot(),this.painter.clear()},dispose:function(){this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,b(this.id)}},t.version=p,t.init=g,t.dispose=m,t.getInstance=v,t.registerPainter=y},"69a8":function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},"69ff":function(e,t,n){var i=n("6d8b"),r=i.each,a=i.map,s=(i.isArray,i.isFunction),o=i.createHashMap,l=i.noop,u=n("f47d"),c=u.createTask,d=n("8918"),h=d.getUID,f=n("7e63"),p=n("843e"),g=n("e0d3"),m=g.normalizeToArray;function v(e,t,n,i){this.ecInstance=e,this.api=t,this.unfinished;n=this._dataProcessorHandlers=n.slice(),i=this._visualHandlers=i.slice();this._allHandlers=n.concat(i),this._stageTaskMap=o()}var y=v.prototype;function b(e,t,n,i,a){var s;function o(e,t){return e.setDirty&&(!e.dirtyMap||e.dirtyMap.get(t.__pipeline.id))}a=a||{},r(t,function(t,r){if(!a.visualType||a.visualType===t.visualType){var l=e._stageTaskMap.get(t.uid),u=l.seriesTaskMap,c=l.overallTask;if(c){var d,h=c.agentStubMap;h.each(function(e){o(a,e)&&(e.dirty(),d=!0)}),d&&c.dirty(),S(c,i);var f=e.getPerformArgs(c,a.block);h.each(function(e){e.perform(f)}),s|=c.perform(f)}else u&&u.each(function(r,l){o(a,r)&&r.dirty();var u=e.getPerformArgs(r,a.block);u.skip=!t.performRawSeries&&n.isSeriesFiltered(r.context.model),S(r,i),s|=r.perform(u)})}}),e.unfinished|=s}y.restoreData=function(e,t){e.restoreData(t),this._stageTaskMap.each(function(e){var t=e.overallTask;t&&t.dirty()})},y.getPerformArgs=function(e,t){if(e.__pipeline){var n=this._pipelineMap.get(e.__pipeline.id),i=n.context,r=!t&&n.progressiveEnabled&&(!i||i.progressiveRender)&&e.__idxInPipeline>n.blockIndex,a=r?n.step:null,s=i&&i.modDataCount,o=null!=s?Math.ceil(s/a):null;return{step:a,modBy:o,modDataCount:s}}},y.getPipeline=function(e){return this._pipelineMap.get(e)},y.updateStreamModes=function(e,t){var n=this._pipelineMap.get(e.uid),i=e.getData(),r=i.count(),a=n.progressiveEnabled&&t.incrementalPrepareRender&&r>=n.threshold,s=e.get("large")&&r>=e.get("largeThreshold"),o="mod"===e.get("progressiveChunkMode")?r:null;e.pipelineContext=n.context={progressiveRender:a,modDataCount:o,large:s}},y.restorePipelines=function(e){var t=this,n=t._pipelineMap=o();e.eachSeries(function(e){var i=e.getProgressive(),r=e.uid;n.set(r,{id:r,head:null,tail:null,threshold:e.getProgressiveThreshold(),progressiveEnabled:i&&!(e.preventIncremental&&e.preventIncremental()),blockIndex:-1,step:Math.round(i||700),count:0}),D(t,e,e.dataTask)})},y.prepareStageTasks=function(){var e=this._stageTaskMap,t=this.ecInstance.getModel(),n=this.api;r(this._allHandlers,function(i){var r=e.get(i.uid)||e.set(i.uid,[]);i.reset&&T(this,i,r,t,n),i.overallReset&&_(this,i,r,t,n)},this)},y.prepareView=function(e,t,n,i){var r=e.renderTask,a=r.context;a.model=t,a.ecModel=n,a.api=i,r.__block=!e.incrementalPrepareRender,D(this,t,r)},y.performDataProcessorTasks=function(e,t){b(this,this._dataProcessorHandlers,e,t,{block:!0})},y.performVisualTasks=function(e,t,n){b(this,this._visualHandlers,e,t,n)},y.performSeriesTasks=function(e){var t;e.eachSeries(function(e){t|=e.dataTask.perform()}),this.unfinished|=t},y.plan=function(){this._pipelineMap.each(function(e){var t=e.tail;do{if(t.__block){e.blockIndex=t.__idxInPipeline;break}t=t.getUpstream()}while(t)})};var S=y.updatePayload=function(e,t){"remain"!==t&&(e.context.payload=t)};function T(e,t,n,i,r){var a=n.seriesTaskMap||(n.seriesTaskMap=o()),s=t.seriesType,l=t.getTargetSeries;function u(n){var s=n.uid,o=a.get(s)||a.set(s,c({plan:k,reset:I,count:M}));o.context={model:n,ecModel:i,api:r,useClearVisual:t.isVisual&&!t.isLayout,plan:t.plan,reset:t.reset,scheduler:e},D(e,n,o)}t.createOnAllSeries?i.eachRawSeries(u):s?i.eachRawSeriesByType(s,u):l&&l(i,r).each(u);var d=e._pipelineMap;a.each(function(e,t){d.get(t)||(e.dispose(),a.removeKey(t))})}function _(e,t,n,i,a){var s=n.overallTask=n.overallTask||c({reset:w});s.context={ecModel:i,api:a,overallReset:t.overallReset,scheduler:e};var l=s.agentStubMap=s.agentStubMap||o(),u=t.seriesType,d=t.getTargetSeries,h=!0,f=t.modifyOutputEnd;function p(t){var n=t.uid,i=l.get(n);i||(i=l.set(n,c({reset:E,onDirty:A})),s.dirty()),i.context={model:t,overallProgress:h,modifyOutputEnd:f},i.agent=s,i.__block=h,D(e,t,i)}u?i.eachRawSeriesByType(u,p):d?d(i,a).each(p):(h=!1,r(i.getSeries(),p));var g=e._pipelineMap;l.each(function(e,t){g.get(t)||(e.dispose(),s.dirty(),l.removeKey(t))})}function w(e){e.overallReset(e.ecModel,e.api,e.payload)}function E(e,t){return e.overallProgress&&x}function x(){this.agent.dirty(),this.getDownstream().dirty()}function A(){this.agent&&this.agent.dirty()}function k(e){return e.plan&&e.plan(e.model,e.ecModel,e.api,e.payload)}function I(e){e.useClearVisual&&e.data.clearAllVisual();var t=e.resetDefines=m(e.reset(e.model,e.ecModel,e.api,e.payload));return t.length>1?a(t,function(e,t){return R(t)}):C}var C=R(0);function R(e){return function(t,n){var i=n.data,r=n.resetDefines[e];if(r&&r.dataEach)for(var a=t.start;a<t.end;a++)r.dataEach(i,a);else r&&r.progress&&r.progress(t,i)}}function M(e){return e.data.count()}function D(e,t,n){var i=t.uid,r=e._pipelineMap.get(i);!r.head&&(r.head=n),r.tail&&r.tail.pipe(n),r.tail=n,n.__idxInPipeline=r.count++,n.__pipeline=r}function L(e){P=null;try{e(O,N)}catch(e){}return P}v.wrapStageHandler=function(e,t){return s(e)&&(e={overallReset:e,seriesType:L(e)}),e.uid=h("stageHandler"),t&&(e.visualType=t),e};var P,O={},N={};function U(e,t){for(var n in t.prototype)e[n]=l}U(O,f),U(N,p),O.eachSeriesByType=O.eachRawSeriesByType=function(e){P=e},O.eachComponent=function(e){"series"===e.mainType&&e.subType&&(P=e.subType)};var F=v;e.exports=F},"6a99":function(e,t,n){var i=n("d3f4");e.exports=function(e,t){if(!i(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!i(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},"6b54":function(e,t,n){"use strict";n("3846");var i=n("cb7c"),r=n("0bfb"),a=n("9e1e"),s="toString",o=/./[s],l=function(e){n("2aba")(RegExp.prototype,s,e,!0)};n("79e5")(function(){return"/a/b"!=o.call({source:"a",flags:"b"})})?l(function(){var e=i(this);return"/".concat(e.source,"/","flags"in e?e.flags:!a&&e instanceof RegExp?r.call(e):void 0)}):o.name!=s&&l(function(){return o.call(this)})},"6cb7":function(e,t,n){var i=n("6d8b"),r=n("4319"),a=n("8918"),s=n("625e"),o=s.enableClassManagement,l=s.parseClassType,u=n("e0d3"),c=u.makeInner,d=n("f934"),h=n("de1c"),f=c(),p=r.extend({type:"component",id:"",name:"",mainType:"",subType:"",componentIndex:0,defaultOption:null,ecModel:null,dependentModels:[],uid:null,layoutMode:null,$constructor:function(e,t,n,i){r.call(this,e,t,n,i),this.uid=a.getUID("ec_cpt_model")},init:function(e,t,n,i){this.mergeDefaultAndTheme(e,n)},mergeDefaultAndTheme:function(e,t){var n=this.layoutMode,r=n?d.getLayoutParams(e):{},a=t.getTheme();i.merge(e,a.get(this.mainType)),i.merge(e,this.getDefaultOption()),n&&d.mergeLayoutParam(e,r,n)},mergeOption:function(e,t){i.merge(this.option,e,!0);var n=this.layoutMode;n&&d.mergeLayoutParam(this.option,e,n)},optionUpdated:function(e,t){},getDefaultOption:function(){var e=f(this);if(!e.defaultOption){var t=[],n=this.constructor;while(n){var r=n.prototype.defaultOption;r&&t.push(r),n=n.superClass}for(var a={},s=t.length-1;s>=0;s--)a=i.merge(a,t[s],!0);e.defaultOption=a}return e.defaultOption},getReferringComponents:function(e){return this.ecModel.queryComponents({mainType:e,index:this.get(e+"Index",!0),id:this.get(e+"Id",!0)})}});function g(e){var t=[];return i.each(p.getClassesByMainType(e),function(e){t=t.concat(e.prototype.dependencies||[])}),t=i.map(t,function(e){return l(e).main}),"dataset"!==e&&i.indexOf(t,"dataset")<=0&&t.unshift("dataset"),t}o(p,{registerWhenExtend:!0}),a.enableSubTypeDefaulter(p),a.enableTopologicalTravel(p,g),i.mixin(p,h);var m=p;e.exports=m},"6d8b":function(e,t){var n={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},i={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},r=Object.prototype.toString,a=Array.prototype,s=a.forEach,o=a.filter,l=a.slice,u=a.map,c=a.reduce,d={};function h(e,t){"createCanvas"===e&&(y=null),d[e]=t}function f(e){if(null==e||"object"!=typeof e)return e;var t=e,a=r.call(e);if("[object Array]"===a){if(!Y(e)){t=[];for(var s=0,o=e.length;s<o;s++)t[s]=f(e[s])}}else if(i[a]){if(!Y(e)){var l=e.constructor;if(e.constructor.from)t=l.from(e);else{t=new l(e.length);for(s=0,o=e.length;s<o;s++)t[s]=f(e[s])}}}else if(!n[a]&&!Y(e)&&!F(e))for(var u in t={},e)e.hasOwnProperty(u)&&(t[u]=f(e[u]));return t}function p(e,t,n){if(!O(t)||!O(e))return n?f(t):e;for(var i in t)if(t.hasOwnProperty(i)){var r=e[i],a=t[i];!O(a)||!O(r)||D(a)||D(r)||F(a)||F(r)||N(a)||N(r)||Y(a)||Y(r)?!n&&i in e||(e[i]=f(t[i],!0)):p(r,a,n)}return e}function g(e,t){for(var n=e[0],i=1,r=e.length;i<r;i++)n=p(n,e[i],t);return n}function m(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function v(e,t,n){for(var i in t)t.hasOwnProperty(i)&&(n?null!=t[i]:null==e[i])&&(e[i]=t[i]);return e}var y,b=function(){return d.createCanvas()};function S(){return y||(y=b().getContext("2d")),y}function T(e,t){if(e){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n}return-1}function _(e,t){var n=e.prototype;function i(){}for(var r in i.prototype=t.prototype,e.prototype=new i,n)e.prototype[r]=n[r];e.prototype.constructor=e,e.superClass=t}function w(e,t,n){e="prototype"in e?e.prototype:e,t="prototype"in t?t.prototype:t,v(e,t,n)}function E(e){if(e)return"string"!=typeof e&&"number"==typeof e.length}function x(e,t,n){if(e&&t)if(e.forEach&&e.forEach===s)e.forEach(t,n);else if(e.length===+e.length)for(var i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e);else for(var a in e)e.hasOwnProperty(a)&&t.call(n,e[a],a,e)}function A(e,t,n){if(e&&t){if(e.map&&e.map===u)return e.map(t,n);for(var i=[],r=0,a=e.length;r<a;r++)i.push(t.call(n,e[r],r,e));return i}}function k(e,t,n,i){if(e&&t){if(e.reduce&&e.reduce===c)return e.reduce(t,n,i);for(var r=0,a=e.length;r<a;r++)n=t.call(i,n,e[r],r,e);return n}}function I(e,t,n){if(e&&t){if(e.filter&&e.filter===o)return e.filter(t,n);for(var i=[],r=0,a=e.length;r<a;r++)t.call(n,e[r],r,e)&&i.push(e[r]);return i}}function C(e,t,n){if(e&&t)for(var i=0,r=e.length;i<r;i++)if(t.call(n,e[i],i,e))return e[i]}function R(e,t){var n=l.call(arguments,2);return function(){return e.apply(t,n.concat(l.call(arguments)))}}function M(e){var t=l.call(arguments,1);return function(){return e.apply(this,t.concat(l.call(arguments)))}}function D(e){return"[object Array]"===r.call(e)}function L(e){return"function"===typeof e}function P(e){return"[object String]"===r.call(e)}function O(e){var t=typeof e;return"function"===t||!!e&&"object"==t}function N(e){return!!n[r.call(e)]}function U(e){return!!i[r.call(e)]}function F(e){return"object"===typeof e&&"number"===typeof e.nodeType&&"object"===typeof e.ownerDocument}function B(e){return e!==e}function V(e){for(var t=0,n=arguments.length;t<n;t++)if(null!=arguments[t])return arguments[t]}function j(e,t){return null!=e?e:t}function G(e,t,n){return null!=e?e:null!=t?t:n}function H(){return Function.call.apply(l,arguments)}function z(e){if("number"===typeof e)return[e,e,e,e];var t=e.length;return 2===t?[e[0],e[1],e[0],e[1]]:3===t?[e[0],e[1],e[2],e[1]]:e}function K(e,t){if(!e)throw new Error(t)}function $(e){return null==e?null:"function"===typeof e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}d.createCanvas=function(){return document.createElement("canvas")};var W="__ec_primitive__";function q(e){e[W]=!0}function Y(e){return e[W]}function X(e){var t=D(e),n=this;function i(e,i){t?n.set(e,i):n.set(i,e)}e instanceof X?e.each(i):e&&x(e,i)}function Q(e){return new X(e)}function Z(e,t){for(var n=new e.constructor(e.length+t.length),i=0;i<e.length;i++)n[i]=e[i];var r=e.length;for(i=0;i<t.length;i++)n[i+r]=t[i];return n}function J(){}X.prototype={constructor:X,get:function(e){return this.hasOwnProperty(e)?this[e]:null},set:function(e,t){return this[e]=t},each:function(e,t){for(var n in void 0!==t&&(e=R(e,t)),this)this.hasOwnProperty(n)&&e(this[n],n)},removeKey:function(e){delete this[e]}},t.$override=h,t.clone=f,t.merge=p,t.mergeAll=g,t.extend=m,t.defaults=v,t.createCanvas=b,t.getContext=S,t.indexOf=T,t.inherits=_,t.mixin=w,t.isArrayLike=E,t.each=x,t.map=A,t.reduce=k,t.filter=I,t.find=C,t.bind=R,t.curry=M,t.isArray=D,t.isFunction=L,t.isString=P,t.isObject=O,t.isBuiltInObject=N,t.isTypedArray=U,t.isDom=F,t.eqNaN=B,t.retrieve=V,t.retrieve2=j,t.retrieve3=G,t.slice=H,t.normalizeCssArray=z,t.assert=K,t.trim=$,t.setAsPrimitive=q,t.isPrimitive=Y,t.createHashMap=Q,t.concatArray=Z,t.noop=J},"6fda":function(e,t,n){var i=n("6d8b"),r=i.each,a="\0_ec_hist_store";function s(e,t){var n=c(e);r(t,function(t,i){for(var r=n.length-1;r>=0;r--){var a=n[r];if(a[i])break}if(r<0){var s=e.queryComponents({mainType:"dataZoom",subType:"select",id:i})[0];if(s){var o=s.getPercentRange();n[0][i]={dataZoomId:i,start:o[0],end:o[1]}}}}),n.push(t)}function o(e){var t=c(e),n=t[t.length-1];t.length>1&&t.pop();var i={};return r(n,function(e,n){for(var r=t.length-1;r>=0;r--){e=t[r][n];if(e){i[n]=e;break}}}),i}function l(e){e[a]=null}function u(e){return c(e).length}function c(e){var t=e[a];return t||(t=e[a]=[{}]),t}t.push=s,t.pop=o,t.clear=l,t.count=u},"71ad":function(e,t,n){var i=n("6d8b"),r={show:!0,zlevel:0,z:0,inverse:!1,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:!1,triggerEvent:!1,tooltip:{show:!1},axisPointer:{},axisLine:{show:!0,onZero:!0,onZeroAxisIndex:null,lineStyle:{color:"#333",width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15]},axisTick:{show:!0,inside:!1,length:5,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12},splitLine:{show:!0,lineStyle:{color:["#ccc"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}}},a={};a.categoryAxis=i.merge({boundaryGap:!0,deduplication:null,splitLine:{show:!1},axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"}},r),a.valueAxis=i.merge({boundaryGap:[0,0],splitNumber:5},r),a.timeAxis=i.defaults({scale:!0,min:"dataMin",max:"dataMax"},a.valueAxis),a.logAxis=i.defaults({scale:!0,logBase:10},a.valueAxis);var s=a;e.exports=s},"74cb":function(e,t){var n={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quarticIn:function(e){return e*e*e*e},quarticOut:function(e){return 1- --e*e*e*e},quarticInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quinticIn:function(e){return e*e*e*e*e},quinticOut:function(e){return--e*e*e*e*e+1},quinticInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},sinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},sinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},exponentialIn:function(e){return 0===e?0:Math.pow(1024,e-1)},exponentialOut:function(e){return 1===e?1:1-Math.pow(2,-10*e)},exponentialInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circularIn:function(e){return 1-Math.sqrt(1-e*e)},circularOut:function(e){return Math.sqrt(1- --e*e)},circularInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:function(e){var t,n=.1,i=.4;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=i/4):t=i*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i))},elasticOut:function(e){var t,n=.1,i=.4;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=i/4):t=i*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/i)+1)},elasticInOut:function(e){var t,n=.1,i=.4;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=i/4):t=i*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i)*.5+1)},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:function(e){return 1-n.bounceOut(1-e)},bounceOut:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bounceInOut:function(e){return e<.5?.5*n.bounceIn(2*e):.5*n.bounceOut(2*e-1)+.5}},i=n;e.exports=i},"767c":function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("607d"),s=n("29a8"),o=n("2145"),l=s.toolbox.dataView,u=new Array(60).join("-"),c="\t";function d(e){var t={},n=[],i=[];return e.eachRawSeries(function(e){var r=e.coordinateSystem;if(!r||"cartesian2d"!==r.type&&"polar"!==r.type)n.push(e);else{var a=r.getBaseAxis();if("category"===a.type){var s=a.dim+"_"+a.index;t[s]||(t[s]={categoryAxis:a,valueAxis:r.getOtherAxis(a),series:[]},i.push({axisDim:a.dim,axisIndex:a.index})),t[s].series.push(e)}else n.push(e)}}),{seriesGroupByCategoryAxis:t,other:n,meta:i}}function h(e){var t=[];return r.each(e,function(e,n){var i=e.categoryAxis,a=e.valueAxis,s=a.dim,o=[" "].concat(r.map(e.series,function(e){return e.name})),l=[i.model.getCategories()];r.each(e.series,function(e){l.push(e.getRawData().mapArray(s,function(e){return e}))});for(var u=[o.join(c)],d=0;d<l[0].length;d++){for(var h=[],f=0;f<l.length;f++)h.push(l[f][d]);u.push(h.join(c))}t.push(u.join("\n"))}),t.join("\n\n"+u+"\n\n")}function f(e){return r.map(e,function(e){var t=e.getRawData(),n=[e.name],i=[];return t.each(t.dimensions,function(){for(var e=arguments.length,r=arguments[e-1],a=t.getName(r),s=0;s<e-1;s++)i[s]=arguments[s];n.push((a?a+c:"")+i.join(c))}),n.join("\n")}).join("\n\n"+u+"\n\n")}function p(e){var t=d(e);return{value:r.filter([h(t.seriesGroupByCategoryAxis),f(t.other)],function(e){return e.replace(/[\n\t\s]/g,"")}).join("\n\n"+u+"\n\n"),meta:t.meta}}function g(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function m(e){var t=e.slice(0,e.indexOf("\n"));if(t.indexOf(c)>=0)return!0}var v=new RegExp("["+c+"]+","g");function y(e){for(var t=e.split(/\n+/g),n=g(t.shift()).split(v),i=[],a=r.map(n,function(e){return{name:e,data:[]}}),s=0;s<t.length;s++){var o=g(t[s]).split(v);i.push(o.shift());for(var l=0;l<o.length;l++)a[l]&&(a[l].data[s]=o[l])}return{series:a,categories:i}}function b(e){for(var t=e.split(/\n+/g),n=g(t.shift()),i=[],r=0;r<t.length;r++){var a,s=g(t[r]).split(v),o="",l=!1;isNaN(s[0])?(l=!0,o=s[0],s=s.slice(1),i[r]={name:o,value:[]},a=i[r].value):a=i[r]=[];for(var u=0;u<s.length;u++)a.push(+s[u]);1===a.length&&(l?i[r].value=a[0]:i[r]=a[0])}return{name:n,data:i}}function S(e,t){var n=e.split(new RegExp("\n*"+u+"\n*","g")),i={series:[]};return r.each(n,function(e,n){if(m(e)){var r=y(e),a=t[n],s=a.axisDim+"Axis";a&&(i[s]=i[s]||[],i[s][a.axisIndex]={data:r.categories},i.series=i.series.concat(r.series))}else{r=b(e);i.series.push(r)}}),i}function T(e){this._dom=null,this.model=e}function _(e,t){return r.map(e,function(e,n){var i=t&&t[n];return r.isObject(i)&&!r.isArray(i)?(r.isObject(e)&&!r.isArray(e)&&(e=e.value),r.defaults({value:e},i)):e})}T.defaultOption={show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:r.clone(l.title),lang:r.clone(l.lang),backgroundColor:"#fff",textColor:"#000",textareaColor:"#fff",textareaBorderColor:"#333",buttonColor:"#c23531",buttonTextColor:"#fff"},T.prototype.onclick=function(e,t){var n=t.getDom(),i=this.model;this._dom&&n.removeChild(this._dom);var s=document.createElement("div");s.style.cssText="position:absolute;left:5px;top:5px;bottom:5px;right:5px;",s.style.backgroundColor=i.get("backgroundColor")||"#fff";var o=document.createElement("h4"),l=i.get("lang")||[];o.innerHTML=l[0]||i.get("title"),o.style.cssText="margin: 10px 20px;",o.style.color=i.get("textColor");var u=document.createElement("div"),d=document.createElement("textarea");u.style.cssText="display:block;width:100%;overflow:auto;";var h=i.get("optionToContent"),f=i.get("contentToOption"),g=p(e);if("function"===typeof h){var m=h(t.getOption());"string"===typeof m?u.innerHTML=m:r.isDom(m)&&u.appendChild(m)}else u.appendChild(d),d.readOnly=i.get("readOnly"),d.style.cssText="width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;",d.style.color=i.get("textColor"),d.style.borderColor=i.get("textareaBorderColor"),d.style.backgroundColor=i.get("textareaColor"),d.value=g.value;var v=g.meta,y=document.createElement("div");y.style.cssText="position:absolute;bottom:0;left:0;right:0;";var b="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px",T=document.createElement("div"),_=document.createElement("div");b+=";background-color:"+i.get("buttonColor"),b+=";color:"+i.get("buttonTextColor");var w=this;function E(){n.removeChild(s),w._dom=null}a.addEventListener(T,"click",E),a.addEventListener(_,"click",function(){var e;try{e="function"===typeof f?f(u,t.getOption()):S(d.value,v)}catch(e){throw E(),new Error("Data view format error "+e)}e&&t.dispatchAction({type:"changeDataView",newOption:e}),E()}),T.innerHTML=l[1],_.innerHTML=l[2],_.style.cssText=b,T.style.cssText=b,!i.get("readOnly")&&y.appendChild(_),y.appendChild(T),a.addEventListener(d,"keydown",function(e){if(9===(e.keyCode||e.which)){var t=this.value,n=this.selectionStart,i=this.selectionEnd;this.value=t.substring(0,n)+c+t.substring(i),this.selectionStart=this.selectionEnd=n+1,a.stop(e)}}),s.appendChild(o),s.appendChild(u),s.appendChild(y),u.style.height=n.clientHeight-80+"px",n.appendChild(s),this._dom=s},T.prototype.remove=function(e,t){this._dom&&t.getDom().removeChild(this._dom)},T.prototype.dispose=function(e,t){this.remove(e,t)},o.register("dataView",T),i.registerAction({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},function(e,t){var n=[];r.each(e.newOption.series,function(e){var i=t.getSeriesByName(e.name)[0];if(i){var a=i.get("data");n.push({name:e.name,data:_(e.data,a)})}else n.push(r.extend({type:"scatter"},e))}),t.mergeOption(r.defaults({series:n},e.newOption))});var w=T;e.exports=w},"76a5":function(e,t,n){var i=n("19eb"),r=n("6d8b"),a=n("e86a"),s=n("a73c"),o=function(e){i.call(this,e)};o.prototype={constructor:o,type:"text",brush:function(e,t){var n=this.style;this.__dirty&&s.normalizeTextStyle(n,!0),n.fill=n.stroke=n.shadowBlur=n.shadowColor=n.shadowOffsetX=n.shadowOffsetY=null;var i=n.text;null!=i&&(i+=""),n.bind(e,this,t),s.needDrawText(i,n)&&(this.setTransform(e),s.renderText(this,e,i,n),this.restoreTransform(e))},getBoundingRect:function(){var e=this.style;if(this.__dirty&&s.normalizeTextStyle(e,!0),!this._rect){var t=e.text;null!=t?t+="":t="";var n=a.getBoundingRect(e.text+"",e.font,e.textAlign,e.textVerticalAlign,e.textPadding,e.rich);if(n.x+=e.x||0,n.y+=e.y||0,s.getStroke(e.textStroke,e.textStrokeWidth)){var i=e.textStrokeWidth;n.x-=i/2,n.y-=i/2,n.width+=i,n.height+=i}this._rect=n}return this._rect}},r.inherits(o,i);var l=o;e.exports=l},7726:function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},"77f1":function(e,t,n){var i=n("4588"),r=Math.max,a=Math.min;e.exports=function(e,t){return e=i(e),e<0?r(e+t,0):a(e,t)}},7919:function(e,t,n){var i=n("f934"),r=i.getLayoutRect,a=i.box,s=i.positionElement,o=n("eda2"),l=n("2306");function u(e,t,n){var i=t.getBoxLayoutParams(),o=t.get("padding"),l={width:n.getWidth(),height:n.getHeight()},u=r(i,l,o);a(t.get("orient"),e,t.get("itemGap"),u.width,u.height),s(e,i,l,o)}function c(e,t){var n=o.normalizeCssArray(t.get("padding")),i=t.getItemStyle(["color","opacity"]);i.fill=t.get("backgroundColor");e=new l.Rect({shape:{x:e.x-n[3],y:e.y-n[0],width:e.width+n[1]+n[3],height:e.height+n[0]+n[2],r:t.get("borderRadius")},style:i,silent:!0,z2:-1});return e}t.layout=u,t.makeBackground=c},"79e5":function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},"7a56":function(e,t,n){"use strict";var i=n("7726"),r=n("86cc"),a=n("9e1e"),s=n("2b4c")("species");e.exports=function(e){var t=i[e];a&&t&&!t[s]&&r.f(t,s,{configurable:!0,get:function(){return this}})}},"7c4d":function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("fc82"),s=n("bd9e"),o=n("6fda"),l=n("ef6a"),u=n("29a8"),c=n("2145");n("dd39");var d=u.toolbox.dataZoom,h=r.each,f="\0_ec_\0toolbox-dataZoom_";function p(e,t,n){(this._brushController=new a(n.getZr())).on("brush",r.bind(this._onBrush,this)).mount(),this._isZoomActive}p.defaultOption={show:!0,icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:r.clone(d.title)};var g=p.prototype;g.render=function(e,t,n,i){this.model=e,this.ecModel=t,this.api=n,b(e,t,this,i,n),y(e,t)},g.onclick=function(e,t,n){m[n].call(this)},g.remove=function(e,t){this._brushController.unmount()},g.dispose=function(e,t){this._brushController.dispose()};var m={zoom:function(){var e=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:e})},back:function(){this._dispatchZoomAction(o.pop(this.ecModel))}};function v(e){var t={};return r.each(["xAxisIndex","yAxisIndex"],function(n){t[n]=e[n],null==t[n]&&(t[n]="all"),(!1===t[n]||"none"===t[n])&&(t[n]=[])}),t}function y(e,t){e.setIconStatus("back",o.count(t)>1?"emphasis":"normal")}function b(e,t,n,i,r){var a=n._isZoomActive;i&&"takeGlobalCursor"===i.type&&(a="dataZoomSelect"===i.key&&i.dataZoomSelectActive),n._isZoomActive=a,e.setIconStatus("zoom",a?"emphasis":"normal");var o=new s(v(e.option),t,{include:["grid"]});n._brushController.setPanels(o.makePanelOpts(r,function(e){return e.xAxisDeclared&&!e.yAxisDeclared?"lineX":!e.xAxisDeclared&&e.yAxisDeclared?"lineY":"rect"})).enableBrush(!!a&&{brushType:"auto",brushStyle:{lineWidth:0,fill:"rgba(0,0,0,0.2)"}})}g._onBrush=function(e,t){if(t.isEnd&&e.length){var n={},i=this.ecModel;this._brushController.updateCovers([]);var r=new s(v(this.model.option),i,{include:["grid"]});r.matchOutputRanges(e,i,function(e,t,n){if("cartesian2d"===n.type){var i=e.brushType;"rect"===i?(a("x",n,t[0]),a("y",n,t[1])):a({lineX:"x",lineY:"y"}[i],n,t)}}),o.push(i,n),this._dispatchZoomAction(n)}function a(e,t,r){var a=t.getAxis(e),s=a.model,o=u(e,s,i),c=o.findRepresentativeAxisProxy(s).getMinMaxSpan();null==c.minValueSpan&&null==c.maxValueSpan||(r=l(0,r.slice(),a.scale.getExtent(),0,c.minValueSpan,c.maxValueSpan)),o&&(n[o.id]={dataZoomId:o.id,startValue:r[0],endValue:r[1]})}function u(e,t,n){var i;return n.eachComponent({mainType:"dataZoom",subType:"select"},function(n){var r=n.getAxisModel(e,t.componentIndex);r&&(i=n)}),i}},g._dispatchZoomAction=function(e){var t=[];h(e,function(e,n){t.push(r.clone(e))}),t.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:t})},c.register("dataZoom",p),i.registerPreprocessor(function(e){if(e){var t=e.dataZoom||(e.dataZoom=[]);r.isArray(t)||(e.dataZoom=t=[t]);var n=e.toolbox;if(n&&(r.isArray(n)&&(n=n[0]),n&&n.feature)){var i=n.feature.dataZoom;a("xAxis",i),a("yAxis",i)}}function a(e,n){if(n){var i=e+"Index",a=n[i];null==a||"all"==a||r.isArray(a)||(a=!1===a||"none"===a?[]:[a]),s(e,function(n,s){if(null==a||"all"==a||-1!==r.indexOf(a,s)){var o={type:"select",$fromToolbox:!0,id:f+e+s};o[i]=s,t.push(o)}})}}function s(t,n){var i=e[t];r.isArray(i)||(i=i?[i]:[]),h(i,n)}});var S=p;e.exports=S},"7d6d":function(e,t){var n={shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1,textShadowBlur:1,textShadowOffsetX:1,textShadowOffsetY:1,textBoxShadowBlur:1,textBoxShadowOffsetX:1,textBoxShadowOffsetY:1};function i(e,t,i){return n.hasOwnProperty(t)?i*e.dpr:i}e.exports=i},"7dcf":function(e,t,n){var i=n("b12f"),r=i.extend({type:"dataZoom",render:function(e,t,n,i){this.dataZoomModel=e,this.ecModel=t,this.api=n},getTargetCoordInfo:function(){var e=this.dataZoomModel,t=this.ecModel,n={};function i(e,t,n,i){for(var r,a=0;a<n.length;a++)if(n[a].model===e){r=n[a];break}r||n.push(r={model:e,axisModels:[],coordIndex:i}),r.axisModels.push(t)}return e.eachTargetAxis(function(e,r){var a=t.getComponent(e.axis,r);if(a){var s=a.getCoordSysModel();s&&i(s,a,n[s.mainType]||(n[s.mainType]=[]),s.componentIndex)}},this),n}});e.exports=r},"7e63":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=r.each,s=r.filter,o=r.map,l=r.isArray,u=r.indexOf,c=r.isObject,d=r.isString,h=r.createHashMap,f=r.assert,p=r.clone,g=r.merge,m=r.extend,v=r.mixin,y=n("e0d3"),b=n("4319"),S=n("6cb7"),T=n("8971"),_=n("e47b"),w=n("0f99"),E=w.resetSourceDefaulter,x="\0_ec_inner",A=b.extend({init:function(e,t,n,i){n=n||{},this.option=null,this._theme=new b(n),this._optionManager=i},setOption:function(e,t){f(!(x in e),"please use chart.getOption()"),this._optionManager.setOption(e,t),this.resetOption(null)},resetOption:function(e){var t=!1,n=this._optionManager;if(!e||"recreate"===e){var i=n.mountOption("recreate"===e);this.option&&"recreate"!==e?(this.restoreData(),this.mergeOption(i)):C.call(this,i),t=!0}if("timeline"!==e&&"media"!==e||this.restoreData(),!e||"recreate"===e||"timeline"===e){var r=n.getTimelineOption(this);r&&(this.mergeOption(r),t=!0)}if(!e||"recreate"===e||"media"===e){var s=n.getMediaOption(this,this._api);s.length&&a(s,function(e){this.mergeOption(e,t=!0)},this)}return t},mergeOption:function(e){var t=this.option,n=this._componentsMap,i=[];function r(i,r){var s=y.normalizeToArray(e[i]),o=y.mappingToExists(n.get(i),s);y.makeIdAndName(o),a(o,function(e,t){var n=e.option;c(n)&&(e.keyInfo.mainType=i,e.keyInfo.subType=M(i,n,e.exist))});var l=R(n,r);t[i]=[],n.set(i,[]),a(o,function(e,r){var a=e.exist,s=e.option;if(f(c(s)||a,"Empty component definition"),s){var o=S.getClass(i,e.keyInfo.subType,!0);if(a&&a instanceof o)a.name=e.keyInfo.name,a.mergeOption(s,this),a.optionUpdated(s,!1);else{var u=m({dependentModels:l,componentIndex:r},e.keyInfo);a=new o(s,this,this,u),m(a,u),a.init(s,this,this,u),a.optionUpdated(null,!0)}}else a.mergeOption({},this),a.optionUpdated({},!1);n.get(i)[r]=a,t[i][r]=a.option},this),"series"===i&&D(this,n.get("series"))}E(this),a(e,function(e,n){null!=e&&(S.hasClass(n)?n&&i.push(n):t[n]=null==t[n]?p(e):g(t[n],e,!0))}),S.topologicalTravel(i,S.getAllClassMainTypes(),r,this),this._seriesIndicesMap=h(this._seriesIndices=this._seriesIndices||[])},getOption:function(){var e=p(this.option);return a(e,function(t,n){if(S.hasClass(n)){t=y.normalizeToArray(t);for(var i=t.length-1;i>=0;i--)y.isIdInner(t[i])&&t.splice(i,1);e[n]=t}}),delete e[x],e},getTheme:function(){return this._theme},getComponent:function(e,t){var n=this._componentsMap.get(e);if(n)return n[t||0]},queryComponents:function(e){var t=e.mainType;if(!t)return[];var n,i=e.index,r=e.id,a=e.name,c=this._componentsMap.get(t);if(!c||!c.length)return[];if(null!=i)l(i)||(i=[i]),n=s(o(i,function(e){return c[e]}),function(e){return!!e});else if(null!=r){var d=l(r);n=s(c,function(e){return d&&u(r,e.id)>=0||!d&&e.id===r})}else if(null!=a){var h=l(a);n=s(c,function(e){return h&&u(a,e.name)>=0||!h&&e.name===a})}else n=c.slice();return L(n,e)},findComponents:function(e){var t=e.query,n=e.mainType,i=a(t),r=i?this.queryComponents(i):this._componentsMap.get(n);return o(L(r,e));function a(e){var t=n+"Index",i=n+"Id",r=n+"Name";return!e||null==e[t]&&null==e[i]&&null==e[r]?null:{mainType:n,index:e[t],id:e[i],name:e[r]}}function o(t){return e.filter?s(t,e.filter):t}},eachComponent:function(e,t,n){var i=this._componentsMap;if("function"===typeof e)n=t,t=e,i.each(function(e,i){a(e,function(e,r){t.call(n,i,e,r)})});else if(d(e))a(i.get(e),t,n);else if(c(e)){var r=this.findComponents(e);a(r,t,n)}},getSeriesByName:function(e){var t=this._componentsMap.get("series");return s(t,function(t){return t.name===e})},getSeriesByIndex:function(e){return this._componentsMap.get("series")[e]},getSeriesByType:function(e){var t=this._componentsMap.get("series");return s(t,function(t){return t.subType===e})},getSeries:function(){return this._componentsMap.get("series").slice()},getSeriesCount:function(){return this._componentsMap.get("series").length},eachSeries:function(e,t){P(this),a(this._seriesIndices,function(n){var i=this._componentsMap.get("series")[n];e.call(t,i,n)},this)},eachRawSeries:function(e,t){a(this._componentsMap.get("series"),e,t)},eachSeriesByType:function(e,t,n){P(this),a(this._seriesIndices,function(i){var r=this._componentsMap.get("series")[i];r.subType===e&&t.call(n,r,i)},this)},eachRawSeriesByType:function(e,t,n){return a(this.getSeriesByType(e),t,n)},isSeriesFiltered:function(e){return P(this),null==this._seriesIndicesMap.get(e.componentIndex)},getCurrentSeriesIndices:function(){return(this._seriesIndices||[]).slice()},filterSeries:function(e,t){P(this);var n=s(this._componentsMap.get("series"),e,t);D(this,n)},restoreData:function(e){var t=this._componentsMap;D(this,t.get("series"));var n=[];t.each(function(e,t){n.push(t)}),S.topologicalTravel(n,S.getAllClassMainTypes(),function(n,i){a(t.get(n),function(t){("series"!==n||!k(t,e))&&t.restoreData()})})}});function k(e,t){if(t){var n=t.seiresIndex,i=t.seriesId,r=t.seriesName;return null!=n&&e.componentIndex!==n||null!=i&&e.id!==i||null!=r&&e.name!==r}}function I(e,t){var n=e.color&&!e.colorLayer;a(t,function(t,i){"colorLayer"===i&&n||S.hasClass(i)||("object"===typeof t?e[i]=e[i]?g(e[i],t,!1):p(t):null==e[i]&&(e[i]=t))})}function C(e){e=e,this.option={},this.option[x]=1,this._componentsMap=h({series:[]}),this._seriesIndices,this._seriesIndicesMap,I(e,this._theme.option),g(e,T,!1),this.mergeOption(e)}function R(e,t){l(t)||(t=t?[t]:[]);var n={};return a(t,function(t){n[t]=(e.get(t)||[]).slice()}),n}function M(e,t,n){var i=t.type?t.type:n?n.subType:S.determineSubType(e,t);return i}function D(e,t){e._seriesIndicesMap=h(e._seriesIndices=o(t,function(e){return e.componentIndex})||[])}function L(e,t){return t.hasOwnProperty("subType")?s(e,function(e){return e.subType===t.subType}):e}function P(e){}v(A,_);var O=A;e.exports=O},"7f20":function(e,t,n){var i=n("86cc").f,r=n("69a8"),a=n("2b4c")("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,a)&&i(e,a,{configurable:!0,value:t})}},"7f96":function(e,t){function n(e,t,n){return{seriesType:e,performRawSeries:!0,reset:function(e,i,r){var a=e.getData(),s=e.get("symbol")||t,o=e.get("symbolSize"),l=e.get("symbolKeepAspect");if(a.setVisual({legendSymbol:n||s,symbol:s,symbolSize:o,symbolKeepAspect:l}),!i.isSeriesFiltered(e)){var u="function"===typeof o;return{dataEach:a.hasItemOption||u?c:null}}function c(t,n){if("function"===typeof o){var i=e.getRawValue(n),r=e.getDataParams(n);t.setItemVisual(n,"symbolSize",o(i,r))}if(t.hasItemOption){var a=t.getItemModel(n),s=a.getShallow("symbol",!0),l=a.getShallow("symbolSize",!0),u=a.getShallow("symbolKeepAspect",!0);null!=s&&t.setItemVisual(n,"symbol",s),null!=l&&t.setItemVisual(n,"symbolSize",l),null!=u&&t.setItemVisual(n,"symbolKeepAspect",u)}}}}}e.exports=n},8079:function(e,t,n){var i=n("7726"),r=n("1991").set,a=i.MutationObserver||i.WebKitMutationObserver,s=i.process,o=i.Promise,l="process"==n("2d95")(s);e.exports=function(){var e,t,n,u=function(){var i,r;l&&(i=s.domain)&&i.exit();while(e){r=e.fn,e=e.next;try{r()}catch(i){throw e?n():t=void 0,i}}t=void 0,i&&i.enter()};if(l)n=function(){s.nextTick(u)};else if(!a||i.navigator&&i.navigator.standalone)if(o&&o.resolve){var c=o.resolve(void 0);n=function(){c.then(u)}}else n=function(){r.call(i,u)};else{var d=!0,h=document.createTextNode("");new a(u).observe(h,{characterData:!0}),n=function(){h.data=d=!d}}return function(i){var r={fn:i,next:void 0};t&&(t.next=r),e||(e=r,n()),t=r}}},"80f0":function(e,t){function n(e){return e}function i(e,t,i,r,a){this._old=e,this._new=t,this._oldKeyGetter=i||n,this._newKeyGetter=r||n,this.context=a}function r(e,t,n,i,r){for(var a=0;a<e.length;a++){var s="_ec_"+r[i](e[a],a),o=t[s];null==o?(n.push(s),t[s]=a):(o.length||(t[s]=o=[o]),o.push(a))}}i.prototype={constructor:i,add:function(e){return this._add=e,this},update:function(e){return this._update=e,this},remove:function(e){return this._remove=e,this},execute:function(){var e=this._old,t=this._new,n={},i={},a=[],s=[];for(r(e,n,a,"_oldKeyGetter",this),r(t,i,s,"_newKeyGetter",this),c=0;c<e.length;c++){var o=a[c],l=i[o];if(null!=l){var u=l.length;u?(1===u&&(i[o]=null),l=l.unshift()):i[o]=null,this._update&&this._update(l,c)}else this._remove&&this._remove(c)}for(var c=0;c<s.length;c++){o=s[c];if(i.hasOwnProperty(o)){l=i[o];if(null==l)continue;if(l.length){var d=0;for(u=l.length;d<u;d++)this._add&&this._add(l[d])}else this._add&&this._add(l)}}}};var a=i;e.exports=a},8378:function(e,t){var n=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)},"843e":function(e,t,n){var i=n("6d8b"),r=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isDisposed","on","off","getDataURL","getConnectedDataURL","getModel","getOption","getViewOfComponentModel","getViewOfSeriesModel"];function a(e){i.each(r,function(t){this[t]=i.bind(e[t],e)},this)}var s=a;e.exports=s},"84ce":function(e,t,n){var i=n("6d8b"),r=i.each,a=i.map,s=n("3842"),o=s.linearMap,l=s.getPixelPrecision,u=n("e073"),c=u.createAxisTicks,d=u.createAxisLabels,h=u.calculateCategoryInterval,f=[0,1],p=function(e,t,n){this.dim=e,this.scale=t,this._extent=n||[0,0],this.inverse=!1,this.onBand=!1};function g(e,t){var n=e[1]-e[0],i=t,r=n/i/2;e[0]+=r,e[1]-=r}function m(e,t,n,i,a){var s=t.length;if(e.onBand&&!i&&s){var o,l=e.getExtent();if(1===s)t[0].coord=l[0],o=t[1]={coord:l[0]};else{var u=t[1].coord-t[0].coord;r(t,function(e){e.coord-=u/2;var t=t||0;t%2>0&&(e.coord-=u/(2*(t+1)))}),o={coord:t[s-1].coord+u},t.push(o)}var c=l[0]>l[1];d(t[0].coord,l[0])&&(a?t[0].coord=l[0]:t.shift()),a&&d(l[0],t[0].coord)&&t.unshift({coord:l[0]}),d(l[1],o.coord)&&(a?o.coord=l[1]:t.pop()),a&&d(o.coord,l[1])&&t.push({coord:l[1]})}function d(e,t){return c?e>t:e<t}}p.prototype={constructor:p,contain:function(e){var t=this._extent,n=Math.min(t[0],t[1]),i=Math.max(t[0],t[1]);return e>=n&&e<=i},containData:function(e){return this.contain(this.dataToCoord(e))},getExtent:function(){return this._extent.slice()},getPixelPrecision:function(e){return l(e||this.scale.getExtent(),this._extent)},setExtent:function(e,t){var n=this._extent;n[0]=e,n[1]=t},dataToCoord:function(e,t){var n=this._extent,i=this.scale;return e=i.normalize(e),this.onBand&&"ordinal"===i.type&&(n=n.slice(),g(n,i.count())),o(e,f,n,t)},coordToData:function(e,t){var n=this._extent,i=this.scale;this.onBand&&"ordinal"===i.type&&(n=n.slice(),g(n,i.count()));var r=o(e,n,f,t);return this.scale.scale(r)},pointToData:function(e,t){},getTicksCoords:function(e){e=e||{};var t=e.tickModel||this.getTickModel(),n=c(this,t),i=n.ticks,r=a(i,function(e){return{coord:this.dataToCoord(e),tickValue:e}},this),s=t.get("alignWithLabel");return m(this,r,n.tickCategoryInterval,s,e.clamp),r},getViewLabels:function(){return d(this).labels},getLabelModel:function(){return this.model.getModel("axisLabel")},getTickModel:function(){return this.model.getModel("axisTick")},getBandWidth:function(){var e=this._extent,t=this.scale.getExtent(),n=t[1]-t[0]+(this.onBand?1:0);0===n&&(n=1);var i=Math.abs(e[1]-e[0]);return Math.abs(i)/n},isHorizontal:null,getRotate:null,calculateCategoryInterval:function(){return h(this)}};var v=p;e.exports=v},"84d5":function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("4319"),s=n("e0d3"),o=s.isNameSpecified,l=i.extendComponentModel({type:"legend.plain",dependencies:["series"],layoutMode:{type:"box",ignoreSize:!0},init:function(e,t,n){this.mergeDefaultAndTheme(e,n),e.selected=e.selected||{}},mergeOption:function(e){l.superCall(this,"mergeOption",e)},optionUpdated:function(){this._updateData(this.ecModel);var e=this._data;if(e[0]&&"single"===this.get("selectedMode")){for(var t=!1,n=0;n<e.length;n++){var i=e[n].get("name");if(this.isSelected(i)){this.select(i),t=!0;break}}!t&&this.select(e[0].get("name"))}},_updateData:function(e){var t=[],n=[];e.eachRawSeries(function(i){var r,a=i.name;if(n.push(a),i.legendDataProvider){var s=i.legendDataProvider(),l=s.mapArray(s.getName);e.isSeriesFiltered(i)||(n=n.concat(l)),l.length?t=t.concat(l):r=!0}else r=!0;r&&o(i)&&t.push(i.name)}),this._availableNames=n;var i=this.get("data")||t,s=r.map(i,function(e){return"string"!==typeof e&&"number"!==typeof e||(e={name:e}),new a(e,this,this.ecModel)},this);this._data=s},getData:function(){return this._data},select:function(e){var t=this.option.selected,n=this.get("selectedMode");if("single"===n){var i=this._data;r.each(i,function(e){t[e.get("name")]=!1})}t[e]=!0},unSelect:function(e){"single"!==this.get("selectedMode")&&(this.option.selected[e]=!1)},toggleSelected:function(e){var t=this.option.selected;t.hasOwnProperty(e)||(t[e]=!0),this[t[e]?"unSelect":"select"](e)},isSelected:function(e){var t=this.option.selected;return!(t.hasOwnProperty(e)&&!t[e])&&r.indexOf(this._availableNames,e)>=0},defaultOption:{zlevel:0,z:4,show:!0,orient:"horizontal",left:"center",top:0,align:"auto",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemGap:10,itemWidth:25,itemHeight:14,inactiveColor:"#ccc",textStyle:{color:"#333"},selectedMode:!0,tooltip:{show:!1}}}),u=l;e.exports=u},"84f2":function(e,t){e.exports={}},"857d":function(e,t){var n=2*Math.PI;function i(e){return e%=n,e<0&&(e+=n),e}t.normalizeRadian=i},"862d":function(e,t,n){var i=n("6d8b"),r=i.createHashMap,a=i.each,s=i.isString,o=i.defaults,l=i.extend,u=i.isObject,c=i.clone,d=n("e0d3"),h=d.normalizeToArray,f=n("0f99"),p=f.guessOrdinal,g=n("ec6f"),m=n("2f45"),v=m.OTHER_DIMENSIONS;function y(e,t,n){g.isInstance(t)||(t=g.seriesDataToSource(t)),n=n||{},e=(e||[]).slice();for(var i=(n.dimsDef||[]).slice(),d=r(n.encodeDef),f=r(),m=r(),y=[],T=b(t,e,i,n.dimCount),_=0;_<T;_++){var w=i[_]=l({},u(i[_])?i[_]:{name:i[_]}),E=w.name,x=y[_]={otherDims:{}};null!=E&&null==f.get(E)&&(x.name=x.displayName=E,f.set(E,_)),null!=w.type&&(x.type=w.type),null!=w.displayName&&(x.displayName=w.displayName)}d.each(function(e,t){e=h(e).slice();var n=d.set(t,[]);a(e,function(e,i){s(e)&&(e=f.get(e)),null!=e&&e<T&&(n[i]=e,k(y[e],t,i))})});var A=0;function k(e,t,n){null!=v.get(t)?e.otherDims[t]=n:(e.coordDim=t,e.coordDimIndex=n,m.set(t,!0))}a(e,function(e,t){var n,i,r;if(s(e))n=e,e={};else{n=e.name;var l=e.ordinalMeta;e.ordinalMeta=null,e=c(e),e.ordinalMeta=l,i=e.dimsDef,r=e.otherDims,e.name=e.coordDim=e.coordDimIndex=e.dimsDef=e.otherDims=null}var f=h(d.get(n));if(!f.length)for(var p=0;p<(i&&i.length||1);p++){while(A<y.length&&null!=y[A].coordDim)A++;A<y.length&&f.push(A++)}a(f,function(t,a){var s=y[t];if(k(o(s,e),n,a),null==s.name&&i){var l=i[a];!u(l)&&(l={name:l}),s.name=s.displayName=l.name,s.defaultTooltip=l.defaultTooltip}r&&o(s.otherDims,r)})});var I=n.generateCoord,C=n.generateCoordCount,R=null!=C;C=I?C||1:0;for(var M=I||"value",D=0;D<T;D++){x=y[D]=y[D]||{};var L=x.coordDim;null==L&&(x.coordDim=S(M,m,R),x.coordDimIndex=0,(!I||C<=0)&&(x.isExtraCoord=!0),C--),null==x.name&&(x.name=S(x.coordDim,f)),null==x.type&&p(t,D,x.name)&&(x.type="ordinal")}return y}function b(e,t,n,i){var r=Math.max(e.dimensionsDetectCount||1,t.length,n.length,i||0);return a(t,function(e){var t=e.dimsDef;t&&(r=Math.max(r,t.length))}),r}function S(e,t,n){if(n||null!=t.get(e)){var i=0;while(null!=t.get(e+i))i++;e+=i}return t.set(e,!0),e}var T=y;e.exports=T},"86cc":function(e,t,n){var i=n("cb7c"),r=n("c69a"),a=n("6a99"),s=Object.defineProperty;t.f=n("9e1e")?Object.defineProperty:function(e,t,n){if(i(e),t=a(t,!0),i(n),r)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},8728:function(e,t){function n(e,t,n,i,r,a){if(a>t&&a>i||a<t&&a<i)return 0;if(i===t)return 0;var s=i<t?1:-1,o=(a-t)/(i-t);1!==o&&0!==o||(s=i<t?.5:-.5);var l=o*(n-e)+e;return l===r?1/0:l>r?s:0}e.exports=n},"87b1":function(e,t,n){var i=n("cbe5"),r=n("4fac"),a=i.extend({type:"polygon",shape:{points:null,smooth:!1,smoothConstraint:null},buildPath:function(e,t){r.buildPath(e,t,!0)}});e.exports=a},"87c3":function(e,t,n){var i=n("6d8b"),r=i.map,a=n("cccd"),s=n("ee1a"),o=s.isDimensionStacked;function l(e){return{seriesType:e,plan:a(),reset:function(e){var t=e.getData(),n=e.coordinateSystem,i=e.pipelineContext,a=i.large;if(n){var s=r(n.dimensions,function(e){return t.mapDimension(e)}).slice(0,2),l=s.length,u=t.getCalculationInfo("stackResultDimension");return o(t,s[0])&&(s[0]=u),o(t,s[1])&&(s[1]=u),l&&{progress:c}}function c(e,t){for(var i=e.end-e.start,r=a&&new Float32Array(i*l),o=e.start,u=0,c=[],d=[];o<e.end;o++){var h;if(1===l){var f=t.get(s[0],o);h=!isNaN(f)&&n.dataToPoint(f,null,d)}else{f=c[0]=t.get(s[0],o);var p=c[1]=t.get(s[1],o);h=!isNaN(f)&&!isNaN(p)&&n.dataToPoint(c,null,d)}a?(r[u++]=h?h[0]:NaN,r[u++]=h?h[1]:NaN):t.setItemLayout(o,h&&h.slice()||[NaN,NaN])}a&&t.setLayout("symbolPoints",r)}}}}e.exports=l},"88b3":function(e,t){var n="\0__throttleOriginMethod",i="\0__throttleRate",r="\0__throttleType";function a(e,t,n){var i,r,a,s,o,l=0,u=0,c=null;function d(){u=(new Date).getTime(),c=null,e.apply(a,s||[])}t=t||0;var h=function(){i=(new Date).getTime(),a=this,s=arguments;var e=o||t,h=o||n;o=null,r=i-(h?l:u)-e,clearTimeout(c),h?c=setTimeout(d,e):r>=0?d():c=setTimeout(d,-r),l=i};return h.clear=function(){c&&(clearTimeout(c),c=null)},h.debounceNextCall=function(e){o=e},h}function s(e,t,s,o){var l=e[t];if(l){var u=l[n]||l,c=l[r],d=l[i];if(d!==s||c!==o){if(null==s||!o)return e[t]=u;l=e[t]=a(u,s,"debounce"===o),l[n]=u,l[r]=o,l[i]=s}return l}}function o(e,t){var i=e[t];i&&i[n]&&(e[t]=i[n])}t.throttle=a,t.createOrUpdate=s,t.clear=o},8918:function(e,t,n){var i=n("6d8b"),r=n("625e"),a=r.parseClassType,s=0;function o(e){return[e||"",s++,Math.random().toFixed(5)].join("_")}function l(e){var t={};return e.registerSubTypeDefaulter=function(e,n){e=a(e),t[e.main]=n},e.determineSubType=function(n,i){var r=i.type;if(!r){var s=a(n).main;e.hasSubTypes(n)&&t[s]&&(r=t[s](i))}return r},e}function u(e,t){function n(e){var n={},s=[];return i.each(e,function(o){var l=r(n,o),u=l.originalDeps=t(o),c=a(u,e);l.entryCount=c.length,0===l.entryCount&&s.push(o),i.each(c,function(e){i.indexOf(l.predecessor,e)<0&&l.predecessor.push(e);var t=r(n,e);i.indexOf(t.successor,e)<0&&t.successor.push(o)})}),{graph:n,noEntryList:s}}function r(e,t){return e[t]||(e[t]={predecessor:[],successor:[]}),e[t]}function a(e,t){var n=[];return i.each(e,function(e){i.indexOf(t,e)>=0&&n.push(e)}),n}e.topologicalTravel=function(e,t,r,a){if(e.length){var s=n(t),o=s.graph,l=s.noEntryList,u={};i.each(e,function(e){u[e]=!0});while(l.length){var c=l.pop(),d=o[c],h=!!u[c];h&&(r.call(a,c,d.originalDeps.slice()),delete u[c]),i.each(d.successor,h?p:f)}i.each(u,function(){throw new Error("Circle dependency may exists")})}function f(e){o[e].entryCount--,0===o[e].entryCount&&l.push(e)}function p(e){u[e]=!0,f(e)}}}t.getUID=o,t.enableSubTypeDefaulter=l,t.enableTopologicalTravel=u},8971:function(e,t){var n="";"undefined"!==typeof navigator&&(n=navigator.platform||"");var i={color:["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],gradientColor:["#f6efa6","#d88273","#bf444c"],textStyle:{fontFamily:n.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,animation:"auto",animationDuration:1e3,animationDurationUpdate:300,animationEasing:"exponentialOut",animationEasingUpdate:"cubicOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:!1};e.exports=i},"897a":function(e,t,n){var i=n("22d1"),r=[["shadowBlur",0],["shadowColor","#000"],["shadowOffsetX",0],["shadowOffsetY",0]];function a(e){return i.browser.ie&&i.browser.version>=11?function(){var t,n=this.__clipPaths,i=this.style;if(n)for(var a=0;a<n.length;a++){var s=n[a],o=s&&s.shape,l=s&&s.type;if(o&&("sector"===l&&o.startAngle===o.endAngle||"rect"===l&&(!o.width||!o.height))){for(var u=0;u<r.length;u++)r[u][2]=i[r[u][0]],i[r[u][0]]=r[u][1];t=!0;break}}if(e.apply(this,arguments),t)for(u=0;u<r.length;u++)i[r[u][0]]=r[u][2]}:e}e.exports=a},"89e3":function(e,t,n){var i=n("3842"),r=n("eda2"),a=n("e0d8"),s=n("944e"),o=i.round,l=a.extend({type:"interval",_interval:0,_intervalPrecision:2,setExtent:function(e,t){var n=this._extent;isNaN(e)||(n[0]=parseFloat(e)),isNaN(t)||(n[1]=parseFloat(t))},unionExtent:function(e){var t=this._extent;e[0]<t[0]&&(t[0]=e[0]),e[1]>t[1]&&(t[1]=e[1]),l.prototype.setExtent.call(this,t[0],t[1])},getInterval:function(){return this._interval},setInterval:function(e){this._interval=e,this._niceExtent=this._extent.slice(),this._intervalPrecision=s.getIntervalPrecision(e)},getTicks:function(){return s.intervalScaleGetTicks(this._interval,this._extent,this._niceExtent,this._intervalPrecision)},getLabel:function(e,t){if(null==e)return"";var n=t&&t.precision;return null==n?n=i.getPrecisionSafe(e)||0:"auto"===n&&(n=this._intervalPrecision),e=o(e,n,!0),r.addCommas(e)},niceTicks:function(e,t,n){e=e||5;var i=this._extent,r=i[1]-i[0];if(isFinite(r)){r<0&&(r=-r,i.reverse());var a=s.intervalScaleNiceTicks(i,e,t,n);this._intervalPrecision=a.intervalPrecision,this._interval=a.interval,this._niceExtent=a.niceTickExtent}},niceExtent:function(e){var t=this._extent;if(t[0]===t[1])if(0!==t[0]){var n=t[0];e.fixMax?t[0]-=n/2:(t[1]+=n/2,t[0]-=n/2)}else t[1]=1;var i=t[1]-t[0];isFinite(i)||(t[0]=0,t[1]=1),this.niceTicks(e.splitNumber,e.minInterval,e.maxInterval);var r=this._interval;e.fixMin||(t[0]=o(Math.floor(t[0]/r)*r)),e.fixMax||(t[1]=o(Math.ceil(t[1]/r)*r))}});l.create=function(){return new l};var u=l;e.exports=u},"8b7f":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=r.createHashMap,s=(r.retrieve,r.each);function o(e){var t=e.get("coordinateSystem"),n={coordSysName:t,coordSysDims:[],axisMap:a(),categoryAxisMap:a()},i=l[t];if(i)return i(e,n,n.axisMap,n.categoryAxisMap),n}var l={cartesian2d:function(e,t,n,i){var r=e.getReferringComponents("xAxis")[0],a=e.getReferringComponents("yAxis")[0];t.coordSysDims=["x","y"],n.set("x",r),n.set("y",a),u(r)&&(i.set("x",r),t.firstCategoryDimIndex=0),u(a)&&(i.set("y",a),t.firstCategoryDimIndex=1)},singleAxis:function(e,t,n,i){var r=e.getReferringComponents("singleAxis")[0];t.coordSysDims=["single"],n.set("single",r),u(r)&&(i.set("single",r),t.firstCategoryDimIndex=0)},polar:function(e,t,n,i){var r=e.getReferringComponents("polar")[0],a=r.findAxisModel("radiusAxis"),s=r.findAxisModel("angleAxis");t.coordSysDims=["radius","angle"],n.set("radius",a),n.set("angle",s),u(a)&&(i.set("radius",a),t.firstCategoryDimIndex=0),u(s)&&(i.set("angle",s),t.firstCategoryDimIndex=1)},geo:function(e,t,n,i){t.coordSysDims=["lng","lat"]},parallel:function(e,t,n,i){var r=e.ecModel,a=r.getComponent("parallel",e.get("parallelIndex")),o=t.coordSysDims=a.dimensions.slice();s(a.parallelAxisIndex,function(e,a){var s=r.getComponent("parallelAxis",e),l=o[a];n.set(l,s),u(s)&&null==t.firstCategoryDimIndex&&(i.set(l,s),t.firstCategoryDimIndex=a)})}};function u(e){return"category"===e.get("type")}t.getCoordSysDefineBySeries=o},"8b97":function(e,t,n){var i=n("d3f4"),r=n("cb7c"),a=function(e,t){if(r(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,i){try{i=n("9b43")(Function.call,n("11e9").f(Object.prototype,"__proto__").set,2),i(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:i(e,n),e}}({},!1):void 0),check:a}},"8c2a":function(e,t,n){var i=n("6d8b"),r=n("e0d8"),a=n("3842"),s=n("89e3"),o=r.prototype,l=s.prototype,u=a.getPrecisionSafe,c=a.round,d=Math.floor,h=Math.ceil,f=Math.pow,p=Math.log,g=r.extend({type:"log",base:10,$constructor:function(){r.apply(this,arguments),this._originalScale=new s},getTicks:function(){var e=this._originalScale,t=this._extent,n=e.getExtent();return i.map(l.getTicks.call(this),function(i){var r=a.round(f(this.base,i));return r=i===t[0]&&e.__fixMin?m(r,n[0]):r,r=i===t[1]&&e.__fixMax?m(r,n[1]):r,r},this)},getLabel:l.getLabel,scale:function(e){return e=o.scale.call(this,e),f(this.base,e)},setExtent:function(e,t){var n=this.base;e=p(e)/p(n),t=p(t)/p(n),l.setExtent.call(this,e,t)},getExtent:function(){var e=this.base,t=o.getExtent.call(this);t[0]=f(e,t[0]),t[1]=f(e,t[1]);var n=this._originalScale,i=n.getExtent();return n.__fixMin&&(t[0]=m(t[0],i[0])),n.__fixMax&&(t[1]=m(t[1],i[1])),t},unionExtent:function(e){this._originalScale.unionExtent(e);var t=this.base;e[0]=p(e[0])/p(t),e[1]=p(e[1])/p(t),o.unionExtent.call(this,e)},unionExtentFromData:function(e,t){this.unionExtent(e.getApproximateExtent(t))},niceTicks:function(e){e=e||10;var t=this._extent,n=t[1]-t[0];if(!(n===1/0||n<=0)){var i=a.quantity(n),r=e/n*i;r<=.5&&(i*=10);while(!isNaN(i)&&Math.abs(i)<1&&Math.abs(i)>0)i*=10;var s=[a.round(h(t[0]/i)*i),a.round(d(t[1]/i)*i)];this._interval=i,this._niceExtent=s}},niceExtent:function(e){l.niceExtent.call(this,e);var t=this._originalScale;t.__fixMin=e.fixMin,t.__fixMax=e.fixMax}});function m(e,t){return c(e,u(t))}i.each(["contain","normalize"],function(e){g.prototype[e]=function(t){return t=p(t)/p(this.base),o[e].call(this,t)}}),g.create=function(){return new g};var v=g;e.exports=v},"8d32":function(e,t,n){var i=n("cbe5"),r=i.extend({type:"arc",shape:{cx:0,cy:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},style:{stroke:"#000",fill:null},buildPath:function(e,t){var n=t.cx,i=t.cy,r=Math.max(t.r,0),a=t.startAngle,s=t.endAngle,o=t.clockwise,l=Math.cos(a),u=Math.sin(a);e.moveTo(l*r+n,u*r+i),e.arc(n,i,r,a,s,!o)}});e.exports=r},"8e43":function(e,t,n){var i=n("6d8b"),r=i.createHashMap,a=i.isObject,s=i.map;function o(e){this.categories=e.categories||[],this._needCollect=e.needCollect,this._deduplication=e.deduplication,this._map}o.createByAxisModel=function(e){var t=e.option,n=t.data,i=n&&s(n,c);return new o({categories:i,needCollect:!i,deduplication:!1!==t.dedplication})};var l=o.prototype;function u(e){return e._map||(e._map=r(e.categories))}function c(e){return a(e)&&null!=e.value?e.value:e+""}l.getOrdinal=function(e){return u(this).get(e)},l.parseAndCollect=function(e){var t,n=this._needCollect;if("string"!==typeof e&&!n)return e;if(n&&!this._deduplication)return t=this.categories.length,this.categories[t]=e,t;var i=u(this);return t=i.get(e),null==t&&(n?(t=this.categories.length,this.categories[t]=e,i.set(e,t)):t=NaN),t};var d=o;e.exports=d},"8ec5":function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("2145"),s=i.extendComponentModel({type:"toolbox",layoutMode:{type:"box",ignoreSize:!0},optionUpdated:function(){s.superApply(this,"optionUpdated",arguments),r.each(this.option.feature,function(e,t){var n=a.get(t);n&&r.merge(e,n.defaultOption)})},defaultOption:{show:!0,z:6,zlevel:0,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemSize:15,itemGap:8,showTitle:!0,iconStyle:{borderColor:"#666",color:"none"},emphasis:{iconStyle:{borderColor:"#3E98C5"}}}}),o=s;e.exports=o},"8ed2":function(e,t,n){n("48c7");var i=n("6cb7"),r=i.extend({type:"grid",dependencies:["xAxis","yAxis"],layoutMode:"box",coordinateSystem:null,defaultOption:{show:!1,zlevel:0,z:0,left:"10%",top:60,right:"10%",bottom:60,containLabel:!1,backgroundColor:"rgba(0,0,0,0)",borderWidth:1,borderColor:"#ccc"}});e.exports=r},"903c":function(e,t){function n(e){var t=e.findComponents({mainType:"legend"});t&&t.length&&e.filterSeries(function(e){for(var n=0;n<t.length;n++)if(!t[n].isSelected(e.name))return!1;return!0})}e.exports=n},9093:function(e,t,n){var i=n("ce10"),r=n("e11e").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,r)}},"93d0":function(e,t){var n="original",i="arrayRows",r="objectRows",a="keyedColumns",s="unknown",o="typedArray",l="column",u="row";t.SOURCE_FORMAT_ORIGINAL=n,t.SOURCE_FORMAT_ARRAY_ROWS=i,t.SOURCE_FORMAT_OBJECT_ROWS=r,t.SOURCE_FORMAT_KEYED_COLUMNS=a,t.SOURCE_FORMAT_UNKNOWN=s,t.SOURCE_FORMAT_TYPED_ARRAY=o,t.SERIES_LAYOUT_BY_COLUMN=l,t.SERIES_LAYOUT_BY_ROW=u},"944e":function(e,t,n){var i=n("3842"),r=i.round;function a(e,t,n,a){var o={},u=e[1]-e[0],c=o.interval=i.nice(u/t,!0);null!=n&&c<n&&(c=o.interval=n),null!=a&&c>a&&(c=o.interval=a);var d=o.intervalPrecision=s(c),h=o.niceTickExtent=[r(Math.ceil(e[0]/c)*c,d),r(Math.floor(e[1]/c)*c,d)];return l(h,e),o}function s(e){return i.getPrecisionSafe(e)+2}function o(e,t,n){e[t]=Math.max(Math.min(e[t],n[1]),n[0])}function l(e,t){!isFinite(e[0])&&(e[0]=t[0]),!isFinite(e[1])&&(e[1]=t[1]),o(e,0,t),o(e,1,t),e[0]>e[1]&&(e[0]=e[1])}function u(e,t,n,i){var a=[];if(!e)return a;var s=1e4;t[0]<n[0]&&a.push(t[0]);var o=n[0];while(o<=n[1]){if(a.push(o),o=r(o+e,i),o===a[a.length-1])break;if(a.length>s)return[]}return t[1]>(a.length?a[a.length-1]:n[1])&&a.push(t[1]),a}t.intervalScaleNiceTicks=a,t.getIntervalPrecision=s,t.fixExtent=l,t.intervalScaleGetTicks=u},"94b1":function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("9d57"),s=a.layout,o=a.largeLayout;n("5aa9"),n("17b8"),n("67cc"),n("01ed"),i.registerLayout(r.curry(s,"bar")),i.registerLayout(o),i.registerVisual({seriesType:"bar",reset:function(e){e.getData().setVisual("legendSymbol","roundRect")}})},9680:function(e,t){function n(e,t,n,i,r,a,s){if(0===r)return!1;var o=r,l=0,u=e;if(s>t+o&&s>i+o||s<t-o&&s<i-o||a>e+o&&a>n+o||a<e-o&&a<n-o)return!1;if(e===n)return Math.abs(a-e)<=o/2;l=(t-i)/(e-n),u=(e*i-n*t)/(e-n);var c=l*a-s+u,d=c*c/(l*l+1);return d<=o/2*o/2}t.containStroke=n},"96cf":function(e,t,n){var i=function(e){"use strict";var t,n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"===typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var a=t&&t.prototype instanceof v?t:v,s=Object.create(a.prototype),o=new R(i||[]);return r(s,"_invoke",{value:A(e,n,o)}),s}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h="suspendedStart",f="suspendedYield",p="executing",g="completed",m={};function v(){}function y(){}function b(){}var S={};u(S,s,function(){return this});var T=Object.getPrototypeOf,_=T&&T(T(M([])));_&&_!==n&&i.call(_,s)&&(S=_);var w=b.prototype=v.prototype=Object.create(S);function E(e){["next","throw","return"].forEach(function(t){u(e,t,function(e){return this._invoke(t,e)})})}function x(e,t){function n(r,a,s,o){var l=d(e[r],e,a);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"===typeof c&&i.call(c,"__await")?t.resolve(c.__await).then(function(e){n("next",e,s,o)},function(e){n("throw",e,s,o)}):t.resolve(c).then(function(e){u.value=e,s(u)},function(e){return n("throw",e,s,o)})}o(l.arg)}var a;function s(e,i){function r(){return new t(function(t,r){n(e,i,t,r)})}return a=a?a.then(r,r):r()}r(this,"_invoke",{value:s})}function A(e,t,n){var i=h;return function(r,a){if(i===p)throw new Error("Generator is already running");if(i===g){if("throw"===r)throw a;return D()}n.method=r,n.arg=a;while(1){var s=n.delegate;if(s){var o=k(s,n);if(o){if(o===m)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=d(e,t,n);if("normal"===l.type){if(i=n.done?g:f,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=g,n.method="throw",n.arg=l.arg)}}}function k(e,n){var i=n.method,r=e.iterator[i];if(r===t)return n.delegate=null,"throw"===i&&e.iterator["return"]&&(n.method="return",n.arg=t,k(e,n),"throw"===n.method)?m:("return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m);var a=d(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,m;var s=a.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function M(e){if(null!=e){var n=e[s];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){while(++r<e.length)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(typeof e+" is not iterable")}function D(){return{value:t,done:!0}}return y.prototype=b,r(w,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:y,configurable:!0}),y.displayName=u(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,l,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},E(x.prototype),u(x.prototype,o,function(){return this}),e.AsyncIterator=x,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var s=new x(c(t,n,i,r),a);return e.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})},E(w),u(w,l,"Generator"),u(w,s,function(){return this}),u(w,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){while(n.length){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=M,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return o.type="throw",o.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var l=i.call(s,"catchLoc"),u=i.call(s,"finallyLoc");if(l&&u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:M(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=i}catch(e){"object"===typeof globalThis?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},9850:function(e,t,n){var i=n("401b"),r=n("1687"),a=i.applyTransform,s=Math.min,o=Math.max;function l(e,t,n,i){n<0&&(e+=n,n=-n),i<0&&(t+=i,i=-i),this.x=e,this.y=t,this.width=n,this.height=i}l.prototype={constructor:l,union:function(e){var t=s(e.x,this.x),n=s(e.y,this.y);this.width=o(e.x+e.width,this.x+this.width)-t,this.height=o(e.y+e.height,this.y+this.height)-n,this.x=t,this.y=n},applyTransform:function(){var e=[],t=[],n=[],i=[];return function(r){if(r){e[0]=n[0]=this.x,e[1]=i[1]=this.y,t[0]=i[0]=this.x+this.width,t[1]=n[1]=this.y+this.height,a(e,e,r),a(t,t,r),a(n,n,r),a(i,i,r),this.x=s(e[0],t[0],n[0],i[0]),this.y=s(e[1],t[1],n[1],i[1]);var l=o(e[0],t[0],n[0],i[0]),u=o(e[1],t[1],n[1],i[1]);this.width=l-this.x,this.height=u-this.y}}}(),calculateTransform:function(e){var t=this,n=e.width/t.width,i=e.height/t.height,a=r.create();return r.translate(a,a,[-t.x,-t.y]),r.scale(a,a,[n,i]),r.translate(a,a,[e.x,e.y]),a},intersect:function(e){if(!e)return!1;e instanceof l||(e=l.create(e));var t=this,n=t.x,i=t.x+t.width,r=t.y,a=t.y+t.height,s=e.x,o=e.x+e.width,u=e.y,c=e.y+e.height;return!(i<s||o<n||a<u||c<r)},contain:function(e,t){var n=this;return e>=n.x&&e<=n.x+n.width&&t>=n.y&&t<=n.y+n.height},clone:function(){return new l(this.x,this.y,this.width,this.height)},copy:function(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},l.create=function(e){return new l(e.x,e.y,e.width,e.height)};var u=l;e.exports=u},"98b7":function(e,t){var n="undefined"!==typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){setTimeout(e,16)};e.exports=n},"998c":function(e,t,n){var i=n("6d8b"),r=n("2306"),a=Math.PI;function s(e,t){t=t||{},i.defaults(t,{text:"loading",color:"#c23531",textColor:"#000",maskColor:"rgba(255, 255, 255, 0.8)",zlevel:0});var n=new r.Rect({style:{fill:t.maskColor},zlevel:t.zlevel,z:1e4}),s=new r.Arc({shape:{startAngle:-a/2,endAngle:-a/2+.1,r:10},style:{stroke:t.color,lineCap:"round",lineWidth:5},zlevel:t.zlevel,z:10001}),o=new r.Rect({style:{fill:"none",text:t.text,textPosition:"right",textDistance:10,textFill:t.textColor},zlevel:t.zlevel,z:10001});s.animateShape(!0).when(1e3,{endAngle:3*a/2}).start("circularInOut"),s.animateShape(!0).when(1e3,{startAngle:3*a/2}).delay(300).start("circularInOut");var l=new r.Group;return l.add(s),l.add(o),l.add(n),l.resize=function(){var t=e.getWidth()/2,i=e.getHeight()/2;s.setShape({cx:t,cy:i});var r=s.shape.r;o.setShape({x:t-r,y:i-r,width:2*r,height:2*r}),n.setShape({x:0,y:0,width:e.getWidth(),height:e.getHeight()})},l.resize(),l}e.exports=s},"9b43":function(e,t,n){var i=n("d8e8");e.exports=function(e,t,n){if(i(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)}}return function(){return e.apply(t,arguments)}}},"9bdb":function(e,t,n){var i=n("282b"),r=i([["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]]),a={getAreaStyle:function(e,t){return r(this,e,t)}};e.exports=a},"9c2c":function(e,t,n){var i=n("401b"),r=i.min,a=i.max,s=i.scale,o=i.distance,l=i.add,u=i.clone,c=i.sub;function d(e,t,n,i){var d,h,f,p,g=[],m=[],v=[],y=[];if(i){f=[1/0,1/0],p=[-1/0,-1/0];for(var b=0,S=e.length;b<S;b++)r(f,f,e[b]),a(p,p,e[b]);r(f,f,i[0]),a(p,p,i[1])}for(b=0,S=e.length;b<S;b++){var T=e[b];if(n)d=e[b?b-1:S-1],h=e[(b+1)%S];else{if(0===b||b===S-1){g.push(u(e[b]));continue}d=e[b-1],h=e[b+1]}c(m,h,d),s(m,m,t);var _=o(T,d),w=o(T,h),E=_+w;0!==E&&(_/=E,w/=E),s(v,m,-_),s(y,m,w);var x=l([],T,v),A=l([],T,y);i&&(a(x,x,f),r(x,x,p),a(A,A,f),r(A,A,p)),g.push(x),g.push(A)}return n&&g.push(g.shift()),g}e.exports=d},"9c6c":function(e,t,n){var i=n("2b4c")("unscopables"),r=Array.prototype;void 0==r[i]&&n("32e9")(r,i,{}),e.exports=function(e){r[i][e]=!0}},"9c80":function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},"9d57":function(e,t,n){var i=n("6d8b"),r=n("3842"),a=r.parsePercent,s=n("ee1a"),o=s.isDimensionStacked,l=n("cccd"),u="__ec_stack_",c=.5,d="undefined"!==typeof Float32Array?Float32Array:Array;function h(e){return e.get("stack")||u+e.seriesIndex}function f(e){return e.dim+e.index}function p(e){var t=[],n=e.axis,r="axis0";if("category"===n.type){for(var a=n.getBandWidth(),s=0;s<e.count;s++)t.push(i.defaults({bandWidth:a,axisKey:r,stackId:u+s},e));var o=v(t),l=[];for(s=0;s<e.count;s++){var c=o[r][u+s];c.offsetCenter=c.offset+c.width/2,l.push(c)}return l}}function g(e,t){var n=[];return t.eachSeriesByType(e,function(e){T(e)&&!_(e)&&n.push(e)}),n}function m(e){var t=[];return i.each(e,function(e){var n=e.getData(),i=e.coordinateSystem,r=i.getBaseAxis(),s=r.getExtent(),o="category"===r.type?r.getBandWidth():Math.abs(s[1]-s[0])/n.count(),l=a(e.get("barWidth"),o),u=a(e.get("barMaxWidth"),o),c=e.get("barGap"),d=e.get("barCategoryGap");t.push({bandWidth:o,barWidth:l,barMaxWidth:u,barGap:c,barCategoryGap:d,axisKey:f(r),stackId:h(e)})}),v(t)}function v(e){var t={};i.each(e,function(e,n){var i=e.axisKey,r=e.bandWidth,a=t[i]||{bandWidth:r,remainedWidth:r,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},s=a.stacks;t[i]=a;var o=e.stackId;s[o]||a.autoWidthCount++,s[o]=s[o]||{width:0,maxWidth:0};var l=e.barWidth;l&&!s[o].width&&(s[o].width=l,l=Math.min(a.remainedWidth,l),a.remainedWidth-=l);var u=e.barMaxWidth;u&&(s[o].maxWidth=u);var c=e.barGap;null!=c&&(a.gap=c);var d=e.barCategoryGap;null!=d&&(a.categoryGap=d)});var n={};return i.each(t,function(e,t){n[t]={};var r=e.stacks,s=e.bandWidth,o=a(e.categoryGap,s),l=a(e.gap,1),u=e.remainedWidth,c=e.autoWidthCount,d=(u-o)/(c+(c-1)*l);d=Math.max(d,0),i.each(r,function(e,t){var n=e.maxWidth;n&&n<d&&(n=Math.min(n,u),e.width&&(n=Math.min(n,e.width)),u-=n,e.width=n,c--)}),d=(u-o)/(c+(c-1)*l),d=Math.max(d,0);var h,f=0;i.each(r,function(e,t){e.width||(e.width=d),h=e,f+=e.width*(1+l)}),h&&(f-=h.width*l);var p=-f/2;i.each(r,function(e,i){n[t][i]=n[t][i]||{offset:p,width:e.width},p+=e.width*(1+l)})}),n}function y(e,t,n){if(e&&t){var i=e[f(t)];return null!=i&&null!=n&&(i=i[h(n)]),i}}function b(e,t){var n=g(e,t),r=m(n),a={},s={};i.each(n,function(e){var t=e.getData(),n=e.coordinateSystem,i=n.getBaseAxis(),l=h(e),u=r[f(i)][l],c=u.offset,d=u.width,p=n.getOtherAxis(i),g=e.get("barMinHeight")||0;a[l]=a[l]||[],s[l]=s[l]||[],t.setLayout({offset:c,size:d});for(var m=t.mapDimension(p.dim),v=t.mapDimension(i.dim),y=o(t,m),b=p.isHorizontal(),S=w(i,p,y),T=0,_=t.count();T<_;T++){var E=t.get(m,T),x=t.get(v,T);if(!isNaN(E)){var A,k,I,C,R=E>=0?"p":"n",M=S;if(y&&(a[l][x]||(a[l][x]={p:S,n:S}),M=a[l][x][R]),b){var D=n.dataToPoint([E,x]);A=M,k=D[1]+c,I=D[0]-S,C=d,Math.abs(I)<g&&(I=(I<0?-1:1)*g),y&&(a[l][x][R]+=I)}else{D=n.dataToPoint([x,E]);A=D[0]+c,k=M,I=d,C=D[1]-S,Math.abs(C)<g&&(C=(C<=0?-1:1)*g),y&&(a[l][x][R]+=C)}t.setItemLayout(T,{x:A,y:k,width:I,height:C})}}},this)}var S={seriesType:"bar",plan:l(),reset:function(e){if(T(e)&&_(e)){var t=e.getData(),n=e.coordinateSystem,i=n.getBaseAxis(),r=n.getOtherAxis(i),a=t.mapDimension(r.dim),s=t.mapDimension(i.dim),o=r.isHorizontal(),l=o?0:1,u=y(m([e]),i,e).width;return u>c||(u=c),{progress:h}}function h(e,t){var c,h=new d(2*e.count),f=[],p=[],g=0;while(null!=(c=e.next()))p[l]=t.get(a,c),p[1-l]=t.get(s,c),f=n.dataToPoint(p,null,f),h[g++]=f[0],h[g++]=f[1];t.setLayout({largePoints:h,barWidth:u,valueAxisStart:w(i,r,!1),valueAxisHorizontal:o})}}};function T(e){return e.coordinateSystem&&"cartesian2d"===e.coordinateSystem.type}function _(e){return e.pipelineContext&&e.pipelineContext.large}function w(e,t,n){return i.indexOf(e.getAxesOnZeroOf(),t)>=0||n?t.toGlobalCoord(t.dataToCoord(0)):t.getGlobalExtent()[0]}t.getLayoutOnAxis=p,t.prepareLayoutBarSeries=g,t.makeColumnLayout=m,t.retrieveColumnLayout=y,t.layout=b,t.largeLayout=S},"9def":function(e,t,n){var i=n("4588"),r=Math.min;e.exports=function(e){return e>0?r(i(e),9007199254740991):0}},"9e1e":function(e,t,n){e.exports=!n("79e5")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},"9e2e":function(e,t,n){var i=n("a73c"),r=n("9850"),a=new r,s=function(){};s.prototype={constructor:s,drawRectText:function(e,t){var n=this.style;t=n.textRect||t,this.__dirty&&i.normalizeTextStyle(n,!0);var r=n.text;if(null!=r&&(r+=""),i.needDrawText(r,n)){e.save();var s=this.transform;n.transformText?this.setTransform(e):s&&(a.copy(t),a.applyTransform(s),t=a),i.renderText(this,e,r,n,t),e.restore()}}};var o=s;e.exports=o},"9e47":function(e,t,n){var i=n("6d8b"),r=n("71ad"),a=n("6cb7"),s=n("f934"),o=s.getLayoutParams,l=s.mergeLayoutParam,u=n("8e43"),c=["value","category","time","log"];function d(e,t,n,s){i.each(c,function(a){t.extend({type:e+"Axis."+a,mergeDefaultAndTheme:function(t,r){var s=this.layoutMode,u=s?o(t):{},c=r.getTheme();i.merge(t,c.get(a+"Axis")),i.merge(t,this.getDefaultOption()),t.type=n(e,t),s&&l(t,u,s)},optionUpdated:function(){var e=this.option;"category"===e.type&&(this.__ordinalMeta=u.createByAxisModel(this))},getCategories:function(e){var t=this.option;if("category"===t.type)return e?t.data:this.__ordinalMeta.categories},getOrdinalMeta:function(){return this.__ordinalMeta},defaultOption:i.mergeAll([{},r[a+"Axis"],s],!0)})}),a.registerSubTypeDefaulter(e+"Axis",i.curry(n,e))}e.exports=d},"9e87":function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("50e5");i.registerAction("dataZoom",function(e,t){var n=a.createLinkedNodesFinder(r.bind(t.eachComponent,t,"dataZoom"),a.eachAxisDim,function(e,t){return e.get(t.axisIndex)}),i=[];t.eachComponent({mainType:"dataZoom",query:e},function(e,t){i.push.apply(i,n(e).nodes)}),r.each(i,function(t,n){t.setRawRange({start:e.start,end:e.end,startValue:e.startValue,endValue:e.endValue})})})},"9f51":function(e,t,n){var i=n("857d"),r=i.normalizeRadian,a=2*Math.PI;function s(e,t,n,i,s,o,l,u,c){if(0===l)return!1;var d=l;u-=e,c-=t;var h=Math.sqrt(u*u+c*c);if(h-d>n||h+d<n)return!1;if(Math.abs(i-s)%a<1e-4)return!0;if(o){var f=i;i=r(s),s=r(f)}else i=r(i),s=r(s);i>s&&(s+=a);var p=Math.atan2(c,u);return p<0&&(p+=a),p>=i&&p<=s||p+a>=i&&p+a<=s}t.containStroke=s},"9f82":function(e,t,n){var i=n("ee1a"),r=i.isDimensionStacked,a=n("6d8b"),s=a.map;function o(e,t,n){var i,a=e.getBaseAxis(),o=e.getOtherAxis(a),u=l(o,n),c=a.dim,d=o.dim,h=t.mapDimension(d),f=t.mapDimension(c),p="x"===d||"radius"===d?1:0,g=s(e.dimensions,function(e){return t.mapDimension(e)}),m=t.getCalculationInfo("stackResultDimension");return(i|=r(t,g[0]))&&(g[0]=m),(i|=r(t,g[1]))&&(g[1]=m),{dataDimsForPoint:g,valueStart:u,valueAxisDim:d,baseAxisDim:c,stacked:!!i,valueDim:h,baseDim:f,baseDataOffset:p,stackedOverDimension:t.getCalculationInfo("stackedOverDimension")}}function l(e,t){var n=0,i=e.scale.getExtent();return"start"===t?n=i[0]:"end"===t?n=i[1]:i[0]>0?n=i[0]:i[1]<0&&(n=i[1]),n}function u(e,t,n,i){var r=NaN;e.stacked&&(r=n.get(n.getCalculationInfo("stackedOverDimension"),i)),isNaN(r)&&(r=e.valueStart);var a=e.baseDataOffset,s=[];return s[a]=n.get(e.baseDim,i),s[1-a]=r,t.dataToPoint(s)}t.prepareDataCoordInfo=o,t.getStackedOnPoint=u},a15a:function(e,t,n){var i=n("6d8b"),r=n("2306"),a=n("9850"),s=r.extendShape({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(e,t){var n=t.cx,i=t.cy,r=t.width/2,a=t.height/2;e.moveTo(n,i-a),e.lineTo(n+r,i+a),e.lineTo(n-r,i+a),e.closePath()}}),o=r.extendShape({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(e,t){var n=t.cx,i=t.cy,r=t.width/2,a=t.height/2;e.moveTo(n,i-a),e.lineTo(n+r,i),e.lineTo(n,i+a),e.lineTo(n-r,i),e.closePath()}}),l=r.extendShape({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var n=t.x,i=t.y,r=t.width/5*3,a=Math.max(r,t.height),s=r/2,o=s*s/(a-s),l=i-a+s+o,u=Math.asin(o/s),c=Math.cos(u)*s,d=Math.sin(u),h=Math.cos(u),f=.6*s,p=.7*s;e.moveTo(n-c,l+o),e.arc(n,l,s,Math.PI-u,2*Math.PI+u),e.bezierCurveTo(n+c-d*f,l+o+h*f,n,i-p,n,i),e.bezierCurveTo(n,i-p,n-c+d*f,l+o+h*f,n-c,l+o),e.closePath()}}),u=r.extendShape({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var n=t.height,i=t.width,r=t.x,a=t.y,s=i/3*2;e.moveTo(r,a),e.lineTo(r+s,a+n),e.lineTo(r,a+n/4*3),e.lineTo(r-s,a+n),e.lineTo(r,a),e.closePath()}}),c={line:r.Line,rect:r.Rect,roundRect:r.Rect,square:r.Rect,circle:r.Circle,diamond:o,pin:l,arrow:u,triangle:s},d={line:function(e,t,n,i,r){r.x1=e,r.y1=t+i/2,r.x2=e+n,r.y2=t+i/2},rect:function(e,t,n,i,r){r.x=e,r.y=t,r.width=n,r.height=i},roundRect:function(e,t,n,i,r){r.x=e,r.y=t,r.width=n,r.height=i,r.r=Math.min(n,i)/4},square:function(e,t,n,i,r){var a=Math.min(n,i);r.x=e,r.y=t,r.width=a,r.height=a},circle:function(e,t,n,i,r){r.cx=e+n/2,r.cy=t+i/2,r.r=Math.min(n,i)/2},diamond:function(e,t,n,i,r){r.cx=e+n/2,r.cy=t+i/2,r.width=n,r.height=i},pin:function(e,t,n,i,r){r.x=e+n/2,r.y=t+i/2,r.width=n,r.height=i},arrow:function(e,t,n,i,r){r.x=e+n/2,r.y=t+i/2,r.width=n,r.height=i},triangle:function(e,t,n,i,r){r.cx=e+n/2,r.cy=t+i/2,r.width=n,r.height=i}},h={};i.each(c,function(e,t){h[t]=new e});var f=r.extendShape({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},beforeBrush:function(){var e=this.style,t=this.shape;"pin"===t.symbolType&&"inside"===e.textPosition&&(e.textPosition=["50%","40%"],e.textAlign="center",e.textVerticalAlign="middle")},buildPath:function(e,t,n){var i=t.symbolType,r=h[i];"none"!==t.symbolType&&(r||(i="rect",r=h[i]),d[i](t.x,t.y,t.width,t.height,r.shape),r.buildPath(e,r.shape,n))}});function p(e,t){if("image"!==this.type){var n=this.style,i=this.shape;i&&"line"===i.symbolType?n.stroke=e:this.__isEmptyBrush?(n.stroke=e,n.fill=t||"#fff"):(n.fill&&(n.fill=e),n.stroke&&(n.stroke=e)),this.dirty(!1)}}function g(e,t,n,i,s,o,l){var u,c=0===e.indexOf("empty");return c&&(e=e.substr(5,1).toLowerCase()+e.substr(6)),u=0===e.indexOf("image://")?r.makeImage(e.slice(8),new a(t,n,i,s),l?"center":"cover"):0===e.indexOf("path://")?r.makePath(e.slice(7),{},new a(t,n,i,s),l?"center":"cover"):new f({shape:{symbolType:e,x:t,y:n,width:i,height:s}}),u.__isEmptyBrush=c,u.setColor=p,u.setColor(o),u}t.createSymbol=g},a25f:function(e,t,n){var i=n("7726"),r=i.navigator;e.exports=r&&r.userAgent||""},a481:function(e,t,n){n("214f")("replace",2,function(e,t,n){return[function(i,r){"use strict";var a=e(this),s=void 0==i?void 0:i[t];return void 0!==s?s.call(i,a,r):n.call(String(a),i,r)},n]})},a4fe:function(e,t,n){var i=n("3eba"),r="\0_ec_interaction_mutex";function a(e,t,n){var i=l(e);i[t]=n}function s(e,t,n){var i=l(e),r=i[t];r===n&&(i[t]=null)}function o(e,t){return!!l(e)[t]}function l(e){return e[r]||(e[r]={})}i.registerAction({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},function(){}),t.take=a,t.release=s,t.isTaken=o},a567:function(e,t,n){"use strict";function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}n.d(t,"a",function(){return Al});var r={exports:{}};(function(e,t){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),t=t.trim(),!t){if(!n.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+a.path;u.path=s.normalizePath(d)}else u.path=o.path,a.params||(u.params=o.params,a.query||(u.query=o.query));return null===u.path&&(u.path=n.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(u)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){e=e.split("").reverse().join("").replace(r,"");while(e.length!==(e=e.replace(a,"")).length);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s})()})(r);var a=r.exports;function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function u(e){var t=l(e,"string");return"symbol"==typeof t?t:String(t)}function c(e,t,n){return t=u(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},d.apply(this,arguments)}const h=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},f=Number.isSafeInteger||function(e){return"number"===typeof e&&Math.abs(e)<=p},p=Number.MAX_SAFE_INTEGER||9007199254740991;let g=function(e){return e["MEDIA_ATTACHING"]="hlsMediaAttaching",e["MEDIA_ATTACHED"]="hlsMediaAttached",e["MEDIA_DETACHING"]="hlsMediaDetaching",e["MEDIA_DETACHED"]="hlsMediaDetached",e["BUFFER_RESET"]="hlsBufferReset",e["BUFFER_CODECS"]="hlsBufferCodecs",e["BUFFER_CREATED"]="hlsBufferCreated",e["BUFFER_APPENDING"]="hlsBufferAppending",e["BUFFER_APPENDED"]="hlsBufferAppended",e["BUFFER_EOS"]="hlsBufferEos",e["BUFFER_FLUSHING"]="hlsBufferFlushing",e["BUFFER_FLUSHED"]="hlsBufferFlushed",e["MANIFEST_LOADING"]="hlsManifestLoading",e["MANIFEST_LOADED"]="hlsManifestLoaded",e["MANIFEST_PARSED"]="hlsManifestParsed",e["LEVEL_SWITCHING"]="hlsLevelSwitching",e["LEVEL_SWITCHED"]="hlsLevelSwitched",e["LEVEL_LOADING"]="hlsLevelLoading",e["LEVEL_LOADED"]="hlsLevelLoaded",e["LEVEL_UPDATED"]="hlsLevelUpdated",e["LEVEL_PTS_UPDATED"]="hlsLevelPtsUpdated",e["LEVELS_UPDATED"]="hlsLevelsUpdated",e["AUDIO_TRACKS_UPDATED"]="hlsAudioTracksUpdated",e["AUDIO_TRACK_SWITCHING"]="hlsAudioTrackSwitching",e["AUDIO_TRACK_SWITCHED"]="hlsAudioTrackSwitched",e["AUDIO_TRACK_LOADING"]="hlsAudioTrackLoading",e["AUDIO_TRACK_LOADED"]="hlsAudioTrackLoaded",e["SUBTITLE_TRACKS_UPDATED"]="hlsSubtitleTracksUpdated",e["SUBTITLE_TRACKS_CLEARED"]="hlsSubtitleTracksCleared",e["SUBTITLE_TRACK_SWITCH"]="hlsSubtitleTrackSwitch",e["SUBTITLE_TRACK_LOADING"]="hlsSubtitleTrackLoading",e["SUBTITLE_TRACK_LOADED"]="hlsSubtitleTrackLoaded",e["SUBTITLE_FRAG_PROCESSED"]="hlsSubtitleFragProcessed",e["CUES_PARSED"]="hlsCuesParsed",e["NON_NATIVE_TEXT_TRACKS_FOUND"]="hlsNonNativeTextTracksFound",e["INIT_PTS_FOUND"]="hlsInitPtsFound",e["FRAG_LOADING"]="hlsFragLoading",e["FRAG_LOAD_EMERGENCY_ABORTED"]="hlsFragLoadEmergencyAborted",e["FRAG_LOADED"]="hlsFragLoaded",e["FRAG_DECRYPTED"]="hlsFragDecrypted",e["FRAG_PARSING_INIT_SEGMENT"]="hlsFragParsingInitSegment",e["FRAG_PARSING_USERDATA"]="hlsFragParsingUserdata",e["FRAG_PARSING_METADATA"]="hlsFragParsingMetadata",e["FRAG_PARSED"]="hlsFragParsed",e["FRAG_BUFFERED"]="hlsFragBuffered",e["FRAG_CHANGED"]="hlsFragChanged",e["FPS_DROP"]="hlsFpsDrop",e["FPS_DROP_LEVEL_CAPPING"]="hlsFpsDropLevelCapping",e["MAX_AUTO_LEVEL_UPDATED"]="hlsMaxAutoLevelUpdated",e["ERROR"]="hlsError",e["DESTROYING"]="hlsDestroying",e["KEY_LOADING"]="hlsKeyLoading",e["KEY_LOADED"]="hlsKeyLoaded",e["LIVE_BACK_BUFFER_REACHED"]="hlsLiveBackBufferReached",e["BACK_BUFFER_REACHED"]="hlsBackBufferReached",e["STEERING_MANIFEST_LOADED"]="hlsSteeringManifestLoaded",e}({}),m=function(e){return e["NETWORK_ERROR"]="networkError",e["MEDIA_ERROR"]="mediaError",e["KEY_SYSTEM_ERROR"]="keySystemError",e["MUX_ERROR"]="muxError",e["OTHER_ERROR"]="otherError",e}({}),v=function(e){return e["KEY_SYSTEM_NO_KEYS"]="keySystemNoKeys",e["KEY_SYSTEM_NO_ACCESS"]="keySystemNoAccess",e["KEY_SYSTEM_NO_SESSION"]="keySystemNoSession",e["KEY_SYSTEM_NO_CONFIGURED_LICENSE"]="keySystemNoConfiguredLicense",e["KEY_SYSTEM_LICENSE_REQUEST_FAILED"]="keySystemLicenseRequestFailed",e["KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED"]="keySystemServerCertificateRequestFailed",e["KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED"]="keySystemServerCertificateUpdateFailed",e["KEY_SYSTEM_SESSION_UPDATE_FAILED"]="keySystemSessionUpdateFailed",e["KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED"]="keySystemStatusOutputRestricted",e["KEY_SYSTEM_STATUS_INTERNAL_ERROR"]="keySystemStatusInternalError",e["MANIFEST_LOAD_ERROR"]="manifestLoadError",e["MANIFEST_LOAD_TIMEOUT"]="manifestLoadTimeOut",e["MANIFEST_PARSING_ERROR"]="manifestParsingError",e["MANIFEST_INCOMPATIBLE_CODECS_ERROR"]="manifestIncompatibleCodecsError",e["LEVEL_EMPTY_ERROR"]="levelEmptyError",e["LEVEL_LOAD_ERROR"]="levelLoadError",e["LEVEL_LOAD_TIMEOUT"]="levelLoadTimeOut",e["LEVEL_PARSING_ERROR"]="levelParsingError",e["LEVEL_SWITCH_ERROR"]="levelSwitchError",e["AUDIO_TRACK_LOAD_ERROR"]="audioTrackLoadError",e["AUDIO_TRACK_LOAD_TIMEOUT"]="audioTrackLoadTimeOut",e["SUBTITLE_LOAD_ERROR"]="subtitleTrackLoadError",e["SUBTITLE_TRACK_LOAD_TIMEOUT"]="subtitleTrackLoadTimeOut",e["FRAG_LOAD_ERROR"]="fragLoadError",e["FRAG_LOAD_TIMEOUT"]="fragLoadTimeOut",e["FRAG_DECRYPT_ERROR"]="fragDecryptError",e["FRAG_PARSING_ERROR"]="fragParsingError",e["FRAG_GAP"]="fragGap",e["REMUX_ALLOC_ERROR"]="remuxAllocError",e["KEY_LOAD_ERROR"]="keyLoadError",e["KEY_LOAD_TIMEOUT"]="keyLoadTimeOut",e["BUFFER_ADD_CODEC_ERROR"]="bufferAddCodecError",e["BUFFER_INCOMPATIBLE_CODECS_ERROR"]="bufferIncompatibleCodecsError",e["BUFFER_APPEND_ERROR"]="bufferAppendError",e["BUFFER_APPENDING_ERROR"]="bufferAppendingError",e["BUFFER_STALLED_ERROR"]="bufferStalledError",e["BUFFER_FULL_ERROR"]="bufferFullError",e["BUFFER_SEEK_OVER_HOLE"]="bufferSeekOverHole",e["BUFFER_NUDGE_ON_STALL"]="bufferNudgeOnStall",e["INTERNAL_EXCEPTION"]="internalException",e["INTERNAL_ABORTED"]="aborted",e["UNKNOWN"]="unknown",e}({});const y=function(){},b={trace:y,debug:y,log:y,warn:y,info:y,error:y};let S=b;function T(e){const t=self.console[e];return t?t.bind(self.console,`[${e}] >`):y}function _(e,...t){t.forEach(function(t){S[t]=e[t]?e[t].bind(e):T(t)})}function w(e,t){if("object"===typeof console&&!0===e||"object"===typeof e){_(e,"debug","log","info","warn","error");try{S.log(`Debug logs enabled for "${t}" in hls.js version 1.5.14`)}catch(e){S=b}}else S=b}const E=S,x=/^(\d+)x(\d+)$/,A=/(.+?)=(".*?"|.*?)(?:,|$)/g;class k{constructor(e){"string"===typeof e&&(e=k.parseAttrList(e)),d(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const n=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)n[e]=parseInt(t.slice(2*e,2*e+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=x.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const n={},i='"';A.lastIndex=0;while(null!==(t=A.exec(e))){let e=t[2];0===e.indexOf(i)&&e.lastIndexOf(i)===e.length-1&&(e=e.slice(1,-1));const r=t[1].trim();n[r]=e}return n}}function I(e){return"ID"!==e&&"CLASS"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function C(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}class R{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const n=t.attr;for(const t in n)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==n[t]){E.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=d(new k({}),n,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=new Date(this.attr["END-DATE"]);h(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(h(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&h(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class M{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var D={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class L{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[D.AUDIO]:null,[D.VIDEO]:null,[D.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const n=e.split("@",2);let i;i=1===n.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class P extends L{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new M,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!h(this.programDateTime))return null;const e=h(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,n,i,r,a=!1){const{elementaryStreams:s}=this,o=s[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,r)):s[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:r,partial:a}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[D.AUDIO]=null,e[D.VIDEO]=null,e[D.AUDIOVIDEO]=null}}class O extends L{constructor(e,t,n,i,r){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new M,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const N=10;class U{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&h(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||N}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){const t=this.driftEnd-this.driftStart;return 1e3*t/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function F(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function B(e){const t=G(e).subarray(0,16),n=new Uint8Array(16);return n.set(t,16-t.length),n}function V(e){const t=function(e,t,n){const i=e[t];e[t]=e[n],e[n]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function j(e){const t=e.split(":");let n=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){const t="base64"===i[0],r=i[1];t?(e.splice(-1,1),n=F(r)):n=B(r)}}return n}function G(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}const H="undefined"!==typeof self?self:void 0;var z={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},K={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function $(e){switch(e){case K.FAIRPLAY:return z.FAIRPLAY;case K.PLAYREADY:return z.PLAYREADY;case K.WIDEVINE:return z.WIDEVINE;case K.CLEARKEY:return z.CLEARKEY}}var W={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function q(e){if(e===W.WIDEVINE)return z.WIDEVINE}function Y(e){switch(e){case z.FAIRPLAY:return K.FAIRPLAY;case z.PLAYREADY:return K.PLAYREADY;case z.WIDEVINE:return K.WIDEVINE;case z.CLEARKEY:return K.CLEARKEY}}function X(e){const{drmSystems:t,widevineLicenseUrl:n}=e,i=t?[z.FAIRPLAY,z.WIDEVINE,z.PLAYREADY,z.CLEARKEY].filter(e=>!!t[e]):[];return!i[z.WIDEVINE]&&n&&i.push(z.WIDEVINE),i}const Q=function(e){return null!=H&&null!=(e=H.navigator)&&e.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Z(e,t,n,i){let r;switch(e){case z.FAIRPLAY:r=["cenc","sinf"];break;case z.WIDEVINE:case z.PLAYREADY:r=["cenc"];break;case z.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return J(r,t,n,i)}function J(e,t,n,i){const r={initDataTypes:e,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:n.map(e=>({contentType:`video/mp4; codecs="${e}"`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))};return[r]}function ee(e,t,n){return Uint8Array.prototype.slice?e.slice(t,n):new Uint8Array(Array.prototype.slice.call(e,t,n))}const te=(e,t)=>{return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},ne=(e,t)=>{return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},ie=(e,t)=>{const n=t;let i=0;while(te(e,t)){i+=10;const n=re(e,t+6);i+=n,ne(e,t+10)&&(i+=10),t+=i}if(i>0)return e.subarray(n,n+i)},re=(e,t)=>{let n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3],n},ae=(e,t)=>{return te(e,t)&&re(e,t+6)+10<=e.length-t},se=e=>{const t=ue(e);for(let n=0;n<t.length;n++){const e=t[n];if(oe(e))return pe(e)}},oe=e=>{return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},le=e=>{const t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=re(e,4),i=10;return{type:t,size:n,data:e.subarray(i,i+n)}},ue=e=>{let t=0;const n=[];while(te(e,t)){const i=re(e,t+6);t+=10;const r=t+i;while(t+8<r){const i=le(e.subarray(t)),r=ce(i);r&&n.push(r),t+=i.size+10}ne(e,t)&&(t+=10)}return n},ce=e=>{return"PRIV"===e.type?de(e):"W"===e.type[0]?fe(e):he(e)},de=e=>{if(e.size<2)return;const t=ge(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}},he=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1;const n=ge(e.data.subarray(t),!0);t+=n.length+1;const i=ge(e.data.subarray(t));return{key:e.type,info:n,data:i}}const t=ge(e.data.subarray(1));return{key:e.type,data:t}},fe=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1;const n=ge(e.data.subarray(t),!0);t+=n.length+1;const i=ge(e.data.subarray(t));return{key:e.type,info:n,data:i}}const t=ge(e.data);return{key:e.type,data:t}},pe=e=>{if(8===e.data.byteLength){const t=new Uint8Array(e.data),n=1&t[3];let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,n&&(i+=47721858.84),Math.round(i)}},ge=(e,t=!1)=>{const n=ve();if(n){const i=n.decode(e);if(t){const e=i.indexOf("\0");return-1!==e?i.substring(0,e):i}return i.replace(/\0/g,"")}const i=e.length;let r,a,s,o="",l=0;while(l<i){if(r=e[l++],0===r&&t)return o;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:a=e[l++],o+=String.fromCharCode((31&r)<<6|63&a);break;case 14:a=e[l++],s=e[l++],o+=String.fromCharCode((15&r)<<12|(63&a)<<6|(63&s)<<0);break}}return o};let me;function ve(){if(!navigator.userAgent.includes("PlayStation 4"))return me||"undefined"===typeof self.TextDecoder||(me=new self.TextDecoder("utf-8")),me}const ye={hexDump:function(e){let t="";for(let n=0;n<e.length;n++){let i=e[n].toString(16);i.length<2&&(i="0"+i),t+=i}return t}},be=Math.pow(2,32)-1,Se=[].push,Te={video:1,audio:2,id3:3,text:4};function _e(e){return String.fromCharCode.apply(null,e)}function we(e,t){const n=e[t]<<8|e[t+1];return n<0?65536+n:n}function Ee(e,t){const n=Ae(e,t);return n<0?4294967296+n:n}function xe(e,t){let n=Ee(e,t);return n*=Math.pow(2,32),n+=Ee(e,t+4),n}function Ae(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function ke(e,t,n){e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}function Ie(e){const t=e.byteLength;for(let n=0;n<t;){const i=Ee(e,n);if(i>8&&109===e[n+4]&&111===e[n+5]&&111===e[n+6]&&102===e[n+7])return!0;n=i>1?n+i:t}return!1}function Ce(e,t){const n=[];if(!t.length)return n;const i=e.byteLength;for(let r=0;r<i;){const a=Ee(e,r),s=_e(e.subarray(r+4,r+8)),o=a>1?r+a:i;if(s===t[0])if(1===t.length)n.push(e.subarray(r+8,o));else{const i=Ce(e.subarray(r+8,o),t.slice(1));i.length&&Se.apply(n,i)}r=o}return n}function Re(e){const t=[],n=e[0];let i=8;const r=Ee(e,i);i+=4;let a=0,s=0;0===n?(a=Ee(e,i),s=Ee(e,i+4),i+=8):(a=xe(e,i),s=xe(e,i+8),i+=16),i+=2;let o=e.length+s;const l=we(e,i);i+=2;for(let u=0;u<l;u++){let n=i;const a=Ee(e,n);n+=4;const s=2147483647&a,l=(2147483648&a)>>>31;if(1===l)return E.warn("SIDX has hierarchical references (not supported)"),null;const u=Ee(e,n);n+=4,t.push({referenceSize:s,subsegmentDuration:u,info:{duration:u/r,start:o,end:o+s-1}}),o+=s,n+=4,i=n}return{earliestPresentationTime:a,timescale:r,version:n,referencesCount:l,references:t}}function Me(e){const t=[],n=Ce(e,["moov","trak"]);for(let r=0;r<n.length;r++){const e=n[r],i=Ce(e,["tkhd"])[0];if(i){let n=i[0];const r=Ee(i,0===n?12:20),a=Ce(e,["mdia","mdhd"])[0];if(a){n=a[0];const i=Ee(a,0===n?12:20),s=Ce(e,["mdia","hdlr"])[0];if(s){const n=_e(s.subarray(8,12)),a={soun:D.AUDIO,vide:D.VIDEO}[n];if(a){const n=Ce(e,["mdia","minf","stbl","stsd"])[0],s=De(n);t[r]={timescale:i,type:a},t[a]=o({timescale:i,id:r},s)}}}}}const i=Ce(e,["moov","mvex","trex"]);return i.forEach(e=>{const n=Ee(e,4),i=t[n];i&&(i.default={duration:Ee(e,12),flags:Ee(e,20)})}),t}function De(e){const t=e.subarray(8),n=t.subarray(86),i=_e(t.subarray(4,8));let r=i;const a="enca"===i||"encv"===i;if(a){const e=Ce(t,[i])[0],n=e.subarray("enca"===i?28:78),a=Ce(n,["sinf"]);a.forEach(e=>{const t=Ce(e,["schm"])[0];if(t){const n=_e(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=Ce(e,["frma"])[0];t&&(r=_e(t))}}})}switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const e=Ce(n,["avcC"])[0];r+="."+Pe(e[1])+Pe(e[2])+Pe(e[3]);break}case"mp4a":{const e=Ce(t,[i])[0],n=Ce(e.subarray(28),["esds"])[0];if(n&&n.length>12){let e=4;if(3!==n[e++])break;e=Le(n,e),e+=2;const t=n[e++];if(128&t&&(e+=2),64&t&&(e+=n[e++]),4!==n[e++])break;e=Le(n,e);const i=n[e++];if(64!==i)break;if(r+="."+Pe(i),e+=12,5!==n[e++])break;e=Le(n,e);const a=n[e++];let s=(248&a)>>3;31===s&&(s+=1+((7&a)<<3)+((224&n[e])>>5)),r+="."+s}break}case"hvc1":case"hev1":{const e=Ce(n,["hvcC"])[0],t=e[1],i=["","A","B","C"][t>>6],a=31&t,s=Ee(e,2),o=(32&t)>>5?"H":"L",l=e[12],u=e.subarray(6,12);r+="."+i+a,r+="."+s.toString(16).toUpperCase(),r+="."+o+l;let c="";for(let n=u.length;n--;){const e=u[n];if(e||c){const t=e.toString(16).toUpperCase();c="."+t+c}}r+=c;break}case"dvh1":case"dvhe":{const e=Ce(n,["dvcC"])[0],t=e[2]>>1&127,i=e[2]<<5&32|e[3]>>3&31;r+="."+Oe(t)+"."+Oe(i);break}case"vp09":{const e=Ce(n,["vpcC"])[0],t=e[4],i=e[5],a=e[6]>>4&15;r+="."+Oe(t)+"."+Oe(i)+"."+Oe(a);break}case"av01":{const e=Ce(n,["av1C"])[0],t=e[1]>>>5,i=31&e[1],a=e[2]>>>7?"H":"M",s=(64&e[2])>>6,o=(32&e[2])>>5,l=2===t&&s?o?12:10:s?10:8,u=(16&e[2])>>4,c=(8&e[2])>>3,d=(4&e[2])>>2,h=3&e[2],f=1,p=1,g=1,m=0;r+="."+t+"."+Oe(i)+a+"."+Oe(l)+"."+u+"."+c+d+h+"."+Oe(f)+"."+Oe(p)+"."+Oe(g)+"."+m;break}}return{codec:r,encrypted:a}}function Le(e,t){const n=t+5;while(128&e[t++]&&t<n);return t}function Pe(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function Oe(e){return(e<10?"0":"")+e}function Ne(e,t){if(!e||!t)return e;const n=t.keyId;if(n&&t.isCommonEncryption){const t=Ce(e,["moov","trak"]);t.forEach(e=>{const t=Ce(e,["mdia","minf","stbl","stsd"])[0],i=t.subarray(8);let r=Ce(i,["enca"]);const a=r.length>0;a||(r=Ce(i,["encv"])),r.forEach(e=>{const t=a?e.subarray(28):e.subarray(78),i=Ce(t,["sinf"]);i.forEach(e=>{const t=Ue(e);if(t){const e=t.subarray(8,24);e.some(e=>0!==e)||(E.log(`[eme] Patching keyId in 'enc${a?"a":"v"}>sinf>>tenc' box: ${ye.hexDump(e)} -> ${ye.hexDump(n)}`),t.set(n,8))}})})})}return e}function Ue(e){const t=Ce(e,["schm"])[0];if(t){const n=_e(t.subarray(4,8));if("cbcs"===n||"cenc"===n)return Ce(e,["schi","tenc"])[0]}return E.error("[eme] missing 'schm' box"),null}function Fe(e,t){return Ce(t,["moof","traf"]).reduce((t,n)=>{const i=Ce(n,["tfdt"])[0],r=i[0],a=Ce(n,["tfhd"]).reduce((t,n)=>{const a=Ee(n,4),s=e[a];if(s){let e=Ee(i,4);if(1===r){if(e===be)return E.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=be+1,e+=Ee(i,8)}const n=s.timescale||9e4,a=e/n;if(h(a)&&(null===t||a<t))return a}return t},null);return null!==a&&h(a)&&(null===t||a<t)?a:t},null)}function Be(e,t){let n=0,i=0,r=0;const a=Ce(e,["moof","traf"]);for(let s=0;s<a.length;s++){const e=a[s],o=Ce(e,["tfhd"])[0],l=Ee(o,4),u=t[l];if(!u)continue;const c=u.default,d=Ee(o,0)|(null==c?void 0:c.flags);let h=null==c?void 0:c.duration;8&d&&(h=Ee(o,2&d?12:8));const f=u.timescale||9e4,p=Ce(e,["trun"]);for(let t=0;t<p.length;t++){if(n=Ve(p[t]),!n&&h){const e=Ee(p[t],4);n=h*e}u.type===D.VIDEO?i+=n/f:u.type===D.AUDIO&&(r+=n/f)}}if(0===i&&0===r){let t=1/0,n=0,i=0;const r=Ce(e,["sidx"]);for(let e=0;e<r.length;e++){const a=Re(r[e]);if(null!=a&&a.references){t=Math.min(t,a.earliestPresentationTime/a.timescale);const e=a.references.reduce((e,t)=>e+t.info.duration||0,0);n=Math.max(n,e+a.earliestPresentationTime/a.timescale),i=n-t}}if(i&&h(i))return i}return i||r}function Ve(e){const t=Ee(e,0);let n=8;1&t&&(n+=4),4&t&&(n+=4);let i=0;const r=Ee(e,4);for(let a=0;a<r;a++){if(256&t){const t=Ee(e,n);i+=t,n+=4}512&t&&(n+=4),1024&t&&(n+=4),2048&t&&(n+=4)}return i}function je(e,t,n){Ce(t,["moof","traf"]).forEach(t=>{Ce(t,["tfhd"]).forEach(i=>{const r=Ee(i,4),a=e[r];if(!a)return;const s=a.timescale||9e4;Ce(t,["tfdt"]).forEach(e=>{const t=e[0],i=n*s;if(i){let n=Ee(e,4);if(0===t)n-=i,n=Math.max(n,0),ke(e,4,n);else{n*=Math.pow(2,32),n+=Ee(e,8),n-=i,n=Math.max(n,0);const t=Math.floor(n/(be+1)),r=Math.floor(n%(be+1));ke(e,4,t),ke(e,8,r)}}})})})}function Ge(e){const t={valid:null,remainder:null},n=Ce(e,["moof"]);if(n.length<2)return t.remainder=e,t;const i=n[n.length-1];return t.valid=ee(e,0,i.byteOffset-8),t.remainder=ee(e,i.byteOffset-8),t}function He(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function ze(e,t){const n=[],i=t.samples,r=t.timescale,a=t.id;let s=!1;const o=Ce(i,["moof"]);return o.map(o=>{const l=o.byteOffset-8,u=Ce(o,["traf"]);u.map(o=>{const u=Ce(o,["tfdt"]).map(e=>{const t=e[0];let n=Ee(e,4);return 1===t&&(n*=Math.pow(2,32),n+=Ee(e,8)),n/r})[0];return void 0!==u&&(e=u),Ce(o,["tfhd"]).map(u=>{const c=Ee(u,4),d=16777215&Ee(u,0),h=0!==(1&d),f=0!==(2&d),p=0!==(8&d);let g=0;const m=0!==(16&d);let v=0;const y=0!==(32&d);let b=8;c===a&&(h&&(b+=8),f&&(b+=4),p&&(g=Ee(u,b),b+=4),m&&(v=Ee(u,b),b+=4),y&&(b+=4),"video"===t.type&&(s=Ke(t.codec)),Ce(o,["trun"]).map(a=>{const o=a[0],u=16777215&Ee(a,0),c=0!==(1&u);let d=0;const h=0!==(4&u),f=0!==(256&u);let p=0;const m=0!==(512&u);let y=0;const b=0!==(1024&u),S=0!==(2048&u);let T=0;const _=Ee(a,4);let w=8;c&&(d=Ee(a,w),w+=4),h&&(w+=4);let E=d+l;for(let l=0;l<_;l++){if(f?(p=Ee(a,w),w+=4):p=g,m?(y=Ee(a,w),w+=4):y=v,b&&(w+=4),S&&(T=0===o?Ee(a,w):Ae(a,w),w+=4),t.type===D.VIDEO){let t=0;while(t<y){const a=Ee(i,E);if(E+=4,$e(s,i[E])){const t=i.subarray(E,E+a);We(t,s?2:1,e+T/r,n)}E+=a,t+=a+4}}e+=p/r}}))})})}),n}function Ke(e){if(!e)return!1;const t=e.indexOf("."),n=t<0?e:e.substring(0,t);return"hvc1"===n||"hev1"===n||"dvh1"===n||"dvhe"===n}function $e(e,t){if(e){const e=t>>1&63;return 39===e||40===e}{const e=31&t;return 6===e}}function We(e,t,n,i){const r=qe(e);let a=0;a+=t;let s=0,o=0,l=0;while(a<r.length){s=0;do{if(a>=r.length)break;l=r[a++],s+=l}while(255===l);o=0;do{if(a>=r.length)break;l=r[a++],o+=l}while(255===l);const e=r.length-a;let t=a;if(o<e)a+=o;else if(o>e){E.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===s){const e=r[t++];if(181===e){const e=we(r,t);if(t+=2,49===e){const e=Ee(r,t);if(t+=4,1195456820===e){const e=r[t++];if(3===e){const a=r[t++],o=31&a,l=64&a,u=l?2+3*o:0,c=new Uint8Array(u);if(l){c[0]=a;for(let e=1;e<u;e++)c[e]=r[t++]}i.push({type:e,payloadType:s,pts:n,bytes:c})}}}}}else if(5===s&&o>16){const e=[];for(let n=0;n<16;n++){const i=r[t++].toString(16);e.push(1==i.length?"0"+i:i),3!==n&&5!==n&&7!==n&&9!==n||e.push("-")}const a=o-16,l=new Uint8Array(a);for(let n=0;n<a;n++)l[n]=r[t++];i.push({payloadType:s,pts:n,uuid:e.join(""),userData:ge(l),userDataBytes:l})}}}function qe(e){const t=e.byteLength,n=[];let i=1;while(i<t-2)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(0===n.length)return e;const r=t-n.length,a=new Uint8Array(r);let s=0;for(i=0;i<r;s++,i++)s===n[0]&&(s++,n.shift()),a[i]=e[s];return a}function Ye(e){const t=e[0];let n="",i="",r=0,a=0,s=0,o=0,l=0,u=0;if(0===t){while("\0"!==_e(e.subarray(u,u+1)))n+=_e(e.subarray(u,u+1)),u+=1;n+=_e(e.subarray(u,u+1)),u+=1;while("\0"!==_e(e.subarray(u,u+1)))i+=_e(e.subarray(u,u+1)),u+=1;i+=_e(e.subarray(u,u+1)),u+=1,r=Ee(e,12),a=Ee(e,16),o=Ee(e,20),l=Ee(e,24),u=28}else if(1===t){u+=4,r=Ee(e,u),u+=4;const t=Ee(e,u);u+=4;const a=Ee(e,u);u+=4,s=2**32*t+a,f(s)||(s=Number.MAX_SAFE_INTEGER,E.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Ee(e,u),u+=4,l=Ee(e,u),u+=4;while("\0"!==_e(e.subarray(u,u+1)))n+=_e(e.subarray(u,u+1)),u+=1;n+=_e(e.subarray(u,u+1)),u+=1;while("\0"!==_e(e.subarray(u,u+1)))i+=_e(e.subarray(u,u+1)),u+=1;i+=_e(e.subarray(u,u+1)),u+=1}const c=e.subarray(u,e.byteLength);return{schemeIdUri:n,value:i,timeScale:r,presentationTime:s,presentationTimeDelta:a,eventDuration:o,id:l,payload:c}}function Xe(e,...t){const n=t.length;let i=8,r=n;while(r--)i+=t[r].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4),r=0,i=8;r<n;r++)a.set(t[r],i),i+=t[r].byteLength;return a}function Qe(e,t,n){if(16!==e.byteLength)throw new RangeError("Invalid system id");let i,r,a;if(t){i=1,r=new Uint8Array(16*t.length);for(let e=0;e<t.length;e++){const n=t[e];if(16!==n.byteLength)throw new RangeError("Invalid key");r.set(n,16*e)}}else i=0,r=new Uint8Array;i>0?(a=new Uint8Array(4),t.length>0&&new DataView(a.buffer).setUint32(0,t.length,!1)):a=new Uint8Array;const s=new Uint8Array(4);return n&&n.byteLength>0&&new DataView(s.buffer).setUint32(0,n.byteLength,!1),Xe([112,115,115,104],new Uint8Array([i,0,0,0]),e,a,r,s,n||new Uint8Array)}function Ze(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},n=new DataView(e),i=n.getUint32(0);if(e.byteLength!==i&&i>44)return null;const r=n.getUint32(4);if(1886614376!==r)return null;if(t.version=n.getUint32(8)>>>24,t.version>1)return null;t.systemId=ye.hexDump(new Uint8Array(e,12,16));const a=n.getUint32(28);if(0===t.version){if(i-32<a)return null;t.data=new Uint8Array(e,32,a)}else if(1===t.version){t.kids=[];for(let n=0;n<a;n++)t.kids.push(new Uint8Array(e,32+16*n,16))}return t}let Je={};class et{static clearKeyUriToKeyIdMap(){Je={}}constructor(e,t,n,i=[1],r=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case K.FAIRPLAY:case K.WIDEVINE:case K.PLAYREADY:case K.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!==typeof e&&("AES-128"!==this.method||this.iv||E.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=tt(e),n=new et(this.method,this.uri,"identity",this.keyFormatVersions,t);return n}const t=j(this.uri);if(t)switch(this.keyFormat){case K.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case K.PLAYREADY:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Qe(e,null,t);const n=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),i=String.fromCharCode.apply(null,Array.from(n)),r=i.substring(i.indexOf("<"),i.length),a=new DOMParser,s=a.parseFromString(r,"text/xml"),o=s.getElementsByTagName("KID")[0];if(o){const e=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(e){const t=F(e).subarray(0,16);V(t),this.keyId=t}}break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=Je[this.uri];if(!e){const t=Object.keys(Je).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);const n=new DataView(e.buffer,12,4);n.setUint32(0,t),Je[this.uri]=e}this.keyId=e}return this}}function tt(e){const t=new Uint8Array(16);for(let n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}const nt=/\{\$([a-zA-Z0-9-_]+)\}/g;function it(e){return nt.test(e)}function rt(e,t,n){if(null!==e.variableList||e.hasVariableRefs)for(let i=n.length;i--;){const r=n[i],a=t[r];a&&(t[r]=at(e,a))}}function at(e,t){if(null!==e.variableList||e.hasVariableRefs){const n=e.variableList;return t.replace(nt,t=>{const i=t.substring(2,t.length-1),r=null==n?void 0:n[i];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),t):r})}return t}function st(e,t,n){let i,r,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{const t=new self.URL(n).searchParams;if(!t.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${n}"`);r=t.get(i)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else i=t.NAME,r=t.VALUE;i in a?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):a[i]=r||""}function ot(e,t,n){const i=t.IMPORT;if(n&&i in n){let t=e.variableList;t||(e.variableList=t={}),t[i]=n[i]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function lt(e=!0){if("undefined"===typeof self)return;const t=(e||!self.MediaSource)&&self.ManagedMediaSource;return t||self.MediaSource||self.WebKitMediaSource}function ut(e){return"undefined"!==typeof self&&e===self.ManagedMediaSource}const ct={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function dt(e,t){const n=ct[t];return!!n&&!!n[e.slice(0,4)]}function ht(e,t,n=!0){return!e.split(",").some(e=>!ft(e,t,n))}function ft(e,t,n=!0){var i;const r=lt(n);return null!=(i=null==r?void 0:r.isTypeSupported(pt(e,t)))&&i}function pt(e,t){return`${t}/mp4;codecs="${e}"`}function gt(e){if(e){const t=e.substring(0,4);return ct.video[t]}return 2}function mt(e){return e.split(",").reduce((e,t)=>{const n=ct.video[t];return n?(2*n+e)/(e?3:2):(ct.audio[t]+e)/(e?2:1)},0)}const vt={};function yt(e,t=!0){if(vt[e])return vt[e];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[e];for(let i=0;i<n.length;i++)if(ft(n[i],"audio",t))return vt[e]=n[i],n[i];return e}const bt=/flac|opus/i;function St(e,t=!0){return e.replace(bt,e=>yt(e.toLowerCase(),t))}function Tt(e,t){return e&&"mp4a"!==e?e:t?t.split(",")[0]:t}function _t(e){const t=e.split(",");for(let n=0;n<t.length;n++){const e=t[n].split(".");if(e.length>2){let i=e.shift()+".";i+=parseInt(e.shift()).toString(16),i+=("000"+parseInt(e.shift()).toString(16)).slice(-4),t[n]=i}}return t.join(",")}const wt=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Et=/#EXT-X-MEDIA:(.*)/g,xt=/^#EXT(?:INF|-X-TARGETDURATION):/m,At=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),kt=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class It{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return xt.test(e)}static parseMasterPlaylist(e,t){const n=it(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},r=[];let a;wt.lastIndex=0;while(null!=(a=wt.exec(e)))if(a[1]){var s;const e=new k(a[1]);rt(i,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const n=at(i,a[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:It.resolve(n,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),Mt(e.CODECS,o),null!=(s=o.unknownCodecs)&&s.length||r.push(o),i.levels.push(o)}else if(a[3]){const e=a[3],n=a[4];switch(e){case"SESSION-DATA":{const e=new k(n);rt(i,e,["DATA-ID","LANGUAGE","VALUE","URI"]);const t=e["DATA-ID"];t&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[t]=e);break}case"SESSION-KEY":{const e=Ct(n,t,i);e.encrypted&&e.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(e)):E.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${n}"`);break}case"DEFINE":{const e=new k(n);rt(i,e,["NAME","VALUE","QUERYPARAM"]),st(i,e,t)}break;case"CONTENT-STEERING":{const e=new k(n);rt(i,e,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:It.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":i.startTimeOffset=Rt(n);break}}const o=r.length>0&&r.length<i.levels.length;return i.levels=o?r:i.levels,0===i.levels.length&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,n){let i;const r={},a=n.levels,s={AUDIO:a.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:a.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;Et.lastIndex=0;while(null!==(i=Et.exec(e))){const e=new k(i[1]),a=e.TYPE;if(a){const i=s[a],l=r[a]||[];r[a]=l,rt(n,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const u=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],d=e.CHANNELS,h=e.CHARACTERISTICS,f=e["INSTREAM-ID"],p={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||u||"",type:a,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:u,url:e.URI?It.resolve(e.URI,t):""};if(c&&(p.assocLang=c),d&&(p.channels=d),h&&(p.characteristics=h),f&&(p.instreamId=f),null!=i&&i.length){const e=It.findGroup(i,p.groupId)||i[0];Dt(p,e,"audioCodec"),Dt(p,e,"textCodec")}l.push(p)}}return r}static parseLevelPlaylist(e,t,n,i,r,a){const s=new U(t),o=s.fragments;let l,u,c,f=null,p=0,g=0,m=0,v=0,y=null,b=new P(i,t),S=-1,T=!1,_=null;At.lastIndex=0,s.m3u8=e,s.hasVariableRefs=it(e);while(null!==(l=At.exec(e))){T&&(T=!1,b=new P(i,t),b.start=m,b.sn=p,b.cc=v,b.level=n,f&&(b.initSegment=f,b.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null,_&&(b.setByteRange(_),_=null)));const e=l[1];if(e){b.duration=parseFloat(e);const t=(" "+l[2]).slice(1);b.title=t||null,b.tagList.push(t?["INF",e,t]:["INF",e])}else if(l[3]){if(h(b.duration)){b.start=m,c&&Nt(b,c,s),b.sn=p,b.level=n,b.cc=v,o.push(b);const e=(" "+l[3]).slice(1);b.relurl=at(s,e),Pt(b,y),y=b,m+=b.duration,p++,g=0,T=!0}}else if(l[4]){const e=(" "+l[4]).slice(1);y?b.setByteRange(e,y):b.setByteRange(e)}else if(l[5])b.rawProgramDateTime=(" "+l[5]).slice(1),b.tagList.push(["PROGRAM-DATE-TIME",b.rawProgramDateTime]),-1===S&&(S=o.length);else{if(l=l[0].match(kt),!l){E.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<l.length;u++)if("undefined"!==typeof l[u])break;const e=(" "+l[u]).slice(1),r=(" "+l[u+1]).slice(1),m=l[u+2]?(" "+l[u+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":s.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":p=s.startSN=parseInt(r);break;case"SKIP":{const e=new k(r);rt(s,e,["RECENTLY-REMOVED-DATERANGES"]);const t=e.decimalInteger("SKIPPED-SEGMENTS");if(h(t)){s.skippedSegments=t;for(let e=t;e--;)o.unshift(null);p+=t}const n=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");n&&(s.recentlyRemovedDateranges=n.split("\t"));break}case"TARGETDURATION":s.targetduration=Math.max(parseInt(r),1);break;case"VERSION":s.version=parseInt(r);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":s.live=!1;break;case"#":(r||m)&&b.tagList.push(m?[r,m]:[r]);break;case"DISCONTINUITY":v++,b.tagList.push(["DIS"]);break;case"GAP":b.gap=!0,b.tagList.push([e]);break;case"BITRATE":b.tagList.push([e,r]);break;case"DATERANGE":{const e=new k(r);rt(s,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),rt(s,e,e.clientAttrs);const t=new R(e,s.dateRanges[e.ID]);t.isValid||s.skippedSegments?s.dateRanges[t.id]=t:E.warn(`Ignoring invalid DATERANGE tag: "${r}"`),b.tagList.push(["EXT-X-DATERANGE",r]);break}case"DEFINE":{const e=new k(r);rt(s,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?ot(s,e,a):st(s,e,t)}break;case"DISCONTINUITY-SEQUENCE":v=parseInt(r);break;case"KEY":{const e=Ct(r,t,s);if(e.isSupported()){if("NONE"===e.method){c=void 0;break}c||(c={}),c[e.keyFormat]&&(c=d({},c)),c[e.keyFormat]=e}else E.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${r}"`);break}case"START":s.startTimeOffset=Rt(r);break;case"MAP":{const e=new k(r);if(rt(s,e,["BYTERANGE","URI"]),b.duration){const r=new P(i,t);Ot(r,e,n,c),f=r,b.initSegment=f,f.rawProgramDateTime&&!b.rawProgramDateTime&&(b.rawProgramDateTime=f.rawProgramDateTime)}else{const t=b.byteRangeEndOffset;if(t){const e=b.byteRangeStartOffset;_=`${t-e}@${e}`}else _=null;Ot(b,e,n,c),f=b,T=!0}break}case"SERVER-CONTROL":{const e=new k(r);s.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),s.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),s.canSkipDateRanges=s.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),s.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),s.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const e=new k(r);s.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=s.partList;e||(e=s.partList=[]);const n=g>0?e[e.length-1]:void 0,i=g++,a=new k(r);rt(s,a,["BYTERANGE","URI"]);const o=new O(a,b,t,i,n);e.push(o),b.duration+=o.duration;break}case"PRELOAD-HINT":{const e=new k(r);rt(s,e,["URI"]),s.preloadHint=e;break}case"RENDITION-REPORT":{const e=new k(r);rt(s,e,["URI"]),s.renditionReports=s.renditionReports||[],s.renditionReports.push(e);break}default:E.warn(`line parsed but not handled: ${l}`);break}}}y&&!y.relurl?(o.pop(),m-=y.duration,s.partList&&(s.fragmentHint=y)):s.partList&&(Pt(b,y),b.cc=v,s.fragmentHint=b,c&&Nt(b,c,s));const w=o.length,x=o[0],A=o[w-1];if(m+=s.skippedSegments*s.targetduration,m>0&&w&&A){s.averagetargetduration=m/w;const e=A.sn;s.endSN="initSegment"!==e?e:0,s.live||(A.endList=!0),x&&(s.startCC=x.cc)}else s.endSN=0,s.startCC=0;return s.fragmentHint&&(m+=s.fragmentHint.duration),s.totalduration=m,s.endCC=v,S>0&&Lt(o,S),s}}function Ct(e,t,n){var i,r;const a=new k(e);rt(n,a,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const s=null!=(i=a.METHOD)?i:"",o=a.URI,l=a.hexadecimalInteger("IV"),u=a.KEYFORMATVERSIONS,c=null!=(r=a.KEYFORMAT)?r:"identity";o&&a.IV&&!l&&E.error(`Invalid IV: ${a.IV}`);const d=o?It.resolve(o,t):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new et(s,d,c,h,l)}function Rt(e){const t=new k(e),n=t.decimalFloatingPoint("TIME-OFFSET");return h(n)?n:null}function Mt(e,t){let n=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const i=n.filter(t=>dt(t,e));i.length&&(t[`${e}Codec`]=i.join(","),n=n.filter(e=>-1===i.indexOf(e)))}),t.unknownCodecs=n}function Dt(e,t,n){const i=t[n];i&&(e[n]=i)}function Lt(e,t){let n=e[t];for(let i=t;i--;){const t=e[i];if(!t)return;t.programDateTime=n.programDateTime-1e3*t.duration,n=t}}function Pt(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),h(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function Ot(e,t,n,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=n,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function Nt(e,t,n){e.levelkeys=t;const{encryptedFragments:i}=n;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||i.push(e)}var Ut={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ft={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Bt(e){const{type:t}=e;switch(t){case Ut.AUDIO_TRACK:return Ft.AUDIO;case Ut.SUBTITLE_TRACK:return Ft.SUBTITLE;default:return Ft.MAIN}}function Vt(e,t){let n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n}class jt{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(g.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_LOADING,this.onLevelLoading,this),e.off(g.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(g.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,r=n||i,a=new r(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ut.MANIFEST,url:n,deliveryDirectives:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:r,url:a,deliveryDirectives:s}=t;this.load({id:n,level:i,pathwayId:r,responseType:"text",type:Ut.LEVEL,url:a,deliveryDirectives:s})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:r,deliveryDirectives:a}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:Ut.AUDIO_TRACK,url:r,deliveryDirectives:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:r,deliveryDirectives:a}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:Ut.SUBTITLE_TRACK,url:r,deliveryDirectives:a})}load(e){var t;const n=this.hls.config;let i,r=this.getInternalLoader(e);if(r){const t=r.context;if(t&&t.url===e.url&&t.level===e.level)return void E.trace("[playlist-loader]: playlist request ongoing");E.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}if(i=e.type===Ut.MANIFEST?n.manifestLoadPolicy.default:d({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),h(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===Ut.LEVEL&&null!==e.level?t=this.hls.levels[e.level].details:e.type===Ut.AUDIO_TRACK&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===Ut.SUBTITLE_TRACK&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,n=t.targetduration;if(e&&n){const t=1e3*Math.max(3*e,.8*n);i=d({},i,{maxTimeToFirstByteMs:Math.min(t,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,i.maxTimeToFirstByteMs)})}}}const a=i.errorRetry||i.timeoutRetry||{},s={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},o={onSuccess:(e,t,n,i)=>{const r=this.getInternalLoader(n);this.resetInternalLoader(n.type);const a=e.data;0===a.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),It.isMediaPlaylist(a)?this.handleTrackOrLevelPlaylist(e,t,n,i||null,r):this.handleMasterPlaylist(e,t,n,i)):this.handleManifestParsingError(e,n,new Error("no EXTM3U delimiter"),i||null,t)},onError:(e,t,n,i)=>{this.handleNetworkError(t,n,!1,e,i)},onTimeout:(e,t,n)=>{this.handleNetworkError(t,n,!0,void 0,e)}};r.load(e,s,o)}handleMasterPlaylist(e,t,n,i){const r=this.hls,a=e.data,s=Vt(e,n),o=It.parseMasterPlaylist(a,s);if(o.playlistParsingError)return void this.handleManifestParsingError(e,n,o.playlistParsingError,i,t);const{contentSteering:l,levels:u,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f}=o;this.variableList=f;const{AUDIO:p=[],SUBTITLES:m,"CLOSED-CAPTIONS":v}=It.parseMasterPlaylistMedia(a,s,o);if(p.length){const e=p.some(e=>!e.url);e||!u[0].audioCodec||u[0].attrs.AUDIO||(E.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new k({}),bitrate:0,url:""}))}r.trigger(g.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:m,captions:v,contentSteering:l,url:s,stats:t,networkDetails:i,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f})}handleTrackOrLevelPlaylist(e,t,n,i,r){const a=this.hls,{id:s,level:o,type:l}=n,u=Vt(e,n),c=0,d=h(o)?o:h(s)?s:0,f=Bt(n),p=It.parseLevelPlaylist(e.data,u,d,f,c,this.variableList);if(l===Ut.MANIFEST){const e={attrs:new k({}),bitrate:0,details:p,name:"",url:u};a.trigger(g.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:u,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=p,this.handlePlaylistLoaded(p,e,t,n,i,r)}handleManifestParsingError(e,t,n,i,r){this.hls.trigger(g.ERROR,{type:m.NETWORK_ERROR,details:v.MANIFEST_PARSING_ERROR,fatal:t.type===Ut.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t,n=!1,i,r){let a=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Ut.LEVEL?a+=`: ${e.level} id: ${e.id}`:e.type!==Ut.AUDIO_TRACK&&e.type!==Ut.SUBTITLE_TRACK||(a+=` id: ${e.id} group-id: "${e.groupId}"`);const s=new Error(a);E.warn(`[playlist-loader]: ${a}`);let l=v.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case Ut.MANIFEST:l=n?v.MANIFEST_LOAD_TIMEOUT:v.MANIFEST_LOAD_ERROR,u=!0;break;case Ut.LEVEL:l=n?v.LEVEL_LOAD_TIMEOUT:v.LEVEL_LOAD_ERROR,u=!1;break;case Ut.AUDIO_TRACK:l=n?v.AUDIO_TRACK_LOAD_TIMEOUT:v.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Ut.SUBTITLE_TRACK:l=n?v.SUBTITLE_TRACK_LOAD_TIMEOUT:v.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:m.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:s,networkDetails:t,stats:r};if(i){const n=(null==t?void 0:t.url)||e.url;d.response=o({url:n,data:void 0},i)}this.hls.trigger(g.ERROR,d)}handlePlaylistLoaded(e,t,n,i,r,a){const s=this.hls,{type:o,level:l,id:u,groupId:c,deliveryDirectives:d}=i,h=Vt(t,i),f=Bt(i),p="number"===typeof i.level&&f===Ft.MAIN?l:void 0;if(!e.fragments.length){const e=new Error("No Segments found in Playlist");return void s.trigger(g.ERROR,{type:m.NETWORK_ERROR,details:v.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:e,reason:e.message,response:t,context:i,level:p,parent:f,networkDetails:r,stats:n})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const y=e.playlistParsingError;if(y)s.trigger(g.ERROR,{type:m.NETWORK_ERROR,details:v.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:y,reason:y.message,response:t,context:i,level:p,parent:f,networkDetails:r,stats:n});else switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Ut.MANIFEST:case Ut.LEVEL:s.trigger(g.LEVEL_LOADED,{details:e,level:p||0,id:u||0,stats:n,networkDetails:r,deliveryDirectives:d});break;case Ut.AUDIO_TRACK:s.trigger(g.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:n,networkDetails:r,deliveryDirectives:d});break;case Ut.SUBTITLE_TRACK:s.trigger(g.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:n,networkDetails:r,deliveryDirectives:d});break}}}function Gt(e,t){let n;try{n=new Event("addtrack")}catch(e){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function Ht(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(n){E.debug(`[texttrack-utils]: ${n}`);try{const n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(e){E.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===n&&(e.mode=n)}function zt(e){const t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let n=e.cues.length;n--;)e.removeCue(e.cues[n]);"disabled"===t&&(e.mode=t)}function Kt(e,t,n,i){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=Wt(e.cues,t,n);for(let t=0;t<r.length;t++)i&&!i(r[t])||e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}function $t(e,t){if(t<e[0].startTime)return 0;const n=e.length-1;if(t>e[n].endTime)return-1;let i=0,r=n;while(i<=r){const a=Math.floor((r+i)/2);if(t<e[a].startTime)r=a-1;else{if(!(t>e[a].startTime&&i<n))return a;i=a+1}}return e[i].startTime-t<t-e[r].startTime?i:r}function Wt(e,t,n){const i=[],r=$t(e,t);if(r>-1)for(let a=r,s=e.length;a<s;a++){const r=e[a];if(r.startTime>=t&&r.endTime<=n)i.push(r);else if(r.startTime>n)return i}return i}function qt(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[n])}return t}var Yt={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const Xt=.25;function Qt(){if("undefined"!==typeof self)return self.VTTCue||self.TextTrackCue}function Zt(e,t,n,i,r){let a=new e(t,n,"");try{a.value=i,r&&(a.type=r)}catch(s){a=new e(t,n,JSON.stringify(r?o({type:r},i):i))}return a}const Jt=(()=>{const e=Qt();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function en(e,t){return e.getTime()/1e3-t}function tn(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class nn{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(zt(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if("metadata"===n.kind&&"id3"===n.label)return Gt(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:i}}}=this;if(!n&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Qt();if(a)for(let s=0;s<r.length;s++){const e=r[s].type;if(e===Yt.emsg&&!n||!i)continue;const t=ue(r[s].data);if(t){const n=r[s].pts;let i=n+r[s].duration;i>Jt&&(i=Jt);const o=i-n;o<=0&&(i=n+Xt);for(let r=0;r<t.length;r++){const s=t[r];if(!oe(s)){this.updateId3CueEnds(n,e);const t=Zt(a,n,i,s,e);t&&this.id3Track.addCue(t)}}}}}updateId3CueEnds(e,t){var n;const i=null==(n=this.id3Track)?void 0:n.cues;if(i)for(let r=i.length;r--;){const n=i[r];n.type===t&&n.startTime<e&&n.endTime===Jt&&(n.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:i}){const{id3Track:r,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:s,enableID3MetadataCues:o}}=a;if(r&&(s||o)){let e;e="audio"===i?e=>e.type===Yt.audioId3&&o:"video"===i?e=>e.type===Yt.emsg&&s:e=>e.type===Yt.audioId3&&o||e.type===Yt.emsg&&s,Kt(r,t,n,e)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:n,id3Track:i}=this,{dateRanges:r}=t,a=Object.keys(r);if(i){const e=Object.keys(n).filter(e=>!a.includes(e));for(let t=e.length;t--;){const r=e[t];Object.keys(n[r].cues).forEach(e=>{i.removeCue(n[r].cues[e])}),delete n[r]}}const s=t.fragments[t.fragments.length-1];if(0===a.length||!h(null==s?void 0:s.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=s.programDateTime/1e3-s.start,l=Qt();for(let u=0;u<a.length;u++){const e=a[u],t=r[e],i=en(t.startDate,o),s=n[e],c=(null==s?void 0:s.cues)||{};let d=(null==s?void 0:s.durationKnown)||!1,h=Jt;const f=t.endDate;if(f)h=en(f,o),d=!0;else if(t.endOnNext&&!d){const e=a.reduce((e,n)=>{if(n!==t.id){const i=r[n];if(i.class===t.class&&i.startDate>t.startDate&&(!e||t.startDate<e.startDate))return i}return e},null);e&&(h=en(e.startDate,o),d=!0)}const p=Object.keys(t.attr);for(let n=0;n<p.length;n++){const r=p[n];if(!I(r))continue;const a=c[r];if(a)d&&!s.durationKnown&&(a.endTime=h);else if(l){let n=t.attr[r];C(r)&&(n=tn(n));const a=Zt(l,i,h,{key:r,data:n},Yt.dateRange);a&&(a.id=e,this.id3Track.addCue(a),c[r]=a)}}n[e]={cues:c,dateRange:t,durationKnown:d}}}}class rn{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=(()=>this.timeupdate()),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:a,lowLatencyMode:s}=this.config,o=this.hls.userConfig;let l=s&&n||t;(o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:a*i);const u=i,c=1;return l+Math.min(this.stallCount*c,u)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,n=this.levelDetails;if(null===e||null===t||null===n)return null;const i=n.edge,r=e-t-this.edgeStalled,a=i-n.totalduration,s=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,r),s)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(g.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(g.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(g.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(g.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var n;t.details===v.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(n=this.levelDetails)&&n.live&&E.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:r}=this.config;if(!i||1===r||!t.live)return;const a=this.targetLatency;if(null===a)return;const s=n-a,o=Math.min(this.maxLatency,a+t.targetduration),l=s<o;if(l&&s>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),n=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20;e.playbackRate=Math.min(t,Math.max(1,n))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const an=["NONE","TYPE-0","TYPE-1",null];function sn(e){return an.indexOf(e)>-1}const on=["SDR","PQ","HLG"];function ln(e){return!!e&&on.indexOf(e)>-1}var un={No:"",Yes:"YES",v2:"v2"};function cn(e){const{canSkipUntil:t,canSkipDateRanges:n,age:i}=e,r=i<t/2;return t&&r?n?un.v2:un.Yes:un.No}class dn{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class hn{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return fn(this._audioGroups,e)}hasSubtitleGroup(e){return fn(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function fn(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function pn(e,t){const n=t.startPTS;if(h(n)){let i,r=0;t.sn>e.sn?(r=n-e.start,i=e):(r=e.start-n,i=t),i.duration!==r&&(i.duration=r)}else if(t.sn>e.sn){const n=e.cc===t.cc;n&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function gn(e,t,n,i,r,a){const s=i-n;s<=0&&(E.warn("Fragment should have a positive duration",t),i=n+t.duration,a=r+t.duration);let o=n,l=i;const u=t.startPTS,c=t.endPTS;if(h(u)){const e=Math.abs(u-n);h(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,o=Math.max(n,u),n=Math.min(n,u),r=Math.min(r,t.startDTS),l=Math.min(i,c),i=Math.max(i,c),a=Math.max(a,t.endDTS)}const d=n-t.start;0!==t.start&&(t.start=n),t.duration=i-t.start,t.startPTS=n,t.maxStartPTS=o,t.startDTS=r,t.endPTS=i,t.minEndPTS=l,t.endDTS=a;const f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;let p;const g=f-e.startSN,m=e.fragments;for(m[g]=t,p=g;p>0;p--)pn(m[p],m[p-1]);for(p=g;p<m.length-1;p++)pn(m[p],m[p+1]);return e.fragmentHint&&pn(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function mn(e,t){let n=null;const i=e.fragments;for(let l=i.length-1;l>=0;l--){const e=i[l].initSegment;if(e){n=e;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;let r,a=0;if(bn(e,t,(e,i)=>{e.relurl&&(a=e.cc-i.cc),h(e.startPTS)&&h(e.endPTS)&&(i.start=i.startPTS=e.startPTS,i.startDTS=e.startDTS,i.maxStartPTS=e.maxStartPTS,i.endPTS=e.endPTS,i.endDTS=e.endDTS,i.minEndPTS=e.minEndPTS,i.duration=e.endPTS-e.startPTS,i.duration&&(r=i),t.PTSKnown=t.alignedSliding=!0),i.elementaryStreams=e.elementaryStreams,i.loader=e.loader,i.stats=e.stats,e.initSegment&&(i.initSegment=e.initSegment,n=e.initSegment)}),n){const e=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;e.forEach(e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=n)?void 0:t.relurl)||(e.initSegment=n)})}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(e=>!e),t.deltaUpdateFailed){E.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=vn(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const s=t.fragments;if(a){E.warn("discontinuity sliding from playlist, take drift into account");for(let e=0;e<s.length;e++)s[e].cc+=a}t.skippedSegments&&(t.startCC=t.fragments[0].cc),yn(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),r?gn(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):Sn(e,t),s.length&&(t.totalduration=t.edge-s[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const e=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=e),t.driftEndTime=o,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function vn(e,t,n){const i=d({},e);return n&&n.forEach(e=>{delete i[e]}),Object.keys(t).forEach(e=>{const n=new R(t[e].attr,i[e]);n.isValid?i[e]=n:E.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)}),i}function yn(e,t,n){if(e&&t){let i=0;for(let r=0,a=e.length;r<=a;r++){const a=e[r],s=t[r+i];a&&s&&a.index===s.index&&a.fragment.sn===s.fragment.sn?n(a,s):i--}}}function bn(e,t,n){const i=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let u=r;u<=a;u++){const e=l[s+u];let r=o[u];i&&!r&&u<i&&(r=t.fragments[u]=e),e&&r&&n(e,r)}}function Sn(e,t){const n=t.startSN+t.skippedSegments-e.startSN,i=e.fragments;n<0||n>=i.length||Tn(t,i[n].start)}function Tn(e,t){if(t){const n=e.fragments;for(let i=e.skippedSegments;i<n.length;i++)n[i].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function _n(e,t=1/0){let n=1e3*e.targetduration;if(e.updated){const i=e.fragments,r=4;if(i.length&&n*r>t){const e=1e3*i[i.length-1].duration;e<n&&(n=e)}}else n/=2;return Math.round(n)}function wn(e,t,n){if(null==e||!e.details)return null;const i=e.details;let r=i.fragments[t-i.startSN];return r||(r=i.fragmentHint,r&&r.sn===t?r:t<i.startSN&&n&&n.sn===t?n:null)}function En(e,t,n){var i;return null!=e&&e.details?xn(null==(i=e.details)?void 0:i.partList,t,n):null}function xn(e,t,n){if(e)for(let i=e.length;i--;){const r=e[i];if(r.index===n&&r.fragment.sn===t)return r}return null}function An(e){e.forEach((e,t)=>{const{details:n}=e;null!=n&&n.fragments&&n.fragments.forEach(e=>{e.level=t})})}function kn(e){switch(e.details){case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_TIMEOUT:case v.LEVEL_LOAD_TIMEOUT:case v.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function In(e,t){const n=kn(t);return e.default[`${n?"timeout":"error"}Retry`]}function Cn(e,t){const n="linear"===e.backoff?1:Math.pow(2,t);return Math.min(n*e.retryDelayMs,e.maxRetryDelayMs)}function Rn(e){return o(o({},e),{errorRetry:null,timeoutRetry:null})}function Mn(e,t,n,i){if(!e)return!1;const r=null==i?void 0:i.code,a=t<e.maxNumRetry&&(Dn(r)||!!n);return e.shouldRetry?e.shouldRetry(e,t,n,i,a):a}function Dn(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}const Ln={search:function(e,t){let n=0,i=e.length-1,r=null,a=null;while(n<=i){r=(n+i)/2|0,a=e[r];const s=t(a);if(s>0)n=r+1;else{if(!(s<0))return a;i=r-1}}return null}};function Pn(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!h(t))return null;const i=e[0].programDateTime;if(t<(i||0))return null;const r=e[e.length-1].endProgramDateTime;if(t>=(r||0))return null;n=n||0;for(let a=0;a<e.length;++a){const i=e[a];if(Fn(t,n,i))return i}return null}function On(e,t,n=0,i=0,r=.005){let a=null;if(e){a=t[e.sn-t[0].sn+1]||null;const i=e.endDTS-n;i>0&&i<15e-7&&(n+=15e-7)}else 0===n&&0===t[0].start&&(a=t[0]);if(a&&((!e||e.level===a.level)&&0===Un(n,i,a)||Nn(a,e,Math.min(r,i))))return a;const s=Ln.search(t,Un.bind(null,n,i));return!s||s===e&&a?a:s}function Nn(e,t,n){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const i=t.tagList.reduce((e,t)=>{return"INF"===t[0]&&(e+=parseFloat(t[1])),e},n);return e.start<=i}return!1}function Un(e=0,t=0,n){if(n.start<=e&&n.start+n.duration>e)return 0;const i=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-i<=e?1:n.start-i>e&&n.start?-1:0}function Fn(e,t,n){const i=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0)),r=n.endProgramDateTime||0;return r-i>e}function Bn(e,t){return Ln.search(e,e=>{return e.cc<t?1:e.cc>t?-1:0})}var Vn={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},jn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class Gn{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=E.log.bind(E,"[info]:"),this.warn=E.warn.bind(E,"[warning]:"),this.error=E.error.bind(E,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(g.ERROR,this.onError,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(g.ERROR,this.onError,this),e.off(g.ERROR,this.onErrorOut,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===Ft.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var n,i;if(t.fatal)return;const r=this.hls,a=t.context;switch(t.details){case v.FRAG_LOAD_ERROR:case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_ERROR:case v.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case v.FRAG_PARSING_ERROR:if(null!=(n=t.frag)&&n.gap)return void(t.errorAction={action:Vn.DoNothing,flags:jn.None});case v.FRAG_GAP:case v.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Vn.SendAlternateToPenaltyBox);case v.LEVEL_EMPTY_ERROR:case v.LEVEL_PARSING_ERROR:{var s,o;const e=t.parent===Ft.MAIN?t.level:r.loadLevel;t.details===v.LEVEL_EMPTY_ERROR&&null!=(s=t.context)&&null!=(o=s.levelDetails)&&o.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case v.LEVEL_LOAD_ERROR:case v.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==a?void 0:a.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level)));case v.AUDIO_TRACK_LOAD_ERROR:case v.AUDIO_TRACK_LOAD_TIMEOUT:case v.SUBTITLE_LOAD_ERROR:case v.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const e=r.levels[r.loadLevel];if(e&&(a.type===Ut.AUDIO_TRACK&&e.hasAudioGroup(a.groupId)||a.type===Ut.SUBTITLE_TRACK&&e.hasSubtitleGroup(a.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Vn.SendAlternateToPenaltyBox,void(t.errorAction.flags=jn.MoveAllAlternatesMatchingHost)}return;case v.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=r.levels[r.loadLevel],n=null==e?void 0:e.attrs["HDCP-LEVEL"];n?t.errorAction={action:Vn.SendAlternateToPenaltyBox,flags:jn.MoveAllAlternatesMatchingHDCP,hdcpLevel:n}:this.keySystemError(t)}return;case v.BUFFER_ADD_CODEC_ERROR:case v.REMUX_ALLOC_ERROR:case v.BUFFER_APPEND_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(i=t.level)?i:r.loadLevel));case v.INTERNAL_EXCEPTION:case v.BUFFER_APPENDING_ERROR:case v.BUFFER_FULL_ERROR:case v.LEVEL_SWITCH_ERROR:case v.BUFFER_STALLED_ERROR:case v.BUFFER_SEEK_OVER_HOLE:case v.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:Vn.DoNothing,flags:jn.None})}t.type===m.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,i=In(n.config.playlistLoadPolicy,e),r=this.playlistError++,a=Mn(i,r,kn(e),e.response);if(a)return{action:Vn.RetryRequest,flags:jn.None,retryConfig:i,retryCount:r};const s=this.getLevelSwitchAction(e,t);return i&&(s.retryConfig=i,s.retryCount=r),s}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:r,keyLoadPolicy:a}=t.config,s=In(e.details.startsWith("key")?a:r,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(i){e.details!==v.FRAG_GAP&&i.fragmentError++;const t=Mn(s,o,kn(e),e.response);if(t)return{action:Vn.RetryRequest,flags:jn.None,retryConfig:s,retryCount:o}}const l=this.getLevelSwitchAction(e,n);return s&&(l.retryConfig=s,l.retryCount=o),l}getLevelSwitchAction(e,t){const n=this.hls;null!==t&&void 0!==t||(t=n.loadLevel);const i=this.hls.levels[t];if(i){var r,a;const t=e.details;i.loadError++,t===v.BUFFER_APPEND_ERROR&&i.fragmentError++;let l=-1;const{levels:u,loadLevel:c,minAutoLevel:d,maxAutoLevel:h}=n;n.autoLevelEnabled||(n.loadLevel=-1);const f=null==(r=e.frag)?void 0:r.type,p=f===Ft.AUDIO&&t===v.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===v.BUFFER_ADD_CODEC_ERROR||t===v.BUFFER_APPEND_ERROR),g=p&&u.some(({audioCodec:e})=>i.audioCodec!==e),m="video"===e.sourceBufferName&&(t===v.BUFFER_ADD_CODEC_ERROR||t===v.BUFFER_APPEND_ERROR),y=m&&u.some(({codecSet:e,audioCodec:t})=>i.codecSet!==e&&i.audioCodec===t),{type:b,groupId:S}=null!=(a=e.context)?a:{};for(let n=u.length;n--;){const r=(n+c)%u.length;if(r!==c&&r>=d&&r<=h&&0===u[r].loadError){var s,o;const n=u[r];if(t===v.FRAG_GAP&&f===Ft.MAIN&&e.frag){const t=u[r].details;if(t){const n=On(e.frag,t.fragments,e.frag.start);if(null!=n&&n.gap)continue}}else{if(b===Ut.AUDIO_TRACK&&n.hasAudioGroup(S)||b===Ut.SUBTITLE_TRACK&&n.hasSubtitleGroup(S))continue;if(f===Ft.AUDIO&&null!=(s=i.audioGroups)&&s.some(e=>n.hasAudioGroup(e))||f===Ft.SUBTITLE&&null!=(o=i.subtitleGroups)&&o.some(e=>n.hasSubtitleGroup(e))||g&&i.audioCodec===n.audioCodec||!g&&i.audioCodec!==n.audioCodec||y&&i.codecSet===n.codecSet)continue}l=r;break}}if(l>-1&&n.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:Vn.SendAlternateToPenaltyBox,flags:jn.None,nextAutoLevel:l}}return{action:Vn.SendAlternateToPenaltyBox,flags:jn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch(null==(n=t.errorAction)?void 0:n.action){case Vn.DoNothing:break;case Vn.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===v.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0;break;case Vn.RetryRequest:break}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i,hdcpLevel:r,nextAutoLevel:a}=n;switch(i){case jn.None:this.switchLevel(e,a);break;case jn.MoveAllAlternatesMatchingHDCP:r&&(t.maxHdcpLevel=an[an.indexOf(r)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(e,a)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class Hn{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=E.log.bind(E,`${t}:`),this.warn=E.warn.bind(E,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=null==t?void 0:t.renditionReports;if(i){let r=-1;for(let n=0;n<i.length;n++){const a=i[n];let s;try{s=new self.URL(a.URI,t.url).href}catch(e){E.warn(`Could not construct new URL for Rendition Report: ${e}`),s=a.URI||""}if(s===e){r=n;break}s===e.substring(0,s.length)&&(r=n)}if(-1!==r){const e=i[r],a=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let s=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);s>=0&&e>t.partTarget&&(s+=1)}const o=n&&cn(n);return new dn(a,s>=0?s:void 0,o)}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,n){const{details:i,stats:r}=t,a=self.performance.now(),s=r.loading.first?Math.max(0,a-r.loading.first):0;if(i.advancedDateTime=Date.now()-s,i.live||null!=n&&n.live){if(i.reloaded(n),n&&this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),n&&i.fragments.length>0&&mn(n,i),!this.canLoad||!i.live)return;let s,o=void 0,l=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){const e=this.hls.config.lowLatencyMode,r=i.lastPartSn,a=i.endSN,u=i.lastPartIndex,c=-1!==u,d=r===a,h=e?0:u;c?(o=d?a+1:r,l=d?h:u+1):o=a+1;const f=i.age,p=f+i.ageHeader;let g=Math.min(p-i.partTarget,1.5*i.targetduration);if(g>0){if(n&&g>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${g} with playlist age: ${i.age}`),g=0;else{const e=Math.floor(g/i.targetduration);if(o+=e,void 0!==l){const e=Math.round(g%i.targetduration/i.partTarget);l+=e}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${f.toFixed(2)}s goal: ${g} skip sn ${e} to part ${l}`)}i.tuneInGoal=g}if(s=this.getDeliveryDirectives(i,t.deliveryDirectives,o,l),e||!d)return void this.loadPlaylist(s)}else(i.canBlockReload||i.canSkipUntil)&&(s=this.getDeliveryDirectives(i,t.deliveryDirectives,o,l));const u=this.hls.mainForwardBufferInfo,c=u?u.end-u.len:0,d=1e3*(i.edge-c),h=_n(i,d);i.updated&&a>this.requestScheduled+h&&(this.requestScheduled=r.loading.start),void 0!==o&&i.canBlockReload?this.requestScheduled=r.loading.first+h-(1e3*i.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+h<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=h);let f=this.requestScheduled-a;f=Math.max(0,f),this.log(`reload live playlist ${e} in ${Math.round(f)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(s),f)}else this.clearTimer()}getDeliveryDirectives(e,t,n,i){let r=cn(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,r=un.No),new dn(n,i,r)}checkRetry(e){const t=e.details,n=kn(e),i=e.errorAction,{action:r,retryCount:a=0,retryConfig:s}=i||{},o=!!i&&!!s&&(r===Vn.RetryRequest||!i.resolved&&r===Vn.SendAlternateToPenaltyBox);if(o){var l;if(this.requestScheduled=-1,a>=s.maxNumRetry)return!1;if(n&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${s.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=Cn(s,a);this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn(`Retrying playlist loading ${a+1}/${s.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,i.resolved=!0}return o}}class zn{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Kn{constructor(e,t,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new zn(e),this.fast_=new zn(t),this.defaultTTFB_=i,this.ttfb_=new zn(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:r}=this;n.halfLife!==e&&(this.slow_=new zn(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new zn(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new zn(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,i=e/1e3,r=n/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const $n={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},Wn={};function qn(e,t,n,i,r,a){const s=e.audioCodec?e.audioGroups:null,o=null==a?void 0:a.audioCodec,l=null==a?void 0:a.channels,u=l?parseInt(l):o?1/0:2;let c=null;if(null!=s&&s.length)try{c=1===s.length&&s[0]?t.groups[s[0]].channels:s.reduce((e,n)=>{if(n){const i=t.groups[n];if(!i)throw new Error(`Audio track group ${n} not found`);Object.keys(i.channels).forEach(t=>{e[t]=(e[t]||0)+i.channels[t]})}return e},{2:0})}catch(e){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(i,30)||"SDR"!==e.videoRange&&e.videoRange!==n||e.bitrate>Math.max(r,8e6))||!!c&&h(u)&&Object.keys(c).some(e=>parseInt(e)>u)}function Yn(e,t,n){const i=e.videoCodec,r=e.audioCodec;if(!i||!r||!n)return Promise.resolve($n);const a={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),framerate:e.frameRate||30},s=e.videoRange;"SDR"!==s&&(a.transferFunction=s.toLowerCase());const l=i.split(",").map(e=>({type:"media-source",video:o(o({},a),{},{contentType:pt(e,"video")})}));return r&&e.audioGroups&&e.audioGroups.forEach(e=>{var n;e&&(null==(n=t.groups[e])||n.tracks.forEach(t=>{if(t.groupId===e){const e=t.channels||"",n=parseFloat(e);h(n)&&n>2&&l.push.apply(l,r.split(",").map(e=>({type:"media-source",audio:{contentType:pt(e,"audio"),channels:""+n}})))}}))}),Promise.all(l.map(e=>{const t=Xn(e);return Wn[t]||(Wn[t]=n.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:l,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:l,decodingInfoResults:[],error:e}))}function Xn(e){const{audio:t,video:n}=e,i=n||t;if(i){const e=i.contentType.split('"')[1];if(n)return`r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${e}_${Math.ceil(n.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${e}`}return""}function Qn(){if("function"===typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}function Zn(e,t){let n=!1,i=[];return e&&(n="SDR"!==e,i=[e]),t&&(i=t.allowedVideoRanges||on.slice(0),n=void 0!==t.preferHDR?t.preferHDR:Qn(),i=n?i.filter(e=>"SDR"!==e):["SDR"]),{preferHDR:n,allowedVideoRanges:i}}function Jn(e,t,n,i,r){const a=Object.keys(e),s=null==i?void 0:i.channels,o=null==i?void 0:i.audioCodec,l=s&&2===parseInt(s);let u=!0,c=!1,d=1/0,f=1/0,p=1/0,g=0,m=[];const{preferHDR:v,allowedVideoRanges:y}=Zn(t,r);for(let h=a.length;h--;){const t=e[a[h]];u=t.channels[2]>0,d=Math.min(d,t.minHeight),f=Math.min(f,t.minFramerate),p=Math.min(p,t.minBitrate);const n=y.filter(e=>t.videoRanges[e]>0);n.length>0&&(c=!0,m=n)}d=h(d)?d:0,f=h(f)?f:0;const b=Math.max(1080,d),S=Math.max(30,f);p=h(p)?p:n,n=Math.max(p,n),c||(t=void 0,m=[]);const T=a.reduce((t,i)=>{const r=e[i];if(i===t)return t;if(r.minBitrate>n)return ei(i,`min bitrate of ${r.minBitrate} > current estimate of ${n}`),t;if(!r.hasDefaultAudio)return ei(i,"no renditions with default or auto-select sound found"),t;if(o&&i.indexOf(o.substring(0,4))%5!==0)return ei(i,`audio codec preference "${o}" not found`),t;if(s&&!l){if(!r.channels[s])return ei(i,`no renditions with ${s} channel sound found (channels options: ${Object.keys(r.channels)})`),t}else if((!o||l)&&u&&0===r.channels["2"])return ei(i,"no renditions with stereo sound found"),t;return r.minHeight>b?(ei(i,`min resolution of ${r.minHeight} > maximum of ${b}`),t):r.minFramerate>S?(ei(i,`min framerate of ${r.minFramerate} > maximum of ${S}`),t):m.some(e=>r.videoRanges[e]>0)?r.maxScore<g?(ei(i,`max score of ${r.maxScore} < selected max of ${g}`),t):t&&(mt(i)>=mt(t)||r.fragmentError>e[t].fragmentError)?t:(g=r.maxScore,i):(ei(i,`no variants with VIDEO-RANGE of ${JSON.stringify(m)} found`),t)},void 0);return{codecSet:T,videoRanges:m,preferHDR:v,minFramerate:f,minBitrate:p}}function ei(e,t){E.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function ti(e){return e.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function ni(e,t,n,i){return e.slice(n,i+1).reduce((e,n)=>{if(!n.codecSet)return e;const i=n.audioGroups;let r=e[n.codecSet];r||(e[n.codecSet]=r={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),r.minBitrate=Math.min(r.minBitrate,n.bitrate);const a=Math.min(n.height,n.width);return r.minHeight=Math.min(r.minHeight,a),r.minFramerate=Math.min(r.minFramerate,n.frameRate),r.maxScore=Math.max(r.maxScore,n.score),r.fragmentError+=n.fragmentError,r.videoRanges[n.videoRange]=(r.videoRanges[n.videoRange]||0)+1,i&&i.forEach(e=>{if(!e)return;const n=t.groups[e];n&&(r.hasDefaultAudio=r.hasDefaultAudio||t.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(n.channels).forEach(e=>{r.channels[e]=(r.channels[e]||0)+n.channels[e]}))}),e},{})}function ii(e,t,n){if("attrs"in e){const n=t.indexOf(e);if(-1!==n)return n}for(let i=0;i<t.length;i++){const r=t[i];if(ri(e,r,n))return i}return-1}function ri(e,t,n){const{groupId:i,name:r,lang:a,assocLang:s,characteristics:o,default:l}=e,u=e.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===a||t.lang===a)&&(void 0===a||t.assocLang===s)&&(void 0===l||t.default===l)&&(void 0===u||t.forced===u)&&(void 0===o||ai(o,t.characteristics))&&(void 0===n||n(e,t))}function ai(e,t=""){const n=e.split(","),i=t.split(",");return n.length===i.length&&!n.some(e=>-1===i.indexOf(e))}function si(e,t){const{audioCodec:n,channels:i}=e;return(void 0===n||(t.audioCodec||"").substring(0,4)===n.substring(0,4))&&(void 0===i||i===(t.channels||"2"))}function oi(e,t,n,i,r){const a=t[i],s=t.reduce((e,t,n)=>{const i=t.uri,r=e[i]||(e[i]=[]);return r.push(n),e},{}),o=s[a.uri];o.length>1&&(i=Math.max.apply(Math,o));const l=a.videoRange,u=a.frameRate,c=a.codecSet.substring(0,4),d=li(t,i,t=>{if(t.videoRange!==l||t.frameRate!==u||t.codecSet.substring(0,4)!==c)return!1;const i=t.audioGroups,a=n.filter(e=>!i||-1!==i.indexOf(e.groupId));return ii(e,a,r)>-1});return d>-1?d:li(t,i,t=>{const i=t.audioGroups,a=n.filter(e=>!i||-1!==i.indexOf(e.groupId));return ii(e,a,r)>-1})}function li(e,t,n){for(let i=t;i;i--)if(n(e[i]))return i;for(let i=t+1;i<e.length;i++)if(n(e[i]))return i;return-1}class ui{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=(()=>{const{fragCurrent:e,partCurrent:t,hls:n}=this,{autoLevelEnabled:i,media:r}=n;if(!e||!r)return;const a=performance.now(),s=t?t.stats:e.stats,o=t?t.duration:e.duration,l=a-s.loading.start,u=n.minAutoLevel;if(s.aborted||s.loaded&&s.loaded===s.total||e.level<=u)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!i||r.paused||!r.playbackRate||!r.readyState)return;const c=n.mainForwardBufferInfo;if(null===c)return;const d=this.bwEstimator.getEstimateTTFB(),f=Math.abs(r.playbackRate);if(l<=Math.max(d,o/(2*f)*1e3))return;const p=c.len/f,m=s.loading.first?s.loading.first-s.loading.start:-1,v=s.loaded&&m>-1,y=this.getBwEstimate(),b=n.levels,S=b[e.level],T=s.total||Math.max(s.loaded,Math.round(o*S.averageBitrate/8));let _=v?l-m:l;_<1&&v&&(_=Math.min(l,8*s.loaded/y));const w=v?1e3*s.loaded/_:0,x=w?(T-s.loaded)/w:8*T/y+d/1e3;if(x<=p)return;const A=w?8*w:y;let k,I=Number.POSITIVE_INFINITY;for(k=e.level-1;k>u;k--){const e=b[k].maxBitrate;if(I=this.getTimeToLoadFrag(d/1e3,A,o*e,!b[k].details),I<p)break}if(I>=x)return;if(I>10*o)return;n.nextLoadLevel=n.nextAutoLevel=k,v?this.bwEstimator.sample(l-Math.min(d,m),s.loaded):this.bwEstimator.sampleTTFB(l);const C=b[k].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>C&&this.resetEstimator(C),this.clearTimer(),E.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${p.toFixed(3)} s\n      Estimated load time for current fragment: ${x.toFixed(3)} s\n      Estimated load time for down switch fragment: ${I.toFixed(3)} s\n      TTFB estimate: ${0|m} ms\n      Current BW estimate: ${h(y)?0|y:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${k} @ ${0|C} bps`),n.trigger(g.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:s})}),this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(E.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Kn(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.FRAG_LOADING,this.onFragLoading,this),e.on(g.FRAG_LOADED,this.onFragLoaded,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this),e.on(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(g.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.FRAG_LOADING,this.onFragLoading,this),e.off(g.FRAG_LOADED,this.onFragLoaded,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this),e.off(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(g.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(g.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){var i;if(!n.bitrateTest)this.fragCurrent=n,this.partCurrent=null!=(i=t.part)?i:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case v.BUFFER_ADD_CODEC_ERROR:case v.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case v.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:n,partCurrent:i}=this;if(e&&n&&e.sn===n.sn&&e.level===n.level){const t=performance.now(),n=i?i.stats:e.stats,r=t-n.loading.start,a=n.loading.first?n.loading.first-n.loading.start:-1,s=n.loaded&&a>-1;if(s){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(e,a),n.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}getTimeToLoadFrag(e,t,n,i){const r=e+n/t,a=i?this.lastLevelLoadSec:0;return r+a}onLevelLoaded(e,t){const n=this.hls.config,{loading:i}=t.stats,r=i.end-i.start;h(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:n}){const i=n?n.stats:t.stats;if(t.type===Ft.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=n?n.duration:t.duration,r=this.hls.levels[t.level],a=(r.loaded?r.loaded.bytes:0)+i.loaded,s=(r.loaded?r.loaded.duration:0)+e;r.loaded={bytes:a,duration:s},r.realBitrate=Math.round(8*a/s)}if(t.bitrateTest){const e={stats:i,frag:t,part:n,id:t.type};this.onFragBuffered(g.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,r=null!=i&&i.stats.loaded?i.stats:n.stats;if(r.aborted)return;if(this.ignoreFragment(n))return;const a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Ft.MAIN||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(n,t,e,0,i,1,1);if(r>-1)return r;const a=this.hls.firstLevel,s=Math.min(Math.max(a,t),e);return E.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${s}`),s}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator,n=t.canEstimate(),i=this.lastLoadedFragLevel>-1;if(-1!==e&&(!n||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=n&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,r)&&t[e].loadError<=t[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this,{maxAutoLevel:i,config:r,minAutoLevel:a}=n,s=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let u=r.abrBandWidthFactor,c=r.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,a,i,l,0,u,c);if(e>=0)return e}let d=s?Math.min(s,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){const t=s?Math.min(s,r.maxLoadingDelay):r.maxLoadingDelay;d=t-e,E.info(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*d)} ms`),u=c=1}}const h=this.findBestLevel(o,a,i,l,d,u,c);if(E.info(`[abr] ${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`),h>-1)return h;const f=n.levels[a],p=n.levels[n.loadLevel];return(null==f?void 0:f.bitrate)<(null==p?void 0:p.bitrate)?a:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,i,r,a,s){var o;const l=i+r,u=this.lastLoadedFragLevel,c=-1===u?this.hls.firstLevel:u,{fragCurrent:d,partCurrent:f}=this,{levels:p,allAudioTracks:g,loadLevel:m,config:v}=this.hls;if(1===p.length)return 0;const y=p[c],b=!(null==y||null==(o=y.details)||!o.live),S=-1===m||-1===u;let T,_="SDR",w=(null==y?void 0:y.frameRate)||0;const{audioPreference:x,videoPreference:A}=v,k=this.audioTracksByGroup||(this.audioTracksByGroup=ti(g));if(S){if(-1!==this.firstSelection)return this.firstSelection;const i=this.codecTiers||(this.codecTiers=ni(p,k,t,n)),r=Jn(i,_,e,x,A),{codecSet:a,videoRanges:s,minFramerate:o,minBitrate:l,preferHDR:u}=r;T=a,_=u?s[s.length-1]:s[0],w=o,e=Math.max(e,l),E.log(`[abr] picked start tier ${JSON.stringify(r)}`)}else T=null==y?void 0:y.codecSet,_=null==y?void 0:y.videoRange;const I=f?f.duration:d?d.duration:0,C=this.bwEstimator.getEstimateTTFB()/1e3,R=[];for(let D=n;D>=t;D--){var M;const t=p[D],o=D>c;if(!t)continue;if(v.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const n=navigator.mediaCapabilities;"function"===typeof(null==n?void 0:n.decodingInfo)&&qn(t,k,_,w,e,x)?(t.supportedPromise=Yn(t,k,n),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const n=this.hls.levels,i=n.indexOf(t);e.error?E.warn(`[abr] MediaCapabilities decodingInfo error: "${e.error}" for level ${i} ${JSON.stringify(e)}`):e.supported||(E.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${i} ${JSON.stringify(e)}`),i>-1&&n.length>1&&(E.log(`[abr] Removing unsupported level ${i}`),this.hls.removeLevel(i)))})):t.supportedResult=$n}if(T&&t.codecSet!==T||_&&t.videoRange!==_||o&&w>t.frameRate||!o&&w>0&&w<t.frameRate||t.supportedResult&&(null==(M=t.supportedResult.decodingInfoResults)||!M[0].smooth)){R.push(D);continue}const d=t.details,g=(f?null==d?void 0:d.partTarget:null==d?void 0:d.averagetargetduration)||I;let A;A=o?s*e:a*e;const L=I&&i>=2*I&&0===r?p[D].averageBitrate:p[D].maxBitrate,P=this.getTimeToLoadFrag(C,A,L*g,void 0===d),O=A>=L&&(D===u||0===t.loadError&&0===t.fragmentError)&&(P<=C||!h(P)||b&&!this.bitrateTestDelay||P<l);if(O){const e=this.forcedAutoLevel;return D===m||-1!==e&&e===m||(R.length&&E.trace(`[abr] Skipped level(s) ${R.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${p[R[0]].codecs}" ${p[R[0]].videoRange}; not compatible with "${y.codecs}" ${_}`),E.info(`[abr] switch candidate:${c}->${D} adjustedbw(${Math.round(A)})-bitrate=${Math.round(A-L)} ttfb:${C.toFixed(1)} avgDuration:${g.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${P.toFixed(1)} firstSelection:${S} codecSet:${T} videoRange:${_} hls.loadLevel:${m}`)),S&&(this.firstSelection=D),D}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls,i=Math.min(Math.max(e,n),t);this._nextAutoLevel!==i&&(this.nextAutoLevelKey="",this._nextAutoLevel=i)}}class ci{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var di={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class hi{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(g.BUFFER_APPENDED,this.onBufferAppended,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this),e.on(g.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.BUFFER_APPENDED,this.onBufferAppended,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this),e.off(g.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let i=n.length;i--;){const t=n[i];if(!t)break;const r=t.end;if(t.start<=e&&null!==r&&e<=r)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:n}=this,i=Object.keys(n);for(let r=i.length;r--;){const a=n[i[r]];if((null==a?void 0:a.body.type)===t&&a.buffered){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,n,i){this.timeRanges&&(this.timeRanges[e]=t);const r=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(i=>{const a=this.fragments[i];if(!a)return;if(r>=a.body.sn)return;if(!a.buffered&&!a.loaded)return void(a.body.type===n&&this.removeFragment(a.body));const s=a.range[e];s&&s.time.some(e=>{const n=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&this.removeFragment(a.body),n})})}detectPartialFragments(e){const t=this.timeRanges,{frag:n,part:i}=e;if(!t||"initSegment"===n.sn)return;const r=pi(n),a=this.fragments[r];if(!a||a.buffered&&n.gap)return;const s=!n.relurl;if(Object.keys(t).forEach(e=>{const r=n.elementaryStreams[e];if(!r)return;const o=t[e],l=s||!0===r.partial;a.range[e]=this.getBufferedTimes(n,i,l,o)}),a.loaded=null,Object.keys(a.range).length){a.buffered=!0;const e=a.body.endList=n.endList||a.body.endList;e&&(this.endListFragments[a.body.type]=a),fi(a)||this.removeParts(n.sn-1,n.type)}else this.removeFragment(a.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=n.filter(t=>t.fragment.sn>=e))}fragBuffered(e,t){const n=pi(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,n,i){const r={time:[],partial:n},a=e.start,s=e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a;for(let u=0;u<i.length;u++){const e=i.start(u)-this.bufferPadding,t=i.end(u)+this.bufferPadding;if(l>=e&&o<=t){r.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(s,i.end(u))});break}if(a<t&&s>e){const e=Math.max(a,i.start(u)),t=Math.min(s,i.end(u));t>e&&(r.partial=!0,r.time.push({startPTS:e,endPTS:t}))}else if(s<=e)break}return r}getPartialFragment(e){let t,n,i,r=null,a=0;const{bufferPadding:s,fragments:o}=this;return Object.keys(o).forEach(l=>{const u=o[l];u&&fi(u)&&(n=u.body.start-s,i=u.body.end+s,e>=n&&e<=i&&(t=Math.min(e-n,i-e),a<=t&&(r=u.body,a=t)))}),r}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||fi(t))}getState(e){const t=pi(e),n=this.fragments[t];return n?n.buffered?fi(n)?di.PARTIAL:di.OK:di.APPENDING:di.NOT_LOADED}isTimeBuffered(e,t,n){let i,r;for(let a=0;a<n.length;a++){if(i=n.start(a)-this.bufferPadding,r=n.end(a)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onFragLoaded(e,t){const{frag:n,part:i}=t;if("initSegment"===n.sn||n.bitrateTest)return;const r=i?null:t,a=pi(n);this.fragments[a]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:r}=t;if("initSegment"===n.sn)return;const a=n.type;if(i){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(i)}this.timeRanges=r,Object.keys(r).forEach(e=>{const t=r[e];this.detectEvictedFragments(e,t,a,i)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=pi(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,n,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const s=this.fragments[a];if(!s)return;const o=s.body;o.type!==n||i&&!o.gap||o.start<t&&o.end>e&&(s.buffered||r)&&this.removeFragment(o)})}removeFragment(e){const t=pi(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const t=e.sn;this.activePartLists[e.type]=n.filter(e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function fi(e){var t,n,i;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(n=e.range.audio)?void 0:n.partial)||(null==(i=e.range.audiovideo)?void 0:i.partial))}function pi(e){return`${e.type}_${e.level}_${e.sn}`}const gi={length:0,start:()=>0,end:()=>0};class mi{static isBuffered(e,t){try{if(e){const n=mi.getBuffered(e);for(let e=0;e<n.length;e++)if(t>=n.start(e)&&t<=n.end(e))return!0}}catch(e){}return!1}static bufferInfo(e,t,n){try{if(e){const i=mi.getBuffered(e),r=[];let a;for(a=0;a<i.length;a++)r.push({start:i.start(a),end:i.end(a)});return this.bufferedInfo(r,t,n)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.sort(function(e,t){const n=e.start-t.start;return n||t.end-e.end});let i=[];if(n)for(let l=0;l<e.length;l++){const t=i.length;if(t){const r=i[t-1].end;e[l].start-r<n?e[l].end>r&&(i[t-1].end=e[l].end):i.push(e[l])}else i.push(e[l])}else i=e;let r,a=0,s=t,o=t;for(let l=0;l<i.length;l++){const e=i[l].start,u=i[l].end;if(t+n>=e&&t<u)s=e,o=u,a=o-t;else if(t+n<e){r=e;break}}return{len:a,start:s||0,end:o||0,nextStart:r}}static getBuffered(e){try{return e.buffered}catch(e){return E.log("failed to get media.buffered",e),gi}}}class vi{constructor(e,t,n,i=0,r=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=yi(),this.buffering={audio:yi(),video:yi(),audiovideo:yi()},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=r,this.partial=a}}function yi(){return{start:0,executeStart:0,executeEnd:0,end:0}}function bi(e,t){for(let i=0,r=e.length;i<r;i++){var n;if((null==(n=e[i])?void 0:n.cc)===t)return e[i]}return null}function Si(e,t,n){return!(!t||!(n.endCC>n.startCC||e&&e.cc<n.startCC))}function Ti(e,t){const n=e.fragments,i=t.fragments;if(!i.length||!n.length)return void E.log("No fragments to align");const r=bi(n,i[0].cc);if(r&&(!r||r.startPTS))return r;E.log("No frag in previous level to align on")}function _i(e,t){if(e){const n=e.start+t;e.start=e.startPTS=n,e.endPTS=n+e.duration}}function wi(e,t){const n=t.fragments;for(let i=0,r=n.length;i<r;i++)_i(n[i],e);t.fragmentHint&&_i(t.fragmentHint,e),t.alignedSliding=!0}function Ei(e,t,n){t&&(xi(e,n,t),!n.alignedSliding&&t&&Ai(n,t),n.alignedSliding||!t||n.skippedSegments||Sn(t,n))}function xi(e,t,n){if(Si(e,n,t)){const e=Ti(n,t);e&&h(e.start)&&(E.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),wi(e.start,t))}}function Ai(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const n=e.fragments,i=t.fragments;if(!n.length||!i.length)return;let r,a;const s=Math.min(t.endCC,e.endCC);t.startCC<s&&e.startCC<s&&(r=bi(i,s),a=bi(n,s)),r&&a||(r=i[Math.floor(i.length/2)],a=bi(n,r.cc)||n[Math.floor(n.length/2)]);const o=r.programDateTime,l=a.programDateTime;if(!o||!l)return;const u=(l-o)/1e3-(a.start-r.start);wi(u,e)}const ki=Math.pow(2,17);class Ii{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Mi({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise((s,l)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void l(Ri(e));e.gap=!1}const u=this.loader=e.loader=r?new r(i):new a(i),c=Ci(e),d=Rn(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:ki};e.stats=u.stats,u.load(c,h,{onSuccess:(t,n,i,r)=>{this.resetLoader(e,u);let a=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(a.slice(0,16)),a=a.slice(16)),s({frag:e,part:null,payload:a,networkDetails:r})},onError:(t,i,r,a)=>{this.resetLoader(e,u),l(new Mi({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:o({url:n,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:r,stats:a}))},onAbort:(t,n,i)=>{this.resetLoader(e,u),l(new Mi({type:m.NETWORK_ERROR,details:v.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:(t,n,i)=>{this.resetLoader(e,u),l(new Mi({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:i,stats:t}))},onProgress:(n,i,r,a)=>{t&&t({frag:e,part:null,payload:r,networkDetails:a})}})})}loadPart(e,t,n){this.abort();const i=this.config,r=i.fLoader,a=i.loader;return new Promise((s,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void l(Ri(e,t));const u=this.loader=e.loader=r?new r(i):new a(i),c=Ci(e,t),d=Rn(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:ki};t.stats=u.stats,u.load(c,h,{onSuccess:(i,r,a,o)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const l={frag:e,part:t,payload:i.data,networkDetails:o};n(l),s(l)},onError:(n,i,r,a)=>{this.resetLoader(e,u),l(new Mi({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:o({url:c.url,data:void 0},n),error:new Error(`HTTP Error ${n.code} ${n.text}`),networkDetails:r,stats:a}))},onAbort:(n,i,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Mi({type:m.NETWORK_ERROR,details:v.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:r,stats:n}))},onTimeout:(n,i,r)=>{this.resetLoader(e,u),l(new Mi({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:n}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,r=i.total;if(n.loaded+=i.loaded,r){const i=Math.round(e.duration/t.duration),a=Math.min(Math.round(n.loaded/r),i),s=i-a,o=s*Math.round(n.loaded/a);n.total=n.loaded+o}else n.total=Math.max(n.loaded,n.total);const a=n.loading,s=i.loading;a.start?a.first+=s.first-s.start:(a.start=s.start,a.first=s.first),a.end=s.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Ci(e,t=null){const n=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},r=n.byteRangeStartOffset,a=n.byteRangeEndOffset;if(h(r)&&h(a)){var s;let t=r,n=a;if("initSegment"===e.sn&&"AES-128"===(null==(s=e.decryptdata)?void 0:s.method)){const e=a-r;e%16&&(n=a+(16-e%16)),0!==r&&(i.resetIV=!0,t=r-16)}i.rangeStart=t,i.rangeEnd=n}return i}function Ri(e,t){const n=new Error(`GAP ${e.gap?"tag":"attribute"} found`),i={type:m.MEDIA_ERROR,details:v.FRAG_GAP,fatal:!1,frag:e,error:n,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new Mi(i)}class Mi extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Di{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class Li{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function Pi(e){const t=e.byteLength,n=t&&new DataView(e.buffer).getUint8(t-1);return n?ee(e,0,t-n):e}class Oi{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(4*i);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],r=n[1],a=n[2],s=n[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=new Uint32Array(256);let f=0,p=0,g=0;for(g=0;g<256;g++)h[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let n=p^p<<1^p<<2^p<<3^p<<4;n=n>>>8^255&n^99,e[f]=n,t[n]=f;const o=h[f],g=h[o],m=h[g];let v=257*h[n]^16843008*n;i[f]=v<<24|v>>>8,r[f]=v<<16|v>>>16,a[f]=v<<8|v>>>24,s[f]=v,v=16843009*m^65537*g^257*o^16843008*f,l[n]=v<<24|v>>>8,u[n]=v<<16|v>>>16,c[n]=v<<8|v>>>24,d[n]=v,f?(f=o^h[h[h[m^o]]],p^=h[h[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;while(i<t.length&&n)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const a=this.ksRows=4*(r+6+1);let s,o;const l=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),c=this.sBox,d=this.rcon,h=this.invSubMix,f=h[0],p=h[1],g=h[2],m=h[3];let v,y;for(s=0;s<a;s++)s<r?v=l[s]=t[s]:(y=v,s%r===0?(y=y<<8|y>>>24,y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y],y^=d[s/r|0]<<24):r>6&&s%r===4&&(y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y]),l[s]=v=(l[s-r]^y)>>>0);for(o=0;o<a;o++)s=a-o,y=3&o?l[s]:l[s-4],u[o]=o<4||s<=4?y:f[c[y>>>24]]^p[c[y>>>16&255]]^g[c[y>>>8&255]]^m[c[255&y]],u[o]=u[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,s=this.invSubMix,o=s[0],l=s[1],u=s[2],c=s[3],d=this.uint8ArrayToUint32Array_(n);let h=d[0],f=d[1],p=d[2],g=d[3];const m=new Int32Array(e),v=new Int32Array(m.length);let y,b,S,T,_,w,E,x,A,k,I,C,R,M;const D=this.networkToHostOrderSwap;while(t<m.length){for(A=D(m[t]),k=D(m[t+1]),I=D(m[t+2]),C=D(m[t+3]),_=A^r[0],w=C^r[1],E=I^r[2],x=k^r[3],R=4,M=1;M<i;M++)y=o[_>>>24]^l[w>>16&255]^u[E>>8&255]^c[255&x]^r[R],b=o[w>>>24]^l[E>>16&255]^u[x>>8&255]^c[255&_]^r[R+1],S=o[E>>>24]^l[x>>16&255]^u[_>>8&255]^c[255&w]^r[R+2],T=o[x>>>24]^l[_>>16&255]^u[w>>8&255]^c[255&E]^r[R+3],_=y,w=b,E=S,x=T,R+=4;y=a[_>>>24]<<24^a[w>>16&255]<<16^a[E>>8&255]<<8^a[255&x]^r[R],b=a[w>>>24]<<24^a[E>>16&255]<<16^a[x>>8&255]<<8^a[255&_]^r[R+1],S=a[E>>>24]<<24^a[x>>16&255]<<16^a[_>>8&255]<<8^a[255&w]^r[R+2],T=a[x>>>24]<<24^a[_>>16&255]<<16^a[w>>8&255]<<8^a[255&E]^r[R+3],v[t]=D(y^h),v[t+1]=D(T^f),v[t+2]=D(S^p),v[t+3]=D(b^g),h=A,f=k,p=I,g=C,t+=4}return v.buffer}}const Ni=16;class Ui{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Pi(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n){return this.useSoftware?new Promise((i,r)=>{this.softwareDecrypt(new Uint8Array(e),t,n);const a=this.flush();a?i(a.buffer):r(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n)}softwareDecrypt(e,t,n){const{currentIV:i,currentResult:r,remainderData:a}=this;this.logOnce("JS AES decrypt"),a&&(e=He(a,e),this.remainderData=null);const s=this.getValidChunk(e);if(!s.length)return null;i&&(n=i);let o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new Oi),o.expandKey(t);const l=r;return this.currentResult=o.decrypt(s.buffer,0,n),this.currentIV=ee(s,-16).buffer,l||null}webCryptoDecrypt(e,t,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n));this.key=t,this.fastAesKey=new Li(this.subtle,t)}return this.fastAesKey.expandKey().then(t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");const i=new Di(this.subtle,new Uint8Array(n));return i.decrypt(e.buffer,t)}).catch(i=>{return E.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,n)})}onWebCryptoError(e,t,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n);const i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%Ni;return n!==e.length&&(t=ee(e,0,n),this.remainderData=ee(e,n)),t}logOnce(e){this.logEnabled&&(E.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Fi={toString:function(e){let t="";const n=e.length;for(let i=0;i<n;i++)t+=`[${e.start(i).toFixed(3)}-${e.end(i).toFixed(3)}]`;return t}},Bi={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Vi extends ci{constructor(e,t,n,i,r){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Bi.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=r,this.logPrefix=i,this.log=E.log.bind(E,`${i}:`),this.warn=E.warn.bind(E,`${i}:`),this.hls=e,this.fragmentLoader=new Ii(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ui(e.config),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Bi.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const n=t.partList;if(null!=n&&n.length){const e=n[n.length-1],t=mi.isBuffered(this.media,e.start+e.duration/2);return t}const i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);const i=this.config;this.levels&&i.autoStartLoad&&this.state===Bi.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:n,mediaBuffer:i,state:r}=this,a=n?n.currentTime:0,s=mi.bufferInfo(i||n,a,e.maxBufferHole);if(this.log(`media seeking to ${h(a)?a.toFixed(3):a}, state: ${r}`),this.state===Bi.ENDED)this.resetLoadingState();else if(t){const n=e.maxFragLookUpTolerance,i=t.start-n,r=t.start+t.duration+n;if(!s.len||r<s.start||i>s.end){const e=a>r;(a<i||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}n&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),this.loadedmetadata||s.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=Bi.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const i=t=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)};this._doFragLoad(e,t,n,i).then(t=>{if(!t)return;const n=this.state;this.fragContextChanged(e)?(n===Bi.FRAG_LOADING||!this.fragCurrent&&n===Bi.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=Bi.IDLE):("payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(g.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))}).catch(t=>{this.state!==Bi.STOPPED&&this.state!==Bi.ERROR&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this,i=n.getState(e);if(i===di.APPENDING){const t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,i?i.len:this.config.maxBufferLength),a=this.backtrackFragment,s=a?e.sn-a.sn:0;(1===s||this.reduceMaxBufferLength(r,e.duration))&&n.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===di.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:n};this.hls.trigger(g.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t}).then(t=>{const{hls:n}=this,{payload:i}=t,r=e.decryptdata;if(i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&"AES-128"===r.method){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).catch(t=>{throw n.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t}).then(i=>{const r=self.performance.now();return n.trigger(g.FRAG_DECRYPTED,{frag:e,payload:i,stats:{tstart:a,tdecrypt:r}}),t.payload=i,this.completeInitSegmentLoad(t)})}return this.completeInitSegmentLoad(t)}).catch(t=>{this.state!==Bi.STOPPED&&this.state!==Bi.ERROR&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state=Bi.IDLE,e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var n,i,r,a;const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===Ft.MAIN?"level":"track"} ${e.level} (frag:[${(null!=(n=e.startPTS)?n:NaN).toFixed(3)}-${(null!=(i=e.endPTS)?i:NaN).toFixed(3)}] > buffer:${s?Fi.toString(mi.getBuffered(s)):"(detached)"})`),"initSegment"!==e.sn){var o;if(e.type!==Ft.SUBTITLE){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=Bi.IDLE)}const t=null==(o=this.levels)?void 0:o[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=Bi.IDLE,s&&(!this.loadedmetadata&&e.type==Ft.MAIN&&s.buffered.length&&(null==(r=this.fragCurrent)?void 0:r.sn)===(null==(a=this.fragPrevious)?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:r}=e,a=!r||0===r.length||r.some(e=>!e),s=new vi(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(s)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,i){var r;const a=null==t?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let s=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=Bi.KEY_LOADING,this.fragCurrent=e,s=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(g.KEY_LOADED,e),this.state===Bi.KEY_LOADING&&(this.state=Bi.IDLE),e}),this.hls.trigger(g.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(s=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),n=Math.max(e.start,n||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const r=a.partList;if(r&&i){n>e.end&&a.fragmentHint&&(e=a.fragmentHint);const o=this.getNextPart(r,e,n);if(o>-1){const l=r[o];let u;return this.log(`Loading part sn: ${e.sn} p: ${l.index} cc: ${e.cc} of playlist [${a.startSN}-${a.endSN}] parts [0-${o}-${r.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=Bi.FRAG_LOADING,u=s?s.then(n=>{return!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(e,l,t,i)}).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,l,t,i).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(g.FRAG_LOADING,{frag:e,part:l,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):u}if(!e.url||this.loadedEndOfParts(r,n))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${a?"of ["+a.startSN+"-"+a.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),h(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Bi.FRAG_LOADING;const o=this.config.progressive;let l;return l=o&&s?s.then(t=>{return!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,i)}).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,o?i:void 0),s]).then(([e])=>{return!o&&e&&i&&i(e),e}).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(g.FRAG_LOADING,{frag:e,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(e,t,n,i){return new Promise((r,a)=>{var s;const o=[],l=null==(s=n.details)?void 0:s.partList,u=t=>{this.fragmentLoader.loadPart(e,t,i).then(i=>{o[t.index]=i;const a=i.part;this.hls.trigger(g.FRAG_LOADED,i);const s=En(n,e.sn,t.index+1)||xn(l,e.sn,t.index+1);if(!s)return r({frag:e,part:a,partsLoaded:o});u(s)}).catch(a)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===v.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(g.ERROR,t)}else this.hls.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Bi.PARSING)return void(this.fragCurrent||this.state===Bi.STOPPED||this.state===Bi.ERROR||(this.state=Bi.IDLE));const{frag:n,part:i,level:r}=t,a=self.performance.now();n.stats.parsing.end=a,i&&(i.stats.parsing.end=a),this.updateLevelTiming(n,i,r,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:r,part:a}=e;if(null==t||!t[i])return this.warn(`Levels object was unset while buffering fragment ${r} of level ${i}. The current chunk will not be buffered.`),null;const s=t[i],o=a>-1?En(s,r,a):null,l=o?o.fragment:wn(s,r,n);return l?(n&&n!==l&&(l.stats=n.stats),{frag:l,part:o,level:s}):null}bufferFragmentData(e,t,n,i,r){var a;if(!e||this.state!==Bi.PARSING)return;const{data1:s,data2:o}=e;let l=s;if(s&&o&&(l=He(s,o)),null==(a=l)||!a.length)return;const u={type:e.type,frag:t,part:n,chunkMeta:i,parent:t.type,data:l};if(this.hls.trigger(g.BUFFER_APPENDING,u),e.dropped&&e.independent&&!n){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!mi.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const n=t.currentTime,i=mi.bufferInfo(t,n,0),r=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),s=Math.max(Math.min(e.start-a,i.end-a),n+a);e.start-s>a&&this.flushMainBuffer(s,e.start)}getFwdBufferInfo(e,t){const n=this.getLoadPosition();return h(n)?this.getFwdBufferInfoAtPos(e,n,t):null}getFwdBufferInfoAtPos(e,t,n){const{config:{maxBufferHole:i}}=this,r=mi.bufferInfo(e,t,i);if(0===r.len&&void 0!==r.nextStart){const a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&r.nextStart<a.end)return mi.bufferInfo(e,t,Math.max(r.nextStart,i))}return r}getMaxBufferLength(e){const{config:t}=this;let n;return n=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),r=Math.max(e-3*t,n.maxMaxBufferLength/2,i);return r>=i&&(n.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0)}getAppendedFrag(e,t=Ft.MAIN){const n=this.fragmentTracker.getAppendedFrag(e,Ft.MAIN);return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:r}=this,a=n[0].start;let s;if(t.live){const o=r.initialLiveManifestSize;if(i<o)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${o})`),null;(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<a)&&(s=this.getInitialLiveFragment(t,n),this.startPosition=this.nextLoadPosition=s?this.hls.liveSyncPosition||s.start:e)}else e<=a&&(s=n[0]);if(!s){const n=r.lowLatencyMode?t.partEnd:t.fragmentEnd;s=this.getFragmentAtPosition(e,n,t)}return this.mapToInitFragWhenRequired(s)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===di.OK||n===di.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,r){const a=e.gap,s=this.getNextFragment(this.nextLoadPosition,t);if(null===s)return s;if(e=s,a&&e&&!e.gap&&n.nextStart){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i);if(null!==t&&n.len+t.len>=r)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,n){let i=-1,r=!1,a=!0;for(let s=0,o=e.length;s<o;s++){const o=e[s];if(a=a&&!o.independent,i>-1&&n<o.start)break;const l=o.loaded;l?i=-1:(r||o.independent||a)&&o.fragment===t&&(i=s),r=l}return i}loadedEndOfParts(e,t){const n=e[e.length-1];return n&&t>n.start&&n.loaded}getInitialLiveFragment(e,t){const n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=Pn(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=n.sn+1;if(r>=e.startSN&&r<=e.endSN){const a=t[r-e.startSN];n.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Bn(t,n.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(i=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:r}=this,{fragments:a,endSN:s}=n;const{fragmentHint:o}=n,{maxFragLookUpTolerance:l}=i,u=n.partList,c=!!(i.lowLatencyMode&&null!=u&&u.length&&o);let d;if(c&&o&&!this.bitrateTest&&(a=a.concat(o),s=o.sn),e<t){const n=e>t-l?0:l;d=On(r,a,e,n)}else d=a[a.length-1];if(d){const e=d.sn-n.startSN,t=this.fragmentTracker.getState(d);if((t===di.OK||t===di.PARTIAL&&d.gap)&&(r=d),r&&d.sn===r.sn&&(!c||u[0].fragment.sn>d.sn)){const t=r&&d.level===r.level;if(t){const t=a[e+1];d=d.sn<s&&this.fragmentTracker.getState(t)!==di.OK?t:null}}}return d}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,r=n.currentTime,a=e.fragments[0].start,s=e.edge,o=r>=a-t.maxFragLookUpTolerance&&r<=s;if(null!==i&&n.duration>i&&(r<i||!o)){const a=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&n.readyState<4||r<s-a)&&(this.loadedmetadata||(this.nextLoadPosition=i),n.readyState&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${s}, reset currentTime to : ${i.toFixed(3)}`),n.currentTime=i))}}alignPlaylists(e,t,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragments[0].start,a=!t,s=e.alignedSliding&&h(r);if(a||!s&&!r){const{fragPrevious:r}=this;Ei(r,n,e);const a=e.fragments[0].start;return this.log(`Live playlist sliding: ${a.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${r?r.sn:"na"} fragments: ${i}`),a}return r}waitForCdnTuneIn(e){const t=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*t)}setStartPosition(e,t){let n=this.startPosition;if(n<t&&(n=-1),-1===n||-1===this.lastCurrentTime){const i=null!==this.startTimeOffset,r=i?this.startTimeOffset:e.startTimeOffset;null!==r&&h(r)?(n=t+r,r<0&&(n+=e.totalduration),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Start time offset ${r} found in ${i?"multivariant":"media"} playlist, adjust startPosition to ${n}`),this.startPosition=n):e.live?n=this.hls.liveSyncPosition||t:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Bi.FRAG_LOADING_WAITING_RETRY)||(this.state=Bi.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;var i;if(this.fragContextChanged(n))return void this.warn(`Frag load error must match current frag to retry ${n.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const r=t.details===v.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(n,!0);const a=t.errorAction,{action:s,retryCount:o=0,retryConfig:l}=a||{};if(a&&s===Vn.RetryRequest&&l){this.resetStartWhenNotLoaded(this.levelLastLoaded);const i=Cn(l,o);this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${o+1}/${l.maxNumRetry} in ${i}ms`),a.resolved=!0,this.retryDate=self.performance.now()+i,this.state=Bi.FRAG_LOADING_WAITING_RETRY}else if(l&&a){if(this.resetFragmentErrors(e),!(o<l.maxNumRetry))return void E.warn(`${t.details} reached or exceeded max retry (${o})`);r||s===Vn.RemoveAlternatePermanently||(a.resolved=!0)}else(null==a?void 0:a.action)===Vn.SendAlternateToPenaltyBox?this.state=Bi.WAITING_LEVEL:this.state=Bi.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Bi.PARSING||this.state===Bi.PARSED){const t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);const a=!r;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Ft.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Bi.STOPPED&&(this.state=Bi.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const i=mi.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===Bi.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Bi.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){var r;const a=n.details;if(!a)return void this.warn("level.details undefined");const s=Object.keys(e.elementaryStreams).reduce((t,r)=>{const s=e.elementaryStreams[r];if(s){const o=s.endPTS-s.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${r} duration reliably (${o})`),t||!1;const l=i?0:gn(a,e,s.startPTS,s.endPTS,s.startDTS,s.endDTS);return this.hls.trigger(g.LEVEL_PTS_UPDATED,{details:a,level:n,drift:l,type:r,frag:e,start:s.startPTS,end:s.endPTS}),!0}return t},!1);if(!s&&null===(null==(r=this.transmuxer)?void 0:r.error)){const t=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===n.fragmentError&&(n.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(t.message),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of level "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=Bi.PARSED,this.hls.trigger(g.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class ji{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;return e.length?(n=1===e.length?e[0]:Gi(e,t),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function Gi(e,t){const n=new Uint8Array(t);let i=0;for(let r=0;r<e.length;r++){const t=e[r];n.set(t,i),i+=t.length}return n}function Hi(){return"function"===typeof __HLS_WORKER_BUNDLE__}function zi(){const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n=new self.Worker(t);return{worker:n,objectURL:t}}function Ki(e){const t=new self.URL(e,self.location.href).href,n=new self.Worker(t);return{worker:n,scriptURL:t}}function $i(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Wi{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=He(this.cachedData,e),this.cachedData=null);let n,i=ie(e,0),r=i?i.length:0;const a=this._audioTrack,s=this._id3Track,o=i?se(i):void 0,l=e.length;(null===this.basePTS||0===this.frameIndex&&h(o))&&(this.basePTS=qi(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Yt.audioId3,duration:Number.POSITIVE_INFINITY});while(r<l){if(this.canParse(e,r)){const t=this.appendFrame(a,e,r);t?(this.frameIndex++,this.lastPTS=t.sample.pts,r+=t.length,n=r):r=l}else ae(e,r)?(i=ie(e,r),s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Yt.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,n=r):r++;if(r===l&&n!==l){const t=ee(e,n);this.cachedData?this.cachedData=He(this.cachedData,t):this.cachedData=t}}return{audioTrack:a,videoTrack:$i(),id3Track:s,textTrack:$i()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:$i(),id3Track:this._id3Track,textTrack:$i()}}destroy(){}}const qi=(e,t,n)=>{if(h(e))return 90*e;const i=n?9e4*n.baseTime/n.timescale:0;return 9e4*t+i};function Yi(e,t,n,i){let r,a,s,o;const l=navigator.userAgent.toLowerCase(),u=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=1+((192&t[n+2])>>>6);const d=(60&t[n+2])>>>2;if(!(d>c.length-1))return s=(1&t[n+2])<<2,s|=(192&t[n+3])>>>6,E.log(`manifest codec:${i}, ADTS type:${r}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(r=5,o=new Array(4),a=d-3):(r=2,o=new Array(2),a=d):-1!==l.indexOf("android")?(r=2,o=new Array(2),a=d):(r=5,o=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&d>=6?a=d-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(d>=6&&1===s||/vivaldi/i.test(l))||!i&&1===s)&&(r=2,o=new Array(2)),a=d)),o[0]=r<<3,o[0]|=(14&d)>>1,o[1]|=(1&d)<<7,o[1]|=s<<3,5===r&&(o[1]|=(14&a)>>1,o[2]=(1&a)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:c[d],channelCount:s,codec:"mp4a.40."+r,manifestCodec:u};{const t=new Error(`invalid ADTS sampling index:${d}`);e.emit(g.ERROR,g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}}function Xi(e,t){return 255===e[t]&&240===(246&e[t+1])}function Qi(e,t){return 1&e[t+1]?7:9}function Zi(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Ji(e,t){return t+5<e.length}function er(e,t){return t+1<e.length&&Xi(e,t)}function tr(e,t){return Ji(e,t)&&Xi(e,t)&&Zi(e,t)<=e.length-t}function nr(e,t){if(er(e,t)){const n=Qi(e,t);if(t+n>=e.length)return!1;const i=Zi(e,t);if(i<=n)return!1;const r=t+i;return r===e.length||er(e,r)}return!1}function ir(e,t,n,i,r){if(!e.samplerate){const a=Yi(t,n,i,r);if(!a)return;e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,E.log(`parsed codec:${e.codec}, rate:${a.samplerate}, channels:${a.channelCount}`)}}function rr(e){return 9216e4/e}function ar(e,t){const n=Qi(e,t);if(t+n<=e.length){const i=Zi(e,t)-n;if(i>0)return{headerLength:n,frameLength:i}}}function sr(e,t,n,i,r){const a=rr(e.samplerate),s=i+r*a,o=ar(t,n);let l;if(o){const{frameLength:i,headerLength:r}=o,a=r+i,u=Math.max(0,n+a-t.length);u?(l=new Uint8Array(a-r),l.set(t.subarray(n+r,t.length),0)):l=t.subarray(n+r,n+a);const c={unit:l,pts:s};return u||e.samples.push(c),{sample:c,length:a,missing:u}}const u=t.length-n;l=new Uint8Array(u),l.set(t.subarray(n,t.length),0);const c={unit:l,pts:s};return{sample:c,length:u,missing:-1}}let or=null;const lr=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],ur=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],cr=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],dr=[0,1,1,4];function hr(e,t,n,i,r){if(n+24>t.length)return;const a=fr(t,n);if(a&&n+a.frameLength<=t.length){const s=9e4*a.samplesPerFrame/a.sampleRate,o=i+r*s,l={unit:t.subarray(n,n+a.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(l),{sample:l,length:a.frameLength,missing:0}}}function fr(e,t){const n=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==n&&0!==r&&15!==r&&3!==a){const s=e[t+2]>>1&1,o=e[t+3]>>6,l=3===n?3-i:3===i?3:4,u=1e3*lr[14*l+r-1],c=3===n?0:2===n?1:2,d=ur[3*c+a],h=3===o?1:2,f=cr[n][i],p=dr[i],g=8*f*p,m=Math.floor(f*u/d+s)*p;if(null===or){const e=navigator.userAgent||"",t=e.match(/Chrome\/(\d+)/i);or=t?parseInt(t[1]):0}const v=!!or&&or<=87;return v&&2===i&&u>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:d,channelCount:h,frameLength:m,samplesPerFrame:g}}}function pr(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function gr(e,t){return t+1<e.length&&pr(e,t)}function mr(e,t){const n=4;return pr(e,t)&&n<=e.length-t}function vr(e,t){if(t+1<e.length&&pr(e,t)){const n=4,i=fr(e,t);let r=n;null!=i&&i.frameLength&&(r=i.frameLength);const a=t+r;return a===e.length||gr(e,a)}return!1}class yr extends Wi{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ie(e,0);let n=(null==t?void 0:t.length)||0;if(vr(e,n))return!1;for(let i=e.length;n<i;n++)if(nr(e,n))return E.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return tr(e,t)}appendFrame(e,t,n){ir(e,this.observer,t,n,e.manifestCodec);const i=sr(e,t,n,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}}const br=/\/emsg[-/]ID3/i;class Sr{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const r=this.videoTrack=$i("video",1),a=this.audioTrack=$i("audio",1),s=this.txtTrack=$i("text",1);if(this.id3Track=$i("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=Me(e);if(o.video){const{id:e,timescale:t,codec:n}=o.video;r.id=e,r.timescale=s.timescale=t,r.codec=n}if(o.audio){const{id:e,timescale:t,codec:n}=o.audio;a.id=e,a.timescale=t,a.codec=n}s.id=Te.text,r.sampleDuration=0,r.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return Ie(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=He(this.remainderData,e));const t=Ge(n);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=n;const a=this.extractID3Track(i,t);return r.samples=ze(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=ze(e,t),{videoTrack:t,audioTrack:$i(),id3Track:i,textTrack:$i()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=Ce(e.samples,["emsg"]);i&&i.forEach(e=>{const i=Ye(e);if(br.test(i.schemeIdUri)){const e=h(i.presentationTime)?i.presentationTime/i.timeScale:t+i.presentationTimeDelta/i.timeScale;let r=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const a=i.payload;n.samples.push({data:a,len:a.byteLength,dts:e,pts:e,type:Yt.emsg,duration:r})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const Tr=(e,t)=>{let n=0,i=5;t+=i;const r=new Uint32Array(1),a=new Uint32Array(1),s=new Uint8Array(1);while(i>0){s[0]=e[t];const o=Math.min(i,8),l=8-o;a[0]=4278190080>>>24+l<<l,r[0]=(s[0]&a[0])>>l,n=n?n<<o|r[0]:r[0],t+=1,i-=o}return n};class _r extends Wi{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=wr(e,t,n,this.basePTS,this.frameIndex);if(-1!==i){const t=e.samples[e.samples.length-1];return{sample:t,length:i,missing:0}}}static probe(e){if(!e)return!1;const t=ie(e,0);if(!t)return!1;const n=t.length;return 11===e[n]&&119===e[n+1]&&void 0!==se(t)&&Tr(e,n)<16}}function wr(e,t,n,i,r){if(n+8>t.length)return-1;if(11!==t[n]||119!==t[n+1])return-1;const a=t[n+4]>>6;if(a>=3)return-1;const s=[48e3,44100,32e3],o=s[a],l=63&t[n+4],u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920],c=2*u[3*l+a];if(n+c>t.length)return-1;const d=t[n+6]>>5;let h=0;2===d?h+=2:(1&d&&1!==d&&(h+=2),4&d&&(h+=2));const f=(t[n+6]<<8|t[n+7])>>12-h&1,p=[2,1,2,3,3,4,4,5],g=p[d]+f,m=t[n+5]>>3,v=7&t[n+5],y=new Uint8Array([a<<6|m<<1|v>>2,(3&v)<<6|d<<3|f<<2|l>>4,l<<4&224]),b=1536/o*9e4,S=i+r*b,T=t.subarray(n,n+c);return e.config=y,e.channelCount=g,e.samplerate=o,e.samples.push({unit:T,pts:S}),c}class Er{constructor(){this.VideoSample=null}createVideoSample(e,t,n,i){return{key:e,frame:!1,pts:t,dts:n,units:[],debug:i,length:0}}getLastNalUnit(e){var t;let n,i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){const e=i.units;n=e[e.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const n=t.samples,i=n.length;if(!i)return void t.dropped++;{const t=n[i-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}e.debug.length&&E.log(e.pts+"/"+e.dts+":"+e.debug)}}class xr{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");i.set(e.subarray(n,n+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&E.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t,n=8,i=8;for(let r=0;r<e;r++)0!==i&&(t=this.readEG(),i=(n+t+256)%256),n=0===i?n:i}readSPS(){let e,t,n,i=0,r=0,a=0,s=0;const o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),d=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();const g=o();if(l(5),d(3),o(),f(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){const e=u();if(3===e&&d(1),f(),f(),d(1),c())for(t=3!==e?8:12,n=0;n<t;n++)c()&&p(n<6?16:64)}f();const m=u();if(0===m)u();else if(1===m)for(d(1),h(),h(),e=u(),n=0;n<e;n++)h();f(),d(1);const v=u(),y=u(),b=l(1);0===b&&d(1),d(1),c()&&(i=u(),r=u(),a=u(),s=u());let S=[1,1];if(c()&&c()){const e=o();switch(e){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[o()<<8|o(),o()<<8|o()];break}}return{width:Math.ceil(16*(v+1)-2*i-2*r),height:(2-b)*(y+1)*16-(b?2:4)*(a+s),pixelRatio:S}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Ar extends Er{parseAVCPES(e,t,n,i,r){const a=this.parseAVCNALu(e,n.data);let s,o=this.VideoSample,l=!1;n.data=null,o&&a.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"")),a.forEach(i=>{var a;switch(i.type){case 1:{let t=!1;s=!0;const r=i.data;if(l&&r.length>4){const e=new xr(r).readSliceType();2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var u;if(t)null!=(u=o)&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null);o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts,"")),o.frame=!0,o.key=t;break}case 5:s=!0,null!=(a=o)&&a.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts,"")),o.key=!0,o.frame=!0;break;case 6:s=!0,We(i.data,1,n.pts,t.samples);break;case 7:{var c,d;s=!0,l=!0;const t=i.data,n=new xr(t),a=n.readSPS();if(!e.sps||e.width!==a.width||e.height!==a.height||(null==(c=e.pixelRatio)?void 0:c[0])!==a.pixelRatio[0]||(null==(d=e.pixelRatio)?void 0:d[1])!==a.pixelRatio[1]){e.width=a.width,e.height=a.height,e.pixelRatio=a.pixelRatio,e.sps=[t],e.duration=r;const n=t.subarray(1,4);let i="avc1.";for(let e=0;e<3;e++){let t=n[e].toString(16);t.length<2&&(t="0"+t),i+=t}e.codec=i}break}case 8:s=!0,e.pps=[i.data];break;case 9:s=!0,e.audFound=!0,o&&this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"");break;case 12:s=!0;break;default:s=!1,o&&(o.debug+="unknown NAL "+i.type+" ");break}if(o&&s){const e=o.units;e.push(i)}}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}parseAVCNALu(e,t){const n=t.byteLength;let i=e.naluState||0;const r=i,a=[];let s,o,l,u=0,c=-1,d=0;-1===i&&(c=0,d=31&t[0],i=0,u=1);while(u<n)if(s=t[u++],i)if(1!==i)if(s)if(1===s){if(o=u-i-1,c>=0){const e={data:t.subarray(c,o),type:d};a.push(e)}else{const n=this.getLastNalUnit(e.samples);n&&(r&&u<=4-r&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-r)),o>0&&(n.data=He(n.data,t.subarray(0,o)),n.state=0))}u<n?(l=31&t[u],c=u,d=l,i=0):i=-1}else i=0;else i=3;else i=s?0:2;else i=s?0:1;if(c>=0&&i>=0){const e={data:t.subarray(c,n),type:d,state:i};a.push(e)}if(0===a.length){const n=this.getLastNalUnit(e.samples);n&&(n.data=He(n.data,t))}return e.naluState=i,a}}class kr{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Ui(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(a).then(r=>{const a=new Uint8Array(r);i.set(a,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)})}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)n.set(e.subarray(r,r+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)e.set(n.subarray(i,i+16),r);return e}decryptAvcSample(e,t,n,i,r){const a=qe(r.data),s=this.getAvcEncryptedData(a);this.decryptBuffer(s.buffer).then(s=>{r.data=this.getAvcDecryptedUnit(a,s),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)})}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void i();const r=e[t].units;for(;;n++){if(n>=r.length)break;const a=r[n];if(!(a.data.length<=48||1!==a.type&&5!==a.type)&&(this.decryptAvcSample(e,t,n,i,a),!this.decrypter.isSync()))return}}}}const Ir=188;class Cr{constructor(e,t,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.videoParser=new Ar}static probe(e){const t=Cr.syncOffset(e);return t>0&&E.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let n=Math.min(5*Ir,t-Ir)+1,i=0;while(i<n){let r=!1,a=-1,s=0;for(let o=i;o<t;o+=Ir){if(71!==e[o]||t-o!==Ir&&71!==e[o+Ir]){if(s)return-1;break}if(s++,-1===a&&(a=o,0!==a&&(n=Math.min(a+99*Ir,e.length-Ir)+1)),r||(r=0===Rr(e,o)),r&&s>1&&(0===a&&s>2||o+Ir>n))return a}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Te[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Cr.createTrack("video"),this._audioTrack=Cr.createTrack("audio",i),this._id3Track=Cr.createTrack("id3"),this._txtTrack=Cr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n,this._duration=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,i=!1){let r;n||(this.sampleAes=null);const a=this._videoTrack,s=this._audioTrack,o=this._id3Track,l=this._txtTrack;let u=a.pid,c=a.pesData,d=s.pid,h=o.pid,f=s.pesData,p=o.pesData,g=null,m=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(e=He(this.remainderData,e),y=e.length,this.remainderData=null),y<Ir&&!i)return this.remainderData=e,{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l};const b=Math.max(0,Cr.syncOffset(e));y-=(y-b)%Ir,y<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let S=0;for(let _=b;_<y;_+=Ir)if(71===e[_]){const t=!!(64&e[_+1]),i=Rr(e,_),y=(48&e[_+3])>>4;let S;if(y>1){if(S=_+5+e[_+4],S===_+Ir)continue}else S=_+4;switch(i){case u:t&&(c&&(r=Or(c))&&this.videoParser.parseAVCPES(a,l,r,!1,this._duration),c={data:[],size:0}),c&&(c.data.push(e.subarray(S,_+Ir)),c.size+=_+Ir-S);break;case d:if(t){if(f&&(r=Or(f)))switch(s.segmentCodec){case"aac":this.parseAACPES(s,r);break;case"mp3":this.parseMPEGPES(s,r);break;case"ac3":this.parseAC3PES(s,r);break}f={data:[],size:0}}f&&(f.data.push(e.subarray(S,_+Ir)),f.size+=_+Ir-S);break;case h:t&&(p&&(r=Or(p))&&this.parseID3PES(o,r),p={data:[],size:0}),p&&(p.data.push(e.subarray(S,_+Ir)),p.size+=_+Ir-S);break;case 0:t&&(S+=e[S]+1),v=this._pmtId=Mr(e,S);break;case v:{t&&(S+=e[S]+1);const i=Dr(e,S,this.typeSupported,n,this.observer);u=i.videoPid,u>0&&(a.pid=u,a.segmentCodec=i.segmentVideoCodec),d=i.audioPid,d>0&&(s.pid=d,s.segmentCodec=i.segmentAudioCodec),h=i.id3Pid,h>0&&(o.pid=h),null===g||m||(E.warn(`MPEG-TS PMT found at ${_} after unknown PID '${g}'. Backtracking to sync byte @${b} to parse all TS packets.`),g=null,_=b-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=i;break}}else S++;S>0&&Lr(this.observer,new Error(`Found ${S} TS packet/s that do not start with 0x47`)),a.pesData=c,s.pesData=f,o.pesData=p;const T={audioTrack:s,videoTrack:a,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(T),T}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:r}=e,a=n.pesData,s=t.pesData,o=i.pesData;let l;if(a&&(l=Or(a))?(this.videoParser.parseAVCPES(n,r,l,!0,this._duration),n.pesData=null):n.pesData=a,s&&(l=Or(s))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l);break}t.pesData=null}else null!=s&&s.size&&E.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=s;o&&(l=Or(o))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),r=this.sampleAes=new kr(this.observer,this.config,t);return this.decrypt(i,r)}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{n(e)}):n(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{n(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let r,a,s,o=t.data;if(i){this.aacOverFlow=null;const t=i.missing,r=i.sample.unit.byteLength;if(-1===t)o=He(i.sample.unit,o);else{const a=r-t;i.sample.unit.set(o.subarray(0,t),a),e.samples.push(i.sample),n=i.missing}}for(r=n,a=o.length;r<a-1;r++)if(er(o,r))break;if(r!==n){let e;const t=r<a-1;if(e=t?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES",Lr(this.observer,new Error(e),t),!t)return}if(ir(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)s=t.pts;else{if(!i)return void E.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=rr(e.samplerate);s=i.sample.pts+t}}let l,u=0;while(r<a){if(l=sr(e,o,r,s,u),r+=l.length,l.missing){this.aacOverFlow=l;break}for(u++;r<a-1;r++)if(er(o,r))break}}parseMPEGPES(e,t){const n=t.data,i=n.length;let r=0,a=0;const s=t.pts;if(void 0!==s)while(a<i)if(gr(n,a)){const t=hr(e,n,a,s,r);if(!t)break;a+=t.length,r++}else a++;else E.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(void 0===i)return void E.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=n.length;let a,s=0,o=0;while(o<r&&(a=wr(e,n,o,i,s++))>0)o+=a}}parseID3PES(e,t){if(void 0===t.pts)return void E.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=d({},t,{type:this._videoTrack?Yt.emsg:Yt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function Rr(e,t){return((31&e[t+1])<<8)+e[t+2]}function Mr(e,t){return(31&e[t+10])<<8|e[t+11]}function Dr(e,t,n,i,r){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},s=(15&e[t+1])<<8|e[t+2],o=t+3+s-4,l=(15&e[t+10])<<8|e[t+11];t+=12+l;while(t<o){const s=Rr(e,t),o=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){Pr("ADTS AAC");break}case 15:-1===a.audioPid&&(a.audioPid=s);break;case 21:-1===a.id3Pid&&(a.id3Pid=s);break;case 219:if(!i){Pr("H.264");break}case 27:-1===a.videoPid&&(a.videoPid=s,a.segmentVideoCodec="avc");break;case 3:case 4:n.mpeg||n.mp3?-1===a.audioPid&&(a.audioPid=s,a.segmentAudioCodec="mp3"):E.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){Pr("AC-3");break}case 129:n.ac3?-1===a.audioPid&&(a.audioPid=s,a.segmentAudioCodec="ac3"):E.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&o>0){let i=t+5,r=o;while(r>2){const t=e[i];switch(t){case 106:!0!==n.ac3?E.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=s,a.segmentAudioCodec="ac3");break}const o=e[i+1]+2;i+=o,r-=o}}break;case 194:case 135:return Lr(r,new Error("Unsupported EC-3 in M2TS found")),a;case 36:return Lr(r,new Error("Unsupported HEVC in M2TS found")),a}t+=o+5}return a}function Lr(e,t,n){E.warn(`parsing error: ${t.message}`),e.emit(g.ERROR,g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:t,reason:t.message})}function Pr(e){E.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function Or(e){let t,n,i,r,a,s=0;const o=e.data;if(!e||0===e.size)return null;while(o[0].length<19&&o.length>1)o[0]=He(o[0],o[1]),o.splice(1,1);t=o[0];const l=(t[0]<<16)+(t[1]<<8)+t[2];if(1===l){if(n=(t[4]<<8)+t[5],n&&n>e.size-6)return null;const l=t[7];192&l&&(r=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,r-a>54e5&&(E.warn(`${Math.round((r-a)/9e4)}s delta between PTS and DTS, align them`),r=a)):a=r),i=t[8];let u=i+9;if(e.size<=u)return null;e.size-=u;const c=new Uint8Array(e.size);for(let e=0,n=o.length;e<n;e++){t=o[e];let n=t.byteLength;if(u){if(u>n){u-=n;continue}t=t.subarray(u),n-=u,u=0}c.set(t,s),s+=n}return n&&(n-=i+3),{data:c,pts:r,dts:a,len:n}}return null}class Nr extends Wi{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ie(e,0);let n=(null==t?void 0:t.length)||0;if(t&&11===e[n]&&119===e[n+1]&&void 0!==se(t)&&Tr(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(vr(e,n))return E.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return mr(e,t)}appendFrame(e,t,n){if(null!==this.basePTS)return hr(e,t,n,this.basePTS,this.frameIndex)}}class Ur{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Fr=Math.pow(2,32)-1;class Br{static init(){let e;for(e in Br.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Br.types)Br.types.hasOwnProperty(e)&&(Br.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Br.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Br.STTS=Br.STSC=Br.STCO=r,Br.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Br.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Br.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Br.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);Br.FTYP=Br.box(Br.types.ftyp,a,o,a,s),Br.DINF=Br.box(Br.types.dinf,Br.box(Br.types.dref,i))}static box(e,...t){let n=8,i=t.length;const r=i;while(i--)n+=t[i].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=255&n,a.set(e,4),i=0,n=8;i<r;i++)a.set(t[i],n),n+=t[i].byteLength;return a}static hdlr(e){return Br.box(Br.types.hdlr,Br.HDLR_TYPES[e])}static mdat(e){return Br.box(Br.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Fr+1)),i=Math.floor(t%(Fr+1));return Br.box(Br.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(e){return Br.box(Br.types.mdia,Br.mdhd(e.timescale,e.duration),Br.hdlr(e.type),Br.minf(e))}static mfhd(e){return Br.box(Br.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?Br.box(Br.types.minf,Br.box(Br.types.smhd,Br.SMHD),Br.DINF,Br.stbl(e)):Br.box(Br.types.minf,Br.box(Br.types.vmhd,Br.VMHD),Br.DINF,Br.stbl(e))}static moof(e,t,n){return Br.box(Br.types.moof,Br.mfhd(e),Br.traf(n,t))}static moov(e){let t=e.length;const n=[];while(t--)n[t]=Br.trak(e[t]);return Br.box.apply(null,[Br.types.moov,Br.mvhd(e[0].timescale,e[0].duration)].concat(n).concat(Br.mvex(e)))}static mvex(e){let t=e.length;const n=[];while(t--)n[t]=Br.trex(e[t]);return Br.box.apply(null,[Br.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Fr+1)),i=Math.floor(t%(Fr+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Br.box(Br.types.mvhd,r)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return Br.box(Br.types.sdtp,n)}static stbl(e){return Br.box(Br.types.stbl,Br.stsd(e),Br.box(Br.types.stts,Br.STTS),Br.box(Br.types.stsc,Br.STSC),Br.box(Br.types.stsz,Br.STSZ),Br.box(Br.types.stco,Br.STCO))}static avc1(e){let t,n,i,r=[],a=[];for(t=0;t<e.sps.length;t++)n=e.sps[t],i=n.byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(n));for(t=0;t<e.pps.length;t++)n=e.pps[t],i=n.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(n));const s=Br.box(Br.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(a))),o=e.width,l=e.height,u=e.pixelRatio[0],c=e.pixelRatio[1];return Br.box(Br.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,Br.box(Br.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Br.box(Br.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return Br.box(Br.types.mp4a,Br.audioStsd(e),Br.box(Br.types.esds,Br.esds(e)))}static mp3(e){return Br.box(Br.types[".mp3"],Br.audioStsd(e))}static ac3(e){return Br.box(Br.types["ac-3"],Br.audioStsd(e),Br.box(Br.types.dac3,e.config))}static stsd(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?Br.box(Br.types.stsd,Br.STSD,Br.mp3(e)):"ac3"===e.segmentCodec?Br.box(Br.types.stsd,Br.STSD,Br.ac3(e)):Br.box(Br.types.stsd,Br.STSD,Br.mp4a(e)):Br.box(Br.types.stsd,Br.STSD,Br.avc1(e))}static tkhd(e){const t=e.id,n=e.duration*e.timescale,i=e.width,r=e.height,a=Math.floor(n/(Fr+1)),s=Math.floor(n%(Fr+1));return Br.box(Br.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,r>>8&255,255&r,0,0]))}static traf(e,t){const n=Br.sdtp(e),i=e.id,r=Math.floor(t/(Fr+1)),a=Math.floor(t%(Fr+1));return Br.box(Br.types.traf,Br.box(Br.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),Br.box(Br.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a])),Br.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,Br.box(Br.types.trak,Br.tkhd(e),Br.mdia(e))}static trex(e){const t=e.id;return Br.box(Br.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,r=12+16*i,a=new Uint8Array(r);let s,o,l,u,c,d;for(t+=8+r,a.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),s=0;s<i;s++)o=n[s],l=o.duration,u=o.size,c=o.flags,d=o.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*s);return Br.box(Br.types.trun,a)}static initSegment(e){Br.types||Br.init();const t=Br.moov(e),n=He(Br.FTYP,t);return n}}Br.types=void 0,Br.HDLR_TYPES=void 0,Br.STTS=void 0,Br.STSC=void 0,Br.STCO=void 0,Br.STSZ=void 0,Br.VMHD=void 0,Br.SMHD=void 0,Br.STSD=void 0,Br.FTYP=void 0,Br.DINF=void 0;const Vr=9e4;function jr(e,t,n=1,i=!1){const r=e*t*n;return i?Math.round(r):r}function Gr(e,t,n=1,i=!1){return jr(e,t,1/n,i)}function Hr(e,t=!1){return jr(e,1e3,1/Vr,t)}function zr(e,t=1){return jr(e,Vr,1/t)}const Kr=1e4,$r=1024,Wr=1152,qr=1536;let Yr,Xr=null,Qr=null;class Zr{constructor(e,t,n,i=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===Xr){const e=navigator.userAgent||"",t=e.match(/Chrome\/(\d+)/i);Xr=t?parseInt(t[1]):0}if(null===Qr){const e=navigator.userAgent.match(/Safari\/(\d+)/i);Qr=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){E.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){E.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){E.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e.reduce((e,n)=>{const i=n.pts-e;return i<-4294967296?(t=!0,Jr(e,n.pts)):i>0?e:n.pts},e[0].pts);return t&&E.debug("PTS rollover detected"),n}remux(e,t,n,i,r,a,s,o){let l,u,c,d,h,f,p=r,g=r;const m=e.pid>-1,v=t.pid>-1,y=t.samples.length,b=e.samples.length>0,S=s&&y>0||y>1,T=(!m||b)&&(!v||S)||this.ISGenerated||s;if(T){if(this.ISGenerated){var _,w,x,A;const e=this.videoTrackConfig;!e||t.width===e.width&&t.height===e.height&&(null==(_=t.pixelRatio)?void 0:_[0])===(null==(w=e.pixelRatio)?void 0:w[0])&&(null==(x=t.pixelRatio)?void 0:x[1])===(null==(A=e.pixelRatio)?void 0:A[1])||this.resetInitSegment()}else c=this.generateIS(e,t,r,a);const n=this.isVideoContiguous;let i,s=-1;if(S&&(s=ea(t.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,s>0){E.warn(`[mp4-remuxer]: Dropped ${s} out of ${y} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(s),t.dropped+=s,g+=(t.samples[0].pts-e)/t.inputTimeScale,i=g}else-1===s&&(E.warn(`[mp4-remuxer]: No keyframe found out of ${y} video samples`),f=!1);if(this.ISGenerated){if(b&&S){const n=this.getVideoStartPts(t.samples),i=Jr(e.samples[0].pts,n)-n,r=i/t.inputTimeScale;p+=Math.max(0,r),g+=Math.max(0,-r)}if(b){if(e.samplerate||(E.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,r,a)),u=this.remuxAudio(e,p,this.isAudioContiguous,a,v||S||o===Ft.AUDIO?g:void 0),S){const i=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(E.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,r,a)),l=this.remuxVideo(t,g,n,i)}}else S&&(l=this.remuxVideo(t,g,n,0));l&&(l.firstKeyFrame=s,l.independent=-1!==s,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(h=ta(n,r,this._initPTS,this._initDTS)),i.samples.length&&(d=na(i,r,this._initPTS))),{audio:u,video:l,initSegment:c,independent:f,text:d,id3:h}}generateIS(e,t,n,i){const r=e.samples,a=t.samples,s=this.typeSupported,o={},l=this._initPTS;let u,c,d,h=!l||i,f="audio/mp4";if(h&&(u=c=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":s.mpeg?(f="audio/mpeg",e.codec=""):s.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&s.mpeg?new Uint8Array(0):Br.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(d=e.inputTimeScale,l&&d===l.timescale?h=!1:u=c=r[0].pts-Math.round(d*n))}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Br.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(d=t.inputTimeScale,l&&d===l.timescale)h=!1;else{const e=this.getVideoStartPts(a),t=Math.round(d*n);c=Math.min(c,Jr(a[0].dts,e)-t),u=Math.min(u,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:u,timescale:d},this._initDTS={baseTime:c,timescale:d}):u=d=void 0,{tracks:o,initPTS:u,timescale:d}}remuxVideo(e,t,n,i){const r=e.inputTimeScale,a=e.samples,s=[],o=a.length,l=this._initPTS;let u,c,h=this.nextAvcDts,f=8,p=this.videoSampleDuration,y=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,S=!1;if(!n||null===h){const e=t*r,i=a[0].pts-Jr(a[0].dts,a[0].pts);Xr&&null!==h&&Math.abs(e-i-h)<15e3?n=!0:h=e-i}const T=l.baseTime*r/l.timescale;for(let d=0;d<o;d++){const e=a[d];e.pts=Jr(e.pts-T,h),e.dts=Jr(e.dts-T,h),e.dts<a[d>0?d-1:d].dts&&(S=!0)}S&&a.sort(function(e,t){const n=e.dts-t.dts,i=e.pts-t.pts;return n||i}),u=a[0].dts,c=a[a.length-1].dts;const _=c-u,w=_?Math.round(_/(o-1)):p||e.inputTimeScale/30;if(n){const e=u-h,n=e>w,i=e<-1;if((n||i)&&(n?E.warn(`AVC: ${Hr(e,!0)} ms (${e}dts) hole between fragments detected at ${t.toFixed(3)}`):E.warn(`AVC: ${Hr(-e,!0)} ms (${e}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!i||h>=a[0].pts||Xr)){u=h;const t=a[0].pts-e;if(n)a[0].dts=u,a[0].pts=t;else for(let n=0;n<a.length;n++){if(a[n].dts>t)break;a[n].dts-=e,a[n].pts-=e}E.log(`Video: Initial PTS/DTS adjusted: ${Hr(t,!0)}/${Hr(u,!0)}, delta: ${Hr(e,!0)} ms`)}}u=Math.max(0,u);let x=0,A=0,k=u;for(let d=0;d<o;d++){const e=a[d],t=e.units,n=t.length;let i=0;for(let r=0;r<n;r++)i+=t[r].data.length;A+=i,x+=n,e.length=i,e.dts<k?(e.dts=k,k+=w/4|0||1):k=e.dts,y=Math.min(e.pts,y),b=Math.max(e.pts,b)}c=a[o-1].dts;const I=A+4*x+8;let C;try{C=new Uint8Array(I)}catch(e){return void this.observer.emit(g.ERROR,g.ERROR,{type:m.MUX_ERROR,details:v.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:I,reason:`fail allocating video mdat ${I}`})}const R=new DataView(C.buffer);R.setUint32(0,I),C.set(Br.types.mdat,4);let M=!1,D=Number.POSITIVE_INFINITY,L=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY,O=Number.NEGATIVE_INFINITY;for(let d=0;d<o;d++){const e=a[d],t=e.units;let n,l=0;for(let i=0,r=t.length;i<r;i++){const e=t[i],n=e.data,r=e.data.byteLength;R.setUint32(f,r),f+=4,C.set(n,f),f+=r,l+=4+r}if(d<o-1)p=a[d+1].dts-e.dts,n=a[d+1].pts-e.pts;else{const t=this.config,s=d>0?e.dts-a[d-1].dts:w;if(n=d>0?e.pts-a[d-1].pts:w,t.stretchShortVideoTrack&&null!==this.nextAudioPts){const n=Math.floor(t.maxBufferHole*r),a=(i?y+i*r:this.nextAudioPts)-e.pts;a>n?(p=a-s,p<0?p=s:M=!0,E.log(`[mp4-remuxer]: It is approximately ${a/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=s}else p=s}const u=Math.round(e.pts-e.dts);D=Math.min(D,p),P=Math.max(P,p),L=Math.min(L,n),O=Math.max(O,n),s.push(new ia(e.key,p,l,u))}if(s.length)if(Xr){if(Xr<70){const e=s[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Qr&&O-L<P-D&&w/P<.025&&0===s[0].cts){E.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=u;for(let t=0,n=s.length;t<n;t++){const i=e+s[t].duration,r=e+s[t].cts;if(t<n-1){const e=i+s[t+1].cts;s[t].duration=e-r}else s[t].duration=t?s[t-1].duration:w;s[t].cts=0,e=i}}p=M||!p?w:p,this.nextAvcDts=h=c+p,this.videoSampleDuration=p,this.isVideoContiguous=!0;const N=Br.moof(e.sequenceNumber++,u,d({},e,{samples:s})),U="video",F={data1:N,data2:C,startPTS:y/r,endPTS:(b+p)/r,startDTS:u/r,endDTS:h/r,type:U,hasAudio:!1,hasVideo:!0,nb:s.length,dropped:e.dropped};return e.samples=[],e.dropped=0,F}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Wr;case"ac3":return qr;default:return $r}}remuxAudio(e,t,n,i,r){const a=e.inputTimeScale,s=e.samplerate?e.samplerate:a,o=a/s,l=this.getSamplesPerFrame(e),u=l*o,c=this._initPTS,h="mp3"===e.segmentCodec&&this.typeSupported.mpeg,f=[],p=void 0!==r;let y=e.samples,b=h?0:8,S=this.nextAudioPts||-1;const T=t*a,_=c.baseTime*a/c.timescale;if(this.isAudioContiguous=n=n||y.length&&S>0&&(i&&Math.abs(T-S)<9e3||Math.abs(Jr(y[0].pts-_,T)-S)<20*u),y.forEach(function(e){e.pts=Jr(e.pts-_,T)}),!n||S<0){if(y=y.filter(e=>e.pts>=0),!y.length)return;S=0===r?0:i&&!p?Math.max(0,T):y[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let n=0,i=S;n<y.length;n++){const r=y[n],s=r.pts,o=s-i,l=Math.abs(1e3*o/a);if(o<=-t*u&&p)0===n&&(E.warn(`Audio frame @ ${(s/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/a)} ms.`),this.nextAudioPts=S=i=s);else if(o>=t*u&&l<Kr&&p){let t=Math.round(o/u);i=s-t*u,i<0&&(t--,i+=u),0===n&&(this.nextAudioPts=S=i),E.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(i/a).toFixed(3)}s due to ${Math.round(1e3*o/a)} ms gap.`);for(let a=0;a<t;a++){const t=Math.max(i,0);let a=Ur.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);a||(E.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),a=r.unit.subarray()),y.splice(n,0,{unit:a,pts:t}),i+=u,n++}}r.pts=i,i+=u}}let w,x=null,A=null,k=0,I=y.length;while(I--)k+=y[I].unit.byteLength;for(let d=0,E=y.length;d<E;d++){const t=y[d],i=t.unit;let r=t.pts;if(null!==A){const e=f[d-1];e.duration=Math.round((r-A)/o)}else{if(n&&"aac"===e.segmentCodec&&(r=S),x=r,!(k>0))return;k+=b;try{w=new Uint8Array(k)}catch(e){return void this.observer.emit(g.ERROR,g.ERROR,{type:m.MUX_ERROR,details:v.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:k,reason:`fail allocating audio mdat ${k}`})}if(!h){const e=new DataView(w.buffer);e.setUint32(0,k),w.set(Br.types.mdat,4)}}w.set(i,b);const a=i.byteLength;b+=a,f.push(new ia(!0,l,a,0)),A=r}const C=f.length;if(!C)return;const R=f[f.length-1];this.nextAudioPts=S=A+o*R.duration;const M=h?new Uint8Array(0):Br.moof(e.sequenceNumber++,x/o,d({},e,{samples:f}));e.samples=[];const D=x/a,L=S/a,P="audio",O={data1:M,data2:w,startPTS:D,endPTS:L,startDTS:D,endDTS:L,type:P,hasAudio:!0,hasVideo:!1,nb:C};return this.isAudioContiguous=!0,O}remuxEmptyAudio(e,t,n,i){const r=e.inputTimeScale,a=e.samplerate?e.samplerate:r,s=r/a,o=this.nextAudioPts,l=this._initDTS,u=9e4*l.baseTime/l.timescale,c=(null!==o?o:i.startDTS*r)+u,d=i.endDTS*r+u,h=s*$r,f=Math.ceil((d-c)/h),p=Ur.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(E.warn("[mp4-remuxer]: remux empty Audio"),!p)return void E.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const g=[];for(let m=0;m<f;m++){const e=c+m*h;g.push({unit:p,pts:e,dts:e})}return e.samples=g,this.remuxAudio(e,t,n,!1)}}function Jr(e,t){let n;if(null===t)return e;n=t<e?-8589934592:8589934592;while(Math.abs(e-t)>4294967296)e+=n;return e}function ea(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}function ta(e,t,n,i){const r=e.samples.length;if(!r)return;const a=e.inputTimeScale;for(let o=0;o<r;o++){const r=e.samples[o];r.pts=Jr(r.pts-n.baseTime*a/n.timescale,t*a)/a,r.dts=Jr(r.dts-i.baseTime*a/i.timescale,t*a)/a}const s=e.samples;return e.samples=[],{samples:s}}function na(e,t,n){const i=e.samples.length;if(!i)return;const r=e.inputTimeScale;for(let s=0;s<i;s++){const i=e.samples[s];i.pts=Jr(i.pts-n.baseTime*r/n.timescale,t*r)/r}e.samples.sort((e,t)=>e.pts-t.pts);const a=e.samples;return e.samples=[],{samples:a}}class ia{constructor(e,t,n,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=n,this.cts=i,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class ra{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(Ne(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:n}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const i=this.initData=Me(e);i.audio&&(t=sa(i.audio,D.AUDIO)),i.video&&(n=sa(i.video,D.VIDEO));const r={};i.audio&&i.video?r.audiovideo={container:"video/mp4",codec:t+","+n,initSegment:e,id:"main"}:i.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?r.video={container:"video/mp4",codec:n,initSegment:e,id:"main"}:E.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(e,t,n,i,r,a){var s,o;let{initPTS:l,lastEndTime:u}=this;const c={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};h(u)||(u=this.lastEndTime=r||0);const d=t.samples;if(null==d||!d.length)return c;const f={initPTS:void 0,timescale:1};let p=this.initData;if(null!=(s=p)&&s.length||(this.generateInitSegment(d),p=this.initData),null==(o=p)||!o.length)return E.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const g=Be(d,p),m=Fe(p,d),v=null===m?r:m;(aa(l,v,r,g)||f.timescale!==l.timescale&&a)&&(f.initPTS=v-r,l&&1===l.timescale&&E.warn(`Adjusting initPTS by ${f.initPTS-l.baseTime}`),this.initPTS=l={baseTime:f.initPTS,timescale:1});const y=e?v-l.baseTime/l.timescale:u,b=y+g;je(p,d,l.baseTime/l.timescale),g>0?this.lastEndTime=b:(E.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const S=!!p.audio,T=!!p.video;let _="";S&&(_+="audio"),T&&(_+="video");const w={data1:d,startPTS:y,startDTS:y,endPTS:b,endDTS:b,type:_,hasAudio:S,hasVideo:T,nb:1,dropped:0};return c.audio="audio"===w.type?w:void 0,c.video="audio"!==w.type?w:void 0,c.initSegment=f,c.id3=ta(n,r,l,l),i.samples.length&&(c.text=na(i,r,l)),c}}function aa(e,t,n,i){if(null===e)return!0;const r=Math.max(i,1),a=t-e.baseTime/e.timescale;return Math.abs(a-n)>r}function sa(e,t){const n=null==e?void 0:e.codec;if(n&&n.length>4)return n;if(t===D.AUDIO){if("ec-3"===n||"ac-3"===n||"alac"===n)return n;if("fLaC"===n||"Opus"===n){const e=!1;return St(n,e)}const e="mp4a.40.5";return E.info(`Parsed audio codec "${n}" or audio object type not handled. Using "${e}"`),e}return E.warn(`Unhandled video codec "${n}"`),"hvc1"===n||"hev1"===n?"hvc1.1.6.L120.90":"av01"===n?"av01.0.04M.08":"avc1.42e01e"}try{Yr=self.performance.now.bind(self.performance)}catch(e){E.debug("Unable to use Performance API on this environment"),Yr=null==H?void 0:H.Date.now}const oa=[{demux:Sr,remux:ra},{demux:Cr,remux:Zr},{demux:yr,remux:Zr},{demux:Nr,remux:Zr}];oa.splice(2,0,{demux:_r,remux:Zr});class la{constructor(e,t,n,i,r){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.vendor=i,this.id=r}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const r=n.transmuxing;r.executeStart=Yr();let a=new Uint8Array(e);const{currentTransmuxState:s,transmuxConfig:o}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:u,trackSwitch:c,accurateTimeOffset:d,timeOffset:h,initSegmentChange:f}=i||s,{audioCodec:p,videoCodec:y,defaultInitPts:b,duration:S,initSegmentData:T}=o,_=ua(a,t);if(_&&"AES-128"===_.method){const e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(a,_.key.buffer,_.iv.buffer).then(e=>{const t=this.push(e,null,n);return this.decryptionPromise=null,t}),this.decryptionPromise;{let t=e.softwareDecrypt(a,_.key.buffer,_.iv.buffer);const i=n.part>-1;if(i&&(t=e.flush()),!t)return r.executeEnd=Yr(),ca(n);a=new Uint8Array(t)}}const w=this.needsProbing(u,c);if(w){const e=this.configureTransmuxer(a);if(e)return E.warn(`[transmuxer] ${e.message}`),this.observer.emit(g.ERROR,g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),r.executeEnd=Yr(),ca(n)}(u||c||f||w)&&this.resetInitSegment(T,p,y,S,t),(u||f||w)&&this.resetInitialTimestamp(b),l||this.resetContiguity();const x=this.transmux(a,_,h,d,n),A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,r.executeEnd=Yr(),x}flush(e){const t=e.transmuxing;t.executeStart=Yr();const{decrypter:n,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return r.then(()=>{return this.flush(e)});const a=[],{timeOffset:s}=i;if(n){const t=n.flush();t&&a.push(this.push(t,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l)return t.executeEnd=Yr(),[ca(e)];const u=o.flush(s);return da(u)?u.then(t=>{return this.flushRemux(a,t,e),a}):(this.flushRemux(a,u,e),a)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:r,id3Track:a,textTrack:s}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;E.log(`[transmuxer.ts]: Flushed fragment ${n.sn}${n.part>-1?" p: "+n.part:""} of level ${n.level}`);const u=this.remuxer.remux(i,r,a,s,l,o,!0,this.id);e.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=Yr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;t&&n&&(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,r){const{demuxer:a,remuxer:s}=this;a&&s&&(a.resetInitSegment(e,t,n,i),s.resetInitSegment(e,t,n,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,r){let a;return a=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,i,r):this.transmuxUnencrypted(e,n,i,r),a}transmuxUnencrypted(e,t,n,i){const{audioTrack:r,videoTrack:a,id3Track:s,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive),l=this.remuxer.remux(r,a,s,o,t,n,!1,this.id);return{remuxResult:l,chunkMeta:i}}transmuxSampleAes(e,t,n,i,r){return this.demuxer.demuxSampleAes(e,t,n).then(e=>{const t=this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,n,i,!1,this.id);return{remuxResult:t,chunkMeta:r}})}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i,vendor:r}=this;let a;for(let d=0,h=oa.length;d<h;d++){var s;if(null!=(s=oa[d].demux)&&s.probe(e)){a=oa[d];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=a.remux,c=a.demux;l&&l instanceof u||(this.remuxer=new u(n,t,i,r)),o&&o instanceof c||(this.demuxer=new c(n,t,i),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ui(this.config)),e}}function ua(e,t){let n=null;return e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(n=t),n}const ca=e=>({remuxResult:{},chunkMeta:e});function da(e){return"then"in e&&e.then instanceof Function}class ha{constructor(e,t,n,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=r||null}}class fa{constructor(e,t,n,i,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=a}}var pa={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,i,a,s){if("function"!==typeof i)throw new TypeError("The listener must be a function");var o=new r(i,a||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,a=i.length,s=new Array(a);r<a;r++)s[r]=i[r].fn;return s},o.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,r,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,r),!0;case 5:return c.fn.call(c.context,t,i,r,a),!0;case 6:return c.fn.call(c.context,t,i,r,a,s),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,i);break;case 4:c[u].fn.call(c[u].context,t,i,r);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,i,r){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||r&&!o.once||i&&o.context!==i||s(this,a);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||r&&!o[l].once||i&&o[l].context!==i)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:s(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o})(pa);var ga=pa.exports,ma=i(ga);class va{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const a=(e,t)=>{t=t||{},t.frag=this.frag,t.id=this.id,e===g.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new ma,this.observer.on(g.FRAG_DECRYPTED,a),this.observer.on(g.ERROR,a);const s=lt(r.preferManagedMediaSource)||{isTypeSupported:()=>!1},o={mpeg:s.isTypeSupported("audio/mpeg"),mp3:s.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:s.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&"undefined"!==typeof Worker){const e=r.workerPath||Hi();if(e){try{r.workerPath?(E.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=Ki(r.workerPath)):(E.log(`injecting Web Worker for "${t}"`),this.workerContext=zi()),this.onwmsg=(e=>this.onWorkerMessage(e));const{worker:e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=(e=>{const n=new Error(`${e.message}  (${e.filename}:${e.lineno})`);r.enableWorker=!1,E.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:n})}),e.postMessage({cmd:"init",typeSupported:o,vendor:"",id:t,config:JSON.stringify(r)})}catch(e){E.warn(`Error setting up "${t}" Web Worker, fallback to inline`,e),this.resetWorker(),this.error=null,this.transmuxer=new la(this.observer,o,r,"",t)}return}}this.transmuxer=new la(this.observer,o,r,"",t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,n,i,r,a,s,o,l,u){var c,d;l.transmuxing.start=self.performance.now();const{transmuxer:h}=this,f=a?a.start:r.start,p=r.decryptdata,g=this.frag,m=!(g&&r.cc===g.cc),v=!(g&&l.level===g.level),y=g?l.sn-g.sn:-1,b=this.part?l.part-this.part.index:-1,S=0===y&&l.id>1&&l.id===(null==g?void 0:g.stats.chunkCount),T=!v&&(1===y||0===y&&(1===b||S&&b<=0)),_=self.performance.now();(v||y||0===r.stats.parsing.start)&&(r.stats.parsing.start=_),!a||!b&&T||(a.stats.parsing.start=_);const w=!(g&&(null==(c=r.initSegment)?void 0:c.url)===(null==(d=g.initSegment)?void 0:d.url)),x=new fa(m,T,o,v,f,w);if(!T||m||w){E.log(`[transmuxer-interface, ${r.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}\n        discontinuity: ${m}\n        trackSwitch: ${v}\n        contiguous: ${T}\n        accurateTimeOffset: ${o}\n        timeOffset: ${f}\n        initSegmentChange: ${w}`);const e=new ha(n,i,t,s,u);this.configureTransmuxer(e)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:x},e instanceof ArrayBuffer?[e]:[]);else if(h){const t=h.push(e,p,l,x);da(t)?(h.async=!0,t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")})):(h.async=!1,this.handleTransmuxComplete(t))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let n=t.flush(e);const i=da(n);i||t.async?(da(n)||(n=Promise.resolve(n)),n.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")})):this.handleFlushResult(n,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data;if(null==t||!t.event)return void E.warn(`worker message received with no ${t?"event name":"data"}`);const n=this.hls;if(this.hls)switch(t.event){case"init":{var i;const e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":E[t.data.logType]&&E[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data);break}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function ya(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!ba(e[n].attrs,t[n].attrs))return!1;return!0}function ba(e,t,n){const i=e["STABLE-RENDITION-ID"];return i&&!n?i===t["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>e[n]!==t[n])}function Sa(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}const Ta=100;class _a extends Vi{constructor(e,t,n){super(e,t,n,"[audio-stream-controller]",Ft.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(g.ERROR,this.onError,this),e.on(g.BUFFER_RESET,this.onBufferReset,this),e.on(g.BUFFER_CREATED,this.onBufferCreated,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(g.ERROR,this.onError,this),e.off(g.BUFFER_RESET,this.onBufferReset,this),e.off(g.BUFFER_CREATED,this.onBufferCreated,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:r}){if("main"===n){const e=t.cc;this.initPTS[t.cc]={baseTime:i,timescale:r},this.log(`InitPTS for cc: ${e} found from main: ${i}`),this.videoTrackCC=e,this.state===Bi.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state=Bi.STOPPED);const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(Ta),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=Bi.IDLE):(this.loadedmetadata=!1,this.state=Bi.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case Bi.IDLE:this.doTickIdle();break;case Bi.WAITING_TRACK:{var e;const{levels:t,trackId:n}=this,i=null==t?void 0:null==(e=t[n])?void 0:e.details;if(i){if(this.waitForCdnTuneIn(i))break;this.state=Bi.WAITING_INIT_PTS}break}case Bi.FRAG_LOADING_WAITING_RETRY:{var t;const e=performance.now(),n=this.retryDate;if(!n||e>=n||null!=(t=this.media)&&t.seeking){const{levels:e,trackId:t}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==e?void 0:e[t])||null),this.state=Bi.IDLE}break}case Bi.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:i,complete:r}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=Bi.FRAG_LOADING;const e=i.flush(),a={frag:t,part:n,payload:e,networkDetails:null};this._handleFragmentLoadProgress(a),r&&super._handleFragmentLoadComplete(a)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const e=this.getLoadPosition(),n=mi.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole),i=Un(n.end,this.config.maxFragLookUpTolerance,t);i<0&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${n.end} is needed`),this.clearWaitingFragment())}}else this.state=Bi.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Bi.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:n,trackId:i}=this,r=e.config;if(!n&&(this.startFragRequested||!r.startFragPrefetch)||null==t||!t[i])return;const a=t[i],s=a.details;if(!s||s.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(s))return void(this.state=Bi.WAITING_TRACK);const o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,D.AUDIO,Ft.AUDIO));const l=this.getFwdBufferInfo(o,Ft.AUDIO);if(null===l)return;const{bufferedTrack:u,switchingTrack:c}=this;if(!c&&this._streamEnded(l,s))return e.trigger(g.BUFFER_EOS,{type:"audio"}),void(this.state=Bi.ENDED);const d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Ft.MAIN),h=l.len,f=this.getMaxBufferLength(null==d?void 0:d.len),p=s.fragments,m=p[0].start;let v=this.flushing?this.getLoadPosition():l.end;if(c&&n){const e=this.getLoadPosition();u&&!ba(c.attrs,u.attrs)&&(v=e),s.PTSKnown&&e<m&&(l.end>m||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=m+.05)}if(h>=f&&!c&&v<p[p.length-1].start)return;let y=this.getNextFragment(v,s),b=!1;if(y&&this.isLoopLoading(y,v)&&(b=!!y.gap,y=this.getNextFragmentLoopLoading(y,s,l,Ft.MAIN,f)),!y)return void(this.bufferFlushed=!0);const S=d&&y.start>d.end+s.targetduration;if(S||(null==d||!d.len)&&l.len){const e=this.getAppendedFrag(y.start,Ft.MAIN);if(null===e)return;if(b||(b=!!e.gap||!!S&&0===d.len),S&&!b||b&&l.nextStart&&l.nextStart<e.end)return}this.loadFragment(y,a,v)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(e=>new hn(e))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?this.setInterval(Ta):this.resetTransmuxer(),n?(this.switchingTrack=t,this.state=Bi.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=Bi.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(g.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var n;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:i}=this,{details:r,id:a}=t;if(!i)return void this.warn(`Audio tracks were reset while loading level ${a}`);this.log(`Audio track ${a} loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const s=i[a];let o=0;if(r.live||null!=(n=s.details)&&n.live){this.checkLiveUpdate(r);const e=this.mainDetails;if(r.deltaUpdateFailed||!e)return;var l;if(!s.details&&r.hasProgramDateTime&&e.hasProgramDateTime)Ai(r,e),o=r.fragments[0].start;else o=this.alignPlaylists(r,s.details,null==(l=this.levelLastLoaded)?void 0:l.details)}s.details=r,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(this.mainDetails||r,o),this.state!==Bi.WAITING_TRACK||this.waitForCdnTuneIn(r)||(this.state=Bi.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:n,part:i,payload:r}=e,{config:a,trackId:s,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);const l=o[s];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);const c=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new va(this.hls,Ft.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[n.cc],f=null==(t=n.initSegment)?void 0:t.data;if(void 0!==h){const e=!1,t=i?i.index:-1,a=-1!==t,s=new vi(n.level,n.sn,n.stats.chunkCount,r.byteLength,t,a);d.push(r,f,c,"",n,i,u.totalduration,e,s,h)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${u.startSN} ,${u.endSN}],track ${s}`);const{cache:e}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new ji,complete:!1};e.push(new Uint8Array(r)),this.waitingVideoCC=this.videoTrackCC,this.state=Bi.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type===Ft.AUDIO)if(this.fragContextChanged(n))this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==n.sn){this.fragPrevious=n;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(g.AUDIO_TRACK_SWITCHED,o({},e)))}this.fragBufferedComplete(n,i)}else if(!this.loadedmetadata&&n.type===Ft.MAIN){const e=this.videoBuffer||this.media;if(e){const t=mi.getBuffered(e);t.length&&(this.loadedmetadata=!0)}}}onError(e,t){var n;if(t.fatal)this.state=Bi.ERROR;else switch(t.details){case v.FRAG_GAP:case v.FRAG_PARSING_ERROR:case v.FRAG_DECRYPT_ERROR:case v.FRAG_LOAD_ERROR:case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_ERROR:case v.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ft.AUDIO,t);break;case v.AUDIO_TRACK_LOAD_ERROR:case v.AUDIO_TRACK_LOAD_TIMEOUT:case v.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Bi.WAITING_TRACK||(null==(n=t.context)?void 0:n.type)!==Ut.AUDIO_TRACK||(this.state=Bi.IDLE);break;case v.BUFFER_APPEND_ERROR:case v.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;if(t.details===v.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case v.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==D.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==D.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Bi.ENDED&&(this.state=Bi.IDLE);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,Ft.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,s=this.getCurrentContext(a);if(!s)return void this.resetWhenMissingContext(a);const{frag:o,part:l,level:u}=s,{details:c}=u,{audio:h,text:f,id3:p,initSegment:m}=r;if(!this.fragContextChanged(o)&&c){if(this.state=Bi.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const e=o.initSegment||o;this._bufferInitSegment(u,m.tracks,e,a),i.trigger(g.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:n,tracks:m.tracks})}if(h){const{startPTS:e,endPTS:t,startDTS:n,endDTS:i}=h;l&&(l.elementaryStreams[D.AUDIO]={startPTS:e,endPTS:t,startDTS:n,endDTS:i}),o.setElementaryStreamInfo(D.AUDIO,e,t,n,i),this.bufferFragmentData(h,o,l,a)}if(null!=p&&null!=(t=p.samples)&&t.length){const e=d({id:n,frag:o,details:c},p);i.trigger(g.FRAG_PARSING_METADATA,e)}if(f){const e=d({id:n,frag:o,details:c},f);i.trigger(g.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,n,i){if(this.state!==Bi.PARSING)return;t.video&&delete t.video;const r=t.audio;if(!r)return;r.id="audio";const a=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${a}/${r.codec}]`),a&&1===a.split(",").length&&(r.levelCodec=a),this.hls.trigger(g.BUFFER_CODECS,t);const s=r.initSegment;if(null!=s&&s.byteLength){const e={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:s};this.hls.trigger(g.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);var r;if(this.fragCurrent=e,this.switchingTrack||i===di.NOT_LOADED||i===di.PARTIAL)if("initSegment"===e.sn)this._loadInitSegment(e,t);else if(null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Bi.WAITING_INIT_PTS;const n=this.mainDetails;n&&n.fragments[0].start!==t.details.fragments[0].start&&Ai(t.details,n)}else this.startFragRequested=!0,super.loadFragment(e,t,n);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:t,bufferedTrack:n}=this,i=null==n?void 0:n.attrs,r=e.attrs;t&&i&&(i.CHANNELS!==r.CHANNELS||n.name!==e.name||n.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(g.AUDIO_TRACK_SWITCHED,o({},e))}}class wa extends Hn{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVEL_LOADING,this.onLevelLoading,this),e.off(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(g.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:r}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i)return void this.warn(`Audio track with id:${n} and group:${i} not found in active group ${null==a?void 0:a.groupId}`);const s=a.details;a.details=t.details,this.log(`Audio track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,s)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==i?void 0:i.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!r&&t){const n=ii(t,e,si);if(n>-1)r=e[n];else{const e=ii(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const s={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==n?void 0:n.join(",")}`),this.hls.trigger(g.AUDIO_TRACKS_UPDATED,s);const o=this.trackId;if(-1!==i&&-1===o)this.setAudioTrack(i);else if(e.length&&-1===o){var a;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(a=this.groupIds)?void 0:a.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}else this.shouldReloadPlaylist(r)&&this.setAudioTrack(this.trackId)}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Ut.AUDIO_TRACK||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||(this.requestScheduled=-1,this.checkRetry(t)))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&ri(e,i,si))return i;const r=ii(e,this.tracksInGroup,si);if(r>-1){const e=this.tracksInGroup[r];return this.setAudioTrack(r),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);const r=oi(e,t.levels,n,i,si);if(-1===r)return null;t.nextLoadLevel=r}if(e.channels||e.audioCodec){const t=ii(e,n);if(t>-1)return n[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===n&&r)return;if(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(g.AUDIO_TRACK_SWITCHING,o({},i)),r)return;const a=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if((!this.selectDefaultTrack||i.default)&&(!e||ri(e,i,si)))return n}if(e){const{name:n,lang:i,assocLang:r,characteristics:a,audioCodec:s,channels:o}=e;for(let e=0;e<t.length;e++){const l=t[e];if(ri({name:n,lang:i,assocLang:r,characteristics:a,audioCodec:s,channels:o},l,si))return e}for(let l=0;l<t.length;l++){const n=t[l];if(ba(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const n=t[l];if(ba(e.attrs,n.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const n=t.id,i=t.groupId;let r=t.url;if(e)try{r=e.addDirectives(r)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`loading audio-track playlist ${n} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(g.AUDIO_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:e||null})}}}const Ea=500;class xa extends Vi{constructor(e,t,n){super(e,t,n,"[subtitle-stream-controller]",Ft.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.ERROR,this.onError,this),e.on(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(g.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(g.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.ERROR,this.onError,this),e.off(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(g.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(g.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=Bi.IDLE,this.setInterval(Ea),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(this.fragPrevious=n,this.state=Bi.IDLE,!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let a;const s=n.start;for(let l=0;l<r.length;l++)if(s>=r[l].start&&s<=r[l].end){a=r[l];break}const o=n.start+n.duration;a?a.end=o:(a={start:s,end:o},r.push(a)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null)}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(0===n&&i!==Number.POSITIVE_INFINITY){const e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let n=0;n<t.length;)if(t[n].end<=e)t.shift();else{if(!(t[n].start<e))break;t[n].start=e,n++}}),this.fragmentTracker.removeFragmentsInRange(n,e,Ft.SUBTITLE)}}onFragBuffered(e,t){var n;this.loadedmetadata||t.frag.type!==Ft.MAIN||null!=(n=this.media)&&n.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){const n=t.frag;(null==n?void 0:n.type)===Ft.SUBTITLE&&(t.details===v.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Bi.STOPPED&&(this.state=Bi.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&ya(this.levels,t)?this.levels=t.map(e=>new hn(e)):(this.tracksBuffered=[],this.levels=t.map(e=>{const t=new hn(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ft.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,null==(n=this.levels)||!n.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(Ea)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:r}=this,{details:a,id:s}=t;if(!r)return void this.warn(`Subtitle tracks were reset while loading level ${s}`);const o=r[s];if(s>=r.length||!o)return;this.log(`Subtitle track ${s} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(a.live||null!=(n=o.details)&&n.live){const e=this.mainDetails;if(a.deltaUpdateFailed||!e)return;const t=e.fragments[0];var u;if(o.details)l=this.alignPlaylists(a,o.details,null==(u=this.levelLastLoaded)?void 0:u.details),0===l&&t&&(l=t.start,Tn(a,l));else a.hasProgramDateTime&&e.hasProgramDateTime?(Ai(a,e),l=a.fragments[0].start):t&&(l=t.start,Tn(a,l))}if(o.details=a,this.levelLastLoaded=o,s===i&&(this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(this.mainDetails||a,l),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===Bi.IDLE)){const e=On(null,a.fragments,this.media.currentTime,0);e||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&null!=i&&i.key&&i.iv&&"AES-128"===i.method){const e=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer).catch(e=>{throw r.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(n=>{const i=performance.now();r.trigger(g.FRAG_DECRYPTED,{frag:t,payload:n,stats:{tstart:e,tdecrypt:i}})}).catch(e=>{this.warn(`${e.name}: ${e.message}`),this.state=Bi.IDLE})}}doTick(){if(this.media){if(this.state===Bi.IDLE){const{currentTrackId:e,levels:t}=this,n=null==t?void 0:t[e];if(!n||!t.length||!n.details)return;const{config:i}=this,r=this.getLoadPosition(),a=mi.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:s,len:o}=a,l=this.getFwdBufferInfo(this.media,Ft.MAIN),u=n.details,c=this.getMaxBufferLength(null==l?void 0:l.len)+u.levelTargetDuration;if(o>c)return;const d=u.fragments,h=d.length,f=u.edge;let p=null;const g=this.fragPrevious;if(s<f){const e=i.maxFragLookUpTolerance,t=s>f-e?0:e;p=On(g,d,Math.max(d[0].start,s),t),!p&&g&&g.start<d[0].start&&(p=d[0])}else p=d[h-1];if(!p)return;if(p=this.mapToInitFragWhenRequired(p),"initSegment"!==p.sn){const e=p.sn-u.startSN,t=d[e-1];t&&t.cc===p.cc&&this.fragmentTracker.getState(t)===di.NOT_LOADED&&(p=t)}this.fragmentTracker.getState(p)===di.NOT_LOADED&&this.loadFragment(p,n,s)}}else this.state=Bi.IDLE}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,n){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,n))}get mediaBufferTimeRanges(){return new Aa(this.tracksBuffered[this.currentTrackId]||[])}}class Aa{constructor(e){this.buffered=void 0;const t=(t,n,i)=>{if(n>>>=0,n>i-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${i})`);return e[n][t]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}class ka extends Hn{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=(()=>this.pollTrackChange(0)),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=(()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=qt(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=t[i];else if("showing"===t[i].mode){e=t[i];break}const n=this.findTrackForTextTrack(e);this.subtitleTrack!==n&&this.setSubtitleTrack(n)}),this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVEL_LOADING,this.onLevelLoading,this),e.off(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(g.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);const e=qt(this.media.textTracks);e.forEach(e=>{zt(e)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:r}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i)return void this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${null==a?void 0:a.groupId}`);const s=a.details;a.details=t.details,this.log(`Subtitle track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,s)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==i?void 0:i.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!r&&t){this.selectDefaultTrack=!1;const n=ii(t,e);if(n>-1)r=e[n];else{const e=ii(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const a={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==n?void 0:n.join(",")}" group-id`),this.hls.trigger(g.SUBTITLE_TRACKS_UPDATED,a),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}else this.shouldReloadPlaylist(r)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if((!n||r.default)&&(n||e)&&(!e||ri(r,e)))return i}if(e){for(let n=0;n<t.length;n++){const i=t[n];if(ba(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const i=t[n];if(ba(e.attrs,i.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(Sa(i,e))return n}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Ut.SUBTITLE_TRACK||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&ri(e,n))return n;const i=ii(e,this.tracksInGroup);if(i>-1){const e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(n)return null;{const n=ii(e,t);if(n>-1)return t[n]}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const n=t.id,i=t.groupId;let r=t.url;if(e)try{r=e.addDirectives(r)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(g.SUBTITLE_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=qt(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(e=>Sa(n,e))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==i&&(e.mode="disabled")}),i){const e=this.subtitleDisplay?"showing":"hidden";i.mode!==e&&(i.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!h(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i)return void this.hls.trigger(g.SUBTITLE_TRACK_SWITCH,{id:e});const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&r)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:s="",name:o,type:l,url:u}=i;this.hls.trigger(g.SUBTITLE_TRACK_SWITCH,{id:a,groupId:s,name:o,type:l,url:u});const c=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(c)}}class Ia{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,n){const i=this.queues[t];i.push(e),1!==i.length||n||this.executeNext(t)}insertAbort(e,t){const n=this.queues[t];n.unshift(e),this.executeNext(t)}appendBlocker(e){let t;const n=new Promise(e=>{t=e}),i={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(i,e),n}executeNext(e){const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(t){E.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${t}`),n.onError(t);const i=this.buffers[e];null!=i&&i.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const Ca=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class Ra{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=(e=>{this.hls&&this.hls.pauseBuffering()}),this._onStartStreaming=(e=>{this.hls&&this.hls.resumeBuffering()}),this._onMediaSourceOpen=(()=>{const{media:e,mediaSource:t}=this;this.log("Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(g.MEDIA_ATTACHED,{media:e,mediaSource:t})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()}),this._onMediaSourceClose=(()=>{this.log("Media source closed")}),this._onMediaSourceEnded=(()=>{this.log("Media source ended")}),this._onMediaEmptied=(()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&E.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)}),this.hls=e;const t="[buffer-controller]";this.appendSource=ut(lt(e.config.preferManagedMediaSource)),this.log=E.log.bind(E,t),this.warn=E.warn.bind(E,t),this.error=E.error.bind(E,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.BUFFER_RESET,this.onBufferReset,this),e.on(g.BUFFER_APPENDING,this.onBufferAppending,this),e.on(g.BUFFER_CODECS,this.onBufferCodecs,this),e.on(g.BUFFER_EOS,this.onBufferEos,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(g.FRAG_PARSED,this.onFragParsed,this),e.on(g.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.BUFFER_RESET,this.onBufferReset,this),e.off(g.BUFFER_APPENDING,this.onBufferAppending,this),e.off(g.BUFFER_CODECS,this.onBufferCodecs,this),e.off(g.BUFFER_EOS,this.onBufferEos,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(g.FRAG_PARSED,this.onFragParsed,this),e.off(g.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Ia(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const n=this.media=t.media,i=lt(this.appendSource);if(n&&i){var r;const e=this.mediaSource=new i;this.log(`created media source: ${null==(r=e.constructor)?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming));const t=this._objectUrl=self.URL.createObjectURL(e);if(this.appendSource)try{n.removeAttribute("src");const i=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||i&&e instanceof i,Ma(n),Da(n,t),n.load()}catch(e){n.src=t}else n.src=t;n.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:n}=this;if(t){if(this.log("media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){this.warn(`onMediaDetaching: ${e.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(e.removeAttribute("src"),this.appendSource&&Ma(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(g.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer()}resetBuffer(e){const t=this.sourceBuffer[e];try{var n;if(t)this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,null!=(n=this.mediaSource)&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}catch(t){this.warn(`onBufferReset ${e}`,t)}}onBufferCodecs(e,t){const n=this.getSourceBufferTypes().length,i=Object.keys(t);if(i.forEach(e=>{if(n){const n=this.tracks[e];if(n&&"function"===typeof n.buffer.changeType){var i;const{id:r,codec:a,levelCodec:s,container:o,metadata:l}=t[e],u=Tt(n.codec,n.levelCodec),c=null==u?void 0:u.replace(Ca,"$1");let d=Tt(a,s);const h=null==(i=d)?void 0:i.replace(Ca,"$1");if(d&&c!==h){"audio"===e.slice(0,5)&&(d=St(d,this.appendSource));const t=`${o};codecs=${d}`;this.appendChangeType(e,t),this.log(`switching codec ${u} to ${d}`),this.tracks[e]={buffer:n.buffer,codec:a,container:o,levelCodec:s,metadata:l,id:r}}}}else this.pendingTracks[e]=t[e]}),n)return;const r=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==r&&(this.log(`${r} bufferCodec event(s) expected ${i.join(",")}`),this.bufferCodecEventsExpected=r),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:n}=this,i={execute:()=>{const i=this.sourceBuffer[e];i&&(this.log(`changing ${e} sourceBuffer type to ${t}`),i.changeType(t)),n.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};n.append(i,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:n,operationQueue:i,tracks:r}=this,{data:a,type:s,frag:o,part:l,chunkMeta:u}=t,c=u.buffering[s],d=self.performance.now();c.start=d;const h=o.stats.buffering,f=l?l.stats.buffering:null;0===h.start&&(h.start=d),f&&0===f.start&&(f.start=d);const p=r.audio;let y=!1;"audio"===s&&"audio/mpeg"===(null==p?void 0:p.container)&&(y=!this.lastMpegAudioChunk||1===u.id||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const b=o.start,S={execute:()=>{if(c.executeStart=self.performance.now(),y){const e=this.sourceBuffer[s];if(e){const t=b-e.timestampOffset;Math.abs(t)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${b} (delta: ${t}) sn: ${o.sn})`),e.timestampOffset=b)}}this.appendExecutor(a,s)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();c.executeEnd=c.end=e,0===h.first&&(h.first=e),f&&0===f.first&&(f.first=e);const{sourceBuffer:t}=this,n={};for(const i in t)n[i]=mi.getBuffered(t[i]);this.appendErrors[s]=0,"audio"===s||"video"===s?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(g.BUFFER_APPENDED,{type:s,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:n})},onError:e=>{const t={type:m.MEDIA_ERROR,parent:o.type,details:v.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:o,part:l,chunkMeta:u,error:e,err:e,fatal:!1};if(e.code===DOMException.QUOTA_EXCEEDED_ERR)t.details=v.BUFFER_FULL_ERROR;else{const e=++this.appendErrors[s];t.details=v.BUFFER_APPEND_ERROR,this.warn(`Failed ${e}/${n.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer`),e>=n.config.appendErrorMaxRetry&&(t.fatal=!0)}n.trigger(g.ERROR,t)}};i.append(S,s,!!this.pendingTracks[s])}onBufferFlushing(e,t){const{operationQueue:n}=this,i=e=>({execute:this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(g.BUFFER_FLUSHED,{type:e})},onError:t=>{this.warn(`Failed to remove from ${e} SourceBuffer`,t)}});t.type?n.append(i(t.type),t.type):this.getSourceBufferTypes().forEach(e=>{n.append(i(e),e)})}onFragParsed(e,t){const{frag:n,part:i}=t,r=[],a=i?i.elementaryStreams:n.elementaryStreams;a[D.AUDIOVIDEO]?r.push("audiovideo"):(a[D.AUDIO]&&r.push("audio"),a[D.VIDEO]&&r.push("video"));const s=()=>{const e=self.performance.now();n.stats.buffering.end=e,i&&(i.stats.buffering.end=e);const t=i?i.stats:n.stats;this.hls.trigger(g.FRAG_BUFFERED,{frag:n,part:i,stats:t,id:n.type})};0===r.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(s,r)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){const n=this.getSourceBufferTypes().reduce((e,n)=>{const i=this.sourceBuffer[n];return!i||t.type&&t.type!==n||(i.ending=!0,i.ended||(i.ended=!0,this.log(`${n} sourceBuffer now EOS`))),e&&!(i&&!i.ended)},!0);n&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(e=>{const t=this.sourceBuffer[e];t&&(t.ending=!1)});const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream()):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||null===t)return;const i=this.getSourceBufferTypes();if(!i.length)return;const r=e.config,a=n.currentTime,s=t.levelTargetDuration,o=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(h(o)&&o>0){const e=Math.max(o,s),t=Math.floor(a/s)*s-e;this.flushBackBuffer(a,s,t)}if(h(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){const e=Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),t=Math.max(e,s),n=Math.floor(a/s)*s+t;this.flushFrontBuffer(a,s,n)}}flushBackBuffer(e,t,n){const{details:i,sourceBuffer:r}=this,a=this.getSourceBufferTypes();a.forEach(a=>{const s=r[a];if(s){const r=mi.getBuffered(s);if(r.length>0&&n>r.start(0)){if(this.hls.trigger(g.BACK_BUFFER_REACHED,{bufferEnd:n}),null!=i&&i.live)this.hls.trigger(g.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(s.ended&&r.end(r.length-1)-e<2*t)return void this.log(`Cannot flush ${a} back buffer while SourceBuffer is in ended state`);this.hls.trigger(g.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:a})}}})}flushFrontBuffer(e,t,n){const{sourceBuffer:i}=this,r=this.getSourceBufferTypes();r.forEach(r=>{const a=i[r];if(a){const i=mi.getBuffered(a),s=i.length;if(s<2)return;const o=i.start(s-1),l=i.end(s-1);if(n>o||e>=o&&e<=l)return;if(a.ended&&e-l<2*t)return void this.log(`Cannot flush ${r} front buffer while SourceBuffer is in ended state`);this.hls.trigger(g.BUFFER_FLUSHING,{startOffset:o,endOffset:1/0,type:r})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:n,mediaSource:i}=this,r=e.fragments[0].start+e.totalduration,a=n.duration,s=h(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(i.duration=1/0,this.updateSeekableRange(e)):(r>s&&r>a||!h(a))&&(this.log(`Updating Media Source duration to ${r.toFixed(3)}`),i.duration=r)}updateSeekableRange(e){const t=this.mediaSource,n=e.fragments,i=n.length;if(i&&e.live&&null!=t&&t.setLiveSeekableRange){const i=Math.max(0,n[0].start),r=Math.max(i,i+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${i}-${r}.`),t.setLiveSeekableRange(i,r)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:n}=this,i=Object.keys(n).length;if(i&&(!e||2===i||"audiovideo"in n)){this.createSourceBuffers(n),this.pendingTracks={};const e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(g.BUFFER_CREATED,{tracks:this.tracks}),e.forEach(e=>{t.executeNext(e)});else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(const r in e)if(!t[r]){var i;const a=e[r];if(!a)throw Error(`source buffer exists for track ${r}, however track does not`);let s=-1===(null==(i=a.levelCodec)?void 0:i.indexOf(","))?a.levelCodec:a.codec;s&&"audio"===r.slice(0,5)&&(s=St(s,this.appendSource));const o=`${a.container};codecs=${s}`;this.log(`creating sourceBuffer(${o})`);try{const e=t[r]=n.addSourceBuffer(o),i=r;this.addBufferListener(i,"updatestart",this._onSBUpdateStart),this.addBufferListener(i,"updateend",this._onSBUpdateEnd),this.addBufferListener(i,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(i,"bufferedchange",(e,t)=>{const n=t.removedRanges;null!=n&&n.length&&this.hls.trigger(g.BUFFER_FLUSHED,{type:r})}),this.tracks[r]={buffer:e,codec:s,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(e){this.error(`error while trying to add sourceBuffer: ${e.message}`),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:r,mimeType:o})}}}get mediaSrc(){var e,t;const n=(null==(e=this.media)?void 0:null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==n?void 0:n.src}_onSBUpdateStart(e){const{operationQueue:t}=this,n=t.current(e);n.onStart()}_onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const{operationQueue:n}=this,i=n.current(e);i.onComplete(),n.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var n;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(n=this.mediaSource)?void 0:n.readyState}`);this.error(`${i}`,t),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.operationQueue.current(e);r&&r.onError(i)}removeExecutor(e,t,n){const{media:i,mediaSource:r,operationQueue:a,sourceBuffer:s}=this,o=s[e];if(!i||!r||!o)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void a.shiftAndExecuteNext(e);const l=h(i.duration)?i.duration:1/0,u=h(r.duration)?r.duration:1/0,c=Math.max(0,t),d=Math.min(n,l,u);d>c&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):a.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.sourceBuffer[t];if(n)n.ended=!1,n.appendBuffer(e);else if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:n}=this,i=t.map(e=>n.appendBlocker(e));Promise.all(i).then(()=>{e(),t.forEach(e=>{const t=this.sourceBuffer[e];null!=t&&t.updating||n.shiftAndExecuteNext(e)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,n){const i=this.sourceBuffer[e];if(!i)return;const r=n.bind(this,e);this.listeners[e].push({event:t,listener:r}),i.addEventListener(t,r)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(e=>{t.removeEventListener(e.event,e.listener)})}}function Ma(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function Da(e,t){const n=self.document.createElement("source");n.type="video/mp4",n.src=t,e.appendChild(n)}const La={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Pa=e=>String.fromCharCode(La[e]||e),Oa=15,Na=100,Ua={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Fa={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ba={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Va={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ja=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Ga{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n="function"===typeof t?t():t;E.log(`${this.time} [${e}] ${n}`)}}}const Ha=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class za{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Ka{constructor(){this.uchar=" ",this.penState=new za}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class $a{constructor(e){this.chars=[],this.pos=0,this.currPenState=new za,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Na;t++)this.chars.push(new Ka);this.logger=e}equals(e){for(let t=0;t<Na;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Na;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Na;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Na&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Na)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Pa(e);this.pos>=Na?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Na;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Na;n++){const i=this.chars[n].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);const t=this.chars[this.pos];t.setPenState(this.currPenState)}}class Wa{constructor(e){this.rows=[],this.currRow=Oa-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Oa;t++)this.rows.push(new $a(e));this.logger=e}reset(){for(let e=0;e<Oa;e++)this.rows[e].clear();this.currRow=Oa-1}equals(e){let t=!0;for(let n=0;n<Oa;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Oa;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Oa;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){const e=this.rows[this.currRow];e.backSpace()}clearToEndOfRow(){const e=this.rows[this.currRow];e.clearToEndOfRow()}insertChar(e){const t=this.rows[this.currRow];t.insertChar(e)}setPen(e){const t=this.rows[this.currRow];t.setPenStyles(e)}moveCursor(e){const t=this.rows[this.currRow];t.moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);const t=this.rows[this.currRow];t.setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<Oa;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const i=n.rows[e].cueStartTime,r=this.logger.time;if(null!==i&&null!==r&&i<r)for(let a=0;a<this.nrRollUpRows;a++)this.rows[t-this.nrRollUpRows+a+1].copy(n.rows[e+a])}}this.currRow=t;const n=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,i=Math.max(t-1,0);n.setCursor(e.indent),e.color=n.chars[i].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let r=0;r<Oa;r++){const n=this.rows[r].getTextString();n&&(i=r+1,e?t.push("Row "+i+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}getTextAndFormat(){return this.rows}}class qa{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Wa(n),this.nonDisplayedMemory=new Wa(n),this.lastOutputScreen=new Wa(n),this.currRollUpRow=this.displayedMemory.rows[Oa-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Oa-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Ya{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Za(),this.logger=void 0;const i=this.logger=new Ga;this.channels=[null,new qa(e,t,i),new qa(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const e=127&t[n],i=127&t[n+1];let r=!1,a=null;if(0===e&&0===i)continue;this.logger.log(3,()=>"["+Ha([t[n],t[n+1]])+"] -> ("+Ha([e,i])+")");const s=this.cmdHistory,o=e>=16&&e<=31;if(o){if(Qa(e,i,s)){Xa(null,null,s),this.logger.log(3,()=>"Repeated command ("+Ha([e,i])+") is dropped");continue}Xa(e,i,this.cmdHistory),r=this.parseCmd(e,i),r||(r=this.parseMidrow(e,i)),r||(r=this.parsePAC(e,i)),r||(r=this.parseBackgroundAttributes(e,i))}else Xa(null,null,s);if(!r&&(a=this.parseChars(e,i),a)){const e=this.currentChannel;if(e&&e>0){const t=this.channels[e];t.insertChars(a)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||a||this.logger.log(2,()=>"Couldn't parse cleaned data "+Ha([e,i])+" orig: "+Ha([t[n],t[n+1]]))}}parseCmd(e,t){const n=(20===e||28===e||21===e||29===e)&&t>=32&&t<=47,i=(23===e||31===e)&&t>=33&&t<=35;if(!n&&!i)return!1;const r=20===e||21===e||23===e?1:2,a=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let n=0;if((17===e||25===e)&&t>=32&&t<=47){if(n=17===e?1:2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return!!i&&(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ha([e,t])+")"),!0)}return!1}parsePAC(e,t){let n;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(16===e||24===e)&&t>=64&&t<=95;if(!i&&!r)return!1;const a=e<=23?1:2;n=t>=64&&t<=95?1===a?Ua[e]:Ba[e]:1===a?Fa[e]:Va[e];const s=this.channels[a];return!!s&&(s.setPAC(this.interpretPAC(n,t)),this.currentChannel=a,!0)}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,i.underline=1===(1&n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i}parseChars(e,t){let n,i=null,r=null;if(e>=25?(n=2,r=e-8):(n=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,()=>"Special char '"+Pa(e)+"' in channel "+n),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Ha(i).join(",")),i}parseBackgroundAttributes(e,t){const n=(16===e||24===e)&&t>=32&&t<=47,i=(23===e||31===e)&&t>=45&&t<=47;if(!n&&!i)return!1;let r;const a={};16===e||24===e?(r=Math.floor((t-32)/2),a.background=ja[r],t%2===1&&(a.background=a.background+"_semi")):45===t?a.background="transparent":(a.foreground="black",47===t&&(a.underline=!0));const s=e<=23?1:2,o=this.channels[s];return o.setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Xa(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Xa(e,t,n){n.a=e,n.b=t}function Qa(e,t,n){return n.a===e&&n.b===t}function Za(){return{a:null,b:null}}class Ja{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var es=function(){if(null!=H&&H.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!==typeof t)return!1;if(!Array.isArray(e))return!1;const n=t.toLowerCase();return!!~e.indexOf(n)&&n}function i(t){return n(e,t)}function r(e){return n(t,e)}function a(e,...t){let n=1;for(;n<arguments.length;n++){const t=arguments[n];for(const n in t)e[n]=t[n]}return e}function s(e,t,n){const s=this,o={enumerable:!0};s.hasBeenReset=!1;let l="",u=!1,c=e,d=t,h=n,f=null,p="",g=!0,m="auto",v="start",y=50,b="middle",S=50,T="middle";Object.defineProperty(s,"id",a({},o,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(s,"pauseOnExit",a({},o,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(s,"startTime",a({},o,{get:function(){return c},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",a({},o,{get:function(){return d},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",a({},o,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",a({},o,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",a({},o,{get:function(){return p},set:function(e){const t=i(e);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",a({},o,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",a({},o,{get:function(){return m},set:function(e){if("number"!==typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",a({},o,{get:function(){return v},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",a({},o,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",a({},o,{get:function(){return b},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",a({},o,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",a({},o,{get:function(){return T},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),s.displayState=void 0}return s.prototype.getCueAsHTML=function(){const e=self.WebVTT;return e.convertCueToDOMTree(self,this.text)},s}();class ts{decode(e,t){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ns(e){function t(e,t,n,i){return 3600*(0|e)+60*(0|t)+(0|n)+parseFloat(i||0)}const n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}class is{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function rs(e,t,n,i){const r=i?e.split(i):[e];for(const a in r){if("string"!==typeof r[a])continue;const e=r[a].split(n);if(2!==e.length)continue;const i=e[0],s=e[1];t(i,s)}}const as=new es(0,0,""),ss="middle"===as.align?"middle":"center";function os(e,t,n){const i=e;function r(){const t=ns(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(e,t){const i=new is;rs(e,function(e,t){let r;switch(e){case"region":for(let r=n.length-1;r>=0;r--)if(n[r].id===t){i.set(e,n[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),i.integer(e,r[0]),i.percent(e,r[0])&&i.set("snapToLines",!1),i.alt(e,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",ss,"end"]);break;case"position":r=t.split(","),i.percent(e,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",ss,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",ss,"end","left","right"]);break}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let r=i.get("line","auto");"auto"===r&&-1===as.line&&(r=-1),t.line=r,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",ss);let a=i.get("position","auto");"auto"===a&&50===as.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=r(),s(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),s(),t.endTime=r(),s(),a(e,t)}function ls(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class us{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new ts,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function n(){let e=t.buffer,n=0;e=ls(e);while(n<e.length&&"\r"!==e[n]&&"\n"!==e[n])++n;const i=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),i}function i(e){rs(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=n();const i=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;while(t.buffer){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:e=n(),t.state){case"HEADER":/:/.test(e)?i(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new es(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{os(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const n=-1!==e.indexOf("--\x3e");if(!e||n&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const cs=/\r\n|\n\r|\n|\r/g,ds=function(e,t,n=0){return e.slice(n,n+t.length)===t},hs=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!h(t)||!h(n)||!h(i)||!h(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=6e4*i,t+=36e5*r,t},fs=function(e){let t=5381,n=e.length;while(n)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()};function ps(e,t,n){return fs(e.toString())+fs(t.toString())+fs(n)}const gs=function(e,t,n){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);while(null!=(a=r)&&a.new){var a;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=n};function ms(e,t,n,i,r,a,s){const o=new us,l=ge(new Uint8Array(e)).trim().replace(cs,"\n").split("\n"),u=[],c=t?zr(t.baseTime,t.timescale):0;let d,h="00:00.000",f=0,p=0,g=!0;o.oncue=function(e){const a=n[i];let s=n.ccOffset;const o=(f-c)/9e4;if(null!=a&&a.new&&(void 0!==p?s=n.ccOffset=a.start:gs(n,i,o)),o){if(!t)return void(d=new Error("Missing initPTS for VTT MPEGTS"));s=o-n.presentationOffset}const l=e.endTime-e.startTime,h=Jr(9e4*(e.startTime+s-p),9e4*r)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const g=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(g)),e.id||(e.id=ps(e.startTime,e.endTime,g)),e.endTime>0&&u.push(e)},o.onparsingerror=function(e){d=e},o.onflush=function(){d?s(d):a(u)},l.forEach(e=>{if(g){if(ds(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach(e=>{ds(e,"LOCAL:")?h=e.slice(6):ds(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))});try{p=hs(h)/1e3}catch(e){d=e}return}""===e&&(g=!1)}o.parse(e+"\n")}),o.flush()}const vs="stpp.ttml.im1t",ys=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,bs=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Ss={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ts(e,t,n,i){const r=Ce(new Uint8Array(e),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const a=r.map(e=>ge(e)),s=Gr(t.baseTime,1,t.timescale);try{a.forEach(e=>n(_s(e,s)))}catch(e){i(e)}}function _s(e,t){const n=new DOMParser,i=n.parseFromString(e,"text/xml"),r=i.getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},s=Object.keys(a).reduce((e,t)=>{return e[t]=r.getAttribute(`ttp:${t}`)||a[t],e},{}),o="preserve"!==r.getAttribute("xml:space"),l=Es(ws(r,"styling","style")),u=Es(ws(r,"layout","region")),c=ws(r,"body","[begin]");return[].map.call(c,e=>{const n=xs(e,o);if(!n||!e.hasAttribute("begin"))return null;const i=Cs(e.getAttribute("begin"),s),r=Cs(e.getAttribute("dur"),s);let a=Cs(e.getAttribute("end"),s);if(null===i)throw Is(e);if(null===a){if(null===r)throw Is(e);a=i+r}const c=new es(i-t,a-t,n);c.id=ps(c.startTime,c.endTime,c.text);const h=u[e.getAttribute("region")],f=l[e.getAttribute("style")],p=As(h,f,l),{textAlign:g}=p;if(g){const e=Ss[g];e&&(c.lineAlign=e),c.align=g}return d(c,p),c}).filter(e=>null!==e)}function ws(e,t,n){const i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(n)):[]}function Es(e){return e.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function xs(e,t){return[].slice.call(e.childNodes).reduce((e,n,i)=>{var r;return"br"===n.nodeName&&i?e+"\n":null!=(r=n.childNodes)&&r.length?xs(n,t):t?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent},"")}function As(e,t,n){const i="http://www.w3.org/ns/ttml#styling";let r=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],s=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return s&&n.hasOwnProperty(s)&&(r=n[s]),a.reduce((n,a)=>{const s=ks(t,i,a)||ks(e,i,a)||ks(r,i,a);return s&&(n[a]=s),n},{})}function ks(e,t,n){return e&&e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function Is(e){return new Error(`Could not parse ttml timestamp ${e}`)}function Cs(e,t){if(!e)return null;let n=ns(e);return null===n&&(ys.test(e)?n=Rs(e,t):bs.test(e)&&(n=Ms(e,t))),n}function Rs(e,t){const n=ys.exec(e),i=(0|n[4])+(0|n[5])/t.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+i/t.frameRate}function Ms(e,t){const n=bs.exec(e),i=Number(n[1]),r=n[2];switch(r){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}class Ds{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ns(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(g.FRAG_LOADING,this.onFragLoading,this),e.on(g.FRAG_LOADED,this.onFragLoaded,this),e.on(g.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(g.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(g.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(g.FRAG_LOADING,this.onFragLoading,this),e.off(g.FRAG_LOADED,this.onFragLoaded,this),e.off(g.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(g.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(g.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new Ja(this,"textTrack1"),t=new Ja(this,"textTrack2"),n=new Ja(this,"textTrack3"),i=new Ja(this,"textTrack4");this.cea608Parser1=new Ya(1,e,t),this.cea608Parser2=new Ya(3,n,i)}}addCues(e,t,n,i,r){let a=!1;for(let s=r.length;s--;){const e=r[s],i=Os(e[0],e[1],t,n);if(i>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],n),a=!0,i/(n-t)>.5))return}if(a||r.push([t,n]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,n,i)}else{const r=this.Cues.newCue(null,t,n,i);this.hls.trigger(g.CUES_PARSED,{type:"captions",cues:r,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:r}){const{unparsedVttFrags:a}=this;"main"===n&&(this.initPTS[t.cc]={baseTime:i,timescale:r}),a.length&&(this.unparsedVttFrags=[],a.forEach(e=>{this.onFragLoaded(g.FRAG_LOADED,e)}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const r=n.textTracks[i];if(Ps(r,{name:e,lang:t,attrs:{}}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:r,languageCode:a}=t[e],s=this.getExistingTrack(r,a);if(s)n[e]=s,zt(n[e]),Gt(n[e],i);else{const t=this.createTextTrack("captions",r,a);t&&(t[e]=!0,n[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,i={_id:e,label:n,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(g.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{zt(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ns(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)zt(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(e=>e.textCodec===vs);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){const e=ya(this.tracks,n);if(e)return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const e=this.media,t=e?qt(e.textTracks):null;if(this.tracks.forEach((e,n)=>{let i;if(t){let n=null;for(let i=0;i<t.length;i++)if(t[i]&&Ps(t[i],e)){n=t[i],t[i]=null;break}n&&(i=n)}if(i)zt(i);else{const t=Ls(e);i=this.createTextTrack(t,e.name,e.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&E.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map(e=>{return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}});this.hls.trigger(g.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const n=`textTrack${t[1]}`,i=this.captionsProperties[n];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Ft.MAIN){var n,i;const{cea608Parser1:e,cea608Parser2:r,lastSn:a}=this,{cc:s,sn:o}=t.frag,l=null!=(n=null==(i=t.part)?void 0:i.index)?n:-1;e&&r&&(o!==a+1||o===a&&l!==this.lastPartIndex+1||s!==this.lastCc)&&(e.reset(),r.reset()),this.lastCc=s,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===Ft.SUBTITLE)if(i.byteLength){const e=n.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[n.level],r=this.vttCCs;r[n.cc]||(r[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),e&&e.textCodec===vs?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Ts(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),n.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{E.log(`Failed to parse IMSC1: ${t}`),n.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:r,unparsedVttFrags:a}=this,s=r.length-1;if(!r[n.cc]&&-1===s)return void a.push(e);const o=this.hls,l=null!=(t=n.initSegment)&&t.data?He(n.initSegment.data,new Uint8Array(i)):i;ms(l,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,e=>{this._appendCues(e,n.level),o.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?a.push(e):this._fallbackToIMSC1(n,i),E.log(`Failed to parse VTT cue: ${t}`),r&&s>n.cc||o.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:t})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Ts(t,this.initPTS[e.cc],()=>{n.textCodec=vs,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||"disabled"===n.mode)return;e.forEach(e=>Ht(n,e))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;n.trigger(g.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===Ft.SUBTITLE&&this.onFragLoaded(g.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:n,cea608Parser2:i}=this;if(!this.enabled||!n||!i)return;const{frag:r,samples:a}=t;if(r.type!==Ft.MAIN||"NONE"!==this.closedCaptionsForLevel(r))for(let s=0;s<a.length;s++){const e=a[s].bytes;if(e){const t=this.extractCea608Data(e);n.addData(a[s].pts,t[0]),i.addData(a[s].pts,t[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:i,type:r}){const{media:a}=this;if(a&&!(a.currentTime<n)){if(!r||"video"===r){const{captionsTracks:e}=this;Object.keys(e).forEach(i=>Kt(e[i],t,n))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){const{textTracks:e}=this;Object.keys(e).forEach(n=>Kt(e[n],t,i))}}}extractCea608Data(e){const t=[[],[]],n=31&e[0];let i=2;for(let r=0;r<n;r++){const n=e[i++],r=127&e[i++],a=127&e[i++];if(0===r&&0===a)continue;const s=0!==(4&n);if(s){const e=3&n;0!==e&&1!==e||(t[e].push(r),t[e].push(a))}}return t}}function Ls(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function Ps(e,t){return!!e&&e.kind===Ls(t)&&Sa(t,e)}function Os(e,t,n,i){return Math.min(t,i)-Math.max(e,n)}function Ns(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Us{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(g.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(g.BUFFER_CODECS,this.onBufferCodecs,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(g.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(g.BUFFER_CODECS,this.onBufferCodecs,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&h(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){const n=this.hls;n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&E.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((t,n)=>this.isLevelAllowed(t)&&n<=e);return this.clientRect=null,Us.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}isLevelAllowed(e){const t=this.restrictedLevels;return!t.some(t=>{return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height})}static getMaxLevelByMediaSize(e,t,n){if(null==e||!e.length)return-1;const i=(e,t)=>{return!t||(e.width!==t.width||e.height!==t.height)};let r=e.length-1;const a=Math.max(t,n);for(let s=0;s<e.length;s+=1){const t=e[s];if((t.width>=a||t.height>=a)&&i(t,e[s+1])){r=s;break}}return r}}class Fs{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"===typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const e=i-this.lastTime,r=n-this.lastDroppedFrames,a=t-this.lastDecodedFrames,s=1e3*r/e,o=this.hls;if(o.trigger(g.FPS_DROP,{currentDropped:r,currentDecoded:a,totalDroppedFrames:n}),s>0&&r>o.config.fpsDroppedMonitoringThreshold*a){let e=o.currentLevel;E.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(g.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const Bs="[eme]";class Vs{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Vs.CDMCleanupPromise?[Vs.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=E.debug.bind(E,Bs),this.log=E.log.bind(E,Bs),this.warn=E.warn.bind(E,Bs),this.error=E.error.bind(E,Bs),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(g.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(g.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(g.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===z.WIDEVINE&&n)return n;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(e,t,n)=>!!e&&n.indexOf(e)===t,i=t.map(e=>e.audioCodec).filter(n),r=t.map(e=>e.videoCodec).filter(n);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise((t,n)=>{const a=e=>{const s=e.shift();this.getMediaKeysPromise(s,i,r).then(e=>t({keySystem:s,mediaKeys:e})).catch(t=>{e.length?a(e):n(t instanceof js?t:new js({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};a(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!==typeof n){let e=`Configured requestMediaKeySystemAccess is not a function ${n}`;return null===Q&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return n(e,t)}getMediaKeysPromise(e,t,n){const i=Z(e,t,n,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let a=null==r?void 0:r.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(i)}`),a=this.requestMediaKeySystemAccess(e,i);const t=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)}),a.then(n=>{this.log(`Access for key-system "${n.keySystem}" obtained`);const i=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=n.createMediaKeys().then(t=>{return this.log(`Media-keys created for "${e}"`),i.then(n=>{return n?this.setMediaKeysServerCertificate(t,e,n):t})}),t.mediaKeys.catch(t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)}),t.mediaKeys})}return a.then(()=>r.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${ye.hexDump(e.keyId||[])}`);const i=n.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,r,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return ye.hexDump(e.keyId)}updateKeySession(e,t){var n;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${ye.hexDump((null==(n=e.decryptdata)?void 0:n.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,n)=>{const i=X(this.config),r=e.map($).filter(e=>!!e&&-1!==i.indexOf(e));return this.getKeySystemSelectionPromise(r).then(({keySystem:e})=>{const i=Y(e);i?t(i):n(new Error(`Unable to find format for key-system "${e}"`))}).catch(n)})}loadKey(e){const t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),i=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let r=this.keyIdToKeySessionPromise[n];return r||(r=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(t).then(({keySystem:n,mediaKeys:r})=>{return this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(n,r).then(()=>{this.throwIfDestroyed();const e=this.createMediaKeySessionContext({keySystem:n,mediaKeys:r,decryptdata:t}),i="cenc";return this.generateRequestWithPreferredKeySession(e,i,t.pssh,"playlist-key")})}),r.catch(e=>this.handleError(e))),r}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof js?this.hls.trigger(g.ERROR,e.data):this.hls.trigger(g.ERROR,{type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){const t=$(e.keyFormat),n=t?[t]:X(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=X(this.config)),0===e.length)throw new js({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:n}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),null===n)return;let i,r;if("sinf"===t&&this.config.drmSystems[z.FAIRPLAY]){const e=_e(new Uint8Array(n));try{const t=F(JSON.parse(e).sinf),n=Ue(new Uint8Array(t));if(!n)return;i=n.subarray(8,24),r=z.FAIRPLAY}catch(e){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const e=Ze(n);if(null===e)return;0===e.version&&e.systemId===W.WIDEVINE&&e.data&&(i=e.data.subarray(8,24)),r=q(e.systemId)}if(!r||!i)return;const a=ye.hexDump(i),{keyIdToKeySessionPromise:s,mediaKeySessions:o}=this;let l=s[a];for(let u=0;u<o.length;u++){const e=o[u],r=e.decryptdata;if(r.pssh||!r.keyId)continue;const c=ye.hexDump(r.keyId);if(a===c||-1!==r.uri.replace(/-/g,"").indexOf(a)){l=s[c],delete s[c],r.pssh=new Uint8Array(n),r.keyId=i,l=s[a]=l.then(()=>{return this.generateRequestWithPreferredKeySession(e,t,n,"encrypted-event-key-match")});break}}l||(l=s[a]=this.getKeySystemSelectionPromise([r]).then(({keySystem:e,mediaKeys:r})=>{var s;this.throwIfDestroyed();const o=new et("ISO-23001-7",a,null!=(s=Y(e))?s:"");return o.pssh=new Uint8Array(n),o.keyId=i,this.attemptSetMediaKeys(e,r).then(()=>{this.throwIfDestroyed();const i=this.createMediaKeySessionContext({decryptdata:o,keySystem:e,mediaKeys:r});return this.generateRequestWithPreferredKeySession(i,t,n,"encrypted-event-no-match")})})),l.catch(e=>this.handleError(e))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(n).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===n.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,n,i){var r,a;const s=null==(r=this.config.drmSystems)?void 0:null==(a=r[e.keySystem])?void 0:a.generateRequest;if(s)try{const i=s.call(this.hls,t,n,e);if(!i)throw new Error("Invalid response from configured generateRequest filter");t=i.initDataType,n=e.decryptdata.pssh=i.initData?new Uint8Array(i.initData):null}catch(e){var o;if(this.warn(e.message),null!=(o=this.hls)&&o.config.debug)throw e}if(null===n)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${l} (init data type: ${t} length: ${n?n.byteLength:null})`);const u=new ma,c=e._onmessage=(t=>{const n=e.mediaKeysSession;if(!n)return void u.emit("error",new Error("invalid state"));const{messageType:i,message:r}=t;this.log(`"${i}" message event for session "${n.sessionId}" message size: ${r.byteLength}`),"license-request"===i||"license-renewal"===i?this.renewLicense(e,r).catch(e=>{this.handleError(e),u.emit("error",e)}):"license-release"===i?e.keySystem===z.FAIRPLAY&&(this.updateKeySession(e,G("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${i}"`)}),d=e._onkeystatuseschange=(t=>{const n=e.mediaKeysSession;if(!n)return void u.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const i=e.keyStatus;u.emit("keyStatus",i),"expired"===i&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))});e.mediaKeysSession.addEventListener("message",c),e.mediaKeysSession.addEventListener("keystatuseschange",d);const h=new Promise((e,t)=>{u.on("error",t),u.on("keyStatus",n=>{n.startsWith("usable")?e():"output-restricted"===n?t(new js({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===n?t(new js({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${n}"`)):"expired"===n?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${n}"`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)}).catch(e=>{throw new js({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)}).then(()=>h).catch(t=>{throw u.removeAllListeners(),this.removeSession(e),t}).then(()=>{return u.removeAllListeners(),e})}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,n)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${ye.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${ye.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,n=t.loader,i=new n(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((n,a)=>{const s={responseType:"arraybuffer",url:r},l=t.certLoadPolicy.default,u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,i,r)=>{n(e.data)},onError:(t,n,i,l)=>{a(new js({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:o({url:s.url,data:void 0},t)},`"${e}" certificate request failed (${r}). Status: ${t.code} (${t.text})`))},onTimeout:(t,n,i)=>{a(new js({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:s.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(e,t,n)=>{a(new Error("aborted"))}};i.load(s,u,c)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,r)=>{e.setServerCertificate(n).then(r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${null==n?void 0:n.byteLength}) on "${t}"`),i(e)}).catch(e=>{r(new js({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>{return this.updateKeySession(e,new Uint8Array(t)).catch(e=>{throw new js({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)})})}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=(new DOMParser).parseFromString(n,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let t;for(let n=0,i=r.length;n<i;n++){var a,s;t=r[n];const i=null==(a=t.querySelector("name"))?void 0:a.textContent,o=null==(s=t.querySelector("value"))?void 0:s.textContent;i&&o&&e.setRequestHeader(i,o)}}const o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return G(atob(l))}setupLicenseXHR(e,t,n,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,n,i)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),r.call(this.hls,e,t,n,i)}).then(n=>{e.readyState||e.open("POST",t,!0);const r=n||i;return{xhr:e,licenseChallenge:r}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,r)=>{const a=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${a}`);const s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=(()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===s.readyState)if(200===s.status){this._requestLicenseFailureCount=0;let t=s.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const n=this.config.licenseResponseCallback;if(n)try{t=n.call(this.hls,s,a,e)}catch(e){this.error(e)}i(t)}else{const o=n.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||s.status>=400&&s.status<500)r(new js({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:s,response:{url:a,data:void 0,code:s.status,text:s.statusText}},`License Request XHR failed (${a}). Status: ${s.status} (${s.statusText})`));else{const n=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${n} attempts left`),this.requestLicense(e,t).then(i,r)}}}),e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=s,this.setupLicenseXHR(s,a,e,t).then(({xhr:t,licenseChallenge:n})=>{e.keySystem==z.PLAYREADY&&(n=this.unpackPlayReadyKeyMessage(t,n)),t.send(n)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},et.clearKeyUriToKeyIdMap();const n=t.length;Vs.CDMCleanupPromise=Promise.all(t.map(e=>this.removeSession(e)).concat(null==e?void 0:e.setMediaKeys(null).catch(e=>{this.log(`Could not clear media keys: ${e}`)}))).then(()=>{n&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(e=>{this.log(`Could not close sessions and clear media keys: ${e}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce((e,t)=>{return-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e},[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),t.remove().catch(e=>{this.log(`Could not remove session: ${e}`)}).then(()=>{return t.close()}).catch(e=>{this.log(`Could not close session: ${e}`)})}}}Vs.CDMCleanupPromise=void 0;class js extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var Gs,Hs,zs;(function(e){e["MANIFEST"]="m",e["AUDIO"]="a",e["VIDEO"]="v",e["MUXED"]="av",e["INIT"]="i",e["CAPTION"]="c",e["TIMED_TEXT"]="tt",e["KEY"]="k",e["OTHER"]="o"})(Gs||(Gs={})),function(e){e["DASH"]="d",e["HLS"]="h",e["SMOOTH"]="s",e["OTHER"]="o"}(Hs||(Hs={})),function(e){e["OBJECT"]="CMCD-Object",e["REQUEST"]="CMCD-Request",e["SESSION"]="CMCD-Session",e["STATUS"]="CMCD-Status"}(zs||(zs={}));const Ks={[zs.OBJECT]:["br","d","ot","tb"],[zs.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[zs.SESSION]:["cid","pr","sf","sid","st","v"],[zs.STATUS]:["bs","rtp"]};class $s{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(e=>e instanceof $s?e:new $s(e))),this.value=e,this.params=t}}class Ws{constructor(e){this.description=void 0,this.description=e}}const qs="Dict";function Ys(e){return Array.isArray(e)?JSON.stringify(e):e instanceof Map?"Map{}":e instanceof Set?"Set{}":"object"===typeof e?JSON.stringify(e):String(e)}function Xs(e,t,n,i){return new Error(`failed to ${e} "${Ys(t)}" as ${n}`,{cause:i})}const Qs="Bare Item",Zs="Boolean",Js="Byte Sequence",eo="Decimal",to="Integer";function no(e){return e<-999999999999999||999999999999999<e}const io=/[\x00-\x1f\x7f]+/,ro="Token",ao="Key";function so(e,t,n){return Xs("serialize",e,t,n)}function oo(e){if("boolean"!==typeof e)throw so(e,Zs);return e?"?1":"?0"}function lo(e){return btoa(String.fromCharCode(...e))}function uo(e){if(!1===ArrayBuffer.isView(e))throw so(e,Js);return`:${lo(e)}:`}function co(e){if(no(e))throw so(e,to);return e.toString()}function ho(e){return`@${co(e.getTime()/1e3)}`}function fo(e,t){if(e<0)return-fo(-e,t);const n=Math.pow(10,t),i=Math.abs(e*n%1-.5)<Number.EPSILON;if(i){const t=Math.floor(e*n);return(t%2===0?t:t+1)/n}return Math.round(e*n)/n}function po(e){const t=fo(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw so(e,eo);const n=t.toString();return n.includes(".")?n:`${n}.0`}const go="String";function mo(e){if(io.test(e))throw so(e,go);return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function vo(e){return e.description||e.toString().slice(7,-1)}function yo(e){const t=vo(e);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw so(t,ro);return t}function bo(e){switch(typeof e){case"number":if(!h(e))throw so(e,Qs);return Number.isInteger(e)?co(e):po(e);case"string":return mo(e);case"symbol":return yo(e);case"boolean":return oo(e);case"object":if(e instanceof Date)return ho(e);if(e instanceof Uint8Array)return uo(e);if(e instanceof Ws)return yo(e);default:throw so(e,Qs)}}function So(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw so(e,ao);return e}function To(e){return null==e?"":Object.entries(e).map(([e,t])=>{return!0===t?`;${So(e)}`:`;${So(e)}=${bo(t)}`}).join("")}function _o(e){return e instanceof $s?`${bo(e.value)}${To(e.params)}`:bo(e)}function wo(e){return`(${e.value.map(_o).join(" ")})${To(e.params)}`}function Eo(e,t={whitespace:!0}){if("object"!==typeof e)throw so(e,qs);const n=e instanceof Map?e.entries():Object.entries(e),i=null!=t&&t.whitespace?" ":"";return Array.from(n).map(([e,t])=>{t instanceof $s===!1&&(t=new $s(t));let n=So(e);return!0===t.value?n+=To(t.params):(n+="=",Array.isArray(t.value)?n+=wo(t):n+=_o(t)),n}).join(`,${i}`)}function xo(e,t){return Eo(e,t)}const Ao=e=>"ot"===e||"sf"===e||"st"===e,ko=e=>{return"number"===typeof e?h(e):null!=e&&""!==e&&!1!==e};function Io(e,t){const n=new URL(e),i=new URL(t);if(n.origin!==i.origin)return e;const r=n.pathname.split("/").slice(1),a=i.pathname.split("/").slice(1,-1);while(r[0]===a[0])r.shift(),a.shift();while(a.length)a.shift(),r.unshift("..");return r.join("/")}function Co(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();const n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return n}}}const Ro=e=>Math.round(e),Mo=(e,t)=>{return null!=t&&t.baseUrl&&(e=Io(e,t.baseUrl)),encodeURIComponent(e)},Do=e=>100*Ro(e/100),Lo={br:Ro,d:Ro,bl:Do,dl:Do,mtp:Do,nor:Mo,rtp:Do,tb:Ro};function Po(e,t){const n={};if(null==e||"object"!==typeof e)return n;const i=Object.keys(e).sort(),r=d({},Lo,null==t?void 0:t.formatters),a=null==t?void 0:t.filter;return i.forEach(i=>{if(null!=a&&a(i))return;let s=e[i];const o=r[i];o&&(s=o(s,t)),"v"===i&&1===s||"pr"==i&&1===s||ko(s)&&(Ao(i)&&"string"===typeof s&&(s=new Ws(s)),n[i]=s)}),n}function Oo(e,t={}){return e?xo(Po(e,t),d({whitespace:!1},t)):""}function No(e,t={}){if(!e)return{};const n=Object.entries(e),i=Object.entries(Ks).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{})),r=n.reduce((e,t)=>{var n;const[r,a]=t,s=(null==(n=i.find(e=>e[1].includes(r)))?void 0:n[0])||zs.REQUEST;return null!=e[s]||(e[s]={}),e[s][r]=a,e},{});return Object.entries(r).reduce((e,[n,i])=>{return e[n]=Oo(i,t),e},{})}function Uo(e,t,n){return d(e,No(t,n))}const Fo="CMCD";function Bo(e,t={}){if(!e)return"";const n=Oo(e,t);return`${Fo}=${encodeURIComponent(n)}`}const Vo=/CMCD=[^&#]+/;function jo(e,t,n){const i=Bo(t,n);if(!i)return e;if(Vo.test(e))return e.replace(Vo,i);const r=e.includes("?")?"&":"?";return`${e}${r}${i}`}class Go{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=(()=>{this.initialized&&(this.starved=!0),this.buffering=!0}),this.onPlaying=(()=>{this.initialized||(this.initialized=!0),this.buffering=!1}),this.applyPlaylistData=(e=>{try{this.apply(e,{ot:Gs.MANIFEST,su:!this.initialized})}catch(e){E.warn("Could not generate manifest CMCD data.",e)}}),this.applyFragmentData=(e=>{try{const t=e.frag,n=this.hls.levels[t.level],i=this.getObjectType(t),r={d:1e3*t.duration,ot:i};i!==Gs.VIDEO&&i!==Gs.AUDIO&&i!=Gs.MUXED||(r.br=n.bitrate/1e3,r.tb=this.getTopBandwidth(i)/1e3,r.bl=this.getBufferLength(i)),this.apply(e,r)}catch(e){E.warn("Could not generate segment CMCD data.",e)}}),this.hls=e;const t=this.config=e.config,{cmcd:n}=t;null!=n&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||Co(),this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHED,this.onMediaDetached,this),e.on(g.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHED,this.onMediaDetached,this),e.off(g.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=null==(n=t.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:Hs.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){d(t,this.createData());const n=t.ot===Gs.INIT||t.ot===Gs.VIDEO||t.ot===Gs.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((e,n)=>{return i.includes(n)&&(e[n]=t[n]),e},{})),this.useHeaders?(e.headers||(e.headers={}),Uo(e.headers,t)):e.url=jo(e.url,t)}getObjectType(e){const{type:t}=e;return"subtitle"===t?Gs.TIMED_TEXT:"initSegment"===e.sn?Gs.INIT:"audio"===t?Gs.AUDIO:"main"===t?this.hls.audioTracks.length?Gs.VIDEO:Gs.MUXED:void 0}getTopBandwidth(e){let t,n=0;const i=this.hls;if(e===Gs.AUDIO)t=i.audioTracks;else{const e=i.maxAutoLevel,n=e>-1?e+1:i.levels.length;t=i.levels.slice(0,n)}for(const r of t)r.bitrate>n&&(n=r.bitrate);return n>0?n:NaN}getBufferLength(e){const t=this.hls.media,n=e===Gs.AUDIO?this.audioBuffer:this.videoBuffer;if(!n||!t)return NaN;const i=mi.bufferInfo(n,t.currentTime,this.config.maxBufferHole);return 1e3*i.len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,i){t(e),this.loader.load(e,n,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,i){t(e),this.loader.load(e,n,i)}}}}const Ho=3e5;class zo{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=E.log.bind(E,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((null==n?void 0:n.action)===Vn.SendAlternateToPenaltyBox&&n.flags===jn.MoveAllAlternatesMatchingHost){const e=this.levels;let i=this.pathwayPriority,r=this.pathwayId;if(t.context){const{groupId:n,pathwayId:i,type:a}=t.context;n&&e?r=this.getPathwayForGroupId(n,a,r):i&&(r=i)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!i&&e&&(i=e.reduce((e,t)=>{return-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e},[])),i&&i.length>1&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==r),n.resolved||E.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${r} levels: ${e?e.length:e} priorities: ${JSON.stringify(i)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this.pathwayPriority=e;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(e=>{i-n[e]>Ho&&delete n[e]});for(let r=0;r<e.length;r++){const i=e[r];if(i in n)continue;if(i===this.pathwayId)return;const a=this.hls.nextLoadLevel,s=this.hls.levels[a];if(t=this.getLevelsForPathway(i),t.length>0){this.log(`Setting Pathway to "${i}"`),this.pathwayId=i,An(t),this.hls.trigger(g.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[a];s&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==s.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==s.bitrate&&this.log(`Unstable Pathways change from bitrate ${s.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===Ut.AUDIO_TRACK&&i[r].hasAudioGroup(e)||t===Ut.SUBTITLE_TRACK&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(e=>{const{ID:r,"BASE-ID":a,"URI-REPLACEMENT":s}=e;if(t.some(e=>e.pathwayId===r))return;const o=this.getLevelsForPathway(a).map(e=>{const t=new k(e.attrs);t["PATHWAY-ID"]=r;const a=t.AUDIO&&`${t.AUDIO}_clone_${r}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${r}`;a&&(n[t.AUDIO]=a,t.AUDIO=a),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);const l=$o(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",s),u=new hn({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let n=1;n<e.audioGroups.length;n++)u.addGroupId("audio",`${e.audioGroups[n]}_clone_${r}`);if(e.subtitleGroups)for(let n=1;n<e.subtitleGroups.length;n++)u.addGroupId("text",`${e.subtitleGroups[n]}_clone_${r}`);return u});t.push(...o),Ko(this.audioTracks,n,s,r),Ko(this.subtitleTracks,i,s,r)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new n(t);try{i=new self.URL(e)}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==i.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+e)}const r={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,s=a.errorRetry||a.timeoutRetry||{},o={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},l={onSuccess:(e,t,n,r)=>{this.log(`Loaded steering manifest: "${i}"`);const a=e.data;if(1!==a.VERSION)return void this.log(`Steering VERSION ${a.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=a.TTL;const{"RELOAD-URI":s,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=a;if(s)try{this.uri=new self.URL(s,i).href}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${s}`)}this.scheduleRefresh(this.uri||n.url),o&&this.clonePathways(o);const u={steeringManifest:a,url:i.toString()};this.hls.trigger(g.STEERING_MANIFEST_LOADED,u),l&&this.updatePathwayPriority(l)},onError:(e,t,n,i)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let r=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,r);else{const e=this.loader;if("function"===typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,n)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const n=null==(t=this.hls)?void 0:t.media;!n||n.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}}function Ko(e,t,n,i){e&&Object.keys(t).forEach(r=>{const a=e.filter(e=>e.groupId===r).map(e=>{const a=d({},e);return a.details=void 0,a.attrs=new k(a.attrs),a.url=a.attrs.URI=$o(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),a.groupId=a.attrs["GROUP-ID"]=t[r],a.attrs["PATHWAY-ID"]=i,a});e.push(...a)})}function $o(e,t,n,i){const{HOST:r,PARAMS:a,[n]:s}=i;let o;t&&(o=null==s?void 0:s[t],o&&(e=o));const l=new self.URL(e);return r&&!o&&(l.host=r),a&&Object.keys(a).sort().forEach(e=>{e&&l.searchParams.set(e,a[e])}),l.href}const Wo=/^age:\s*[\d.]+\s*$/im;class qo{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new M,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(this.loader===n&&!this.stats.aborted)return r(n,t.url)}).catch(e=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",t.url,!0),r(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(e=>{this.callbacks.onError({code:n.status,text:e.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:a}=n.loadPolicy;if(i)for(const s in i)e.setRequestHeader(s,i[s]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=r&&h(r)?r:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!n.aborted&&i>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const i=t.status,a="text"!==t.responseType;if(i>=200&&i<300&&(a&&t.response||null!==t.responseText)){n.loading.end=Math.max(self.performance.now(),n.loading.first);const r=a?t.response:t.responseText,s="arraybuffer"===t.responseType?r.byteLength:r.length;if(n.loaded=n.total=s,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first),!this.callbacks)return;const o=this.callbacks.onProgress;if(o&&o(n,e,r,t),!this.callbacks)return;const l={url:t.responseURL,data:r,code:i};this.callbacks.onSuccess(l,n,e,t)}else{const a=r.loadPolicy.errorRetry,s=n.retry,o={url:e.url,data:void 0,code:i};Mn(a,s,!1,o)?this.retry(a):(E.error(`${i} while loading ${e.url}`),this.callbacks.onError({code:i,text:t.statusText},e,t,n))}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Mn(e,t,!0))this.retry(e);else{var n;E.warn(`timeout while loading ${null==(n=this.context)?void 0:n.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=Cn(e,n.retry),n.retry++,E.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Wo.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function Yo(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}const Xo=/(\d+)-(\d+)\/(\d+)/;class Qo{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||tl,this.controller=new self.AbortController,this.stats=new M}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=Zo(e,this.controller.signal),a=n.onProgress,s="arraybuffer"===e.responseType,o=s?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=l&&h(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(i,e,this.response)},t.timeout),self.fetch(this.request).then(r=>{this.response=this.loader=r;const o=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(i,e,this.response)},u-(o-i.loading.start)),!r.ok){const{status:e,statusText:t}=r;throw new nl(t||"fetch, bad network response",e,r)}return i.loading.first=o,i.total=el(r.headers)||i.total,a&&h(t.highWaterMark)?this.loadProgressively(r,i,e,t.highWaterMark,a):s?r.arrayBuffer():"json"===e.responseType?r.json():r.text()}).then(r=>{const s=this.response;if(!s)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=r[o];l&&(i.loaded=i.total=l);const u={url:s.url,data:r,code:s.status};a&&!h(t.highWaterMark)&&a(i,e,r,s),n.onSuccess(u,i,e,s)}).catch(t=>{if(self.clearTimeout(this.requestTimeout),i.aborted)return;const r=t&&t.code||0,a=t?t.message:null;n.onError({code:r,text:a},e,t?t.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,i=0,r){const a=new ji,s=e.body.getReader(),o=()=>{return s.read().then(s=>{if(s.done)return a.dataLength&&r(t,n,a.flush(),e),Promise.resolve(new ArrayBuffer(0));const l=s.value,u=l.length;return t.loaded+=u,u<i||a.dataLength?(a.push(l),a.dataLength>=i&&r(t,n,a.flush(),e)):r(t,n,l,e),o()}).catch(()=>{return Promise.reject()})};return o()}}function Zo(e,t){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(d({},e.headers))};return e.rangeEnd&&n.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),n}function Jo(e){const t=Xo.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}function el(e){const t=e.get("Content-Range");if(t){const e=Jo(t);if(h(e))return e}const n=e.get("Content-Length");if(n)return parseInt(n)}function tl(e,t){return new self.Request(e.url,t)}class nl extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const il=/\s/,rl={newCue(e,t,n,i){const r=[];let a,s,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<i.rows.length;h++)if(a=i.rows[h],o=!0,l=0,u="",!a.isEmpty()){var d;for(let e=0;e<a.chars.length;e++)il.test(a.chars[e].uchar)&&o?l++:(u+=a.chars[e].uchar,o=!1);a.cueStartTime=t,t===n&&(n+=1e-4),l>=16?l--:l++;const i=ls(u.trim()),f=ps(t,n,i);null!=e&&null!=(d=e.cues)&&d.getCueById(f)||(s=new c(t,n,i),s.id=f,s.line=h+1,s.align="left",s.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(s))}return e&&r.length&&(r.sort((e,t)=>{return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line}),r.forEach(t=>Ht(e,t))),r}},al={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},sl=o(o({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:qo,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ui,bufferController:Ra,capLevelController:Us,errorController:Gn,fpsController:Fs,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Q,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:al},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},ol()),{},{subtitleStreamController:xa,subtitleTrackController:ka,timelineController:Ds,audioStreamController:_a,audioTrackController:wa,emeController:Vs,cmcdController:Go,contentSteeringController:zo});function ol(){return{cueHandler:rl,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function ll(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=ul(e),i=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(e=>{const i=`${"level"===e?"playlist":e}LoadPolicy`,a=void 0===t[i],s=[];r.forEach(r=>{const o=`${e}Loading${r}`,l=t[o];if(void 0!==l&&a){s.push(o);const e=n[i].default;switch(t[i]={default:e},r){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l;break}}}),s.length&&E.warn(`hls.js config: "${s.join('", "')}" setting(s) are deprecated, use "${i}": ${JSON.stringify(t[i])}`)}),o(o({},n),t)}function ul(e){return e&&"object"===typeof e?Array.isArray(e)?e.map(ul):Object.keys(e).reduce((t,n)=>{return t[n]=ul(e[n]),t},{}):e}function cl(e){const t=e.loader;if(t!==Qo&&t!==qo)E.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{const t=Yo();t&&(e.loader=Qo,e.progressive=!0,e.enableSoftwareAES=!0,E.log("[config]: Progressive streaming enabled, using FetchLoader"))}}let dl;class hl extends Hn{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this),e.on(g.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this),e.off(g.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){const e=this._levels;e.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],r={},a={};let s=!1,o=!1,l=!1;t.levels.forEach(e=>{var t,u;const c=e.attrs;let{audioCodec:d,videoCodec:h}=e;-1!==(null==(t=d)?void 0:t.indexOf("mp4a.40.34"))&&(dl||(dl=/chrome|firefox/i.test(navigator.userAgent)),dl&&(e.audioCodec=d=void 0)),d&&(e.audioCodec=d=St(d,n)),0===(null==(u=h)?void 0:u.indexOf("avc1"))&&(h=e.videoCodec=_t(h));const{width:f,height:p,unknownCodecs:g}=e;if(s||(s=!(!f||!p)),o||(o=!!h),l||(l=!!d),null!=g&&g.length||d&&!ht(d,"audio",n)||h&&!ht(h,"video",n))return;const{CODECS:m,"FRAME-RATE":v,"HDCP-LEVEL":y,"PATHWAY-ID":b,RESOLUTION:S,"VIDEO-RANGE":T}=c,_=`${b||"."}-`,w=`${_}${e.bitrate}-${S}-${v}-${m}-${T}-${y}`;if(r[w])if(r[w].uri===e.url||e.attrs["PATHWAY-ID"])r[w].addGroupId("audio",c.AUDIO),r[w].addGroupId("text",c.SUBTITLES);else{const t=a[w]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const n=new hn(e);r[w]=n,i.push(n)}else{const t=new hn(e);r[w]=t,a[w]=1,i.push(t)}}),this.filterAndSortMediaOptions(i,t,s,o,l)}filterAndSortMediaOptions(e,t,n,i,r){let a=[],s=[],o=e;if((n||i)&&r&&(o=o.filter(({videoCodec:e,videoRange:t,width:n,height:i})=>(!!e||!(!n||!i))&&ln(t))),0===o.length)return void Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const e=new Error("no level with compatible codecs found in manifest");this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}});if(t.audioTracks){const{preferManagedMediaSource:e}=this.hls.config;a=t.audioTracks.filter(t=>!t.audioCodec||ht(t.audioCodec,"audio",e)),fl(a)}t.subtitles&&(s=t.subtitles,fl(s));const l=o.slice(0);o.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return on.indexOf(e.videoRange)-on.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const n=gt(e.videoCodec),i=gt(t.videoCodec);if(n!==i)return i-n}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const n=mt(e.codecSet),i=mt(t.codecSet);if(n!==i)return i-n}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let u=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let f=0;f<l.length;f++)if(l[f].pathwayId===o[0].pathwayId){u=l[f];break}this._levels=o;for(let f=0;f<o.length;f++)if(o[f]===u){var c;this._firstLevel=f;const e=u.bitrate,t=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${e}`),void 0===(null==(c=this.hls.userConfig)?void 0:c.abrEwmaDefaultEstimate)){const n=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);n>t&&t===sl.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=n)}break}const d=r&&!i,h={levels:o,audioTracks:a,subtitleTracks:s,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:!d&&a.some(e=>!!e.url)};this.hls.trigger(g.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const n=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:n,reason:n.message}),i)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],s=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&a.details&&i&&r===s)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${s?" with Pathway "+s:""} from level ${n}${r?" with Pathway "+r:""}`);const o={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(g.LEVEL_SWITCHING,o);const l=a.details;if(!l||l.live){const e=this.switchParams(a.uri,null==i?void 0:i.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===Ut.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===Ft.MAIN){const e=t.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const n=this._levels[t.level];null!=n&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:r}=t,a=this._levels[i];var s;if(!a)return this.warn(`Invalid level index ${i}`),void(null!=(s=t.deliveryDirectives)&&s.skip&&(r.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===a.fragmentError&&(a.loadError=0),this.playlistLoaded(i,t,a.details)):null!=(n=t.deliveryDirectives)&&n.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){let i=n.uri;if(e)try{i=e.addDirectives(i)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}const r=n.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""} with${r?" Pathway "+r:""} ${i}`),this.clearTimer(),this.hls.trigger(g.LEVEL_LOADING,{url:i,level:t,pathwayId:n.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const n=this._levels.filter((t,n)=>{return n!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1)});An(n),this._levels=n,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(g.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(g.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function fl(e){const t={};e.forEach(e=>{const n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++})}class pl{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[n].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=v.KEY_LOAD_ERROR,n,i,r){return new Mi({type:m.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:n,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:n,cc:i}=e;for(let e=0;e<t.length;e++){const r=t[e];if(i<=r.cc&&("initSegment"===n||"initSegment"===r.sn||n<r.sn)){this.emeController.selectKeySystemFormat(r).then(e=>{r.setKeyFormat(e)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>{return this.loadInternal(e,t)}):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const n=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,v.KEY_LOAD_ERROR,n))}const a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,v.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let s=this.keyUriToKeyInfo[a];if(null!=(n=s)&&n.decryptdata.key)return r.key=s.decryptdata.key,Promise.resolve({frag:e,keyInfo:s});var o;if(null!=(i=s)&&i.keyLoadPromise)switch(null==(o=s.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return s.keyLoadPromise.then(t=>{return r.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:s}})}switch(s=this.keyUriToKeyInfo[a]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(s,e):this.loadKeyEME(s,e);case"AES-128":return this.loadKeyHTTP(s,e);default:return Promise.reject(this.createKeyLoadError(e,v.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(n);if(t)return(e.keyLoadPromise=t.then(t=>{return e.mediaKeySessionContext=t,n})).catch(t=>{throw e.keyLoadPromise=null,t})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=n.loader,r=new i(n);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((i,a)=>{const s={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=n.keyLoadPolicy.default,u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,r)=>{const{frag:s,keyInfo:o,url:l}=n;if(!s.decryptdata||o!==this.keyUriToKeyInfo[l])return a(this.createKeyLoadError(s,v.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));o.decryptdata.key=s.decryptdata.key=new Uint8Array(e.data),s.keyLoader=null,o.loader=null,i({frag:s,keyInfo:o})},onError:(e,n,i,r)=>{this.resetLoader(n),a(this.createKeyLoadError(t,v.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),i,o({url:s.url,data:void 0},e)))},onTimeout:(e,n,i)=>{this.resetLoader(n),a(this.createKeyLoadError(t,v.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:(e,n,i)=>{this.resetLoader(n),a(this.createKeyLoadError(t,v.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};r.load(s,u,c)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,r=n.loader;t.keyLoader===r&&(t.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[i],r&&r.destroy()}}function gl(){return self.SourceBuffer||self.WebKitSourceBuffer}function ml(){const e=lt();if(!e)return!1;const t=gl();return!t||t.prototype&&"function"===typeof t.prototype.appendBuffer&&"function"===typeof t.prototype.remove}function vl(){if(!ml())return!1;const e=lt();return"function"===typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(pt(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(pt(t,"audio"))))}function yl(){var e;const t=gl();return"function"===typeof(null==t?void 0:null==(e=t.prototype)?void 0:e.changeType)}const bl=250,Sl=2,Tl=.1,_l=.05;class wl{constructor(e,t,n,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=n,this.hls=i}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:n,media:i,stalled:r}=this;if(null===i)return;const{currentTime:a,seeking:s}=i,o=this.seeking&&!s,l=!this.seeking&&s;if(this.seeking=s,a!==e){if(this.moved=!0,s||(this.nudgeRetry=0),null!==r){if(this.stallReported){const e=self.performance.now()-r;E.warn(`playback not stuck anymore @${a}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null}return}if(l||o)return void(this.stalled=null);if(i.paused&&!s||i.ended||0===i.playbackRate||!mi.getBuffered(i).length)return void(this.nudgeRetry=0);const u=mi.bufferInfo(i,a,0),c=u.nextStart||0;if(s){const e=u.len>Sl,n=!c||t&&t.start<=a||c-a>Sl&&!this.fragmentTracker.getPartialFragment(a);if(e||n)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var d;const e=u.len>0;if(!e&&!c)return;const t=Math.max(c,u.start||0)-a,n=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,r=null==n?void 0:null==(d=n.details)?void 0:d.live,s=r?2*n.details.targetduration:Sl,o=this.fragmentTracker.getPartialFragment(a);if(t>0&&(t<=s||o))return void(i.paused||this._trySkipBufferHole(o))}const h=self.performance.now();if(null===r)return void(this.stalled=h);const f=h-r;if(!s&&f>=bl&&(this._reportStall(u),!this.media))return;const p=mi.bufferInfo(i,a,n.maxBufferHole);this._tryFixBufferStall(p,f)}_tryFixBufferStall(e,t){const{config:n,fragmentTracker:i,media:r}=this;if(null===r)return;const a=r.currentTime,s=i.getPartialFragment(a);if(s){const e=this._trySkipBufferHole(s);if(e||!this.media)return}(e.len>n.maxBufferHole||e.nextStart&&e.nextStart-a<n.maxBufferHole)&&t>1e3*n.highBufferWatchdogPeriod&&(E.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:n,stallReported:i}=this;if(!i&&n){this.stallReported=!0;const i=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${JSON.stringify(e)})`);E.warn(i.message),t.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:n,media:i}=this;if(null===i)return 0;const r=i.currentTime,a=mi.bufferInfo(i,r,0),s=r<a.start?a.start:a.nextStart;if(s){const o=a.len<=t.maxBufferHole,l=a.len>0&&a.len<1&&i.readyState<3,u=s-r;if(u>0&&(o||l)){if(u>t.maxBufferHole){const{fragmentTracker:t}=this;let n=!1;if(0===r){const e=t.getAppendedFrag(0,Ft.MAIN);e&&s<e.end&&(n=!0)}if(!n){const n=e||t.getAppendedFrag(r,Ft.MAIN);if(n){let e=!1,i=n.end;while(i<s){const n=t.getPartialFragment(i);if(!n){e=!0;break}i+=n.duration}if(e)return 0}}}const a=Math.max(s+_l,r+Tl);if(E.warn(`skipping hole, adjusting currentTime from ${r} to ${a}`),this.moved=!0,this.stalled=null,i.currentTime=a,e&&!e.gap){const t=new Error(`fragment loaded with buffer holes, seeking from ${r} to ${a}`);n.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:t,reason:t.message,frag:e})}return a}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:n,nudgeRetry:i}=this;if(null===n)return;const r=n.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){const a=r+(i+1)*e.nudgeOffset,s=new Error(`Nudging 'currentTime' from ${r} to ${a}`);E.warn(s.message),n.currentTime=a,t.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_NUDGE_ON_STALL,error:s,fatal:!1})}else{const n=new Error(`Playhead still not moving while enough data buffered @${r} after ${e.nudgeMaxRetry} nudges`);E.error(n.message),t.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_STALLED_ERROR,error:n,fatal:!0})}}}const El=100;class xl extends Vi{constructor(e,t,n){super(e,t,n,"[stream-controller]",Ft.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(g.ERROR,this.onError,this),e.on(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(g.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(g.BUFFER_CREATED,this.onBufferCreated,this),e.on(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(g.ERROR,this.onError,this),e.off(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(g.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(g.BUFFER_CREATED,this.onBufferCreated,this),e.off(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:n}=this;if(this.stopLoad(),this.setInterval(El),this.level=-1,!this.startFragRequested){let e=n.startLevel;-1===e&&(n.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=n.firstAutoLevel),n.nextLoadLevel=e,this.level=n.loadLevel,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=Bi.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Bi.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Bi.WAITING_LEVEL:{const{levels:e,level:t}=this,n=null==e?void 0:e[t],i=null==n?void 0:n.details;if(i&&(!i.live||this.levelLastLoaded===n)){if(this.waitForCdnTuneIn(i))break;this.state=Bi.IDLE;break}if(this.hls.nextLoadLevel!==this.level){this.state=Bi.IDLE;break}break}case Bi.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),n=this.retryDate;if(!n||t>=n||null!=(e=this.media)&&e.seeking){const{levels:e,level:t}=this,n=null==e?void 0:e[t];this.resetStartWhenNotLoaded(n||null),this.state=Bi.IDLE}}break}this.state===Bi.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(null===t||!i&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const r=e.nextLoadLevel;if(null==n||!n[r])return;const a=n[r],s=this.getMainFwdBufferInfo();if(null===s)return;const o=this.getLevelDetails();if(o&&this._streamEnded(s,o)){const e={};return this.altAudio&&(e.type="video"),this.hls.trigger(g.BUFFER_EOS,e),void(this.state=Bi.ENDED)}e.loadLevel!==r&&-1===e.manualLevel&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const l=a.details;if(!l||this.state===Bi.WAITING_LEVEL||l.live&&this.levelLastLoaded!==a)return this.level=r,void(this.state=Bi.WAITING_LEVEL);const u=s.len,c=this.getMaxBufferLength(a.maxBitrate);if(u>=c)return;this.backtrackFragment&&this.backtrackFragment.start>s.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:s.end;let h=this.getNextFragment(d,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&"initSegment"!==h.sn&&this.fragmentTracker.getState(h)!==di.OK){var f;const e=(null!=(f=this.backtrackFragment)?f:h).sn,t=e-l.startSN,n=l.fragments[t-1];n&&h.cc===n.cc&&(h=n,this.fragmentTracker.removeFragment(n))}else this.backtrackFragment&&s.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,d)){const e=h.gap;if(!e){const e=this.audioOnly&&!this.altAudio?D.AUDIO:D.VIDEO,t=(e===D.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,Ft.MAIN)}h=this.getNextFragmentLoopLoading(h,l,s,Ft.MAIN,c)}h&&(!h.initSegment||h.initSegment.data||this.bitrateTest||(h=h.initSegment),this.loadFragment(h,a,d))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===di.NOT_LOADED||i===di.PARTIAL?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,n)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Ft.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=this.hls.nextLoadLevel,i=e[t],r=this.fragLastKbps;n=r&&this.fragCurrent?this.fragCurrent.duration*i.maxBitrate/(1e3*r)+1:0}else n=0;const a=this.getBufferedFrag(t.currentTime+n);if(a){const e=this.followingBufferedFrag(a);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,n=e.duration,i=Math.max(a.end,t+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Bi.KEY_LOADING:case Bi.FRAG_LOADING:case Bi.FRAG_LOADING_WAITING_RETRY:case Bi.PARSING:case Bi.PARSED:this.state=Bi.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new wl(this.config,n,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;h(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const n=this.getMainFwdBufferInfo();null!==n&&0!==n.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${n?n.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(g.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let n=!1,i=!1;t.levels.forEach(e=>{const t=e.audioCodec;t&&(n=n||-1!==t.indexOf("mp4a.40.2"),i=i||-1!==t.indexOf("mp4a.40.5"))}),this.audioCodecSwitch=n&&i&&!yl(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==Bi.IDLE)return;const i=n[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(i.details))&&(this.state=Bi.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:i}=this,r=t.level,a=t.details,s=a.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${r}`);this.log(`Level ${r} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${s}`);const o=i[r],l=this.fragCurrent;!l||this.state!==Bi.FRAG_LOADING&&this.state!==Bi.FRAG_LOADING_WAITING_RETRY||l.level!==t.level&&l.loader&&this.abortCurrentFrag();let u=0;if(a.live||null!=(n=o.details)&&n.live){var c;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,o.details,null==(c=this.levelLastLoaded)?void 0:c.details)}if(o.details=a,this.levelLastLoaded=o,this.hls.trigger(g.LEVEL_UPDATED,{details:a,level:r}),this.state===Bi.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=Bi.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,u),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:n,part:i,payload:r}=e,{levels:a}=this;if(!a)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);const s=a[n.level],o=s.details;if(!o)return this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),void this.fragmentTracker.removeFragment(n);const l=s.videoCodec,u=o.PTSKnown||!o.live,c=null==(t=n.initSegment)?void 0:t.data,d=this._getAudioCodec(s),h=this.transmuxer=this.transmuxer||new va(this.hls,Ft.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,p=-1!==f,g=new vi(n.level,n.sn,n.stats.chunkCount,r.byteLength,f,p),m=this.initPTS[n.cc];h.push(r,c,d,l,n,i,o.totalduration,u,g,m)}onAudioTrackSwitching(e,t){const n=this.altAudio,i=!!t.url;if(!i){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const e=this.hls;n&&(e.trigger(g.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(g.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=t.id,i=!!this.hls.audioTracks[n].url;if(i){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=i,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,r,a=!1;for(const s in n){const e=n[s];if("main"===e.id){if(r=s,i=e,"video"===s){const e=n[s];e&&(this.videoBuffer=e.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n&&n.type!==Ft.MAIN)return;if(this.fragContextChanged(n))return this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===Bi.PARSED&&(this.state=Bi.IDLE));const r=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}onError(e,t){var n;if(t.fatal)this.state=Bi.ERROR;else switch(t.details){case v.FRAG_GAP:case v.FRAG_PARSING_ERROR:case v.FRAG_DECRYPT_ERROR:case v.FRAG_LOAD_ERROR:case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_ERROR:case v.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ft.MAIN,t);break;case v.LEVEL_LOAD_ERROR:case v.LEVEL_LOAD_TIMEOUT:case v.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Bi.WAITING_LEVEL||(null==(n=t.context)?void 0:n.type)!==Ut.LEVEL||(this.state=Bi.IDLE);break;case v.BUFFER_APPEND_ERROR:case v.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;if(t.details===v.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case v.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!mi.getBuffered(e).length){const e=this.state!==Bi.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=Bi.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==D.AUDIO||this.audioOnly&&!this.altAudio){const e=(t===D.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,Ft.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void this.log(`could not seek to ${n}, already seeking at ${t}`);const i=mi.getBuffered(e),r=i.length?i.start(0):0,a=r-n;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${a} to match buffer start`),n+=a,this.startPosition=n),this.log(`seek to target start position ${n} from current time ${t}`),e.currentTime=n}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:i}=this;if(!n||this.fragContextChanged(e))return;t.fragmentError=0,this.state=Bi.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const r=e.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),i.trigger(g.FRAG_LOADED,n),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const n="main",{hls:i}=this,{remuxResult:r,chunkMeta:a}=e,s=this.getCurrentContext(a);if(!s)return void this.resetWhenMissingContext(a);const{frag:o,part:l,level:u}=s,{video:c,text:d,id3:f,initSegment:p}=r,{details:m}=u,v=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Bi.PARSING,p){if(null!=p&&p.tracks){const e=o.initSegment||o;this._bufferInitSegment(u,p.tracks,e,a),i.trigger(g.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:n,tracks:p.tracks})}const e=p.initPTS,t=p.timescale;h(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},i.trigger(g.INIT_PTS_FOUND,{frag:o,id:n,initPTS:e,timescale:t}))}if(c&&m&&"initSegment"!==o.sn){const e=m.fragments[o.sn-1-m.startSN],t=o.sn===m.startSN,n=!e||o.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:i,startDTS:r,endDTS:s}=c;if(l)l.elementaryStreams[c.type]={startPTS:e,endPTS:i,startDTS:r,endDTS:s};else if(c.firstKeyFrame&&c.independent&&1===a.id&&!n&&(this.couldBacktrack=!0),c.dropped&&c.independent){const r=this.getMainFwdBufferInfo(),a=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,l=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&a<l-this.config.maxBufferHole&&!n)return void this.backtrack(o);n&&(o.gap=!0),o.setElementaryStreamInfo(c.type,o.start,i,o.start,s,!0)}else t&&e>Sl&&(o.gap=!0);o.setElementaryStreamInfo(c.type,e,i,r,s),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,a,t||n)}else{if(!t&&!n)return void this.backtrack(o);o.gap=!0}}if(v){const{startPTS:e,endPTS:t,startDTS:n,endDTS:i}=v;l&&(l.elementaryStreams[D.AUDIO]={startPTS:e,endPTS:t,startDTS:n,endDTS:i}),o.setElementaryStreamInfo(D.AUDIO,e,t,n,i),this.bufferFragmentData(v,o,l,a)}if(m&&null!=f&&null!=(t=f.samples)&&t.length){const e={id:n,frag:o,details:m,samples:f.samples};i.trigger(g.FRAG_PARSING_METADATA,e)}if(m&&d){const e={id:n,frag:o,details:m,samples:d.samples};i.trigger(g.FRAG_PARSING_USERDATA,e)}}}_bufferInitSegment(e,t,n,i){if(this.state!==Bi.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:r,video:a,audiovideo:s}=t;if(r){let t=e.audioCodec;const n=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=r.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===n.indexOf("firefox")&&(t="mp4a.40.5")}t&&-1!==t.indexOf("mp4a.40.5")&&-1!==n.indexOf("android")&&"audio/mpeg"!==r.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),r.levelCodec=t,r.id="main",this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${r.codec}]`)}a&&(a.levelCodec=e.videoCodec,a.id="main",this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${a.codec}]`)),s&&this.log(`Init audiovideo buffer, container:${s.container}, codecs[level/parsed]=[${e.codecs}/${s.codec}]`),this.hls.trigger(g.BUFFER_CODECS,t),Object.keys(t).forEach(e=>{const r=t[e],a=r.initSegment;null!=a&&a.byteLength&&this.hls.trigger(g.BUFFER_APPENDING,{type:e,data:a,frag:n,part:null,chunkMeta:i,parent:n.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Ft.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Bi.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const n=e.currentTime;if(mi.isBuffered(e,n)?t=this.getAppendedFrag(n):mi.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,n=t.level;e&&t.sn===e.sn&&e.level===n||(this.fragPlaying=t,this.hls.trigger(g.FRAG_CHANGED,{frag:t}),e&&e.level===n||this.hls.trigger(g.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,n=this.currentFrag;if(n&&h(t)&&h(n.programDateTime)){const e=n.programDateTime+1e3*(t-n.start);return new Date(e)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Al{static get version(){return"1.5.14"}static isMSESupported(){return ml()}static isSupported(){return vl()}static getMediaSource(){return lt()}static get Events(){return g}static get ErrorTypes(){return m}static get ErrorDetails(){return v}static get DefaultConfig(){return Al.defaultConfig?Al.defaultConfig:sl}static set DefaultConfig(e){Al.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new ma,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,w(e.debug||!1,"Hls instance");const t=this.config=ll(Al.DefaultConfig,e);this.userConfig=e,t.progressive&&cl(t);const{abrController:n,bufferController:i,capLevelController:r,errorController:a,fpsController:s}=t,o=new a(this),l=this.abrController=new n(this),u=this.bufferController=new i(this),c=this.capLevelController=new r(this),d=new s(this),h=new jt(this),f=new nn(this),p=t.contentSteeringController,m=p?new p(this):null,v=this.levelController=new hl(this,m),y=new hi(this),b=new pl(this.config),S=this.streamController=new xl(this,y,b);c.setStreamController(S),d.setStreamController(S);const T=[h,v,S];m&&T.splice(1,0,m),this.networkControllers=T;const _=[l,u,c,d,f,y];this.audioTrackController=this.createController(t.audioTrackController,T);const E=t.audioStreamController;E&&T.push(new E(this,y,b)),this.subtitleTrackController=this.createController(t.subtitleTrackController,T);const x=t.subtitleStreamController;x&&T.push(new x(this,y,b)),this.createController(t.timelineController,_),b.emeController=this.emeController=this.createController(t.emeController,_),this.cmcdController=this.createController(t.cmcdController,_),this.latencyController=this.createController(rn,_),this.coreComponents=_,T.push(o);const A=o.onErrorOut;"function"===typeof A&&this.on(g.ERROR,A,o)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,i){this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(E.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;const n=e===g.ERROR;this.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.INTERNAL_EXCEPTION,fatal:n,event:e,error:t}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){E.log("destroy"),this.trigger(g.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){E.log("attachMedia"),this._media=e,this.trigger(g.MEDIA_ATTACHING,{media:e})}detachMedia(){E.log("detachMedia"),this.trigger(g.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,n=this.url,i=this.url=a.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,E.log(`loadSource:${i}`),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(g.MANIFEST_LOADING,{url:e})}startLoad(e=-1){E.log(`startLoad(${e})`),this.started=!0,this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){E.log("stopLoad"),this.started=!1,this.networkControllers.forEach(e=>{e.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.stopLoad()})}swapAudioCodec(){E.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){E.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){E.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){E.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){E.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){E.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){E.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(E.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){sn(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(i=-1===t&&null!=e&&e.length?e.length-1:t,n)for(let r=i;r--;){const t=e[r].attrs["HDCP-LEVEL"];if(t&&t<=n)return r}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return null==(t=this.audioTrackController)?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return null==(t=this.subtitleTrackController)||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Al.defaultConfig=void 0},a5b8:function(e,t,n){"use strict";var i=n("d8e8");function r(e){var t,n;this.promise=new e(function(e,i){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=i}),this.resolve=i(t),this.reject=i(n)}e.exports.f=function(e){return new r(e)}},a73c:function(e,t,n){var i=n("6d8b"),r=i.retrieve2,a=i.retrieve3,s=i.each,o=i.normalizeCssArray,l=i.isString,u=i.isObject,c=n("e86a"),d=n("5693"),h=n("5e76"),f=n("7d6d"),p={left:1,right:1,center:1},g={top:1,bottom:1,middle:1};function m(e){return v(e),s(e.rich,v),e}function v(e){if(e){e.font=c.makeFont(e);var t=e.textAlign;"middle"===t&&(t="center"),e.textAlign=null==t||p[t]?t:"left";var n=e.textVerticalAlign||e.textBaseline;"center"===n&&(n="middle"),e.textVerticalAlign=null==n||g[n]?n:"top";var i=e.textPadding;i&&(e.textPadding=o(e.textPadding))}}function y(e,t,n,i,r){i.rich?S(e,t,n,i,r):b(e,t,n,i,r)}function b(e,t,n,i,r){var a=I(t,"font",i.font||c.DEFAULT_FONT),s=i.textPadding,o=e.__textCotentBlock;o&&!e.__dirty||(o=e.__textCotentBlock=c.parsePlainText(n,a,s,i.truncate));var l=o.outerHeight,u=o.lines,d=o.lineHeight,h=k(l,i,r),f=h.baseX,p=h.baseY,g=h.textAlign,m=h.textVerticalAlign;_(t,i,r,f,p);var v=c.adjustTextY(p,l,m),y=f,b=v,S=E(i);if(S||s){var T=c.getWidth(n,a),w=T;s&&(w+=s[1]+s[3]);var A=c.adjustTextX(f,w,g);S&&x(e,t,i,A,v,w,l),s&&(y=D(f,g,s),b+=s[0])}I(t,"textAlign",g||"left"),I(t,"textBaseline","middle"),I(t,"shadowBlur",i.textShadowBlur||0),I(t,"shadowColor",i.textShadowColor||"transparent"),I(t,"shadowOffsetX",i.textShadowOffsetX||0),I(t,"shadowOffsetY",i.textShadowOffsetY||0),b+=d/2;var M=i.textStrokeWidth,L=C(i.textStroke,M),P=R(i.textFill);L&&(I(t,"lineWidth",M),I(t,"strokeStyle",L)),P&&I(t,"fillStyle",P);for(var O=0;O<u.length;O++)L&&t.strokeText(u[O],y,b),P&&t.fillText(u[O],y,b),b+=d}function S(e,t,n,i,r){var a=e.__textCotentBlock;a&&!e.__dirty||(a=e.__textCotentBlock=c.parseRichText(n,i)),T(e,t,a,i,r)}function T(e,t,n,i,r){var a=n.width,s=n.outerWidth,o=n.outerHeight,l=i.textPadding,u=k(o,i,r),d=u.baseX,h=u.baseY,f=u.textAlign,p=u.textVerticalAlign;_(t,i,r,d,h);var g=c.adjustTextX(d,s,f),m=c.adjustTextY(h,o,p),v=g,y=m;l&&(v+=l[3],y+=l[0]);var b=v+a;E(i)&&x(e,t,i,g,m,s,o);for(var S=0;S<n.lines.length;S++){var T,A=n.lines[S],I=A.tokens,C=I.length,R=A.lineHeight,M=A.width,D=0,L=v,P=b,O=C-1;while(D<C&&(T=I[D],!T.textAlign||"left"===T.textAlign))w(e,t,T,i,R,y,L,"left"),M-=T.width,L+=T.width,D++;while(O>=0&&(T=I[O],"right"===T.textAlign))w(e,t,T,i,R,y,P,"right"),M-=T.width,P-=T.width,O--;L+=(a-(L-v)-(b-P)-M)/2;while(D<=O)T=I[D],w(e,t,T,i,R,y,L+T.width/2,"center"),L+=T.width,D++;y+=R}}function _(e,t,n,i,r){if(n&&t.textRotation){var a=t.textOrigin;"center"===a?(i=n.width/2+n.x,r=n.height/2+n.y):a&&(i=a[0]+n.x,r=a[1]+n.y),e.translate(i,r),e.rotate(-t.textRotation),e.translate(-i,-r)}}function w(e,t,n,i,s,o,l,u){var d=i.rich[n.styleName]||{},h=n.textVerticalAlign,f=o+s/2;"top"===h?f=o+n.height/2:"bottom"===h&&(f=o+s-n.height/2),!n.isLineHolder&&E(d)&&x(e,t,d,"right"===u?l-n.width:"center"===u?l-n.width/2:l,f-n.height/2,n.width,n.height);var p=n.textPadding;p&&(l=D(l,u,p),f-=n.height/2-p[2]-n.textHeight/2),I(t,"shadowBlur",a(d.textShadowBlur,i.textShadowBlur,0)),I(t,"shadowColor",d.textShadowColor||i.textShadowColor||"transparent"),I(t,"shadowOffsetX",a(d.textShadowOffsetX,i.textShadowOffsetX,0)),I(t,"shadowOffsetY",a(d.textShadowOffsetY,i.textShadowOffsetY,0)),I(t,"textAlign",u),I(t,"textBaseline","middle"),I(t,"font",n.font||c.DEFAULT_FONT);var g=C(d.textStroke||i.textStroke,v),m=R(d.textFill||i.textFill),v=r(d.textStrokeWidth,i.textStrokeWidth);g&&(I(t,"lineWidth",v),I(t,"strokeStyle",g),t.strokeText(n.text,l,f)),m&&(I(t,"fillStyle",m),t.fillText(n.text,l,f))}function E(e){return e.textBackgroundColor||e.textBorderWidth&&e.textBorderColor}function x(e,t,n,i,r,a,s){var o=n.textBackgroundColor,c=n.textBorderWidth,f=n.textBorderColor,p=l(o);if(I(t,"shadowBlur",n.textBoxShadowBlur||0),I(t,"shadowColor",n.textBoxShadowColor||"transparent"),I(t,"shadowOffsetX",n.textBoxShadowOffsetX||0),I(t,"shadowOffsetY",n.textBoxShadowOffsetY||0),p||c&&f){t.beginPath();var g=n.textBorderRadius;g?d.buildPath(t,{x:i,y:r,width:a,height:s,r:g}):t.rect(i,r,a,s),t.closePath()}if(p)I(t,"fillStyle",o),t.fill();else if(u(o)){var m=o.image;m=h.createOrUpdateImage(m,null,e,A,o),m&&h.isImageReady(m)&&t.drawImage(m,i,r,a,s)}c&&f&&(I(t,"lineWidth",c),I(t,"strokeStyle",f),t.stroke())}function A(e,t){t.image=e}function k(e,t,n){var i=t.x||0,r=t.y||0,a=t.textAlign,s=t.textVerticalAlign;if(n){var o=t.textPosition;if(o instanceof Array)i=n.x+M(o[0],n.width),r=n.y+M(o[1],n.height);else{var l=c.adjustTextPositionOnRect(o,n,t.textDistance);i=l.x,r=l.y,a=a||l.textAlign,s=s||l.textVerticalAlign}var u=t.textOffset;u&&(i+=u[0],r+=u[1])}return{baseX:i,baseY:r,textAlign:a,textVerticalAlign:s}}function I(e,t,n){return e[t]=f(e,t,n),e[t]}function C(e,t){return null==e||t<=0||"transparent"===e||"none"===e?null:e.image||e.colorStops?"#000":e}function R(e){return null==e||"none"===e?null:e.image||e.colorStops?"#000":e}function M(e,t){return"string"===typeof e?e.lastIndexOf("%")>=0?parseFloat(e)/100*t:parseFloat(e):e}function D(e,t,n){return"right"===t?e-n[1]:"center"===t?e+n[3]/2-n[1]/2:e+n[3]}function L(e,t){return null!=e&&(e||t.textBackgroundColor||t.textBorderWidth&&t.textBorderColor||t.textPadding)}t.normalizeTextStyle=m,t.renderText=y,t.getStroke=C,t.getFill=R,t.needDrawText=L},a96b:function(e,t,n){var i=n("3eba"),r=i.extendComponentModel({type:"tooltip",dependencies:["axisPointer"],defaultOption:{zlevel:0,z:8,show:!0,showContent:!0,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:!1,displayMode:"single",confine:!1,showDelay:0,hideDelay:100,transitionDuration:.4,enterable:!1,backgroundColor:"rgba(50,50,50,0.7)",borderColor:"#333",borderRadius:4,borderWidth:0,padding:5,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:"#999",width:1,type:"dashed",textStyle:{}}},textStyle:{color:"#fff",fontSize:14}}});e.exports=r},aa77:function(e,t,n){var i=n("5ca1"),r=n("be13"),a=n("79e5"),s=n("fdef"),o="["+s+"]",l="​",u=RegExp("^"+o+o+"*"),c=RegExp(o+o+"*$"),d=function(e,t,n){var r={},o=a(function(){return!!s[e]()||l[e]()!=l}),u=r[e]=o?t(h):s[e];n&&(r[n]=u),i(i.P+i.F*o,"String",r)},h=d.trim=function(e,t){return e=String(r(e)),1&t&&(e=e.replace(u,"")),2&t&&(e=e.replace(c,"")),e};e.exports=d},aae3:function(e,t,n){var i=n("d3f4"),r=n("2d95"),a=n("2b4c")("match");e.exports=function(e){var t;return i(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==r(e))}},ac0f:function(e,t,n){var i=n("cbe5"),r=n("401b"),a=n("4a3f"),s=a.quadraticSubdivide,o=a.cubicSubdivide,l=a.quadraticAt,u=a.cubicAt,c=a.quadraticDerivativeAt,d=a.cubicDerivativeAt,h=[];function f(e,t,n){var i=e.cpx2,r=e.cpy2;return null===i||null===r?[(n?d:u)(e.x1,e.cpx1,e.cpx2,e.x2,t),(n?d:u)(e.y1,e.cpy1,e.cpy2,e.y2,t)]:[(n?c:l)(e.x1,e.cpx1,e.x2,t),(n?c:l)(e.y1,e.cpy1,e.y2,t)]}var p=i.extend({type:"bezier-curve",shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(e,t){var n=t.x1,i=t.y1,r=t.x2,a=t.y2,l=t.cpx1,u=t.cpy1,c=t.cpx2,d=t.cpy2,f=t.percent;0!==f&&(e.moveTo(n,i),null==c||null==d?(f<1&&(s(n,l,r,f,h),l=h[1],r=h[2],s(i,u,a,f,h),u=h[1],a=h[2]),e.quadraticCurveTo(l,u,r,a)):(f<1&&(o(n,l,c,r,f,h),l=h[1],c=h[2],r=h[3],o(i,u,d,a,f,h),u=h[1],d=h[2],a=h[3]),e.bezierCurveTo(l,u,c,d,r,a)))},pointAt:function(e){return f(this.shape,e,!1)},tangentAt:function(e){var t=f(this.shape,e,!0);return r.normalize(t,t)}});e.exports=p},ac6a:function(e,t,n){for(var i=n("cadf"),r=n("0d58"),a=n("2aba"),s=n("7726"),o=n("32e9"),l=n("84f2"),u=n("2b4c"),c=u("iterator"),d=u("toStringTag"),h=l.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=r(f),g=0;g<p.length;g++){var m,v=p[g],y=f[v],b=s[v],S=b&&b.prototype;if(S&&(S[c]||o(S,c,h),S[d]||o(S,d,v),l[v]=h,y))for(m in i)S[m]||a(S,m,i[m],!0)}},aef6:function(e,t,n){"use strict";var i=n("5ca1"),r=n("9def"),a=n("d2c8"),s="endsWith",o=""[s];i(i.P+i.F*n("5147")(s),"String",{endsWith:function(e){var t=a(this,e,s),n=arguments.length>1?arguments[1]:void 0,i=r(t.length),l=void 0===n?i:Math.min(r(n),i),u=String(e);return o?o.call(t,u,l):t.slice(l-u.length,l)===u}})},af24:function(e,t,n){n("48c7"),n("f273")},afa0:function(e,t,n){var i=n("6d8b"),r=n("22d1"),a=n("e1fc"),s=n("04f6");function o(e,t){return e.zlevel===t.zlevel?e.z===t.z?e.z2-t.z2:e.z-t.z:e.zlevel-t.zlevel}var l=function(){this._roots=[],this._displayList=[],this._displayListLen=0};l.prototype={constructor:l,traverse:function(e,t){for(var n=0;n<this._roots.length;n++)this._roots[n].traverse(e,t)},getDisplayList:function(e,t){return t=t||!1,e&&this.updateDisplayList(t),this._displayList},updateDisplayList:function(e){this._displayListLen=0;for(var t=this._roots,n=this._displayList,i=0,a=t.length;i<a;i++)this._updateAndAddDisplayable(t[i],null,e);n.length=this._displayListLen,r.canvasSupported&&s(n,o)},_updateAndAddDisplayable:function(e,t,n){if(!e.ignore||n){e.beforeUpdate(),e.__dirty&&e.update(),e.afterUpdate();var i=e.clipPath;if(i){t=t?t.slice():[];var r=i,a=e;while(r)r.parent=a,r.updateTransform(),t.push(r),a=r,r=r.clipPath}if(e.isGroup){for(var s=e._children,o=0;o<s.length;o++){var l=s[o];e.__dirty&&(l.__dirty=!0),this._updateAndAddDisplayable(l,t,n)}e.__dirty=!1}else e.__clipPaths=t,this._displayList[this._displayListLen++]=e}},addRoot:function(e){e.__storage!==this&&(e instanceof a&&e.addChildrenToStorage(this),this.addToStorage(e),this._roots.push(e))},delRoot:function(e){if(null==e){for(var t=0;t<this._roots.length;t++){var n=this._roots[t];n instanceof a&&n.delChildrenFromStorage(this)}return this._roots=[],this._displayList=[],void(this._displayListLen=0)}if(e instanceof Array){t=0;for(var r=e.length;t<r;t++)this.delRoot(e[t])}else{var s=i.indexOf(this._roots,e);s>=0&&(this.delFromStorage(e),this._roots.splice(s,1),e instanceof a&&e.delChildrenFromStorage(this))}},addToStorage:function(e){return e&&(e.__storage=this,e.dirty(!1)),this},delFromStorage:function(e){return e&&(e.__storage=null),this},dispose:function(){this._renderList=this._roots=null},displayableSortFunc:o};var u=l;e.exports=u},b11c:function(e,t,n){n("8ec5"),n("db9e"),n("4e9f"),n("d3a0"),n("767c"),n("7c4d"),n("df70")},b12f:function(e,t,n){var i=n("e1fc"),r=n("8918"),a=n("625e"),s=function(){this.group=new i,this.uid=r.getUID("viewComponent")};s.prototype={constructor:s,init:function(e,t){},render:function(e,t,n,i){},dispose:function(){}};var o=s.prototype;o.updateView=o.updateLayout=o.updateVisual=function(e,t,n,i){},a.enableClassExtend(s),a.enableClassManagement(s,{registerWhenExtend:!0});var l=s;e.exports=l},b1d4:function(e,t,n){var i=n("862d");function r(e,t){return t=t||{},i(t.coordDimensions||[],e,{dimsDef:t.dimensionsDefine||e.dimensionsDefine,encodeDef:t.encodeDefine||e.encodeDefine,dimCount:t.dimensionsCount,generateCoord:t.generateCoord,generateCoordCount:t.generateCoordCount})}e.exports=r},b5c7:function(e,t,n){var i=n("282b"),r=i([["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["stroke","barBorderColor"],["lineWidth","barBorderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),a={getBarItemStyle:function(e){var t=r(this,e);if(this.getBorderLineDash){var n=this.getBorderLineDash();n&&(t.lineDash=n)}return t}};e.exports=a},b719:function(e,t,n){var i=n("697e7");t.zrender=i;var r=n("1687");t.matrix=r;var a=n("401b");t.vector=a;var s=n("6d8b"),o=n("41ef");t.color=o;var l=n("2306");t.graphic=l;var u=n("3842");t.number=u;var c=n("eda2");t.format=c;var d=n("88b3");d.throttle;t.throttle=d.throttle;var h=n("1548");t.helper=h;var f=n("bda7");t.parseGeoJSON=f;var p=n("6179");t.List=p;var g=n("4319");t.Model=g;var m=n("84ce");t.Axis=m;var v=n("22d1");t.env=v;var y=f,b={};s.each(["map","each","filter","indexOf","inherits","reduce","filter","bind","curry","isArray","isString","isObject","isFunction","extend","defaults","clone","merge"],function(e){b[e]=s[e]}),t.parseGeoJson=y,t.util=b},b809:function(e,t,n){var i=n("6d8b"),r=n("29a8"),a=n("2b17"),s=a.retrieveRawValue;function o(e,t){var n=t.getModel("aria");if(n.get("show"))if(n.get("description"))e.setAttribute("aria-label",n.get("description"));else{var a=0;t.eachSeries(function(e,t){++a},this);var o,l=n.get("data.maxCount")||10,u=n.get("series.maxCount")||10,c=Math.min(a,u);if(!(a<1)){var d=m();o=d?p(g("general.withTitle"),{title:d}):g("general.withoutTitle");var h=[],f=a>1?"series.multiple.prefix":"series.single.prefix";o+=p(g(f),{seriesCount:a}),t.eachSeries(function(e,t){if(t<c){var n,i=e.get("name"),r="series."+(a>1?"multiple":"single")+".";n=g(i?r+"withName":r+"withoutName"),n=p(n,{seriesId:e.seriesIndex,seriesName:e.get("name"),seriesType:v(e.subType)});var o=e.getData();window.data=o,o.count()>l?n+=p(g("data.partialData"),{displayCnt:l}):n+=g("data.allData");for(var u=[],d=0;d<o.count();d++)if(d<l){var f=o.getName(d),m=s(o,d);u.push(p(g(f?"data.withName":"data.withoutName"),{name:f,value:m}))}n+=u.join(g("data.separator.middle"))+g("data.separator.end"),h.push(n)}}),o+=h.join(g("series.multiple.separator.middle"))+g("series.multiple.separator.end"),e.setAttribute("aria-label",o)}}function p(e,t){if("string"!==typeof e)return e;var n=e;return i.each(t,function(e,t){n=n.replace(new RegExp("\\{\\s*"+t+"\\s*\\}","g"),e)}),n}function g(e){var t=n.get(e);if(null==t){for(var i=e.split("."),a=r.aria,s=0;s<i.length;++s)a=a[i[s]];return a}return t}function m(){var e=t.getModel("title").option;return e&&e.length&&(e=e[0]),e&&e.text}function v(e){return r.series.typeNames[e]||"自定义图"}}e.exports=o},bcaa:function(e,t,n){var i=n("cb7c"),r=n("d3f4"),a=n("a5b8");e.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var n=a.f(e),s=n.resolve;return s(t),n.promise}},bd6b:function(e,t,n){var i=n("06ad"),r=n("4942"),a=n("6d8b"),s=a.isString,o=a.isFunction,l=a.isObject,u=a.isArrayLike,c=a.indexOf,d=function(){this.animators=[]};d.prototype={constructor:d,animate:function(e,t){var n,a=!1,s=this,o=this.__zr;if(e){var l=e.split("."),u=s;a="shape"===l[0];for(var d=0,h=l.length;d<h;d++)u&&(u=u[l[d]]);u&&(n=u)}else n=s;if(n){var f=s.animators,p=new i(n,t);return p.during(function(e){s.dirty(a)}).done(function(){f.splice(c(f,p),1)}),f.push(p),o&&o.animation.addAnimator(p),p}r('Property "'+e+'" is not existed in element '+s.id)},stopAnimation:function(e){for(var t=this.animators,n=t.length,i=0;i<n;i++)t[i].stop(e);return t.length=0,this},animateTo:function(e,t,n,i,r,a){s(n)?(r=i,i=n,n=0):o(i)?(r=i,i="linear",n=0):o(n)?(r=n,n=0):o(t)?(r=t,t=500):t||(t=500),this.stopAnimation(),this._animateToShallow("",this,e,t,n);var l=this.animators.slice(),u=l.length;function c(){u--,u||r&&r()}u||r&&r();for(var d=0;d<l.length;d++)l[d].done(c).start(i,a)},_animateToShallow:function(e,t,n,i,r){var a={},s=0;for(var o in n)if(n.hasOwnProperty(o))if(null!=t[o])l(n[o])&&!u(n[o])?this._animateToShallow(e?e+"."+o:o,t[o],n[o],i,r):(a[o]=n[o],s++);else if(null!=n[o])if(e){var c={};c[e]={},c[e][o]=n[o],this.attr(c)}else this.attr(o,n[o]);return s>0&&this.animate(e,!1).when(null==i?500:i,a).delay(r||0),this}};var h=d;e.exports=h},bd9e:function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=n("2306"),s=n("e0d3"),o=n("f4a2"),l=r.each,u=r.indexOf,c=r.curry,d=["dataToPoint","pointToData"],h=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"];function f(e,t,n){var i=this._targetInfoList=[],r={},a=m(t,e);l(v,function(e,t){(!n||!n.include||u(n.include,t)>=0)&&e(a,i,r)})}var p=f.prototype;function g(e){return e[0]>e[1]&&e.reverse(),e}function m(e,t){return s.parseFinder(e,t,{includeMainTypes:h})}p.setOutputRanges=function(e,t){this.matchOutputRanges(e,t,function(e,t,n){if((e.coordRanges||(e.coordRanges=[])).push(t),!e.coordRange){e.coordRange=t;var i=S[e.brushType](0,n,t);e.__rangeOffset={offset:_[e.brushType](i.values,e.range,[1,1]),xyMinMax:i.xyMinMax}}})},p.matchOutputRanges=function(e,t,n){l(e,function(e){var i=this.findTargetInfo(e,t);i&&!0!==i&&r.each(i.coordSyses,function(i){var r=S[e.brushType](1,i,e.range);n(e,r.values,i,t)})},this)},p.setInputRanges=function(e,t){l(e,function(e){var n=this.findTargetInfo(e,t);if(e.range=e.range||[],n&&!0!==n){e.panelId=n.panelId;var i=S[e.brushType](0,n.coordSys,e.coordRange),r=e.__rangeOffset;e.range=r?_[e.brushType](i.values,r.offset,E(i.xyMinMax,r.xyMinMax)):i.values}},this)},p.makePanelOpts=function(e,t){return r.map(this._targetInfoList,function(n){var i=n.getPanelRect();return{panelId:n.panelId,defaultBrushType:t&&t(n),clipPath:o.makeRectPanelClipPath(i),isTargetByCursor:o.makeRectIsTargetByCursor(i,e,n.coordSysModel),getLinearBrushOtherExtent:o.makeLinearBrushOtherExtent(i)}})},p.controlSeries=function(e,t,n){var i=this.findTargetInfo(e,n);return!0===i||i&&u(i.coordSyses,t.coordinateSystem)>=0},p.findTargetInfo=function(e,t){for(var n=this._targetInfoList,i=m(t,e),r=0;r<n.length;r++){var a=n[r],s=e.panelId;if(s){if(a.panelId===s)return a}else for(r=0;r<y.length;r++)if(y[r](i,a))return a}return!0};var v={grid:function(e,t){var n=e.xAxisModels,i=e.yAxisModels,a=e.gridModels,s=r.createHashMap(),o={},c={};(n||i||a)&&(l(n,function(e){var t=e.axis.grid.model;s.set(t.id,t),o[t.id]=!0}),l(i,function(e){var t=e.axis.grid.model;s.set(t.id,t),c[t.id]=!0}),l(a,function(e){s.set(e.id,e),o[e.id]=!0,c[e.id]=!0}),s.each(function(e){var r=e.coordinateSystem,a=[];l(r.getCartesians(),function(e,t){(u(n,e.getAxis("x").model)>=0||u(i,e.getAxis("y").model)>=0)&&a.push(e)}),t.push({panelId:"grid--"+e.id,gridModel:e,coordSysModel:e,coordSys:a[0],coordSyses:a,getPanelRect:b.grid,xAxisDeclared:o[e.id],yAxisDeclared:c[e.id]})}))},geo:function(e,t){l(e.geoModels,function(e){var n=e.coordinateSystem;t.push({panelId:"geo--"+e.id,geoModel:e,coordSysModel:e,coordSys:n,coordSyses:[n],getPanelRect:b.geo})})}},y=[function(e,t){var n=e.xAxisModel,i=e.yAxisModel,r=e.gridModel;return!r&&n&&(r=n.axis.grid.model),!r&&i&&(r=i.axis.grid.model),r&&r===t.gridModel},function(e,t){var n=e.geoModel;return n&&n===t.geoModel}],b={grid:function(){return this.coordSys.grid.getRect().clone()},geo:function(){var e=this.coordSys,t=e.getBoundingRect().clone();return t.applyTransform(a.getTransform(e)),t}},S={lineX:c(T,0),lineY:c(T,1),rect:function(e,t,n){var i=t[d[e]]([n[0][0],n[1][0]]),r=t[d[e]]([n[0][1],n[1][1]]),a=[g([i[0],r[0]]),g([i[1],r[1]])];return{values:a,xyMinMax:a}},polygon:function(e,t,n){var i=[[1/0,-1/0],[1/0,-1/0]],a=r.map(n,function(n){var r=t[d[e]](n);return i[0][0]=Math.min(i[0][0],r[0]),i[1][0]=Math.min(i[1][0],r[1]),i[0][1]=Math.max(i[0][1],r[0]),i[1][1]=Math.max(i[1][1],r[1]),r});return{values:a,xyMinMax:i}}};function T(e,t,n,i){var a=n.getAxis(["x","y"][e]),s=g(r.map([0,1],function(e){return t?a.coordToData(a.toLocalCoord(i[e])):a.toGlobalCoord(a.dataToCoord(i[e]))})),o=[];return o[e]=s,o[1-e]=[NaN,NaN],{values:s,xyMinMax:o}}var _={lineX:c(w,0),lineY:c(w,1),rect:function(e,t,n){return[[e[0][0]-n[0]*t[0][0],e[0][1]-n[0]*t[0][1]],[e[1][0]-n[1]*t[1][0],e[1][1]-n[1]*t[1][1]]]},polygon:function(e,t,n){return r.map(e,function(e,i){return[e[0]-n[0]*t[i][0],e[1]-n[1]*t[i][1]]})}};function w(e,t,n,i){return[t[0]-i[e]*n[0],t[1]-i[e]*n[1]]}function E(e,t){var n=x(e),i=x(t),r=[n[0]/i[0],n[1]/i[1]];return isNaN(r[0])&&(r[0]=1),isNaN(r[1])&&(r[1]=1),r}function x(e){return e?[e[0][1]-e[0][0],e[1][1]-e[1][0]]:[NaN,NaN]}var A=f;e.exports=A},bda7:function(e,t,n){var i=n("6d8b"),r=n("f279");function a(e){if(!e.UTF8Encoding)return e;var t=e.UTF8Scale;null==t&&(t=1024);for(var n=e.features,i=0;i<n.length;i++)for(var r=n[i],a=r.geometry,o=a.coordinates,l=a.encodeOffsets,u=0;u<o.length;u++){var c=o[u];if("Polygon"===a.type)o[u]=s(c,l[u],t);else if("MultiPolygon"===a.type)for(var d=0;d<c.length;d++){var h=c[d];c[d]=s(h,l[u][d],t)}}return e.UTF8Encoding=!1,e}function s(e,t,n){for(var i=[],r=t[0],a=t[1],s=0;s<e.length;s+=2){var o=e.charCodeAt(s)-64,l=e.charCodeAt(s+1)-64;o=o>>1^-(1&o),l=l>>1^-(1&l),o+=r,l+=a,r=o,a=l,i.push([o/n,l/n])}return i}function o(e){return a(e),i.map(i.filter(e.features,function(e){return e.geometry&&e.properties&&e.geometry.coordinates.length>0}),function(e){var t=e.properties,n=e.geometry,a=n.coordinates,s=[];"Polygon"===n.type&&s.push({type:"polygon",exterior:a[0],interiors:a.slice(1)}),"MultiPolygon"===n.type&&i.each(a,function(e){e[0]&&s.push({type:"polygon",exterior:e[0],interiors:e.slice(1)})});var o=new r(t.name,s,t.cp);return o.properties=t,o})}e.exports=o},be13:function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},c366:function(e,t,n){var i=n("6821"),r=n("9def"),a=n("77f1");e.exports=function(e){return function(t,n,s){var o,l=i(t),u=r(l.length),c=a(s,u);if(e&&n!=n){while(u>c)if(o=l[c++],o!=o)return!0}else for(;u>c;c++)if((e||c in l)&&l[c]===n)return e||c||0;return!e&&-1}}},c526:function(e,t){var n={axisPointer:1,tooltip:1,brush:1};function i(e,t,i){var r=t.getComponentByElement(e.topTarget),a=r&&r.coordinateSystem;return r&&r!==i&&!n[r.mainType]&&a&&a.model!==i}t.onIrrelevantElement=i},c533:function(e,t){var n=["#37A2DA","#32C5E9","#67E0E3","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#E062AE","#E690D1","#e7bcf3","#9d96f5","#8378EA","#96BFFF"],i={color:n,colorLayer:[["#37A2DA","#ffd85c","#fd7b5f"],["#37A2DA","#67E0E3","#FFDB5C","#ff9f7f","#E062AE","#9d96f5"],["#37A2DA","#32C5E9","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#e7bcf3","#8378EA","#96BFFF"],n]};e.exports=i},c5f6:function(e,t,n){"use strict";var i=n("7726"),r=n("69a8"),a=n("2d95"),s=n("5dbc"),o=n("6a99"),l=n("79e5"),u=n("9093").f,c=n("11e9").f,d=n("86cc").f,h=n("aa77").trim,f="Number",p=i[f],g=p,m=p.prototype,v=a(n("2aeb")(m))==f,y="trim"in String.prototype,b=function(e){var t=o(e,!1);if("string"==typeof t&&t.length>2){t=y?t.trim():h(t,3);var n,i,r,a=t.charCodeAt(0);if(43===a||45===a){if(n=t.charCodeAt(2),88===n||120===n)return NaN}else if(48===a){switch(t.charCodeAt(1)){case 66:case 98:i=2,r=49;break;case 79:case 111:i=8,r=55;break;default:return+t}for(var s,l=t.slice(2),u=0,c=l.length;u<c;u++)if(s=l.charCodeAt(u),s<48||s>r)return NaN;return parseInt(l,i)}}return+t};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof p&&(v?l(function(){m.valueOf.call(n)}):a(n)!=f)?s(new g(b(t)),n,p):b(t)};for(var S,T=n("9e1e")?u(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),_=0;T.length>_;_++)r(g,S=T[_])&&!r(p,S)&&d(p,S,c(g,S));p.prototype=m,m.constructor=p,n("2aba")(i,f,p)}},c69a:function(e,t,n){e.exports=!n("9e1e")&&!n("79e5")(function(){return 7!=Object.defineProperty(n("230e")("div"),"a",{get:function(){return 7}}).a})},c775:function(e,t,n){var i=n("2b17"),r=i.retrieveRawValue;function a(e,t){var n=e.mapDimension("defaultedLabel",!0),i=n.length;if(1===i)return r(e,t,n[0]);if(i){for(var a=[],s=0;s<n.length;s++){var o=r(e,t,n[s]);a.push(o)}return a.join(" ")}}t.getDefaultLabel=a},c7a2:function(e,t,n){var i=n("cbe5"),r=n("5693"),a=i.extend({type:"rect",shape:{r:0,x:0,y:0,width:0,height:0},buildPath:function(e,t){var n=t.x,i=t.y,a=t.width,s=t.height;t.r?r.buildPath(e,t):e.rect(n,i,a,s),e.closePath()}});e.exports=a},c8ba:function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"===typeof window&&(n=window)}e.exports=n},ca5a:function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},ca98:function(e,t,n){var i=n("6d8b"),r=n("e0d3"),a=n("6cb7"),s=i.each,o=i.clone,l=i.map,u=i.merge,c=/^(min|max)?(.+)$/;function d(e){this._api=e,this._timelineOptions=[],this._mediaList=[],this._mediaDefault,this._currentMediaIndices=[],this._optionBackup,this._newBaseOption}function h(e,t,n){var r,a,o=[],l=[],u=e.timeline;if(e.baseOption&&(a=e.baseOption),(u||e.options)&&(a=a||{},o=(e.options||[]).slice()),e.media){a=a||{};var c=e.media;s(c,function(e){e&&e.option&&(e.query?l.push(e):r||(r=e))})}return a||(a=e),a.timeline||(a.timeline=u),s([a].concat(o).concat(i.map(l,function(e){return e.option})),function(e){s(t,function(t){t(e,n)})}),{baseOption:a,timelineOptions:o,mediaDefault:r,mediaList:l}}function f(e,t,n){var r={width:t,height:n,aspectratio:t/n},a=!0;return i.each(e,function(e,t){var n=t.match(c);if(n&&n[1]&&n[2]){var i=n[1],s=n[2].toLowerCase();p(r[s],e,i)||(a=!1)}}),a}function p(e,t,n){return"min"===n?e>=t:"max"===n?e<=t:e===t}function g(e,t){return e.join(",")===t.join(",")}function m(e,t){t=t||{},s(t,function(t,n){if(null!=t){var i=e[n];if(a.hasClass(n)){t=r.normalizeToArray(t),i=r.normalizeToArray(i);var s=r.mappingToExists(i,t);e[n]=l(s,function(e){return e.option&&e.exist?u(e.exist,e.option,!0):e.exist||e.option})}else e[n]=u(i,t,!0)}})}d.prototype={constructor:d,setOption:function(e,t){e&&i.each(r.normalizeToArray(e.series),function(e){e&&e.data&&i.isTypedArray(e.data)&&i.setAsPrimitive(e.data)}),e=o(e,!0);var n=this._optionBackup,a=h.call(this,e,t,!n);this._newBaseOption=a.baseOption,n?(m(n.baseOption,a.baseOption),a.timelineOptions.length&&(n.timelineOptions=a.timelineOptions),a.mediaList.length&&(n.mediaList=a.mediaList),a.mediaDefault&&(n.mediaDefault=a.mediaDefault)):this._optionBackup=a},mountOption:function(e){var t=this._optionBackup;return this._timelineOptions=l(t.timelineOptions,o),this._mediaList=l(t.mediaList,o),this._mediaDefault=o(t.mediaDefault),this._currentMediaIndices=[],o(e?t.baseOption:this._newBaseOption)},getTimelineOption:function(e){var t,n=this._timelineOptions;if(n.length){var i=e.getComponent("timeline");i&&(t=o(n[i.getCurrentIndex()],!0))}return t},getMediaOption:function(e){var t=this._api.getWidth(),n=this._api.getHeight(),i=this._mediaList,r=this._mediaDefault,a=[],s=[];if(!i.length&&!r)return s;for(var u=0,c=i.length;u<c;u++)f(i[u].query,t,n)&&a.push(u);return!a.length&&r&&(a=[-1]),a.length&&!g(a,this._currentMediaIndices)&&(s=l(a,function(e){return o(-1===e?r.option:i[e].option)})),this._currentMediaIndices=a,s}};var v=d;e.exports=v},cadf:function(e,t,n){"use strict";var i=n("9c6c"),r=n("d53b"),a=n("84f2"),s=n("6821");e.exports=n("01f9")(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,r(1)):r(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),a.Arguments=a.Array,i("keys"),i("values"),i("entries")},cb0c:function(e,t,n){"use strict";function i(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var a=e.apply(t,n);function s(e,t){try{var n=a[e](t),s=n.value}catch(e){return void r(e)}n.done?i(s):Promise.resolve(s).then(o,l)}function o(e){s("next",e)}function l(e){s("throw",e)}o()})}}n.d(t,"a",function(){return i})},cb11:function(e,t,n){var i=n("cbe5"),r=i.extend({type:"line",shape:{x1:0,y1:0,x2:0,y2:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(e,t){var n=t.x1,i=t.y1,r=t.x2,a=t.y2,s=t.percent;0!==s&&(e.moveTo(n,i),s<1&&(r=n*(1-s)+r*s,a=i*(1-s)+a*s),e.lineTo(r,a))},pointAt:function(e){var t=this.shape;return[t.x1*(1-e)+t.x2*e,t.y1*(1-e)+t.y2*e]}});e.exports=r},cb6d:function(e,t){function n(){this.on("mousedown",this._dragStart,this),this.on("mousemove",this._drag,this),this.on("mouseup",this._dragEnd,this),this.on("globalout",this._dragEnd,this)}function i(e,t){return{target:e,topTarget:t&&t.topTarget}}n.prototype={constructor:n,_dragStart:function(e){var t=e.target;t&&t.draggable&&(this._draggingTarget=t,t.dragging=!0,this._x=e.offsetX,this._y=e.offsetY,this.dispatchToElement(i(t,e),"dragstart",e.event))},_drag:function(e){var t=this._draggingTarget;if(t){var n=e.offsetX,r=e.offsetY,a=n-this._x,s=r-this._y;this._x=n,this._y=r,t.drift(a,s,e),this.dispatchToElement(i(t,e),"drag",e.event);var o=this.findHover(n,r,t).target,l=this._dropTarget;this._dropTarget=o,t!==o&&(l&&o!==l&&this.dispatchToElement(i(l,e),"dragleave",e.event),o&&o!==l&&this.dispatchToElement(i(o,e),"dragenter",e.event))}},_dragEnd:function(e){var t=this._draggingTarget;t&&(t.dragging=!1),this.dispatchToElement(i(t,e),"dragend",e.event),this._dropTarget&&this.dispatchToElement(i(this._dropTarget,e),"drop",e.event),this._draggingTarget=null,this._dropTarget=null}};var r=n;e.exports=r},cb7c:function(e,t,n){var i=n("d3f4");e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},cb8f:function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("cd33"),s=n("eb6b");n("48ac"),n("d4b1"),n("4a9d"),i.registerPreprocessor(function(e){if(e){(!e.axisPointer||0===e.axisPointer.length)&&(e.axisPointer={});var t=e.axisPointer.link;t&&!r.isArray(t)&&(e.axisPointer.link=[t])}}),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,function(e,t){e.getComponent("axisPointer").coordSysAxesInfo=a.collect(e,t)}),i.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},s)},cbe5:function(e,t,n){var i=n("19eb"),r=n("6d8b"),a=n("20c8"),s=n("d833"),o=n("dc2f"),l=o.prototype.getCanvasPattern,u=Math.abs,c=new a(!0);function d(e){i.call(this,e),this.path=null}d.prototype={constructor:d,type:"path",__dirtyPath:!0,strokeContainThreshold:5,brush:function(e,t){var n,i=this.style,r=this.path||c,a=i.hasStroke(),s=i.hasFill(),o=i.fill,u=i.stroke,d=s&&!!o.colorStops,h=a&&!!u.colorStops,f=s&&!!o.image,p=a&&!!u.image;(i.bind(e,this,t),this.setTransform(e),this.__dirty)&&(d&&(n=n||this.getBoundingRect(),this._fillGradient=i.getGradient(e,o,n)),h&&(n=n||this.getBoundingRect(),this._strokeGradient=i.getGradient(e,u,n)));d?e.fillStyle=this._fillGradient:f&&(e.fillStyle=l.call(o,e)),h?e.strokeStyle=this._strokeGradient:p&&(e.strokeStyle=l.call(u,e));var g=i.lineDash,m=i.lineDashOffset,v=!!e.setLineDash,y=this.getGlobalScale();r.setScale(y[0],y[1]),this.__dirtyPath||g&&!v&&a?(r.beginPath(e),g&&!v&&(r.setLineDash(g),r.setLineDashOffset(m)),this.buildPath(r,this.shape,!1),this.path&&(this.__dirtyPath=!1)):(e.beginPath(),this.path.rebuildPath(e)),s&&r.fill(e),g&&v&&(e.setLineDash(g),e.lineDashOffset=m),a&&r.stroke(e),g&&v&&e.setLineDash([]),null!=i.text&&(this.restoreTransform(e),this.drawRectText(e,this.getBoundingRect()))},buildPath:function(e,t,n){},createPathProxy:function(){this.path=new a},getBoundingRect:function(){var e=this._rect,t=this.style,n=!e;if(n){var i=this.path;i||(i=this.path=new a),this.__dirtyPath&&(i.beginPath(),this.buildPath(i,this.shape,!1)),e=i.getBoundingRect()}if(this._rect=e,t.hasStroke()){var r=this._rectWithStroke||(this._rectWithStroke=e.clone());if(this.__dirty||n){r.copy(e);var s=t.lineWidth,o=t.strokeNoScale?this.getLineScale():1;t.hasFill()||(s=Math.max(s,this.strokeContainThreshold||4)),o>1e-10&&(r.width+=s/o,r.height+=s/o,r.x-=s/o/2,r.y-=s/o/2)}return r}return e},contain:function(e,t){var n=this.transformCoordToLocal(e,t),i=this.getBoundingRect(),r=this.style;if(e=n[0],t=n[1],i.contain(e,t)){var a=this.path.data;if(r.hasStroke()){var o=r.lineWidth,l=r.strokeNoScale?this.getLineScale():1;if(l>1e-10&&(r.hasFill()||(o=Math.max(o,this.strokeContainThreshold)),s.containStroke(a,o/l,e,t)))return!0}if(r.hasFill())return s.contain(a,e,t)}return!1},dirty:function(e){null==e&&(e=!0),e&&(this.__dirtyPath=e,this._rect=null),this.__dirty=!0,this.__zr&&this.__zr.refresh(),this.__clipTarget&&this.__clipTarget.dirty()},animateShape:function(e){return this.animate("shape",e)},attrKV:function(e,t){"shape"===e?(this.setShape(t),this.__dirtyPath=!0,this._rect=null):i.prototype.attrKV.call(this,e,t)},setShape:function(e,t){var n=this.shape;if(n){if(r.isObject(e))for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);else n[e]=t;this.dirty(!0)}return this},getLineScale:function(){var e=this.transform;return e&&u(e[0]-1)>1e-10&&u(e[3]-1)>1e-10?Math.sqrt(u(e[0]*e[3]-e[2]*e[1])):1}},d.extend=function(e){var t=function(t){d.call(this,t),e.style&&this.style.extendFrom(e.style,!1);var n=e.shape;if(n){this.shape=this.shape||{};var i=this.shape;for(var r in n)!i.hasOwnProperty(r)&&n.hasOwnProperty(r)&&(i[r]=n[r])}e.init&&e.init.call(this,t)};for(var n in r.inherits(t,d),e)"style"!==n&&"shape"!==n&&(t.prototype[n]=e[n]);return t},r.inherits(d,i);var h=d;e.exports=h},cbe9:function(e,t,n){var i=n("6d8b"),r=n("cf7e");function a(e){r.call(this,e)}a.prototype={constructor:a,type:"cartesian2d",dimensions:["x","y"],getBaseAxis:function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")},containPoint:function(e){var t=this.getAxis("x"),n=this.getAxis("y");return t.contain(t.toLocalCoord(e[0]))&&n.contain(n.toLocalCoord(e[1]))},containData:function(e){return this.getAxis("x").containData(e[0])&&this.getAxis("y").containData(e[1])},dataToPoint:function(e,t,n){var i=this.getAxis("x"),r=this.getAxis("y");return n=n||[],n[0]=i.toGlobalCoord(i.dataToCoord(e[0])),n[1]=r.toGlobalCoord(r.dataToCoord(e[1])),n},clampData:function(e,t){var n=this.getAxis("x").scale,i=this.getAxis("y").scale,r=n.getExtent(),a=i.getExtent(),s=n.parse(e[0]),o=i.parse(e[1]);return t=t||[],t[0]=Math.min(Math.max(Math.min(r[0],r[1]),s),Math.max(r[0],r[1])),t[1]=Math.min(Math.max(Math.min(a[0],a[1]),o),Math.max(a[0],a[1])),t},pointToData:function(e,t){var n=this.getAxis("x"),i=this.getAxis("y");return t=t||[],t[0]=n.coordToData(n.toLocalCoord(e[0])),t[1]=i.coordToData(i.toLocalCoord(e[1])),t},getOtherAxis:function(e){return this.getAxis("x"===e.dim?"y":"x")}},i.inherits(a,r);var s=a;e.exports=s},cc39:function(e,t,n){var i=n("6d8b"),r=n("3842"),a=n("50e5"),s=i.each,o=r.asc,l=function(e,t,n,i){this._dimName=e,this._axisIndex=t,this._valueWindow,this._percentWindow,this._dataExtent,this._minMaxSpan,this.ecModel=i,this._dataZoomModel=n};function u(e,t,n){var i=[1/0,-1/0];return s(n,function(e){var n=e.getData();n&&s(n.mapDimension(t,!0),function(e){var t=n.getApproximateExtent(e);t[0]<i[0]&&(i[0]=t[0]),t[1]>i[1]&&(i[1]=t[1])})}),i[1]<i[0]&&(i=[NaN,NaN]),c(e,i),i}function c(e,t){var n=e.getAxisModel(),i=n.getMin(!0),r="category"===n.get("type"),a=r&&n.getCategories().length;null!=i&&"dataMin"!==i&&"function"!==typeof i?t[0]=i:r&&(t[0]=a>0?0:NaN);var s=n.getMax(!0);return null!=s&&"dataMax"!==s&&"function"!==typeof s?t[1]=s:r&&(t[1]=a>0?a-1:NaN),n.get("scale",!0)||(t[0]>0&&(t[0]=0),t[1]<0&&(t[1]=0)),t}function d(e,t){var n=e.getAxisModel(),i=e._percentWindow,a=e._valueWindow;if(i){var s=r.getPixelPrecision(a,[0,500]);s=Math.min(s,20);var o=t||0===i[0]&&100===i[1];n.setRange(o?null:+a[0].toFixed(s),o?null:+a[1].toFixed(s))}}function h(e){var t=e._minMaxSpan={},n=e._dataZoomModel;s(["min","max"],function(i){t[i+"Span"]=n.get(i+"Span");var a=n.get(i+"ValueSpan");if(null!=a&&(t[i+"ValueSpan"]=a,a=e.getAxisModel().axis.scale.parse(a),null!=a)){var s=e._dataExtent;t[i+"Span"]=r.linearMap(s[0]+a,s,[0,100],!0)}})}l.prototype={constructor:l,hostedBy:function(e){return this._dataZoomModel===e},getDataValueWindow:function(){return this._valueWindow.slice()},getDataPercentWindow:function(){return this._percentWindow.slice()},getTargetSeriesModels:function(){var e=[],t=this.ecModel;return t.eachSeries(function(n){if(a.isCoordSupported(n.get("coordinateSystem"))){var i=this._dimName,r=t.queryComponents({mainType:i+"Axis",index:n.get(i+"AxisIndex"),id:n.get(i+"AxisId")})[0];this._axisIndex===(r&&r.componentIndex)&&e.push(n)}},this),e},getAxisModel:function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},getOtherAxisModel:function(){var e,t,n,i=this._dimName,r=this.ecModel,a=this.getAxisModel(),s="x"===i||"y"===i;return s?(t="gridIndex",e="x"===i?"y":"x"):(t="polarIndex",e="angle"===i?"radius":"angle"),r.eachComponent(e+"Axis",function(e){(e.get(t)||0)===(a.get(t)||0)&&(n=e)}),n},getMinMaxSpan:function(){return i.clone(this._minMaxSpan)},calculateDataWindow:function(e){var t=this._dataExtent,n=this.getAxisModel(),i=n.axis.scale,a=this._dataZoomModel.getRangePropMode(),l=[0,100],u=[e.start,e.end],c=[];return s(["startValue","endValue"],function(t){c.push(null!=e[t]?i.parse(e[t]):null)}),s([0,1],function(e){var n=c[e],s=u[e];"percent"===a[e]?(null==s&&(s=l[e]),n=i.parse(r.linearMap(s,l,t,!0))):s=r.linearMap(n,t,l,!0),c[e]=n,u[e]=s}),{valueWindow:o(c),percentWindow:o(u)}},reset:function(e){if(e===this._dataZoomModel){var t=this.getTargetSeriesModels();this._dataExtent=u(this,this._dimName,t);var n=this.calculateDataWindow(e.option);this._valueWindow=n.valueWindow,this._percentWindow=n.percentWindow,h(this),d(this)}},restore:function(e){e===this._dataZoomModel&&(this._valueWindow=this._percentWindow=null,d(this,!0))},filterData:function(e,t){if(e===this._dataZoomModel){var n=this._dimName,i=this.getTargetSeriesModels(),r=e.get("filterMode"),a=this._valueWindow;"none"!==r&&s(i,function(e){var t=e.getData(),i=t.mapDimension(n,!0);"weakFilter"===r?t.filterSelf(function(e){for(var n,r,s,o=0;o<i.length;o++){var l=t.get(i[o],e),u=!isNaN(l),c=l<a[0],d=l>a[1];if(u&&!c&&!d)return!0;u&&(s=!0),c&&(n=!0),d&&(r=!0)}return s&&n&&r}):s(i,function(n){if("empty"===r)e.setData(t.map(n,function(e){return o(e)?e:NaN}));else{var i={};i[n]=a,t.selectRange(i)}}),s(i,function(e){t.setApproximateExtent(a,e)})})}function o(e){return e>=a[0]&&e<=a[1]}}};var f=l;e.exports=f},cccd:function(e,t,n){var i=n("e0d3"),r=i.makeInner;function a(){var e=r();return function(t){var n=e(t),i=t.pipelineContext,r=n.large,a=n.progressiveRender,s=n.large=i.large,o=n.progressiveRender=i.progressiveRender;return!!(r^s||a^o)&&"reset"}}e.exports=a},cd33:function(e,t,n){var i=n("6d8b"),r=n("4319"),a=i.each,s=i.curry;function o(e,t){var n={axesInfo:{},seriesInvolved:!1,coordSysAxesInfo:{},coordSysMap:{}};return l(n,e,t),n.seriesInvolved&&c(n,e),n}function l(e,t,n){var i=t.getComponent("tooltip"),r=t.getComponent("axisPointer"),o=r.get("link",!0)||[],l=[];a(n.getCoordinateSystems(),function(n){if(n.axisPointerEnabled){var c=v(n.model),h=e.coordSysAxesInfo[c]={};e.coordSysMap[c]=n;var f=n.model,p=f.getModel("tooltip",i);if(a(n.getAxes(),s(S,!1,null)),n.getTooltipAxes&&i&&p.get("show")){var g="axis"===p.get("trigger"),y="cross"===p.get("axisPointer.type"),b=n.getTooltipAxes(p.get("axisPointer.axis"));(g||y)&&a(b.baseAxes,s(S,!y||"cross",g)),y&&a(b.otherAxes,s(S,"cross",!1))}}function S(i,a,s){var c=s.model.getModel("axisPointer",r),f=c.get("show");if(f&&("auto"!==f||i||m(c))){null==a&&(a=c.get("triggerTooltip")),c=i?u(s,p,r,t,i,a):c;var g=c.get("snap"),y=v(s.model),b=a||g||"category"===s.type,S=e.axesInfo[y]={key:y,axis:s,coordSys:n,axisPointerModel:c,triggerTooltip:a,involveSeries:b,snap:g,useHandle:m(c),seriesModels:[]};h[y]=S,e.seriesInvolved|=b;var T=d(o,s);if(null!=T){var _=l[T]||(l[T]={axesInfo:{}});_.axesInfo[y]=S,_.mapper=o[T].mapper,S.linkGroup=_}}}})}function u(e,t,n,s,o,l){var u=t.getModel("axisPointer"),c={};a(["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"],function(e){c[e]=i.clone(u.get(e))}),c.snap="category"!==e.type&&!!l,"cross"===u.get("type")&&(c.type="line");var d=c.label||(c.label={});if(null==d.show&&(d.show=!1),"cross"===o){var h=u.get("label.show");if(d.show=null==h||h,!l){var f=c.lineStyle=u.get("crossStyle");f&&i.defaults(d,f.textStyle)}}return e.model.getModel("axisPointer",new r(c,n,s))}function c(e,t){t.eachSeries(function(t){var n=t.coordinateSystem,i=t.get("tooltip.trigger",!0),r=t.get("tooltip.show",!0);n&&"none"!==i&&!1!==i&&"item"!==i&&!1!==r&&!1!==t.get("axisPointer.show",!0)&&a(e.coordSysAxesInfo[v(n.model)],function(e){var i=e.axis;n.getAxis(i.dim)===i&&(e.seriesModels.push(t),null==e.seriesDataCount&&(e.seriesDataCount=0),e.seriesDataCount+=t.getData().count())})},this)}function d(e,t){for(var n=t.model,i=t.dim,r=0;r<e.length;r++){var a=e[r]||{};if(h(a[i+"AxisId"],n.id)||h(a[i+"AxisIndex"],n.componentIndex)||h(a[i+"AxisName"],n.name))return r}}function h(e,t){return"all"===e||i.isArray(e)&&i.indexOf(e,t)>=0||e===t}function f(e){var t=p(e);if(t){var n=t.axisPointerModel,i=t.axis.scale,r=n.option,a=n.get("status"),s=n.get("value");null!=s&&(s=i.parse(s));var o=m(n);null==a&&(r.status=o?"show":"hide");var l=i.getExtent().slice();l[0]>l[1]&&l.reverse(),(null==s||s>l[1])&&(s=l[1]),s<l[0]&&(s=l[0]),r.value=s,o&&(r.status=t.axis.scale.isBlank()?"hide":"show")}}function p(e){var t=(e.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return t&&t.axesInfo[v(e)]}function g(e){var t=p(e);return t&&t.axisPointerModel}function m(e){return!!e.get("handle.show")}function v(e){return e.type+"||"+e.id}t.collect=o,t.fixValue=f,t.getAxisInfo=p,t.getAxisPointerModel=g,t.makeKey=v},cdaa:function(e,t,n){var i=n("607d"),r=i.addEventListener,a=i.removeEventListener,s=i.normalizeEvent,o=n("6d8b"),l=n("1fab"),u=n("22d1"),c=n("0b44"),d=300,h=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],f=["touchstart","touchend","touchmove"],p={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},g=o.map(h,function(e){var t=e.replace("mouse","pointer");return p[t]?t:e});function m(e){return"mousewheel"===e&&u.browser.firefox?"DOMMouseScroll":e}function v(e,t,n){var i=e._gestureMgr;"start"===n&&i.clear();var r=i.recognize(t,e.handler.findHover(t.zrX,t.zrY,null).target,e.dom);if("end"===n&&i.clear(),r){var a=r.type;t.gestureEvent=a,e.handler.dispatchToElement({target:r.target},a,r.event)}}function y(e){e._touching=!0,clearTimeout(e._touchTimer),e._touchTimer=setTimeout(function(){e._touching=!1},700)}var b={mousemove:function(e){e=s(this.dom,e),this.trigger("mousemove",e)},mouseout:function(e){e=s(this.dom,e);var t=e.toElement||e.relatedTarget;if(t!=this.dom)while(t&&9!=t.nodeType){if(t===this.dom)return;t=t.parentNode}this.trigger("mouseout",e)},touchstart:function(e){e=s(this.dom,e),e.zrByTouch=!0,this._lastTouchMoment=new Date,v(this,e,"start"),b.mousemove.call(this,e),b.mousedown.call(this,e),y(this)},touchmove:function(e){e=s(this.dom,e),e.zrByTouch=!0,v(this,e,"change"),b.mousemove.call(this,e),y(this)},touchend:function(e){e=s(this.dom,e),e.zrByTouch=!0,v(this,e,"end"),b.mouseup.call(this,e),+new Date-this._lastTouchMoment<d&&b.click.call(this,e),y(this)},pointerdown:function(e){b.mousedown.call(this,e)},pointermove:function(e){S(e)||b.mousemove.call(this,e)},pointerup:function(e){b.mouseup.call(this,e)},pointerout:function(e){S(e)||b.mouseout.call(this,e)}};function S(e){var t=e.pointerType;return"pen"===t||"touch"===t}function T(e){function t(e,t){return function(){if(!t._touching)return e.apply(t,arguments)}}o.each(f,function(t){e._handlers[t]=o.bind(b[t],e)}),o.each(g,function(t){e._handlers[t]=o.bind(b[t],e)}),o.each(h,function(n){e._handlers[n]=t(b[n],e)})}function _(e){function t(t,n){o.each(t,function(t){r(e,m(t),n._handlers[t])},n)}l.call(this),this.dom=e,this._touching=!1,this._touchTimer,this._gestureMgr=new c,this._handlers={},T(this),u.pointerEventsSupported?t(g,this):(u.touchEventsSupported&&t(f,this),t(h,this))}o.each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(e){b[e]=function(t){t=s(this.dom,t),this.trigger(e,t)}});var w=_.prototype;w.dispose=function(){for(var e=h.concat(f),t=0;t<e.length;t++){var n=e[t];a(this.dom,m(n),this._handlers[n])}},w.setCursor=function(e){this.dom.style&&(this.dom.style.cursor=e||"default")},o.mixin(_,l);var E=_;e.exports=E},ce10:function(e,t,n){var i=n("69a8"),r=n("6821"),a=n("c366")(!1),s=n("613b")("IE_PROTO");e.exports=function(e,t){var n,o=r(e),l=0,u=[];for(n in o)n!=s&&i(o,n)&&u.push(n);while(t.length>l)i(o,n=t[l++])&&(~a(u,n)||u.push(n));return u}},cf7e:function(e,t,n){var i=n("6d8b");function r(e){return this._axes[e]}var a=function(e){this._axes={},this._dimList=[],this.name=e||""};a.prototype={constructor:a,type:"cartesian",getAxis:function(e){return this._axes[e]},getAxes:function(){return i.map(this._dimList,r,this)},getAxesByScale:function(e){return e=e.toLowerCase(),i.filter(this.getAxes(),function(t){return t.scale.type===e})},addAxis:function(e){var t=e.dim;this._axes[t]=e,this._dimList.push(t)},dataToCoord:function(e){return this._dataCoordConvert(e,"dataToCoord")},coordToData:function(e){return this._dataCoordConvert(e,"coordToData")},_dataCoordConvert:function(e,t){for(var n=this._dimList,i=e instanceof Array?[]:{},r=0;r<n.length;r++){var a=n[r],s=this._axes[a];i[a]=s[t](e[a])}return i}};var s=a;e.exports=s},d136:function(e,t,n){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),t=t.trim(),!t){if(!n.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+a.path;u.path=s.normalizePath(d)}else u.path=o.path,a.params||(u.params=o.params,a.query||(u.query=o.query));return null===u.path&&(u.path=n.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(u)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){e=e.split("").reverse().join("").replace(r,"");while(e.length!==(e=e.replace(a,"")).length);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s})()},d15d:function(e,t,n){var i=n("6d8b"),r=i.createHashMap,a=i.each;function s(e){var t=r();e.eachSeries(function(e){var n=e.get("stack");if(n){var i=t.get(n)||t.set(n,[]),r=e.getData(),a={stackResultDimension:r.getCalculationInfo("stackResultDimension"),stackedOverDimension:r.getCalculationInfo("stackedOverDimension"),stackedDimension:r.getCalculationInfo("stackedDimension"),stackedByDimension:r.getCalculationInfo("stackedByDimension"),isStackedByIndex:r.getCalculationInfo("isStackedByIndex"),data:r,seriesModel:e};if(!a.stackedDimension||!a.isStackedByIndex&&!a.stackedByDimension)return;i.length&&r.setCalculationInfo("stackedOnSeries",i[i.length-1].seriesModel),i.push(a)}}),t.each(o)}function o(e){a(e,function(t,n){var i=[],r=[NaN,NaN],a=[t.stackResultDimension,t.stackedOverDimension],s=t.data,o=t.isStackedByIndex,l=s.map(a,function(a,l,u){var c,d,h=s.get(t.stackedDimension,u);if(isNaN(h))return r;o?d=s.getRawIndex(u):c=s.get(t.stackedByDimension,u);for(var f=NaN,p=n-1;p>=0;p--){var g=e[p];if(o||(d=g.data.rawIndexOf(g.stackedByDimension,c)),d>=0){var m=g.data.getByRawIndex(g.stackResultDimension,d);if(h>=0&&m>0||h<=0&&m<0){h+=m,f=m;break}}}return i[0]=h,i[1]=f,i});s.hostModel.setData(l),t.data=l})}e.exports=s},d28f:function(e,t,n){var i=n("3eba");n("84d5"),n("4650"),n("5e97");var r=n("903c"),a=n("6cb7");i.registerProcessor(r),a.registerSubTypeDefaulter("legend",function(){return"plain"})},d2c8:function(e,t,n){var i=n("aae3"),r=n("be13");e.exports=function(e,t,n){if(i(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(r(e))}},d2cf:function(e,t,n){var i=n("6d8b"),r=n("401b"),a=n("cb6d"),s=n("1fab"),o="silent";function l(e,t,n){return{type:e,event:n,target:t.target,topTarget:t.topTarget,cancelBubble:!1,offsetX:n.zrX,offsetY:n.zrY,gestureEvent:n.gestureEvent,pinchX:n.pinchX,pinchY:n.pinchY,pinchScale:n.pinchScale,wheelDelta:n.zrDelta,zrByTouch:n.zrByTouch,which:n.which}}function u(){}u.prototype.dispose=function(){};var c=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],d=function(e,t,n,i){s.call(this),this.storage=e,this.painter=t,this.painterRoot=i,n=n||new u,this.proxy=null,this._hovered={},this._lastTouchMoment,this._lastX,this._lastY,a.call(this),this.setHandlerProxy(n)};function h(e,t,n){if(e[e.rectHover?"rectContain":"contain"](t,n)){var i,r=e;while(r){if(r.clipPath&&!r.clipPath.contain(t,n))return!1;r.silent&&(i=!0),r=r.parent}return!i||o}return!1}d.prototype={constructor:d,setHandlerProxy:function(e){this.proxy&&this.proxy.dispose(),e&&(i.each(c,function(t){e.on&&e.on(t,this[t],this)},this),e.handler=this),this.proxy=e},mousemove:function(e){var t=e.zrX,n=e.zrY,i=this._hovered,r=i.target;r&&!r.__zr&&(i=this.findHover(i.x,i.y),r=i.target);var a=this._hovered=this.findHover(t,n),s=a.target,o=this.proxy;o.setCursor&&o.setCursor(s?s.cursor:"default"),r&&s!==r&&this.dispatchToElement(i,"mouseout",e),this.dispatchToElement(a,"mousemove",e),s&&s!==r&&this.dispatchToElement(a,"mouseover",e)},mouseout:function(e){this.dispatchToElement(this._hovered,"mouseout",e);var t,n=e.toElement||e.relatedTarget;do{n=n&&n.parentNode}while(n&&9!=n.nodeType&&!(t=n===this.painterRoot));!t&&this.trigger("globalout",{event:e})},resize:function(e){this._hovered={}},dispatch:function(e,t){var n=this[e];n&&n.call(this,t)},dispose:function(){this.proxy.dispose(),this.storage=this.proxy=this.painter=null},setCursorStyle:function(e){var t=this.proxy;t.setCursor&&t.setCursor(e)},dispatchToElement:function(e,t,n){e=e||{};var i=e.target;if(!i||!i.silent){var r="on"+t,a=l(t,e,n);while(i)if(i[r]&&(a.cancelBubble=i[r].call(i,a)),i.trigger(t,a),i=i.parent,a.cancelBubble)break;a.cancelBubble||(this.trigger(t,a),this.painter&&this.painter.eachOtherLayer(function(e){"function"==typeof e[r]&&e[r].call(e,a),e.trigger&&e.trigger(t,a)}))}},findHover:function(e,t,n){for(var i=this.storage.getDisplayList(),r={x:e,y:t},a=i.length-1;a>=0;a--){var s;if(i[a]!==n&&!i[a].ignore&&(s=h(i[a],e,t))&&(!r.topTarget&&(r.topTarget=i[a]),s!==o)){r.target=i[a];break}}return r}},i.each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(e){d.prototype[e]=function(t){var n=this.findHover(t.zrX,t.zrY),i=n.target;if("mousedown"===e)this._downEl=i,this._downPoint=[t.zrX,t.zrY],this._upEl=i;else if("mouseup"===e)this._upEl=i;else if("click"===e){if(this._downEl!==this._upEl||!this._downPoint||r.dist(this._downPoint,[t.zrX,t.zrY])>4)return;this._downPoint=null}this.dispatchToElement(n,e,t)}}),i.mixin(d,s),i.mixin(d,a);var f=d;e.exports=f},d3a0:function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("29a8"),s=n("2145"),o=a.toolbox.magicType;function l(e){this.model=e}l.defaultOption={show:!0,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z",tiled:"M2.3,2.2h22.8V25H2.3V2.2z M35,2.2h22.8V25H35V2.2zM2.3,35h22.8v22.8H2.3V35z M35,35h22.8v22.8H35V35z"},title:r.clone(o.title),option:{},seriesIndex:{}};var u=l.prototype;u.getIcons=function(){var e=this.model,t=e.get("icon"),n={};return r.each(e.get("type"),function(e){t[e]&&(n[e]=t[e])}),n};var c={line:function(e,t,n,i){if("bar"===e)return r.merge({id:t,type:"line",data:n.get("data"),stack:n.get("stack"),markPoint:n.get("markPoint"),markLine:n.get("markLine")},i.get("option.line")||{},!0)},bar:function(e,t,n,i){if("line"===e)return r.merge({id:t,type:"bar",data:n.get("data"),stack:n.get("stack"),markPoint:n.get("markPoint"),markLine:n.get("markLine")},i.get("option.bar")||{},!0)},stack:function(e,t,n,i){if("line"===e||"bar"===e)return r.merge({id:t,stack:"__ec_magicType_stack__"},i.get("option.stack")||{},!0)},tiled:function(e,t,n,i){if("line"===e||"bar"===e)return r.merge({id:t,stack:""},i.get("option.tiled")||{},!0)}},d=[["line","bar"],["stack","tiled"]];u.onclick=function(e,t,n){var i=this.model,a=i.get("seriesIndex."+n);if(c[n]){var s={series:[]},o=function(t){var a=t.subType,o=t.id,l=c[n](a,o,t,i);l&&(r.defaults(l,t.option),s.series.push(l));var u=t.coordinateSystem;if(u&&"cartesian2d"===u.type&&("line"===n||"bar"===n)){var d=u.getAxesByScale("ordinal")[0];if(d){var h=d.dim,f=h+"Axis",p=e.queryComponents({mainType:f,index:t.get(name+"Index"),id:t.get(name+"Id")})[0],g=p.componentIndex;s[f]=s[f]||[];for(var m=0;m<=g;m++)s[f][g]=s[f][g]||{};s[f][g].boundaryGap="bar"===n}}};r.each(d,function(e){r.indexOf(e,n)>=0&&r.each(e,function(e){i.setIconStatus(e,"normal")})}),i.setIconStatus(n,"emphasis"),e.eachComponent({mainType:"series",query:null==a?null:{seriesIndex:a}},o),t.dispatchAction({type:"changeMagicType",currentType:n,newOption:s})}},i.registerAction({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},function(e,t){t.mergeOption(e.newOption)}),s.register("magicType",l);var h=l;e.exports=h},d3f4:function(e,t){e.exports=function(e){return"object"===typeof e?null!==e:"function"===typeof e}},d498:function(e,t,n){var i=n("cbe5"),r=n("4fac"),a=i.extend({type:"polyline",shape:{points:null,smooth:!1,smoothConstraint:null},style:{stroke:"#000",fill:null},buildPath:function(e,t){r.buildPath(e,t,!1)}});e.exports=a},d4b1:function(e,t,n){var i=n("3eba"),r=n("17d6"),a=i.extendComponentView({type:"axisPointer",render:function(e,t,n){var i=t.getComponent("tooltip"),a=e.get("triggerOn")||i&&i.get("triggerOn")||"mousemove|click";r.register("axisPointer",n,function(e,t,n){"none"!==a&&("leave"===e||a.indexOf(e)>=0)&&n({type:"updateAxisPointer",currTrigger:e,x:t&&t.offsetX,y:t&&t.offsetY})})},remove:function(e,t){r.unregister(t.getZr(),"axisPointer"),a.superApply(this._model,"remove",arguments)},dispose:function(e,t){r.unregister("axisPointer",t),a.superApply(this._model,"dispose",arguments)}}),s=a;e.exports=s},d4c6:function(e,t,n){var i=n("cbe5"),r=i.extend({type:"compound",shape:{paths:null},_updatePathDirty:function(){for(var e=this.__dirtyPath,t=this.shape.paths,n=0;n<t.length;n++)e=e||t[n].__dirtyPath;this.__dirtyPath=e,this.__dirty=this.__dirty||e},beforeBrush:function(){this._updatePathDirty();for(var e=this.shape.paths||[],t=this.getGlobalScale(),n=0;n<e.length;n++)e[n].path||e[n].createPathProxy(),e[n].path.setScale(t[0],t[1])},buildPath:function(e,t){for(var n=t.paths||[],i=0;i<n.length;i++)n[i].buildPath(e,n[i].shape,!0)},afterBrush:function(){for(var e=this.shape.paths||[],t=0;t<e.length;t++)e[t].__dirtyPath=!1},getBoundingRect:function(){return this._updatePathDirty(),i.prototype.getBoundingRect.call(this)}});e.exports=r},d4d1:function(e,t,n){var i=n("cbe5"),r=n("401b"),a=n("897a"),s=r.min,o=r.max,l=r.scaleAndAdd,u=r.copy,c=[],d=[],h=[];function f(e){return isNaN(e[0])||isNaN(e[1])}function p(e,t,n,i,r,a,s,o,l,u,c){return"none"!==u&&u?g.apply(this,arguments):m.apply(this,arguments)}function g(e,t,n,i,r,a,s,o,l,c,p){for(var g=0,m=n,v=0;v<i;v++){var y=t[m];if(m>=r||m<0)break;if(f(y)){if(p){m+=a;continue}break}if(m===n)e[a>0?"moveTo":"lineTo"](y[0],y[1]);else if(l>0){var b=t[g],S="y"===c?1:0,T=(y[S]-b[S])*l;u(d,b),d[S]=b[S]+T,u(h,y),h[S]=y[S]-T,e.bezierCurveTo(d[0],d[1],h[0],h[1],y[0],y[1])}else e.lineTo(y[0],y[1]);g=m,m+=a}return v}function m(e,t,n,i,a,p,g,m,v,y,b){for(var S=0,T=n,_=0;_<i;_++){var w=t[T];if(T>=a||T<0)break;if(f(w)){if(b){T+=p;continue}break}if(T===n)e[p>0?"moveTo":"lineTo"](w[0],w[1]),u(d,w);else if(v>0){var E=T+p,x=t[E];if(b)while(x&&f(t[E]))E+=p,x=t[E];var A=.5,k=t[S];x=t[E];if(!x||f(x))u(h,w);else{var I,C;if(f(x)&&!b&&(x=w),r.sub(c,x,k),"x"===y||"y"===y){var R="x"===y?0:1;I=Math.abs(w[R]-k[R]),C=Math.abs(w[R]-x[R])}else I=r.dist(w,k),C=r.dist(w,x);A=C/(C+I),l(h,w,c,-v*(1-A))}s(d,d,m),o(d,d,g),s(h,h,m),o(h,h,g),e.bezierCurveTo(d[0],d[1],h[0],h[1],w[0],w[1]),l(d,w,c,v*A)}else e.lineTo(w[0],w[1]);S=T,T+=p}return _}function v(e,t){var n=[1/0,1/0],i=[-1/0,-1/0];if(t)for(var r=0;r<e.length;r++){var a=e[r];a[0]<n[0]&&(n[0]=a[0]),a[1]<n[1]&&(n[1]=a[1]),a[0]>i[0]&&(i[0]=a[0]),a[1]>i[1]&&(i[1]=a[1])}return{min:t?n:i,max:t?i:n}}var y=i.extend({type:"ec-polyline",shape:{points:[],smooth:0,smoothConstraint:!0,smoothMonotone:null,connectNulls:!1},style:{fill:null,stroke:"#000"},brush:a(i.prototype.brush),buildPath:function(e,t){var n=t.points,i=0,r=n.length,a=v(n,t.smoothConstraint);if(t.connectNulls){for(;r>0;r--)if(!f(n[r-1]))break;for(;i<r;i++)if(!f(n[i]))break}while(i<r)i+=p(e,n,i,r,r,1,a.min,a.max,t.smooth,t.smoothMonotone,t.connectNulls)+1}}),b=i.extend({type:"ec-polygon",shape:{points:[],stackedOnPoints:[],smooth:0,stackedOnSmooth:0,smoothConstraint:!0,smoothMonotone:null,connectNulls:!1},brush:a(i.prototype.brush),buildPath:function(e,t){var n=t.points,i=t.stackedOnPoints,r=0,a=n.length,s=t.smoothMonotone,o=v(n,t.smoothConstraint),l=v(i,t.smoothConstraint);if(t.connectNulls){for(;a>0;a--)if(!f(n[a-1]))break;for(;r<a;r++)if(!f(n[r]))break}while(r<a){var u=p(e,n,r,a,a,1,o.min,o.max,t.smooth,s,t.connectNulls);p(e,i,r+u-1,u,a,-1,l.min,l.max,t.stackedOnSmooth,s,t.connectNulls),r+=u+1,e.closePath()}}});t.Polyline=y,t.Polygon=b},d51b:function(e,t){var n=function(){this.head=null,this.tail=null,this._len=0},i=n.prototype;i.insert=function(e){var t=new r(e);return this.insertEntry(t),t},i.insertEntry=function(e){this.head?(this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e):this.head=this.tail=e,this._len++},i.remove=function(e){var t=e.prev,n=e.next;t?t.next=n:this.head=n,n?n.prev=t:this.tail=t,e.next=e.prev=null,this._len--},i.len=function(){return this._len},i.clear=function(){this.head=this.tail=null,this._len=0};var r=function(e){this.value=e,this.next,this.prev},a=function(e){this._list=new n,this._map={},this._maxSize=e||10,this._lastRemovedEntry=null},s=a.prototype;s.put=function(e,t){var n=this._list,i=this._map,a=null;if(null==i[e]){var s=n.len(),o=this._lastRemovedEntry;if(s>=this._maxSize&&s>0){var l=n.head;n.remove(l),delete i[l.key],a=l.value,this._lastRemovedEntry=l}o?o.value=t:o=new r(t),o.key=e,n.insertEntry(o),i[e]=o}return a},s.get=function(e){var t=this._map[e],n=this._list;if(null!=t)return t!==n.tail&&(n.remove(t),n.insertEntry(t)),t.value},s.clear=function(){this._list.clear(),this._map={}};var o=a;e.exports=o},d53b:function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},d5b7:function(e,t,n){var i=n("de00"),r=n("1fab"),a=n("0cde"),s=n("bd6b"),o=n("6d8b"),l=function(e){a.call(this,e),r.call(this,e),s.call(this,e),this.id=e.id||i()};l.prototype={type:"element",name:"",__zr:null,ignore:!1,clipPath:null,isGroup:!1,drift:function(e,t){switch(this.draggable){case"horizontal":t=0;break;case"vertical":e=0;break}var n=this.transform;n||(n=this.transform=[1,0,0,1,0,0]),n[4]+=e,n[5]+=t,this.decomposeTransform(),this.dirty(!1)},beforeUpdate:function(){},afterUpdate:function(){},update:function(){this.updateTransform()},traverse:function(e,t){},attrKV:function(e,t){if("position"===e||"scale"===e||"origin"===e){if(t){var n=this[e];n||(n=this[e]=[]),n[0]=t[0],n[1]=t[1]}}else this[e]=t},hide:function(){this.ignore=!0,this.__zr&&this.__zr.refresh()},show:function(){this.ignore=!1,this.__zr&&this.__zr.refresh()},attr:function(e,t){if("string"===typeof e)this.attrKV(e,t);else if(o.isObject(e))for(var n in e)e.hasOwnProperty(n)&&this.attrKV(n,e[n]);return this.dirty(!1),this},setClipPath:function(e){var t=this.__zr;t&&e.addSelfToZr(t),this.clipPath&&this.clipPath!==e&&this.removeClipPath(),this.clipPath=e,e.__zr=t,e.__clipTarget=this,this.dirty(!1)},removeClipPath:function(){var e=this.clipPath;e&&(e.__zr&&e.removeSelfFromZr(e.__zr),e.__zr=null,e.__clipTarget=null,this.clipPath=null,this.dirty(!1))},addSelfToZr:function(e){this.__zr=e;var t=this.animators;if(t)for(var n=0;n<t.length;n++)e.animation.addAnimator(t[n]);this.clipPath&&this.clipPath.addSelfToZr(e)},removeSelfFromZr:function(e){this.__zr=null;var t=this.animators;if(t)for(var n=0;n<t.length;n++)e.animation.removeAnimator(t[n]);this.clipPath&&this.clipPath.removeSelfFromZr(e)}},o.mixin(l,s),o.mixin(l,a),o.mixin(l,r);var u=l;e.exports=u},d708:function(e,t,n){"use strict";var i=n("01e1");const r="undefined"===typeof window&&!i["a"];t["a"]=r},d833:function(e,t,n){var i=n("20c8"),r=n("9680"),a=n("e7d2"),s=n("68ab"),o=n("9f51"),l=n("857d"),u=l.normalizeRadian,c=n("4a3f"),d=n("8728"),h=i.CMD,f=2*Math.PI,p=1e-4;function g(e,t){return Math.abs(e-t)<p}var m=[-1,-1,-1],v=[-1,-1];function y(){var e=v[0];v[0]=v[1],v[1]=e}function b(e,t,n,i,r,a,s,o,l,u){if(u>t&&u>i&&u>a&&u>o||u<t&&u<i&&u<a&&u<o)return 0;var d=c.cubicRootAt(t,i,a,o,u,m);if(0===d)return 0;for(var h,f,p=0,g=-1,b=0;b<d;b++){var S=m[b],T=0===S||1===S?.5:1,_=c.cubicAt(e,n,r,s,S);_<l||(g<0&&(g=c.cubicExtrema(t,i,a,o,v),v[1]<v[0]&&g>1&&y(),h=c.cubicAt(t,i,a,o,v[0]),g>1&&(f=c.cubicAt(t,i,a,o,v[1]))),2==g?S<v[0]?p+=h<t?T:-T:S<v[1]?p+=f<h?T:-T:p+=o<f?T:-T:S<v[0]?p+=h<t?T:-T:p+=o<h?T:-T)}return p}function S(e,t,n,i,r,a,s,o){if(o>t&&o>i&&o>a||o<t&&o<i&&o<a)return 0;var l=c.quadraticRootAt(t,i,a,o,m);if(0===l)return 0;var u=c.quadraticExtremum(t,i,a);if(u>=0&&u<=1){for(var d=0,h=c.quadraticAt(t,i,a,u),f=0;f<l;f++){var p=0===m[f]||1===m[f]?.5:1,g=c.quadraticAt(e,n,r,m[f]);g<s||(m[f]<u?d+=h<t?p:-p:d+=a<h?p:-p)}return d}p=0===m[0]||1===m[0]?.5:1,g=c.quadraticAt(e,n,r,m[0]);return g<s?0:a<t?p:-p}function T(e,t,n,i,r,a,s,o){if(o-=t,o>n||o<-n)return 0;var l=Math.sqrt(n*n-o*o);m[0]=-l,m[1]=l;var c=Math.abs(i-r);if(c<1e-4)return 0;if(c%f<1e-4){i=0,r=f;var d=a?1:-1;return s>=m[0]+e&&s<=m[1]+e?d:0}if(a){l=i;i=u(r),r=u(l)}else i=u(i),r=u(r);i>r&&(r+=f);for(var h=0,p=0;p<2;p++){var g=m[p];if(g+e>s){var v=Math.atan2(o,g);d=a?1:-1;v<0&&(v=f+v),(v>=i&&v<=r||v+f>=i&&v+f<=r)&&(v>Math.PI/2&&v<1.5*Math.PI&&(d=-d),h+=d)}}return h}function _(e,t,n,i,l){for(var u=0,c=0,f=0,p=0,m=0,v=0;v<e.length;){var y=e[v++];switch(y===h.M&&v>1&&(n||(u+=d(c,f,p,m,i,l))),1==v&&(c=e[v],f=e[v+1],p=c,m=f),y){case h.M:p=e[v++],m=e[v++],c=p,f=m;break;case h.L:if(n){if(r.containStroke(c,f,e[v],e[v+1],t,i,l))return!0}else u+=d(c,f,e[v],e[v+1],i,l)||0;c=e[v++],f=e[v++];break;case h.C:if(n){if(a.containStroke(c,f,e[v++],e[v++],e[v++],e[v++],e[v],e[v+1],t,i,l))return!0}else u+=b(c,f,e[v++],e[v++],e[v++],e[v++],e[v],e[v+1],i,l)||0;c=e[v++],f=e[v++];break;case h.Q:if(n){if(s.containStroke(c,f,e[v++],e[v++],e[v],e[v+1],t,i,l))return!0}else u+=S(c,f,e[v++],e[v++],e[v],e[v+1],i,l)||0;c=e[v++],f=e[v++];break;case h.A:var _=e[v++],w=e[v++],E=e[v++],x=e[v++],A=e[v++],k=e[v++],I=(e[v++],1-e[v++]),C=Math.cos(A)*E+_,R=Math.sin(A)*x+w;v>1?u+=d(c,f,C,R,i,l):(p=C,m=R);var M=(i-_)*x/E+_;if(n){if(o.containStroke(_,w,x,A,A+k,I,t,M,l))return!0}else u+=T(_,w,x,A,A+k,I,M,l);c=Math.cos(A+k)*E+_,f=Math.sin(A+k)*x+w;break;case h.R:p=c=e[v++],m=f=e[v++];var D=e[v++],L=e[v++];C=p+D,R=m+L;if(n){if(r.containStroke(p,m,C,m,t,i,l)||r.containStroke(C,m,C,R,t,i,l)||r.containStroke(C,R,p,R,t,i,l)||r.containStroke(p,R,p,m,t,i,l))return!0}else u+=d(C,m,C,R,i,l),u+=d(p,R,p,m,i,l);break;case h.Z:if(n){if(r.containStroke(c,f,p,m,t,i,l))return!0}else u+=d(c,f,p,m,i,l);c=p,f=m;break}}return n||g(f,m)||(u+=d(c,f,p,m,i,l)||0),0!==u}function w(e,t,n){return _(e,0,!1,t,n)}function E(e,t,n,i){return _(e,t,!0,n,i)}t.contain=w,t.containStroke=E},d8e8:function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},d9fc:function(e,t,n){var i=n("cbe5"),r=i.extend({type:"circle",shape:{cx:0,cy:0,r:0},buildPath:function(e,t,n){n&&e.moveTo(t.cx+t.r,t.cy),e.arc(t.cx,t.cy,t.r,0,2*Math.PI,!0)}});e.exports=r},db9e:function(e,t,n){var i=n("3eba"),r=n("6d8b"),a=n("e86a"),s=n("2145"),o=n("2306"),l=n("4319"),u=n("80f0"),c=n("7919"),d=i.extendComponentView({type:"toolbox",render:function(e,t,n,i){var d=this.group;if(d.removeAll(),e.get("show")){var f=+e.get("itemSize"),p=e.get("feature")||{},g=this._features||(this._features={}),m=[];r.each(p,function(e,t){m.push(t)}),new u(this._featureNames||[],m).add(v).update(v).remove(r.curry(v,null)).execute(),this._featureNames=m,c.layout(d,e,n),d.add(c.makeBackground(d.getBoundingRect(),e)),d.eachChild(function(e){var t=e.__title,i=e.hoverStyle;if(i&&t){var r=a.getBoundingRect(t,a.makeFont(i)),s=e.position[0]+d.position[0],o=e.position[1]+d.position[1]+f,l=!1;o+r.height>n.getHeight()&&(i.textPosition="top",l=!0);var u=l?-5-r.height:f+8;s+r.width/2>n.getWidth()?(i.textPosition=["100%",u],i.textAlign="right"):s-r.width/2<0&&(i.textPosition=[0,u],i.textAlign="left")}})}function v(r,a){var o,u=m[r],c=m[a],d=p[u],f=new l(d,e,e.ecModel);if(u&&!c){if(h(u))o={model:f,onclick:f.option.onclick,featureName:u};else{var v=s.get(u);if(!v)return;o=new v(f,t,n)}g[u]=o}else{if(o=g[c],!o)return;o.model=f,o.ecModel=t,o.api=n}u||!c?f.get("show")&&!o.unusable?(y(f,o,u),f.setIconStatus=function(e,t){var n=this.option,i=this.iconPaths;n.iconStatus=n.iconStatus||{},n.iconStatus[e]=t,i[e]&&i[e].trigger(t)},o.render&&o.render(f,t,n,i)):o.remove&&o.remove(t,n):o.dispose&&o.dispose(t,n)}function y(i,a,s){var l=i.getModel("iconStyle"),u=i.getModel("emphasis.iconStyle"),c=a.getIcons?a.getIcons():i.get("icon"),h=i.get("title")||{};if("string"===typeof c){var p=c,g=h;c={},h={},c[s]=p,h[s]=g}var m=i.iconPaths={};r.each(c,function(s,c){var p=o.createIcon(s,{},{x:-f/2,y:-f/2,width:f,height:f});p.setStyle(l.getItemStyle()),p.hoverStyle=u.getItemStyle(),o.setHoverStyle(p),e.get("showTitle")&&(p.__title=h[c],p.on("mouseover",function(){var e=u.getItemStyle();p.setStyle({text:h[c],textPosition:e.textPosition||"bottom",textFill:e.fill||e.stroke||"#000",textAlign:e.textAlign||"center"})}).on("mouseout",function(){p.setStyle({textFill:null})})),p.trigger(i.get("iconStatus."+c)||"normal"),d.add(p),p.on("click",r.bind(a.onclick,a,t,n,c)),m[c]=p})}},updateView:function(e,t,n,i){r.each(this._features,function(e){e.updateView&&e.updateView(e.model,t,n,i)})},remove:function(e,t){r.each(this._features,function(n){n.remove&&n.remove(e,t)}),this.group.removeAll()},dispose:function(e,t){r.each(this._features,function(n){n.dispose&&n.dispose(e,t)})}});function h(e){return 0===e.indexOf("my")}e.exports=d},dc2f:function(e,t){var n=function(e,t){this.image=e,this.repeat=t,this.type="pattern"};n.prototype.getCanvasPattern=function(e){return e.createPattern(this.image,this.repeat||"repeat")};var i=n;e.exports=i},dcb3:function(e,t,n){var i=n("6d8b"),r=n("625e"),a=n("2306"),s=n("cd33"),o=n("607d"),l=n("88b3"),u=n("e0d3"),c=u.makeInner,d=c(),h=i.clone,f=i.bind;function p(){}function g(e,t,n,i){m(d(n).lastProp,i)||(d(n).lastProp=i,t?a.updateProps(n,i,e):(n.stopAnimation(),n.attr(i)))}function m(e,t){if(i.isObject(e)&&i.isObject(t)){var n=!0;return i.each(t,function(t,i){n=n&&m(e[i],t)}),!!n}return e===t}function v(e,t){e[t.get("label.show")?"show":"hide"]()}function y(e){return{position:e.position.slice(),rotation:e.rotation||0}}function b(e,t,n){var i=t.get("z"),r=t.get("zlevel");e&&e.traverse(function(e){"group"!==e.type&&(null!=i&&(e.z=i),null!=r&&(e.zlevel=r),e.silent=n)})}p.prototype={_group:null,_lastGraphicKey:null,_handle:null,_dragging:!1,_lastValue:null,_lastStatus:null,_payloadInfo:null,animationThreshold:15,render:function(e,t,n,r){var s=t.get("value"),o=t.get("status");if(this._axisModel=e,this._axisPointerModel=t,this._api=n,r||this._lastValue!==s||this._lastStatus!==o){this._lastValue=s,this._lastStatus=o;var l=this._group,u=this._handle;if(!o||"hide"===o)return l&&l.hide(),void(u&&u.hide());l&&l.show(),u&&u.show();var c={};this.makeElOption(c,s,e,t,n);var d=c.graphicKey;d!==this._lastGraphicKey&&this.clear(n),this._lastGraphicKey=d;var h=this._moveAnimation=this.determineAnimation(e,t);if(l){var f=i.curry(g,t,h);this.updatePointerEl(l,c,f,t),this.updateLabelEl(l,c,f,t)}else l=this._group=new a.Group,this.createPointerEl(l,c,e,t),this.createLabelEl(l,c,e,t),n.getZr().add(l);b(l,t,!0),this._renderHandle(s)}},remove:function(e){this.clear(e)},dispose:function(e){this.clear(e)},determineAnimation:function(e,t){var n=t.get("animation"),i=e.axis,r="category"===i.type,a=t.get("snap");if(!a&&!r)return!1;if("auto"===n||null==n){var o=this.animationThreshold;if(r&&i.getBandWidth()>o)return!0;if(a){var l=s.getAxisInfo(e).seriesDataCount,u=i.getExtent();return Math.abs(u[0]-u[1])/l>o}return!1}return!0===n},makeElOption:function(e,t,n,i,r){},createPointerEl:function(e,t,n,i){var r=t.pointer;if(r){var s=d(e).pointerEl=new a[r.type](h(t.pointer));e.add(s)}},createLabelEl:function(e,t,n,i){if(t.label){var r=d(e).labelEl=new a.Rect(h(t.label));e.add(r),v(r,i)}},updatePointerEl:function(e,t,n){var i=d(e).pointerEl;i&&(i.setStyle(t.pointer.style),n(i,{shape:t.pointer.shape}))},updateLabelEl:function(e,t,n,i){var r=d(e).labelEl;r&&(r.setStyle(t.label.style),n(r,{shape:t.label.shape,position:t.label.position}),v(r,i))},_renderHandle:function(e){if(!this._dragging&&this.updateHandleTransform){var t,n=this._axisPointerModel,r=this._api.getZr(),s=this._handle,u=n.getModel("handle"),c=n.get("status");if(!u.get("show")||!c||"hide"===c)return s&&r.remove(s),void(this._handle=null);this._handle||(t=!0,s=this._handle=a.createIcon(u.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(e){o.stop(e.event)},onmousedown:f(this._onHandleDragMove,this,0,0),drift:f(this._onHandleDragMove,this),ondragend:f(this._onHandleDragEnd,this)}),r.add(s)),b(s,n,!1);var d=["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];s.setStyle(u.getItemStyle(null,d));var h=u.get("size");i.isArray(h)||(h=[h,h]),s.attr("scale",[h[0]/2,h[1]/2]),l.createOrUpdate(this,"_doDispatchAxisPointer",u.get("throttle")||0,"fixRate"),this._moveHandleToValue(e,t)}},_moveHandleToValue:function(e,t){g(this._axisPointerModel,!t&&this._moveAnimation,this._handle,y(this.getHandleTransform(e,this._axisModel,this._axisPointerModel)))},_onHandleDragMove:function(e,t){var n=this._handle;if(n){this._dragging=!0;var i=this.updateHandleTransform(y(n),[e,t],this._axisModel,this._axisPointerModel);this._payloadInfo=i,n.stopAnimation(),n.attr(y(i)),d(n).lastProp=null,this._doDispatchAxisPointer()}},_doDispatchAxisPointer:function(){var e=this._handle;if(e){var t=this._payloadInfo,n=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:t.cursorPoint[0],y:t.cursorPoint[1],tooltipOption:t.tooltipOption,axesInfo:[{axisDim:n.axis.dim,axisIndex:n.componentIndex}]})}},_onHandleDragEnd:function(e){this._dragging=!1;var t=this._handle;if(t){var n=this._axisPointerModel.get("value");this._moveHandleToValue(n),this._api.dispatchAction({type:"hideTip"})}},getHandleTransform:null,updateHandleTransform:null,clear:function(e){this._lastValue=null,this._lastStatus=null;var t=e.getZr(),n=this._group,i=this._handle;t&&n&&(this._lastGraphicKey=null,n&&t.remove(n),i&&t.remove(i),this._group=null,this._handle=null,this._payloadInfo=null)},doClear:function(){},buildLabel:function(e,t,n){return n=n||0,{x:e[n],y:e[1-n],width:t[n],height:t[1-n]}}},p.prototype.constructor=p,r.enableClassExtend(p);var S=p;e.exports=S},dcbc:function(e,t,n){var i=n("2aba");e.exports=function(e,t,n){for(var r in t)i(e,r,t[r],n);return e}},dd39:function(e,t,n){n("6932"),n("3a56"),n("7dcf"),n("414c"),n("4b08"),n("2c17"),n("9e87")},dded:function(e,t,n){var i=n("6d8b"),r=n("42e5"),a=function(e,t,n,i,a){this.x=null==e?.5:e,this.y=null==t?.5:t,this.r=null==n?.5:n,this.type="radial",this.global=a||!1,r.call(this,i)};a.prototype={constructor:a},i.inherits(a,r);var s=a;e.exports=s},de00:function(e,t){var n=2311;function i(){return n++}e.exports=i},de1c:function(e,t){var n={getBoxLayoutParams:function(){return{left:this.get("left"),top:this.get("top"),right:this.get("right"),bottom:this.get("bottom"),width:this.get("width"),height:this.get("height")}}};e.exports=n},df70:function(e,t,n){var i=n("3eba"),r=n("6fda"),a=n("29a8"),s=n("2145"),o=a.toolbox.restore;function l(e){this.model=e}l.defaultOption={show:!0,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:o.title};var u=l.prototype;u.onclick=function(e,t,n){r.clear(e),t.dispatchAction({type:"restore",from:this.uid})},s.register("restore",l),i.registerAction({type:"restore",event:"restore",update:"prepareAndUpdate"},function(e,t){t.resetOption("recreate")});var c=l;e.exports=c},e073:function(e,t,n){var i=n("6d8b"),r=n("e86a"),a=n("e0d3"),s=a.makeInner,o=n("697e"),l=o.makeLabelFormatter,u=s();function c(e){return"category"===e.type?h(e):g(e)}function d(e,t){return"category"===e.type?p(e,t):{ticks:e.scale.getTicks()}}function h(e){var t=e.getLabelModel(),n=f(e,t);return!t.get("show")||e.scale.isBlank()?{labels:[],labelCategoryInterval:n.labelCategoryInterval}:n}function f(e,t){var n,r,a=m(e,"labels"),s=E(t),o=v(a,s);return o||(i.isFunction(s)?n=w(e,s):(r="auto"===s?b(e):s,n=_(e,r)),y(a,s,{labels:n,labelCategoryInterval:r}))}function p(e,t){var n,r,a=m(e,"ticks"),s=E(t),o=v(a,s);if(o)return o;if(t.get("show")&&!e.scale.isBlank()||(n=[]),i.isFunction(s))n=w(e,s,!0);else if("auto"===s){var l=f(e,e.getLabelModel());r=l.labelCategoryInterval,n=i.map(l.labels,function(e){return e.tickValue})}else r=s,n=_(e,r,!0);return y(a,s,{ticks:n,tickCategoryInterval:r})}function g(e){var t=e.scale.getTicks(),n=l(e);return{labels:i.map(t,function(t,i){return{formattedLabel:n(t,i),rawLabel:e.scale.getLabel(t),tickValue:t}})}}function m(e,t){return u(e)[t]||(u(e)[t]=[])}function v(e,t){for(var n=0;n<e.length;n++)if(e[n].key===t)return e[n].value}function y(e,t,n){return e.push({key:t,value:n}),n}function b(e){var t=u(e).autoInterval;return null!=t?t:u(e).autoInterval=e.calculateCategoryInterval()}function S(e){var t=T(e),n=l(e),i=(t.axisRotate-t.labelRotate)/180*Math.PI,a=e.scale,s=a.getExtent(),o=a.count();if(s[1]-s[0]<1)return 0;var c=1;o>40&&(c=Math.max(1,Math.floor(o/40)));for(var d=s[0],h=e.dataToCoord(d+1)-e.dataToCoord(d),f=Math.abs(h*Math.cos(i)),p=Math.abs(h*Math.sin(i)),g=0,m=0;d<=s[1];d+=c){var v=0,y=0,b=r.getBoundingRect(n(d),t.font,"center","top");v=1.3*b.width,y=1.3*b.height,g=Math.max(g,v,7),m=Math.max(m,y,7)}var S=g/f,_=m/p;isNaN(S)&&(S=1/0),isNaN(_)&&(_=1/0);var w=Math.max(0,Math.floor(Math.min(S,_))),E=u(e.model),x=E.lastAutoInterval,A=E.lastTickCount;return null!=x&&null!=A&&Math.abs(x-w)<=1&&Math.abs(A-o)<=1&&x>w?w=x:(E.lastTickCount=o,E.lastAutoInterval=w),w}function T(e){var t=e.getLabelModel();return{axisRotate:e.getRotate?e.getRotate():e.isHorizontal&&!e.isHorizontal()?90:0,labelRotate:t.get("rotate")||0,font:t.getFont()}}function _(e,t,n){var i=l(e),r=e.scale,a=r.getExtent(),s=e.getLabelModel(),o=[],u=Math.max((t||0)+1,1),c=a[0],d=r.count();0!==c&&u>1&&d/u>2&&(c=Math.round(Math.ceil(c/u)*u));var h={min:s.get("showMinLabel"),max:s.get("showMaxLabel")};h.min&&c!==a[0]&&p(a[0]);for(var f=c;f<=a[1];f+=u)p(f);function p(e){o.push(n?e:{formattedLabel:i(e),rawLabel:r.getLabel(e),tickValue:e})}return h.max&&f!==a[1]&&p(a[1]),o}function w(e,t,n){var r=e.scale,a=l(e),s=[];return i.each(r.getTicks(),function(e){var i=r.getLabel(e);t(e,i)&&s.push(n?e:{formattedLabel:a(e),rawLabel:i,tickValue:e})}),s}function E(e){var t=e.get("interval");return null==t?"auto":t}t.createAxisLabels=c,t.createAxisTicks=d,t.calculateCategoryInterval=S},e0d3:function(e,t,n){var i=n("6d8b"),r=i.each,a=i.isObject,s=i.isArray,o="series\0";function l(e){return e instanceof Array?e:null==e?[]:[e]}function u(e,t,n){if(e){e[t]=e[t]||{},e.emphasis=e.emphasis||{},e.emphasis[t]=e.emphasis[t]||{};for(var i=0,r=n.length;i<r;i++){var a=n[i];!e.emphasis[t].hasOwnProperty(a)&&e[t].hasOwnProperty(a)&&(e.emphasis[t][a]=e[t][a])}}}var c=["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"];function d(e){return!a(e)||s(e)||e instanceof Date?e:e.value}function h(e){return a(e)&&!(e instanceof Array)}function f(e,t){t=(t||[]).slice();var n=i.map(e||[],function(e,t){return{exist:e}});return r(t,function(e,i){if(a(e)){for(var r=0;r<n.length;r++)if(!n[r].option&&null!=e.id&&n[r].exist.id===e.id+"")return n[r].option=e,void(t[i]=null);for(r=0;r<n.length;r++){var s=n[r].exist;if(!n[r].option&&(null==s.id||null==e.id)&&null!=e.name&&!m(e)&&!m(s)&&s.name===e.name+"")return n[r].option=e,void(t[i]=null)}}}),r(t,function(e,t){if(a(e)){for(var i=0;i<n.length;i++){var r=n[i].exist;if(!n[i].option&&!m(r)&&null==e.id){n[i].option=e;break}}i>=n.length&&n.push({option:e})}}),n}function p(e){var t=i.createHashMap();r(e,function(e,n){var i=e.exist;i&&t.set(i.id,e)}),r(e,function(e,n){var r=e.option;i.assert(!r||null==r.id||!t.get(r.id)||t.get(r.id)===e,"id duplicates: "+(r&&r.id)),r&&null!=r.id&&t.set(r.id,e),!e.keyInfo&&(e.keyInfo={})}),r(e,function(e,n){var i=e.exist,r=e.option,s=e.keyInfo;if(a(r)){if(s.name=null!=r.name?r.name+"":i?i.name:o+n,i)s.id=i.id;else if(null!=r.id)s.id=r.id+"";else{var l=0;do{s.id="\0"+s.name+"\0"+l++}while(t.get(s.id))}t.set(s.id,e)}})}function g(e){var t=e.name;return!(!t||!t.indexOf(o))}function m(e){return a(e)&&e.id&&0===(e.id+"").indexOf("\0_ec_\0")}function v(e,t){var n={},i={};return r(e||[],n),r(t||[],i,n),[a(n),a(i)];function r(e,t,n){for(var i=0,r=e.length;i<r;i++)for(var a=e[i].seriesId,s=l(e[i].dataIndex),o=n&&n[a],u=0,c=s.length;u<c;u++){var d=s[u];o&&o[d]?o[d]=null:(t[a]||(t[a]={}))[d]=1}}function a(e,t){var n=[];for(var i in e)if(e.hasOwnProperty(i)&&null!=e[i])if(t)n.push(+i);else{var r=a(e[i],!0);r.length&&n.push({seriesId:i,dataIndex:r})}return n}}function y(e,t){return null!=t.dataIndexInside?t.dataIndexInside:null!=t.dataIndex?i.isArray(t.dataIndex)?i.map(t.dataIndex,function(t){return e.indexOfRawIndex(t)}):e.indexOfRawIndex(t.dataIndex):null!=t.name?i.isArray(t.name)?i.map(t.name,function(t){return e.indexOfName(t)}):e.indexOfName(t.name):void 0}function b(){var e="__\0ec_inner_"+S+++"_"+Math.random().toFixed(5);return function(t){return t[e]||(t[e]={})}}var S=0;function T(e,t,n){if(i.isString(t)){var a={};a[t+"Index"]=0,t=a}var s=n&&n.defaultMainType;!s||_(t,s+"Index")||_(t,s+"Id")||_(t,s+"Name")||(t[s+"Index"]=0);var o={};return r(t,function(r,a){r=t[a];if("dataIndex"!==a&&"dataIndexInside"!==a){var s=a.match(/^(\w+)(Index|Id|Name)$/)||[],l=s[1],u=(s[2]||"").toLowerCase();if(!(!l||!u||null==r||"index"===u&&"none"===r||n&&n.includeMainTypes&&i.indexOf(n.includeMainTypes,l)<0)){var c={mainType:l};"index"===u&&"all"===r||(c[u]=r);var d=e.queryComponents(c);o[l+"Models"]=d,o[l+"Model"]=d[0]}}else o[a]=r}),o}function _(e,t){return e&&e.hasOwnProperty(t)}function w(e,t,n){e.setAttribute?e.setAttribute(t,n):e[t]=n}function E(e,t){return e.getAttribute?e.getAttribute(t):e[t]}t.normalizeToArray=l,t.defaultEmphasis=u,t.TEXT_STYLE_OPTIONS=c,t.getDataItemValue=d,t.isDataItemOption=h,t.mappingToExists=f,t.makeIdAndName=p,t.isNameSpecified=g,t.isIdInner=m,t.compressBatches=v,t.queryDataIndex=y,t.makeInner=b,t.parseFinder=T,t.setAttribute=w,t.getAttribute=E},e0d8:function(e,t,n){var i=n("625e");function r(e){this._setting=e||{},this._extent=[1/0,-1/0],this._interval=0,this.init&&this.init.apply(this,arguments)}r.prototype.parse=function(e){return e},r.prototype.getSetting=function(e){return this._setting[e]},r.prototype.contain=function(e){var t=this._extent;return e>=t[0]&&e<=t[1]},r.prototype.normalize=function(e){var t=this._extent;return t[1]===t[0]?.5:(e-t[0])/(t[1]-t[0])},r.prototype.scale=function(e){var t=this._extent;return e*(t[1]-t[0])+t[0]},r.prototype.unionExtent=function(e){var t=this._extent;e[0]<t[0]&&(t[0]=e[0]),e[1]>t[1]&&(t[1]=e[1])},r.prototype.unionExtentFromData=function(e,t){this.unionExtent(e.getApproximateExtent(t))},r.prototype.getExtent=function(){return this._extent.slice()},r.prototype.setExtent=function(e,t){var n=this._extent;isNaN(e)||(n[0]=e),isNaN(t)||(n[1]=t)},r.prototype.isBlank=function(){return this._isBlank},r.prototype.setBlank=function(e){this._isBlank=e},r.prototype.getLabel=null,i.enableClassExtend(r),i.enableClassManagement(r,{registerWhenExtend:!0});var a=r;e.exports=a},e11e:function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},e1fc:function(e,t,n){var i=n("6d8b"),r=n("d5b7"),a=n("9850"),s=function(e){for(var t in e=e||{},r.call(this,e),e)e.hasOwnProperty(t)&&(this[t]=e[t]);this._children=[],this.__storage=null,this.__dirty=!0};s.prototype={constructor:s,isGroup:!0,type:"group",silent:!1,children:function(){return this._children.slice()},childAt:function(e){return this._children[e]},childOfName:function(e){for(var t=this._children,n=0;n<t.length;n++)if(t[n].name===e)return t[n]},childCount:function(){return this._children.length},add:function(e){return e&&e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),this},addBefore:function(e,t){if(e&&e!==this&&e.parent!==this&&t&&t.parent===this){var n=this._children,i=n.indexOf(t);i>=0&&(n.splice(i,0,e),this._doAdd(e))}return this},_doAdd:function(e){e.parent&&e.parent.remove(e),e.parent=this;var t=this.__storage,n=this.__zr;t&&t!==e.__storage&&(t.addToStorage(e),e instanceof s&&e.addChildrenToStorage(t)),n&&n.refresh()},remove:function(e){var t=this.__zr,n=this.__storage,r=this._children,a=i.indexOf(r,e);return a<0?this:(r.splice(a,1),e.parent=null,n&&(n.delFromStorage(e),e instanceof s&&e.delChildrenFromStorage(n)),t&&t.refresh(),this)},removeAll:function(){var e,t,n=this._children,i=this.__storage;for(t=0;t<n.length;t++)e=n[t],i&&(i.delFromStorage(e),e instanceof s&&e.delChildrenFromStorage(i)),e.parent=null;return n.length=0,this},eachChild:function(e,t){for(var n=this._children,i=0;i<n.length;i++){var r=n[i];e.call(t,r,i)}return this},traverse:function(e,t){for(var n=0;n<this._children.length;n++){var i=this._children[n];e.call(t,i),"group"===i.type&&i.traverse(e,t)}return this},addChildrenToStorage:function(e){for(var t=0;t<this._children.length;t++){var n=this._children[t];e.addToStorage(n),n instanceof s&&n.addChildrenToStorage(e)}},delChildrenFromStorage:function(e){for(var t=0;t<this._children.length;t++){var n=this._children[t];e.delFromStorage(n),n instanceof s&&n.delChildrenFromStorage(e)}},dirty:function(){return this.__dirty=!0,this.__zr&&this.__zr.refresh(),this},getBoundingRect:function(e){for(var t=null,n=new a(0,0,0,0),i=e||this._children,r=[],s=0;s<i.length;s++){var o=i[s];if(!o.ignore&&!o.invisible){var l=o.getBoundingRect(),u=o.getLocalTransform(r);u?(n.copy(l),n.applyTransform(u),t=t||n.clone(),t.union(n)):(t=t||l.clone(),t.union(l))}}return t||n}},i.inherits(s,r);var o=s;e.exports=o},e263:function(e,t,n){var i=n("401b"),r=n("4a3f"),a=Math.min,s=Math.max,o=Math.sin,l=Math.cos,u=2*Math.PI,c=i.create(),d=i.create(),h=i.create();function f(e,t,n){if(0!==e.length){var i,r=e[0],o=r[0],l=r[0],u=r[1],c=r[1];for(i=1;i<e.length;i++)r=e[i],o=a(o,r[0]),l=s(l,r[0]),u=a(u,r[1]),c=s(c,r[1]);t[0]=o,t[1]=u,n[0]=l,n[1]=c}}function p(e,t,n,i,r,o){r[0]=a(e,n),r[1]=a(t,i),o[0]=s(e,n),o[1]=s(t,i)}var g=[],m=[];function v(e,t,n,i,o,l,u,c,d,h){var f,p=r.cubicExtrema,v=r.cubicAt,y=p(e,n,o,u,g);for(d[0]=1/0,d[1]=1/0,h[0]=-1/0,h[1]=-1/0,f=0;f<y;f++){var b=v(e,n,o,u,g[f]);d[0]=a(b,d[0]),h[0]=s(b,h[0])}for(y=p(t,i,l,c,m),f=0;f<y;f++){var S=v(t,i,l,c,m[f]);d[1]=a(S,d[1]),h[1]=s(S,h[1])}d[0]=a(e,d[0]),h[0]=s(e,h[0]),d[0]=a(u,d[0]),h[0]=s(u,h[0]),d[1]=a(t,d[1]),h[1]=s(t,h[1]),d[1]=a(c,d[1]),h[1]=s(c,h[1])}function y(e,t,n,i,o,l,u,c){var d=r.quadraticExtremum,h=r.quadraticAt,f=s(a(d(e,n,o),1),0),p=s(a(d(t,i,l),1),0),g=h(e,n,o,f),m=h(t,i,l,p);u[0]=a(e,o,g),u[1]=a(t,l,m),c[0]=s(e,o,g),c[1]=s(t,l,m)}function b(e,t,n,r,a,s,f,p,g){var m=i.min,v=i.max,y=Math.abs(a-s);if(y%u<1e-4&&y>1e-4)return p[0]=e-n,p[1]=t-r,g[0]=e+n,void(g[1]=t+r);if(c[0]=l(a)*n+e,c[1]=o(a)*r+t,d[0]=l(s)*n+e,d[1]=o(s)*r+t,m(p,c,d),v(g,c,d),a%=u,a<0&&(a+=u),s%=u,s<0&&(s+=u),a>s&&!f?s+=u:a<s&&f&&(a+=u),f){var b=s;s=a,a=b}for(var S=0;S<s;S+=Math.PI/2)S>a&&(h[0]=l(S)*n+e,h[1]=o(S)*r+t,m(p,h,p),v(g,h,g))}t.fromPoints=f,t.fromLine=p,t.fromCubic=v,t.fromQuadratic=y,t.fromArc=b},e47b:function(e,t,n){var i=n("e0d3"),r=i.makeInner,a=i.normalizeToArray,s=r();function o(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i].length>t)return e[i];return e[n-1]}var l={clearColorPalette:function(){s(this).colorIdx=0,s(this).colorNameMap={}},getColorFromPalette:function(e,t,n){t=t||this;var i=s(t),r=i.colorIdx||0,l=i.colorNameMap=i.colorNameMap||{};if(l.hasOwnProperty(e))return l[e];var u=a(this.get("color",!0)),c=this.get("colorLayer",!0),d=null!=n&&c?o(c,n):u;if(d=d||u,d&&d.length){var h=d[r];return e&&(l[e]=h),i.colorIdx=(r+1)%d.length,h}}};e.exports=l},e7aa:function(e,t,n){var i=n("2306"),r=n("c775"),a=r.getDefaultLabel;function s(e,t,n,r,s,l,u){var c=n.getModel("label"),d=n.getModel("emphasis.label");i.setLabelStyle(e,t,c,d,{labelFetcher:s,labelDataIndex:l,defaultText:a(s.getData(),l),isRectText:!0,autoColor:r}),o(e),o(t)}function o(e,t){"outside"===e.textPosition&&(e.textPosition=t)}t.setLabel=s},e7d2:function(e,t,n){var i=n("4a3f");function r(e,t,n,r,a,s,o,l,u,c,d){if(0===u)return!1;var h=u;if(d>t+h&&d>r+h&&d>s+h&&d>l+h||d<t-h&&d<r-h&&d<s-h&&d<l-h||c>e+h&&c>n+h&&c>a+h&&c>o+h||c<e-h&&c<n-h&&c<a-h&&c<o-h)return!1;var f=i.cubicProjectPoint(e,t,n,r,a,s,o,l,c,d,null);return f<=h/2}t.containStroke=r},e86a:function(e,t,n){var i=n("9850"),r=n("5e76"),a=n("6d8b"),s=a.getContext,o=a.extend,l=a.retrieve2,u=a.retrieve3,c=a.trim,d={},h=0,f=5e3,p=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g,g="12px sans-serif",m={};function v(e,t){m[e]=t}function y(e,t){t=t||g;var n=e+":"+t;if(d[n])return d[n];for(var i=(e+"").split("\n"),r=0,a=0,s=i.length;a<s;a++)r=Math.max(R(i[a],t).width,r);return h>f&&(h=0,d={}),h++,d[n]=r,r}function b(e,t,n,i,r,a,s){return a?T(e,t,n,i,r,a,s):S(e,t,n,i,r,s)}function S(e,t,n,r,a,s){var o=M(e,t,a,s),l=y(e,t);a&&(l+=a[1]+a[3]);var u=o.outerHeight,c=_(0,l,n),d=w(0,u,r),h=new i(c,d,l,u);return h.lineHeight=o.lineHeight,h}function T(e,t,n,r,a,s,o){var l=D(e,{rich:s,truncate:o,font:t,textAlign:n,textPadding:a}),u=l.outerWidth,c=l.outerHeight,d=_(0,u,n),h=w(0,c,r);return new i(d,h,u,c)}function _(e,t,n){return"right"===n?e-=t:"center"===n&&(e-=t/2),e}function w(e,t,n){return"middle"===n?e-=t/2:"bottom"===n&&(e-=t),e}function E(e,t,n){var i=t.x,r=t.y,a=t.height,s=t.width,o=a/2,l="left",u="top";switch(e){case"left":i-=n,r+=o,l="right",u="middle";break;case"right":i+=n+s,r+=o,u="middle";break;case"top":i+=s/2,r-=n,l="center",u="bottom";break;case"bottom":i+=s/2,r+=a+n,l="center";break;case"inside":i+=s/2,r+=o,l="center",u="middle";break;case"insideLeft":i+=n,r+=o,u="middle";break;case"insideRight":i+=s-n,r+=o,l="right",u="middle";break;case"insideTop":i+=s/2,r+=n,l="center";break;case"insideBottom":i+=s/2,r+=a-n,l="center",u="bottom";break;case"insideTopLeft":i+=n,r+=n;break;case"insideTopRight":i+=s-n,r+=n,l="right";break;case"insideBottomLeft":i+=n,r+=a-n,u="bottom";break;case"insideBottomRight":i+=s-n,r+=a-n,l="right",u="bottom";break}return{x:i,y:r,textAlign:l,textVerticalAlign:u}}function x(e,t,n,i,r){if(!t)return"";var a=(e+"").split("\n");r=A(t,n,i,r);for(var s=0,o=a.length;s<o;s++)a[s]=k(a[s],r);return a.join("\n")}function A(e,t,n,i){i=o({},i),i.font=t;n=l(n,"...");i.maxIterations=l(i.maxIterations,2);var r=i.minChar=l(i.minChar,0);i.cnCharWidth=y("国",t);var a=i.ascCharWidth=y("a",t);i.placeholder=l(i.placeholder,"");for(var s=e=Math.max(0,e-1),u=0;u<r&&s>=a;u++)s-=a;var c=y(n);return c>s&&(n="",c=0),s=e-c,i.ellipsis=n,i.ellipsisWidth=c,i.contentWidth=s,i.containerWidth=e,i}function k(e,t){var n=t.containerWidth,i=t.font,r=t.contentWidth;if(!n)return"";var a=y(e,i);if(a<=n)return e;for(var s=0;;s++){if(a<=r||s>=t.maxIterations){e+=t.ellipsis;break}var o=0===s?I(e,r,t.ascCharWidth,t.cnCharWidth):a>0?Math.floor(e.length*r/a):0;e=e.substr(0,o),a=y(e,i)}return""===e&&(e=t.placeholder),e}function I(e,t,n,i){for(var r=0,a=0,s=e.length;a<s&&r<t;a++){var o=e.charCodeAt(a);r+=0<=o&&o<=127?n:i}return a}function C(e){return y("国",e)}function R(e,t){return m.measureText(e,t)}function M(e,t,n,i){null!=e&&(e+="");var r=C(t),a=e?e.split("\n"):[],s=a.length*r,o=s;if(n&&(o+=n[0]+n[2]),e&&i){var l=i.outerHeight,u=i.outerWidth;if(null!=l&&o>l)e="",a=[];else if(null!=u)for(var c=A(u-(n?n[1]+n[3]:0),t,i.ellipsis,{minChar:i.minChar,placeholder:i.placeholder}),d=0,h=a.length;d<h;d++)a[d]=k(a[d],c)}return{lines:a,height:s,outerHeight:o,lineHeight:r}}function D(e,t){var n={lines:[],width:0,height:0};if(null!=e&&(e+=""),!e)return n;var i,a=p.lastIndex=0;while(null!=(i=p.exec(e))){var s=i.index;s>a&&L(n,e.substring(a,s)),L(n,i[2],i[1]),a=p.lastIndex}a<e.length&&L(n,e.substring(a,e.length));var o=n.lines,c=0,d=0,h=[],f=t.textPadding,g=t.truncate,m=g&&g.outerWidth,v=g&&g.outerHeight;f&&(null!=m&&(m-=f[1]+f[3]),null!=v&&(v-=f[0]+f[2]));for(var b=0;b<o.length;b++){for(var S=o[b],T=0,_=0,w=0;w<S.tokens.length;w++){var E=S.tokens[w],A=E.styleName&&t.rich[E.styleName]||{},k=E.textPadding=A.textPadding,I=E.font=A.font||t.font,R=E.textHeight=l(A.textHeight,C(I));if(k&&(R+=k[0]+k[2]),E.height=R,E.lineHeight=u(A.textLineHeight,t.textLineHeight,R),E.textAlign=A&&A.textAlign||t.textAlign,E.textVerticalAlign=A&&A.textVerticalAlign||"middle",null!=v&&c+E.lineHeight>v)return{lines:[],width:0,height:0};E.textWidth=y(E.text,I);var M=A.textWidth,D=null==M||"auto"===M;if("string"===typeof M&&"%"===M.charAt(M.length-1))E.percentWidth=M,h.push(E),M=0;else{if(D){M=E.textWidth;var P=A.textBackgroundColor,O=P&&P.image;O&&(O=r.findExistImage(O),r.isImageReady(O)&&(M=Math.max(M,O.width*R/O.height)))}var N=k?k[1]+k[3]:0;M+=N;var U=null!=m?m-_:null;null!=U&&U<M&&(!D||U<N?(E.text="",E.textWidth=M=0):(E.text=x(E.text,U-N,I,g.ellipsis,{minChar:g.minChar}),E.textWidth=y(E.text,I),M=E.textWidth+N))}_+=E.width=M,A&&(T=Math.max(T,E.lineHeight))}S.width=_,S.lineHeight=T,c+=T,d=Math.max(d,_)}n.outerWidth=n.width=l(t.textWidth,d),n.outerHeight=n.height=l(t.textHeight,c),f&&(n.outerWidth+=f[1]+f[3],n.outerHeight+=f[0]+f[2]);for(b=0;b<h.length;b++){E=h[b];var F=E.percentWidth;E.width=parseInt(F,10)/100*d}return n}function L(e,t,n){for(var i=""===t,r=t.split("\n"),a=e.lines,s=0;s<r.length;s++){var o=r[s],l={styleName:n,text:o,isLineHolder:!o&&!i};if(s)a.push({tokens:[l]});else{var u=(a[a.length-1]||(a[0]={tokens:[]})).tokens,c=u.length;1===c&&u[0].isLineHolder?u[0]=l:(o||!c||i)&&u.push(l)}}}function P(e){var t=(e.fontSize||e.fontFamily)&&[e.fontStyle,e.fontWeight,(e.fontSize||12)+"px",e.fontFamily||"sans-serif"].join(" ");return t&&c(t)||e.textFont||e.font}m.measureText=function(e,t){var n=s();return n.font=t||g,n.measureText(e)},t.DEFAULT_FONT=g,t.$override=v,t.getWidth=y,t.getBoundingRect=b,t.adjustTextX=_,t.adjustTextY=w,t.adjustTextPositionOnRect=E,t.truncateText=x,t.getLineHeight=C,t.measureText=R,t.parsePlainText=M,t.parseRichText=D,t.makeFont=P},e887:function(e,t,n){var i=n("6d8b"),r=i.each,a=n("e1fc"),s=n("8918"),o=n("625e"),l=n("e0d3"),u=n("f47d"),c=u.createTask,d=n("cccd"),h=l.makeInner(),f=d();function p(){this.group=new a,this.uid=s.getUID("viewChart"),this.renderTask=c({plan:y,reset:b}),this.renderTask.context={view:this}}p.prototype={type:"chart",init:function(e,t){},render:function(e,t,n,i){},highlight:function(e,t,n,i){v(e.getData(),i,"emphasis")},downplay:function(e,t,n,i){v(e.getData(),i,"normal")},remove:function(e,t){this.group.removeAll()},dispose:function(){},incrementalPrepareRender:null,incrementalRender:null,updateTransform:null};var g=p.prototype;function m(e,t){if(e&&(e.trigger(t),"group"===e.type))for(var n=0;n<e.childCount();n++)m(e.childAt(n),t)}function v(e,t,n){var i=l.queryDataIndex(e,t);null!=i?r(l.normalizeToArray(i),function(t){m(e.getItemGraphicEl(t),n)}):e.eachItemGraphicEl(function(e){m(e,n)})}function y(e){return f(e.model)}function b(e){var t=e.model,n=e.ecModel,i=e.api,r=e.payload,a=t.pipelineContext.progressiveRender,s=e.view,o=r&&h(r).updateMethod,l=a?"incrementalPrepareRender":o&&s[o]?o:"render";return"render"!==l&&s[l](t,n,i,r),S[l]}g.updateView=g.updateLayout=g.updateVisual=function(e,t,n,i){this.render(e,t,n,i)},o.enableClassExtend(p,["dispose"]),o.enableClassManagement(p,{registerWhenExtend:!0}),p.markUpdateMethod=function(e,t){h(e).updateMethod=t};var S={incrementalPrepareRender:{progress:function(e,t){t.view.incrementalRender(e,t.model,t.ecModel,t.api,t.payload)}},render:{forceFirstProgress:!0,progress:function(e,t){t.view.render(t.model,t.ecModel,t.api,t.payload)}}},T=p;e.exports=T},eb6b:function(e,t,n){var i=n("6d8b"),r=n("e0d3"),a=r.makeInner,s=n("cd33"),o=n("133d"),l=i.each,u=i.curry,c=a();function d(e,t,n){var r=e.currTrigger,a=[e.x,e.y],s=e,c=e.dispatchAction||i.bind(n.dispatchAction,n),d=t.getComponent("axisPointer").coordSysAxesInfo;if(d){T(a)&&(a=o({seriesIndex:s.seriesIndex,dataIndex:s.dataIndex},t).point);var f=T(a),_=s.axesInfo,w=d.axesInfo,E="leave"===r||T(a),x={},A={},k={list:[],map:{}},I={showPointer:u(p,A),showTooltip:u(g,k)};l(d.coordSysMap,function(e,t){var n=f||e.containPoint(a);l(d.coordSysAxesInfo[t],function(e,t){var i=e.axis,r=b(_,e);if(!E&&n&&(!_||r)){var s=r&&r.value;null!=s||f||(s=i.pointToData(a)),null!=s&&h(e,s,I,!1,x)}})});var C={};return l(w,function(e,t){var n=e.linkGroup;n&&!A[t]&&l(n.axesInfo,function(t,i){var r=A[i];if(t!==e&&r){var a=r.value;n.mapper&&(a=e.axis.scale.parse(n.mapper(a,S(t),S(e)))),C[e.key]=a}})}),l(C,function(e,t){h(w[t],e,I,!0,x)}),m(A,w,x),v(k,a,e,c),y(w,c,n),x}}function h(e,t,n,r,a){var s=e.axis;if(!s.scale.isBlank()&&s.containData(t))if(e.involveSeries){var o=f(t,e),l=o.payloadBatch,u=o.snapToValue;l[0]&&null==a.seriesIndex&&i.extend(a,l[0]),!r&&e.snap&&s.containData(u)&&null!=u&&(t=u),n.showPointer(e,t,l,a),n.showTooltip(e,o,u)}else n.showPointer(e,t)}function f(e,t){var n=t.axis,i=n.dim,r=e,a=[],s=Number.MAX_VALUE,o=-1;return l(t.seriesModels,function(t,u){var c,d,h=t.getData().mapDimension(i,!0);if(t.getAxisTooltipData){var f=t.getAxisTooltipData(h,e,n);d=f.dataIndices,c=f.nestestValue}else{if(d=t.getData().indicesOfNearest(h[0],e,"category"===n.type?.5:null),!d.length)return;c=t.getData().get(h[0],d[0])}if(null!=c&&isFinite(c)){var p=e-c,g=Math.abs(p);g<=s&&((g<s||p>=0&&o<0)&&(s=g,o=p,r=c,a.length=0),l(d,function(e){a.push({seriesIndex:t.seriesIndex,dataIndexInside:e,dataIndex:t.getData().getRawIndex(e)})}))}}),{payloadBatch:a,snapToValue:r}}function p(e,t,n,i){e[t.key]={value:n,payloadBatch:i}}function g(e,t,n,i){var r=n.payloadBatch,a=t.axis,o=a.model,l=t.axisPointerModel;if(t.triggerTooltip&&r.length){var u=t.coordSys.model,c=s.makeKey(u),d=e.map[c];d||(d=e.map[c]={coordSysId:u.id,coordSysIndex:u.componentIndex,coordSysType:u.type,coordSysMainType:u.mainType,dataByAxis:[]},e.list.push(d)),d.dataByAxis.push({axisDim:a.dim,axisIndex:o.componentIndex,axisType:o.type,axisId:o.id,value:i,valueLabelOpt:{precision:l.get("label.precision"),formatter:l.get("label.formatter")},seriesDataIndices:r.slice()})}}function m(e,t,n){var i=n.axesInfo=[];l(t,function(t,n){var r=t.axisPointerModel.option,a=e[n];a?(!t.useHandle&&(r.status="show"),r.value=a.value,r.seriesDataIndices=(a.payloadBatch||[]).slice()):!t.useHandle&&(r.status="hide"),"show"===r.status&&i.push({axisDim:t.axis.dim,axisIndex:t.axis.model.componentIndex,value:r.value})})}function v(e,t,n,i){if(!T(t)&&e.list.length){var r=((e.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};i({type:"showTip",escapeConnect:!0,x:t[0],y:t[1],tooltipOption:n.tooltipOption,position:n.position,dataIndexInside:r.dataIndexInside,dataIndex:r.dataIndex,seriesIndex:r.seriesIndex,dataByCoordSys:e.list})}else i({type:"hideTip"})}function y(e,t,n){var r=n.getZr(),a="axisPointerLastHighlights",s=c(r)[a]||{},o=c(r)[a]={};l(e,function(e,t){var n=e.axisPointerModel.option;"show"===n.status&&l(n.seriesDataIndices,function(e){var t=e.seriesIndex+" | "+e.dataIndex;o[t]=e})});var u=[],d=[];i.each(s,function(e,t){!o[t]&&d.push(e)}),i.each(o,function(e,t){!s[t]&&u.push(e)}),d.length&&n.dispatchAction({type:"downplay",escapeConnect:!0,batch:d}),u.length&&n.dispatchAction({type:"highlight",escapeConnect:!0,batch:u})}function b(e,t){for(var n=0;n<(e||[]).length;n++){var i=e[n];if(t.axis.dim===i.axisDim&&t.axis.model.componentIndex===i.axisIndex)return i}}function S(e){var t=e.axis.model,n={},i=n.axisDim=e.axis.dim;return n.axisIndex=n[i+"AxisIndex"]=t.componentIndex,n.axisName=n[i+"AxisName"]=t.name,n.axisId=n[i+"AxisId"]=t.id,n}function T(e){return!e||null==e[0]||isNaN(e[0])||null==e[1]||isNaN(e[1])}e.exports=d},ebd6:function(e,t,n){var i=n("cb7c"),r=n("d8e8"),a=n("2b4c")("species");e.exports=function(e,t){var n,s=i(e).constructor;return void 0===s||void 0==(n=i(s)[a])?t:r(n)}},ec02:function(e,t,n){var i=n("6d8b"),r=n("84ce"),a=function(e,t,n,i,a){r.call(this,e,t,n),this.type=i||"value",this.position=a||"bottom"};a.prototype={constructor:a,index:0,getAxesOnZeroOf:null,model:null,isHorizontal:function(){var e=this.position;return"top"===e||"bottom"===e},getGlobalExtent:function(e){var t=this.getExtent();return t[0]=this.toGlobalCoord(t[0]),t[1]=this.toGlobalCoord(t[1]),e&&t[0]>t[1]&&t.reverse(),t},getOtherAxis:function(){this.grid.getOtherAxis()},pointToData:function(e,t){return this.coordToData(this.toLocalCoord(e["x"===this.dim?0:1]),t)},toLocalCoord:null,toGlobalCoord:null},i.inherits(a,r);var s=a;e.exports=s},ec6f:function(e,t,n){var i=n("6d8b"),r=i.createHashMap,a=i.isTypedArray,s=n("625e"),o=s.enableClassCheck,l=n("93d0"),u=l.SOURCE_FORMAT_ORIGINAL,c=l.SERIES_LAYOUT_BY_COLUMN,d=l.SOURCE_FORMAT_UNKNOWN,h=l.SOURCE_FORMAT_TYPED_ARRAY,f=l.SOURCE_FORMAT_KEYED_COLUMNS;function p(e){this.fromDataset=e.fromDataset,this.data=e.data||(e.sourceFormat===f?{}:[]),this.sourceFormat=e.sourceFormat||d,this.seriesLayoutBy=e.seriesLayoutBy||c,this.dimensionsDefine=e.dimensionsDefine,this.encodeDefine=e.encodeDefine&&r(e.encodeDefine),this.startIndex=e.startIndex||0,this.dimensionsDetectCount=e.dimensionsDetectCount}p.seriesDataToSource=function(e){return new p({data:e,sourceFormat:a(e)?h:u,fromDataset:!1})},o(p);var g=p;e.exports=g},ed21:function(e,t,n){var i=n("2cf4"),r=i.devicePixelRatio,a=n("6d8b"),s=n("4942"),o=n("9850"),l=n("04f6"),u=n("5e68"),c=n("98b7"),d=n("0da8"),h=n("22d1"),f=1e5,p=314159,g=.01,m=.001;function v(e){return parseInt(e,10)}function y(e){return!!e&&(!!e.__builtin__||"function"===typeof e.resize&&"function"===typeof e.refresh)}var b=new o(0,0,0,0),S=new o(0,0,0,0);function T(e,t,n){return b.copy(e.getBoundingRect()),e.transform&&b.applyTransform(e.transform),S.width=t,S.height=n,!b.intersect(S)}function _(e,t){if(e==t)return!1;if(!e||!t||e.length!==t.length)return!0;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!0}function w(e,t){for(var n=0;n<e.length;n++){var i=e[n];i.setTransform(t),t.beginPath(),i.buildPath(t,i.shape),t.clip(),i.restoreTransform(t)}}function E(e,t){var n=document.createElement("div");return n.style.cssText=["position:relative","overflow:hidden","width:"+e+"px","height:"+t+"px","padding:0","margin:0","border-width:0"].join(";")+";",n}var x=function(e,t,n){this.type="canvas";var i=!e.nodeName||"CANVAS"===e.nodeName.toUpperCase();this._opts=n=a.extend({},n||{}),this.dpr=n.devicePixelRatio||r,this._singleCanvas=i,this.root=e;var s=e.style;s&&(s["-webkit-tap-highlight-color"]="transparent",s["-webkit-user-select"]=s["user-select"]=s["-webkit-touch-callout"]="none",e.innerHTML=""),this.storage=t;var o=this._zlevelList=[],l=this._layers={};if(this._layerConfig={},this._needsManuallyCompositing=!1,i){var c=e.width,d=e.height;null!=n.width&&(c=n.width),null!=n.height&&(d=n.height),this.dpr=n.devicePixelRatio||1,e.width=c*this.dpr,e.height=d*this.dpr,this._width=c,this._height=d;var h=new u(e,this,this.dpr);h.__builtin__=!0,h.initContext(),l[p]=h,h.zlevel=p,o.push(p),this._domRoot=e}else{this._width=this._getSize(0),this._height=this._getSize(1);var f=this._domRoot=E(this._width,this._height);e.appendChild(f)}this._hoverlayer=null,this._hoverElements=[]};x.prototype={constructor:x,getType:function(){return"canvas"},isSingleCanvas:function(){return this._singleCanvas},getViewportRoot:function(){return this._domRoot},getViewportRootOffset:function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},refresh:function(e){var t=this.storage.getDisplayList(!0),n=this._zlevelList;this._redrawId=Math.random(),this._paintList(t,e,this._redrawId);for(var i=0;i<n.length;i++){var r=n[i],a=this._layers[r];if(!a.__builtin__&&a.refresh){var s=0===i?this._backgroundColor:null;a.refresh(s)}}return this.refreshHover(),this},addHover:function(e,t){if(!e.__hoverMir){var n=new e.constructor({style:e.style,shape:e.shape});n.__from=e,e.__hoverMir=n,n.setStyle(t),this._hoverElements.push(n)}},removeHover:function(e){var t=e.__hoverMir,n=this._hoverElements,i=a.indexOf(n,t);i>=0&&n.splice(i,1),e.__hoverMir=null},clearHover:function(e){for(var t=this._hoverElements,n=0;n<t.length;n++){var i=t[n].__from;i&&(i.__hoverMir=null)}t.length=0},refreshHover:function(){var e=this._hoverElements,t=e.length,n=this._hoverlayer;if(n&&n.clear(),t){l(e,this.storage.displayableSortFunc),n||(n=this._hoverlayer=this.getLayer(f));var i={};n.ctx.save();for(var r=0;r<t;){var a=e[r],s=a.__from;s&&s.__zr?(r++,s.invisible||(a.transform=s.transform,a.invTransform=s.invTransform,a.__clipPaths=s.__clipPaths,this._doPaintEl(a,n,!0,i))):(e.splice(r,1),s.__hoverMir=null,t--)}n.ctx.restore()}},getHoverLayer:function(){return this.getLayer(f)},_paintList:function(e,t,n){if(this._redrawId===n){t=t||!1,this._updateLayerStatus(e);var i=this._doPaintList(e,t);if(this._needsManuallyCompositing&&this._compositeManually(),!i){var r=this;c(function(){r._paintList(e,t,n)})}}},_compositeManually:function(){var e=this.getLayer(p).ctx,t=this._domRoot.width,n=this._domRoot.height;e.clearRect(0,0,t,n),this.eachBuiltinLayer(function(i){i.virtual&&e.drawImage(i.dom,0,0,t,n)})},_doPaintList:function(e,t){for(var n=[],i=0;i<this._zlevelList.length;i++){var r=this._zlevelList[i],s=this._layers[r];s.__builtin__&&s!==this._hoverlayer&&(s.__dirty||t)&&n.push(s)}for(var o=!0,l=0;l<n.length;l++){s=n[l];var u=s.ctx,c={};u.save();var d=t?s.__startIndex:s.__drawIndex,f=!t&&s.incremental&&Date.now,p=f&&Date.now(),g=s.zlevel===this._zlevelList[0]?this._backgroundColor:null;if(s.__startIndex===s.__endIndex)s.clear(!1,g);else if(d===s.__startIndex){var m=e[d];m.incremental&&m.notClear&&!t||s.clear(!1,g)}-1===d&&(console.error("For some unknown reason. drawIndex is -1"),d=s.__startIndex);for(var v=d;v<s.__endIndex;v++){var y=e[v];if(this._doPaintEl(y,s,t,c),y.__dirty=!1,f){var b=Date.now()-p;if(b>15)break}}s.__drawIndex=v,s.__drawIndex<s.__endIndex&&(o=!1),c.prevElClipPaths&&u.restore(),u.restore()}return h.wxa&&a.each(this._layers,function(e){e&&e.ctx&&e.ctx.draw&&e.ctx.draw()}),o},_doPaintEl:function(e,t,n,i){var r=t.ctx,a=e.transform;if((t.__dirty||n)&&!e.invisible&&0!==e.style.opacity&&(!a||a[0]||a[3])&&(!e.culling||!T(e,this._width,this._height))){var s=e.__clipPaths;i.prevElClipPaths&&!_(s,i.prevElClipPaths)||(i.prevElClipPaths&&(t.ctx.restore(),i.prevElClipPaths=null,i.prevEl=null),s&&(r.save(),w(s,r),i.prevElClipPaths=s)),e.beforeBrush&&e.beforeBrush(r),e.brush(r,i.prevEl||null),i.prevEl=e,e.afterBrush&&e.afterBrush(r)}},getLayer:function(e,t){this._singleCanvas&&!this._needsManuallyCompositing&&(e=p);var n=this._layers[e];return n||(n=new u("zr_"+e,this,this.dpr),n.zlevel=e,n.__builtin__=!0,this._layerConfig[e]&&a.merge(n,this._layerConfig[e],!0),t&&(n.virtual=t),this.insertLayer(e,n),n.initContext()),n},insertLayer:function(e,t){var n=this._layers,i=this._zlevelList,r=i.length,a=null,o=-1,l=this._domRoot;if(n[e])s("ZLevel "+e+" has been used already");else if(y(t)){if(r>0&&e>i[0]){for(o=0;o<r-1;o++)if(i[o]<e&&i[o+1]>e)break;a=n[i[o]]}if(i.splice(o+1,0,e),n[e]=t,!t.virtual)if(a){var u=a.dom;u.nextSibling?l.insertBefore(t.dom,u.nextSibling):l.appendChild(t.dom)}else l.firstChild?l.insertBefore(t.dom,l.firstChild):l.appendChild(t.dom)}else s("Layer of zlevel "+e+" is not valid")},eachLayer:function(e,t){var n,i,r=this._zlevelList;for(i=0;i<r.length;i++)n=r[i],e.call(t,this._layers[n],n)},eachBuiltinLayer:function(e,t){var n,i,r,a=this._zlevelList;for(r=0;r<a.length;r++)i=a[r],n=this._layers[i],n.__builtin__&&e.call(t,n,i)},eachOtherLayer:function(e,t){var n,i,r,a=this._zlevelList;for(r=0;r<a.length;r++)i=a[r],n=this._layers[i],n.__builtin__||e.call(t,n,i)},getLayers:function(){return this._layers},_updateLayerStatus:function(e){function t(e){r&&(r.__endIndex!==e&&(r.__dirty=!0),r.__endIndex=e)}if(this.eachBuiltinLayer(function(e,t){e.__dirty=e.__used=!1}),this._singleCanvas)for(var n=1;n<e.length;n++){var i=e[n];if(i.zlevel!==e[n-1].zlevel||i.incremental){this._needsManuallyCompositing=!0;break}}var r=null,a=0;for(n=0;n<e.length;n++){i=e[n];var o,l=i.zlevel;i.incremental?(o=this.getLayer(l+m,this._needsManuallyCompositing),o.incremental=!0,a=1):o=this.getLayer(l+(a>0?g:0),this._needsManuallyCompositing),o.__builtin__||s("ZLevel "+l+" has been used by unkown layer "+o.id),o!==r&&(o.__used=!0,o.__startIndex!==n&&(o.__dirty=!0),o.__startIndex=n,o.incremental?o.__drawIndex=-1:o.__drawIndex=n,t(n),r=o),i.__dirty&&(o.__dirty=!0,o.incremental&&o.__drawIndex<0&&(o.__drawIndex=n))}t(n),this.eachBuiltinLayer(function(e,t){!e.__used&&e.getElementCount()>0&&(e.__dirty=!0,e.__startIndex=e.__endIndex=e.__drawIndex=0),e.__dirty&&e.__drawIndex<0&&(e.__drawIndex=e.__startIndex)})},clear:function(){return this.eachBuiltinLayer(this._clearLayer),this},_clearLayer:function(e){e.clear()},setBackgroundColor:function(e){this._backgroundColor=e},configLayer:function(e,t){if(t){var n=this._layerConfig;n[e]?a.merge(n[e],t,!0):n[e]=t;for(var i=0;i<this._zlevelList.length;i++){var r=this._zlevelList[i];if(r===e||r===e+g){var s=this._layers[r];a.merge(s,n[e],!0)}}}},delLayer:function(e){var t=this._layers,n=this._zlevelList,i=t[e];i&&(i.dom.parentNode.removeChild(i.dom),delete t[e],n.splice(a.indexOf(n,e),1))},resize:function(e,t){if(this._domRoot.style){var n=this._domRoot;n.style.display="none";var i=this._opts;if(null!=e&&(i.width=e),null!=t&&(i.height=t),e=this._getSize(0),t=this._getSize(1),n.style.display="",this._width!=e||t!=this._height){for(var r in n.style.width=e+"px",n.style.height=t+"px",this._layers)this._layers.hasOwnProperty(r)&&this._layers[r].resize(e,t);a.each(this._progressiveLayers,function(n){n.resize(e,t)}),this.refresh(!0)}this._width=e,this._height=t}else{if(null==e||null==t)return;this._width=e,this._height=t,this.getLayer(p).resize(e,t)}return this},clearLayer:function(e){var t=this._layers[e];t&&t.clear()},dispose:function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},getRenderedCanvas:function(e){if(e=e||{},this._singleCanvas&&!this._compositeManually)return this._layers[p].dom;var t=new u("image",this,e.pixelRatio||this.dpr);if(t.initContext(),t.clear(!1,e.backgroundColor||this._backgroundColor),e.pixelRatio<=this.dpr){this.refresh();var n=t.dom.width,i=t.dom.height,r=t.ctx;this.eachLayer(function(e){e.__builtin__?r.drawImage(e.dom,0,0,n,i):e.renderToCanvas&&(t.ctx.save(),e.renderToCanvas(t.ctx),t.ctx.restore())})}else for(var a={},s=this.storage.getDisplayList(!0),o=0;o<s.length;o++){var l=s[o];this._doPaintEl(l,t,!0,a)}return t.dom},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(e){var t=this._opts,n=["width","height"][e],i=["clientWidth","clientHeight"][e],r=["paddingLeft","paddingTop"][e],a=["paddingRight","paddingBottom"][e];if(null!=t[n]&&"auto"!==t[n])return parseFloat(t[n]);var s=this.root,o=document.defaultView.getComputedStyle(s);return(s[i]||v(o[n])||v(s.style[n]))-(v(o[r])||0)-(v(o[a])||0)|0},pathToImage:function(e,t){t=t||this.dpr;var n=document.createElement("canvas"),i=n.getContext("2d"),r=e.getBoundingRect(),a=e.style,s=a.shadowBlur*t,o=a.shadowOffsetX*t,l=a.shadowOffsetY*t,u=a.hasStroke()?a.lineWidth:0,c=Math.max(u/2,-o+s),h=Math.max(u/2,o+s),f=Math.max(u/2,-l+s),p=Math.max(u/2,l+s),g=r.width+c+h,m=r.height+f+p;n.width=g*t,n.height=m*t,i.scale(t,t),i.clearRect(0,0,g,m),i.dpr=t;var v={position:e.position,rotation:e.rotation,scale:e.scale};e.position=[c-r.x,f-r.y],e.rotation=0,e.scale=[1,1],e.updateTransform(),e&&e.brush(i);var y=d,b=new y({style:{x:0,y:0,image:n}});return null!=v.position&&(b.position=e.position=v.position),null!=v.rotation&&(b.rotation=e.rotation=v.rotation),null!=v.scale&&(b.scale=e.scale=v.scale),b}};var A=x;e.exports=A},eda2:function(e,t,n){var i=n("6d8b"),r=n("e86a"),a=n("3842");function s(e){return isNaN(e)?"-":(e=(e+"").split("."),e[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(e.length>1?"."+e[1]:""))}function o(e,t){return e=(e||"").toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()}),t&&e&&(e=e.charAt(0).toUpperCase()+e.slice(1)),e}var l=i.normalizeCssArray,u=/([&<>"'])/g,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function d(e){return null==e?"":(e+"").replace(u,function(e,t){return c[t]})}var h=["a","b","c","d","e","f","g"],f=function(e,t){return"{"+e+(null==t?"":t)+"}"};function p(e,t,n){i.isArray(t)||(t=[t]);var r=t.length;if(!r)return"";for(var a=t[0].$vars||[],s=0;s<a.length;s++){var o=h[s];e=e.replace(f(o),f(o,0))}for(var l=0;l<r;l++)for(var u=0;u<a.length;u++){var c=t[l][a[u]];e=e.replace(f(h[u],l),n?d(c):c)}return e}function g(e,t,n){return i.each(t,function(t,i){e=e.replace("{"+i+"}",n?d(t):t)}),e}function m(e,t){e=i.isString(e)?{color:e,extraCssText:t}:e||{};var n=e.color,r=e.type;t=e.extraCssText;return n?"subItem"===r?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+d(n)+";"+(t||"")+'"></span>':'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+d(n)+";"+(t||"")+'"></span>':""}function v(e,t){return e+="","0000".substr(0,t-e.length)+e}function y(e,t,n){"week"!==e&&"month"!==e&&"quarter"!==e&&"half-year"!==e&&"year"!==e||(e="MM-dd\nyyyy");var i=a.parseDate(t),r=n?"UTC":"",s=i["get"+r+"FullYear"](),o=i["get"+r+"Month"]()+1,l=i["get"+r+"Date"](),u=i["get"+r+"Hours"](),c=i["get"+r+"Minutes"](),d=i["get"+r+"Seconds"](),h=i["get"+r+"Milliseconds"]();return e=e.replace("MM",v(o,2)).replace("M",o).replace("yyyy",s).replace("yy",s%100).replace("dd",v(l,2)).replace("d",l).replace("hh",v(u,2)).replace("h",u).replace("mm",v(c,2)).replace("m",c).replace("ss",v(d,2)).replace("s",d).replace("SSS",v(h,3)),e}function b(e){return e?e.charAt(0).toUpperCase()+e.substr(1):e}var S=r.truncateText,T=r.getBoundingRect;t.addCommas=s,t.toCamelCase=o,t.normalizeCssArray=l,t.encodeHTML=d,t.formatTpl=p,t.formatTplSimple=g,t.getTooltipMarker=m,t.formatTime=y,t.capitalFirst=b,t.truncateText=S,t.getTextRect=T},ee1a:function(e,t,n){var i=n("6d8b"),r=i.each,a=i.isString;function s(e,t,n){n=n||{};var i,s,o,l,u=n.byIndex,c=n.stackedCoordDimension,d=!(!e||!e.get("stack"));if(r(t,function(e,n){a(e)&&(t[n]=e={name:e}),d&&!e.isExtraCoord&&(u||i||!e.ordinalMeta||(i=e),s||"ordinal"===e.type||"time"===e.type||c&&c!==e.coordDim||(s=e))}),!s||u||i||(u=!0),s){o="__\0ecstackresult",l="__\0ecstackedover",i&&(i.createInvertedIndices=!0);var h=s.coordDim,f=s.type,p=0;r(t,function(e){e.coordDim===h&&p++}),t.push({name:o,coordDim:h,coordDimIndex:p,type:f,isExtraCoord:!0,isCalculationCoord:!0}),p++,t.push({name:l,coordDim:l,coordDimIndex:p,type:f,isExtraCoord:!0,isCalculationCoord:!0})}return{stackedDimension:s&&s.name,stackedByDimension:i&&i.name,isStackedByIndex:u,stackedOverDimension:l,stackResultDimension:o}}function o(e,t){return!!t&&t===e.getCalculationInfo("stackedDimension")}function l(e,t){return o(e,t)?e.getCalculationInfo("stackResultDimension"):t}t.enableDataStack=s,t.isDimensionStacked=o,t.getStackedDimension=l},ee84:function(e,t,n){var i=n("20c8"),r=n("401b"),a=r.applyTransform,s=i.CMD,o=[[],[],[]],l=Math.sqrt,u=Math.atan2;function c(e,t){var n,i,r,c,d,h=e.data,f=s.M,p=s.C,g=s.L,m=s.R,v=s.A,y=s.Q;for(r=0,c=0;r<h.length;){switch(n=h[r++],c=r,i=0,n){case f:i=1;break;case g:i=1;break;case p:i=3;break;case y:i=2;break;case v:var b=t[4],S=t[5],T=l(t[0]*t[0]+t[1]*t[1]),_=l(t[2]*t[2]+t[3]*t[3]),w=u(-t[1]/_,t[0]/T);h[r]*=T,h[r++]+=b,h[r]*=_,h[r++]+=S,h[r++]*=T,h[r++]*=_,h[r++]+=w,h[r++]+=w,r+=2,c=r;break;case m:E[0]=h[r++],E[1]=h[r++],a(E,E,t),h[c++]=E[0],h[c++]=E[1],E[0]+=h[r++],E[1]+=h[r++],a(E,E,t),h[c++]=E[0],h[c++]=E[1]}for(d=0;d<i;d++){var E=o[d];E[0]=h[r++],E[1]=h[r++],a(E,E,t),h[c++]=E[0],h[c++]=E[1]}}}e.exports=c},ef6a:function(e,t){function n(e,t,n,a,s,o){t[0]=r(t[0],n),t[1]=r(t[1],n),e=e||0;var l=n[1]-n[0];null!=s&&(s=r(s,[0,l])),null!=o&&(o=Math.max(o,null!=s?s:0)),"all"===a&&(s=o=Math.abs(t[1]-t[0]),a=0);var u=i(t,a);t[a]+=e;var c=s||0,d=n.slice();u.sign<0?d[0]+=c:d[1]-=c,t[a]=r(t[a],d);var h=i(t,a);null!=s&&(h.sign!==u.sign||h.span<s)&&(t[1-a]=t[a]+u.sign*s);h=i(t,a);return null!=o&&h.span>o&&(t[1-a]=t[a]+h.sign*o),t}function i(e,t){var n=e[t]-e[1-t];return{span:Math.abs(n),sign:n>0?-1:n<0?1:t?-1:1}}function r(e,t){return Math.min(t[1],Math.max(t[0],e))}e.exports=n},ef97:function(e,t,n){var i=n("3eba");n("217b"),n("f17f");var r=n("7f96"),a=n("87c3"),s=n("fdde");n("01ed"),i.registerVisual(r("line","circle","line")),i.registerLayout(a("line")),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,s("line"))},f123:function(e,t,n){var i=n("9f82"),r=i.prepareDataCoordInfo,a=i.getStackedOnPoint;function s(e,t){var n=[];return t.diff(e).add(function(e){n.push({cmd:"+",idx:e})}).update(function(e,t){n.push({cmd:"=",idx:t,idx1:e})}).remove(function(e){n.push({cmd:"-",idx:e})}).execute(),n}function o(e,t,n,i,o,l,u,c){for(var d=s(e,t),h=[],f=[],p=[],g=[],m=[],v=[],y=[],b=r(o,t,u),S=r(l,e,c),T=0;T<d.length;T++){var _=d[T],w=!0;switch(_.cmd){case"=":var E=e.getItemLayout(_.idx),x=t.getItemLayout(_.idx1);(isNaN(E[0])||isNaN(E[1]))&&(E=x.slice()),h.push(E),f.push(x),p.push(n[_.idx]),g.push(i[_.idx1]),y.push(t.getRawIndex(_.idx1));break;case"+":var A=_.idx;h.push(o.dataToPoint([t.get(b.dataDimsForPoint[0],A),t.get(b.dataDimsForPoint[1],A)])),f.push(t.getItemLayout(A).slice()),p.push(a(b,o,t,A)),g.push(i[A]),y.push(t.getRawIndex(A));break;case"-":A=_.idx;var k=e.getRawIndex(A);k!==A?(h.push(e.getItemLayout(A)),f.push(l.dataToPoint([e.get(S.dataDimsForPoint[0],A),e.get(S.dataDimsForPoint[1],A)])),p.push(n[A]),g.push(a(S,l,e,A)),y.push(k)):w=!1}w&&(m.push(_),v.push(v.length))}v.sort(function(e,t){return y[e]-y[t]});var I=[],C=[],R=[],M=[],D=[];for(T=0;T<v.length;T++){A=v[T];I[T]=h[A],C[T]=f[A],R[T]=p[A],M[T]=g[A],D[T]=m[A]}return{current:I,next:C,stackedOnCurrent:R,stackedOnNext:M,status:D}}e.exports=o},f17f:function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=n("f706"),s=n("1418"),o=n("f123"),l=n("2306"),u=n("e0d3"),c=n("d4d1"),d=c.Polyline,h=c.Polygon,f=n("e887"),p=n("3842"),g=p.round,m=n("9f82"),v=m.prepareDataCoordInfo,y=m.getStackedOnPoint;function b(e,t){if(e.length===t.length){for(var n=0;n<e.length;n++){var i=e[n],r=t[n];if(i[0]!==r[0]||i[1]!==r[1])return}return!0}}function S(e){return"number"===typeof e?e:e?.5:0}function T(e){var t=e.getGlobalExtent();if(e.onBand){var n=e.getBandWidth()/2-1,i=t[1]>t[0]?1:-1;t[0]+=i*n,t[1]-=i*n}return t}function _(e,t,n){if(!n.valueDim)return[];for(var i=[],r=0,a=t.count();r<a;r++)i.push(y(n,e,t,r));return i}function w(e,t,n,i){var r=T(e.getAxis("x")),a=T(e.getAxis("y")),s=e.getBaseAxis().isHorizontal(),o=Math.min(r[0],r[1]),u=Math.min(a[0],a[1]),c=Math.max(r[0],r[1])-o,d=Math.max(a[0],a[1])-u;if(n)o-=.5,c+=.5,u-=.5,d+=.5;else{var h=i.get("lineStyle.width")||2,f=i.get("clipOverflow")?h/2:Math.max(c,d);s?(u-=f,d+=2*f):(o-=f,c+=2*f)}var p=new l.Rect({shape:{x:o,y:u,width:c,height:d}});return t&&(p.shape[s?"width":"height"]=0,l.initProps(p,{shape:{width:c,height:d}},i)),p}function E(e,t,n,i){var r=e.getAngleAxis(),a=e.getRadiusAxis(),s=a.getExtent().slice();s[0]>s[1]&&s.reverse();var o=r.getExtent(),u=Math.PI/180;n&&(s[0]-=.5,s[1]+=.5);var c=new l.Sector({shape:{cx:g(e.cx,1),cy:g(e.cy,1),r0:g(s[0],1),r:g(s[1],1),startAngle:-o[0]*u,endAngle:-o[1]*u,clockwise:r.inverse}});return t&&(c.shape.endAngle=-o[0]*u,l.initProps(c,{shape:{endAngle:-o[1]*u}},i)),c}function x(e,t,n,i){return"polar"===e.type?E(e,t,n,i):w(e,t,n,i)}function A(e,t,n){for(var i=t.getBaseAxis(),r="x"===i.dim||"radius"===i.dim?0:1,a=[],s=0;s<e.length-1;s++){var o=e[s+1],l=e[s];a.push(l);var u=[];switch(n){case"end":u[r]=o[r],u[1-r]=l[1-r],a.push(u);break;case"middle":var c=(l[r]+o[r])/2,d=[];u[r]=d[r]=c,u[1-r]=l[1-r],d[1-r]=o[1-r],a.push(u),a.push(d);break;default:u[r]=l[r],u[1-r]=o[1-r],a.push(u)}}return e[s]&&a.push(e[s]),a}function k(e,t){var n=e.getVisual("visualMeta");if(n&&n.length&&e.count()&&"cartesian2d"===t.type){for(var i,a,s=n.length-1;s>=0;s--){var o=n[s].dimension,u=e.dimensions[o],c=e.getDimensionInfo(u);if(i=c&&c.coordDim,"x"===i||"y"===i){a=n[s];break}}if(a){var d=t.getAxis(i),h=r.map(a.stops,function(e){return{coord:d.toGlobalCoord(d.dataToCoord(e.value)),color:e.color}}),f=h.length,p=a.outerColors.slice();f&&h[0].coord>h[f-1].coord&&(h.reverse(),p.reverse());var g=10,m=h[0].coord-g,v=h[f-1].coord+g,y=v-m;if(y<.001)return"transparent";r.each(h,function(e){e.offset=(e.coord-m)/y}),h.push({offset:f?h[f-1].offset:.5,color:p[1]||"transparent"}),h.unshift({offset:f?h[0].offset:.5,color:p[0]||"transparent"});var b=new l.LinearGradient(0,0,0,0,h,!0);return b[i]=m,b[i+"2"]=v,b}}}function I(e,t,n){var i=e.get("showAllSymbol"),a="auto"===i;if(!i||a){var s=n.getAxesByScale("ordinal")[0];if(s&&(!a||!C(s,t))){var o=t.mapDimension(s.dim),l={};return r.each(s.getViewLabels(),function(e){l[e.tickValue]=1}),function(e){return!l.hasOwnProperty(t.get(o,e))}}}}function C(e,t){var n=e.getExtent(),i=Math.abs(n[1]-n[0])/e.scale.count();isNaN(i)&&(i=0);for(var r=t.count(),a=Math.max(1,Math.round(r/5)),o=0;o<r;o+=a)if(1.5*s.getSymbolSize(t,o)[e.isHorizontal()?1:0]>i)return!1;return!0}var R=f.extend({type:"line",init:function(){var e=new l.Group,t=new a;this.group.add(t.group),this._symbolDraw=t,this._lineGroup=e},render:function(e,t,n){var i=e.coordinateSystem,a=this.group,s=e.getData(),o=e.getModel("lineStyle"),l=e.getModel("areaStyle"),u=s.mapArray(s.getItemLayout),c="polar"===i.type,d=this._coordSys,h=this._symbolDraw,f=this._polyline,p=this._polygon,g=this._lineGroup,m=e.get("animation"),y=!l.isEmpty(),T=l.get("origin"),w=v(i,s,T),E=_(i,s,w),C=e.get("showSymbol"),R=C&&!c&&I(e,s,i),M=this._data;M&&M.eachItemGraphicEl(function(e,t){e.__temp&&(a.remove(e),M.setItemGraphicEl(t,null))}),C||h.remove(),a.add(g);var D=!c&&e.get("step");f&&d.type===i.type&&D===this._step?(y&&!p?p=this._newPolygon(u,E,i,m):p&&!y&&(g.remove(p),p=this._polygon=null),g.setClipPath(x(i,!1,!1,e)),C&&h.updateData(s,{isIgnore:R,clipShape:x(i,!1,!0,e)}),s.eachItemGraphicEl(function(e){e.stopAnimation(!0)}),b(this._stackedOnPoints,E)&&b(this._points,u)||(m?this._updateAnimation(s,E,i,n,D,T):(D&&(u=A(u,i,D),E=A(E,i,D)),f.setShape({points:u}),p&&p.setShape({points:u,stackedOnPoints:E})))):(C&&h.updateData(s,{isIgnore:R,clipShape:x(i,!1,!0,e)}),D&&(u=A(u,i,D),E=A(E,i,D)),f=this._newPolyline(u,i,m),y&&(p=this._newPolygon(u,E,i,m)),g.setClipPath(x(i,!0,!1,e)));var L=k(s,i)||s.getVisual("color");f.useStyle(r.defaults(o.getLineStyle(),{fill:"none",stroke:L,lineJoin:"bevel"}));var P=e.get("smooth");if(P=S(e.get("smooth")),f.setShape({smooth:P,smoothMonotone:e.get("smoothMonotone"),connectNulls:e.get("connectNulls")}),p){var O=s.getCalculationInfo("stackedOnSeries"),N=0;p.useStyle(r.defaults(l.getAreaStyle(),{fill:L,opacity:.7,lineJoin:"bevel"})),O&&(N=S(O.get("smooth"))),p.setShape({smooth:P,stackedOnSmooth:N,smoothMonotone:e.get("smoothMonotone"),connectNulls:e.get("connectNulls")})}this._data=s,this._coordSys=i,this._stackedOnPoints=E,this._points=u,this._step=D,this._valueOrigin=T},dispose:function(){},highlight:function(e,t,n,i){var r=e.getData(),a=u.queryDataIndex(r,i);if(!(a instanceof Array)&&null!=a&&a>=0){var o=r.getItemGraphicEl(a);if(!o){var l=r.getItemLayout(a);if(!l)return;o=new s(r,a),o.position=l,o.setZ(e.get("zlevel"),e.get("z")),o.ignore=isNaN(l[0])||isNaN(l[1]),o.__temp=!0,r.setItemGraphicEl(a,o),o.stopSymbolAnimation(!0),this.group.add(o)}o.highlight()}else f.prototype.highlight.call(this,e,t,n,i)},downplay:function(e,t,n,i){var r=e.getData(),a=u.queryDataIndex(r,i);if(null!=a&&a>=0){var s=r.getItemGraphicEl(a);s&&(s.__temp?(r.setItemGraphicEl(a,null),this.group.remove(s)):s.downplay())}else f.prototype.downplay.call(this,e,t,n,i)},_newPolyline:function(e){var t=this._polyline;return t&&this._lineGroup.remove(t),t=new d({shape:{points:e},silent:!0,z2:10}),this._lineGroup.add(t),this._polyline=t,t},_newPolygon:function(e,t){var n=this._polygon;return n&&this._lineGroup.remove(n),n=new h({shape:{points:e,stackedOnPoints:t},silent:!0}),this._lineGroup.add(n),this._polygon=n,n},_updateAnimation:function(e,t,n,i,r,a){var s=this._polyline,u=this._polygon,c=e.hostModel,d=o(this._data,e,this._stackedOnPoints,t,this._coordSys,n,this._valueOrigin,a),h=d.current,f=d.stackedOnCurrent,p=d.next,g=d.stackedOnNext;r&&(h=A(d.current,n,r),f=A(d.stackedOnCurrent,n,r),p=A(d.next,n,r),g=A(d.stackedOnNext,n,r)),s.shape.__points=d.current,s.shape.points=h,l.updateProps(s,{shape:{points:p}},c),u&&(u.setShape({points:h,stackedOnPoints:f}),l.updateProps(u,{shape:{points:p,stackedOnPoints:g}},c));for(var m=[],v=d.status,y=0;y<v.length;y++){var b=v[y].cmd;if("="===b){var S=e.getItemGraphicEl(v[y].idx1);S&&m.push({el:S,ptIdx:y})}}s.animators&&s.animators.length&&s.animators[0].during(function(){for(var e=0;e<m.length;e++){var t=m[e].el;t.attr("position",s.shape.__points[m[e].ptIdx])}})},remove:function(e){var t=this.group,n=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),n&&n.eachItemGraphicEl(function(e,i){e.__temp&&(t.remove(e),n.setItemGraphicEl(i,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._data=null}});e.exports=R},f219:function(e,t){var n="#eee",i=function(){return{axisLine:{lineStyle:{color:n}},axisTick:{lineStyle:{color:n}},axisLabel:{textStyle:{color:n}},splitLine:{lineStyle:{type:"dashed",color:"#aaa"}},splitArea:{areaStyle:{color:n}}}},r=["#dd6b66","#759aa0","#e69d87","#8dc1a9","#ea7e53","#eedd78","#73a373","#73b9bc","#7289ab","#91ca8c","#f49f42"],a={color:r,backgroundColor:"#333",tooltip:{axisPointer:{lineStyle:{color:n},crossStyle:{color:n}}},legend:{textStyle:{color:n}},textStyle:{color:n},title:{textStyle:{color:n}},toolbox:{iconStyle:{normal:{borderColor:n}}},dataZoom:{textStyle:{color:n}},visualMap:{textStyle:{color:n}},timeline:{lineStyle:{color:n},itemStyle:{normal:{color:r[1]}},label:{normal:{textStyle:{color:n}}},controlStyle:{normal:{color:n,borderColor:n}}},timeAxis:i(),logAxis:i(),valueAxis:i(),categoryAxis:i(),line:{symbol:"circle"},graph:{color:r},gauge:{title:{textStyle:{color:n}}},candlestick:{itemStyle:{normal:{color:"#FD1050",color0:"#0CF49B",borderColor:"#FD1050",borderColor0:"#0CF49B"}}}};a.categoryAxis.splitLine.show=!1;var s=a;e.exports=s},f273:function(e,t,n){var i=n("6d8b"),r=n("2306"),a=n("fab22"),s=n("6679"),o=n("0156"),l=["axisLine","axisTickLabel","axisName"],u=["splitArea","splitLine"],c=s.extend({type:"cartesianAxis",axisPointerClass:"CartesianAxisPointer",render:function(e,t,n,s){this.group.removeAll();var d=this._axisGroup;if(this._axisGroup=new r.Group,this.group.add(this._axisGroup),e.get("show")){var h=e.getCoordSysModel(),f=o.layout(h,e),p=new a(e,f);i.each(l,p.add,p),this._axisGroup.add(p.getGroup()),i.each(u,function(t){e.get(t+".show")&&this["_"+t](e,h)},this),r.groupTransition(d,this._axisGroup,e),c.superCall(this,"render",e,t,n,s)}},remove:function(){this._splitAreaColors=null},_splitLine:function(e,t){var n=e.axis;if(!n.scale.isBlank()){var a=e.getModel("splitLine"),s=a.getModel("lineStyle"),o=s.get("color");o=i.isArray(o)?o:[o];for(var l=t.coordinateSystem.getRect(),u=n.isHorizontal(),c=0,d=n.getTicksCoords({tickModel:a}),h=[],f=[],p=s.getLineStyle(),g=0;g<d.length;g++){var m=n.toGlobalCoord(d[g].coord);u?(h[0]=m,h[1]=l.y,f[0]=m,f[1]=l.y+l.height):(h[0]=l.x,h[1]=m,f[0]=l.x+l.width,f[1]=m);var v=c++%o.length,y=d[g].tickValue;this._axisGroup.add(new r.Line(r.subPixelOptimizeLine({anid:null!=y?"line_"+d[g].tickValue:null,shape:{x1:h[0],y1:h[1],x2:f[0],y2:f[1]},style:i.defaults({stroke:o[v]},p),silent:!0})))}}},_splitArea:function(e,t){var n=e.axis;if(!n.scale.isBlank()){var a=e.getModel("splitArea"),s=a.getModel("areaStyle"),o=s.get("color"),l=t.coordinateSystem.getRect(),u=n.getTicksCoords({tickModel:a,clamp:!0});if(u.length){var c=o.length,d=this._splitAreaColors,h=i.createHashMap(),f=0;if(d)for(var p=0;p<u.length;p++){var g=d.get(u[p].tickValue);if(null!=g){f=(g+(c-1)*p)%c;break}}var m=n.toGlobalCoord(u[0].coord),v=s.getAreaStyle();o=i.isArray(o)?o:[o];for(p=1;p<u.length;p++){var y,b,S,T,_=n.toGlobalCoord(u[p].coord);n.isHorizontal()?(y=m,b=l.y,S=_-y,T=l.height,m=y+S):(y=l.x,b=m,S=l.width,T=_-b,m=b+T);var w=u[p-1].tickValue;null!=w&&h.set(w,f),this._axisGroup.add(new r.Rect({anid:null!=w?"area_"+w:null,shape:{x:y,y:b,width:S,height:T},style:i.defaults({fill:o[f]},v),silent:!0})),f=(f+1)%c}this._splitAreaColors=h}}}});c.extend({type:"xAxis"}),c.extend({type:"yAxis"})},f279:function(e,t,n){var i=n("9850"),r=n("e263"),a=n("401b"),s=n("0655");function o(e,t,n){if(this.name=e,this.geometries=t,n)n=[n[0],n[1]];else{var i=this.getBoundingRect();n=[i.x+i.width/2,i.y+i.height/2]}this.center=n}o.prototype={constructor:o,properties:null,getBoundingRect:function(){var e=this._rect;if(e)return e;for(var t=Number.MAX_VALUE,n=[t,t],s=[-t,-t],o=[],l=[],u=this.geometries,c=0;c<u.length;c++)if("polygon"===u[c].type){var d=u[c].exterior;r.fromPoints(d,o,l),a.min(n,n,o),a.max(s,s,l)}return 0===c&&(n[0]=n[1]=s[0]=s[1]=0),this._rect=new i(n[0],n[1],s[0]-n[0],s[1]-n[1])},contain:function(e){var t=this.getBoundingRect(),n=this.geometries;if(!t.contain(e[0],e[1]))return!1;e:for(var i=0,r=n.length;i<r;i++)if("polygon"===n[i].type){var a=n[i].exterior,o=n[i].interiors;if(s.contain(a,e[0],e[1])){for(var l=0;l<(o?o.length:0);l++)if(s.contain(o[l]))continue e;return!0}}return!1},transformTo:function(e,t,n,r){var s=this.getBoundingRect(),o=s.width/s.height;n?r||(r=n/o):n=o*r;for(var l=new i(e,t,n,r),u=s.calculateTransform(l),c=this.geometries,d=0;d<c.length;d++)if("polygon"===c[d].type){for(var h=c[d].exterior,f=c[d].interiors,p=0;p<h.length;p++)a.applyTransform(h[p],h[p],u);for(var g=0;g<(f?f.length:0);g++)for(p=0;p<f[g].length;p++)a.applyTransform(f[g][p],f[g][p],u)}s=this._rect,s.copy(l),this.center=[s.x+s.width/2,s.y+s.height/2]}};var l=o;e.exports=l},f47d:function(e,t,n){var i=n("6d8b"),r=(i.assert,i.isArray),a=n("4e08");a.__DEV__;function s(e){return new o(e)}function o(e){e=e||{},this._reset=e.reset,this._plan=e.plan,this._count=e.count,this._onDirty=e.onDirty,this._dirty=!0,this.context}var l=o.prototype;l.perform=function(e){var t,n=this._upstream,i=e&&e.skip;if(this._dirty&&n){var a=this.context;a.data=a.outputData=n.context.outputData}this.__pipeline&&(this.__pipeline.currentTask=this),this._plan&&!i&&(t=this._plan(this.context));var s,o=f(this._modBy),l=this._modDataCount||0,u=f(e&&e.modBy),h=e&&e.modDataCount||0;function f(e){return!(e>=1)&&(e=1),e}o===u&&l===h||(t="reset"),(this._dirty||"reset"===t)&&(this._dirty=!1,s=d(this,i)),this._modBy=u,this._modDataCount=h;var p=e&&e.step;if(this._dueEnd=n?n._outputDueEnd:this._count?this._count(this.context):1/0,this._progress){var g=this._dueIndex,m=Math.min(null!=p?this._dueIndex+p:1/0,this._dueEnd);if(!i&&(s||g<m)){var v=this._progress;if(r(v))for(var y=0;y<v.length;y++)c(this,v[y],g,m,u,h);else c(this,v,g,m,u,h)}this._dueIndex=m;var b=null!=this._settedOutputEnd?this._settedOutputEnd:m;this._outputDueEnd=b}else this._dueIndex=this._outputDueEnd=null!=this._settedOutputEnd?this._settedOutputEnd:this._dueEnd;return this.unfinished()};var u=function(){var e,t,n,i,r,a={reset:function(l,u,c,d){t=l,e=u,n=c,i=d,r=Math.ceil(i/n),a.next=n>1&&i>0?o:s}};return a;function s(){return t<e?t++:null}function o(){var a=t%r*n+Math.ceil(t/r),s=t>=e?null:a<i?a:t;return t++,s}}();function c(e,t,n,i,r,a){u.reset(n,i,r,a),e._callingProgress=t,e._callingProgress({start:n,end:i,count:i-n,next:u.next},e.context)}function d(e,t){var n,i;e._dueIndex=e._outputDueEnd=e._dueEnd=0,e._settedOutputEnd=null,!t&&e._reset&&(n=e._reset(e.context),n&&n.progress&&(i=n.forceFirstProgress,n=n.progress),r(n)&&!n.length&&(n=null)),e._progress=n,e._modBy=e._modDataCount=null;var a=e._downstream;return a&&a.dirty(),i}l.dirty=function(){this._dirty=!0,this._onDirty&&this._onDirty(this.context)},l.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd},l.pipe=function(e){(this._downstream!==e||this._dirty)&&(this._downstream=e,e._upstream=this,e.dirty())},l.dispose=function(){this._disposed||(this._upstream&&(this._upstream._downstream=null),this._downstream&&(this._downstream._upstream=null),this._dirty=!1,this._disposed=!0)},l.getUpstream=function(){return this._upstream},l.getDownstream=function(){return this._downstream},l.setOutputEnd=function(e){this._outputDueEnd=this._settedOutputEnd=e},t.createTask=s},f4a2:function(e,t,n){var i=n("9850"),r=n("c526"),a=r.onIrrelevantElement,s=n("2306");function o(e){return e=c(e),function(t,n){return s.clipPointsByRect(t,e)}}function l(e,t){return e=c(e),function(n){var i=null!=t?t:n,r=i?e.width:e.height,a=i?e.x:e.y;return[a,a+(r||0)]}}function u(e,t,n){return e=c(e),function(i,r,s){return e.contain(r[0],r[1])&&!a(i,t,n)}}function c(e){return i.create(e)}t.makeRectPanelClipPath=o,t.makeLinearBrushOtherExtent=l,t.makeRectIsTargetByCursor=u},f605:function(e,t){e.exports=function(e,t,n,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(n+": incorrect invocation!");return e}},f706:function(e,t,n){var i=n("2306"),r=n("1418"),a=n("6d8b"),s=a.isObject;function o(e){this.group=new i.Group,this._symbolCtor=e||r}var l=o.prototype;function u(e,t,n,i){return t&&!isNaN(t[0])&&!isNaN(t[1])&&!(i.isIgnore&&i.isIgnore(n))&&!(i.clipShape&&!i.clipShape.contain(t[0],t[1]))&&"none"!==e.getItemVisual(n,"symbol")}function c(e){return null==e||s(e)||(e={isIgnore:e}),e||{}}function d(e){var t=e.hostModel;return{itemStyle:t.getModel("itemStyle").getItemStyle(["color"]),hoverItemStyle:t.getModel("emphasis.itemStyle").getItemStyle(),symbolRotate:t.get("symbolRotate"),symbolOffset:t.get("symbolOffset"),hoverAnimation:t.get("hoverAnimation"),labelModel:t.getModel("label"),hoverLabelModel:t.getModel("emphasis.label"),cursorStyle:t.get("cursor")}}l.updateData=function(e,t){t=c(t);var n=this.group,r=e.hostModel,a=this._data,s=this._symbolCtor,o=d(e);a||n.removeAll(),e.diff(a).add(function(i){var r=e.getItemLayout(i);if(u(e,r,i,t)){var a=new s(e,i,o);a.attr("position",r),e.setItemGraphicEl(i,a),n.add(a)}}).update(function(l,c){var d=a.getItemGraphicEl(c),h=e.getItemLayout(l);u(e,h,l,t)?(d?(d.updateData(e,l,o),i.updateProps(d,{position:h},r)):(d=new s(e,l),d.attr("position",h)),n.add(d),e.setItemGraphicEl(l,d)):n.remove(d)}).remove(function(e){var t=a.getItemGraphicEl(e);t&&t.fadeOut(function(){n.remove(t)})}).execute(),this._data=e},l.isPersistent=function(){return!0},l.updateLayout=function(){var e=this._data;e&&e.eachItemGraphicEl(function(t,n){var i=e.getItemLayout(n);t.attr("position",i)})},l.incrementalPrepareUpdate=function(e){this._seriesScope=d(e),this._data=null,this.group.removeAll()},l.incrementalUpdate=function(e,t,n){function i(e){e.isGroup||(e.incremental=e.useHoverLayer=!0)}n=c(n);for(var r=e.start;r<e.end;r++){var a=t.getItemLayout(r);if(u(t,a,r,n)){var s=new this._symbolCtor(t,r,this._seriesScope);s.traverse(i),s.attr("position",a),this.group.add(s),t.setItemGraphicEl(r,s)}}},l.remove=function(e){var t=this.group,n=this._data;n&&e?n.eachItemGraphicEl(function(e){e.fadeOut(function(){t.remove(e)})}):t.removeAll()};var h=o;e.exports=h},f934:function(e,t,n){var i=n("6d8b"),r=n("9850"),a=n("3842"),s=a.parsePercent,o=n("eda2"),l=i.each,u=["left","right","top","bottom","width","height"],c=[["width","left","right"],["height","top","bottom"]];function d(e,t,n,i,r){var a=0,s=0;null==i&&(i=1/0),null==r&&(r=1/0);var o=0;t.eachChild(function(l,u){var c,d,h=l.position,f=l.getBoundingRect(),p=t.childAt(u+1),g=p&&p.getBoundingRect();if("horizontal"===e){var m=f.width+(g?-g.x+f.x:0);c=a+m,c>i||l.newline?(a=0,c=m,s+=o+n,o=f.height):o=Math.max(o,f.height)}else{var v=f.height+(g?-g.y+f.y:0);d=s+v,d>r||l.newline?(a+=o+n,s=0,d=v,o=f.width):o=Math.max(o,f.width)}l.newline||(h[0]=a,h[1]=s,"horizontal"===e?a=c+n:s=d+n)})}var h=d,f=i.curry(d,"vertical"),p=i.curry(d,"horizontal");function g(e,t,n){var i=t.width,r=t.height,a=s(e.x,i),l=s(e.y,r),u=s(e.x2,i),c=s(e.y2,r);return(isNaN(a)||isNaN(parseFloat(e.x)))&&(a=0),(isNaN(u)||isNaN(parseFloat(e.x2)))&&(u=i),(isNaN(l)||isNaN(parseFloat(e.y)))&&(l=0),(isNaN(c)||isNaN(parseFloat(e.y2)))&&(c=r),n=o.normalizeCssArray(n||0),{width:Math.max(u-a-n[1]-n[3],0),height:Math.max(c-l-n[0]-n[2],0)}}function m(e,t,n){n=o.normalizeCssArray(n||0);var i=t.width,a=t.height,l=s(e.left,i),u=s(e.top,a),c=s(e.right,i),d=s(e.bottom,a),h=s(e.width,i),f=s(e.height,a),p=n[2]+n[0],g=n[1]+n[3],m=e.aspect;switch(isNaN(h)&&(h=i-c-g-l),isNaN(f)&&(f=a-d-p-u),null!=m&&(isNaN(h)&&isNaN(f)&&(m>i/a?h=.8*i:f=.8*a),isNaN(h)&&(h=m*f),isNaN(f)&&(f=h/m)),isNaN(l)&&(l=i-c-h-g),isNaN(u)&&(u=a-d-f-p),e.left||e.right){case"center":l=i/2-h/2-n[3];break;case"right":l=i-h-g;break}switch(e.top||e.bottom){case"middle":case"center":u=a/2-f/2-n[0];break;case"bottom":u=a-f-p;break}l=l||0,u=u||0,isNaN(h)&&(h=i-g-l-(c||0)),isNaN(f)&&(f=a-p-u-(d||0));var v=new r(l+n[3],u+n[0],h,f);return v.margin=n,v}function v(e,t,n,a,s){var o=!s||!s.hv||s.hv[0],l=!s||!s.hv||s.hv[1],u=s&&s.boundingMode||"all";if(o||l){var c;if("raw"===u)c="group"===e.type?new r(0,0,+t.width||0,+t.height||0):e.getBoundingRect();else if(c=e.getBoundingRect(),e.needLocalTransform()){var d=e.getLocalTransform();c=c.clone(),c.applyTransform(d)}t=m(i.defaults({width:c.width,height:c.height},t),n,a);var h=e.position,f=o?t.x-c.x:0,p=l?t.y-c.y:0;e.attr("position","raw"===u?[f,p]:[h[0]+f,h[1]+p])}}function y(e,t){return null!=e[c[t][0]]||null!=e[c[t][1]]&&null!=e[c[t][2]]}function b(e,t,n){!i.isObject(n)&&(n={});var r=n.ignoreSize;!i.isArray(r)&&(r=[r,r]);var a=o(c[0],0),s=o(c[1],1);function o(n,i){var a={},s=0,o={},c=0,h=2;if(l(n,function(t){o[t]=e[t]}),l(n,function(e){u(t,e)&&(a[e]=o[e]=t[e]),d(a,e)&&s++,d(o,e)&&c++}),r[i])return d(t,n[1])?o[n[2]]=null:d(t,n[2])&&(o[n[1]]=null),o;if(c!==h&&s){if(s>=h)return a;for(var f=0;f<n.length;f++){var p=n[f];if(!u(a,p)&&u(e,p)){a[p]=e[p];break}}return a}return o}function u(e,t){return e.hasOwnProperty(t)}function d(e,t){return null!=e[t]&&"auto"!==e[t]}function h(e,t,n){l(e,function(e){t[e]=n[e]})}h(c[0],e,a),h(c[1],e,s)}function S(e){return T({},e)}function T(e,t){return t&&e&&l(u,function(n){t.hasOwnProperty(n)&&(e[n]=t[n])}),e}t.LOCATION_PARAMS=u,t.HV_NAMES=c,t.box=h,t.vbox=f,t.hbox=p,t.getAvailableSize=g,t.getLayoutRect=m,t.positionElement=v,t.sizeCalculable=y,t.mergeLayoutParam=b,t.getLayoutParams=S,t.copyLayoutParams=T},fab2:function(e,t,n){var i=n("7726").document;e.exports=i&&i.documentElement},fab22:function(e,t,n){var i=n("6d8b"),r=i.retrieve,a=i.defaults,s=i.extend,o=i.each,l=n("eda2"),u=n("2306"),c=n("4319"),d=n("3842"),h=d.isRadianAroundZero,f=d.remRadian,p=n("a15a"),g=p.createSymbol,m=n("1687"),v=n("401b"),y=v.applyTransform,b=Math.PI;function S(e){var t={componentType:e.mainType};return t[e.mainType+"Index"]=e.componentIndex,t}var T=function(e,t){this.opt=t,this.axisModel=e,a(t,{labelOffset:0,nameDirection:1,tickDirection:1,labelDirection:1,silent:!0}),this.group=new u.Group;var n=new u.Group({position:t.position.slice(),rotation:t.rotation});n.updateTransform(),this._transform=n.transform,this._dumbGroup=n};T.prototype={constructor:T,hasBuilder:function(e){return!!_[e]},add:function(e){_[e].call(this)},getGroup:function(){return this.group}};var _={axisLine:function(){var e=this.opt,t=this.axisModel;if(t.get("axisLine.show")){var n=this.axisModel.axis.getExtent(),i=this._transform,r=[n[0],0],a=[n[1],0];i&&(y(r,r,i),y(a,a,i));var l=s({lineCap:"round"},t.getModel("axisLine.lineStyle").getLineStyle());this.group.add(new u.Line(u.subPixelOptimizeLine({anid:"line",shape:{x1:r[0],y1:r[1],x2:a[0],y2:a[1]},style:l,strokeContainThreshold:e.strokeContainThreshold||5,silent:!0,z2:1})));var c=t.get("axisLine.symbol"),d=t.get("axisLine.symbolSize"),h=t.get("axisLine.symbolOffset")||0;if("number"===typeof h&&(h=[h,h]),null!=c){"string"===typeof c&&(c=[c,c]),"string"!==typeof d&&"number"!==typeof d||(d=[d,d]);var f=d[0],p=d[1];o([{rotate:e.rotation+Math.PI/2,offset:h[0],r:0},{rotate:e.rotation-Math.PI/2,offset:h[1],r:Math.sqrt((r[0]-a[0])*(r[0]-a[0])+(r[1]-a[1])*(r[1]-a[1]))}],function(t,n){if("none"!==c[n]&&null!=c[n]){var i=g(c[n],-f/2,-p/2,f,p,l.stroke,!0),a=t.r+t.offset,s=[r[0]+a*Math.cos(e.rotation),r[1]-a*Math.sin(e.rotation)];i.attr({rotation:t.rotate,position:s,silent:!0}),this.group.add(i)}},this)}}},axisTickLabel:function(){var e=this.axisModel,t=this.opt,n=R(this,e,t),i=M(this,e,t);A(e,i,n)},axisName:function(){var e=this.opt,t=this.axisModel,n=r(e.axisName,t.get("name"));if(n){var i,a,o=t.get("nameLocation"),c=e.nameDirection,d=t.getModel("nameTextStyle"),h=t.get("nameGap")||0,f=this.axisModel.axis.getExtent(),p=f[0]>f[1]?-1:1,g=["start"===o?f[0]-p*h:"end"===o?f[1]+p*h:(f[0]+f[1])/2,C(o)?e.labelOffset+c*h:0],m=t.get("nameRotate");null!=m&&(m=m*b/180),C(o)?i=w(e.rotation,null!=m?m:e.rotation,c):(i=E(e,o,m||0,f),a=e.axisNameAvailableWidth,null!=a&&(a=Math.abs(a/Math.sin(i.rotation)),!isFinite(a)&&(a=null)));var v=d.getFont(),y=t.get("nameTruncate",!0)||{},T=y.ellipsis,_=r(e.nameTruncateMaxWidth,y.maxWidth,a),A=null!=T&&null!=_?l.truncateText(n,_,v,T,{minChar:2,placeholder:y.placeholder}):n,k=t.get("tooltip",!0),I=t.mainType,R={componentType:I,name:n,$vars:["name"]};R[I+"Index"]=t.componentIndex;var M=new u.Text({anid:"name",__fullText:n,__truncatedText:A,position:g,rotation:i.rotation,silent:x(t),z2:1,tooltip:k&&k.show?s({content:n,formatter:function(){return n},formatterParams:R},k):null});u.setTextStyle(M.style,d,{text:A,textFont:v,textFill:d.getTextColor()||t.get("axisLine.lineStyle.color"),textAlign:i.textAlign,textVerticalAlign:i.textVerticalAlign}),t.get("triggerEvent")&&(M.eventData=S(t),M.eventData.targetType="axisName",M.eventData.name=n),this._dumbGroup.add(M),M.updateTransform(),this.group.add(M),M.decomposeTransform()}}},w=T.innerTextLayout=function(e,t,n){var i,r,a=f(t-e);return h(a)?(r=n>0?"top":"bottom",i="center"):h(a-b)?(r=n>0?"bottom":"top",i="center"):(r="middle",i=a>0&&a<b?n>0?"right":"left":n>0?"left":"right"),{rotation:a,textAlign:i,textVerticalAlign:r}};function E(e,t,n,i){var r,a,s=f(n-e.rotation),o=i[0]>i[1],l="start"===t&&!o||"start"!==t&&o;return h(s-b/2)?(a=l?"bottom":"top",r="center"):h(s-1.5*b)?(a=l?"top":"bottom",r="center"):(a="middle",r=s<1.5*b&&s>b/2?l?"left":"right":l?"right":"left"),{rotation:s,textAlign:r,textVerticalAlign:a}}function x(e){var t=e.get("tooltip");return e.get("silent")||!(e.get("triggerEvent")||t&&t.show)}function A(e,t,n){var i=e.get("axisLabel.showMinLabel"),r=e.get("axisLabel.showMaxLabel");t=t||[],n=n||[];var a=t[0],s=t[1],o=t[t.length-1],l=t[t.length-2],u=n[0],c=n[1],d=n[n.length-1],h=n[n.length-2];!1===i?(k(a),k(u)):I(a,s)&&(i?(k(s),k(c)):(k(a),k(u))),!1===r?(k(o),k(d)):I(l,o)&&(r?(k(l),k(h)):(k(o),k(d)))}function k(e){e&&(e.ignore=!0)}function I(e,t,n){var i=e&&e.getBoundingRect().clone(),r=t&&t.getBoundingRect().clone();if(i&&r){var a=m.identity([]);return m.rotate(a,a,-e.rotation),i.applyTransform(m.mul([],a,e.getLocalTransform())),r.applyTransform(m.mul([],a,t.getLocalTransform())),i.intersect(r)}}function C(e){return"middle"===e||"center"===e}function R(e,t,n){var i=t.axis;if(t.get("axisTick.show")&&!i.scale.isBlank()){for(var r=t.getModel("axisTick"),s=r.getModel("lineStyle"),o=r.get("length"),l=i.getTicksCoords(),c=[],d=[],h=e._transform,f=[],p=0;p<l.length;p++){var g=l[p].coord;c[0]=g,c[1]=0,d[0]=g,d[1]=n.tickDirection*o,h&&(y(c,c,h),y(d,d,h));var m=new u.Line(u.subPixelOptimizeLine({anid:"tick_"+l[p].tickValue,shape:{x1:c[0],y1:c[1],x2:d[0],y2:d[1]},style:a(s.getLineStyle(),{stroke:t.get("axisLine.lineStyle.color")}),z2:2,silent:!0}));e.group.add(m),f.push(m)}return f}}function M(e,t,n){var i=t.axis,a=r(n.axisLabelShow,t.get("axisLabel.show"));if(a&&!i.scale.isBlank()){var s=t.getModel("axisLabel"),l=s.get("margin"),d=i.getViewLabels(),h=(r(n.labelRotate,s.get("rotate"))||0)*b/180,f=w(n.rotation,h,n.labelDirection),p=t.getCategories(!0),g=[],m=x(t),v=t.get("triggerEvent");return o(d,function(r,a){var o=r.tickValue,d=r.formattedLabel,h=r.rawLabel,y=s;p&&p[o]&&p[o].textStyle&&(y=new c(p[o].textStyle,s,t.ecModel));var b=y.getTextColor()||t.get("axisLine.lineStyle.color"),T=i.dataToCoord(o),_=[T,n.labelOffset+n.labelDirection*l],w=new u.Text({anid:"label_"+o,position:_,rotation:f.rotation,silent:m,z2:10});u.setTextStyle(w.style,y,{text:d,textAlign:y.getShallow("align",!0)||f.textAlign,textVerticalAlign:y.getShallow("verticalAlign",!0)||y.getShallow("baseline",!0)||f.textVerticalAlign,textFill:"function"===typeof b?b("category"===i.type?h:"value"===i.type?o+"":o,a):b}),v&&(w.eventData=S(t),w.eventData.targetType="axisLabel",w.eventData.value=h),e._dumbGroup.add(w),w.updateTransform(),g.push(w),e.group.add(w),w.decomposeTransform()}),g}}var D=T;e.exports=D},fb05:function(e,t,n){var i=n("6d8b"),r=i.each,a=i.isArray,s=i.isObject,o=n("26e1"),l=n("e0d3"),u=l.normalizeToArray;function c(e,t){t=t.split(",");for(var n=e,i=0;i<t.length;i++)if(n=n&&n[t[i]],null==n)break;return n}function d(e,t,n,i){t=t.split(",");for(var r,a=e,s=0;s<t.length-1;s++)r=t[s],null==a[r]&&(a[r]={}),a=a[r];(i||null==a[t[s]])&&(a[t[s]]=n)}function h(e){r(f,function(t){t[0]in e&&!(t[1]in e)&&(e[t[1]]=e[t[0]])})}var f=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]],p=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"];function g(e,t){o(e,t),e.series=u(e.series),r(e.series,function(e){if(s(e)){var t=e.type;if("pie"!==t&&"gauge"!==t||null!=e.clockWise&&(e.clockwise=e.clockWise),"gauge"===t){var n=c(e,"pointer.color");null!=n&&d(e,"itemStyle.normal.color",n)}h(e)}}),e.dataRange&&(e.visualMap=e.dataRange),r(p,function(t){var n=e[t];n&&(a(n)||(n=[n]),r(n,function(e){h(e)}))})}e.exports=g},fc82:function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),a=n("1fab"),s=n("2306"),o=n("a4fe"),l=n("80f0"),u=r.curry,c=r.each,d=r.map,h=Math.min,f=Math.max,p=Math.pow,g=1e4,m=6,v=6,y="globalPan",b={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},S={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},T={brushStyle:{lineWidth:2,stroke:"rgba(0,0,0,0.3)",fill:"rgba(0,0,0,0.1)"},transformable:!0,brushMode:"single",removeOnClick:!1},_=0;function w(e){a.call(this),this._zr=e,this.group=new s.Group,this._brushType,this._brushOption,this._panels,this._track=[],this._dragging,this._covers=[],this._creatingCover,this._creatingPanel,this._enableGlobalPan,this._uid="brushController_"+_++,this._handlers={},c(ne,function(e,t){this._handlers[t]=r.bind(e,this)},this)}function E(e,t){var n=e._zr;e._enableGlobalPan||o.take(n,y,e._uid),c(e._handlers,function(e,t){n.on(t,e)}),e._brushType=t.brushType,e._brushOption=r.merge(r.clone(T),t,!0)}function x(e){var t=e._zr;o.release(t,y,e._uid),c(e._handlers,function(e,n){t.off(n,e)}),e._brushType=e._brushOption=null}function A(e,t){var n=re[t.brushType].createCover(e,t);return n.__brushOption=t,C(n,t),e.group.add(n),n}function k(e,t){var n=M(t);return n.endCreating&&(n.endCreating(e,t),C(t,t.__brushOption)),t}function I(e,t){var n=t.__brushOption;M(t).updateCoverShape(e,t,n.range,n)}function C(e,t){var n=t.z;null==n&&(n=g),e.traverse(function(e){e.z=n,e.z2=n})}function R(e,t){M(t).updateCommon(e,t),I(e,t)}function M(e){return re[e.__brushOption.brushType]}function D(e,t,n){var i,r=e._panels;if(!r)return!0;var a=e._transform;return c(r,function(e){e.isTargetByCursor(t,n,a)&&(i=e)}),i}function L(e,t){var n=e._panels;if(!n)return!0;var i=t.__brushOption.panelId;return null==i||n[i]}function P(e){var t=e._covers,n=t.length;return c(t,function(t){e.group.remove(t)},e),t.length=0,!!n}function O(e,t){var n=d(e._covers,function(e){var t=e.__brushOption,n=r.clone(t.range);return{brushType:t.brushType,panelId:t.panelId,range:n}});e.trigger("brush",n,{isEnd:!!t.isEnd,removeOnClick:!!t.removeOnClick})}function N(e){var t=e._track;if(!t.length)return!1;var n=t[t.length-1],i=t[0],r=n[0]-i[0],a=n[1]-i[1],s=p(r*r+a*a,.5);return s>m}function U(e){var t=e.length-1;return t<0&&(t=0),[e[0],e[t]]}function F(e,t,n,i){var r=new s.Group;return r.add(new s.Rect({name:"main",style:G(n),silent:!0,draggable:!0,cursor:"move",drift:u(e,t,r,"nswe"),ondragend:u(O,t,{isEnd:!0})})),c(i,function(n){r.add(new s.Rect({name:n,style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:u(e,t,r,n),ondragend:u(O,t,{isEnd:!0})}))}),r}function B(e,t,n,i){var r=i.brushStyle.lineWidth||0,a=f(r,v),s=n[0][0],o=n[1][0],l=s-r/2,u=o-r/2,c=n[0][1],d=n[1][1],h=c-a+r/2,p=d-a+r/2,g=c-s,m=d-o,y=g+r,b=m+r;j(e,t,"main",s,o,g,m),i.transformable&&(j(e,t,"w",l,u,a,b),j(e,t,"e",h,u,a,b),j(e,t,"n",l,u,y,a),j(e,t,"s",l,p,y,a),j(e,t,"nw",l,u,a,a),j(e,t,"ne",h,u,a,a),j(e,t,"sw",l,p,a,a),j(e,t,"se",h,p,a,a))}function V(e,t){var n=t.__brushOption,i=n.transformable,r=t.childAt(0);r.useStyle(G(n)),r.attr({silent:!i,cursor:i?"move":"default"}),c(["w","e","n","s","se","sw","ne","nw"],function(n){var r=t.childOfName(n),a=K(e,n);r&&r.attr({silent:!i,invisible:!i,cursor:i?S[a]+"-resize":null})})}function j(e,t,n,i,r,a,s){var o=t.childOfName(n);o&&o.setShape(X(Y(e,t,[[i,r],[i+a,r+s]])))}function G(e){return r.defaults({strokeNoScale:!0},e.brushStyle)}function H(e,t,n,i){var r=[h(e,n),h(t,i)],a=[f(e,n),f(t,i)];return[[r[0],a[0]],[r[1],a[1]]]}function z(e){return s.getTransform(e.group)}function K(e,t){if(t.length>1){t=t.split("");var n=[K(e,t[0]),K(e,t[1])];return("e"===n[0]||"w"===n[0])&&n.reverse(),n.join("")}var i={w:"left",e:"right",n:"top",s:"bottom"},r={left:"w",right:"e",top:"n",bottom:"s"};n=s.transformDirection(i[t],z(e));return r[n]}function $(e,t,n,i,r,a,s,o){var l=i.__brushOption,u=e(l.range),d=q(n,a,s);c(r.split(""),function(e){var t=b[e];u[t[0]][t[1]]+=d[t[0]]}),l.range=t(H(u[0][0],u[1][0],u[0][1],u[1][1])),R(n,i),O(n,{isEnd:!1})}function W(e,t,n,i,r){var a=t.__brushOption.range,s=q(e,n,i);c(a,function(e){e[0]+=s[0],e[1]+=s[1]}),R(e,t),O(e,{isEnd:!1})}function q(e,t,n){var i=e.group,r=i.transformCoordToLocal(t,n),a=i.transformCoordToLocal(0,0);return[r[0]-a[0],r[1]-a[1]]}function Y(e,t,n){var i=L(e,t);return i&&!0!==i?i.clipPath(n,e._transform):r.clone(n)}function X(e){var t=h(e[0][0],e[1][0]),n=h(e[0][1],e[1][1]),i=f(e[0][0],e[1][0]),r=f(e[0][1],e[1][1]);return{x:t,y:n,width:i-t,height:r-n}}function Q(e,t,n){if(e._brushType){var i=e._zr,r=e._covers,a=D(e,t,n);if(!e._dragging)for(var s=0;s<r.length;s++){var o=r[s].__brushOption;if(a&&(!0===a||o.panelId===a.panelId)&&re[o.brushType].contain(r[s],n[0],n[1]))return}a&&i.setCursorStyle("crosshair")}}function Z(e){var t=e.event;t.preventDefault&&t.preventDefault()}function J(e,t,n){return e.childOfName("main").contain(t,n)}function ee(e,t,n,i){var a,s=e._creatingCover,o=e._creatingPanel,l=e._brushOption;if(e._track.push(n.slice()),N(e)||s){if(o&&!s){"single"===l.brushMode&&P(e);var u=r.clone(l);u.brushType=te(u.brushType,o),u.panelId=!0===o?null:o.panelId,s=e._creatingCover=A(e,u),e._covers.push(s)}if(s){var c=re[te(e._brushType,o)],d=s.__brushOption;d.range=c.getCreatingRange(Y(e,s,e._track)),i&&(k(e,s),c.updateCommon(e,s)),I(e,s),a={isEnd:i}}}else i&&"single"===l.brushMode&&l.removeOnClick&&D(e,t,n)&&P(e)&&(a={isEnd:i,removeOnClick:!0});return a}function te(e,t){return"auto"===e?t.defaultBrushType:e}w.prototype={constructor:w,enableBrush:function(e){return this._brushType&&x(this),e.brushType&&E(this,e),this},setPanels:function(e){if(e&&e.length){var t=this._panels={};r.each(e,function(e){t[e.panelId]=r.clone(e)})}else this._panels=null;return this},mount:function(e){e=e||{},this._enableGlobalPan=e.enableGlobalPan;var t=this.group;return this._zr.add(t),t.attr({position:e.position||[0,0],rotation:e.rotation||0,scale:e.scale||[1,1]}),this._transform=t.getLocalTransform(),this},eachCover:function(e,t){c(this._covers,e,t)},updateCovers:function(e){e=r.map(e,function(e){return r.merge(r.clone(T),e,!0)});var t="\0-brush-index-",n=this._covers,i=this._covers=[],a=this,s=this._creatingCover;return new l(n,e,u,o).add(c).update(c).remove(d).execute(),this;function o(e,n){return(null!=e.id?e.id:t+n)+"-"+e.brushType}function u(e,t){return o(e.__brushOption,t)}function c(t,r){var o=e[t];if(null!=r&&n[r]===s)i[t]=n[r];else{var l=i[t]=null!=r?(n[r].__brushOption=o,n[r]):k(a,A(a,o));R(a,l)}}function d(e){n[e]!==s&&a.group.remove(n[e])}},unmount:function(){return this.enableBrush(!1),P(this),this._zr.remove(this.group),this},dispose:function(){this.unmount(),this.off()}},r.mixin(w,a);var ne={mousedown:function(e){if(this._dragging)ie.call(this,e);else if(!e.target||!e.target.draggable){Z(e);var t=this.group.transformCoordToLocal(e.offsetX,e.offsetY);this._creatingCover=null;var n=this._creatingPanel=D(this,e,t);n&&(this._dragging=!0,this._track=[t.slice()])}},mousemove:function(e){var t=this.group.transformCoordToLocal(e.offsetX,e.offsetY);if(Q(this,e,t),this._dragging){Z(e);var n=ee(this,e,t,!1);n&&O(this,n)}},mouseup:ie};function ie(e){if(this._dragging){Z(e);var t=this.group.transformCoordToLocal(e.offsetX,e.offsetY),n=ee(this,e,t,!0);this._dragging=!1,this._track=[],this._creatingCover=null,n&&O(this,n)}}var re={lineX:ae(0),lineY:ae(1),rect:{createCover:function(e,t){return F(u($,function(e){return e},function(e){return e}),e,t,["w","e","n","s","se","sw","ne","nw"])},getCreatingRange:function(e){var t=U(e);return H(t[1][0],t[1][1],t[0][0],t[0][1])},updateCoverShape:function(e,t,n,i){B(e,t,n,i)},updateCommon:V,contain:J},polygon:{createCover:function(e,t){var n=new s.Group;return n.add(new s.Polyline({name:"main",style:G(t),silent:!0})),n},getCreatingRange:function(e){return e},endCreating:function(e,t){t.remove(t.childAt(0)),t.add(new s.Polygon({name:"main",draggable:!0,drift:u(W,e,t),ondragend:u(O,e,{isEnd:!0})}))},updateCoverShape:function(e,t,n,i){t.childAt(0).setShape({points:Y(e,t,n)})},updateCommon:V,contain:J}};function ae(e){return{createCover:function(t,n){return F(u($,function(t){var n=[t,[0,100]];return e&&n.reverse(),n},function(t){return t[e]}),t,n,[["w","e"],["n","s"]][e])},getCreatingRange:function(t){var n=U(t),i=h(n[0][e],n[1][e]),r=f(n[0][e],n[1][e]);return[i,r]},updateCoverShape:function(t,n,i,r){var a,s=L(t,n);if(!0!==s&&s.getLinearBrushOtherExtent)a=s.getLinearBrushOtherExtent(e,t._transform);else{var o=t._zr;a=[0,[o.getWidth(),o.getHeight()][1-e]]}var l=[i,a];e&&l.reverse(),B(t,n,l,r)},updateCommon:V,contain:J}}var se=w;e.exports=se},fd63:function(e,t,n){var i=n("42e5"),r={createOnAllSeries:!0,performRawSeries:!0,reset:function(e,t){var n=e.getData(),r=(e.visualColorAccessPath||"itemStyle.color").split("."),a=e.get(r)||e.getColorFromPalette(e.name,null,t.getSeriesCount());if(n.setVisual("color",a),!t.isSeriesFiltered(e)){"function"!==typeof a||a instanceof i||n.each(function(t){n.setItemVisual(t,"color",a(e.getDataParams(t)))});var s=function(e,t){var n=e.getItemModel(t),i=n.get(r,!0);null!=i&&e.setItemVisual(t,"color",i)};return{dataEach:n.hasItemOption?s:null}}}};e.exports=r},fdde:function(e,t){var n={average:function(e){for(var t=0,n=0,i=0;i<e.length;i++)isNaN(e[i])||(t+=e[i],n++);return 0===n?NaN:t/n},sum:function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n]||0;return t},max:function(e){for(var t=-1/0,n=0;n<e.length;n++)e[n]>t&&(t=e[n]);return isFinite(t)?t:NaN},min:function(e){for(var t=1/0,n=0;n<e.length;n++)e[n]<t&&(t=e[n]);return isFinite(t)?t:NaN},nearest:function(e){return e[0]}},i=function(e,t){return Math.round(e.length/2)};function r(e){return{seriesType:e,modifyOutputEnd:!0,reset:function(e,t,r){var a=e.getData(),s=e.get("sampling"),o=e.coordinateSystem;if("cartesian2d"===o.type&&s){var l,u=o.getBaseAxis(),c=o.getOtherAxis(u),d=u.getExtent(),h=d[1]-d[0],f=Math.round(a.count()/h);if(f>1)"string"===typeof s?l=n[s]:"function"===typeof s&&(l=s),l&&e.setData(a.downSample(a.mapDimension(c.dim),1/f,l,i))}}}}e.exports=r},fdef:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},fe21:function(e,t,n){var i=n("e86a"),r=n("2306"),a=["textStyle","color"],s={getTextColor:function(e){var t=this.ecModel;return this.getShallow("color")||(!e&&t?t.get(a):null)},getFont:function(){return r.getFont({fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},this.ecModel)},getTextRect:function(e){return i.getBoundingRect(e,this.getFont(),this.getShallow("align"),this.getShallow("verticalAlign")||this.getShallow("baseline"),this.getShallow("padding"),this.getShallow("rich"),this.getShallow("truncateText"))}};e.exports=s},ff2e:function(e,t,n){var i=n("6d8b"),r=n("2306"),a=n("e86a"),s=n("eda2"),o=n("1687"),l=n("697e"),u=n("fab22");function c(e){var t,n=e.get("type"),i=e.getModel(n+"Style");return"line"===n?(t=i.getLineStyle(),t.fill=null):"shadow"===n&&(t=i.getAreaStyle(),t.stroke=null),t}function d(e,t,n,i,r){var o=n.get("value"),l=f(o,t.axis,t.ecModel,n.get("seriesDataIndices"),{precision:n.get("label.precision"),formatter:n.get("label.formatter")}),u=n.getModel("label"),c=s.normalizeCssArray(u.get("padding")||0),d=u.getFont(),p=a.getBoundingRect(l,d),g=r.position,m=p.width+c[1]+c[3],v=p.height+c[0]+c[2],y=r.align;"right"===y&&(g[0]-=m),"center"===y&&(g[0]-=m/2);var b=r.verticalAlign;"bottom"===b&&(g[1]-=v),"middle"===b&&(g[1]-=v/2),h(g,m,v,i);var S=u.get("backgroundColor");S&&"auto"!==S||(S=t.get("axisLine.lineStyle.color")),e.label={shape:{x:0,y:0,width:m,height:v,r:u.get("borderRadius")},position:g.slice(),style:{text:l,textFont:d,textFill:u.getTextColor(),textPosition:"inside",fill:S,stroke:u.get("borderColor")||"transparent",lineWidth:u.get("borderWidth")||0,shadowBlur:u.get("shadowBlur"),shadowColor:u.get("shadowColor"),shadowOffsetX:u.get("shadowOffsetX"),shadowOffsetY:u.get("shadowOffsetY")},z2:10}}function h(e,t,n,i){var r=i.getWidth(),a=i.getHeight();e[0]=Math.min(e[0]+t,r)-t,e[1]=Math.min(e[1]+n,a)-n,e[0]=Math.max(e[0],0),e[1]=Math.max(e[1],0)}function f(e,t,n,r,a){e=t.scale.parse(e);var s=t.scale.getLabel(e,{precision:a.precision}),o=a.formatter;if(o){var u={value:l.getAxisRawValue(t,e),seriesData:[]};i.each(r,function(e){var t=n.getSeriesByIndex(e.seriesIndex),i=e.dataIndexInside,r=t&&t.getDataParams(i);r&&u.seriesData.push(r)}),i.isString(o)?s=o.replace("{value}",s):i.isFunction(o)&&(s=o(u))}return s}function p(e,t,n){var i=o.create();return o.rotate(i,i,n.rotation),o.translate(i,i,n.position),r.applyTransform([e.dataToCoord(t),(n.labelOffset||0)+(n.labelDirection||1)*(n.labelMargin||0)],i)}function g(e,t,n,i,r,a){var s=u.innerTextLayout(n.rotation,0,n.labelDirection);n.labelMargin=r.get("label.margin"),d(t,i,r,a,{position:p(i.axis,e,n),align:s.textAlign,verticalAlign:s.textVerticalAlign})}function m(e,t,n){return n=n||0,{x1:e[n],y1:e[1-n],x2:t[n],y2:t[1-n]}}function v(e,t,n){return n=n||0,{x:e[n],y:e[1-n],width:t[n],height:t[1-n]}}function y(e,t,n,i,r,a){return{cx:e,cy:t,r0:n,r:i,startAngle:r,endAngle:a,clockwise:!0}}t.buildElStyle=c,t.buildLabelElOption=d,t.getValueLabel=f,t.getTransformedPosition=p,t.buildCartesianSingleLabelElOption=g,t.makeLineShape=m,t.makeRectShape=v,t.makeSectorShape=y}}]);
//# sourceMappingURL=chunk-vendors.31365f87.js.map