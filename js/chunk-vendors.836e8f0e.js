(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-vendors"],{"007d":function(e,t,n){var i=n("3eba");n("cb8f"),n("a96b"),n("42f6"),i.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},function(){}),i.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},function(){})},"0156":function(e,t,n){var i=n("6d8b");function r(e,t,n){n=n||{};var r=e.coordinateSystem,s=t.axis,a={},o=s.getAxesOnZeroOf()[0],l=s.position,u=o?"onZero":l,c=s.dim,d=r.getRect(),h=[d.x,d.x+d.width,d.y,d.y+d.height],f={left:0,right:1,top:0,bottom:1,onZero:2},p=t.get("offset")||0,g="x"===c?[h[2]-p,h[3]+p]:[h[0]-p,h[1]+p];if(o){var m=o.toGlobalCoord(o.dataToCoord(0));g[f["onZero"]]=Math.max(Math.min(m,g[1]),g[0])}a.position=["y"===c?g[f[u]]:h[0],"x"===c?g[f[u]]:h[3]],a.rotation=Math.PI/2*("x"===c?0:1);var v={top:-1,bottom:1,left:-1,right:1};a.labelDirection=a.tickDirection=a.nameDirection=v[l],a.labelOffset=o?g[f[l]]-g[f["onZero"]]:0,t.get("axisTick.inside")&&(a.tickDirection=-a.tickDirection),i.retrieve(n.labelInside,t.get("axisLabel.inside"))&&(a.labelDirection=-a.labelDirection);var y=t.get("axisLabel.rotate");return a.labelRotate="top"===u?-y:y,a.z2=1,a}t.layout=r},"01e1":function(e,t,n){"use strict";t["a"]="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope},"01ed":function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("2306");n("5aa9"),n("af24"),i.extendComponentView({type:"grid",render:function(e,t){this.group.removeAll(),e.get("show")&&this.group.add(new s.Rect({shape:e.coordinateSystem.getRect(),style:r.defaults({fill:e.get("backgroundColor")},e.getItemStyle()),silent:!0,z2:-1}))}}),i.registerPreprocessor(function(e){e.xAxis&&e.yAxis&&!e.grid&&(e.grid={})})},"01f9":function(e,t,n){"use strict";var i=n("2d00"),r=n("5ca1"),s=n("2aba"),a=n("32e9"),o=n("84f2"),l=n("41a0"),u=n("7f20"),c=n("38fd"),d=n("2b4c")("iterator"),h=!([].keys&&"next"in[].keys()),f="@@iterator",p="keys",g="values",m=function(){return this};e.exports=function(e,t,n,v,y,b,_){l(n,t,v);var T,S,w,E=function(e){if(!h&&e in I)return I[e];switch(e){case p:return function(){return new n(this,e)};case g:return function(){return new n(this,e)}}return function(){return new n(this,e)}},x=t+" Iterator",k=y==g,A=!1,I=e.prototype,C=I[d]||I[f]||y&&I[y],D=C||E(y),R=y?k?E("entries"):D:void 0,M="Array"==t&&I.entries||C;if(M&&(w=c(M.call(new e)),w!==Object.prototype&&w.next&&(u(w,x,!0),i||"function"==typeof w[d]||a(w,d,m))),k&&C&&C.name!==g&&(A=!0,D=function(){return C.call(this)}),i&&!_||!h&&!A&&I[d]||a(I,d,D),o[t]=D,o[x]=m,y)if(T={values:k?D:E(g),keys:b?D:E(p),entries:R},_)for(S in T)S in I||s(I,S,T[S]);else r(r.P+r.F*(h||A),t,T);return T}},"0352":function(e,t,n){var i=n("6cb7"),r=n("b12f"),s=n("0f99"),a=s.detectSourceFormat,o=n("93d0"),l=o.SERIES_LAYOUT_BY_COLUMN;i.extend({type:"dataset",defaultOption:{seriesLayoutBy:l,sourceHeader:null,dimensions:null,source:null},optionUpdated:function(){a(this)}}),r.extend({type:"dataset"})},"04f6":function(e,t){var n=32,i=7;function r(e){var t=0;while(e>=n)t|=1&e,e>>=1;return e+t}function s(e,t,n,i){var r=t+1;if(r===n)return 1;if(i(e[r++],e[t])<0){while(r<n&&i(e[r],e[r-1])<0)r++;a(e,t,r)}else while(r<n&&i(e[r],e[r-1])>=0)r++;return r-t}function a(e,t,n){n--;while(t<n){var i=e[t];e[t++]=e[n],e[n--]=i}}function o(e,t,n,i,r){for(i===t&&i++;i<n;i++){var s,a=e[i],o=t,l=i;while(o<l)s=o+l>>>1,r(a,e[s])<0?l=s:o=s+1;var u=i-o;switch(u){case 3:e[o+3]=e[o+2];case 2:e[o+2]=e[o+1];case 1:e[o+1]=e[o];break;default:while(u>0)e[o+u]=e[o+u-1],u--}e[o]=a}}function l(e,t,n,i,r,s){var a=0,o=0,l=1;if(s(e,t[n+r])>0){o=i-r;while(l<o&&s(e,t[n+r+l])>0)a=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o),a+=r,l+=r}else{o=r+1;while(l<o&&s(e,t[n+r-l])<=0)a=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o);var u=a;a=r-l,l=r-u}a++;while(a<l){var c=a+(l-a>>>1);s(e,t[n+c])>0?a=c+1:l=c}return l}function u(e,t,n,i,r,s){var a=0,o=0,l=1;if(s(e,t[n+r])<0){o=r+1;while(l<o&&s(e,t[n+r-l])<0)a=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o);var u=a;a=r-l,l=r-u}else{o=i-r;while(l<o&&s(e,t[n+r+l])>=0)a=l,l=1+(l<<1),l<=0&&(l=o);l>o&&(l=o),a+=r,l+=r}a++;while(a<l){var c=a+(l-a>>>1);s(e,t[n+c])<0?l=c:a=c+1}return l}function c(e,t){var n,r,s=i,a=0,o=0;a=e.length;var c=[];function d(e,t){n[o]=e,r[o]=t,o+=1}function h(){while(o>1){var e=o-2;if(e>=1&&r[e-1]<=r[e]+r[e+1]||e>=2&&r[e-2]<=r[e]+r[e-1])r[e-1]<r[e+1]&&e--;else if(r[e]>r[e+1])break;p(e)}}function f(){while(o>1){var e=o-2;e>0&&r[e-1]<r[e+1]&&e--,p(e)}}function p(i){var s=n[i],a=r[i],c=n[i+1],d=r[i+1];r[i]=a+d,i===o-3&&(n[i+1]=n[i+2],r[i+1]=r[i+2]),o--;var h=u(e[c],e,s,a,0,t);s+=h,a-=h,0!==a&&(d=l(e[s+a-1],e,c,d,d-1,t),0!==d&&(a<=d?g(s,a,c,d):m(s,a,c,d)))}function g(n,r,a,o){var d=0;for(d=0;d<r;d++)c[d]=e[n+d];var h=0,f=a,p=n;if(e[p++]=e[f++],0!==--o)if(1!==r){var g,m,v,y=s;while(1){g=0,m=0,v=!1;do{if(t(e[f],c[h])<0){if(e[p++]=e[f++],m++,g=0,0===--o){v=!0;break}}else if(e[p++]=c[h++],g++,m=0,1===--r){v=!0;break}}while((g|m)<y);if(v)break;do{if(g=u(e[f],c,h,r,0,t),0!==g){for(d=0;d<g;d++)e[p+d]=c[h+d];if(p+=g,h+=g,r-=g,r<=1){v=!0;break}}if(e[p++]=e[f++],0===--o){v=!0;break}if(m=l(c[h],e,f,o,0,t),0!==m){for(d=0;d<m;d++)e[p+d]=e[f+d];if(p+=m,f+=m,o-=m,0===o){v=!0;break}}if(e[p++]=c[h++],1===--r){v=!0;break}y--}while(g>=i||m>=i);if(v)break;y<0&&(y=0),y+=2}if(s=y,s<1&&(s=1),1===r){for(d=0;d<o;d++)e[p+d]=e[f+d];e[p+o]=c[h]}else{if(0===r)throw new Error;for(d=0;d<r;d++)e[p+d]=c[h+d]}}else{for(d=0;d<o;d++)e[p+d]=e[f+d];e[p+o]=c[h]}else for(d=0;d<r;d++)e[p+d]=c[h+d]}function m(n,r,a,o){var d=0;for(d=0;d<o;d++)c[d]=e[a+d];var h=n+r-1,f=o-1,p=a+o-1,g=0,m=0;if(e[p--]=e[h--],0!==--r)if(1!==o){var v=s;while(1){var y=0,b=0,_=!1;do{if(t(c[f],e[h])<0){if(e[p--]=e[h--],y++,b=0,0===--r){_=!0;break}}else if(e[p--]=c[f--],b++,y=0,1===--o){_=!0;break}}while((y|b)<v);if(_)break;do{if(y=r-u(c[f],e,n,r,r-1,t),0!==y){for(p-=y,h-=y,r-=y,m=p+1,g=h+1,d=y-1;d>=0;d--)e[m+d]=e[g+d];if(0===r){_=!0;break}}if(e[p--]=c[f--],1===--o){_=!0;break}if(b=o-l(e[h],c,0,o,o-1,t),0!==b){for(p-=b,f-=b,o-=b,m=p+1,g=f+1,d=0;d<b;d++)e[m+d]=c[g+d];if(o<=1){_=!0;break}}if(e[p--]=e[h--],0===--r){_=!0;break}v--}while(y>=i||b>=i);if(_)break;v<0&&(v=0),v+=2}if(s=v,s<1&&(s=1),1===o){for(p-=r,h-=r,m=p+1,g=h+1,d=r-1;d>=0;d--)e[m+d]=e[g+d];e[p]=c[f]}else{if(0===o)throw new Error;for(g=p-(o-1),d=0;d<o;d++)e[g+d]=c[d]}}else{for(p-=r,h-=r,m=p+1,g=h+1,d=r-1;d>=0;d--)e[m+d]=e[g+d];e[p]=c[f]}else for(g=p-(o-1),d=0;d<o;d++)e[g+d]=c[d]}n=[],r=[],this.mergeRuns=h,this.forceMergeRuns=f,this.pushRun=d}function d(e,t,i,a){i||(i=0),a||(a=e.length);var l=a-i;if(!(l<2)){var u=0;if(l<n)return u=s(e,i,a,t),void o(e,i,a,i+u,t);var d=new c(e,t),h=r(l);do{if(u=s(e,i,a,t),u<h){var f=l;f>h&&(f=h),o(e,i,i+f,i+u,t),u=f}d.pushRun(i,u),d.mergeRuns(),l-=u,i+=u}while(0!==l);d.forceMergeRuns()}}e.exports=d},"0655":function(e,t,n){var i=n("8728"),r=1e-8;function s(e,t){return Math.abs(e-t)<r}function a(e,t,n){var r=0,a=e[0];if(!a)return!1;for(var o=1;o<e.length;o++){var l=e[o];r+=i(a[0],a[1],l[0],l[1],t,n),a=l}var u=e[0];return s(a[0],u[0])&&s(a[1],u[1])||(r+=i(a[0],a[1],u[0],u[1],t,n)),0!==r}t.contain=a},"06ad":function(e,t,n){var i=n("4436"),r=n("41ef"),s=n("6d8b"),a=s.isArrayLike,o=Array.prototype.slice;function l(e,t){return e[t]}function u(e,t,n){e[t]=n}function c(e,t,n){return(t-e)*n+e}function d(e,t,n){return n>.5?t:e}function h(e,t,n,i,r){var s=e.length;if(1==r)for(var a=0;a<s;a++)i[a]=c(e[a],t[a],n);else{var o=s&&e[0].length;for(a=0;a<s;a++)for(var l=0;l<o;l++)i[a][l]=c(e[a][l],t[a][l],n)}}function f(e,t,n){var i=e.length,r=t.length;if(i!==r){var s=i>r;if(s)e.length=r;else for(var a=i;a<r;a++)e.push(1===n?t[a]:o.call(t[a]))}var l=e[0]&&e[0].length;for(a=0;a<e.length;a++)if(1===n)isNaN(e[a])&&(e[a]=t[a]);else for(var u=0;u<l;u++)isNaN(e[a][u])&&(e[a][u]=t[a][u])}function p(e,t,n){if(e===t)return!0;var i=e.length;if(i!==t.length)return!1;if(1===n){for(var r=0;r<i;r++)if(e[r]!==t[r])return!1}else{var s=e[0].length;for(r=0;r<i;r++)for(var a=0;a<s;a++)if(e[r][a]!==t[r][a])return!1}return!0}function g(e,t,n,i,r,s,a,o,l){var u=e.length;if(1==l)for(var c=0;c<u;c++)o[c]=m(e[c],t[c],n[c],i[c],r,s,a);else{var d=e[0].length;for(c=0;c<u;c++)for(var h=0;h<d;h++)o[c][h]=m(e[c][h],t[c][h],n[c][h],i[c][h],r,s,a)}}function m(e,t,n,i,r,s,a){var o=.5*(n-e),l=.5*(i-t);return(2*(t-n)+o+l)*a+(-3*(t-n)-2*o-l)*s+o*r+t}function v(e){if(a(e)){var t=e.length;if(a(e[0])){for(var n=[],i=0;i<t;i++)n.push(o.call(e[i]));return n}return o.call(e)}return e}function y(e){return e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.floor(e[2]),"rgba("+e.join(",")+")"}function b(e){var t=e[e.length-1].value;return a(t&&t[0])?2:1}function _(e,t,n,s,o,l){var u=e._getter,v=e._setter,_="spline"===t,T=s.length;if(T){var S,w=s[0].value,E=a(w),x=!1,k=!1,A=E?b(s):0;s.sort(function(e,t){return e.time-t.time}),S=s[T-1].time;for(var I=[],C=[],D=s[0].value,R=!0,M=0;M<T;M++){I.push(s[M].time/S);var L=s[M].value;if(E&&p(L,D,A)||!E&&L===D||(R=!1),D=L,"string"==typeof L){var P=r.parse(L);P?(L=P,x=!0):k=!0}C.push(L)}if(l||!R){var O=C[T-1];for(M=0;M<T-1;M++)E?f(C[M],O,A):!isNaN(C[M])||isNaN(O)||k||x||(C[M]=O);E&&f(u(e._target,o),O,A);var N,U,F,B,j,V,H=0,$=0;if(x)var G=[0,0,0,0];var z=function(e,t){var n;if(t<0)n=0;else if(t<$){for(N=Math.min(H+1,T-1),n=N;n>=0;n--)if(I[n]<=t)break;n=Math.min(n,T-2)}else{for(n=H;n<T;n++)if(I[n]>t)break;n=Math.min(n-1,T-2)}H=n,$=t;var i=I[n+1]-I[n];if(0!==i)if(U=(t-I[n])/i,_)if(B=C[n],F=C[0===n?n:n-1],j=C[n>T-2?T-1:n+1],V=C[n>T-3?T-1:n+2],E)g(F,B,j,V,U,U*U,U*U*U,u(e,o),A);else{if(x)r=g(F,B,j,V,U,U*U,U*U*U,G,1),r=y(G);else{if(k)return d(B,j,U);r=m(F,B,j,V,U,U*U,U*U*U)}v(e,o,r)}else if(E)h(C[n],C[n+1],U,u(e,o),A);else{var r;if(x)h(C[n],C[n+1],U,G,1),r=y(G);else{if(k)return d(C[n],C[n+1],U);r=c(C[n],C[n+1],U)}v(e,o,r)}},q=new i({target:e._target,life:S,loop:e._loop,delay:e._delay,onframe:z,ondestroy:n});return t&&"spline"!==t&&(q.easing=t),q}}}var T=function(e,t,n,i){this._tracks={},this._target=e,this._loop=t||!1,this._getter=n||l,this._setter=i||u,this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[]};T.prototype={when:function(e,t){var n=this._tracks;for(var i in t)if(t.hasOwnProperty(i)){if(!n[i]){n[i]=[];var r=this._getter(this._target,i);if(null==r)continue;0!==e&&n[i].push({time:0,value:v(r)})}n[i].push({time:e,value:t[i]})}return this},during:function(e){return this._onframeList.push(e),this},pause:function(){for(var e=0;e<this._clipList.length;e++)this._clipList[e].pause();this._paused=!0},resume:function(){for(var e=0;e<this._clipList.length;e++)this._clipList[e].resume();this._paused=!1},isPaused:function(){return!!this._paused},_doneCallback:function(){this._tracks={},this._clipList.length=0;for(var e=this._doneList,t=e.length,n=0;n<t;n++)e[n].call(this)},start:function(e,t){var n,i=this,r=0,s=function(){r--,r||i._doneCallback()};for(var a in this._tracks)if(this._tracks.hasOwnProperty(a)){var o=_(this,e,s,this._tracks[a],a,t);o&&(this._clipList.push(o),r++,this.animation&&this.animation.addClip(o),n=o)}if(n){var l=n.onframe;n.onframe=function(e,t){l(e,t);for(var n=0;n<i._onframeList.length;n++)i._onframeList[n](e,t)}}return r||this._doneCallback(),this},stop:function(e){for(var t=this._clipList,n=this.animation,i=0;i<t.length;i++){var r=t[i];e&&r.onframe(this._target,1),n&&n.removeClip(r)}t.length=0},delay:function(e){return this._delay=e,this},done:function(e){return e&&this._doneList.push(e),this},getClips:function(){return this._clipList}};var S=T;e.exports=S},"07d7":function(e,t,n){var i=n("6d8b"),r=n("41ef"),s=n("607d"),a=n("22d1"),o=n("eda2"),l=i.each,u=o.toCamelCase,c=["","-webkit-","-moz-","-o-"],d="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;";function h(e){var t="cubic-bezier(0.23, 1, 0.32, 1)",n="left "+e+"s "+t+",top "+e+"s "+t;return i.map(c,function(e){return e+"transition:"+n}).join(";")}function f(e){var t=[],n=e.get("fontSize"),i=e.getTextColor();return i&&t.push("color:"+i),t.push("font:"+e.getFont()),n&&t.push("line-height:"+Math.round(3*n/2)+"px"),l(["decoration","align"],function(n){var i=e.get(n);i&&t.push("text-"+n+":"+i)}),t.join(";")}function p(e){var t=[],n=e.get("transitionDuration"),i=e.get("backgroundColor"),s=e.getModel("textStyle"),c=e.get("padding");return n&&t.push(h(n)),i&&(a.canvasSupported?t.push("background-Color:"+i):(t.push("background-Color:#"+r.toHex(i)),t.push("filter:alpha(opacity=70)"))),l(["width","color","radius"],function(n){var i="border-"+n,r=u(i),s=e.get(r);null!=s&&t.push(i+":"+s+("color"===n?"":"px"))}),t.push(f(s)),null!=c&&t.push("padding:"+o.normalizeCssArray(c).join("px ")+"px"),t.join(";")+";"}function g(e,t){if(a.wxa)return null;var n=document.createElement("div"),i=this._zr=t.getZr();this.el=n,this._x=t.getWidth()/2,this._y=t.getHeight()/2,e.appendChild(n),this._container=e,this._show=!1,this._hideTimeout;var r=this;n.onmouseenter=function(){r._enterable&&(clearTimeout(r._hideTimeout),r._show=!0),r._inContent=!0},n.onmousemove=function(t){if(t=t||window.event,!r._enterable){var n=i.handler;s.normalizeEvent(e,t,!0),n.dispatch("mousemove",t)}},n.onmouseleave=function(){r._enterable&&r._show&&r.hideLater(r._hideDelay),r._inContent=!1}}g.prototype={constructor:g,_enterable:!0,update:function(){var e=this._container,t=e.currentStyle||document.defaultView.getComputedStyle(e),n=e.style;"absolute"!==n.position&&"absolute"!==t.position&&(n.position="relative")},show:function(e){clearTimeout(this._hideTimeout);var t=this.el;t.style.cssText=d+p(e)+";left:"+this._x+"px;top:"+this._y+"px;"+(e.get("extraCssText")||""),t.style.display=t.innerHTML?"block":"none",this._show=!0},setContent:function(e){this.el.innerHTML=null==e?"":e},setEnterable:function(e){this._enterable=e},getSize:function(){var e=this.el;return[e.clientWidth,e.clientHeight]},moveTo:function(e,t){var n,i=this._zr;i&&i.painter&&(n=i.painter.getViewportRootOffset())&&(e+=n.offsetLeft,t+=n.offsetTop);var r=this.el.style;r.left=e+"px",r.top=t+"px",this._x=e,this._y=t},hide:function(){this.el.style.display="none",this._show=!1},hideLater:function(e){!this._show||this._inContent&&this._enterable||(e?(this._hideDelay=e,this._show=!1,this._hideTimeout=setTimeout(i.bind(this.hide,this),e)):this.hide())},isShow:function(){return this._show}};var m=g;e.exports=m},"097d":function(e,t,n){"use strict";var i=n("5ca1"),r=n("8378"),s=n("7726"),a=n("ebd6"),o=n("bcaa");i(i.P+i.R,"Promise",{finally:function(e){var t=a(this,r.Promise||s.Promise),n="function"==typeof e;return this.then(n?function(n){return o(t,e()).then(function(){return n})}:e,n?function(n){return o(t,e()).then(function(){throw n})}:e)}})},"0aec":function(e,t){function n(){return e.exports=n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},e.exports.__esModule=!0,e.exports["default"]=e.exports,n.apply(null,arguments)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"0b44":function(e,t,n){var i=n("607d"),r=function(){this._track=[]};function s(e){var t=e[1][0]-e[0][0],n=e[1][1]-e[0][1];return Math.sqrt(t*t+n*n)}function a(e){return[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]}r.prototype={constructor:r,recognize:function(e,t,n){return this._doTrack(e,t,n),this._recognize(e)},clear:function(){return this._track.length=0,this},_doTrack:function(e,t,n){var r=e.touches;if(r){for(var s={points:[],touches:[],target:t,event:e},a=0,o=r.length;a<o;a++){var l=r[a],u=i.clientToLocal(n,l,{});s.points.push([u.zrX,u.zrY]),s.touches.push(l)}this._track.push(s)}},_recognize:function(e){for(var t in o)if(o.hasOwnProperty(t)){var n=o[t](this._track,e);if(n)return n}}};var o={pinch:function(e,t){var n=e.length;if(n){var i=(e[n-1]||{}).points,r=(e[n-2]||{}).points||i;if(r&&r.length>1&&i&&i.length>1){var o=s(i)/s(r);!isFinite(o)&&(o=1),t.pinchScale=o;var l=a(i);return t.pinchX=l[0],t.pinchY=l[1],{type:"pinch",target:e[0].target,event:t}}}}},l=r;e.exports=l},"0bfb":function(e,t,n){"use strict";var i=n("cb7c");e.exports=function(){var e=i(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},"0cde":function(e,t,n){var i=n("1687"),r=n("401b"),s=i.identity,a=5e-5;function o(e){return e>a||e<-a}var l=function(e){e=e||{},e.position||(this.position=[0,0]),null==e.rotation&&(this.rotation=0),e.scale||(this.scale=[1,1]),this.origin=this.origin||null},u=l.prototype;u.transform=null,u.needLocalTransform=function(){return o(this.rotation)||o(this.position[0])||o(this.position[1])||o(this.scale[0]-1)||o(this.scale[1]-1)},u.updateTransform=function(){var e=this.parent,t=e&&e.transform,n=this.needLocalTransform(),r=this.transform;n||t?(r=r||i.create(),n?this.getLocalTransform(r):s(r),t&&(n?i.mul(r,e.transform,r):i.copy(r,e.transform)),this.transform=r,this.invTransform=this.invTransform||i.create(),i.invert(this.invTransform,r)):r&&s(r)},u.getLocalTransform=function(e){return l.getLocalTransform(this,e)},u.setTransform=function(e){var t=this.transform,n=e.dpr||1;t?e.setTransform(n*t[0],n*t[1],n*t[2],n*t[3],n*t[4],n*t[5]):e.setTransform(n,0,0,n,0,0)},u.restoreTransform=function(e){var t=e.dpr||1;e.setTransform(t,0,0,t,0,0)};var c=[];u.decomposeTransform=function(){if(this.transform){var e=this.parent,t=this.transform;e&&e.transform&&(i.mul(c,e.invTransform,t),t=c);var n=t[0]*t[0]+t[1]*t[1],r=t[2]*t[2]+t[3]*t[3],s=this.position,a=this.scale;o(n-1)&&(n=Math.sqrt(n)),o(r-1)&&(r=Math.sqrt(r)),t[0]<0&&(n=-n),t[3]<0&&(r=-r),s[0]=t[4],s[1]=t[5],a[0]=n,a[1]=r,this.rotation=Math.atan2(-t[1]/r,t[0]/n)}},u.getGlobalScale=function(){var e=this.transform;if(!e)return[1,1];var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]),n=Math.sqrt(e[2]*e[2]+e[3]*e[3]);return e[0]<0&&(t=-t),e[3]<0&&(n=-n),[t,n]},u.transformCoordToLocal=function(e,t){var n=[e,t],i=this.invTransform;return i&&r.applyTransform(n,n,i),n},u.transformCoordToGlobal=function(e,t){var n=[e,t],i=this.transform;return i&&r.applyTransform(n,n,i),n},l.getLocalTransform=function(e,t){t=t||[],s(t);var n=e.origin,r=e.scale||[1,1],a=e.rotation||0,o=e.position||[0,0];return n&&(t[4]-=n[0],t[5]-=n[1]),i.scale(t,t,r),a&&i.rotate(t,t,a),n&&(t[4]+=n[0],t[5]+=n[1]),t[4]+=o[0],t[5]+=o[1],t};var d=l;e.exports=d},"0d58":function(e,t,n){var i=n("ce10"),r=n("e11e");e.exports=Object.keys||function(e){return i(e,r)}},"0da8":function(e,t,n){var i=n("19eb"),r=n("9850"),s=n("6d8b"),a=n("5e76");function o(e){i.call(this,e)}o.prototype={constructor:o,type:"image",brush:function(e,t){var n=this.style,i=n.image;n.bind(e,this,t);var r=this._image=a.createOrUpdateImage(i,this._image,this,this.onload);if(r&&a.isImageReady(r)){var s=n.x||0,o=n.y||0,l=n.width,u=n.height,c=r.width/r.height;if(null==l&&null!=u?l=u*c:null==u&&null!=l?u=l/c:null==l&&null==u&&(l=r.width,u=r.height),this.setTransform(e),n.sWidth&&n.sHeight){var d=n.sx||0,h=n.sy||0;e.drawImage(r,d,h,n.sWidth,n.sHeight,s,o,l,u)}else if(n.sx&&n.sy){d=n.sx,h=n.sy;var f=l-d,p=u-h;e.drawImage(r,d,h,f,p,s,o,l,u)}else e.drawImage(r,s,o,l,u);null!=n.text&&(this.restoreTransform(e),this.drawRectText(e,this.getBoundingRect()))}},getBoundingRect:function(){var e=this.style;return this._rect||(this._rect=new r(e.x||0,e.y||0,e.width||0,e.height||0)),this._rect}},s.inherits(o,i);var l=o;e.exports=l},"0f99":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("e0d3")),s=r.makeInner,a=r.getDataItemValue,o=n("8b7f"),l=o.getCoordSysDefineBySeries,u=n("6d8b"),c=u.createHashMap,d=u.each,h=u.map,f=u.isArray,p=u.isString,g=u.isObject,m=u.isTypedArray,v=u.isArrayLike,y=u.extend,b=(u.assert,n("ec6f")),_=n("93d0"),T=_.SOURCE_FORMAT_ORIGINAL,S=_.SOURCE_FORMAT_ARRAY_ROWS,w=_.SOURCE_FORMAT_OBJECT_ROWS,E=_.SOURCE_FORMAT_KEYED_COLUMNS,x=_.SOURCE_FORMAT_UNKNOWN,k=_.SOURCE_FORMAT_TYPED_ARRAY,A=_.SERIES_LAYOUT_BY_ROW,I=s();function C(e){var t=e.option.source,n=x;if(m(t))n=k;else if(f(t))for(var i=0,r=t.length;i<r;i++){var s=t[i];if(null!=s){if(f(s)){n=S;break}if(g(s)){n=w;break}}}else if(g(t)){for(var a in t)if(t.hasOwnProperty(a)&&v(t[a])){n=E;break}}else if(null!=t)throw new Error("Invalid data");I(e).sourceFormat=n}function D(e){return I(e).source}function R(e){I(e).datasetMap=c()}function M(e){var t=e.option,n=t.data,i=m(n)?k:T,r=!1,s=t.seriesLayoutBy,a=t.sourceHeader,o=t.dimensions,l=F(e);if(l){var u=l.option;n=u.source,i=I(l).sourceFormat,r=!0,s=s||u.seriesLayoutBy,null==a&&(a=u.sourceHeader),o=o||u.dimensions}var c=L(n,i,s,a,o),d=t.encode;!d&&l&&(d=U(e,l,n,i,s,c)),I(e).source=new b({data:n,fromDataset:r,seriesLayoutBy:s,sourceFormat:i,dimensionsDefine:c.dimensionsDefine,startIndex:c.startIndex,dimensionsDetectCount:c.dimensionsDetectCount,encodeDefine:d})}function L(e,t,n,i,r){if(!e)return{dimensionsDefine:P(r)};var s,o,l,u;if(t===S)"auto"===i||null==i?O(function(e){null!=e&&"-"!==e&&(p(e)?null==o&&(o=1):o=0)},n,e,10):o=i?1:0,r||1!==o||(r=[],O(function(e,t){r[t]=null!=e?e:""},n,e)),s=r?r.length:n===A?e.length:e[0]?e[0].length:null;else if(t===w)r||(r=N(e),l=!0);else if(t===E)r||(r=[],l=!0,d(e,function(e,t){r.push(t)}));else if(t===T){var c=a(e[0]);s=f(c)&&c.length||1}return l&&d(r,function(e,t){"name"===(g(e)?e.name:e)&&(u=t)}),{startIndex:o,dimensionsDefine:P(r),dimensionsDetectCount:s,potentialNameDimIndex:u}}function P(e){if(e){var t=c();return h(e,function(e,n){if(e=y({},g(e)?e:{name:e}),null==e.name)return e;e.name+="",null==e.displayName&&(e.displayName=e.name);var i=t.get(e.name);return i?e.name+="-"+i.count++:t.set(e.name,{count:1}),e})}}function O(e,t,n,i){if(null==i&&(i=1/0),t===A)for(var r=0;r<n.length&&r<i;r++)e(n[r]?n[r][0]:null,r);else{var s=n[0]||[];for(r=0;r<s.length&&r<i;r++)e(s[r],r)}}function N(e){var t,n=0;while(n<e.length&&!(t=e[n++]));if(t){var i=[];return d(t,function(e,t){i.push(t)}),i}}function U(e,t,n,i,r,s){var a=l(e),o={},u=[],h=[],f=e.subType,p=c(["pie","map","funnel"]),g=c(["line","bar","pictorialBar","scatter","effectScatter","candlestick","boxplot"]);if(a&&null!=g.get(f)){var m=e.ecModel,v=I(m).datasetMap,y=t.uid+"_"+r,b=v.get(y)||v.set(y,{categoryWayDim:1,valueWayDim:0});d(a.coordSysDims,function(e){if(null==a.firstCategoryDimIndex){var t=b.valueWayDim++;o[e]=t,h.push(t)}else if(a.categoryAxisMap.get(e))o[e]=0,u.push(0);else{t=b.categoryWayDim++;o[e]=t,h.push(t)}})}else if(null!=p.get(f)){for(var _,T=0;T<5&&null==_;T++)j(n,i,r,s.dimensionsDefine,s.startIndex,T)||(_=T);if(null!=_){o.value=_;var S=s.potentialNameDimIndex||Math.max(_-1,0);h.push(S),u.push(S)}}return u.length&&(o.itemName=u),h.length&&(o.seriesName=h),o}function F(e){var t=e.option,n=t.data;if(!n)return e.ecModel.getComponent("dataset",t.datasetIndex||0)}function B(e,t){return j(e.data,e.sourceFormat,e.seriesLayoutBy,e.dimensionsDefine,e.startIndex,t)}function j(e,t,n,i,r,s){var o,l,u=5;if(m(e))return!1;if(i&&(l=i[s],l=g(l)?l.name:l),t===S)if(n===A){for(var c=e[s],d=0;d<(c||[]).length&&d<u;d++)if(null!=(o=b(c[r+d])))return o}else for(d=0;d<e.length&&d<u;d++){var h=e[r+d];if(h&&null!=(o=b(h[s])))return o}else if(t===w){if(!l)return;for(d=0;d<e.length&&d<u;d++){var v=e[d];if(v&&null!=(o=b(v[l])))return o}}else if(t===E){if(!l)return;c=e[l];if(!c||m(c))return!1;for(d=0;d<c.length&&d<u;d++)if(null!=(o=b(c[d])))return o}else if(t===T)for(d=0;d<e.length&&d<u;d++){v=e[d];var y=a(v);if(!f(y))return!1;if(null!=(o=b(y[s])))return o}function b(e){return(null==e||!isFinite(e)||""===e)&&(!(!p(e)||"-"===e)||void 0)}return!1}t.detectSourceFormat=C,t.getSource=D,t.resetSourceDefaulter=R,t.prepareSource=M,t.guessOrdinal=B},"11e9":function(e,t,n){var i=n("52a7"),r=n("4630"),s=n("6821"),a=n("6a99"),o=n("69a8"),l=n("c69a"),u=Object.getOwnPropertyDescriptor;t.f=n("9e1e")?u:function(e,t){if(e=s(e),t=a(t,!0),l)try{return u(e,t)}catch(e){}if(o(e,t))return r(!i.f.call(e,t),e[t])}},"128e":function(e,t,n){"use strict";function i(){return"boolean"===typeof __RX_PLAYER_DEBUG_MODE__&&__RX_PLAYER_DEBUG_MODE__}function r(e){return null===e||void 0===e}class s{constructor(){this._listeners={}}addEventListener(e,t,n){const i=this._listeners[e];Array.isArray(i)?i.push(t):this._listeners[e]=[t],void 0!==n&&n.register(()=>{this.removeEventListener(e,t)})}removeEventListener(e,t){if(r(e))return void(this._listeners={});const n=this._listeners[e];if(!Array.isArray(n))return;if(r(t))return void delete this._listeners[e];const i=n.indexOf(t);-1!==i&&n.splice(i,1),0===n.length&&delete this._listeners[e]}trigger(e,t){const n=this._listeners[e];Array.isArray(n)&&n.slice().forEach(e=>{try{e(t)}catch(e){0,console.error("RxPlayer: EventEmitter error",e instanceof Error?e:null)}})}}var a=n("45c1"),o=n("d708"),l="function"===typeof queueMicrotask?queueMicrotask:function(e){Promise.resolve().then(e,()=>e())};function u(){if(!o["a"]&&!r(a["a"].WebKitSourceBuffer)&&void 0===a["a"].WebKitSourceBuffer.prototype.addEventListener){const e=a["a"].WebKitSourceBuffer,t=e.prototype;for(const n in s.prototype)s.prototype.hasOwnProperty(n)&&(t[n]=s.prototype[n]);t._listeners=[],t._emitUpdate=function(e,t){l(()=>{this.trigger(e,t),this.updating=!1,this.trigger("updateend")})},t.appendBuffer=function(e){if(this.updating)throw new Error("updating");this.trigger("updatestart"),this.updating=!0;try{this.append(e)}catch(e){return void this._emitUpdate("error",e)}this._emitUpdate("update")}}}let c=!1,d=!1,h=!1,f=!1,p=!1,g=!1,m=!1,v=!1,y=!1,b=!1,_=!1,T=!1,S=!1,w=!1,E=!1;(function(){var e,t,n;o["a"]||("undefined"!==typeof a["a"].MSInputMethodContext&&"undefined"!==typeof document.documentMode?(d=!0,h=!0):"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&/(Trident|Edge)\//.test(navigator.userAgent)?h=!0:-1!==navigator.userAgent.toLowerCase().indexOf("edg/")?c=!0:-1!==navigator.userAgent.toLowerCase().indexOf("firefox")?f=!0:"string"===typeof navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)?g=!0:(Object.prototype.toString.call(a["a"].HTMLElement).indexOf("Constructor")>=0||"[object SafariRemoteNotification]"===(null===(t=null===(e=a["a"].safari)||void 0===e?void 0:e.pushNotification)||void 0===t?void 0:t.toString())||/Safari\/(\d+)/.test(navigator.userAgent)&&/Version\/(\d+)/.test(navigator.userAgent)&&-1!==(null===(n=navigator.vendor)||void 0===n?void 0:n.indexOf("Apple"))&&!/Chrome\/(\d+)/.test(navigator.userAgent)&&!/Chromium\/(\d+)/.test(navigator.userAgent))&&(p=!0),/SamsungBrowser/.test(navigator.userAgent)&&(m=!0),-1!==navigator.userAgent.indexOf("PlayStation 4")?S=!0:-1!==navigator.userAgent.indexOf("PlayStation 5")?w=!0:/Tizen/.test(navigator.userAgent)?v=!0:/[Ww]eb[O0]S/.test(navigator.userAgent)?(y=!0,/[Ww]eb[O0]S.TV-2022/.test(navigator.userAgent)||/[Cc]hr[o0]me\/87/.test(navigator.userAgent)?_=!0:(/[Ww]eb[O0]S.TV-2021/.test(navigator.userAgent)||/[Cc]hr[o0]me\/79/.test(navigator.userAgent))&&(b=!0)):/[Pp]anasonic/.test(navigator.userAgent)?T=!0:-1!==navigator.userAgent.indexOf("Xbox")&&(E=!0))})();const x=w;var k=x;function A(e){return void 0===e||e.indexOf("widevine")<0}const I={DEFAULT_REQUEST_TIMEOUT:3e4,DEFAULT_CONNECTION_TIMEOUT:15e3,DEFAULT_TEXT_TRACK_MODE:"native",DEFAULT_ENABLE_FAST_SWITCHING:!0,DELTA_POSITION_AFTER_RELOAD:{bitrateSwitch:-.1,trackSwitch:{audio:0,video:0,other:0}},DEFAULT_CODEC_SWITCHING_BEHAVIOR:"continue",DEFAULT_AUTO_PLAY:!1,DEFAULT_WANTED_BUFFER_AHEAD:30,DEFAULT_MAX_BUFFER_AHEAD:1/0,DEFAULT_MAX_BUFFER_BEHIND:1/0,DEFAULT_MAX_VIDEO_BUFFER_SIZE:1/0,MAXIMUM_MAX_BUFFER_AHEAD:{text:18e3},MINIMUM_MAX_BUFFER_AHEAD:{text:120},MAXIMUM_MAX_BUFFER_BEHIND:{text:18e3},DEFAULT_BASE_BANDWIDTH:0,INACTIVITY_DELAY:6e4,DEFAULT_THROTTLE_VIDEO_BITRATE_WHEN_HIDDEN:!1,DEFAULT_VIDEO_RESOLUTION_LIMIT:"none",DEFAULT_LIVE_GAP:{DEFAULT:10,LOW_LATENCY:3.5},BUFFER_DISCONTINUITY_THRESHOLD:.2,BITRATE_REBUFFERING_RATIO:1.5,DEFAULT_MAX_MANIFEST_REQUEST_RETRY:4,DEFAULT_CDN_DOWNGRADE_TIME:60,DEFAULT_MAX_REQUESTS_RETRY_ON_ERROR:4,INITIAL_BACKOFF_DELAY_BASE:{REGULAR:200,LOW_LATENCY:50},MAX_BACKOFF_DELAY_BASE:{REGULAR:3e3,LOW_LATENCY:1e3},SAMPLING_INTERVAL_MEDIASOURCE:1e3,SAMPLING_INTERVAL_LOW_LATENCY:500,SAMPLING_INTERVAL_NO_MEDIASOURCE:500,ABR_ENTER_BUFFER_BASED_ALGO:10,ABR_EXIT_BUFFER_BASED_ALGO:5,ABR_MINIMUM_TOTAL_BYTES:15e4,ABR_MINIMUM_CHUNK_SIZE:16e3,ABR_STARVATION_FACTOR:{DEFAULT:.72,LOW_LATENCY:.72},ABR_REGULAR_FACTOR:{DEFAULT:.72,LOW_LATENCY:.72},ABR_STARVATION_GAP:{DEFAULT:5,LOW_LATENCY:5},OUT_OF_STARVATION_GAP:{DEFAULT:7,LOW_LATENCY:7},ABR_STARVATION_DURATION_DELTA:.1,ABR_FAST_EMA:2,ABR_SLOW_EMA:10,RESUME_GAP_AFTER_SEEKING:{DEFAULT:1.5,LOW_LATENCY:.5},RESUME_GAP_AFTER_NOT_ENOUGH_DATA:{DEFAULT:.5,LOW_LATENCY:.5},RESUME_GAP_AFTER_BUFFERING:{DEFAULT:5,LOW_LATENCY:.5},REBUFFERING_GAP:{DEFAULT:.5,LOW_LATENCY:.2},MINIMUM_BUFFER_AMOUNT_BEFORE_FREEZING:2,UNFREEZING_SEEK_DELAY:6e3,FREEZING_STALLED_DELAY:600,UNFREEZING_DELTA_POSITION:.001,SEGMENT_SYNCHRONIZATION_DELAY:1500,MISSING_DATA_TRIGGER_SYNC_DELAY:.1,MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:.15,MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:.4,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:.3,MINIMUM_SEGMENT_SIZE:.001,APPEND_WINDOW_SECURITIES:{START:.2,END:.1},MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL:50,TEXT_TRACK_SIZE_CHECKS_INTERVAL:250,BUFFER_PADDING:{audio:1,video:3,other:1},SEGMENT_PRIORITIES_STEPS:[2,4,8,12,18,25],MAX_HIGH_PRIORITY_LEVEL:1,MIN_CANCELABLE_PRIORITY:3,EME_DEFAULT_VIDEO_CODECS:['video/mp4;codecs="avc1.4d401e"','video/mp4;codecs="avc1.42e01e"','video/webm;codecs="vp8"'],EME_DEFAULT_AUDIO_CODECS:['audio/mp4;codecs="mp4a.40.2"',"audio/webm;codecs=opus"],EME_DEFAULT_WIDEVINE_ROBUSTNESSES:["HW_SECURE_ALL","HW_SECURE_DECODE","HW_SECURE_CRYPTO","SW_SECURE_DECODE","SW_SECURE_CRYPTO"],EME_DEFAULT_PLAYREADY_RECOMMENDATION_ROBUSTNESSES:["3000","2000"],EME_KEY_SYSTEMS:{clearkey:["webkit-org.w3.clearkey","org.w3.clearkey"],widevine:["com.widevine.alpha"],playready:["com.microsoft.playready.recommendation","com.microsoft.playready","com.chromecast.playready","com.youtube.playready"],fairplay:["com.apple.fps.1_0"]},MAX_CONSECUTIVE_MANIFEST_PARSING_IN_UNSAFE_MODE:10,MIN_MANIFEST_PARSING_TIME_TO_ENTER_UNSAFE_MODE:200,MIN_DASH_S_ELEMENTS_TO_PARSE_UNSAFELY:300,OUT_OF_SYNC_MANIFEST_REFRESH_DELAY:3e3,FAILED_PARTIAL_UPDATE_MANIFEST_REFRESH_DELAY:3e3,DASH_FALLBACK_LIFETIME_WHEN_MINIMUM_UPDATE_PERIOD_EQUAL_0:3,EME_DEFAULT_MAX_SIMULTANEOUS_MEDIA_KEY_SESSIONS:15,EME_MAX_STORED_PERSISTENT_SESSION_INFORMATION:1e3,EME_WAITING_DELAY_LOADED_SESSION_EMPTY_KEYSTATUSES:100,FORCED_ENDED_THRESHOLD:8e-4,ADAP_REP_SWITCH_BUFFER_PADDINGS:{video:{before:5,after:5},audio:{before:2,after:2.5},text:{before:0,after:0}},SOURCE_BUFFER_FLUSHING_INTERVAL:500,CONTENT_REPLACEMENT_PADDING:1.2,CACHE_LOAD_DURATION_THRESHOLDS:{video:50,audio:10},STREAM_EVENT_EMITTER_POLL_INTERVAL:250,DEFAULT_MAXIMUM_TIME_ROUNDING_ERROR:.001,BUFFERED_HISTORY_RETENTION_TIME:6e4,BUFFERED_HISTORY_MAXIMUM_ENTRIES:200,MIN_BUFFER_AHEAD:5,UPTO_CURRENT_POSITION_CLEANUP:5,DEFAULT_VIDEO_REPRESENTATIONS_SWITCHING_MODE:"seamless",DEFAULT_AUDIO_REPRESENTATIONS_SWITCHING_MODE:"seamless",DEFAULT_VIDEO_TRACK_SWITCHING_MODE:"reload",DEFAULT_AUDIO_TRACK_SWITCHING_MODE:"seamless"};var C=I;function D(e,...t){if(null===e||void 0===e)throw new TypeError("Cannot convert undefined or null to object");const n=Object(e);for(let i=0;i<t.length;i++){const e=t[i];for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}return n}var R="function"===typeof Object.assign?Object.assign:D;function M(e){return null!==e&&void 0!==e&&!Array.isArray(e)&&"object"===typeof e}function L(e,...t){if(0===t.length)return e;const n=t.shift();if(M(e)&&M(n))for(const i in n)if(M(n[i])){let t=e[i];void 0===t&&(t={},e[i]=t),L(t,n[i])}else R(e,{[i]:n[i]});return L(e,...t)}class P{constructor(){this._config=C}update(e){const t=L(this._config,e);this._config=t}getCurrent(){return this._config}}const O=new P;var N=O,U=function(){};const F="NONE";class B extends s{constructor(){super(),this.error=U,this.warn=U,this.info=U,this.debug=U,this._levels={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4},this._currentLevel=F}setLevel(e,t){let n;const i=this._levels[e];"number"===typeof i?(n=i,this._currentLevel=e):(n=0,this._currentLevel="NONE"),void 0===t?(this.error=n>=this._levels.ERROR?console.error.bind(console):U,this.warn=n>=this._levels.WARNING?console.warn.bind(console):U,this.info=n>=this._levels.INFO?console.info.bind(console):U,this.debug=n>=this._levels.DEBUG?console.log.bind(console):U):(this.error=n>=this._levels.ERROR?(...e)=>t("ERROR",e):U,this.warn=n>=this._levels.WARNING?(...e)=>t("WARNING",e):U,this.info=n>=this._levels.INFO?(...e)=>t("INFO",e):U,this.debug=n>=this._levels.DEBUG?(...e)=>t("DEBUG",e):U),this.trigger("onLogLevelChange",this._currentLevel)}getLevel(){return this._currentLevel}hasLevel(e){return this._levels[e]>=this._levels[this._currentLevel]}}const j=new B;var V=j;const H=1/60;function $(e,t){return Math.abs(e-t)<H}function G(e,t){const n=Math.min(e.start,t.start),i=Math.max(e.end,t.end);return{start:n,end:i}}function z(e){for(let t=0;t<e.length;t++){const n=e[t];n.start===n.end&&e.splice(t--,1)}return e}function q(e){for(let t=1;t<e.length;t++){const n=e[t-1],i=e[t];if(X(n,i)){const r=G(n,i);e.splice(--t,2,r)}}return e}function W(e,t){return e.end<=t.start}function K({start:e,end:t},n){return e<=n&&n<t}function Y(e,t){return K(e,t.start)||e.start<t.end&&t.end<e.end||K(t,e.start)}function X(e,t){return $(t.start,e.end)||$(t.end,e.start)}function Q(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}function Z(e,t){for(let n=e.length-1;n>=0;n--){const i=e.start(n);if(t>=i){const r=e.end(n);if(t<r)return{start:i,end:r}}}return null}function J(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n].start;if(t>=i){const i=e[n].end;if(t<i)return e[n]}}return null}function ee(e,t){const n=e.length;for(let i=0;i<n;i++){const n=e.start(i);if(t<n)return n-t}return 1/0}function te(e,t){let n=null;const i=[];for(let r=0;r<e.length;r++){const s=e[r].start,a=e[r].end;t<s||t>=a?i.push({start:s,end:a}):n={start:s,end:a}}return{outerRanges:i,innerRange:n}}function ne(e,t){const n=Z(e,t);return null!==n?n.end-t:1/0}function ie(e,t){const n=J(e,t);return null!==n?n.end-t:1/0}function re(e,t){if(t.start===t.end)return e;let n=t,i=0;for(;i<e.length;i++){const t=e[i],r=Y(n,t),s=X(n,t);if(r||s)n=G(n,t),e.splice(i--,1);else if(0===i){if(W(n,e[0]))break}else if(W(e[i-1],n)&&W(n,t))break}return e.splice(i,0,n),q(z(e))}function se(e,t){const n=[];for(let i=0;i<t.length;i++)Y(e,t[i])&&n.push(t[i]);return n}function ae(e,t){const n=[];for(let i=0;i<e.length;i++){const r=e[i],s=se(r,t);if(s.length>0)for(let e=0;e<s.length;e++){const t=s[e];n.push({start:Math.max(r.start,t.start),end:Math.min(r.end,t.end)})}}return n}function oe(e,t){const n=[];for(let i=0;i<e.length;i++){const r=e[i],s=[],a=se(r,t);if(a.length>0)for(let e=0;e<a.length;e++){const t=a[e];s.push({start:Math.max(r.start,t.start),end:Math.min(r.end,t.end)})}if(0===s.length)n.push(r);else{let e=r.start;for(let t=0;t<s.length;t++)s[t].start>e&&n.push({start:e,end:s[t].start}),e=s[t].end;e<r.end&&n.push({start:e,end:r.end})}}return n}function le(e,t,n){if("function"===typeof Array.prototype.findIndex)return e.findIndex(t,n);const i=e.length>>>0;for(let r=0;r<i;r++)if(t.call(n,e[r],r,e))return r;return-1}class ue{constructor(e,t){this._value=e,this._listeners=[],this._isFinished=!1,this._onFinishCbs=[],void 0!==t&&(this._deregisterCancellation=t.register(()=>this.finish()))}getValue(){return this._value}setValue(e){if(this._isFinished)return void 0;if(this._value=e,0===this._listeners.length)return;const t=this._listeners.slice();for(const n of t)try{n.hasBeenCleared||n.trigger(e,n.complete)}catch(e){}}setValueIfChanged(e){e!==this._value&&this.setValue(e)}onUpdate(e,t){const n=()=>{if(void 0!==(null===t||void 0===t?void 0:t.clearSignal)&&t.clearSignal.deregister(n),i.hasBeenCleared)return;i.hasBeenCleared=!0;const e=this._listeners.indexOf(i);e>=0&&this._listeners.splice(e,1)},i={trigger:e,complete:n,hasBeenCleared:!1};this._listeners.push(i),!0===(null===t||void 0===t?void 0:t.emitCurrentValue)&&e(this._value,n),this._isFinished||i.hasBeenCleared?n():void 0!==(null===t||void 0===t?void 0:t.clearSignal)&&t.clearSignal.register(n)}waitUntilDefined(e,t){this.onUpdate((t,n)=>{void 0!==t&&(n(),e(this._value))},{clearSignal:null===t||void 0===t?void 0:t.clearSignal,emitCurrentValue:!0})}_onFinished(e,t){if(t.isCancelled())return U;const n=()=>{const e=le(this._onFinishCbs,e=>e.trigger===i);e>=0&&(this._onFinishCbs[e].hasBeenCleared=!0,this._onFinishCbs.splice(e,1))},i=()=>{n(),e()},r=t.register(n);return this._onFinishCbs.push({trigger:i,hasBeenCleared:!1}),r}finish(){void 0!==this._deregisterCancellation&&this._deregisterCancellation(),this._isFinished=!0;const e=this._listeners.slice();for(const t of e)try{t.hasBeenCleared||(t.complete(),t.hasBeenCleared=!0)}catch(e){}if(this._listeners.length=0,this._onFinishCbs.length>0){const e=this._onFinishCbs.slice();for(const t of e)try{t.hasBeenCleared||(t.trigger(),t.hasBeenCleared=!0)}catch(e){}this._onFinishCbs.length=0}}}function ce(e,t,n){const i=new ue(t(e.getValue()),n);return e.onUpdate(function(e){i.setValue(t(e))},{clearSignal:n}),e._onFinished(()=>{i.finish()},n),i}var de=ue;class he extends Error{constructor(e){super(e),Object.setPrototypeOf(this,he.prototype),this.name="AssertionError"}}function fe(e,t){0}function pe(e,t,n="object"){fe(!r(e),`${n} should be an object`);for(const i in t)t.hasOwnProperty(i)&&fe(typeof e[i]===t[i],`${n} should have property ${i} as a ${t[i]}`)}function ge(e){throw new he("Unreachable path taken")}class me{constructor(){const[e,t]=be();this._isUsed=!1,this._trigger=e,this.signal=new ve(t)}isUsed(){return this._isUsed}linkToSignal(e){const t=e.register(()=>{this.cancel()});return this.signal.register(t),t}cancel(e){if(this._isUsed)return;this._isUsed=!0;const t=null!==e&&void 0!==e?e:new ye;this._trigger(t)}static isCancellationError(e){return e instanceof ye}}class ve{constructor(e){this._isCancelled=!1,this.cancellationError=null,this._listeners=[],e(e=>{this.cancellationError=e,this._isCancelled=!0;while(this._listeners.length>0)try{const t=this._listeners.pop();null===t||void 0===t||t(e)}catch(e){V.error("Error while calling clean up listener",e instanceof Error?e.toString():"Unknown error")}})}isCancelled(){return this._isCancelled}register(e){return this._isCancelled?(fe(null!==this.cancellationError),e(this.cancellationError),U):(this._listeners.push(e),()=>this.deregister(e))}deregister(e){for(let t=this._listeners.length-1;t>=0;t--)this._listeners[t]===e&&this._listeners.splice(t,1)}}class ye extends Error{constructor(){const e="This task was cancelled.";super(e),Object.setPrototypeOf(this,ye.prototype),this.name="CancellationError"}}function be(){let e=U;return[function(t){e(t)},function(t){e=t}]}const _e=new de(0);const Te="undefined"!==typeof performance?()=>performance.now()+_e.getValue():()=>Date.now()+_e.getValue();var Se=Te;function we(e){const t=e.map(t=>Math.log(t/e[0])),n=t.map(e=>e-t[0]+1),i=(n[n.length-1]-1)/(2*e.length+10),r=1/i;return e.map((e,t)=>s(t));function s(t){if(0===t)return 0;const a=Math.min(Math.max(1,t),e.length-1);return e[a]===e[a-1]?s(t-1):r*(i+(e[a]*n[a-1]-e[a-1]*n[a])/(e[a]-e[a-1]))+4}}const Ee=6e3,xe=15e3,ke=3e3,Ae=1e3,Ie=9e3;class Ce{constructor(e){this._levelsMap=we(e).map(e=>{return e+4}),this._bitrates=e,this._lastUnsuitableQualityTimestamp=void 0,this._blockRaiseDelay=Ee,V.debug("ABR: Steps for buffer based chooser.",this._levelsMap.map((t,n)=>`bufferLevel: ${t}, bitrate: ${e[n]}`).join(" ,"))}onAddedSegment(e){const t=this._levelsMap,n=this._bitrates,{bufferGap:i,currentBitrate:s,currentScore:a,speed:o}=e;if(r(s))return void(this._currentEstimate=n[0]);let l,u=-1;for(let r=0;r<n.length;r++){const e=n[r];if(e===s)u=r;else if(e>s)break}if(u<0||n.length!==t.length)return V.info("ABR: Current Bitrate not found in the calculated levels"),void(this._currentEstimate=n[0]);void 0!==a&&(l=0===o?a.score:a.score/o);const c=isFinite(i)?i:0,d=Se();if(c<t[u]||void 0!==l&&l<1&&1===(null===a||void 0===a?void 0:a.confidenceLevel)){const e=void 0===this._lastUnsuitableQualityTimestamp?-1:d-this._lastUnsuitableQualityTimestamp;if(e<this._blockRaiseDelay+Ie){const e=this._blockRaiseDelay+ke;this._blockRaiseDelay=Math.min(e,xe),V.debug("ABR: Incrementing blocking raise in BufferBasedChooser due to unstable quality",this._blockRaiseDelay)}else{const e=this._blockRaiseDelay-Ae;this._blockRaiseDelay=Math.max(Ee,e),V.debug("ABR: Lowering quality in BufferBasedChooser",this._blockRaiseDelay)}this._lastUnsuitableQualityTimestamp=d;const i=le(n,e=>e===s);for(let r=i-1;r>=0;r--)if(c>=t[r])return void(this._currentEstimate=n[r]);return void(this._currentEstimate=n[0])}if(void 0!==this._lastUnsuitableQualityTimestamp&&d-this._lastUnsuitableQualityTimestamp<this._blockRaiseDelay||void 0===l||l<1.15||1!==(null===a||void 0===a?void 0:a.confidenceLevel))return void(this._currentEstimate=s);const h=t[u],f=(()=>{for(let e=u+1;e<t.length;e++)if(t[e]>h)return e})();if(void 0!==f){const e=t[f];if(i>=e)return V.debug("ABR: Raising quality in BufferBasedChooser",n[f]),void(this._currentEstimate=n[f])}this._currentEstimate=s}getLastEstimate(){return this._currentEstimate}}function De(e,t,n){if("function"===typeof Array.prototype.find)return e.find(t,n);const i=e.length>>>0;for(let r=0;r<i;r++){const i=e[r];if(t.call(n,i,r,e))return i}}class Re{constructor(e){this._alpha=Math.exp(Math.log(.5)/e),this._lastEstimate=0,this._totalWeight=0}addSample(e,t){const n=Math.pow(this._alpha,e),i=t*(1-n)+n*this._lastEstimate;isNaN(i)||(this._lastEstimate=i,this._totalWeight+=e)}getEstimate(){const e=1-Math.pow(this._alpha,this._totalWeight);return this._lastEstimate/e}}function Me(e,t){let n=-1;for(let a=0;a<e.length;a++){const{segment:i}=e[a].content;if(i.duration<=0)continue;const r=i.time+i.duration;if(!i.complete&&a===e.length-1&&t-i.time>-1.2){n=a;break}if(r>t&&t-i.time>-1.2){n=a;break}}if(n<0)return[];const i=e[n],r=i.content.segment.time,s=[i];for(let a=n+1;a<e.length;a++){if(e[a].content.segment.time!==r)break;s.push(e[a])}return s}function Le(e){if(e.progress.length<5)return;const t=new Re(2),{progress:n}=e;for(let i=1;i<n.length;i++){const e=n[i].size-n[i-1].size,r=n[i].timestamp-n[i-1].timestamp,s=8*e/(r/1e3);t.addSample(r/1e3,s)}return t.getEstimate()}function Pe(e,t){const n=8*(e.totalSize-e.size);return Math.max(n/t,0)}function Oe(e,t,n,i,s){if(i)return;const{bufferGap:a,speed:o,position:l}=t,u=isFinite(a)?a:0,c=l.getWanted()+u,d=Me(e,c);if(1!==d.length)return;const h=d[0],f=Se();let p=1.5*h.content.segment.duration;if(p=Math.min(p,3e3),p=Math.max(p,12e3),f-h.requestTimestamp<p)return;const g=h.progress.length>0?h.progress[h.progress.length-1]:void 0,m=Le(h);if(void 0!==g&&void 0!==m){const e=Pe(g,m);if((f-g.timestamp)/1e3<=e){const t=e-u/o;if(t>2500)return m}}if(!h.content.segment.complete)return;const v=h.content.segment.duration,y=(f-h.requestTimestamp)/1e3,b=y<=(1.5*v+2)/o;if(r(n)||b)return;const _=v/y,T=n.bitrate*Math.min(.7,_);return void 0===s||T<s?T:void 0}function Ne(e,t,n){if(n)return!0;const i=isFinite(e.bufferGap)?e.bufferGap:0,r=e.position.getWanted()+i,s=De(t,({content:e})=>e.segment.duration>0&&e.segment.time+e.segment.duration>r);if(void 0===s)return!0;const a=Se(),o=s.progress.length>0?s.progress[s.progress.length-1]:void 0,l=Le(s);if(void 0===o||void 0===l)return!0;const u=Pe(o,l);if((a-o.timestamp)/1e3>1.2*u)return!0;const c=u-i/e.speed;return c>-1.5}class Ue{constructor(e,t){const{ABR_STARVATION_GAP:n,OUT_OF_STARVATION_GAP:i,ABR_STARVATION_FACTOR:r,ABR_REGULAR_FACTOR:s}=N.getCurrent();this._initialBitrate=e,this._inStarvationMode=!1,this._lowLatencyMode=t,this._config=t?{starvationGap:n.LOW_LATENCY,outOfStarvationGap:i.LOW_LATENCY,starvationBitrateFactor:r.LOW_LATENCY,regularBitrateFactor:s.LOW_LATENCY}:{starvationGap:n.DEFAULT,outOfStarvationGap:i.DEFAULT,starvationBitrateFactor:r.DEFAULT,regularBitrateFactor:s.DEFAULT}}getBandwidthEstimate(e,t,n,i,s){let a,o;const l=this._config,{bufferGap:u,position:c,duration:d}=e,h=isFinite(u)?u:0,{ABR_STARVATION_DURATION_DELTA:f}=N.getCurrent();return isNaN(d)||h+c.getWanted()<d-f?!this._inStarvationMode&&h<=l.starvationGap?(V.info("ABR: enter starvation mode."),this._inStarvationMode=!0):this._inStarvationMode&&h>=l.outOfStarvationGap&&(V.info("ABR: exit starvation mode."),this._inStarvationMode=!1):this._inStarvationMode&&(V.info("ABR: exit starvation mode."),this._inStarvationMode=!1),this._inStarvationMode&&(o=Oe(i,e,n,this._lowLatencyMode,s),void 0!==o&&(V.info("ABR: starvation mode emergency estimate:",o),t.reset(),a=r(n)?o:Math.min(o,n.bitrate))),r(a)&&(o=t.getEstimate(),a=void 0!==o?o*(this._inStarvationMode?l.starvationBitrateFactor:l.regularBitrateFactor):void 0!==s?s*(this._inStarvationMode?l.starvationBitrateFactor:l.regularBitrateFactor):this._initialBitrate),e.speed>1&&(a/=e.speed),{bandwidthEstimate:o,bitrateChosen:a}}isUrgent(e,t,n,i){return null===t||!(e>=t.bitrate)&&Ne(i,n,this._lowLatencyMode)}}class Fe{constructor(e,t){this._scoreCalculator=e,this._lastAbrEstimate=t,this._consecutiveWrongGuesses=0,this._blockGuessesUntil=0,this._lastMaintanableBitrate=null}getGuess(e,t,n,i,r){const{bufferGap:s,speed:a}=t,o=this._lastAbrEstimate.representation;if(null===o)return null;if(i>o.bitrate)return 2===this._lastAbrEstimate.algorithmType&&(null!==this._lastAbrEstimate.representation&&(this._lastMaintanableBitrate=this._lastAbrEstimate.representation.bitrate),this._consecutiveWrongGuesses=0),null;const l=this._scoreCalculator.getEstimate(n);if(2!==this._lastAbrEstimate.algorithmType){if(void 0===l)return null;if(this._canGuessHigher(s,a,l)){const t=Be(e,n);if(null!==t)return t}return null}if(this._isLastGuessValidated(o,i,l)&&(V.debug("ABR: Guessed Representation validated",o.bitrate),this._lastMaintanableBitrate=o.bitrate,this._consecutiveWrongGuesses=0),n.id!==o.id)return o;const u=this._shouldStopGuess(n,l,s,r);if(u)return this._consecutiveWrongGuesses++,this._blockGuessesUntil=Se()+Math.min(15e3*this._consecutiveWrongGuesses,12e4),je(e,n);if(void 0===l)return n;if(this._canGuessHigher(s,a,l)){const t=Be(e,n);if(null!==t)return t}return n}_canGuessHigher(e,t,{score:n,confidenceLevel:i}){return isFinite(e)&&e>=2.5&&Se()>this._blockGuessesUntil&&1===i&&n/t>1.01}_shouldStopGuess(e,t,n,i){if(void 0!==t&&t.score<1.01)return!0;if((void 0===t||t.score<1.2)&&n<.6)return!0;const r=i.filter(t=>{return t.content.representation.id===e.id}),s=Se();for(const a of r){const t=s-a.requestTimestamp;if(a.content.segment.isInit){if(t>1e3)return!0}else{if(t>1e3*a.content.segment.duration+200)return!0;{const t=Le(a);if(void 0!==t&&t<.8*e.bitrate)return!0}}}return!1}_isLastGuessValidated(e,t,n){return void 0!==n&&1===n.confidenceLevel&&n.score>1.5||t>=e.bitrate&&(null===this._lastMaintanableBitrate||this._lastMaintanableBitrate<e.bitrate)}}function Be(e,t){const n=e.length;let i=le(e,({id:e})=>e===t.id);if(i<0)return V.error("ABR: Current Representation not found."),null;while(++i<n)if(e[i].bitrate>t.bitrate)return e[i];return null}function je(e,t){let n=le(e,({id:e})=>e===t.id);if(n<0)return V.error("ABR: Current Representation not found."),null;while(--n>=0)if(e[n].bitrate<t.bitrate)return e[n];return null}class Ve{constructor(){const{ABR_FAST_EMA:e,ABR_SLOW_EMA:t}=N.getCurrent();this._fastEWMA=new Re(e),this._slowEWMA=new Re(t),this._bytesSampled=0}addSample(e,t){const{ABR_MINIMUM_CHUNK_SIZE:n}=N.getCurrent();if(t<n)return;const i=8e3*t/e,r=e/1e3;this._bytesSampled+=t,this._fastEWMA.addSample(r,i),this._slowEWMA.addSample(r,i)}getEstimate(){const{ABR_MINIMUM_TOTAL_BYTES:e}=N.getCurrent();if(!(this._bytesSampled<e))return Math.min(this._fastEWMA.getEstimate(),this._slowEWMA.getEstimate())}reset(){const{ABR_FAST_EMA:e,ABR_SLOW_EMA:t}=N.getCurrent();this._fastEWMA=new Re(e),this._slowEWMA=new Re(t),this._bytesSampled=0}}function He(e,t){if(0===e.length)return[];e.sort((e,t)=>e.bitrate-t.bitrate);const n=e[0].bitrate,i=Math.max(t,n),r=le(e,e=>e.bitrate>i);return-1===r?e:e.slice(0,r)}function $e(e,t){if(void 0===t.width||void 0===t.height)return e;const n=t.width*t.pixelRatio,i=t.height*t.pixelRatio,r=e.slice().sort((e,t)=>{var n,i;return(null!==(n=e.width)&&void 0!==n?n:0)-(null!==(i=t.width)&&void 0!==i?i:0)}),s=De(r,e=>"number"===typeof e.width&&e.width>=n&&"number"===typeof e.height&&e.height>=i);if(void 0===s)return e;const a="number"===typeof s.width?s.width:0;return e.filter(e=>"number"!==typeof e.width||e.width<=a)}class Ge{constructor(){this.bandwidth=void 0,this.representation=null,this.algorithmType=3}update(e,t,n){this.representation=e,this.bandwidth=t,this.algorithmType=n}}function ze(e){return Object.keys(e).map(t=>e[t])}var qe="function"===typeof Object.values?Object.values:ze;class We{constructor(){this._currentRequests={}}add(e){const{id:t,requestTimestamp:n,content:i}=e;this._currentRequests[t]={requestTimestamp:n,progress:[],content:i}}addProgress(e){const t=this._currentRequests[e.id];r(t)?V.warn("ABR: progress for a request not added"):t.progress.push(e)}remove(e){r(this._currentRequests[e])&&V.warn("ABR: can't remove unknown request"),delete this._currentRequests[e]}getRequests(){return qe(this._currentRequests).filter(e=>!r(e)).sort((e,t)=>e.content.segment.time-t.content.segment.time)}}class Ke{constructor(){this._currentRepresentationData=null,this._lastRepresentationWithGoodScore=null}addSample(e,t,n){const i=n/t,r=this._currentRepresentationData;let s;null!==r&&r.representation.id===e.id?(s=r.ewma,r.ewma.addSample(t,i),r.loadedDuration+=n,r.loadedSegments++):(s=new Re(5),s.addSample(t,i),this._currentRepresentationData={representation:e,ewma:s,loadedDuration:n,loadedSegments:0}),s.getEstimate()>1&&this._lastRepresentationWithGoodScore!==e&&(V.debug("ABR: New last stable representation",e.bitrate),this._lastRepresentationWithGoodScore=e)}getEstimate(e){if(null===this._currentRepresentationData||this._currentRepresentationData.representation.id!==e.id)return;const{ewma:t,loadedSegments:n,loadedDuration:i}=this._currentRepresentationData,r=t.getEstimate(),s=n>=5&&i>=10?1:0;return{score:r,confidenceLevel:s}}getLastStableRepresentation(){return this._lastRepresentationWithGoodScore}}function Ye(e,t){const n=le(e,e=>e.bitrate>t);return-1===n?e[e.length-1]:0===n?e[0]:e[n-1]}const Xe=new de(void 0);Xe.finish();const Qe=new de(1/0);function Ze(e){const t={},{initialBitrates:n,throttlers:i,lowLatencyMode:s}=e;return function(e,t,r,o,l){var u,c,d;const{type:h}=e.adaptation,f=a(h),p=null!==(u=n[h])&&void 0!==u?u:0,g={limitResolution:null!==(c=i.limitResolution[h])&&void 0!==c?c:Xe,throttleBitrate:null!==(d=i.throttleBitrate[h])&&void 0!==d?d:Qe};return Je({bandwidthEstimator:f,context:e,currentRepresentation:t,filters:g,initialBitrate:p,playbackObserver:o,representations:r,lowLatencyMode:s},l)};function a(e){const n=t[e];if(r(n)){V.debug("ABR: Creating new BandwidthEstimator for ",e);const n=new Ve;return t[e]=n,n}return n}}function Je({bandwidthEstimator:e,context:t,currentRepresentation:n,filters:i,initialBitrate:r,lowLatencyMode:s,playbackObserver:a,representations:o},l){const u=new Ke,c=new Ue(null!==r&&void 0!==r?r:0,s),d=new We;let h=U;const f={metrics:y,requestBegin:b,requestProgress:_,requestEnd:T,addedSegment(e){h(e)}};let p=new me;p.linkToSignal(l);const g=m(o.getValue(),p.signal);return o.onUpdate(v,{clearSignal:l}),{estimates:g,callbacks:f};function m(r,o){if(r.length<=1)return new de({bitrate:void 0,representation:r[0],urgent:!0,knownStableBitrate:void 0});let l=!1;const f=r.sort((e,t)=>e.bitrate-t.bitrate),p=new Ce(f.map(e=>e.bitrate)),g=new Ge,m=new Fe(u,g);let v=a.getReference().getValue();const y=new de(_());return a.listen(e=>{v=e,b()},{includeLastObservation:!1,clearSignal:o}),h=function(e){if(null===v)return;const{position:t,speed:n}=v,i=e.buffered,r=ie(i,t.getWanted()),{representation:s}=e.content,a=u.getEstimate(s),o=s.bitrate,l={bufferGap:r,currentBitrate:o,currentScore:a,speed:n};p.onAddedSegment(l),b()},o.register(()=>{h=U}),i.throttleBitrate.onUpdate(b,{clearSignal:o}),i.limitResolution.onUpdate(b,{clearSignal:o}),y;function b(){y.setValue(_())}function _(){const{bufferGap:r,position:a,maximumPosition:o}=v,h=i.limitResolution.getValue(),y=i.throttleBitrate.getValue(),b=n.getValue(),_=et(f,h,y),T=d.getRequests(),{bandwidthEstimate:S,bitrateChosen:w}=c.getBandwidthEstimate(v,e,b,T,g.bandwidth),E=u.getLastStableRepresentation(),x=null===E?void 0:E.bitrate/(v.speed>0?v.speed:1),{ABR_ENTER_BUFFER_BASED_ALGO:k,ABR_EXIT_BUFFER_BASED_ALGO:A}=N.getCurrent();l&&r<=A?l=!1:!l&&isFinite(r)&&r>=k&&(l=!0);const I=Ye(_,w),C=p.getLastEstimate();let D=I.bitrate,R=null;l&&void 0!==C&&C>D&&(R=Ye(_,C),D=R.bitrate);let M=null;return s&&null!==b&&t.manifest.isDynamic&&o-a.getWanted()<40&&(M=m.getGuess(f,v,b,D,T)),null!==M&&M.bitrate>D?(V.debug("ABR: Choosing representation with guess-based estimation.",M.bitrate,M.id),g.update(M,S,2),{bitrate:S,representation:M,urgent:null===b||M.bitrate<b.bitrate,knownStableBitrate:x}):null!==R?(V.debug("ABR: Choosing representation with buffer-based estimation.",R.bitrate,R.id),g.update(R,S,0),{bitrate:S,representation:R,urgent:c.isUrgent(R.bitrate,b,T,v),knownStableBitrate:x}):(V.debug("ABR: Choosing representation with bandwidth estimation.",I.bitrate,I.id),g.update(I,S,1),{bitrate:S,representation:I,urgent:c.isUrgent(I.bitrate,b,T,v),knownStableBitrate:x})}}function v(){const e=o.getValue();p.cancel(),p=new me,p.linkToSignal(l);const t=m(e,p.signal);t.onUpdate(function(e){g.setValue(e)},{clearSignal:p.signal,emitCurrentValue:!0})}function y(t){const{requestDuration:n,segmentDuration:i,size:r,content:s}=t;if(e.addSample(n,r),!s.segment.isInit){const{segment:e,representation:t}=s;if(void 0===i&&!e.complete)return;const r=null!==i&&void 0!==i?i:e.duration;u.addSample(t,n/1e3,r)}}function b(e){d.add(e)}function _(e){d.addProgress(e)}function T(e){d.remove(e.id)}}function et(e,t,n){let i=e;return void 0!==n&&n<1/0&&(i=He(i,n)),void 0!==t&&(i=$e(i,t)),i}Qe.finish();var tt=Ze;class nt extends Error{constructor(e,t,n){let i;switch(n){case"TIMEOUT":i="The request timed out";break;case"ERROR_EVENT":i="An error prevented the request to be performed successfully";break;case"PARSE_ERROR":i="An error happened while formatting the response data";break;case"ERROR_HTTP_CODE":i="An HTTP status code indicating failure was received: "+String(t);break}super(i),Object.setPrototypeOf(this,nt.prototype),this.name="RequestError",this.url=e,this.status=t,this.type=n}serialize(){return{url:this.url,status:this.status,type:this.type}}}const it={TIMEOUT:"TIMEOUT",ERROR_EVENT:"ERROR_EVENT",ERROR_HTTP_CODE:"ERROR_HTTP_CODE",PARSE_ERROR:"PARSE_ERROR"},rt=it,st={NETWORK_ERROR:"NETWORK_ERROR",MEDIA_ERROR:"MEDIA_ERROR",ENCRYPTED_MEDIA_ERROR:"ENCRYPTED_MEDIA_ERROR",OTHER_ERROR:"OTHER_ERROR"},at={PIPELINE_LOAD_ERROR:"PIPELINE_LOAD_ERROR",PIPELINE_PARSE_ERROR:"PIPELINE_PARSE_ERROR",INTEGRITY_ERROR:"INTEGRITY_ERROR",MANIFEST_PARSE_ERROR:"MANIFEST_PARSE_ERROR",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"MANIFEST_INCOMPATIBLE_CODECS_ERROR",MANIFEST_UPDATE_ERROR:"MANIFEST_UPDATE_ERROR",MANIFEST_UNSUPPORTED_ADAPTATION_TYPE:"MANIFEST_UNSUPPORTED_ADAPTATION_TYPE",MEDIA_STARTING_TIME_NOT_FOUND:"MEDIA_STARTING_TIME_NOT_FOUND",MEDIA_TIME_BEFORE_MANIFEST:"MEDIA_TIME_BEFORE_MANIFEST",MEDIA_TIME_AFTER_MANIFEST:"MEDIA_TIME_AFTER_MANIFEST",MEDIA_TIME_NOT_FOUND:"MEDIA_TIME_NOT_FOUND",NO_PLAYABLE_REPRESENTATION:"NO_PLAYABLE_REPRESENTATION",MEDIA_IS_ENCRYPTED_ERROR:"MEDIA_IS_ENCRYPTED_ERROR",CREATE_MEDIA_KEYS_ERROR:"CREATE_MEDIA_KEYS_ERROR",MEDIA_KEYS_ATTACHMENT_ERROR:"MEDIA_KEYS_ATTACHMENT_ERROR",KEY_ERROR:"KEY_ERROR",KEY_STATUS_CHANGE_ERROR:"KEY_STATUS_CHANGE_ERROR",KEY_UPDATE_ERROR:"KEY_UPDATE_ERROR",KEY_LOAD_ERROR:"KEY_LOAD_ERROR",KEY_LOAD_TIMEOUT:"KEY_LOAD_TIMEOUT",KEY_GENERATE_REQUEST_ERROR:"KEY_GENERATE_REQUEST_ERROR",INCOMPATIBLE_KEYSYSTEMS:"INCOMPATIBLE_KEYSYSTEMS",INVALID_ENCRYPTED_EVENT:"INVALID_ENCRYPTED_EVENT",INVALID_KEY_SYSTEM:"INVALID_KEY_SYSTEM",LICENSE_SERVER_CERTIFICATE_ERROR:"LICENSE_SERVER_CERTIFICATE_ERROR",MULTIPLE_SESSIONS_SAME_INIT_DATA:"MULTIPLE_SESSIONS_SAME_INIT_DATA",BUFFER_APPEND_ERROR:"BUFFER_APPEND_ERROR",BUFFER_FULL_ERROR:"BUFFER_FULL_ERROR",BUFFER_TYPE_UNKNOWN:"BUFFER_TYPE_UNKNOWN",MEDIA_ERR_BLOCKED_AUTOPLAY:"MEDIA_ERR_BLOCKED_AUTOPLAY",MEDIA_ERR_PLAY_NOT_ALLOWED:"MEDIA_ERR_PLAY_NOT_ALLOWED",MEDIA_ERR_NOT_LOADED_METADATA:"MEDIA_ERR_NOT_LOADED_METADATA",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_UNKNOWN:"MEDIA_ERR_UNKNOWN",MEDIA_SOURCE_NOT_SUPPORTED:"MEDIA_SOURCE_NOT_SUPPORTED",MEDIA_KEYS_NOT_SUPPORTED:"MEDIA_KEYS_NOT_SUPPORTED",DISCONTINUITY_ENCOUNTERED:"DISCONTINUITY_ENCOUNTERED",NONE:"NONE"};function ot(e,t){return`${e}: ${t}`}class lt extends Error{constructor(e,t,n){super(ot(e,t)),Object.setPrototypeOf(this,lt.prototype),this.name="EncryptedMediaError",this.type=st.ENCRYPTED_MEDIA_ERROR,this.code=e,this._originalMessage=t,this.fatal=!1,"string"===typeof(null===n||void 0===n?void 0:n.keyStatuses)&&(this.keyStatuses=n.keyStatuses)}serialize(){return{name:this.name,code:this.code,reason:this._originalMessage,keyStatuses:this.keyStatuses}}}class ut extends Error{constructor(e,t,n){super(ot(e,t)),Object.setPrototypeOf(this,ut.prototype),this.name="MediaError",this.type=st.MEDIA_ERROR,this._originalMessage=t,this.code=e,this.fatal=!1,void 0!==(null===n||void 0===n?void 0:n.tracks)&&(null===n||void 0===n?void 0:n.tracks.length)>0&&(this.tracksInfo=n.tracks)}serialize(){return{name:this.name,code:this.code,reason:this._originalMessage,tracks:this.tracksInfo}}}class ct extends Error{constructor(e,t){super(ot(e,t.message)),Object.setPrototypeOf(this,ct.prototype),this.name="NetworkError",this.type=st.NETWORK_ERROR,this.url=t.url,this.status=t.status,this.errorType=t.type,this._baseError=t,this.code=e,this.fatal=!1}isHttpError(e){return this.errorType===rt.ERROR_HTTP_CODE&&this.status===e}serialize(){return{name:this.name,code:this.code,baseError:this._baseError.serialize()}}}class dt extends Error{constructor(e,t){super(ot(e,t)),Object.setPrototypeOf(this,dt.prototype),this.name="OtherError",this.type=st.OTHER_ERROR,this.code=e,this.fatal=!1,this._originalMessage=t}serialize(){return{name:this.name,code:this.code,reason:this._originalMessage}}}function ht(e){return(e instanceof lt||e instanceof ut||e instanceof dt||e instanceof ct)&&Object.keys(st).indexOf(e.type)>=0}function ft(e,{defaultCode:t,defaultReason:n}){if(ht(e))return e;const i=e instanceof Error?e.toString():n;return new dt(t,i)}function pt(){let e="",t=-1;return function(){return t++,t>=Number.MAX_SAFE_INTEGER&&(e+="0",t=0),e+String(t)}}function gt(e,t,n){if("function"===typeof Array.prototype.includes)return e.includes(t,n);const i=e.length>>>0;if(0===i)return!1;const r=0|n;let s=r>=0?Math.min(r,i-1):Math.max(i+r,0);const a=(e,t)=>e===t||"number"===typeof e&&"number"===typeof t&&isNaN(e)&&isNaN(t);while(s<i){if(a(e[s],t))return!0;s++}return!1}const mt=[];function vt(e){gt(mt,e)||(console.warn(e),mt.push(e))}function yt(e,t){if(e.length!==t.length)return!1;if(e===t)return!0;for(let n=e.length-1;n>=0;n--)if(e[n]!==t[n])return!1;return!0}const bt=["audio","video","text"];function _t(e){var t,n;const i=e.timeBounds;if(null===i.timeshiftDepth)return null!==(t=i.minimumSafePosition)&&void 0!==t?t:0;const{maximumTimeData:r}=i;let s;if(i.maximumTimeData.isLinear){const e=Se()-r.time;s=r.maximumSafePosition+e/1e3}else s=r.maximumSafePosition;const a=s-i.timeshiftDepth;return Math.max(null!==(n=i.minimumSafePosition)&&void 0!==n?n:0,a)}function Tt(e){const{maximumTimeData:t}=e.timeBounds;if(!e.isLive||void 0===t.livePosition)return;if(!t.isLinear)return t.livePosition;const n=Se()-t.time;return t.livePosition+n/1e3}function St(e){const{maximumTimeData:t}=e.timeBounds;if(!t.isLinear)return t.maximumSafePosition;const n=Se()-t.time;return t.maximumSafePosition+n/1e3}function wt(e,t){if(void 0===t)return At(e).filter(e=>{return!0===e.isSupported});const n=e.adaptations[t];return void 0===n?[]:n.filter(e=>{return!0===e.isSupported})}function Et(e,t){let n=null;for(let i=e.periods.length-1;i>=0;i--){const r=e.periods[i];if(kt(r,t,n))return r;n=r}}function xt(e,t){const n=t.end;if(void 0===n)return null;const i=De(e.periods,e=>{return void 0===e.end||n<e.end});return void 0===i?null:i}function kt(e,t,n){return t>=e.start&&(void 0===e.end||t<e.end)||t===e.end&&(null===n||n.start>e.end)}function At(e){const t=e.adaptations;return ze(t).reduce((e,t)=>r(t)?e:e.concat(t),[])}function It(e,t){var n,i;const r={language:null!==(n=e.language)&&void 0!==n?n:"",normalized:null!==(i=e.normalizedLanguage)&&void 0!==i?i:"",audioDescription:!0===e.isAudioDescription,id:e.id,representations:(t?e.representations.filter(e=>!0===e.isSupported&&!1!==e.decipherable):e.representations).map(Rt),label:e.label};return!0===e.isDub&&(r.dub=!0),r}function Ct(e){var t,n;return{language:null!==(t=e.language)&&void 0!==t?t:"",normalized:null!==(n=e.normalizedLanguage)&&void 0!==n?n:"",closedCaption:!0===e.isClosedCaption,id:e.id,label:e.label,forced:e.isForcedSubtitles}}function Dt(e,t){const n=void 0!==e.trickModeTracks?e.trickModeTracks.map(e=>{const n=(t?e.representations.filter(e=>!0===e.isSupported&&!1!==e.decipherable):e.representations).map(Mt),i={id:e.id,representations:n,isTrickModeTrack:!0};return!0===e.isSignInterpreted&&(i.signInterpreted=!0),i}):void 0,i={id:e.id,representations:(t?e.representations.filter(e=>!0===e.isSupported&&!1!==e.decipherable):e.representations).map(Mt),label:e.label};return!0===e.isSignInterpreted&&(i.signInterpreted=!0),!0===e.isTrickModeTrack&&(i.isTrickModeTrack=!0),void 0!==n&&(i.trickModeTracks=n),i}function Rt(e){const{id:t,bitrate:n,codecs:i,isSpatialAudio:r,isSupported:s,decipherable:a}=e;return{id:t,bitrate:n,codec:null===i||void 0===i?void 0:i[0],isSpatialAudio:r,isCodecSupported:s,decipherable:a}}function Mt(e){const{id:t,bitrate:n,frameRate:i,width:r,height:s,codecs:a,hdrInfo:o,isSupported:l,decipherable:u}=e;return{id:t,bitrate:n,frameRate:i,width:r,height:s,codec:null===a||void 0===a?void 0:a[0],hdrInfo:o,isCodecSupported:l,decipherable:u}}function Lt(e){switch(e.type){case"audio":return{type:"audio",track:It(e,!1)};case"video":return{type:"video",track:Dt(e,!1)};case"text":return{type:"text",track:Ct(e)}}}function Pt(e){return new Function(`return (${e}(arguments[0], arguments[1]))`)}function Ot(e){return"string"===typeof e&&e.length>0}const Nt={aa:"aar",ab:"abk",ae:"ave",af:"afr",ak:"aka",am:"amh",an:"arg",ar:"ara",as:"asm",av:"ava",ay:"aym",az:"aze",ba:"bak",be:"bel",bg:"bul",bi:"bis",bm:"bam",bn:"ben",bo:"bod",br:"bre",bs:"bos",ca:"cat",ce:"che",ch:"cha",co:"cos",cr:"cre",cs:"ces",cu:"chu",cv:"chv",cy:"cym",da:"dan",de:"deu",dv:"div",dz:"dzo",ee:"ewe",el:"ell",en:"eng",eo:"epo",es:"spa",et:"est",eu:"eus",fa:"fas",ff:"ful",fi:"fin",fj:"fij",fo:"fao",fr:"fra",fy:"fry",ga:"gle",gd:"gla",gl:"glg",gn:"grn",gu:"guj",gv:"glv",ha:"hau",he:"heb",hi:"hin",ho:"hmo",hr:"hrv",ht:"hat",hu:"hun",hy:"hye",hz:"her",ia:"ina",id:"ind",ie:"ile",ig:"ibo",ii:"iii",ik:"ipk",io:"ido",is:"isl",it:"ita",iu:"iku",ja:"jpn",jv:"jav",ka:"kat",kg:"kon",ki:"kik",kj:"kua",kk:"kaz",kl:"kal",km:"khm",kn:"kan",ko:"kor",kr:"kau",ks:"kas",ku:"kur",kv:"kom",kw:"cor",ky:"kir",la:"lat",lb:"ltz",lg:"lug",li:"lim",ln:"lin",lo:"lao",lt:"lit",lu:"lub",lv:"lav",mg:"mlg",mh:"mah",mi:"mri",mk:"mkd",ml:"mal",mn:"mon",mr:"mar",ms:"msa",mt:"mlt",my:"mya",na:"nau",nb:"nob",nd:"nde",ne:"nep",ng:"ndo",nl:"nld",nn:"nno",no:"nor",nr:"nbl",nv:"nav",ny:"nya",oc:"oci",oj:"oji",om:"orm",or:"ori",os:"oss",pa:"pan",pi:"pli",pl:"pol",ps:"pus",pt:"por",qu:"que",rm:"roh",rn:"run",ro:"ron",ru:"rus",rw:"kin",sa:"san",sc:"srd",sd:"snd",se:"sme",sg:"sag",si:"sin",sk:"slk",sl:"slv",sm:"smo",sn:"sna",so:"som",sq:"sqi",sr:"srp",ss:"ssw",st:"sot",su:"sun",sv:"swe",sw:"swa",ta:"tam",te:"tel",tg:"tgk",th:"tha",ti:"tir",tk:"tuk",tl:"tgl",tn:"tsn",to:"ton",tr:"tur",ts:"tso",tt:"tat",tw:"twi",ty:"tah",ug:"uig",uk:"ukr",ur:"urd",uz:"uzb",ve:"ven",vi:"vie",vo:"vol",wa:"wln",wo:"wol",xh:"xho",yi:"yid",yo:"yor",za:"zha",zh:"zho",zu:"zul"};var Ut=Nt;const Ft={alb:"sqi",arm:"hye",baq:"eus",bur:"mya",chi:"zho",cze:"ces",dut:"nld",fre:"fra",geo:"kat",ger:"deu",gre:"ell",ice:"isl",mac:"mkd",mao:"mri",may:"msa",per:"fas",slo:"slk",rum:"ron",tib:"bod",wel:"cym"};var Bt=Ft;function jt(e){if(r(e)||""===e)return"und";const t=(""+e).toLowerCase().split("-"),n=t[0],i=Vt(n);return Ot(i)?i:e}function Vt(e){let t;switch(e.length){case 2:t=Ut[e];break;case 3:t=Bt[e];break}return t}var Ht=jt,$t=Ht;const Gt={dashParsers:{wasm:null,native:null,fastJs:null},codecSupportProber:null,createDebugElement:null,directfile:null,decrypt:null,htmlTextDisplayer:null,htmlTextTracksParsers:{},mainThreadMediaSourceInit:null,multithread:null,nativeTextDisplayer:null,nativeTextTracksParsers:{},transports:{}};var zt=Gt,qt=zt;const Wt=pt();class Kt{constructor(e,t){var n,i,r,s,a;if(this.id=e.id,this.uniqueId=Wt(),this.bitrate=e.bitrate,this.codecs=[],void 0!==e.isSpatialAudio&&(this.isSpatialAudio=e.isSpatialAudio),void 0!==e.height&&(this.height=e.height),void 0!==e.width&&(this.width=e.width),void 0!==e.mimeType&&(this.mimeType=e.mimeType),void 0!==e.contentProtections&&(this.contentProtections=e.contentProtections),void 0!==e.frameRate&&(this.frameRate=e.frameRate),void 0!==e.hdrInfo&&(this.hdrInfo=e.hdrInfo),this.cdnMetadata=e.cdnMetadata,this.index=e.index,"audio"===t||"video"===t)if(null!==qt.codecSupportProber){if(void 0!==e.supplementalCodecs){const t=qt.codecSupportProber.isSupported(null!==(n=this.mimeType)&&void 0!==n?n:"",null!==(i=e.supplementalCodecs)&&void 0!==i?i:"");!1!==t&&(this.codecs=[e.supplementalCodecs],!0===t&&(this.isSupported=!0))}!0!==this.isSupported&&(this.codecs.length>0?this.codecs.push(null!==(r=e.codecs)&&void 0!==r?r:""):(this.codecs=void 0===e.codecs?[]:[e.codecs],this.isSupported=qt.codecSupportProber.isSupported(null!==(s=this.mimeType)&&void 0!==s?s:"",null!==(a=e.codecs)&&void 0!==a?a:"")))}else void 0!==e.supplementalCodecs&&this.codecs.push(e.supplementalCodecs),void 0!==e.codecs&&this.codecs.push(e.codecs);else void 0!==e.codecs&&this.codecs.push(e.codecs),this.isSupported=!0}refreshCodecSupport(e){var t;const n=null!==(t=this.mimeType)&&void 0!==t?t:"";let i=this.codecs;0===i.length&&(i=[""]);for(let r=0;r<i.length;r++)for(const t of e){const e=i[r];if(t.codec===e&&t.mimeType===n){if(t.result)return this.isSupported=!0,void(this.codecs=[e]);if(r===i.length)return this.isSupported=!1,void(this.codecs=[e])}}}getMimeTypeString(){var e,t,n;return`${null!==(e=this.mimeType)&&void 0!==e?e:""};codecs="${null!==(n=null===(t=this.codecs)||void 0===t?void 0:t[0])&&void 0!==n?n:""}"`}getEncryptionData(e){var t,n;const i=this.getAllEncryptionData(),r=[];for(let s=0;s<i.length;s++){let a=!1;const o=i[s];for(let i=0;i<o.values.length;i++)if(o.values[i].systemId.toLowerCase()===e.toLowerCase())if(a)r[r.length-1].values.push(o.values[i]);else{const e=null===(n=null===(t=this.contentProtections)||void 0===t?void 0:t.keyIds)||void 0===n?void 0:n.map(e=>e.keyId);r.push({type:o.type,keyIds:e,values:[o.values[i]]}),a=!0}}return r}getAllEncryptionData(){var e,t;if(void 0===this.contentProtections||0===this.contentProtections.initData.length)return[];const n=null===(t=null===(e=this.contentProtections)||void 0===e?void 0:e.keyIds)||void 0===t?void 0:t.map(e=>e.keyId);return this.contentProtections.initData.map(e=>{return{type:e.type,keyIds:n,values:e.values}})}addProtectionData(e,t,n){let i=!1;if(void 0===this.contentProtections)return this.contentProtections={keyIds:void 0!==t?[{keyId:t}]:[],initData:[{type:e,values:n}]},!0;if(void 0!==t){const e=this.contentProtections.keyIds;if(void 0===e)this.contentProtections.keyIds=[{keyId:t}];else{let n=!1;for(const i of e)yt(i.keyId,t)&&(n=!0);n||(V.warn("Manifest: found unanounced key id."),e.push({keyId:t}))}}const r=this.contentProtections.initData;for(let s=0;s<r.length;s++)if(r[s].type===e){const e=r[s].values;for(let t=0;t<n.length;t++){const r=n[t];let s;for(s=0;s<e.length;s++)if(r.systemId===e[s].systemId){if(yt(r.data,e[s].data))break;V.warn("Manifest: different init data for the same system ID")}s===e.length&&(e.push(r),i=!0)}return i}return this.contentProtections.initData.push({type:e,values:n}),!0}getMetadataSnapshot(){return{id:this.id,uniqueId:this.uniqueId,bitrate:this.bitrate,codecs:this.codecs,mimeType:this.mimeType,width:this.width,height:this.height,frameRate:this.frameRate,isSupported:this.isSupported,hdrInfo:this.hdrInfo,contentProtections:this.contentProtections,decipherable:this.decipherable}}}var Yt,Xt=Kt;class Qt{constructor(e,t={}){const{trickModeTracks:n}=e,{representationFilter:i,isManuallyAdded:s}=t;this.id=e.id,this.type=e.type,void 0!==e.isTrickModeTrack&&(this.isTrickModeTrack=e.isTrickModeTrack),void 0!==e.language&&(this.language=e.language,this.normalizedLanguage=$t(e.language)),void 0!==e.closedCaption&&(this.isClosedCaption=e.closedCaption),void 0!==e.audioDescription&&(this.isAudioDescription=e.audioDescription),void 0!==e.isDub&&(this.isDub=e.isDub),void 0!==e.forcedSubtitles&&(this.isForcedSubtitles=e.forcedSubtitles),void 0!==e.isSignInterpreted&&(this.isSignInterpreted=e.isSignInterpreted),void 0!==e.label&&(this.label=e.label),void 0!==n&&n.length>0&&(this.trickModeTracks=n.map(e=>new Qt(e)));const a=e.representations,o=[];let l;for(let u=0;u<a.length;u++){const e=new Xt(a[u],this.type);let t=!0;if(!r(i)){const n={id:e.id,bitrate:e.bitrate,codecs:e.codecs,height:e.height,width:e.width,frameRate:e.frameRate,hdrInfo:e.hdrInfo};if(void 0!==e.contentProtections&&(n.contentProtections={},void 0!==e.contentProtections.keyIds)){const t=e.contentProtections.keyIds.map(({keyId:e})=>e);n.contentProtections.keyIds=t}t=i(n,{trackType:this.type,language:this.language,normalizedLanguage:this.normalizedLanguage,isClosedCaption:this.isClosedCaption,isDub:this.isDub,isAudioDescription:this.isAudioDescription,isSignInterpreted:this.isSignInterpreted})}t?(o.push(e),void 0===l&&(!0===e.isSupported?l=!0:!1===e.isSupported&&(l=!1))):V.debug("Filtering Representation due to representationFilter",this.type,`Adaptation: ${this.id}`,`Representation: ${e.id}`,`(${e.bitrate})`)}o.sort((e,t)=>e.bitrate-t.bitrate),this.representations=o,this.isSupported=l,this.manuallyAdded=!0===s}refreshCodecSupport(e){for(const t of this.representations)void 0===t.isSupported&&(t.refreshCodecSupport(e),!0!==this.isSupported&&!0===t.isSupported?this.isSupported=!0:void 0===this.isSupported&&!1===t.isSupported&&(this.isSupported=!1))}getRepresentation(e){return De(this.representations,({id:t})=>e===t)}getMetadataSnapshot(){const e=[],t=this.representations;for(const n of t)e.push(n.getMetadataSnapshot());return{id:this.id,type:this.type,isSupported:this.isSupported,language:this.language,isForcedSubtitles:this.isForcedSubtitles,isClosedCaption:this.isClosedCaption,isAudioDescription:this.isAudioDescription,isSignInterpreted:this.isSignInterpreted,normalizedLanguage:this.normalizedLanguage,representations:e,label:this.label,isDub:this.isDub}}}class Zt{constructor(e,t,n){if(this.id=e.id,this.adaptations=Object.keys(e.adaptations).reduce((i,s)=>{const a=e.adaptations[s];if(r(a))return i;const o=a.map(e=>{const i=new Qt(e,{representationFilter:n});return i.representations.length>0&&!1===i.isSupported&&t.push(i),i}).filter(e=>e.representations.length>0);if(o.every(e=>!1===e.isSupported)&&a.length>0&&("video"===s||"audio"===s))throw new ut("MANIFEST_INCOMPATIBLE_CODECS_ERROR","No supported "+s+" adaptations",{tracks:void 0});return o.length>0&&(i[s]=o),i},{}),!Array.isArray(this.adaptations.video)&&!Array.isArray(this.adaptations.audio))throw new ut("MANIFEST_PARSE_ERROR","No supported audio and video tracks.");this.duration=e.duration,this.start=e.start,r(this.duration)||r(this.start)||(this.end=this.start+this.duration),this.streamEvents=void 0===e.streamEvents?[]:e.streamEvents}refreshCodecSupport(e,t){Object.keys(this.adaptations).forEach(n=>{const i=this.adaptations[n];if(void 0===i)return;let r=!1;for(const s of i){const n=s.isSupported;s.refreshCodecSupport(e),!1!==n&&!1===s.isSupported&&t.push(s),!1===r?r=s.isSupported:void 0===r&&!0===s.isSupported&&(r=!0)}if(("video"===n||"audio"===n)&&!1===r)throw new ut("MANIFEST_INCOMPATIBLE_CODECS_ERROR","No supported "+n+" adaptations",{tracks:void 0})},{})}getAdaptations(){return At(this)}getAdaptationsForType(e){const t=this.adaptations[e];return null!==t&&void 0!==t?t:[]}getAdaptation(e){return De(this.getAdaptations(),({id:t})=>e===t)}getSupportedAdaptations(e){return wt(this,e)}containsTime(e,t){return kt(this,e,t)}getMetadataSnapshot(){const e={},t=this.getAdaptations();for(const n of t){let t=e[n.type];void 0===t&&(t=[],e[n.type]=t),t.push(n.getMetadataSnapshot())}return{start:this.start,end:this.end,id:this.id,streamEvents:this.streamEvents,adaptations:e}}}function Jt(e,t,n){const i={updatedAdaptations:[],removedAdaptations:[],addedAdaptations:[]};e.start=t.start,e.end=t.end,e.duration=t.duration,e.streamEvents=t.streamEvents;const r=e.getAdaptations(),s=t.getAdaptations();for(let a=0;a<r.length;a++){const e=r[a],t=le(s,t=>t.id===e.id);if(-1===t){V.warn('Manifest: Adaptation "'+r[a].id+'" not found when merging.');const[e]=r.splice(a,1);a--,i.removedAdaptations.push({id:e.id,trackType:e.type})}else{const[r]=s.splice(t,1),a=[],o=[],l=[];i.updatedAdaptations.push({adaptation:e.id,trackType:e.type,updatedRepresentations:a,addedRepresentations:o,removedRepresentations:l});const u=e.representations,c=r.representations.slice();for(let e=0;e<u.length;e++){const t=u[e],i=le(c,e=>e.id===t.id);if(-1===i){V.warn(`Manifest: Representation "${u[e].id}" `+"not found when merging.");const[t]=u.splice(e,1);e--,l.push(t.id)}else{const[e]=c.splice(i,1);a.push(t.getMetadataSnapshot()),t.cdnMetadata=e.cdnMetadata,n===Yt.Full?t.index._replace(e.index):t.index._update(e.index)}}c.length>0&&(V.warn(`Manifest: ${c.length} new Representations `+"found when merging."),e.representations.push(...c),o.push(...c.map(e=>e.getMetadataSnapshot())))}}if(s.length>0){V.warn(`Manifest: ${s.length} new Adaptations `+"found when merging.");for(const t of s){const n=e.adaptations[t.type];void 0===n?e.adaptations[t.type]=[t]:n.push(t),i.addedAdaptations.push(t.getMetadataSnapshot())}}return i}function en(e,t){const n={updatedPeriods:[],addedPeriods:[],removedPeriods:[]};let i=0;for(let s=0;s<t.length;s++){const r=t[s];let a=i,o=e[a];while(void 0!==o&&o.id!==r.id)a++,o=e[a];if(void 0!==o){const l=Jt(o,r,Yt.Full);n.updatedPeriods.push({period:{id:o.id,start:o.start,end:o.end,duration:o.duration,streamEvents:o.streamEvents},result:l});const u=t.slice(i,s),c=a-i,d=e.splice(i,c,...u);n.removedPeriods.push(...d.map(e=>({id:e.id,start:e.start,end:e.end}))),n.addedPeriods.push(...u.map(e=>e.getMetadataSnapshot())),i=s+1}}if(i>e.length)return V.error("Manifest: error when updating Periods"),n;if(i<e.length){const t=e.splice(i,e.length-i);n.removedPeriods.push(...t.map(e=>({id:e.id,start:e.start,end:e.end})))}const r=t.slice(i,t.length);return r.length>0&&(e.push(...r),n.addedPeriods.push(...r.map(e=>e.getMetadataSnapshot()))),n}function tn(e,t){const n={updatedPeriods:[],addedPeriods:[],removedPeriods:[]};if(0===e.length)return e.splice(0,0,...t),n.addedPeriods.push(...t.map(e=>e.getMetadataSnapshot())),n;if(0===t.length)return n;const i=e[e.length-1];if(i.start<t[0].start){if(i.end!==t[0].start)throw new ut("MANIFEST_UPDATE_ERROR","Cannot perform partial update: not enough data");return e.push(...t),n.addedPeriods.push(...t.map(e=>e.getMetadataSnapshot())),n}const r=le(e,({id:e})=>e===t[0].id);if(r<0)throw new ut("MANIFEST_UPDATE_ERROR","Cannot perform partial update: incoherent data");const s=Jt(e[r],t[0],Yt.Partial);n.updatedPeriods.push({period:R(e[r].getMetadataSnapshot(),{adaptations:void 0}),result:s});let a=r+1;for(let o=1;o<t.length;o++){const i=t[o];let r=-1;for(let t=a;t<e.length;t++)if(i.id===e[t].id){r=t;break}if(r<0){let t=-1;for(let n=a;n<e.length;n++)if(i.start<e[n].start){t=n;break}const r=t-a,s=e.splice(a,r,i);n.addedPeriods.push(i.getMetadataSnapshot()),n.removedPeriods.push(...s.map(e=>({id:e.id,start:e.start,end:e.end})))}else{if(r>a){V.warn("Manifest: old Periods not found in new when updating, removing");const t=e.splice(a,r-a);n.removedPeriods.push(...t.map(e=>({id:e.id,start:e.start,end:e.end}))),r=a}const t=Jt(e[r],i,Yt.Full);n.updatedPeriods.push({period:R(e[r].getMetadataSnapshot(),{adaptations:void 0}),result:t})}a++}if(a<e.length){V.warn("Manifest: Ending Periods not found in new when updating, removing");const t=e.splice(a,e.length-a);n.removedPeriods.push(...t.map(e=>({id:e.id,start:e.start,end:e.end})))}return n}(function(e){e[e["Full"]=0]="Full",e[e["Partial"]=1]="Partial"})(Yt||(Yt={}));const nn=pt();class rn extends s{constructor(e,t,n){var i;super();const{representationFilter:r,manifestUpdateUrl:s}=t;this.manifestFormat=0,this.id=nn(),this.expired=null!==(i=e.expired)&&void 0!==i?i:null,this.transport=e.transportType,this.clockOffset=e.clockOffset;const a=[];if(this.periods=e.periods.map(e=>{const t=new Zt(e,a,r);return t}).sort((e,t)=>e.start-t.start),a.length>0){const e=new ut("MANIFEST_INCOMPATIBLE_CODECS_ERROR","An Adaptation contains only incompatible codecs.",{tracks:a.map(Lt)});n.push(e)}this.adaptations=void 0===this.periods[0]?{}:this.periods[0].adaptations,this.timeBounds=e.timeBounds,this.isDynamic=e.isDynamic,this.isLive=e.isLive,this.isLastPeriodKnown=e.isLastPeriodKnown,this.uris=void 0===e.uris?[]:e.uris,this.updateUrl=s,this.lifetime=e.lifetime,this.clockOffset=e.clockOffset,this.suggestedPresentationDelay=e.suggestedPresentationDelay,this.availabilityStartTime=e.availabilityStartTime,this.publishTime=e.publishTime}refreshCodecSupport(e){const t=[];for(const n of this.periods)n.refreshCodecSupport(e,t);return t.length>0?new ut("MANIFEST_INCOMPATIBLE_CODECS_ERROR","An Adaptation contains only incompatible codecs.",{tracks:t.map(Lt)}):null}getPeriod(e){return De(this.periods,t=>{return e===t.id})}getPeriodForTime(e){return Et(this,e)}getNextPeriod(e){return De(this.periods,t=>{return t.start>e})}getPeriodAfter(e){return xt(this,e)}getUrls(){return this.uris}replace(e){this._performUpdate(e,Yt.Full)}update(e){this._performUpdate(e,Yt.Partial)}getMinimumSafePosition(){return _t(this)}getLivePosition(){return Tt(this)}getMaximumSafePosition(){return St(this)}updateRepresentationsDeciperability(e){const t=sn(this,e);t.length>0&&this.trigger("decipherabilityUpdate",t)}getAdaptations(){vt("manifest.getAdaptations() is deprecated. Please use manifest.period[].getAdaptations() instead");const e=this.periods[0];if(void 0===e)return[];const t=e.adaptations,n=[];for(const i in t)if(t.hasOwnProperty(i)){const e=t[i];n.push(...e)}return n}getAdaptationsForType(e){vt("manifest.getAdaptationsForType(type) is deprecated. Please use manifest.period[].getAdaptationsForType(type) instead");const t=this.periods[0];if(void 0===t)return[];const n=t.adaptations[e];return void 0===n?[]:n}getAdaptation(e){return vt("manifest.getAdaptation(id) is deprecated. Please use manifest.period[].getAdaptation(id) instead"),De(this.getAdaptations(),({id:t})=>e===t)}getMetadataSnapshot(){const e=[];for(const t of this.periods)e.push(t.getMetadataSnapshot());return{manifestFormat:1,id:this.id,periods:e,isDynamic:this.isDynamic,isLive:this.isLive,isLastPeriodKnown:this.isLastPeriodKnown,suggestedPresentationDelay:this.suggestedPresentationDelay,clockOffset:this.clockOffset,uris:this.uris,availabilityStartTime:this.availabilityStartTime,timeBounds:this.timeBounds}}_performUpdate(e,t){let n;if(this.availabilityStartTime=e.availabilityStartTime,this.expired=e.expired,this.isDynamic=e.isDynamic,this.isLive=e.isLive,this.isLastPeriodKnown=e.isLastPeriodKnown,this.lifetime=e.lifetime,this.clockOffset=e.clockOffset,this.suggestedPresentationDelay=e.suggestedPresentationDelay,this.transport=e.transport,this.publishTime=e.publishTime,t===Yt.Full)this.timeBounds=e.timeBounds,this.uris=e.uris,n=en(this.periods,e.periods);else{this.timeBounds.maximumTimeData=e.timeBounds.maximumTimeData,this.updateUrl=e.uris[0],n=tn(this.periods,e.periods);const t=this.getMinimumSafePosition();while(this.periods.length>0){const e=this.periods[0];if(void 0===e.end||e.end>t)break;this.periods.shift()}}this.adaptations=void 0===this.periods[0]?{}:this.periods[0].adaptations,this.trigger("manifestUpdate",n)}}function sn(e,t){const n=[];for(const i of e.periods)for(const r of i.getAdaptations())for(const s of r.representations){const a={manifest:e,period:i,adaptation:r,representation:s},o=t(a);o!==s.decipherable&&(n.push(a),s.decipherable=o,V.debug(`Decipherability changed for "${s.id}"`,`(${s.bitrate})`,String(s.decipherable)))}return n}var an=rn;function on(e){return e instanceof nt?new ct("PIPELINE_LOAD_ERROR",e):ft(e,{defaultCode:"PIPELINE_LOAD_ERROR",defaultReason:"Unknown error when fetching the Manifest"})}class ln extends Error{constructor(e,t,n){super(e),Object.setPrototypeOf(this,ln.prototype),this.name="CustomLoaderError",this.canRetry=t,this.xhr=n}}function un(e,t){let n;return new Promise((i,r)=>{if(null!==e.cancellationError)return r(e.cancellationError);let s=!1;function a(e){void 0!==n&&n(),r(e)}n=t(function(t){e.deregister(a),s=!0,i(t)},function(t){e.deregister(a),s=!0,r(t)}),s||e.register(a)})}function cn(e,t){return un(t,t=>{const n=setTimeout(()=>t(),e);return()=>clearTimeout(n)})}const dn=.3;function hn(e){const t=(2*Math.random()-1)*dn;return e*(t+1)}function fn(e){return e instanceof nt?e.type===rt.ERROR_HTTP_CODE?e.status>=500||404===e.status||415===e.status||412===e.status:e.type===rt.TIMEOUT||e.type===rt.ERROR_EVENT:e instanceof ln?"boolean"===typeof e.canRetry?e.canRetry:void 0!==e.xhr&&(e.xhr.status>=500||404===e.xhr.status||415===e.xhr.status||412===e.xhr.status):ht(e)&&"INTEGRITY_ERROR"===e.code}async function pn(e,t,n,i,r){if(null!==r.cancellationError)return Promise.reject(r.cancellationError);const{baseDelay:s,maxDelay:a,maxRetry:o,onRetry:l}=i;null!==e&&0===e.length&&V.warn("Fetchers: no CDN given to `scheduleRequestWithCdns`.");const u=new Map,c=d();if(void 0===c)throw new Error("No CDN to request");return h(c);function d(){if(null===e){const e=u.get(null);if(void 0!==e&&e.isBlacklisted)return;return null}if(null===t)return g(e);{const n=t.getCdnPreferenceForResource(e);return g(n)}}async function h(e){try{const i=await n(e,r);return i}catch(n){if(me.isCancellationError(n))throw n;null!==e&&null!==t&&t.downgradeCdn(e);let i=u.get(e);if(void 0===i?(i={errorCounter:1,blockedUntil:void 0,isBlacklisted:!1},u.set(e,i)):i.errorCounter++,!fn(n))return i.blockedUntil=void 0,i.isBlacklisted=!0,f(n);if(i.errorCounter>o)i.blockedUntil=void 0,i.isBlacklisted=!0;else{const e=i.errorCounter,t=Math.min(s*Math.pow(2,e-1),a),n=hn(t);i.blockedUntil=Se()+n}return f(n)}}async function f(e){const t=d();if(r.isCancelled())throw r.cancellationError;if(void 0===t)throw e;if(l(e),r.isCancelled())throw r.cancellationError;return p(t,e)}function p(e,n){const i=u.get(e);if(void 0===i||void 0===i.blockedUntil)return h(e);const s=Se(),a=i.blockedUntil-s;if(a<=0)return h(e);const o=new me,l=o.linkToSignal(r);return new Promise((i,s)=>{function u(e){l(),i(e)}function c(e){l(),s(e)}null===t||void 0===t||t.addEventListener("priorityChange",()=>{const t=d();if(r.isCancelled())throw r.cancellationError;if(void 0===t)return c(n);t!==e&&(o.cancel(),p(t,n).then(u,c))},o.signal),cn(a,o.signal).then(()=>h(e).then(u,c),U)})}function g(e){var t;if(0===u.size)return e[0];const n=Se();return null===(t=e.filter(e=>{var t;return!0!==(null===(t=u.get(e))||void 0===t?void 0:t.isBlacklisted)}).reduce((e,t)=>{var i;let r=null===(i=u.get(t))||void 0===i?void 0:i.blockedUntil;return void 0!==r&&r<=n&&(r=void 0),void 0===e?[t,r]:void 0===e[1]?e:void 0===r?[t,void 0]:r<e[1]?[t,r]:e},void 0))||void 0===t?void 0:t[0]}}function gn(e,t,n){return pn(null,null,e,t,n)}class mn extends s{constructor(e,t,n){super(),this.scheduleManualRefresh=U,this._manifestUrls=e,this._pipelines=t.manifest,this._settings=n,this._canceller=new me,this._isStarted=!1,this._isRefreshPending=!1,this._consecutiveUnsafeMode=0,this._prioritizedContentUrl=null}dispose(){this._canceller.cancel(),this.removeEventListener()}start(){if(this._isStarted)return;let e;this._isStarted=!0;const t=this._settings.initialManifest;e=t instanceof an?Promise.resolve({manifest:t}):void 0!==t?this.parse(t,{previousManifest:null,unsafeMode:!1},void 0):this._fetchManifest(void 0).then(e=>{return e.parse({previousManifest:null,unsafeMode:!1})}),e.then(e=>{this.trigger("manifestReady",e.manifest),this._canceller.isUsed()||this._recursivelyRefreshManifest(e.manifest,e)}).catch(e=>this._onFatalError(e))}updateContentUrls(e,t){var n;this._prioritizedContentUrl=null!==(n=null===e||void 0===e?void 0:e[0])&&void 0!==n?n:void 0,t&&this.scheduleManualRefresh({enablePartialRefresh:!1,delay:0,canUseUnsafeMode:!1})}async _fetchManifest(e){var t;const n=this._canceller.signal,i=this._settings,r=this._pipelines,s=null!==e&&void 0!==e?e:null===(t=this._manifestUrls)||void 0===t?void 0:t[0],a=this._getBackoffSetting(e=>{this.trigger("warning",on(e))});try{const e=await o(s);return{parse:t=>{return this._parseLoadedManifest(e,t,s)}}}catch(e){throw on(e)}function o(e){const{loadManifest:t}=r;let s=void 0===i.requestTimeout?N.getCurrent().DEFAULT_REQUEST_TIMEOUT:i.requestTimeout,o=void 0===i.connectionTimeout?N.getCurrent().DEFAULT_CONNECTION_TIMEOUT:i.connectionTimeout;s<0&&(s=void 0),o<0&&(o=void 0);const l=()=>t(e,{timeout:s,connectionTimeout:o},n);return gn(l,a,n)}}parse(e,t,n){return this._parseLoadedManifest({responseData:e,size:void 0,requestDuration:void 0},t,n)}async _parseLoadedManifest(e,t,n){var i;const r=Se(),s=this._canceller.signal,a=this.trigger.bind(this),{sendingTime:o,receivedTime:l}=e,u=this._getBackoffSetting(e=>{this.trigger("warning",on(e))}),c=null!==n&&void 0!==n?n:null===(i=this._manifestUrls)||void 0===i?void 0:i[0],d={externalClockOffset:t.externalClockOffset,unsafeMode:t.unsafeMode,previousManifest:t.previousManifest,originalUrl:c};try{const t=this._pipelines.parseManifest(e,d,f,s,h);if(vn(t)){const{manifest:e,warnings:n}=await t;return p(e,n)}return p(t.manifest,t.warnings)}catch(e){const t=ft(e,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"Unknown error when parsing the Manifest"});throw t}async function h(e){try{const t=await gn(e,u,s);return t}catch(e){throw on(e)}}function f(e){for(const t of e){if(s.isCancelled())return;const e=ft(t,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"Unknown error when parsing the Manifest"});a("warning",e)}}function p(e,t){f(t);const n=Se()-r;return V.info(`MF: Manifest parsed in ${n}ms`),{manifest:e,sendingTime:o,receivedTime:l,parsingTime:n}}}_getBackoffSetting(e){const{DEFAULT_MAX_MANIFEST_REQUEST_RETRY:t,INITIAL_BACKOFF_DELAY_BASE:n,MAX_BACKOFF_DELAY_BASE:i}=N.getCurrent(),{lowLatencyMode:r,maxRetry:s}=this._settings,a=r?n.LOW_LATENCY:n.REGULAR,o=r?i.LOW_LATENCY:i.REGULAR,l=null!==s&&void 0!==s?s:t;return{onRetry:e,baseDelay:a,maxDelay:o,maxRetry:l}}_recursivelyRefreshManifest(e,{sendingTime:t,parsingTime:n,updatingTime:i}){const{MAX_CONSECUTIVE_MANIFEST_PARSING_IN_UNSAFE_MODE:r,MIN_MANIFEST_PARSING_TIME_TO_ENTER_UNSAFE_MODE:s}=N.getCurrent(),a=void 0!==n?n+(null!==i&&void 0!==i?i:0):void 0;let o=!1;this._consecutiveUnsafeMode>0?o=this._consecutiveUnsafeMode<r:void 0!==a&&(o=a>=s);const l=void 0===t?0:Se()-t,u=Math.max(this._settings.minimumManifestUpdateInterval-l,0),c=new me;if(c.linkToSignal(this._canceller.signal),this.scheduleManualRefresh=(n=>{const{enablePartialRefresh:i,delay:r,canUseUnsafeMode:s}=n,a=s&&o,l=void 0===t?0:Se()-t,u=Math.max(this._settings.minimumManifestUpdateInterval-l,0),d=setTimeout(()=>{c.cancel(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:i,unsafeMode:a})},Math.max((null!==r&&void 0!==r?r:0)-l,u));c.signal.register(()=>{clearTimeout(d)})}),null!==e.expired){const t=setTimeout(()=>{var t;null===(t=e.expired)||void 0===t||t.then(()=>{c.cancel(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:o})},U)},u);c.signal.register(()=>{clearTimeout(t)})}if(void 0!==e.lifetime&&e.lifetime>=0){const t=1e3*e.lifetime-l;let n;void 0===a?n=t:e.lifetime<3&&a>=100?(n=Math.min(Math.max(3e3-l,Math.max(t,0)+a),6*t),V.info("MUS: Manifest update rythm is too frequent. Postponing next request.",t,n)):a>=1e3*e.lifetime/10?(n=Math.min(Math.max(t,0)+a,6*t),V.info("MUS: Manifest took too long to parse. Postponing next request",n,n)):n=t;const i=setTimeout(()=>{c.cancel(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:o})},Math.max(n,u));c.signal.register(()=>{clearTimeout(i)})}}_triggerNextManifestRefresh(e,{enablePartialRefresh:t,unsafeMode:n}){const i=e.updateUrl;let r,s;null!==this._prioritizedContentUrl?(r=!0,s=this._prioritizedContentUrl,this._prioritizedContentUrl=null):(r=!t||void 0===i,s=r?e.getUrls()[0]:i);const a=e.clockOffset;n?(this._consecutiveUnsafeMode+=1,V.info('Init: Refreshing the Manifest in "unsafeMode" for the '+String(this._consecutiveUnsafeMode)+" consecutive time.")):this._consecutiveUnsafeMode>0&&(V.info('Init: Not parsing the Manifest in "unsafeMode" anymore after '+String(this._consecutiveUnsafeMode)+" consecutive times."),this._consecutiveUnsafeMode=0),this._isRefreshPending||(this._isRefreshPending=!0,this._fetchManifest(s).then(t=>t.parse({externalClockOffset:a,previousManifest:e,unsafeMode:n})).then(t=>{this._isRefreshPending=!1;const{manifest:n,sendingTime:i,parsingTime:s}=t,a=Se();if(r)e.replace(n);else try{e.update(n)}catch(t){const n=t instanceof Error?t.message:"unknown error";V.warn(`MUS: Attempt to update Manifest failed: ${n}`,"Re-downloading the Manifest fully");const{FAILED_PARTIAL_UPDATE_MANIFEST_REFRESH_DELAY:r}=N.getCurrent(),s=void 0===i?0:Se()-i,a=Math.max(this._settings.minimumManifestUpdateInterval-s,0);let o=U;const l=setTimeout(()=>{o(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:!1})},Math.max(r-s,a));return void(o=this._canceller.signal.register(()=>{clearTimeout(l)}))}const o=Se()-a;this._recursivelyRefreshManifest(e,{sendingTime:i,parsingTime:s,updatingTime:o})}).catch(e=>{this._isRefreshPending=!1,this._onFatalError(e)}))}_onFatalError(e){this._canceller.isUsed()||(this.trigger("error",e),this.dispose())}}function vn(e){return e instanceof Promise}var yn=mn;class bn extends s{constructor(e){super(),this._downgradedCdnList={metadata:[],timeouts:[]},e.register(()=>{for(const e of this._downgradedCdnList.timeouts)clearTimeout(e);this._downgradedCdnList={metadata:[],timeouts:[]}})}getCdnPreferenceForResource(e){return e.length<=1?e:this._innerGetCdnPreferenceForResource(e)}downgradeCdn(e){const t=_n(this._downgradedCdnList.metadata,e);t>=0&&this._removeIndexFromDowngradeList(t);const{DEFAULT_CDN_DOWNGRADE_TIME:n}=N.getCurrent(),i=n;this._downgradedCdnList.metadata.push(e);const r=setTimeout(()=>{const t=_n(this._downgradedCdnList.metadata,e);t>=0&&this._removeIndexFromDowngradeList(t),this.trigger("priorityChange",null)},i);this._downgradedCdnList.timeouts.push(r),this.trigger("priorityChange",null)}_innerGetCdnPreferenceForResource(e){const[t,n]=e.reduce((e,t)=>{return this._downgradedCdnList.metadata.some(e=>e.id===t.id&&e.baseUrl===t.baseUrl)?e[1].push(t):e[0].push(t),e},[[],[]]);return t.concat(n)}_removeIndexFromDowngradeList(e){this._downgradedCdnList.metadata.splice(e,1);const t=this._downgradedCdnList.timeouts.splice(e,1);clearTimeout(t[0])}}function _n(e,t){return 0===e.length?-1:void 0!==t.id?le(e,e=>e.id===t.id):le(e,e=>e.baseUrl===t.baseUrl)}function Tn(e,t){const n=new WeakMap;return{createRequest(i,r,s,a){const o=e=>{return t(i,s,e)},l=e.create(o,r,s,a);return n.set(l,o),l},updatePriority(t,i){const r=n.get(t);void 0!==r?e.updatePriority(r,i):V.warn("Fetchers: Cannot update the priority of a request: task not found.")}}}function Sn(e,t){return e.segment.id===t.segment.id&&e.representation.uniqueId===t.representation.uniqueId}function wn(e){if(r(e))return"";const{period:t,adaptation:n,representation:i,segment:s}=e;let a;return a=s.isInit?"init":s.complete?`${s.time}-${s.duration}`:`${s.time}`,`${n.type} P: ${t.id} A: ${n.id} `+`R: ${i.id} S: ${a}`}class En{constructor(){this._cache=new WeakMap}add({representation:e,segment:t},n){t.isInit&&this._cache.set(e,n)}get({representation:e,segment:t}){if(t.isInit){const t=this._cache.get(e);if(void 0!==t)return t}return null}}var xn=En;const kn=pt();function An(e,t,n,i,s){let a;a=void 0===s.connectionTimeout||s.connectionTimeout<0?void 0:s.connectionTimeout;const o={timeout:s.requestTimeout<0?void 0:s.requestTimeout,connectionTimeout:a},l=gt(["audio","video"],e)?new xn:void 0,{loadSegment:u,parseSegment:c}=t;return async function(e,t,a){var d,h,f;const{segment:p,adaptation:g,representation:m,manifest:v,period:y}=e,b=wn(e),_=kn();let T;const S=[];let w=0,E=!1;const x={segment:p,type:g.type,language:g.language,isLive:v.isLive,periodStart:y.start,periodEnd:y.end,mimeType:m.mimeType,codecs:m.codecs[0],manifestPublishTime:v.publishTime},k={onProgress(e){var t;void 0===T&&void 0!==e.totalSize&&e.size<e.totalSize&&(null===(t=i.onProgress)||void 0===t||t.call(i,{duration:e.duration,size:e.size,totalSize:e.totalSize,timestamp:Se(),id:_}))},onNewChunk(e){t.onChunk(D(e,!0))}},A=void 0!==l?l.get(e):null;if(null!==A)return V.debug("SF: Found wanted segment in cache",b),t.onChunk(D(A,!1)),Promise.resolve();V.debug("SF: Beginning request",b),null===(d=i.onRequestBegin)||void 0===d||d.call(i,{requestTimestamp:Se(),id:_,content:e}),a.register(I);try{const r=await pn(e.representation.cdnMetadata,n,C,R({onRetry:M},s),a);if("segment-loaded"===r.resultType){const n=r.resultData.responseData;void 0!==l&&l.add(e,r.resultData.responseData),t.onChunk(D(n,!1))}else"segment-created"===r.resultType&&t.onChunk(D(r.resultData,!1));V.debug("SF: Segment request ended with success",b),t.onAllChunksReceived(),"segment-created"!==r.resultType?(T=r.resultData,L()):T=null,a.isCancelled()||null===(h=i.onRequestEnd)||void 0===h||h.call(i,{id:_}),a.deregister(I)}catch(e){if(a.deregister(I),T=null,e instanceof ye)throw V.debug("SF: Segment request aborted",b),e;throw V.debug("SF: Segment request failed",b),null===(f=i.onRequestEnd)||void 0===f||f.call(i,{id:_}),on(e)}function I(){var e;void 0===T&&(V.debug("SF: Segment request cancelled",b),T=null,null===(e=i.onRequestEnd)||void 0===e||e.call(i,{id:_}))}function C(e){return u(e,x,o,a,k)}function D(e,t){S.push(!1);const n=S.length-1;return function(i){const r={data:e,isChunked:t};try{const e=c(r,x,i);return S[n]||(w=void 0!==w&&"media"===e.segmentType&&null!==e.chunkInfos&&void 0!==e.chunkInfos.duration?w+e.chunkInfos.duration:void 0,S[n]=!0,L()),e}catch(e){throw ft(e,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"Unknown parsing error"})}}}function M(e){t.onRetry(on(e))}function L(){var t;E||!r(T)&&void 0!==T.size&&void 0!==T.requestDuration&&S.length>0&&S.every(e=>e)&&(E=!0,null===(t=i.onMetrics)||void 0===t||t.call(i,{size:T.size,requestDuration:T.requestDuration,content:e,segmentDuration:w}))}}}function In({maxRetry:e,lowLatencyMode:t,requestTimeout:n,connectionTimeout:i}){const{DEFAULT_MAX_REQUESTS_RETRY_ON_ERROR:r,DEFAULT_REQUEST_TIMEOUT:s,DEFAULT_CONNECTION_TIMEOUT:a,INITIAL_BACKOFF_DELAY_BASE:o,MAX_BACKOFF_DELAY_BASE:l}=N.getCurrent();return{maxRetry:null!==e&&void 0!==e?e:r,baseDelay:t?o.LOW_LATENCY:o.REGULAR,maxDelay:t?l.LOW_LATENCY:l.REGULAR,requestTimeout:void 0===n?s:n,connectionTimeout:void 0===i?a:i}}class Cn{constructor({prioritySteps:e}){if(this._minPendingPriority=null,this._waitingQueue=[],this._pendingTasks=[],this._prioritySteps=e,this._prioritySteps.high>=this._prioritySteps.low)throw new Error("TP: the max high level priority should be given a lowerpriority number than the min low priority.")}create(e,t,n,i){let r;return un(i,(s,a)=>{const o=()=>{if(r.hasEnded)return;const e=()=>{u(),this._endTask(r)},t=t=>{n.beforeEnded(),e(),s(t)},o=t=>{e(),a(t)},l=new me,u=l.linkToSignal(i);r.interrupter=l,l.signal.register(()=>{r.interrupter=null,i.isCancelled()||n.beforeInterrupted()}),this._minPendingPriority=null===this._minPendingPriority?r.priority:Math.min(this._minPendingPriority,r.priority),this._pendingTasks.push(r),r.taskFn(l.signal).then(t).catch(e=>{!i.isCancelled()&&l.isUsed()&&e instanceof ye||o(e)})};return r={hasEnded:!1,priority:t,trigger:o,taskFn:e,interrupter:null},this._canBeStartedNow(r)?(r.trigger(),this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks()):this._waitingQueue.push(r),()=>this._endTask(r)})}_endTask(e){e.hasEnded=!0;const t=Dn(e.taskFn,this._waitingQueue);if(t>=0)this._waitingQueue.splice(t,1);else{const t=Dn(e.taskFn,this._pendingTasks);if(t<0)return;this._pendingTasks.splice(t,1),this._pendingTasks.length>0?this._minPendingPriority===e.priority&&(this._minPendingPriority=Math.min(...this._pendingTasks.map(e=>e.priority))):this._minPendingPriority=null,this._loopThroughWaitingQueue()}}updatePriority(e,t){const n=Dn(e,this._waitingQueue);if(n>=0){const e=this._waitingQueue[n];if(e.priority===t)return;if(e.priority=t,!this._canBeStartedNow(e))return;return this._findAndRunWaitingQueueTask(n),void(this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks())}const i=Dn(e,this._pendingTasks);if(i<0)return void V.warn("TP: request to update the priority of a non-existent task");const r=this._pendingTasks[i];if(r.priority===t)return;const s=r.priority;r.priority=t,null===this._minPendingPriority||t<this._minPendingPriority?this._minPendingPriority=t:this._minPendingPriority===s&&(1===this._pendingTasks.length?this._minPendingPriority=t:this._minPendingPriority=Math.min(...this._pendingTasks.map(e=>e.priority)),this._loopThroughWaitingQueue()),this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks()}_loopThroughWaitingQueue(){const e=this._waitingQueue.reduce((e,t)=>{return null===e||e>t.priority?t.priority:e},null);if(!(null===e||null!==this._minPendingPriority&&this._minPendingPriority<e))for(let t=0;t<this._waitingQueue.length;t++){const n=null===this._minPendingPriority?e:Math.min(this._minPendingPriority,e),i=this._waitingQueue[t];i.priority<=n&&(this._findAndRunWaitingQueueTask(t),t--)}}_interruptCancellableTasks(){for(let e=0;e<this._pendingTasks.length;e++){const t=this._pendingTasks[e];if(t.priority>=this._prioritySteps.low)return this._interruptPendingTask(t),this._interruptCancellableTasks()}}_findAndRunWaitingQueueTask(e){if(e>=this._waitingQueue.length||e<0)return V.warn("TP : Tried to start a non existing task"),!1;const t=this._waitingQueue.splice(e,1)[0];return t.trigger(),!0}_interruptPendingTask(e){var t;const n=Dn(e.taskFn,this._pendingTasks);n<0?V.warn("TP: Interrupting a non-existent pending task. Aborting..."):(this._pendingTasks.splice(n,1),this._waitingQueue.push(e),0===this._pendingTasks.length?this._minPendingPriority=null:this._minPendingPriority===e.priority&&(this._minPendingPriority=Math.min(...this._pendingTasks.map(e=>e.priority))),null===(t=e.interrupter)||void 0===t||t.cancel())}_canBeStartedNow(e){return null===this._minPendingPriority||e.priority<=this._minPendingPriority}_isRunningHighPriorityTasks(){return null!==this._minPendingPriority&&this._minPendingPriority<=this._prioritySteps.high}}function Dn(e,t){return le(t,t=>t.taskFn===e)}class Rn{constructor(e,t,n){const i=new bn(n),{MIN_CANCELABLE_PRIORITY:r,MAX_HIGH_PRIORITY_LEVEL:s}=N.getCurrent();this._transport=e,this._prioritizer=new Cn({prioritySteps:{high:s,low:r}}),this._cdnPrioritizer=i,this._backoffOptions=t}createSegmentFetcher(e,t){const n=In(this._backoffOptions),i=this._transport[e],r=An(e,i,this._cdnPrioritizer,t,n);return Tn(this._prioritizer,r)}}var Mn=Rn;class Ln{constructor(e){this._array=[],this._sortingFn=e}add(...e){e.sort(this._sortingFn);let t=0;for(let n=0;n<e.length;n++){const i=e[n];let r=!1;while(!r&&t<this._array.length)this._sortingFn(i,this._array[t])<0?(this._array.splice(t,0,i),r=!0):t++;r||this._array.push(i)}}length(){return this._array.length}get(e){if(e<0||e>=this._array.length)throw new Error("Invalid index.");return this._array[e]}toArray(){return this._array.slice()}findFirst(e){return De(this._array,e)}has(e){return gt(this._array,e)}removeElement(e){const t=this._array.indexOf(e);if(t>=0)return this._array.splice(t,1),t}head(){return this._array[0]}last(){return this._array[this._array.length-1]}shift(){return this._array.shift()}pop(){return this._array.pop()}}class Pn extends s{constructor(e,t,n){super(),this._canceller=new me,this._manifest=e,this._activeStreams=new Map,this._allBufferTypes=n,this._lastCurrentPeriodId=null;const i=new On(e);this._maximumPositionCalculator=i;const r=this._canceller.signal;t.listen(({position:t})=>{const n=t.getWanted();if(n<e.getMinimumSafePosition()){const e=new ut("MEDIA_TIME_BEFORE_MANIFEST","The current position is behind the earliest time announced in the Manifest.");this.trigger("warning",e)}else if(n>i.getMaximumAvailablePosition()){const e=new ut("MEDIA_TIME_AFTER_MANIFEST","The current position is after the latest time announced in the Manifest.");this.trigger("warning",e)}},{includeLastObservation:!0,clearSignal:r}),e.addEventListener("manifestUpdate",()=>{this.trigger("endingPositionChange",this._getManifestEndTime()),r.isCancelled()||this._checkEndOfStream()},r)}getCurrentEndingTime(){return this._getManifestEndTime()}onAdaptationChange(e,t,n){if(this._manifest.isLastPeriodKnown){const i=this._manifest.periods[this._manifest.periods.length-1];if(t.id===(null===i||void 0===i?void 0:i.id)&&("audio"===e||"video"===e)){"audio"===e?this._maximumPositionCalculator.updateLastAudioAdaptation(n):this._maximumPositionCalculator.updateLastVideoAdaptation(n);const t=this._maximumPositionCalculator.getEndingPosition(),i=void 0!==t?{isEnd:!0,endingPosition:t}:{isEnd:!1,endingPosition:this._maximumPositionCalculator.getMaximumAvailablePosition()};this.trigger("endingPositionChange",i)}}this._canceller.isUsed()||null===n&&this._addActivelyLoadedPeriod(t,e)}onRepresentationChange(e,t){this._addActivelyLoadedPeriod(t,e)}onPeriodCleared(e,t){this._removeActivelyLoadedPeriod(t,e)}onLastSegmentFinishedLoading(e){const t=this._lazilyCreateActiveStreamInfo(e);t.hasFinishedLoadingLastPeriod||(t.hasFinishedLoadingLastPeriod=!0,this._checkEndOfStream())}onLastSegmentLoadingResume(e){const t=this._lazilyCreateActiveStreamInfo(e);t.hasFinishedLoadingLastPeriod&&(t.hasFinishedLoadingLastPeriod=!1,this._checkEndOfStream())}dispose(){this.removeEventListener(),this._canceller.cancel()}_addActivelyLoadedPeriod(e,t){const n=this._lazilyCreateActiveStreamInfo(t);n.activePeriods.has(e)||(n.activePeriods.add(e),this._checkCurrentPeriod())}_removeActivelyLoadedPeriod(e,t){const n=this._activeStreams.get(t);void 0!==n&&n.activePeriods.has(e)&&(n.activePeriods.removeElement(e),this._checkCurrentPeriod())}_checkCurrentPeriod(){if(0===this._allBufferTypes.length)return;const e=this._activeStreams.get(this._allBufferTypes[0]);if(void 0!==e)for(const t of e.activePeriods.toArray()){let e=!0;for(const n of this._allBufferTypes){const i=this._activeStreams.get(n);if(void 0===i)return;const r=i.activePeriods.toArray(),s=r.some(e=>e.id===t.id);if(!s){e=!1;break}}if(e)return void(this._lastCurrentPeriodId!==t.id&&(this._lastCurrentPeriodId=t.id,this.trigger("periodChange",t)))}}_getManifestEndTime(){const e=this._maximumPositionCalculator.getEndingPosition();return void 0!==e?{isEnd:!0,endingPosition:e}:{isEnd:!1,endingPosition:this._maximumPositionCalculator.getMaximumAvailablePosition()}}_lazilyCreateActiveStreamInfo(e){let t=this._activeStreams.get(e);return void 0===t&&(t={activePeriods:new Ln((e,t)=>e.start-t.start),hasFinishedLoadingLastPeriod:!1},this._activeStreams.set(e,t)),t}_checkEndOfStream(){if(!this._manifest.isLastPeriodKnown)return;const e=this._allBufferTypes.every(e=>{const t=this._activeStreams.get(e);return void 0!==t&&t.hasFinishedLoadingLastPeriod});e?this.trigger("endOfStream",null):this.trigger("resumeStream",null)}}class On{constructor(e){this._manifest=e,this._lastAudioAdaptation=void 0,this._lastVideoAdaptation=void 0}updateLastAudioAdaptation(e){this._lastAudioAdaptation=e}updateLastVideoAdaptation(e){this._lastVideoAdaptation=e}getMaximumAvailablePosition(){if(this._manifest.isDynamic)return this._manifest.getMaximumSafePosition();if(void 0===this._lastVideoAdaptation||void 0===this._lastAudioAdaptation)return this._manifest.getMaximumSafePosition();if(null===this._lastAudioAdaptation){if(null===this._lastVideoAdaptation)return this._manifest.getMaximumSafePosition();{const e=Nn(this._lastVideoAdaptation);return"number"!==typeof e?this._manifest.getMaximumSafePosition():e}}if(null===this._lastVideoAdaptation){const e=Nn(this._lastAudioAdaptation);return"number"!==typeof e?this._manifest.getMaximumSafePosition():e}{const e=Nn(this._lastAudioAdaptation),t=Nn(this._lastVideoAdaptation);return"number"!==typeof e||"number"!==typeof t?this._manifest.getMaximumSafePosition():Math.min(e,t)}}getEndingPosition(){var e,t;if(!this._manifest.isDynamic)return this.getMaximumAvailablePosition();if(void 0!==this._lastVideoAdaptation&&void 0!==this._lastAudioAdaptation){if(null===this._lastAudioAdaptation)return null===this._lastVideoAdaptation?void 0:null!==(e=Un(this._lastVideoAdaptation))&&void 0!==e?e:void 0;if(null===this._lastVideoAdaptation)return null!==(t=Un(this._lastAudioAdaptation))&&void 0!==t?t:void 0;{const e=Un(this._lastAudioAdaptation),t=Un(this._lastVideoAdaptation);return"number"!==typeof e||"number"!==typeof t?void 0:Math.min(e,t)}}}}function Nn(e){const{representations:t}=e;let n,i=null;for(const s of t)if(s.index!==n){n=s.index;const e=s.index.getLastAvailablePosition();if(void 0===e)return;null!==e&&(i=r(i)?e:Math.min(i,e))}return i}function Un(e){const{representations:t}=e;let n,i=null;for(let s=0;s<t.length;s++)if(t[s].index!==n){n=t[s].index;const e=t[s].index.getEnd();if(void 0===e)return;null!==e&&(i=r(i)?e:Math.min(i,e))}return i}function Fn(e,t,n,i,r,s){s.register(()=>{t.interruptDurationSetting()});const a=new Pn(e,n,i.getBufferTypes());s.register(()=>{a.dispose()}),a.addEventListener("warning",e=>r.onWarning(e)),a.addEventListener("periodChange",e=>r.onPeriodChanged(e)),a.addEventListener("endingPositionChange",e=>{t.setDuration(e.endingPosition,e.isEnd)}),a.addEventListener("endOfStream",()=>{V.debug("Init: end-of-stream order received."),t.maintainEndOfStream()}),a.addEventListener("resumeStream",()=>{t.stopEndOfStream()});const o=a.getCurrentEndingTime();return t.setDuration(o.endingPosition,o.isEnd),a}class Bn{constructor(e){this._segmentSinksStore=e,this._currentFreezeTimestamp=null}needToReload(e){const{readyState:t,rebuffering:n,freezing:i}=e,r=void 0!==e.bufferGap&&isFinite(e.bufferGap)?e.bufferGap:0;if(r<6||null===n&&null===i||t>1)return this._currentFreezeTimestamp=null,!1;const s=Se();null===this._currentFreezeTimestamp&&(this._currentFreezeTimestamp=s);const a=null!==n&&s-n.timestamp>4e3,o=null!==i&&s-i.timestamp>4e3;if((a||o)&&Se()-this._currentFreezeTimestamp>4e3){const e=this._segmentSinksStore.getStatus("audio"),t=this._segmentSinksStore.getStatus("video");let n=!0,i=!0;for(const r of[e,t])if("initialized"===r.type)for(const e of r.value.getLastKnownInventory()){const{representation:t}=e.infos;if(!1===t.decipherable)return V.warn("Init: we have undecipherable segments left in the buffer, reloading"),this._currentFreezeTimestamp=null,!0;void 0!==t.contentProtections&&(i=!1,!0!==t.decipherable&&(n=!1))}if(!i&&n)return V.warn("Init: we are frozen despite only having decipherable segments left in the buffer, reloading"),this._currentFreezeTimestamp=null,!0}return!1}}class jn{constructor(e,t){this._history=[],this._lifetime=e,this._maxHistoryLength=t}addBufferedSegment(e,t){const n=Se();this._history.push({date:n,buffered:t,context:e}),this._cleanHistory(n)}getHistoryFor(e){return this._history.filter(t=>Sn(t.context,e))}_cleanHistory(e){const t=e-this._lifetime;let n=0;for(const i of this._history){if(!(i.date<t))break;n++}if(n>0&&(this._history=this._history.splice(n)),this._history.length>this._maxHistoryLength){const e=this._history.length-this._maxHistoryLength;this._history=this._history.splice(e)}}}class Vn{constructor(){const{BUFFERED_HISTORY_RETENTION_TIME:e,BUFFERED_HISTORY_MAXIMUM_ENTRIES:t}=N.getCurrent();this._inventory=[],this._bufferedHistory=new jn(e,t)}reset(){this._inventory.length=0}synchronizeBuffered(e){var t,n,i,s,a,o,l;const u=this._inventory;let c=0,d=u[0];const{MINIMUM_SEGMENT_SIZE:h}=N.getCurrent(),f=null===d||void 0===d?void 0:d.infos.adaptation.type;if(V.hasLevel("DEBUG")){const t=e.map(e=>`${e.start}-${e.end}`).join(",");V.debug(`SI: synchronizing ${null!==f&&void 0!==f?f:"unknown"} buffered ranges:`,t)}const p=e.length;for(let r=0;r<p;r++){if(void 0===d)return;const g=e[r].start,m=e[r].end;if(m-g<h){V.warn("SI: skipped range when synchronizing because it was too small",f,g,m);continue}const v=c;while(void 0!==d&&(null!==(t=d.bufferedEnd)&&void 0!==t?t:d.end)-g<h)d=u[++c];let y=null;const b=c-v;if(b>0){const e=u[v+b-1];y={end:null!==(n=e.bufferedEnd)&&void 0!==n?n:e.end,precizeEnd:e.precizeEnd},V.debug(`SI: ${b} segments GCed.`,f);const t=u.splice(v,b);for(const n of t)void 0===n.bufferedStart&&void 0===n.bufferedEnd&&2!==n.status&&this._bufferedHistory.addBufferedSegment(n.infos,null);c=v}if(void 0===d)return;if(m-(null!==(i=d.bufferedStart)&&void 0!==i?i:d.start)>=h){if(Gn(d,g,y,f),c===u.length-1)return void zn(d,m,f);d=u[++c];let t=null!==(s=d.bufferedStart)&&void 0!==s?s:d.start,n=null!==(a=d.bufferedEnd)&&void 0!==a?a:d.end;const i=r<p-1?e[r+1].start:void 0;while(void 0!==d){if(m<t)break;if(m-t<h&&n-m>=h)break;if(void 0!==i&&m-t<n-i)break;const e=u[c-1];void 0===e.bufferedEnd&&(d.precizeStart?e.bufferedEnd=d.start:e.infos.segment.complete?e.bufferedEnd=e.end:e.bufferedEnd=d.start,V.debug("SI: calculating buffered end of contiguous segment",f,e.bufferedEnd,e.end)),d.bufferedStart=e.bufferedEnd,d=u[++c],void 0!==d&&(t=null!==(o=d.bufferedStart)&&void 0!==o?o:d.start,n=null!==(l=d.bufferedEnd)&&void 0!==l?l:d.end)}}const _=u[c-1];void 0!==_&&zn(_,m,f)}if(!r(d)){const{SEGMENT_SYNCHRONIZATION_DELAY:e}=N.getCurrent(),t=Se();for(let n=c;n<u.length;n++){const i=u[n];t-i.insertionTs>=e&&(V.debug("SI: A segment at the end has been completely GCed",f,`${i.start}-${i.end}`),void 0===i.bufferedStart&&void 0===i.bufferedEnd&&2!==i.status&&this._bufferedHistory.addBufferedSegment(i.infos,null),u.splice(n,1),n--)}}void 0!==f&&V.hasLevel("DEBUG")&&V.debug(`SI: current ${f} inventory timeline:\n`+qn(this._inventory))}insertChunk({period:e,adaptation:t,representation:n,segment:i,chunkSize:r,start:s,end:a},o,l){if(i.isInit)return;const u=t.type;if(s>=a)return void V.warn("SI: Invalid chunked inserted: starts before it ends",u,s,a);const c=this._inventory,d={status:o?0:2,insertionTs:l,chunkSize:r,splitted:!1,start:s,end:a,precizeStart:!1,precizeEnd:!1,bufferedStart:void 0,bufferedEnd:void 0,infos:{segment:i,period:e,adaptation:t,representation:n}};for(let f=c.length-1;f>=0;f--){const e=c[f];if(e.start<=s){if(e.end<=s){V.debug("SI: Pushing segment strictly after previous one.",u,s,e.end),this._inventory.splice(f+1,0,d),f+=2;while(f<c.length&&c[f].start<d.end){if(c[f].end>d.end)return V.debug("SI: Segment pushed updates the start of the next one",u,d.end,c[f].start),c[f].start=d.end,c[f].bufferedStart=void 0,void(c[f].precizeStart=c[f].precizeStart&&d.precizeEnd);V.debug("SI: Segment pushed removes the next one",u,s,a,c[f].start,c[f].end),c.splice(f,1)}return}if(e.start===s){if(e.end<=a){V.debug("SI: Segment pushed replace another one",u,s,a,e.end),this._inventory.splice(f,1,d),f+=1;while(f<c.length&&c[f].start<d.end){if(c[f].end>d.end)return V.debug("SI: Segment pushed updates the start of the next one",u,d.end,c[f].start),c[f].start=d.end,c[f].bufferedStart=void 0,void(c[f].precizeStart=c[f].precizeStart&&d.precizeEnd);V.debug("SI: Segment pushed removes the next one",u,s,a,c[f].start,c[f].end),c.splice(f,1)}return}return V.debug("SI: Segment pushed ends before another with the same start",u,s,a,e.end),c.splice(f,0,d),e.start=d.end,e.bufferedStart=void 0,void(e.precizeStart=e.precizeStart&&d.precizeEnd)}if(e.end<=d.end){V.debug("SI: Segment pushed updates end of previous one",u,s,a,e.start,e.end),this._inventory.splice(f+1,0,d),e.end=d.start,e.bufferedEnd=void 0,e.precizeEnd=e.precizeEnd&&d.precizeStart,f+=2;while(f<c.length&&c[f].start<d.end){if(c[f].end>d.end)return V.debug("SI: Segment pushed updates the start of the next one",u,d.end,c[f].start),c[f].start=d.end,c[f].bufferedStart=void 0,void(c[f].precizeStart=c[f].precizeStart&&d.precizeEnd);V.debug("SI: Segment pushed removes the next one",u,s,a,c[f].start,c[f].end),c.splice(f,1)}return}{V.warn("SI: Segment pushed is contained in a previous one",u,s,a,e.start,e.end);const t={status:e.status,insertionTs:e.insertionTs,chunkSize:e.chunkSize,splitted:!0,start:d.end,end:e.end,precizeStart:e.precizeStart&&e.precizeEnd&&d.precizeEnd,precizeEnd:e.precizeEnd,bufferedStart:void 0,bufferedEnd:e.end,infos:e.infos};return e.end=d.start,e.splitted=!0,e.bufferedEnd=void 0,e.precizeEnd=e.precizeEnd&&d.precizeStart,c.splice(f+1,0,d),void c.splice(f+2,0,t)}}}const h=this._inventory[0];if(void 0===h)return V.debug("SI: first segment pushed",u,s,a),void this._inventory.push(d);if(!(h.start>=a)){if(h.end<=a){V.debug("SI: Segment pushed starts before and completely recovers the previous first one",u,s,a,h.start,h.end),this._inventory.splice(0,1,d);while(c.length>1&&c[1].start<d.end){if(c[1].end>d.end)return V.debug("SI: Segment pushed updates the start of the next one",u,d.end,c[1].start),c[1].start=d.end,c[1].bufferedStart=void 0,void(c[1].precizeStart=d.precizeEnd);V.debug("SI: Segment pushed removes the next one",u,s,a,c[1].start,c[1].end),c.splice(1,1)}return}return V.debug("SI: Segment pushed start of the next one",u,s,a,h.start,h.end),h.start=a,h.bufferedStart=void 0,h.precizeStart=d.precizeEnd,void this._inventory.splice(0,0,d)}V.debug("SI: Segment pushed comes before all previous ones",u,s,a,h.start),this._inventory.splice(0,0,d)}completeSegment(e){if(e.segment.isInit)return;const t=this._inventory,n=[];for(let i=0;i<t.length;i++)if(Sn(t[i].infos,e)){let r=!1;n.length>0&&(r=!0,1===n.length&&(V.warn("SI: Completed Segment is splitted.",e.segment.id,e.segment.time,e.segment.end),n[0].splitted=!0));const s=i;let a=t[i].chunkSize;i+=1;while(i<t.length&&Sn(t[i].infos,e)){const e=t[i].chunkSize;void 0!==a&&void 0!==e&&(a+=e),i++}const o=i-1,l=o-s,u=t[o].end,c=t[o].bufferedEnd;l>0&&(this._inventory.splice(s+1,l),i-=l),0===this._inventory[s].status&&(this._inventory[s].status=1),this._inventory[s].chunkSize=a,this._inventory[s].end=u,this._inventory[s].bufferedEnd=c,this._inventory[s].splitted=r,n.push(this._inventory[s])}if(0===n.length)V.warn("SI: Completed Segment not found",e.segment.id,e.segment.time);else for(const i of n)void 0!==i.bufferedStart&&void 0!==i.bufferedEnd?2!==i.status&&this._bufferedHistory.addBufferedSegment(i.infos,{start:i.bufferedStart,end:i.bufferedEnd}):V.debug("SI: buffered range not known after sync. Skipping history.",i.start,i.end)}getInventory(){return this._inventory}getHistoryFor(e){return this._bufferedHistory.getHistoryFor(e)}}function Hn(e){if(void 0===e.bufferedStart||1!==e.status)return!1;const{start:t,end:n}=e,i=n-t,{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:r,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:s}=N.getCurrent();return Math.abs(t-e.bufferedStart)<=r&&(void 0===e.bufferedEnd||e.bufferedEnd>e.bufferedStart&&Math.abs(e.bufferedEnd-e.bufferedStart-i)<=Math.min(s,i/3))}function $n(e){if(void 0===e.bufferedEnd||!e.infos.segment.complete||1!==e.status)return!1;const{start:t,end:n}=e,i=n-t,{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:r,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:s}=N.getCurrent();return Math.abs(n-e.bufferedEnd)<=r&&void 0!==e.bufferedStart&&e.bufferedEnd>e.bufferedStart&&Math.abs(e.bufferedEnd-e.bufferedStart-i)<=Math.min(s,i/3)}function Gn(e,t,n,i){const{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:r,MISSING_DATA_TRIGGER_SYNC_DELAY:s,SEGMENT_SYNCHRONIZATION_DELAY:a}=N.getCurrent();if(void 0!==e.bufferedStart)e.bufferedStart<t&&(V.debug("SI: Segment partially GCed at the start",i,e.bufferedStart,t),e.bufferedStart=t),!e.precizeStart&&Hn(e)&&(e.start=e.bufferedStart,e.precizeStart=!0);else if(e.precizeStart)V.debug("SI: buffered start is precize start",i,e.start),e.bufferedStart=e.start;else if(null!==n&&n.end>t&&(n.precizeEnd||e.start-n.end<=r))V.debug("SI: buffered start is end of previous segment",i,t,e.start,n.end),e.bufferedStart=n.end,Hn(e)&&(e.start=n.end,e.precizeStart=!0);else if(e.start-t<=r){const n=Se();if(e.start-t>=s&&n-e.insertionTs<a)return void V.debug("SI: Ignored bufferedStart synchronization",i,t,e.start,n-e.insertionTs);V.debug("SI: found true buffered start",i,t,e.start),e.bufferedStart=t,Hn(e)&&(e.start=t,e.precizeStart=!0)}else if(t<e.start)V.debug("SI: range start too far from expected start",i,t,e.start),e.bufferedStart=e.start;else{const n=Se();if(e.start-t>=s&&n-e.insertionTs<a)return void V.debug("SI: Ignored bufferedStart synchronization",i,t,e.start,n-e.insertionTs);V.debug("SI: Segment appears immediately garbage collected at the start",i,t,e.start),e.bufferedStart=t}}function zn(e,t,n){const{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:i,MISSING_DATA_TRIGGER_SYNC_DELAY:r,SEGMENT_SYNCHRONIZATION_DELAY:s}=N.getCurrent();if(void 0!==e.bufferedEnd)e.bufferedEnd>t&&(V.debug("SI: Segment partially GCed at the end",n,e.bufferedEnd,t),e.bufferedEnd=t),!e.precizeEnd&&t-e.end<=i&&$n(e)&&(e.precizeEnd=!0,e.end=t);else if(e.precizeEnd)V.debug("SI: buffered end is precize end",n,e.end),e.bufferedEnd=e.end;else if(t-e.end<=i||!e.infos.segment.complete){const i=Se();if(t-e.end>=r&&i-e.insertionTs<s)return void V.debug("SI: Ignored bufferedEnd synchronization",n,t,e.end,i-e.insertionTs);V.debug("SI: found true buffered end",n,t,e.end),e.bufferedEnd=t,$n(e)&&(e.end=t,e.precizeEnd=!0)}else if(t>e.end)V.debug("SI: range end too far from expected end",n,t,e.end),e.bufferedEnd=e.end;else{const i=Se();if(t-e.end>=r&&i-e.insertionTs<s)return void V.debug("SI: Ignored bufferedEnd synchronization",n,t,e.end,i-e.insertionTs);V.debug("SI: Segment appears immediately garbage collected at the end",n,e.bufferedEnd,t),e.bufferedEnd=t}}function qn(e){const t=1/60,n={},i=[];let r=null,s=null;function a(e){const t=String.fromCharCode(i.length+65);return i.push({letter:t,periodId:e.period.id,representationId:e.representation.id,bitrate:e.representation.bitrate}),t}let o="";for(let l=0;l<e.length;l++){const i=e[l];if(void 0!==i.bufferedStart&&void 0!==i.bufferedEnd){const e=i.infos.period.id,l=i.infos.representation.id,u=n[e];let c;void 0===u?(c=a(i.infos),n[e]={[l]:c}):void 0===u[l]?(c=a(i.infos),u[l]=c):c=u[l],null===r?o+=`${i.bufferedStart.toFixed(2)}|${c}|`:s===c?r.bufferedEnd+t<i.bufferedStart&&(o+=`${r.bufferedEnd.toFixed(2)} ~ `+`${i.bufferedStart.toFixed(2)}|${c}|`):o+=`${r.bufferedEnd.toFixed(2)} ~ `+`${i.bufferedStart.toFixed(2)}|${c}|`,r=i,s=c}}return null!==r&&(o+=String(r.end.toFixed(2))),i.forEach(e=>{var t;o+=`\n[${e.letter}] `+`P: ${e.periodId} || R: ${e.representationId}`+`(${null!==(t=e.bitrate)&&void 0!==t?t:"unknown bitrate"})`}),o}var Wn,Kn=Vn;class Yn{constructor(){this._segmentInventory=new Kn}synchronizeInventory(e){this._segmentInventory.synchronizeBuffered(e)}getLastKnownInventory(){return this._segmentInventory.getInventory()}getSegmentHistory(e){return this._segmentInventory.getHistoryFor(e)}}(function(e){e[e["Push"]=0]="Push",e[e["Remove"]=1]="Remove",e[e["SignalSegmentComplete"]=2]="SignalSegmentComplete"})(Wn||(Wn={}));class Xn extends Yn{constructor(e,t,n){super(),V.info("AVSB: calling `mediaSource.addSourceBuffer`",t);const i=n.addSourceBuffer(e,t);this.bufferType=e,this._sourceBuffer=i,this._lastInitSegmentUniqueId=null,this.codec=t,this._initSegmentsMap=new Map,this._pendingOperations=[]}declareInitSegment(e,t){Qn(t),this._initSegmentsMap.set(e,t)}freeInitSegment(e){this._initSegmentsMap.delete(e)}async pushChunk(e){Qn(e.data.chunk),V.debug("AVSB: receiving order to push data to the SourceBuffer",this.bufferType,wn(e.inventoryInfos));const t=this._getActualDataToPush(e.data);0===t.length&&t.push(new Uint8Array);const n=Promise.all(t.map(t=>{const{codec:n,timestampOffset:i,appendWindow:r}=e.data;return V.debug("AVSB: pushing segment",this.bufferType,wn(e.inventoryInfos)),this._sourceBuffer.appendBuffer(t,{codec:n,timestampOffset:i,appendWindow:r})}));let i;this._addToOperationQueue(n,{type:Wn.Push,value:e});try{i=await n}catch(t){throw this._segmentInventory.insertChunk(e.inventoryInfos,!1,Se()),t}null!==e.inventoryInfos&&this._segmentInventory.insertChunk(e.inventoryInfos,!0,Se());const r=i[i.length-1];return this._segmentInventory.synchronizeBuffered(r),r}async removeBuffer(e,t){V.debug("AVSB: receiving order to remove data from the SourceBuffer",this.bufferType,e,t);const n=this._sourceBuffer.remove(e,t);this._addToOperationQueue(n,{type:Wn.Remove,value:{start:e,end:t}});const i=await n;return this._segmentInventory.synchronizeBuffered(i),i}async signalSegmentComplete(e){if(this._pendingOperations.length>0){const{promise:t}=this._pendingOperations[this._pendingOperations.length-1];this._addToOperationQueue(t,{type:Wn.SignalSegmentComplete,value:e});try{await t}catch(e){}}this._segmentInventory.completeSegment(e)}getPendingOperations(){return this._pendingOperations.map(e=>e.operation)}dispose(){try{V.debug("AVSB: Calling `dispose` on the SourceBufferInterface"),this._sourceBuffer.dispose()}catch(e){V.debug(`AVSB: Failed to dispose a ${this.bufferType} SourceBufferInterface:`,e instanceof Error?e:"")}}_getActualDataToPush(e){const t=[];if(null!==e.initSegmentUniqueId&&!this._isLastInitSegment(e.initSegmentUniqueId)){let n=this._initSegmentsMap.get(e.initSegmentUniqueId);if(void 0===n)throw new Error("Invalid initialization segment uniqueId");const i=new ArrayBuffer(n.byteLength),r=new Uint8Array(i);r.set(n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer)),n=r,t.push(n),this._lastInitSegmentUniqueId=e.initSegmentUniqueId}return null!==e.chunk&&t.push(e.chunk),t}_isLastInitSegment(e){return null!==this._lastInitSegmentUniqueId&&this._lastInitSegmentUniqueId===e}_addToOperationQueue(e,t){const n={operation:t,promise:e};this._pendingOperations.push(n);const i=()=>{const e=this._pendingOperations.indexOf(n);e>=0&&this._pendingOperations.splice(e,1)};e.then(i,i)}}function Qn(e){}var Zn=Xn;class Jn extends Yn{constructor(e){V.debug("HTSB: Creating TextSegmentSink"),super(),this.bufferType="text",this._sender=e,this._pendingOperations=[],this._sender.reset()}declareInitSegment(e){V.warn("HTSB: Declaring initialization segment for  Text SegmentSink",e)}freeInitSegment(e){V.warn("HTSB: Freeing initialization segment for  Text SegmentSink",e)}async pushChunk(e){const{data:t}=e;ei(t.chunk);const n=this._sender.pushTextData(Object.assign(Object.assign({},t),{chunk:t.chunk}));this._addToOperationQueue(n,{type:Wn.Push,value:e});const i=await n;return null!==e.inventoryInfos&&this._segmentInventory.insertChunk(e.inventoryInfos,!0,Se()),this._segmentInventory.synchronizeBuffered(i),i}async removeBuffer(e,t){const n=this._sender.remove(e,t);this._addToOperationQueue(n,{type:Wn.Remove,value:{start:e,end:t}});const i=await n;return this._segmentInventory.synchronizeBuffered(i),i}async signalSegmentComplete(e){if(this._pendingOperations.length>0){const{promise:t}=this._pendingOperations[this._pendingOperations.length-1];this._addToOperationQueue(t,{type:Wn.SignalSegmentComplete,value:e});try{await t}catch(e){}}this._segmentInventory.completeSegment(e)}getPendingOperations(){return this._pendingOperations.map(e=>e.operation)}dispose(){V.debug("HTSB: Disposing TextSegmentSink"),this._sender.reset()}_addToOperationQueue(e,t){const n={operation:t,promise:e};this._pendingOperations.push(n);const i=()=>{const e=this._pendingOperations.indexOf(n);e>=0&&this._pendingOperations.splice(e,1)};e.then(i,i)}}function ei(e){}var ti=Jn;const ni=["audio","video","text"];class ii{static isNative(e){return ri(e)}constructor(e,t,n){this._mediaSource=e,this._textInterface=n,this._hasVideo=t,this._initializedSegmentSinks={},this._onNativeBufferAddedOrDisabled=[]}getBufferTypes(){const e=this.getNativeBufferTypes();return null!==this._textInterface&&e.push("text"),e}getNativeBufferTypes(){return this._hasVideo?["video","audio"]:["audio"]}getStatus(e){const t=this._initializedSegmentSinks[e];return void 0===t?{type:"uninitialized"}:null===t?{type:"disabled"}:{type:"initialized",value:t}}waitForUsableBuffers(e){return this._areNativeBuffersUsable()?Promise.resolve():un(e,e=>{let t;const n=()=>{const e=this._onNativeBufferAddedOrDisabled.indexOf(t);e>=0&&this._onNativeBufferAddedOrDisabled.splice(e,1)};return t=(()=>{this._areNativeBuffersUsable()&&(n(),e())}),this._onNativeBufferAddedOrDisabled.push(t),n})}disableSegmentSink(e){const t=this._initializedSegmentSinks[e];if(null!==t){if(void 0!==t)throw new Error("Cannot disable an active SegmentSink.");this._initializedSegmentSinks[e]=null,ii.isNative(e)&&this._onNativeBufferAddedOrDisabled.forEach(e=>e())}else V.warn(`SBS: The ${e} SegmentSink was already disabled.`)}createSegmentSink(e,t){const n=this._initializedSegmentSinks[e];if(ri(e)){if(!r(n))return n instanceof Zn&&n.codec!==t?V.warn("SB: Reusing native SegmentSink with codec",n.codec,"for codec",t):V.info("SB: Reusing native SegmentSink with codec",t),n;V.info("SB: Adding native SegmentSink with codec",t);const i="audio"===e?"audio":"video",s=new Zn(i,t,this._mediaSource);return this._initializedSegmentSinks[e]=s,this._onNativeBufferAddedOrDisabled.forEach(e=>e()),s}if(!r(n))return V.info("SB: Reusing a previous custom SegmentSink for the type",e),n;let i;if("text"===e){if(V.info("SB: Creating a new text SegmentSink"),null===this._textInterface)throw new Error("HTML Text track feature not activated");return i=new ti(this._textInterface),this._initializedSegmentSinks.text=i,i}throw V.error("SB: Unknown buffer type:",e),new ut("BUFFER_TYPE_UNKNOWN","The player wants to create a SegmentSink of an unknown type.")}disposeSegmentSink(e){const t=this._initializedSegmentSinks[e];r(t)?V.warn("SB: Trying to dispose a SegmentSink that does not exist"):(V.info("SB: Aborting SegmentSink",e),t.dispose(),delete this._initializedSegmentSinks[e])}disposeAll(){ni.forEach(e=>{"initialized"===this.getStatus(e).type&&this.disposeSegmentSink(e)})}_areNativeBuffersUsable(){const e=this.getNativeBufferTypes(),t=e.some(e=>void 0===this._initializedSegmentSinks[e]);if(t)return!1;const n=e.every(e=>null===this._initializedSegmentSinks[e]);return!n}createSegmentSinkMetricsForType(e){var t,n;return{bufferType:e,codec:null===(t=this._initializedSegmentSinks[e])||void 0===t?void 0:t.codec,segmentInventory:null===(n=this._initializedSegmentSinks[e])||void 0===n?void 0:n.getLastKnownInventory().map(e=>Object.assign(Object.assign({},e),{infos:si(e.infos)}))}}getSegmentSinksMetrics(){return{segmentSinks:{audio:this.createSegmentSinkMetricsForType("audio"),video:this.createSegmentSinkMetricsForType("video"),text:this.createSegmentSinkMetricsForType("text")}}}}function ri(e){return"audio"===e||"video"===e}function si(e){return{adaptation:e.adaptation.getMetadataSnapshot(),period:e.period.getMetadataSnapshot(),representation:e.representation.getMetadataSnapshot()}}var ai=ii;class oi{constructor(e){this._weakMap=new WeakMap,this._fn=e}get(e){const t=this._weakMap.get(e);if(void 0===t){const t=this._fn(e);return this._weakMap.set(e,t),t}return t}destroy(e){this._weakMap.delete(e)}}function li({segmentSink:e,playbackObserver:t,maxBufferBehind:n,maxBufferAhead:i},r){let s,a=[];function o(){null!==a&&ui(e,s,a,n.getValue(),i.getValue(),r).catch(e=>{const t=e instanceof Error?e.message:"Unknown error";V.error("Could not run BufferGarbageCollector:",t)})}t.listen(t=>{s=t.position.getWanted(),a=t.buffered[e.bufferType],o()},{includeLastObservation:!0,clearSignal:r}),n.onUpdate(o,{clearSignal:r}),i.onUpdate(o,{clearSignal:r}),o()}async function ui(e,t,n,i,s,a){if(!isFinite(i)&&!isFinite(s))return Promise.resolve();const o=[],{innerRange:l,outerRanges:u}=te(n,t),c=()=>{if(isFinite(i)){for(const e of u)t-i>=e.end?o.push(e):t>=e.end&&t-i>e.start&&t-i<e.end&&o.push({start:e.start,end:t-i});r(l)||t-i>l.start&&o.push({start:l.start,end:t-i})}},d=()=>{if(isFinite(s)){for(const e of u)t+s<=e.start?o.push(e):t<=e.start&&t+s<e.end&&t+s>e.start&&o.push({start:t+s,end:e.end});r(l)||t+s<l.end&&o.push({start:t+s,end:l.end})}};c(),d();for(const r of o)if(r.start<r.end){if(V.debug("GC: cleaning range from SegmentSink",r.start,r.end),null!==a.cancellationError)throw a.cancellationError;await e.removeBuffer(r.start,r.end)}}class ci extends s{constructor(e,t,n,i){super(),this._content=e,this._currentCanceller=null,this._downloadQueue=t,this._initSegmentRequest=null,this._mediaSegmentRequest=null,this._segmentFetcher=n,this._initSegmentInfoRef=new de(void 0),this._mediaSegmentAwaitingInitMetadata=null,i||this._initSegmentInfoRef.setValue(null)}getRequestedInitSegment(){return null===this._initSegmentRequest?null:this._initSegmentRequest.segment}getRequestedMediaSegment(){return null===this._mediaSegmentRequest?null:this._mediaSegmentRequest.segment}start(){null===this._currentCanceller&&(this._currentCanceller=new me,this._downloadQueue.onUpdate(e=>{const{segmentQueue:t}=e;if(t.length>0&&t[0].segment.id===this._mediaSegmentAwaitingInitMetadata)return;const n=this._mediaSegmentRequest;if(0===t.length){if(null===n)return;return V.debug("Stream: no more media segment to request. Cancelling queue.",this._content.adaptation.type),void this._restartMediaSegmentDownloadingQueue()}if(null===n)return V.debug("Stream: Media segments now need to be requested. Starting queue.",this._content.adaptation.type,t.length),void this._restartMediaSegmentDownloadingQueue();{const e=t[0];return n.segment.id!==e.segment.id?(V.debug("Stream: Next media segment changed, cancelling previous",this._content.adaptation.type),void this._restartMediaSegmentDownloadingQueue()):void(n.priority!==e.priority&&(V.debug("Stream: Priority of next media segment changed, updating",this._content.adaptation.type,n.priority,e.priority),this._segmentFetcher.updatePriority(n.request,e.priority)))}},{emitCurrentValue:!0,clearSignal:this._currentCanceller.signal}),this._downloadQueue.onUpdate(e=>{var t;const n=this._initSegmentRequest;null===e.initSegment||null===n?(null===(t=e.initSegment)||void 0===t?void 0:t.segment.id)!==(null===n||void 0===n?void 0:n.segment.id)&&(null===e.initSegment&&V.debug("Stream: no more init segment to request. Cancelling queue.",this._content.adaptation.type),this._restartInitSegmentDownloadingQueue(e.initSegment)):e.initSegment.priority!==n.priority&&this._segmentFetcher.updatePriority(n.request,e.initSegment.priority)},{emitCurrentValue:!0,clearSignal:this._currentCanceller.signal}))}stop(){var e;null===(e=this._currentCanceller)||void 0===e||e.cancel(),this._currentCanceller=null}_restartMediaSegmentDownloadingQueue(){null!==this._mediaSegmentRequest&&this._mediaSegmentRequest.canceller.cancel();const{segmentQueue:e}=this._downloadQueue.getValue(),t=e[0],n=e=>{if(null!==this._currentCanceller&&this._currentCanceller.isUsed())return void(this._mediaSegmentRequest=null);if(void 0===e)return this._mediaSegmentRequest=null,void this.trigger("emptyQueue",null);const t=new me,i=null===this._currentCanceller?U:t.linkToSignal(this._currentCanceller.signal),{segment:r,priority:s}=e,a=R({segment:r},this._content);let o=!1,l=!1;t.signal.register(()=>{this._mediaSegmentRequest=null,o||(this._mediaSegmentAwaitingInitMetadata===r.id&&(this._mediaSegmentAwaitingInitMetadata=null),o=!0,l=!1)});const u=e=>{fe("media"===e.segmentType,"Should have loaded a media segment."),this.trigger("parsedMediaSegment",R({},e,{segment:r}))},c=()=>{const e=this._downloadQueue.getValue().segmentQueue;if(0===e.length)return o=!0,void this.trigger("emptyQueue",null);e[0].segment.id===r.id&&e.shift(),o=!0,n(e[0])},d=this._segmentFetcher.createRequest(a,s,{onRetry:e=>{this.trigger("requestRetry",{segment:r,error:e})},beforeInterrupted(){V.info("Stream: segment request interrupted temporarly.",r.id,r.time)},onChunk:e=>{const n=this._initSegmentInfoRef.getValue();void 0!==n?u(e(null!==n&&void 0!==n?n:void 0)):(l=!0,this._initSegmentInfoRef.waitUntilDefined(t=>{u(e(null!==t&&void 0!==t?t:void 0))},{clearSignal:t.signal}))},onAllChunksReceived:()=>{l?(this._mediaSegmentAwaitingInitMetadata=r.id,this._initSegmentInfoRef.waitUntilDefined(()=>{this._mediaSegmentAwaitingInitMetadata=null,l=!1,this.trigger("fullyLoadedSegment",r)},{clearSignal:t.signal})):this.trigger("fullyLoadedSegment",r)},beforeEnded:()=>{i(),this._mediaSegmentRequest=null,l?this._initSegmentInfoRef.waitUntilDefined(c,{clearSignal:t.signal}):c()}},t.signal);d.catch(e=>{i(),o||(o=!0,this.stop(),this.trigger("error",e))}),this._mediaSegmentRequest={segment:r,priority:s,request:d,canceller:t}};n(t)}_restartInitSegmentDownloadingQueue(e){if(null!==this._currentCanceller&&this._currentCanceller.isUsed())return;if(null!==this._initSegmentRequest&&this._initSegmentRequest.canceller.cancel(),null===e)return;const t=new me,n=null===this._currentCanceller?U:t.linkToSignal(this._currentCanceller.signal),{segment:i,priority:r}=e,s=R({segment:i},this._content);let a=!1;const o=this._segmentFetcher.createRequest(s,r,{onRetry:e=>{this.trigger("requestRetry",{segment:i,error:e})},beforeInterrupted:()=>{V.info("Stream: init segment request interrupted temporarly.",i.id)},beforeEnded:()=>{n(),this._initSegmentRequest=null,a=!0},onChunk:e=>{var t;const n=e(void 0);fe("init"===n.segmentType,"Should have loaded an init segment."),this.trigger("parsedInitSegment",R({},n,{segment:i})),"init"===n.segmentType&&this._initSegmentInfoRef.setValue(null!==(t=n.initTimescale)&&void 0!==t?t:null)},onAllChunksReceived:()=>{this.trigger("fullyLoadedSegment",i)}},t.signal);o.catch(e=>{n(),a||(a=!0,this.stop(),this.trigger("error",e))}),t.signal.register(()=>{this._initSegmentRequest=null,a||(a=!0)}),this._initSegmentRequest={segment:i,priority:r,request:o,canceller:t}}}function di(e,t,n,i,r){const{period:s,adaptation:a,representation:o}=e,l=hi(r,t);if(null===l){if(null===n){if(i&&void 0!==s.end&&t.end>=s.end)return{start:void 0,end:null};const e=o.index.checkDiscontinuity(t.start);if(null!==e)return{start:void 0,end:e}}return null}const u=r[l];if(void 0!==u.bufferedStart&&u.bufferedStart>t.start&&(null===n||u.infos.segment.end<=n)){const e=u.bufferedStart;return i||!1===o.index.awaitSegmentBetween(t.start,e)?(V.debug("RS: current discontinuity encountered",a.type,u.bufferedStart),{start:void 0,end:e}):null}const c=fi(r,t,l+1);if(null!==c){const e=r[c-1],t=r[c];if(null===n||t.infos.segment.end<=n){if(!i&&!1!==o.index.awaitSegmentBetween(e.infos.segment.end,t.infos.segment.time))return null;const n=e.bufferedEnd,r=t.bufferedStart;return V.debug("RS: future discontinuity encountered",a.type,n,r),{start:n,end:r}}}if(null===n){if(i&&void 0!==s.end){if(t.end<s.end)return null;const e=pi(r,s.end);if(null!==e){const t=r[e];if(void 0!==t.bufferedEnd&&t.bufferedEnd<s.end)return V.debug("RS: discontinuity encountered at the end of the current period",a.type,t.bufferedEnd,s.end),{start:t.bufferedEnd,end:null}}}if(void 0!==s.end&&t.end>=s.end)return null;for(let e=r.length-1;e>=0;e--){const n=r[e];if(void 0===n.bufferedStart)break;if(n.bufferedStart<t.end){if(void 0!==n.bufferedEnd&&n.bufferedEnd<t.end){const e=o.index.checkDiscontinuity(t.end);if(null!==e)return{start:n.bufferedEnd,end:e}}return null}}}return null}function hi(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(void 0===i.bufferedStart||void 0===i.bufferedEnd||i.bufferedStart>=t.end)return null;if(i.bufferedEnd>t.start)return n}return null}function fi(e,t,n){if(n<=0)return V.error("RS: Asked to check a discontinuity before the first chunk."),null;for(let i=n;i<e.length;i++){const n=e[i],r=e[i-1];if(void 0===n.bufferedStart||void 0===r.bufferedEnd||n.bufferedStart>=t.end)return null;if(n.bufferedStart-r.bufferedEnd>0)return i}return null}function pi(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(void 0===i.bufferedStart)return null;if(i.bufferedStart<t)return n}return null}function gi({bufferedSegments:e,content:t,currentPlaybackTime:n,fastSwitchThreshold:i,getBufferedHistory:r,neededRange:s,segmentsBeingPushed:a,maxBufferSize:o}){const{adaptation:l,representation:u}=t;let c=mi(e,a,o);const d=u.index.getSegments(s.start,s.end-s.start),h=e.filter(e=>!yi(e.infos,t,n,i)),f=Ei(h,s,r),{MINIMUM_SEGMENT_SIZE:p,MIN_BUFFER_AHEAD:g}=N.getCurrent();let m=!1;const v=Math.min(1/60,p);let y=!1;const b=[],_=d.filter(e=>{const o=R({segment:e},t);if(a.length>0){const e=a.some(e=>Sn(o,e));if(e)return!1}const{duration:d,time:h,end:_}=e;if(e.isInit)return!0;if(m)return b.push(e),!1;if(e.complete&&d<p)return!1;if(a.length>0){const e=a.some(e=>{if(e.period.id!==t.period.id||e.adaptation.id!==t.adaptation.id)return!1;const{segment:r}=e;if(r.time-v>h)return!1;if(r.complete){if(r.end+v<_)return!1}else if(Math.abs(h-r.time)>h)return!1;return!yi(e,o,n,i)});if(e)return!1}for(let n=0;n<f.length;n++){const e=f[n],i=e.infos.period.id===t.period.id;if(1===e.status&&i){const t=e.infos.segment;if(h-t.time>-v)if(t.complete){if(t.end-_>-v)return!1}else if(Math.abs(h-t.time)<v)return!1}}const T=d*t.representation.bitrate;if(c-T<0&&(y=!0,h>s.start+g))return m=!0,b.push(e),!1;const S=r(o);if(S.length>1){const t=S[S.length-1],n=S[S.length-2];if(null===t.buffered&&null===n.buffered)return V.warn("Stream: Segment GCed multiple times in a row, ignoring it.","If this happens a lot and lead to unpleasant experience, please  check your device's available memory. If it's low when this message is emitted, you might want to update the RxPlayer's settings (`maxBufferAhead`, `maxVideoBufferSize` etc.) so less memory is used by regular media data buffering."+l.type,u.id,e.time),!1}for(let t=0;t<f.length;t++){const e=f[t];if(e.end+v>h){const n=e.start>h+v||vi(f,t).end<_-v;return n&&(c-=T),n}}return c-=T,!0});return{segmentsToLoad:_,segmentsOnHold:b,isBufferFull:y}}function mi(e,t,n){let i=8e3*n;return i-=t.reduce((e,t)=>{const{bitrate:n}=t.representation,{duration:i}=t.segment;return e+n*i},0),e.reduce((e,t)=>{return void 0!==t.chunkSize?e-8*t.chunkSize:e},i)}function vi(e,t){let n=t+1;const{MINIMUM_SEGMENT_SIZE:i}=N.getCurrent(),r=Math.min(1/60,i);while(n<e.length-1&&e[n-1].end+r>e[n].start)n++;return n--,e[n]}function yi(e,t,n,i){const{CONTENT_REPLACEMENT_PADDING:r}=N.getCurrent();if(e.period.id!==t.period.id)return!1;const{segment:s}=e;return!(s.time<n+r)&&(e.adaptation.id!==t.adaptation.id||bi(e.representation,t.representation,i))}function bi(e,t,n){const i=e.bitrate,{BITRATE_REBUFFERING_RATIO:r}=N.getCurrent();if(void 0===n){const e=i*r;return t.bitrate>e}return i<n&&t.bitrate>i}function _i(e,t,n){const{MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:i}=N.getCurrent();return void 0!==e.bufferedStart&&(!(null!==t&&void 0!==t.bufferedEnd&&e.bufferedStart-t.bufferedEnd<.1)&&(n<e.bufferedStart&&e.bufferedStart-e.start>i&&(V.info("Stream: The start of the wanted segment has been garbage collected",e.start,e.bufferedStart),!0)))}function Ti(e,t,n){const{MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:i}=N.getCurrent();return void 0!==e.bufferedEnd&&(!(null!==t&&void 0!==t.bufferedStart&&t.bufferedStart-e.bufferedEnd<.1)&&(n>e.bufferedEnd&&e.end-e.bufferedEnd>i&&(V.info("Stream: The end of the wanted segment has been garbage collected",e.end,e.bufferedEnd),!0)))}function Si(e,t){var n,i;if(e.length<2)return!0;const r=e[e.length-1],s=null===(n=r.buffered)||void 0===n?void 0:n.start;if(void 0!==t&&void 0!==s&&t-s>.05)return!0;const a=e[e.length-2],o=null===(i=a.buffered)||void 0===i?void 0:i.start;return void 0===o||void 0===s||Math.abs(o-s)>.01}function wi(e,t){var n,i;if(e.length<2)return!0;const r=e[e.length-1],s=null===(n=r.buffered)||void 0===n?void 0:n.end;if(void 0!==t&&void 0!==s&&s-t>.05)return!0;const a=e[e.length-2],o=null===(i=a.buffered)||void 0===i?void 0:i.end;return void 0===o||void 0===s||Math.abs(o-s)>.01}function Ei(e,t,n){return e.filter((e,i,r)=>{const s=0===i?null:r[i-1],a=i>=r.length-1?null:r[i+1];let o=null;if(_i(e,s,t.start)){if(o=n(e.infos),Si(o,e.bufferedStart))return!1;V.debug("Stream: skipping segment gc-ed at the start",e.start,e.bufferedStart)}if(Ti(e,a,t.end)){if(o=null!==o&&void 0!==o?o:n(e.infos),wi(o,e.bufferedEnd))return!1;V.debug("Stream: skipping segment gc-ed at the end",e.end,e.bufferedEnd)}return!0})}function xi(e,t){const n=e-t,{SEGMENT_PRIORITIES_STEPS:i}=N.getCurrent();for(let r=0;r<i.length;r++)if(n<i[r])return r;return i.length}function ki(e,t,n,i,r,s,a){var o,l,u;const{representation:c}=e,d=null!==(l=null!==(o=n.getIsPaused())&&void 0!==o?o:n.getReference().getValue().paused.pending)&&void 0!==l?l:n.getReference().getValue().paused.last,h=null!==(u=n.getPlaybackRate())&&void 0!==u?u:n.getReference().getValue().speed;let f=t;(void 0===d||void 0===h||d||h<=0)&&(f-=.1);const p=Ai(e,f,r),g=c.index.shouldRefresh(p.start,p.end),m=a.getPendingOperations().filter(e=>e.type===Wn.SignalSegmentComplete).map(e=>e.value),v=a.getLastKnownInventory();let y=n.getCurrentTime();void 0===y&&(y=n.getReference().getValue().position.getWanted());const b=a.getSegmentHistory.bind(a),{segmentsToLoad:_,segmentsOnHold:T,isBufferFull:S}=gi({content:e,bufferedSegments:v,currentPlaybackTime:y,fastSwitchThreshold:i,getBufferedHistory:b,neededRange:p,segmentsBeingPushed:m,maxBufferSize:s}),w=_.map(e=>({priority:xi(e.time,f),segment:e})),E=c.index.isInitialized()&&!c.index.isStillAwaitingFutureSegments()&&p.hasReachedPeriodEnd&&0===w.length&&0===T.length;let x=null;m.length>0&&(x=Math.min(...m.map(e=>e.segment.time))),T.length>0&&(x=null!==x?Math.min(x,T[0].time):T[0].time),w.length>0&&(x=null!==x?Math.min(x,w[0].segment.time):w[0].segment.time);const k=di(e,p,x,E,v);return{imminentDiscontinuity:k,hasFinishedLoading:E,neededSegments:w,isBufferFull:S,shouldRefreshManifest:g}}function Ai(e,t,n){var i;let s;const{manifest:a,period:o,representation:l}=e,u=l.index.getLastAvailablePosition(),c=l.index;s=!r(u)&&ai.isNative(e.adaptation.type)&&t>=u&&c.isInitialized()&&!c.isStillAwaitingFutureSegments()&&Ii(a,o,t)?u-1:t-.1;const d=s+n;let h;return h=!(!l.index.isInitialized()||l.index.isStillAwaitingFutureSegments()||void 0===o.end)&&(void 0===u?d>=o.end:null===u||d>=u),{start:Math.max(s,o.start),end:Math.min(d,null!==(i=o.end)&&void 0!==i?i:1/0),hasReachedPeriodEnd:h}}function Ii(e,t,n){var i;const r=e.getPeriodAfter(t);return t.containsTime(n,r)&&e.isLastPeriodKnown&&t.id===(null===(i=e.periods[e.periods.length-1])||void 0===i?void 0:i.id)}class Ci extends Error{constructor(e,t,n){super(t),Object.setPrototypeOf(this,Ci.prototype),this.name="SourceBufferError",this.errorName=e,this.isBufferFull=n}serialize(){return{errorName:this.name,message:this.message,isBufferFull:this.isBufferFull}}toString(){return`${this.errorName}: ${this.message}`}}function Di(e){return new Promise(t=>{setTimeout(t,e)})}async function Ri(e,t,n,i,r){try{return await t.pushChunk(n)}catch(s){if(r.isCancelled()&&s instanceof ye)throw s;if(!(s instanceof Ci)||!s.isBufferFull){const e=s instanceof Error?s.toString():"An unknown error happened when pushing content";throw new ut("BUFFER_APPEND_ERROR",e,{tracks:[Lt(n.inventoryInfos.adaptation)]})}const{position:a}=e.getReference().getValue(),o=a.getWanted();try{V.warn("Stream: Running garbage collector");const e=Math.max(o-5,0),s=o+i.getValue()+12;if(await t.removeBuffer(0,e),await t.removeBuffer(s,Number.MAX_VALUE),await Di(200),null!==r.cancellationError)throw r.cancellationError;return await t.pushChunk(n)}catch(e){if(e instanceof ye)throw e;const t=e instanceof Error?e.toString():"Could not clean the buffer";throw new ut("BUFFER_FULL_ERROR",t,{tracks:[Lt(n.inventoryInfos.adaptation)]})}}}async function Mi({playbackObserver:e,content:t,initSegmentUniqueId:n,segment:i,segmentSink:r,bufferGoal:s},a){if(null!==a.cancellationError)throw a.cancellationError;const o=t.representation.getMimeTypeString(),l={initSegmentUniqueId:n,chunk:null,timestampOffset:0,appendWindow:[void 0,void 0],codec:o},u=R({segment:i,chunkSize:void 0,start:0,end:0},t),c=await Ri(e,r,{data:l,inventoryInfos:u},s,a);return{content:t,segment:i,buffered:c}}async function Li({playbackObserver:e,bufferGoal:t,content:n,initSegmentUniqueId:i,parsedSegment:r,segment:s,segmentSink:a},o){var l,u;if(null===r.chunkData)return null;if(null!==o.cancellationError)throw o.cancellationError;const{chunkData:c,chunkInfos:d,chunkOffset:h,chunkSize:f,appendWindow:p}=r,g=n.representation.getMimeTypeString(),{APPEND_WINDOW_SECURITIES:m}=N.getCurrent(),v=[void 0!==p[0]?Math.max(0,p[0]-m.START):void 0,void 0!==p[1]?p[1]+m.END:void 0],y={initSegmentUniqueId:i,chunk:c,timestampOffset:h,appendWindow:v,codec:g};let b=null!==(l=null===d||void 0===d?void 0:d.time)&&void 0!==l?l:s.time;const _=null!==(u=null===d||void 0===d?void 0:d.duration)&&void 0!==u?u:s.duration;let T=b+_;void 0!==v[0]&&(b=Math.max(b,v[0])),void 0!==v[1]&&(T=Math.min(T,v[1]));const S=R({segment:s,chunkSize:f,start:b,end:T},n),w=await Ri(e,a,{data:y,inventoryInfos:S},t,o);return{content:n,segment:s,buffered:w}}function Pi({content:e,options:t,playbackObserver:n,segmentSink:i,segmentFetcher:r,terminate:s},a,o){const{period:l,adaptation:u,representation:c}=e,{bufferGoal:d,maxBufferSize:h,drmSystemId:f,fastSwitchThreshold:p}=t,g=u.type,m=new me;m.linkToSignal(o);const v=new me;v.linkToSignal(m.signal);const y={segment:c.index.getInitSegment(),uniqueId:null,isLoaded:!1};m.signal.register(()=>{null!==y.uniqueId&&i.freeInitSegment(y.uniqueId)});const b=new de({initSegment:null,segmentQueue:[]},v.signal),_=null!==y.segment;_||(y.isLoaded=!0);let T=!1;if(void 0!==f){const t=c.getEncryptionData(f);if(t.length>0&&t.every(e=>void 0!==e.keyIds)&&(T=!0,a.encryptionDataEncountered(t.map(t=>R({content:e},t))),m.isUsed()))return}const S=new ci(e,b,r,_);return S.addEventListener("error",e=>{v.signal.isCancelled()||(m.cancel(),a.error(e))}),S.addEventListener("parsedInitSegment",E),S.addEventListener("parsedMediaSegment",E),S.addEventListener("emptyQueue",w),S.addEventListener("requestRetry",e=>{if(a.warning(e.error),v.signal.isCancelled())return;const t=e.segment,{index:n}=c;!1===n.isSegmentStillAvailable(t)?w():n.canBeOutOfSyncError(e.error,t)&&a.manifestMightBeOufOfSync()}),S.addEventListener("fullyLoadedSegment",t=>{i.signalSegmentComplete(R({segment:t},e)).catch(x)}),S.start(),v.signal.register(()=>{S.removeEventListener(),S.stop()}),n.listen(w,{includeLastObservation:!1,clearSignal:v.signal}),e.manifest.addEventListener("manifestUpdate",w,v.signal),d.onUpdate(w,{emitCurrentValue:!1,clearSignal:v.signal}),h.onUpdate(w,{emitCurrentValue:!1,clearSignal:v.signal}),s.onUpdate(w,{emitCurrentValue:!1,clearSignal:v.signal}),void w();function w(){if(v.isUsed())return;const t=n.getReference().getValue(),r=t.position.getWanted(),o=ki(e,r,n,p.getValue(),d.getValue(),h.getValue(),i),{neededSegments:u}=o;let f=null;if(c.index.isInitialized()){if(u.length>0&&!y.isLoaded&&null!==y.segment){const e=u[0].priority;f={segment:y.segment,priority:e}}}else if(null===y.segment)V.warn("Stream: Uninitialized index without an initialization segment");else if(y.isLoaded)V.warn("Stream: Uninitialized index with an already loaded initialization segment");else{const e=t.position.getWanted();f={segment:y.segment,priority:xi(l.start,e)}}const m=s.getValue();if(null===m)b.setValue({initSegment:f,segmentQueue:u});else{if(m.urgent)return V.debug("Stream: Urgent switch, terminate now.",g),b.setValue({initSegment:null,segmentQueue:[]}),b.finish(),v.cancel(),void a.terminating();{const e=u[0],t=S.getRequestedInitSegment(),n=S.getRequestedMediaSegment(),i=null===n||void 0===e||n.id!==e.segment.id?[]:[e],r=null===t?null:f;if(b.setValue({initSegment:r,segmentQueue:i}),0===i.length&&null===r)return V.debug("Stream: No request left, terminate",g),b.finish(),v.cancel(),void a.terminating()}}if(a.streamStatusUpdate({period:l,position:t.position.getWanted(),bufferType:g,imminentDiscontinuity:o.imminentDiscontinuity,isEmptyStream:!1,hasFinishedLoading:o.hasFinishedLoading,neededSegments:o.neededSegments}),v.signal.isCancelled())return;const{UPTO_CURRENT_POSITION_CLEANUP:_}=N.getCurrent();if(o.isBufferFull){const e=Math.max(0,r-_);e>0&&i.removeBuffer(0,e).catch(x)}o.shouldRefreshManifest&&a.needsManifestRefresh()}function E(t){if(!m.isUsed()){for(const e of t.protectionData)c.addProtectionData(e.initDataType,e.keyId,e.initData);if(!T){const t=c.getAllEncryptionData();if(t.length>0&&(a.encryptionDataEncountered(t.map(t=>R({content:e},t))),T=!0,m.isUsed()))return}if("init"!==t.segmentType){const{inbandEvents:r,predictedSegments:s,needsManifestRefresh:o}=t;if(void 0!==s&&c.index.addPredictedSegments(s,t.segment),!0===o&&(a.needsManifestRefresh(),m.isUsed()))return;if(void 0!==r&&r.length>0&&(a.inbandEvent(r),m.isUsed()))return;const l=y.uniqueId;Li({playbackObserver:n,bufferGoal:d,content:e,initSegmentUniqueId:l,parsedSegment:t,segment:t.segment,segmentSink:i},m.signal).then(e=>{null!==e&&a.addedSegment(e)}).catch(x)}else{if(c.index.isInitialized()||void 0===t.segmentList||c.index.initialize(t.segmentList),y.isLoaded=!0,null!==t.initializationData){const r=c.uniqueId;y.uniqueId=r,i.declareInitSegment(r,t.initializationData),Mi({playbackObserver:n,bufferGoal:d,content:e,initSegmentUniqueId:r,segment:t.segment,segmentData:t.initializationData,segmentSink:i},m.signal).then(e=>{null!==e&&a.addedSegment(e)}).catch(x)}w()}}}function x(e){m.isUsed()&&e instanceof ye||(m.cancel(),a.error(e))}}var Oi=Pi;function Ni(e,t){for(let n=0;n<e.length;n++)if(e[n].infos.period.start>=t.start)return n>0?e[n-1]:null;return e.length>0?e[e.length-1]:null}function Ui(e,t){for(const n of e)if(n.infos.period.start>t.start)return n;return null}function Fi(e,t,n,i,r){var s,a,o,l;if("lazy"===n.switchingMode)return{type:"continue",value:void 0};const u=i.getLastKnownInventory(),c=[];for(const m of u)m.infos.period.id!==e.id||m.infos.adaptation.id===t.id&&gt(n.representationIds,m.infos.representation.id)||re(c,{start:null!==(s=m.bufferedStart)&&void 0!==s?s:m.start,end:null!==(a=m.bufferedEnd)&&void 0!==a?a:m.end});const d=i.getPendingOperations();for(const m of d)if(m.type===Wn.Push){const i=m.value.inventoryInfos;if(i.period.id===e.id&&(i.adaptation.id!==t.id||!gt(n.representationIds,i.representation.id))){const e=i.segment.time,t=e+i.segment.duration;re(c,{start:e,end:t})}}if(0===c.length)return{type:"continue",value:void 0};if("reload"===n.switchingMode){const e=r.getReadyState();if(void 0===e||e>1)return{type:"needs-reload",value:void 0}}const h="direct"===n.switchingMode,f=[],p=Ni(u,e);if(null!==p&&(void 0===p.bufferedEnd||e.start-p.bufferedEnd<1)&&f.push({start:0,end:e.start+1}),!h){const{ADAP_REP_SWITCH_BUFFER_PADDINGS:e}=N.getCurrent(),n=t.type,i=null!==(o=e[n].before)&&void 0!==o?o:0,s=null!==(l=e[n].after)&&void 0!==l?l:0;let a=r.getCurrentTime();if(void 0===a){const e=r.getReference().getValue();a=e.position.getPolled()}f.push({start:a-i,end:a+s})}if(void 0!==e.end){const t=Ui(u,e);null!==t&&(void 0===t.bufferedStart||t.bufferedStart-e.end<1)&&f.push({start:e.end-1,end:Number.MAX_VALUE})}const g=oe(c,f);return 0===g.length?{type:"continue",value:void 0}:h?{type:"flush-buffer",value:g}:{type:"clean-buffer",value:g}}function Bi({playbackObserver:e,content:t,options:n,representationEstimator:i,segmentSink:r,segmentFetcherCreator:s,wantedBufferAhead:a,maxVideoBufferSize:o},u,c){const{manifest:d,period:h,adaptation:f}=t,p=new me;p.linkToSignal(c);const g=new Map,m=new de(null,p.signal);let v;const y=t.representations.getValue().representationIds,b=t.adaptation.representations.filter(e=>gt(y,e.id)&&!1!==e.decipherable&&!1!==e.isSupported),_=new de(b,p.signal),{estimates:T,callbacks:S}=i({manifest:d,period:h,adaptation:f},m,_,e,p.signal),w=s.createSegmentFetcher(f.type,{onRequestBegin:S.requestBegin,onRequestEnd:S.requestEnd,onProgress:S.requestProgress,onMetrics:S.metrics}),E=new de(0);let x;return T.onUpdate(({bitrate:e,knownStableBitrate:t})=>{n.enableFastSwitching&&E.setValueIfChanged(t),void 0!==e&&e!==v&&(v=e,V.debug(`Stream: new ${f.type} bitrate estimate`,e),u.bitrateEstimateChange({type:f.type,bitrate:e}))},{emitCurrentValue:!0,clearSignal:p.signal}),void t.representations.onUpdate(e=>{void 0!==x&&x.cancel();const n=t.representations.getValue().representationIds,i=t.adaptation.representations.filter(e=>gt(n,e.id));_.setValueIfChanged(i),x=new me,x.linkToSignal(p.signal),k(e,x.signal).catch(e=>{!0===(null===x||void 0===x?void 0:x.isUsed())&&me.isCancellationError(e)||(p.cancel(),u.error(e))})},{clearSignal:p.signal,emitCurrentValue:!0});async function k(t,n){const i=Fi(h,f,t,r,e);switch(i.type){case"continue":break;case"needs-reload":return l(()=>{e.listen(()=>{if(n.isCancelled())return;const{DELTA_POSITION_AFTER_RELOAD:e}=N.getCurrent(),t=e.bitrateSwitch;return u.waitingMediaSourceReload({bufferType:f.type,period:h,timeOffset:t,stayInPeriod:!0})},{includeLastObservation:!0,clearSignal:n})});case"flush-buffer":case"clean-buffer":for(const e of i.value)if(await r.removeBuffer(e.start,e.end),n.isCancelled())return;if("flush-buffer"===i.type&&(u.needsBufferFlush(),n.isCancelled()))return;break;default:ge(i)}A(n)}function A(e){const t=new me;t.linkToSignal(e);const{representation:n}=T.getValue();if(null===n)return;const i=new de(null,t.signal);T.onUpdate(e=>{if(null!==e.representation&&e.representation.id!==n.id)return e.urgent?(V.info("Stream: urgent Representation switch",f.type),i.setValue({urgent:!0})):(V.info("Stream: slow Representation switch",f.type),i.setValue({urgent:!1}))},{clearSignal:t.signal,emitCurrentValue:!0});const r={type:f.type,adaptation:f,period:h,representation:n};if(m.setValue(n),p.isUsed())return;if(u.representationChange(r),p.isUsed())return;const s={streamStatusUpdate:u.streamStatusUpdate,encryptionDataEncountered:u.encryptionDataEncountered,manifestMightBeOufOfSync:u.manifestMightBeOufOfSync,needsManifestRefresh:u.needsManifestRefresh,inbandEvent:u.inbandEvent,warning:u.warning,error(e){p.cancel(),u.error(e)},addedSegment(e){S.addedSegment(e)},terminating(){if(!t.isUsed())return t.cancel(),A(e)}};I(n,i,s,e)}function I(t,i,s,l){const c=new me;c.linkToSignal(l);const m=ce(a,e=>{return e*C(t)},c.signal),v="video"===f.type?o:new de(1/0);V.info("Stream: changing representation",f.type,t.id,t.bitrate);const y=R({},s,{error(e){var n;const r=ft(e,{defaultCode:"NONE",defaultReason:"Unknown `RepresentationStream` error"});if("BUFFER_FULL_ERROR"!==r.code)s.error(e);else{const e=a.getValue(),o=null!==(n=g.get(t.id))&&void 0!==n?n:1,u=.7*o;if(u<=.05||e*u<=2)throw r;g.set(t.id,u),cn(4e3,p.signal).then(()=>{return I(t,i,s,l)}).catch(U)}},terminating(){c.cancel(),s.terminating()}});Oi({playbackObserver:e,content:{representation:t,adaptation:f,period:h,manifest:d},segmentSink:r,segmentFetcher:w,terminate:i,options:{bufferGoal:m,maxBufferSize:v,drmSystemId:n.drmSystemId,fastSwitchThreshold:E}},y,l),d.addEventListener("manifestUpdate",e=>{for(const n of e.updatedPeriods)if(n.period.id===h.id){for(const e of n.result.updatedAdaptations)if(e.adaptation===f.id)for(const n of e.removedRepresentations)if(n===t.id){if(l.isCancelled())return;return u.waitingMediaSourceReload({bufferType:f.type,period:h,timeOffset:0,stayInPeriod:!0})}}else if(n.period.start>h.start)break},l)}function C(e){const t=g.get(e.id),n=void 0!==t?t:1;return void 0===t&&g.set(e.id,n),n}}var ji=Bi;function Vi(e,t,n){if("function"===typeof String.prototype.startsWith)return e.startsWith(t,n);const i="number"===typeof n?Math.max(n,0):0;return e.substring(i,i+t.length)===t}function Hi(e,t){const[n,...i]=e.split(";"),[r,...s]=t.split(";");if(n!==r)return!1;const a=De(i,e=>Vi(e,"codecs=")),o=De(s,e=>Vi(e,"codecs="));if(void 0===a||void 0===o)return!1;const l=a.substring(7),u=o.substring(7);return l.split(".")[0]===u.split(".")[0]}var $i=Hi;function Gi(e,t,n,i,r,s){var a,o,l,u;if(void 0!==e.codec&&"reload"===s.onCodecSwitch&&!zi(n,e.codec))return{type:"needs-reload",value:void 0};const c=e.getLastKnownInventory(),d=[];for(const v of c)v.infos.period.id===t.id&&v.infos.adaptation.id!==n.id&&re(d,{start:null!==(a=v.bufferedStart)&&void 0!==a?a:v.start,end:null!==(o=v.bufferedEnd)&&void 0!==o?o:v.end});const h=e.getPendingOperations();for(const v of h)if(v.type===Wn.Push){const e=v.value.inventoryInfos;if(e.period.id===t.id&&e.adaptation.id!==n.id){const t=e.segment.time,n=t+e.segment.duration;re(d,{start:t,end:n})}}if(0===d.length)return{type:"continue",value:void 0};if("reload"===i){const e=r.getReadyState();if(void 0===e||e>1)return{type:"needs-reload",value:void 0}}const f="direct"===i,p=[],g=Ni(c,t);if(null!==g&&(void 0===g.bufferedEnd||t.start-g.bufferedEnd<1)&&p.push({start:0,end:t.start+1}),!f){const e=n.type,{ADAP_REP_SWITCH_BUFFER_PADDINGS:t}=N.getCurrent(),i=null!==(l=t[e].before)&&void 0!==l?l:0,s=null!==(u=t[e].after)&&void 0!==u?u:0;let a=r.getCurrentTime();if(void 0===a){const e=r.getReference().getValue();a=e.position.getPolled()}p.push({start:a-i,end:a+s})}if(void 0!==t.end){const e=Ui(c,t);null!==e&&(void 0===e.bufferedStart||e.bufferedStart-t.end<1)&&p.push({start:t.end-1,end:Number.MAX_VALUE})}const m=oe(d,p);return 0===m.length?{type:"continue",value:void 0}:f&&"text"!==n.type?{type:"flush-buffer",value:m}:{type:"clean-buffer",value:m}}function zi(e,t){return e.representations.some(e=>!0===e.isSupported&&!1!==e.decipherable&&$i(e.getMimeTypeString(),t))}function qi({bufferType:e,content:t,garbageCollectors:n,playbackObserver:i,representationEstimator:r,segmentFetcherCreator:s,segmentSinksStore:a,options:o,wantedBufferAhead:u,maxVideoBufferSize:c},d,h){const{manifest:f,period:p}=t,g=new de(void 0,h);if(d.periodStreamReady({type:e,manifest:f,period:p,adaptationRef:g}),h.isCancelled())return;let m,v=!0;function y(t,n,l,h){const g=Yi(i,t.type);function m(t){if(!ai.isNative(e)){V.error(`Stream: ${e} Stream crashed. Aborting it.`,t instanceof Error?t:""),a.disposeSegmentSink(e);const n=ft(t,{defaultCode:"NONE",defaultReason:"Unknown `AdaptationStream` error"});if(d.warning(n),h.isCancelled())return;return Xi(i,u,e,{period:p},d,h)}V.error(`Stream: ${e} Stream crashed. Stopping playback.`,t instanceof Error?t:""),d.error(t)}ji({content:{manifest:f,period:p,adaptation:t,representations:n},options:o,playbackObserver:g,representationEstimator:r,segmentSink:l,segmentFetcherCreator:s,wantedBufferAhead:u,maxVideoBufferSize:c},Object.assign(Object.assign({},d),{error:m}),h)}function b(t,n,r){l(()=>{i.listen(()=>{r.isCancelled()||d.waitingMediaSourceReload({bufferType:e,period:p,timeOffset:t,stayInPeriod:n})},{includeLastObservation:!0,clearSignal:r})})}g.onUpdate(t=>{(async()=>{var r;if(void 0===t)return;const s=new me;if(s.linkToSignal(h),null===m||void 0===m||m.cancel(),m=s,null===t){V.info(`Stream: Set no ${e} Adaptation. P:`,p.start);const t=a.getStatus(e);if("initialized"===t.type){if(V.info(`Stream: Clearing previous ${e} SegmentSink`),ai.isNative(e))return b(0,!0,s.signal);{const e=null!==(r=p.end)&&void 0!==r?r:1/0;if(p.start>e)V.warn("Stream: Can't free buffer: period's start is after its end");else if(await t.value.removeBuffer(p.start,e),s.isUsed())return}}else if("uninitialized"===t.type&&(a.disableSegmentSink(e),s.isUsed()))return;if(d.adaptationChange({type:e,adaptation:null,period:p}),s.isUsed())return;return Xi(i,u,e,{period:p},d,s.signal)}const l=p.adaptations[e],c=De(null!==l&&void 0!==l?l:[],e=>e.id===t.adaptationId);if(void 0===c)return m.cancel(),void V.warn("Stream: Unfound chosen Adaptation choice",t.adaptationId);const{DELTA_POSITION_AFTER_RELOAD:g}=N.getCurrent();let _,T=!1;if(v)_=0;else if(void 0!==t.relativeResumingPosition)_=t.relativeResumingPosition;else switch(T=!0,e){case"audio":_=g.trackSwitch.audio;break;case"video":_=g.trackSwitch.video;break;default:_=g.trackSwitch.other;break}if(v=!1,ai.isNative(e)&&"disabled"===a.getStatus(e).type)return b(_,!0,s.signal);f.addEventListener("manifestUpdate",e=>{for(const t of e.updatedPeriods)if(t.period.id===p.id){for(const e of t.result.removedAdaptations)if(e.id===c.id)return b(_,!0,s.signal)}else if(t.period.start>p.start)break},m.signal);const{representations:S}=t;if(V.info(`Stream: Updating ${e} adaptation`,`A: ${c.id}`,`P: ${p.start}`),d.adaptationChange({type:e,adaptation:c,period:p}),s.isUsed())return;const w=Wi(a,e,c),E=Gi(w,p,c,t.switchingMode,i,o);if("needs-reload"===E.type)return b(_,!0,s.signal);if(await a.waitForUsableBuffers(s.signal),!s.isUsed()){if("flush-buffer"===E.type||"clean-buffer"===E.type){for(const{start:e,end:t}of E.value)if(await w.removeBuffer(e,t),s.isUsed())return;if("flush-buffer"===E.type&&(d.needsBufferFlush({relativeResumingPosition:_,relativePosHasBeenDefaulted:T}),s.isUsed()))return}n.get(w)(s.signal),y(c,S,w,s.signal)}})().catch(e=>{e instanceof ye||(null===m||void 0===m||m.cancel(),d.error(e))})},{clearSignal:h,emitCurrentValue:!0})}function Wi(e,t,n){const i=e.getStatus(t);if("initialized"===i.type)return V.info("Stream: Reusing a previous SegmentSink for the type",t),i.value;const r=Ki(n);return e.createSegmentSink(t,r)}function Ki(e){const t=e.representations.filter(e=>{return!0===e.isSupported&&!1!==e.decipherable});if(0===t.length){const t=new ut("NO_PLAYABLE_REPRESENTATION","No Representation in the chosen "+e.type+" Adaptation can be played",{tracks:[Lt(e)]});throw t}return t[0].getMimeTypeString()}function Yi(e,t){return e.deriveReadOnlyObserver(function(e,n){const i=new de(r(),n);return e.onUpdate(s,{clearSignal:n,emitCurrentValue:!1}),i;function r(){const n=e.getValue(),i=n.buffered[t],r=null!==i?ie(i,n.position.getWanted()):0;return R({},n,{bufferGap:r,buffered:i})}function s(){i.setValue(r())}})}function Xi(e,t,n,i,r,s){const{period:a}=i;let o=!1;function l(){const i=e.getReference().getValue(),s=t.getValue(),l=i.position.getWanted();void 0!==a.end&&l+s>=a.end&&(V.debug('Stream: full "empty" AdaptationStream',n),o=!0),r.streamStatusUpdate({period:a,bufferType:n,imminentDiscontinuity:null,position:l,isEmptyStream:!0,hasFinishedLoading:o,neededSegments:[]})}t.onUpdate(l,{emitCurrentValue:!1,clearSignal:s}),e.listen(l,{includeLastObservation:!1,clearSignal:s}),l()}var Qi=qi;function Zi(e,t){if(0===t.length)return[];const n=[],i=e.getLastKnownInventory();for(let r=0;r<i.length;r++){const e=i[r],s=t.some(t=>{return e.infos.period.id===t.period.id&&e.infos.adaptation.id===t.adaptation.id&&e.infos.representation.id===t.representation.id});if(s){const{bufferedStart:t,bufferedEnd:i}=e;if(void 0===t||void 0===i)return V.warn("SO: No buffered start or end found from a segment."),[{start:0,end:Number.MAX_VALUE}];const r=n[n.length-1];void 0!==r&&r.end===t?r.end=i:n.push({start:t,end:i})}}return n}function Ji(e,t,n,i,s,a,o,u){const{manifest:c,initialPeriod:d}=e,{maxBufferAhead:h,maxBufferBehind:f,wantedBufferAhead:p,maxVideoBufferSize:g}=a,{MINIMUM_MAX_BUFFER_AHEAD:m,MAXIMUM_MAX_BUFFER_AHEAD:v,MAXIMUM_MAX_BUFFER_BEHIND:y}=N.getCurrent(),b=new oi(e=>{var n,i;const{bufferType:r}=e,s=null!==(n=y[r])&&void 0!==n?n:1/0,a=null!==(i=v[r])&&void 0!==i?i:1/0;return n=>{li({segmentSink:e,playbackObserver:t,maxBufferBehind:ce(f,e=>Math.min(e,s),n),maxBufferAhead:ce(h,e=>{var t;const n=Math.max(e,null!==(t=m[r])&&void 0!==t?t:0);return Math.min(n,a)},n)},n)}});for(const r of i.getBufferTypes())_(r,d);function _(e,n){const s=new Ln((e,t)=>e.start-t.start);let a=!1,d=new me;return d.linkToSignal(u),t.listen(({position:t})=>{var n;const i=t.getWanted();if(!a||!f(i))return;V.info("Stream: Destroying all PeriodStreams due to out of bounds situation",e,i),a=!1;while(s.length()>0){const t=s.get(s.length()-1);s.removeElement(t),o.periodStreamCleared({type:e,manifest:c,period:t})}d.cancel(),d=new me,d.linkToSignal(u);const r=null!==(n=c.getPeriodForTime(i))&&void 0!==n?n:c.getNextPeriod(i);if(void 0===r)return V.warn("Stream: The wanted position is not found in the Manifest."),void(a=!0);h(r)},{clearSignal:u,includeLastObservation:!0}),c.addEventListener("decipherabilityUpdate",e=>{u.isCancelled()||p(e).catch(e=>{u.isCancelled()||(d.cancel(),o.error(e))})},u),h(n);function h(t){const n=Object.assign(Object.assign({},o),{waitingMediaSourceReload(e){const t=s.head();void 0===t||t.id!==e.period.id?o.lockedStream({bufferType:e.bufferType,period:e.period}):o.needsMediaSourceReload({timeOffset:e.timeOffset,minimumPosition:e.stayInPeriod?e.period.start:void 0,maximumPosition:e.stayInPeriod?e.period.end:void 0})},periodStreamReady(e){a=!0,s.add(e.period),o.periodStreamReady(e)},periodStreamCleared(e){s.removeElement(e.period),o.periodStreamCleared(e)},error(e){d.cancel(),o.error(e)}});T(e,t,n,d.signal)}function f(e){const t=s.head(),n=s.last();return void 0===t||void 0===n||(t.start>e||(r(n.end)?1/0:n.end)<e)}async function p(n){const r=i.getStatus(e),f=n.filter(t=>t.adaptation.type===e);if(0===f.length||"initialized"!==r.type||f.every(e=>!0===e.representation.decipherable))return;const p=r.value,g=f.filter(e=>void 0===e.representation.decipherable),m=f.filter(e=>!1===e.representation.decipherable),v=Zi(p,m),y=Zi(p,g);a=!1,V.info("Stream: Destroying all PeriodStreams for decipherability matters",e);while(s.length()>0){const t=s.get(s.length()-1);s.removeElement(t),o.periodStreamCleared({type:e,manifest:c,period:t})}d.cancel(),d=new me,d.linkToSignal(u);for(const{start:e,end:t}of[...v,...y]){if(u.isCancelled())return;if(e<t){if(u.isCancelled())return;await p.removeBuffer(e,t)}}l(()=>{if(u.isCancelled())return;const e=t.getReference().getValue();if(er(e,v)){if(o.needsDecipherabilityFlush(),u.isCancelled())return}else if(er(e,y)&&(o.needsBufferFlush(),u.isCancelled()))return;const n=e.position.getWanted(),i=c.getPeriodForTime(n);void 0!==i?h(i):o.error(new ut("MEDIA_TIME_NOT_FOUND","The wanted position is not found in the Manifest."))})}}function T(e,r,u,d){V.info("Stream: Creating new Stream for",e,r.start);let h=null;const f=new me;f.linkToSignal(d),t.listen(({position:t},n)=>{if(void 0!==r.end&&t.getWanted()>=r.end){const i=c.getPeriodAfter(r);if(r.containsTime(t.getWanted(),i))return;V.info("Stream: Destroying PeriodStream as the current playhead moved above it",e,r.start,t.getWanted(),r.end),n(),u.periodStreamCleared({type:e,manifest:c,period:r}),f.cancel()}},{clearSignal:d,includeLastObservation:!0});const m={bufferType:e,content:{manifest:c,period:r},garbageCollectors:b,maxVideoBufferSize:g,segmentFetcherCreator:s,segmentSinksStore:i,options:a,playbackObserver:t,representationEstimator:n,wantedBufferAhead:p},v=Object.assign(Object.assign({},u),{streamStatusUpdate(t){if(t.hasFinishedLoading){const e=c.getPeriodAfter(r);null!==e&&y(e)}else null!==h&&(V.info("Stream: Destroying next PeriodStream due to current one being active",e,h.period.start),u.periodStreamCleared({type:e,manifest:c,period:h.period}),h.canceller.cancel(),h=null);u.streamStatusUpdate(t)},error(e){null!==h&&(h.canceller.cancel(),h=null),f.cancel(),u.error(e)}});function y(t){if(null!==h){if(h.period.id===t.id)return;V.warn("Stream: Creating next `PeriodStream` while one was already created.",e,t.id,h.period.id),u.periodStreamCleared({type:e,manifest:c,period:h.period}),h.canceller.cancel()}const n=new me;n.linkToSignal(d),h={canceller:n,period:t},T(e,t,u,h.canceller.signal)}function _(t){c.addEventListener("manifestUpdate",n=>{for(const e of n.removedPeriods)if(e.id===r.id){if(c.periods.length>0&&c.periods[0].start<=e.start)return l(()=>{if(!t.isCancelled())return o.needsMediaSourceReload({timeOffset:0,minimumPosition:void 0,maximumPosition:void 0})})}else if(e.start>r.start)break;if(n.addedPeriods.length>0&&null!==h){const t=c.getPeriodAfter(r);null!==t&&h.period.id===t.id||(V.warn("Stream: Destroying next PeriodStream due to new one being added",e,h.period.start),u.periodStreamCleared({type:e,manifest:c,period:h.period}),h.canceller.cancel(),h=null)}},t)}Qi(m,v,f.signal),_(f.signal)}}function er(e,t){if(0===t.length)return!1;const n=e.position.getPolled();return e.speed>=0?t[t.length-1].end>=n-5:t[0].start<=n+5}var tr=Ji,nr=tr;const ir={createSync(e){return{syncValue:e,getValueAsAsync(){return Promise.resolve(e)}}},createAsync(e){let t=null;return e.then(e=>{t=e},U),{syncValue:t,getValueAsAsync(){return e}}}};var rr=ir;const sr=new WeakMap;var ar={setState(e,t){sr.set(e,t)},getState(e){const t=sr.get(e);return void 0===t?null:t},clearState(e){sr.set(e,null)}};function or(e){const t=ar.getState(e);return null===t?null:[t.mediaKeySystemAccess.keySystem,t.mediaKeySystemAccess.getConfiguration()]}class lr extends s{}function ur(e,t){const n={audio:null,video:null,text:null};if(null!==t&&(n.text=t.getBufferedRanges()),null===e)return n;const i=De(e.sourceBuffers,e=>"audio"===e.type),r=De(e.sourceBuffers,e=>"video"===e.type),s=null===i||void 0===i?void 0:i.getBuffered();void 0!==s&&(n.audio=s);const a=null===r||void 0===r?void 0:r.getBuffered();return void 0!==a&&(n.video=a),n}function cr(e,{autoPlay:t,initialPlayPerformed:n,manifest:i,mediaSource:r,speed:s,textDisplayer:a},o){return e.deriveReadOnlyObserver(function(e,l){const u=new me;u.linkToSignal(l),u.linkToSignal(o);const c=new de(d(),u.signal);return s.onUpdate(h,{clearSignal:u.signal,emitCurrentValue:!1}),e.onUpdate(h,{clearSignal:u.signal,emitCurrentValue:!1}),c;function d(){const o=e.getValue(),l=s.getValue();return dr(o,i),{maximumPosition:St(i),bufferGap:o.bufferGap,position:o.position,buffered:ur(r,a),duration:o.duration,rebuffering:o.rebuffering,freezing:o.freezing,paused:{last:o.paused,pending:hr(n,t)},readyState:o.readyState,speed:l}}function h(){c.setValue(d())}})}function dr(e,t){if(!t.isDynamic||t.isLastPeriodKnown){const n=t.periods[t.periods.length-1];if(void 0!==n&&void 0!==n.end){const t=e.position.getWanted();if(t>=n.start&&t>=n.end-1){const t=e.buffered;(0===t.length||t.end(t.length-1)<e.duration-1)&&e.position.forceWantedPosition(n.end-1)}}}}function hr(e,t){return e.getValue()?void 0:!t}function fr(e){const{textTracks:t}=e;if(!r(t)){for(let e=0;e<t.length;e++)t[e].mode="disabled";if(e.hasChildNodes()){const{childNodes:t}=e;for(let n=t.length-1;n>=0;n--)if("track"===t[n].nodeName)try{e.removeChild(t[n])}catch(e){V.warn("Compat: Could not remove text track child from element.")}}}e.src="",e.removeAttribute("src")}const pr=a["a"],gr=void 0===pr?void 0:r(pr.MediaSource)?r(pr.MozMediaSource)?r(pr.WebKitMediaSource)?pr.MSMediaSource:pr.WebKitMediaSource:pr.MozMediaSource:pr.MediaSource;function mr(e,t){if("function"===typeof e.changeType){try{e.changeType(t)}catch(e){return V.warn("Could not call 'changeType' on the given SourceBuffer:",e instanceof Error?e:""),!1}return!0}return!1}const vr=["","webkit","moz","ms"];function yr(e,t){const n=document.createElement(e.tagName),i="on"+t;return i in n||(n.setAttribute(i,"return;"),"function"===typeof n[i])}function br(e,t){return t.filter(t=>yr(e,t))[0]}function _r(e,t){return e.reduce((e,n)=>e.concat((void 0===t?vr:t).map(e=>e+n)),[])}function Tr(e,t){let n;const i=_r(e,t);return(e,t,r)=>{if(!r.isCancelled()){if("undefined"!==typeof HTMLElement&&e instanceof HTMLElement){if("undefined"===typeof n&&(n=br(e,i)),!Ot(n))return void 0;e.addEventListener(n,t),r.register(()=>{void 0!==n&&e.removeEventListener(n,t)})}i.forEach(n=>{let i=!1;"function"===typeof e.addEventListener?e.addEventListener(n,t):(i=!0,e["on"+n]=t),r.register(()=>{"function"===typeof e.removeEventListener&&e.removeEventListener(n,t),i&&delete e["on"+n]})})}}}function Sr(e){let t;const n=document;r(n.hidden)?r(n.mozHidden)?r(n.msHidden)?r(n.webkitHidden)||(t="webkit"):t="ms":t="moz":t="";const i=Ot(t)?t+"Hidden":"hidden",s=Ot(t)?t+"visibilitychange":"visibilitychange",a=document[i],o=new de(!a,e);return Br(document,s,()=>{const e=!document[i];o.setValueIfChanged(e)},e),o}function wr(e,t){const n=e;if(!0===n.webkitSupportsPresentationMode&&"function"===typeof n.webkitSetPresentationMode){const e="picture-in-picture"===n.webkitPresentationMode,i=new de({isEnabled:e,pipWindow:null},t);return Br(n,"webkitpresentationmodechanged",()=>{const e="picture-in-picture"===n.webkitPresentationMode;i.setValue({isEnabled:e,pipWindow:null})},t),i}const i=document.pictureInPictureElement===n,r=new de({isEnabled:i,pipWindow:null},t);return Br(n,"enterpictureinpicture",e=>{var t;r.setValue({isEnabled:!0,pipWindow:null!==(t=e.pictureInPictureWindow)&&void 0!==t?t:null})},t),Br(n,"leavepictureinpicture",()=>{r.setValue({isEnabled:!1,pipWindow:null})},t),r}function Er(e,t){const n=Sr(t);let i;const r=new de(!0,t);return t.register(()=>{clearTimeout(i),i=void 0}),n.onUpdate(s,{clearSignal:t}),e.onUpdate(s,{clearSignal:t}),s(),r;function s(){if(clearTimeout(i),i=void 0,e.getValue().isEnabled||n.getValue())r.setValueIfChanged(!0);else{const{INACTIVITY_DELAY:e}=N.getCurrent();i=setTimeout(()=>{r.setValueIfChanged(!1)},e)}}}function xr(e){var t,n;const i=r(a["a"].devicePixelRatio)||0===a["a"].devicePixelRatio?1:a["a"].devicePixelRatio,s=new de({width:null===(t=a["a"].screen)||void 0===t?void 0:t.width,height:null===(n=a["a"].screen)||void 0===n?void 0:n.height,pixelRatio:i},e),o=setInterval(l,2e4);return e.register(function(){clearInterval(o)}),s;function l(){const e=s.getValue();e.width===screen.width&&e.height===screen.height&&e.pixelRatio===i||s.setValue({width:screen.width,height:screen.height,pixelRatio:i})}}function kr(e,t,n){const i=r(a["a"].devicePixelRatio)||0===a["a"].devicePixelRatio?1:a["a"].devicePixelRatio,s=new de({width:e.clientWidth,height:e.clientHeight,pixelRatio:i},n);let o=U;t.onUpdate(u,{clearSignal:n}),Br(a["a"],"resize",u,n),Br(e,"enterpictureinpicture",u,n),Br(e,"leavepictureinpicture",u,n);const l=setInterval(u,2e4);return u(),n.register(function(){o(),clearInterval(l)}),s;function u(){o();const n=t.getValue(),{pipWindow:a}=n;if(n.isEnabled)if(r(a)){const e=s.getValue();void 0===e.width&&void 0===e.height&&e.pixelRatio===i||s.setValue({width:void 0,height:void 0,pixelRatio:i})}else{const e=()=>{l()};a.addEventListener("resize",e),o=(()=>{a.removeEventListener("resize",e),o=U}),l()}else{const t=s.getValue();t.width===e.clientWidth&&t.height===e.clientHeight&&t.pixelRatio===i||s.setValue({width:e.clientWidth,height:e.clientHeight,pixelRatio:i})}function l(){const e=s.getValue();e.width===(null===a||void 0===a?void 0:a.width)&&e.height===(null===a||void 0===a?void 0:a.height)&&e.pixelRatio===i||s.setValue({width:null===a||void 0===a?void 0:a.width,height:null===a||void 0===a?void 0:a.height,pixelRatio:i})}}}Tr(["loadedmetadata"]),Tr(["timeupdate"]),Tr(["addtrack"]),Tr(["removetrack"]);const Ar=Tr(["sourceopen","webkitsourceopen"]),Ir=Tr(["sourceclose","webkitsourceclose"]),Cr=Tr(["sourceended","webkitsourceended"]),Dr=Tr(["update"]),Rr=Tr(["removesourcebuffer"]),Mr=Tr(["keymessage","message"]),Lr=Tr(["keyadded","ready"]),Pr=Tr(["keyerror","error"]),Or=Tr(["keystatuseschange"]),Nr=Tr(["seeking"]),Ur=Tr(["seeked"]),Fr=Tr(["ended"]);function Br(e,t,n,i){e.addEventListener(t,n),i.register(()=>{e.removeEventListener(t,n)})}function jr(...e){const t=e.length;let n,i=-1,r=0;while(++i<t)n=e[i],r+="number"===typeof n?n:n.length;const s=new Uint8Array(r);let a=0;i=-1;while(++i<t)n=e[i],"number"===typeof n?a+=n:n.length>0&&(s.set(n,a),a+=n.length);return s}function Vr(e,t){return(e[t+0]<<8)+(e[t+1]<<0)}function Hr(e,t){return 65536*e[t+0]+256*e[t+1]+e[t+2]}function $r(e,t){return 16777216*e[t+0]+65536*e[t+1]+256*e[t+2]+e[t+3]}function Gr(e,t){return 4294967296*(16777216*e[t+0]+65536*e[t+1]+256*e[t+2]+e[t+3])+16777216*e[t+4]+65536*e[t+5]+256*e[t+6]+e[t+7]}function zr(e){return new Uint8Array([e>>>8&255,255&e])}function qr(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}function Wr(e){const t=e%4294967296,n=(e-t)/4294967296;return new Uint8Array([n>>>24&255,n>>>16&255,n>>>8&255,255&n,t>>>24&255,t>>>16&255,t>>>8&255,255&t])}function Kr(e,t){return(e[t+0]<<0)+(e[t+1]<<8)}function Yr(e,t){return e[t+0]+256*e[t+1]+65536*e[t+2]+16777216*e[t+3]}function Xr(e){return new Uint8Array([255&e,e>>>8&255])}function Qr(e){return new Uint8Array([255&e,e>>>8&255,e>>>16&255,e>>>24&255])}function Zr(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];i.updating&&t.push(i)}return t}function Jr(e,t){if(V.debug("Init: Trying to call endOfStream"),"open"!==e.readyState)return void V.debug("Init: MediaSource not open, cancel endOfStream");const{sourceBuffers:n}=e,i=Zr(n);if(0===i.length){V.info("Init: Triggering end of stream");try{e.endOfStream()}catch(e){V.error("Unable to call endOfStream",e instanceof Error?e:new Error("Unknown error"))}return}V.debug("Init: Waiting SourceBuffers to be updated before calling endOfStream.");const r=new me;r.linkToSignal(t);for(const s of i)Dr(s,()=>{r.cancel(),Jr(e,t)},r.signal);Rr(n,()=>{r.cancel(),Jr(e,t)},r.signal)}function es(e,t){let n=new me;n.linkToSignal(t),Ar(e,()=>{V.debug("Init: MediaSource re-opened while end-of-stream is active"),n.cancel(),n=new me,n.linkToSignal(t),Jr(e,n.signal)},t),Jr(e,n.signal)}function ts(){return w}const ns=31536e3;class is{constructor(e){this._mediaSource=e,this._currentMediaSourceDurationUpdateCanceller=null}updateDuration(e,t){null!==this._currentMediaSourceDurationUpdateCanceller&&this._currentMediaSourceDurationUpdateCanceller.cancel(),this._currentMediaSourceDurationUpdateCanceller=new me;const n=this._mediaSource,i=this._currentMediaSourceDurationUpdateCanceller.signal,r=as(n,i);let s=new me;function a(){if(s.cancel(),!r.getValue())return;s=new me,s.linkToSignal(i);const a=ss(n.sourceBuffers,s.signal);let o=new me;return o.linkToSignal(s.signal),a.onUpdate(i=>{o.cancel(),o=new me,o.linkToSignal(s.signal),i||os(n,e,t,o.signal)},{clearSignal:s.signal,emitCurrentValue:!0})}s.linkToSignal(i),r.onUpdate(a,{emitCurrentValue:!0,clearSignal:i})}stopUpdating(){null!==this._currentMediaSourceDurationUpdateCanceller&&(this._currentMediaSourceDurationUpdateCanceller.cancel(),this._currentMediaSourceDurationUpdateCanceller=null)}}function rs(e,t,n){let i=t;n||(i=ts()?1/0:ls(t));let r=0;for(let s=0;s<e.sourceBuffers.length;s++){const t=e.sourceBuffers[s],n=t.buffered.length;n>0&&(r=Math.max(t.buffered.end(n-1)))}if(i===e.duration)return"success";if(r>i){if(r<e.duration)try{V.info("Init: Updating duration to what is currently buffered",r),e.duration=r}catch(e){return V.warn("Duration Updater: Can't update duration on the MediaSource.",e instanceof Error?e:""),"failed"}return"partial"}{const n=e.duration;try{if(V.info("Init: Updating duration",i),e.duration=i,"open"===e.readyState&&!isFinite(i)){const n=ls(t);V.info("Init: calling `mediaSource.setLiveSeekableRange`",n),e.setLiveSeekableRange(0,n)}}catch(e){return V.warn("Duration Updater: Can't update duration on the MediaSource.",e instanceof Error?e:""),"failed"}const r=Math.abs(e.duration-i);if(r>=.1){const t=Math.abs(e.duration-n);return r<t?"partial":"failed"}return"success"}}function ss(e,t){if(0===e.length){const e=new de(!1);return e.finish(),e}const n=new de(!1,t);i();for(let r=0;r<e.length;r++){const n=e[r];n.addEventListener("updatestart",i),n.addEventListener("update",i),t.register(()=>{n.removeEventListener("updatestart",i),n.removeEventListener("update",i)})}return n;function i(){for(let t=0;t<e.length;t++){const i=e[t];if(i.updating)return void n.setValueIfChanged(!0)}n.setValueIfChanged(!1)}}function as(e,t){const n=new de("open"===e.readyState,t);return Ar(e,()=>{V.debug("Init: Reacting to MediaSource open in duration updater"),n.setValueIfChanged(!0)},t),Cr(e,()=>{V.debug("Init: Reacting to MediaSource ended in duration updater"),n.setValueIfChanged(!1)},t),Ir(e,()=>{V.debug("Init: Reacting to MediaSource close in duration updater"),n.setValueIfChanged(!1)},t),n}function os(e,t,n,i){const r=rs(e,t,n);if("success"===r)return;const s=setTimeout(()=>{a(),os(e,t,n,i)},2e3),a=i.register(()=>{clearTimeout(s)})}function ls(e){return Math.max(Math.pow(2,32),e+ns)}class us extends s{constructor(e){if(super(),this.id=e,this.sourceBuffers=[],this._canceller=new me,r(gr))throw new ut("MEDIA_SOURCE_NOT_SUPPORTED","No MediaSource Object was found in the current browser.");V.info("Init: Creating MediaSource");const t=new gr;this.readyState=t.readyState;const n=t.handle;this.handle=r(n)?{type:"media-source",value:t}:{type:"handle",value:n},this._mediaSource=t,this._durationUpdater=new is(t),this._endOfStreamCanceller=null,Ar(t,()=>{this.readyState=t.readyState,this.trigger("mediaSourceOpen",null)},this._canceller.signal),Cr(t,()=>{this.readyState=t.readyState,this.trigger("mediaSourceEnded",null)},this._canceller.signal),Ir(t,()=>{this.readyState=t.readyState,this.trigger("mediaSourceClose",null)},this._canceller.signal)}addSourceBuffer(e,t){const n=this._mediaSource.addSourceBuffer(t),i=new cs(e,t,n);return this.sourceBuffers.push(i),i}setDuration(e,t){this._durationUpdater.updateDuration(e,t)}interruptDurationSetting(){this._durationUpdater.stopUpdating()}maintainEndOfStream(){null===this._endOfStreamCanceller&&(this._endOfStreamCanceller=new me,this._endOfStreamCanceller.linkToSignal(this._canceller.signal),V.debug("Init: end-of-stream order received."),es(this._mediaSource,this._endOfStreamCanceller.signal))}stopEndOfStream(){null!==this._endOfStreamCanceller&&(V.debug("Init: resume-stream order received."),this._endOfStreamCanceller.cancel(),this._endOfStreamCanceller=null)}dispose(){this.sourceBuffers.forEach(e=>e.dispose()),this._canceller.cancel(),ds(this._mediaSource)}}class cs{constructor(e,t,n){this.type=e,this.codec=t,this._canceller=new me,this._sourceBuffer=n,this._operationQueue=[],this._currentOperations=[];const i=e=>{let t;t=e instanceof Error?e:e.error instanceof Error?e.error:new Error("Unknown SourceBuffer Error");const n=this._currentOperations;if(this._currentOperations=[],0===n.length)V.error("SBI: error for an unknown operation",t);else{const e=new Ci(t.name,t.message,"QuotaExceededError"===t.name);for(const t of n)t.reject(e)}},r=()=>{const e=this._currentOperations;this._currentOperations=[];try{for(const t of e)t.resolve(Q(this._sourceBuffer.buffered))}catch(t){for(const n of e)t instanceof Error&&"InvalidStateError"===t.name?n.resolve([]):n.reject(t)}this._performNextOperation()};n.addEventListener("error",i),n.addEventListener("updateend",r),this._canceller.signal.register(()=>{n.removeEventListener("error",i),n.removeEventListener("updateend",r)})}appendBuffer(...e){return V.debug("SBI: receiving order to push data to the SourceBuffer",this.type),this._addToQueue({operationName:0,params:e})}remove(e,t){return V.debug("SBI: receiving order to remove data from the SourceBuffer",this.type,e,t),this._addToQueue({operationName:1,params:[e,t]})}getBuffered(){try{return Q(this._sourceBuffer.buffered)}catch(e){return V.error("Failed to get buffered time range of SourceBuffer",this.type,e instanceof Error?e:null),[]}}abort(){try{this._sourceBuffer.abort()}catch(e){V.debug("Init: Failed to abort SourceBuffer:",e instanceof Error?e:null)}this._emptyCurrentQueue()}dispose(){try{this._sourceBuffer.abort()}catch(e){}this._emptyCurrentQueue()}_emptyCurrentQueue(){const e=new ye;this._currentOperations.length>0&&(this._currentOperations.forEach(t=>{t.reject(e)}),this._currentOperations=[]),this._operationQueue.length>0&&(this._operationQueue.forEach(t=>{t.reject(e)}),this._operationQueue=[])}_addToQueue(e){return new Promise((t,n)=>{const i=0===this._operationQueue.length&&0===this._currentOperations.length,r=R({resolve:t,reject:n},e);this._operationQueue.push(r),i&&this._performNextOperation()})}_performNextOperation(){var e,t,n,i,r;if(0!==this._currentOperations.length||this._sourceBuffer.updating)return;const s=this._operationQueue.shift();if(void 0!==s)if(0===s.operationName){this._currentOperations=[{operationName:0,resolve:s.resolve,reject:s.reject}];const a=s.params[0],o=s.params[1];let l=a;if(this._operationQueue.length>0&&0===this._operationQueue[0].operationName){let s;s=a instanceof ArrayBuffer?new Uint8Array(a):a instanceof Uint8Array?a:new Uint8Array(a.buffer);const u=[s];while(0===(null===(e=this._operationQueue[0])||void 0===e?void 0:e.operationName)){const e=this._operationQueue[0],s=null!==(t=o.appendWindow)&&void 0!==t?t:[void 0,void 0],a=null!==(n=e.params[1].appendWindow)&&void 0!==n?n:[void 0,void 0],l=null!==(i=o.timestampOffset)&&void 0!==i?i:0,c=null!==(r=e.params[1].timestampOffset)&&void 0!==r?r:0;if(s[0]!==a[0]||s[1]!==a[1]||o.codec!==e.params[1].codec||l!==c)break;{const t=e.params[0];let n;n=t instanceof ArrayBuffer?new Uint8Array(t):t instanceof Uint8Array?t:new Uint8Array(t.buffer),u.push(n),this._operationQueue.splice(0,1),this._currentOperations.push({operationName:0,resolve:e.resolve,reject:e.reject})}}u.length>1&&(V.info(`MMSI: Merging ${u.length} segments together for perf`,this.type),l=jr(...u))}try{this._appendBufferNow(l,o)}catch(e){const t=e instanceof Error?new Ci(e.name,e.message,"QuotaExceededError"===e.name):new Ci("Error","Unknown SourceBuffer Error during appendBuffer",!1);this._currentOperations.forEach(e=>{e.reject(t)}),this._currentOperations=[]}}else{this._currentOperations=[s];const[e,t]=s.params;V.debug("SBI: removing data from SourceBuffer",this.type,e,t);try{this._sourceBuffer.remove(e,t)}catch(e){const t=e instanceof Error?new Ci(e.name,e.message,!1):new Ci("Error","Unknown SourceBuffer Error during remove",!1);s.reject(t),this._currentOperations=[]}}}_appendBufferNow(e,t){const n=this._sourceBuffer,{codec:i,timestampOffset:r,appendWindow:s=[]}=t;if(void 0!==i&&i!==this.codec){V.debug("SBI: updating codec",i);const e=mr(n,i);e?this.codec=i:V.debug("SBI: could not update codec",i,this.codec)}if(void 0!==r&&n.timestampOffset!==r){const e=r;V.debug("SBI: updating timestampOffset",i,n.timestampOffset,e),n.timestampOffset=e}if(void 0===s[0])n.appendWindowStart>0&&(V.debug("SBI: re-setting `appendWindowStart` to `0`"),n.appendWindowStart=0);else if(s[0]!==n.appendWindowStart){if(s[0]>=n.appendWindowEnd){const e=s[0]+1;V.debug("SBI: pre-updating `appendWindowEnd`",e),n.appendWindowEnd=e}V.debug("SBI: setting `appendWindowStart`",s[0]),n.appendWindowStart=s[0]}void 0===s[1]?n.appendWindowEnd!==1/0&&(V.debug("SBI: re-setting `appendWindowEnd` to `Infinity`"),n.appendWindowEnd=1/0):s[1]!==n.appendWindowEnd&&(V.debug("SBI: setting `appendWindowEnd`",s[1]),n.appendWindowEnd=s[1]),V.debug("SBI: pushing segment",this.type),n.appendBuffer(e)}}function ds(e){if("closed"!==e.readyState){const{readyState:t,sourceBuffers:n}=e;for(let i=n.length-1;i>=0;i--){const r=n[i];try{if("open"===t){V.info("Init: Aborting SourceBuffer before removing");try{r.abort()}catch(e){}}V.info("Init: Removing SourceBuffer from mediaSource"),e.removeSourceBuffer(r)}catch(e){}}n.length>0&&V.info("Init: Not all SourceBuffers could have been removed.")}}const hs=pt();function fs(e,t){if(null!==t&&e.src===t&&(V.info("Init: Clearing HTMLMediaElement's src"),fr(e)),null!==t)try{V.debug("Init: Revoking previous URL"),URL.revokeObjectURL(t)}catch(e){V.warn("Init: Error while revoking the media source URL",e instanceof Error?e:"")}}function ps(e,t){const n=Ot(e.src)?e.src:null;fs(e,n);const i=new us(hs());return t.register(()=>{i.dispose()}),i}function gs(e,t){return un(t,n=>{const i=ps(e,t);if(i.addEventListener("mediaSourceOpen",()=>{V.info("Init: MediaSource opened"),n(i)},t),V.info("MTCI: Attaching MediaSource URL to the media element"),"handle"===i.handle.type)e.srcObject=i.handle.value,t.register(()=>{fs(e,null)});else{const n=URL.createObjectURL(i.handle.value);e.src=n,t.register(()=>{fs(e,n)})}})}function ms(e,t,n){var i;if(!r(n)){const t=_t(e),s=St(e);if(!r(n.position))return V.debug("Init: using startAt.minimumPosition"),Math.max(Math.min(n.position,s),t);if(!r(n.wallClockTime)){V.debug("Init: using startAt.wallClockTime");const i=void 0===e.availabilityStartTime?0:e.availabilityStartTime,r=n.wallClockTime-i;return Math.max(Math.min(r,s),t)}if(!r(n.fromFirstPosition)){V.debug("Init: using startAt.fromFirstPosition");const{fromFirstPosition:e}=n;return e<=0?t:Math.min(s,t+e)}if(!r(n.fromLastPosition)){V.debug("Init: using startAt.fromLastPosition");const{fromLastPosition:e}=n;return e>=0?s:Math.max(t,s+e)}if(!r(n.fromLivePosition)){V.debug("Init: using startAt.fromLivePosition");const r=null!==(i=Tt(e))&&void 0!==i?i:s,{fromLivePosition:a}=n;return a>=0?r:Math.max(t,r+a)}if(!r(n.percentage)){V.debug("Init: using startAt.percentage");const{percentage:e}=n;if(e>100)return s;if(e<0)return t;const i=+e/100,r=s-t;return t+r*i}}const s=_t(e);if(e.isLive){const{suggestedPresentationDelay:n,clockOffset:i}=e,r=St(e);let a;const{DEFAULT_LIVE_GAP:o}=N.getCurrent();if(void 0===i)V.info("Init: no clock offset found for a live content, starting close to maximum available position"),a=r;else{V.info("Init: clock offset found for a live content, checking if we can start close to it");const t=void 0===e.availabilityStartTime?0:e.availabilityStartTime,n=(Se()+i)/1e3-t;a=Math.min(r,n)}const l=null!==n&&void 0!==n?n:t?o.LOW_LATENCY:o.DEFAULT;return V.debug(`Init: ${a} defined as the live time, applying a live gap`+` of ${l}`),Math.max(a-l,s)}return V.info("Init: starting at the minimum available position:",s),s}function vs(){return m}function ys(e){return!e||!g}function bs(){return w}function _s(e,t,n,i){const r=new me;r.linkToSignal(i);const s=new de(!1,r.signal);return e.listen(e=>{if(null!==e.rebuffering||null!==e.freezing||0===e.readyState)return;if(!ys(n)){if(isNaN(t.duration))return;if(t.duration>0)return s.setValue(!0),void r.cancel()}const i=bs()?4:3;return e.readyState>=i&&(null!==e.currentRange||e.ended)&&(!vs()||t.duration>0)?(s.setValue(!0),void r.cancel()):void 0},{includeLastObservation:!0,clearSignal:r.signal}),s}const Ts=!g;var Ss,ws=Ts;function Es({mediaElement:e,playbackObserver:t,startTime:n,mustAutoPlay:i,isDirectfile:r,onWarning:s},a){const o=new de(!1,a),l=new Promise((l,u)=>{const c=a.register(e=>{u(e)});if(a.isCancelled())return;let d=!1;const h=e=>{t.setCurrentTime(e),d=!0};if(r&&"number"!==typeof n)t.listen((e,t)=>{if(e.readyState>=1){t();const e="number"===typeof n?n:n();0!==e&&(ws?h(e):setTimeout(()=>{h(e)},0)),f()}},{includeLastObservation:!0,clearSignal:a});else{const e="number"===typeof n?n:n();0!==e&&h(e),f()}function f(){let n=!1;t.listen((t,i)=>{if(n||0===t.seeking&&"seeking"!==t.event&&"internal-seeking"!==t.event||(n=!0),(!d||n)&&0!==t.readyState){if(i(),vs()&&0===e.duration){const e=new ut("MEDIA_ERR_NOT_LOADED_METADATA","Cannot load automatically: your browser falsely announced having loaded the content.");s(e)}a.isCancelled()||p()}},{includeLastObservation:!0,clearSignal:a})}function p(){t.listen((e,t)=>{0===e.seeking&&null===e.rebuffering&&e.readyState>=1&&(t(),g())},{includeLastObservation:!0,clearSignal:a})}function g(){var t;if(V.info("Init: Can begin to play content"),!i)return e.autoplay&&V.warn("Init: autoplay is enabled on HTML media element. Media will play as soon as possible."),o.setValue(!0),o.finish(),c(),l({type:"skipped"});if(e.ended)return V.warn("Init: autoplay is enabled but the video is ended. Skipping autoplay to prevent video to start again"),o.setValue(!0),o.finish(),c(),l({type:"skipped"});let n;try{n=null!==(t=e.play())&&void 0!==t?t:Promise.resolve()}catch(e){return c(),u(e)}n.then(()=>{if(!a.isCancelled())return o.setValue(!0),o.finish(),c(),l({type:"autoplay"})}).catch(e=>{if(c(),!a.isCancelled()){if(e instanceof Error&&"NotAllowedError"===e.name){V.warn("Init: Media element can't play. It may be due to browser auto-play policies.");const e=new ut("MEDIA_ERR_BLOCKED_AUTOPLAY","Cannot trigger auto-play automatically: your browser does not allow it.");if(s(e),a.isCancelled())return;return l({type:"autoplay-blocked"})}u(e)}})}});return{autoPlayResult:l,initialPlayPerformed:o}}function xs(e,t,n,i,r){if(0===t.length)return u("No `keySystems` option given.");if(null===qt.decrypt)return u("EME feature not activated.");const s=new me;s.linkToSignal(r);const a=new de({initializationState:{type:"uninitialized",value:null},drmSystemId:void 0},r),o=qt.decrypt;if(!o.hasEmeApis())return u("EME API not available on the current page.");V.debug("Init: Creating ContentDecryptor");const l=new o(e,t);return l.addEventListener("stateChange",e=>{if(e===Ss.WaitingForAttachment){const t=new de(!1);t.onUpdate((t,n)=>{t&&(n(),e===Ss.WaitingForAttachment&&l.attach())},{clearSignal:s.signal}),a.setValue({initializationState:{type:"awaiting-media-link",value:{isMediaLinked:t}},drmSystemId:l.systemId})}else e===Ss.ReadyForContent&&(a.setValue({initializationState:{type:"initialized",value:null},drmSystemId:l.systemId}),l.removeEventListener("stateChange"))}),l.addEventListener("error",e=>{s.cancel(),i.onError(e)}),l.addEventListener("warning",e=>{i.onWarning(e)}),l.addEventListener("blackListProtectionData",e=>{i.onBlackListProtectionData(e)}),l.addEventListener("keyIdsCompatibilityUpdate",e=>{i.onKeyIdsCompatibilityUpdate(e)}),n.onUpdate(e=>{null!==e&&l.onInitializationData(e)},{clearSignal:s.signal}),s.signal.register(()=>{l.dispose()}),a;function u(e){n.onUpdate((t,n)=>{if(null===t)return;n();const r=new lt("MEDIA_IS_ENCRYPTED_ERROR",e);i.onError(r)},{clearSignal:r});const t=new de({initializationState:{type:"initialized",value:null},drmSystemId:void 0});return t.finish(),t}}(function(e){e[e["Initializing"]=0]="Initializing",e[e["WaitingForAttachment"]=1]="WaitingForAttachment",e[e["ReadyForContent"]=2]="ReadyForContent",e[e["Error"]=3]="Error",e[e["Disposed"]=4]="Disposed"})(Ss||(Ss={}));class ks{constructor(e){this._displayer=e}pushTextData(e){try{return Promise.resolve(this._displayer.pushTextData(e))}catch(e){return Promise.reject(e)}}remove(e,t){try{return Promise.resolve(this._displayer.removeBuffer(e,t))}catch(e){return Promise.reject(e)}}reset(){this._displayer.reset()}stop(){this._displayer.stop()}}const As=1/60;class Is extends s{constructor(e,t,n){super(),this._playbackObserver=e,this._manifest=t,this._speed=n,this._discontinuitiesStore=[],this._isStarted=!1,this._canceller=new me}start(){if(this._isStarted)return;this._isStarted=!0;const e=new Ls(this._playbackObserver,this._speed);this._canceller.signal.register(()=>{e.dispose()});let t=null;this._playbackObserver.listen(n=>{const i=this._discontinuitiesStore,{buffered:r,position:s,readyState:a,rebuffering:o,freezing:l}=n,{BUFFER_DISCONTINUITY_THRESHOLD:u,FREEZING_STALLED_DELAY:c,UNFREEZING_SEEK_DELAY:d,UNFREEZING_DELTA_POSITION:h}=N.getCurrent();if(null!==l){const n=Se(),i=null===t?l.timestamp:t.attemptTimestamp;if(!s.isAwaitingFuturePosition()&&n-i>d&&(V.warn("Init: trying to seek to un-freeze player"),this._playbackObserver.setCurrentTime(this._playbackObserver.getCurrentTime()+h),t={attemptTimestamp:n}),n-l.timestamp>c)return null===o?e.stopRebuffering():e.startRebuffering(),void this.trigger("stalled","freezing")}else t=null;if(null===o){if(e.stopRebuffering(),1===a){let e;return e=0!==n.seeking?1===n.seeking?"internal-seek":"seeking":"not-ready",void this.trigger("stalled",e)}return void this.trigger("unstalled",null)}const f="seeking"===o.reason&&1===n.seeking?"internal-seek":o.reason;if(s.isAwaitingFuturePosition())return e.stopRebuffering(),V.debug("Init: let rebuffering happen as we're awaiting a future position"),void this.trigger("stalled",f);if(e.startRebuffering(),null===this._manifest)return void this.trigger("stalled",f);const{position:p}=o;if(null!==p&&void 0!==p&&this._speed.getValue()>0){const e=Cs(i,this._manifest,p);if(null!==e){const t=e+.001;if(!(t<=this._playbackObserver.getCurrentTime()))return V.warn("SA: skippable discontinuity found in the stream",s.getPolled(),t),this._playbackObserver.setCurrentTime(t),void this.trigger("warning",Ms(p,t));V.info("Init: position to seek already reached, no seeking",this._playbackObserver.getCurrentTime(),t)}}const g=null!==p&&void 0!==p?p:s.getPolled(),m=ee(r,g);if(this._speed.getValue()>0&&m<u){const e=g+m+As;if(this._playbackObserver.getCurrentTime()<e)return V.warn("Init: discontinuity encountered inferior to the threshold",g,e,u),this._playbackObserver.setCurrentTime(e),void this.trigger("warning",Ms(g,e))}for(let e=this._manifest.periods.length-2;e>=0;e--){const t=this._manifest.periods[e];if(void 0!==t.end&&t.end<=g){if(this._manifest.periods[e+1].start>g&&this._manifest.periods[e+1].start>this._playbackObserver.getCurrentTime()){const t=this._manifest.periods[e+1];return this._playbackObserver.setCurrentTime(t.start),void this.trigger("warning",Ms(g,t.start))}break}}this.trigger("stalled",f)},{includeLastObservation:!0,clearSignal:this._canceller.signal})}updateDiscontinuityInfo(e){this._isStarted||this.start();const t=this._playbackObserver.getReference().getValue();Rs(this._discontinuitiesStore,e,t)}onLockedStream(e,t){var n;this._isStarted||this.start();const i=this._playbackObserver.getReference().getValue();if(!i.rebuffering||i.paused||this._speed.getValue()<=0||"audio"!==e&&"video"!==e)return;const r=i.position.getWanted(),s=null!==(n=i.rebuffering.position)&&void 0!==n?n:r,a=t.start;r<a&&Math.abs(s-a)<1&&(V.warn("Init: rebuffering because of a future locked stream.\nTrying to unlock by seeking to the next Period"),this._playbackObserver.setCurrentTime(a+.001))}destroy(){this._canceller.cancel()}}function Cs(e,t,n){if(0===e.length)return null;let i=null;for(const r of e){const{period:e}=r;if(e.start>n)return i;let s;if(void 0===e.end||e.end>n){const{discontinuity:a,position:o}=r,{start:l,end:u}=a,c=null!==l&&void 0!==l?l:o;if(n>=c-As)if(null===u){const n=xt(t,e);null!==n?s=n.start+As:V.warn("Init: discontinuity at Period's end but no next Period")}else n<u+As&&(s=u+As);void 0!==s&&(V.info("Init: discontinuity found",n,s),i=null!==i&&i>s?i:s)}}return i}function Ds(e){return null!==e.discontinuity}function Rs(e,t,n){const i=Math.min(n.position.getPolled(),n.position.getWanted());while(e.length>0&&void 0!==e[0].period.end&&e[0].period.end+10<i)e.shift();const{period:r,bufferType:s}=t;if("audio"===s||"video"===s){for(let n=0;n<e.length;n++)if(e[n].period.id===r.id){if(e[n].bufferType===s)return void(Ds(t)?e[n]=t:e.splice(n,1))}else if(e[n].period.start>r.start)return void(Ds(t)&&e.splice(n,0,t));Ds(t)&&e.push(t)}}function Ms(e,t){return new ut("DISCONTINUITY_ENCOUNTERED","A discontinuity has been encountered at position "+String(e)+", seeked at position "+String(t))}class Ls{constructor(e,t){this._speedUpdateCanceller=new me,this._isRebuffering=!1,this._playbackObserver=e,this._isDisposed=!1,this._speed=t,this._updateSpeed()}startRebuffering(){this._isRebuffering||this._isDisposed||(this._isRebuffering=!0,this._speedUpdateCanceller.cancel(),V.info("Init: Pause playback to build buffer"),this._playbackObserver.setPlaybackRate(0))}stopRebuffering(){this._isRebuffering&&!this._isDisposed&&(this._isRebuffering=!1,this._speedUpdateCanceller=new me,this._updateSpeed())}dispose(){this._speedUpdateCanceller.cancel(),this._isDisposed=!0}_updateSpeed(){this._speed.onUpdate(e=>{V.info("Init: Resume playback speed",e),this._playbackObserver.setPlaybackRate(e)},{clearSignal:this._speedUpdateCanceller.signal,emitCurrentValue:!0})}}function Ps(e,t){return e.id===t.id&&e.start===t.start&&e.end===t.end}var Os=Ps;function Ns(e,t){const n=[],{periods:i}=t;for(const r of i){const{streamEvents:t}=r;t.forEach(({start:t,end:i,id:r,data:s})=>{for(const l of e)if(Os(l,{id:r,start:t,end:i}))return void n.push(l);let a;if(void 0!==s.value.element)a=s.value.element;else{if(void 0===s.value.xmlData)return;{let e=s.value.xmlData.namespaces.reduce((e,t)=>{return e+"xmlns:"+t.key+'="'+t.value+'" '},"<toremove ");e+=">";const t=(new DOMParser).parseFromString(e+s.value.xmlData.data+"</toremove>","application/xml").documentElement;a=t.children.length>0?t.children[0]:t.childNodes[0]}}const o={type:s.type,value:Object.assign(Object.assign({},s.value),{element:a})};if(void 0===i){const e={start:t,id:r,data:o,publicEvent:{start:t,data:o}};n.push(e)}else{const e={start:t,end:i,id:r,data:o,publicEvent:{start:t,end:i,data:o}};n.push(e)}})}return n}var Us=Ns;class Fs extends s{constructor(e,t,n){super(),this._manifest=e,this._mediaElement=t,this._playbackObserver=n,this._canceller=null,this._scheduledEventsRef=new de([]),this._eventsBeingPlayed=new WeakMap}start(){if(null!==this._canceller)return;this._canceller=new me;const e=this._canceller.signal,t=this._playbackObserver,n=this._mediaElement;let i=!1,r=new me;r.linkToSignal(e),this._scheduledEventsRef.setValue(Us([],this._manifest)),this._scheduledEventsRef.onUpdate(({length:s})=>{if(0===s)return void(i&&(r.cancel(),r=new me,r.linkToSignal(e),i=!1));if(i)return;i=!0;let a=c();const o=()=>{const e=c();this._emitStreamEvents(this._scheduledEventsRef.getValue(),a,e,r.signal),a=e},{STREAM_EVENT_EMITTER_POLL_INTERVAL:l}=N.getCurrent(),u=setInterval(o,l);function c(){const e=t.getReference().getValue(),i=n.currentTime,r=0!==e.seeking;return{currentTime:i,isSeeking:r}}t.listen(o,{includeLastObservation:!1,clearSignal:r.signal}),r.signal.register(()=>{clearInterval(u)})},{emitCurrentValue:!0,clearSignal:e})}onManifestUpdate(e){const t=this._scheduledEventsRef.getValue();this._scheduledEventsRef.setValue(Us(t,e))}stop(){null!==this._canceller&&(this._canceller.cancel(),this._canceller=null)}_emitStreamEvents(e,t,n,i){const{currentTime:r}=t,{isSeeking:s,currentTime:a}=n,o=[],l=[];for(let u=0;u<e.length;u++){const t=e[u],n=t.start,i=Bs(t)?t.end:void 0,c=this._eventsBeingPlayed.has(t);c?(n>a||void 0!==i&&a>=i)&&(Bs(t)&&l.push(t.publicEvent),this._eventsBeingPlayed.delete(t)):n<=a&&void 0!==i&&a<i?(o.push({type:"stream-event",value:t.publicEvent}),this._eventsBeingPlayed.set(t,!0)):r<n&&a>=(null!==i&&void 0!==i?i:n)&&(s?o.push({type:"stream-event-skip",value:t.publicEvent}):(o.push({type:"stream-event",value:t.publicEvent}),Bs(t)&&l.push(t.publicEvent)))}if(o.length>0)for(const u of o)if("stream-event"===u.type?this.trigger("event",u.value):this.trigger("eventSkip",u.value),i.isCancelled())return;if(l.length>0)for(const u of l)if("function"===typeof u.onExit&&u.onExit(),i.isCancelled())return}}function Bs(e){return void 0!==e.end}var js=Fs;function Vs(e,t,n){function i(){const n=e.error;let i,s;switch(r(n)||(i=n.code,s=n.message),i){case 1:return s=null!==s&&void 0!==s?s:"The fetching of the associated resource was aborted by the user's request.",t(new ut("MEDIA_ERR_ABORTED",s));case 2:return s=null!==s&&void 0!==s?s:"A network error occurred which prevented the media from being successfully fetched",t(new ut("MEDIA_ERR_NETWORK",s));case 3:return s=null!==s&&void 0!==s?s:"An error occurred while trying to decode the media resource",t(new ut("MEDIA_ERR_DECODE",s));case 4:return s=null!==s&&void 0!==s?s:"The media resource has been found to be unsuitable.",t(new ut("MEDIA_ERR_SRC_NOT_SUPPORTED",s));default:return s=null!==s&&void 0!==s?s:"The HTMLMediaElement errored due to an unknown reason.",t(new ut("MEDIA_ERR_UNKNOWN",s))}}n.isCancelled()||(e.addEventListener("error",i),n.register(()=>{e.removeEventListener("error",i)}))}class Hs extends lr{constructor(e){super(),this._settings=e,this._initCanceller=new me,this._manifest=null;const t=void 0===e.url?void 0:[e.url];this._manifestFetcher=new yn(t,e.transport,e.manifestRequestSettings)}prepare(){null===this._manifest&&(this._manifest=rr.createAsync(un(this._initCanceller.signal,(e,t)=>{this._manifestFetcher.addEventListener("warning",e=>this.trigger("warning",e)),this._manifestFetcher.addEventListener("error",e=>{this.trigger("error",e),t(e)}),this._manifestFetcher.addEventListener("manifestReady",t=>{e(t)})})),this._manifestFetcher.start(),this._initCanceller.signal.register(()=>{this._manifestFetcher.dispose()}))}start(e,t){this.prepare(),Vs(e,e=>this._onFatalError(e),this._initCanceller.signal);const n=new de(null,this._initCanceller.signal);this._initializeMediaSourceAndDecryption(e,n).then(i=>this._onInitialMediaSourceReady(e,i.mediaSource,t,i.drmSystemId,n,i.unlinkMediaSource)).catch(e=>{this._onFatalError(e)})}updateContentUrls(e,t){this._manifestFetcher.updateContentUrls(e,t)}dispose(){this._initCanceller.cancel()}_onFatalError(e){this._initCanceller.isUsed()||(this._initCanceller.cancel(),this.trigger("error",e))}_initializeMediaSourceAndDecryption(e,t){const n=this._initCanceller;return un(n.signal,i=>{const{keySystems:r}=this._settings,s=xs(e,r,t,{onWarning:e=>this.trigger("warning",e),onError:e=>this._onFatalError(e),onBlackListProtectionData:e=>{(async()=>{var t;if(null===this._manifest)return;const n=null!==(t=this._manifest.syncValue)&&void 0!==t?t:await this._manifest.getValueAsAsync();Gs(n,e)})().catch(U)},onKeyIdsCompatibilityUpdate:e=>{(async()=>{var t;if(null===this._manifest)return;const n=null!==(t=this._manifest.syncValue)&&void 0!==t?t:await this._manifest.getValueAsAsync();$s(n,e.whitelistedKeyIds,e.blacklistedKeyIds,e.delistedKeyIds)})().catch(U)}},n.signal);s.onUpdate((t,r)=>{if("uninitialized"===t.initializationState.type)return;r();const a=new me;a.linkToSignal(n.signal),gs(e,a.signal).then(e=>{const r=s.getValue();if("awaiting-media-link"===r.initializationState.type)r.initializationState.value.isMediaLinked.setValue(!0),s.onUpdate((t,n)=>{if("initialized"===t.initializationState.type)return n(),void i({mediaSource:e,drmSystemId:t.drmSystemId,unlinkMediaSource:a})},{emitCurrentValue:!0,clearSignal:n.signal});else if("initialized"===t.initializationState.type)return void i({mediaSource:e,drmSystemId:t.drmSystemId,unlinkMediaSource:a})}).catch(e=>{a.isUsed()||this._onFatalError(e)})},{emitCurrentValue:!0,clearSignal:n.signal})})}async _onInitialMediaSourceReady(e,t,n,i,r,s){var a;const{adaptiveOptions:o,autoPlay:l,bufferOptions:u,lowLatencyMode:c,segmentRequestOptions:d,speed:h,startAt:f,textTrackOptions:p,transport:g}=this._settings,m=this._initCanceller;let v;fe(null!==this._manifest);try{v=null!==(a=this._manifest.syncValue)&&void 0!==a?a:await this._manifest.getValueAsAsync()}catch(e){return}v.addEventListener("manifestUpdate",e=>{this.trigger("manifestUpdate",e)},m.signal),v.addEventListener("decipherabilityUpdate",e=>{this.trigger("decipherabilityUpdate",e)},m.signal),V.debug("Init: Calculating initial time");const y=ms(v,c,f);V.debug("Init: Initial time calculated:",y);const b=tt(o),_=R({textTrackOptions:p,drmSystemId:i},u),T=new Mn(g,d,m.signal);if(this.trigger("manifestReady",v),m.isUsed())return;const S=this._startBufferingOnMediaSource.bind(this),w=this.trigger.bind(this),E=this._onFatalError.bind(this);function x(t,i,s,a){const o={mediaElement:e,playbackObserver:n,mediaSource:t,initialTime:i,autoPlay:s,manifest:v,representationEstimator:b,segmentFetcherCreator:T,speed:h,protectionRef:r,bufferOptions:_};function l(t){if(a.cancel(),m.isUsed())return;if(w("reloadingMediaSource",t),m.isUsed())return;const n=new me;n.linkToSignal(m.signal),gs(e,n.signal).then(e=>{x(e,t.position,t.autoPlay,n)}).catch(e=>{n.isUsed()||E(e)})}S(o,l,a.signal)}x(t,y,l,s)}_startBufferingOnMediaSource(e,t,n){var i;const{autoPlay:r,bufferOptions:s,initialTime:a,manifest:o,mediaElement:l,mediaSource:u,playbackObserver:c,protectionRef:d,representationEstimator:h,segmentFetcherCreator:f,speed:p}=e,g=null!==(i=o.getPeriodForTime(a))&&void 0!==i?i:o.getNextPeriod(a);if(void 0===g){const e=new ut("MEDIA_STARTING_TIME_NOT_FOUND","Wanted starting time not found in the Manifest.");return this._onFatalError(e)}let m=null,v=null;if("html"===this._settings.textTrackOptions.textTrackMode&&null!==qt.htmlTextDisplayer?v=new qt.htmlTextDisplayer(l,this._settings.textTrackOptions.textTrackElement):null!==qt.nativeTextDisplayer&&(v=new qt.nativeTextDisplayer(l)),null!==v){const e=new ks(v);m=e,n.register(()=>{e.stop(),null===v||void 0===v||v.stop()})}const y=new ai(u,"VIDEO"===l.nodeName,m);n.register(()=>{y.disposeAll()});const{autoPlayResult:b,initialPlayPerformed:_}=Es({mediaElement:l,playbackObserver:c,startTime:a,mustAutoPlay:r,onWarning:e=>{this.trigger("warning",e)},isDirectfile:!1},n);if(n.isCancelled())return;_.onUpdate((e,t)=>{if(e){t();const e=new js(o,l,c);o.addEventListener("manifestUpdate",()=>{e.onManifestUpdate(o)},n),e.addEventListener("event",e=>{this.trigger("streamEvent",e)},n),e.addEventListener("eventSkip",e=>{this.trigger("streamEventSkip",e)},n),e.start(),n.register(()=>{e.stop()})}},{clearSignal:n,emitCurrentValue:!0});const T=cr(c,{autoPlay:r,manifest:o,mediaSource:u,textDisplayer:v,initialPlayPerformed:_,speed:p},n),S=this._createRebufferingController(c,o,p,n),w=new Bn(y);k&&o.addEventListener("decipherabilityUpdate",e=>{e.some(e=>!0!==e.representation.decipherable)&&C(0,void 0,void 0)},n),c.listen(e=>{if(w.needToReload(e)){let e;const n=c.getReference().getValue();e=n.position.isAwaitingFuturePosition()?n.position.getWanted():c.getCurrentTime();const i=_.getValue()?!c.getIsPaused():r;t({position:e,autoPlay:i})}},{clearSignal:n}),T.listen(e=>{["video","audio","text"].forEach(t=>{var n;const i=y.getStatus(t);"initialized"===i.type&&i.value.synchronizeInventory(null!==(n=e.buffered[t])&&void 0!==n?n:[])})},{clearSignal:n});const E=Fn(o,u,T,y,{onWarning:e=>this.trigger("warning",e),onPeriodChanged:e=>this.trigger("activePeriodChanged",{period:e})},n);b.then(()=>{_s(c,l,!1,n).onUpdate((e,t)=>{e&&(t(),this.trigger("loaded",{getSegmentSinkMetrics:async()=>{return new Promise(e=>e(y.getSegmentSinksMetrics()))}}))},{emitCurrentValue:!0,clearSignal:n})}).catch(e=>{n.isCancelled()||this._onFatalError(e)});const x=this;function I(){return{needsBufferFlush:e=>{var t;let i;const r=c.getCurrentTime(),s=null!==(t=null===e||void 0===e?void 0:e.relativeResumingPosition)&&void 0!==t?t:0,a=Boolean(null===e||void 0===e?void 0:e.relativePosHasBeenDefaulted);i=0===s&&a?r+.001:r+s,c.setCurrentTime(i),c.listen((e,t)=>{(null!==e.currentRange||e.position.getPolled()>i+.1)&&(t(),c.setCurrentTime(e.position.getWanted()+.001))},{includeLastObservation:!1,clearSignal:n})},streamStatusUpdate(e){const{period:t,bufferType:i,imminentDiscontinuity:r,position:s}=e;if(S.updateDiscontinuityInfo({period:t,bufferType:i,discontinuity:r,position:s}),!n.isCancelled()&&o.isLastPeriodKnown&&e.period.id===o.periods[o.periods.length-1].id){const t=e.hasFinishedLoading||e.isEmptyStream;t?E.onLastSegmentFinishedLoading(e.bufferType):E.onLastSegmentLoadingResume(e.bufferType)}},needsManifestRefresh:()=>x._manifestFetcher.scheduleManualRefresh({enablePartialRefresh:!0,canUseUnsafeMode:!0}),manifestMightBeOufOfSync:()=>{const{OUT_OF_SYNC_MANIFEST_REFRESH_DELAY:e}=N.getCurrent();x._manifestFetcher.scheduleManualRefresh({enablePartialRefresh:!1,canUseUnsafeMode:!1,delay:e})},lockedStream:e=>S.onLockedStream(e.bufferType,e.period),adaptationChange:e=>{x.trigger("adaptationChange",e),n.isCancelled()||E.onAdaptationChange(e.type,e.period,e.adaptation)},representationChange:e=>{x.trigger("representationChange",e),n.isCancelled()||E.onRepresentationChange(e.type,e.period)},inbandEvent:e=>x.trigger("inbandEvents",e),warning:e=>x.trigger("warning",e),periodStreamReady:e=>x.trigger("periodStreamReady",e),periodStreamCleared:e=>{E.onPeriodCleared(e.type,e.period),n.isCancelled()||x.trigger("periodStreamCleared",e)},bitrateEstimateChange:e=>x.trigger("bitrateEstimateChange",e),needsMediaSourceReload:e=>{C(e.timeOffset,e.minimumPosition,e.maximumPosition)},needsDecipherabilityFlush(){var e,n,i,r;const s=or(l);if(A(null===s||void 0===s?void 0:s[0])){const r=T.getReference().getValue(),s=r.position.isAwaitingFuturePosition()?r.position.getWanted():null!==(e=T.getCurrentTime())&&void 0!==e?e:r.position.getPolled(),a=null!==(i=null!==(n=r.paused.pending)&&void 0!==n?n:T.getIsPaused())&&void 0!==i?i:r.paused.last;t({position:s,autoPlay:!a})}else{const e=T.getReference().getValue(),t=e.position.isAwaitingFuturePosition()?e.position.getWanted():null!==(r=T.getCurrentTime())&&void 0!==r?r:e.position.getPolled();t+.001<e.duration?c.setCurrentTime(l.currentTime+.001):c.setCurrentTime(t)}},encryptionDataEncountered:e=>{for(const t of e)if(d.setValue(t),n.isCancelled())return},error:e=>x._onFatalError(e)}}function C(e,n,i){var r,s,a;const o=T.getReference().getValue(),l=o.position.isAwaitingFuturePosition()?o.position.getWanted():null!==(r=T.getCurrentTime())&&void 0!==r?r:o.position.getPolled(),u=null!==(a=null!==(s=o.paused.pending)&&void 0!==s?s:T.getIsPaused())&&void 0!==a?a:o.paused.last;let c=l+e;void 0!==n&&(c=Math.max(n,c)),void 0!==i&&(c=Math.min(i,c)),t({position:c,autoPlay:!u})}nr({manifest:o,initialPeriod:g},T,h,y,f,s,I(),n)}_createRebufferingController(e,t,n,i){const r=new Is(e,t,n);return r.addEventListener("stalled",e=>this.trigger("stalled",e)),r.addEventListener("unstalled",()=>this.trigger("unstalled",null)),r.addEventListener("warning",e=>this.trigger("warning",e)),i.register(()=>r.destroy()),r.start(),r}}function $s(e,t,n,i){e.updateRepresentationsDeciperability(e=>{const{representation:r}=e;if(void 0===r.contentProtections)return r.decipherable;const s=r.contentProtections.keyIds;if(void 0!==s)for(const a of s){for(const e of n)if(yt(e,a.keyId))return!1;for(const e of t)if(yt(e,a.keyId))return!0;for(const e of i)if(yt(e,a.keyId))return}return r.decipherable})}function Gs(e,t){e.updateRepresentationsDeciperability(e=>{var n,i;const r=e.representation;if(!1===r.decipherable)return!1;const s=null!==(i=null===(n=r.contentProtections)||void 0===n?void 0:n.initData)&&void 0!==i?i:[];for(const a of s)if(void 0===t.type||a.type===t.type){const e=t.values.getFormattedValues().every(e=>{return a.values.some(t=>{return(void 0===e.systemId||t.systemId===e.systemId)&&yt(t.data,e.data)})});if(e)return!1}return r.decipherable})}var zs=n("01e1");const qs=200,Ws=new Map;function Ks(e){if(r(gr))return zs["a"]&&V.error("Compat: Cannot request codec support in a worker without MSE."),!1;if("function"===typeof gr.isTypeSupported){const t=Ws.get(e);if(void 0!==t)return t;{const t=gr.isTypeSupported(e);return Ws.size>=qs&&Ws.clear(),Ws.set(e,t),t}}return!0}const Ys=50;class Xs{constructor(){this._cachedCodecSupport=new Map}isSupported(e,t){const n=`${null!==e&&void 0!==e?e:""};codecs="${null!==t&&void 0!==t?t:""}"`,i=this._cachedCodecSupport.get(n);if(void 0!==i)return i;this._cachedCodecSupport.size>=Ys&&this._cachedCodecSupport.clear();const r=Ks(n);return this._cachedCodecSupport.set(n,r),r}}const Qs=new Xs;var Zs=Qs;function Js(e,t){let n=e;for(const i of t){const e=ea(n,i);if(null===e)return null;n=e}return n}function ea(e,t){const n=ia(e,t);return null!==n?e.subarray(n[1],n[2]):null}function ta(e,t){const n=[];let i=e;while(1){const e=ia(i,t);if(null===e)return n;fe(0!==e[2]&&0!==i.length),n.push(i.subarray(e[1],e[2])),i=i.subarray(e[2])}}function na(e,t){const n=ia(e,t);return null!==n?e.subarray(n[0],n[2]):null}function ia(e,t){const n=e.length;let i,r,s=0,a=0;while(s+8<=n){if(r=s,a=$r(e,r),r+=4,i=$r(e,r),r+=4,0===a)a=n-s;else if(1===a){if(r+8>n)return null;a=Gr(e,r),r+=8}if(a<0)throw new Error("ISOBMFF: Size out of range");if(i===t)return 1970628964===t&&(r+=16),[s,r,s+a];s+=a}return null}function ra(e,t,n,i,r){const s=e.length;let a;for(let o=0;o<s;o+=a){let l=o;a=$r(e,l),l+=4;const u=$r(e,l);if(l+=4,0===a)a=s-o;else if(1===a){if(l+8>s)return;a=Gr(e,l),l+=8}if(1970628964===u&&l+16<=s&&$r(e,l)===t&&$r(e,l+4)===n&&$r(e,l+8)===i&&$r(e,l+12)===r)return l+=16,e.subarray(l,o+a)}}function sa(e){const t=e.length;if(t<8)return V.warn("ISOBMFF: box inferior to 8 bytes, cannot find offsets"),null;let n=0,i=$r(e,n);n+=4;const r=$r(e,n);if(n+=4,0===i)i=t;else if(1===i){if(n+8>t)return V.warn("ISOBMFF: box too short, cannot find offsets"),null;i=Gr(e,n),n+=8}if(i<0)throw new Error("ISOBMFF: Size out of range");return 1970628964===r&&(n+=16),[0,n,i]}function aa(e){const t=ea(e,1836019558);return null===t?null:ea(t,1953653094)}function oa(e){const t=ta(e,1836019558);return t.reduce((e,t)=>{const n=ea(t,1953653094);return null!==n&&e.push(n),e},[])}function la(e){return ea(e,1835295092)}function ua(e){const t=ea(e,1836019574);if(null===t)return null;const n=ea(t,1953653099);return null===n?null:ea(n,1835297121)}function ca(e,t=0){return ea(e.subarray(t),1701671783)}const da=/^(?:[a-z]+:)?\/\//i,ha=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/;function fa(e){const t=e.lastIndexOf("/");if(t<0)return e.length;if(da.test(e)){const n=e.indexOf("/");if(n>=0&&t===n+1)return e.length}const n=e.indexOf("?");return n>=0&&n<t?fa(e.substring(0,n)):t+1}function pa(e,t){const n=va(e),i=va(t);if(i.scheme)return ya(i);const r={scheme:n.scheme,authority:n.authority,path:"",query:i.query,fragment:i.fragment};return i.authority?(r.authority=i.authority,r.path=ba(i.path),ya(r)):(""===i.path?(r.path=n.path,i.query||(r.query=n.query)):Vi(i.path,"/")?r.path=ba(i.path):r.path=ba(_a(n,i.path)),ya(r))}const ga=new Map,ma=200;function va(e){var t,n,i,r,s;if(ga.has(e))return ga.get(e);const a=e.match(ha);let o;return o=null===a?{scheme:"",authority:"",path:"",query:"",fragment:""}:{scheme:null!==(t=a[1])&&void 0!==t?t:"",authority:null!==(n=a[2])&&void 0!==n?n:"",path:null!==(i=a[3])&&void 0!==i?i:"",query:null!==(r=a[4])&&void 0!==r?r:"",fragment:null!==(s=a[5])&&void 0!==s?s:""},ga.size>=ma&&ga.clear(),ga.set(e,o),o}function ya(e){let t="";return e.scheme&&(t+=e.scheme+":"),e.authority&&(t+="//"+e.authority),t+=e.path,e.query&&(t+="?"+e.query),e.fragment&&(t+="#"+e.fragment),t}function ba(e){const t=e.split(/(?=\/)/),n=[];for(let i=0;i<t.length;i++){const e=t[i];".."!==e&&"."!==e&&""!==e&&("/.."!==e?"/."!==e?n.push(e):i===t.length-1&&n.push("/"):(n.pop(),i===t.length-1&&n.push("/")))}return n.join("")}function _a(e,t){if(e.authority&&""===e.path)return"/"+t;const n=e.path;return n.substring(0,n.lastIndexOf("/")+1)+t}function Ta(...e){var t,n,i;const r=e.filter(e=>""!==e),s=r.length;if(0===s)return"";if(1===s)return null!==(t=r[0])&&void 0!==t?t:"";{const e=null!==(n=r[0])&&void 0!==n?n:"",t=null!==(i=r[1])&&void 0!==i?i:"",s=pa(e,t),a=r.slice(2);return Ta(s,...a)}}var Sa=Ta;const wa="object"===typeof a["a"]&&"function"===typeof a["a"].TextDecoder,Ea="object"===typeof a["a"]&&"function"===typeof a["a"].TextEncoder;function xa(e){const t=new ArrayBuffer(2*e.length),n=new Uint8Array(t);for(let i=0;i<n.length;i+=2){const t=e.charCodeAt(i/2);n[i]=255&t,n[i+1]=t>>8&255}return n}function ka(e){if(wa)try{const t=new TextDecoder("utf-16le");return t.decode(e)}catch(e){const t=e instanceof Error?e:"";V.warn("Utils: could not use TextDecoder to parse UTF-16LE, fallbacking to another implementation",t)}let t="";for(let n=0;n<e.length;n+=2)t+=String.fromCharCode((e[n+1]<<8)+e[n]);return t}function Aa(e){if(Ea)try{const t=new TextEncoder;return t.encode(e)}catch(e){const t=e instanceof Error?e:"";V.warn("Utils: could not use TextEncoder to encode string into UTF-8, fallbacking to another implementation",t)}let t;const n=encodeURIComponent(e);if("function"===typeof unescape)t=unescape(n);else{const e=/[0-9a-fA-F]/,i=n.length;t="";for(let r=0;r<n.length;r++){let s=!1;if("%"===n[r])if(r<=i-6&&"u"===n[r+1]&&e.test(n[r+2])&&e.test(n[r+3])&&e.test(n[r+4])&&e.test(n[r+5])){const e=parseInt(n.substring(r+1,r+6),16);t+=String.fromCharCode(e),s=!0,r+=5}else if(r<=i-3&&e.test(n[r+1])&&e.test(n[r+2])){const e=parseInt(n.substring(r+1,r+3),16);t+=String.fromCharCode(e),s=!0,r+=2}s||(t+=n[r])}}const i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=255&t.charCodeAt(r);return i}function Ia(e){const t=16e3;let n="";for(let i=0;i<e.length;i+=t){const r=e.subarray(i,i+t);n+=String.fromCharCode.apply(null,r)}return n}function Ca(e,t){const n=e.toString(16);return n.length>=t?n:new Array(t-n.length+1).join("0")+n}function Da(e){if(wa)try{const t=new TextDecoder;return t.decode(e)}catch(e){const t=e instanceof Error?e:"";V.warn("Utils: could not use TextDecoder to parse UTF-8, fallbacking to another implementation",t)}let t=e;239===t[0]&&187===t[1]&&191===t[2]&&(t=t.subarray(3));const n=Ia(t);let i;if("function"===typeof escape)i=escape(n);else{const e=/[A-Za-z0-9*_\+-\.\/]/;i="";for(let t=0;t<n.length;t++)if(e.test(n[t]))i+=n[t];else{const e=n.charCodeAt(t);i+=e>=256?"%u"+Ca(e,4):"%"+Ca(e,2)}}return decodeURIComponent(i)}function Ra(e){const t=e.length,n=new Uint8Array(t/2);for(let i=0,r=0;i<t;i+=2,r++)n[r]=255&parseInt(e.substring(i,i+2),16);return n}function Ma(e,t=""){let n="";for(let i=0;i<e.byteLength;i++)n+=(e[i]>>>4).toString(16),n+=(15&e[i]).toString(16),t.length>0&&i<e.byteLength-1&&(n+=t);return n}function La(e){fe(16===e.length,"GUID length should be 16");const t=e[0],n=e[1],i=e[2],r=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=new Uint8Array(16);return u[0]=r,u[1]=i,u[2]=n,u[3]=t,u[4]=a,u[5]=s,u[6]=l,u[7]=o,u.set(e.subarray(8,16),8),u}function Pa(e,t){let n=t;while(n<e.length){const t=e[n];if(0===t)break;n+=1}const i=e.subarray(t,n);return{end:n+1,string:Da(i)}}const Oa=Math.pow(2,32)-1,Na={};function Ua(e){if(void 0!==Na[e])return Na[e];const t=Aa(e);return Na[e]=t,t}function Fa(e,t){const n=t.length+8;return n<=Oa?jr(qr(n),Ua(e),t):jr(qr(1),Ua(e),Wr(n+8),t)}function Ba(e,t){return Fa(e,jr(...t))}function ja(e){const t=[];e.periods.forEach(n=>{const i=n.id;if(gt(t,i)){V.warn("Two periods with the same ID found. Updating.");const r=i+"-dup";n.id=r,ja(e),t.push(r)}else t.push(i);const{adaptations:r}=n,s=[];Object.keys(r).forEach(t=>{const n=r[t];void 0!==n&&n.forEach(t=>{const n=t.id;if(gt(s,n)){V.warn("Two adaptations with the same ID found. Updating.",n);const i=n+"-dup";t.id=i,ja(e),s.push(i)}else s.push(n);const i=[];t.representations.forEach(t=>{const n=t.id;if(gt(i,n)){V.warn("Two representations with the same ID found. Updating.",n);const r=`${n}-dup`;t.id=r,ja(e),i.push(r)}else i.push(n)})})})})}function Va(e,t){let n;return n="AACH"===t?5:Ot(e)?(248&parseInt(e.substring(0,2),16))>>3:2,0===n?"mp4a.40.2":`mp4a.40.${n}`}function Ha(e){const t=/00000001\d7([0-9a-fA-F]{6})/.exec(e);return null!==t&&Ot(t[1])?"avc1."+t[1]:"avc1.4D401E"}function $a(e){return e.reduce((t,n,i)=>{const r=n.getAttribute("d"),s=n.getAttribute("t"),a=n.getAttribute("r"),o=null!==a?+a-1:0;let l=null!==s?+s:void 0,u=null!==r?+r:void 0;if(0===i)l=void 0===l||isNaN(l)?0:l;else{const e=t[i-1];if(void 0===l||isNaN(l)){if(void 0===e.duration||isNaN(e.duration))throw new Error("Smooth: Invalid CNodes. Missing timestamp.");l=e.start+e.duration*(e.repeatCount+1)}}if(void 0===u||isNaN(u)){const n=e[i+1];if(void 0===n)return t;{const e=n.getAttribute("t"),t=Ot(e)?+e:null;if(null===t)throw new Error("Can't build index timeline from Smooth Manifest.");u=t-l}}return t.push({duration:u,start:l,repeatCount:o}),t},[])}const Ga=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],za=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];function qa(e){if(e>=za.length)throw new Error("Unable to parse base64 string.");const t=za[e];if(255===t)throw new Error("Unable to parse base64 string.");return t}function Wa(e){let t,n="";const i=e.length;for(t=2;t<i;t+=3)n+=Ga[e[t-2]>>2],n+=Ga[(3&e[t-2])<<4|e[t-1]>>4],n+=Ga[(15&e[t-1])<<2|e[t]>>6],n+=Ga[63&e[t]];return t===i+1&&(n+=Ga[e[t-2]>>2],n+=Ga[(3&e[t-2])<<4],n+="=="),t===i&&(n+=Ga[e[t-2]>>2],n+=Ga[(3&e[t-2])<<4|e[t-1]>>4],n+=Ga[(15&e[t-1])<<2],n+="="),n}function Ka(e){const t=e.length%4;let n=e;0!==t&&(V.warn("base64ToBytes: base64 given miss padding"),n+=3===t?"=":2===t?"==":"===");const i=n.indexOf("=");if(-1!==i&&i<n.length-2)throw new Error("Unable to parse base64 string.");const r=n.endsWith("==")?2:n.endsWith("=")?1:0,s=n.length,a=new Uint8Array(s/4*3);let o;for(let l=0,u=0;l<s;l+=4,u+=3)o=qa(n.charCodeAt(l))<<18|qa(n.charCodeAt(l+1))<<12|qa(n.charCodeAt(l+2))<<6|qa(n.charCodeAt(l+3)),a[u]=o>>16,a[u+1]=o>>8&255,a[u+2]=255&o;return a.subarray(0,a.length-r)}function Ya(e){const t=Kr(e,8),n=ka(e.subarray(10,t+10)),i=(new DOMParser).parseFromString(n,"application/xml"),r=i.querySelector("KID");if(null===r)throw new Error("Cannot parse PlayReady private data: invalid XML");const s=null===r.textContent?"":r.textContent,a=La(Ka(s));return Ma(a).toLowerCase()}function Xa(e){return[{systemId:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",privateData:jr([8,1,18,16],e)}]}function Qa(e,t=Xa){if(null===e.firstElementChild||"ProtectionHeader"!==e.firstElementChild.nodeName)throw new Error("Protection should have ProtectionHeader child");const n=e.firstElementChild,i=Ka(null===n.textContent?"":n.textContent),r=Ya(i),s=Ra(r),a=n.getAttribute("SystemID"),o=(null!==a?a:"").toLowerCase().replace(/\{|\}/g,"");return{keyId:s,keySystems:[{systemId:o,privateData:i}].concat(t(s))}}function Za(e,t,n){const{repeatCount:i}=e;if(i>=0)return i;let s;return s=r(t)?void 0!==n?n:Number.MAX_VALUE:t.start,Math.ceil((s-e.start)/e.duration)-1}function Ja(e,t,n){const{start:i,duration:r}=e;if(r<=0)return i;const s=Za(e,t,n);return i+(s+1)*r}function eo(e,t){var n;return e*t.timescale+(null!==(n=t.indexTimeOffset)&&void 0!==n?n:0)}function to(e,t){var n;return(e-(null!==(n=t.indexTimeOffset)&&void 0!==n?n:0))/t.timescale}function no(e,t,n){return[e*n,(e+t)*n]}function io(e,t){let n=0,i=e.length;while(n<i){const r=n+i>>>1;e[r].start<=t?n=r+1:i=r}return n-1}function ro(e,t,n){const{timeline:i}=e,r=eo(t,e);if(r<0)return null;const s=io(i,r);if(s<0||s>=i.length-1)return null;const a=i[s];if(a.duration<=0)return null;const o=i[s+1];if(void 0===o)return null;const l=o.start,u=Ja(a,o,n);return r>=u&&r<l?to(l,e):null}function so(e,t,n){return e.replace(/\{bitrate\}/g,String(t)).replace(/{CustomAttributes}/g,n.length>0?n[0]:"")}function ao(e,t){return e.replace(/\{start time\}/g,String(t))}function oo(e,t,n){const i=t-e;return i>0?Math.floor(i/n):0}function lo(e,t,n){const i=void 0===e||0===e?1:e;return{up:t*i,to:(t+n)*i}}function uo(e,t){let n=e.repeatCount;if(void 0!==e.duration&&n<0){const i=void 0!==t?t.start:1/0;n=Math.ceil((i-e.start)/e.duration)-1}return n}class co{constructor(e){const{isLive:t,segmentPrivateInfos:n,media:i,sharedSmoothTimeline:r}=e;if(this._sharedSmoothTimeline=r,this._initSegmentInfos={bitsPerSample:n.bitsPerSample,channels:n.channels,codecPrivateData:n.codecPrivateData,packetSize:n.packetSize,samplingRate:n.samplingRate,timescale:r.timescale,height:n.height,width:n.width,protection:n.protection},this._isLive=t,this._media=i,0!==r.timeline.length&&t){const{timeline:e,validityTime:t}=r,n=e[e.length-1],i=Ja(n,null),s=t/1e3*r.timescale;this._scaledLiveGap=s-i}}getInitSegment(){return{id:"init",isInit:!0,privateInfos:{smoothInitSegment:this._initSegmentInfos},url:null,time:0,end:0,duration:0,timescale:1,complete:!0}}getSegments(e,t){this._refreshTimeline();const{timescale:n,timeline:i}=this._sharedSmoothTimeline,{up:r,to:s}=lo(n,e,t),a=this._media;let o;const l=[],u=i.length,c=void 0===this._scaledLiveGap?void 0:Se()/1e3*n-this._scaledLiveGap;for(let d=0;d<u;d++){const e=i[d],{duration:t,start:u}=e,h=uo(e,i[d+1]);let f=oo(u,r,t),p=u+f*t;const g=t;while(p<s&&f<=h&&(void 0===c||p+g<=c)){const e=p,i=void 0!==o?o+f:void 0,r={id:String(p),isInit:!1,time:e/n,end:(e+t)/n,duration:t/n,timescale:1,number:i,url:ao(a,e),complete:!0,privateInfos:{smoothMediaSegment:{time:e,duration:t}}};l.push(r),f++,p=u+f*t}if(p>=s)return l;void 0!==o&&(o+=h+1)}return l}shouldRefresh(e,t){if(this._refreshTimeline(),!this._isLive)return!1;const{timeline:n,timescale:i}=this._sharedSmoothTimeline,r=n[n.length-1];if(void 0===r)return!1;const s=r.repeatCount,a=r.start+(s+1)*r.duration;if(t*i<a)return!1;if(e*i>=a)return!0;const o=r.start+s*r.duration;return e*i>o}getFirstAvailablePosition(){this._refreshTimeline();const{timeline:e,timescale:t}=this._sharedSmoothTimeline;return 0===e.length?null:e[0].start/t}getLastAvailablePosition(){this._refreshTimeline();const{timeline:e,timescale:t}=this._sharedSmoothTimeline;if(void 0===this._scaledLiveGap){const n=e[e.length-1];return Ja(n,null)/t}for(let n=e.length-1;n>=0;n--){const i=e[n],r=Se()/1e3*t,{start:s,duration:a,repeatCount:o}=i;for(let e=o;e>=0;e--){const n=s+a*(e+1),i=n;if(i<=r-this._scaledLiveGap)return n/t}}}getEnd(){if(!this._isLive)return this.getLastAvailablePosition()}awaitSegmentBetween(e,t){var n;if(fe(e<=t),this.isStillAwaitingFutureSegments())return!1;const i=this.getLastAvailablePosition();return!(void 0!==i&&t<i)&&(t>(null!==(n=this.getFirstAvailablePosition())&&void 0!==n?n:0)&&void 0)}checkDiscontinuity(e){return this._refreshTimeline(),ro(this._sharedSmoothTimeline,e,void 0)}isSegmentStillAvailable(e){if(e.isInit)return!0;this._refreshTimeline();const{timeline:t,timescale:n}=this._sharedSmoothTimeline;for(let i=0;i<t.length;i++){const r=t[i],s=r.start/n;if(s>e.time)return!1;if(s===e.time)return!0;if(r.repeatCount>=0&&void 0!==r.duration){const e=s-r.start,t=e/r.duration-1;return t%1===0&&t<=r.repeatCount}}return!1}canBeOutOfSyncError(e){return!!this._isLive&&(e instanceof ct&&(e.isHttpError(404)||e.isHttpError(412)))}_replace(e){this._initialScaledLastPosition=e._initialScaledLastPosition,this._scaledLiveGap=e._scaledLiveGap,this._sharedSmoothTimeline.replace(e._sharedSmoothTimeline)}_update(e){this._scaledLiveGap=e._scaledLiveGap,this._sharedSmoothTimeline.update(e._sharedSmoothTimeline)}isStillAwaitingFutureSegments(){return this._isLive}isInitialized(){return!0}initialize(){V.error("A `SmoothRepresentationIndex` does not need to be initialized")}addPredictedSegments(e,t){this._sharedSmoothTimeline.addPredictedSegments(e,t)}_refreshTimeline(){this._sharedSmoothTimeline.refresh()}}function ho(e,t){let n=0;while(e.length>0){const i=e[0];if(i.start>=t)return n;if(-1===i.repeatCount)return n;if(0===i.repeatCount)e.shift(),n+=1;else{const r=e[1];if(void 0!==r&&r.start<=t)e.shift(),n+=1;else{if(i.duration<=0)return n;let r=i.start+i.duration,s=1;while(r<t&&s<=i.repeatCount)r+=i.duration,s++;if(!(s>i.repeatCount)){const e=i.repeatCount-s;return i.start=r,i.repeatCount=e,n+=s,n}e.shift(),n=i.repeatCount+1}}}return n}function fo(e,t){if(0===e.length)return e.push(...t),!0;if(0===t.length)return!1;const n=e.length,i=t[0].start,r=e[n-1],s=Ja(r,t[0]);if(s<i)throw new ut("MANIFEST_UPDATE_ERROR","Cannot perform partial update: not enough data");for(let c=n-1;c>=0;c--){const r=e[c].start;if(r===i){const i=n-c;return e.splice(c,i,...t),!1}if(r<i){const r=e[c];if(r.start+r.duration>i)return V.warn("RepresentationIndex: Manifest update removed all previous segments"),e.splice(0,n,...t),!0;if(void 0===r.repeatCount||r.repeatCount<=0)return r.repeatCount<0&&(r.repeatCount=Math.floor((i-r.start)/r.duration)-1),e.splice(c+1,n-(c+1),...t),!1;const s=r.start+r.duration*(r.repeatCount+1);if(s<=i)return e.splice(c+1,n-(c+1),...t),!1;const a=(i-r.start)/r.duration-1;if(a%1===0&&r.duration===t[0].duration){const i=t[0].repeatCount<0?-1:t[0].repeatCount+a+1;return e.splice(c,n-c,...t),e[c].start=r.start,e[c].repeatCount=i,!1}return V.warn("RepresentationIndex: Manifest update removed previous segments"),e[c].repeatCount=Math.floor(a),e.splice(c+1,n-(c+1),...t),!1}}const a=e[e.length-1],o=t[t.length-1];if(void 0!==a.repeatCount&&a.repeatCount<0)return a.start>o.start?(V.warn("RepresentationIndex: The new index is older than the previous one"),!1):(V.warn('RepresentationIndex: The new index is "bigger" than the previous one'),e.splice(0,n,...t),!0);const l=a.start+a.duration*(a.repeatCount+1),u=o.start+o.duration*(o.repeatCount+1);return l>=u?(V.warn("RepresentationIndex: The new index is older than the previous one"),!1):(V.warn('RepresentationIndex: The new index is "bigger" than the previous one'),e.splice(0,n,...t),!0)}function po(e,t,n,i){const r=e.length,s=e[r-1],a=n.timescale===t?{time:n.time,duration:n.duration}:{time:n.time/n.timescale*t,duration:n.duration/n.timescale*t},o=i.time===a.time;return!o&&(a.time>=Ja(s,null)&&(s.duration===a.duration?s.repeatCount++:e.push({duration:a.duration,start:a.time,repeatCount:0}),!0))}class go{constructor(e){const{timeline:t,timescale:n,timeShiftBufferDepth:i,manifestReceivedTime:r}=e;this.timeline=t,this.timescale=n;const s=null!==r&&void 0!==r?r:Se();if(this.validityTime=s,this._timeShiftBufferDepth=i,0!==t.length){const e=t[t.length-1],n=Ja(e,null);this._initialScaledLastPosition=n}}refresh(){if(void 0===this._initialScaledLastPosition)return;const e=this._timeShiftBufferDepth,t=(Se()-this.validityTime)/1e3,n=t+this._initialScaledLastPosition/this.timescale;if(void 0!==e){const t=(n-e)*this.timescale;ho(this.timeline,t)}}replace(e){const t=this.timeline,n=e.timeline,i=this.timescale,r=e.timescale;if(this._initialScaledLastPosition=e._initialScaledLastPosition,this.validityTime=e.validityTime,0===t.length||0===n.length||i!==r)return;const s=t[t.length-1],a=n[n.length-1],o=Ja(a,null);if(!(Ja(s,null)<=o))for(let l=0;l<t.length;l++){const e=t[l],n=Ja(e,null);if(n===o)return void(this.timeline=this.timeline.concat(t.slice(l+1)));if(n>o){if(e.duration!==a.duration)return;const n=o-e.start;if(0===n)return V.warn("Smooth Parser: a discontinuity detected in the previous manifest has been resolved."),void(this.timeline=this.timeline.concat(t.slice(l)));if(n<0||n%e.duration!==0)return;const i=n/e.duration-1,r=e.repeatCount-i;if(r<0)return;a.repeatCount+=r;const s=t.slice(l+1);return void(this.timeline=this.timeline.concat(s))}}}update(e){fo(this.timeline,e.timeline),this._initialScaledLastPosition=e._initialScaledLastPosition,this.validityTime=e.validityTime}addPredictedSegments(e,t){var n;if(void 0!==(null===(n=t.privateInfos)||void 0===n?void 0:n.smoothMediaSegment)){this.refresh();for(let n=0;n<e.length;n++)po(this.timeline,this.timescale,e[n],t.privateInfos.smoothMediaSegment)}else V.warn("Smooth Parser: should only encounter SmoothRepresentationIndex")}}function mo(e){return"boolean"===typeof e?e:"string"===typeof e&&"TRUE"===e.toUpperCase()}function vo(e,t,n){let i=e.firstElementChild,r=n;while(null!==i)r=t(r,i.nodeName,i),i=i.nextElementSibling;return r}const yo={audio:"audio/mp4",video:"video/mp4",text:"application/ttml+xml"},bo={AACL:"audio/mp4",AVC1:"video/mp4",H264:"video/mp4",TTML:"application/ttml+xml+mp4",DFXP:"application/ttml+xml+mp4"};function _o(e={}){const t=void 0===e.referenceDateTime?Date.UTC(1970,0,1,0,0,0,0)/1e3:e.referenceDateTime,n=void 0===e.minRepresentationBitrate?0:e.minRepresentationBitrate,{serverSyncInfos:i}=e,s=void 0!==i?i.serverTimestamp-i.clientTime:void 0;function a(e,t){const n=vo(e,(e,t,n)=>{return"CustomAttributes"===t&&e.push(...vo(n,(e,t,n)=>{if("Attribute"===t){const t=n.getAttribute("Name"),i=n.getAttribute("Value");null!==t&&null!==i&&e.push(t+"="+i)}return e},[])),e},[]);function i(t){const n=e.getAttribute(t);return null===n?void 0:n}switch(t){case"audio":{const e=i("AudioTag"),t=i("BitsPerSample"),r=i("Channels"),s=i("CodecPrivateData"),a=i("FourCC"),o=i("PacketSize"),l=i("SamplingRate"),u=i("Bitrate");let c=void 0===u?0:parseInt(u,10);if(c=isNaN(c)?0:c,void 0!==a&&void 0===bo[a]||void 0===s)return V.warn("Smooth parser: Unsupported audio codec. Ignoring quality level."),null;const d=Va(s,a);return{audiotag:void 0!==e?parseInt(e,10):e,bitrate:c,bitsPerSample:void 0!==t?parseInt(t,10):t,channels:void 0!==r?parseInt(r,10):r,codecPrivateData:s,codecs:d,customAttributes:n,mimeType:void 0!==a?bo[a]:a,packetSize:void 0!==o?parseInt(o,10):o,samplingRate:void 0!==l?parseInt(l,10):l}}case"video":{const e=i("CodecPrivateData"),t=i("FourCC"),r=i("MaxWidth"),s=i("MaxHeight"),a=i("Bitrate");let o=void 0===a?0:parseInt(a,10);if(o=isNaN(o)?0:o,void 0!==t&&void 0===bo[t]||void 0===e)return V.warn("Smooth parser: Unsupported video codec. Ignoring quality level."),null;const l=Ha(e);return{bitrate:o,customAttributes:n,mimeType:void 0!==t?bo[t]:t,codecPrivateData:e,codecs:l,width:void 0!==r?parseInt(r,10):void 0,height:void 0!==s?parseInt(s,10):void 0}}case"text":{const e=i("CodecPrivateData"),t=i("FourCC"),r=i("Bitrate");let s=void 0===r?0:parseInt(r,10);return s=isNaN(s)?0:s,{bitrate:s,customAttributes:n,mimeType:void 0!==t?bo[t]:t,codecPrivateData:null!==e&&void 0!==e?e:""}}default:return V.error("Smooth Parser: Unrecognized StreamIndex type: "+t),null}}function o(e){const{root:t,timescale:i,baseUrl:s,protections:o,timeShiftBufferDepth:l,manifestReceivedTime:u,isLive:c}=e,d=t.getAttribute("Timescale");let h=null===d?i:+d;isNaN(h)&&(h=i);const f=t.getAttribute("Type");if(null===f)throw new Error("StreamIndex without type.");gt(bt,f)||V.warn("Smooth Parser: Unrecognized adaptation type:",f);const p=f,g=t.getAttribute("Subtype"),m=t.getAttribute("Language"),v=t.getAttribute("Url"),y=null===v?"":v;const{qualityLevels:b,cNodes:_}=vo(t,(e,t,i)=>{switch(t){case"QualityLevel":const r=a(i,p);if(null===r)return e;("video"!==p||r.bitrate>n)&&e.qualityLevels.push(r);break;case"c":e.cNodes.push(i);break}return e},{qualityLevels:[],cNodes:[]}),T=new go({timeline:$a(_),timescale:h,timeShiftBufferDepth:l,manifestReceivedTime:u});fe(0!==b.length,"Adaptation should have at least one playable representation.");const S=p+(Ot(m)?"_"+m:""),w=b.map(e=>{const t=so(y,e.bitrate,e.customAttributes),n=Ot(e.mimeType)?e.mimeType:yo[p],i=e.codecs,a=S+"_"+(r(p)?"":p+"-")+(r(n)?"":n+"-")+(r(i)?"":i+"-")+String(e.bitrate),l=[];let u;o.length>0&&(u=o[0],o.forEach(e=>{const t=e.keyId;e.keySystems.forEach(e=>{l.push({keyId:t,systemId:e.systemId})})}));const d={bitsPerSample:e.bitsPerSample,channels:e.channels,codecPrivateData:e.codecPrivateData,packetSize:e.packetSize,samplingRate:e.samplingRate,height:e.height,width:e.width,protection:r(u)?void 0:{keyId:u.keyId}},h=new co({isLive:c,sharedSmoothTimeline:T,media:t,segmentPrivateInfos:d}),f=R({},e,{index:h,cdnMetadata:[{baseUrl:s}],mimeType:n,codecs:i,id:a});if(l.length>0||void 0!==u){const e=void 0===u?[]:u.keySystems.map(e=>{const{systemId:t,privateData:n}=e,i=t.replace(/-/g,""),r=To(i,n);return{systemId:i,data:r}});if(e.length>0){const t=[{type:"cenc",values:e}];f.contentProtections={keyIds:l,initData:t}}else f.contentProtections={keyIds:l,initData:[]}}return f});if("ADVT"===g)return null;const E={id:S,type:p,representations:w,language:null===m?void 0:m};return"text"===p&&"DESC"===g&&(E.closedCaption=!0),E}function l(n,i,a){let l="";if(void 0!==i){const e=fa(i);l=i.substring(0,e)}const u=n.documentElement;if(r(u)||"SmoothStreamingMedia"!==u.nodeName)throw new Error("document root should be SmoothStreamingMedia");const c=u.getAttribute("MajorVersion"),d=u.getAttribute("MinorVersion");if(null===c||null===d||!/^[2]-[0-2]$/.test(c+"-"+d))throw new Error("Version should be 2.0, 2.1 or 2.2");const h=u.getAttribute("Timescale");let f=Ot(h)?+h:1e7;isNaN(f)&&(f=1e7);const{protections:p,adaptationNodes:g}=vo(u,(t,n,i)=>{switch(n){case"Protection":t.protections.push(Qa(i,e.keySystems));break;case"StreamIndex":t.adaptationNodes.push(i);break}return t},{adaptationNodes:[],protections:[]}),m={},v=mo(u.getAttribute("IsLive"));let y;if(v){const e=u.getAttribute("DVRWindowLength");null===e||isNaN(+e)||0===+e||(y=+e/f)}const b=g.reduce((e,t)=>{const n=o({root:t,baseUrl:l,timescale:f,protections:p,isLive:v,timeShiftBufferDepth:y,manifestReceivedTime:a});if(null===n)return e;const i=n.type,r=e[i];return void 0===r?e[i]=[n]:r.push(n),e},m);let _,T,S,w,E=null;const x=void 0!==b.video?b.video[0]:void 0,k=void 0!==b.audio?b.audio[0]:void 0;let A,I,C;if(void 0!==x||void 0!==k){const e=[],t=[];if(void 0!==x){const n=x.representations[0];if(void 0!==n){const i=n.index.getFirstAvailablePosition(),s=n.index.getLastAvailablePosition();r(i)||e.push(i),r(s)||t.push(s)}}if(void 0!==k){const n=k.representations[0];if(void 0!==n){const i=n.index.getFirstAvailablePosition(),s=n.index.getLastAvailablePosition();r(i)||e.push(i),r(s)||t.push(s)}}e.length>0&&(A=Math.max(...e)),t.length>0&&(I=Math.min(...t),C=Math.max(...t))}const D=u.getAttribute("Duration"),R=null!==D&&0!==+D?+D/f:void 0;if(v){_=e.suggestedPresentationDelay,T=t,S=null!==A&&void 0!==A?A:T;let n=C;void 0===n&&(n=Date.now()/1e3-T);let i=I;void 0===i&&(i=n),w={isLinear:!0,maximumSafePosition:i,livePosition:n,time:Se()},E=null!==y&&void 0!==y?y:null}else{S=null!==A&&void 0!==A?A:0;let e=I;void 0===e&&(e=void 0!==R?S+R:1/0),w={isLinear:!1,maximumSafePosition:e,livePosition:void 0,time:Se()}}const M=v?0:S,L=v?void 0:w.maximumSafePosition,P={availabilityStartTime:void 0===T?0:T,clockOffset:s,isLive:v,isDynamic:v,isLastPeriodKnown:!0,timeBounds:{minimumSafePosition:S,timeshiftDepth:E,maximumTimeData:w},periods:[{adaptations:b,duration:void 0!==L?L-M:R,end:L,id:"gen-smooth-period-0",start:M}],suggestedPresentationDelay:_,transportType:"smooth",uris:r(i)?[]:[i]};return ja(P),P}return l}function To(e,t){if(32!==e.length)throw new Error("HSS: wrong system id length");const n=0;return Fa("pssh",jr([n,0,0,0],Ra(e),qr(t.length),t))}var So=_o,wo=So;const Eo="json";function xo(e){const t={url:e.url,headers:e.headers,responseType:r(e.responseType)?Eo:e.responseType,timeout:e.timeout,connectionTimeout:e.connectionTimeout};return new Promise((n,i)=>{const{onProgress:s,cancelSignal:a}=e,{url:o,headers:l,responseType:u,timeout:c,connectionTimeout:d}=t,h=new XMLHttpRequest;let f,p;if(h.open("GET",o,!0),void 0!==c&&(h.timeout=c,f=setTimeout(()=>{v(),i(new nt(o,h.status,it.TIMEOUT))},c+3e3)),void 0!==d&&(p=setTimeout(()=>{v(),h.readyState!==XMLHttpRequest.DONE&&h.abort(),i(new nt(o,h.status,it.TIMEOUT))},d)),h.responseType=u,"document"===h.responseType&&h.overrideMimeType("text/xml"),!r(l)){const e=l;for(const t in e)e.hasOwnProperty(t)&&h.setRequestHeader(t,e[t])}const g=Se();let m=null;if(void 0===a||(m=a.register(function(e){v(),h.readyState!==XMLHttpRequest.DONE&&h.abort(),i(e)}),!a.isCancelled())){if(h.onerror=function(){v(),i(new nt(o,h.status,it.ERROR_EVENT))},h.ontimeout=function(){v(),i(new nt(o,h.status,it.TIMEOUT))},void 0!==d&&(h.onreadystatechange=function(){h.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&clearTimeout(p)}),void 0!==s&&(h.onprogress=function(e){const t=Se();s({url:o,duration:t-g,sendingTime:g,currentTime:t,size:e.loaded,totalSize:e.total})}),h.onload=function(e){if(h.readyState===XMLHttpRequest.DONE)if(v(),h.status>=200&&h.status<300){const t=Se(),s=h.response instanceof ArrayBuffer?h.response.byteLength:e.total,a=h.status,l=h.responseType,u=Ot(h.responseURL)?h.responseURL:o;let c;if(c="json"===l?"object"===typeof h.response?h.response:ko(h.responseText):h.response,r(c))return void i(new nt(o,h.status,it.PARSE_ERROR));n({status:a,url:u,responseType:l,sendingTime:g,receivedTime:t,requestDuration:t-g,size:s,responseData:c})}else i(new nt(o,h.status,it.ERROR_HTTP_CODE))},V.hasLevel("DEBUG")){let t="XHR: Sending GET "+o;void 0!==e.responseType&&(t+=" type="+e.responseType),void 0!==c&&(t+=" to="+String(c/1e3)),void 0!==d&&(t+=" cto="+String(d/1e3)),void 0!==(null===l||void 0===l?void 0:l.Range)&&(t+=" Range="+(null===l||void 0===l?void 0:l.Range)),V.debug(t)}h.send()}function v(){void 0!==f&&clearTimeout(f),void 0!==p&&clearTimeout(p),null!==m&&m()}})}function ko(e){try{return JSON.parse(e)}catch(e){return null}}var Ao=xo;function Io(e,t){const n=e.length;let i=0;while(i+8<=n){let r=$r(e,i);if(0===r)r=n-i;else if(1===r){if(i+16>n)return-1;r=Gr(e,i+8)}if(isNaN(r)||r<=0)return-1;const s=$r(e,i+4);if(s===t)return i+r<=n?i:-1;i+=r}return-1}function Co(e,t){if(t){const t=Io(e,1718909296);if(t<0)throw new dt("INTEGRITY_ERROR","Incomplete `ftyp` box");const n=Io(e,1836019574);if(n<0)throw new dt("INTEGRITY_ERROR","Incomplete `moov` box")}else{const t=Io(e,1836019558);if(t<0)throw new dt("INTEGRITY_ERROR","Incomplete `moof` box");const n=Io(e,1835295092);if(n<0)throw new dt("INTEGRITY_ERROR","Incomplete `mdat` box")}}function Do(e,t){return(n,i,r)=>{return new Promise((s,a)=>{const o=Date.now()-Se();let l=!1;const u=e=>{if(l||r.isCancelled())return;l=!0,r.deregister(p);const t=void 0!==e.receivingTime?e.receivingTime-o:void 0,n=void 0!==e.sendingTime?e.sendingTime-o:void 0;s({responseData:e.data,size:e.size,requestDuration:e.duration,url:e.url,receivedTime:t,sendingTime:n})},c=e=>{var t,n;if(l||r.isCancelled())return;l=!0,r.deregister(p);const i=e,s=null!==(t=null===i||void 0===i?void 0:i.message)&&void 0!==t?t:"Unknown error when fetching the Manifest through a custom manifestLoader.",o=new ln(s,null!==(n=null===i||void 0===i?void 0:i.canRetry)&&void 0!==n&&n,null===i||void 0===i?void 0:i.xhr);a(o)},d=()=>{l||r.isCancelled()||(l=!0,r.deregister(p),t(n,i,r).then(s,a))},h={reject:c,resolve:u,fallback:d},f=e({url:n,timeout:i.timeout},h);function p(e){l||(l=!0,"function"===typeof f&&f(),a(e))}r.register(p)})}}function Ro(e){return function(t,n,i){if(void 0===t)throw new Error("Cannot perform HTTP(s) request. URL not known");switch(e){case"arraybuffer":return Ao({url:t,responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i});case"text":return Ao({url:t,responseType:"text",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i});case"document":return Ao({url:t,responseType:"document",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i});default:ge(e)}}}function Mo({customManifestLoader:e},t){const n=Ro(t);return"function"!==typeof e?n:Do(e,n)}function Lo(e,t){const n=ia(e,1936286840);if(null===n)return null;let i=t;const r=n[2]-n[0];let s=n[1];const a=e[s];s+=8;const o=$r(e,s);let l;if(s+=4,0===a)l=$r(e,s),s+=4,i+=$r(e,s)+r,s+=4;else{if(1!==a)return null;l=Gr(e,s),s+=8,i+=Gr(e,s)+r,s+=8}const u=[];s+=2;let c=Vr(e,s);s+=2;while(--c>=0){const t=$r(e,s);s+=4;const n=(2147483648&t)>>>31,r=2147483647&t;if(1===n)throw new Error("sidx with reference_type `1` not yet implemented");const a=$r(e,s);s+=4,s+=4,u.push({time:l,duration:a,timescale:o,range:[i,i+r-1]}),l+=a,i+=r}return u}function Po(e){const t=aa(e);if(null===t)return;const n=ea(t,1952867444);if(null===n)return;const i=n[0];return 1===i?Gr(n,4):0===i?$r(n,4):void 0}function Oo(e){const t=ea(e,1952868452);if(null===t)return;let n=1;const i=Hr(t,n);n+=3;const r=(1&i)>0,s=(2&i)>0,a=(8&i)>0;if(!a)return;n+=4,r&&(n+=8),s&&(n+=4);const o=$r(t,n);return o}function No(e){const t=oa(e);if(0===t.length)return;let n=0;for(const i of t){const e=ea(i,1953658222);if(null===e)return;let t=0;const r=e[t];if(t+=1,r>1)return;const s=Hr(e,t);t+=3;const a=(256&s)>0;let o=0;if(!a&&(o=Oo(i),void 0===o))return;const l=(1&s)>0,u=(4&s)>0,c=(512&s)>0,d=(1024&s)>0,h=(2048&s)>0,f=$r(e,t);t+=4,l&&(t+=4),u&&(t+=4);let p=f,g=0;while(p-- >0)a?(g+=$r(e,t),t+=4):g+=o,c&&(t+=4),d&&(t+=4),h&&(t+=4);n+=g}return n}function Uo(e){const t=ua(e);if(null===t)return;const n=ea(t,1835296868);if(null===n)return;let i=0;const r=n[i];return i+=4,1===r?$r(n,i+16):0===r?$r(n,i+8):void 0}function Fo(e){const t=e.length;if(t<4)throw new Error("Cannot update box length: box too short");const n=$r(e,0);if(0===n){if(t>Oa){const n=new Uint8Array(t+8);return n.set(qr(1),0),n.set(e.subarray(4,8),4),n.set(Wr(t+8),8),n.set(e.subarray(8,t),16),n}return e.set(qr(t),0),e}if(1===n){if(t<16)throw new Error("Cannot update box length: box too short");return e.set(Wr(t),8),e}if(t<=Oa)return e.set(qr(t),0),e;{const n=new Uint8Array(t+8);return n.set(qr(1),0),n.set(e.subarray(4,8),4),n.set(Wr(t+8),8),n.set(e.subarray(8,t),16),n}}function Bo(e){const t=[];let n=0;while(n<e.length){const i=ca(e,n);if(null===i)break;const r=i.length;n+=r;const s=i[0];if(0!==s)V.warn("ISOBMFF: EMSG version "+s.toString()+" not supported.");else{let e=4;const{end:n,string:s}=Pa(i,e);e=n;const{end:a,string:o}=Pa(i,e);e=a;const l=$r(i,e);e+=4;const u=$r(i,e);e+=4;const c=$r(i,e);e+=4;const d=$r(i,e);e+=4;const h=i.subarray(e,r),f={schemeIdUri:s,value:o,timescale:l,presentationTimeDelta:u,eventDuration:c,id:d,messageData:h};t.push(f)}}if(0!==t.length)return t}function jo(e){const t=Js(e,[1836019574,1953653099,1835297121,1835626086,1937007212,1937011556]);if(null===t)return null;const n=t.subarray(8);let i=ea(n,1701733238),r=0;if(null===i?(r=28,i=ea(n,1701733217)):r=78,null===i)return null;const s=Js(i.subarray(r),[1936289382,1935894633,1952804451]);if(null===s||s.byteLength<24)return null;const a=s.subarray(8,24);return a.every(e=>0===e)?null:a}function Vo(e){const t=ra(e,3565190898,3392751253,2387879627,2655430559);if(void 0===t)return[];const n=[],i=t[0],r=t[4];for(let s=0;s<r;s++){let e,r;1===i?(r=Gr(t,16*s+5),e=Gr(t,16*s+5+8)):(r=$r(t,8*s+5),e=$r(t,8*s+5+4)),n.push({time:r,duration:e})}return n}function Ho(e){const t=ra(e,1830656773,1121273062,2162299933,2952222642);if(void 0!==t)return{duration:Gr(t,12),time:Gr(t,4)}}function $o(e,t,n,i,r){var s;const a=[];let o,l,u;if(r){const t=aa(e);null!==t?(u=Vo(t),l=Ho(t)):V.warn("smooth: could not find traf atom")}if(void 0!==u)for(let p=0;p<u.length;p++)a.push({time:u[p].time,duration:u[p].duration,timescale:n});if(void 0!==l)return o={time:l.time/n,duration:l.duration/n},{nextSegments:a,chunkInfos:o,scaledSegmentTime:l.time};if(t||!i.complete)return{nextSegments:a,chunkInfos:null,scaledSegmentTime:void 0};const c=i.duration*n,d=Math.min(.9*n,c/4),h=No(e),f=void 0!==(null===(s=i.privateInfos)||void 0===s?void 0:s.smoothMediaSegment)?i.privateInfos.smoothMediaSegment.time:Math.round(i.time*n);return o=void 0!==h&&Math.abs(h-c)<=d?{time:i.time,duration:h/n}:{time:i.time,duration:i.duration},{nextSegments:a,chunkInfos:o,scaledSegmentTime:f}}function Go(e){return"string"===typeof e&&e.indexOf("mp4")>=0}function zo(){return!h}function qo(e,t,n,i,r,s,a){return Fa("avc1",jr(6,zr(1),16,zr(e),zr(t),zr(n),2,zr(i),6,[0,1,r.length],Aa(r),31-r.length,zr(s),[255,255],a))}function Wo(e,t,n,i,r,s,a,o){return Fa("encv",jr(6,zr(1),16,zr(e),zr(t),zr(n),2,zr(i),6,[0,1,r.length],Aa(r),31-r.length,zr(s),[255,255],a,o))}function Ko(e,t,n,i,r,s){return Fa("mp4a",jr(6,zr(e),8,zr(t),zr(n),2,zr(i),zr(r),2,s))}function Yo(e,t,n,i,r,s,a){return Fa("enca",jr(6,zr(e),8,zr(t),zr(n),2,zr(i),zr(r),2,s,a))}function Xo(e){return Fa("dref",jr(7,[1],e))}function Qo(e,t){const n=jr(...[Aa(e),[0,0,0,1]].concat(t.map(Aa)));return Fa("ftyp",n)}function Zo(e,t){return Fa("schm",jr(4,Aa(e),qr(t)))}function Jo(e){return Fa("tfdt",jr([1,0,0,0],Wr(e)))}function el(){const e=new Uint8Array(12);return e[3]=1,Fa("vmhd",e)}function tl(e){return Fa("trex",jr(4,qr(e),[0,0,0,1],12))}function nl(e){return Fa("free",new Uint8Array(e-8))}function il(e,t){return Fa("esds",jr(4,[3,25],zr(e),[0,4,17,64,21],11,[5,2],Ra(t),[6,1,2]))}function rl(e){return Fa("frma",Aa(e))}function sl(e,t,n){let i;i=2===n?1:4===n?3:0;const r=e[1],s=e[2],a=e[3];return Fa("avcC",jr([1,r,s,a,252|i,225],zr(e.length),e,[1],zr(t.length),t))}function al(e){let t,n;switch(e){case"video":t="vide",n="VideoHandler";break;case"audio":t="soun",n="SoundHandler";break;default:t="hint",n="";break}return Fa("hdlr",jr(8,Aa(t),12,Aa(n),1))}function ol(e){return Fa("mdhd",jr(12,qr(e),8))}function ll(e,t){return Fa("mvhd",jr(12,qr(e),4,[0,1],2,[1,0],10,[0,1],14,[0,1],14,[64,0,0,0],26,zr(t+1)))}function ul(e,t,n,i){return Fa("saio",jr(4,[0,0,0,1],qr(e.length+t.length+n.length+i.length+8+8+8+8)))}function cl(e){if(0===e.length)return Fa("saiz",new Uint8Array(0));const t=$r(e,0),n=$r(e,4),i=new Uint8Array(n+9);i.set(qr(n),5);let r,s,a=9,o=8;while(o<e.length)o+=8,2===(2&t)?(s=2,r=Vr(e,o),o+=6*r+2):(r=0,s=0),i[a]=6*r+8+s,a++;return Fa("saiz",i)}function dl(){return Fa("smhd",new Uint8Array(8))}function hl(e){const t=[7,[e.length]];return Fa("stsd",jr(...t.concat(e)))}function fl(e,t,n){return Fa("tkhd",jr(qr(7),8,qr(n),20,[1,0,0,0],[0,1,0,0],12,[0,1,0,0],12,[64,0,0,0],zr(e),2,zr(t),2))}function pl(e,t,n){return Fa("tenc",jr(6,[e,t],n))}function gl(e,t,n,i,r){const s=[e,t,n];return void 0!==r&&s.push(Fa("senc",r),cl(r),ul(i,e,t,n)),Ba("traf",s)}function ml(e,t){const n=ia(e,1836019558);if(null===n)throw new Error("Smooth: Invalid ISOBMFF given");const i=e.subarray(n[1],n[2]),r=na(i,1835427940),s=ea(i,1953653094);if(null===s||null===r)throw new Error("Smooth: Invalid ISOBMFF given");const a=ia(s,1952868452),o=ia(s,1953658222);if(null===a||null===o)throw new Error("Smooth: Invalid ISOBMFF given");const l=s.subarray(a[0],a[2]),u=s.subarray(o[0],o[2]);l.set([0,0,0,1],a[1]-a[0]+4);const c=Jo(t),d=vl(u,o[1]-o[0]),h=ra(s,2721664850,1520127764,2722393154,2086964724),f=gl(l,c,d,r,h),p=Ba("moof",[r,f]),g=ia(p,1836019558),m=ia(f,1953653094),v=ia(d,1953658222);if(null===g||null===m||null===v)throw new Error("Smooth: Invalid moof, trun or traf generation");const y=g[1]-g[0]+r.length+(m[1]-m[0])+l.length+c.length+(v[1]-v[0])+8,b=n[2]-n[0],_=p.length-b,T=ia(e,1835295092);if(null===T)throw new Error("Smooth: Invalid ISOBMFF given");if(zo()&&(0===_||_<=-8)){const t=T[1];return p.set(qr(t),y),e.set(p,n[0]),_<=-8&&e.set(nl(-_),p.length),e}{const t=T[1]+_;p.set(qr(t),y);const i=new Uint8Array(e.length+_),r=e.subarray(0,n[0]),s=e.subarray(n[2],e.length);return i.set(r,0),i.set(p,r.length),i.set(s,r.length+p.length),i}}function vl(e,t){const n=(1&e[t+3])>0;if(n)return e;const i=new Uint8Array(e.length+4);return i.set(e.subarray(0,t+8),0),i[t+3]=1|i[t+3],i.set([0,0,0,0],t+8),i.set(e.subarray(t+8,e.length),t+12),Fo(i)}function yl([e,t]){return t===1/0?`bytes=${e}-`:`bytes=${e}-${t}`}function bl(e,t,n){const i=[e,t,n];return Ba("moov",i)}function _l(e,t,n,i,r,s){const a=Ba("stbl",[n,Fa("stts",new Uint8Array(8)),Fa("stsc",new Uint8Array(8)),Fa("stsz",new Uint8Array(12)),Fa("stco",new Uint8Array(8))]),o=Fa("url ",new Uint8Array([0,0,0,1])),l=Xo(o),u=Ba("dinf",[l]),c=Ba("minf",[i,u,a]),d=al(t),h=ol(e),f=Ba("mdia",[h,d,c]),p=fl(r,s,1),g=Ba("trak",[p,f]),m=tl(1),v=Ba("mvex",[m]),y=ll(e,1),b=bl(y,v,g),_=Qo("isom",["isom","iso2","iso6","avc1","dash"]);return jr(_,b)}function Tl(e,t,n,i,r,s,a,o){const[,l,u]=a.split("00000001");if(void 0===l||void 0===u)throw new Error("Smooth: unsupported codec private data.");const c=Ra(l),d=Ra(u),h=sl(c,d,s);let f;if(void 0===o){const e=qo(t,n,i,r,"AVC Coding",24,h);f=hl([e])}else{const e=pl(1,8,o),s=Ba("schi",[e]),a=Zo("cenc",65536),l=rl("avc1"),u=Ba("sinf",[l,a,s]),c=Wo(t,n,i,r,"AVC Coding",24,h,u);f=hl([c])}return _l(e,"video",f,el(),t,n)}const Sl=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];function wl(e,t,n){const i=Sl.indexOf(t);let r;return r=(63&e)<<4,r=(r|31&i)<<4,r=(r|31&n)<<3,Ma(zr(r))}function El(e,t,n,i,r,s,a){const o=0===s.length?wl(2,r,t):s,l=il(1,o),u=(()=>{if(void 0===a){const e=Ko(1,t,n,i,r,l);return hl([e])}const e=pl(1,8,a),s=Ba("schi",[e]),o=Zo("cenc",65536),u=rl("mp4a"),c=Ba("sinf",[u,o,s]),d=Yo(1,t,n,i,r,l,c);return hl([d])})();return _l(e,"audio",u,dl(),0,0)}function xl(e,t,n,i,r,s){let a;const o=t.segment.range;return Array.isArray(o)&&(a={Range:yl(o)}),Ao({url:e,responseType:"arraybuffer",headers:a,timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:r,onProgress:n.onProgress}).then(e=>{const n=Go(t.mimeType);if(!n||!0!==s)return{resultType:"segment-loaded",resultData:e};const i=new Uint8Array(e.responseData);return Co(i,t.segment.isInit),{resultType:"segment-loaded",resultData:Object.assign(Object.assign({},e),{responseData:i})}})}const kl=({checkMediaSegmentIntegrity:e,segmentLoader:t})=>(n,i,r,s,a)=>{const{segment:o}=i;if(o.isInit){if(void 0===o.privateInfos||void 0===o.privateInfos.smoothInitSegment)throw new Error("Smooth: Invalid segment format");const e=o.privateInfos.smoothInitSegment;let t;const{codecPrivateData:n,timescale:r,height:s,width:a,protection:l={keyId:void 0,keySystems:void 0}}=e;if(void 0===n)throw new Error("Smooth: no codec private data.");switch(i.type){case"video":t=Tl(r,null!==a&&void 0!==a?a:0,null!==s&&void 0!==s?s:0,72,72,4,n,l.keyId);break;case"audio":{const{channels:i=0,bitsPerSample:s=0,packetSize:a=0,samplingRate:o=0}=e;t=El(r,i,s,a,o,n,l.keyId);break}default:0,t=new Uint8Array(0)}return Promise.resolve({resultType:"segment-created",resultData:t})}return null===n?Promise.resolve({resultType:"segment-created",resultData:null}):"function"!==typeof t?xl(n,i,a,r,s,e):new Promise((o,l)=>{let u=!1;const c=t=>{if(u||s.isCancelled())return;u=!0,s.deregister(y);const n=Go(i.mimeType);n&&!0===e||o({resultType:"segment-loaded",resultData:{responseData:t.data,size:t.size,requestDuration:t.duration}});const r=t.data instanceof Uint8Array?t.data:new Uint8Array(t.data);Co(r,i.segment.isInit),o({resultType:"segment-loaded",resultData:{responseData:r,size:t.size,requestDuration:t.duration}})},d=e=>{var t,n;if(u||s.isCancelled())return;u=!0,s.deregister(y);const i=e,r=null!==(t=null===i||void 0===i?void 0:i.message)&&void 0!==t?t:"Unknown error when fetching a Smooth segment through a custom segmentLoader.",a=new ln(r,null!==(n=null===i||void 0===i?void 0:i.canRetry)&&void 0!==n&&n,null===i||void 0===i?void 0:i.xhr);l(a)},h=e=>{u||s.isCancelled()||a.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize})},f=()=>{u||s.isCancelled()||(u=!0,s.deregister(y),xl(n,i,a,r,s,e).then(o,l))},p={reject:d,resolve:c,fallback:f,progress:h};let g;void 0!==i.segment.range&&(g=[i.segment.range],void 0!==i.segment.indexRange&&g.push(i.segment.indexRange));const m={isInit:i.segment.isInit,timeout:r.timeout,byteRanges:g,trackType:i.type,url:n},v=t(m,p);function y(e){u||(u=!0,u||"function"!==typeof v||v(),l(e))}s.register(y)})};var Al=kl;function Il(e,t){return null===e?null:null===t.url?e.baseUrl:Sa(e.baseUrl,t.url)}var Cl=function(e){const t=wo(e),n=Al(e),i={customManifestLoader:e.manifestLoader},r=Mo(i,"text"),s={loadManifest:r,parseManifest(n,i){var r;const s=null!==(r=n.url)&&void 0!==r?r:i.originalUrl,{receivedTime:a,responseData:o}=n,l="string"===typeof o?(new DOMParser).parseFromString(o,"text/xml"):o,u=t(l,s,a),c=[],d=new an(u,{representationFilter:e.representationFilter},c);return{manifest:d,url:s,warnings:c}}},a={loadSegment(e,t,i,r,s){const a=Il(e,t.segment);return n(a,t,i,r,s)},parseSegment(e,t,n){var i,r;const{segment:s}=t,{data:a,isChunked:o}=e;if(null===a)return s.isInit?{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:"media",chunkData:null,chunkInfos:null,chunkOffset:0,chunkSize:0,protectionData:[],appendWindow:[void 0,void 0]};const l=a instanceof Uint8Array?a:new Uint8Array(a);if(s.isInit){const e=null===(r=null===(i=s.privateInfos)||void 0===i?void 0:i.smoothInitSegment)||void 0===r?void 0:r.timescale;return{segmentType:"init",initializationData:a,initializationDataSize:a.byteLength,initTimescale:e,protectionData:[]}}const u=void 0!==n?$o(l,o,n,s,t.isLive):null;if(null===u||null===u.chunkInfos||void 0===u.scaledSegmentTime)throw new Error("Smooth Segment without time information");const{nextSegments:c,chunkInfos:d,scaledSegmentTime:h}=u,f=ml(l,h),p=c.length>0?c:void 0;return{segmentType:"media",chunkData:f,chunkInfos:d,chunkOffset:0,chunkSize:f.length,protectionData:[],predictedSegments:p,appendWindow:[void 0,void 0]}}},o={loadSegment(t,n,i,r,s){const{segment:a}=n,o=Il(t,a);if(a.isInit||null===o)return Promise.resolve({resultType:"segment-created",resultData:null});const l=Go(n.mimeType);return l?Ao({url:o,responseType:"arraybuffer",timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:r,onProgress:s.onProgress}).then(t=>{if(!0!==e.checkMediaSegmentIntegrity)return{resultType:"segment-loaded",resultData:t};const i=new Uint8Array(t.responseData);return Co(i,n.segment.isInit),{resultType:"segment-loaded",resultData:Object.assign(Object.assign({},t),{responseData:i})}}):Ao({url:o,responseType:"text",timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:r,onProgress:s.onProgress}).then(e=>({resultType:"segment-loaded",resultData:e}))},parseSegment(e,t,n){var i;const{segment:r,language:s,mimeType:a="",codecs:o=""}=t,l=Go(t.mimeType),{data:u,isChunked:c}=e;let d,h;if(r.isInit)return{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0};if(null===u)return{segmentType:"media",chunkData:null,chunkInfos:null,chunkOffset:0,chunkSize:0,protectionData:[],appendWindow:[void 0,void 0]};let f,p,g,m,v=null;if(l){let e;e="string"===typeof u?Aa(u):u instanceof Uint8Array?u:new Uint8Array(u),d=e.length;const s=void 0!==n?$o(e,c,n,r,t.isLive):null;h=null===s||void 0===s?void 0:s.nextSegments,v=null!==(i=null===s||void 0===s?void 0:s.chunkInfos)&&void 0!==i?i:null,null===v?c?V.warn("Smooth: Unavailable time data for current text track."):(f=r.time,p=r.end):(f=v.time,p=void 0!==v.duration?v.time+v.duration:r.end);const l=o.toLowerCase();if("application/ttml+xml+mp4"===a||"stpp"===l||"stpp.ttml.im1t"===l)m="ttml";else{if("wvtt"!==l)throw new Error(`could not find a text-track parser for the type ${a}`);m="vtt"}const y=la(e);g=null===y?"":Da(y)}else{let e;if(f=r.time,p=r.end,"string"!==typeof u){const t=u instanceof Uint8Array?u:new Uint8Array(u);d=t.length,e=Da(t)}else e=u;switch(a){case"application/x-sami":case"application/smil":m="sami";break;case"application/ttml+xml":m="ttml";break;case"text/vtt":m="vtt";break}if(void 0===m){const e=o.toLowerCase();if("srt"!==e)throw new Error(`could not find a text-track parser for the type ${a}`);m="srt"}g=e}const y=Array.isArray(h)&&h.length>0?h:void 0,b=null!==f&&void 0!==f?f:0;return{segmentType:"media",chunkData:{type:m,data:g,start:f,end:p,language:s},chunkSize:d,chunkInfos:v,chunkOffset:b,protectionData:[],predictedSegments:y,appendWindow:[void 0,void 0]}}};return{manifest:s,audio:a,video:a,text:o}},Dl=Cl;function Rl(e){void 0===e.transports.smooth&&(e.transports.smooth=Dl),e.mainThreadMediaSourceInit=Hs,e.codecSupportProber=Zs}class Ml{constructor(){this._refs=new Map,this._stored=[]}addReferences(e){for(const t of e)void 0!==t.attributes.refId&&this._refs.set(t.attributes.refId,t)}add(e,t){this._tryParsing(e,t,!1)||this._stored.push([e,t]),void 0!==t.attributes.refId&&(this._refs.set(t.attributes.refId,t),this._resolveStoredRefs(!1))}finalize(){this._resolveStoredRefs(!0)}_resolveStoredRefs(e){for(let t=this._stored.length-1;t>=0;t--){const[n,i]=this._stored[t];(this._tryParsing(n,i,e)||e)&&this._stored.splice(t,1)}return 0===this._stored.length}_tryParsing(e,t,n){if(void 0===t.attributes.ref)return Ll(e,t),!0;const i=this._getReferenced(t.attributes.ref);return void 0===i?(n&&(V.warn("DASH: forcing the parsing of a referencing ContentProtection"),Ll(e,t)),!1):(t.children.cencPssh.push(...i.children.cencPssh),void 0===t.attributes.keyId&&void 0!==i.attributes.keyId&&(t.attributes.keyId=i.attributes.keyId),void 0===t.attributes.schemeIdUri&&void 0!==i.attributes.schemeIdUri&&(t.attributes.schemeIdUri=i.attributes.schemeIdUri),void 0===t.attributes.value&&void 0!==i.attributes.value&&(t.attributes.value=i.attributes.value),Ll(e,t),!0)}_getReferenced(e){return this._refs.get(e)}}function Ll(e,t){let n;if(void 0!==t.attributes.schemeIdUri&&"urn:uuid:"===t.attributes.schemeIdUri.substring(0,9)&&(n=t.attributes.schemeIdUri.substring(9).replace(/-/g,"").toLowerCase()),void 0!==t.attributes.keyId&&t.attributes.keyId.length>0){const i={keyId:t.attributes.keyId,systemId:n};void 0===e.contentProtections?e.contentProtections={keyIds:[i],initData:[]}:void 0===e.contentProtections.keyIds?e.contentProtections.keyIds=[i]:e.contentProtections.keyIds.push(i)}if(void 0===n)return;const{cencPssh:i}=t.children,r=[];for(const a of i)r.push({systemId:n,data:a});if(0===r.length)return;if(void 0===e.contentProtections)return void(e.contentProtections={keyIds:[],initData:[{type:"cenc",values:r}]});const s=De(e.contentProtections.initData,e=>"cenc"===e.type);void 0===s?e.contentProtections.initData.push({type:"cenc",values:r}):s.values.push(...r)}function Pl(e){const t=Date.parse(e)-Se();if(!isNaN(t))return t;V.warn("DASH Parser: Invalid clock received: ",e)}function Ol(e){const t=e.children.utcTimings.filter(e=>("urn:mpeg:dash:utc:http-iso:2014"===e.schemeIdUri||"urn:mpeg:dash:utc:http-xsdate:2014"===e.schemeIdUri)&&void 0!==e.value);return t.length>0?t[0].value:void 0}function Nl(e){const{representations:t}=e;let n=null;for(let i=0;i<t.length;i++){const e=t[i].index.getLastAvailablePosition();if(void 0===e)return;null!==e&&(n=null===n?e:Math.min(n,e))}return null===n?null:n}function Ul(e){for(let t=e.length-1;t>=0;t--){const n=e[t].adaptations,i=void 0===n.audio?void 0:n.audio[0],r=void 0===n.video?void 0:n.video[0];if(void 0!==i||void 0!==r){let e=null,t=null;if(void 0!==i){const t=Nl(i);if(void 0===t)return{safe:void 0,unsafe:void 0};e=t}if(void 0!==r){const e=Nl(r);if(void 0===e)return{safe:void 0,unsafe:void 0};t=e}if(void 0!==i&&null===e||void 0!==r&&null===t)return V.info("Parser utils: found Period with no segment. ","Going to previous one to calculate last position"),{safe:void 0,unsafe:void 0};if(null!==t)return null!==e?{safe:Math.min(e,t),unsafe:Math.max(e,t)}:{safe:t,unsafe:t};if(null!==e)return{safe:e,unsafe:e}}}return{safe:void 0,unsafe:void 0}}function Fl(e){const{representations:t}=e;let n=null;for(let i=0;i<t.length;i++){const e=t[i].index.getFirstAvailablePosition();if(void 0===e)return;null!==e&&(n=null===n?e:Math.max(n,e))}return null===n?null:n}function Bl(e){for(let t=0;t<=e.length-1;t++){const n=e[t].adaptations,i=void 0===n.audio?void 0:n.audio[0],r=void 0===n.video?void 0:n.video[0];if(void 0!==i||void 0!==r){let e=null,t=null;if(void 0!==i){const t=Fl(i);if(void 0===t)return;e=t}if(void 0!==r){const e=Fl(r);if(void 0===e)return;t=e}if(void 0!==i&&null===e||void 0!==r&&null===t)return void V.info("Parser utils: found Period with no segment. ","Going to next one to calculate first position");if(null!==t)return null!==e?Math.max(e,t):t;if(null!==e)return e}}}function jl(e){if(0===e.length)throw new Error("DASH Parser: no period available for a dynamic content");const t=Bl(e),n=Ul(e);return{minimumSafePosition:t,maximumSafePosition:n.safe,maximumUnsafePosition:n.unsafe}}class Vl{constructor(e){this._isDynamic=e.isDynamic,this._timeShiftBufferDepth=e.isDynamic&&void 0!==e.timeShiftBufferDepth?e.timeShiftBufferDepth:null,this._serverTimestampOffset=e.serverTimestampOffset,this._availabilityStartTime=e.availabilityStartTime}setLastPosition(e,t){this._lastPosition=e,this._positionTime=t}lastPositionIsKnown(){return this._isDynamic?void 0!==this._positionTime&&void 0!==this._lastPosition:void 0!==this._lastPosition}getEstimatedMinimumSegmentTime(){var e;if(!this._isDynamic||null===this._timeShiftBufferDepth)return 0;const t=null!==(e=this.getEstimatedLiveEdge())&&void 0!==e?e:this.getEstimatedMaximumPosition(0);if(void 0===t)return;const n=t-this._timeShiftBufferDepth;return n}getEstimatedLiveEdge(){if(this._isDynamic&&void 0!==this._serverTimestampOffset)return(Se()+this._serverTimestampOffset)/1e3-this._availabilityStartTime}getEstimatedMaximumPosition(e){if(!this._isDynamic)return this._lastPosition;const t=this.getEstimatedLiveEdge();return void 0!==t&&e!==1/0?t+e:void 0!==this._positionTime&&void 0!==this._lastPosition?Math.max(this._lastPosition-this._positionTime+Se()/1e3,0):this._lastPosition}}function Hl(e,t){return"dynamic"!==e.type?0:r(e.availabilityStartTime)?null!==t&&void 0!==t?t:0:e.availabilityStartTime}function $l(e,t){return"function"===typeof Array.prototype.flatMap?e.flatMap(t):e.reduce((e,n)=>{const i=t(n);return Array.isArray(i)?(e.push(...i),e):(e.push(i),e)},[])}function Gl(e){if(0===e.length)return[];const t=[e[0]];for(let n=1;n<e.length;n++){const i=e[n];let r=t[t.length-1];while(void 0===r.duration||r.start+r.duration>i.start){if(V.warn("DASH: Updating overlapping Periods.",null===r||void 0===r?void 0:r.start,i.start),r.duration=i.start-r.start,r.end=i.start,r.duration>0)break;if(t.pop(),0===t.length)break;r=t[t.length-1]}t.push(i)}return t}function zl(e,t){const n=[];return e.forEach((i,s)=>{let a,o;if(r(i.attributes.start))if(0===s)a=!t.isDynamic||r(t.availabilityStartTime)?0:t.availabilityStartTime;else{const e=n[n.length-1];if(r(e)||r(e.periodEnd))throw new Error("Missing start time when parsing periods.");a=e.periodEnd}else a=i.attributes.start;const l=e[s+1];r(i.attributes.duration)?s===e.length-1?o=t.duration:r(l.attributes.start)||(o=l.attributes.start-a):o=i.attributes.duration;const u=r(o)?void 0:a+o;n.push({periodStart:a,periodDuration:o,periodEnd:u})}),n}function ql(e,t){for(const n of t){const{adaptation:t,trickModeAttachedAdaptationIds:i}=n;for(const n of i)for(const i of bt){const r=e[i];if(void 0!==r)for(const e of r)e.id===n&&(void 0===e.trickModeTracks&&(e.trickModeTracks=[]),e.trickModeTracks.push(t))}}}var Wl=ql;const Kl=["subtitle","caption"];function Yl(e,t,n,i){function r(e,t){const n=e.split("/")[0];return gt(bt,n)?n:"application/ttml+xml"===e?"text":"application/mp4"===e&&null!==t&&void 0!==De(t,e=>"urn:mpeg:dash:role:2011"===e.schemeIdUri&&gt(Kl,e.value))?"text":void 0}function s(e){switch(e.substring(0,3)){case"avc":case"hev":case"hvc":case"vp8":case"vp9":case"av1":return"video";case"vtt":return"text"}switch(e.substring(0,4)){case"mp4a":return"audio";case"wvtt":case"stpp":return"text"}}if(null!==t){const e=r(t,i);if(void 0!==e)return e}if(null!==n){const e=s(n);if(void 0!==e)return e}for(let a=0;a<e.length;a++){const t=e[a],{mimeType:n,codecs:o}=t.attributes;if(void 0!==n){const e=r(n,i);if(void 0!==e)return e}if(void 0!==o){const e=s(o);if(void 0!==e)return e}}}const Xl=/[, ]+/g;function Ql(e){return Ot(e)?e.trim().replace(Xl,", "):""}function Zl(e){const[t,n,i,r,s,a,o,l]=e.split(".");if("vp08"!==t&&"vp09"!==t&&"vp10"!==t)return;let u,c,d;return(void 0!==r&&"10"===r||"12"===r)&&(u=parseInt(r,10)),void 0!==o&&("16"===o?c="pq":"18"===o&&(c="hlg")),void 0!==a&&void 0!==l&&"09"===a&&"09"===l&&(d="rec2020"),void 0!==u&&void 0!==c?{colorDepth:u,eotf:c,colorSpace:d}:void 0}function Jl(e,t){var n;const{initialization:i}=e,s={};return void 0!==t&&(s.isEMSGWhitelisted=t),{id:"init",isInit:!0,time:0,end:0,duration:0,timescale:1,range:r(i)?void 0:i.range,indexRange:e.indexRange,url:null!==(n=null===i||void 0===i?void 0:i.url)&&void 0!==n?n:null,complete:!0,privateInfos:s,timestampOffset:-e.indexTimeOffset/e.timescale}}function eu(e,t){const n=e.toString();if(n.length>=t)return n;const i=new Array(t+1).join("0")+n;return i.slice(-t)}function tu(e){return(t,n,i)=>{const r=Ot(i)?parseInt(i,10):1;return eu(String(e),r)}}function nu(e,t,n){return iu(e,t,n)}function iu(e,t,n){return-1===e.indexOf("$")?e:e.replace(/\$\$/g,"$").replace(/\$RepresentationID\$/g,String(t)).replace(/\$Bandwidth(\%0(\d+)d)?\$/g,tu(void 0===n?0:n))}function ru(e,t){return function(n){return-1===n.indexOf("$")?n:n.replace(/\$\$/g,"$").replace(/\$Number(\%0(\d+)d)?\$/g,(e,n,i)=>{if(void 0===t)throw new Error("Segment number not defined in a $Number$ scheme");return tu(t)(e,n,i)}).replace(/\$Time(\%0(\d+)d)?\$/g,(t,n,i)=>{if(void 0===e)throw new Error("Segment time not defined in a $Time$ scheme");return tu(e)(t,n,i)})}}function su(e,t,n){const i=n-e;return i>0?Math.floor(i/t):0}function au(e,t,n,i,r,s){var a;const o=i.getEstimatedMaximumPosition(null!==(a=e.availabilityTimeOffset)&&void 0!==a?a:0),l=Math.min(t+n,null!==o&&void 0!==o?o:1/0),u=eo(t,e),c=eo(l,e),{timeline:d,timescale:h,segmentUrlTemplate:f,startNumber:p,endNumber:g}=e;let m=null!==p&&void 0!==p?p:1;const v=[],y=d.length;for(let b=0;b<y;b++){const t=d[b],{duration:n,start:i,range:a}=t;let l;l=void 0===o?r:Math.min(o*h,null!==r&&void 0!==r?r:1/0);const p=Za(t,d[b+1],l),_=!1!==e.availabilityTimeComplete||b!==y-1&&0!==p;let T=su(i,n,u),S=i+T*n;while(S<c&&T<=p){const t=m+T;if(void 0!==g&&t>g)break;const r=null===f?null:ru(S,t)(f);let o=S-e.indexTimeOffset,l=n;o<0&&(l=n+o,o=0);const u={id:String(S),time:o/h,end:(o+l)/h,duration:l/h,isInit:!1,range:a,timescale:1,url:r,number:t,timestampOffset:-e.indexTimeOffset/h,complete:_,privateInfos:{isEMSGWhitelisted:s}};v.push(u),T++,S=i+T*n}if(S>=c)return v;if(m+=p+1,void 0!==g&&m>g)return v}return v}function ou(e,t){if(t.timescale!==e.timescale){const{timescale:n}=e;e.timeline.push({start:t.time/t.timescale*n,duration:t.duration/t.timescale*n,repeatCount:void 0===t.count?0:t.count,range:t.range})}else e.timeline.push({start:t.time,duration:t.duration,repeatCount:void 0===t.count?0:t.count,range:t.range});return!0}class lu{constructor(e,t){var n,i,s,a;const{periodStart:o,periodEnd:l,representationId:u,representationBitrate:c,isEMSGWhitelisted:d}=t,h=null!==(n=e.timescale)&&void 0!==n?n:1,f=null!==(i=e.presentationTimeOffset)&&void 0!==i?i:0,p=f-o*h,g=void 0===(null===(s=e.initialization)||void 0===s?void 0:s.media)?null:nu(e.initialization.media,u,c),m=void 0===e.media?null:nu(e.media,u,c);let v;void 0!==e.initialization?v=e.initialization.range:void 0!==e.indexRange&&(v=[0,e.indexRange[0]-1]),this._index={indexRange:e.indexRange,indexTimeOffset:p,initialization:{url:g,range:v},segmentUrlTemplate:m,startNumber:e.startNumber,endNumber:e.endNumber,timeline:null!==(a=e.timeline)&&void 0!==a?a:[],timescale:h},this._manifestBoundsCalculator=t.manifestBoundsCalculator,this._scaledPeriodStart=eo(o,this._index),this._scaledPeriodEnd=r(l)?void 0:eo(l,this._index),this._isInitialized=this._index.timeline.length>0,this._isEMSGWhitelisted=d}getInitSegment(){return Jl(this._index,this._isEMSGWhitelisted)}getSegments(e,t){return au(this._index,e,t,this._manifestBoundsCalculator,this._scaledPeriodEnd,this._isEMSGWhitelisted)}shouldRefresh(){return!1}getFirstAvailablePosition(){const e=this._index;return 0===e.timeline.length?null:to(Math.max(this._scaledPeriodStart,e.timeline[0].start),e)}getLastAvailablePosition(){var e;const{timeline:t}=this._index;if(0===t.length)return null;const n=t[t.length-1],i=Math.min(Ja(n,null,this._scaledPeriodEnd),null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0);return to(i,this._index)}getEnd(){return this.getLastAvailablePosition()}awaitSegmentBetween(){return!1}isSegmentStillAvailable(){return!0}checkDiscontinuity(){return null}canBeOutOfSyncError(){return!1}isStillAwaitingFutureSegments(){return!1}isInitialized(){return this._isInitialized}initialize(e){if(!this._isInitialized){for(let t=0;t<e.length;t++)ou(this._index,e[t]);this._isInitialized=!0}}addPredictedSegments(){V.warn("Cannot add predicted segments to a `BaseRepresentationIndex`")}_replace(e){this._index=e._index,this._isInitialized=e._isInitialized,this._scaledPeriodEnd=e._scaledPeriodEnd,this._isEMSGWhitelisted=e._isEMSGWhitelisted}_update(){V.error("Base RepresentationIndex: Cannot update a SegmentList")}}class uu{constructor(e,t){var n,i,s;if(void 0===e.duration)throw new Error("Invalid SegmentList: no duration");const{periodStart:a,periodEnd:o,representationId:l,representationBitrate:u,isEMSGWhitelisted:c}=t;this._isEMSGWhitelisted=c,this._periodStart=a,this._periodEnd=o;const d=null!==(n=e.presentationTimeOffset)&&void 0!==n?n:0,h=null!==(i=e.timescale)&&void 0!==i?i:1,f=d-a*h,p=void 0===(null===(s=e.initialization)||void 0===s?void 0:s.media)?null:nu(e.initialization.media,l,u),g=e.list.map(e=>({url:void 0===e.media?null:nu(e.media,l,u),mediaRange:e.mediaRange}));this._index={list:g,timescale:h,duration:e.duration,indexTimeOffset:f,indexRange:e.indexRange,initialization:r(e.initialization)?void 0:{url:p,range:e.initialization.range}}}getInitSegment(){const e=Jl(this._index);return void 0===e.privateInfos&&(e.privateInfos={}),e.privateInfos.isEMSGWhitelisted=this._isEMSGWhitelisted,e}getSegments(e,t){const n=this._index,{duration:i,list:r,timescale:s}=n,a=i/s,o=e-this._periodStart,[l,u]=no(o,t,s),c=Math.min(r.length-1,Math.floor(u/i)),d=[];let h=Math.floor(l/i);while(h<=c){const e=r[h].mediaRange,t=r[h].url,i=h*a+this._periodStart,o={id:String(h),time:i,isInit:!1,range:e,duration:a,timescale:1,end:i+a,url:t,timestampOffset:-n.indexTimeOffset/s,complete:!0,privateInfos:{isEMSGWhitelisted:this._isEMSGWhitelisted}};d.push(o),h++}return d}shouldRefresh(e,t){return!1}getFirstAvailablePosition(){return this._periodStart}getLastAvailablePosition(){var e;const t=this._index,{duration:n,list:i}=t;return Math.min(i.length*n/t.timescale+this._periodStart,null!==(e=this._periodEnd)&&void 0!==e?e:1/0)}getEnd(){return this.getLastAvailablePosition()}awaitSegmentBetween(){return!1}isSegmentStillAvailable(){return!0}checkDiscontinuity(){return null}canBeOutOfSyncError(){return!1}isStillAwaitingFutureSegments(){return!1}isInitialized(){return!0}initialize(){V.error("A `ListRepresentationIndex` does not need to be initialized")}addPredictedSegments(){V.warn("Cannot add predicted segments to a `ListRepresentationIndex`")}_replace(e){this._index=e._index}_update(){V.error("A `ListRepresentationIndex` cannot be updated")}}function cu(e){return N.getCurrent().DEFAULT_MAXIMUM_TIME_ROUNDING_ERROR*e}function du(e,t,n){let i=e.start,s=e.duration;const a=e.repeatCount;return void 0===i&&(null===t?i=0:r(t.duration)||(i=t.start+t.duration*(t.repeatCount+1))),void 0!==s&&!isNaN(s)||null===n||void 0===n.start||isNaN(n.start)||void 0===i||isNaN(i)||(s=n.start-i),void 0===i||isNaN(i)||void 0===s||isNaN(s)||void 0!==a&&isNaN(a)?(V.warn('DASH: A "S" Element could not have been parsed.'),null):{start:i,duration:s,repeatCount:void 0===a?0:a}}function hu(e){const t={};for(const n of Object.keys(e.attributes)){const i=e.attributes[n];if(!r(i))switch(n){case"t":const e=parseInt(i,10);isNaN(e)?V.warn(`DASH: invalid t ("${i}")`):t.start=e;break;case"d":const r=parseInt(i,10);isNaN(r)?V.warn(`DASH: invalid d ("${i}")`):t.duration=r;break;case"r":const s=parseInt(i,10);isNaN(s)?V.warn(`DASH: invalid r ("${i}")`):t.repeatCount=s;break}}return t}function fu(e){const t={};for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];switch(i.name){case"t":const e=parseInt(i.value,10);isNaN(e)?V.warn(`DASH: invalid t ("${i.value}")`):t.start=e;break;case"d":const n=parseInt(i.value,10);isNaN(n)?V.warn(`DASH: invalid d ("${i.value}")`):t.duration=n;break;case"r":const r=parseInt(i.value,10);isNaN(r)?V.warn(`DASH: invalid r ("${i.value}")`):t.repeatCount=r;break}}return t}function pu(e){const t=[];if(Array.isArray(e))for(let i=0;i<e.length;i++)t.push(hu(e[i]));else for(let i=0;i<e.length;i++)t.push(fu(e[i]));const n=[];for(let i=0;i<t.length;i++){const e=t[i],r=void 0===n[n.length-1]?null:n[n.length-1],s=void 0===t[i+1]?null:t[i+1],a=du(e,r,s);null!==a&&n.push(a)}return n}function gu(e,t){if(0===e.length||0===t.length)return null;const n=e[0].start,i=Array.isArray(t)?t[0].attributes.t:t[0].getAttribute("t"),s=r(i)?null:parseInt(i,10);if(null===s||Number.isNaN(s))return null;if(n===s)return{prevSegmentsIdx:0,newElementsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(n<s){let t=e[0],n=0;while(1){if(t.repeatCount>0){const e=s-t.start;if(e%t.duration===0&&e/t.duration<=t.repeatCount){const i=e/t.duration;return{repeatNumberInPrevSegments:i,prevSegmentsIdx:n,newElementsIdx:0,repeatNumberInNewElements:0}}}if(n++,n>=e.length)return null;if(t=e[n],t.start===s)return{prevSegmentsIdx:n,newElementsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(t.start>s)return null}}else{let e=0,i=Array.isArray(t)?t[0]:null,a=Array.isArray(t)?null:t[0],o=s;while(1){const l=null!==i?i.attributes.d:null===a||void 0===a?void 0:a.getAttribute("d"),u=r(l)?null:parseInt(l,10);if(null===u||Number.isNaN(u))return null;const c=null!==i?i.attributes.r:null===a||void 0===a?void 0:a.getAttribute("r"),d=r(c)?null:parseInt(c,10);if(null!==d){if(Number.isNaN(d)||d<0)return null;if(d>0){const t=n-o;if(t%u===0&&t/u<=d){const n=t/u;return{repeatNumberInPrevSegments:0,repeatNumberInNewElements:n,prevSegmentsIdx:0,newElementsIdx:e}}}o+=u*(d+1)}else o+=u;if(e++,e>=t.length)return null;Array.isArray(t)?i=t[e]:a=t[e];const h=null!==i?i.attributes.t:null===a||void 0===a?void 0:a.getAttribute("t"),f=r(h)?null:parseInt(h,10);if(null!==f){if(Number.isNaN(f))return null;o=f}if(o===n)return{newElementsIdx:e,prevSegmentsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(o>s)return null}}}function mu(e,t){var n;const i=gu(t,e);if(null===i)return V.warn('DASH: Cannot perform "based" update. Common segment not found.'),pu(e);const{prevSegmentsIdx:r,newElementsIdx:s,repeatNumberInPrevSegments:a,repeatNumberInNewElements:o}=i,l=t.length-r,u=l+s-1;if(u>=e.length)return V.info('DASH: Cannot perform "based" update. New timeline too short'),pu(e);const c=t.slice(r);if(a>0){const e=c[0];e.start+=e.duration*a,c[0].repeatCount-=a}if(o>0&&0!==s)return V.info('DASH: Cannot perform "based" update. The new timeline has a different form.'),pu(e);const d=c[c.length-1],h=Array.isArray(e)?hu(e[u]):fu(e[u]),f=(null!==(n=h.repeatCount)&&void 0!==n?n:0)-o;if(h.duration!==d.duration||d.repeatCount>f)return V.info('DASH: Cannot perform "based" update. The new timeline has a different form at the beginning.'),pu(e);void 0!==h.repeatCount&&h.repeatCount>d.repeatCount&&(d.repeatCount=h.repeatCount);const p=[],g=[];if(Array.isArray(e))for(let m=u+1;m<e.length;m++)g.push(hu(e[m]));else for(let m=u+1;m<e.length;m++)g.push(fu(e[m]));for(let m=0;m<g.length;m++){const e=g[m],t=void 0===p[p.length-1]?d:p[p.length-1],n=void 0===g[m+1]?null:g[m+1],i=du(e,t,n);null!==i&&p.push(i)}return c.concat(p)}class vu{constructor(e,t){var n,i,s,a,o;if(!vu.isTimelineIndexArgument(e))throw new Error("The given index is not compatible with a TimelineRepresentationIndex.");const{availabilityTimeComplete:l,availabilityTimeOffset:u,manifestBoundsCalculator:c,isDynamic:d,isLastPeriod:h,representationId:f,representationBitrate:p,periodStart:g,periodEnd:m,isEMSGWhitelisted:v}=t,y=null!==(n=e.timescale)&&void 0!==n?n:1,b=null!==(i=e.presentationTimeOffset)&&void 0!==i?i:0,_=g*y,T=b-_;this._manifestBoundsCalculator=c,this._isEMSGWhitelisted=v,this._isLastPeriod=h,this._lastUpdate=null!==(s=t.receivedTime)&&void 0!==s?s:Se(),this._unsafelyBaseOnPreviousIndex=null,null!==t.unsafelyBaseOnPreviousRepresentation&&t.unsafelyBaseOnPreviousRepresentation.index instanceof vu&&(t.unsafelyBaseOnPreviousRepresentation.index._unsafelyBaseOnPreviousIndex=null,this._unsafelyBaseOnPreviousIndex=t.unsafelyBaseOnPreviousRepresentation.index),this._isDynamic=d,this._parseTimeline=null!==(a=e.timelineParser)&&void 0!==a?a:null;const S=void 0===(null===(o=e.initialization)||void 0===o?void 0:o.media)?null:nu(e.initialization.media,f,p),w=void 0===e.media?null:nu(e.media,f,p);let E;E=void 0===u&&void 0===l?1/0:null!==u&&void 0!==u?u:0,this._index={availabilityTimeComplete:null===l||void 0===l||l,availabilityTimeOffset:E,indexRange:e.indexRange,indexTimeOffset:T,initialization:r(e.initialization)?void 0:{url:S,range:e.initialization.range},segmentUrlTemplate:w,startNumber:e.startNumber,endNumber:e.endNumber,timeline:void 0===e.timeline?null:yu(e.timeline,e.startNumber,e.endNumber),timescale:y},this._scaledPeriodStart=eo(g,this._index),this._scaledPeriodEnd=void 0===m?void 0:eo(m,this._index)}getInitSegment(){return Jl(this._index,this._isEMSGWhitelisted)}getSegments(e,t){return this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline()),au(this._index,e,t,this._manifestBoundsCalculator,this._scaledPeriodEnd,this._isEMSGWhitelisted)}shouldRefresh(){return!1}getFirstAvailablePosition(){this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());const e=this._index.timeline;return 0===e.length?null:to(Math.max(this._scaledPeriodStart,e[0].start),this._index)}getLastAvailablePosition(){var e;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());const t=_u(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(null===t)return null;const n=Math.min(t.end,null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0);return to(n,this._index)}getEnd(){var e;if(this._isDynamic&&!this._isLastPeriod)return;if(this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline()),this._index.timeline.length<=0)return null;const t=this._index.timeline[this._index.timeline.length-1],n=Math.min(Ja(t,null,this._scaledPeriodEnd),null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0);return to(n,this._index)}awaitSegmentBetween(e,t){var n,i;if(fe(e<=t),!this._isDynamic)return!1;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());const{timescale:r,timeline:s}=this._index,a=cu(r),o=eo(t,this._index),l=_u(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(null!==l){const e=Math.min(l.end,null!==(n=this._scaledPeriodEnd)&&void 0!==n?n:1/0),t=e+a;if(t>=Math.min(o,null!==(i=this._scaledPeriodEnd)&&void 0!==i?i:1/0))return!1}const u=eo(e,this._index);if(s.length>0&&null!==l&&!l.isLastOfTimeline){const e=s[s.length-1],t=Ja(e,null,this._scaledPeriodEnd),n=t+a;if(u<n+a)return!0}return!!this._isLastPeriod&&(void 0===this._scaledPeriodEnd?o+a>this._scaledPeriodStart&&void 0:u-a<this._scaledPeriodEnd&&o+a>this._scaledPeriodStart)}isSegmentStillAvailable(e){return!!e.isInit||(this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline()),bu(e,this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd))}checkDiscontinuity(e){this._refreshTimeline();let t=this._index.timeline;return null===t&&(t=this._getTimeline(),this._index.timeline=t),ro({timeline:t,timescale:this._index.timescale,indexTimeOffset:this._index.indexTimeOffset},e,this._scaledPeriodEnd)}canBeOutOfSyncError(e){return!!this._isDynamic&&(e instanceof ct&&e.isHttpError(404))}_replace(e){this._parseTimeline=e._parseTimeline,this._index=e._index,this._isDynamic=e._isDynamic,this._scaledPeriodStart=e._scaledPeriodStart,this._scaledPeriodEnd=e._scaledPeriodEnd,this._lastUpdate=e._lastUpdate,this._manifestBoundsCalculator=e._manifestBoundsCalculator,this._isLastPeriod=e._isLastPeriod}_update(e){null===this._index.timeline&&(this._index.timeline=this._getTimeline()),null===e._index.timeline&&(e._index.timeline=e._getTimeline());const t=fo(this._index.timeline,e._index.timeline);t&&(this._index.startNumber=e._index.startNumber),this._index.availabilityTimeOffset=e._index.availabilityTimeOffset,this._index.availabilityTimeComplete=e._index.availabilityTimeComplete,this._index.endNumber=e._index.endNumber,this._isDynamic=e._isDynamic,this._scaledPeriodStart=e._scaledPeriodStart,this._scaledPeriodEnd=e._scaledPeriodEnd,this._lastUpdate=e._lastUpdate,this._isLastPeriod=e._isLastPeriod}isStillAwaitingFutureSegments(){var e;if(!this._isDynamic)return!1;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());const{timeline:t}=this._index;if(0===t.length){if(void 0!==this._scaledPeriodEnd){const e=this._manifestBoundsCalculator.getEstimatedLiveEdge();if(void 0!==e&&eo(e,this._index)>this._scaledPeriodEnd)return!1}return this._isLastPeriod}const n=cu(this._index.timescale),i=_u(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(null!==i&&!i.isLastOfTimeline){const t=Math.min(i.end,null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0);return!(void 0!==this._scaledPeriodEnd&&t+n>=this._scaledPeriodEnd)}if(!this._isLastPeriod)return!1;if(void 0===this._scaledPeriodEnd)return!0;const r=t[t.length-1],s=Ja(r,null,this._scaledPeriodEnd);return s+n<this._scaledPeriodEnd}isInitialized(){return!0}initialize(){V.error("A `TimelineRepresentationIndex` does not need to be initialized")}addPredictedSegments(){V.warn("Cannot add predicted segments to a `TimelineRepresentationIndex`")}static isTimelineIndexArgument(e){return"function"===typeof e.timelineParser||Array.isArray(e.timeline)}_refreshTimeline(){if(null===this._index.timeline&&(this._index.timeline=this._getTimeline()),!this._isDynamic)return;const e=this._manifestBoundsCalculator.getEstimatedMinimumSegmentTime();if(r(e))return;const t=eo(e,this._index),n=ho(this._index.timeline,t);void 0!==this._index.startNumber?this._index.startNumber+=n:void 0!==this._index.endNumber&&(this._index.startNumber=n+1)}_getTimeline(){if(null===this._parseTimeline)return null!==this._index.timeline?this._index.timeline:(V.error("DASH: Timeline already lazily parsed."),[]);const e=this._parseTimeline();this._parseTimeline=null;const{MIN_DASH_S_ELEMENTS_TO_PARSE_UNSAFELY:t}=N.getCurrent();if(null===this._unsafelyBaseOnPreviousIndex||e.length<t)return yu(pu(e),this._index.startNumber,this._index.endNumber);let n;return null===this._unsafelyBaseOnPreviousIndex._index.timeline?(n=this._unsafelyBaseOnPreviousIndex._getTimeline(),this._unsafelyBaseOnPreviousIndex._index.timeline=n):n=this._unsafelyBaseOnPreviousIndex._index.timeline,this._unsafelyBaseOnPreviousIndex=null,yu(mu(e,n),this._index.startNumber,this._index.endNumber)}}function yu(e,t,n){if(void 0===n)return e;let i=null!==t&&void 0!==t?t:1;for(let r=0;r<e.length;r++){const t=e[r];if(i+=t.repeatCount+1,i>n){if(i===n+1)return e.slice(0,r+1);{const s=e.slice(0,r),a=Object.assign({},t),o=i-t.repeatCount-1;return a.repeatCount=Math.max(0,n-o),s.push(a),s}}}return e}function bu(e,t,n,i){const s=_u(t,n,i);if(null===s)return!1;for(let a=0;a<t.timeline.length;a++){if(s.timelineIdx<a)return!1;const n=t.timeline[a],i=(n.start-t.indexTimeOffset)/t.timescale;if(i>e.time)return!1;if(i===e.time)return void 0===n.range?void 0===e.range:!r(e.range)&&n.range[0]===e.range[0]&&n.range[1]===e.range[1];if(n.repeatCount>=0&&void 0!==n.duration){const e=i-n.start,t=e/n.duration-1;return t%1===0&&t<=s.newRepeatCount}}return!1}function _u(e,t,n){if(e.timeline.length<=0)return null;if(e.availabilityTimeOffset===1/0){const t=e.timeline.length-1,i=e.timeline[t];return{isLastOfTimeline:!0,timelineIdx:t,newRepeatCount:i.repeatCount,end:Ja(i,null,n)}}const i=t.getEstimatedMaximumPosition(e.availabilityTimeOffset);if(void 0===i){const t=e.timeline.length-1,i=e.timeline[t];return{isLastOfTimeline:!0,timelineIdx:t,newRepeatCount:i.repeatCount,end:Ja(i,null,n)}}for(let r=e.timeline.length-1;r>=e.timeline.length;r--){const t=e.timeline[r],s=t.start+t.duration;if(to(s,e)<=i){const a=Ja(t,e.timeline[r+1],n);if(to(a,e)<=i)return{isLastOfTimeline:r===e.timeline.length-1,timelineIdx:r,newRepeatCount:t.repeatCount,end:s};{const n=eo(i,e),s=n-t.start,a=Math.floor(s/t.duration);return fe(a>=1),{isLastOfTimeline:!1,timelineIdx:r,newRepeatCount:a-1,end:t.start+a*t.duration}}}}return null}var Tu=vu;class Su{constructor(e,t){var n,i,s;const{availabilityTimeOffset:a,manifestBoundsCalculator:o,isDynamic:l,periodEnd:u,periodStart:c,representationId:d,representationBitrate:h,isEMSGWhitelisted:f}=t,p=null!==(n=e.timescale)&&void 0!==n?n:1;this._availabilityTimeOffset=a,this._manifestBoundsCalculator=o;const g=null!==(i=e.presentationTimeOffset)&&void 0!==i?i:0,m=c*p,v=g-m;if(void 0===e.duration)throw new Error("Invalid SegmentTemplate: no duration");const y=void 0===(null===(s=e.initialization)||void 0===s?void 0:s.media)?null:nu(e.initialization.media,d,h),b=void 0===e.media?null:nu(e.media,d,h);this._index={duration:e.duration,timescale:p,indexRange:e.indexRange,indexTimeOffset:v,initialization:r(e.initialization)?void 0:{url:y,range:e.initialization.range},url:b,presentationTimeOffset:g,startNumber:e.startNumber,endNumber:e.endNumber},this._isDynamic=l,this._periodStart=c,this._scaledRelativePeriodEnd=void 0===u?void 0:(u-c)*p,this._isEMSGWhitelisted=f}getInitSegment(){return Jl(this._index,this._isEMSGWhitelisted)}getSegments(e,t){const n=this._index,{duration:i,startNumber:s,endNumber:a,timescale:o,url:l}=n,u=this._periodStart*o,c=this._scaledRelativePeriodEnd,d=e*o-u,h=(e+t)*o-u,f=this._getFirstSegmentStart(),p=this._getLastSegmentStart();if(r(f)||r(p))return[];const g=Math.max(f,d),m=Math.min(p,h);if(m+i<=g)return[];const v=[],y=null!==s&&void 0!==s?s:1;let b=Math.floor(g/i);for(let _=b*i;_<=m;_+=i){const e=b+y;if(void 0!==a&&e>a)return v;const t=!r(c)&&_+i>c?c-_:i,s=_+u,d=_+this._index.presentationTimeOffset,h=null===l?null:ru(d,e)(l),f={id:String(e),number:e,time:s/o,end:(s+t)/o,duration:t/o,timescale:1,isInit:!1,scaledDuration:t/o,url:h,timestampOffset:-n.indexTimeOffset/o,complete:!0,privateInfos:{isEMSGWhitelisted:this._isEMSGWhitelisted}};v.push(f),b++}return v}getFirstAvailablePosition(){const e=this._getFirstSegmentStart();return r(e)?e:e/this._index.timescale+this._periodStart}getLastAvailablePosition(){const e=this._getLastSegmentStart();if(r(e))return e;const t=this._estimateRelativeScaledEnd(),n=Math.min(e+this._index.duration,null!==t&&void 0!==t?t:1/0);return n/this._index.timescale+this._periodStart}getEnd(){if(!this._isDynamic)return this.getLastAvailablePosition();const e=this._estimateRelativeScaledEnd();if(void 0===e)return;const{timescale:t}=this._index,n=e+this._periodStart*t;return n/t}awaitSegmentBetween(e,t){if(fe(e<=t),!this._isDynamic)return!1;const{timescale:n}=this._index,i=cu(n),s=this._periodStart*n,a=e*n-s,o=t*n-s,l=this._getLastSegmentStart();if(r(l)){const e=this._estimateRelativeScaledEnd();return void 0===e?o+i>=0:o+i>=0&&a<e-i}const u=l+this._index.duration,c=this._estimateRelativeScaledEnd();return void 0===c?o>u-i:o>u-i&&a<c-i}shouldRefresh(){return!1}checkDiscontinuity(){return null}isSegmentStillAvailable(e){if(e.isInit)return!0;const t=this.getSegments(e.time,.1);return 0!==t.length&&(t[0].time===e.time&&t[0].end===e.end&&t[0].number===e.number)}canBeOutOfSyncError(){return!1}isStillAwaitingFutureSegments(){if(!this._isDynamic)return!1;const e=this._estimateRelativeScaledEnd();if(void 0===e)return!0;const{timescale:t}=this._index,n=this._getLastSegmentStart();if(r(n))return!0;const i=n+this._index.duration,s=cu(t);return i+s<e}isInitialized(){return!0}initialize(){V.error("A `TemplateRepresentationIndex` does not need to be initialized")}addPredictedSegments(){V.warn("Cannot add predicted segments to a `TemplateRepresentationIndex`")}_replace(e){this._index=e._index,this._isDynamic=e._isDynamic,this._periodStart=e._periodStart,this._scaledRelativePeriodEnd=e._scaledRelativePeriodEnd,this._manifestBoundsCalculator=e._manifestBoundsCalculator}_update(e){this._replace(e)}_getFirstSegmentStart(){var e;if(!this._isDynamic)return 0;if(0===this._scaledRelativePeriodEnd||void 0===this._scaledRelativePeriodEnd){const t=this._manifestBoundsCalculator.getEstimatedMaximumPosition(null!==(e=this._availabilityTimeOffset)&&void 0!==e?e:0);if(void 0!==t&&t<this._periodStart)return null}const{duration:t,timescale:n}=this._index,i=this._manifestBoundsCalculator.getEstimatedMinimumSegmentTime();if(void 0===i)return;const r=i>this._periodStart?(i-this._periodStart)*n:0,s=Math.floor(r/t);return s*t}_getLastSegmentStart(){var e,t;const{duration:n,timescale:i,endNumber:r,startNumber:s=1}=this._index;if(this._isDynamic){const t=this._manifestBoundsCalculator.getEstimatedLiveEdge();if(void 0!==t&&void 0!==this._scaledRelativePeriodEnd&&this._scaledRelativePeriodEnd<t-this._periodStart*this._index.timescale){let e=Math.ceil(this._scaledRelativePeriodEnd/n);return void 0!==r&&r-s+1<e&&(e=r-s+1),(e-1)*n}const a=this._manifestBoundsCalculator.getEstimatedMaximumPosition(null!==(e=this._availabilityTimeOffset)&&void 0!==e?e:0);if(void 0===a)return;const o=(a-this._periodStart)*i;if(o<0)return null;let l=Math.floor(o/n);return void 0!==r&&r-s+1<l&&(l=r-s+1),l<=0?null:(l-1)*n}{const e=null!==(t=this._scaledRelativePeriodEnd)&&void 0!==t?t:0;let a=Math.ceil(e/n);void 0!==r&&r-s+1<a&&(a=r-s+1);const o=(a-1)*n,l=N.getCurrent().MINIMUM_SEGMENT_SIZE*i;return void 0!==r||e-o>l||a<2?o:(a-2)*n}}_estimateRelativeScaledEnd(){var e,t;if(void 0!==this._index.endNumber){const n=this._index.endNumber-(null!==(e=this._index.startNumber)&&void 0!==e?e:1)+1;return Math.max(Math.min(n*this._index.duration,null!==(t=this._scaledRelativePeriodEnd)&&void 0!==t?t:1/0),0)}if(void 0!==this._scaledRelativePeriodEnd)return Math.max(this._scaledRelativePeriodEnd,0)}}function wu(e,t){var n,i,r;const{availabilityTimeOffset:s,manifestBoundsCalculator:a,isDynamic:o,end:l,start:u,receivedTime:c,unsafelyBaseOnPreviousRepresentation:d,inbandEventStreams:h,isLastPeriod:f}=t,p=e=>{return void 0!==h&&h.some(({schemeIdUri:t})=>t===e.schemeIdUri)},g={availabilityTimeComplete:void 0,availabilityTimeOffset:s,unsafelyBaseOnPreviousRepresentation:d,isEMSGWhitelisted:p,isLastPeriod:f,manifestBoundsCalculator:a,isDynamic:o,periodEnd:l,periodStart:u,receivedTime:c,representationBitrate:e.attributes.bitrate,representationId:e.attributes.id};let m;if(void 0!==e.children.segmentBase){const{segmentBase:t}=e.children;m=new lu(t,g)}else if(void 0!==e.children.segmentList){const{segmentList:t}=e.children;m=new uu(t,g)}else if(void 0!==e.children.segmentTemplate||t.parentSegmentTemplates.length>0){const s=t.parentSegmentTemplates.slice(),a=e.children.segmentTemplate;void 0!==a&&s.push(a);const o=R({},...s);void 0===o.availabilityTimeOffset&&void 0===t.availabilityTimeOffset||(g.availabilityTimeOffset=(null!==(n=o.availabilityTimeOffset)&&void 0!==n?n:0)+(null!==(i=t.availabilityTimeOffset)&&void 0!==i?i:0)),void 0===o.availabilityTimeComplete&&void 0===t.availabilityTimeComplete||(g.availabilityTimeComplete=null!==(r=o.availabilityTimeComplete)&&void 0!==r?r:t.availabilityTimeComplete),m=Tu.isTimelineIndexArgument(o)?new Tu(o,g):new Su(o,g)}else{const e=t.adaptation.children;if(void 0!==e.segmentBase){const{segmentBase:t}=e;m=new lu(t,g)}else if(void 0!==e.segmentList){const{segmentList:t}=e;m=new uu(t,g)}else m=new Su({duration:Number.MAX_VALUE,timescale:1,startNumber:0,media:""},g)}return m}function Eu(e,t){var n;if(0===t.length)return e;const i=t.map(e=>{return{url:e.value}});if(0===e.length)return i;const r=[];for(let s=0;s<e.length;s++){const t=e[s];for(let e=0;e<i.length;e++){const s=i[e],a=Sa(t.url,s.url);r.push({url:a,serviceLocation:null!==(n=s.serviceLocation)&&void 0!==n?n:t.serviceLocation})}}return r}function xu(e,t){const n=[];if(void 0!==e.children.inbandEventStreams&&n.push(...e.children.inbandEventStreams),void 0!==t.children.inbandEventStreams&&n.push(...t.children.inbandEventStreams),0!==n.length)return n}function ku({adaptationProfiles:e,essentialProperties:t,supplementalProperties:n,manifestProfiles:i,codecs:r}){const s=(null!==e&&void 0!==e?e:"")+(null!==i&&void 0!==i?i:"");if(-1!==s.indexOf("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10")&&("hvc1.2.4.L153.B0"===r||"hev1.2.4.L153.B0"===r))return{colorDepth:10,eotf:"pq",colorSpace:"rec2020"};const a=De([...null!==t&&void 0!==t?t:[],...null!==n&&void 0!==n?n:[]],e=>"urn:mpeg:mpegB:cicp:TransferCharacteristics"===e.schemeIdUri);if(void 0!==a)switch(a.value){case"15":return;case"16":return{eotf:"pq"};case"18":return{eotf:"hlg"}}return void 0!==r&&/^vp(08|09|10)/.exec(r)?Zl(r):void 0}function Au(e,t,n){var i,r,s,a,o,l,u;const c=[];for(const d of e){let e=void 0!==d.attributes.id?d.attributes.id:String(d.attributes.bitrate)+(void 0!==d.attributes.height?`-${d.attributes.height}`:"")+(void 0!==d.attributes.width?`-${d.attributes.width}`:"")+(void 0!==d.attributes.mimeType?`-${d.attributes.mimeType}`:"")+(void 0!==d.attributes.codecs?`-${d.attributes.codecs}`:"");while(c.some(t=>t.id===e))e+="-dup";const h=null!==(r=null===(i=n.unsafelyBaseOnPreviousAdaptation)||void 0===i?void 0:i.getRepresentation(e))&&void 0!==r?r:null,f=xu(d,t),p=null!==(s=d.attributes.availabilityTimeComplete)&&void 0!==s?s:n.availabilityTimeComplete;let g;void 0===d.attributes.availabilityTimeOffset&&void 0===n.availabilityTimeOffset||(g=(null!==(a=d.attributes.availabilityTimeOffset)&&void 0!==a?a:0)+(null!==(o=n.availabilityTimeOffset)&&void 0!==o?o:0));const m=R({},n,{availabilityTimeOffset:g,availabilityTimeComplete:p,unsafelyBaseOnPreviousRepresentation:h,adaptation:t,inbandEventStreams:f}),v=wu(d,m);let y;void 0===d.attributes.bitrate?(V.warn("DASH: No usable bitrate found in the Representation."),y=0):y=d.attributes.bitrate;const b=Eu(n.baseURLs,d.children.baseURLs),_=0===b.length?[{baseUrl:"",id:void 0}]:b.map(e=>({baseUrl:e.url,id:e.serviceLocation})),T={bitrate:y,cdnMetadata:_,index:v,id:e};let S,w;void 0!==d.children.supplementalProperties&&De(d.children.supplementalProperties,e=>"tag:dolby.com,2018:dash:EC3_ExtensionType:2018"===e.schemeIdUri&&"JOC"===e.value)&&(T.isSpatialAudio=!0),void 0!==d.attributes.codecs?S=d.attributes.codecs:void 0!==t.attributes.codecs&&(S=t.attributes.codecs),void 0!==S&&(S="mp4a.40.02"===S?"mp4a.40.2":S,T.codecs=S),void 0!==d.attributes.supplementalCodecs?w=d.attributes.supplementalCodecs:void 0!==t.attributes.supplementalCodecs&&(w=t.attributes.supplementalCodecs),void 0!==w&&(T.supplementalCodecs=Ql(w)),void 0!==d.attributes.frameRate?T.frameRate=d.attributes.frameRate:void 0!==t.attributes.frameRate&&(T.frameRate=t.attributes.frameRate),void 0!==d.attributes.height?T.height=d.attributes.height:void 0!==t.attributes.height&&(T.height=t.attributes.height),void 0!==d.attributes.mimeType?T.mimeType=d.attributes.mimeType:void 0!==t.attributes.mimeType&&(T.mimeType=t.attributes.mimeType),void 0!==d.attributes.width?T.width=d.attributes.width:void 0!==t.attributes.width&&(T.width=t.attributes.width);{const e=[...null!==(l=t.children.contentProtections)&&void 0!==l?l:[],...null!==(u=d.children.contentProtections)&&void 0!==u?u:[]];for(const t of e)n.contentProtectionParser.add(T,t)}T.hdrInfo=ku({adaptationProfiles:t.attributes.profiles,supplementalProperties:t.children.supplementalProperties,essentialProperties:t.children.essentialProperties,manifestProfiles:n.manifestProfiles,codecs:S}),c.push(T)}return c}function Iu(e){if(void 0===e)return!1;const t="urn:tva:metadata:cs:AudioPurposeCS:2007"===e.schemeIdUri&&"1"===e.value,n="urn:mpeg:dash:role:2011"===e.schemeIdUri&&"description"===e.value;return t||n}function Cu(e,t){if(void 0!==e){const t=e.some(e=>"urn:tva:metadata:cs:AudioPurposeCS:2007"===e.schemeIdUri&&"2"===e.value);if(t)return!0}if(void 0!==t){const e=t.some(e=>"urn:mpeg:dash:role:2011"===e.schemeIdUri&&"caption"===e.value);if(e)return!0}return!1}function Du(e){return void 0!==e&&("urn:mpeg:dash:role:2011"===e.schemeIdUri&&"sign"===e.value)}function Ru(e,t){if(Ot(e.attributes.id))return e.attributes.id;const{isClosedCaption:n,isForcedSubtitle:i,isAudioDescription:r,isSignInterpreted:s,isTrickModeTrack:a,type:o}=t;let l=o;return Ot(e.attributes.language)&&(l+=`-${e.attributes.language}`),!0===n&&(l+="-cc"),!0===i&&(l+="-cc"),!0===r&&(l+="-ad"),!0===s&&(l+="-si"),a&&(l+="-trickMode"),Ot(e.attributes.contentType)&&(l+=`-${e.attributes.contentType}`),Ot(e.attributes.codecs)&&(l+=`-${e.attributes.codecs}`),Ot(e.attributes.mimeType)&&(l+=`-${e.attributes.mimeType}`),void 0!==e.attributes.frameRate&&(l+=`-${String(e.attributes.frameRate)}`),l}function Mu(e){if(!r(e.children.supplementalProperties)){const{supplementalProperties:t}=e.children;for(const e of t)if("urn:mpeg:dash:adaptation-set-switching:2016"===e.schemeIdUri&&!r(e.value))return e.value.split(",").map(e=>e.trim()).filter(e=>e)}return[]}function Lu(e,t){var n,i,s,a,o,l,u;const c={video:[],audio:[],text:[]},d=[],h={},f=[];for(let g=0;g<e.length;g++){const p=e[g],m=p.children,{essentialProperties:v,roles:y,label:b}=m,_=Array.isArray(y)&&y.some(e=>"main"===e.value)&&y.some(e=>"urn:mpeg:dash:role:2011"===e.schemeIdUri),T=p.children.representations,S=null!==(n=p.attributes.availabilityTimeComplete)&&void 0!==n?n:t.availabilityTimeComplete;let w;void 0===p.attributes.availabilityTimeOffset&&void 0===t.availabilityTimeOffset||(w=(null!==(i=p.attributes.availabilityTimeOffset)&&void 0!==i?i:0)+(null!==(s=t.availabilityTimeOffset)&&void 0!==s?s:0));const E=p.attributes.mimeType,x=p.attributes.codecs,k=Yl(T,Ot(E)?E:null,Ot(x)?x:null,r(m.roles)?null:m.roles);if(void 0===k)continue;const A=null!==(a=p.attributes.selectionPriority)&&void 0!==a?a:1,I=p.attributes.id,C=Mu(p),D=[];void 0!==t.segmentTemplate&&D.push(t.segmentTemplate),void 0!==p.children.segmentTemplate&&D.push(p.children.segmentTemplate);const R={availabilityTimeComplete:S,availabilityTimeOffset:w,baseURLs:Eu(t.baseURLs,m.baseURLs),contentProtectionParser:t.contentProtectionParser,manifestBoundsCalculator:t.manifestBoundsCalculator,end:t.end,isDynamic:t.isDynamic,isLastPeriod:t.isLastPeriod,manifestProfiles:t.manifestProfiles,parentSegmentTemplates:D,receivedTime:t.receivedTime,start:t.start,unsafelyBaseOnPreviousAdaptation:null},M=Array.isArray(v)?De(v,e=>{return"http://dashif.org/guidelines/trickmode"===e.schemeIdUri}):void 0,L=null===(o=null===M||void 0===M?void 0:M.value)||void 0===o?void 0:o.split(" "),P=void 0!==L,{accessibilities:O}=m;let N,U,F,B,j;void 0!==y&&y.some(e=>"dub"===e.value)&&(N=!0),U="text"===k&&Cu(O,y),"text"===k&&void 0!==y&&y.some(e=>"forced-subtitle"===e.value||"forced_subtitle"===e.value)&&(F=!0),"audio"!==k?B=!1:void 0!==O&&(B=O.some(Iu)),"video"!==k?j=!1:void 0!==O&&(j=O.some(Du));let H=Ru(p,{isAudioDescription:B,isForcedSubtitle:F,isClosedCaption:U,isSignInterpreted:j,isTrickModeTrack:P,type:k});while(gt(f,H))H+="-dup";const $=H;f.push(H),R.unsafelyBaseOnPreviousAdaptation=null!==(u=null===(l=t.unsafelyBaseOnPreviousPeriod)||void 0===l?void 0:l.getAdaptation(H))&&void 0!==u?u:null;const G=Au(T,p,R),z={id:H,representations:G,type:k,isTrickModeTrack:P};if(r(p.attributes.language)||(z.language=p.attributes.language),r(U)||(z.closedCaption=U),r(B)||(z.audioDescription=B),!0===N&&(z.isDub=!0),void 0!==F&&(z.forcedSubtitles=F),!0===j&&(z.isSignInterpreted=!0),void 0!==b&&(z.label=b),void 0!==L)d.push({adaptation:z,trickModeAttachedAdaptationIds:L});else{let e=-1;for(const t of C){const n=h[t];if(void 0!==n&&n.newID!==$&&gt(n.adaptationSetSwitchingIDs,I)){e=le(c[k],e=>e[0].id===t);const n=c[k][e];if(void 0!==n&&n[0].audioDescription===z.audioDescription&&n[0].closedCaption===z.closedCaption&&n[0].language===z.language){V.info('DASH Parser: merging "switchable" AdaptationSets',I,t),n[0].representations.push(...z.representations),n[1]={priority:Math.max(A,n[1].priority),isMainAdaptation:_||n[1].isMainAdaptation,indexInMpd:Math.min(g,n[1].indexInMpd)};break}}}e<0&&c[k].push([z,{priority:A,isMainAdaptation:_,indexInMpd:g}])}!r(I)&&r(h[I])&&(h[I]={newID:$,adaptationSetSwitchingIDs:C})}const p=bt.reduce((e,t)=>{const n=c[t];return n.length>0&&(n.sort(Pu),e[t]=n.map(([e])=>e)),e},{});return c.video.sort(Pu),Wl(p,d),p}function Pu(e,t){const n=t[1].priority-e[1].priority;return 0!==n?n:e[1].isMainAdaptation!==t[1].isMainAdaptation?e[1].isMainAdaptation?-1:1:e[1].indexInMpd-t[1].indexInMpd}const Ou=pt();function Nu(e,t){var n,i,s,a,o;const l=[],u=zl(e,t);if(u.length!==e.length)throw new Error("MPD parsing error: the time information are incoherent.");const{isDynamic:c,manifestBoundsCalculator:d}=t;c||r(t.duration)||d.setLastPosition(t.duration);for(let h=e.length-1;h>=0;h--){const f=h===e.length-1,p=e[h],g=t.xlinkInfos.get(p),m=Eu(t.baseURLs,p.children.baseURLs),{periodStart:v,periodDuration:y,periodEnd:b}=u[h];let _;r(p.attributes.id)?(V.warn("DASH: No usable id found in the Period. Generating one."),_="gen-dash-period-"+Ou()):_=p.attributes.id;while(l.some(e=>e.id===_))_+="-dup";const T=void 0!==g?g.receivedTime:t.receivedTime,S=null!==(i=null===(n=t.unsafelyBaseOnPreviousManifest)||void 0===n?void 0:n.getPeriod(_))&&void 0!==i?i:null,w=p.attributes.availabilityTimeComplete,E=p.attributes.availabilityTimeOffset,{manifestProfiles:x,contentProtectionParser:k}=t,{segmentTemplate:A}=p.children;k.addReferences(null!==(s=p.children.contentProtections)&&void 0!==s?s:[]);const I={availabilityTimeComplete:w,availabilityTimeOffset:E,baseURLs:m,contentProtectionParser:k,manifestBoundsCalculator:d,end:b,isDynamic:c,isLastPeriod:f,manifestProfiles:x,receivedTime:T,segmentTemplate:A,start:v,unsafelyBaseOnPreviousPeriod:S},C=Lu(p.children.adaptations,I),D=(null!==(a=t.xmlNamespaces)&&void 0!==a?a:[]).concat(null!==(o=p.attributes.namespaces)&&void 0!==o?o:[]),R=Bu(p.children.eventStreams,v,D),M={id:_,start:v,end:b,duration:y,adaptations:C,streamEvents:R};if(l.unshift(M),!d.lastPositionIsKnown()){const e=Fu(C);if(c)if("number"===typeof e){const t=Se()/1e3;d.setLastPosition(e,t)}else{const e=Uu(t,v);if(void 0!==e){const[t,n]=e;d.setLastPosition(t,n)}}else"number"===typeof e&&d.setLastPosition(e)}}if(t.isDynamic&&!d.lastPositionIsKnown()){const e=Uu(t,0);if(void 0!==e){const[t,n]=e;d.setLastPosition(t,n)}}return Gl(l)}function Uu(e,t){if(r(e.clockOffset)){const n=Date.now()/1e3;if(n>=t){V.warn("DASH Parser: no clock synchronization mechanism found. Using the system clock instead.");const t=n-e.availabilityStartTime,i=Se()/1e3;return[t,i]}}else{const n=e.clockOffset/1e3-e.availabilityStartTime,i=Se()/1e3,r=i+n;if(r>=t)return[r,i]}}function Fu(e){let t=null,n=!0;const i=qe(e).filter(e=>!r(e)),s=$l(i,e=>e);for(const a of s){const e=a.representations;for(const i of e){const e=i.index.getLastAvailablePosition();null!==e&&(n=!1,"number"===typeof e&&(t=r(t)?e:Math.max(t,e)))}}return r(t)?n?null:void 0:t}function Bu(e,t,n){var i,r;const s=[];for(const a of e){const{schemeIdUri:e="",timescale:o=1}=a.attributes,l=n.concat(null!==(i=a.attributes.namespaces)&&void 0!==i?i:[]);for(const n of a.children.events)if(void 0!==n.eventStreamData){const i=(null!==(r=n.presentationTime)&&void 0!==r?r:0)/o+t,a=void 0===n.duration?void 0:i+n.duration/o;let u,c;if(!zs["a"]&&n.eventStreamData instanceof Element)u=n.eventStreamData;else try{c={namespaces:l,data:"string"===typeof n.eventStreamData?n.eventStreamData:Da(new Uint8Array(n.eventStreamData))}}catch(e){V.error("DASH: Error while parsing event-stream:",e instanceof Error?e.message:"Unknown error")}s.push({start:i,end:a,id:n.id,data:{type:"dash-event-stream",value:{schemeIdUri:e,timescale:o,element:u,xmlData:c}}})}}return s}function ju(e,t,n,i,s=new WeakMap){const{children:a,attributes:o}=e;if(r(t.externalClockOffset)){const s="dynamic"===o.type,l=De(a.utcTimings,e=>{return"urn:mpeg:dash:utc:direct:2014"===e.schemeIdUri&&!r(e.value)}),u=r(l)||r(l.value)?void 0:Pl(l.value),c=r(u)||isNaN(u)?void 0:u;if(r(c)||!0===i){if(s&&!0!==i){const i=Ol(e);if(!r(i)&&i.length>0)return{type:"needs-clock",value:{url:i,continue:function(i){return i.success?(t.externalClockOffset=Pl(i.data),ju(e,t,n,!0)):(n.push(i.error),V.warn("DASH Parser: Error on fetching the clock ressource",i.error),ju(e,t,n,!0))}}}}}else t.externalClockOffset=c}const l=[];for(let u=0;u<a.periods.length;u++){const{xlinkHref:e,xlinkActuate:t}=a.periods[u].attributes;r(e)||"onLoad"!==t||l.push({index:u,ressource:e})}return 0===l.length?Vu(e,t,n,s):{type:"needs-xlinks",value:{xlinksUrls:l.map(({ressource:e})=>e),continue:function(r){if(r.length!==l.length)throw new Error("DASH parser: wrong number of loaded ressources.");for(let e=r.length-1;e>=0;e--){const t=l[e].index,{parsed:i,warnings:o,receivedTime:u,sendingTime:c,url:d}=r[e];o.length>0&&n.push(...o);for(const e of i)s.set(e,{receivedTime:u,sendingTime:c,url:d});a.periods.splice(t,1,...i)}return ju(e,t,n,i,s)}}}}function Vu(e,t,n,i){var s,a,o,l,u;const{children:c,attributes:d}=e,h="dynamic"===d.type,f=void 0!==t.url?[{url:t.url.substring(0,fa(t.url))}]:[],p=Eu(f,c.baseURLs),g=Hl(d,t.referenceDateTime),m=d.timeShiftBufferDepth,{externalClockOffset:v,unsafelyBaseOnPreviousManifest:y}=t,{externalClockOffset:b}=t,_=new Vl({availabilityStartTime:g,isDynamic:h,timeShiftBufferDepth:m,serverTimestampOffset:b}),T=new Ml;T.addReferences(null!==(s=c.contentProtections)&&void 0!==s?s:[]);const S={availabilityStartTime:g,baseURLs:p,clockOffset:v,contentProtectionParser:T,duration:d.duration,isDynamic:h,manifestBoundsCalculator:_,manifestProfiles:e.attributes.profiles,receivedTime:t.manifestReceivedTime,timeShiftBufferDepth:m,unsafelyBaseOnPreviousManifest:y,xlinkInfos:i,xmlNamespaces:e.attributes.namespaces},w=Nu(c.periods,S);T.finalize();const E=d.duration;let x,k,A,I=null;void 0!==d.minimumUpdatePeriod&&d.minimumUpdatePeriod>=0&&(x=0===d.minimumUpdatePeriod?N.getCurrent().DASH_FALLBACK_LIFETIME_WHEN_MINIMUM_UPDATE_PERIOD_EQUAL_0:d.minimumUpdatePeriod);const{minimumSafePosition:C,maximumSafePosition:D,maximumUnsafePosition:R}=jl(w),M=Se();if(h){let e;if(void 0!==D)e=D;else if(void 0===b)V.warn("DASH Parser: use system clock to define maximum position"),e=Date.now()/1e3-g;else{const t=Se()+b;e=t/1e3-g}let t=_.getEstimatedLiveEdge();void 0===t&&(t=void 0!==R?R:e),A={isLinear:!0,maximumSafePosition:e,livePosition:t,time:M},k=C,I=null!==m&&void 0!==m?m:null,null!==I&&void 0!==k&&t-k>I&&(I=t-k)}else{k=C,void 0===k&&(k=null!==(o=null===(a=w[0])||void 0===a?void 0:a.start)&&void 0!==o?o:0);let e=null!==E&&void 0!==E?E:1/0;if(void 0!==w[w.length-1]){const t=w[w.length-1],n=null!==(l=t.end)&&void 0!==l?l:void 0!==t.duration?t.start+t.duration:void 0;void 0!==n&&n<e&&(e=n)}void 0!==D&&D<e&&(e=D),A={isLinear:!1,maximumSafePosition:e,livePosition:void 0,time:M}}const L=!h||void 0===e.attributes.minimumUpdatePeriod&&(void 0!==(null===(u=w[w.length-1])||void 0===u?void 0:u.end)||void 0!==e.attributes.duration),P={availabilityStartTime:g,clockOffset:t.externalClockOffset,isDynamic:h,isLive:h,isLastPeriodKnown:L,periods:w,publishTime:d.publishTime,suggestedPresentationDelay:d.suggestedPresentationDelay,transportType:"dash",timeBounds:{minimumSafePosition:k,timeshiftDepth:I,maximumTimeData:A},lifetime:x,uris:r(t.url)?c.locations:[t.url,...c.locations]};return{type:"done",value:{parsed:P,warnings:n}}}var Hu=ju;function $u(e){const t=e.textContent,n=[];return null===t||0===t.length?[void 0,n]:[{value:t},n]}const Gu=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,zu=/([0-9]+)-([0-9]+)/;function qu(e,t){if("true"===e)return[!0,null];if("false"===e)return[!1,null];const n=new ic(`\`${t}\` property is not a boolean value but "${e}"`);return[!1,n]}function Wu(e,t){const n=parseInt(e,10);if(isNaN(n)){const n=new ic(`\`${t}\` property is not an integer value but "${e}"`);return[null,n]}return[n,null]}function Ku(e,t){if("INF"===e)return[1/0,null];const n=parseFloat(e);if(isNaN(n)){const n=new ic(`\`${t}\` property is invalid: "${e}"`);return[null,n]}return[n,null]}function Yu(e,t){if("true"===e)return[!0,null];if("false"===e)return[!1,null];const n=parseInt(e,10);if(isNaN(n)){const n=new ic(`\`${t}\` property is not a boolean nor an integer but "${e}"`);return[null,n]}return[n,null]}function Xu(e,t){const n=Date.parse(e);if(isNaN(n)){const n=new ic(`\`${t}\` is in an invalid date format: "${e}"`);return[null,n]}return[new Date(Date.parse(e)).getTime()/1e3,null]}function Qu(e,t){if(!Ot(e)){const e=new ic(`\`${t}\` property is empty`);return[0,e]}const n=Gu.exec(e);if(null===n){const n=new ic(`\`${t}\` property has an unrecognized format "${e}"`);return[null,n]}const i=365*parseFloat(Ot(n[2])?n[2]:"0")*24*60*60+30*parseFloat(Ot(n[4])?n[4]:"0")*24*60*60+24*parseFloat(Ot(n[6])?n[6]:"0")*60*60+60*parseFloat(Ot(n[8])?n[8]:"0")*60+60*parseFloat(Ot(n[10])?n[10]:"0")+parseFloat(Ot(n[12])?n[12]:"0");return[i,null]}function Zu(e,t){const n=zu.exec(e);if(null===n){const n=new ic(`\`${t}\` property has an unrecognized format "${e}"`);return[null,n]}return[[+n[1],+n[2]],null]}function Ju(e,t){try{return[Ka(e),null]}catch(n){const i=new ic(`\`${t}\` is not a valid base64 string: "${e}"`);return[null,i]}}function ec(e,t){const n=/^(\d+)\/(\d+)$/.exec(e);return null!==n?[+n[1]/+n[2],null]:Ku(e,t)}function tc(e){let t,n;for(let i=0;i<e.attributes.length;i++){const r=e.attributes[i];switch(r.name){case"schemeIdUri":t=r.value;break;case"value":n=r.value;break}}return{schemeIdUri:t,value:n}}function nc(e,t){return function(n,{asKey:i,parser:r,dashName:s}){const[a,o]=r(n,s);null!==o&&(V.warn(o.message),t.push(o)),null!==a&&(e[i]=a)}}class ic extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ic.prototype),this.name="MPDError"}}function rc(e){const t=[],n=[];for(let i=0;i<e.length;i++)if(e[i].nodeType===Node.ELEMENT_NODE){const r=e[i];if("cenc:pssh"===r.nodeName){const e=r.textContent;if(null!==e&&e.length>0){const[i,r]=Ju(e,"cenc:pssh");null!==r&&(V.warn(r.message),t.push(r)),null!==i&&n.push(i)}}}return[{cencPssh:n},t]}function sc(e){const t={};for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];switch(i.name){case"schemeIdUri":t.schemeIdUri=i.value;break;case"value":t.value=i.value;break;case"cenc:default_KID":t.keyId=Ra(i.value.replace(/-/g,""));break;case"ref":t.ref=i.value;break;case"refId":t.refId=i.value;break}}return t}function ac(e){const[t,n]=rc(e.childNodes),i=sc(e);return[{children:t,attributes:i},n]}function oc(e){const t={};for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n];switch(i.name){case"id":t.id=i.value;break;case"lang":t.language=i.value;break;case"contentType":t.contentType=i.value;break;case"par":t.par=i.value;break}}return t}function lc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"range":i(n.value,{asKey:"range",parser:Zu,dashName:"range"});break;case"sourceURL":t.media=n.value;break}}return[t,n]}function uc(e){const t={};let n=[];const i=nc(t,n),r=e.childNodes;for(let s=0;s<r.length;s++)if(r[s].nodeType===Node.ELEMENT_NODE){const e=r[s];if("Initialization"===e.nodeName){const[i,r]=lc(e);t.initialization=i,n=n.concat(r)}}for(let s=0;s<e.attributes.length;s++){const t=e.attributes[s];switch(t.name){case"timescale":i(t.value,{asKey:"timescale",parser:Wu,dashName:"timescale"});break;case"presentationTimeOffset":i(t.value,{asKey:"presentationTimeOffset",parser:Ku,dashName:"presentationTimeOffset"});break;case"indexRange":i(t.value,{asKey:"indexRange",parser:Zu,dashName:"indexRange"});break;case"indexRangeExact":i(t.value,{asKey:"indexRangeExact",parser:qu,dashName:"indexRangeExact"});break;case"availabilityTimeOffset":i(t.value,{asKey:"availabilityTimeOffset",parser:Ku,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":i(t.value,{asKey:"availabilityTimeComplete",parser:qu,dashName:"availabilityTimeComplete"});break;case"duration":i(t.value,{asKey:"duration",parser:Wu,dashName:"duration"});break;case"startNumber":i(t.value,{asKey:"startNumber",parser:Wu,dashName:"startNumber"});break;case"endNumber":i(t.value,{asKey:"endNumber",parser:Wu,dashName:"endNumber"});break}}return[t,n]}function cc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"media":t.media=n.value;break;case"indexRange":i(n.value,{asKey:"indexRange",parser:Zu,dashName:"indexRange"});break;case"index":t.index=n.value;break;case"mediaRange":i(n.value,{asKey:"mediaRange",parser:Zu,dashName:"mediaRange"});break}}return[t,n]}function dc(e){const[t,n]=uc(e);let i=n;const r=[],s=e.childNodes;for(let o=0;o<s.length;o++)if(s[o].nodeType===Node.ELEMENT_NODE){const e=s[o];if("SegmentURL"===e.nodeName){const[t,n]=cc(e);r.push(t),i=i.concat(n)}}const a=R(t,{list:r});return[a,i]}function hc(e){let t=null;return function(){if(null===t){const n=e.getElementsByTagName("S");return t=n,n}return t}}function fc(e){const[t,n]=uc(e),i=n;let s;for(let r=0;r<e.childNodes.length;r++)if(e.childNodes[r].nodeType===Node.ELEMENT_NODE){const t=e.childNodes[r];"SegmentTimeline"===t.nodeName&&(s=hc(t))}const a=R({},t,{duration:t.duration,timelineParser:s}),o=nc(a,i);for(let l=0;l<e.attributes.length;l++){const t=e.attributes[l];switch(t.nodeName){case"initialization":r(a.initialization)&&(a.initialization={media:t.value});break;case"index":a.index=t.value;break;case"availabilityTimeOffset":o(t.value,{asKey:"availabilityTimeOffset",parser:Ku,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":o(t.value,{asKey:"availabilityTimeComplete",parser:qu,dashName:"availabilityTimeComplete"});break;case"media":a.media=t.value;break;case"bitstreamSwitching":o(t.value,{asKey:"bitstreamSwitching",parser:qu,dashName:"bitstreamSwitching"});break}}return[a,i]}function pc(e){const t={baseURLs:[]},n=[];let i=[];for(let s=0;s<e.length;s++)if(e[s].nodeType===Node.ELEMENT_NODE){const a=e[s];switch(a.nodeName){case"BaseURL":const[e,s]=$u(a);void 0!==e&&t.baseURLs.push(e),i=i.concat(s);break;case"InbandEventStream":void 0===t.inbandEventStreams&&(t.inbandEventStreams=[]),t.inbandEventStreams.push(tc(a));break;case"SegmentBase":const[o,l]=uc(a);t.segmentBase=o,l.length>0&&(i=i.concat(l));break;case"SegmentList":const[u,c]=dc(a);i=i.concat(c),t.segmentList=u;break;case"SegmentTemplate":const[d,h]=fc(a);i=i.concat(h),t.segmentTemplate=d;break;case"ContentProtection":const[f,p]=ac(a);p.length>0&&(i=i.concat(p)),void 0!==f&&n.push(f);break;case"SupplementalProperty":r(t.supplementalProperties)?t.supplementalProperties=[tc(a)]:t.supplementalProperties.push(tc(a));break}}return n.length>0&&(t.contentProtections=n),[t,i]}function gc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"audioSamplingRate":t.audioSamplingRate=n.value;break;case"bandwidth":i(n.value,{asKey:"bitrate",parser:Wu,dashName:"bandwidth"});break;case"codecs":t.codecs=n.value;break;case"codingDependency":i(n.value,{asKey:"codingDependency",parser:qu,dashName:"codingDependency"});break;case"frameRate":i(n.value,{asKey:"frameRate",parser:ec,dashName:"frameRate"});break;case"height":i(n.value,{asKey:"height",parser:Wu,dashName:"height"});break;case"id":t.id=n.value;break;case"maxPlayoutRate":i(n.value,{asKey:"maxPlayoutRate",parser:Ku,dashName:"maxPlayoutRate"});break;case"maximumSAPPeriod":i(n.value,{asKey:"maximumSAPPeriod",parser:Ku,dashName:"maximumSAPPeriod"});break;case"mimeType":t.mimeType=n.value;break;case"profiles":t.profiles=n.value;break;case"qualityRanking":i(n.value,{asKey:"qualityRanking",parser:Wu,dashName:"qualityRanking"});break;case"scte214:supplementalCodecs":t.supplementalCodecs=n.value;break;case"segmentProfiles":t.segmentProfiles=n.value;break;case"width":i(n.value,{asKey:"width",parser:Wu,dashName:"width"});break;case"availabilityTimeOffset":i(n.value,{asKey:"availabilityTimeOffset",parser:Ku,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":i(n.value,{asKey:"availabilityTimeComplete",parser:qu,dashName:"availabilityTimeComplete"});break}}return void 0===t.bitrate&&n.push(new ic("No bitrate found on a Representation")),[t,n]}function mc(e){const[t,n]=pc(e.childNodes),[i,r]=gc(e),s=n.concat(r);return[{children:t,attributes:i},s]}function vc(e){const t={baseURLs:[],representations:[]},n=[];let i=[];for(let s=0;s<e.length;s++)if(e[s].nodeType===Node.ELEMENT_NODE){const a=e[s];switch(a.nodeName){case"Accessibility":void 0===t.accessibilities?t.accessibilities=[tc(a)]:t.accessibilities.push(tc(a));break;case"BaseURL":const[e,s]=$u(a);void 0!==e&&t.baseURLs.push(e),s.length>0&&(i=i.concat(s));break;case"ContentComponent":t.contentComponent=oc(a);break;case"EssentialProperty":r(t.essentialProperties)?t.essentialProperties=[tc(a)]:t.essentialProperties.push(tc(a));break;case"InbandEventStream":void 0===t.inbandEventStreams&&(t.inbandEventStreams=[]),t.inbandEventStreams.push(tc(a));break;case"Label":const o=a.textContent;null!==o&&void 0!==o&&(t.label=o);break;case"Representation":const[l,u]=mc(a);t.representations.push(l),u.length>0&&(i=i.concat(u));break;case"Role":r(t.roles)?t.roles=[tc(a)]:t.roles.push(tc(a));break;case"SupplementalProperty":r(t.supplementalProperties)?t.supplementalProperties=[tc(a)]:t.supplementalProperties.push(tc(a));break;case"SegmentBase":const[c,d]=uc(a);t.segmentBase=c,d.length>0&&(i=i.concat(d));break;case"SegmentList":const[h,f]=dc(a);t.segmentList=h,f.length>0&&(i=i.concat(f));break;case"SegmentTemplate":const[p,g]=fc(a);t.segmentTemplate=p,g.length>0&&(i=i.concat(g));break;case"ContentProtection":const[m,v]=ac(a);v.length>0&&(i=i.concat(v)),void 0!==m&&n.push(m);break}}return n.length>0&&(t.contentProtections=n),[t,i]}function yc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"id":t.id=n.value;break;case"group":i(n.value,{asKey:"group",parser:Wu,dashName:"group"});break;case"lang":t.language=n.value;break;case"contentType":t.contentType=n.value;break;case"par":t.par=n.value;break;case"minBandwidth":i(n.value,{asKey:"minBitrate",parser:Wu,dashName:"minBandwidth"});break;case"maxBandwidth":i(n.value,{asKey:"maxBitrate",parser:Wu,dashName:"maxBandwidth"});break;case"minWidth":i(n.value,{asKey:"minWidth",parser:Wu,dashName:"minWidth"});break;case"maxWidth":i(n.value,{asKey:"maxWidth",parser:Wu,dashName:"maxWidth"});break;case"minHeight":i(n.value,{asKey:"minHeight",parser:Wu,dashName:"minHeight"});break;case"maxHeight":i(n.value,{asKey:"maxHeight",parser:Wu,dashName:"maxHeight"});break;case"minFrameRate":i(n.value,{asKey:"minFrameRate",parser:ec,dashName:"minFrameRate"});break;case"maxFrameRate":i(n.value,{asKey:"maxFrameRate",parser:ec,dashName:"maxFrameRate"});break;case"selectionPriority":i(n.value,{asKey:"selectionPriority",parser:Wu,dashName:"selectionPriority"});break;case"segmentAlignment":i(n.value,{asKey:"segmentAlignment",parser:Yu,dashName:"segmentAlignment"});break;case"subsegmentAlignment":i(n.value,{asKey:"subsegmentAlignment",parser:Yu,dashName:"subsegmentAlignment"});break;case"bitstreamSwitching":i(n.value,{asKey:"bitstreamSwitching",parser:qu,dashName:"bitstreamSwitching"});break;case"audioSamplingRate":t.audioSamplingRate=n.value;break;case"codecs":t.codecs=n.value;break;case"scte214:supplementalCodecs":t.supplementalCodecs=n.value;break;case"codingDependency":i(n.value,{asKey:"codingDependency",parser:qu,dashName:"codingDependency"});break;case"frameRate":i(n.value,{asKey:"frameRate",parser:ec,dashName:"frameRate"});break;case"height":i(n.value,{asKey:"height",parser:Wu,dashName:"height"});break;case"maxPlayoutRate":i(n.value,{asKey:"maxPlayoutRate",parser:Ku,dashName:"maxPlayoutRate"});break;case"maximumSAPPeriod":i(n.value,{asKey:"maximumSAPPeriod",parser:Ku,dashName:"maximumSAPPeriod"});break;case"mimeType":t.mimeType=n.value;break;case"profiles":t.profiles=n.value;break;case"segmentProfiles":t.segmentProfiles=n.value;break;case"width":i(n.value,{asKey:"width",parser:Wu,dashName:"width"});break;case"availabilityTimeOffset":i(n.value,{asKey:"availabilityTimeOffset",parser:Ku,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":i(n.value,{asKey:"availabilityTimeComplete",parser:qu,dashName:"availabilityTimeComplete"});break}}return[t,n]}function bc(e){const t=e.childNodes,[n,i]=vc(t),[r,s]=yc(e),a=i.concat(s);return[{children:n,attributes:r},a]}function _c(e){const t={children:{events:[]},attributes:{}};let n=[];const i=nc(t.attributes,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"schemeIdUri":t.attributes.schemeIdUri=n.value;break;case"timescale":i(n.value,{asKey:"timescale",parser:Wu,dashName:"timescale"});break;case"value":t.attributes.value=n.value;break}}for(let r=0;r<e.childNodes.length;r++)if(e.childNodes[r].nodeType===Node.ELEMENT_NODE){const i=e.childNodes[r];switch(i.nodeName){case"Event":const[e,r]=Tc(i);t.children.events.push(e),r.length>0&&(n=n.concat(r));break}}return[t,n]}function Tc(e){const t={eventStreamData:e},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"presentationTime":i(n.value,{asKey:"presentationTime",parser:Wu,dashName:"presentationTime"});break;case"duration":i(n.value,{asKey:"duration",parser:Wu,dashName:"duration"});break;case"id":t.id=n.value;break}}return[t,n]}function Sc(e){const t=[],n=[];let i;const r=[];let s=[];const a=[];for(let o=0;o<e.length;o++)if(e[o].nodeType===Node.ELEMENT_NODE){const l=e[o];switch(l.nodeName){case"BaseURL":const[e,o]=$u(l);void 0!==e&&t.push(e),s=s.concat(o);break;case"AdaptationSet":const[u,c]=bc(l);n.push(u),s=s.concat(c);break;case"EventStream":const[d,h]=_c(l);a.push(d),s=s.concat(h);break;case"SegmentTemplate":const[f,p]=fc(l);i=f,p.length>0&&(s=s.concat(p));break;case"ContentProtection":const[g,m]=ac(l);m.length>0&&(s=s.concat(m)),void 0!==g&&r.push(g);break}}return[{baseURLs:t,adaptations:n,eventStreams:a,segmentTemplate:i,contentProtections:r},s]}function wc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"id":t.id=n.value;break;case"start":i(n.value,{asKey:"start",parser:Qu,dashName:"start"});break;case"duration":i(n.value,{asKey:"duration",parser:Qu,dashName:"duration"});break;case"bitstreamSwitching":i(n.value,{asKey:"bitstreamSwitching",parser:qu,dashName:"bitstreamSwitching"});break;case"xlink:href":t.xlinkHref=n.value;break;case"xlink:actuate":t.xlinkActuate=n.value;break}}return[t,n]}function Ec(e){const[t,n]=Sc(e.childNodes),[i,r]=wc(e),s=n.concat(r);return[{children:t,attributes:i},s]}function xc(e){const t=[],n=[],i=[],r=[],s=[];let a=[];for(let o=0;o<e.length;o++)if(e[o].nodeType===Node.ELEMENT_NODE){const l=e[o];switch(l.nodeName){case"BaseURL":const[e,o]=$u(l);void 0!==e&&t.push(e),a=a.concat(o);break;case"Location":n.push(null===l.textContent?"":l.textContent);break;case"Period":const[u,c]=Ec(l);i.push(u),a=a.concat(c);break;case"UTCTiming":const d=tc(l);r.push(d);break;case"ContentProtection":const[h,f]=ac(l);f.length>0&&(a=a.concat(f)),void 0!==h&&s.push(h);break}}return[{baseURLs:t,locations:n,periods:i,utcTimings:r,contentProtections:s},a]}function kc(e){const t={},n=[],i=nc(t,n);for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r];switch(n.name){case"id":t.id=n.value;break;case"profiles":t.profiles=n.value;break;case"type":t.type=n.value;break;case"availabilityStartTime":i(n.value,{asKey:"availabilityStartTime",parser:Xu,dashName:"availabilityStartTime"});break;case"availabilityEndTime":i(n.value,{asKey:"availabilityEndTime",parser:Xu,dashName:"availabilityEndTime"});break;case"publishTime":i(n.value,{asKey:"publishTime",parser:Xu,dashName:"publishTime"});break;case"mediaPresentationDuration":i(n.value,{asKey:"duration",parser:Qu,dashName:"mediaPresentationDuration"});break;case"minimumUpdatePeriod":i(n.value,{asKey:"minimumUpdatePeriod",parser:Qu,dashName:"minimumUpdatePeriod"});break;case"minBufferTime":i(n.value,{asKey:"minBufferTime",parser:Qu,dashName:"minBufferTime"});break;case"timeShiftBufferDepth":i(n.value,{asKey:"timeShiftBufferDepth",parser:Qu,dashName:"timeShiftBufferDepth"});break;case"suggestedPresentationDelay":i(n.value,{asKey:"suggestedPresentationDelay",parser:Qu,dashName:"suggestedPresentationDelay"});break;case"maxSegmentDuration":i(n.value,{asKey:"maxSegmentDuration",parser:Qu,dashName:"maxSegmentDuration"});break;case"maxSubsegmentDuration":i(n.value,{asKey:"maxSubsegmentDuration",parser:Qu,dashName:"maxSubsegmentDuration"});break}}return[t,n]}function Ac(e){const[t,n]=xc(e.childNodes),[i,r]=kc(e),s=n.concat(r);return[{children:t,attributes:i},s]}function Ic(e,t){const n=e.documentElement;if(r(n)||"MPD"!==n.nodeName)throw new Error("DASH Parser: document root should be MPD");const[i,s]=Ac(n),a=Hu(i,t,s);return o(a);function o(e){return"done"===e.type?e:"needs-clock"===e.type?{type:"needs-resources",value:{urls:[e.value.url],format:"string",continue(t){if(1!==t.length)throw new Error("DASH parser: wrong number of loaded ressources.");const n=e.value.continue(t[0].responseData);return o(n)}}}:"needs-xlinks"===e.type?{type:"needs-resources",value:{urls:e.value.xlinksUrls,format:"string",continue(t){const n=[];for(let e=0;e<t.length;e++){const{responseData:i,receivedTime:s,sendingTime:a,url:o}=t[e];if(!i.success)throw i.error;const l="<root>"+i.data+"</root>",u=(new DOMParser).parseFromString(l,"text/xml");if(r(u)||0===u.children.length)throw new Error("DASH parser: Invalid external ressources");const c=u.children[0].children,d=[],h=[];for(let e=0;e<c.length;e++)if(c[e].nodeType===Node.ELEMENT_NODE){const[t,n]=Ec(c[e]);h.push(...n),d.push(t)}n.push({url:o,receivedTime:s,sendingTime:a,parsed:d,warnings:h})}const i=e.value.continue(n);return o(i)}}}:void ge(e)}}var Cc=Ic;function Dc(e){const{referenceDateTime:t}=e,n=void 0!==e.serverSyncInfos?e.serverSyncInfos.serverTimestamp-e.serverSyncInfos.clientTime:void 0;return function(i,r,s,a,o){var l;const{responseData:u}=i,c=r.externalClockOffset,d=null!==(l=i.url)&&void 0!==l?l:r.originalUrl,h=null!==n&&void 0!==n?n:c,f=r.unsafeMode?r.previousManifest:null,p={unsafelyBaseOnPreviousManifest:f,url:d,referenceDateTime:t,externalClockOffset:h},g=qt.dashParsers;if(null===g.wasm||"uninitialized"===g.wasm.status||"failure"===g.wasm.status)return V.debug("DASH: WASM MPD Parser not initialized. Running JS one."),m();{const e=Oc(u);if(!Nc(e))return V.info("DASH: MPD doesn't seem to be UTF-8-encoded. Running JS parser instead of the WASM one."),m();if("initialized"===g.wasm.status){V.debug("DASH: Running WASM MPD Parser.");const t=g.wasm.runWasmParser(e,p);return v(t)}{V.debug("DASH: Awaiting WASM initialization before parsing the MPD.");const t=g.wasm.waitForInitialization().catch(()=>{});return t.then(()=>{if(null===g.wasm||"initialized"!==g.wasm.status)return V.warn("DASH: WASM MPD parser initialization failed. Running JS parser instead"),m();V.debug("DASH: Running WASM MPD Parser.");const t=g.wasm.runWasmParser(e,p);return v(t)})}}function m(){if(null!==g.fastJs){const e=Lc(u),t=g.fastJs(e,p);return v(t)}if(null!==g.native){const e=Pc(u),t=g.native(e,p);return v(t)}throw new Error("No MPD parser is imported")}function v(t){if("done"===t.type){if(t.value.warnings.length>0&&s(t.value.warnings),a.isCancelled())return Promise.reject(a.cancellationError);const n=[],i=new an(t.value.parsed,e,n);return{manifest:i,url:d,warnings:n}}const{value:n}=t,i=n.urls.map(e=>{return o(()=>{const t=N.getCurrent().DEFAULT_REQUEST_TIMEOUT,i=N.getCurrent().DEFAULT_CONNECTION_TIMEOUT;return"string"===n.format?Ao({url:e,responseType:"text",timeout:t,connectionTimeout:i,cancelSignal:a}):Ao({url:e,responseType:"arraybuffer",timeout:t,connectionTimeout:i,cancelSignal:a})}).then(e=>{if("string"===n.format){if("string"!==typeof e.responseData)throw new Error("External DASH resources should have been a string");return R(e,{responseData:{success:!0,data:e.responseData}})}if(!(e.responseData instanceof ArrayBuffer))throw new Error("External DASH resources should have been ArrayBuffers");return R(e,{responseData:{success:!0,data:e.responseData}})},e=>{const t=ft(e,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"An unknown error occured when parsing ressources."});return R({},{size:void 0,requestDuration:void 0,responseData:{success:!1,error:t}})})});return Promise.all(i).then(e=>{return"string"===n.format?(Rc(e),v(n.continue(e))):(Mc(e),v(n.continue(e)))})}}}function Rc(e){}function Mc(e){}function Lc(e){if(e instanceof ArrayBuffer)return Da(new Uint8Array(e));if("string"===typeof e)return e;if(e instanceof Document)return e.documentElement.outerHTML;throw new Error("DASH Manifest Parser: Unrecognized Manifest format")}function Pc(e){if(e instanceof ArrayBuffer)return(new DOMParser).parseFromString(Da(new Uint8Array(e)),"text/xml");if("string"===typeof e)return(new DOMParser).parseFromString(e,"text/xml");if(e instanceof Document)return e;throw new Error("DASH Manifest Parser: Unrecognized Manifest format")}function Oc(e){if(e instanceof ArrayBuffer)return e;if("string"===typeof e)return Aa(e).buffer;if(e instanceof Document)return Aa(e.documentElement.innerHTML).buffer;throw new Error("DASH Manifest Parser: Unrecognized Manifest format")}function Nc(e){const t=new DataView(e);return 61371===t.getUint16(0)&&191===t.getUint8(2)||65279!==t.getUint16(0)&&65534!==t.getUint16(0)}const Uc="function"===typeof Headers?Headers:null,Fc="function"===typeof AbortController?AbortController:null;function Bc(e){var t,n;let i;if(!r(e.headers))if(r(Uc))i=e.headers;else{i=new Uc;const t=Object.keys(e.headers);for(let n=0;n<t.length;n++){const r=t[n];i.append(r,e.headers[r])}}V.debug("Fetch: Called with URL",e.url);let s=null,a=!1,o=!1;const l=Se(),u=r(Fc)?null:new Fc;function c(){r(u)?V.warn("Fetch: AbortController API not available."):u.abort()}let d,h;void 0!==e.timeout&&(d=setTimeout(()=>{a=!0,void 0!==h&&clearTimeout(h),c()},e.timeout)),void 0!==e.connectionTimeout&&(h=setTimeout(()=>{o=!0,void 0!==d&&clearTimeout(d),c()},e.connectionTimeout));const f=e.cancelSignal.register(function(e){s=e,c()}),p={method:"GET"};if(void 0!==i&&(p.headers=i),p.signal=r(u)?null:u.signal,V.hasLevel("DEBUG")){let i="FETCH: Sending GET "+e.url;void 0!==e.timeout&&(i+=" to="+String(e.timeout/1e3)),void 0!==e.connectionTimeout&&(i+=" cto="+String(e.connectionTimeout/1e3)),void 0!==(null===(t=e.headers)||void 0===t?void 0:t.Range)&&(i+=" Range="+(null===(n=e.headers)||void 0===n?void 0:n.Range)),V.debug(i)}return fetch(e.url,p).then(t=>{if(void 0!==h&&clearTimeout(h),t.status>=300)throw V.warn("Fetch: Request HTTP Error",t.status,t.url),new nt(t.url,t.status,it.ERROR_HTTP_CODE);if(r(t.body))throw new nt(t.url,t.status,it.PARSE_ERROR);const n=t.headers.get("Content-Length"),i=r(n)||isNaN(+n)?void 0:+n,s=t.body.getReader();let a=0;return o();async function o(){const n=await s.read();if(!n.done&&!r(n.value)){a+=n.value.byteLength;const r=Se(),s={url:t.url,currentTime:r,duration:r-l,sendingTime:l,chunkSize:n.value.byteLength,chunk:n.value.buffer,size:a,totalSize:i};return e.onData(s),o()}if(n.done){void 0!==d&&clearTimeout(d),f();const e=Se(),n=e-l;return{requestDuration:n,receivedTime:e,sendingTime:l,size:a,status:t.status,url:t.url}}return o()}}).catch(t=>{if(null!==s)throw s;if(f(),a)throw V.warn("Fetch: Request timed out."),new nt(e.url,0,it.TIMEOUT);if(o)throw V.warn("Fetch: Request connection timed out."),new nt(e.url,0,it.TIMEOUT);if(t instanceof nt)throw t;throw V.warn("Fetch: Request Error",t instanceof Error?t.toString():""),new nt(e.url,0,it.ERROR_EVENT)})}function jc(){return"function"===typeof a["a"].fetch&&!r(Fc)&&!r(Uc)}function Vc(e,t){return"audio"===e||"video"===e?"video/mp4"===t||"audio/mp4"===t?"mp4":"video/webm"===t||"audio/webm"===t?"webm":void 0:"text"===e&&"application/mp4"===t?"mp4":void 0}function Hc(e){return(t,n,i,r,s)=>{return new Promise((o,l)=>{const u=new me,c=u.linkToSignal(r);function d(){u.signal.deregister(l),c()}u.signal.register(l),e(t,n,i,u.signal,Object.assign(Object.assign({},s),{onNewChunk(e){try{a(e),s.onNewChunk(e)}catch(e){d(),u.cancel(),l(e)}}})).then(e=>{if(d(),!u.isUsed()){if("segment-loaded"===e.resultType)try{a(e.resultData.responseData)}catch(e){return void l(e)}o(e)}},e=>{d(),l(e)})});function a(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&"mp4"===Vc(n.type,n.mimeType)&&Co(new Uint8Array(e),n.segment.isInit)}}}function $c(e,t){return null===e?null:null===t.url?e.baseUrl:Sa(e.baseUrl,t.url)}function Gc(e,t,n,i,r){if(void 0===t.range)return Ao({url:e,responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}).then(e=>({resultType:"segment-loaded",resultData:e}));if(void 0===t.indexRange)return Ao({url:e,headers:{Range:yl(t.range)},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}).then(e=>({resultType:"segment-loaded",resultData:e}));if(t.range[1]+1===t.indexRange[0])return Ao({url:e,headers:{Range:yl([t.range[0],t.indexRange[1]])},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}).then(e=>({resultType:"segment-loaded",resultData:e}));const s=Ao({url:e,headers:{Range:yl(t.range)},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}),a=Ao({url:e,headers:{Range:yl(t.indexRange)},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress});return Promise.all([s,a]).then(([t,n])=>{const i=jr(new Uint8Array(t.responseData),new Uint8Array(n.responseData)),r=Math.min(t.sendingTime,n.sendingTime),s=Math.max(t.receivedTime,n.receivedTime);return{resultType:"segment-loaded",resultData:{url:e,responseData:i,size:t.size+n.size,requestDuration:s-r,sendingTime:r,receivedTime:s}}})}function zc(e){let t=0;const n=[];let i=null;while(t<=e.length){if(t===e.length){i=null;break}i=e.subarray(t,1/0);const r=Io(i,1836019558);if(r<0)break;const s=$r(e,r+t),a=t+r+s;if(a>e.length)break;const o=Io(i,1835295092);if(o<0)break;const l=$r(e,o+t),u=t+o+l;if(u>e.length)break;const c=Math.max(a,u),d=e.subarray(t,c);n.push(d),t=c}return 0===n.length?[null,i]:[n,i]}function qc(e,t,n,i,r){const{segment:s}=t,a=void 0!==s.range?{Range:yl(s.range)}:void 0;let o=null;function l(e){const t=new Uint8Array(e.chunk),n=null!==o?jr(o,t):t,s=zc(n),a=s[0];o=s[1],null!==a&&(a.forEach(e=>{i.onNewChunk(e)}),r.isCancelled())||(i.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize}),r.isCancelled())}return Bc({url:e,headers:a,onData:l,timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:r}).then(e=>({resultType:"chunk-complete",resultData:e}))}function Wc(e,t,n,i,r,s){if(t.segment.isInit)return Gc(e,t.segment,i,s,r);const a=Vc(t.type,t.mimeType);if(n&&("mp4"===a||void 0===a)){if(jc())return qc(e,t,i,r,s);vt("DASH: Your browser does not have the fetch API. You will have a higher chance of rebuffering when playing close to the live edge")}const{segment:o}=t;return Ao({url:e,responseType:"arraybuffer",headers:void 0!==o.range?{Range:yl(o.range)}:void 0,timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:s,onProgress:r.onProgress}).then(e=>({resultType:"segment-loaded",resultData:e}))}function Kc({lowLatencyMode:e,segmentLoader:t,checkMediaSegmentIntegrity:n}){return!0!==n?i:Hc(i);function i(n,i,r,s,a){const o=$c(n,i.segment);return null===o?Promise.resolve({resultType:"segment-created",resultData:null}):e||void 0===t?Wc(o,i,e,r,a,s):new Promise((n,l)=>{let u=!1;const c=e=>{u||s.isCancelled()||(u=!0,s.deregister(y),n({resultType:"segment-loaded",resultData:{responseData:e.data,size:e.size,requestDuration:e.duration}}))},d=e=>{var t,n;if(u||s.isCancelled())return;u=!0,s.deregister(y);const i=e,r=null!==(t=null===i||void 0===i?void 0:i.message)&&void 0!==t?t:"Unknown error when fetching a DASH segment through a custom segmentLoader.",a=new ln(r,null!==(n=null===i||void 0===i?void 0:i.canRetry)&&void 0!==n&&n,null===i||void 0===i?void 0:i.xhr);l(a)},h=e=>{u||s.isCancelled()||a.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize})},f=()=>{u||s.isCancelled()||(u=!0,s.deregister(y),Wc(o,i,e,r,a,s).then(n,l))},p={reject:d,resolve:c,progress:h,fallback:f};let g;void 0!==i.segment.range&&(g=[i.segment.range],void 0!==i.segment.indexRange&&g.push(i.segment.indexRange));const m={isInit:i.segment.isInit,timeout:r.timeout,byteRanges:g,trackType:i.type,url:o},v=t(m,p);function y(e){u||(u=!0,"function"===typeof v&&v(),l(e))}s.register(y)})}}function Yc(e,t,n){return new Uint8Array(Array.prototype.slice.call(e,t,n))}function Xc(e,t,n){return e.slice(t,n)}var Qc="function"===typeof Uint8Array.prototype.slice?Xc:Yc;function Zc(e){let t=0;const n=ea(e,1836019574);if(null===n)return[];const i=[];while(t<n.length){let e;try{e=ia(n,1886614376)}catch(e){const t=e instanceof Error?e:"";return V.warn("Error while removing PSSH from ISOBMFF",t),i}if(null===e)return i;const r=Qc(n,e[0],e[2]),s=Jc(r,e[1]-e[0]);void 0!==s&&i.push({systemId:s,data:r}),n[e[0]+4]=102,n[e[0]+5]=114,n[e[0]+6]=101,n[e[0]+7]=101,t=e[2]}return i}function Jc(e,t){if(e[t]>1)return void V.warn("ISOBMFF: un-handled PSSH version");const n=t+4;if(n+16>e.length)return;const i=Qc(e,n,n+16);return Ma(i)}const ed=408125543,td=357149030,nd=2807729,id=17545,rd=475249515,sd=187,ad=179,od=183,ld=241;function ud(e,t,n,[i,r]){let s=i;while(s<r){const i=pd(n,s);if(null===i)return null;const{value:r,length:a}=i,o=s+a,l=gd(n,o);if(null===l)return null;const{length:u,value:c}=l,d=o+u,h=d+c;if(r===e)return[d,h];if(t.length>0)for(let s=0;s<t.length;s++)if(r===t[s]){const i=t.slice(s+1,t.length);return ud(e,i,n,[d,h])}s=h}return null}function cd(e,t){const n=ud(nd,[ed,td],e,[t,e.length]);if(null===n)return null;const i=n[1]-n[0];return 1e9/yd(e,n[0],i)}function dd(e,t){const n=ud(id,[ed,td],e,[t,e.length]);if(null===n)return null;const i=n[1]-n[0];return 4===i?md(e,n[0]):8===i?vd(e,n[0]):null}function hd(e,t){const n=ud(ed,[],e,[t,e.length]);if(null===n)return null;const[i,r]=n,s=cd(e,i);if(null===s)return null;const a=dd(e,i);if(null===a)return null;const o=ud(rd,[],e,[i,r]);if(null===o)return null;const l=[];let u=o[0];while(u<o[1]){const t=ud(sd,[],e,[u,o[1]]);if(null===t)break;const n=ud(ad,[],e,[t[0],t[1]]);if(null===n)return null;const r=yd(e,n[0],n[1]-n[0]),s=ud(ld,[od],e,[t[0],t[1]]);if(null===s)return null;const a=yd(e,s[0],s[1]-s[0])+i;l.push({time:r,rangeStart:a}),u=t[1]}const c=[];for(let d=0;d<l.length;d++){const e=l[d];d===l.length-1?c.push({time:e.time,timescale:s,duration:0===d?a:a-e.time,range:[e.rangeStart,1/0]}):c.push({time:e.time,timescale:s,duration:l[d+1].time-e.time,range:[e.rangeStart,l[d+1].rangeStart-1]})}return c}function fd(e,t){for(let n=1;n<=8;n++)if(e[t]>=Math.pow(2,8-n))return n}function pd(e,t){const n=fd(e,t);if(void 0===n)return V.warn("webm: unrepresentable length"),null;if(t+n>e.length)return V.warn("webm: impossible length"),null;let i=0;for(let r=0;r<n;r++)i=e[t+r]*Math.pow(2,8*(n-r-1))+i;return{length:n,value:i}}function gd(e,t){const n=fd(e,t);if(void 0===n)return V.warn("webm: unrepresentable length"),null;if(t+n>e.length)return V.warn("webm: impossible length"),null;let i=(e[t]&(1<<8-n)-1)*Math.pow(2,8*(n-1));for(let r=1;r<n;r++)i=e[t+r]*Math.pow(2,8*(n-r-1))+i;return{length:n,value:i}}function md(e,t){return new DataView(e.buffer).getFloat32(t)}function vd(e,t){return new DataView(e.buffer).getFloat64(t)}function yd(e,t,n){let i=0;for(let r=0;r<n;r++)i=e[t+r]*Math.pow(2,8*(n-r-1))+i;return i}function bd(e,t,n,i){const r=Po(e);if(void 0===r||void 0===i)return null;let s,a=void 0!==n.timestampOffset?r+n.timestampOffset*i:r,o=No(e);if(a<0&&(void 0!==o&&(o+=a),a=0),t||!n.complete)return void 0===o&&V.warn("DASH: Chunked segments should indicate a duration through their trun boxes"),{time:a/i,duration:void 0!==o?o/i:void 0};const l=n.duration*i,u=Math.min(.9*i,l/4);return void 0!==o&&Math.abs(o-l)<=u&&(s=o),{time:a/i,duration:void 0!==s?s/i:s}}function _d(e,t){if(e.length<=0)return!1;const n=e.length;for(let i=0;i<n;i++){const n=e[i],r=t,{messageData:s}=n,a=Da(s),o=Date.parse(a);if(void 0===r||void 0===o||isNaN(o)||o>=r)return!0}return!1}function Td(e,t){if(0===e.length)return;const{manifestRefreshEventsFromEMSGs:n,EMSGs:i}=e.reduce((e,t)=>{return"urn:mpeg:dash:event:2012"===t.schemeIdUri&&"1"===t.value?(void 0===e.manifestRefreshEventsFromEMSGs&&(e.manifestRefreshEventsFromEMSGs=[]),e.manifestRefreshEventsFromEMSGs.push(t)):(void 0===e.EMSGs&&(e.EMSGs=[]),e.EMSGs.push(t)),e},{manifestRefreshEventsFromEMSGs:void 0,EMSGs:void 0}),r=null===i||void 0===i?void 0:i.map(e=>({type:"emsg",value:e})),s=void 0!==t&&void 0!==n&&_d(n,t);return{inbandEvents:r,needsManifestRefresh:s}}function Sd({__priv_patchLastSegmentInSidx:e}){return function(t,n,i){var s,a;const{segment:o,periodStart:l,periodEnd:u}=n,{data:c,isChunked:d}=t,h=[l,u];if(null===c)return o.isInit?{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:"media",chunkData:null,chunkSize:0,chunkInfos:null,chunkOffset:0,protectionData:[],appendWindow:h};const f=c instanceof Uint8Array?c:new Uint8Array(c),p=Vc(n.type,n.mimeType),g="mp4"===p||void 0===p,m=[];if(g){const e=Zc(f);let t;o.isInit&&(t=null!==(s=jo(f))&&void 0!==s?s:void 0),(e.length>0||void 0!==t)&&m.push({initDataType:"cenc",keyId:t,initData:e})}if(!o.isInit){const e=g?bd(f,d,o,i):null,t=null!==(a=o.timestampOffset)&&void 0!==a?a:0;if(g){const i=Bo(f);if(void 0!==i){const r=i.filter(e=>{return void 0!==o.privateInfos&&void 0!==o.privateInfos.isEMSGWhitelisted&&o.privateInfos.isEMSGWhitelisted(e)}),s=Td(r,n.manifestPublishTime);if(void 0!==s){const{needsManifestRefresh:n,inbandEvents:i}=s;return{segmentType:"media",chunkData:f,chunkSize:f.length,chunkInfos:e,chunkOffset:t,appendWindow:h,inbandEvents:i,protectionData:m,needsManifestRefresh:n}}}}return{segmentType:"media",chunkData:f,chunkSize:f.length,chunkInfos:e,chunkOffset:t,protectionData:m,appendWindow:h}}const{indexRange:v}=o;let y,b;if("webm"===p)y=hd(f,0);else if(g&&(y=Lo(f,Array.isArray(v)?v[0]:0),!0===e&&null!==y&&y.length>0)){const e=y[y.length-1];Array.isArray(e.range)&&(e.range[1]=1/0)}g?b=Uo(f):"webm"===p&&(b=cd(f,0));const _=r(b)?void 0:b;return{segmentType:"init",initializationData:f,initializationDataSize:f.length,protectionData:m,initTimescale:_,segmentList:null!==y&&void 0!==y?y:void 0}}}function wd({lowLatencyMode:e,checkMediaSegmentIntegrity:t}){return!0!==t?n:Hc(n);function n(t,n,i,r,s){const{segment:a}=n,{range:o}=a,l=$c(t,a);if(null===l)return Promise.resolve({resultType:"segment-created",resultData:null});if(a.isInit)return Gc(l,a,i,r,s);const u=Vc(n.type,n.mimeType),c="mp4"===u||void 0===u;if(e&&c){if(jc())return qc(l,n,i,s,r);vt("DASH: Your browser does not have the fetch API. You will have a higher chance of rebuffering when playing close to the live edge")}return c?Ao({url:l,responseType:"arraybuffer",headers:Array.isArray(o)?{Range:yl(o)}:null,timeout:i.timeout,connectionTimeout:i.connectionTimeout,onProgress:s.onProgress,cancelSignal:r}).then(e=>({resultType:"segment-loaded",resultData:e})):Ao({url:l,responseType:"text",headers:Array.isArray(o)?{Range:yl(o)}:null,timeout:i.timeout,connectionTimeout:i.connectionTimeout,onProgress:s.onProgress,cancelSignal:r}).then(e=>({resultType:"segment-loaded",resultData:e}))}}function Ed(e){const t=la(e);return null===t?"":Da(t)}function xd(e){if(void 0===e)throw new Error("Cannot parse subtitles: unknown format");switch(e.toLowerCase()){case"stpp":case"stpp.ttml.im1t":return"ttml";case"wvtt":return"vtt"}throw new Error("The codec used for the subtitles "+`"${e}" is not managed yet.`)}function kd(e,t){switch(t){case"application/ttml+xml":return"ttml";case"application/x-sami":case"application/smil":return"sami";case"text/vtt":return"vtt"}if(void 0!==e){const t=e.toLowerCase();if("srt"===t)return"srt"}throw new Error(`could not find a text-track parser for the type ${null!==t&&void 0!==t?t:""}`)}function Ad({segment:e,language:t,codecs:n},i,r,s){if(e.isInit)return null;let a,o;null===r?s?(a=e.time,o=e.end):V.warn("Transport: Unavailable time data for current text track."):(a=r.time,void 0!==r.duration?o=a+r.duration:!s&&e.complete&&(o=a+e.duration));const l=xd(n),u=Ed(i);return{data:u,type:l,language:t,start:a,end:o}}function Id(e,t,n){const{segment:i}=e;if(i.isInit)return null;let r,s;n?V.warn("Transport: Unavailable time data for current text track."):(r=i.time,i.complete&&(s=i.time+i.duration));const a=kd(e.codecs,e.mimeType);return{data:t,type:a,language:e.language,start:r,end:s}}function Cd(e,t,n,i,r){var s;const{segment:a}=n,{isInit:o,indexRange:l}=a;let u;if(u="string"===typeof e?Aa(e):e instanceof Uint8Array?e:new Uint8Array(e),o){const e=Lo(u,Array.isArray(l)?l[0]:0);if(!0===r&&null!==e&&e.length>0){const t=e[e.length-1];Array.isArray(t.range)&&(t.range[1]=1/0)}const t=Uo(u);return{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:t,segmentList:null!==e&&void 0!==e?e:void 0}}const c=bd(u,t,a,i),d=Ad(n,u,c,t),h=null!==(s=a.timestampOffset)&&void 0!==s?s:0;return{segmentType:"media",chunkData:d,chunkSize:u.length,chunkInfos:c,chunkOffset:h,protectionData:[],appendWindow:[n.periodStart,n.periodEnd]}}function Dd(e,t,n){const{periodStart:i,periodEnd:r,segment:s}=n,{timestampOffset:a=0}=s;if(s.isInit)return{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0};let o,l;if("string"!==typeof e){const t=e instanceof Uint8Array?e:new Uint8Array(e);o=Da(t),l=t.length}else o=e;const u=Id(n,o,t);return{segmentType:"media",chunkData:u,chunkSize:l,chunkInfos:null,chunkOffset:a,protectionData:[],appendWindow:[i,r]}}function Rd({__priv_patchLastSegmentInSidx:e}){return function(t,n,i){var r;const{periodStart:s,periodEnd:a,segment:o}=n,{data:l,isChunked:u}=t;if(null===l)return o.isInit?{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:"media",chunkData:null,chunkSize:0,chunkInfos:null,chunkOffset:null!==(r=o.timestampOffset)&&void 0!==r?r:0,protectionData:[],appendWindow:[s,a]};const c=Vc(n.type,n.mimeType);if("webm"===c)throw new Error("Text tracks with a WEBM container are not yet handled.");return"mp4"===c?Cd(l,u,n,i,e):Dd(l,u,n)}}var Md=function(e){const t=Mo({customManifestLoader:e.manifestLoader},Ld()?"text":"arraybuffer"),n=Dc(e),i=Kc(e),r=Sd(e),s=wd(e),a=Rd(e);return{manifest:{loadManifest:t,parseManifest:n},audio:{loadSegment:i,parseSegment:r},video:{loadSegment:i,parseSegment:r},text:{loadSegment:s,parseSegment:a}}};function Ld(){return null!==qt.dashParsers.wasm&&("initialized"===qt.dashParsers.wasm.status||"initializing"===qt.dashParsers.wasm.status)}var Pd=Md;function Od(e){void 0===e.transports.dash&&(e.transports.dash=Pd),e.dashParsers.native=Cc,e.mainThreadMediaSourceInit=Hs,e.codecSupportProber=Zs}class Nd extends lr{constructor(e){super(),this._settings=e,this._initCanceller=new me}prepare(){}start(e,t){const n=this._initCanceller.signal,{keySystems:i,speed:r,url:s}=this._settings;fr(e);const a=new de(null);a.finish();const o=xs(e,i,a,{onError:e=>this._onFatalError(e),onWarning:e=>this.trigger("warning",e),onBlackListProtectionData:U,onKeyIdsCompatibilityUpdate:U},n);Vs(e,e=>this._onFatalError(e),n);const l=new Is(t,null,r);l.addEventListener("stalled",e=>this.trigger("stalled",e)),l.addEventListener("unstalled",()=>this.trigger("unstalled",null)),l.addEventListener("warning",e=>this.trigger("warning",e)),n.register(()=>{l.destroy()}),l.start(),o.onUpdate((i,r)=>{"uninitialized"!==i.initializationState.type&&(r(),V.info("Setting URL to HTMLMediaElement",s),e.src=s,n.register(()=>{V.info("Init: Removing directfile src from media element",e.src),fr(e)}),"awaiting-media-link"===i.initializationState.type?(i.initializationState.value.isMediaLinked.setValue(!0),o.onUpdate((n,i)=>{"initialized"===n.initializationState.type&&(i(),this._seekAndPlay(e,t))},{emitCurrentValue:!0,clearSignal:n})):(fe("initialized"===i.initializationState.type),this._seekAndPlay(e,t)))},{emitCurrentValue:!0,clearSignal:n})}updateContentUrls(e,t){throw new Error("Cannot update content URL of directfile contents")}dispose(){this._initCanceller.cancel()}_onFatalError(e){this._initCanceller.cancel(),this.trigger("error",e)}_seekAndPlay(e,t){const n=this._initCanceller.signal,{autoPlay:i,startAt:r}=this._settings,s=()=>{V.debug("Init: Calculating initial time");const t=Ud(e,r);return V.debug("Init: Initial time calculated:",t),t};Es({mediaElement:e,playbackObserver:t,startTime:s,mustAutoPlay:i,onWarning:e=>this.trigger("warning",e),isDirectfile:!0},n).autoPlayResult.then(()=>_s(t,e,!0,n).onUpdate((e,t)=>{e&&(t(),this.trigger("loaded",{getSegmentSinkMetrics:null}))},{emitCurrentValue:!0,clearSignal:n})).catch(e=>{n.isCancelled()||this._onFatalError(e)})}}function Ud(e,t){if(r(t))return 0;if(!r(t.position))return t.position;if(!r(t.wallClockTime))return t.wallClockTime;if(!r(t.fromFirstPosition))return t.fromFirstPosition;const n=e.duration;if("number"===typeof t.fromLastPosition)return r(n)||!isFinite(n)?(V.warn("startAt.fromLastPosition set but no known duration, beginning at 0."),0):Math.max(0,n+t.fromLastPosition);if("number"===typeof t.fromLivePosition){const i=e.seekable.length>0?e.seekable.end(0):n;return r(i)?(V.warn("startAt.fromLivePosition set but no known live position, beginning at 0."),0):Math.max(0,i+t.fromLivePosition)}if(!r(t.percentage)){if(r(n)||!isFinite(n))return V.warn("startAt.percentage set but no known duration, beginning at 0."),0;const{percentage:e}=t;if(e>=100)return n;if(e<=0)return 0;const i=+e/100;return n*i}return 0}function Fd(e,t){for(let n=0;n<e.length;n++)v&&n===t||(e[n].enabled=!1);return!(t<0||t>=e.length)&&(e[t].enabled=!0,!0)}function Bd(e,t){var n;if(t.length!==e.length)return!0;for(let i=0;i<t.length;i++)if(t[i].nativeTrack!==(null===(n=e[i])||void 0===n?void 0:n.nativeTrack))return!0;return!1}function jd(e){var t;const n=[],i={};for(let r=0;r<e.length;r++){const s=e[r],a=""===s.language?"nolang":s.language,o=null!==(t=i[a])&&void 0!==t?t:1,l="gen_audio_"+a+"_"+o.toString();i[a]=o+1;const u={language:s.language,id:l,normalized:$t(s.language),audioDescription:"descriptions"===s.kind||"description"===s.kind,representations:[]};n.push({track:u,nativeTrack:s})}return n}function Vd(e){var t;const n=[],i={};for(let r=0;r<e.length;r++){const s=e[r],a=""===s.language?"nolang":s.language,o=null!==(t=i[a])&&void 0!==t?t:1,l="gen_text_"+a+"_"+o.toString();i[a]=o+1;const u="forced"===s.kind||void 0,c={language:s.language,forced:u,label:s.label,id:l,normalized:$t(s.language),closedCaption:"captions"===s.kind};n.push({track:c,nativeTrack:s})}return n}function Hd(e){var t;const n=[],i={};for(let r=0;r<e.length;r++){const s=e[r],a=""===s.language?"nolang":s.language,o=null!==(t=i[a])&&void 0!==t?t:1,l="gen_video_"+a+"_"+o.toString();i[a]=o+1,n.push({track:{id:l,representations:[]},nativeTrack:s})}return n}class $d extends s{constructor(e){var t,n,i;super(),this._nativeAudioTracks=e.audioTracks,this._nativeVideoTracks=e.videoTracks,this._nativeTextTracks=e.textTracks,this._audioTracks=void 0!==this._nativeAudioTracks?jd(this._nativeAudioTracks):[],this._videoTracks=void 0!==this._nativeVideoTracks?Hd(this._nativeVideoTracks):[],this._textTracks=void 0!==this._nativeTextTracks?Vd(this._nativeTextTracks):[],this._lastEmittedNativeAudioTrack=null===(t=this._getCurrentAudioTrack())||void 0===t?void 0:t.nativeTrack,this._lastEmittedNativeVideoTrack=null===(n=this._getCurrentVideoTrack())||void 0===n?void 0:n.nativeTrack,this._lastEmittedNativeTextTrack=null===(i=this._getCurrentTextTrack())||void 0===i?void 0:i.nativeTrack,this._handleNativeTracksCallbacks()}setAudioTrackById(e){for(let t=0;t<this._audioTracks.length;t++){const{track:n,nativeTrack:i}=this._audioTracks[t];if(n.id===e)return this._enableAudioTrackFromIndex(t),void(this._audioTrackLockedOn=i)}throw new Error("Audio track not found.")}disableTextTrack(){Gd(this._textTracks),this._textTrackLockedOn=null}setTextTrackById(e){let t=!1;for(let n=0;n<this._textTracks.length;n++){const{track:i,nativeTrack:r}=this._textTracks[n];i.id===e?(r.mode="showing",t=!0,this._textTrackLockedOn=r):"showing"!==r.mode&&"hidden"!==r.mode||(r.mode="disabled")}if(!t)throw new Error("Text track not found.")}disableVideoTrack(){qd(this._videoTracks),this._videoTrackLockedOn=null}setVideoTrackById(e){for(let t=0;t<this._videoTracks.length;t++){const{track:n,nativeTrack:i}=this._videoTracks[t];if(n.id===e)return i.selected=!0,void(this._videoTrackLockedOn=i)}throw new Error("Video track not found.")}getChosenAudioTrack(){const e=this._getCurrentAudioTrack();return r(e)?e:e.track}getChosenTextTrack(){const e=this._getCurrentTextTrack();return r(e)?e:e.track}getChosenVideoTrack(){const e=this._getCurrentVideoTrack();return r(e)?e:e.track}getAvailableAudioTracks(){return this._audioTracks.map(({track:e,nativeTrack:t})=>{return{id:e.id,language:e.language,normalized:e.normalized,audioDescription:e.audioDescription,active:t.enabled,representations:e.representations}})}getAvailableTextTracks(){return this._textTracks.map(({track:e,nativeTrack:t})=>{return{id:e.id,label:e.label,forced:e.forced,language:e.language,normalized:e.normalized,closedCaption:e.closedCaption,active:"showing"===t.mode}})}getAvailableVideoTracks(){return this._videoTracks.map(({track:e,nativeTrack:t})=>{return{id:e.id,representations:e.representations,active:t.selected}})}dispose(){void 0!==this._nativeVideoTracks&&(this._nativeVideoTracks.onchange=null,this._nativeVideoTracks.onaddtrack=null,this._nativeVideoTracks.onremovetrack=null),void 0!==this._nativeAudioTracks&&(this._nativeAudioTracks.onchange=null,this._nativeAudioTracks.onaddtrack=null,this._nativeAudioTracks.onremovetrack=null),void 0!==this._nativeTextTracks&&(this._nativeTextTracks.onchange=null,this._nativeTextTracks.onaddtrack=null,this._nativeTextTracks.onremovetrack=null),this.removeEventListener()}_getCurrentAudioTrack(){if(void 0!==this._nativeAudioTracks){for(let e=0;e<this._audioTracks.length;e++){const t=this._audioTracks[e];if(t.nativeTrack.enabled)return t}return null}}_getCurrentVideoTrack(){if(void 0!==this._nativeVideoTracks){for(let e=0;e<this._videoTracks.length;e++){const t=this._videoTracks[e];if(t.nativeTrack.selected)return t}return null}}_getCurrentTextTrack(){if(void 0!==this._nativeTextTracks){for(let e=0;e<this._textTracks.length;e++){const t=this._textTracks[e];if("showing"===t.nativeTrack.mode)return t}return null}}_setPreviouslyLockedAudioTrack(){if(void 0!==this._audioTrackLockedOn)if(null===this._audioTrackLockedOn)for(let e=0;e<this._audioTracks.length;e++){const{nativeTrack:t}=this._audioTracks[e];t.enabled=!1}else for(let e=0;e<this._audioTracks.length;e++){const{nativeTrack:t}=this._audioTracks[e];if(t===this._audioTrackLockedOn)return void this._enableAudioTrackFromIndex(e)}}_setPreviouslyLockedTextTrack(){if(void 0!==this._textTrackLockedOn)if(null!==this._textTrackLockedOn)for(let e=0;e<this._textTracks.length;e++){const{nativeTrack:t}=this._textTracks[e];if(t===this._textTrackLockedOn)return zd(this._textTracks,t),void("showing"!==t.mode&&(t.mode="showing"))}else Gd(this._textTracks)}_setPreviouslyLockedVideoTrack(){if(void 0!==this._videoTrackLockedOn)if(null!==this._videoTrackLockedOn)for(let e=0;e<this._videoTracks.length;e++){const{nativeTrack:t}=this._videoTracks[e];if(t===this._videoTrackLockedOn)return void(t.selected=!0)}else qd(this._videoTracks)}_handleNativeTracksCallbacks(){void 0!==this._nativeAudioTracks&&(this._nativeAudioTracks.onaddtrack=(()=>{var e,t;if(void 0!==this._nativeAudioTracks){const n=jd(this._nativeAudioTracks);if(Bd(this._audioTracks,n)){this._audioTracks=n,this._setPreviouslyLockedAudioTrack(),this.trigger("availableAudioTracksChange",this.getAvailableAudioTracks());const i=this._getCurrentAudioTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeAudioTrack&&(this.trigger("audioTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeAudioTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeAudioTracks.onremovetrack=(()=>{var e,t;if(void 0!==this._nativeAudioTracks){const n=jd(this._nativeAudioTracks);if(Bd(this._audioTracks,n)){this._audioTracks=n,this.trigger("availableAudioTracksChange",this.getAvailableAudioTracks());const i=this._getCurrentAudioTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeAudioTrack&&(this.trigger("audioTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeAudioTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeAudioTracks.onchange=(()=>{if(void 0!==this._audioTracks)for(let e=0;e<this._audioTracks.length;e++){const{track:t,nativeTrack:n}=this._audioTracks[e];if(n.enabled)return void(n!==this._lastEmittedNativeAudioTrack&&(this.trigger("audioTrackChange",t),this._lastEmittedNativeAudioTrack=n))}null!==this._lastEmittedNativeAudioTrack&&(this.trigger("audioTrackChange",null),this._lastEmittedNativeAudioTrack=null)})),void 0!==this._nativeTextTracks&&(this._nativeTextTracks.onaddtrack=(()=>{var e,t;if(void 0!==this._nativeTextTracks){const n=Vd(this._nativeTextTracks);if(Bd(this._textTracks,n)){this._textTracks=n,this._setPreviouslyLockedTextTrack(),this.trigger("availableTextTracksChange",this.getAvailableTextTracks());const i=this._getCurrentTextTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeTextTrack&&(this.trigger("textTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeTextTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeTextTracks.onremovetrack=(()=>{var e,t;if(void 0!==this._nativeTextTracks){const n=Vd(this._nativeTextTracks);if(Bd(this._textTracks,n)){this._textTracks=n,this._setPreviouslyLockedTextTrack(),this.trigger("availableTextTracksChange",this.getAvailableTextTracks());const i=this._getCurrentTextTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeTextTrack&&(this.trigger("textTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeTextTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeTextTracks.onchange=(()=>{if(void 0!==this._textTracks)for(let e=0;e<this._textTracks.length;e++){const{track:t,nativeTrack:n}=this._textTracks[e];if("showing"===n.mode)return void(n!==this._lastEmittedNativeTextTrack&&(this.trigger("textTrackChange",t),this._lastEmittedNativeTextTrack=n))}null!==this._lastEmittedNativeTextTrack&&(this.trigger("textTrackChange",null),this._lastEmittedNativeTextTrack=null)})),void 0!==this._nativeVideoTracks&&(this._nativeVideoTracks.onaddtrack=(()=>{var e,t;if(void 0!==this._nativeVideoTracks){const n=Hd(this._nativeVideoTracks);if(Bd(this._videoTracks,n)){this._videoTracks=n,this._setPreviouslyLockedVideoTrack(),this.trigger("availableVideoTracksChange",this.getAvailableVideoTracks());const i=this._getCurrentVideoTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeVideoTrack&&(this.trigger("videoTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeVideoTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeVideoTracks.onremovetrack=(()=>{var e,t;if(void 0!==this._nativeVideoTracks){const n=Hd(this._nativeVideoTracks);if(Bd(this._videoTracks,n)){this._videoTracks=n,this._setPreviouslyLockedVideoTrack(),this.trigger("availableVideoTracksChange",this.getAvailableVideoTracks());const i=this._getCurrentVideoTrack();(null===i||void 0===i?void 0:i.nativeTrack)!==this._lastEmittedNativeVideoTrack&&(this.trigger("videoTrackChange",null!==(e=null===i||void 0===i?void 0:i.track)&&void 0!==e?e:null),this._lastEmittedNativeVideoTrack=null!==(t=null===i||void 0===i?void 0:i.nativeTrack)&&void 0!==t?t:null)}}}),this._nativeVideoTracks.onchange=(()=>{if(void 0!==this._videoTracks)for(let e=0;e<this._videoTracks.length;e++){const{track:t,nativeTrack:n}=this._videoTracks[e];if(n.selected)return void(n!==this._lastEmittedNativeVideoTrack&&(this.trigger("videoTrackChange",t),this._lastEmittedNativeVideoTrack=n))}null!==this._lastEmittedNativeVideoTrack&&(this.trigger("videoTrackChange",null),this._lastEmittedNativeVideoTrack=null)}))}_enableAudioTrackFromIndex(e){Fd(this._audioTracks.map(({nativeTrack:e})=>e),e)}}function Gd(e){for(let t=0;t<e.length;t++){const{nativeTrack:n}=e[t];n.mode="disabled"}}function zd(e,t){for(let n=0;n<e.length;n++){const{nativeTrack:i}=e[n];i===t||"showing"!==i.mode&&"hidden"!==i.mode||(i.mode="disabled")}}function qd(e){for(let t=0;t<e.length;t++){const{nativeTrack:n}=e[t];n.selected=!1}}function Wd(e){e.directfile={initDirectFile:Nd,mediaElementTracksStore:$d}}let Kd;const{WebKitMediaKeys:Yd}=a["a"];function Xd(){return(p||g)&&void 0!==Kd}void 0!==Yd&&"function"===typeof Yd.isTypeSupported&&"function"===typeof Yd.prototype.createSession&&"function"===typeof HTMLMediaElement.prototype.webkitSetMediaKeys&&(Kd=Yd);class Qd{constructor(e,t,n){this._keyType=e,this._mediaKeys=t,this._configuration=n}get keySystem(){return this._keyType}createMediaKeys(){return new Promise(e=>e(this._mediaKeys))}getConfiguration(){return this._configuration}}let Zd;const{MSMediaKeys:Jd}=a["a"];function eh(e){try{const t=e();return"object"===typeof t&&null!==t&&"function"===typeof t.then?t:Promise.resolve(t)}catch(e){return Promise.reject(e)}}void 0!==Jd&&void 0!==Jd.prototype&&"function"===typeof Jd.isTypeSupported&&"function"===typeof Jd.prototype.createSession&&(Zd=Jd);class th extends s{constructor(e){super(),this.expiration=NaN,this.keyStatuses=new Map,this._mk=e,this._sessionClosingCanceller=new me,this.closed=new Promise(e=>{this._sessionClosingCanceller.signal.register(()=>e())}),this.update=(e=>{return new Promise((t,n)=>{if(void 0===this._ss)return n("MediaKeySession not set.");try{t(this._ss.update(e,""))}catch(e){n(e)}})})}generateRequest(e,t){return new Promise(e=>{let n;n=t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer),this._ss=this._mk.createSession("video/mp4",n),Mr(this._ss,e=>{var t;this.trigger(null!==(t=e.type)&&void 0!==t?t:"message",e)},this._sessionClosingCanceller.signal),Lr(this._ss,e=>{var t;this.trigger(null!==(t=e.type)&&void 0!==t?t:"keyadded",e)},this._sessionClosingCanceller.signal),Pr(this._ss,e=>{var t;this.trigger(null!==(t=e.type)&&void 0!==t?t:"keyerror",e)},this._sessionClosingCanceller.signal),e()})}close(){return new Promise(e=>{r(this._ss)||(this._ss.close(),this._ss=void 0),this._sessionClosingCanceller.cancel(),e()})}load(){return Promise.resolve(!1)}remove(){return Promise.resolve()}get sessionId(){var e,t;return null!==(t=null===(e=this._ss)||void 0===e?void 0:e.sessionId)&&void 0!==t?t:""}}class nh{constructor(e){if(void 0===Zd)throw new Error("No MSMediaKeys API.");this._mediaKeys=new Zd(e)}_setVideo(e){return eh(()=>{this._videoElement=e,void 0!==this._videoElement.msSetMediaKeys&&this._videoElement.msSetMediaKeys(this._mediaKeys)})}createSession(){if(void 0===this._videoElement||void 0===this._mediaKeys)throw new Error("Video not attached to the MediaKeys");return new th(this._mediaKeys)}setServerCertificate(){throw new Error("Server certificate is not implemented in your browser")}}function ih(){const e=(e,t)=>{if(void 0===Zd)throw new Error("No MSMediaKeys API.");return void 0!==t?Zd.isTypeSupported(e,t):Zd.isTypeSupported(e)},t=e=>new nh(e),n=(e,t)=>{if(null===t)return Promise.resolve(void 0);if(!(t instanceof nh))throw new Error("Custom setMediaKeys is supposed to be called with IE11 custom MediaKeys.");return t._setVideo(e)};return{isTypeSupported:e,createCustomMediaKeys:t,setMediaKeys:n}}let rh;const{MozMediaKeys:sh}=a["a"];function ah(){const e=(e,t)=>{if(void 0===rh)throw new Error("No MozMediaKeys API.");return void 0!==t?rh.isTypeSupported(e,t):rh.isTypeSupported(e)},t=e=>{if(void 0===rh)throw new Error("No MozMediaKeys API.");return new rh(e)},n=(e,t)=>{return eh(()=>{const n=e;if(void 0===n.mozSetMediaKeys||"function"!==typeof n.mozSetMediaKeys)throw new Error("Can't set video on MozMediaKeys.");return n.mozSetMediaKeys(t)})};return{isTypeSupported:e,createCustomMediaKeys:t,setMediaKeys:n}}function oh(e){return"function"===typeof(null===e||void 0===e?void 0:e.webkitGenerateKeyRequest)}void 0!==sh&&void 0!==sh.prototype&&"function"===typeof sh.isTypeSupported&&"function"===typeof sh.prototype.createSession&&(rh=sh);class lh extends s{constructor(e,t){super(),this._vid=e,this._key=t,this.sessionId="",this._closeSession=U,this.keyStatuses=new Map,this.expiration=NaN;const n=e=>{this.trigger(e.type,e)};this.closed=new Promise(t=>{this._closeSession=(()=>{["keymessage","message","keyadded","ready","keyerror","error"].forEach(t=>{e.removeEventListener(t,n),e.removeEventListener(`webkit${t}`,n)}),t()})}),["keymessage","message","keyadded","ready","keyerror","error"].forEach(t=>{e.addEventListener(t,n),e.addEventListener(`webkit${t}`,n)})}update(e){return new Promise((t,n)=>{try{if(this._key.indexOf("clearkey")>=0){const n=e instanceof ArrayBuffer?new Uint8Array(e):e,i=JSON.parse(Da(n)),r=Ka(i.keys[0].k),s=Ka(i.keys[0].kid);t(this._vid.webkitAddKey(this._key,r,s,""))}else t(this._vid.webkitAddKey(this._key,e,null,""))}catch(e){n(e)}})}generateRequest(e,t){return new Promise(e=>{this._vid.webkitGenerateKeyRequest(this._key,t),e()})}close(){return new Promise(e=>{this._closeSession(),e()})}load(){return Promise.resolve(!1)}remove(){return Promise.resolve()}}class uh{constructor(e){this._keySystem=e}_setVideo(e){return eh(()=>{if(!oh(e))throw new Error("Video not attached to the MediaKeys");this._videoElement=e})}createSession(){if(r(this._videoElement))throw new Error("Video not attached to the MediaKeys");return new lh(this._videoElement,this._keySystem)}setServerCertificate(){throw new Error("Server certificate is not implemented in your browser")}}function ch(){const e=function(e){let t=document.querySelector("video");return r(t)&&(t=document.createElement("video")),!r(t)&&"function"===typeof t.canPlayType&&!!t.canPlayType("video/mp4",e)},t=e=>new uh(e),n=(e,t)=>{if(null===t)return Promise.resolve(void 0);if(!(t instanceof uh))throw new Error("Custom setMediaKeys is supposed to be called with old webkit custom MediaKeys.");return t._setVideo(e)};return{isTypeSupported:e,createCustomMediaKeys:t,setMediaKeys:n}}function dh(e,t){const n=e instanceof Uint8Array?e:new Uint8Array(e),i=t instanceof Uint8Array?t:new Uint8Array(t),r=Yr(n,0);if(r+4!==n.length)throw new Error("Unsupported WebKit initData.");const s=ka(n),a=s.indexOf("skd://"),o=a>-1?s.substring(a+6):s,l=xa(o);let u=0;const c=new Uint8Array(n.byteLength+4+l.byteLength+4+i.byteLength);return c.set(n),u+=n.length,c.set(Qr(l.byteLength),u),u+=4,c.set(l,u),u+=l.byteLength,c.set(Qr(i.byteLength),u),u+=4,c.set(i,u),c}function hh(e){return Vi(e,"com.apple.fps")}function fh(e,t){const n=e;return eh(()=>{if(void 0===n.webkitSetMediaKeys)throw new Error("No webKitMediaKeys API.");n.webkitSetMediaKeys(t)})}class ph extends s{constructor(e,t,n){super(),this._serverCertificate=n,this._videoElement=e,this._keyType=t,this._unbindSession=U,this._closeSession=U,this.closed=new Promise(e=>{this._closeSession=e}),this.keyStatuses=new Map,this.expiration=NaN}update(e){return new Promise((t,n)=>{if(void 0===this._nativeSession||void 0===this._nativeSession.update||"function"!==typeof this._nativeSession.update)return n("Unavailable WebKit key session.");try{let i;i=e instanceof ArrayBuffer?new Uint8Array(e):e instanceof Uint8Array?e:new Uint8Array(e.buffer),t(this._nativeSession.update(i))}catch(e){n(e)}})}generateRequest(e,t){return new Promise(e=>{var n;const i=this._videoElement;if(void 0===(null===(n=i.webkitKeys)||void 0===n?void 0:n.createSession))throw new Error("No WebKitMediaKeys API.");let r;if(hh(this._keyType)){if(void 0===this._serverCertificate)throw new Error("A server certificate is needed for creating fairplay session.");r=dh(t,this._serverCertificate)}else r=t;const s=i.webkitKeys.createSession("video/mp4",r);if(void 0===s||null===s)throw new Error("Impossible to get the key sessions");this._listenEvent(s),this._nativeSession=s,e()})}close(){return new Promise((e,t)=>{this._unbindSession(),this._closeSession(),void 0!==this._nativeSession?(this._nativeSession.close(),e()):t("No session to close.")})}load(){return Promise.resolve(!1)}remove(){return Promise.resolve()}get sessionId(){var e,t;return null!==(t=null===(e=this._nativeSession)||void 0===e?void 0:e.sessionId)&&void 0!==t?t:""}_listenEvent(e){this._unbindSession();const t=e=>{this.trigger(e.type,e)};["keymessage","message","keyadded","ready","keyerror","error"].forEach(n=>{e.addEventListener(n,t),e.addEventListener(`webkit${n}`,t)}),this._unbindSession=(()=>{["keymessage","message","keyadded","ready","keyerror","error"].forEach(n=>{e.removeEventListener(n,t),e.removeEventListener(`webkit${n}`,t)})})}}class gh{constructor(e){if(void 0===Kd)throw new Error("No WebKitMediaKeys API.");this._keyType=e,this._mediaKeys=new Kd(e)}_setVideo(e){if(this._videoElement=e,void 0===this._videoElement)throw new Error("Video not attached to the MediaKeys");return fh(this._videoElement,this._mediaKeys)}createSession(){if(void 0===this._videoElement||void 0===this._mediaKeys)throw new Error("Video not attached to the MediaKeys");return new ph(this._videoElement,this._keyType,this._serverCertificate)}setServerCertificate(e){return this._serverCertificate=e,Promise.resolve()}}function mh(){if(void 0===Kd)throw new Error("No WebKitMediaKeys API.");const e=Kd.isTypeSupported,t=e=>new gh(e),n=(e,t)=>{if(null===t)return fh(e,t);if(!(t instanceof gh))throw new Error("Custom setMediaKeys is supposed to be called with webkit custom MediaKeys.");return t._setVideo(e)};return{isTypeSupported:e,createCustomMediaKeys:t,setMediaKeys:n}}const vh=bh("auto");var yh=vh;function bh(e){var t;let n,i,s,l=_h;if("standard"!==e&&("auto"!==e||Xd())||!o["a"]&&r(navigator.requestMediaKeySystemAccess)){let o,u;if("webkit"===e&&void 0!==Kd){i=Tr(["needkey"]);const e=mh();o=e.isTypeSupported,u=e.createCustomMediaKeys,l=e.setMediaKeys,s="webkit"}else if(oh(null===(t=a["a"].HTMLVideoElement)||void 0===t?void 0:t.prototype)){i=Tr(["needkey"]);const e=ch();o=e.isTypeSupported,u=e.createCustomMediaKeys,l=e.setMediaKeys,s="older-webkit"}else if(void 0!==Kd){i=Tr(["needkey"]);const e=mh();o=e.isTypeSupported,u=e.createCustomMediaKeys,l=e.setMediaKeys,s="webkit"}else if(d&&void 0!==Zd){i=Tr(["encrypted","needkey"]);const e=ih();o=e.isTypeSupported,u=e.createCustomMediaKeys,l=e.setMediaKeys,s="ms"}else if(void 0!==rh){i=Tr(["encrypted","needkey"]);const e=ah();o=e.isTypeSupported,u=e.createCustomMediaKeys,l=e.setMediaKeys,s="moz"}else{i=Tr(["encrypted","needkey"]);const e=a["a"].MediaKeys,t=()=>{if(void 0===e)throw new ut("MEDIA_KEYS_NOT_SUPPORTED","No `MediaKeys` implementation found in the current browser.");if("undefined"===typeof e.isTypeSupported){const e="This browser seems to be unable to play encrypted contents currently.Note: Some browsers do not allow decryption in some situations, like when not using HTTPS.";throw new Error(e)}};o=(n=>{return t(),fe("function"===typeof e.isTypeSupported),e.isTypeSupported(n)}),u=(n=>{return t(),new e(n)}),s="unknown"}n=function(e,t){if(!o(e))return Promise.reject(new Error("Unsupported key type"));for(let n=0;n<t.length;n++){const i=t[n],{videoCapabilities:s,audioCapabilities:a,initDataTypes:o,distinctiveIdentifier:l}=i;let c=!0;if(c=c&&(r(o)||o.some(e=>"cenc"===e)),c=c&&"required"!==l,c){const t={initDataTypes:["cenc"],distinctiveIdentifier:"not-allowed",persistentState:"required",sessionTypes:["temporary","persistent-license"]};void 0!==s&&(t.videoCapabilities=s),void 0!==a&&(t.audioCapabilities=a);const n=u(e);return Promise.resolve(new Qd(e,n,t))}}return Promise.reject(new Error("Unsupported configuration"))}}else n=((...e)=>navigator.requestMediaKeySystemAccess(...e)),i=Tr(["encrypted"]),s="standard";return{requestMediaKeySystemAccess:n,onEncrypted:i,setMediaKeys:l,implementation:s}}function _h(e,t){try{let n;const i=e;return"function"===typeof i.setMediaKeys?n=i.setMediaKeys(t):"function"===typeof i.webkitSetMediaKeys?n=i.webkitSetMediaKeys(t):"function"===typeof i.mozSetMediaKeys?n=i.mozSetMediaKeys(t):"function"===typeof i.msSetMediaKeys&&null!==t&&(n=i.msSetMediaKeys(t)),"object"===typeof n&&null!==n&&"function"===typeof n.then?n:Promise.resolve(n)}catch(e){return Promise.reject(e)}}var Th=yh;const Sh=$r(Aa("pssh"),0);function wh(e){const t=[];let n=0;while(n<e.length){if(e.length<n+8||$r(e,n+4)!==Sh)return V.warn("Compat: Unrecognized initialization data. Use as is."),[{systemId:void 0,data:e}];const i=$r(new Uint8Array(e),n);if(n+i>e.length)return V.warn("Compat: Unrecognized initialization data. Use as is."),[{systemId:void 0,data:e}];const r=e.subarray(n,n+i),s=Jc(r,8),a={systemId:s,data:r};Eh(t,a)?V.warn("Compat: Duplicated PSSH found in initialization data, removing it."):t.push(a),n+=i}return n!==e.length?(V.warn("Compat: Unrecognized initialization data. Use as is."),[{systemId:void 0,data:e}]):t}function Eh(e,t){for(let n=0;n<e.length;n++){const i=e[n];if((void 0===t.systemId||void 0===i.systemId||t.systemId===i.systemId)&&yt(t.data,i.data))return!0}return!1}function xh(e){const{initData:t,initDataType:n}=e;if(r(t))return V.warn("Compat: No init data found on media encrypted event."),null;const i=new Uint8Array(t),s=wh(i);return{type:n,values:s}}function kh(){return y}function Ah(e,t,n){const i=e.setMediaKeys(t,n).then(()=>{V.info("Compat: MediaKeys updated with success")}).catch(e=>{if(null!==n)throw V.error("Compat: Could not update MediaKeys",e instanceof Error?e:"Unknown Error"),e;V.error("Compat: Could not reset MediaKeys",e instanceof Error?e:"Unknown Error")});return kh()?i:Promise.race([i,Di(1e3)])}function Ih(e){var t;const n=ar.getState(e);return ar.setState(e,null),Ah(null!==(t=null===n||void 0===n?void 0:n.emeImplementation)&&void 0!==t?t:Th,e,null)}async function Ch(e,{emeImplementation:t,keySystemOptions:n,loadedSessionsStore:i,mediaKeySystemAccess:r,mediaKeys:s},a){const o=ar.getState(e),l=null!==o&&o.loadedSessionsStore!==i?o.loadedSessionsStore.closeAllSessions():Promise.resolve();if(await l,a.isCancelled())throw a.cancellationError;if(ar.setState(e,{emeImplementation:t,keySystemOptions:n,mediaKeySystemAccess:r,mediaKeys:s,loadedSessionsStore:i}),e.mediaKeys!==s)return V.info("DRM: Attaching MediaKeys to the media element"),Ah(t,e,s).then(()=>{V.info("DRM: MediaKeys attached with success")}).catch(e=>{const t=e instanceof Error?e.toString():"Unknown Error";throw new lt("MEDIA_KEYS_ATTACHMENT_ERROR","Could not attach the MediaKeys to the media element: "+t)})}function Dh(e){if(""===e.sessionId)return!1;const t=e.keyStatuses,n=[];return t.forEach(e=>{n.push(e)}),n.length<=0?(V.debug("DRM: isSessionUsable: MediaKeySession given has an empty keyStatuses",e.sessionId),!1):gt(n,"expired")?(V.debug("DRM: isSessionUsable: MediaKeySession given has an expired key",e.sessionId),!1):gt(n,"internal-error")?(V.debug("DRM: isSessionUsable: MediaKeySession given has a key with an internal-error",e.sessionId),!1):(V.debug("DRM: isSessionUsable: MediaKeySession is usable",e.sessionId),!0)}function Rh(e,t,n,i){const{loadedSessionsStore:r,persistentSessionsStore:s}=e;return"temporary"===n?Mh(r,t):null===s?(V.warn("DRM: Cannot create persistent MediaKeySession, PersistentSessionsStore not created."),Mh(r,t)):Lh(r,s,t,i)}function Mh(e,t){V.info("DRM: Creating a new temporary session");const n=e.createSession(t,"temporary");return Promise.resolve({type:"created-session",value:n})}async function Lh(e,t,n,i){if(null!==i.cancellationError)throw i.cancellationError;V.info("DRM: Creating persistent MediaKeySession");const r=e.createSession(n,"persistent-license"),s=t.getAndReuse(n);if(null===s)return{type:"created-session",value:r};try{const i=await e.loadPersistentSession(r.mediaKeySession,s.sessionId);if(!i){V.warn("DRM: No data stored for the loaded session"),t.delete(s.sessionId),e.removeSessionWithoutClosingIt(r.mediaKeySession);const i=e.createSession(n,"persistent-license");return{type:"created-session",value:i}}return i&&Dh(r.mediaKeySession)?(t.add(n,n.keyIds,r.mediaKeySession),V.info("DRM: Succeeded to load persistent session."),{type:"loaded-persistent-session",value:r}):(V.warn("DRM: Previous persistent session not usable anymore."),a())}catch(e){return V.warn("DRM: Unable to load persistent session: "+(e instanceof Error?e.toString():"Unknown Error")),a()}async function a(){if(null!==i.cancellationError)throw i.cancellationError;V.info("DRM: Removing previous persistent session.");const s=t.get(n);null!==s&&t.delete(s.sessionId);try{await e.closeSession(r.mediaKeySession)}catch(t){if(""!==r.mediaKeySession.sessionId)throw t;e.removeSessionWithoutClosingIt(r.mediaKeySession)}if(null!==i.cancellationError)throw i.cancellationError;const a=e.createSession(n,"persistent-license");return{type:"created-session",value:a}}}async function Ph(e,t){if(t<0||t>=e.getLength())return;V.info("DRM: LSS cache limit exceeded",t,e.getLength());const n=[],i=e.getAll().slice(),r=i.length-t;for(let s=0;s<r;s++){const t=i[s];n.push(e.closeSession(t.mediaKeySession))}await Promise.all(n)}async function Oh(e,t,n,i,r){let s=null;const{loadedSessionsStore:a,persistentSessionsStore:o}=t,l=a.reuse(e);if(null!==l){if(s=l.mediaKeySession,Dh(s))return V.info("DRM: Reuse loaded session",s.sessionId),{type:"loaded-open-session",value:{mediaKeySession:s,sessionType:l.sessionType,keySessionRecord:l.keySessionRecord}};null!==o&&""!==l.mediaKeySession.sessionId&&o.delete(l.mediaKeySession.sessionId)}if(null!==s&&(await a.closeSession(s),null!==r.cancellationError))throw r.cancellationError;if(await Ph(a,i),null!==r.cancellationError)throw r.cancellationError;const u=await Rh(t,e,n,r);return{type:u.type,value:{mediaKeySession:u.value.mediaKeySession,sessionType:u.value.sessionType,keySessionRecord:u.value.keySessionRecord}}}function Nh(){return!y&&!T}function Uh(e){return!c||-1===e.indexOf("playready")}const Fh='<WRMHEADER xmlns="http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader" version="4.0.0.0"><DATA><PROTECTINFO><KEYLEN>16</KEYLEN><ALGID>AESCTR</ALGID></PROTECTINFO><KID>ckB07BNLskeUq0qd83fTbA==</KID><DS_ID>yYIPDBca1kmMfL60IsfgAQ==</DS_ID><CUSTOMATTRIBUTES xmlns=""><encryptionref>312_4024_2018127108</encryptionref></CUSTOMATTRIBUTES><CHECKSUM>U/tsUYRgMzw=</CHECKSUM></DATA></WRMHEADER>';function Bh(e){const t=xa(e),n=Xr(t.length),i=new Uint8Array([1,0]),r=new Uint8Array([1,0]),s=Qr(t.length+6),a=jr(s,r,i,n,t),o=Ra("9a04f07998404286ab92e65be0885f95");return jh(a,o)}function jh(e,t){const n=Aa("pssh"),i=new Uint8Array([0,0,0,0]),r=qr(e.length),s=qr(32+e.length);return jr(s,n,i,t,r,e)}function Vh(){return d}function Hh(e,t,n){const i=t.getConfiguration();if(Vh()||r(i))return null;const s=e.filter(e=>{return e.type===n.type&&(!!(r(e.persistentLicenseConfig)&&"required"!==e.persistentState||"required"===i.persistentState)&&("required"!==e.distinctiveIdentifier||"required"===i.distinctiveIdentifier))})[0];return void 0!==s?{keySystemOptions:s,keySystemAccess:t}:null}function $h(e){const{EME_KEY_SYSTEMS:t}=N.getCurrent();for(const n of Object.keys(t))if(gt(t[n],e))return n}function Gh(e){const{keyName:t,keyType:n,keySystemOptions:i}=e,s=["temporary"];let a="optional",o="optional";r(i.persistentLicenseConfig)||(a="required",s.push("persistent-license")),r(i.persistentState)||(a=i.persistentState),r(i.distinctiveIdentifier)||(o=i.distinctiveIdentifier);const{EME_DEFAULT_AUDIO_CODECS:l,EME_DEFAULT_VIDEO_CODECS:u,EME_DEFAULT_WIDEVINE_ROBUSTNESSES:c,EME_DEFAULT_PLAYREADY_RECOMMENDATION_ROBUSTNESSES:d}=N.getCurrent();let h,f;const{audioCapabilitiesConfig:p,videoCapabilitiesConfig:g}=i;if("full"===(null===p||void 0===p?void 0:p.type))h=p.value;else{let e;e="robustness"===(null===p||void 0===p?void 0:p.type)?p.value:"widevine"===t?c:"com.microsoft.playready.recommendation"===n?d:[],0===e.length&&e.push(void 0);const i="contentType"===(null===p||void 0===p?void 0:p.type)?p.value:l;h=$l(e,e=>i.map(t=>{return void 0!==e?{contentType:t,robustness:e}:{contentType:t}}))}if("full"===(null===g||void 0===g?void 0:g.type))f=g.value;else{let e;e="robustness"===(null===g||void 0===g?void 0:g.type)?g.value:"widevine"===t?c:"com.microsoft.playready.recommendation"===n?d:[],0===e.length&&e.push(void 0);const i="contentType"===(null===g||void 0===g?void 0:g.type)?g.value:u;f=$l(e,e=>i.map(t=>{return void 0!==e?{contentType:t,robustness:e}:{contentType:t}}))}const m={initDataTypes:["cenc"],videoCapabilities:f,audioCapabilities:h,distinctiveIdentifier:o,persistentState:a,sessionTypes:s};return[m,Object.assign(Object.assign({},m),{audioCapabilities:void 0,videoCapabilities:void 0})]}function zh(e,t,n){V.info("DRM: Searching for compatible MediaKeySystemAccess");const i=ar.getState(e);if(null!==i&&Th.implementation===i.emeImplementation.implementation){const e=Hh(t,i.mediaKeySystemAccess,i.keySystemOptions);if(null!==e)return V.info("DRM: Found cached compatible keySystem"),Promise.resolve({type:"reuse-media-key-system-access",value:{mediaKeySystemAccess:e.keySystemAccess,options:e.keySystemOptions}})}const s=t.reduce((e,t)=>{const{EME_KEY_SYSTEMS:n}=N.getCurrent(),i=n[t.type];let s;if(r(i)){const e=$h(t.type),n=t.type;s=[{keyName:e,keyType:n,keySystemOptions:t}]}else s=i.map(e=>{const n=t.type;return{keyName:n,keyType:e,keySystemOptions:t}});return e.concat(s)},[]);return a(0);async function a(e){if(e>=s.length)throw new lt("INCOMPATIBLE_KEYSYSTEMS","No key system compatible with your wanted configuration has been found in the current browser.");if(r(Th.requestMediaKeySystemAccess))throw new Error("requestMediaKeySystemAccess is not implemented in your browser.");const t=s[e],{keyType:i,keySystemOptions:o}=t,l=Gh(t);V.debug(`DRM: Request keysystem access ${i},`+`${e+1} of ${s.length}`);try{const t=await qh(i,l);return V.info("DRM: Found compatible keysystem",i,e+1),{type:"create-media-key-system-access",value:{options:o,mediaKeySystemAccess:t}}}catch(t){if(V.debug("DRM: Rejected access to keysystem",i,e+1),null!==n.cancellationError)throw n.cancellationError;return a(e+1)}}}async function qh(e,t){const n=await Th.requestMediaKeySystemAccess(e,t);if(!Uh(e))try{const e=await n.createMediaKeys(),t=e.createSession(),i=Bh(Fh);await t.generateRequest("cenc",i)}catch(e){throw V.debug("DRM: KeySystemAccess was granted but it is not usable"),e}return n}function Wh(e){V.info("Compat: Trying to move CENC PSSH from init data at the end of it.");let t=!1,n=new Uint8Array,i=new Uint8Array,r=0;while(r<e.length){if(e.length<r+8||$r(e,r+4)!==Sh)throw V.warn("Compat: unrecognized initialization data. Cannot patch it."),new Error("Compat: unrecognized initialization data. Cannot patch it.");const s=$r(new Uint8Array(e),r);if(r+s>e.length)throw V.warn("Compat: unrecognized initialization data. Cannot patch it."),new Error("Compat: unrecognized initialization data. Cannot patch it.");const a=e.subarray(r,r+s);if(16===e[r+12]&&119===e[r+13]&&239===e[r+14]&&236===e[r+15]&&192===e[r+16]&&178===e[r+17]&&77===e[r+18]&&2===e[r+19]&&172===e[r+20]&&227===e[r+21]&&60===e[r+22]&&30===e[r+23]&&82===e[r+24]&&226===e[r+25]&&251===e[r+26]&&75===e[r+27]){const e=sa(a),i=null===e?void 0:a[e[1]];V.info("Compat: CENC PSSH found with version",i),void 0===i?V.warn("Compat: could not read version of CENC PSSH"):t===(1===i)?n=jr(n,a):1===i?(V.warn("Compat: cenc version 1 encountered, removing every other cenc pssh box."),n=a,t=!0):V.warn("Compat: filtering out cenc pssh box with wrong version",i)}else i=jr(i,a);r+=s}if(r!==e.length)throw V.warn("Compat: unrecognized initialization data. Cannot patch it."),new Error("Compat: unrecognized initialization data. Cannot patch it.");return jr(i,n)}function Kh(e,t,n){let i;V.debug("Compat: Calling generateRequest on the MediaKeySession");try{i=Wh(n)}catch(e){i=n}const r=null!==t&&void 0!==t?t:"";return e.generateRequest(r,i).catch(t=>{if(""!==r||!(t instanceof TypeError))throw t;return V.warn('Compat: error while calling `generateRequest` with an empty initialization data type. Retrying with a default "cenc" value.',t),e.generateRequest("cenc",i)})}const Yh=100;async function Xh(e,t){V.info("DRM: Load persisted session",t);const n=await e.load(t);return!n||e.keyStatuses.size>0?n:new Promise(t=>{e.addEventListener("keystatuseschange",r);const i=setTimeout(r,Yh);function r(){s(),t(n)}function s(){clearTimeout(i),e.removeEventListener("keystatuseschange",r)}})}function Qh(e){const t=new me;return Promise.race([e.close().then(()=>{t.cancel()}),e.closed.then(()=>{t.cancel()}),n()]);async function n(){try{await cn(1e3,t.signal),await i()}catch(e){if(e instanceof ye)return;const t=e instanceof Error?e.message:"Unknown error made it impossible to close the session";V.error(`DRM: ${t}`)}}async function i(){try{await e.update(new Uint8Array(1))}catch(e){if(t.isUsed())return;if(e instanceof Error&&"The session is already closed."===e.message)return;await cn(1e3,t.signal)}if(!t.isUsed())throw new Error("Compat: Couldn't know if session is closed")}}function Zh(e,t){for(const n of e){const e=t.some(e=>yt(e,n));if(!e)return!1}return!0}function Jh(e,t){for(const n of e){const e=t.some(e=>yt(e,n));if(e)return!0}return!1}class ef{constructor(e){this._initializationData=e,this._keyIds=null}associateKeyIds(e){null===this._keyIds&&(this._keyIds=[]);const t=Array.from(e);for(const n of t)this.isAssociatedWithKeyId(n)||this._keyIds.push(n)}isAssociatedWithKeyId(e){if(null===this._keyIds)return!1;for(const t of this._keyIds)if(yt(t,e))return!0;return!1}getAssociatedKeyIds(){return null===this._keyIds?[]:this._keyIds}isCompatibleWith(e){const{keyIds:t}=e;if(void 0!==t&&t.length>0){if(null!==this._keyIds&&Zh(t,this._keyIds))return!0;if(void 0!==this._initializationData.keyIds)return Zh(t,this._initializationData.keyIds)}return this._checkInitializationDataCompatibility(e)}_checkInitializationDataCompatibility(e){return void 0!==e.keyIds&&e.keyIds.length>0&&void 0!==this._initializationData.keyIds?Zh(e.keyIds,this._initializationData.keyIds):this._initializationData.type===e.type&&this._initializationData.values.isCompatibleWith(e.values)}}class tf{constructor(e){this._mediaKeys=e,this._storage=[]}createSession(e,t){const n=new ef(e);V.debug("DRM-LSS: calling `createSession`",t);const i=this._mediaKeys.createSession(t),s={mediaKeySession:i,sessionType:t,keySessionRecord:n,isGeneratingRequest:!1,isLoadingPersistentSession:!1,closingStatus:{type:"none"}};return r(i.closed)||i.closed.then(()=>{V.info("DRM-LSS: session was closed, removing it.",i.sessionId);const e=this.getIndex(n);e>=0&&this._storage[e].mediaKeySession===i&&this._storage.splice(e,1)}).catch(e=>{V.warn(`DRM-LSS: MediaKeySession.closed rejected: ${e}`)}),this._storage.push(Object.assign({},s)),V.debug("DRM-LSS: MediaKeySession added",s.sessionType,this._storage.length),s}reuse(e){for(let t=this._storage.length-1;t>=0;t--){const n=this._storage[t];if(n.keySessionRecord.isCompatibleWith(e))return this._storage.splice(t,1),this._storage.push(n),V.debug("DRM-LSS: Reusing session:",n.mediaKeySession.sessionId,n.sessionType),Object.assign({},n)}return null}getEntryForSession(e){for(let t=this._storage.length-1;t>=0;t--){const n=this._storage[t];if(n.mediaKeySession===e)return Object.assign({},n)}return null}async generateLicenseRequest(e,t,n){let i;for(const r of this._storage)if(r.mediaKeySession===e){i=r;break}if(void 0===i)return V.error("DRM-LSS: generateRequest error. No MediaKeySession found with the given initData and initDataType"),Kh(e,t,n);if(i.isGeneratingRequest=!0,"none"!==i.closingStatus.type)throw new Error("The `MediaKeySession` is being closed.");try{await Kh(e,t,n)}catch(e){if(void 0===i)throw e;throw i.isGeneratingRequest=!1,"awaiting"===i.closingStatus.type&&i.closingStatus.start(),e}void 0!==i&&(i.isGeneratingRequest=!1,"awaiting"===i.closingStatus.type&&i.closingStatus.start())}async loadPersistentSession(e,t){let n,i;for(const r of this._storage)if(r.mediaKeySession===e){n=r;break}if(void 0===n)return V.error("DRM-LSS: loadPersistentSession error. No MediaKeySession found with the given initData and initDataType"),Xh(e,t);if(n.isLoadingPersistentSession=!0,"none"!==n.closingStatus.type)throw new Error("The `MediaKeySession` is being closed.");try{i=await Xh(e,t)}catch(e){if(void 0===n)throw e;throw n.isLoadingPersistentSession=!1,"awaiting"===n.closingStatus.type&&n.closingStatus.start(),e}return void 0===n?i:(n.isLoadingPersistentSession=!1,"awaiting"===n.closingStatus.type&&n.closingStatus.start(),i)}async closeSession(e){let t;for(const n of this._storage)if(n.mediaKeySession===e){t=n;break}return void 0===t?(V.warn("DRM-LSS: No MediaKeySession found with the given initData and initDataType"),Promise.resolve(!1)):this._closeEntry(t)}getLength(){return this._storage.length}getAll(){return this._storage}async closeAllSessions(){const e=this._storage;V.debug("DRM-LSS: Closing all current MediaKeySessions",e.length),this._storage=[];const t=e.map(e=>this._closeEntry(e));await Promise.all(t)}removeSessionWithoutClosingIt(e){fe(""===e.sessionId,"Initialized `MediaKeySession`s should always be properly closed");for(let t=this._storage.length-1;t>=0;t--){const n=this._storage[t];if(n.mediaKeySession===e)return V.debug("DRM-LSS: Removing session without closing it",e.sessionId),this._storage.splice(t,1),!0}return!1}getIndex(e){for(let t=0;t<this._storage.length;t++){const n=this._storage[t];if(n.keySessionRecord===e)return t}return-1}async _closeEntry(e){const{mediaKeySession:t}=e;return new Promise((n,i)=>{function r(){void 0!==e&&(e.closingStatus={type:"pending"}),nf(t).then(()=>{void 0!==e&&(e.closingStatus={type:"done"}),n(!0)}).catch(t=>{void 0!==e&&(e.closingStatus={type:"failed"}),i(t)})}void 0!==e&&(e.isLoadingPersistentSession||e.isGeneratingRequest)?e.closingStatus={type:"awaiting",start:r}:r()})}}async function nf(e){V.debug("DRM: Trying to close a MediaKeySession",e.sessionId);try{return await Qh(e),void V.debug("DRM: Succeeded to close MediaKeySession")}catch(e){return void V.error("DRM: Could not close MediaKeySession: "+(e instanceof Error?e.toString():"Unknown error"))}}function rf(e){let t,n=0;for(let i=0;i<e.length;i++)t=e[i],n=(n<<5)-n+t,n&=n;return n}class sf{constructor(e){this.initData=e}toJSON(){return Wa(this.initData)}static decode(e){return Ka(e)}}function af(e,t){var n,i;return null!==(i=null!==(n=of(e,t))&&void 0!==n?n:of(t,e))&&void 0!==i&&i}function of(e,t){if(0===e.length)return!1;if(t.length<e.length)return null;const n=e[0];let i=0,r=0;for(;r<t.length;r++){const s=t[r];if(s.systemId!==n.systemId)continue;if(s.hash!==n.hash)return!1;let a,o;if(a=n.data instanceof Uint8Array?n.data:"string"===typeof n.data?sf.decode(n.data):n.data.initData,o=s.data instanceof Uint8Array?s.data:"string"===typeof s.data?sf.decode(s.data):s.data.initData,!yt(a,o))return!1;if(t.length-r<e.length)return null;for(i=1;i<e.length;i++){const n=e[i];for(r+=1;r<t.length;r++){const e=t[r];if(n.systemId!==e.systemId)continue;if(n.hash!==e.hash)return!1;let i,s;if(i=n.data instanceof Uint8Array?n.data:"string"===typeof n.data?sf.decode(n.data):n.data.initData,s=e.data instanceof Uint8Array?e.data:"string"===typeof e.data?sf.decode(e.data):e.data.initData,!yt(i,s))return!1;break}if(i===t.length)return null}return!0}return null}function lf(e){pe(e,{save:"function",load:"function"},"persistentLicenseConfig")}class uf{constructor(e){lf(e),this._entries=[],this._storage=e;try{let e=this._storage.load();Array.isArray(e)||(e=[]),this._entries=e}catch(e){V.warn("DRM-PSS: Could not get entries from license storage",e instanceof Error?e:""),this.dispose()}}getLength(){return this._entries.length}getAll(){return this._entries}get(e){const t=this._getIndex(e);return-1===t?null:this._entries[t]}getAndReuse(e){const t=this._getIndex(e);if(-1===t)return null;const n=this._entries.splice(t,1)[0];return this._entries.push(n),n}add(e,t,n){var i;if(r(n)||!Ot(n.sessionId))return void V.warn("DRM-PSS: Invalid Persisten Session given.");const{sessionId:s}=n,a=this._getIndex(e);if(a>=0){const e=void 0===t?3:4,n=this._entries[a],r=null!==(i=n.version)&&void 0!==i?i:-1;if(r>=e&&s===n.sessionId)return;V.info("DRM-PSS: Updating session info.",s),this._entries.splice(a,1)}else V.info("DRM-PSS: Add new session",s);const o=cf(e.values.getFormattedValues());void 0===t?this._entries.push({version:3,sessionId:s,values:o,initDataType:e.type}):this._entries.push({version:4,sessionId:s,keyIds:t.map(e=>new sf(e)),values:o,initDataType:e.type}),this._save()}delete(e){let t=-1;for(let i=0;i<this._entries.length;i++){const n=this._entries[i];if(n.sessionId===e){t=i;break}}if(-1===t)return void V.warn("DRM-PSS: initData to delete not found.");const n=this._entries[t];V.warn("DRM-PSS: Delete session from store",n.sessionId),this._entries.splice(t,1),this._save()}deleteOldSessions(e){V.info(`DRM-PSS: Deleting last ${e} sessions.`),e<=0||(e<=this._entries.length?this._entries.splice(0,e):(V.warn("DRM-PSS: Asked to remove more information that it contains",e,this._entries.length),this._entries=[]),this._save())}dispose(){this._entries=[],this._save()}_getIndex(e){let t=null;function n(){if(null===t){const n=e.values.constructRequestData();t={initData:n,initDataHash:rf(n)}}return t}for(let i=0;i<this._entries.length;i++){const t=this._entries[i];if(t.initDataType===e.type)switch(t.version){case 4:if(void 0!==e.keyIds){const n=e.keyIds.every(e=>{const n=Wa(e);for(const i of t.keyIds)if("string"===typeof i){if(n===i)return!0}else if(yt(i.initData,e))return!0;return!1});if(n)return i}else{const n=e.values.getFormattedValues();if(af(n,t.values))return i}break;case 3:const r=e.values.getFormattedValues();if(af(r,t.values))return i;break;case 2:{const{initData:e,initDataHash:r}=n();if(t.initDataHash===r)try{const n="string"===typeof t.initData?sf.decode(t.initData):t.initData.initData;if(yt(n,e))return i}catch(e){V.warn("DRM-PSS: Could not decode initialization data.",e instanceof Error?e:"")}break}case 1:{const{initData:e,initDataHash:r}=n();if(t.initDataHash===r){if("undefined"===typeof t.initData.length)return i;if(yt(t.initData,e))return i}break}default:{const{initDataHash:e}=n();if(t.initData===e)return i}}}return-1}_save(){try{this._storage.save(this._entries)}catch(e){const t=e instanceof Error?e:void 0;V.warn("DRM-PSS: Could not save MediaKeySession information",t)}}}function cf(e){return e.map(({systemId:e,data:t,hash:n})=>({systemId:e,hash:n,data:new sf(t)}))}const df=new WeakMap;var hf={prepare(e){df.set(e,null)},set(e,t){const n=t instanceof Uint8Array?t:new Uint8Array(t instanceof ArrayBuffer?t:t.buffer),i=rf(n);df.set(e,{hash:i,serverCertificate:n})},hasOne(e){const t=df.get(e);return void 0!==t&&(null!==t||void 0)},has(e,t){const n=df.get(e);if(void 0===n||null===n)return!1;const{hash:i,serverCertificate:r}=n,s=t instanceof Uint8Array?t:new Uint8Array(t instanceof ArrayBuffer?t:t.buffer),a=rf(s);if(a!==i||r.length!==s.length)return!1;for(let o=0;o<r.length;o++)if(r[o]!==s[o])return!1;return!0}};function ff(e){const{persistentLicenseConfig:t}=e;return r(t)?null:(V.debug("DRM: Set the given license storage"),new uf(t))}async function pf(e,t,n){const i=await zh(e,t,n);if(null!==n.cancellationError)throw n.cancellationError;const{options:s,mediaKeySystemAccess:a}=i.value,o=ar.getState(e),l=ff(s);if(Nh()&&null!==o&&"reuse-media-key-system-access"===i.type){const{mediaKeys:e,loadedSessionsStore:t}=o;if(!1===hf.hasOne(e)||!r(s.serverCertificate)&&hf.has(e,s.serverCertificate))return{mediaKeys:e,mediaKeySystemAccess:a,stores:{loadedSessionsStore:t,persistentSessionsStore:l},options:s}}const u=await gf(a);V.info("DRM: MediaKeys created with success");const c=new tf(u);return{mediaKeys:u,mediaKeySystemAccess:a,stores:{loadedSessionsStore:c,persistentSessionsStore:l},options:s}}async function gf(e){V.info("DRM: Calling createMediaKeys on the MediaKeySystemAccess");try{const t=await e.createMediaKeys();return t}catch(e){const t=e instanceof Error?e.message:"Unknown error when creating MediaKeys.";throw new lt("CREATE_MEDIA_KEYS_ERROR",t)}}async function mf(e,t,n){const i=await pf(e,t,n),{mediaKeys:r}=i,s=null!==e.mediaKeys&&void 0!==e.mediaKeys&&r!==e.mediaKeys;return s&&(V.debug("DRM: Disabling old MediaKeys"),await Ih(e)),i}function vf(e,t,n){const{baseDelay:i,maxDelay:s,totalRetry:a,shouldRetry:o,onRetry:l}=t;let u=0;return c();async function c(){if(null!==n.cancellationError)throw n.cancellationError;try{const t=await e();return t}catch(e){if(null!==n.cancellationError)throw n.cancellationError;if(!r(o)&&!o(e)||u++>=a)throw e;"function"===typeof l&&l(e,u);const t=yf(i,u,s);await Di(t);const d=c();return d}}}function yf(e,t,n){const i=e*Math.pow(2,t-1),r=hn(i);return Math.min(r,n)}function bf(e,t){return-1!==e.indexOf("playready")&&(h||c)?La(t):t}class _f extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,_f.prototype),this.reason=e}}const Tf={EXPIRED:"expired",INTERNAL_ERROR:"internal-error",OUTPUT_RESTRICTED:"output-restricted"};function Sf(e,t,n){const{onKeyInternalError:i,onKeyOutputRestricted:r,onKeyExpiration:s}=t,a=[],o=[],l=[];let u;return e.keyStatuses.forEach((e,t)=>{const[u,c]=(()=>{return"string"===typeof e?[e,t]:[t,e]})(),d=bf(n,new Uint8Array(c)),h={keyId:d.buffer,keyStatus:u};switch(V.hasLevel("DEBUG")&&V.debug(`DRM: key status update (${Ma(d)}): ${u}`),u){case Tf.EXPIRED:{const e=new lt("KEY_STATUS_CHANGE_ERROR",`A decryption key expired (${Ma(d)})`,{keyStatuses:[h,...l]});if("error"===s||void 0===s)throw e;switch(s){case"close-session":throw new _f(e);case"fallback":a.push(d);break;default:"continue"===s||void 0===s?o.push(d):ge(s);break}l.push(h);break}case Tf.INTERNAL_ERROR:{const e=new lt("KEY_STATUS_CHANGE_ERROR",`A "${u}" status has been encountered (${Ma(d)})`,{keyStatuses:[h,...l]});switch(i){case void 0:case"error":throw e;case"close-session":throw new _f(e);case"fallback":a.push(d);break;case"continue":o.push(d);break;default:if(void 0===i)throw e;ge(i)}l.push(h);break}case Tf.OUTPUT_RESTRICTED:{const e=new lt("KEY_STATUS_CHANGE_ERROR",`A "${u}" status has been encountered (${Ma(d)})`,{keyStatuses:[h,...l]});switch(r){case void 0:case"error":throw e;case"fallback":a.push(d);break;case"continue":o.push(d);break;default:if(void 0===r)throw e;ge(r)}l.push(h);break}default:o.push(d);break}}),l.length>0&&(u=new lt("KEY_STATUS_CHANGE_ERROR","One or several problematic key statuses have been encountered",{keyStatuses:l})),{warning:u,blacklistedKeyIds:a,whitelistedKeyIds:o}}function wf(e,t,n,i,s){V.info("DRM: Binding session events",e.sessionId);const{getLicenseConfig:a={}}=t,o=new me;return o.linkToSignal(s),r(e.closed)||e.closed.then(()=>o.cancel()).catch(e=>{s.isCancelled()||(o.cancel(),i.onError(e))}),Pr(e,e=>{o.cancel(),i.onError(new lt("KEY_ERROR",e.type))},o.signal),Or(e,()=>{V.info("DRM: keystatuseschange event received",e.sessionId);try{l()}catch(e){if(s.isCancelled()||o.isUsed()&&e instanceof ve)return;o.cancel(),i.onError(e)}},o.signal),Mr(e,t=>{const n=t,s=new Uint8Array(n.message),l=Ot(n.messageType)?n.messageType:"license-request";V.info(`DRM: Received message event, type ${l}`,e.sessionId);const d=c(a.retry);vf(()=>u(s,l),d,o.signal).then(t=>{if(o.isUsed())return Promise.resolve();if(r(t))V.info("DRM: No license given, skipping session.update");else try{return xf(e,t)}catch(e){o.cancel(),i.onError(e)}}).catch(e=>{if(o.isUsed())return;o.cancel();const t=Ef(e);if(!r(e)){const{fallbackOnLastTry:n}=e;if(!0===n)return V.warn("DRM: Last `getLicense` attempt failed. Blacklisting the current session."),void i.onError(new kf(t))}i.onError(t)})},o.signal),V.info("DRM: transmitting current keystatuses",e.sessionId),void l();function l(){if(o.isUsed()||0===e.keyStatuses.size)return;const{warning:r,blacklistedKeyIds:s,whitelistedKeyIds:a}=Sf(e,t,n);void 0!==r&&(i.onWarning(r),o.isUsed())||i.onKeyUpdate({whitelistedKeyIds:a,blacklistedKeyIds:s})}function u(e,n){let i;return new Promise((s,o)=>{try{V.debug("DRM: Calling `getLicense`",n);const s=t.getLicense(e,n),c=r(a.timeout)?1e4:a.timeout;c>=0&&(i=setTimeout(()=>{o(new Af(`"getLicense" timeout exceeded (${c} ms)`))},c)),Promise.resolve(s).then(l,u)}catch(e){u(e)}function l(e){void 0!==i&&clearTimeout(i),s(e)}function u(e){void 0!==i&&clearTimeout(i),o(e)}})}function c(e){return{totalRetry:null!==e&&void 0!==e?e:2,baseDelay:200,maxDelay:3e3,shouldRetry:e=>e instanceof Af||r(e)||!0!==e.noRetry,onRetry:e=>i.onWarning(Ef(e))}}}function Ef(e){if(e instanceof Af)return new lt("KEY_LOAD_TIMEOUT","The license server took too much time to respond.");const t=new lt("KEY_LOAD_ERROR","An error occured when calling `getLicense`.");return!r(e)&&Ot(e.message)&&(t.message=e.message),t}async function xf(e,t){V.info("DRM: Updating MediaKeySession with message");try{await e.update(t)}catch(e){const t=e instanceof Error?e.toString():"`session.update` failed";throw new lt("KEY_UPDATE_ERROR",t)}V.info("DRM: MediaKeySession update succeeded.")}class kf extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,kf.prototype),this.sessionError=e}}class Af extends Error{constructor(e){super(e),Object.setPrototypeOf(this,kf.prototype),this.message=e}}async function If(e,t){try{const n=await e.setServerCertificate(t);return n}catch(e){V.warn("DRM: mediaKeys.setServerCertificate returned an error",e instanceof Error?e:"");const t=e instanceof Error?e.toString():"`setServerCertificate` error";throw new lt("LICENSE_SERVER_CERTIFICATE_ERROR",t)}}async function Cf(e,t){if(!0===hf.hasOne(e))return V.info("DRM: The MediaKeys already has a server certificate, skipping..."),{type:"already-has-one"};if("function"!==typeof e.setServerCertificate)return V.warn("DRM: Could not set the server certificate. mediaKeys.setServerCertificate is not a function"),{type:"method-not-implemented"};V.info("DRM: Setting server certificate on the MediaKeys"),hf.prepare(e);try{const n=await If(e,t);return hf.set(e,t),{type:"success",value:n}}catch(e){const t=ht(e)?e:new lt("LICENSE_SERVER_CERTIFICATE_ERROR","Unknown error when setting the server certificate.");return{type:"error",value:t}}}function Df(e,t){if(isNaN(t)||t<0||t>=e.getLength())return;const n=e.getLength(),i=n-t;V.info("DRM: Too many stored persistent sessions, removing some.",n,i),e.deleteOldSessions(i)}function Rf(e){return Vi(e,"com.microsoft.playready")||"com.chromecast.playready"===e||"com.youtube.playready"===e?"9a04f07998404286ab92e65be0885f95":"com.widevine.alpha"===e?"edef8ba979d64acea3c827dcd51d21ed":Vi(e,"com.apple.fps")?"94ce86fb07ff4f43adb893d2fa968ca2":Vi(e,"com.nagra.")?"adb41c242dbf4a6d958b4457c0d27b95":void 0}class Mf{constructor(e){this._innerValues=e,this._lazyFormattedValues=null}constructRequestData(){return jr(...this._innerValues.map(e=>e.data))}isCompatibleWith(e){const t=e instanceof Mf?e.getFormattedValues():e;return af(this.getFormattedValues(),t)}getFormattedValues(){return null===this._lazyFormattedValues&&(this._lazyFormattedValues=Lf(this._innerValues)),this._lazyFormattedValues}}function Lf(e){return e.slice().sort((e,t)=>{return e.systemId===t.systemId?0:void 0===e.systemId?1:void 0===t.systemId?-1:e.systemId<t.systemId?-1:1}).map(({systemId:e,data:t})=>({systemId:e,data:t,hash:rf(t)}))}class Pf extends s{static hasEmeApis(){return!r(Th.requestMediaKeySystemAccess)}constructor(e,t){super(),V.debug("DRM: Starting ContentDecryptor logic.");const n=new me;this._currentSessions=[],this._canceller=n,this._initDataQueue=[],this._stateData={state:Ss.Initializing,isMediaKeysAttached:0,isInitDataQueueLocked:!0,data:null},this.error=null,Th.onEncrypted(e,e=>{V.debug("DRM: Encrypted event received from media element.");const t=xh(e);null!==t&&this.onInitializationData(t)},n.signal),mf(e,t,n.signal).then(t=>{const{options:n,mediaKeySystemAccess:i}=t;let s;(r(n.persistentLicenseConfig)||!0===n.persistentLicenseConfig.disableRetroCompatibility)&&(s=Rf(i.keySystem)),this.systemId=s,this._stateData.state===Ss.Initializing&&(this._stateData={state:Ss.WaitingForAttachment,isInitDataQueueLocked:!0,isMediaKeysAttached:0,data:{mediaKeysInfo:t,mediaElement:e}},this.trigger("stateChange",this._stateData.state))}).catch(e=>{this._onFatalError(e)})}getState(){return this._stateData.state}attach(){if(this._stateData.state!==Ss.WaitingForAttachment)throw new Error("`attach` should only be called when in the WaitingForAttachment state");if(0!==this._stateData.isMediaKeysAttached)return void V.warn("DRM: ContentDecryptor's `attach` method called more than once.");const{mediaElement:e,mediaKeysInfo:t}=this._stateData.data,{options:n,mediaKeys:i,mediaKeySystemAccess:s,stores:a}=t,o=!0===n.disableMediaKeysAttachmentLock;if(o&&(this._stateData={state:Ss.ReadyForContent,isInitDataQueueLocked:!0,isMediaKeysAttached:1,data:{mediaKeysInfo:t,mediaElement:e}},this.trigger("stateChange",this._stateData.state),this._isStopped()))return;this._stateData.isMediaKeysAttached=1;const l={emeImplementation:Th,loadedSessionsStore:a.loadedSessionsStore,mediaKeySystemAccess:s,mediaKeys:i,keySystemOptions:n};V.debug("DRM: Attaching current MediaKeys"),Ch(e,l,this._canceller.signal).then(async()=>{this._stateData.isMediaKeysAttached=2;const{serverCertificate:e}=n;if(!r(e)){const t=await Cf(i,e);"error"===t.type&&this.trigger("warning",t.value)}if(this._isStopped())return;const s=this._stateData.state;this._stateData={state:Ss.ReadyForContent,isMediaKeysAttached:2,isInitDataQueueLocked:!1,data:{mediaKeysData:t}},s!==Ss.ReadyForContent&&this.trigger("stateChange",Ss.ReadyForContent),this._isStopped()||this._processCurrentInitDataQueue()}).catch(e=>{this._onFatalError(e)})}dispose(){this.removeEventListener(),this._stateData={state:Ss.Disposed,isMediaKeysAttached:void 0,isInitDataQueueLocked:void 0,data:null},this._canceller.cancel(),this.trigger("stateChange",this._stateData.state)}onInitializationData(e){if(!1!==this._stateData.isInitDataQueueLocked){if(this._isStopped())throw new Error("ContentDecryptor either disposed or stopped.");return void this._initDataQueue.push(e)}const{mediaKeysData:t}=this._stateData.data,n=Object.assign(Object.assign({},e),{values:new Mf(e.values)});this._processInitializationData(n,t).catch(e=>{this._onFatalError(e)})}async _processInitializationData(e,t){var n,i,s;V.hasLevel("DEBUG")&&V.debug("DRM: processing init data",null===(n=e.content)||void 0===n?void 0:n.adaptation.type,null===(i=e.content)||void 0===i?void 0:i.representation.bitrate,(null!==(s=e.keyIds)&&void 0!==s?s:[]).map(e=>Ma(e)).join(", "));const{mediaKeySystemAccess:a,stores:o,options:l}=t;if(this._tryToUseAlreadyCreatedSession(e,t)||this._isStopped())return;if("content"===l.singleLicensePer){const t=De(this._currentSessions,e=>"created-session"===e.source);if(void 0!==t){const n=e.keyIds;if(void 0===n)return void(void 0===e.content?V.warn("DRM: Unable to fallback from a non-decipherable quality."):(V.debug("DRM: Blacklisting new init data (due to singleLicensePer content policy)"),this.trigger("blackListProtectionData",e)));if(t.record.associateKeyIds(n),void 0===e.content)V.warn("DRM: Unable to fallback from a non-decipherable quality.");else{if(V.hasLevel("DEBUG")){const e=n.reduce((e,t)=>`${e}, ${Ma(t)}`,"");V.debug("DRM: Blacklisting new key ids",e)}this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:[],blacklistedKeyIds:n,delistedKeyIds:[]})}return}}else if("periods"===l.singleLicensePer&&void 0!==e.content){const{period:t}=e.content,n=this._currentSessions.filter(e=>"created-session"===e.source),i=new Set;Vf(i,t);for(const e of n){const t=Array.from(i);for(const n of t)if(e.record.isAssociatedWithKeyId(n)){e.record.associateKeyIds(i.values());for(const n of t)e.keyStatuses.whitelisted.some(e=>yt(e,n))||e.keyStatuses.blacklisted.some(e=>yt(e,n))||e.keyStatuses.blacklisted.push(n);return V.hasLevel("DEBUG")&&V.debug("DRM: Session already created for",Ma(n),'under singleLicensePer "periods" policy'),void this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:e.keyStatuses.whitelisted,blacklistedKeyIds:e.keyStatuses.blacklisted,delistedKeyIds:[]})}}}let u;this._lockInitDataQueue(),r(l.persistentLicenseConfig)?u="temporary":Of(a)?u="persistent-license":(V.warn('DRM: Cannot create "persistent-license" session: not supported'),u="temporary");const{EME_DEFAULT_MAX_SIMULTANEOUS_MEDIA_KEY_SESSIONS:c,EME_MAX_STORED_PERSISTENT_SESSION_INFORMATION:d}=N.getCurrent(),h="number"===typeof l.maxSessionCacheSize?l.maxSessionCacheSize:c,f=await Oh(e,o,u,h,this._canceller.signal);if(this._isStopped())return;const p={record:f.value.keySessionRecord,source:f.type,keyStatuses:{whitelisted:[],blacklisted:[]},blacklistedSessionError:null};this._currentSessions.push(p);const{mediaKeySession:g,sessionType:m}=f.value;let v=!1;if(wf(g,l,a.keySystem,{onKeyUpdate:t=>{const n=Bf(e,p.record,l.singleLicensePer,"created-session"===p.source,t.whitelistedKeyIds,t.blacklistedKeyIds);if(p.record.associateKeyIds(n.whitelisted),p.record.associateKeyIds(n.blacklisted),p.keyStatuses={whitelisted:n.whitelisted,blacklisted:n.blacklisted},0!==p.record.getAssociatedKeyIds().length&&"persistent-license"===m&&null!==o.persistentSessionsStore&&!v){const{persistentSessionsStore:t}=o;Df(t,d-1),t.add(e,p.record.getAssociatedKeyIds(),g),v=!0}void 0!==e.content&&this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:n.whitelisted,blacklistedKeyIds:n.blacklisted,delistedKeyIds:[]}),this._unlockInitDataQueue()},onWarning:e=>{this.trigger("warning",e)},onError:t=>{var n;if(t instanceof _f){V.warn("DRM: A session's closing condition has been triggered"),this._lockInitDataQueue();const i=this._currentSessions.indexOf(p);return i>=0&&this._currentSessions.splice(i),void 0!==e.content&&this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:[],blacklistedKeyIds:[],delistedKeyIds:p.record.getAssociatedKeyIds()}),null===(n=o.persistentSessionsStore)||void 0===n||n.delete(g.sessionId),o.loadedSessionsStore.closeSession(g).catch(e=>{const t=e instanceof Error?e:"unknown error";V.warn("DRM: failed to close expired session",t)}).then(()=>this._unlockInitDataQueue()).catch(e=>this._onFatalError(e)),void(this._isStopped()||this.trigger("warning",t.reason))}t instanceof kf?(p.blacklistedSessionError=t,void 0!==e.content&&(V.info("DRM: blacklisting Representations based on protection data."),this.trigger("blackListProtectionData",e)),this._unlockInitDataQueue()):this._onFatalError(t)}},this._canceller.signal),void 0!==l.singleLicensePer&&"init-data"!==l.singleLicensePer||this._unlockInitDataQueue(),"created-session"===f.type){const t=e.values.constructRequestData();try{await o.loadedSessionsStore.generateLicenseRequest(g,e.type,t)}catch(e){const t=o.loadedSessionsStore.getEntryForSession(g);if(null===t||"none"!==t.closingStatus.type){const e=this._currentSessions.indexOf(p);return e>=0&&this._currentSessions.splice(e,1),Promise.resolve()}throw new lt("KEY_GENERATE_REQUEST_ERROR",e instanceof Error?e.toString():"Unknown error")}}return Promise.resolve()}_tryToUseAlreadyCreatedSession(e,t){const{stores:n,options:i}=t,s=De(this._currentSessions,t=>t.record.isCompatibleWith(e));if(void 0===s)return!1;const a=s.blacklistedSessionError;if(!r(a))return void 0===e.type||void 0===e.content?(V.error("DRM: This initialization data has already been blacklisted but the current content is not known."),!0):(V.info("DRM: This initialization data has already been blacklisted. Blacklisting the related content."),this.trigger("blackListProtectionData",e),!0);if(void 0!==e.keyIds){let t;if(void 0===i.singleLicensePer||"init-data"===i.singleLicensePer){const{blacklisted:n}=s.keyStatuses;t=Jh(e.keyIds,n)}else{const{whitelisted:n}=s.keyStatuses;t=!Zh(e.keyIds,n)}if(t)return void 0===e.content?(V.error("DRM: Cannot forbid key id, the content is unknown."),!0):(V.info("DRM: Current initialization data is linked to blacklisted keys. Marking Representations as not decipherable"),this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:[],blacklistedKeyIds:e.keyIds,delistedKeyIds:[]}),!0)}const o=n.loadedSessionsStore.reuse(e);if(null!==o)return V.debug("DRM: Init data already processed. Skipping it."),!0;const l=this._currentSessions.indexOf(s);return-1===l?V.error("DRM: Unable to remove processed init data: not found."):(V.debug("DRM: A session from a processed init data is not available anymore. Re-processing it."),this._currentSessions.splice(l,1)),!1}_onFatalError(e){if(this._canceller.isUsed())return;const t=e instanceof Error?e:new dt("NONE","Unknown decryption error");this.error=t,this._initDataQueue.length=0,this._stateData={state:Ss.Error,isMediaKeysAttached:void 0,isInitDataQueueLocked:void 0,data:null},this._canceller.cancel(),this.trigger("error",t),this._stateData.state===Ss.Error&&this.trigger("stateChange",this._stateData.state)}_isStopped(){return this._stateData.state===Ss.Disposed||this._stateData.state===Ss.Error}_processCurrentInitDataQueue(){while(!1===this._stateData.isInitDataQueueLocked){const e=this._initDataQueue.shift();if(void 0===e)return;this.onInitializationData(e)}}_lockInitDataQueue(){!1===this._stateData.isInitDataQueueLocked&&(this._stateData.isInitDataQueueLocked=!0)}_unlockInitDataQueue(){2===this._stateData.isMediaKeysAttached?(this._stateData.isInitDataQueueLocked=!1,this._processCurrentInitDataQueue()):V.error("DRM: Trying to unlock in the wrong state")}}function Of(e){const{sessionTypes:t}=e.getConfiguration();return void 0!==t&&gt(t,"persistent-license")}function Nf(e,t){return e.filter(e=>{return!t.some(t=>yt(t,e))})}function Uf(e,t){const n=e.getAssociatedKeyIds(),i=Nf(n,t);return i.length>0&&V.hasLevel("DEBUG")&&V.debug("DRM: KeySessionRecord's keys missing in the license, blacklisting them",i.map(e=>Ma(e)).join(", ")),i}function Ff(e,t){let n=[];const{keyIds:i}=e;return void 0!==i&&(n=Nf(i,t)),n.length>0&&V.hasLevel("DEBUG")&&V.debug("DRM: init data keys missing in the license, blacklisting them",n.map(e=>Ma(e)).join(", ")),n}function Bf(e,t,n,i,r,s){var a;const o=[...r,...s],l=Uf(t,o),u=o.concat(l);if(void 0!==n&&"init-data"!==n){const t=Ff(e,u);u.push(...t);const{content:r}=e;if(i&&void 0!==r)if("content"===n){const e=new Set,{manifest:t}=r;for(const n of t.periods)Vf(e,n);jf(e,u)}else if("periods"===n){const{manifest:t}=r;for(const n of t.periods){const t=new Set;if(Vf(t,n),(null===(a=e.content)||void 0===a?void 0:a.period.id)===n.id)jf(t,u);else{const e=Array.from(t);for(const n of e){const e=u.some(e=>yt(e,n));if(e){jf(t,u);break}}}}}}return{whitelisted:r,blacklisted:u.slice(r.length)}}function jf(e,t){const n=Array.from(e.values());for(const i of n){const e=t.some(e=>yt(e,i));e||t.push(i)}}function Vf(e,t){const n=t.adaptations,i=ze(n).reduce((e,t)=>r(t)?e:e.concat(t),[]);for(const r of i)for(const t of r.representations)if(void 0!==t.contentProtections&&void 0!==t.contentProtections.keyIds)for(const n of t.contentProtections.keyIds)e.add(n.keyId)}var Hf=Pf;function $f(e){e.decrypt=Hf}function Gf(e){var t;let n,i;const r="subtitles";if(h){const i=e.textTracks.length;n=i>0?e.textTracks[i-1]:e.addTextTrack(r),n.mode=null!==(t=n.SHOWING)&&void 0!==t?t:"showing"}else i=document.createElement("track"),e.appendChild(i),n=i.track,i.kind=r,n.mode="showing";return{track:n,trackElement:i}}function zf(e,t){const{activeCues:n}=e;if(null===n)return!1;for(let i=0;i<n.length;i++)if(n[i]===t)return!0;return!1}function qf(e,t){if(f&&zf(e,t)){const n=e.mode;e.mode="hidden";try{e.removeCue(t)}catch(e){V.warn("Compat: Could not remove cue from text track.")}e.mode=n}else try{e.removeCue(t)}catch(e){V.warn("Compat: Could not remove cue from text track.")}}class Wf{constructor(){this._ranges=[],this.length=0}insert(e,t){re(this._ranges,{start:e,end:t}),this.length=this._ranges.length}remove(e,t){const n=[];e>0&&n.push({start:0,end:e}),t<1/0&&n.push({start:t,end:1/0}),this._ranges=ae(this._ranges,n),this.length=this._ranges.length}start(e){if(e>=this._ranges.length)throw new Error("INDEX_SIZE_ERROR");return this._ranges[e].start}end(e){if(e>=this._ranges.length)throw new Error("INDEX_SIZE_ERROR");return this._ranges[e].end}}function Kf(e,t,n,i){V.debug("NTSB: Finding parser for native text tracks:",e);const r=qt.nativeTextTracksParsers[e];if("function"!==typeof r)throw new Error("no parser found for the given text track");V.debug("NTSB: Parser found, parsing...");const s=r(t,n,i);return V.debug("NTSB: Parsed successfully!",s.length),s}class Yf{constructor(e){V.debug("NTD: Creating NativeTextDisplayer");const{track:t,trackElement:n}=Gf(e);this._buffered=new Wf,this._videoElement=e,this._track=t,this._trackElement=n}pushTextData(e){var t,n;if(V.debug("NTD: Appending new native text tracks"),null===e.chunk)return Q(this._buffered);const{timestampOffset:i,appendWindow:r,chunk:s}=e,{start:a,end:o,data:l,type:u,language:c}=s,d=null!==(t=r[0])&&void 0!==t?t:0,h=null!==(n=r[1])&&void 0!==n?n:1/0,f=Kf(u,l,i,c);if(0!==d&&h!==1/0){let e=0;while(e<f.length&&f[e].endTime<=d)e++;f.splice(0,e),e=0;while(e<f.length&&f[e].startTime<d)f[e].startTime=d,e++;e=f.length-1;while(e>=0&&f[e].startTime>=h)e--;f.splice(e,f.length),e=f.length-1;while(e>=0&&f[e].endTime>h)f[e].endTime=h,e--}let p,g;if(void 0!==a)p=Math.max(d,a);else{if(f.length<=0)return V.warn("NTD: Current text tracks have no cues nor start time. Aborting"),Q(this._buffered);V.warn("NTD: No start time given. Guessing from cues."),p=f[0].startTime}if(void 0!==o)g=Math.min(h,o);else{if(f.length<=0)return V.warn("NTD: Current text tracks have no cues nor end time. Aborting"),Q(this._buffered);V.warn("NTD: No end time given. Guessing from cues."),g=f[f.length-1].endTime}if(g<=p)return V.warn("NTD: Invalid text track appended: ","the start time is inferior or equal to the end time."),Q(this._buffered);if(f.length>0){const e=f[0],t=this._track.cues;null!==t&&t.length>0&&e.startTime<t[t.length-1].startTime&&this._removeData(e.startTime,1/0);for(const n of f)this._track.addCue(n)}return this._buffered.insert(p,g),Q(this._buffered)}removeBuffer(e,t){return this._removeData(e,t),Q(this._buffered)}getBufferedRanges(){return Q(this._buffered)}reset(){V.debug("NTD: Aborting NativeTextDisplayer"),this._removeData(0,1/0);const{_trackElement:e,_videoElement:t}=this;if(void 0!==e&&t.hasChildNodes())try{t.removeChild(e)}catch(e){V.warn("NTD: Can't remove track element from the video")}const n=this._track.mode;this._track.mode="disabled",this._track.mode=n,void 0!==this._trackElement&&(this._trackElement.innerHTML="")}stop(){V.debug("NTD: Aborting NativeTextDisplayer"),this._removeData(0,1/0);const{_trackElement:e,_videoElement:t}=this;if(void 0!==e&&t.hasChildNodes())try{t.removeChild(e)}catch(e){V.warn("NTD: Can't remove track element from the video")}this._track.mode="disabled",void 0!==this._trackElement&&(this._trackElement.innerHTML="")}_removeData(e,t){V.debug("NTD: Removing native text track data",e,t);const n=this._track,i=n.cues;if(null!==i)for(let r=i.length-1;r>=0;r--){const s=i[r],{startTime:a,endTime:o}=s;a>=e&&a<=t&&o<=t&&qf(n,s)}this._buffered.remove(e,t)}}var Xf=Yf;const Qf=/(\d+) (\d+)/;function Zf(e){const t=e.getAttribute("ttp:frameRate"),n=e.getAttribute("ttp:subFramRate"),i=e.getAttribute("ttp:tickRate"),r=e.getAttribute("ttp:frameRateMultiplier"),s=e.getAttribute("xml:space"),a=e.getAttribute("ttp:cellResolution");let o={columns:32,rows:15};if(null!==a){const e=Qf.exec(a);if(null===e||e.length<3)V.warn("TTML Parser: Invalid cellResolution");else{const t=parseInt(e[1],10),n=parseInt(e[2],10);isNaN(t)||isNaN(n)?V.warn("TTML Parser: Invalid cellResolution"):o={columns:t,rows:n}}}if(Ot(s)&&"default"!==s&&"preserve"!==s)throw new Error("Invalid spacing style");let l=Number(t);(isNaN(l)||l<=0)&&(l=30);let u=Number(n);(isNaN(u)||u<=0)&&(u=1);let c=Number(i);(isNaN(c)||c<=0)&&(c=void 0);let d=l;const h=null!==u&&void 0!==u?u:1,f=null!==s&&void 0!==s?s:"default",p=null!==c&&void 0!==c?c:l*u;if(null!==r){const e=/^(\d+) (\d+)$/g.exec(r);if(null!==e){const t=Number(e[1]),n=Number(e[2]),i=t/n;d=l*i}}return{cellResolution:o,tickRate:p,frameRate:d,subFrameRate:h,spaceStyle:f}}function Jf(e,t,n,i){const r={},s=e.slice();for(let a=0;a<=t.length-1;a++){const e=t[a];if(void 0!==e){let t,a;if(e.nodeType===Node.ELEMENT_NODE){const n=e;for(let e=0;e<=n.attributes.length-1;e++){const i=n.attributes[e],o=i.name;if("style"===o)t=i.value;else if("region"===o)a=i.value;else{const t=o.substring(4);if(gt(s,t)&&(r[t]=i.value,s.splice(e,1),0===s.length))return r}}}if(Ot(t)){const e=De(n,e=>e.id===t);if(void 0!==e)for(let t=0;t<=s.length-1;t++){const n=s[t];if(!Ot(r[n])&&Ot(e.style[n])){if(r[n]=e.style[n],s.splice(t,1),0===s.length)return r;t--}}}if(Ot(a)){const e=De(i,e=>e.id===a);if(void 0!==e)for(let t=0;t<=s.length-1;t++){const n=s[t];if(!Ot(r[n])&&Ot(e.style[n])){if(r[n]=e.style[n],s.splice(t,1),0===s.length)return r;t--}}}}}return r}function ep(e){if(e.nodeType!==Node.ELEMENT_NODE)return{};const t=e,n={};for(let i=0;i<=t.attributes.length-1;i++){const e=t.attributes[i];if(Vi(e.name,"tts")){const t=e.name.substring(4);n[t]=e.value}}return n}function tp(e){const t=[];function n(i,r){t.push(r);for(let s=0;s<i.extendsStyles.length;s++){const r=i.extendsStyles[s],a=le(e,e=>e.id===r);if(a<0)V.warn("TTML Parser: unknown style inheritance: "+r);else{const r=e[a];gt(t,a)?V.warn("TTML Parser: infinite style inheritance loop avoided"):n(r,a),i.style=R({},r.style,i.style)}}i.extendsStyles.length=0}for(let i=0;i<e.length;i++)n(e[i],i),t.length=0}function np(e,t){if(!(e.parentNode instanceof Element))return[];function n(e){const i=[];e.tagName.toLowerCase()===t.toLowerCase()&&i.push(e);const r=e.parentNode;return r instanceof Element&&i.push(...n(r)),i}return n(e.parentNode)}function ip(e){let t=np(e,"div");if(0===t.length){const n=np(e,"tt:div");n.length>0&&(t=n)}return t}function rp(e){const t=e.getElementsByTagName("body");if(t.length>0)return t[0];const n=e.getElementsByTagName("tt:body");return n.length>0?n[0]:null}function sp(e){const t=e.getElementsByTagName("style");if(t.length>0)return t;const n=e.getElementsByTagName("tt:style");return n.length>0?n:t}function ap(e){const t=e.getElementsByTagName("region");if(t.length>0)return t;const n=e.getElementsByTagName("tt:region");return n.length>0?n:t}function op(e){const t=e.getElementsByTagName("p");if(t.length>0)return t;const n=e.getElementsByTagName("tt:p");return n.length>0?n:t}function lp(e){return"br"===e.nodeName||"tt:br"===e.nodeName}function up(e){return"span"===e.nodeName||"tt:span"===e.nodeName}const cp=["align","backgroundColor","color","direction","display","displayAlign","extent","fontFamily","fontSize","fontStyle","fontWeight","lineHeight","opacity","origin","overflow","padding","textAlign","textDecoration","textOutline","unicodeBidi","visibility","wrapOption","writingMode"];function dp(e,t){const n=[],i=(new DOMParser).parseFromString(e,"text/xml");if(null!==i&&void 0!==i){const e=i.getElementsByTagName("tt");let r=e[0];if(void 0===r){const e=i.getElementsByTagNameNS("*","tt");if(r=e[0],void 0===r)throw new Error("invalid XML")}const s=rp(r),a=sp(r),o=ap(r),l=op(r),u=Zf(r),c=[];for(let t=0;t<=a.length-1;t++){const e=a[t];if(e instanceof Element){const t=e.getAttribute("xml:id");if(null!==t){const n=e.getAttribute("style"),i=null===n?[]:n.split(" ");c.push({id:t,style:ep(e),extendsStyles:i})}}}tp(c);const d=[];for(let t=0;t<=o.length-1;t++){const e=o[t];if(e instanceof Element){const t=e.getAttribute("xml:id");if(null!==t){let n=ep(e);const i=e.getAttribute("style");if(Ot(i)){const e=De(c,e=>e.id===i);void 0!==e&&(n=R({},e.style,n))}d.push({id:t,style:n,extendsStyles:[]})}}}const h=Jf(cp,null!==s?[s]:[],c,d),f=null!==s?s.getAttribute("xml:space"):void 0,p="default"===f||"default"===u.spaceStyle;for(let i=0;i<l.length;i++){const e=l[i];if(e instanceof Element){const i=ip(e),r=R({},h,Jf(cp,[e,...i],c,d)),a=e.getAttribute("xml:space"),o=Ot(a)?"default"===a:p,l={paragraph:e,timeOffset:t,idStyles:c,regionStyles:d,body:s,paragraphStyle:r,ttParams:u,shouldTrimWhiteSpace:o};null!==l&&n.push(l)}}}return n}function hp(e){return"function"===typeof a["a"].VTTCue&&e instanceof a["a"].VTTCue}function fp(e,t,n){if(e>=t)return V.warn(`Compat: Invalid cue times: ${e} - ${t}`),null;if(r(a["a"].VTTCue)){if(r(a["a"].TextTrackCue))throw new Error("VTT cues not supported in your target");return new TextTrackCue(e,t,n)}return new VTTCue(e,t,n)}const pp=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,gp=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,mp=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,vp=/^(\d*\.?\d*)f$/,yp=/^(\d*\.?\d*)t$/,bp=/^(?:(\d*\.?\d*)h)?(?:(\d*\.?\d*)m)?(?:(\d*\.?\d*)s)?(?:(\d*\.?\d*)ms)?$/,_p=/^(\d{1,2}|100)% (\d{1,2}|100)%$/,Tp=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/,Sp=/^#([0-9A-f]{2})([0-9A-f]{2})([0-9A-f]{2})([0-9A-f]{2})$/,wp=/^#([0-9A-f])([0-9A-f])([0-9A-f])([0-9A-f])$/,Ep=/^rgb\( *(\d+) *, *(\d+) *, *(\d+) *\)/,xp=/^rgba\( *(\d+) *, *(\d+) *, *(\d+) *, *(\d+) *\)/;function kp(e,t){return pp.test(e)?Cp(t,e):gp.test(e)?Dp(gp,e):mp.test(e)?Dp(mp,e):vp.test(e)?Ap(t,e):yp.test(e)?Ip(t,e):bp.test(e)?Dp(bp,e):void 0}function Ap(e,t){const n=vp.exec(t),i=Number(n[1]);return i/e.frameRate}function Ip(e,t){const n=yp.exec(t),i=Number(n[1]);return i/e.tickRate}function Cp(e,t){const n=pp.exec(t),i=Number(n[1]),r=Number(n[2]);let s=Number(n[3]),a=Number(n[4]),o=Number(n[5]);return isNaN(o)&&(o=0),a+=o/e.subFrameRate,s+=a/e.frameRate,s+60*r+3600*i}function Dp(e,t){const n=e.exec(t);if(null===n||""===n[0])return null;let i=Number(n[1]);isNaN(i)&&(i=0);let r=Number(n[2]);isNaN(r)&&(r=0);let s=Number(n[3]);isNaN(s)&&(s=0);let a=Number(n[4]);return isNaN(a)&&(a=0),a/1e3+s+60*r+3600*i}var Rp=kp;function Mp(e,t){const n=e.getAttribute("begin"),i=e.getAttribute("dur"),s=e.getAttribute("end"),a=Ot(n)?Rp(n,t):null,o=Ot(i)?Rp(i,t):null,l=Ot(s)?Rp(s,t):null;if(r(a)||r(l)&&r(o))throw new Error("Invalid text cue");const u=r(l)?a+o:l;return{start:a,end:u}}const Lp={left:"start",center:"center",right:"end",start:"start",end:"end"},Pp={left:"line-left",center:"center",right:"line-right"};function Op(e){const{paragraph:t,timeOffset:n,paragraphStyle:i,ttParams:r,shouldTrimWhiteSpace:s}=e;if(!t.hasAttribute("begin")&&!t.hasAttribute("end")&&/^\s*$/.test(null===t.textContent?"":t.textContent))return null;const{start:a,end:o}=Mp(t,r),l=Np(t,s),u=fp(a+n,o+n,l);return null===u?null:(hp(u)&&Up(u,i),u)}function Np(e,t){function n(e,t){const i=e.childNodes;let r="";for(let s=0;s<i.length;s++){const e=i[s];if("#text"===e.nodeName){let n=e.textContent;if(null===n&&(n=""),t){let e=n.trim();e=e.replace(/\s+/g," "),n=e}const i=n.replace(/&|\u0026/g,"&amp;").replace(/<|\u003C/g,"&lt;").replace(/>|\u2265/g,"&gt;").replace(/\u200E/g,"&lrm;").replace(/\u200F/g,"&rlm;").replace(/\u00A0/g,"&nbsp;");r+=i}else if(lp(e))r+="\n";else if(up(e)&&e.nodeType===Node.ELEMENT_NODE&&e.childNodes.length>0){const i=e.getAttribute("xml:space"),s=Ot(i)?"default"===i:t;r+=n(e,s)}}return r}return n(e,t)}function Up(e,t){const n=t.extent;if(Ot(n)){const t=_p.exec(n);r(t)||(e.size=Number(t[1]))}const i=t.writingMode;switch(i){case"tb":case"tblr":e.vertical="lr";break;case"tbrl":e.vertical="rl";break;default:break}const s=t.origin;if(Ot(s)){const e=_p.exec(s);r(e)}const a=t.align;if(Ot(a)){e.align=a,"center"===a&&("center"!==e.align&&(e.align="middle"),e.position="auto");const t=Pp[a];e.positionAlign=void 0===t?"":t;const n=Lp[a];e.lineAlign=void 0===n?"":n}}function Fp(e,t){const n=dp(e,t),i=[];for(let r=0;r<n.length;r++){const e=n[r],t=Op(e);null!==t&&i.push(t)}return i}var Bp=Fp;function jp(e){e.nativeTextTracksParsers.ttml=Bp,e.nativeTextDisplayer=Xf}const Vp=/&#([0-9]+);/g,Hp=/<br>/gi,$p=/<style[^>]*>([\s\S]*?)<\/style[^>]*>/i,Gp=/\s*<p (?:class=([^>]+))?>(.*)/i,zp=/<sync[^>]+?start="?([0-9]*)"?[^0-9]/i;function qp(e){const t=[];for(let n=0;n<e.length;n++){const{start:i,end:s,text:a}=e[n];if(Ot(a)&&!r(s)){const e=fp(i,s,a);null!==e&&t.push(e)}}return t}function Wp(e){const t=/\.(\S+)\s*{([^}]*)}/gi,n={};let i=t.exec(e);while(Array.isArray(i)){const s=i[1],a=Kp(i[2],"lang");r(s)||r(a)||(n[a]=s),i=t.exec(e)}return n}function Kp(e,t){const n=new RegExp("\\s*"+t+":\\s*(\\S+);","i").exec(e);return Array.isArray(n)?n[1]:null}function Yp(e){return e.replace(Hp,"\n").replace(Vp,(e,t)=>String.fromCharCode(Number(t)))}function Xp(e,t,n){const i=/<sync[ >]/gi,r=/<sync[ >]|<\/body>/gi,s=[],a=$p.exec(e),o=null!==a?a[1]:"";let l,u;r.exec(e);const c=Wp(o);let d;if(Ot(n)&&(d=c[n],void 0===d))throw new Error(`sami: could not find lang ${n} in CSS`);while(1){if(l=i.exec(e),u=r.exec(e),null===l&&null===u)break;if(null===l||null===u||l.index>=u.index)throw new Error("parse error");const t=e.slice(l.index,u.index),n=zp.exec(t);if(null===n)throw new Error("parse error (sync time attribute)");const s=+n[1];if(isNaN(s))throw new Error("parse error (sync time attribute NaN)");h(t.split("\n"),s/1e3)}return qp(s);function h(e,n){let i,r=e.length;while(--r>=0){if(i=Gp.exec(e[r]),null===i)continue;const[,a,o]=i;d===a&&("&nbsp;"===o?s[s.length-1].end=n:s.push({text:Yp(o),start:n+t}))}}}var Qp=Xp;function Zp(e){e.nativeTextTracksParsers.sami=Qp,e.nativeTextDisplayer=Xf}function Jp(e){let t=0;while(t<e.length){if(""===e[t])return t+1;t++}return t}function eg(e,t){return"string"===typeof e[t]&&/^STYLE( .*)?$/g.test(e[t])&&(void 0===e[t+1]||e[t+1].indexOf("--\x3e")<0)}function tg(e,t){return"string"===typeof e[t]&&/^NOTE( .*)?$/g.test(e[t])&&(void 0===e[t+1]||e[t+1].indexOf("--\x3e")<0)}function ng(e,t){return"string"===typeof e[t]&&/^REGION( .*)?$/g.test(e[t])&&(void 0===e[t+1]||e[t+1].indexOf("--\x3e")<0)}function ig(e,t){const n=e[t];if(void 0===n||""===n||eg(e,t)||ng(e,t)||tg(e,t))return!1;if(n.indexOf("--\x3e")>=0)return!0;const i=e[t+1];return void 0!==i&&i.indexOf("--\x3e")>=0}function rg(e,t){let n=t+1;while(Ot(e[n]))n++;return n}function sg(e,t){const n=[];for(let i=t;i<e.length;i++)if(ig(e,i)){const t=rg(e,i);n.push(e.slice(i,t)),i=t}else if(Ot(e[i]))while(Ot(e[i]))i++;return n}function ag(e){const t=e.split(":").reverse();if(Ot(t[2])||Ot(t[1])){const e=Ot(t[2])?parseInt(t[2],10):0,n=parseInt(t[1],10),i=parseFloat(t[0].replace(",","."));if(isNaN(e)||isNaN(n)||isNaN(i))return;return 60*e*60+60*n+i}}function og(e){const t=e.split(/ |\t/);return t.reduce((e,t)=>{const n=t.split(":");return 2===n.length&&(e[n[0]]=n[1]),e},{})}function lg(e){const t=/^([\d:.]+)[ |\t]+-->[ |\t]+([\d:.]+)[ |\t]*(.*)$/,n=t.exec(e);if(null===n)return null;const i=ag(n[1]),r=ag(n[2]);if(void 0===i||void 0===r)return null;const s=og(n[3]);return{start:i,end:r,settings:s}}function ug(e,t){const n=/-->/;let i,r,s;if(n.test(e[0]))i=e[0],r=e.slice(1,e.length);else{if(!n.test(e[1]))return null;s=e[0],i=e[1],r=e.slice(2,e.length)}const a=lg(i);if(null===a)return null;const{start:o,end:l,settings:u}=a;return{start:o+t,end:l+t,settings:u,payload:r,header:s}}function cg(e,t){if(!Ot(e.vertical)||"rl"!==e.vertical&&"lr"!==e.vertical||(t.vertical=e.vertical),Ot(e.line)){const n=/^(\d+(\.\d+)?)%(,([a-z]+))?/,i=n.exec(e.line);if(Array.isArray(i))t.line=Number(i[1]),t.snapToLines=!1,gt(["start","center","end"],i[4])&&(t.lineAlign=i[4]);else{const n=/^(-?\d+)(,([a-z]+))?/,i=n.exec(e.line);Array.isArray(i)&&(t.line=Number(i[1]),t.snapToLines=!0,gt(["start","center","end"],i[3])&&(t.lineAlign=i[3]))}}if(Ot(e.position)){const n=/^([\d\.]+)%(?:,(line-left|line-right|center))?$/,i=n.exec(e.position);if(Array.isArray(i)&&i.length>=2){const e=parseInt(i[1],10);isNaN(e)||(t.position=e,void 0!==i[2]&&(t.positionAlign=i[2]))}}Ot(e.size)&&(t.size=e.size),"string"===typeof e.align&&gt(["start","center","end","left"],e.align)&&(t.align=e.align)}function dg(e){const{start:t,end:n,payload:i}=e,r=i.join("\n");return fp(t,n,r)}function hg(e,t){const n=e.split(/\r\n|\n|\r/);if(!/^WEBVTT($| |\t)/.test(n[0]))throw new Error("Can't parse WebVTT: Invalid file.");const i=Jp(n),r=sg(n,i),s=[];for(let a=0;a<r.length;a++){const e=ug(r[a],t);if(null!==e){const t=dg(e);null!==t&&(hp(t)&&cg(e.settings,t),s.push(t))}}return s}var fg=hg;function pg(e){e.nativeTextTracksParsers.vtt=fg,e.nativeTextDisplayer=Xf}function gg(e,t){let n=t+1;while(Ot(e[n]))n++;return n}function mg(e){const t=[];for(let n=0;n<e.length;n++)if(Ot(e[n])){const i=gg(e,n),r=e.slice(n,i);r.length>0&&(1===r.length?r[0].indexOf("--\x3e")>=0&&t.push(r):(r[1].indexOf("--\x3e")>=0||r[0].indexOf("--\x3e")>=0)&&t.push(r)),n=i}return t}function vg(e){const t=e.split(":");if(Ot(t[2])){const e=parseInt(t[0],10),n=parseInt(t[1],10),i=parseFloat(t[2].replace(",","."));if(isNaN(e)||isNaN(n)||isNaN(i))return;return 60*e*60+60*n+i}}function yg(e,t){if(0===e.length)return null;let n,i,r=[];if(Ot(e[1])&&-1!==e[1].indexOf("--\x3e")&&([n,i]=e[1].split("--\x3e").map(e=>e.trim()),r=e.slice(2,e.length)),Ot(n)&&Ot(i)||([n,i]=e[0].split("--\x3e").map(e=>e.trim()),r=e.slice(1,e.length)),!Ot(n)||!Ot(i))return null;const s=vg(n),a=vg(i);return void 0===s||void 0===a?null:{start:s+t,end:a+t,payload:r}}function bg(e,t){const n=e.split(/\r\n|\n|\r/),i=mg(n),r=[];for(let s=0;s<i.length;s++){const e=yg(i[s],t);if(null!==e){const t=_g(e);null!==t&&r.push(t)}}return r}function _g(e){const{start:t,end:n,payload:i}=e,r=i.join("\n");return fp(t,n,r)}function Tg(e){e.nativeTextTracksParsers.srt=bg,e.nativeTextDisplayer=Xf}const Sg=a["a"].ResizeObserver;function wg(e,t,n){const{height:i,width:r}=e.getBoundingClientRect(),s=new de({height:i,width:r},n);let a=i,o=r;if(void 0!==Sg){const t=new Sg(e=>{if(0===e.length)return void V.error("Compat: Resized but no observed element.");const t=e[0],{height:n,width:i}=t.contentRect;n===a&&i===o||(a=n,o=i,s.setValue({height:n,width:i}))});t.observe(e),n.register(()=>{t.disconnect()})}else{const i=setInterval(()=>{const{height:t,width:n}=e.getBoundingClientRect();t===a&&n===o||(a=t,o=n,s.setValue({height:t,width:n}))},t);n.register(()=>{clearInterval(i)})}return s}function Eg(e,t,n,i){V.debug("HTSB: Finding parser for html text tracks:",e);const r=qt.htmlTextTracksParsers[e];if("function"!==typeof r)throw new Error("no parser found for the given text track");V.debug("HTSB: Parser found, parsing...");const s=r(t,n,i);return V.debug("HTTB: Parsed successfully!",s.length),s}const xg=.2;function kg(e,t,n=xg){return Math.abs(e-t)<=Math.min(n,xg)}const Ag=.05;function Ig(e,t){const n=e.end-e.start,i=t.end-t.start,r=Math.abs(e.start-t.start),s=Math.min(n,i,xg);return r/s<=Ag}function Cg(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.start<t)return e.slice(0,n+1)}return[]}function Dg(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.end>t)return e.slice(n,e.length)}return[]}function Rg(e,t,n){const i=Math.max(e.start,t),r=Cg(e.cues,t),s={start:e.start,end:i,cues:r},a=Math.min(n,e.end),o=Dg(e.cues,n),l={start:a,end:e.end,cues:o};return[s,l]}const Mg=.001,Lg=5;class Pg{constructor(){this._cuesBuffer=[]}isEmpty(){return 0===this._cuesBuffer.length}get(e){const t=this._cuesBuffer,n=[];for(let i=t.length-1;i>=0;i--){const r=t[i];if(e<r.end&&e>=r.start){const t=r.cues;for(const i of t)e>=i.start&&e<i.end&&n.push(i.element);if(0===n.length&&t.length>0)for(const i of t)(kg(e,i.start,Mg)||kg(e,i.end,Mg))&&n.push(i.element);return n}}return[]}remove(e,t){const n=Math.max(e,t),i=this._cuesBuffer;for(let r=0;r<i.length;r++)if(i[r].end>e){const t=i[r];if(t.start>=n)return;if(t.end>=n){if(e<=t.start)t.cues=Dg(t.cues,n),t.start=n;else{const[s,a]=Rg(t,e,n);this._cuesBuffer[r]=s,i.splice(r+1,0,a)}return}t.start>=e?(i.splice(r,1),r--):(t.cues=Cg(t.cues,e),t.end=Math.max(e,t.start))}}insert(e,t,n){const i=this._cuesBuffer,r={start:t,end:n,cues:e},s=Math.abs(t-n)/Lg;function a(e){const t=i[e];void 0===t||kg(r.end,t.end,s)?i[e]=r:t.start>=r.end?i.splice(e,0,r):(t.cues=Dg(t.cues,r.end),t.start=r.end,i.splice(e,0,r))}for(let o=0;o<i.length;o++){let e=i[o];if(t<e.end){if(Ig(r,e)){if(kg(n,e.end,s))return void(i[o]=r);if(n<e.end)return e.cues=Dg(e.cues,n),e.start=n,void i.splice(o,0,r);do{i.splice(o,1),e=i[o]}while(void 0!==e&&n>e.end);return void a(o)}if(t<e.start){if(n<e.start)return void i.splice(o,0,r);if(kg(n,e.start,s))return e.start=n,void i.splice(o,0,r);if(kg(n,e.end,s))return void i.splice(o,1,r);if(n<e.end)return e.cues=Dg(e.cues,n),e.start=n,void i.splice(o,0,r);do{i.splice(o,1),e=i[o]}while(void 0!==e&&n>e.end);return void a(o)}if(kg(e.end,n,s))return e.cues=Cg(e.cues,t),e.end=t,void i.splice(o+1,0,r);if(e.end>n){const[s,a]=Rg(e,t,n);return this._cuesBuffer[o]=s,i.splice(o+1,0,r),void i.splice(o+2,0,a)}{e.cues=Cg(e.cues,t),e.end=t;const r=o+1;e=i[r];while(void 0!==e&&n>e.end)i.splice(r,1),e=i[r];return void a(r)}}}if(i.length){const e=i[i.length-1];kg(e.end,t,s)&&(e.end=t)}i.push(r)}}function Og(e,t,n,i){const r=[t/n.columns,e/n.rows],s=i.getElementsByClassName("proportional-style");for(let a=0;a<s.length;a++){const e=s[a];if(e instanceof HTMLElement){const t=e.getAttribute("data-proportional-font-size");null===t||isNaN(+t)||(e.style.fontSize=String(+t*r[1])+"px");const n=e.getAttribute("data-proportional-width");null===n||isNaN(+n)||(e.style.width=String(+n*r[0])+"px");const i=e.getAttribute("data-proportional-height");null===i||isNaN(+i)||(e.style.height=String(+i*r[1])+"px");const s=e.getAttribute("data-proportional-line-height");null===s||isNaN(+s)||(e.style.lineHeight=String(+s*r[1])+"px");const a=e.getAttribute("data-proportional-left");null===a||isNaN(+a)||(e.style.left=String(+a*r[0])+"px");const o=e.getAttribute("data-proportional-top");null===o||isNaN(+o)||(e.style.top=String(+o*r[1])+"px");const l=e.getAttribute("data-proportional-padding-top");null===l||isNaN(+l)||(e.style.paddingTop=String(+l*r[1])+"px");const u=e.getAttribute("data-proportional-padding-bottom");null===u||isNaN(+u)||(e.style.paddingBottom=String(+u*r[1])+"px");const c=e.getAttribute("data-proportional-padding-left");null===c||isNaN(+c)||(e.style.paddingLeft=String(+c*r[0])+"px");const d=e.getAttribute("data-proportional-padding-right");null===d||isNaN(+d)||(e.style.paddingRight=String(+d*r[0])+"px")}}return s.length>0}function Ng(e,t){try{e.removeChild(t)}catch(e){V.warn("HTD: Can't remove text track: not in the element.")}}function Ug(e){const t=e.getAttribute("data-resolution-rows"),n=e.getAttribute("data-resolution-columns");if(null===t||null===n)return null;const i=parseInt(t,10),r=parseInt(n,10);return null===i||null===r?null:{rows:i,columns:r}}class Fg{constructor(e,t){V.debug("HTD: Creating HTMLTextDisplayer"),this._buffered=new Wf,this._videoElement=e,this._textTrackElement=t,this._sizeUpdateCanceller=new me,this._subtitlesIntervalCanceller=new me,this._buffer=new Pg,this._currentCues=[],this._isAutoRefreshing=!1}pushTextData(e){var t,n;V.debug("HTD: Appending new html text tracks");const{timestampOffset:i,appendWindow:r,chunk:s}=e;if(null===s)return Q(this._buffered);const{start:a,end:o,data:l,type:u,language:c}=s,d=null!==(t=r[0])&&void 0!==t?t:0,h=null!==(n=r[1])&&void 0!==n?n:1/0,f=Eg(u,l,i,c);if(0!==d&&h!==1/0){let e=0;while(e<f.length&&f[e].end<=d)e++;f.splice(0,e),e=0;while(e<f.length&&f[e].start<d)f[e].start=d,e++;e=f.length-1;while(e>=0&&f[e].start>=h)e--;f.splice(e,f.length),e=f.length-1;while(e>=0&&f[e].end>h)f[e].end=h,e--}let p,g;if(void 0!==a)p=Math.max(d,a);else{if(f.length<=0)return V.warn("HTD: Current text tracks have no cues nor start time. Aborting"),Q(this._buffered);V.warn("HTD: No start time given. Guessing from cues."),p=f[0].start}if(void 0!==o)g=Math.min(h,o);else{if(f.length<=0)return V.warn("HTD: Current text tracks have no cues nor end time. Aborting"),Q(this._buffered);V.warn("HTD: No end time given. Guessing from cues."),g=f[f.length-1].end}return g<=p?(V.warn("HTD: Invalid text track appended: ","the start time is inferior or equal to the end time."),Q(this._buffered)):(this._buffer.insert(f,p,g),this._buffered.insert(p,g),this._isAutoRefreshing||this._buffer.isEmpty()||this.autoRefreshSubtitles(this._subtitlesIntervalCanceller.signal),Q(this._buffered))}removeBuffer(e,t){return V.debug("HTD: Removing html text track data",e,t),this._buffer.remove(e,t),this._buffered.remove(e,t),this._isAutoRefreshing&&this._buffer.isEmpty()&&(this.refreshSubtitles(),this._isAutoRefreshing=!1,this._subtitlesIntervalCanceller.cancel(),this._subtitlesIntervalCanceller=new me),Q(this._buffered)}getBufferedRanges(){return Q(this._buffered)}reset(){V.debug("HTD: Resetting HTMLTextDisplayer"),this.stop(),this._subtitlesIntervalCanceller=new me}stop(){this._subtitlesIntervalCanceller.isUsed()||(V.debug("HTD: Stopping HTMLTextDisplayer"),this._disableCurrentCues(),this._buffer.remove(0,1/0),this._buffered.remove(0,1/0),this._isAutoRefreshing=!1,this._subtitlesIntervalCanceller.cancel())}_disableCurrentCues(){if(this._sizeUpdateCanceller.cancel(),this._currentCues.length>0){for(const e of this._currentCues)Ng(this._textTrackElement,e.element);this._currentCues=[]}}_displayCues(e){const t=this._currentCues.length===e.length&&this._currentCues.every((t,n)=>t.element===e[n]);if(t)return;this._sizeUpdateCanceller.cancel();for(const i of this._currentCues)Ng(this._textTrackElement,i.element);this._currentCues=[];for(const i of e){const e=Ug(i);this._currentCues.push({element:i,resolution:e}),this._textTrackElement.appendChild(i)}const n=this._currentCues.filter(e=>null!==e.resolution);if(n.length>0){this._sizeUpdateCanceller=new me,this._sizeUpdateCanceller.linkToSignal(this._subtitlesIntervalCanceller.signal);const{TEXT_TRACK_SIZE_CHECKS_INTERVAL:e}=N.getCurrent(),t=wg(this._textTrackElement,e,this._sizeUpdateCanceller.signal);t.onUpdate(({height:e,width:t})=>{for(const i of n){const{resolution:n,element:r}=i;Og(e,t,n,r)}},{clearSignal:this._sizeUpdateCanceller.signal,emitCurrentValue:!0})}}autoRefreshSubtitles(e){if(this._isAutoRefreshing||e.isCancelled())return;let t=null;const{MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL:n}=N.getCurrent(),i=()=>{this._isAutoRefreshing=!1,null!==t&&(t.cancel(),t=null)},r=()=>{i(),this._isAutoRefreshing=!0,t=new me,t.linkToSignal(e);const r=setInterval(()=>this.refreshSubtitles(),n);t.signal.register(()=>{clearInterval(r)}),this.refreshSubtitles()};Nr(this._videoElement,()=>{i(),this._disableCurrentCues()},e),Ur(this._videoElement,r,e),Fr(this._videoElement,r,e),r()}refreshSubtitles(){const{MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL:e}=N.getCurrent();let t;t=this._videoElement.paused||this._videoElement.playbackRate<=0?this._videoElement.currentTime:Math.max(this._videoElement.currentTime+e/1e3/2,0);const n=this._buffer.get(t);0===n.length?this._disableCurrentCues():this._displayCues(n)}}var Bg=Fg;function jg(e){return void 0===e.extent&&void 0===e.origin&&void 0===e.displayAlign&&void 0===e.display&&void 0===e.textAlign&&void 0===e.fontSize}function Vg(e){e.extent="70% 20%",e.fontSize="1c",e.origin="15% 80%",e.displayAlign="before",e.textAlign="center"}let Hg;function $g(e,t){if(void 0===Hg&&(Hg=void 0!==e.classList&&"function"===typeof e.classList.add),Hg)e.classList.add(t);else{const n=" "+e.className+" ";n.indexOf(" "+t+" ")<0&&(e.className+=" "+t)}}function Gg(e,t){const n=t.trim();if("auto"===n)return;const i=n.split(" ");if(2!==i.length)return;const r=Tp.exec(i[0]),s=Tp.exec(i[1]);null!==r&&null!==s&&("px"===r[2]||"%"===r[2]||"em"===r[2]?e.style.width=r[1]+r[2]:"c"===r[2]?($g(e,"proportional-style"),e.setAttribute("data-proportional-width",r[1])):V.warn("TTML Parser: unhandled extent unit:",r[2]),"px"===s[2]||"%"===s[2]||"em"===s[2]?e.style.height=s[1]+s[2]:"c"===s[2]?($g(e,"proportional-style"),e.setAttribute("data-proportional-height",s[1])):V.warn("TTML Parser: unhandled extent unit:",s[2]))}function zg(e,t){const n=t.trim(),i=n.split(" ");if(0===i.length)return;const r=Tp.exec(i[0]);if(null!==r)if("px"===r[2]||"em"===r[2])e.style.fontSize=r[1]+r[2];else if("c"===r[2])e.style.position="relative",$g(e,"proportional-style"),e.setAttribute("data-proportional-font-size",r[1]);else if("%"===r[2]){const t=Number(r[1]);isNaN(t)?V.warn('TTML Parser: could not parse fontSize value "'+r[1]+'" into a number'):(e.style.position="relative",$g(e,"proportional-style"),e.setAttribute("data-proportional-font-size",String(t/100)))}else V.warn("TTML Parser: unhandled fontSize unit:",r[2])}function qg(e,t){const n=t.trim(),i=n.split(" ");if("auto"===n)return;const r=Tp.exec(i[0]);null!==r&&("px"===r[2]||"%"===r[2]||"em"===r[2]?e.style.lineHeight=r[1]+r[2]:"c"===r[2]?($g(e,"proportional-style"),e.setAttribute("data-proportional-line-height",r[1])):V.warn("TTML Parser: unhandled lineHeight unit:",r[2]))}function Wg(e,t){const n=t.trim();if("auto"===n)return;const i=n.split(" ");if(2!==i.length)return;const r=Tp.exec(i[0]),s=Tp.exec(i[1]);null!==r&&null!==s&&("px"===r[2]||"%"===r[2]||"em"===r[2]?e.style.left=r[1]+r[2]:"c"===r[2]?($g(e,"proportional-style"),e.setAttribute("data-proportional-left",r[1])):V.warn("TTML Parser: unhandled origin unit:",r[2]),"px"===s[2]||"%"===s[2]||"em"===s[2]?e.style.top=s[1]+s[2]:"c"===s[2]?($g(e,"proportional-style"),e.setAttribute("data-proportional-top",s[1])):V.warn("TTML Parser: unhandled origin unit:",s[2]))}function Kg(e,t){const n=t.trim(),i=n.split(" ");if(i.length<1)return;const r=Tp.exec(i[0]);if(null===r)return;if("px"===r[2]||"%"===r[2]||"em"===r[2]){const t=r[1]+r[2];1===i.length?e.style.padding=t:2===i.length?(e.style.paddingTop=t,e.style.paddingBottom=t):e.style.paddingTop=t}else"c"===r[2]?($g(e,"proportional-style"),1===i.length?(e.setAttribute("data-proportional-padding-top",r[1]),e.setAttribute("data-proportional-padding-bottom",r[1]),e.setAttribute("data-proportional-padding-left",r[1]),e.setAttribute("data-proportional-padding-right",r[1])):2===i.length?(e.setAttribute("data-proportional-padding-top",r[1]),e.setAttribute("data-proportional-padding-bottom",r[1])):e.setAttribute("data-proportional-padding-top",r[1])):V.warn("TTML Parser: unhandled padding unit:",r[2]);if(1===i.length)return;const s=Tp.exec(i[1]);if(null===s)return;if("px"===s[2]||"%"===s[2]||"em"===s[2]){const t=s[1]+s[2];i.length<4?(e.style.paddingLeft=t,e.style.paddingRight=t):e.style.paddingRight=t}else"c"===s[2]?($g(e,"proportional-style"),i.length<4?(e.setAttribute("data-proportional-padding-left",s[1]),e.setAttribute("data-proportional-padding-right",s[1])):e.setAttribute("data-proportional-padding-right",s[1])):V.warn("TTML Parser: unhandled padding unit:",s[2]);if(2===i.length)return;const a=Tp.exec(i[2]);if(null===a)return;if("px"===a[2]||"%"===a[2]||"em"===a[2]){const t=a[1]+a[2];e.style.paddingBottom=t}else"c"===a[2]?($g(e,"proportional-style"),e.setAttribute("data-proportional-padding-bottom",a[1])):V.warn("TTML Parser: unhandled padding unit:",a[2]);if(3===i.length)return;const o=Tp.exec(i[3]);if(null!==o)if("px"===o[2]||"%"===o[2]||"em"===o[2]){const t=o[1]+o[2];e.style.paddingLeft=t}else"c"===o[2]?($g(e,"proportional-style"),e.setAttribute("data-proportional-padding-left",o[1])):V.warn("TTML Parser: unhandled padding unit:",o[2])}function Yg(e,t){let n=t;return Ot(t)&&t.trim().endsWith("%")&&(n=t.trim().slice(0,-1),n=(parseInt(n,10)/100).toString()+"em"),`-1px -1px ${n} ${e},`+`1px -1px ${n} ${e},`+`-1px 1px ${n} ${e},`+`1px 1px ${n} ${e}`}function Xg(e){let t;return t=Sp.exec(e),r(t)?(t=wp.exec(e),r(t)?(t=Ep.exec(e),r(t)?(t=xp.exec(e),r(t)?e:"rgba("+String(+t[1])+","+String(+t[2])+","+String(+t[3])+","+String(+t[4]/255)+")"):"rgb("+String(+t[1])+","+String(+t[2])+","+String(+t[3])+")"):"rgba("+String(parseInt(t[1]+t[1],16))+","+String(parseInt(t[2]+t[2],16))+","+String(parseInt(t[3]+t[3],16))+","+String(parseInt(t[4]+t[4],16)/255)+")"):"rgba("+String(parseInt(t[1],16))+","+String(parseInt(t[2],16))+","+String(parseInt(t[3],16))+","+String(parseInt(t[4],16)/255)+")"}const Qg=["color","direction","display","fontFamily","fontSize","fontStyle","fontWeight","textDecoration","textOutline","unicodeBidi","visibility","wrapOption"];function Zg(e,t,n){const i=t.color;Ot(i)&&(e.style.color=Xg(i));const r=t.backgroundColor;Ot(r)&&(e.style.backgroundColor=Xg(r));const s=t.textOutline;if(Ot(s)){const t=s.trim().replace(/\s+/g," ").split(" "),n=t.length;if(3===n){const n=Xg(t[0]),i=t[1];e.style.textShadow=Yg(n,i)}else if(Ot(i)&&1===n){const n=t[0];e.style.textShadow=Yg(i,n)}else if(2===n){const n=/^[#A-Z]/i.test(t[0]),r=/^[0-9]/.test(t[0]);if(n!==r)if(n){const n=Xg(t[0]),i=t[1];e.style.textShadow=Yg(n,i)}else if(Ot(i)){const n=t[0];e.style.textShadow=Yg(i,n)}}}const a=t.textDecoration;if(Ot(a))switch(a){case"noUnderline":case"noLineThrough":case"noOverline":e.style.textDecoration="none";break;case"lineThrough":e.style.textDecoration="line-through";break;default:e.style.textDecoration=a;break}const o=t.fontFamily;if(Ot(o))switch(o){case"proportionalSansSerif":e.style.fontFamily="Arial, Helvetica, Liberation Sans, sans-serif";break;case"monospaceSansSerif":case"sansSerif":e.style.fontFamily="sans-serif";break;case"monospaceSerif":case"default":e.style.fontFamily="Courier New, Liberation Mono, monospace";break;case"proportionalSerif":e.style.fontFamily="serif";break;default:e.style.fontFamily=o}const l=t.fontStyle;Ot(l)&&(e.style.fontStyle=l);const u=t.fontWeight;Ot(u)&&(e.style.fontWeight=u);const c=t.fontSize;Ot(c)?zg(e,c):($g(e,"proportional-style"),e.setAttribute("data-proportional-font-size","1"));const d=t.direction;Ot(d)&&(e.style.direction=d);const h=t.unicodeBidi;if(Ot(h))switch(h){case"bidiOverride":e.style.unicodeBidi="bidi-override";break;case"embed":e.style.unicodeBidi="embed";break;default:e.style.unicodeBidi="normal"}const f=t.visibility;Ot(f)&&(e.style.visibility=f);const p=t.display;"none"===p&&(e.style.display="none");const g=t.wrapOption;e.style.whiteSpace="noWrap"===g?n?"nowrap":"pre":n?"normal":"pre-wrap"}function Jg(e,t){e.style.color="white",e.style.position="absolute";const n=t.extent;Ot(n)&&Gg(e,n);const i=t.writingMode;Ot(i);const r=t.overflow;e.style.overflow=Ot(r)?r:"hidden";const s=t.padding;Ot(s)&&Kg(e,s);const a=t.origin;Ot(a)&&Wg(e,a);const o=t.displayAlign;if(Ot(o))switch(e.style.display="flex",e.style.flexDirection="column",o){case"before":e.style.justifyContent="flex-start";break;case"center":e.style.justifyContent="center";break;case"after":e.style.justifyContent="flex-end";break}const l=t.opacity;Ot(l)&&(e.style.opacity=l);const u=t.visibility;Ot(u)&&(e.style.visibility=u);const c=t.display;"none"===c&&(e.style.display="none")}function em(e,t){e.style.margin="0px",$g(e,"proportional-style"),e.setAttribute("data-proportional-font-size","1");const n=t.backgroundColor;Ot(n)&&(e.style.backgroundColor=Xg(n));const i=t.lineHeight;Ot(i)&&qg(e,i);const r=t.textAlign;if(Ot(r))switch(r){case"center":e.style.textAlign="center";break;case"left":case"start":e.style.textAlign="left";break;case"right":case"end":e.style.textAlign="right";break}}function tm(e,t,n){const i=document.createElement("span");let r=null===e.textContent?"":e.textContent;if(n){let e=r.trim();e=e.replace(/\s+/g," "),r=e}const s=document.createTextNode(r);return i.appendChild(s),i.className="rxp-texttrack-span",Zg(i,t,n),i}function nm(e,t,n,i,r){function s(e,i,r,a){const o=e.childNodes,l=[];for(let u=0;u<o.length;u++){const e=o[u];if("#text"===e.nodeName){const{backgroundColor:s}=Jf(["backgroundColor"],r,n,t);Ot(s)?i.backgroundColor=s:delete i.backgroundColor;const o=tm(e,i,a);l.push(o)}else if(lp(e)){const e=document.createElement("BR");l.push(e)}else if(up(e)&&e.nodeType===Node.ELEMENT_NODE&&e.childNodes.length>0){const o=e.getAttribute("xml:space"),u=Ot(o)?"default"===o:a,c=R({},i,Jf(Qg,[e],n,t));l.push(...s(e,c,[e,...r],u))}}return l}return s(e,R({},i),[],r)}function im(e,t,n,i,r,{cellResolution:s,shouldTrimWhiteSpace:a}){const o=ip(e),l=document.createElement("DIV");if(l.className="rxp-texttrack-region",l.setAttribute("data-resolution-columns",String(s.columns)),l.setAttribute("data-resolution-rows",String(s.rows)),Jg(l,r),null!==t){const{bodyBackgroundColor:e}=Jf(["backgroundColor"],[...o,t],i,n);Ot(e)&&(l.style.backgroundColor=Xg(e))}const u=document.createElement("p");u.className="rxp-texttrack-p",em(u,r);const c=nm(e,n,i,r,a);for(let d=0;d<c.length;d++)u.appendChild(c[d]);return l.appendChild(u),l}function rm(e){const{paragraph:t,ttParams:n,body:i,regionStyles:r,idStyles:s,paragraphStyle:a,timeOffset:o,shouldTrimWhiteSpace:l}=e;if(!t.hasAttribute("begin")&&!t.hasAttribute("end")&&/^\s*$/.test(null===t.textContent?"":t.textContent))return null;const{cellResolution:u}=n,{start:c,end:d}=Mp(t,n),h=im(t,i,r,s,a,{cellResolution:u,shouldTrimWhiteSpace:l});return{start:c+o,end:d+o,element:h}}function sm(e,t){const n=dp(e,t),i=[];for(let r=0;r<n.length;r++){const{paragraphStyle:e}=n[r];jg(e)&&Vg(e);const t=rm(n[r]);null!==t&&i.push(t)}return i}var am=sm;function om(e){e.htmlTextTracksParsers.ttml=am,e.htmlTextDisplayer=Bg}const lm=/&#([0-9]+);/g,um=/<br>/gi,cm=/<style[^>]*>([\s\S]*?)<\/style[^>]*>/i,dm=/\s*<p (?:class=([^>]+))?>(.*)/i,hm=/<sync[^>]+?start="?([0-9]*)"?[^0-9]/i;function fm(e){const t=/\.(\S+)\s*{([^}]*)}/gi,n={};let i=t.exec(e);while(null!==i){const s=i[1],a=gm(i[2],"lang");r(s)||r(a)||(n[a]=s),i=t.exec(e)}return n}function pm(e){const t=/p\s*{([^}]*)}/gi,n=t.exec(e);return null===n?"":n[1]}function gm(e,t){const n=new RegExp("\\s*"+t+":\\s*(\\S+);","i").exec(e);return Array.isArray(n)?n[1]:null}function mm(e){return e.replace(lm,(e,t)=>String.fromCharCode(Number(t)))}function vm(e,t,n){const i=/<sync[ >]/gi,r=/<sync[ >]|<\/body>/gi,s=[],a=cm.exec(e),o=Array.isArray(a)?a[1]:"";let l,u;r.exec(e);const c=fm(o),d=pm(o);let h;if(Ot(n)&&(h=c[n],void 0===h))throw new Error(`sami: could not find lang ${n} in CSS`);while(1){if(l=i.exec(e),u=r.exec(e),null===l&&null===u)break;if(null===l||null===u||l.index>=u.index)throw new Error("parse error");const t=e.slice(l.index,u.index),n=hm.exec(t);if(!Array.isArray(n))throw new Error("parse error (sync time attribute)");const s=+n[1];if(isNaN(s))throw new Error("parse error (sync time attribute NaN)");f(t.split("\n"),s/1e3)}return s;function f(e,n){let i=e.length;while(--i>=0){const r=dm.exec(e[i]);if(!Array.isArray(r))continue;const[,a,o]=r;if(h===a)if("&nbsp;"===o)s[s.length-1].end=n;else{const e=document.createElement("DIV");e.className="rxp-texttrack-region";const i=document.createElement("DIV");i.className="rxp-texttrack-div",i.style.position="absolute",i.style.bottom="0",i.style.width="100%",i.style.color="#fff",i.style.textShadow="-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000";const r=document.createElement("div");r.className="rxp-texttrack-p",Ot(d)&&(r.style.cssText=d);const a=o.split(um);for(let t=0;t<a.length;t++){0!==t&&r.appendChild(document.createElement("BR"));const e=document.createElement("SPAN");e.className="rxp-texttrack-span",e.textContent=mm(a[t]),r.appendChild(e)}i.appendChild(r),e.appendChild(i),s.push({element:e,start:n+t,end:-1})}}}}var ym=vm;function bm(e){e.htmlTextTracksParsers.sami=ym,e.htmlTextDisplayer=Bg}function _m(e,t){const n=[];for(let i=t;i<e.length;i++)if(eg(e,i)){const t=i;i++;while(Ot(e[i]))i++;const r=e.slice(t,i);n.push(r)}else if(Ot(e[i]))while(Ot(e[i]))i++;return n}const Tm={white:"#ffffff",lime:"#00ff00",cyan:"#00ffff",red:"#ff0000",yellow:"#ffff00",magenta:"#ff00ff",blue:"#0000ff",black:"#000000"};function Sm(){return Object.keys(Tm).reduce((e,t)=>{return e[t]=`color: ${Tm[t]};`,e[`bg_${t}`]=`background-color: ${Tm[t]};`,e},{})}function wm(e){const t=Sm();let n="";return e.forEach(e=>{if(e.length>=2)for(let i=1;i<e.length;i++){let r=e[i];if(Array.isArray(/::cue {/.exec(r))){r=e[++i];while(Ot(r)&&!Array.isArray(/}/.exec(r))&&0!==r.length)n+=r,r=e[++i]}else{const n=[];let s=/::cue\(\.?(.*?)\)(?:,| {)/.exec(r);while(Ot(r)&&Array.isArray(s))n.push(s[1]),r=e[++i],s=/::cue\(\.?(.*?)\)(?:,| {)/.exec(r);let a="";while(Ot(r)&&!Array.isArray(/}/.exec(r))&&0!==r.length)a+=r,r=e[++i];n.forEach(e=>{const n=t[e];void 0===n?t[e]=a:t[e]+=a})}}}),{classes:t,global:n}}function Em(e,t){const n=["u","i","b"],i=["u","i","b","c","#text"],r=e.nodeName.toLowerCase().split(".")[0];let s;if(gt(i,r))if("#text"===r){const t=e.wholeText.split("\n");s=document.createElement("span");for(let e=0;e<t.length;e++)if(e>0&&s.appendChild(document.createElement("br")),t[e].length>0){const n=document.createTextNode(t[e]);s.appendChild(n)}}else{const i=e.nodeName.toLowerCase().split("."),a=[];if(i.forEach(e=>{Ot(t[e])&&a.push(t[e])}),0!==a.length){const e=document.createAttribute("style");a.forEach(t=>{e.value+=t});const t=gt(n,r)?r:"span";s=document.createElement(t),s.setAttributeNode(e)}else{const e=gt(n,r)?r:"span";s=document.createElement(e)}for(let n=0;n<e.childNodes.length;n++){const i=Em(e.childNodes[n],t);s.appendChild(i)}}else{s=document.createElement("span");for(let n=0;n<e.childNodes.length;n++){const i=Em(e.childNodes[n],t);s.appendChild(i)}}return s}function xm(e,t){const n=e.replace(/<[0-9]{2}:[0-9]{2}.[0-9]{3}>/,"").replace(/<([u,i,b,c])(\..*?)?(?: .*?)?>(.*?)<\/\1>/g,"<$1$2>$3</$1$2>"),i=(new DOMParser).parseFromString(n,"text/html"),r=i.body.childNodes,s=[];for(let a=0;a<r.length;a++)s.push(Em(r[a],t));return s}function km(e){const t=document.createAttribute("style");return t.value=Am(e),t}const Am=e=>{const t=void 0!==e&&0!==qe(e).length;if(!t)return"text-align:center";const n=Rm(e),i=Pm(e);return"position: absolute;margin: 0;"+`transform: translate(${n.offset}%,${i.offset}%);`+`width: ${Fm(e.size)}%;`+`left: ${n.position}%;`+`top: ${null!==i.position?`${i.position}%`:"auto"};`+`text-align: ${Um(e.align)};`};var Im,Cm,Dm;(function(e){e["LINE_LEFT"]="line-left",e["CENTER"]="center",e["LINE_RIGHT"]="line-right"})(Im||(Im={})),function(e){e["LEFT"]="left",e["CENTER"]="center",e["RIGHT"]="right"}(Cm||(Cm={})),function(e){e["START"]="start",e["CENTER"]="center",e["END"]="end"}(Dm||(Dm={}));const Rm=e=>{return{position:Mm(e),offset:Lm(e)}},Mm=e=>{const t=jm(e.position);if(null!==t)return t;const n=Um(e.align),i={[Cm.LEFT]:0,[Cm.CENTER]:50,[Cm.RIGHT]:100};return i[n]},Lm=e=>{const t=e=>{const t=/,(line-left|line-right|center)/,n=t.exec(e);return!Array.isArray(n)||n.length<2?null:n[1]},n={[Im.LINE_LEFT]:0,[Im.CENTER]:-50,[Im.LINE_RIGHT]:-100},i=void 0!==e.position?t(e.position):null;if(null!==i)return n[i];const r={[Cm.LEFT]:0,[Cm.CENTER]:-50,[Cm.RIGHT]:-100},s=void 0!==e.align?Um(e.align):Cm.CENTER;return r[s]},Pm=e=>{return{position:Om(e.line),offset:Nm(e.line)}},Om=e=>{return jm(e)},Nm=e=>{const t=e=>{const t=/,(start|center|end)/,n=t.exec(e);return!Array.isArray(n)||n.length<2?null:n[1]},n={[Dm.START]:0,[Dm.CENTER]:-50,[Dm.END]:-100};if(void 0===e)return n[Dm.START];const i=t(e);return null!==i?n[i]:n[Dm.START]},Um=e=>{switch(e){case"left":case"start":return"left";case"right":case"end":return"right";default:return"center"}},Fm=e=>{const t=100;return Bm(e,t)},Bm=(e,t)=>{const n=jm(e);return null!==n?n:t},jm=e=>{if(void 0===e)return null;const t=/^([\d.]+)%/,n=t.exec(e);return!Array.isArray(n)||n.length<2?null:parseInt(n[1],10)};function Vm(e,t){const{start:n,end:i,settings:r,header:s,payload:a}=e,o=document.createElement("div"),l=document.createAttribute("style");l.value="width:100%;height:100%;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;",o.setAttributeNode(l);const u=document.createElement("p"),c=km(r);u.setAttributeNode(c);const d=document.createElement("span"),h=document.createAttribute("style");h.value="background-color:rgba(0,0,0,0.8);color:white;",d.setAttributeNode(h);const{global:f,classes:p}=t,g=Ot(s)?p[s]:void 0,m=[f,g].filter(e=>void 0!==e).join("");return h.value+=m,d.setAttributeNode(h),xm(a.join("\n"),p).forEach(e=>{d.appendChild(e)}),o.appendChild(u),u.appendChild(d),{start:n,end:i,element:o}}function Hm(e,t){const n=/\r\n|\n|\r/g,i=e.split(n),r=[];if(null===/^WEBVTT( |\t|\n|\r|$)/.exec(i[0]))throw new Error("Can't parse WebVTT: Invalid File.");const s=Jp(i),a=_m(i,s),o=sg(i,s),l=wm(a);for(let u=0;u<o.length;u++){const e=ug(o[u],t);if(null!==e){const t=Vm(e,l);r.push(t)}}return r}var $m=Hm;function Gm(e){e.htmlTextTracksParsers.vtt=$m,e.htmlTextDisplayer=Bg}function zm(e,t){const n=e.split(/\r\n|\n|\r/),i=mg(n),r=[];for(let s=0;s<i.length;s++){const e=yg(i[s],t);if(null!==e){const t=qm(e);null!==t&&r.push(t)}}return r}function qm(e){const{start:t,end:n,payload:i}=e,r=document.createElement("div");r.className="rxp-texttrack-p",r.style.fontSize="28px",r.style.position="absolute",r.style.bottom="5%",r.style.width="100%",r.style.textAlign="center",r.style.color="#fff",r.style.textShadow="-1px -1px 2px #000,1px -1px 2px #000,-1px 1px 2px #000,1px 1px 2px #000";for(let s=0;s<i.length;s++){0!==s&&r.appendChild(document.createElement("br"));const e=Wm(i[s]);r.appendChild(e)}return{start:t,end:n,element:r}}function Wm(e){const t=document.createElement("div");t.innerHTML=e;const n=function(e){const t=e.childNodes,i=document.createElement("span");i.className="rxp-texttrack-span";for(let r=0;r<t.length;r++){const e=t[r];if("#text"===e.nodeName){const t=e.wholeText.split("\n");for(let e=0;e<t.length;e++)if(0!==e&&i.appendChild(document.createElement("br")),t[e].length>0){const n=document.createTextNode(t[e]);i.appendChild(n)}}else if("B"===e.nodeName){const t=n(e);t.style.fontWeight="bold",i.appendChild(t)}else if("I"===e.nodeName){const t=n(e);t.style.fontStyle="italic",i.appendChild(t)}else if("U"===e.nodeName){const t=n(e);t.style.textDecoration="underline",i.appendChild(t)}else if(Km(e)&&"string"===typeof e.color){const t=n(e);t.style.color=e.color,i.appendChild(t)}else{const t=n(e);i.appendChild(t)}}return i};return n(t)}function Km(e){return"FONT"===e.nodeName&&"color"in e}function Ym(e){e.htmlTextTracksParsers.srt=zm,e.htmlTextDisplayer=Bg}function Xm(){if(!f)return V.warn("Compat: Can't access Firefox version on no firefox browser."),null;const e=navigator.userAgent,t=/Firefox\/([0-9]+)\./.exec(e);if(null===t)return-1;const n=parseInt(t[1],10);return isNaN(n)?-1:n}function Qm(){if(!f)return!0;const e=Xm();if(null===e||e<67)return!0;const t=null===HTMLVideoElement||void 0===HTMLVideoElement?void 0:HTMLVideoElement.prototype;return void 0!==(null===t||void 0===t?void 0:t.requirePictureInPicture)}function Zm(e){const t=e;if("function"===typeof t.getStartDate){const e=t.getStartDate();if("object"===typeof e&&null!==e){const t=+e;if(!isNaN(t))return t/1e3}else if("number"===typeof e&&!isNaN(e))return e}}const Jm="function"===typeof MediaSource&&!0===MediaSource.canConstructInDedicatedWorker;var ev=Jm;function tv(){return S&&"object"===typeof Worker||"function"===typeof Worker}class nv extends Error{constructor(e,t){super(ot(e,t)),Object.setPrototypeOf(this,nv.prototype),this.name="WorkerInitializationError",this.type="WORKER_INITIALIZATION_ERROR",this.code=e}}function iv(e){for(let t=0;t<e.length;t++){const n=e[t];if("function"===typeof n)n(zt);else{if(r(n)||"function"!==typeof n._addFeature)throw new Error("Unrecognized feature");n._addFeature(zt)}}}const rv=v;var sv=rv;function av(e,t,n){const i=t(e.getReference(),n);return{getCurrentTime(){return e.getCurrentTime()},getReadyState(){return e.getReadyState()},getPlaybackRate(){return e.getPlaybackRate()},getIsPaused(){return e.getIsPaused()},getReference(){return i},listen(e,t){var r;n.isCancelled()||!0===(null===(r=null===t||void 0===t?void 0:t.clearSignal)||void 0===r?void 0:r.isCancelled())||i.onUpdate(e,{clearSignal:null===t||void 0===t?void 0:t.clearSignal,emitCurrentValue:null===t||void 0===t?void 0:t.includeLastObservation})},deriveReadOnlyObserver(e){return av(this,e,n)}}}class ov{constructor(e,t){this._last=e,this._wanted=t}serialize(){return[this._last,this._wanted]}getPolled(){return this._last}getWanted(){var e;return null!==(e=this._wanted)&&void 0!==e?e:this._last}forceWantedPosition(e){this._wanted=e}isAwaitingFuturePosition(){return null!==this._wanted}}const lv=["canplay","ended","play","pause","seeking","seeked","loadedmetadata","ratechange"];class uv{constructor(e,t){this._internalSeeksIncoming=[],this._mediaElement=e,this._withMediaSource=t.withMediaSource,this._lowLatencyMode=t.lowLatencyMode,this._canceller=new me,this._observationRef=this._createSharedReference(),this._expectedSeekingPosition=null,this._pendingSeek=null;const n=()=>{if(null!==this._pendingSeek){const e=this._pendingSeek;this._pendingSeek=null,this._actuallySetCurrentTime(e)}};e.addEventListener("loadedmetadata",n),this._canceller.signal.register(()=>{e.removeEventListener("loadedmetadata",n)})}stop(){this._canceller.cancel()}getCurrentTime(){return this._mediaElement.currentTime}getPlaybackRate(){return this._mediaElement.playbackRate}getIsPaused(){return this._mediaElement.paused}setCurrentTime(e){this._mediaElement.readyState>=1?this._actuallySetCurrentTime(e):(this._internalSeeksIncoming=[],this._pendingSeek=e,this._generateObservationForEvent("manual"))}setPlaybackRate(e){this._mediaElement.playbackRate=e}getReadyState(){return this._mediaElement.readyState}getReference(){return this._observationRef}listen(e,t){var n;if(this._canceller.isUsed()||!0===(null===(n=null===t||void 0===t?void 0:t.clearSignal)||void 0===n?void 0:n.isCancelled()))return U;this._observationRef.onUpdate(e,{clearSignal:null===t||void 0===t?void 0:t.clearSignal,emitCurrentValue:null===t||void 0===t?void 0:t.includeLastObservation})}deriveReadOnlyObserver(e){return av(this,e,this._canceller.signal)}_actuallySetCurrentTime(e){V.info("API: Seeking internally",e),this._internalSeeksIncoming.push(e),this._mediaElement.currentTime=e}_createSharedReference(){if(void 0!==this._observationRef)return this._observationRef;const{SAMPLING_INTERVAL_MEDIASOURCE:e,SAMPLING_INTERVAL_LOW_LATENCY:t,SAMPLING_INTERVAL_NO_MEDIASOURCE:n}=N.getCurrent(),i=new de(this._getCurrentObservation("init"),this._canceller.signal);let r;r=this._lowLatencyMode?t:this._withMediaSource?e:n;const s=()=>{this._generateObservationForEvent("timeupdate")};let a=setInterval(s,r);const o=lv.map(e=>{const t=()=>{l(),this._generateObservationForEvent(e)};return this._mediaElement.addEventListener(e,t),()=>{this._mediaElement.removeEventListener(e,t)}});return this._canceller.signal.register(()=>{clearInterval(a),o.forEach(e=>e()),i.finish()}),i;function l(){clearInterval(a),a=setInterval(s,r)}}_getCurrentObservation(e){var t,n;let i=e;const r=void 0===this._observationRef?mv(this._mediaElement):this._observationRef.getValue();let s=!1,a=this._pendingSeek;const o=hv(this._mediaElement),{buffered:l,readyState:u,position:c,seeking:d}=o;if("seeking"===i)if(this._internalSeeksIncoming.length>0){s=!0,i="internal-seeking";const e=this._internalSeeksIncoming.shift();this._expectedSeekingPosition=sv?Math.max(c,null!==e&&void 0!==e?e:0):c}else this._expectedSeekingPosition=c;else d?this._expectedSeekingPosition=Math.max(c,null!==(t=this._expectedSeekingPosition)&&void 0!==t?t:0):sv&&null!==this._expectedSeekingPosition&&c<this._expectedSeekingPosition?a=this._expectedSeekingPosition:this._expectedSeekingPosition=null;d&&1===r.seeking&&"seeking"!==e&&(s=!0);const h=null!==(n=this._expectedSeekingPosition)&&void 0!==n?n:c;let f,p;!this._withMediaSource&&0===l.length&&u>=3?(f=void 0,p=void 0):(f=Z(l,h),p=null!==f?f.end-h:1/0);const g=fv({previousObservation:r,currentObservation:o,basePosition:h,observationEvent:i,lowLatencyMode:this._lowLatencyMode,withMediaSource:this._withMediaSource,bufferGap:p,currentRange:f}),m=pv(r,o,i,p);let v;v=s?1:d?2:0;const y=R({},o,{position:new ov(o.position,a),event:i,seeking:v,rebuffering:g,freezing:m,bufferGap:p,currentRange:f});return V.hasLevel("DEBUG")&&V.debug("API: current media element state tick","event",y.event,"position",y.position.getPolled(),"seeking",y.seeking,"internalSeek",s,"rebuffering",null!==y.rebuffering,"freezing",null!==y.freezing,"ended",y.ended,"paused",y.paused,"playbackRate",y.playbackRate,"readyState",y.readyState,"pendingPosition",a),y}_generateObservationForEvent(e){const t=this._getCurrentObservation(e);V.hasLevel("DEBUG")&&V.debug("API: current playback timeline:\n"+gv(t.buffered,t.position.getPolled()),`\n${e}`),this._observationRef.setValue(t)}}function cv(e,t){if(null===e)return 0;const n=t?"LOW_LATENCY":"DEFAULT",{RESUME_GAP_AFTER_SEEKING:i,RESUME_GAP_AFTER_NOT_ENOUGH_DATA:r,RESUME_GAP_AFTER_BUFFERING:s}=N.getCurrent();switch(e.reason){case"seeking":return i[n];case"not-ready":return r[n];case"buffering":return s[n]}}function dv(e,t,n,i,r){const{REBUFFERING_GAP:s}=N.getCurrent(),a=r?"LOW_LATENCY":"DEFAULT";return void 0===t?n&&Math.abs(i-e)<=s[a]:null!==t&&i-t.end<=s[a]}function hv(e){const{buffered:t,currentTime:n,duration:i,ended:r,paused:s,playbackRate:a,readyState:o,seeking:l}=e;return{buffered:t,position:n,duration:i,ended:r,paused:s,playbackRate:a,readyState:o,seeking:l}}function fv({previousObservation:e,currentObservation:t,basePosition:n,observationEvent:i,withMediaSource:r,lowLatencyMode:s,bufferGap:a,currentRange:o}){const{REBUFFERING_GAP:l}=N.getCurrent(),{position:u,duration:c,paused:d,readyState:h,ended:f}=t,{rebuffering:p,event:g,position:m}=e,v=dv(n,o,f,c,s),y=h>=1&&"loadedmetadata"!==i&&null===p&&!(v||f);let b,_,T=null;const S=s?l.LOW_LATENCY:l.DEFAULT;if(r){if(y)a===1/0?(b=!0,T=n):void 0===a?h<3&&(b=!0,T=void 0):a<=S&&(b=!0,T=n+a);else if(null!==p){const e=cv(p,s);!0!==b&&null!==p&&h>1&&(v||f||void 0!==a&&isFinite(a)&&a>e)||void 0===a&&h>=3?_=!0:void 0===a?T=void 0:a===1/0?T=n:a<=e&&(T=n+a)}}else y&&(!d&&"timeupdate"===i&&"timeupdate"===g&&u===m.getPolled()||"seeking"===i&&(a===1/0||void 0===a&&h<3))?b=!0:null!==p&&("seeking"!==i&&u!==m.getPolled()||"canplay"===i||void 0===a&&h>=3||void 0!==a&&a<1/0&&(a>cv(p,s)||v||f))&&(_=!0);if(!0===_)return null;if(!0===b||null!==p){let e;return e="seeking"===i||null!==p&&"seeking"===p.reason?"seeking":t.seeking?"seeking":1===h?"not-ready":"buffering",null!==p&&p.reason===e?{reason:p.reason,timestamp:p.timestamp,position:T}:{reason:e,timestamp:Se(),position:T}}return null}function pv(e,t,n,i){const{MINIMUM_BUFFER_AMOUNT_BEFORE_FREEZING:r}=N.getCurrent();return e.freezing?t.ended||t.paused||0===t.readyState||0===t.playbackRate||e.position.getPolled()!==t.position?null:e.freezing:"timeupdate"===n&&void 0!==i&&i>r&&!t.ended&&!t.paused&&t.readyState>=1&&0!==t.playbackRate&&t.position===e.position.getPolled()?{timestamp:Se()}:null}function gv(e,t){let n="",i="";for(let r=0;r<e.length;r++){const s=e.start(r),a=e.end(r),o=s.toFixed(2),l=a.toFixed(2),u=(a-s).toFixed(2),c=`${o}|==${u}==|${l}`;if(n+=c,0===i.length&&a>t){const e=n.length-Math.floor(c.length/2);i=" ".repeat(e)+`^${t}`}if(r<e.length-1){const s=e.start(r+1),o=(s-a).toFixed(2),l=` ~${o}~ `;if(n+=l,0===i.length&&t<s){const e=n.length-Math.floor(l.length/2);i=" ".repeat(e)+`^${t}`}}}return 0===i.length&&(i=" ".repeat(n.length)+`^${t}`),n+"\n"+i}function mv(e){const t=hv(e);return R(t,{rebuffering:null,event:"init",seeking:0,position:new ov(t.position,null),freezing:null,bufferGap:0,currentRange:null})}async function vv(e){const t=ar.getState(e);if(null===t)return;V.info("DRM: Disposing of the current MediaKeys");const{loadedSessionsStore:n}=t;return ar.clearState(e),await n.closeAllSessions(),Ah(t.emeImplementation,e,null)}function yv(){return d}function bv(e){if(V.info("DRM: Clearing-up DRM session."),yv())return V.info("DRM: disposing current MediaKeys."),vv(e);const t=ar.getState(e);return null!==t&&!0===t.keySystemOptions.closeSessionsOnStop?(V.info("DRM: closing all current sessions."),t.loadedSessionsStore.closeAllSessions()):(V.info("DRM: Nothing to clear. Returning right away. No state =",null===t),Promise.resolve())}class _v extends s{constructor(e){super(),this._canceller=new me,this._adaptationRef=e,this._updateToken=!1,this.refresh=U}start(e){if(this._updateToken=!0,null===e)return this._lastEmitted=null,this._updateToken=!1,void this._adaptationRef.setValue(null);const t=this._constructLockedRepresentationsReference(e);this._updateToken&&(this._lastEmitted={adaptation:e.adaptation,switchingMode:e.switchingMode,lockedRepresentations:null},this._updateToken=!1,this._adaptationRef.setValue({adaptationId:e.adaptation.id,switchingMode:e.switchingMode,representations:t,relativeResumingPosition:void 0}))}updateTrack(e){if(this._updateToken=!0,null===e){if(null===this._lastEmitted)return;return this._updateToken=!1,this._canceller.cancel(),this._canceller=new me,this._lastEmitted=null,void this._adaptationRef.setValue(null)}const{adaptation:t,switchingMode:n,relativeResumingPosition:i}=e;this._canceller.cancel(),this._canceller=new me;const r=this._constructLockedRepresentationsReference(e);this._updateToken&&(this._lastEmitted={adaptation:t,switchingMode:n,lockedRepresentations:null},this._updateToken=!1,this._adaptationRef.setValue({adaptationId:t.id,switchingMode:n,representations:r,relativeResumingPosition:i}))}_constructLockedRepresentationsReference(e){const t=new de({representationIds:[],switchingMode:"lazy"}),n=this;return this.refresh=i,this._canceller.signal.register(r),e.lockedRepresentations.onUpdate(i,{clearSignal:this._canceller.signal,emitCurrentValue:!1}),i(),t;function i(){const i=e.lockedRepresentations.getValue();let r,s;if(null===i)s=e.adaptation.representations.filter(e=>{return!0===e.isSupported&&!1!==e.decipherable}),r="lazy";else{const{representationIds:t}=i;r=i.switchingMode;const a=e.adaptation.representations.filter(e=>gt(t,e.id));if(s=a.filter(e=>!0===e.isSupported&&!1!==e.decipherable),0===s.length)return void n.trigger("noPlayableLockedRepresentation",null)}if(s.length<=0)return e.adaptation.isSupported=!1,void n.trigger("noPlayableRepresentation",null);const a=t.getValue(),o=s.map(e=>e.id).slice().sort();if(o.length===a.representationIds.length){for(let e=0;e<o.length;e++)if(a.representationIds[e]!==o[e])return void t.setValue({representationIds:o,switchingMode:r})}else t.setValue({representationIds:o,switchingMode:r})}function r(){n.refresh=U}}dispose(){this.removeEventListener(),this._canceller.cancel(),this._adaptationRef.finish()}}class Tv extends s{constructor(e){var t;super(),this._storedPeriodInfo=[],this._isDisposed=!1,this._cachedPeriodInfo=new WeakMap,this._isTrickModeTrackEnabled=e.preferTrickModeTracks,this._defaultAudioTrackSwitchingMode=null!==(t=e.defaultAudioTrackSwitchingMode)&&void 0!==t?t:N.getCurrent().DEFAULT_AUDIO_TRACK_SWITCHING_MODE}getAvailablePeriods(){return this._storedPeriodInfo.reduce((e,t)=>{return t.isPeriodAdvertised&&e.push(Av(t.period)),e},[])}onManifestUpdate(e){var t,n,i,r,s,a;const{DEFAULT_VIDEO_TRACK_SWITCHING_MODE:o}=N.getCurrent(),{periods:l}=e;const u=[];let c=0;for(let d=0;d<this._storedPeriodInfo.length;d++){const e=this._storedPeriodInfo[d].period,r=l[c];if(void 0===r)for(let t=this._storedPeriodInfo.length-1;t>=d;t--)this._storedPeriodInfo[t].inManifest=!1,Ev(this._storedPeriodInfo[t])&&this._removePeriodObject(t);else if(e===r){c++;const e=this._storedPeriodInfo[d].text.storedSettings;if(null!==e){const n=wt(r,"text"),i=n.some(t=>t.id===e.adaptation.id);if(!i){V.warn("TS: Chosen text Adaptation not available anymore");const e=this._storedPeriodInfo[d];if(e.text.storedSettings=null,this.trigger("trackUpdate",{period:Av(r),trackType:"text",reason:"missing"}),this._isDisposed)return;const n=wv(this._storedPeriodInfo,e.period.id);void 0!==n&&null===n.text.storedSettings&&(null===(t=n.text.dispatcher)||void 0===t||t.updateTrack(null))}}const s=this._storedPeriodInfo[d].video.storedSettings;if(null!==s){const e=wt(r,"video"),t=e.some(e=>e.id===s.adaptation.id);if(!t){V.warn("TS: Chosen video Adaptation not available anymore");const t=this._storedPeriodInfo[d];let i;if(0===e.length)i=null;else{const t=e[0],n=xv(t,this._isTrickModeTrackEnabled),r=new de(null);i={adaptationBase:t,adaptation:n,switchingMode:o,lockedRepresentations:r}}if(t.video.storedSettings=i,this.trigger("trackUpdate",{period:Av(r),trackType:"video",reason:"missing"}),this._isDisposed)return;const s=wv(this._storedPeriodInfo,t.period.id);void 0!==s&&s.video.storedSettings===i&&(null===(n=s.video.dispatcher)||void 0===n||n.updateTrack(i))}}const a=this._storedPeriodInfo[d].audio.storedSettings;if(null!==a){const e=wt(r,"audio"),t=e.some(e=>e.id===a.adaptation.id);if(!t){V.warn("TS: Chosen audio Adaptation not available anymore");const t=this._storedPeriodInfo[d],n=0===e.length?null:{adaptation:e[0],switchingMode:this._defaultAudioTrackSwitchingMode,lockedRepresentations:new de(null)};if(t.audio.storedSettings=n,this.trigger("trackUpdate",{period:Av(r),trackType:"audio",reason:"missing"}),this._isDisposed)return;const s=wv(this._storedPeriodInfo,t.period.id);void 0!==s&&s.audio.storedSettings===n&&(null===(i=s.audio.dispatcher)||void 0===i||i.updateTrack(n))}}}else if(e.start<=r.start)this._storedPeriodInfo[d].inManifest=!1,Ev(this._storedPeriodInfo[d])&&(this._removePeriodObject(d),d--);else{const e=kv(r,!0,this._isTrickModeTrackEnabled,this._defaultAudioTrackSwitchingMode);this._storedPeriodInfo.splice(d,0,e),u.push(e),c++}}if(c<l.length){const e=l.slice(c).map(e=>kv(e,!0,this._isTrickModeTrackEnabled,this._defaultAudioTrackSwitchingMode));this._storedPeriodInfo.push(...e),u.push(...e)}for(const d of this._storedPeriodInfo)null===(r=d.audio.dispatcher)||void 0===r||r.refresh(),null===(s=d.video.dispatcher)||void 0===s||s.refresh(),null===(a=d.text.dispatcher)||void 0===a||a.refresh()}onDecipherabilityUpdates(){var e,t,n;for(const i of this._storedPeriodInfo)null===(e=i.audio.dispatcher)||void 0===e||e.refresh(),null===(t=i.video.dispatcher)||void 0===t||t.refresh(),null===(n=i.text.dispatcher)||void 0===n||n.refresh()}addTrackReference(e,t,n){let i=wv(this._storedPeriodInfo,t.id);if(void 0===i){i=kv(t,!1,this._isTrickModeTrackEnabled,this._defaultAudioTrackSwitchingMode);let e=!1;for(let n=0;n<this._storedPeriodInfo.length;n++)this._storedPeriodInfo[n].period.start>t.start&&(this._storedPeriodInfo.splice(n,0,i),e=!0);e||this._storedPeriodInfo.push(i)}if(!i.isPeriodAdvertised&&(i.isPeriodAdvertised=!0,this.trigger("newAvailablePeriods",[{id:t.id,start:t.start,end:t.end}]),this._isDisposed))return;if(null!==i[e].dispatcher)return void V.error(`TS: Subject already added for ${e} `+`and Period ${t.start}`);const s=i[e].storedSettings,a=new _v(n);i[e].dispatcher=a,a.addEventListener("noPlayableRepresentation",()=>{var n,i,s,a;const o=De(null!==(n=t.adaptations[e])&&void 0!==n?n:[],e=>{if(!1===e.isSupported)return!1;const t=e.representations.filter(e=>!0===e.isSupported&&!1!==e.decipherable);return t.length>0});if(void 0===o){const t=new ut("NO_PLAYABLE_REPRESENTATION",`No ${e} Representation can be played`,{tracks:void 0});return this.trigger("error",t),void this.dispose()}let l=null===(i=wv(this._storedPeriodInfo,t.id))||void 0===i?void 0:i[e];if(r(l))return;const u="audio"===e?this._defaultAudioTrackSwitchingMode:"reload",c={adaptation:o,switchingMode:u,lockedRepresentations:new de(null)};l.storedSettings=c,this.trigger("trackUpdate",{period:Av(t),trackType:e,reason:"no-playable-representation"}),this._isDisposed||(l=null===(s=wv(this._storedPeriodInfo,t.id))||void 0===s?void 0:s[e],r(l)||l.storedSettings!==c||null===(a=l.dispatcher)||void 0===a||a.updateTrack(c))}),a.addEventListener("noPlayableLockedRepresentation",()=>{null===s||void 0===s||s.lockedRepresentations.setValue(null),this.trigger("brokenRepresentationsLock",{period:{id:t.id,start:t.start,end:t.end},trackType:e})}),a.start(s)}removeTrackReference(e,t){const n=Sv(this._storedPeriodInfo,t);if(void 0===n)return void V.warn(`TS: ${e} not found for period`,t.start);const i=this._storedPeriodInfo[n],r=i[e];null!==(null===r||void 0===r?void 0:r.dispatcher)?(r.dispatcher.dispose(),r.dispatcher=null,Ev(i)&&this._removePeriodObject(n)):V.warn(`TS: TrackDispatcher already removed for ${e} `+`and Period ${t.start}`)}getPeriodObjectFromPeriod(e){const t=wv(this._storedPeriodInfo,e.id);return void 0===t&&void 0!==e?this._cachedPeriodInfo.get(e):t}getPeriodObjectFromId(e){return wv(this._storedPeriodInfo,e)}disableVideoTrickModeTracks(){this._isTrickModeTrackEnabled&&(this._isTrickModeTrackEnabled=!1,this._resetVideoTrackChoices("trickmode-disabled"))}enableVideoTrickModeTracks(){this._isTrickModeTrackEnabled||(this._isTrickModeTrackEnabled=!0,this._resetVideoTrackChoices("trickmode-enabled"))}resetPeriodObjects(){var e,t,n;for(let i=this._storedPeriodInfo.length-1;i>=0;i--){const r=this._storedPeriodInfo[i];null===(e=r.audio.dispatcher)||void 0===e||e.dispose(),r.audio.dispatcher=null,null===(t=r.video.dispatcher)||void 0===t||t.dispose(),r.video.dispatcher=null,null===(n=r.text.dispatcher)||void 0===n||n.dispose(),r.text.dispatcher=null,r.inManifest||this._removePeriodObject(i)}}isTrickModeEnabled(){return this._isTrickModeTrackEnabled}setAudioTrack(e){const{periodRef:t,trackId:n,switchingMode:i,lockedRepresentations:r,relativeResumingPosition:s}=e;return this._setAudioOrTextTrack({bufferType:"audio",periodRef:t,trackId:n,switchingMode:null!==i&&void 0!==i?i:this._defaultAudioTrackSwitchingMode,lockedRepresentations:r,relativeResumingPosition:s})}setTextTrack(e,t){return this._setAudioOrTextTrack({bufferType:"text",periodRef:e,trackId:t,switchingMode:"direct",lockedRepresentations:null,relativeResumingPosition:void 0})}_setAudioOrTextTrack({bufferType:e,periodRef:t,trackId:n,switchingMode:i,lockedRepresentations:r,relativeResumingPosition:s}){var a,o;const l=t.period,u=De(null!==(a=l.adaptations[e])&&void 0!==a?a:[],({id:e,isSupported:t})=>!0===t&&e===n);if(void 0===u)throw new Error(`Wanted ${e} track not found.`);const c=t[e];let d;if(null===r)d=new de(null);else{const t=this._getRepresentationsToLock(u,r),n="audio"===e?this._defaultAudioTrackSwitchingMode:"direct";d=new de({representationIds:t,switchingMode:n})}const h={adaptation:u,switchingMode:i,lockedRepresentations:d,relativeResumingPosition:s};if(c.storedSettings=h,this.trigger("trackUpdate",{period:Av(l),trackType:e,reason:"manual"}),this._isDisposed)return;const f=wv(this._storedPeriodInfo,l.id);void 0!==f&&f[e].storedSettings===h&&(null===(o=f[e].dispatcher)||void 0===o||o.updateTrack(h))}setVideoTrack(e){var t,n;const{periodRef:i,trackId:r,switchingMode:s,lockedRepresentations:a,relativeResumingPosition:o}=e,l=i.period,u=De(null!==(t=l.adaptations.video)&&void 0!==t?t:[],({id:e,isSupported:t})=>!0===t&&e===r);if(void 0===u)throw new Error("Wanted video track not found.");const{DEFAULT_VIDEO_TRACK_SWITCHING_MODE:c}=N.getCurrent(),d=i.video,h=xv(u,this._isTrickModeTrackEnabled);let f;if(null===a)f=new de(null);else{const e=this._getRepresentationsToLock(u,a),t=c;f=new de({representationIds:e,switchingMode:t})}const p={adaptationBase:u,switchingMode:null!==s&&void 0!==s?s:c,adaptation:h,relativeResumingPosition:o,lockedRepresentations:f};if(d.storedSettings=p,this.trigger("trackUpdate",{period:Av(l),trackType:"video",reason:"manual"}),this._isDisposed)return;const g=wv(this._storedPeriodInfo,l.id);void 0!==g&&g.video.storedSettings===p&&(null===(n=g.video.dispatcher)||void 0===n||n.updateTrack(p))}disableTrack(e,t){var n,i;const r=e[t];if(null===r.storedSettings)return;if("text"!==t&&(null===(n=e[t].storedSettings)||void 0===n||n.lockedRepresentations.finish()),r.storedSettings=null,this.trigger("trackUpdate",{period:Av(e.period),trackType:t,reason:"manual"}),this._isDisposed)return;const s=wv(this._storedPeriodInfo,e.period.id);void 0!==s&&null===s[t].storedSettings&&(null===(i=s[t].dispatcher)||void 0===i||i.updateTrack(null))}getChosenAudioTrack(e){return null===e.audio.storedSettings?null:It(e.audio.storedSettings.adaptation,!0)}getChosenTextTrack(e){return null===e.text.storedSettings?null:Ct(e.text.storedSettings.adaptation)}getChosenVideoTrack(e){return null===e.video.storedSettings?null:Dt(e.video.storedSettings.adaptation,!0)}getAvailableAudioTracks(e){const t=e.audio.storedSettings,n=null!==t?t.adaptation.id:null,i=wt(e.period,"audio");return i.map(e=>{const t=null!==n&&n===e.id;return R(It(e,!0),{active:t})})}getAvailableTextTracks(e){const t=e.text.storedSettings,n=null!==t?t.adaptation.id:null,i=wt(e.period,"text");return i.map(e=>{const t=null!==n&&n===e.id;return R(Ct(e),{active:t})})}getAvailableVideoTracks(e){const t=e.video.storedSettings,n=null===t?void 0:t.adaptation.id,i=wt(e.period,"video");return i.map(e=>{const t=null!==n&&n===e.id,i=Dt(e,!0),r=void 0!==i.trickModeTracks?i.trickModeTracks.map(e=>{const t=null!==n&&n===e.id;return R(e,{active:t})}):[],s=R(i,{active:t});return void 0!==r&&(s.trickModeTracks=r),s})}getLockedAudioRepresentations(e){const{storedSettings:t}=e.audio;if(null===t)return null;const n=t.lockedRepresentations.getValue();return null===n?null:n.representationIds}getLockedVideoRepresentations(e){const{storedSettings:t}=e.video;if(null===t)return null;const n=t.lockedRepresentations.getValue();return null===n?null:n.representationIds}lockAudioRepresentations(e,t){var n;const{storedSettings:i}=e.audio;if(null===i)return;const{DEFAULT_AUDIO_REPRESENTATIONS_SWITCHING_MODE:r}=N.getCurrent(),s=this._getRepresentationsToLock(i.adaptation,t.representations),a=null!==(n=t.switchingMode)&&void 0!==n?n:r;i.lockedRepresentations.setValue({representationIds:s,switchingMode:a})}lockVideoRepresentations(e,t){var n;const{storedSettings:i}=e.video;if(null===i)return;const{DEFAULT_VIDEO_REPRESENTATIONS_SWITCHING_MODE:r}=N.getCurrent(),s=this._getRepresentationsToLock(i.adaptation,t.representations),a=null!==(n=t.switchingMode)&&void 0!==n?n:r;i.lockedRepresentations.setValue({representationIds:s,switchingMode:a})}unlockAudioRepresentations(e){const{storedSettings:t}=e.audio;null!==t&&null!==t.lockedRepresentations.getValue()&&t.lockedRepresentations.setValue(null)}unlockVideoRepresentations(e){const{storedSettings:t}=e.video;null!==t&&null!==t.lockedRepresentations.getValue()&&t.lockedRepresentations.setValue(null)}dispose(){this._isDisposed=!0;while(1){const e=this._storedPeriodInfo.pop();if(void 0===e)return;e.isRemoved=!0}}_resetVideoTrackChoices(e){var t;for(let i=0;i<this._storedPeriodInfo.length;i++){const e=this._storedPeriodInfo[i];if(null!==e.video.storedSettings){const t=e.video.storedSettings.adaptationBase;if(null!==t){const n=xv(t,this._isTrickModeTrackEnabled);e.video.storedSettings.adaptationBase=t,e.video.storedSettings.adaptation=n}}}const n=this._storedPeriodInfo.slice();for(let i=0;i<n.length;i++){const r=n[i].period,s=n[i].video,a=s.storedSettings;if(this.trigger("trackUpdate",{period:Av(r),trackType:"video",reason:e}),this._isDisposed)return;const o=wv(this._storedPeriodInfo,r.id);void 0!==o&&o.video.storedSettings===a&&(null===(t=o.video.dispatcher)||void 0===t||t.updateTrack(a))}}_removePeriodObject(e){const t=this._storedPeriodInfo[e];this._storedPeriodInfo[e].isRemoved=!0,this._storedPeriodInfo.splice(e,1),this._cachedPeriodInfo.set(t.period,t)}_getRepresentationsToLock(e,t){const n=t.reduce((t,n)=>{const i=De(e.representations,e=>{return e.id===n});return void 0===i?V.warn("API: Wanted locked Representation not found."):t.push(i.id),t},[]);if(0===n.length)throw new Error("Cannot lock Representations: None of the given Representation id are found");return n}}function Sv(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.period.id===t.id)return n}}function wv(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.period.id===t)return i}}function Ev(e){var t,n,i;return!e.inManifest&&null===(null===(t=e.text)||void 0===t?void 0:t.dispatcher)&&null===(null===(n=e.audio)||void 0===n?void 0:n.dispatcher)&&null===(null===(i=e.video)||void 0===i?void 0:i.dispatcher)}function xv(e,t){var n;return t&&void 0!==(null===(n=e.trickModeTracks)||void 0===n?void 0:n[0])?e.trickModeTracks[0]:e}function kv(e,t,n,i){var r,s;const a=wt(e,"audio")[0],o=wt(e,"video")[0],l=xv(o,n),{DEFAULT_VIDEO_TRACK_SWITCHING_MODE:u}=N.getCurrent(),c=void 0!==a?{adaptation:a,switchingMode:i,lockedRepresentations:new de(null)}:null,d=void 0!==l?{adaptation:l,adaptationBase:o,switchingMode:u,lockedRepresentations:new de(null)}:null;let h=null;const f=(null!==(r=e.adaptations.text)&&void 0!==r?r:[]).filter(e=>!0===e.isForcedSubtitles);if(f.length>0){if(null!==a&&void 0!==a){const e=De(f,e=>e.normalizedLanguage===a.normalizedLanguage);void 0!==e&&(h=e)}null===h&&(h=null!==(s=De(f,e=>void 0===e.normalizedLanguage))&&void 0!==s?s:null)}let p=null;return null!==h&&(p={adaptation:h,switchingMode:"direct",lockedRepresentations:new de(null)}),{period:e,inManifest:t,isPeriodAdvertised:!1,isRemoved:!1,audio:{storedSettings:c,dispatcher:null},video:{storedSettings:d,dispatcher:null},text:{storedSettings:p,dispatcher:null}}}function Av(e){return{start:e.start,end:e.end,id:e.id}}var Iv=Tv;function Cv(e){let t,n,i,s,a,o;const{DEFAULT_BASE_BANDWIDTH:l,DEFAULT_VIDEO_RESOLUTION_LIMIT:u,DEFAULT_MAX_BUFFER_AHEAD:c,DEFAULT_MAX_BUFFER_BEHIND:d,DEFAULT_MAX_VIDEO_BUFFER_SIZE:h,DEFAULT_THROTTLE_VIDEO_BITRATE_WHEN_HIDDEN:f,DEFAULT_WANTED_BUFFER_AHEAD:p}=N.getCurrent();if(r(e.maxBufferAhead))t=c;else if(t=Number(e.maxBufferAhead),isNaN(t))throw new Error("Invalid maxBufferAhead parameter. Should be a number.");if(r(e.maxBufferBehind))n=d;else if(n=Number(e.maxBufferBehind),isNaN(n))throw new Error("Invalid maxBufferBehind parameter. Should be a number.");if(r(e.wantedBufferAhead))i=p;else if(i=Number(e.wantedBufferAhead),isNaN(i))throw new Error("Invalid wantedBufferAhead parameter. Should be a number.");if(r(e.maxVideoBufferSize))s=h;else if(s=Number(e.maxVideoBufferSize),isNaN(s))throw new Error("Invalid maxVideoBufferSize parameter. Should be a number.");const g=r(e.videoResolutionLimit)?u:e.videoResolutionLimit,m=r(e.throttleVideoBitrateWhenHidden)?f:!!e.throttleVideoBitrateWhenHidden;if(r(e.videoElement))a=document.createElement("video");else{if(!(e.videoElement instanceof HTMLMediaElement))throw new Error("Invalid videoElement parameter. Should be a HTMLMediaElement.");a=e.videoElement}if(r(e.baseBandwidth))o=l;else if(o=Number(e.baseBandwidth),isNaN(o))throw new Error("Invalid baseBandwidth parameter. Should be a number.");return{maxBufferAhead:t,maxBufferBehind:n,videoResolutionLimit:g,videoElement:a,wantedBufferAhead:i,maxVideoBufferSize:s,throttleVideoBitrateWhenHidden:m,baseBandwidth:o}}function Dv(e){var t,n,i,r;if(null===e||"object"!==typeof e&&void 0!==e)throw new Error("API: reload - Invalid options format.");if(null===(null===e||void 0===e?void 0:e.reloadAt)||"object"!==typeof(null===e||void 0===e?void 0:e.reloadAt)&&void 0!==(null===e||void 0===e?void 0:e.reloadAt))throw new Error("API: reload - Invalid 'reloadAt' option format.");if("number"!==typeof(null===(t=null===e||void 0===e?void 0:e.reloadAt)||void 0===t?void 0:t.position)&&void 0!==(null===(n=null===e||void 0===e?void 0:e.reloadAt)||void 0===n?void 0:n.position))throw new Error("API: reload - Invalid 'reloadAt.position' option format.");if("number"!==typeof(null===(i=null===e||void 0===e?void 0:e.reloadAt)||void 0===i?void 0:i.relative)&&void 0!==(null===(r=null===e||void 0===e?void 0:e.reloadAt)||void 0===r?void 0:r.relative))throw new Error("API: reload - Invalid 'reloadAt.relative' option format.");if(!Array.isArray(null===e||void 0===e?void 0:e.keySystems)&&void 0!==(null===e||void 0===e?void 0:e.keySystems))throw new Error("API: reload - Invalid 'keySystems' option format.");if(void 0!==(null===e||void 0===e?void 0:e.autoPlay)&&"boolean"!==typeof e.autoPlay)throw new Error("API: reload - Invalid 'autoPlay' option format.")}function Rv(e){var t,n,i;let s,a,o,l,u,c,d;const{DEFAULT_AUTO_PLAY:h,DEFAULT_CODEC_SWITCHING_BEHAVIOR:f,DEFAULT_ENABLE_FAST_SWITCHING:p,DEFAULT_TEXT_TRACK_MODE:g}=N.getCurrent();if(r(e))throw new Error("No option set on loadVideo");if(r(e.url)){if(r(e.initialManifest)&&r(e.manifestLoader))throw new Error("Unable to load a content: no url set on loadVideo.\nPlease provide at least either an `url` argument, a `initialManifest` option or a `manifestLoader` option so the RxPlayer can load the content.")}else s=String(e.url);if(r(e.transport))throw new Error("No transport set on loadVideo");a=String(e.transport);const m=r(e.autoPlay)?h:!!e.autoPlay;if(r(e.keySystems))o=[];else{o=Array.isArray(e.keySystems)?e.keySystems:[e.keySystems];for(const e of o)if("string"!==typeof e.type||"function"!==typeof e.getLicense)throw new Error("Invalid key system given: Missing type string or getLicense callback")}const v=void 0!==e.lowLatencyMode&&!!e.lowLatencyMode,y=e.initialManifest,b=null!==(t=e.minimumManifestUpdateInterval)&&void 0!==t?t:0;let _=null!==(n=e.defaultAudioTrackSwitchingMode)&&void 0!==n?n:void 0;void 0===_||gt(["seamless","direct","reload"],_)||(V.warn("The `defaultAudioTrackSwitchingMode` loadVideo option must match one of the following strategy name:\n- `seamless`\n- `direct`\n- `reload`"),_=void 0);let T=r(e.onCodecSwitch)?f:e.onCodecSwitch;if(gt(["continue","reload"],T)||(V.warn("The `onCodecSwitch` loadVideo option must match one of the following string:\n- `continue`\n- `reload`\nIf badly set, "+f+" will be used as default"),T=f),r(e.textTrackMode))l=g;else{if("native"!==e.textTrackMode&&"html"!==e.textTrackMode)throw new Error("Invalid textTrackMode.");l=e.textTrackMode}if("html"===l){if(r(e.textTrackElement))throw new Error('You have to provide a textTrackElement in "html" textTrackMode.');if(!(e.textTrackElement instanceof HTMLElement))throw new Error("textTrackElement should be an HTMLElement.");c=e.textTrackElement}else r(e.textTrackElement)||V.warn('API: You have set a textTrackElement without being in an "html" textTrackMode. It will be ignored.');if(r(e.mode))u="auto";else{if(!gt(["auto","multithread","main"],e.mode))throw new Error("Invalid `mode` option.");u=e.mode}const S=r(e.enableFastSwitching)?p:e.enableFastSwitching;if(!r(e.startAt))if("wallClockTime"in e.startAt&&e.startAt.wallClockTime instanceof Date){const t=e.startAt.wallClockTime.getTime()/1e3;d=R({},e.startAt,{wallClockTime:t})}else d=e.startAt;const w=null!==(i=e.requestConfig)&&void 0!==i?i:{};return{__priv_patchLastSegmentInSidx:e.__priv_patchLastSegmentInSidx,__priv_manifestUpdateUrl:e.__priv_manifestUpdateUrl,checkMediaSegmentIntegrity:e.checkMediaSegmentIntegrity,autoPlay:m,defaultAudioTrackSwitchingMode:_,enableFastSwitching:S,initialManifest:y,keySystems:o,lowLatencyMode:v,manifestLoader:e.manifestLoader,minimumManifestUpdateInterval:b,requestConfig:w,onCodecSwitch:T,referenceDateTime:e.referenceDateTime,representationFilter:e.representationFilter,segmentLoader:e.segmentLoader,serverSyncInfos:e.serverSyncInfos,startAt:d,textTrackElement:c,textTrackMode:l,transport:a,mode:u,url:s}}function Mv(e,t,n,i,r){if(r.isCancelled()||null===e)return;let s=2===t.getReference().getValue().seeking;s&&(n(),r.isCancelled())||t.listen(e=>{"seeking"===e.event?(s=!0,n()):s&&"seeked"===e.event&&(s=!1,i())},{includeLastObservation:!0,clearSignal:r})}function Lv(e,t,n,i){i.isCancelled()||null===e||(e.addEventListener("play",t),e.addEventListener("pause",n),i.register(()=>{e.removeEventListener("play",t),e.removeEventListener("pause",n)}))}function Pv(e,t,n,i){const r=new de("LOADING",i);e.addEventListener("loaded",()=>{if("LOADING"===r.getValue()){if(r.setValue("LOADED"),!i.isCancelled()){const e=Ov(t,null);"PAUSED"!==e&&r.setValue(e)}}else"RELOADING"===r.getValue()?r.setValue(Ov(t,null)):a(null)},i),e.addEventListener("reloadingMediaSource",()=>{Nv(r.getValue())&&r.setValueIfChanged("RELOADING")},i);let s=null;return e.addEventListener("stalled",e=>{e!==s&&(a(e),s=e)},i),e.addEventListener("unstalled",()=>{null!==s&&(a(null),s=null)},i),n.listen(e=>{gt(["seeking","ended","play","pause"],e.event)&&a(s)},{clearSignal:i}),r;function a(e){if(!Nv(r.getValue()))return;const n=Ov(t,e),i=r.getValue();"LOADED"===i&&"PAUSED"===n||r.setValueIfChanged(n)}}function Ov(e,t){const{FORCED_ENDED_THRESHOLD:n}=N.getCurrent();if(e.ended)return"ENDED";if(null!==t){const i=Math.abs(e.duration-e.currentTime);return!r(n)&&i<n?"ENDED":"seeking"===t?"SEEKING":"freezing"===t?"FREEZING":"BUFFERING"}return e.paused?"PAUSED":"PLAYING"}function Nv(e){return"LOADING"!==e&&"RELOADING"!==e&&"STOPPED"!==e}const Uv=pt(),Fv=["manifestLoader","segmentLoader"];class Bv extends s{static get ErrorTypes(){return st}static get ErrorCodes(){return at}static get LogLevel(){return V.getLevel()}static set LogLevel(e){V.setLevel(e)}static addFeatures(e){iv(e)}static _priv_registerVideoElement(e){if(Bv._priv_currentlyUsedVideoElements.has(e)){const e="The video element is already attached to another RxPlayer instance.\nMake sure to dispose the previous instance with player.dispose() before creating a new player instance attaching that video element.";console.warn(e)}Bv._priv_currentlyUsedVideoElements.add(e)}static _priv_deregisterVideoElement(e){Bv._priv_currentlyUsedVideoElements.has(e)&&Bv._priv_currentlyUsedVideoElements.delete(e)}constructor(e={}){super();const{baseBandwidth:t,videoResolutionLimit:n,maxBufferAhead:i,maxBufferBehind:r,throttleVideoBitrateWhenHidden:s,videoElement:a,wantedBufferAhead:o,maxVideoBufferSize:l}=Cv(e);a.preload="auto",this.version="4.1.0",this.log=V,this.state="STOPPED",this.videoElement=a,Bv._priv_registerVideoElement(this.videoElement);const u=new me;this._destroyCanceller=u,this._priv_pictureInPictureRef=wr(a,u.signal),this._priv_speed=new de(a.playbackRate,this._destroyCanceller.signal),this._priv_preferTrickModeTracks=!1,this._priv_contentLock=new de(!1,this._destroyCanceller.signal),this._priv_bufferOptions={wantedBufferAhead:new de(o,this._destroyCanceller.signal),maxBufferAhead:new de(i,this._destroyCanceller.signal),maxBufferBehind:new de(r,this._destroyCanceller.signal),maxVideoBufferSize:new de(l,this._destroyCanceller.signal)},this._priv_bitrateInfos={lastBitrates:{audio:t,video:t}},this._priv_throttleVideoBitrateWhenHidden=s,this._priv_videoResolutionLimit=n,this._priv_currentError=null,this._priv_contentInfos=null,this._priv_contentEventsMemory={},this._priv_reloadingMetadata={},this._priv_lastAutoPlay=!1,this._priv_worker=null,this._priv_segmentSinkMetricsCallback=null;const c=()=>{this.trigger("volumeChange",{volume:a.volume,muted:a.muted})};a.addEventListener("volumechange",c),u.signal.register(()=>{a.removeEventListener("volumechange",c)})}attachWorker(e){return new Promise((t,n)=>{var r;if(!tv())return V.warn("API: Cannot rely on a WebWorker: Worker API unavailable"),n(new nv("INCOMPATIBLE_ERROR","Worker unavailable"));if("string"===typeof e.workerUrl)this._priv_worker=new Worker(e.workerUrl);else{const t=URL.createObjectURL(e.workerUrl);this._priv_worker=new Worker(t),URL.revokeObjectURL(t)}this._priv_worker.onerror=(e=>{null!==this._priv_worker&&(this._priv_worker.terminate(),this._priv_worker=null),V.error("API: Unexpected worker error",e.error instanceof Error?e.error:void 0),n(new nv("UNKNOWN_ERROR",'Unexpected Worker "error" event'))});const s=e=>{const i=e.data;"init-error"===i.type?(V.warn("API: Processing InitError worker message: detaching worker"),null!==this._priv_worker&&(this._priv_worker.removeEventListener("message",s),this._priv_worker.terminate(),this._priv_worker=null),n(new nv("SETUP_ERROR","Worker parser initialization failed: "+i.value.errorMessage))):"init-success"===i.type&&(V.info("API: InitSuccess received from worker."),null!==this._priv_worker&&this._priv_worker.removeEventListener("message",s),t())};this._priv_worker.addEventListener("message",s),V.debug("---\x3e Sending To Worker:","init"),this._priv_worker.postMessage({type:"init",value:{dashWasmUrl:e.dashWasmUrl,logLevel:V.getLevel(),sendBackLogs:i(),date:Date.now(),timestamp:Se(),hasVideo:"video"===(null===(r=this.videoElement)||void 0===r?void 0:r.nodeName.toLowerCase()),hasMseInWorker:ev}}),V.addEventListener("onLogLevelChange",e=>{null!==this._priv_worker&&(V.debug("---\x3e Sending To Worker:","log-level-update"),this._priv_worker.postMessage({type:"log-level-update",value:{logLevel:e,sendBackLogs:i()}}))},this._destroyCanceller.signal)})}getCurrentModeInformation(){return null===this._priv_contentInfos?null:{isDirectFile:this._priv_contentInfos.isDirectFile,useWorker:this._priv_contentInfos.useWorker}}addEventListener(e,t){return super.addEventListener(e,t)}stop(){null!==this._priv_contentInfos&&this._priv_contentInfos.currentContentCanceller.cancel(),this._priv_cleanUpCurrentContentState(),"STOPPED"!==this.state&&this._priv_setPlayerState("STOPPED")}dispose(){this.stop(),null!==this.videoElement&&(Bv._priv_deregisterVideoElement(this.videoElement),vv(this.videoElement).catch(e=>{const t=e instanceof Error?e.message:"Unknown error";V.error("API: Could not dispose decryption resources: "+t)})),this._destroyCanceller.cancel(),this._priv_reloadingMetadata={},this.videoElement=null,null!==this._priv_worker&&(this._priv_worker.terminate(),this._priv_worker=null)}loadVideo(e){const t=Rv(e);V.info("API: Calling loadvideo",t.url,t.transport),this._priv_reloadingMetadata={options:t},this._priv_initializeContentPlayback(t),this._priv_lastAutoPlay=t.autoPlay}reload(e){var t,n,i;const{options:r,manifest:s,reloadPosition:a,reloadInPause:o}=this._priv_reloadingMetadata;if(void 0===r)throw new Error("API: Can't reload without having previously loaded a content.");let l,u,c;if(Dv(e),void 0!==(null===(t=null===e||void 0===e?void 0:e.reloadAt)||void 0===t?void 0:t.position))l={position:e.reloadAt.position};else if(void 0!==(null===(n=null===e||void 0===e?void 0:e.reloadAt)||void 0===n?void 0:n.relative)){if(void 0===a)throw new Error("Can't reload to a relative position when previous content was not loaded.");l={position:e.reloadAt.relative+a}}else void 0!==a&&(l={position:a});void 0!==(null===e||void 0===e?void 0:e.autoPlay)?u=e.autoPlay:void 0!==o&&(u=!o),void 0!==(null===e||void 0===e?void 0:e.keySystems)?c=e.keySystems:void 0!==(null===(i=this._priv_reloadingMetadata.options)||void 0===i?void 0:i.keySystems)&&(c=this._priv_reloadingMetadata.options.keySystems);const d=Object.assign(Object.assign({},r),{initialManifest:s});void 0!==l&&(d.startAt=l),void 0!==u&&(d.autoPlay=u),void 0!==c&&(d.keySystems=c),this._priv_initializeContentPlayback(d)}createDebugElement(e){if(null===qt.createDebugElement)throw new Error("Feature `DEBUG_ELEMENT` not added to the RxPlayer");const t=new me;return qt.createDebugElement(e,this,t.signal),{dispose(){t.cancel()}}}_priv_initializeContentPlayback(e){var t,n,i,s,a,o;const{autoPlay:l,defaultAudioTrackSwitchingMode:u,enableFastSwitching:c,initialManifest:d,keySystems:h,lowLatencyMode:f,minimumManifestUpdateInterval:p,requestConfig:g,onCodecSwitch:m,startAt:v,transport:y,checkMediaSegmentIntegrity:b,manifestLoader:_,referenceDateTime:T,segmentLoader:S,serverSyncInfos:w,mode:E,__priv_manifestUpdateUrl:x,__priv_patchLastSegmentInSidx:k,url:A}=e;if(null===this.videoElement)throw new Error("the attached video element is disposed");const I="directfile"===y,C=new me,D=this.videoElement;let M,L=!1,P=null;if(I){if(null===qt.directfile)throw this.stop(),this._priv_currentError=null,new Error("DirectFile feature not activated in your build.");if(r(A))throw new Error("No URL for a DirectFile content");if(V.info("API: Initializing DirectFile mode in the main thread"),P=this._priv_initializeMediaElementTracksStore(C.signal),C.isUsed())return;M=new qt.directfile.initDirectFile({autoPlay:l,keySystems:h,speed:this._priv_speed,startAt:v,url:A})}else{const u={lowLatencyMode:f,maxRetry:null===(t=g.manifest)||void 0===t?void 0:t.maxRetry,requestTimeout:null===(n=g.manifest)||void 0===n?void 0:n.timeout,connectionTimeout:null===(i=g.manifest)||void 0===i?void 0:i.connectionTimeout,minimumManifestUpdateInterval:p,initialManifest:d},I=Qm(),P={throttleBitrate:{},limitResolution:{}};this._priv_throttleVideoBitrateWhenHidden&&(I?P.throttleBitrate={video:ce(Er(this._priv_pictureInPictureRef,C.signal),e=>e?1/0:0,C.signal)}:V.warn("API: Can't apply throttleVideoBitrateWhenHidden because browser can't be trusted for visibility.")),"videoElement"===this._priv_videoResolutionLimit?I?P.limitResolution={video:kr(D,this._priv_pictureInPictureRef,C.signal)}:V.warn("API: Can't apply videoResolutionLimit because browser can't be trusted for video size."):"screen"===this._priv_videoResolutionLimit&&(P.limitResolution={video:xr(C.signal)});const O={initialBitrates:this._priv_bitrateInfos.lastBitrates,lowLatencyMode:f,throttlers:P},N="native"===e.textTrackMode?{textTrackMode:"native"}:{textTrackMode:"html",textTrackElement:e.textTrackElement},U=R({enableFastSwitching:c,onCodecSwitch:m},this._priv_bufferOptions),F={lowLatencyMode:f,maxRetry:null===(s=g.segment)||void 0===s?void 0:s.maxRetry,requestTimeout:null===(a=g.segment)||void 0===a?void 0:a.timeout,connectionTimeout:null===(o=g.segment)||void 0===o?void 0:o.connectionTimeout},B=null!==qt.multithread&&null!==this._priv_worker&&"dash"===y&&Fv.every(t=>r(e[t]))&&"function"!==typeof e.representationFilter;if("main"===E||"auto"===E&&!B){if(null===qt.mainThreadMediaSourceInit)throw new Error("Cannot load video, neither in a WebWorker nor with the `MEDIA_SOURCE_MAIN` feature");const t=qt.transports[y];if("function"!==typeof t)throw this.stop(),this._priv_currentError=null,new Error(`transport "${y}" not supported`);const n="string"===typeof e.representationFilter?Pt(e.representationFilter):e.representationFilter;V.info("API: Initializing MediaSource mode in the main thread");const i=t({lowLatencyMode:f,checkMediaSegmentIntegrity:b,manifestLoader:_,referenceDateTime:T,representationFilter:n,segmentLoader:S,serverSyncInfos:w,__priv_manifestUpdateUrl:x,__priv_patchLastSegmentInSidx:k});M=new qt.mainThreadMediaSourceInit({adaptiveOptions:O,autoPlay:l,bufferOptions:U,keySystems:h,lowLatencyMode:f,transport:i,manifestRequestSettings:u,segmentRequestOptions:F,speed:this._priv_speed,startAt:v,textTrackOptions:N,url:A})}else{if(null===qt.multithread)throw new Error("Cannot load video in multithread mode: `MULTI_THREAD` feature not imported.");if(null===this._priv_worker)throw new Error("Cannot load video in multithread mode: `attachWorker` method not called.");fe("function"!==typeof e.representationFilter),L=!0,V.info("API: Initializing MediaSource mode in a WebWorker");const t={lowLatencyMode:f,checkMediaSegmentIntegrity:b,referenceDateTime:T,serverSyncInfos:w,manifestLoader:void 0,segmentLoader:void 0,representationFilter:e.representationFilter,__priv_manifestUpdateUrl:x,__priv_patchLastSegmentInSidx:k};M=new qt.multithread.init({adaptiveOptions:O,autoPlay:l,bufferOptions:U,keySystems:h,lowLatencyMode:f,transportOptions:t,manifestRequestSettings:u,segmentRequestOptions:F,speed:this._priv_speed,startAt:v,textTrackOptions:N,worker:this._priv_worker,url:A})}}const O={contentId:Uv(),originalUrl:A,currentContentCanceller:C,defaultAudioTrackSwitchingMode:u,initializer:M,isDirectFile:I,manifest:null,currentPeriod:null,activeAdaptations:null,activeRepresentations:null,tracksStore:null,mediaElementTracksStore:P,useWorker:L};M.addEventListener("error",e=>{this._priv_onFatalError(e,O)}),M.addEventListener("warning",e=>{const t=ft(e,{defaultCode:"NONE",defaultReason:"An unknown error happened."});V.warn("API: Sending warning:",t),this.trigger("warning",t)}),M.addEventListener("reloadingMediaSource",e=>{null!==O.tracksStore&&O.tracksStore.resetPeriodObjects(),this._priv_segmentSinkMetricsCallback=null,this._priv_lastAutoPlay=e.autoPlay}),M.addEventListener("inbandEvents",e=>this.trigger("inbandEvents",e)),M.addEventListener("streamEvent",e=>this.trigger("streamEvent",e)),M.addEventListener("streamEventSkip",e=>this.trigger("streamEventSkip",e)),M.addEventListener("activePeriodChanged",e=>this._priv_onActivePeriodChanged(O,e)),M.addEventListener("periodStreamReady",e=>this._priv_onPeriodStreamReady(O,e)),M.addEventListener("periodStreamCleared",e=>this._priv_onPeriodStreamCleared(O,e)),M.addEventListener("representationChange",e=>this._priv_onRepresentationChange(O,e)),M.addEventListener("adaptationChange",e=>this._priv_onAdaptationChange(O,e)),M.addEventListener("bitrateEstimateChange",e=>this._priv_onBitrateEstimateChange(e)),M.addEventListener("manifestReady",e=>this._priv_onManifestReady(O,e)),M.addEventListener("manifestUpdate",e=>this._priv_onManifestUpdate(O,e)),M.addEventListener("decipherabilityUpdate",e=>this._priv_onDecipherabilityUpdate(O,e)),M.addEventListener("loaded",e=>{this._priv_segmentSinkMetricsCallback=e.getSegmentSinkMetrics}),M.prepare(),this.stop();const N=new uv(D,{withMediaSource:!I,lowLatencyMode:f});C.signal.register(()=>{N.stop()});const U=Pv(M,D,N,C.signal);C.signal.register(()=>{M.dispose()});const F=e=>{switch(e){case"STOPPED":case"RELOADING":case"LOADING":break;case"ENDED":this._priv_reloadingMetadata.reloadInPause=!0,this._priv_reloadingMetadata.reloadPosition=N.getReference().getValue().position.getPolled();break;default:const t=N.getReference().getValue();this._priv_reloadingMetadata.reloadInPause=t.paused,this._priv_reloadingMetadata.reloadPosition=t.position.getWanted();break}};let B=null;const j=e=>{null!==B&&(B.cancel(),B=null),U.onUpdate((t,n)=>{Nv(t)&&(n(),null!==B&&B.cancel(),B=new me,B.linkToSignal(C.signal),e!==!D.paused&&(D.paused?this.trigger("pause",null):this.trigger("play",null)),Lv(D,()=>this.trigger("play",null),()=>this.trigger("pause",null),C.signal))},{emitCurrentValue:!1,clearSignal:C.signal})};j(l),M.addEventListener("reloadingMediaSource",e=>{j(e.autoPlay)}),this._priv_currentError=null,this._priv_contentInfos=O;let H=null;U.onUpdate(e=>{F(e),this._priv_setPlayerState(e),C.isUsed()||(null!==H?Nv(this.state)||(H.cancel(),H=null):Nv(this.state)&&(H=new me,H.linkToSignal(C.signal),Mv(D,N,()=>this.trigger("seeking",null),()=>this.trigger("seeked",null),H.signal)))},{emitCurrentValue:!0,clearSignal:C.signal}),N.listen(e=>{F(this.state),this._priv_triggerPositionUpdate(O,e)},{clearSignal:C.signal}),C.signal.register(()=>{M.removeEventListener()}),this._priv_contentLock.onUpdate((e,t)=>{e||(t(),M.start(D,N))},{emitCurrentValue:!0,clearSignal:C.signal})}getError(){return this._priv_currentError}getVideoElement(){return this.videoElement}getPlayerState(){return this.state}isContentLoaded(){return!gt(["LOADING","RELOADING","STOPPED"],this.state)}isBuffering(){return gt(["BUFFERING","SEEKING","LOADING","RELOADING"],this.state)}isPaused(){return!this.videoElement||(gt(["LOADING","RELOADING"],this.state)?!this._priv_lastAutoPlay:this.videoElement.paused)}isLive(){if(null===this._priv_contentInfos)return!1;const{isDirectFile:e,manifest:t}=this._priv_contentInfos;return!e&&null!==t&&t.isLive}areTrickModeTracksEnabled(){return this._priv_preferTrickModeTracks}getContentUrls(){if(null===this._priv_contentInfos)return;const{isDirectFile:e,manifest:t,originalUrl:n}=this._priv_contentInfos;return e?void 0===n?void 0:[n]:null!==t?t.uris:void 0}updateContentUrls(e,t){if(null===this._priv_contentInfos)throw new Error("No content loaded");const n=!0===(null===t||void 0===t?void 0:t.refresh);this._priv_contentInfos.initializer.updateContentUrls(e,n)}getMediaDuration(){if(null===this.videoElement)throw new Error("Disposed player");return this.videoElement.duration}getCurrentBufferGap(){if(null===this.videoElement)throw new Error("Disposed player");const e=this.videoElement,t=ne(e.buffered,e.currentTime);return t===1/0?0:t}getWallClockTime(){if(null===this.videoElement)throw new Error("Disposed player");if(null===this._priv_contentInfos)return this.videoElement.currentTime;const{isDirectFile:e,manifest:t}=this._priv_contentInfos;if(e){const e=Zm(this.videoElement);return(null!==e&&void 0!==e?e:0)+this.videoElement.currentTime}if(null!==t){const e=this.videoElement.currentTime,n=void 0!==t.availabilityStartTime?t.availabilityStartTime:0;return e+n}return 0}getPosition(){if(null===this.videoElement)throw new Error("Disposed player");return this.videoElement.currentTime}getLastStoredContentPosition(){return this._priv_reloadingMetadata.reloadPosition}getPlaybackRate(){return this._priv_speed.getValue()}setPlaybackRate(e,t){var n;e!==this._priv_speed.getValue()&&this._priv_speed.setValue(e);const i=null===t||void 0===t?void 0:t.preferTrickModeTracks;if("boolean"!==typeof i)return;this._priv_preferTrickModeTracks=i;const s=null===(n=this._priv_contentInfos)||void 0===n?void 0:n.tracksStore;r(s)||(i&&!s.isTrickModeEnabled()?s.enableVideoTrickModeTracks():!i&&s.isTrickModeEnabled()&&s.disableVideoTrickModeTracks())}getVideoRepresentation(){const e=this.__priv_getCurrentRepresentations();if(null!==e)return e.video}getAudioRepresentation(){const e=this.__priv_getCurrentRepresentations();if(null!==e)return e.audio}play(){if(null===this.videoElement)throw new Error("Disposed player");const e=this.videoElement.play();return r(e)||"function"!==typeof e.catch?Promise.resolve():e.catch(e=>{if("NotAllowedError"===e.name){const t=new ut("MEDIA_ERR_PLAY_NOT_ALLOWED",e.toString());this.trigger("warning",t)}throw e})}pause(){if(null===this.videoElement)throw new Error("Disposed player");this.videoElement.pause()}seekTo(e){var t;if(null===this.videoElement)throw new Error("Disposed player");if(null===this._priv_contentInfos)throw new Error("player: no content loaded");const{isDirectFile:n,manifest:i}=this._priv_contentInfos;if(!n&&null===i)throw new Error("player: the content did not load yet");let s;if("number"===typeof e)s=e;else if("object"===typeof e){const a=e,o=this.videoElement.currentTime;if(r(a.relative))if(r(a.position)){if(r(a.wallClockTime))throw new Error('invalid time object. You must set one of the following properties: "relative", "position" or "wallClockTime"');if(null!==i)s=a.wallClockTime-(null!==(t=i.availabilityStartTime)&&void 0!==t?t:0);else if(n&&null!==this.videoElement){const e=Zm(this.videoElement);void 0!==e&&(s=a.wallClockTime-e)}void 0===s&&(s=a.wallClockTime)}else s=a.position;else s=o+a.relative}if(void 0===s)throw new Error("invalid time given");return V.info("API: API Seek to",s),this.videoElement.currentTime=s,s}getVolume(){if(null===this.videoElement)throw new Error("Disposed player");return this.videoElement.volume}setVolume(e){if(null===this.videoElement)throw new Error("Disposed player");const t=this.videoElement;e!==t.volume&&(t.volume=e)}isMute(){var e;return!0===(null===(e=this.videoElement)||void 0===e?void 0:e.muted)}mute(){if(null===this.videoElement)throw new Error("Disposed player");this.videoElement.muted||(this.videoElement.muted=!0)}unMute(){if(null===this.videoElement)throw new Error("Disposed player");this.videoElement.muted&&(this.videoElement.muted=!1)}setMaxBufferBehind(e){this._priv_bufferOptions.maxBufferBehind.setValue(e)}setMaxBufferAhead(e){this._priv_bufferOptions.maxBufferAhead.setValue(e)}setWantedBufferAhead(e){this._priv_bufferOptions.wantedBufferAhead.setValue(e)}setMaxVideoBufferSize(e){this._priv_bufferOptions.maxVideoBufferSize.setValue(e)}getMaxBufferBehind(){return this._priv_bufferOptions.maxBufferBehind.getValue()}getMaxBufferAhead(){return this._priv_bufferOptions.maxBufferAhead.getValue()}getWantedBufferAhead(){return this._priv_bufferOptions.wantedBufferAhead.getValue()}getMaxVideoBufferSize(){return this._priv_bufferOptions.maxVideoBufferSize.getValue()}getCurrentPeriod(){var e;const t=null===(e=this._priv_contentInfos)||void 0===e?void 0:e.currentPeriod;return r(t)?null:{id:t.id,start:t.start,end:t.end}}getKeySystemConfiguration(){if(null===this.videoElement)throw new Error("Disposed player");const e=or(this.videoElement);return null===e?null:{keySystem:e[0],configuration:e[1]}}getAvailablePeriods(){if(null===this._priv_contentInfos)return[];const{isDirectFile:e,tracksStore:t}=this._priv_contentInfos;return e?[]:null===t?[]:t.getAvailablePeriods().slice()}getAvailableAudioTracks(e){var t;if(null===this._priv_contentInfos)return[];const{isDirectFile:n,mediaElementTracksStore:i}=this._priv_contentInfos;return n?null!==(t=null===i||void 0===i?void 0:i.getAvailableAudioTracks())&&void 0!==t?t:[]:this._priv_callTracksStoreGetterSetter(e,[],(e,t)=>{var n;return null!==(n=e.getAvailableAudioTracks(t))&&void 0!==n?n:[]})}getAvailableTextTracks(e){var t;if(null===this._priv_contentInfos)return[];const{isDirectFile:n,mediaElementTracksStore:i}=this._priv_contentInfos;return n?null!==(t=null===i||void 0===i?void 0:i.getAvailableTextTracks())&&void 0!==t?t:[]:this._priv_callTracksStoreGetterSetter(e,[],(e,t)=>{var n;return null!==(n=e.getAvailableTextTracks(t))&&void 0!==n?n:[]})}getAvailableVideoTracks(e){var t;if(null===this._priv_contentInfos)return[];const{isDirectFile:n,mediaElementTracksStore:i}=this._priv_contentInfos;return n?null!==(t=null===i||void 0===i?void 0:i.getAvailableVideoTracks())&&void 0!==t?t:[]:this._priv_callTracksStoreGetterSetter(e,[],(e,t)=>{var n;return null!==(n=e.getAvailableVideoTracks(t))&&void 0!==n?n:[]})}getAudioTrack(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;if(t){if(null===n)return;return n.getChosenAudioTrack()}return this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.getChosenAudioTrack(t))}getTextTrack(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;if(t){if(null===n)return;return n.getChosenTextTrack()}return this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.getChosenTextTrack(t))}getVideoTrack(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;if(t){if(null===n)return;return n.getChosenVideoTrack()}return this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.getChosenVideoTrack(t))}setAudioTrack(e){var t;if(null===this._priv_contentInfos)throw new Error("No content loaded");const{isDirectFile:n,mediaElementTracksStore:i}=this._priv_contentInfos;if(n)try{const t="string"===typeof e?e:e.trackId;return void(null===i||void 0===i||i.setAudioTrackById(t))}catch(e){throw new Error("player: unknown audio track")}let r,s,a,o,l=null;return"string"===typeof e?s=e:(s=e.trackId,r=e.periodId,a=e.switchingMode,l=null!==(t=e.lockedRepresentations)&&void 0!==t?t:null,o=e.relativeResumingPosition),this._priv_callTracksStoreGetterSetter(r,void 0,(e,t)=>e.setAudioTrack({periodRef:t,trackId:s,switchingMode:a,lockedRepresentations:l,relativeResumingPosition:o}))}setTextTrack(e){if(null===this._priv_contentInfos)throw new Error("No content loaded");const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;if(t)try{const t="string"===typeof e?e:e.trackId;return void(null===n||void 0===n||n.setTextTrackById(t))}catch(e){throw new Error("player: unknown text track")}let i,r;return"string"===typeof e?r=e:(r=e.trackId,i=e.periodId),this._priv_callTracksStoreGetterSetter(i,void 0,(e,t)=>e.setTextTrack(t,r))}disableTextTrack(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;if(!t)return this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.disableTrack(t,"text"));null===n||void 0===n||n.disableTextTrack()}setVideoTrack(e){var t;if(null===this._priv_contentInfos)throw new Error("No content loaded");const{isDirectFile:n,mediaElementTracksStore:i}=this._priv_contentInfos;if(n)try{const t="string"===typeof e?e:e.trackId;return void(null===i||void 0===i||i.setVideoTrackById(t))}catch(e){throw new Error("player: unknown video track")}let r,s,a,o,l=null;return"string"===typeof e?s=e:(s=e.trackId,r=e.periodId,a=e.switchingMode,l=null!==(t=e.lockedRepresentations)&&void 0!==t?t:null,o=e.relativeResumingPosition),this._priv_callTracksStoreGetterSetter(r,void 0,(e,t)=>e.setVideoTrack({periodRef:t,trackId:s,switchingMode:a,lockedRepresentations:l,relativeResumingPosition:o}))}disableVideoTrack(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t,mediaElementTracksStore:n}=this._priv_contentInfos;return t&&null!==n?n.disableVideoTrack():this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.disableTrack(t,"video"))}lockVideoRepresentations(e){if(null===this._priv_contentInfos)throw new Error("No content loaded");const{isDirectFile:t}=this._priv_contentInfos;if(t)throw new Error("Cannot lock video Representations in directfile mode.");let n,i,r;return Array.isArray(e)?(n=e,i=void 0):(n=e.representations,i=e.periodId,r=e.switchingMode),this._priv_callTracksStoreGetterSetter(i,void 0,(e,t)=>e.lockVideoRepresentations(t,{representations:n,switchingMode:r}))}lockAudioRepresentations(e){if(null===this._priv_contentInfos)throw new Error("No content loaded");const{isDirectFile:t}=this._priv_contentInfos;if(t)throw new Error("Cannot lock audio Representations in directfile mode.");let n,i,r;return Array.isArray(e)?(n=e,i=void 0):(n=e.representations,i=e.periodId,r=e.switchingMode),this._priv_callTracksStoreGetterSetter(i,void 0,(e,t)=>e.lockAudioRepresentations(t,{representations:n,switchingMode:r}))}getLockedVideoRepresentations(e){if(null===this._priv_contentInfos)return null;const{isDirectFile:t}=this._priv_contentInfos;return t?null:this._priv_callTracksStoreGetterSetter(e,null,(e,t)=>e.getLockedVideoRepresentations(t))}getLockedAudioRepresentations(e){if(null===this._priv_contentInfos)return null;const{isDirectFile:t}=this._priv_contentInfos;return t?null:this._priv_callTracksStoreGetterSetter(e,null,(e,t)=>e.getLockedAudioRepresentations(t))}unlockVideoRepresentations(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t}=this._priv_contentInfos;return t?void 0:this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.unlockVideoRepresentations(t))}unlockAudioRepresentations(e){if(null===this._priv_contentInfos)return;const{isDirectFile:t}=this._priv_contentInfos;return t?void 0:this._priv_callTracksStoreGetterSetter(e,void 0,(e,t)=>e.unlockAudioRepresentations(t))}getMinimumPosition(){if(null===this._priv_contentInfos)return null;if(this._priv_contentInfos.isDirectFile)return 0;const{manifest:e}=this._priv_contentInfos;return null!==e?_t(e):null}getLivePosition(){if(null===this._priv_contentInfos)return null;const{isDirectFile:e,manifest:t}=this._priv_contentInfos;return e?void 0:!0!==(null===t||void 0===t?void 0:t.isLive)?null:Tt(t)}getMaximumPosition(){if(null===this._priv_contentInfos)return null;const{isDirectFile:e,manifest:t}=this._priv_contentInfos;if(e){if(null===this.videoElement)throw new Error("Disposed player");return this.videoElement.duration}return null!==t?t.isDynamic||null===this.videoElement?St(t):this.videoElement.duration:null}async __priv_getSegmentSinkMetrics(){return null===this._priv_segmentSinkMetricsCallback?void 0:this._priv_segmentSinkMetricsCallback()}__priv_getManifest(){return null===this._priv_contentInfos?null:this._priv_contentInfos.manifest}__priv_getCurrentAdaptation(){if(null===this._priv_contentInfos)return null;const{currentPeriod:e,activeAdaptations:t}=this._priv_contentInfos;return null===e||null===t||r(t[e.id])?null:t[e.id]}__priv_getCurrentRepresentations(){if(null===this._priv_contentInfos)return null;const{currentPeriod:e,activeRepresentations:t}=this._priv_contentInfos;return null===e||null===t||r(t[e.id])?null:t[e.id]}_priv_cleanUpCurrentContentState(){var e,t,n,i;V.debug("Locking `contentLock` to clean-up the current content."),this._priv_contentLock.setValue(!0),null===(t=null===(e=this._priv_contentInfos)||void 0===e?void 0:e.tracksStore)||void 0===t||t.dispose(),null===(i=null===(n=this._priv_contentInfos)||void 0===n?void 0:n.mediaElementTracksStore)||void 0===i||i.dispose(),this._priv_contentInfos=null,this._priv_segmentSinkMetricsCallback=null,this._priv_contentEventsMemory={};const s=()=>{null!==this.videoElement&&(V.debug("Unlocking `contentLock`. Next content can begin."),this._priv_contentLock.setValue(!1))};r(this.videoElement)?s():bv(this.videoElement).then(()=>{V.debug("API: DRM session cleaned-up with success!"),s()},e=>{V.error("API: An error arised when trying to clean-up the DRM session:"+(e instanceof Error?e.toString():"Unknown Error")),s()})}_priv_onManifestReady(e,t){var n;if(e.contentId!==(null===(n=this._priv_contentInfos)||void 0===n?void 0:n.contentId))return;e.manifest=t,0===t.manifestFormat&&(this._priv_reloadingMetadata.manifest=t);const i=new Iv({preferTrickModeTracks:this._priv_preferTrickModeTracks,defaultAudioTrackSwitchingMode:e.defaultAudioTrackSwitchingMode});e.tracksStore=i,i.addEventListener("newAvailablePeriods",e=>{this.trigger("newAvailablePeriods",e)}),i.addEventListener("brokenRepresentationsLock",e=>{this.trigger("brokenRepresentationsLock",e)}),i.addEventListener("trackUpdate",e=>{var t,n;this.trigger("trackUpdate",e);const i=null!==(n=null===(t=this._priv_contentInfos)||void 0===t?void 0:t.currentPeriod)&&void 0!==n?n:void 0;"no-playable-representation"===e.reason&&e.period.id===(null===i||void 0===i?void 0:i.id)&&this._priv_onAvailableTracksMayHaveChanged(e.trackType)}),e.tracksStore.addEventListener("warning",e=>{this.trigger("warning",e)}),e.tracksStore.addEventListener("error",t=>{this._priv_onFatalError(t,e)}),e.tracksStore.onManifestUpdate(t)}_priv_onManifestUpdate(e,t){var n,i,s;if(null===this._priv_contentInfos||null===this._priv_contentInfos.manifest)return;r(null===e||void 0===e?void 0:e.tracksStore)||e.tracksStore.onManifestUpdate(this._priv_contentInfos.manifest);const a=null!==(i=null===(n=this._priv_contentInfos)||void 0===n?void 0:n.currentPeriod)&&void 0!==i?i:void 0,o=null===(s=this._priv_contentInfos)||void 0===s?void 0:s.tracksStore;if(void 0!==a&&!r(o))for(const r of t.updatedPeriods)if(r.period.id===a.id&&(r.result.addedAdaptations.length>0||r.result.removedAdaptations.length>0)){const e=o.getPeriodObjectFromPeriod(a);if(void 0===e)return;this._priv_onAvailableTracksMayHaveChanged("audio"),this._priv_onAvailableTracksMayHaveChanged("text"),this._priv_onAvailableTracksMayHaveChanged("video")}}_priv_onDecipherabilityUpdate(e,t){if(null===e||null===e.manifest)return;r(null===e||void 0===e?void 0:e.tracksStore)||e.tracksStore.onDecipherabilityUpdates();const n=t.reduce((t,n)=>{var i,r,s;const a=void 0!==De(t,e=>e[0].id===n.period.id&&e[1]===n.adaptation.type);if(!a){const a=e.tracksStore;if(null===a)return t;let o=!1;const l=a.getPeriodObjectFromPeriod(n.period);if(void 0===l)return t;switch(n.adaptation.type){case"audio":o=(null===(i=a.getChosenAudioTrack(l))||void 0===i?void 0:i.id)===n.adaptation.id;break;case"video":o=(null===(r=a.getChosenVideoTrack(l))||void 0===r?void 0:r.id)===n.adaptation.id;break;case"text":o=(null===(s=a.getChosenTextTrack(l))||void 0===s?void 0:s.id)===n.adaptation.id;break}o&&t.push([n.period,n.adaptation.type])}return t},[]);for(const[i,r]of n)this._priv_triggerEventIfNotStopped("representationListUpdate",{period:{start:i.start,end:i.end,id:i.id},trackType:r,reason:"decipherability-update"},e.currentContentCanceller.signal)}_priv_onActivePeriodChanged(e,{period:t}){var n,i,s,a,o,l;if(e.contentId!==(null===(n=this._priv_contentInfos)||void 0===n?void 0:n.contentId))return;e.currentPeriod=t;const u=e.currentContentCanceller.signal;this._priv_contentEventsMemory.periodChange!==t&&(this._priv_contentEventsMemory.periodChange=t,this._priv_triggerEventIfNotStopped("periodChange",{start:t.start,end:t.end,id:t.id},u)),this._priv_triggerEventIfNotStopped("availableAudioTracksChange",this.getAvailableAudioTracks(),u),this._priv_triggerEventIfNotStopped("availableTextTracksChange",this.getAvailableTextTracks(),u),this._priv_triggerEventIfNotStopped("availableVideoTracksChange",this.getAvailableVideoTracks(),u);const c=null===(i=this._priv_contentInfos)||void 0===i?void 0:i.tracksStore;if(r(c))this._priv_triggerEventIfNotStopped("audioTrackChange",null,u),this._priv_triggerEventIfNotStopped("textTrackChange",null,u),this._priv_triggerEventIfNotStopped("videoTrackChange",null,u);else{const e=c.getPeriodObjectFromPeriod(t);if(e){const t=c.getChosenAudioTrack(e);this._priv_triggerEventIfNotStopped("audioTrackChange",t,u);const n=c.getChosenTextTrack(e);this._priv_triggerEventIfNotStopped("textTrackChange",n,u);const i=c.getChosenVideoTrack(e);this._priv_triggerEventIfNotStopped("videoTrackChange",i,u)}}const d=null!==(a=null===(s=this.__priv_getCurrentRepresentations())||void 0===s?void 0:s.audio)&&void 0!==a?a:null;this._priv_triggerEventIfNotStopped("audioRepresentationChange",d,u);const h=null!==(l=null===(o=this.__priv_getCurrentRepresentations())||void 0===o?void 0:o.video)&&void 0!==l?l:null;this._priv_triggerEventIfNotStopped("videoRepresentationChange",h,u)}_priv_onPeriodStreamReady(e,t){var n;if(e.contentId!==(null===(n=this._priv_contentInfos)||void 0===n?void 0:n.contentId))return;const{type:i,period:s,adaptationRef:a}=t,o=e.tracksStore;switch(i){case"video":case"audio":case"text":r(o)?(V.error(`API: TracksStore not instanciated for a new ${i} period`),a.setValue(null)):o.addTrackReference(i,s,a);break;default:ge(i)}}_priv_onPeriodStreamCleared(e,t){var n;if(e.contentId!==(null===(n=this._priv_contentInfos)||void 0===n?void 0:n.contentId))return;const{type:i,period:s}=t,a=e.tracksStore;switch(i){case"audio":case"text":case"video":r(a)||a.removeTrackReference(i,s);break}const{activeAdaptations:o,activeRepresentations:l}=e;if(!r(o)&&!r(o[s.id])){const e=o[s.id];delete e[i],0===Object.keys(e).length&&delete o[s.id]}if(!r(l)&&!r(l[s.id])){const e=l[s.id];delete e[i],0===Object.keys(e).length&&delete l[s.id]}}_priv_onAdaptationChange(e,{type:t,adaptation:n,period:i}){var s;if(e.contentId!==(null===(s=this._priv_contentInfos)||void 0===s?void 0:s.contentId))return;null===e.activeAdaptations&&(e.activeAdaptations={});const{activeAdaptations:a,currentPeriod:o}=e,l=a[i.id];r(l)?a[i.id]={[t]:n}:l[t]=n;const{tracksStore:u}=e,c=e.currentContentCanceller.signal;if(null!==u&&null!==o&&!r(i)&&i.id===o.id){const e=u.getPeriodObjectFromPeriod(i);if(void 0===e)return;switch(t){case"audio":const n=u.getChosenAudioTrack(e);this._priv_triggerEventIfNotStopped("audioTrackChange",n,c);break;case"text":const i=u.getChosenTextTrack(e);this._priv_triggerEventIfNotStopped("textTrackChange",i,c);break;case"video":const r=u.getChosenVideoTrack(e);this._priv_triggerEventIfNotStopped("videoTrackChange",r,c);break}}}_priv_onRepresentationChange(e,{type:t,period:n,representation:i}){var s;if(e.contentId!==(null===(s=this._priv_contentInfos)||void 0===s?void 0:s.contentId))return;null===e.activeRepresentations&&(e.activeRepresentations={});const{activeRepresentations:a,currentPeriod:o}=e,l=a[n.id];if(r(l)?a[n.id]={[t]:i}:l[t]=i,!r(n)&&null!==o&&o.id===n.id){const e=this._priv_contentInfos.currentContentCanceller.signal;"video"===t?this._priv_triggerEventIfNotStopped("videoRepresentationChange",i,e):"audio"===t&&this._priv_triggerEventIfNotStopped("audioRepresentationChange",i,e)}}_priv_onBitrateEstimateChange({type:e,bitrate:t}){void 0!==t&&(this._priv_bitrateInfos.lastBitrates[e]=t),this.trigger("__priv_bitrateEstimateChange",{type:e,bitrate:t})}_priv_setPlayerState(e){this.state!==e&&(this.state=e,V.info("API: playerStateChange event",e),this.trigger("playerStateChange",e))}_priv_triggerPositionUpdate(e,t){var n,i;if(e.contentId!==(null===(n=this._priv_contentInfos)||void 0===n?void 0:n.contentId))return;const{isDirectFile:s,manifest:a}=e;if(!s&&null===a||r(t))return;const o=null!==a?St(a):void 0,l={position:t.position.getPolled(),duration:t.duration,playbackRate:t.playbackRate,maximumPosition:o,bufferGap:void 0!==t.bufferGap&&isFinite(t.bufferGap)?t.bufferGap:0};if(null!==a&&a.isLive&&t.position.getPolled()>0){const e=null!==(i=a.availabilityStartTime)&&void 0!==i?i:0;l.wallClockTime=t.position.getPolled()+e;const n=Tt(a);void 0!==n&&(l.liveGap=n-t.position.getPolled())}else if(s&&null!==this.videoElement){const e=Zm(this.videoElement);void 0!==e&&(l.wallClockTime=e+t.position.getPolled())}this.trigger("positionUpdate",l)}_priv_triggerEventIfNotStopped(e,t,n){n.isCancelled()||this.trigger(e,t)}_priv_initializeMediaElementTracksStore(e){var t,n,i;fe(null!==qt.directfile,"Initializing `MediaElementTracksStore` without Directfile feature"),fe(null!==this.videoElement,"Initializing `MediaElementTracksStore` on a disposed RxPlayer");const r=new qt.directfile.mediaElementTracksStore(this.videoElement);return this._priv_triggerEventIfNotStopped("availableAudioTracksChange",r.getAvailableAudioTracks(),e),this._priv_triggerEventIfNotStopped("availableVideoTracksChange",r.getAvailableVideoTracks(),e),this._priv_triggerEventIfNotStopped("availableTextTracksChange",r.getAvailableTextTracks(),e),this._priv_triggerEventIfNotStopped("audioTrackChange",null!==(t=r.getChosenAudioTrack())&&void 0!==t?t:null,e),this._priv_triggerEventIfNotStopped("textTrackChange",null!==(n=r.getChosenTextTrack())&&void 0!==n?n:null,e),this._priv_triggerEventIfNotStopped("videoTrackChange",null!==(i=r.getChosenVideoTrack())&&void 0!==i?i:null,e),r.addEventListener("availableVideoTracksChange",e=>this.trigger("availableVideoTracksChange",e)),r.addEventListener("availableAudioTracksChange",e=>this.trigger("availableAudioTracksChange",e)),r.addEventListener("availableTextTracksChange",e=>this.trigger("availableTextTracksChange",e)),r.addEventListener("audioTrackChange",e=>this.trigger("audioTrackChange",e)),r.addEventListener("videoTrackChange",e=>this.trigger("videoTrackChange",e)),r.addEventListener("textTrackChange",e=>this.trigger("textTrackChange",e)),r}_priv_callTracksStoreGetterSetter(e,t,n){var i,r;if(null===this._priv_contentInfos||null===this._priv_contentInfos.tracksStore)return V.warn("API: Trying to call track API too soon"),t;const{tracksStore:s}=this._priv_contentInfos,a=null!==(r=null===(i=this._priv_contentInfos)||void 0===i?void 0:i.currentPeriod)&&void 0!==r?r:void 0,o=null!==e&&void 0!==e?e:null===a||void 0===a?void 0:a.id;if(void 0===o)return t;const l=o===(null===a||void 0===a?void 0:a.id)?s.getPeriodObjectFromPeriod(a):s.getPeriodObjectFromId(o);return void 0===l?t:n(s,l)}_priv_onAvailableTracksMayHaveChanged(e,t){const n=this._priv_contentInfos;if(null===n)return;const{currentPeriod:i,tracksStore:s,currentContentCanceller:a}=n,o=a.signal;if(r(i)||null===s)return;const l=null!==t&&void 0!==t?t:s.getPeriodObjectFromPeriod(i);if(void 0!==l)switch(e){case"video":const t=s.getAvailableVideoTracks(l);this._priv_triggerEventIfNotStopped("availableVideoTracksChange",null!==t&&void 0!==t?t:[],o);break;case"audio":const n=s.getAvailableAudioTracks(l);this._priv_triggerEventIfNotStopped("availableAudioTracksChange",null!==n&&void 0!==n?n:[],o);break;case"text":const i=s.getAvailableTextTracks(l);this._priv_triggerEventIfNotStopped("availableTextTracksChange",null!==i&&void 0!==i?i:[],o);break;default:ge(e)}}_priv_onFatalError(e,t){const n=ft(e,{defaultCode:"NONE",defaultReason:"An unknown error stopped content playback."});n.fatal=!0,t.currentContentCanceller.cancel(),this._priv_cleanUpCurrentContentState(),this._priv_currentError=n,V.error("API: The player stopped because of an error",n),this._priv_setPlayerState("STOPPED"),this._priv_currentError===n&&this.trigger("error",n)}}Bv._priv_currentlyUsedVideoElements=new WeakSet,Bv.version="4.1.0";var jv=Bv,Vv=jv;u(),Vv.addFeatures([Rl,Od,Wd,$f,jp,Zp,pg,Tg,om,bm,Gm,Ym]),i()&&V.setLevel("DEBUG");t["a"]=Vv;"boolean"===typeof __GLOBAL_SCOPE__&&__GLOBAL_SCOPE__&&(a["a"].RxPlayer=Vv)},"133d":function(e,t,n){var i=n("6d8b"),r=n("e0d3");function s(e,t){var n,s=[],a=e.seriesIndex;if(null==a||!(n=t.getSeriesByIndex(a)))return{point:[]};var o=n.getData(),l=r.queryDataIndex(o,e);if(null==l||l<0||i.isArray(l))return{point:[]};var u=o.getItemGraphicEl(l),c=n.coordinateSystem;if(n.getTooltipPosition)s=n.getTooltipPosition(l)||[];else if(c&&c.dataToPoint)s=c.dataToPoint(o.getValues(i.map(c.dimensions,function(e){return o.mapDimension(e)}),l,!0))||[];else if(u){var d=u.getBoundingRect().clone();d.applyTransform(u.transform),s=[d.x+d.width/2,d.y+d.height/2]}return{point:s,el:u}}e.exports=s},1418:function(e,t,n){var i=n("6d8b"),r=n("a15a"),s=r.createSymbol,a=n("2306"),o=n("3842"),l=o.parsePercent,u=n("c775"),c=u.getDefaultLabel;function d(e,t,n){a.Group.call(this),this.updateData(e,t,n)}var h=d.prototype,f=d.getSymbolSize=function(e,t){var n=e.getItemVisual(t,"symbolSize");return n instanceof Array?n.slice():[+n,+n]};function p(e){return[e[0]/2,e[1]/2]}function g(e,t){this.parent.drift(e,t)}h._createSymbol=function(e,t,n,i,r){this.removeAll();var a=t.getItemVisual(n,"color"),o=s(e,-1,-1,2,2,a,r);o.attr({z2:100,culling:!0,scale:p(i)}),o.drift=g,this._symbolType=e,this.add(o)},h.stopSymbolAnimation=function(e){this.childAt(0).stopAnimation(e)},h.getSymbolPath=function(){return this.childAt(0)},h.getScale=function(){return this.childAt(0).scale},h.highlight=function(){this.childAt(0).trigger("emphasis")},h.downplay=function(){this.childAt(0).trigger("normal")},h.setZ=function(e,t){var n=this.childAt(0);n.zlevel=e,n.z=t},h.setDraggable=function(e){var t=this.childAt(0);t.draggable=e,t.cursor=e?"move":"pointer"},h.updateData=function(e,t,n){this.silent=!1;var i=e.getItemVisual(t,"symbol")||"circle",r=e.hostModel,s=f(e,t),o=i!==this._symbolType;if(o){var l=e.getItemVisual(t,"symbolKeepAspect");this._createSymbol(i,e,t,s,l)}else{var u=this.childAt(0);u.silent=!1,a.updateProps(u,{scale:p(s)},r,t)}if(this._updateCommon(e,t,s,n),o){u=this.childAt(0);var c=n&&n.fadeIn,d={scale:u.scale.slice()};c&&(d.style={opacity:u.style.opacity}),u.scale=[0,0],c&&(u.style.opacity=0),a.initProps(u,d,r,t)}this._seriesModel=r};var m=["itemStyle"],v=["emphasis","itemStyle"],y=["label"],b=["emphasis","label"];h._updateCommon=function(e,t,n,r){var s=this.childAt(0),o=e.hostModel,u=e.getItemVisual(t,"color");"image"!==s.type&&s.useStyle({strokeNoScale:!0});var d=r&&r.itemStyle,h=r&&r.hoverItemStyle,f=r&&r.symbolRotate,g=r&&r.symbolOffset,_=r&&r.labelModel,T=r&&r.hoverLabelModel,S=r&&r.hoverAnimation,w=r&&r.cursorStyle;if(!r||e.hasItemOption){var E=r&&r.itemModel?r.itemModel:e.getItemModel(t);d=E.getModel(m).getItemStyle(["color"]),h=E.getModel(v).getItemStyle(),f=E.getShallow("symbolRotate"),g=E.getShallow("symbolOffset"),_=E.getModel(y),T=E.getModel(b),S=E.getShallow("hoverAnimation"),w=E.getShallow("cursor")}else h=i.extend({},h);var x=s.style;s.attr("rotation",(f||0)*Math.PI/180||0),g&&s.attr("position",[l(g[0],n[0]),l(g[1],n[1])]),w&&s.attr("cursor",w),s.setColor(u,r&&r.symbolInnerColor),s.setStyle(d);var k=e.getItemVisual(t,"opacity");null!=k&&(x.opacity=k);var A=e.getItemVisual(t,"liftZ"),I=s.__z2Origin;null!=A?null==I&&(s.__z2Origin=s.z2,s.z2+=A):null!=I&&(s.z2=I,s.__z2Origin=null);var C=r&&r.useNameLabel;function D(t,n){return C?e.getName(t):c(e,t)}a.setLabelStyle(x,h,_,T,{labelFetcher:o,labelDataIndex:t,defaultText:D,isRectText:!0,autoColor:u}),s.off("mouseover").off("mouseout").off("emphasis").off("normal"),s.hoverStyle=h,a.setHoverStyle(s);var R=p(n);if(S&&o.isAnimationEnabled()){var M=function(){if(!this.incremental){var e=R[1]/R[0];this.animateTo({scale:[Math.max(1.1*R[0],R[0]+3),Math.max(1.1*R[1],R[1]+3*e)]},400,"elasticOut")}},L=function(){this.incremental||this.animateTo({scale:R},400,"elasticOut")};s.on("mouseover",M).on("mouseout",L).on("emphasis",M).on("normal",L)}},h.fadeOut=function(e,t){var n=this.childAt(0);this.silent=n.silent=!0,(!t||!t.keepLabel)&&(n.style.text=null),a.updateProps(n,{style:{opacity:0},scale:[0,0]},this._seriesModel,this.dataIndex,e)},i.inherits(d,a.Group);var _=d;e.exports=_},1495:function(e,t,n){var i=n("86cc"),r=n("cb7c"),s=n("0d58");e.exports=n("9e1e")?Object.defineProperties:function(e,t){r(e);var n,a=s(t),o=a.length,l=0;while(o>l)i.f(e,n=a[l++],t[n]);return e}},1548:function(e,t,n){var i=n("6d8b"),r=n("3301"),s=n("697e"),a=n("2023"),o=n("4319"),l=n("f934");l.getLayoutRect;t.getLayoutRect=l.getLayoutRect;var u=n("ee1a"),c=u.enableDataStack,d=u.isDimensionStacked,h=u.getStackedDimension,f=n("862d");t.completeDimensions=f;var p=n("b1d4");t.createDimensions=p;var g=n("a15a");function m(e){return r(e.getSource(),e)}t.createSymbol=g.createSymbol;var v={isDimensionStacked:d,enableDataStack:c,getStackedDimension:h};function y(e,t){var n=t;o.isInstance(t)||(n=new o(t),i.mixin(n,a));var r=s.createScaleByModel(n);return r.setExtent(e[0],e[1]),s.niceScaleExtent(r,n),r}function b(e){i.mixin(e,a)}t.createList=m,t.dataStack=v,t.createScale=y,t.mixinAxisModelCommonMethods=b},1687:function(e,t){var n="undefined"===typeof Float32Array?Array:Float32Array;function i(){var e=new n(6);return r(e),e}function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function a(e,t,n){var i=t[0]*n[0]+t[2]*n[1],r=t[1]*n[0]+t[3]*n[1],s=t[0]*n[2]+t[2]*n[3],a=t[1]*n[2]+t[3]*n[3],o=t[0]*n[4]+t[2]*n[5]+t[4],l=t[1]*n[4]+t[3]*n[5]+t[5];return e[0]=i,e[1]=r,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e}function o(e,t,n){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+n[0],e[5]=t[5]+n[1],e}function l(e,t,n){var i=t[0],r=t[2],s=t[4],a=t[1],o=t[3],l=t[5],u=Math.sin(n),c=Math.cos(n);return e[0]=i*c+a*u,e[1]=-i*u+a*c,e[2]=r*c+o*u,e[3]=-r*u+c*o,e[4]=c*s+u*l,e[5]=c*l-u*s,e}function u(e,t,n){var i=n[0],r=n[1];return e[0]=t[0]*i,e[1]=t[1]*r,e[2]=t[2]*i,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*r,e}function c(e,t){var n=t[0],i=t[2],r=t[4],s=t[1],a=t[3],o=t[5],l=n*a-s*i;return l?(l=1/l,e[0]=a*l,e[1]=-s*l,e[2]=-i*l,e[3]=n*l,e[4]=(i*o-a*r)*l,e[5]=(s*r-n*o)*l,e):null}function d(e){var t=i();return s(t,e),t}t.create=i,t.identity=r,t.copy=s,t.mul=a,t.translate=o,t.rotate=l,t.scale=u,t.invert=c,t.clone=d},"17a3":function(e,t,n){"use strict";n.d(t,"i",function(){return l}),n.d(t,"h",function(){return u}),n.d(t,"d",function(){return c}),n.d(t,"f",function(){return d}),n.d(t,"e",function(){return f}),n.d(t,"c",function(){return p}),n.d(t,"g",function(){return g}),n.d(t,"a",function(){return m}),n.d(t,"b",function(){return v});var i=n("be09"),r=n.n(i),s={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},a=["video","audio","text"],o=["Video","Audio","Text"],l=function(e){return e?e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,n){var i=("00"+Number(t).toString(16)).slice(-2),r=("00"+Number(n).toString(16)).slice(-2);return"avc1."+i+"00"+r}):e},u=function(e){void 0===e&&(e="");var t=e.split(","),n=[];return t.forEach(function(e){var t;e=e.trim(),a.forEach(function(i){var r=s[i].exec(e.toLowerCase());if(r&&!(r.length<=1)){t=i;var a=e.substring(0,r[1].length),o=e.replace(a,"");n.push({type:a,details:o,mediaType:i})}}),t||n.push({type:e,details:"",mediaType:"unknown"})}),n},c=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var n=e.mediaGroups.AUDIO[t];if(!n)return null;for(var i in n){var r=n[i];if(r.default&&r.playlists)return u(r.playlists[0].attributes.CODECS)}return null},d=function(e){return void 0===e&&(e=""),s.audio.test(e.trim().toLowerCase())},h=function(e){return void 0===e&&(e=""),s.text.test(e.trim().toLowerCase())},f=function(e){if(e&&"string"===typeof e){var t=e.toLowerCase().split(",").map(function(e){return l(e.trim())}),n="video";1===t.length&&d(t[0])?n="audio":1===t.length&&h(t[0])&&(n="application");var i="mp4";return t.every(function(e){return s.mp4.test(e)})?i="mp4":t.every(function(e){return s.webm.test(e)})?i="webm":t.every(function(e){return s.ogg.test(e)})&&(i="ogg"),n+"/"+i+';codecs="'+e+'"'}},p=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=!1),r.a.MediaSource&&r.a.MediaSource.isTypeSupported&&r.a.MediaSource.isTypeSupported(f(e))||t&&r.a.ManagedMediaSource&&r.a.ManagedMediaSource.isTypeSupported&&r.a.ManagedMediaSource.isTypeSupported(f(e))||!1},g=function(e){return void 0===e&&(e=""),e.toLowerCase().split(",").every(function(e){e=e.trim();for(var t=0;t<o.length;t++){var n=o[t];if(s["muxer"+n].test(e))return!0}return!1})},m="mp4a.40.2",v="avc1.4d400d"},"17b8":function(e,t,n){var i=n("3014"),r=i.extend({type:"series.bar",dependencies:["grid","polar"],brushSelector:"rect",getProgressive:function(){return!!this.get("large")&&this.get("progressive")},getProgressiveThreshold:function(){var e=this.get("progressiveThreshold"),t=this.get("largeThreshold");return t>e&&(e=t),e}});e.exports=r},"17d6":function(e,t,n){var i=n("6d8b"),r=n("22d1"),s=n("e0d3"),a=s.makeInner,o=a(),l=i.each;function u(e,t,n){if(!r.node){var i=t.getZr();o(i).records||(o(i).records={}),c(i,t);var s=o(i).records[e]||(o(i).records[e]={});s.handler=n}}function c(e,t){function n(n,i){e.on(n,function(n){var r=p(t);l(o(e).records,function(e){e&&i(e,n,r.dispatchAction)}),d(r.pendings,t)})}o(e).initialized||(o(e).initialized=!0,n("click",i.curry(f,"click")),n("mousemove",i.curry(f,"mousemove")),n("globalout",h))}function d(e,t){var n,i=e.showTip.length,r=e.hideTip.length;i?n=e.showTip[i-1]:r&&(n=e.hideTip[r-1]),n&&(n.dispatchAction=null,t.dispatchAction(n))}function h(e,t,n){e.handler("leave",null,n)}function f(e,t,n,i){t.handler(e,n,i)}function p(e){var t={showTip:[],hideTip:[]},n=function(i){var r=t[i.type];r?r.push(i):(i.dispatchAction=n,e.dispatchAction(i))};return{dispatchAction:n,pendings:t}}function g(e,t){if(!r.node){var n=t.getZr(),i=(o(n).records||{})[e];i&&(o(n).records[e]=null)}}t.register=u,t.unregister=g},"18c0":function(e,t,n){var i=n("6d8b"),r=n("e0d8"),s=n("8e43"),a=r.prototype,o=r.extend({type:"ordinal",init:function(e,t){e&&!i.isArray(e)||(e=new s({categories:e})),this._ordinalMeta=e,this._extent=t||[0,e.categories.length-1]},parse:function(e){return"string"===typeof e?this._ordinalMeta.getOrdinal(e):Math.round(e)},contain:function(e){return e=this.parse(e),a.contain.call(this,e)&&null!=this._ordinalMeta.categories[e]},normalize:function(e){return a.normalize.call(this,this.parse(e))},scale:function(e){return Math.round(a.scale.call(this,e))},getTicks:function(){var e=[],t=this._extent,n=t[0];while(n<=t[1])e.push(n),n++;return e},getLabel:function(e){if(!this.isBlank())return this._ordinalMeta.categories[e]},count:function(){return this._extent[1]-this._extent[0]+1},unionExtentFromData:function(e,t){this.unionExtent(e.getApproximateExtent(t))},getOrdinalMeta:function(){return this._ordinalMeta},niceTicks:i.noop,niceExtent:i.noop});o.create=function(){return new o};var l=o;e.exports=l},1991:function(e,t,n){var i,r,s,a=n("9b43"),o=n("31f4"),l=n("fab2"),u=n("230e"),c=n("7726"),d=c.process,h=c.setImmediate,f=c.clearImmediate,p=c.MessageChannel,g=c.Dispatch,m=0,v={},y="onreadystatechange",b=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},_=function(e){b.call(e.data)};h&&f||(h=function(e){var t=[],n=1;while(arguments.length>n)t.push(arguments[n++]);return v[++m]=function(){o("function"==typeof e?e:Function(e),t)},i(m),m},f=function(e){delete v[e]},"process"==n("2d95")(d)?i=function(e){d.nextTick(a(b,e,1))}:g&&g.now?i=function(e){g.now(a(b,e,1))}:p?(r=new p,s=r.port2,r.port1.onmessage=_,i=a(s.postMessage,s,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(i=function(e){c.postMessage(e+"","*")},c.addEventListener("message",_,!1)):i=y in u("script")?function(e){l.appendChild(u("script"))[y]=function(){l.removeChild(this),b.call(e)}}:function(e){setTimeout(a(b,e,1),0)}),e.exports={set:h,clear:f}},"19eb":function(e,t,n){var i=n("6d8b"),r=n("2b61"),s=n("d5b7"),a=n("9e2e");function o(e){for(var t in e=e||{},s.call(this,e),e)e.hasOwnProperty(t)&&"style"!==t&&(this[t]=e[t]);this.style=new r(e.style,this),this._rect=null,this.__clipPaths=[]}o.prototype={constructor:o,type:"displayable",__dirty:!0,invisible:!1,z:0,z2:0,zlevel:0,draggable:!1,dragging:!1,silent:!1,culling:!1,cursor:"pointer",rectHover:!1,progressive:!1,incremental:!1,inplace:!1,beforeBrush:function(e){},afterBrush:function(e){},brush:function(e,t){},getBoundingRect:function(){},contain:function(e,t){return this.rectContain(e,t)},traverse:function(e,t){e.call(t,this)},rectContain:function(e,t){var n=this.transformCoordToLocal(e,t),i=this.getBoundingRect();return i.contain(n[0],n[1])},dirty:function(){this.__dirty=!0,this._rect=null,this.__zr&&this.__zr.refresh()},animateStyle:function(e){return this.animate("style",e)},attrKV:function(e,t){"style"!==e?s.prototype.attrKV.call(this,e,t):this.style.set(t)},setStyle:function(e,t){return this.style.set(e,t),this.dirty(!1),this},useStyle:function(e){return this.style=new r(e,this),this.dirty(!1),this}},i.inherits(o,s),i.mixin(o,a);var l=o;e.exports=l},"1fa8":function(e,t,n){var i=n("cb7c");e.exports=function(e,t,n,r){try{return r?t(i(n)[0],n[1]):t(n)}catch(t){var s=e["return"];throw void 0!==s&&i(s.call(e)),t}}},"1fab":function(e,t){var n=Array.prototype.slice,i=function(){this._$handlers={}};i.prototype={constructor:i,one:function(e,t,n){var i=this._$handlers;if(!t||!e)return this;i[e]||(i[e]=[]);for(var r=0;r<i[e].length;r++)if(i[e][r].h===t)return this;return i[e].push({h:t,one:!0,ctx:n||this}),this},on:function(e,t,n){var i=this._$handlers;if(!t||!e)return this;i[e]||(i[e]=[]);for(var r=0;r<i[e].length;r++)if(i[e][r].h===t)return this;return i[e].push({h:t,one:!1,ctx:n||this}),this},isSilent:function(e){var t=this._$handlers;return t[e]&&t[e].length},off:function(e,t){var n=this._$handlers;if(!e)return this._$handlers={},this;if(t){if(n[e]){for(var i=[],r=0,s=n[e].length;r<s;r++)n[e][r]["h"]!=t&&i.push(n[e][r]);n[e]=i}n[e]&&0===n[e].length&&delete n[e]}else delete n[e];return this},trigger:function(e){if(this._$handlers[e]){var t=arguments,i=t.length;i>3&&(t=n.call(t,1));for(var r=this._$handlers[e],s=r.length,a=0;a<s;){switch(i){case 1:r[a]["h"].call(r[a]["ctx"]);break;case 2:r[a]["h"].call(r[a]["ctx"],t[1]);break;case 3:r[a]["h"].call(r[a]["ctx"],t[1],t[2]);break;default:r[a]["h"].apply(r[a]["ctx"],t);break}r[a]["one"]?(r.splice(a,1),s--):a++}}return this},triggerWithContext:function(e){if(this._$handlers[e]){var t=arguments,i=t.length;i>4&&(t=n.call(t,1,t.length-1));for(var r=t[t.length-1],s=this._$handlers[e],a=s.length,o=0;o<a;){switch(i){case 1:s[o]["h"].call(r);break;case 2:s[o]["h"].call(r,t[1]);break;case 3:s[o]["h"].call(r,t[1],t[2]);break;default:s[o]["h"].apply(r,t);break}s[o]["one"]?(s.splice(o,1),a--):o++}}return this}};var r=i;e.exports=r},"1fb5":function(e,t,n){"use strict";t.byteLength=c,t.toByteArray=h,t.fromByteArray=g;for(var i=[],r=[],s="undefined"!==typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=a.length;o<l;++o)i[o]=a[o],r[a.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var i=n===t?0:4-n%4;return[n,i]}function c(e){var t=u(e),n=t[0],i=t[1];return 3*(n+i)/4-i}function d(e,t,n){return 3*(t+n)/4-n}function h(e){for(var t,n=u(e),i=n[0],a=n[1],o=new s(d(e,i,a)),l=0,c=a>0?i-4:i,h=0;h<c;h+=4)t=r[e.charCodeAt(h)]<<18|r[e.charCodeAt(h+1)]<<12|r[e.charCodeAt(h+2)]<<6|r[e.charCodeAt(h+3)],o[l++]=t>>16&255,o[l++]=t>>8&255,o[l++]=255&t;return 2===a&&(t=r[e.charCodeAt(h)]<<2|r[e.charCodeAt(h+1)]>>4,o[l++]=255&t),1===a&&(t=r[e.charCodeAt(h)]<<10|r[e.charCodeAt(h+1)]<<4|r[e.charCodeAt(h+2)]>>2,o[l++]=t>>8&255,o[l++]=255&t),o}function f(e){return i[e>>18&63]+i[e>>12&63]+i[e>>6&63]+i[63&e]}function p(e,t,n){for(var i,r=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),r.push(f(i));return r.join("")}function g(e){for(var t,n=e.length,r=n%3,s=[],a=16383,o=0,l=n-r;o<l;o+=a)s.push(p(e,o,o+a>l?l:o+a));return 1===r?(t=e[n-1],s.push(i[t>>2]+i[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],s.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"=")),s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},2023:function(e,t,n){var i=n("6d8b"),r=(n("697e"),{getMin:function(e){var t=this.option,n=e||null==t.rangeStart?t.min:t.rangeStart;return this.axis&&null!=n&&"dataMin"!==n&&"function"!==typeof n&&!i.eqNaN(n)&&(n=this.axis.scale.parse(n)),n},getMax:function(e){var t=this.option,n=e||null==t.rangeEnd?t.max:t.rangeEnd;return this.axis&&null!=n&&"dataMax"!==n&&"function"!==typeof n&&!i.eqNaN(n)&&(n=this.axis.scale.parse(n)),n},getNeedCrossZero:function(){var e=this.option;return null==e.rangeStart&&null==e.rangeEnd&&!e.scale},getCoordSysModel:i.noop,setRange:function(e,t){this.option.rangeStart=e,this.option.rangeEnd=t},resetRange:function(){this.option.rangeStart=this.option.rangeEnd=null}});e.exports=r},2039:function(e,t,n){var i=n("6d8b"),r={};function s(){this._coordinateSystems=[]}s.prototype={constructor:s,create:function(e,t){var n=[];i.each(r,function(i,r){var s=i.create(e,t);n=n.concat(s||[])}),this._coordinateSystems=n},update:function(e,t){i.each(this._coordinateSystems,function(n){n.update&&n.update(e,t)})},getCoordinateSystems:function(){return this._coordinateSystems.slice()}},s.register=function(e,t){r[e]=t},s.get=function(e){return r[e]};var a=s;e.exports=a},"20c8":function(e,t,n){var i=n("4a3f"),r=n("401b"),s=n("e263"),a=n("9850"),o=n("2cf4"),l=o.devicePixelRatio,u={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},c=[],d=[],h=[],f=[],p=Math.min,g=Math.max,m=Math.cos,v=Math.sin,y=Math.sqrt,b=Math.abs,_="undefined"!=typeof Float32Array,T=function(e){this._saveData=!e,this._saveData&&(this.data=[]),this._ctx=null};T.prototype={constructor:T,_xi:0,_yi:0,_x0:0,_y0:0,_ux:0,_uy:0,_len:0,_lineDash:null,_dashOffset:0,_dashIdx:0,_dashSum:0,setScale:function(e,t){this._ux=b(1/l/e)||0,this._uy=b(1/l/t)||0},getContext:function(){return this._ctx},beginPath:function(e){return this._ctx=e,e&&e.beginPath(),e&&(this.dpr=e.dpr),this._saveData&&(this._len=0),this._lineDash&&(this._lineDash=null,this._dashOffset=0),this},moveTo:function(e,t){return this.addData(u.M,e,t),this._ctx&&this._ctx.moveTo(e,t),this._x0=e,this._y0=t,this._xi=e,this._yi=t,this},lineTo:function(e,t){var n=b(e-this._xi)>this._ux||b(t-this._yi)>this._uy||this._len<5;return this.addData(u.L,e,t),this._ctx&&n&&(this._needsDash()?this._dashedLineTo(e,t):this._ctx.lineTo(e,t)),n&&(this._xi=e,this._yi=t),this},bezierCurveTo:function(e,t,n,i,r,s){return this.addData(u.C,e,t,n,i,r,s),this._ctx&&(this._needsDash()?this._dashedBezierTo(e,t,n,i,r,s):this._ctx.bezierCurveTo(e,t,n,i,r,s)),this._xi=r,this._yi=s,this},quadraticCurveTo:function(e,t,n,i){return this.addData(u.Q,e,t,n,i),this._ctx&&(this._needsDash()?this._dashedQuadraticTo(e,t,n,i):this._ctx.quadraticCurveTo(e,t,n,i)),this._xi=n,this._yi=i,this},arc:function(e,t,n,i,r,s){return this.addData(u.A,e,t,n,n,i,r-i,0,s?0:1),this._ctx&&this._ctx.arc(e,t,n,i,r,s),this._xi=m(r)*n+e,this._yi=v(r)*n+e,this},arcTo:function(e,t,n,i,r){return this._ctx&&this._ctx.arcTo(e,t,n,i,r),this},rect:function(e,t,n,i){return this._ctx&&this._ctx.rect(e,t,n,i),this.addData(u.R,e,t,n,i),this},closePath:function(){this.addData(u.Z);var e=this._ctx,t=this._x0,n=this._y0;return e&&(this._needsDash()&&this._dashedLineTo(t,n),e.closePath()),this._xi=t,this._yi=n,this},fill:function(e){e&&e.fill(),this.toStatic()},stroke:function(e){e&&e.stroke(),this.toStatic()},setLineDash:function(e){if(e instanceof Array){this._lineDash=e,this._dashIdx=0;for(var t=0,n=0;n<e.length;n++)t+=e[n];this._dashSum=t}return this},setLineDashOffset:function(e){return this._dashOffset=e,this},len:function(){return this._len},setData:function(e){var t=e.length;this.data&&this.data.length==t||!_||(this.data=new Float32Array(t));for(var n=0;n<t;n++)this.data[n]=e[n];this._len=t},appendPath:function(e){e instanceof Array||(e=[e]);for(var t=e.length,n=0,i=this._len,r=0;r<t;r++)n+=e[r].len();_&&this.data instanceof Float32Array&&(this.data=new Float32Array(i+n));for(r=0;r<t;r++)for(var s=e[r].data,a=0;a<s.length;a++)this.data[i++]=s[a];this._len=i},addData:function(e){if(this._saveData){var t=this.data;this._len+arguments.length>t.length&&(this._expandData(),t=this.data);for(var n=0;n<arguments.length;n++)t[this._len++]=arguments[n];this._prevCmd=e}},_expandData:function(){if(!(this.data instanceof Array)){for(var e=[],t=0;t<this._len;t++)e[t]=this.data[t];this.data=e}},_needsDash:function(){return this._lineDash},_dashedLineTo:function(e,t){var n,i,r=this._dashSum,s=this._dashOffset,a=this._lineDash,o=this._ctx,l=this._xi,u=this._yi,c=e-l,d=t-u,h=y(c*c+d*d),f=l,m=u,v=a.length;c/=h,d/=h,s<0&&(s=r+s),s%=r,f-=s*c,m-=s*d;while(c>0&&f<=e||c<0&&f>=e||0==c&&(d>0&&m<=t||d<0&&m>=t))i=this._dashIdx,n=a[i],f+=c*n,m+=d*n,this._dashIdx=(i+1)%v,c>0&&f<l||c<0&&f>l||d>0&&m<u||d<0&&m>u||o[i%2?"moveTo":"lineTo"](c>=0?p(f,e):g(f,e),d>=0?p(m,t):g(m,t));c=f-e,d=m-t,this._dashOffset=-y(c*c+d*d)},_dashedBezierTo:function(e,t,n,r,s,a){var o,l,u,c,d,h=this._dashSum,f=this._dashOffset,p=this._lineDash,g=this._ctx,m=this._xi,v=this._yi,b=i.cubicAt,_=0,T=this._dashIdx,S=p.length,w=0;for(f<0&&(f=h+f),f%=h,o=0;o<1;o+=.1)l=b(m,e,n,s,o+.1)-b(m,e,n,s,o),u=b(v,t,r,a,o+.1)-b(v,t,r,a,o),_+=y(l*l+u*u);for(;T<S;T++)if(w+=p[T],w>f)break;o=(w-f)/_;while(o<=1)c=b(m,e,n,s,o),d=b(v,t,r,a,o),T%2?g.moveTo(c,d):g.lineTo(c,d),o+=p[T]/_,T=(T+1)%S;T%2!==0&&g.lineTo(s,a),l=s-c,u=a-d,this._dashOffset=-y(l*l+u*u)},_dashedQuadraticTo:function(e,t,n,i){var r=n,s=i;n=(n+2*e)/3,i=(i+2*t)/3,e=(this._xi+2*e)/3,t=(this._yi+2*t)/3,this._dashedBezierTo(e,t,n,i,r,s)},toStatic:function(){var e=this.data;e instanceof Array&&(e.length=this._len,_&&(this.data=new Float32Array(e)))},getBoundingRect:function(){c[0]=c[1]=h[0]=h[1]=Number.MAX_VALUE,d[0]=d[1]=f[0]=f[1]=-Number.MAX_VALUE;for(var e=this.data,t=0,n=0,i=0,o=0,l=0;l<e.length;){var p=e[l++];switch(1==l&&(t=e[l],n=e[l+1],i=t,o=n),p){case u.M:i=e[l++],o=e[l++],t=i,n=o,h[0]=i,h[1]=o,f[0]=i,f[1]=o;break;case u.L:s.fromLine(t,n,e[l],e[l+1],h,f),t=e[l++],n=e[l++];break;case u.C:s.fromCubic(t,n,e[l++],e[l++],e[l++],e[l++],e[l],e[l+1],h,f),t=e[l++],n=e[l++];break;case u.Q:s.fromQuadratic(t,n,e[l++],e[l++],e[l],e[l+1],h,f),t=e[l++],n=e[l++];break;case u.A:var g=e[l++],y=e[l++],b=e[l++],_=e[l++],T=e[l++],S=e[l++]+T,w=(e[l++],1-e[l++]);1==l&&(i=m(T)*b+g,o=v(T)*_+y),s.fromArc(g,y,b,_,T,S,w,h,f),t=m(S)*b+g,n=v(S)*_+y;break;case u.R:i=t=e[l++],o=n=e[l++];var E=e[l++],x=e[l++];s.fromLine(i,o,i+E,o+x,h,f);break;case u.Z:t=i,n=o;break}r.min(c,c,h),r.max(d,d,f)}return 0===l&&(c[0]=c[1]=d[0]=d[1]=0),new a(c[0],c[1],d[0]-c[0],d[1]-c[1])},rebuildPath:function(e){for(var t,n,i,r,s,a,o=this.data,l=this._ux,c=this._uy,d=this._len,h=0;h<d;){var f=o[h++];switch(1==h&&(i=o[h],r=o[h+1],t=i,n=r),f){case u.M:t=i=o[h++],n=r=o[h++],e.moveTo(i,r);break;case u.L:s=o[h++],a=o[h++],(b(s-i)>l||b(a-r)>c||h===d-1)&&(e.lineTo(s,a),i=s,r=a);break;case u.C:e.bezierCurveTo(o[h++],o[h++],o[h++],o[h++],o[h++],o[h++]),i=o[h-2],r=o[h-1];break;case u.Q:e.quadraticCurveTo(o[h++],o[h++],o[h++],o[h++]),i=o[h-2],r=o[h-1];break;case u.A:var p=o[h++],g=o[h++],y=o[h++],_=o[h++],T=o[h++],S=o[h++],w=o[h++],E=o[h++],x=y>_?y:_,k=y>_?1:y/_,A=y>_?_/y:1,I=Math.abs(y-_)>.001,C=T+S;I?(e.translate(p,g),e.rotate(w),e.scale(k,A),e.arc(0,0,x,T,C,1-E),e.scale(1/k,1/A),e.rotate(-w),e.translate(-p,-g)):e.arc(p,g,x,T,C,1-E),1==h&&(t=m(T)*y+p,n=v(T)*_+g),i=m(C)*y+p,r=v(C)*_+g;break;case u.R:t=i=o[h],n=r=o[h+1],e.rect(o[h++],o[h++],o[h++],o[h++]);break;case u.Z:e.closePath(),i=t,r=n}}}},T.CMD=u;var S=T;e.exports=S},"210b":function(e,t,n){var i=n("e1c8");t.DOMImplementation=i.DOMImplementation,t.XMLSerializer=i.XMLSerializer,t.DOMParser=n("b074").DOMParser},2145:function(e,t){var n={};function i(e,t){n[e]=t}function r(e){return n[e]}t.register=i,t.get=r},"214f":function(e,t,n){"use strict";var i=n("32e9"),r=n("2aba"),s=n("79e5"),a=n("be13"),o=n("2b4c");e.exports=function(e,t,n){var l=o(e),u=n(a,l,""[e]),c=u[0],d=u[1];s(function(){var t={};return t[l]=function(){return 7},7!=""[e](t)})&&(r(String.prototype,e,c),i(RegExp.prototype,l,2==t?function(e,t){return d.call(e,this,t)}:function(e){return d.call(e,this)}))}},"216a":function(e,t,n){var i=n("6d8b"),r=n("3842"),s=n("eda2"),a=n("944e"),o=n("89e3"),l=o.prototype,u=Math.ceil,c=Math.floor,d=1e3,h=60*d,f=60*h,p=24*f,g=function(e,t,n,i){while(n<i){var r=n+i>>>1;e[r][1]<t?n=r+1:i=r}return n},m=o.extend({type:"time",getLabel:function(e){var t=this._stepLvl,n=new Date(e);return s.formatTime(t[0],n,this.getSetting("useUTC"))},niceExtent:function(e){var t=this._extent;if(t[0]===t[1]&&(t[0]-=p,t[1]+=p),t[1]===-1/0&&t[0]===1/0){var n=new Date;t[1]=+new Date(n.getFullYear(),n.getMonth(),n.getDate()),t[0]=t[1]-p}this.niceTicks(e.splitNumber,e.minInterval,e.maxInterval);var i=this._interval;e.fixMin||(t[0]=r.round(c(t[0]/i)*i)),e.fixMax||(t[1]=r.round(u(t[1]/i)*i))},niceTicks:function(e,t,n){e=e||10;var i=this._extent,s=i[1]-i[0],o=s/e;null!=t&&o<t&&(o=t),null!=n&&o>n&&(o=n);var l=v.length,d=g(v,o,0,l),h=v[Math.min(d,l-1)],f=h[1];if("year"===h[0]){var p=s/f,m=r.nice(p/e,!0);f*=m}var y=this.getSetting("useUTC")?0:60*new Date(+i[0]||+i[1]).getTimezoneOffset()*1e3,b=[Math.round(u((i[0]-y)/f)*f+y),Math.round(c((i[1]-y)/f)*f+y)];a.fixExtent(b,i),this._stepLvl=h,this._interval=f,this._niceExtent=b},parse:function(e){return+r.parseDate(e)}});i.each(["contain","normalize"],function(e){m.prototype[e]=function(t){return l[e].call(this,this.parse(t))}});var v=[["hh:mm:ss",d],["hh:mm:ss",5*d],["hh:mm:ss",10*d],["hh:mm:ss",15*d],["hh:mm:ss",30*d],["hh:mm\nMM-dd",h],["hh:mm\nMM-dd",5*h],["hh:mm\nMM-dd",10*h],["hh:mm\nMM-dd",15*h],["hh:mm\nMM-dd",30*h],["hh:mm\nMM-dd",f],["hh:mm\nMM-dd",2*f],["hh:mm\nMM-dd",6*f],["hh:mm\nMM-dd",12*f],["MM-dd\nyyyy",p],["MM-dd\nyyyy",2*p],["MM-dd\nyyyy",3*p],["MM-dd\nyyyy",4*p],["MM-dd\nyyyy",5*p],["MM-dd\nyyyy",6*p],["week",7*p],["MM-dd\nyyyy",10*p],["week",14*p],["week",21*p],["month",31*p],["week",42*p],["month",62*p],["week",42*p],["quarter",380*p/4],["month",31*p*4],["month",31*p*5],["half-year",380*p/2],["month",31*p*8],["month",31*p*10],["year",380*p]];m.create=function(e){return new m({useUTC:e.ecModel.get("useUTC")})};var y=m;e.exports=y},"217b":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("3301")),s=n("4f85"),a=s.extend({type:"series.line",dependencies:["grid","polar"],getInitialData:function(e,t){return r(this.getSource(),this)},defaultOption:{zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,hoverAnimation:!0,clipOverflow:!0,label:{position:"top"},lineStyle:{width:2,type:"solid"},step:!1,smooth:!1,smoothMonotone:null,symbol:"emptyCircle",symbolSize:4,symbolRotate:null,showSymbol:!0,showAllSymbol:"auto",connectNulls:!1,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:1/0}});e.exports=a},"22d1":function(e,t){var n={};n="object"===typeof wx&&"function"===typeof wx.getSystemInfoSync?{browser:{},os:{},node:!1,wxa:!0,canvasSupported:!0,svgSupported:!1,touchEventsSupported:!0}:"undefined"===typeof document&&"undefined"!==typeof self?{browser:{},os:{},node:!1,worker:!0,canvasSupported:!0}:"undefined"===typeof navigator?{browser:{},os:{},node:!0,worker:!1,canvasSupported:!0,svgSupported:!0}:r(navigator.userAgent);var i=n;function r(e){var t={},n={},i=e.match(/Firefox\/([\d.]+)/),r=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/.+?rv:(([\d.]+))/),s=e.match(/Edge\/([\d.]+)/),a=/micromessenger/i.test(e);return i&&(n.firefox=!0,n.version=i[1]),r&&(n.ie=!0,n.version=r[1]),s&&(n.edge=!0,n.version=s[1]),a&&(n.weChat=!0),{browser:n,os:t,node:!1,canvasSupported:!!document.createElement("canvas").getContext,svgSupported:"undefined"!==typeof SVGRect,touchEventsSupported:"ontouchstart"in window&&!n.ie&&!n.edge,pointerEventsSupported:"onpointerdown"in window&&(n.edge||n.ie&&n.version>=11)}}e.exports=i},2306:function(e,t,n){var i=n("6d8b"),r=n("342d"),s=n("41ef"),a=n("1687"),o=n("401b"),l=n("cbe5"),u=n("0cde"),c=n("0da8");t.Image=c;var d=n("e1fc");t.Group=d;var h=n("76a5");t.Text=h;var f=n("d9fc");t.Circle=f;var p=n("4aa2");t.Sector=p;var g=n("4573");t.Ring=g;var m=n("87b1");t.Polygon=m;var v=n("d498");t.Polyline=v;var y=n("c7a2");t.Rect=y;var b=n("cb11");t.Line=b;var _=n("ac0f");t.BezierCurve=_;var T=n("8d32");t.Arc=T;var S=n("d4c6");t.CompoundPath=S;var w=n("48a9");t.LinearGradient=w;var E=n("dded");t.RadialGradient=E;var x=n("9850");t.BoundingRect=x;var k=n("392f");t.IncrementalDisplayable=k;var A=Math.round,I=Math.max,C=Math.min,D={};function R(e){return l.extend(e)}function M(e,t){return r.extendFromString(e,t)}function L(e,t,n,i){var s=r.createFromString(e,t),a=s.getBoundingRect();return n&&("center"===i&&(n=O(n,a)),U(s,n)),s}function P(e,t,n){var i=new c({style:{image:e,x:t.x,y:t.y,width:t.width,height:t.height},onload:function(e){if("center"===n){var r={width:e.width,height:e.height};i.setStyle(O(t,r))}}});return i}function O(e,t){var n,i=t.width/t.height,r=e.height*i;r<=e.width?n=e.height:(r=e.width,n=r/i);var s=e.x+e.width/2,a=e.y+e.height/2;return{x:s-r/2,y:a-n/2,width:r,height:n}}var N=r.mergePath;function U(e,t){if(e.applyTransform){var n=e.getBoundingRect(),i=n.calculateTransform(t);e.applyTransform(i)}}function F(e){var t=e.shape,n=e.style.lineWidth;return A(2*t.x1)===A(2*t.x2)&&(t.x1=t.x2=j(t.x1,n,!0)),A(2*t.y1)===A(2*t.y2)&&(t.y1=t.y2=j(t.y1,n,!0)),e}function B(e){var t=e.shape,n=e.style.lineWidth,i=t.x,r=t.y,s=t.width,a=t.height;return t.x=j(t.x,n,!0),t.y=j(t.y,n,!0),t.width=Math.max(j(i+s,n,!1)-t.x,0===s?0:1),t.height=Math.max(j(r+a,n,!1)-t.y,0===a?0:1),e}function j(e,t,n){var i=A(2*e);return(i+A(t))%2===0?i/2:(i+(n?1:-1))/2}function V(e){return null!=e&&"none"!=e}function H(e){return"string"===typeof e?s.lift(e,-.1):e}function $(e){if(e.__hoverStlDirty){var t=e.style.stroke,n=e.style.fill,i=e.__hoverStl;i.fill=i.fill||(V(n)?H(n):null),i.stroke=i.stroke||(V(t)?H(t):null);var r={};for(var s in i)null!=i[s]&&(r[s]=e.style[s]);e.__normalStl=r,e.__hoverStlDirty=!1}}function G(e){if(!e.__isHover){if($(e),e.useHoverLayer)e.__zr&&e.__zr.addHover(e,e.__hoverStl);else{var t=e.style,n=t.insideRollbackOpt;n&&le(t),t.extendFrom(e.__hoverStl),n&&(oe(t,t.insideOriginalTextPosition,n),null==t.textFill&&(t.textFill=n.autoColor)),e.dirty(!1),e.z2+=1}e.__isHover=!0}}function z(e){if(e.__isHover){var t=e.__normalStl;e.useHoverLayer?e.__zr&&e.__zr.removeHover(e):(t&&e.setStyle(t),e.z2-=1),e.__isHover=!1}}function q(e){"group"===e.type?e.traverse(function(e){"group"!==e.type&&G(e)}):G(e)}function W(e){"group"===e.type?e.traverse(function(e){"group"!==e.type&&z(e)}):z(e)}function K(e,t){e.__hoverStl=e.hoverStyle||t||{},e.__hoverStlDirty=!0,e.__isHover&&$(e)}function Y(e){this.__hoverSilentOnTouch&&e.zrByTouch||!this.__isEmphasis&&q(this)}function X(e){this.__hoverSilentOnTouch&&e.zrByTouch||!this.__isEmphasis&&W(this)}function Q(){this.__isEmphasis=!0,q(this)}function Z(){this.__isEmphasis=!1,W(this)}function J(e,t,n){e.__hoverSilentOnTouch=n&&n.hoverSilentOnTouch,"group"===e.type?e.traverse(function(e){"group"!==e.type&&K(e,t)}):K(e,t),e.on("mouseover",Y).on("mouseout",X),e.on("emphasis",Q).on("normal",Z)}function ee(e,t,n,r,s,a,o){s=s||D;var l,u=s.labelFetcher,c=s.labelDataIndex,d=s.labelDimIndex,h=n.getShallow("show"),f=r.getShallow("show");(h||f)&&(u&&(l=u.getFormattedLabel(c,"normal",null,d)),null==l&&(l=i.isFunction(s.defaultText)?s.defaultText(c,s):s.defaultText));var p=h?l:null,g=f?i.retrieve2(u?u.getFormattedLabel(c,"emphasis",null,d):null,l):null;null==p&&null==g||(te(e,n,a,s),te(t,r,o,s,!0)),e.text=p,t.text=g}function te(e,t,n,r,s){return ie(e,t,r,s),n&&i.extend(e,n),e.host&&e.host.dirty&&e.host.dirty(!1),e}function ne(e,t,n){var i,r={isRectText:!0};!1===n?i=!0:r.autoColor=n,ie(e,t,r,i),e.host&&e.host.dirty&&e.host.dirty(!1)}function ie(e,t,n,r){if(n=n||D,n.isRectText){var s=t.getShallow("position")||(r?null:"inside");"outside"===s&&(s="top"),e.textPosition=s,e.textOffset=t.getShallow("offset");var a=t.getShallow("rotate");null!=a&&(a*=Math.PI/180),e.textRotation=a,e.textDistance=i.retrieve2(t.getShallow("distance"),r?null:5)}var o,l=t.ecModel,u=l&&l.option.textStyle,c=re(t);if(c)for(var d in o={},c)if(c.hasOwnProperty(d)){var h=t.getModel(["rich",d]);se(o[d]={},h,u,n,r)}return e.rich=o,se(e,t,u,n,r,!0),n.forceRich&&!n.textStyle&&(n.textStyle={}),e}function re(e){var t;while(e&&e!==e.ecModel){var n=(e.option||D).rich;if(n)for(var i in t=t||{},n)n.hasOwnProperty(i)&&(t[i]=1);e=e.parentModel}return t}function se(e,t,n,r,s,a){if(n=!s&&n||D,e.textFill=ae(t.getShallow("color"),r)||n.color,e.textStroke=ae(t.getShallow("textBorderColor"),r)||n.textBorderColor,e.textStrokeWidth=i.retrieve2(t.getShallow("textBorderWidth"),n.textBorderWidth),!s){if(a){var o=e.textPosition;e.insideRollback=oe(e,o,r),e.insideOriginalTextPosition=o,e.insideRollbackOpt=r}null==e.textFill&&(e.textFill=r.autoColor)}e.fontStyle=t.getShallow("fontStyle")||n.fontStyle,e.fontWeight=t.getShallow("fontWeight")||n.fontWeight,e.fontSize=t.getShallow("fontSize")||n.fontSize,e.fontFamily=t.getShallow("fontFamily")||n.fontFamily,e.textAlign=t.getShallow("align"),e.textVerticalAlign=t.getShallow("verticalAlign")||t.getShallow("baseline"),e.textLineHeight=t.getShallow("lineHeight"),e.textWidth=t.getShallow("width"),e.textHeight=t.getShallow("height"),e.textTag=t.getShallow("tag"),a&&r.disableBox||(e.textBackgroundColor=ae(t.getShallow("backgroundColor"),r),e.textPadding=t.getShallow("padding"),e.textBorderColor=ae(t.getShallow("borderColor"),r),e.textBorderWidth=t.getShallow("borderWidth"),e.textBorderRadius=t.getShallow("borderRadius"),e.textBoxShadowColor=t.getShallow("shadowColor"),e.textBoxShadowBlur=t.getShallow("shadowBlur"),e.textBoxShadowOffsetX=t.getShallow("shadowOffsetX"),e.textBoxShadowOffsetY=t.getShallow("shadowOffsetY")),e.textShadowColor=t.getShallow("textShadowColor")||n.textShadowColor,e.textShadowBlur=t.getShallow("textShadowBlur")||n.textShadowBlur,e.textShadowOffsetX=t.getShallow("textShadowOffsetX")||n.textShadowOffsetX,e.textShadowOffsetY=t.getShallow("textShadowOffsetY")||n.textShadowOffsetY}function ae(e,t){return"auto"!==e?e:t&&t.autoColor?t.autoColor:null}function oe(e,t,n){var i,r=n.useInsideStyle;return null==e.textFill&&!1!==r&&(!0===r||n.isRectText&&t&&"string"===typeof t&&t.indexOf("inside")>=0)&&(i={textFill:null,textStroke:e.textStroke,textStrokeWidth:e.textStrokeWidth},e.textFill="#fff",null==e.textStroke&&(e.textStroke=n.autoColor,null==e.textStrokeWidth&&(e.textStrokeWidth=2))),i}function le(e){var t=e.insideRollback;t&&(e.textFill=t.textFill,e.textStroke=t.textStroke,e.textStrokeWidth=t.textStrokeWidth)}function ue(e,t){var n=t||t.getModel("textStyle");return i.trim([e.fontStyle||n&&n.getShallow("fontStyle")||"",e.fontWeight||n&&n.getShallow("fontWeight")||"",(e.fontSize||n&&n.getShallow("fontSize")||12)+"px",e.fontFamily||n&&n.getShallow("fontFamily")||"sans-serif"].join(" "))}function ce(e,t,n,i,r,s){"function"===typeof r&&(s=r,r=null);var a=i&&i.isAnimationEnabled();if(a){var o=e?"Update":"",l=i.getShallow("animationDuration"+o),u=i.getShallow("animationEasing"+o),c=i.getShallow("animationDelay"+o);"function"===typeof c&&(c=c(r,i.getAnimationDelayParams?i.getAnimationDelayParams(t,r):null)),"function"===typeof l&&(l=l(r)),l>0?t.animateTo(n,l,c||0,u,s,!!s):(t.stopAnimation(),t.attr(n),s&&s())}else t.stopAnimation(),t.attr(n),s&&s()}function de(e,t,n,i,r){ce(!0,e,t,n,i,r)}function he(e,t,n,i,r){ce(!1,e,t,n,i,r)}function fe(e,t){var n=a.identity([]);while(e&&e!==t)a.mul(n,e.getLocalTransform(),n),e=e.parent;return n}function pe(e,t,n){return t&&!i.isArrayLike(t)&&(t=u.getLocalTransform(t)),n&&(t=a.invert([],t)),o.applyTransform([],e,t)}function ge(e,t,n){var i=0===t[4]||0===t[5]||0===t[0]?1:Math.abs(2*t[4]/t[0]),r=0===t[4]||0===t[5]||0===t[2]?1:Math.abs(2*t[4]/t[2]),s=["left"===e?-i:"right"===e?i:0,"top"===e?-r:"bottom"===e?r:0];return s=pe(s,t,n),Math.abs(s[0])>Math.abs(s[1])?s[0]>0?"right":"left":s[1]>0?"bottom":"top"}function me(e,t,n,r){if(e&&t){var s=a(e);t.traverse(function(e){if(!e.isGroup&&e.anid){var t=s[e.anid];if(t){var i=l(e);e.attr(l(t)),de(e,i,n,e.dataIndex)}}})}function a(e){var t={};return e.traverse(function(e){!e.isGroup&&e.anid&&(t[e.anid]=e)}),t}function l(e){var t={position:o.clone(e.position),rotation:e.rotation};return e.shape&&(t.shape=i.extend({},e.shape)),t}}function ve(e,t){return i.map(e,function(e){var n=e[0];n=I(n,t.x),n=C(n,t.x+t.width);var i=e[1];return i=I(i,t.y),i=C(i,t.y+t.height),[n,i]})}function ye(e,t){var n=I(e.x,t.x),i=C(e.x+e.width,t.x+t.width),r=I(e.y,t.y),s=C(e.y+e.height,t.y+t.height);if(i>=n&&s>=r)return{x:n,y:r,width:i-n,height:s-r}}function be(e,t,n){t=i.extend({rectHover:!0},t);var r=t.style={strokeNoScale:!0};if(n=n||{x:-1,y:-1,width:2,height:2},e)return 0===e.indexOf("image://")?(r.image=e.slice(8),i.defaults(r,n),new c(t)):L(e.replace("path://",""),t,n,"center")}t.extendShape=R,t.extendPath=M,t.makePath=L,t.makeImage=P,t.mergePath=N,t.resizePath=U,t.subPixelOptimizeLine=F,t.subPixelOptimizeRect=B,t.subPixelOptimize=j,t.setHoverStyle=J,t.setLabelStyle=ee,t.setTextStyle=te,t.setText=ne,t.getFont=ue,t.updateProps=de,t.initProps=he,t.getTransform=fe,t.applyTransform=pe,t.transformDirection=ge,t.groupTransition=me,t.clipPointsByRect=ve,t.clipRectByRect=ye,t.createIcon=be},"230e":function(e,t,n){var i=n("d3f4"),r=n("7726").document,s=i(r)&&i(r.createElement);e.exports=function(e){return s?r.createElement(e):{}}},"23c6":function(e,t,n){var i=n("2d95"),r=n("2b4c")("toStringTag"),s="Arguments"==i(function(){return arguments}()),a=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=a(t=Object(e),r))?n:s?i(t):"Object"==(o=i(t))&&"function"==typeof t.callee?"Arguments":o}},"26e1":function(e,t,n){var i=n("6d8b"),r=n("e0d3"),s=i.each,a=i.isObject,o=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function l(e){var t=e&&e.itemStyle;if(t)for(var n=0,r=o.length;n<r;n++){var s=o[n],a=t.normal,l=t.emphasis;a&&a[s]&&(e[s]=e[s]||{},e[s].normal?i.merge(e[s].normal,a[s]):e[s].normal=a[s],a[s]=null),l&&l[s]&&(e[s]=e[s]||{},e[s].emphasis?i.merge(e[s].emphasis,l[s]):e[s].emphasis=l[s],l[s]=null)}}function u(e,t,n){if(e&&e[t]&&(e[t].normal||e[t].emphasis)){var r=e[t].normal,s=e[t].emphasis;r&&(n?(e[t].normal=e[t].emphasis=null,i.defaults(e[t],r)):e[t]=r),s&&(e.emphasis=e.emphasis||{},e.emphasis[t]=s)}}function c(e){u(e,"itemStyle"),u(e,"lineStyle"),u(e,"areaStyle"),u(e,"label"),u(e,"labelLine"),u(e,"upperLabel"),u(e,"edgeLabel")}function d(e,t){var n=a(e)&&e[t],i=a(n)&&n.textStyle;if(i)for(var s=0,o=r.TEXT_STYLE_OPTIONS.length;s<o;s++){t=r.TEXT_STYLE_OPTIONS[s];i.hasOwnProperty(t)&&(n[t]=i[t])}}function h(e){e&&(c(e),d(e,"label"),e.emphasis&&d(e.emphasis,"label"))}function f(e){if(a(e)){l(e),c(e),d(e,"label"),d(e,"upperLabel"),d(e,"edgeLabel"),e.emphasis&&(d(e.emphasis,"label"),d(e.emphasis,"upperLabel"),d(e.emphasis,"edgeLabel"));var t=e.markPoint;t&&(l(t),h(t));var n=e.markLine;n&&(l(n),h(n));var r=e.markArea;r&&h(r);var s=e.data;if("graph"===e.type){s=s||e.nodes;var o=e.links||e.edges;if(o&&!i.isTypedArray(o))for(var f=0;f<o.length;f++)h(o[f]);i.each(e.categories,function(e){c(e)})}if(s&&!i.isTypedArray(s))for(f=0;f<s.length;f++)h(s[f]);t=e.markPoint;if(t&&t.data){var p=t.data;for(f=0;f<p.length;f++)h(p[f])}n=e.markLine;if(n&&n.data){var g=n.data;for(f=0;f<g.length;f++)i.isArray(g[f])?(h(g[f][0]),h(g[f][1])):h(g[f])}"gauge"===e.type?(d(e,"axisLabel"),d(e,"title"),d(e,"detail")):"treemap"===e.type?(u(e.breadcrumb,"itemStyle"),i.each(e.levels,function(e){c(e)})):"tree"===e.type&&c(e.leaves)}}function p(e){return i.isArray(e)?e:e?[e]:[]}function g(e){return(i.isArray(e)?e[0]:e)||{}}function m(e,t){s(p(e.series),function(e){a(e)&&f(e)});var n=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];t&&n.push("valueAxis","categoryAxis","logAxis","timeAxis"),s(n,function(t){s(p(e[t]),function(e){e&&(d(e,"axisLabel"),d(e.axisPointer,"label"))})}),s(p(e.parallel),function(e){var t=e&&e.parallelAxisDefault;d(t,"axisLabel"),d(t&&t.axisPointer,"label")}),s(p(e.calendar),function(e){u(e,"itemStyle"),d(e,"dayLabel"),d(e,"monthLabel"),d(e,"yearLabel")}),s(p(e.radar),function(e){d(e,"name")}),s(p(e.geo),function(e){a(e)&&(h(e),s(p(e.regions),function(e){h(e)}))}),s(p(e.timeline),function(e){h(e),u(e,"label"),u(e,"itemStyle"),u(e,"controlStyle",!0);var t=e.data;i.isArray(t)&&i.each(t,function(e){i.isObject(e)&&(u(e,"label"),u(e,"itemStyle"))})}),s(p(e.toolbox),function(e){u(e,"iconStyle"),s(e.feature,function(e){u(e,"iconStyle")})}),d(g(e.axisPointer),"label"),d(g(e.tooltip).axisPointer,"label")}e.exports=m},"27ee":function(e,t,n){var i=n("23c6"),r=n("2b4c")("iterator"),s=n("84f2");e.exports=n("8378").getIteratorMethod=function(e){if(void 0!=e)return e[r]||e["@@iterator"]||s[i(e)]}},"282b":function(e,t,n){var i=n("6d8b");function r(e){for(var t=0;t<e.length;t++)e[t][1]||(e[t][1]=e[t][0]);return function(t,n,r){for(var s={},a=0;a<e.length;a++){var o=e[a][1];if(!(n&&i.indexOf(n,o)>=0||r&&i.indexOf(r,o)<0)){var l=t.getShallow(o);null!=l&&(s[e[a][0]]=l)}}return s}}e.exports=r},2877:function(e,t,n){"use strict";function i(e,t,n,i,r,s,a,o){var l,u="function"===typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),i&&(u.functional=!0),s&&(u._scopeId="data-v-"+s),a?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},u._ssrRegister=l):r&&(l=o?function(){r.call(this,this.$root.$options.shadowRoot)}:r),l)if(u.functional){u._injectStyles=l;var c=u.render;u.render=function(e,t){return l.call(t),c(e,t)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:u}}n.d(t,"a",function(){return i})},"29a8":function(e,t){var n={toolbox:{brush:{title:{rect:"",polygon:"",lineX:"",lineY:"",keep:"",clear:""}},dataView:{title:"",lang:["","",""]},dataZoom:{title:{zoom:"",back:""}},magicType:{title:{line:"",bar:"",stack:"",tiled:""}},restore:{title:""},saveAsImage:{title:"",lang:[""]}},series:{typeNames:{pie:"",bar:"",line:"",scatter:"",effectScatter:"",radar:"",tree:"",treemap:"",boxplot:"",candlestick:"K",k:"K",heatmap:"",map:"",parallel:"",lines:"",graph:"",sankey:"",funnel:"",gauge:"",pictorialBar:"",themeRiver:"",sunburst:""}},aria:{general:{withTitle:"{title}",withoutTitle:""},series:{single:{prefix:"",withName:"{seriesType}{seriesName}",withoutName:"{seriesType}"},multiple:{prefix:"{seriesCount}",withName:"{seriesId}{seriesName}{seriesType}",withoutName:"{seriesId}{seriesType}",separator:{middle:"",end:""}}},data:{allData:"",partialData:"{displayCnt}",withName:"{name}{value}",withoutName:"{value}",separator:{middle:"",end:""}}}};e.exports=n},"2aba":function(e,t,n){var i=n("7726"),r=n("32e9"),s=n("69a8"),a=n("ca5a")("src"),o="toString",l=Function[o],u=(""+l).split(o);n("8378").inspectSource=function(e){return l.call(e)},(e.exports=function(e,t,n,o){var l="function"==typeof n;l&&(s(n,"name")||r(n,"name",t)),e[t]!==n&&(l&&(s(n,a)||r(n,a,e[t]?""+e[t]:u.join(String(t)))),e===i?e[t]=n:o?e[t]?e[t]=n:r(e,t,n):(delete e[t],r(e,t,n)))})(Function.prototype,o,function(){return"function"==typeof this&&this[a]||l.call(this)})},"2aeb":function(e,t,n){var i=n("cb7c"),r=n("1495"),s=n("e11e"),a=n("613b")("IE_PROTO"),o=function(){},l="prototype",u=function(){var e,t=n("230e")("iframe"),i=s.length,r="<",a=">";t.style.display="none",n("fab2").appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(r+"script"+a+"document.F=Object"+r+"/script"+a),e.close(),u=e.F;while(i--)delete u[l][s[i]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(o[l]=i(e),n=new o,o[l]=null,n[a]=e):n=u(),void 0===t?n:r(n,t)}},"2b0e":function(e,t,n){"use strict";(function(e){
/*!
 * Vue.js v2.5.17
 * (c) 2014-2018 Evan You
 * Released under the MIT License.
 */
var n=Object.freeze({});function i(e){return void 0===e||null===e}function r(e){return void 0!==e&&null!==e}function s(e){return!0===e}function a(e){return!1===e}function o(e){return"string"===typeof e||"number"===typeof e||"symbol"===typeof e||"boolean"===typeof e}function l(e){return null!==e&&"object"===typeof e}var u=Object.prototype.toString;function c(e){return"[object Object]"===u.call(e)}function d(e){return"[object RegExp]"===u.call(e)}function h(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}function f(e){return null==e?"":"object"===typeof e?JSON.stringify(e,null,2):String(e)}function p(e){var t=parseFloat(e);return isNaN(t)?e:t}function g(e,t){for(var n=Object.create(null),i=e.split(","),r=0;r<i.length;r++)n[i[r]]=!0;return t?function(e){return n[e.toLowerCase()]}:function(e){return n[e]}}g("slot,component",!0);var m=g("key,ref,slot,slot-scope,is");function v(e,t){if(e.length){var n=e.indexOf(t);if(n>-1)return e.splice(n,1)}}var y=Object.prototype.hasOwnProperty;function b(e,t){return y.call(e,t)}function _(e){var t=Object.create(null);return function(n){var i=t[n];return i||(t[n]=e(n))}}var T=/-(\w)/g,S=_(function(e){return e.replace(T,function(e,t){return t?t.toUpperCase():""})}),w=_(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}),E=/\B([A-Z])/g,x=_(function(e){return e.replace(E,"-$1").toLowerCase()});function k(e,t){function n(n){var i=arguments.length;return i?i>1?e.apply(t,arguments):e.call(t,n):e.call(t)}return n._length=e.length,n}function A(e,t){return e.bind(t)}var I=Function.prototype.bind?A:k;function C(e,t){t=t||0;var n=e.length-t,i=new Array(n);while(n--)i[n]=e[n+t];return i}function D(e,t){for(var n in t)e[n]=t[n];return e}function R(e){for(var t={},n=0;n<e.length;n++)e[n]&&D(t,e[n]);return t}function M(e,t,n){}var L=function(e,t,n){return!1},P=function(e){return e};function O(e,t){if(e===t)return!0;var n=l(e),i=l(t);if(!n||!i)return!n&&!i&&String(e)===String(t);try{var r=Array.isArray(e),s=Array.isArray(t);if(r&&s)return e.length===t.length&&e.every(function(e,n){return O(e,t[n])});if(r||s)return!1;var a=Object.keys(e),o=Object.keys(t);return a.length===o.length&&a.every(function(n){return O(e[n],t[n])})}catch(e){return!1}}function N(e,t){for(var n=0;n<e.length;n++)if(O(e[n],t))return n;return-1}function U(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}}var F="data-server-rendered",B=["component","directive","filter"],j=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured"],V={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:L,isReservedAttr:L,isUnknownElement:L,getTagNamespace:M,parsePlatformTagName:P,mustUseProp:L,_lifecycleHooks:j};function H(e){var t=(e+"").charCodeAt(0);return 36===t||95===t}function $(e,t,n,i){Object.defineProperty(e,t,{value:n,enumerable:!!i,writable:!0,configurable:!0})}var G=/[^\w.$]/;function z(e){if(!G.test(e)){var t=e.split(".");return function(e){for(var n=0;n<t.length;n++){if(!e)return;e=e[t[n]]}return e}}}var q,W="__proto__"in{},K="undefined"!==typeof window,Y="undefined"!==typeof WXEnvironment&&!!WXEnvironment.platform,X=Y&&WXEnvironment.platform.toLowerCase(),Q=K&&window.navigator.userAgent.toLowerCase(),Z=Q&&/msie|trident/.test(Q),J=Q&&Q.indexOf("msie 9.0")>0,ee=Q&&Q.indexOf("edge/")>0,te=(Q&&Q.indexOf("android"),Q&&/iphone|ipad|ipod|ios/.test(Q)||"ios"===X),ne=(Q&&/chrome\/\d+/.test(Q),{}.watch),ie=!1;if(K)try{var re={};Object.defineProperty(re,"passive",{get:function(){ie=!0}}),window.addEventListener("test-passive",null,re)}catch(e){}var se=function(){return void 0===q&&(q=!K&&!Y&&"undefined"!==typeof e&&"server"===e["process"].env.VUE_ENV),q},ae=K&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function oe(e){return"function"===typeof e&&/native code/.test(e.toString())}var le,ue="undefined"!==typeof Symbol&&oe(Symbol)&&"undefined"!==typeof Reflect&&oe(Reflect.ownKeys);le="undefined"!==typeof Set&&oe(Set)?Set:function(){function e(){this.set=Object.create(null)}return e.prototype.has=function(e){return!0===this.set[e]},e.prototype.add=function(e){this.set[e]=!0},e.prototype.clear=function(){this.set=Object.create(null)},e}();var ce=M,de=0,he=function(){this.id=de++,this.subs=[]};he.prototype.addSub=function(e){this.subs.push(e)},he.prototype.removeSub=function(e){v(this.subs,e)},he.prototype.depend=function(){he.target&&he.target.addDep(this)},he.prototype.notify=function(){for(var e=this.subs.slice(),t=0,n=e.length;t<n;t++)e[t].update()},he.target=null;var fe=[];function pe(e){he.target&&fe.push(he.target),he.target=e}function ge(){he.target=fe.pop()}var me=function(e,t,n,i,r,s,a,o){this.tag=e,this.data=t,this.children=n,this.text=i,this.elm=r,this.ns=void 0,this.context=s,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=t&&t.key,this.componentOptions=a,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=o,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},ve={child:{configurable:!0}};ve.child.get=function(){return this.componentInstance},Object.defineProperties(me.prototype,ve);var ye=function(e){void 0===e&&(e="");var t=new me;return t.text=e,t.isComment=!0,t};function be(e){return new me(void 0,void 0,void 0,String(e))}function _e(e){var t=new me(e.tag,e.data,e.children,e.text,e.elm,e.context,e.componentOptions,e.asyncFactory);return t.ns=e.ns,t.isStatic=e.isStatic,t.key=e.key,t.isComment=e.isComment,t.fnContext=e.fnContext,t.fnOptions=e.fnOptions,t.fnScopeId=e.fnScopeId,t.isCloned=!0,t}var Te=Array.prototype,Se=Object.create(Te),we=["push","pop","shift","unshift","splice","sort","reverse"];we.forEach(function(e){var t=Te[e];$(Se,e,function(){var n=[],i=arguments.length;while(i--)n[i]=arguments[i];var r,s=t.apply(this,n),a=this.__ob__;switch(e){case"push":case"unshift":r=n;break;case"splice":r=n.slice(2);break}return r&&a.observeArray(r),a.dep.notify(),s})});var Ee=Object.getOwnPropertyNames(Se),xe=!0;function ke(e){xe=e}var Ae=function(e){if(this.value=e,this.dep=new he,this.vmCount=0,$(e,"__ob__",this),Array.isArray(e)){var t=W?Ie:Ce;t(e,Se,Ee),this.observeArray(e)}else this.walk(e)};function Ie(e,t,n){e.__proto__=t}function Ce(e,t,n){for(var i=0,r=n.length;i<r;i++){var s=n[i];$(e,s,t[s])}}function De(e,t){var n;if(l(e)&&!(e instanceof me))return b(e,"__ob__")&&e.__ob__ instanceof Ae?n=e.__ob__:xe&&!se()&&(Array.isArray(e)||c(e))&&Object.isExtensible(e)&&!e._isVue&&(n=new Ae(e)),t&&n&&n.vmCount++,n}function Re(e,t,n,i,r){var s=new he,a=Object.getOwnPropertyDescriptor(e,t);if(!a||!1!==a.configurable){var o=a&&a.get;o||2!==arguments.length||(n=e[t]);var l=a&&a.set,u=!r&&De(n);Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){var t=o?o.call(e):n;return he.target&&(s.depend(),u&&(u.dep.depend(),Array.isArray(t)&&Pe(t))),t},set:function(t){var i=o?o.call(e):n;t===i||t!==t&&i!==i||(l?l.call(e,t):n=t,u=!r&&De(t),s.notify())}})}}function Me(e,t,n){if(Array.isArray(e)&&h(t))return e.length=Math.max(e.length,t),e.splice(t,1,n),n;if(t in e&&!(t in Object.prototype))return e[t]=n,n;var i=e.__ob__;return e._isVue||i&&i.vmCount?n:i?(Re(i.value,t,n),i.dep.notify(),n):(e[t]=n,n)}function Le(e,t){if(Array.isArray(e)&&h(t))e.splice(t,1);else{var n=e.__ob__;e._isVue||n&&n.vmCount||b(e,t)&&(delete e[t],n&&n.dep.notify())}}function Pe(e){for(var t=void 0,n=0,i=e.length;n<i;n++)t=e[n],t&&t.__ob__&&t.__ob__.dep.depend(),Array.isArray(t)&&Pe(t)}Ae.prototype.walk=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)Re(e,t[n])},Ae.prototype.observeArray=function(e){for(var t=0,n=e.length;t<n;t++)De(e[t])};var Oe=V.optionMergeStrategies;function Ne(e,t){if(!t)return e;for(var n,i,r,s=Object.keys(t),a=0;a<s.length;a++)n=s[a],i=e[n],r=t[n],b(e,n)?c(i)&&c(r)&&Ne(i,r):Me(e,n,r);return e}function Ue(e,t,n){return n?function(){var i="function"===typeof t?t.call(n,n):t,r="function"===typeof e?e.call(n,n):e;return i?Ne(i,r):r}:t?e?function(){return Ne("function"===typeof t?t.call(this,this):t,"function"===typeof e?e.call(this,this):e)}:t:e}function Fe(e,t){return t?e?e.concat(t):Array.isArray(t)?t:[t]:e}function Be(e,t,n,i){var r=Object.create(e||null);return t?D(r,t):r}Oe.data=function(e,t,n){return n?Ue(e,t,n):t&&"function"!==typeof t?e:Ue(e,t)},j.forEach(function(e){Oe[e]=Fe}),B.forEach(function(e){Oe[e+"s"]=Be}),Oe.watch=function(e,t,n,i){if(e===ne&&(e=void 0),t===ne&&(t=void 0),!t)return Object.create(e||null);if(!e)return t;var r={};for(var s in D(r,e),t){var a=r[s],o=t[s];a&&!Array.isArray(a)&&(a=[a]),r[s]=a?a.concat(o):Array.isArray(o)?o:[o]}return r},Oe.props=Oe.methods=Oe.inject=Oe.computed=function(e,t,n,i){if(!e)return t;var r=Object.create(null);return D(r,e),t&&D(r,t),r},Oe.provide=Ue;var je=function(e,t){return void 0===t?e:t};function Ve(e,t){var n=e.props;if(n){var i,r,s,a={};if(Array.isArray(n)){i=n.length;while(i--)r=n[i],"string"===typeof r&&(s=S(r),a[s]={type:null})}else if(c(n))for(var o in n)r=n[o],s=S(o),a[s]=c(r)?r:{type:r};else 0;e.props=a}}function He(e,t){var n=e.inject;if(n){var i=e.inject={};if(Array.isArray(n))for(var r=0;r<n.length;r++)i[n[r]]={from:n[r]};else if(c(n))for(var s in n){var a=n[s];i[s]=c(a)?D({from:s},a):{from:a}}else 0}}function $e(e){var t=e.directives;if(t)for(var n in t){var i=t[n];"function"===typeof i&&(t[n]={bind:i,update:i})}}function Ge(e,t,n){"function"===typeof t&&(t=t.options),Ve(t,n),He(t,n),$e(t);var i=t.extends;if(i&&(e=Ge(e,i,n)),t.mixins)for(var r=0,s=t.mixins.length;r<s;r++)e=Ge(e,t.mixins[r],n);var a,o={};for(a in e)l(a);for(a in t)b(e,a)||l(a);function l(i){var r=Oe[i]||je;o[i]=r(e[i],t[i],n,i)}return o}function ze(e,t,n,i){if("string"===typeof n){var r=e[t];if(b(r,n))return r[n];var s=S(n);if(b(r,s))return r[s];var a=w(s);if(b(r,a))return r[a];var o=r[n]||r[s]||r[a];return o}}function qe(e,t,n,i){var r=t[e],s=!b(n,e),a=n[e],o=Xe(Boolean,r.type);if(o>-1)if(s&&!b(r,"default"))a=!1;else if(""===a||a===x(e)){var l=Xe(String,r.type);(l<0||o<l)&&(a=!0)}if(void 0===a){a=We(i,r,e);var u=xe;ke(!0),De(a),ke(u)}return a}function We(e,t,n){if(b(t,"default")){var i=t.default;return e&&e.$options.propsData&&void 0===e.$options.propsData[n]&&void 0!==e._props[n]?e._props[n]:"function"===typeof i&&"Function"!==Ke(t.type)?i.call(e):i}}function Ke(e){var t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:""}function Ye(e,t){return Ke(e)===Ke(t)}function Xe(e,t){if(!Array.isArray(t))return Ye(t,e)?0:-1;for(var n=0,i=t.length;n<i;n++)if(Ye(t[n],e))return n;return-1}function Qe(e,t,n){if(t){var i=t;while(i=i.$parent){var r=i.$options.errorCaptured;if(r)for(var s=0;s<r.length;s++)try{var a=!1===r[s].call(i,e,t,n);if(a)return}catch(e){Ze(e,i,"errorCaptured hook")}}}Ze(e,t,n)}function Ze(e,t,n){if(V.errorHandler)try{return V.errorHandler.call(null,e,t,n)}catch(e){Je(e,null,"config.errorHandler")}Je(e,t,n)}function Je(e,t,n){if(!K&&!Y||"undefined"===typeof console)throw e;console.error(e)}var et,tt,nt=[],it=!1;function rt(){it=!1;var e=nt.slice(0);nt.length=0;for(var t=0;t<e.length;t++)e[t]()}var st=!1;if("undefined"!==typeof setImmediate&&oe(setImmediate))tt=function(){setImmediate(rt)};else if("undefined"===typeof MessageChannel||!oe(MessageChannel)&&"[object MessageChannelConstructor]"!==MessageChannel.toString())tt=function(){setTimeout(rt,0)};else{var at=new MessageChannel,ot=at.port2;at.port1.onmessage=rt,tt=function(){ot.postMessage(1)}}if("undefined"!==typeof Promise&&oe(Promise)){var lt=Promise.resolve();et=function(){lt.then(rt),te&&setTimeout(M)}}else et=tt;function ut(e){return e._withTask||(e._withTask=function(){st=!0;var t=e.apply(null,arguments);return st=!1,t})}function ct(e,t){var n;if(nt.push(function(){if(e)try{e.call(t)}catch(e){Qe(e,t,"nextTick")}else n&&n(t)}),it||(it=!0,st?tt():et()),!e&&"undefined"!==typeof Promise)return new Promise(function(e){n=e})}var dt=new le;function ht(e){ft(e,dt),dt.clear()}function ft(e,t){var n,i,r=Array.isArray(e);if(!(!r&&!l(e)||Object.isFrozen(e)||e instanceof me)){if(e.__ob__){var s=e.__ob__.dep.id;if(t.has(s))return;t.add(s)}if(r){n=e.length;while(n--)ft(e[n],t)}else{i=Object.keys(e),n=i.length;while(n--)ft(e[i[n]],t)}}}var pt,gt=_(function(e){var t="&"===e.charAt(0);e=t?e.slice(1):e;var n="~"===e.charAt(0);e=n?e.slice(1):e;var i="!"===e.charAt(0);return e=i?e.slice(1):e,{name:e,once:n,capture:i,passive:t}});function mt(e){function t(){var e=arguments,n=t.fns;if(!Array.isArray(n))return n.apply(null,arguments);for(var i=n.slice(),r=0;r<i.length;r++)i[r].apply(null,e)}return t.fns=e,t}function vt(e,t,n,r,s){var a,o,l,u;for(a in e)o=e[a],l=t[a],u=gt(a),i(o)||(i(l)?(i(o.fns)&&(o=e[a]=mt(o)),n(u.name,o,u.once,u.capture,u.passive,u.params)):o!==l&&(l.fns=o,e[a]=l));for(a in t)i(e[a])&&(u=gt(a),r(u.name,t[a],u.capture))}function yt(e,t,n){var a;e instanceof me&&(e=e.data.hook||(e.data.hook={}));var o=e[t];function l(){n.apply(this,arguments),v(a.fns,l)}i(o)?a=mt([l]):r(o.fns)&&s(o.merged)?(a=o,a.fns.push(l)):a=mt([o,l]),a.merged=!0,e[t]=a}function bt(e,t,n){var s=t.options.props;if(!i(s)){var a={},o=e.attrs,l=e.props;if(r(o)||r(l))for(var u in s){var c=x(u);_t(a,l,u,c,!0)||_t(a,o,u,c,!1)}return a}}function _t(e,t,n,i,s){if(r(t)){if(b(t,n))return e[n]=t[n],s||delete t[n],!0;if(b(t,i))return e[n]=t[i],s||delete t[i],!0}return!1}function Tt(e){for(var t=0;t<e.length;t++)if(Array.isArray(e[t]))return Array.prototype.concat.apply([],e);return e}function St(e){return o(e)?[be(e)]:Array.isArray(e)?Et(e):void 0}function wt(e){return r(e)&&r(e.text)&&a(e.isComment)}function Et(e,t){var n,a,l,u,c=[];for(n=0;n<e.length;n++)a=e[n],i(a)||"boolean"===typeof a||(l=c.length-1,u=c[l],Array.isArray(a)?a.length>0&&(a=Et(a,(t||"")+"_"+n),wt(a[0])&&wt(u)&&(c[l]=be(u.text+a[0].text),a.shift()),c.push.apply(c,a)):o(a)?wt(u)?c[l]=be(u.text+a):""!==a&&c.push(be(a)):wt(a)&&wt(u)?c[l]=be(u.text+a.text):(s(e._isVList)&&r(a.tag)&&i(a.key)&&r(t)&&(a.key="__vlist"+t+"_"+n+"__"),c.push(a)));return c}function xt(e,t){return(e.__esModule||ue&&"Module"===e[Symbol.toStringTag])&&(e=e.default),l(e)?t.extend(e):e}function kt(e,t,n,i,r){var s=ye();return s.asyncFactory=e,s.asyncMeta={data:t,context:n,children:i,tag:r},s}function At(e,t,n){if(s(e.error)&&r(e.errorComp))return e.errorComp;if(r(e.resolved))return e.resolved;if(s(e.loading)&&r(e.loadingComp))return e.loadingComp;if(!r(e.contexts)){var a=e.contexts=[n],o=!0,u=function(){for(var e=0,t=a.length;e<t;e++)a[e].$forceUpdate()},c=U(function(n){e.resolved=xt(n,t),o||u()}),d=U(function(t){r(e.errorComp)&&(e.error=!0,u())}),h=e(c,d);return l(h)&&("function"===typeof h.then?i(e.resolved)&&h.then(c,d):r(h.component)&&"function"===typeof h.component.then&&(h.component.then(c,d),r(h.error)&&(e.errorComp=xt(h.error,t)),r(h.loading)&&(e.loadingComp=xt(h.loading,t),0===h.delay?e.loading=!0:setTimeout(function(){i(e.resolved)&&i(e.error)&&(e.loading=!0,u())},h.delay||200)),r(h.timeout)&&setTimeout(function(){i(e.resolved)&&d(null)},h.timeout))),o=!1,e.loading?e.loadingComp:e.resolved}e.contexts.push(n)}function It(e){return e.isComment&&e.asyncFactory}function Ct(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];if(r(n)&&(r(n.componentOptions)||It(n)))return n}}function Dt(e){e._events=Object.create(null),e._hasHookEvent=!1;var t=e.$options._parentListeners;t&&Lt(e,t)}function Rt(e,t,n){n?pt.$once(e,t):pt.$on(e,t)}function Mt(e,t){pt.$off(e,t)}function Lt(e,t,n){pt=e,vt(t,n||{},Rt,Mt,e),pt=void 0}function Pt(e){var t=/^hook:/;e.prototype.$on=function(e,n){var i=this,r=this;if(Array.isArray(e))for(var s=0,a=e.length;s<a;s++)i.$on(e[s],n);else(r._events[e]||(r._events[e]=[])).push(n),t.test(e)&&(r._hasHookEvent=!0);return r},e.prototype.$once=function(e,t){var n=this;function i(){n.$off(e,i),t.apply(n,arguments)}return i.fn=t,n.$on(e,i),n},e.prototype.$off=function(e,t){var n=this,i=this;if(!arguments.length)return i._events=Object.create(null),i;if(Array.isArray(e)){for(var r=0,s=e.length;r<s;r++)n.$off(e[r],t);return i}var a=i._events[e];if(!a)return i;if(!t)return i._events[e]=null,i;if(t){var o,l=a.length;while(l--)if(o=a[l],o===t||o.fn===t){a.splice(l,1);break}}return i},e.prototype.$emit=function(e){var t=this,n=t._events[e];if(n){n=n.length>1?C(n):n;for(var i=C(arguments,1),r=0,s=n.length;r<s;r++)try{n[r].apply(t,i)}catch(n){Qe(n,t,'event handler for "'+e+'"')}}return t}}function Ot(e,t){var n={};if(!e)return n;for(var i=0,r=e.length;i<r;i++){var s=e[i],a=s.data;if(a&&a.attrs&&a.attrs.slot&&delete a.attrs.slot,s.context!==t&&s.fnContext!==t||!a||null==a.slot)(n.default||(n.default=[])).push(s);else{var o=a.slot,l=n[o]||(n[o]=[]);"template"===s.tag?l.push.apply(l,s.children||[]):l.push(s)}}for(var u in n)n[u].every(Nt)&&delete n[u];return n}function Nt(e){return e.isComment&&!e.asyncFactory||" "===e.text}function Ut(e,t){t=t||{};for(var n=0;n<e.length;n++)Array.isArray(e[n])?Ut(e[n],t):t[e[n].key]=e[n].fn;return t}var Ft=null;function Bt(e){var t=e.$options,n=t.parent;if(n&&!t.abstract){while(n.$options.abstract&&n.$parent)n=n.$parent;n.$children.push(e)}e.$parent=n,e.$root=n?n.$root:e,e.$children=[],e.$refs={},e._watcher=null,e._inactive=null,e._directInactive=!1,e._isMounted=!1,e._isDestroyed=!1,e._isBeingDestroyed=!1}function jt(e){e.prototype._update=function(e,t){var n=this;n._isMounted&&qt(n,"beforeUpdate");var i=n.$el,r=n._vnode,s=Ft;Ft=n,n._vnode=e,r?n.$el=n.__patch__(r,e):(n.$el=n.__patch__(n.$el,e,t,!1,n.$options._parentElm,n.$options._refElm),n.$options._parentElm=n.$options._refElm=null),Ft=s,i&&(i.__vue__=null),n.$el&&(n.$el.__vue__=n),n.$vnode&&n.$parent&&n.$vnode===n.$parent._vnode&&(n.$parent.$el=n.$el)},e.prototype.$forceUpdate=function(){var e=this;e._watcher&&e._watcher.update()},e.prototype.$destroy=function(){var e=this;if(!e._isBeingDestroyed){qt(e,"beforeDestroy"),e._isBeingDestroyed=!0;var t=e.$parent;!t||t._isBeingDestroyed||e.$options.abstract||v(t.$children,e),e._watcher&&e._watcher.teardown();var n=e._watchers.length;while(n--)e._watchers[n].teardown();e._data.__ob__&&e._data.__ob__.vmCount--,e._isDestroyed=!0,e.__patch__(e._vnode,null),qt(e,"destroyed"),e.$off(),e.$el&&(e.$el.__vue__=null),e.$vnode&&(e.$vnode.parent=null)}}}function Vt(e,t,n){var i;return e.$el=t,e.$options.render||(e.$options.render=ye),qt(e,"beforeMount"),i=function(){e._update(e._render(),n)},new on(e,i,M,null,!0),n=!1,null==e.$vnode&&(e._isMounted=!0,qt(e,"mounted")),e}function Ht(e,t,i,r,s){var a=!!(s||e.$options._renderChildren||r.data.scopedSlots||e.$scopedSlots!==n);if(e.$options._parentVnode=r,e.$vnode=r,e._vnode&&(e._vnode.parent=r),e.$options._renderChildren=s,e.$attrs=r.data.attrs||n,e.$listeners=i||n,t&&e.$options.props){ke(!1);for(var o=e._props,l=e.$options._propKeys||[],u=0;u<l.length;u++){var c=l[u],d=e.$options.props;o[c]=qe(c,d,t,e)}ke(!0),e.$options.propsData=t}i=i||n;var h=e.$options._parentListeners;e.$options._parentListeners=i,Lt(e,i,h),a&&(e.$slots=Ot(s,r.context),e.$forceUpdate())}function $t(e){while(e&&(e=e.$parent))if(e._inactive)return!0;return!1}function Gt(e,t){if(t){if(e._directInactive=!1,$t(e))return}else if(e._directInactive)return;if(e._inactive||null===e._inactive){e._inactive=!1;for(var n=0;n<e.$children.length;n++)Gt(e.$children[n]);qt(e,"activated")}}function zt(e,t){if((!t||(e._directInactive=!0,!$t(e)))&&!e._inactive){e._inactive=!0;for(var n=0;n<e.$children.length;n++)zt(e.$children[n]);qt(e,"deactivated")}}function qt(e,t){pe();var n=e.$options[t];if(n)for(var i=0,r=n.length;i<r;i++)try{n[i].call(e)}catch(n){Qe(n,e,t+" hook")}e._hasHookEvent&&e.$emit("hook:"+t),ge()}var Wt=[],Kt=[],Yt={},Xt=!1,Qt=!1,Zt=0;function Jt(){Zt=Wt.length=Kt.length=0,Yt={},Xt=Qt=!1}function en(){var e,t;for(Qt=!0,Wt.sort(function(e,t){return e.id-t.id}),Zt=0;Zt<Wt.length;Zt++)e=Wt[Zt],t=e.id,Yt[t]=null,e.run();var n=Kt.slice(),i=Wt.slice();Jt(),rn(n),tn(i),ae&&V.devtools&&ae.emit("flush")}function tn(e){var t=e.length;while(t--){var n=e[t],i=n.vm;i._watcher===n&&i._isMounted&&qt(i,"updated")}}function nn(e){e._inactive=!1,Kt.push(e)}function rn(e){for(var t=0;t<e.length;t++)e[t]._inactive=!0,Gt(e[t],!0)}function sn(e){var t=e.id;if(null==Yt[t]){if(Yt[t]=!0,Qt){var n=Wt.length-1;while(n>Zt&&Wt[n].id>e.id)n--;Wt.splice(n+1,0,e)}else Wt.push(e);Xt||(Xt=!0,ct(en))}}var an=0,on=function(e,t,n,i,r){this.vm=e,r&&(e._watcher=this),e._watchers.push(this),i?(this.deep=!!i.deep,this.user=!!i.user,this.lazy=!!i.lazy,this.sync=!!i.sync):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++an,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new le,this.newDepIds=new le,this.expression="","function"===typeof t?this.getter=t:(this.getter=z(t),this.getter||(this.getter=function(){})),this.value=this.lazy?void 0:this.get()};on.prototype.get=function(){var e;pe(this);var t=this.vm;try{e=this.getter.call(t,t)}catch(e){if(!this.user)throw e;Qe(e,t,'getter for watcher "'+this.expression+'"')}finally{this.deep&&ht(e),ge(),this.cleanupDeps()}return e},on.prototype.addDep=function(e){var t=e.id;this.newDepIds.has(t)||(this.newDepIds.add(t),this.newDeps.push(e),this.depIds.has(t)||e.addSub(this))},on.prototype.cleanupDeps=function(){var e=this,t=this.deps.length;while(t--){var n=e.deps[t];e.newDepIds.has(n.id)||n.removeSub(e)}var i=this.depIds;this.depIds=this.newDepIds,this.newDepIds=i,this.newDepIds.clear(),i=this.deps,this.deps=this.newDeps,this.newDeps=i,this.newDeps.length=0},on.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():sn(this)},on.prototype.run=function(){if(this.active){var e=this.get();if(e!==this.value||l(e)||this.deep){var t=this.value;if(this.value=e,this.user)try{this.cb.call(this.vm,e,t)}catch(e){Qe(e,this.vm,'callback for watcher "'+this.expression+'"')}else this.cb.call(this.vm,e,t)}}},on.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},on.prototype.depend=function(){var e=this,t=this.deps.length;while(t--)e.deps[t].depend()},on.prototype.teardown=function(){var e=this;if(this.active){this.vm._isBeingDestroyed||v(this.vm._watchers,this);var t=this.deps.length;while(t--)e.deps[t].removeSub(e);this.active=!1}};var ln={enumerable:!0,configurable:!0,get:M,set:M};function un(e,t,n){ln.get=function(){return this[t][n]},ln.set=function(e){this[t][n]=e},Object.defineProperty(e,n,ln)}function cn(e){e._watchers=[];var t=e.$options;t.props&&dn(e,t.props),t.methods&&yn(e,t.methods),t.data?hn(e):De(e._data={},!0),t.computed&&gn(e,t.computed),t.watch&&t.watch!==ne&&bn(e,t.watch)}function dn(e,t){var n=e.$options.propsData||{},i=e._props={},r=e.$options._propKeys=[],s=!e.$parent;s||ke(!1);var a=function(s){r.push(s);var a=qe(s,t,n,e);Re(i,s,a),s in e||un(e,"_props",s)};for(var o in t)a(o);ke(!0)}function hn(e){var t=e.$options.data;t=e._data="function"===typeof t?fn(t,e):t||{},c(t)||(t={});var n=Object.keys(t),i=e.$options.props,r=(e.$options.methods,n.length);while(r--){var s=n[r];0,i&&b(i,s)||H(s)||un(e,"_data",s)}De(t,!0)}function fn(e,t){pe();try{return e.call(t,t)}catch(e){return Qe(e,t,"data()"),{}}finally{ge()}}var pn={lazy:!0};function gn(e,t){var n=e._computedWatchers=Object.create(null),i=se();for(var r in t){var s=t[r],a="function"===typeof s?s:s.get;0,i||(n[r]=new on(e,a||M,M,pn)),r in e||mn(e,r,s)}}function mn(e,t,n){var i=!se();"function"===typeof n?(ln.get=i?vn(t):n,ln.set=M):(ln.get=n.get?i&&!1!==n.cache?vn(t):n.get:M,ln.set=n.set?n.set:M),Object.defineProperty(e,t,ln)}function vn(e){return function(){var t=this._computedWatchers&&this._computedWatchers[e];if(t)return t.dirty&&t.evaluate(),he.target&&t.depend(),t.value}}function yn(e,t){e.$options.props;for(var n in t)e[n]=null==t[n]?M:I(t[n],e)}function bn(e,t){for(var n in t){var i=t[n];if(Array.isArray(i))for(var r=0;r<i.length;r++)_n(e,n,i[r]);else _n(e,n,i)}}function _n(e,t,n,i){return c(n)&&(i=n,n=n.handler),"string"===typeof n&&(n=e[n]),e.$watch(t,n,i)}function Tn(e){var t={get:function(){return this._data}},n={get:function(){return this._props}};Object.defineProperty(e.prototype,"$data",t),Object.defineProperty(e.prototype,"$props",n),e.prototype.$set=Me,e.prototype.$delete=Le,e.prototype.$watch=function(e,t,n){var i=this;if(c(t))return _n(i,e,t,n);n=n||{},n.user=!0;var r=new on(i,e,t,n);return n.immediate&&t.call(i,r.value),function(){r.teardown()}}}function Sn(e){var t=e.$options.provide;t&&(e._provided="function"===typeof t?t.call(e):t)}function wn(e){var t=En(e.$options.inject,e);t&&(ke(!1),Object.keys(t).forEach(function(n){Re(e,n,t[n])}),ke(!0))}function En(e,t){if(e){for(var n=Object.create(null),i=ue?Reflect.ownKeys(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}):Object.keys(e),r=0;r<i.length;r++){var s=i[r],a=e[s].from,o=t;while(o){if(o._provided&&b(o._provided,a)){n[s]=o._provided[a];break}o=o.$parent}if(!o)if("default"in e[s]){var l=e[s].default;n[s]="function"===typeof l?l.call(t):l}else 0}return n}}function xn(e,t){var n,i,s,a,o;if(Array.isArray(e)||"string"===typeof e)for(n=new Array(e.length),i=0,s=e.length;i<s;i++)n[i]=t(e[i],i);else if("number"===typeof e)for(n=new Array(e),i=0;i<e;i++)n[i]=t(i+1,i);else if(l(e))for(a=Object.keys(e),n=new Array(a.length),i=0,s=a.length;i<s;i++)o=a[i],n[i]=t(e[o],o,i);return r(n)&&(n._isVList=!0),n}function kn(e,t,n,i){var r,s=this.$scopedSlots[e];if(s)n=n||{},i&&(n=D(D({},i),n)),r=s(n)||t;else{var a=this.$slots[e];a&&(a._rendered=!0),r=a||t}var o=n&&n.slot;return o?this.$createElement("template",{slot:o},r):r}function An(e){return ze(this.$options,"filters",e,!0)||P}function In(e,t){return Array.isArray(e)?-1===e.indexOf(t):e!==t}function Cn(e,t,n,i,r){var s=V.keyCodes[t]||n;return r&&i&&!V.keyCodes[t]?In(r,i):s?In(s,e):i?x(i)!==t:void 0}function Dn(e,t,n,i,r){if(n)if(l(n)){var s;Array.isArray(n)&&(n=R(n));var a=function(a){if("class"===a||"style"===a||m(a))s=e;else{var o=e.attrs&&e.attrs.type;s=i||V.mustUseProp(t,o,a)?e.domProps||(e.domProps={}):e.attrs||(e.attrs={})}if(!(a in s)&&(s[a]=n[a],r)){var l=e.on||(e.on={});l["update:"+a]=function(e){n[a]=e}}};for(var o in n)a(o)}else;return e}function Rn(e,t){var n=this._staticTrees||(this._staticTrees=[]),i=n[e];return i&&!t?i:(i=n[e]=this.$options.staticRenderFns[e].call(this._renderProxy,null,this),Ln(i,"__static__"+e,!1),i)}function Mn(e,t,n){return Ln(e,"__once__"+t+(n?"_"+n:""),!0),e}function Ln(e,t,n){if(Array.isArray(e))for(var i=0;i<e.length;i++)e[i]&&"string"!==typeof e[i]&&Pn(e[i],t+"_"+i,n);else Pn(e,t,n)}function Pn(e,t,n){e.isStatic=!0,e.key=t,e.isOnce=n}function On(e,t){if(t)if(c(t)){var n=e.on=e.on?D({},e.on):{};for(var i in t){var r=n[i],s=t[i];n[i]=r?[].concat(r,s):s}}else;return e}function Nn(e){e._o=Mn,e._n=p,e._s=f,e._l=xn,e._t=kn,e._q=O,e._i=N,e._m=Rn,e._f=An,e._k=Cn,e._b=Dn,e._v=be,e._e=ye,e._u=Ut,e._g=On}function Un(e,t,i,r,a){var o,l=a.options;b(r,"_uid")?(o=Object.create(r),o._original=r):(o=r,r=r._original);var u=s(l._compiled),c=!u;this.data=e,this.props=t,this.children=i,this.parent=r,this.listeners=e.on||n,this.injections=En(l.inject,r),this.slots=function(){return Ot(i,r)},u&&(this.$options=l,this.$slots=this.slots(),this.$scopedSlots=e.scopedSlots||n),l._scopeId?this._c=function(e,t,n,i){var s=Yn(o,e,t,n,i,c);return s&&!Array.isArray(s)&&(s.fnScopeId=l._scopeId,s.fnContext=r),s}:this._c=function(e,t,n,i){return Yn(o,e,t,n,i,c)}}function Fn(e,t,i,s,a){var o=e.options,l={},u=o.props;if(r(u))for(var c in u)l[c]=qe(c,u,t||n);else r(i.attrs)&&jn(l,i.attrs),r(i.props)&&jn(l,i.props);var d=new Un(i,l,a,s,e),h=o.render.call(null,d._c,d);if(h instanceof me)return Bn(h,i,d.parent,o);if(Array.isArray(h)){for(var f=St(h)||[],p=new Array(f.length),g=0;g<f.length;g++)p[g]=Bn(f[g],i,d.parent,o);return p}}function Bn(e,t,n,i){var r=_e(e);return r.fnContext=n,r.fnOptions=i,t.slot&&((r.data||(r.data={})).slot=t.slot),r}function jn(e,t){for(var n in t)e[S(n)]=t[n]}Nn(Un.prototype);var Vn={init:function(e,t,n,i){if(e.componentInstance&&!e.componentInstance._isDestroyed&&e.data.keepAlive){var r=e;Vn.prepatch(r,r)}else{var s=e.componentInstance=Gn(e,Ft,n,i);s.$mount(t?e.elm:void 0,t)}},prepatch:function(e,t){var n=t.componentOptions,i=t.componentInstance=e.componentInstance;Ht(i,n.propsData,n.listeners,t,n.children)},insert:function(e){var t=e.context,n=e.componentInstance;n._isMounted||(n._isMounted=!0,qt(n,"mounted")),e.data.keepAlive&&(t._isMounted?nn(n):Gt(n,!0))},destroy:function(e){var t=e.componentInstance;t._isDestroyed||(e.data.keepAlive?zt(t,!0):t.$destroy())}},Hn=Object.keys(Vn);function $n(e,t,n,a,o){if(!i(e)){var u=n.$options._base;if(l(e)&&(e=u.extend(e)),"function"===typeof e){var c;if(i(e.cid)&&(c=e,e=At(c,u,n),void 0===e))return kt(c,t,n,a,o);t=t||{},ri(e),r(t.model)&&qn(e.options,t);var d=bt(t,e,o);if(s(e.options.functional))return Fn(e,d,t,n,a);var h=t.on;if(t.on=t.nativeOn,s(e.options.abstract)){var f=t.slot;t={},f&&(t.slot=f)}zn(t);var p=e.options.name||o,g=new me("vue-component-"+e.cid+(p?"-"+p:""),t,void 0,void 0,void 0,n,{Ctor:e,propsData:d,listeners:h,tag:o,children:a},c);return g}}}function Gn(e,t,n,i){var s={_isComponent:!0,parent:t,_parentVnode:e,_parentElm:n||null,_refElm:i||null},a=e.data.inlineTemplate;return r(a)&&(s.render=a.render,s.staticRenderFns=a.staticRenderFns),new e.componentOptions.Ctor(s)}function zn(e){for(var t=e.hook||(e.hook={}),n=0;n<Hn.length;n++){var i=Hn[n];t[i]=Vn[i]}}function qn(e,t){var n=e.model&&e.model.prop||"value",i=e.model&&e.model.event||"input";(t.props||(t.props={}))[n]=t.model.value;var s=t.on||(t.on={});r(s[i])?s[i]=[t.model.callback].concat(s[i]):s[i]=t.model.callback}var Wn=1,Kn=2;function Yn(e,t,n,i,r,a){return(Array.isArray(n)||o(n))&&(r=i,i=n,n=void 0),s(a)&&(r=Kn),Xn(e,t,n,i,r)}function Xn(e,t,n,i,s){if(r(n)&&r(n.__ob__))return ye();if(r(n)&&r(n.is)&&(t=n.is),!t)return ye();var a,o,l;(Array.isArray(i)&&"function"===typeof i[0]&&(n=n||{},n.scopedSlots={default:i[0]},i.length=0),s===Kn?i=St(i):s===Wn&&(i=Tt(i)),"string"===typeof t)?(o=e.$vnode&&e.$vnode.ns||V.getTagNamespace(t),a=V.isReservedTag(t)?new me(V.parsePlatformTagName(t),n,i,void 0,void 0,e):r(l=ze(e.$options,"components",t))?$n(l,n,e,i,t):new me(t,n,i,void 0,void 0,e)):a=$n(t,n,e,i);return Array.isArray(a)?a:r(a)?(r(o)&&Qn(a,o),r(n)&&Zn(n),a):ye()}function Qn(e,t,n){if(e.ns=t,"foreignObject"===e.tag&&(t=void 0,n=!0),r(e.children))for(var a=0,o=e.children.length;a<o;a++){var l=e.children[a];r(l.tag)&&(i(l.ns)||s(n)&&"svg"!==l.tag)&&Qn(l,t,n)}}function Zn(e){l(e.style)&&ht(e.style),l(e.class)&&ht(e.class)}function Jn(e){e._vnode=null,e._staticTrees=null;var t=e.$options,i=e.$vnode=t._parentVnode,r=i&&i.context;e.$slots=Ot(t._renderChildren,r),e.$scopedSlots=n,e._c=function(t,n,i,r){return Yn(e,t,n,i,r,!1)},e.$createElement=function(t,n,i,r){return Yn(e,t,n,i,r,!0)};var s=i&&i.data;Re(e,"$attrs",s&&s.attrs||n,null,!0),Re(e,"$listeners",t._parentListeners||n,null,!0)}function ei(e){Nn(e.prototype),e.prototype.$nextTick=function(e){return ct(e,this)},e.prototype._render=function(){var e,t=this,i=t.$options,r=i.render,s=i._parentVnode;s&&(t.$scopedSlots=s.data.scopedSlots||n),t.$vnode=s;try{e=r.call(t._renderProxy,t.$createElement)}catch(n){Qe(n,t,"render"),e=t._vnode}return e instanceof me||(e=ye()),e.parent=s,e}}var ti=0;function ni(e){e.prototype._init=function(e){var t=this;t._uid=ti++,t._isVue=!0,e&&e._isComponent?ii(t,e):t.$options=Ge(ri(t.constructor),e||{},t),t._renderProxy=t,t._self=t,Bt(t),Dt(t),Jn(t),qt(t,"beforeCreate"),wn(t),cn(t),Sn(t),qt(t,"created"),t.$options.el&&t.$mount(t.$options.el)}}function ii(e,t){var n=e.$options=Object.create(e.constructor.options),i=t._parentVnode;n.parent=t.parent,n._parentVnode=i,n._parentElm=t._parentElm,n._refElm=t._refElm;var r=i.componentOptions;n.propsData=r.propsData,n._parentListeners=r.listeners,n._renderChildren=r.children,n._componentTag=r.tag,t.render&&(n.render=t.render,n.staticRenderFns=t.staticRenderFns)}function ri(e){var t=e.options;if(e.super){var n=ri(e.super),i=e.superOptions;if(n!==i){e.superOptions=n;var r=si(e);r&&D(e.extendOptions,r),t=e.options=Ge(n,e.extendOptions),t.name&&(t.components[t.name]=e)}}return t}function si(e){var t,n=e.options,i=e.extendOptions,r=e.sealedOptions;for(var s in n)n[s]!==r[s]&&(t||(t={}),t[s]=ai(n[s],i[s],r[s]));return t}function ai(e,t,n){if(Array.isArray(e)){var i=[];n=Array.isArray(n)?n:[n],t=Array.isArray(t)?t:[t];for(var r=0;r<e.length;r++)(t.indexOf(e[r])>=0||n.indexOf(e[r])<0)&&i.push(e[r]);return i}return e}function oi(e){this._init(e)}function li(e){e.use=function(e){var t=this._installedPlugins||(this._installedPlugins=[]);if(t.indexOf(e)>-1)return this;var n=C(arguments,1);return n.unshift(this),"function"===typeof e.install?e.install.apply(e,n):"function"===typeof e&&e.apply(null,n),t.push(e),this}}function ui(e){e.mixin=function(e){return this.options=Ge(this.options,e),this}}function ci(e){e.cid=0;var t=1;e.extend=function(e){e=e||{};var n=this,i=n.cid,r=e._Ctor||(e._Ctor={});if(r[i])return r[i];var s=e.name||n.options.name;var a=function(e){this._init(e)};return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.cid=t++,a.options=Ge(n.options,e),a["super"]=n,a.options.props&&di(a),a.options.computed&&hi(a),a.extend=n.extend,a.mixin=n.mixin,a.use=n.use,B.forEach(function(e){a[e]=n[e]}),s&&(a.options.components[s]=a),a.superOptions=n.options,a.extendOptions=e,a.sealedOptions=D({},a.options),r[i]=a,a}}function di(e){var t=e.options.props;for(var n in t)un(e.prototype,"_props",n)}function hi(e){var t=e.options.computed;for(var n in t)mn(e.prototype,n,t[n])}function fi(e){B.forEach(function(t){e[t]=function(e,n){return n?("component"===t&&c(n)&&(n.name=n.name||e,n=this.options._base.extend(n)),"directive"===t&&"function"===typeof n&&(n={bind:n,update:n}),this.options[t+"s"][e]=n,n):this.options[t+"s"][e]}})}function pi(e){return e&&(e.Ctor.options.name||e.tag)}function gi(e,t){return Array.isArray(e)?e.indexOf(t)>-1:"string"===typeof e?e.split(",").indexOf(t)>-1:!!d(e)&&e.test(t)}function mi(e,t){var n=e.cache,i=e.keys,r=e._vnode;for(var s in n){var a=n[s];if(a){var o=pi(a.componentOptions);o&&!t(o)&&vi(n,s,i,r)}}}function vi(e,t,n,i){var r=e[t];!r||i&&r.tag===i.tag||r.componentInstance.$destroy(),e[t]=null,v(n,t)}ni(oi),Tn(oi),Pt(oi),jt(oi),ei(oi);var yi=[String,RegExp,Array],bi={name:"keep-alive",abstract:!0,props:{include:yi,exclude:yi,max:[String,Number]},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){var e=this;for(var t in e.cache)vi(e.cache,t,e.keys)},mounted:function(){var e=this;this.$watch("include",function(t){mi(e,function(e){return gi(t,e)})}),this.$watch("exclude",function(t){mi(e,function(e){return!gi(t,e)})})},render:function(){var e=this.$slots.default,t=Ct(e),n=t&&t.componentOptions;if(n){var i=pi(n),r=this,s=r.include,a=r.exclude;if(s&&(!i||!gi(s,i))||a&&i&&gi(a,i))return t;var o=this,l=o.cache,u=o.keys,c=null==t.key?n.Ctor.cid+(n.tag?"::"+n.tag:""):t.key;l[c]?(t.componentInstance=l[c].componentInstance,v(u,c),u.push(c)):(l[c]=t,u.push(c),this.max&&u.length>parseInt(this.max)&&vi(l,u[0],u,this._vnode)),t.data.keepAlive=!0}return t||e&&e[0]}},_i={KeepAlive:bi};function Ti(e){var t={get:function(){return V}};Object.defineProperty(e,"config",t),e.util={warn:ce,extend:D,mergeOptions:Ge,defineReactive:Re},e.set=Me,e.delete=Le,e.nextTick=ct,e.options=Object.create(null),B.forEach(function(t){e.options[t+"s"]=Object.create(null)}),e.options._base=e,D(e.options.components,_i),li(e),ui(e),ci(e),fi(e)}Ti(oi),Object.defineProperty(oi.prototype,"$isServer",{get:se}),Object.defineProperty(oi.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(oi,"FunctionalRenderContext",{value:Un}),oi.version="2.5.17";var Si=g("style,class"),wi=g("input,textarea,option,select,progress"),Ei=function(e,t,n){return"value"===n&&wi(e)&&"button"!==t||"selected"===n&&"option"===e||"checked"===n&&"input"===e||"muted"===n&&"video"===e},xi=g("contenteditable,draggable,spellcheck"),ki=g("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,translate,truespeed,typemustmatch,visible"),Ai="http://www.w3.org/1999/xlink",Ii=function(e){return":"===e.charAt(5)&&"xlink"===e.slice(0,5)},Ci=function(e){return Ii(e)?e.slice(6,e.length):""},Di=function(e){return null==e||!1===e};function Ri(e){var t=e.data,n=e,i=e;while(r(i.componentInstance))i=i.componentInstance._vnode,i&&i.data&&(t=Mi(i.data,t));while(r(n=n.parent))n&&n.data&&(t=Mi(t,n.data));return Li(t.staticClass,t.class)}function Mi(e,t){return{staticClass:Pi(e.staticClass,t.staticClass),class:r(e.class)?[e.class,t.class]:t.class}}function Li(e,t){return r(e)||r(t)?Pi(e,Oi(t)):""}function Pi(e,t){return e?t?e+" "+t:e:t||""}function Oi(e){return Array.isArray(e)?Ni(e):l(e)?Ui(e):"string"===typeof e?e:""}function Ni(e){for(var t,n="",i=0,s=e.length;i<s;i++)r(t=Oi(e[i]))&&""!==t&&(n&&(n+=" "),n+=t);return n}function Ui(e){var t="";for(var n in e)e[n]&&(t&&(t+=" "),t+=n);return t}var Fi={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Bi=g("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),ji=g("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignObject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Vi=function(e){return Bi(e)||ji(e)};function Hi(e){return ji(e)?"svg":"math"===e?"math":void 0}var $i=Object.create(null);function Gi(e){if(!K)return!0;if(Vi(e))return!1;if(e=e.toLowerCase(),null!=$i[e])return $i[e];var t=document.createElement(e);return e.indexOf("-")>-1?$i[e]=t.constructor===window.HTMLUnknownElement||t.constructor===window.HTMLElement:$i[e]=/HTMLUnknownElement/.test(t.toString())}var zi=g("text,number,password,search,email,tel,url");function qi(e){if("string"===typeof e){var t=document.querySelector(e);return t||document.createElement("div")}return e}function Wi(e,t){var n=document.createElement(e);return"select"!==e?n:(t.data&&t.data.attrs&&void 0!==t.data.attrs.multiple&&n.setAttribute("multiple","multiple"),n)}function Ki(e,t){return document.createElementNS(Fi[e],t)}function Yi(e){return document.createTextNode(e)}function Xi(e){return document.createComment(e)}function Qi(e,t,n){e.insertBefore(t,n)}function Zi(e,t){e.removeChild(t)}function Ji(e,t){e.appendChild(t)}function er(e){return e.parentNode}function tr(e){return e.nextSibling}function nr(e){return e.tagName}function ir(e,t){e.textContent=t}function rr(e,t){e.setAttribute(t,"")}var sr=Object.freeze({createElement:Wi,createElementNS:Ki,createTextNode:Yi,createComment:Xi,insertBefore:Qi,removeChild:Zi,appendChild:Ji,parentNode:er,nextSibling:tr,tagName:nr,setTextContent:ir,setStyleScope:rr}),ar={create:function(e,t){or(t)},update:function(e,t){e.data.ref!==t.data.ref&&(or(e,!0),or(t))},destroy:function(e){or(e,!0)}};function or(e,t){var n=e.data.ref;if(r(n)){var i=e.context,s=e.componentInstance||e.elm,a=i.$refs;t?Array.isArray(a[n])?v(a[n],s):a[n]===s&&(a[n]=void 0):e.data.refInFor?Array.isArray(a[n])?a[n].indexOf(s)<0&&a[n].push(s):a[n]=[s]:a[n]=s}}var lr=new me("",{},[]),ur=["create","activate","update","remove","destroy"];function cr(e,t){return e.key===t.key&&(e.tag===t.tag&&e.isComment===t.isComment&&r(e.data)===r(t.data)&&dr(e,t)||s(e.isAsyncPlaceholder)&&e.asyncFactory===t.asyncFactory&&i(t.asyncFactory.error))}function dr(e,t){if("input"!==e.tag)return!0;var n,i=r(n=e.data)&&r(n=n.attrs)&&n.type,s=r(n=t.data)&&r(n=n.attrs)&&n.type;return i===s||zi(i)&&zi(s)}function hr(e,t,n){var i,s,a={};for(i=t;i<=n;++i)s=e[i].key,r(s)&&(a[s]=i);return a}function fr(e){var t,n,a={},l=e.modules,u=e.nodeOps;for(t=0;t<ur.length;++t)for(a[ur[t]]=[],n=0;n<l.length;++n)r(l[n][ur[t]])&&a[ur[t]].push(l[n][ur[t]]);function c(e){return new me(u.tagName(e).toLowerCase(),{},[],void 0,e)}function d(e,t){function n(){0===--n.listeners&&h(e)}return n.listeners=t,n}function h(e){var t=u.parentNode(e);r(t)&&u.removeChild(t,e)}function f(e,t,n,i,a,o,l){if(r(e.elm)&&r(o)&&(e=o[l]=_e(e)),e.isRootInsert=!a,!p(e,t,n,i)){var c=e.data,d=e.children,h=e.tag;r(h)?(e.elm=e.ns?u.createElementNS(e.ns,h):u.createElement(h,e),S(e),b(e,d,t),r(c)&&T(e,t),y(n,e.elm,i)):s(e.isComment)?(e.elm=u.createComment(e.text),y(n,e.elm,i)):(e.elm=u.createTextNode(e.text),y(n,e.elm,i))}}function p(e,t,n,i){var a=e.data;if(r(a)){var o=r(e.componentInstance)&&a.keepAlive;if(r(a=a.hook)&&r(a=a.init)&&a(e,!1,n,i),r(e.componentInstance))return m(e,t),s(o)&&v(e,t,n,i),!0}}function m(e,t){r(e.data.pendingInsert)&&(t.push.apply(t,e.data.pendingInsert),e.data.pendingInsert=null),e.elm=e.componentInstance.$el,_(e)?(T(e,t),S(e)):(or(e),t.push(e))}function v(e,t,n,i){var s,o=e;while(o.componentInstance)if(o=o.componentInstance._vnode,r(s=o.data)&&r(s=s.transition)){for(s=0;s<a.activate.length;++s)a.activate[s](lr,o);t.push(o);break}y(n,e.elm,i)}function y(e,t,n){r(e)&&(r(n)?n.parentNode===e&&u.insertBefore(e,t,n):u.appendChild(e,t))}function b(e,t,n){if(Array.isArray(t)){0;for(var i=0;i<t.length;++i)f(t[i],n,e.elm,null,!0,t,i)}else o(e.text)&&u.appendChild(e.elm,u.createTextNode(String(e.text)))}function _(e){while(e.componentInstance)e=e.componentInstance._vnode;return r(e.tag)}function T(e,n){for(var i=0;i<a.create.length;++i)a.create[i](lr,e);t=e.data.hook,r(t)&&(r(t.create)&&t.create(lr,e),r(t.insert)&&n.push(e))}function S(e){var t;if(r(t=e.fnScopeId))u.setStyleScope(e.elm,t);else{var n=e;while(n)r(t=n.context)&&r(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t),n=n.parent}r(t=Ft)&&t!==e.context&&t!==e.fnContext&&r(t=t.$options._scopeId)&&u.setStyleScope(e.elm,t)}function w(e,t,n,i,r,s){for(;i<=r;++i)f(n[i],s,e,t,!1,n,i)}function E(e){var t,n,i=e.data;if(r(i))for(r(t=i.hook)&&r(t=t.destroy)&&t(e),t=0;t<a.destroy.length;++t)a.destroy[t](e);if(r(t=e.children))for(n=0;n<e.children.length;++n)E(e.children[n])}function x(e,t,n,i){for(;n<=i;++n){var s=t[n];r(s)&&(r(s.tag)?(k(s),E(s)):h(s.elm))}}function k(e,t){if(r(t)||r(e.data)){var n,i=a.remove.length+1;for(r(t)?t.listeners+=i:t=d(e.elm,i),r(n=e.componentInstance)&&r(n=n._vnode)&&r(n.data)&&k(n,t),n=0;n<a.remove.length;++n)a.remove[n](e,t);r(n=e.data.hook)&&r(n=n.remove)?n(e,t):t()}else h(e.elm)}function A(e,t,n,s,a){var o,l,c,d,h=0,p=0,g=t.length-1,m=t[0],v=t[g],y=n.length-1,b=n[0],_=n[y],T=!a;while(h<=g&&p<=y)i(m)?m=t[++h]:i(v)?v=t[--g]:cr(m,b)?(C(m,b,s),m=t[++h],b=n[++p]):cr(v,_)?(C(v,_,s),v=t[--g],_=n[--y]):cr(m,_)?(C(m,_,s),T&&u.insertBefore(e,m.elm,u.nextSibling(v.elm)),m=t[++h],_=n[--y]):cr(v,b)?(C(v,b,s),T&&u.insertBefore(e,v.elm,m.elm),v=t[--g],b=n[++p]):(i(o)&&(o=hr(t,h,g)),l=r(b.key)?o[b.key]:I(b,t,h,g),i(l)?f(b,s,e,m.elm,!1,n,p):(c=t[l],cr(c,b)?(C(c,b,s),t[l]=void 0,T&&u.insertBefore(e,c.elm,m.elm)):f(b,s,e,m.elm,!1,n,p)),b=n[++p]);h>g?(d=i(n[y+1])?null:n[y+1].elm,w(e,d,n,p,y,s)):p>y&&x(e,t,h,g)}function I(e,t,n,i){for(var s=n;s<i;s++){var a=t[s];if(r(a)&&cr(e,a))return s}}function C(e,t,n,o){if(e!==t){var l=t.elm=e.elm;if(s(e.isAsyncPlaceholder))r(t.asyncFactory.resolved)?M(e.elm,t,n):t.isAsyncPlaceholder=!0;else if(s(t.isStatic)&&s(e.isStatic)&&t.key===e.key&&(s(t.isCloned)||s(t.isOnce)))t.componentInstance=e.componentInstance;else{var c,d=t.data;r(d)&&r(c=d.hook)&&r(c=c.prepatch)&&c(e,t);var h=e.children,f=t.children;if(r(d)&&_(t)){for(c=0;c<a.update.length;++c)a.update[c](e,t);r(c=d.hook)&&r(c=c.update)&&c(e,t)}i(t.text)?r(h)&&r(f)?h!==f&&A(l,h,f,n,o):r(f)?(r(e.text)&&u.setTextContent(l,""),w(l,null,f,0,f.length-1,n)):r(h)?x(l,h,0,h.length-1):r(e.text)&&u.setTextContent(l,""):e.text!==t.text&&u.setTextContent(l,t.text),r(d)&&r(c=d.hook)&&r(c=c.postpatch)&&c(e,t)}}}function D(e,t,n){if(s(n)&&r(e.parent))e.parent.data.pendingInsert=t;else for(var i=0;i<t.length;++i)t[i].data.hook.insert(t[i])}var R=g("attrs,class,staticClass,staticStyle,key");function M(e,t,n,i){var a,o=t.tag,l=t.data,u=t.children;if(i=i||l&&l.pre,t.elm=e,s(t.isComment)&&r(t.asyncFactory))return t.isAsyncPlaceholder=!0,!0;if(r(l)&&(r(a=l.hook)&&r(a=a.init)&&a(t,!0),r(a=t.componentInstance)))return m(t,n),!0;if(r(o)){if(r(u))if(e.hasChildNodes())if(r(a=l)&&r(a=a.domProps)&&r(a=a.innerHTML)){if(a!==e.innerHTML)return!1}else{for(var c=!0,d=e.firstChild,h=0;h<u.length;h++){if(!d||!M(d,u[h],n,i)){c=!1;break}d=d.nextSibling}if(!c||d)return!1}else b(t,u,n);if(r(l)){var f=!1;for(var p in l)if(!R(p)){f=!0,T(t,n);break}!f&&l["class"]&&ht(l["class"])}}else e.data!==t.text&&(e.data=t.text);return!0}return function(e,t,n,o,l,d){if(!i(t)){var h=!1,p=[];if(i(e))h=!0,f(t,p,l,d);else{var g=r(e.nodeType);if(!g&&cr(e,t))C(e,t,p,o);else{if(g){if(1===e.nodeType&&e.hasAttribute(F)&&(e.removeAttribute(F),n=!0),s(n)&&M(e,t,p))return D(t,p,!0),e;e=c(e)}var m=e.elm,v=u.parentNode(m);if(f(t,p,m._leaveCb?null:v,u.nextSibling(m)),r(t.parent)){var y=t.parent,b=_(t);while(y){for(var T=0;T<a.destroy.length;++T)a.destroy[T](y);if(y.elm=t.elm,b){for(var S=0;S<a.create.length;++S)a.create[S](lr,y);var w=y.data.hook.insert;if(w.merged)for(var k=1;k<w.fns.length;k++)w.fns[k]()}else or(y);y=y.parent}}r(v)?x(v,[e],0,0):r(e.tag)&&E(e)}}return D(t,p,h),t.elm}r(e)&&E(e)}}var pr={create:gr,update:gr,destroy:function(e){gr(e,lr)}};function gr(e,t){(e.data.directives||t.data.directives)&&mr(e,t)}function mr(e,t){var n,i,r,s=e===lr,a=t===lr,o=yr(e.data.directives,e.context),l=yr(t.data.directives,t.context),u=[],c=[];for(n in l)i=o[n],r=l[n],i?(r.oldValue=i.value,_r(r,"update",t,e),r.def&&r.def.componentUpdated&&c.push(r)):(_r(r,"bind",t,e),r.def&&r.def.inserted&&u.push(r));if(u.length){var d=function(){for(var n=0;n<u.length;n++)_r(u[n],"inserted",t,e)};s?yt(t,"insert",d):d()}if(c.length&&yt(t,"postpatch",function(){for(var n=0;n<c.length;n++)_r(c[n],"componentUpdated",t,e)}),!s)for(n in o)l[n]||_r(o[n],"unbind",e,e,a)}var vr=Object.create(null);function yr(e,t){var n,i,r=Object.create(null);if(!e)return r;for(n=0;n<e.length;n++)i=e[n],i.modifiers||(i.modifiers=vr),r[br(i)]=i,i.def=ze(t.$options,"directives",i.name,!0);return r}function br(e){return e.rawName||e.name+"."+Object.keys(e.modifiers||{}).join(".")}function _r(e,t,n,i,r){var s=e.def&&e.def[t];if(s)try{s(n.elm,e,n,i,r)}catch(i){Qe(i,n.context,"directive "+e.name+" "+t+" hook")}}var Tr=[ar,pr];function Sr(e,t){var n=t.componentOptions;if((!r(n)||!1!==n.Ctor.options.inheritAttrs)&&(!i(e.data.attrs)||!i(t.data.attrs))){var s,a,o,l=t.elm,u=e.data.attrs||{},c=t.data.attrs||{};for(s in r(c.__ob__)&&(c=t.data.attrs=D({},c)),c)a=c[s],o=u[s],o!==a&&wr(l,s,a);for(s in(Z||ee)&&c.value!==u.value&&wr(l,"value",c.value),u)i(c[s])&&(Ii(s)?l.removeAttributeNS(Ai,Ci(s)):xi(s)||l.removeAttribute(s))}}function wr(e,t,n){e.tagName.indexOf("-")>-1?Er(e,t,n):ki(t)?Di(n)?e.removeAttribute(t):(n="allowfullscreen"===t&&"EMBED"===e.tagName?"true":t,e.setAttribute(t,n)):xi(t)?e.setAttribute(t,Di(n)||"false"===n?"false":"true"):Ii(t)?Di(n)?e.removeAttributeNS(Ai,Ci(t)):e.setAttributeNS(Ai,t,n):Er(e,t,n)}function Er(e,t,n){if(Di(n))e.removeAttribute(t);else{if(Z&&!J&&"TEXTAREA"===e.tagName&&"placeholder"===t&&!e.__ieph){var i=function(t){t.stopImmediatePropagation(),e.removeEventListener("input",i)};e.addEventListener("input",i),e.__ieph=!0}e.setAttribute(t,n)}}var xr={create:Sr,update:Sr};function kr(e,t){var n=t.elm,s=t.data,a=e.data;if(!(i(s.staticClass)&&i(s.class)&&(i(a)||i(a.staticClass)&&i(a.class)))){var o=Ri(t),l=n._transitionClasses;r(l)&&(o=Pi(o,Oi(l))),o!==n._prevClass&&(n.setAttribute("class",o),n._prevClass=o)}}var Ar,Ir={create:kr,update:kr},Cr="__r",Dr="__c";function Rr(e){if(r(e[Cr])){var t=Z?"change":"input";e[t]=[].concat(e[Cr],e[t]||[]),delete e[Cr]}r(e[Dr])&&(e.change=[].concat(e[Dr],e.change||[]),delete e[Dr])}function Mr(e,t,n){var i=Ar;return function r(){var s=e.apply(null,arguments);null!==s&&Pr(t,r,n,i)}}function Lr(e,t,n,i,r){t=ut(t),n&&(t=Mr(t,e,i)),Ar.addEventListener(e,t,ie?{capture:i,passive:r}:i)}function Pr(e,t,n,i){(i||Ar).removeEventListener(e,t._withTask||t,n)}function Or(e,t){if(!i(e.data.on)||!i(t.data.on)){var n=t.data.on||{},r=e.data.on||{};Ar=t.elm,Rr(n),vt(n,r,Lr,Pr,t.context),Ar=void 0}}var Nr={create:Or,update:Or};function Ur(e,t){if(!i(e.data.domProps)||!i(t.data.domProps)){var n,s,a=t.elm,o=e.data.domProps||{},l=t.data.domProps||{};for(n in r(l.__ob__)&&(l=t.data.domProps=D({},l)),o)i(l[n])&&(a[n]="");for(n in l){if(s=l[n],"textContent"===n||"innerHTML"===n){if(t.children&&(t.children.length=0),s===o[n])continue;1===a.childNodes.length&&a.removeChild(a.childNodes[0])}if("value"===n){a._value=s;var u=i(s)?"":String(s);Fr(a,u)&&(a.value=u)}else a[n]=s}}}function Fr(e,t){return!e.composing&&("OPTION"===e.tagName||Br(e,t)||jr(e,t))}function Br(e,t){var n=!0;try{n=document.activeElement!==e}catch(e){}return n&&e.value!==t}function jr(e,t){var n=e.value,i=e._vModifiers;if(r(i)){if(i.lazy)return!1;if(i.number)return p(n)!==p(t);if(i.trim)return n.trim()!==t.trim()}return n!==t}var Vr={create:Ur,update:Ur},Hr=_(function(e){var t={},n=/;(?![^(]*\))/g,i=/:(.+)/;return e.split(n).forEach(function(e){if(e){var n=e.split(i);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t});function $r(e){var t=Gr(e.style);return e.staticStyle?D(e.staticStyle,t):t}function Gr(e){return Array.isArray(e)?R(e):"string"===typeof e?Hr(e):e}function zr(e,t){var n,i={};if(t){var r=e;while(r.componentInstance)r=r.componentInstance._vnode,r&&r.data&&(n=$r(r.data))&&D(i,n)}(n=$r(e.data))&&D(i,n);var s=e;while(s=s.parent)s.data&&(n=$r(s.data))&&D(i,n);return i}var qr,Wr=/^--/,Kr=/\s*!important$/,Yr=function(e,t,n){if(Wr.test(t))e.style.setProperty(t,n);else if(Kr.test(n))e.style.setProperty(t,n.replace(Kr,""),"important");else{var i=Qr(t);if(Array.isArray(n))for(var r=0,s=n.length;r<s;r++)e.style[i]=n[r];else e.style[i]=n}},Xr=["Webkit","Moz","ms"],Qr=_(function(e){if(qr=qr||document.createElement("div").style,e=S(e),"filter"!==e&&e in qr)return e;for(var t=e.charAt(0).toUpperCase()+e.slice(1),n=0;n<Xr.length;n++){var i=Xr[n]+t;if(i in qr)return i}});function Zr(e,t){var n=t.data,s=e.data;if(!(i(n.staticStyle)&&i(n.style)&&i(s.staticStyle)&&i(s.style))){var a,o,l=t.elm,u=s.staticStyle,c=s.normalizedStyle||s.style||{},d=u||c,h=Gr(t.data.style)||{};t.data.normalizedStyle=r(h.__ob__)?D({},h):h;var f=zr(t,!0);for(o in d)i(f[o])&&Yr(l,o,"");for(o in f)a=f[o],a!==d[o]&&Yr(l,o,null==a?"":a)}}var Jr={create:Zr,update:Zr};function es(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(/\s+/).forEach(function(t){return e.classList.add(t)}):e.classList.add(t);else{var n=" "+(e.getAttribute("class")||"")+" ";n.indexOf(" "+t+" ")<0&&e.setAttribute("class",(n+t).trim())}}function ts(e,t){if(t&&(t=t.trim()))if(e.classList)t.indexOf(" ")>-1?t.split(/\s+/).forEach(function(t){return e.classList.remove(t)}):e.classList.remove(t),e.classList.length||e.removeAttribute("class");else{var n=" "+(e.getAttribute("class")||"")+" ",i=" "+t+" ";while(n.indexOf(i)>=0)n=n.replace(i," ");n=n.trim(),n?e.setAttribute("class",n):e.removeAttribute("class")}}function ns(e){if(e){if("object"===typeof e){var t={};return!1!==e.css&&D(t,is(e.name||"v")),D(t,e),t}return"string"===typeof e?is(e):void 0}}var is=_(function(e){return{enterClass:e+"-enter",enterToClass:e+"-enter-to",enterActiveClass:e+"-enter-active",leaveClass:e+"-leave",leaveToClass:e+"-leave-to",leaveActiveClass:e+"-leave-active"}}),rs=K&&!J,ss="transition",as="animation",os="transition",ls="transitionend",us="animation",cs="animationend";rs&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(os="WebkitTransition",ls="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(us="WebkitAnimation",cs="webkitAnimationEnd"));var ds=K?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(e){return e()};function hs(e){ds(function(){ds(e)})}function fs(e,t){var n=e._transitionClasses||(e._transitionClasses=[]);n.indexOf(t)<0&&(n.push(t),es(e,t))}function ps(e,t){e._transitionClasses&&v(e._transitionClasses,t),ts(e,t)}function gs(e,t,n){var i=vs(e,t),r=i.type,s=i.timeout,a=i.propCount;if(!r)return n();var o=r===ss?ls:cs,l=0,u=function(){e.removeEventListener(o,c),n()},c=function(t){t.target===e&&++l>=a&&u()};setTimeout(function(){l<a&&u()},s+1),e.addEventListener(o,c)}var ms=/\b(transform|all)(,|$)/;function vs(e,t){var n,i=window.getComputedStyle(e),r=i[os+"Delay"].split(", "),s=i[os+"Duration"].split(", "),a=ys(r,s),o=i[us+"Delay"].split(", "),l=i[us+"Duration"].split(", "),u=ys(o,l),c=0,d=0;t===ss?a>0&&(n=ss,c=a,d=s.length):t===as?u>0&&(n=as,c=u,d=l.length):(c=Math.max(a,u),n=c>0?a>u?ss:as:null,d=n?n===ss?s.length:l.length:0);var h=n===ss&&ms.test(i[os+"Property"]);return{type:n,timeout:c,propCount:d,hasTransform:h}}function ys(e,t){while(e.length<t.length)e=e.concat(e);return Math.max.apply(null,t.map(function(t,n){return bs(t)+bs(e[n])}))}function bs(e){return 1e3*Number(e.slice(0,-1))}function _s(e,t){var n=e.elm;r(n._leaveCb)&&(n._leaveCb.cancelled=!0,n._leaveCb());var s=ns(e.data.transition);if(!i(s)&&!r(n._enterCb)&&1===n.nodeType){var a=s.css,o=s.type,u=s.enterClass,c=s.enterToClass,d=s.enterActiveClass,h=s.appearClass,f=s.appearToClass,g=s.appearActiveClass,m=s.beforeEnter,v=s.enter,y=s.afterEnter,b=s.enterCancelled,_=s.beforeAppear,T=s.appear,S=s.afterAppear,w=s.appearCancelled,E=s.duration,x=Ft,k=Ft.$vnode;while(k&&k.parent)k=k.parent,x=k.context;var A=!x._isMounted||!e.isRootInsert;if(!A||T||""===T){var I=A&&h?h:u,C=A&&g?g:d,D=A&&f?f:c,R=A&&_||m,M=A&&"function"===typeof T?T:v,L=A&&S||y,P=A&&w||b,O=p(l(E)?E.enter:E);0;var N=!1!==a&&!J,F=ws(M),B=n._enterCb=U(function(){N&&(ps(n,D),ps(n,C)),B.cancelled?(N&&ps(n,I),P&&P(n)):L&&L(n),n._enterCb=null});e.data.show||yt(e,"insert",function(){var t=n.parentNode,i=t&&t._pending&&t._pending[e.key];i&&i.tag===e.tag&&i.elm._leaveCb&&i.elm._leaveCb(),M&&M(n,B)}),R&&R(n),N&&(fs(n,I),fs(n,C),hs(function(){ps(n,I),B.cancelled||(fs(n,D),F||(Ss(O)?setTimeout(B,O):gs(n,o,B)))})),e.data.show&&(t&&t(),M&&M(n,B)),N||F||B()}}}function Ts(e,t){var n=e.elm;r(n._enterCb)&&(n._enterCb.cancelled=!0,n._enterCb());var s=ns(e.data.transition);if(i(s)||1!==n.nodeType)return t();if(!r(n._leaveCb)){var a=s.css,o=s.type,u=s.leaveClass,c=s.leaveToClass,d=s.leaveActiveClass,h=s.beforeLeave,f=s.leave,g=s.afterLeave,m=s.leaveCancelled,v=s.delayLeave,y=s.duration,b=!1!==a&&!J,_=ws(f),T=p(l(y)?y.leave:y);0;var S=n._leaveCb=U(function(){n.parentNode&&n.parentNode._pending&&(n.parentNode._pending[e.key]=null),b&&(ps(n,c),ps(n,d)),S.cancelled?(b&&ps(n,u),m&&m(n)):(t(),g&&g(n)),n._leaveCb=null});v?v(w):w()}function w(){S.cancelled||(e.data.show||((n.parentNode._pending||(n.parentNode._pending={}))[e.key]=e),h&&h(n),b&&(fs(n,u),fs(n,d),hs(function(){ps(n,u),S.cancelled||(fs(n,c),_||(Ss(T)?setTimeout(S,T):gs(n,o,S)))})),f&&f(n,S),b||_||S())}}function Ss(e){return"number"===typeof e&&!isNaN(e)}function ws(e){if(i(e))return!1;var t=e.fns;return r(t)?ws(Array.isArray(t)?t[0]:t):(e._length||e.length)>1}function Es(e,t){!0!==t.data.show&&_s(t)}var xs=K?{create:Es,activate:Es,remove:function(e,t){!0!==e.data.show?Ts(e,t):t()}}:{},ks=[xr,Ir,Nr,Vr,Jr,xs],As=ks.concat(Tr),Is=fr({nodeOps:sr,modules:As});J&&document.addEventListener("selectionchange",function(){var e=document.activeElement;e&&e.vmodel&&Ns(e,"input")});var Cs={inserted:function(e,t,n,i){"select"===n.tag?(i.elm&&!i.elm._vOptions?yt(n,"postpatch",function(){Cs.componentUpdated(e,t,n)}):Ds(e,t,n.context),e._vOptions=[].map.call(e.options,Ls)):("textarea"===n.tag||zi(e.type))&&(e._vModifiers=t.modifiers,t.modifiers.lazy||(e.addEventListener("compositionstart",Ps),e.addEventListener("compositionend",Os),e.addEventListener("change",Os),J&&(e.vmodel=!0)))},componentUpdated:function(e,t,n){if("select"===n.tag){Ds(e,t,n.context);var i=e._vOptions,r=e._vOptions=[].map.call(e.options,Ls);if(r.some(function(e,t){return!O(e,i[t])})){var s=e.multiple?t.value.some(function(e){return Ms(e,r)}):t.value!==t.oldValue&&Ms(t.value,r);s&&Ns(e,"change")}}}};function Ds(e,t,n){Rs(e,t,n),(Z||ee)&&setTimeout(function(){Rs(e,t,n)},0)}function Rs(e,t,n){var i=t.value,r=e.multiple;if(!r||Array.isArray(i)){for(var s,a,o=0,l=e.options.length;o<l;o++)if(a=e.options[o],r)s=N(i,Ls(a))>-1,a.selected!==s&&(a.selected=s);else if(O(Ls(a),i))return void(e.selectedIndex!==o&&(e.selectedIndex=o));r||(e.selectedIndex=-1)}}function Ms(e,t){return t.every(function(t){return!O(t,e)})}function Ls(e){return"_value"in e?e._value:e.value}function Ps(e){e.target.composing=!0}function Os(e){e.target.composing&&(e.target.composing=!1,Ns(e.target,"input"))}function Ns(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}function Us(e){return!e.componentInstance||e.data&&e.data.transition?e:Us(e.componentInstance._vnode)}var Fs={bind:function(e,t,n){var i=t.value;n=Us(n);var r=n.data&&n.data.transition,s=e.__vOriginalDisplay="none"===e.style.display?"":e.style.display;i&&r?(n.data.show=!0,_s(n,function(){e.style.display=s})):e.style.display=i?s:"none"},update:function(e,t,n){var i=t.value,r=t.oldValue;if(!i!==!r){n=Us(n);var s=n.data&&n.data.transition;s?(n.data.show=!0,i?_s(n,function(){e.style.display=e.__vOriginalDisplay}):Ts(n,function(){e.style.display="none"})):e.style.display=i?e.__vOriginalDisplay:"none"}},unbind:function(e,t,n,i,r){r||(e.style.display=e.__vOriginalDisplay)}},Bs={model:Cs,show:Fs},js={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Vs(e){var t=e&&e.componentOptions;return t&&t.Ctor.options.abstract?Vs(Ct(t.children)):e}function Hs(e){var t={},n=e.$options;for(var i in n.propsData)t[i]=e[i];var r=n._parentListeners;for(var s in r)t[S(s)]=r[s];return t}function $s(e,t){if(/\d-keep-alive$/.test(t.tag))return e("keep-alive",{props:t.componentOptions.propsData})}function Gs(e){while(e=e.parent)if(e.data.transition)return!0}function zs(e,t){return t.key===e.key&&t.tag===e.tag}var qs={name:"transition",props:js,abstract:!0,render:function(e){var t=this,n=this.$slots.default;if(n&&(n=n.filter(function(e){return e.tag||It(e)}),n.length)){0;var i=this.mode;0;var r=n[0];if(Gs(this.$vnode))return r;var s=Vs(r);if(!s)return r;if(this._leaving)return $s(e,r);var a="__transition-"+this._uid+"-";s.key=null==s.key?s.isComment?a+"comment":a+s.tag:o(s.key)?0===String(s.key).indexOf(a)?s.key:a+s.key:s.key;var l=(s.data||(s.data={})).transition=Hs(this),u=this._vnode,c=Vs(u);if(s.data.directives&&s.data.directives.some(function(e){return"show"===e.name})&&(s.data.show=!0),c&&c.data&&!zs(s,c)&&!It(c)&&(!c.componentInstance||!c.componentInstance._vnode.isComment)){var d=c.data.transition=D({},l);if("out-in"===i)return this._leaving=!0,yt(d,"afterLeave",function(){t._leaving=!1,t.$forceUpdate()}),$s(e,r);if("in-out"===i){if(It(s))return u;var h,f=function(){h()};yt(l,"afterEnter",f),yt(l,"enterCancelled",f),yt(d,"delayLeave",function(e){h=e})}}return r}}},Ws=D({tag:String,moveClass:String},js);delete Ws.mode;var Ks={props:Ws,render:function(e){for(var t=this.tag||this.$vnode.data.tag||"span",n=Object.create(null),i=this.prevChildren=this.children,r=this.$slots.default||[],s=this.children=[],a=Hs(this),o=0;o<r.length;o++){var l=r[o];if(l.tag)if(null!=l.key&&0!==String(l.key).indexOf("__vlist"))s.push(l),n[l.key]=l,(l.data||(l.data={})).transition=a;else;}if(i){for(var u=[],c=[],d=0;d<i.length;d++){var h=i[d];h.data.transition=a,h.data.pos=h.elm.getBoundingClientRect(),n[h.key]?u.push(h):c.push(h)}this.kept=e(t,null,u),this.removed=c}return e(t,null,s)},beforeUpdate:function(){this.__patch__(this._vnode,this.kept,!1,!0),this._vnode=this.kept},updated:function(){var e=this.prevChildren,t=this.moveClass||(this.name||"v")+"-move";e.length&&this.hasMove(e[0].elm,t)&&(e.forEach(Ys),e.forEach(Xs),e.forEach(Qs),this._reflow=document.body.offsetHeight,e.forEach(function(e){if(e.data.moved){var n=e.elm,i=n.style;fs(n,t),i.transform=i.WebkitTransform=i.transitionDuration="",n.addEventListener(ls,n._moveCb=function e(i){i&&!/transform$/.test(i.propertyName)||(n.removeEventListener(ls,e),n._moveCb=null,ps(n,t))})}}))},methods:{hasMove:function(e,t){if(!rs)return!1;if(this._hasMove)return this._hasMove;var n=e.cloneNode();e._transitionClasses&&e._transitionClasses.forEach(function(e){ts(n,e)}),es(n,t),n.style.display="none",this.$el.appendChild(n);var i=vs(n);return this.$el.removeChild(n),this._hasMove=i.hasTransform}}};function Ys(e){e.elm._moveCb&&e.elm._moveCb(),e.elm._enterCb&&e.elm._enterCb()}function Xs(e){e.data.newPos=e.elm.getBoundingClientRect()}function Qs(e){var t=e.data.pos,n=e.data.newPos,i=t.left-n.left,r=t.top-n.top;if(i||r){e.data.moved=!0;var s=e.elm.style;s.transform=s.WebkitTransform="translate("+i+"px,"+r+"px)",s.transitionDuration="0s"}}var Zs={Transition:qs,TransitionGroup:Ks};oi.config.mustUseProp=Ei,oi.config.isReservedTag=Vi,oi.config.isReservedAttr=Si,oi.config.getTagNamespace=Hi,oi.config.isUnknownElement=Gi,D(oi.options.directives,Bs),D(oi.options.components,Zs),oi.prototype.__patch__=K?Is:M,oi.prototype.$mount=function(e,t){return e=e&&K?qi(e):void 0,Vt(this,e,t)},K&&setTimeout(function(){V.devtools&&ae&&ae.emit("init",oi)},0),t["a"]=oi}).call(this,n("c8ba"))},"2b17":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=(r.isTypedArray,r.extend),a=(r.assert,r.each),o=r.isObject,l=n("e0d3"),u=l.getDataItemValue,c=l.isDataItemOption,d=n("3842"),h=d.parseDate,f=n("ec6f"),p=n("93d0"),g=p.SOURCE_FORMAT_TYPED_ARRAY,m=p.SOURCE_FORMAT_ARRAY_ROWS,v=p.SOURCE_FORMAT_ORIGINAL,y=p.SOURCE_FORMAT_OBJECT_ROWS;function b(e,t){f.isInstance(e)||(e=f.seriesDataToSource(e)),this._source=e;var n=this._data=e.data,i=e.sourceFormat;i===g&&(this._offset=0,this._dimSize=t,this._data=n);var r=T[i===m?i+"_"+e.seriesLayoutBy:i];s(this,r)}var _=b.prototype;_.pure=!1,_.persistent=!0,_.getSource=function(){return this._source};var T={arrayRows_column:{pure:!0,count:function(){return Math.max(0,this._data.length-this._source.startIndex)},getItem:function(e){return this._data[e+this._source.startIndex]},appendData:E},arrayRows_row:{pure:!0,count:function(){var e=this._data[0];return e?Math.max(0,e.length-this._source.startIndex):0},getItem:function(e){e+=this._source.startIndex;for(var t=[],n=this._data,i=0;i<n.length;i++){var r=n[i];t.push(r?r[e]:null)}return t},appendData:function(){throw new Error('Do not support appendData when set seriesLayoutBy: "row".')}},objectRows:{pure:!0,count:S,getItem:w,appendData:E},keyedColumns:{pure:!0,count:function(){var e=this._source.dimensionsDefine[0].name,t=this._data[e];return t?t.length:0},getItem:function(e){for(var t=[],n=this._source.dimensionsDefine,i=0;i<n.length;i++){var r=this._data[n[i].name];t.push(r?r[e]:null)}return t},appendData:function(e){var t=this._data;a(e,function(e,n){for(var i=t[n]||(t[n]=[]),r=0;r<(e||[]).length;r++)i.push(e[r])})}},original:{count:S,getItem:w,appendData:E},typedArray:{persistent:!1,pure:!0,count:function(){return this._data?this._data.length/this._dimSize:0},getItem:function(e,t){e-=this._offset,t=t||[];for(var n=this._dimSize*e,i=0;i<this._dimSize;i++)t[i]=this._data[n+i];return t},appendData:function(e){this._data=e},clean:function(){this._offset+=this.count(),this._data=null}}};function S(){return this._data.length}function w(e){return this._data[e]}function E(e){for(var t=0;t<e.length;t++)this._data.push(e[t])}var x={arrayRows:k,objectRows:function(e,t,n,i){return null!=n?e[i]:e},keyedColumns:k,original:function(e,t,n,i){var r=u(e);return null!=n&&r instanceof Array?r[n]:r},typedArray:k};function k(e,t,n,i){return null!=n?e[n]:e}var A={arrayRows:I,objectRows:function(e,t,n,i){return C(e[t],this._dimensionInfos[t])},keyedColumns:I,original:function(e,t,n,i){var r=e&&(null==e.value?e:e.value);return!this._rawData.pure&&c(e)&&(this.hasItemOption=!0),C(r instanceof Array?r[i]:r,this._dimensionInfos[t])},typedArray:function(e,t,n,i){return e[i]}};function I(e,t,n,i){return C(e[i],this._dimensionInfos[t])}function C(e,t){var n=t&&t.type;if("ordinal"===n){var i=t&&t.ordinalMeta;return i?i.parseAndCollect(e):e}return"time"===n&&"number"!==typeof e&&null!=e&&"-"!==e&&(e=+h(e)),null==e||""===e?NaN:+e}function D(e,t,n){if(e){var i=e.getRawDataItem(t);if(null!=i){var r,s,a=e.getProvider().getSource().sourceFormat,o=e.getDimensionInfo(n);return o&&(r=o.name,s=o.index),x[a](i,t,s,r)}}}function R(e,t,n){if(e){var i=e.getProvider().getSource().sourceFormat;if(i===v||i===y){var r=e.getRawDataItem(t);return i!==v||o(r)||(r=null),r?r[n]:void 0}}}t.DefaultDataProvider=b,t.defaultDimValueGetters=A,t.retrieveRawValue=D,t.retrieveRawAttr=R},"2b4c":function(e,t,n){var i=n("5537")("wks"),r=n("ca5a"),s=n("7726").Symbol,a="function"==typeof s,o=e.exports=function(e){return i[e]||(i[e]=a&&s[e]||(a?s:r)("Symbol."+e))};o.store=i},"2b61":function(e,t,n){var i=n("7d6d"),r=[["shadowBlur",0],["shadowOffsetX",0],["shadowOffsetY",0],["shadowColor","#000"],["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]],s=function(e,t){this.extendFrom(e,!1),this.host=t};function a(e,t,n){var i=null==t.x?0:t.x,r=null==t.x2?1:t.x2,s=null==t.y?0:t.y,a=null==t.y2?0:t.y2;t.global||(i=i*n.width+n.x,r=r*n.width+n.x,s=s*n.height+n.y,a=a*n.height+n.y),i=isNaN(i)?0:i,r=isNaN(r)?1:r,s=isNaN(s)?0:s,a=isNaN(a)?0:a;var o=e.createLinearGradient(i,s,r,a);return o}function o(e,t,n){var i=n.width,r=n.height,s=Math.min(i,r),a=null==t.x?.5:t.x,o=null==t.y?.5:t.y,l=null==t.r?.5:t.r;t.global||(a=a*i+n.x,o=o*r+n.y,l*=s);var u=e.createRadialGradient(a,o,0,a,o,l);return u}s.prototype={constructor:s,host:null,fill:"#000",stroke:null,opacity:1,lineDash:null,lineDashOffset:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,lineWidth:1,strokeNoScale:!1,text:null,font:null,textFont:null,fontStyle:null,fontWeight:null,fontSize:null,fontFamily:null,textTag:null,textFill:"#000",textStroke:null,textWidth:null,textHeight:null,textStrokeWidth:0,textLineHeight:null,textPosition:"inside",textRect:null,textOffset:null,textAlign:null,textVerticalAlign:null,textDistance:5,textShadowColor:"transparent",textShadowBlur:0,textShadowOffsetX:0,textShadowOffsetY:0,textBoxShadowColor:"transparent",textBoxShadowBlur:0,textBoxShadowOffsetX:0,textBoxShadowOffsetY:0,transformText:!1,textRotation:0,textOrigin:null,textBackgroundColor:null,textBorderColor:null,textBorderWidth:0,textBorderRadius:0,textPadding:null,rich:null,truncate:null,blend:null,bind:function(e,t,n){for(var s=this,a=n&&n.style,o=!a,l=0;l<r.length;l++){var u=r[l],c=u[0];(o||s[c]!==a[c])&&(e[c]=i(e,c,s[c]||u[1]))}if((o||s.fill!==a.fill)&&(e.fillStyle=s.fill),(o||s.stroke!==a.stroke)&&(e.strokeStyle=s.stroke),(o||s.opacity!==a.opacity)&&(e.globalAlpha=null==s.opacity?1:s.opacity),(o||s.blend!==a.blend)&&(e.globalCompositeOperation=s.blend||"source-over"),this.hasStroke()){var d=s.lineWidth;e.lineWidth=d/(this.strokeNoScale&&t&&t.getLineScale?t.getLineScale():1)}},hasFill:function(){var e=this.fill;return null!=e&&"none"!==e},hasStroke:function(){var e=this.stroke;return null!=e&&"none"!==e&&this.lineWidth>0},extendFrom:function(e,t){if(e)for(var n in e)!e.hasOwnProperty(n)||!0!==t&&(!1===t?this.hasOwnProperty(n):null==e[n])||(this[n]=e[n])},set:function(e,t){"string"===typeof e?this[e]=t:this.extendFrom(e,!0)},clone:function(){var e=new this.constructor;return e.extendFrom(this,!0),e},getGradient:function(e,t,n){for(var i="radial"===t.type?o:a,r=i(e,t,n),s=t.colorStops,l=0;l<s.length;l++)r.addColorStop(s[l].offset,s[l].color);return r}};for(var l=s.prototype,u=0;u<r.length;u++){var c=r[u];c[0]in l||(l[c[0]]=c[1])}s.getGradient=l.getGradient;var d=s;e.exports=d},"2b8c":function(e,t,n){var i=n("be09"),r=e.exports={WebVTT:n("d02c"),VTTCue:n("b03c"),VTTRegion:n("f97d")};i.vttjs=r,i.WebVTT=r.WebVTT;var s=r.VTTCue,a=r.VTTRegion,o=i.VTTCue,l=i.VTTRegion;r.shim=function(){i.VTTCue=s,i.VTTRegion=a},r.restore=function(){i.VTTCue=o,i.VTTRegion=l},i.VTTCue||r.shim()},"2c17":function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=r.createHashMap,a=r.each;i.registerProcessor({getTargetSeries:function(e){var t=s();return e.eachComponent("dataZoom",function(e){e.eachTargetAxis(function(e,n,i){var r=i.getAxisProxy(e.name,n);a(r.getTargetSeriesModels(),function(e){t.set(e.uid,e)})})}),t},modifyOutputEnd:!0,overallReset:function(e,t){e.eachComponent("dataZoom",function(e){e.eachTargetAxis(function(e,n,i){i.getAxisProxy(e.name,n).reset(i,t)}),e.eachTargetAxis(function(e,n,i){i.getAxisProxy(e.name,n).filterData(i,t)})}),e.eachComponent("dataZoom",function(e){var t=e.findRepresentativeAxisProxy(),n=t.getDataPercentWindow(),i=t.getDataValueWindow();e.setRawRange({start:n[0],end:n[1],startValue:i[0],endValue:i[1]},!0)})}})},"2cf4":function(e,t){var n=1;"undefined"!==typeof window&&(n=Math.max(window.devicePixelRatio||1,1));var i=0,r=n;t.debugMode=i,t.devicePixelRatio=r},"2d00":function(e,t){e.exports=!1},"2d95":function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},"2f45":function(e,t,n){var i=n("6d8b"),r=i.each,s=i.createHashMap,a=(i.assert,n("4e08")),o=(a.__DEV__,s(["tooltip","label","itemName","itemId","seriesName"]));function l(e){var t={},n=t.encode={},i=s(),a=[],l=[];r(e.dimensions,function(t){var r=e.getDimensionInfo(t),s=r.coordDim;if(s){var u=n[s];n.hasOwnProperty(s)||(u=n[s]=[]),u[r.coordDimIndex]=t,r.isExtraCoord||(i.set(s,1),c(r.type)&&(a[0]=t)),r.defaultTooltip&&l.push(t)}o.each(function(e,t){var i=n[t];n.hasOwnProperty(t)||(i=n[t]=[]);var s=r.otherDims[t];null!=s&&!1!==s&&(i[s]=r.name)})});var u=[],d={};i.each(function(e,t){var i=n[t];d[t]=i[0],u=u.concat(i)}),t.dataDimsOnCoord=u,t.encodeFirstDimNotExtra=d;var h=n.label;h&&h.length&&(a=h.slice());var f=n.tooltip;return f&&f.length?l=f.slice():l.length||(l=a.slice()),n.defaultedLabel=a,n.defaultedTooltip=l,t}function u(e){return"category"===e?"ordinal":"time"===e?"time":"float"}function c(e){return!("ordinal"===e||"time"===e)}t.OTHER_DIMENSIONS=o,t.summarizeDimensions=l,t.getDimensionTypeByAxis=u},3014:function(e,t,n){var i=n("4f85"),r=n("3301"),s=i.extend({type:"series.__base_bar__",getInitialData:function(e,t){return r(this.getSource(),this)},getMarkerPosition:function(e){var t=this.coordinateSystem;if(t){var n=t.dataToPoint(t.clampData(e)),i=this.getData(),r=i.getLayout("offset"),s=i.getLayout("size"),a=t.getBaseAxis().isHorizontal()?0:1;return n[a]+=r+s/2,n}return[NaN,NaN]},defaultOption:{zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,large:!1,largeThreshold:400,progressive:5e3,progressiveChunkMode:"mod",itemStyle:{},emphasis:{}}});e.exports=s},"30a3":function(e,t,n){var i=n("6d8b"),r=n("607d"),s=r.Dispatcher,a=n("98b7"),o=n("06ad"),l=function(e){e=e||{},this.stage=e.stage||{},this.onframe=e.onframe||function(){},this._clips=[],this._running=!1,this._time,this._pausedTime,this._pauseStart,this._paused=!1,s.call(this)};l.prototype={constructor:l,addClip:function(e){this._clips.push(e)},addAnimator:function(e){e.animation=this;for(var t=e.getClips(),n=0;n<t.length;n++)this.addClip(t[n])},removeClip:function(e){var t=i.indexOf(this._clips,e);t>=0&&this._clips.splice(t,1)},removeAnimator:function(e){for(var t=e.getClips(),n=0;n<t.length;n++)this.removeClip(t[n]);e.animation=null},_update:function(){for(var e=(new Date).getTime()-this._pausedTime,t=e-this._time,n=this._clips,i=n.length,r=[],s=[],a=0;a<i;a++){var o=n[a],l=o.step(e,t);l&&(r.push(l),s.push(o))}for(a=0;a<i;)n[a]._needsRemove?(n[a]=n[i-1],n.pop(),i--):a++;i=r.length;for(a=0;a<i;a++)s[a].fire(r[a]);this._time=e,this.onframe(t),this.trigger("frame",t),this.stage.update&&this.stage.update()},_startLoop:function(){var e=this;function t(){e._running&&(a(t),!e._paused&&e._update())}this._running=!0,a(t)},start:function(){this._time=(new Date).getTime(),this._pausedTime=0,this._startLoop()},stop:function(){this._running=!1},pause:function(){this._paused||(this._pauseStart=(new Date).getTime(),this._paused=!0)},resume:function(){this._paused&&(this._pausedTime+=(new Date).getTime()-this._pauseStart,this._paused=!1)},clear:function(){this._clips=[]},isFinished:function(){return!this._clips.length},animate:function(e,t){t=t||{};var n=new o(e,t.loop,t.getter,t.setter);return this.addAnimator(n),n}},i.mixin(l,s);var u=l;e.exports=u},"31f4":function(e,t){e.exports=function(e,t,n){var i=void 0===n;switch(t.length){case 0:return i?e():e.call(n);case 1:return i?e(t[0]):e.call(n,t[0]);case 2:return i?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},"321f":function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n("de66"),r=Object(i["k"])([73,68,51]),s=function(e,t){void 0===t&&(t=0),e=Object(i["k"])(e);var n=e[t+5],r=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],s=(16&n)>>4;return s?r+20:r+10},a=function e(t,n){return void 0===n&&(n=0),t=Object(i["k"])(t),t.length-n<10||!Object(i["a"])(t,r,{offset:n})?n:(n+=s(t,n),e(t,n))}},"32e9":function(e,t,n){var i=n("86cc"),r=n("4630");e.exports=n("9e1e")?function(e,t,n){return i.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},3301:function(e,t,n){var i=n("6d8b"),r=n("6179"),s=n("b1d4"),a=n("93d0"),o=a.SOURCE_FORMAT_ORIGINAL,l=n("2f45"),u=l.getDimensionTypeByAxis,c=n("e0d3"),d=c.getDataItemValue,h=n("2039"),f=n("8b7f"),p=f.getCoordSysDefineBySeries,g=n("ec6f"),m=n("ee1a"),v=m.enableDataStack;function y(e,t,n){n=n||{},g.isInstance(e)||(e=g.seriesDataToSource(e));var a,o=t.get("coordinateSystem"),l=h.get(o),c=p(t);c&&(a=i.map(c.coordSysDims,function(e){var t={name:e},n=c.axisMap.get(e);if(n){var i=n.get("type");t.type=u(i)}return t})),a||(a=l&&(l.getDimensionsInfo?l.getDimensionsInfo():l.dimensions.slice())||["x","y"]);var d,f,m=s(e,{coordDimensions:a,generateCoord:n.generateCoord});c&&i.each(m,function(e,t){var n=e.coordDim,i=c.categoryAxisMap.get(n);i&&(null==d&&(d=t),e.ordinalMeta=i.getOrdinalMeta()),null!=e.otherDims.itemName&&(f=!0)}),f||null==d||(m[d].otherDims.itemName=0);var y=v(t,m),_=new r(m,t);_.setCalculationInfo(y);var T=null!=d&&b(e)?function(e,t,n,i){return i===d?n:this.defaultDimValueGetter(e,t,n,i)}:null;return _.hasItemOption=!1,_.initData(e,null,T),_}function b(e){if(e.sourceFormat===o){var t=_(e.data||[]);return null!=t&&!i.isArray(d(t))}}function _(e){var t=0;while(t<e.length&&null==e[t])t++;return e[t]}var T=y;e.exports=T},"33a4":function(e,t,n){var i=n("84f2"),r=n("2b4c")("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||s[r]===e)}},"342d":function(e,t,n){var i=n("cbe5"),r=n("20c8"),s=n("ee84"),a=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"],o=Math.sqrt,l=Math.sin,u=Math.cos,c=Math.PI,d=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},h=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(d(e)*d(t))},f=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(h(e,t))};function p(e,t,n,i,r,s,a,d,p,g,m){var v=p*(c/180),y=u(v)*(e-n)/2+l(v)*(t-i)/2,b=-1*l(v)*(e-n)/2+u(v)*(t-i)/2,_=y*y/(a*a)+b*b/(d*d);_>1&&(a*=o(_),d*=o(_));var T=(r===s?-1:1)*o((a*a*(d*d)-a*a*(b*b)-d*d*(y*y))/(a*a*(b*b)+d*d*(y*y)))||0,S=T*a*b/d,w=T*-d*y/a,E=(e+n)/2+u(v)*S-l(v)*w,x=(t+i)/2+l(v)*S+u(v)*w,k=f([1,0],[(y-S)/a,(b-w)/d]),A=[(y-S)/a,(b-w)/d],I=[(-1*y-S)/a,(-1*b-w)/d],C=f(A,I);h(A,I)<=-1&&(C=c),h(A,I)>=1&&(C=0),0===s&&C>0&&(C-=2*c),1===s&&C<0&&(C+=2*c),m.addData(g,E,x,a,d,k,C,v,s)}function g(e){if(!e)return[];var t,n=e.replace(/-/g," -").replace(/  /g," ").replace(/ /g,",").replace(/,,/g,",");for(t=0;t<a.length;t++)n=n.replace(new RegExp(a[t],"g"),"|"+a[t]);var i,s=n.split("|"),o=0,l=0,u=new r,c=r.CMD;for(t=1;t<s.length;t++){var d,h=s[t],f=h.charAt(0),g=0,m=h.slice(1).replace(/e,-/g,"e-").split(",");m.length>0&&""===m[0]&&m.shift();for(var v=0;v<m.length;v++)m[v]=parseFloat(m[v]);while(g<m.length&&!isNaN(m[g])){if(isNaN(m[0]))break;var y,b,_,T,S,w,E,x=o,k=l;switch(f){case"l":o+=m[g++],l+=m[g++],d=c.L,u.addData(d,o,l);break;case"L":o=m[g++],l=m[g++],d=c.L,u.addData(d,o,l);break;case"m":o+=m[g++],l+=m[g++],d=c.M,u.addData(d,o,l),f="l";break;case"M":o=m[g++],l=m[g++],d=c.M,u.addData(d,o,l),f="L";break;case"h":o+=m[g++],d=c.L,u.addData(d,o,l);break;case"H":o=m[g++],d=c.L,u.addData(d,o,l);break;case"v":l+=m[g++],d=c.L,u.addData(d,o,l);break;case"V":l=m[g++],d=c.L,u.addData(d,o,l);break;case"C":d=c.C,u.addData(d,m[g++],m[g++],m[g++],m[g++],m[g++],m[g++]),o=m[g-2],l=m[g-1];break;case"c":d=c.C,u.addData(d,m[g++]+o,m[g++]+l,m[g++]+o,m[g++]+l,m[g++]+o,m[g++]+l),o+=m[g-2],l+=m[g-1];break;case"S":y=o,b=l;var A=u.len(),I=u.data;i===c.C&&(y+=o-I[A-4],b+=l-I[A-3]),d=c.C,x=m[g++],k=m[g++],o=m[g++],l=m[g++],u.addData(d,y,b,x,k,o,l);break;case"s":y=o,b=l;A=u.len(),I=u.data;i===c.C&&(y+=o-I[A-4],b+=l-I[A-3]),d=c.C,x=o+m[g++],k=l+m[g++],o+=m[g++],l+=m[g++],u.addData(d,y,b,x,k,o,l);break;case"Q":x=m[g++],k=m[g++],o=m[g++],l=m[g++],d=c.Q,u.addData(d,x,k,o,l);break;case"q":x=m[g++]+o,k=m[g++]+l,o+=m[g++],l+=m[g++],d=c.Q,u.addData(d,x,k,o,l);break;case"T":y=o,b=l;A=u.len(),I=u.data;i===c.Q&&(y+=o-I[A-4],b+=l-I[A-3]),o=m[g++],l=m[g++],d=c.Q,u.addData(d,y,b,o,l);break;case"t":y=o,b=l;A=u.len(),I=u.data;i===c.Q&&(y+=o-I[A-4],b+=l-I[A-3]),o+=m[g++],l+=m[g++],d=c.Q,u.addData(d,y,b,o,l);break;case"A":_=m[g++],T=m[g++],S=m[g++],w=m[g++],E=m[g++],x=o,k=l,o=m[g++],l=m[g++],d=c.A,p(x,k,o,l,w,E,_,T,S,d,u);break;case"a":_=m[g++],T=m[g++],S=m[g++],w=m[g++],E=m[g++],x=o,k=l,o+=m[g++],l+=m[g++],d=c.A,p(x,k,o,l,w,E,_,T,S,d,u);break}}"z"!==f&&"Z"!==f||(d=c.Z,u.addData(d)),i=d}return u.toStatic(),u}function m(e,t){var n=g(e);return t=t||{},t.buildPath=function(e){if(e.setData){e.setData(n.data);var t=e.getContext();t&&e.rebuildPath(t)}else{t=e;n.rebuildPath(t)}},t.applyTransform=function(e){s(n,e),this.dirty(!0)},t}function v(e,t){return new i(m(e,t))}function y(e,t){return i.extend(m(e,t))}function b(e,t){for(var n=[],r=e.length,s=0;s<r;s++){var a=e[s];a.path||a.createPathProxy(),a.__dirtyPath&&a.buildPath(a.path,a.shape,!0),n.push(a.path)}var o=new i(t);return o.createPathProxy(),o.buildPath=function(e){e.appendPath(n);var t=e.getContext();t&&e.rebuildPath(t)},o}t.createFromString=v,t.extendFromString=y,t.mergePath=b},3603:function(e,t,n){"use strict";var i=n("be09"),r=n("0aec"),s=n("8362"),a=n("be24"),o=n("eeb9");h.httpHandler=n("8c00"),h.requestInterceptorsStorage=new a,h.responseInterceptorsStorage=new a,h.retryManager=new o;
/**
 * @license
 * slighly modified parse-headers 2.0.2 <https://github.com/kesla/parse-headers/>
 * Copyright (c) 2014 David Bjrklund
 * Available under the MIT license
 * <https://github.com/kesla/parse-headers/blob/master/LICENCE>
 */
var l=function(e){var t={};return e?(e.trim().split("\n").forEach(function(e){var n=e.indexOf(":"),i=e.slice(0,n).trim().toLowerCase(),r=e.slice(n+1).trim();"undefined"===typeof t[i]?t[i]=r:Array.isArray(t[i])?t[i].push(r):t[i]=[t[i],r]}),t):t};function u(e,t){for(var n=0;n<e.length;n++)t(e[n])}function c(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function d(e,t,n){var i=e;return s(t)?(n=t,"string"===typeof e&&(i={uri:e})):i=r({},t,{uri:e}),i.callback=n,i}function h(e,t,n){return t=d(e,t,n),f(t)}function f(e){if("undefined"===typeof e.callback)throw new Error("callback argument missing");if(e.requestType&&h.requestInterceptorsStorage.getIsEnabled()){var t={uri:e.uri||e.url,headers:e.headers||{},body:e.body,metadata:e.metadata||{},retry:e.retry,timeout:e.timeout},n=h.requestInterceptorsStorage.execute(e.requestType,t);e.uri=n.uri,e.headers=n.headers,e.body=n.body,e.metadata=n.metadata,e.retry=n.retry,e.timeout=n.timeout}var i=!1,r=function(t,n,r){i||(i=!0,e.callback(t,n,r))};function s(){4!==m.readyState||h.responseInterceptorsStorage.getIsEnabled()||setTimeout(u,0)}function a(){var e=void 0;if(e=m.response?m.response:m.responseText||p(m),w)try{e=JSON.parse(e)}catch(e){}return e}function o(t){if(clearTimeout(v),clearTimeout(e.retryTimeout),t instanceof Error||(t=new Error(""+(t||"Unknown XMLHttpRequest Error"))),t.statusCode=0,g||!h.retryManager.getIsEnabled()||!e.retry||!e.retry.shouldRetry()){if(e.requestType&&h.responseInterceptorsStorage.getIsEnabled()){var n={headers:E.headers||{},body:E.body,responseUrl:m.responseURL,responseType:m.responseType},i=h.responseInterceptorsStorage.execute(e.requestType,n);E.body=i.body,E.headers=i.headers}return r(t,E)}e.retryTimeout=setTimeout(function(){e.retry.moveToNextAttempt(),e.xhr=m,f(e)},e.retry.getCurrentFuzzedDelay())}function u(){if(!g){var t;clearTimeout(v),clearTimeout(e.retryTimeout),t=e.useXDR&&void 0===m.status?200:1223===m.status?204:m.status;var n=E,i=null;if(0!==t?(n={body:a(),statusCode:t,method:b,headers:{},url:y,rawRequest:m},m.getAllResponseHeaders&&(n.headers=l(m.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),e.requestType&&h.responseInterceptorsStorage.getIsEnabled()){var s={headers:n.headers||{},body:n.body,responseUrl:m.responseURL,responseType:m.responseType},o=h.responseInterceptorsStorage.execute(e.requestType,s);n.body=o.body,n.headers=o.headers}return r(i,n,n.body)}}var d,g,m=e.xhr||null;m||(m=e.cors||e.useXDR?new h.XDomainRequest:new h.XMLHttpRequest);var v,y=m.url=e.uri||e.url,b=m.method=e.method||"GET",_=e.body||e.data,T=m.headers=e.headers||{},S=!!e.sync,w=!1,E={body:void 0,headers:{},statusCode:0,method:b,url:y,rawRequest:m};if("json"in e&&!1!==e.json&&(w=!0,T["accept"]||T["Accept"]||(T["Accept"]="application/json"),"GET"!==b&&"HEAD"!==b&&(T["content-type"]||T["Content-Type"]||(T["Content-Type"]="application/json"),_=JSON.stringify(!0===e.json?_:e.json))),m.onreadystatechange=s,m.onload=u,m.onerror=o,m.onprogress=function(){},m.onabort=function(){g=!0,clearTimeout(e.retryTimeout)},m.ontimeout=o,m.open(b,y,!S,e.username,e.password),S||(m.withCredentials=!!e.withCredentials),!S&&e.timeout>0&&(v=setTimeout(function(){if(!g){g=!0,m.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",o(e)}},e.timeout)),m.setRequestHeader)for(d in T)T.hasOwnProperty(d)&&m.setRequestHeader(d,T[d]);else if(e.headers&&!c(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(m.responseType=e.responseType),"beforeSend"in e&&"function"===typeof e.beforeSend&&e.beforeSend(m),m.send(_||null),m}function p(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}function g(){}e.exports=h,e.exports.default=h,h.XMLHttpRequest=i.XMLHttpRequest||g,h.XDomainRequest="withCredentials"in new h.XMLHttpRequest?h.XMLHttpRequest:i.XDomainRequest,u(["get","put","post","patch","head","delete"],function(e){h["delete"===e?"del":e]=function(t,n,i){return n=d(t,n,i),n.method=e.toUpperCase(),f(n)}})},"36c6":function(e,t){var n,i,r,s,a,o,l,u=9e4;n=function(e){return e*u},i=function(e,t){return e*t},r=function(e){return e/u},s=function(e,t){return e/t},a=function(e,t){return n(s(e,t))},o=function(e,t){return i(r(e),t)},l=function(e,t,n){return r(n?e:e-t)},e.exports={ONE_SECOND_IN_TS:u,secondsToVideoTs:n,secondsToAudioTs:i,videoTsToSeconds:r,audioTsToSeconds:s,audioTsToVideoTs:a,videoTsToAudioTs:o,metadataTsToSeconds:l}},3842:function(e,t,n){var i=n("6d8b"),r=1e-4;function s(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function a(e,t,n,i){var r=t[1]-t[0],s=n[1]-n[0];if(0===r)return 0===s?n[0]:(n[0]+n[1])/2;if(i)if(r>0){if(e<=t[0])return n[0];if(e>=t[1])return n[1]}else{if(e>=t[0])return n[0];if(e<=t[1])return n[1]}else{if(e===t[0])return n[0];if(e===t[1])return n[1]}return(e-t[0])/r*s+n[0]}function o(e,t){switch(e){case"center":case"middle":e="50%";break;case"left":case"top":e="0%";break;case"right":case"bottom":e="100%";break}return"string"===typeof e?s(e).match(/%$/)?parseFloat(e)/100*t:parseFloat(e):null==e?NaN:+e}function l(e,t,n){return null==t&&(t=10),t=Math.min(Math.max(0,t),20),e=(+e).toFixed(t),n?e:+e}function u(e){return e.sort(function(e,t){return e-t}),e}function c(e){if(e=+e,isNaN(e))return 0;var t=1,n=0;while(Math.round(e*t)/t!==e)t*=10,n++;return n}function d(e){var t=e.toString(),n=t.indexOf("e");if(n>0){var i=+t.slice(n+1);return i<0?-i:0}var r=t.indexOf(".");return r<0?0:t.length-1-r}function h(e,t){var n=Math.log,i=Math.LN10,r=Math.floor(n(e[1]-e[0])/i),s=Math.round(n(Math.abs(t[1]-t[0]))/i),a=Math.min(Math.max(-r+s,0),20);return isFinite(a)?a:20}function f(e,t,n){if(!e[t])return 0;var r=i.reduce(e,function(e,t){return e+(isNaN(t)?0:t)},0);if(0===r)return 0;var s=Math.pow(10,n),a=i.map(e,function(e){return(isNaN(e)?0:e)/r*s*100}),o=100*s,l=i.map(a,function(e){return Math.floor(e)}),u=i.reduce(l,function(e,t){return e+t},0),c=i.map(a,function(e,t){return e-l[t]});while(u<o){for(var d=Number.NEGATIVE_INFINITY,h=null,f=0,p=c.length;f<p;++f)c[f]>d&&(d=c[f],h=f);++l[h],c[h]=0,++u}return l[t]/s}var p=9007199254740991;function g(e){var t=2*Math.PI;return(e%t+t)%t}function m(e){return e>-r&&e<r}var v=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d\d)(?::(\d\d)(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function y(e){if(e instanceof Date)return e;if("string"===typeof e){var t=v.exec(e);if(!t)return new Date(NaN);if(t[8]){var n=+t[4]||0;return"Z"!==t[8].toUpperCase()&&(n-=t[8].slice(0,3)),new Date(Date.UTC(+t[1],+(t[2]||1)-1,+t[3]||1,n,+(t[5]||0),+t[6]||0,+t[7]||0))}return new Date(+t[1],+(t[2]||1)-1,+t[3]||1,+t[4]||0,+(t[5]||0),+t[6]||0,+t[7]||0)}return null==e?new Date(NaN):new Date(Math.round(e))}function b(e){return Math.pow(10,_(e))}function _(e){return Math.floor(Math.log(e)/Math.LN10)}function T(e,t){var n,i=_(e),r=Math.pow(10,i),s=e/r;return n=t?s<1.5?1:s<2.5?2:s<4?3:s<7?5:10:s<1?1:s<2?2:s<3?3:s<5?5:10,e=n*r,i>=-20?+e.toFixed(i<0?-i:0):e}function S(e){e.sort(function(e,t){return o(e,t,0)?-1:1});for(var t=-1/0,n=1,i=0;i<e.length;){for(var r=e[i].interval,s=e[i].close,a=0;a<2;a++)r[a]<=t&&(r[a]=t,s[a]=a?1:1-n),t=r[a],n=s[a];r[0]===r[1]&&s[0]*s[1]!==1?e.splice(i,1):i++}return e;function o(e,t,n){return e.interval[n]<t.interval[n]||e.interval[n]===t.interval[n]&&(e.close[n]-t.close[n]===(n?-1:1)||!n&&o(e,t,1))}}function w(e){return e-parseFloat(e)>=0}t.linearMap=a,t.parsePercent=o,t.round=l,t.asc=u,t.getPrecision=c,t.getPrecisionSafe=d,t.getPixelPrecision=h,t.getPercentWithPrecision=f,t.MAX_SAFE_INTEGER=p,t.remRadian=g,t.isRadianAroundZero=m,t.parseDate=y,t.quantity=b,t.nice=T,t.reformIntervals=S,t.isNumeric=w},3846:function(e,t,n){n("9e1e")&&"g"!=/./g.flags&&n("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:n("0bfb")})},"386d":function(e,t,n){n("214f")("search",1,function(e,t,n){return[function(n){"use strict";var i=e(this),r=void 0==n?void 0:n[t];return void 0!==r?r.call(n,i):new RegExp(n)[t](String(i))},n]})},"38a2":function(e,t,n){var i=n("2b17"),r=i.retrieveRawValue,s=n("eda2"),a=s.getTooltipMarker,o=s.formatTpl,l=/\{@(.+?)\}/g,u={getDataParams:function(e,t){var n=this.getData(t),i=this.getRawValue(e,t),r=n.getRawIndex(e),s=n.getName(e),o=n.getRawDataItem(e),l=n.getItemVisual(e,"color");return{componentType:this.mainType,componentSubType:this.subType,seriesType:"series"===this.mainType?this.subType:null,seriesIndex:this.seriesIndex,seriesId:this.id,seriesName:this.name,name:s,dataIndex:r,data:o,dataType:t,value:i,color:l,marker:a(l),$vars:["seriesName","name","value"]}},getFormattedLabel:function(e,t,n,i,s){t=t||"normal";var a=this.getData(n),u=a.getItemModel(e),c=this.getDataParams(e,n);null!=i&&c.value instanceof Array&&(c.value=c.value[i]);var d=u.get("normal"===t?[s||"label","formatter"]:[t,s||"label","formatter"]);if("function"===typeof d)return c.status=t,d(c);if("string"===typeof d){var h=o(d,c);return h.replace(l,function(t,n){var i=n.length;return"["===n.charAt(0)&&"]"===n.charAt(i-1)&&(n=+n.slice(1,i-1)),r(a,e,n)})}},getRawValue:function(e,t){return r(this.getData(t),e)},formatTooltip:function(){}};e.exports=u},"38fd":function(e,t,n){var i=n("69a8"),r=n("4bf8"),s=n("613b")("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=r(e),i(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},3901:function(e,t,n){var i=n("282b"),r=i([["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),s={getLineStyle:function(e){var t=r(this,e),n=this.getLineDash(t.lineWidth);return n&&(t.lineDash=n),t},getLineDash:function(e){null==e&&(e=1);var t=this.get("type"),n=Math.max(e,2),i=4*e;return"solid"===t||null==t?null:"dashed"===t?[i,i]:[n,n]}};e.exports=s},"392f":function(e,t,n){var i=n("6d8b"),r=i.inherits,s=n("19eb"),a=n("9850");function o(e){s.call(this,e),this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.notClear=!0}o.prototype.incremental=!0,o.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.dirty(),this.notClear=!1},o.prototype.addDisplayable=function(e,t){t?this._temporaryDisplayables.push(e):this._displayables.push(e),this.dirty()},o.prototype.addDisplayables=function(e,t){t=t||!1;for(var n=0;n<e.length;n++)this.addDisplayable(e[n],t)},o.prototype.eachPendingDisplayable=function(e){for(var t=this._cursor;t<this._displayables.length;t++)e&&e(this._displayables[t]);for(t=0;t<this._temporaryDisplayables.length;t++)e&&e(this._temporaryDisplayables[t])},o.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++){var t=this._displayables[e];t.parent=this,t.update(),t.parent=null}for(e=0;e<this._temporaryDisplayables.length;e++){t=this._temporaryDisplayables[e];t.parent=this,t.update(),t.parent=null}},o.prototype.brush=function(e,t){for(var n=this._cursor;n<this._displayables.length;n++){var i=this._displayables[n];i.beforeBrush&&i.beforeBrush(e),i.brush(e,n===this._cursor?null:this._displayables[n-1]),i.afterBrush&&i.afterBrush(e)}this._cursor=n;for(n=0;n<this._temporaryDisplayables.length;n++){i=this._temporaryDisplayables[n];i.beforeBrush&&i.beforeBrush(e),i.brush(e,0===n?null:this._temporaryDisplayables[n-1]),i.afterBrush&&i.afterBrush(e)}this._temporaryDisplayables=[],this.notClear=!0};var l=[];o.prototype.getBoundingRect=function(){if(!this._rect){for(var e=new a(1/0,1/0,-1/0,-1/0),t=0;t<this._displayables.length;t++){var n=this._displayables[t],i=n.getBoundingRect().clone();n.needLocalTransform()&&i.applyTransform(n.getLocalTransform(l)),e.union(i)}this._rect=e}return this._rect},o.prototype.contain=function(e,t){var n=this.transformCoordToLocal(e,t),i=this.getBoundingRect();if(i.contain(n[0],n[1]))for(var r=0;r<this._displayables.length;r++){var s=this._displayables[r];if(s.contain(e,t))return!0}return!1},r(o,s);var u=o;e.exports=u},"3a56":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("3eba")),s=n("6d8b"),a=n("22d1"),o=n("e0d3"),l=n("50e5"),u=n("cc39"),c=s.each,d=l.eachAxisDim,h=r.extendComponentModel({type:"dataZoom",dependencies:["xAxis","yAxis","zAxis","radiusAxis","angleAxis","singleAxis","series"],defaultOption:{zlevel:0,z:4,orient:null,xAxisIndex:null,yAxisIndex:null,filterMode:"filter",throttle:null,start:0,end:100,startValue:null,endValue:null,minSpan:null,maxSpan:null,minValueSpan:null,maxValueSpan:null,rangeMode:null},init:function(e,t,n){this._dataIntervalByAxis={},this._dataInfo={},this._axisProxies={},this.textStyleModel,this._autoThrottle=!0,this._rangePropMode=["percent","percent"];var i=f(e);this.mergeDefaultAndTheme(e,n),this.doInit(i)},mergeOption:function(e){var t=f(e);s.merge(this.option,e,!0),this.doInit(t)},doInit:function(e){var t=this.option;a.canvasSupported||(t.realtime=!1),this._setDefaultThrottle(e),p(this,e),c([["start","startValue"],["end","endValue"]],function(e,n){"value"===this._rangePropMode[n]&&(t[e[0]]=null)},this),this.textStyleModel=this.getModel("textStyle"),this._resetTarget(),this._giveAxisProxies()},_giveAxisProxies:function(){var e=this._axisProxies;this.eachTargetAxis(function(t,n,i,r){var s=this.dependentModels[t.axis][n],a=s.__dzAxisProxy||(s.__dzAxisProxy=new u(t.name,n,this,r));e[t.name+"_"+n]=a},this)},_resetTarget:function(){var e=this.option,t=this._judgeAutoMode();d(function(t){var n=t.axisIndex;e[n]=o.normalizeToArray(e[n])},this),"axisIndex"===t?this._autoSetAxisIndex():"orient"===t&&this._autoSetOrient()},_judgeAutoMode:function(){var e=this.option,t=!1;d(function(n){null!=e[n.axisIndex]&&(t=!0)},this);var n=e.orient;return null==n&&t?"orient":t?void 0:(null==n&&(e.orient="horizontal"),"axisIndex")},_autoSetAxisIndex:function(){var e=!0,t=this.get("orient",!0),n=this.option,i=this.dependentModels;if(e){var r="vertical"===t?"y":"x";i[r+"Axis"].length?(n[r+"AxisIndex"]=[0],e=!1):c(i.singleAxis,function(i){e&&i.get("orient",!0)===t&&(n.singleAxisIndex=[i.componentIndex],e=!1)})}e&&d(function(t){if(e){var i=[],r=this.dependentModels[t.axis];if(r.length&&!i.length)for(var s=0,a=r.length;s<a;s++)"category"===r[s].get("type")&&i.push(s);n[t.axisIndex]=i,i.length&&(e=!1)}},this),e&&this.ecModel.eachSeries(function(e){this._isSeriesHasAllAxesTypeOf(e,"value")&&d(function(t){var i=n[t.axisIndex],r=e.get(t.axisIndex),a=e.get(t.axisId),o=e.ecModel.queryComponents({mainType:t.axis,index:r,id:a})[0];r=o.componentIndex,s.indexOf(i,r)<0&&i.push(r)})},this)},_autoSetOrient:function(){var e;this.eachTargetAxis(function(t){!e&&(e=t.name)},this),this.option.orient="y"===e?"vertical":"horizontal"},_isSeriesHasAllAxesTypeOf:function(e,t){var n=!0;return d(function(i){var r=e.get(i.axisIndex),s=this.dependentModels[i.axis][r];s&&s.get("type")===t||(n=!1)},this),n},_setDefaultThrottle:function(e){if(e.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var t=this.ecModel.option;this.option.throttle=t.animation&&t.animationDurationUpdate>0?100:20}},getFirstTargetAxisModel:function(){var e;return d(function(t){if(null==e){var n=this.get(t.axisIndex);n.length&&(e=this.dependentModels[t.axis][n[0]])}},this),e},eachTargetAxis:function(e,t){var n=this.ecModel;d(function(i){c(this.get(i.axisIndex),function(r){e.call(t,i,r,this,n)},this)},this)},getAxisProxy:function(e,t){return this._axisProxies[e+"_"+t]},getAxisModel:function(e,t){var n=this.getAxisProxy(e,t);return n&&n.getAxisModel()},setRawRange:function(e,t){var n=this.option;c([["start","startValue"],["end","endValue"]],function(t){null==e[t[0]]&&null==e[t[1]]||(n[t[0]]=e[t[0]],n[t[1]]=e[t[1]])},this),!t&&p(this,e)},getPercentRange:function(){var e=this.findRepresentativeAxisProxy();if(e)return e.getDataPercentWindow()},getValueRange:function(e,t){if(null!=e||null!=t)return this.getAxisProxy(e,t).getDataValueWindow();var n=this.findRepresentativeAxisProxy();return n?n.getDataValueWindow():void 0},findRepresentativeAxisProxy:function(e){if(e)return e.__dzAxisProxy;var t=this._axisProxies;for(var n in t)if(t.hasOwnProperty(n)&&t[n].hostedBy(this))return t[n];for(var n in t)if(t.hasOwnProperty(n)&&!t[n].hostedBy(this))return t[n]},getRangePropMode:function(){return this._rangePropMode.slice()}});function f(e){var t={};return c(["start","end","startValue","endValue","throttle"],function(n){e.hasOwnProperty(n)&&(t[n]=e[n])}),t}function p(e,t){var n=e._rangePropMode,i=e.get("rangeMode");c([["start","startValue"],["end","endValue"]],function(e,r){var s=null!=t[e[0]],a=null!=t[e[1]];s&&!a?n[r]="percent":!s&&a?n[r]="value":i?n[r]=i[r]:s&&(n[r]="percent")})}var g=h;e.exports=g},"3b2b":function(e,t,n){var i=n("7726"),r=n("5dbc"),s=n("86cc").f,a=n("9093").f,o=n("aae3"),l=n("0bfb"),u=i.RegExp,c=u,d=u.prototype,h=/a/g,f=/a/g,p=new u(h)!==h;if(n("9e1e")&&(!p||n("79e5")(function(){return f[n("2b4c")("match")]=!1,u(h)!=h||u(f)==f||"/a/i"!=u(h,"i")}))){u=function(e,t){var n=this instanceof u,i=o(e),s=void 0===t;return!n&&i&&e.constructor===u&&s?e:r(p?new c(i&&!s?e.source:e,t):c((i=e instanceof u)?e.source:e,i&&s?l.call(e):t),n?this:d,u)};for(var g=function(e){e in u||s(u,e,{configurable:!0,get:function(){return c[e]},set:function(t){c[e]=t}})},m=a(c),v=0;m.length>v;)g(m[v++]);d.constructor=u,u.prototype=d,n("2aba")(i,"RegExp",u)}n("7a56")("RegExp")},"3eba":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("697e7")),s=n("6d8b"),a=n("41ef"),o=n("22d1"),l=n("04f6"),u=n("1fab"),c=n("7e63"),d=n("843e"),h=n("2039"),f=n("ca98"),p=n("fb05"),g=n("d15d"),m=n("6cb7"),v=n("4f85"),y=n("b12f"),b=n("e887"),_=n("2306"),T=n("e0d3"),S=n("88b3"),w=S.throttle,E=n("fd63"),x=n("b809"),k=n("998c"),A=n("69ff"),I=n("c533"),C=n("f219");n("0352");var D=s.assert,R=s.each,M=s.isFunction,L=s.isObject,P=m.parseClassType,O="4.1.0",N={zrender:"4.0.4"},U=1,F=1e3,B=5e3,j=1e3,V=2e3,H=3e3,$=4e3,G=5e3,z={PROCESSOR:{FILTER:F,STATISTIC:B},VISUAL:{LAYOUT:j,GLOBAL:V,CHART:H,COMPONENT:$,BRUSH:G}},q="__flagInMainProcess",W="__optionUpdated",K=/^[a-zA-Z0-9_]+$/;function Y(e){return function(t,n,i){t=t&&t.toLowerCase(),u.prototype[e].call(this,t,n,i)}}function X(){u.call(this)}function Q(e,t,n){n=n||{},"string"===typeof t&&(t=xe[t]),this.id,this.group,this._dom=e;var i="canvas",a=this._zr=r.init(e,{renderer:n.renderer||i,devicePixelRatio:n.devicePixelRatio,width:n.width,height:n.height});this._throttledZrFlush=w(s.bind(a.flush,a),17);t=s.clone(t);t&&p(t,!0),this._theme=t,this._chartsViews=[],this._chartsMap={},this._componentsViews=[],this._componentsMap={},this._coordSysMgr=new h;var o=this._api=ye(this);function c(e,t){return e.__prio-t.__prio}l(Ee,c),l(Te,c),this._scheduler=new A(this,o,Te,Ee),u.call(this),this._messageCenter=new X,this._initEvents(),this.resize=s.bind(this.resize,this),this._pendingActions=[],a.animation.on("frame",this._onframe,this),oe(a,this),s.setAsPrimitive(this)}X.prototype.on=Y("on"),X.prototype.off=Y("off"),X.prototype.one=Y("one"),s.mixin(X,u);var Z=Q.prototype;function J(e,t,n){var i,r=this._model,s=this._coordSysMgr.getCoordinateSystems();t=T.parseFinder(r,t);for(var a=0;a<s.length;a++){var o=s[a];if(o[e]&&null!=(i=o[e](r,t,n)))return i}}Z._onframe=function(){if(!this._disposed){var e=this._scheduler;if(this[W]){var t=this[W].silent;this[q]=!0,te(this),ee.update.call(this),this[q]=!1,this[W]=!1,se.call(this,t),ae.call(this,t)}else if(e.unfinished){var n=U,i=this._model,r=this._api;e.unfinished=!1;do{var s=+new Date;e.performSeriesTasks(i),e.performDataProcessorTasks(i),ie(this,i),e.performVisualTasks(i),he(this,this._model,r,"remain"),n-=+new Date-s}while(n>0&&e.unfinished);e.unfinished||this._zr.flush()}}},Z.getDom=function(){return this._dom},Z.getZr=function(){return this._zr},Z.setOption=function(e,t,n){var i;if(L(t)&&(n=t.lazyUpdate,i=t.silent,t=t.notMerge),this[q]=!0,!this._model||t){var r=new f(this._api),s=this._theme,a=this._model=new c(null,null,s,r);a.scheduler=this._scheduler,a.init(null,null,s,r)}this._model.setOption(e,Se),n?(this[W]={silent:i},this[q]=!1):(te(this),ee.update.call(this),this._zr.flush(),this[W]=!1,this[q]=!1,se.call(this,i),ae.call(this,i))},Z.setTheme=function(){console.log("ECharts#setTheme() is DEPRECATED in ECharts 3.0")},Z.getModel=function(){return this._model},Z.getOption=function(){return this._model&&this._model.getOption()},Z.getWidth=function(){return this._zr.getWidth()},Z.getHeight=function(){return this._zr.getHeight()},Z.getDevicePixelRatio=function(){return this._zr.painter.dpr||window.devicePixelRatio||1},Z.getRenderedCanvas=function(e){if(o.canvasSupported){e=e||{},e.pixelRatio=e.pixelRatio||1,e.backgroundColor=e.backgroundColor||this._model.get("backgroundColor");var t=this._zr;return t.painter.getRenderedCanvas(e)}},Z.getSvgDataUrl=function(){if(o.svgSupported){var e=this._zr,t=e.storage.getDisplayList();return s.each(t,function(e){e.stopAnimation(!0)}),e.painter.pathToDataUrl()}},Z.getDataURL=function(e){e=e||{};var t=e.excludeComponents,n=this._model,i=[],r=this;R(t,function(e){n.eachComponent({mainType:e},function(e){var t=r._componentsMap[e.__viewId];t.group.ignore||(i.push(t),t.group.ignore=!0)})});var s="svg"===this._zr.painter.getType()?this.getSvgDataUrl():this.getRenderedCanvas(e).toDataURL("image/"+(e&&e.type||"png"));return R(i,function(e){e.group.ignore=!1}),s},Z.getConnectedDataURL=function(e){if(o.canvasSupported){var t=this.group,n=Math.min,i=Math.max,a=1/0;if(Ie[t]){var l=a,u=a,c=-a,d=-a,h=[],f=e&&e.pixelRatio||1;s.each(Ae,function(r,a){if(r.group===t){var o=r.getRenderedCanvas(s.clone(e)),f=r.getDom().getBoundingClientRect();l=n(f.left,l),u=n(f.top,u),c=i(f.right,c),d=i(f.bottom,d),h.push({dom:o,left:f.left,top:f.top})}}),l*=f,u*=f,c*=f,d*=f;var p=c-l,g=d-u,m=s.createCanvas();m.width=p,m.height=g;var v=r.init(m);return R(h,function(e){var t=new _.Image({style:{x:e.left*f-l,y:e.top*f-u,image:e.dom}});v.add(t)}),v.refreshImmediately(),m.toDataURL("image/"+(e&&e.type||"png"))}return this.getDataURL(e)}},Z.convertToPixel=s.curry(J,"convertToPixel"),Z.convertFromPixel=s.curry(J,"convertFromPixel"),Z.containPixel=function(e,t){var n,i=this._model;return e=T.parseFinder(i,e),s.each(e,function(e,i){i.indexOf("Models")>=0&&s.each(e,function(e){var r=e.coordinateSystem;if(r&&r.containPoint)n|=!!r.containPoint(t);else if("seriesModels"===i){var s=this._chartsMap[e.__viewId];s&&s.containPoint&&(n|=s.containPoint(t,e))}},this)},this),!!n},Z.getVisual=function(e,t){var n=this._model;e=T.parseFinder(n,e,{defaultMainType:"series"});var i=e.seriesModel,r=i.getData(),s=e.hasOwnProperty("dataIndexInside")?e.dataIndexInside:e.hasOwnProperty("dataIndex")?r.indexOfRawIndex(e.dataIndex):null;return null!=s?r.getItemVisual(s,t):r.getVisual(t)},Z.getViewOfComponentModel=function(e){return this._componentsMap[e.__viewId]},Z.getViewOfSeriesModel=function(e){return this._chartsMap[e.__viewId]};var ee={prepareAndUpdate:function(e){te(this),ee.update.call(this,e)},update:function(e){var t=this._model,n=this._api,i=this._zr,r=this._coordSysMgr,s=this._scheduler;if(t){s.restoreData(t,e),s.performSeriesTasks(t),r.create(t,n),s.performDataProcessorTasks(t,e),ie(this,t),r.update(t,n),ue(t),s.performVisualTasks(t,e),ce(this,t,n,e);var l=t.get("backgroundColor")||"transparent";if(o.canvasSupported)i.setBackgroundColor(l);else{var u=a.parse(l);l=a.stringify(u,"rgb"),0===u[3]&&(l="transparent")}fe(t,n)}},updateTransform:function(e){var t=this._model,n=this,i=this._api;if(t){var r=[];t.eachComponent(function(s,a){var o=n.getViewOfComponentModel(a);if(o&&o.__alive)if(o.updateTransform){var l=o.updateTransform(a,t,i,e);l&&l.update&&r.push(o)}else r.push(o)});var a=s.createHashMap();t.eachSeries(function(r){var s=n._chartsMap[r.__viewId];if(s.updateTransform){var o=s.updateTransform(r,t,i,e);o&&o.update&&a.set(r.uid,1)}else a.set(r.uid,1)}),ue(t),this._scheduler.performVisualTasks(t,e,{setDirty:!0,dirtyMap:a}),he(n,t,i,e,a),fe(t,this._api)}},updateView:function(e){var t=this._model;t&&(b.markUpdateMethod(e,"updateView"),ue(t),this._scheduler.performVisualTasks(t,e,{setDirty:!0}),ce(this,this._model,this._api,e),fe(t,this._api))},updateVisual:function(e){ee.update.call(this,e)},updateLayout:function(e){ee.update.call(this,e)}};function te(e){var t=e._model,n=e._scheduler;n.restorePipelines(t),n.prepareStageTasks(),le(e,"component",t,n),le(e,"chart",t,n),n.plan()}function ne(e,t,n,i,r){var a=e._model;if(i){var o={};o[i+"Id"]=n[i+"Id"],o[i+"Index"]=n[i+"Index"],o[i+"Name"]=n[i+"Name"];var l={mainType:i,query:o};r&&(l.subType=r);var u=n.excludeSeriesId;null!=u&&(u=s.createHashMap(T.normalizeToArray(u))),a&&a.eachComponent(l,function(t){u&&null!=u.get(t.id)||c(e["series"===i?"_chartsMap":"_componentsMap"][t.__viewId])},e)}else R(e._componentsViews.concat(e._chartsViews),c);function c(i){i&&i.__alive&&i[t]&&i[t](i.__model,a,e._api,n)}}function ie(e,t){var n=e._chartsMap,i=e._scheduler;t.eachSeries(function(e){i.updateStreamModes(e,n[e.__viewId])})}function re(e,t){var n=e.type,i=e.escapeConnect,r=be[n],a=r.actionInfo,o=(a.update||"update").split(":"),l=o.pop();o=null!=o[0]&&P(o[0]),this[q]=!0;var u=[e],c=!1;e.batch&&(c=!0,u=s.map(e.batch,function(t){return t=s.defaults(s.extend({},t),e),t.batch=null,t}));var d,h=[],f="highlight"===n||"downplay"===n;R(u,function(e){d=r.action(e,this._model,this._api),d=d||s.extend({},e),d.type=a.event||d.type,h.push(d),f?ne(this,l,e,"series"):o&&ne(this,l,e,o.main,o.sub)},this),"none"===l||f||o||(this[W]?(te(this),ee.update.call(this,e),this[W]=!1):ee[l].call(this,e)),d=c?{type:a.event||n,escapeConnect:i,batch:h}:h[0],this[q]=!1,!t&&this._messageCenter.trigger(d.type,d)}function se(e){var t=this._pendingActions;while(t.length){var n=t.shift();re.call(this,n,e)}}function ae(e){!e&&this.trigger("updated")}function oe(e,t){e.on("rendered",function(){t.trigger("rendered"),!e.animation.isFinished()||t[W]||t._scheduler.unfinished||t._pendingActions.length||t.trigger("finished")})}function le(e,t,n,i){for(var r="component"===t,s=r?e._componentsViews:e._chartsViews,a=r?e._componentsMap:e._chartsMap,o=e._zr,l=e._api,u=0;u<s.length;u++)s[u].__alive=!1;function c(e){var t="_ec_"+e.id+"_"+e.type,u=a[t];if(!u){var c=P(e.type),d=r?y.getClass(c.main,c.sub):b.getClass(c.sub);u=new d,u.init(n,l),a[t]=u,s.push(u),o.add(u.group)}e.__viewId=u.__id=t,u.__alive=!0,u.__model=e,u.group.__ecComponentInfo={mainType:e.mainType,index:e.componentIndex},!r&&i.prepareView(u,e,n,l)}r?n.eachComponent(function(e,t){"series"!==e&&c(t)}):n.eachSeries(c);for(u=0;u<s.length;){var d=s[u];d.__alive?u++:(!r&&d.renderTask.dispose(),o.remove(d.group),d.dispose(n,l),s.splice(u,1),delete a[d.__id],d.__id=d.group.__ecComponentInfo=null)}}function ue(e){e.clearColorPalette(),e.eachSeries(function(e){e.clearColorPalette()})}function ce(e,t,n,i){de(e,t,n,i),R(e._chartsViews,function(e){e.__alive=!1}),he(e,t,n,i),R(e._chartsViews,function(e){e.__alive||e.remove(t,n)})}function de(e,t,n,i,r){R(r||e._componentsViews,function(e){var r=e.__model;e.render(r,t,n,i),ve(r,e)})}function he(e,t,n,i,r){var s,a=e._scheduler;t.eachSeries(function(t){var n=e._chartsMap[t.__viewId];n.__alive=!0;var o=n.renderTask;a.updatePayload(o,i),r&&r.get(t.uid)&&o.dirty(),s|=o.perform(a.getPerformArgs(o)),n.group.silent=!!t.get("silent"),ve(t,n),me(t,n)}),a.unfinished|=s,ge(e._zr,t),x(e._zr.dom,t)}function fe(e,t){R(we,function(n){n(e,t)})}Z.resize=function(e){this._zr.resize(e);var t=this._model;if(this._loadingFX&&this._loadingFX.resize(),t){var n=t.resetOption("media"),i=e&&e.silent;this[q]=!0,n&&te(this),ee.update.call(this),this[q]=!1,se.call(this,i),ae.call(this,i)}},Z.showLoading=function(e,t){if(L(e)&&(t=e,e=""),e=e||"default",this.hideLoading(),ke[e]){var n=ke[e](this._api,t),i=this._zr;this._loadingFX=n,i.add(n)}},Z.hideLoading=function(){this._loadingFX&&this._zr.remove(this._loadingFX),this._loadingFX=null},Z.makeActionFromEvent=function(e){var t=s.extend({},e);return t.type=_e[e.type],t},Z.dispatchAction=function(e,t){L(t)||(t={silent:!!t}),be[e.type]&&this._model&&(this[q]?this._pendingActions.push(e):(re.call(this,e,t.silent),t.flush?this._zr.flush(!0):!1!==t.flush&&o.browser.weChat&&this._throttledZrFlush(),se.call(this,t.silent),ae.call(this,t.silent)))},Z.appendData=function(e){var t=e.seriesIndex,n=this.getModel(),i=n.getSeriesByIndex(t);i.appendData(e),this._scheduler.unfinished=!0},Z.on=Y("on"),Z.off=Y("off"),Z.one=Y("one");var pe=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];function ge(e,t){var n=e.storage,i=0;n.traverse(function(e){e.isGroup||i++}),i>t.get("hoverLayerThreshold")&&!o.node&&n.traverse(function(e){e.isGroup||(e.useHoverLayer=!0)})}function me(e,t){var n=e.get("blendMode")||null;t.group.traverse(function(e){e.isGroup||e.style.blend!==n&&e.setStyle("blend",n),e.eachPendingDisplayable&&e.eachPendingDisplayable(function(e){e.setStyle("blend",n)})})}function ve(e,t){var n=e.get("z"),i=e.get("zlevel");t.group.traverse(function(e){"group"!==e.type&&(null!=n&&(e.z=n),null!=i&&(e.zlevel=i))})}function ye(e){var t=e._coordSysMgr;return s.extend(new d(e),{getCoordinateSystems:s.bind(t.getCoordinateSystems,t),getComponentByElement:function(t){while(t){var n=t.__ecComponentInfo;if(null!=n)return e._model.getComponent(n.mainType,n.index);t=t.parent}}})}Z._initEvents=function(){R(pe,function(e){this._zr.on(e,function(t){var n,i=this.getModel(),r=t.target;if("globalout"===e)n={};else if(r&&null!=r.dataIndex){var a=r.dataModel||i.getSeriesByIndex(r.seriesIndex);n=a&&a.getDataParams(r.dataIndex,r.dataType)||{}}else r&&r.eventData&&(n=s.extend({},r.eventData));n&&(n.event=t,n.type=e,this.trigger(e,n))},this)},this),R(_e,function(e,t){this._messageCenter.on(t,function(e){this.trigger(t,e)},this)},this)},Z.isDisposed=function(){return this._disposed},Z.clear=function(){this.setOption({series:[]},!0)},Z.dispose=function(){if(!this._disposed){this._disposed=!0,T.setAttribute(this.getDom(),Re,"");var e=this._api,t=this._model;R(this._componentsViews,function(n){n.dispose(t,e)}),R(this._chartsViews,function(n){n.dispose(t,e)}),this._zr.dispose(),delete Ae[this.id]}},s.mixin(Q,u);var be={},_e={},Te=[],Se=[],we=[],Ee=[],xe={},ke={},Ae={},Ie={},Ce=new Date-0,De=new Date-0,Re="_echarts_instance_",Me={};function Le(e){var t=0,n=1,i=2,r="__connectUpdateStatus";function s(e,t){for(var n=0;n<e.length;n++){var i=e[n];i[r]=t}}R(_e,function(a,o){e._messageCenter.on(o,function(a){if(Ie[e.group]&&e[r]!==t){if(a&&a.escapeConnect)return;var o=e.makeActionFromEvent(a),l=[];R(Ae,function(t){t!==e&&t.group===e.group&&l.push(t)}),s(l,t),R(l,function(e){e[r]!==n&&e.dispatchAction(o)}),s(l,i)}})})}function Pe(e,t,n){var i=Be(e);if(i)return i;var r=new Q(e,t,n);return r.id="ec_"+Ce++,Ae[r.id]=r,T.setAttribute(e,Re,r.id),Le(r),r}function Oe(e){if(s.isArray(e)){var t=e;e=null,R(t,function(t){null!=t.group&&(e=t.group)}),e=e||"g_"+De++,R(t,function(t){t.group=e})}return Ie[e]=!0,e}function Ne(e){Ie[e]=!1}var Ue=Ne;function Fe(e){"string"===typeof e?e=Ae[e]:e instanceof Q||(e=Be(e)),e instanceof Q&&!e.isDisposed()&&e.dispose()}function Be(e){return Ae[T.getAttribute(e,Re)]}function je(e){return Ae[e]}function Ve(e,t){xe[e]=t}function He(e){Se.push(e)}function $e(e,t){Xe(Te,e,t,F)}function Ge(e){we.push(e)}function ze(e,t,n){"function"===typeof t&&(n=t,t="");var i=L(e)?e.type:[e,e={event:t}][0];e.event=(e.event||i).toLowerCase(),t=e.event,D(K.test(i)&&K.test(t)),be[i]||(be[i]={action:n,actionInfo:e}),_e[t]=i}function qe(e,t){h.register(e,t)}function We(e){var t=h.get(e);if(t)return t.getDimensionsInfo?t.getDimensionsInfo():t.dimensions.slice()}function Ke(e,t){Xe(Ee,e,t,j,"layout")}function Ye(e,t){Xe(Ee,e,t,H,"visual")}function Xe(e,t,n,i,r){(M(t)||L(t))&&(n=t,t=i);var s=A.wrapStageHandler(n,r);return s.__prio=t,s.__raw=n,e.push(s),s}function Qe(e,t){ke[e]=t}function Ze(e){return m.extend(e)}function Je(e){return y.extend(e)}function et(e){return v.extend(e)}function tt(e){return b.extend(e)}function nt(e){s.$override("createCanvas",e)}function it(e,t,n){t.geoJson&&!t.features&&(n=t.specialAreas,t=t.geoJson),"string"===typeof t&&(t="undefined"!==typeof JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t+");")()),Me[e]={geoJson:t,specialAreas:n}}function rt(e){return Me[e]}Ye(V,E),He(p),$e(B,g),Qe("default",k),ze({type:"highlight",event:"highlight",update:"highlight"},s.noop),ze({type:"downplay",event:"downplay",update:"downplay"},s.noop),Ve("light",I),Ve("dark",C);var st={};t.version=O,t.dependencies=N,t.PRIORITY=z,t.init=Pe,t.connect=Oe,t.disConnect=Ne,t.disconnect=Ue,t.dispose=Fe,t.getInstanceByDom=Be,t.getInstanceById=je,t.registerTheme=Ve,t.registerPreprocessor=He,t.registerProcessor=$e,t.registerPostUpdate=Ge,t.registerAction=ze,t.registerCoordinateSystem=qe,t.getCoordinateSystemDimensions=We,t.registerLayout=Ke,t.registerVisual=Ye,t.registerLoading=Qe,t.extendComponentModel=Ze,t.extendComponentView=Je,t.extendSeriesModel=et,t.extendChartView=tt,t.setCanvasCreator=nt,t.registerMap=it,t.getMap=rt,t.dataTool=st;var at=n("b719");(function(){for(var e in at)at.hasOwnProperty(e)&&(t[e]=at[e])})()},"401b":function(e,t){var n="undefined"===typeof Float32Array?Array:Float32Array;function i(e,t){var i=new n(2);return null==e&&(e=0),null==t&&(t=0),i[0]=e,i[1]=t,i}function r(e,t){return e[0]=t[0],e[1]=t[1],e}function s(e){var t=new n(2);return t[0]=e[0],t[1]=e[1],t}function a(e,t,n){return e[0]=t,e[1]=n,e}function o(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function l(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e}function u(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function c(e){return Math.sqrt(h(e))}var d=c;function h(e){return e[0]*e[0]+e[1]*e[1]}var f=h;function p(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function g(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function m(e,t){return e[0]*t[0]+e[1]*t[1]}function v(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function y(e,t){var n=c(t);return 0===n?(e[0]=0,e[1]=0):(e[0]=t[0]/n,e[1]=t[1]/n),e}function b(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}var _=b;function T(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}var S=T;function w(e,t){return e[0]=-t[0],e[1]=-t[1],e}function E(e,t,n,i){return e[0]=t[0]+i*(n[0]-t[0]),e[1]=t[1]+i*(n[1]-t[1]),e}function x(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e}function k(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function A(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}t.create=i,t.copy=r,t.clone=s,t.set=a,t.add=o,t.scaleAndAdd=l,t.sub=u,t.len=c,t.length=d,t.lenSquare=h,t.lengthSquare=f,t.mul=p,t.div=g,t.dot=m,t.scale=v,t.normalize=y,t.distance=b,t.dist=_,t.distanceSquare=T,t.distSquare=S,t.negate=w,t.lerp=E,t.applyTransform=x,t.min=k,t.max=A},"414c":function(e,t,n){var i=n("3a56"),r=i.extend({type:"dataZoom.select"});e.exports=r},"41a0":function(e,t,n){"use strict";var i=n("2aeb"),r=n("4630"),s=n("7f20"),a={};n("32e9")(a,n("2b4c")("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=i(a,{next:r(1,n)}),s(e,t+" Iterator")}},"41ef":function(e,t,n){var i=n("d51b"),r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(e){return e=Math.round(e),e<0?0:e>255?255:e}function a(e){return e=Math.round(e),e<0?0:e>360?360:e}function o(e){return e<0?0:e>1?1:e}function l(e){return e.length&&"%"===e.charAt(e.length-1)?s(parseFloat(e)/100*255):s(parseInt(e,10))}function u(e){return e.length&&"%"===e.charAt(e.length-1)?o(parseFloat(e)/100):o(parseFloat(e))}function c(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}function d(e,t,n){return e+(t-e)*n}function h(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e}function f(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}var p=new i(20),g=null;function m(e,t){g&&f(g,t),g=p.put(e,g||t.slice())}function v(e,t){if(e){t=t||[];var n=p.get(e);if(n)return f(t,n);e+="";var i=e.replace(/ /g,"").toLowerCase();if(i in r)return f(t,r[i]),m(e,t),t;if("#"!==i.charAt(0)){var s=i.indexOf("("),a=i.indexOf(")");if(-1!==s&&a+1===i.length){var o=i.substr(0,s),c=i.substr(s+1,a-(s+1)).split(","),d=1;switch(o){case"rgba":if(4!==c.length)return void h(t,0,0,0,1);d=u(c.pop());case"rgb":return 3!==c.length?void h(t,0,0,0,1):(h(t,l(c[0]),l(c[1]),l(c[2]),d),m(e,t),t);case"hsla":return 4!==c.length?void h(t,0,0,0,1):(c[3]=u(c[3]),y(c,t),m(e,t),t);case"hsl":return 3!==c.length?void h(t,0,0,0,1):(y(c,t),m(e,t),t);default:return}}h(t,0,0,0,1)}else{if(4===i.length){var g=parseInt(i.substr(1),16);return g>=0&&g<=4095?(h(t,(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1),m(e,t),t):void h(t,0,0,0,1)}if(7===i.length){g=parseInt(i.substr(1),16);return g>=0&&g<=16777215?(h(t,(16711680&g)>>16,(65280&g)>>8,255&g,1),m(e,t),t):void h(t,0,0,0,1)}}}}function y(e,t){var n=(parseFloat(e[0])%360+360)%360/360,i=u(e[1]),r=u(e[2]),a=r<=.5?r*(i+1):r+i-r*i,o=2*r-a;return t=t||[],h(t,s(255*c(o,a,n+1/3)),s(255*c(o,a,n)),s(255*c(o,a,n-1/3)),1),4===e.length&&(t[3]=e[3]),t}function b(e){if(e){var t,n,i=e[0]/255,r=e[1]/255,s=e[2]/255,a=Math.min(i,r,s),o=Math.max(i,r,s),l=o-a,u=(o+a)/2;if(0===l)t=0,n=0;else{n=u<.5?l/(o+a):l/(2-o-a);var c=((o-i)/6+l/2)/l,d=((o-r)/6+l/2)/l,h=((o-s)/6+l/2)/l;i===o?t=h-d:r===o?t=1/3+c-h:s===o&&(t=2/3+d-c),t<0&&(t+=1),t>1&&(t-=1)}var f=[360*t,n,u];return null!=e[3]&&f.push(e[3]),f}}function _(e,t){var n=v(e);if(n){for(var i=0;i<3;i++)n[i]=t<0?n[i]*(1-t)|0:(255-n[i])*t+n[i]|0,n[i]>255?n[i]=255:e[i]<0&&(n[i]=0);return I(n,4===n.length?"rgba":"rgb")}}function T(e){var t=v(e);if(t)return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)}function S(e,t,n){if(t&&t.length&&e>=0&&e<=1){n=n||[];var i=e*(t.length-1),r=Math.floor(i),a=Math.ceil(i),l=t[r],u=t[a],c=i-r;return n[0]=s(d(l[0],u[0],c)),n[1]=s(d(l[1],u[1],c)),n[2]=s(d(l[2],u[2],c)),n[3]=o(d(l[3],u[3],c)),n}}var w=S;function E(e,t,n){if(t&&t.length&&e>=0&&e<=1){var i=e*(t.length-1),r=Math.floor(i),a=Math.ceil(i),l=v(t[r]),u=v(t[a]),c=i-r,h=I([s(d(l[0],u[0],c)),s(d(l[1],u[1],c)),s(d(l[2],u[2],c)),o(d(l[3],u[3],c))],"rgba");return n?{color:h,leftIndex:r,rightIndex:a,value:i}:h}}var x=E;function k(e,t,n,i){if(e=v(e),e)return e=b(e),null!=t&&(e[0]=a(t)),null!=n&&(e[1]=u(n)),null!=i&&(e[2]=u(i)),I(y(e),"rgba")}function A(e,t){if(e=v(e),e&&null!=t)return e[3]=o(t),I(e,"rgba")}function I(e,t){if(e&&e.length){var n=e[0]+","+e[1]+","+e[2];return"rgba"!==t&&"hsva"!==t&&"hsla"!==t||(n+=","+e[3]),t+"("+n+")"}}t.parse=v,t.lift=_,t.toHex=T,t.fastLerp=S,t.fastMapToColor=w,t.lerp=E,t.mapToColor=x,t.modifyHSL=k,t.modifyAlpha=A,t.stringify=I},"42e5":function(e,t){var n=function(e){this.colorStops=e||[]};n.prototype={constructor:n,addColorStop:function(e,t){this.colorStops.push({offset:e,color:t})}};var i=n;e.exports=i},"42f6":function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("22d1"),a=n("07d7"),o=n("eda2"),l=n("3842"),u=n("2306"),c=n("133d"),d=n("f934"),h=n("4319"),f=n("17d6"),p=n("697e"),g=n("ff2e"),m=r.bind,v=r.each,y=l.parsePercent,b=new u.Rect({shape:{x:-1,y:-1,width:2,height:2}}),_=i.extendComponentView({type:"tooltip",init:function(e,t){if(!s.node){var n=new a(t.getDom(),t);this._tooltipContent=n}},render:function(e,t,n){if(!s.node&&!s.wxa){this.group.removeAll(),this._tooltipModel=e,this._ecModel=t,this._api=n,this._lastDataByCoordSys=null,this._alwaysShowContent=e.get("alwaysShowContent");var i=this._tooltipContent;i.update(),i.setEnterable(e.get("enterable")),this._initGlobalListener(),this._keepShow()}},_initGlobalListener:function(){var e=this._tooltipModel,t=e.get("triggerOn");f.register("itemTooltip",this._api,m(function(e,n,i){"none"!==t&&(t.indexOf(e)>=0?this._tryShow(n,i):"leave"===e&&this._hide(i))},this))},_keepShow:function(){var e=this._tooltipModel,t=this._ecModel,n=this._api;if(null!=this._lastX&&null!=this._lastY&&"none"!==e.get("triggerOn")){var i=this;clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout(function(){i.manuallyShowTip(e,t,n,{x:i._lastX,y:i._lastY})})}},manuallyShowTip:function(e,t,n,i){if(i.from!==this.uid&&!s.node){var r=S(i,n);this._ticket="";var a=i.dataByCoordSys;if(i.tooltip&&null!=i.x&&null!=i.y){var o=b;o.position=[i.x,i.y],o.update(),o.tooltip=i.tooltip,this._tryShow({offsetX:i.x,offsetY:i.y,target:o},r)}else if(a)this._tryShow({offsetX:i.x,offsetY:i.y,position:i.position,event:{},dataByCoordSys:i.dataByCoordSys,tooltipOption:i.tooltipOption},r);else if(null!=i.seriesIndex){if(this._manuallyAxisShowTip(e,t,n,i))return;var l=c(i,t),u=l.point[0],d=l.point[1];null!=u&&null!=d&&this._tryShow({offsetX:u,offsetY:d,position:i.position,target:l.el,event:{}},r)}else null!=i.x&&null!=i.y&&(n.dispatchAction({type:"updateAxisPointer",x:i.x,y:i.y}),this._tryShow({offsetX:i.x,offsetY:i.y,position:i.position,target:n.getZr().findHover(i.x,i.y).target,event:{}},r))}},manuallyHideTip:function(e,t,n,i){var r=this._tooltipContent;!this._alwaysShowContent&&this._tooltipModel&&r.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=null,i.from!==this.uid&&this._hide(S(i,n))},_manuallyAxisShowTip:function(e,t,n,i){var r=i.seriesIndex,s=i.dataIndex,a=t.getComponent("axisPointer").coordSysAxesInfo;if(null!=r&&null!=s&&null!=a){var o=t.getSeriesByIndex(r);if(o){var l=o.getData();e=T([l.getItemModel(s),o,(o.coordinateSystem||{}).model,e]);if("axis"===e.get("trigger"))return n.dispatchAction({type:"updateAxisPointer",seriesIndex:r,dataIndex:s,position:i.position}),!0}}},_tryShow:function(e,t){var n=e.target,i=this._tooltipModel;if(i){this._lastX=e.offsetX,this._lastY=e.offsetY;var r=e.dataByCoordSys;r&&r.length?this._showAxisTooltip(r,e):n&&null!=n.dataIndex?(this._lastDataByCoordSys=null,this._showSeriesItemTooltip(e,n,t)):n&&n.tooltip?(this._lastDataByCoordSys=null,this._showComponentItemTooltip(e,n,t)):(this._lastDataByCoordSys=null,this._hide(t))}},_showOrMove:function(e,t){var n=e.get("showDelay");t=r.bind(t,this),clearTimeout(this._showTimout),n>0?this._showTimout=setTimeout(t,n):t()},_showAxisTooltip:function(e,t){var n=this._ecModel,i=this._tooltipModel,s=[t.offsetX,t.offsetY],a=[],l=[],u=T([t.tooltipOption,i]);v(e,function(e){v(e.dataByAxis,function(e){var t=n.getComponent(e.axisDim+"Axis",e.axisIndex),i=e.value,s=[];if(t&&null!=i){var u=g.getValueLabel(i,t.axis,n,e.seriesDataIndices,e.valueLabelOpt);r.each(e.seriesDataIndices,function(r){var a=n.getSeriesByIndex(r.seriesIndex),o=r.dataIndexInside,c=a&&a.getDataParams(o);c.axisDim=e.axisDim,c.axisIndex=e.axisIndex,c.axisType=e.axisType,c.axisId=e.axisId,c.axisValue=p.getAxisRawValue(t.axis,i),c.axisValueLabel=u,c&&(l.push(c),s.push(a.formatTooltip(o,!0)))});var c=u;a.push((c?o.encodeHTML(c)+"<br />":"")+s.join("<br />"))}})},this),a.reverse(),a=a.join("<br /><br />");var c=t.position;this._showOrMove(u,function(){this._updateContentNotChangedOnAxis(e)?this._updatePosition(u,c,s[0],s[1],this._tooltipContent,l):this._showTooltipContent(u,a,l,Math.random(),s[0],s[1],c)})},_showSeriesItemTooltip:function(e,t,n){var i=this._ecModel,r=t.seriesIndex,s=i.getSeriesByIndex(r),a=t.dataModel||s,o=t.dataIndex,l=t.dataType,u=a.getData(),c=T([u.getItemModel(o),a,s&&(s.coordinateSystem||{}).model,this._tooltipModel]),d=c.get("trigger");if(null==d||"item"===d){var h=a.getDataParams(o,l),f=a.formatTooltip(o,!1,l),p="item_"+a.name+"_"+o;this._showOrMove(c,function(){this._showTooltipContent(c,f,h,p,e.offsetX,e.offsetY,e.position,e.target)}),n({type:"showTip",dataIndexInside:o,dataIndex:u.getRawIndex(o),seriesIndex:r,from:this.uid})}},_showComponentItemTooltip:function(e,t,n){var i=t.tooltip;if("string"===typeof i){var r=i;i={content:r,formatter:r}}var s=new h(i,this._tooltipModel,this._ecModel),a=s.get("content"),o=Math.random();this._showOrMove(s,function(){this._showTooltipContent(s,a,s.get("formatterParams")||{},o,e.offsetX,e.offsetY,e.position,t)}),n({type:"showTip",from:this.uid})},_showTooltipContent:function(e,t,n,i,r,s,a,l){if(this._ticket="",e.get("showContent")&&e.get("show")){var u=this._tooltipContent,c=e.get("formatter");a=a||e.get("position");var d=t;if(c&&"string"===typeof c)d=o.formatTpl(c,n,!0);else if("function"===typeof c){var h=m(function(t,i){t===this._ticket&&(u.setContent(i),this._updatePosition(e,a,r,s,u,n,l))},this);this._ticket=i,d=c(n,i,h)}u.setContent(d),u.show(e),this._updatePosition(e,a,r,s,u,n,l)}},_updatePosition:function(e,t,n,i,s,a,o){var l=this._api.getWidth(),u=this._api.getHeight();t=t||e.get("position");var c=s.getSize(),h=e.get("align"),f=e.get("verticalAlign"),p=o&&o.getBoundingRect().clone();if(o&&p.applyTransform(o.transform),"function"===typeof t&&(t=t([n,i],a,s.el,p,{viewSize:[l,u],contentSize:c.slice()})),r.isArray(t))n=y(t[0],l),i=y(t[1],u);else if(r.isObject(t)){t.width=c[0],t.height=c[1];var g=d.getLayoutRect(t,{width:l,height:u});n=g.x,i=g.y,h=null,f=null}else if("string"===typeof t&&o){var m=k(t,p,c);n=m[0],i=m[1]}else{m=w(n,i,s.el,l,u,h?null:20,f?null:20);n=m[0],i=m[1]}if(h&&(n-=A(h)?c[0]/2:"right"===h?c[0]:0),f&&(i-=A(f)?c[1]/2:"bottom"===f?c[1]:0),e.get("confine")){m=E(n,i,s.el,l,u);n=m[0],i=m[1]}s.moveTo(n,i)},_updateContentNotChangedOnAxis:function(e){var t=this._lastDataByCoordSys,n=!!t&&t.length===e.length;return n&&v(t,function(t,i){var r=t.dataByAxis||{},s=e[i]||{},a=s.dataByAxis||[];n&=r.length===a.length,n&&v(r,function(e,t){var i=a[t]||{},r=e.seriesDataIndices||[],s=i.seriesDataIndices||[];n&=e.value===i.value&&e.axisType===i.axisType&&e.axisId===i.axisId&&r.length===s.length,n&&v(r,function(e,t){var i=s[t];n&=e.seriesIndex===i.seriesIndex&&e.dataIndex===i.dataIndex})})}),this._lastDataByCoordSys=e,!!n},_hide:function(e){this._lastDataByCoordSys=null,e({type:"hideTip",from:this.uid})},dispose:function(e,t){s.node||s.wxa||(this._tooltipContent.hide(),f.unregister("itemTooltip",t))}});function T(e){var t=e.pop();while(e.length){var n=e.pop();n&&(h.isInstance(n)&&(n=n.get("tooltip",!0)),"string"===typeof n&&(n={formatter:n}),t=new h(n,t,t.ecModel))}return t}function S(e,t){return e.dispatchAction||r.bind(t.dispatchAction,t)}function w(e,t,n,i,r,s,a){var o=x(n),l=o.width,u=o.height;return null!=s&&(e+l+s>i?e-=l+s:e+=s),null!=a&&(t+u+a>r?t-=u+a:t+=a),[e,t]}function E(e,t,n,i,r){var s=x(n),a=s.width,o=s.height;return e=Math.min(e+a,i)-a,t=Math.min(t+o,r)-o,e=Math.max(e,0),t=Math.max(t,0),[e,t]}function x(e){var t=e.clientWidth,n=e.clientHeight;if(document.defaultView&&document.defaultView.getComputedStyle){var i=document.defaultView.getComputedStyle(e);i&&(t+=parseInt(i.paddingLeft,10)+parseInt(i.paddingRight,10)+parseInt(i.borderLeftWidth,10)+parseInt(i.borderRightWidth,10),n+=parseInt(i.paddingTop,10)+parseInt(i.paddingBottom,10)+parseInt(i.borderTopWidth,10)+parseInt(i.borderBottomWidth,10))}return{width:t,height:n}}function k(e,t,n){var i=n[0],r=n[1],s=5,a=0,o=0,l=t.width,u=t.height;switch(e){case"inside":a=t.x+l/2-i/2,o=t.y+u/2-r/2;break;case"top":a=t.x+l/2-i/2,o=t.y-r-s;break;case"bottom":a=t.x+l/2-i/2,o=t.y+u+s;break;case"left":a=t.x-i-s,o=t.y+u/2-r/2;break;case"right":a=t.x+l+s,o=t.y+u/2-r/2}return[a,o]}function A(e){return"center"===e||"middle"===e}e.exports=_},4319:function(e,t,n){var i=n("6d8b"),r=n("22d1"),s=n("e0d3"),a=s.makeInner,o=n("625e"),l=o.enableClassExtend,u=o.enableClassCheck,c=n("3901"),d=n("9bdb"),h=n("fe21"),f=n("551f"),p=i.mixin,g=a();function m(e,t,n){this.parentModel=t,this.ecModel=n,this.option=e}function v(e,t,n){for(var i=0;i<t.length;i++)if(t[i]&&(e=e&&"object"===typeof e?e[t[i]]:null,null==e))break;return null==e&&n&&(e=n.get(t)),e}function y(e,t){var n=g(e).getParent;return n?n.call(e,t):e.parentModel}m.prototype={constructor:m,init:null,mergeOption:function(e){i.merge(this.option,e,!0)},get:function(e,t){return null==e?this.option:v(this.option,this.parsePath(e),!t&&y(this,e))},getShallow:function(e,t){var n=this.option,i=null==n?n:n[e],r=!t&&y(this,e);return null==i&&r&&(i=r.getShallow(e)),i},getModel:function(e,t){var n,i=null==e?this.option:v(this.option,e=this.parsePath(e));return t=t||(n=y(this,e))&&n.getModel(e),new m(i,t,this.ecModel)},isEmpty:function(){return null==this.option},restoreData:function(){},clone:function(){var e=this.constructor;return new e(i.clone(this.option))},setReadOnly:function(e){},parsePath:function(e){return"string"===typeof e&&(e=e.split(".")),e},customizeGetParent:function(e){g(this).getParent=e},isAnimationEnabled:function(){if(!r.node){if(null!=this.option.animation)return!!this.option.animation;if(this.parentModel)return this.parentModel.isAnimationEnabled()}}},l(m),u(m),p(m,c),p(m,d),p(m,h),p(m,f);var b=m;e.exports=b},4436:function(e,t,n){var i=n("74cb");function r(e){this._target=e.target,this._life=e.life||1e3,this._delay=e.delay||0,this._initialized=!1,this.loop=null!=e.loop&&e.loop,this.gap=e.gap||0,this.easing=e.easing||"Linear",this.onframe=e.onframe,this.ondestroy=e.ondestroy,this.onrestart=e.onrestart,this._pausedTime=0,this._paused=!1}r.prototype={constructor:r,step:function(e,t){if(this._initialized||(this._startTime=e+this._delay,this._initialized=!0),this._paused)this._pausedTime+=t;else{var n=(e-this._startTime-this._pausedTime)/this._life;if(!(n<0)){n=Math.min(n,1);var r=this.easing,s="string"==typeof r?i[r]:r,a="function"===typeof s?s(n):n;return this.fire("frame",a),1==n?this.loop?(this.restart(e),"restart"):(this._needsRemove=!0,"destroy"):null}}},restart:function(e){var t=(e-this._startTime-this._pausedTime)%this._life;this._startTime=e-t+this.gap,this._pausedTime=0,this._needsRemove=!1},fire:function(e,t){e="on"+e,this[e]&&this[e](this._target,t)},pause:function(){this._paused=!0},resume:function(){this._paused=!1}};var s=r;e.exports=s},"446e":function(e,t,n){(function(e){
/*
 @license
 Shaka Player
 Copyright 2016 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
(function(){var n="undefined"!=typeof window?window:e,i={};for(var r in function(e,t,n){var i;function r(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var s="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype?e:(e[t]=n.value,e)};function a(n){n=["object"==typeof globalThis&&globalThis,n,"object"==typeof e&&e,"object"==typeof self&&self,"object"==typeof t&&t];for(var i=0;i<n.length;++i){var r=n[i];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}var o=a(this);function l(e,t){if(t)e:{var n=o;e=e.split(".");for(var i=0;i<e.length-1;i++){var r=e[i];if(!(r in n))break e;n=n[r]}e=e[e.length-1],i=n[e],t=t(i),t!=i&&null!=t&&s(n,e,{configurable:!0,writable:!0,value:t})}}function u(e){return e={next:e},e[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:r(e)}}function d(e){if(!(e instanceof Array)){e=c(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}l("Symbol",function(e){function t(e){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new n(i+(e||"")+"_"+r++,e)}function n(e,t){this.g=e,s(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;n.prototype.toString=function(){return this.g};var i="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return t}),l("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),n=0;n<t.length;n++){var i=o[t[n]];"function"===typeof i&&"function"!=typeof i.prototype[e]&&s(i.prototype,e,{configurable:!0,writable:!0,value:function(){return u(r(this))}})}return e});var h,f="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)h=Object.setPrototypeOf;else{var p;e:{var g={a:!0},m={};try{m.__proto__=g,p=m.a;break e}catch(e){}p=!1}h=p?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var v=h;function y(e,t){if(e.prototype=f(t.prototype),e.prototype.constructor=e,v)v(e,t);else for(var n in t)if("prototype"!=n)if(Object.defineProperties){var i=Object.getOwnPropertyDescriptor(t,n);i&&Object.defineProperty(e,n,i)}else e[n]=t[n];e.pk=t.prototype}function b(){this.o=!1,this.l=null,this.h=void 0,this.g=1,this.j=this.m=0,this.A=this.i=null}function _(e){if(e.o)throw new TypeError("Generator is already running");e.o=!0}function T(e,t){e.i={Gg:t,Tg:!0},e.g=e.m||e.j}function S(e,t,n){return e.g=n,{value:t}}function w(e){e.g=0}function E(e,t,n){e.m=t,void 0!=n&&(e.j=n)}function x(e,t){e.m=0,e.j=t||0}function k(e,t,n){e.g=t,e.m=n||0}function A(e,t){return e.m=t||0,t=e.i.Gg,e.i=null,t}function I(e){e.A=[e.i],e.m=0,e.j=0}function C(e,t){var n=e.A.splice(0)[0];(n=e.i=e.i||n)?n.Tg?e.g=e.m||e.j:void 0!=n.u&&e.j<n.u?(e.g=n.u,e.i=null):e.g=e.j:e.g=t}function D(e){this.g=new b,this.h=e}function R(e,t){_(e.g);var n=e.g.l;return n?M(e,"return"in n?n["return"]:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),L(e))}function M(e,t,n,i){try{var r=t.call(e.g.l,n);if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");if(!r.done)return e.g.o=!1,r;var s=r.value}catch(t){return e.g.l=null,T(e.g,t),L(e)}return e.g.l=null,i.call(e.g,s),L(e)}function L(e){for(;e.g.g;)try{var t=e.h(e.g);if(t)return e.g.o=!1,{value:t.value,done:!1}}catch(t){e.g.h=void 0,T(e.g,t)}if(e.g.o=!1,e.g.i){if(t=e.g.i,e.g.i=null,t.Tg)throw t.Gg;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function P(e){this.next=function(t){return _(e.g),e.g.l?t=M(e,e.g.l.next,t,e.g.s):(e.g.s(t),t=L(e)),t},this.throw=function(t){return _(e.g),e.g.l?t=M(e,e.g.l["throw"],t,e.g.s):(T(e.g,t),t=L(e)),t},this.return=function(t){return R(e,t)},this[Symbol.iterator]=function(){return this}}function O(e){function t(t){return e.next(t)}function n(t){return e.throw(t)}return new Promise(function(i,r){function s(e){e.done?i(e.value):Promise.resolve(e.value).then(t,n).then(s,r)}s(e.next())})}function N(e){return O(new P(new D(e)))}function U(){for(var e=Number(this),t=[],n=e;n<arguments.length;n++)t[n-e]=arguments[n];return t}function F(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function B(e,t){e instanceof String&&(e+="");var n=0,i=!1,r={next:function(){if(!i&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}function j(e,t,n){e instanceof String&&(e=String(e));for(var i=e.length,r=0;r<i;r++){var s=e[r];if(t.call(n,s,r,e))return{Rg:r,v:s}}return{Rg:-1,v:void 0}}function V(e,t,n){if(null==e)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return e+""}b.prototype.s=function(e){this.h=e},b.prototype.return=function(e){this.i={return:e},this.g=this.j},b.prototype.u=function(e){this.g=e},l("Promise",function(e){function t(e){this.h=0,this.i=void 0,this.g=[],this.o=!1;var t=this.j();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}}function n(){this.g=null}function i(e){return e instanceof t?e:new t(function(t){t(e)})}if(e)return e;n.prototype.h=function(e){if(null==this.g){this.g=[];var t=this;this.i(function(){t.l()})}this.g.push(e)};var r=o.setTimeout;n.prototype.i=function(e){r(e,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var e=this.g;this.g=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(e){this.j(e)}}}this.g=null},n.prototype.j=function(e){this.i(function(){throw e})},t.prototype.j=function(){function e(e){return function(i){n||(n=!0,e.call(t,i))}}var t=this,n=!1;return{resolve:e(this.F),reject:e(this.l)}},t.prototype.F=function(e){if(e===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.H(e);else{e:switch(typeof e){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.C(e):this.m(e)}},t.prototype.C=function(e){var t=void 0;try{t=e.then}catch(e){return void this.l(e)}"function"==typeof t?this.I(t,e):this.m(e)},t.prototype.l=function(e){this.s(2,e)},t.prototype.m=function(e){this.s(1,e)},t.prototype.s=function(e,t){if(0!=this.h)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.h);this.h=e,this.i=t,2===this.h&&this.G(),this.A()},t.prototype.G=function(){var e=this;r(function(){if(e.B()){var t=o.console;"undefined"!==typeof t&&t.error(e.i)}},1)},t.prototype.B=function(){if(this.o)return!1;var e=o.CustomEvent,t=o.Event,n=o.dispatchEvent;return"undefined"===typeof n||("function"===typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"===typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=o.document.createEvent("CustomEvent"),e.initCustomEvent("unhandledrejection",!1,!0,e)),e.promise=this,e.reason=this.i,n(e))},t.prototype.A=function(){if(null!=this.g){for(var e=0;e<this.g.length;++e)s.h(this.g[e]);this.g=null}};var s=new n;return t.prototype.H=function(e){var t=this.j();e.be(t.resolve,t.reject)},t.prototype.I=function(e,t){var n=this.j();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},t.prototype.then=function(e,n){function i(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(e){s(e)}}:t}var r,s,a=new t(function(e,t){r=e,s=t});return this.be(i(e,r),i(n,s)),a},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.be=function(e,t){function n(){switch(i.h){case 1:e(i.i);break;case 2:t(i.i);break;default:throw Error("Unexpected state: "+i.h)}}var i=this;null==this.g?s.h(n):this.g.push(n),this.o=!0},t.resolve=i,t.reject=function(e){return new t(function(t,n){n(e)})},t.race=function(e){return new t(function(t,n){for(var r=c(e),s=r.next();!s.done;s=r.next())i(s.value).be(t,n)})},t.all=function(e){var n=c(e),r=n.next();return r.done?i([]):new t(function(e,t){function s(t){return function(n){a[t]=n,o--,0==o&&e(a)}}var a=[],o=0;do{a.push(void 0),o++,i(r.value).be(s(a.length-1),t),r=n.next()}while(!r.done)})},t}),l("WeakMap",function(e){function t(e){if(this.g=(l+=Math.random()+1).toString(),e){e=c(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}}function n(){}function i(e){var t=typeof e;return"object"===t&&null!==e||"function"===t}function r(e){if(!F(e,o)){var t=new n;s(e,o,{value:t})}}function a(e){var t=Object[e];t&&(Object[e]=function(e){return e instanceof n?e:(Object.isExtensible(e)&&r(e),t(e))})}if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),n=Object.seal({}),i=new e([[t,2],[n,3]]);return 2==i.get(t)&&3==i.get(n)&&(i.delete(t),i.set(n,4),!i.has(t)&&4==i.get(n))}catch(e){return!1}}())return e;var o="$jscomp_hidden_"+Math.random();a("freeze"),a("preventExtensions"),a("seal");var l=0;return t.prototype.set=function(e,t){if(!i(e))throw Error("Invalid WeakMap key");if(r(e),!F(e,o))throw Error("WeakMap key fail: "+e);return e[o][this.g]=t,this},t.prototype.get=function(e){return i(e)&&F(e,o)?e[o][this.g]:void 0},t.prototype.has=function(e){return i(e)&&F(e,o)&&F(e[o],this.g)},t.prototype.delete=function(e){return!!(i(e)&&F(e,o)&&F(e[o],this.g))&&delete e[o][this.g]},t}),l("Map",function(e){function t(){var e={};return e.Ob=e.next=e.head=e}function n(e,t){var n=e.g;return u(function(){if(n){for(;n.head!=e.g;)n=n.Ob;for(;n.next!=n.head;)return n=n.next,{done:!1,value:t(n)};n=null}return{done:!0,value:void 0}})}function i(e,t){var n=t&&typeof t;"object"==n||"function"==n?s.has(t)?n=s.get(t):(n=""+ ++a,s.set(t,n)):n="p_"+t;var i=e.h[n];if(i&&F(e.h,n))for(e=0;e<i.length;e++){var r=i[e];if(t!==t&&r.key!==r.key||t===r.key)return{id:n,list:i,index:e,entry:r}}return{id:n,list:i,index:-1,entry:void 0}}function r(e){if(this.h={},this.g=t(),this.size=0,e){e=c(e);for(var n;!(n=e.next()).done;)n=n.value,this.set(n[0],n[1])}}if(function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e(c([[t,"s"]]));if("s"!=n.get(t)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var i=n.entries(),r=i.next();return!r.done&&r.value[0]==t&&"s"==r.value[1]&&(r=i.next(),!(r.done||4!=r.value[0].x||"t"!=r.value[1]||!i.next().done))}catch(e){return!1}}())return e;var s=new WeakMap;r.prototype.set=function(e,t){e=0===e?0:e;var n=i(this,e);return n.list||(n.list=this.h[n.id]=[]),n.entry?n.entry.value=t:(n.entry={next:this.g,Ob:this.g.Ob,head:this.g,key:e,value:t},n.list.push(n.entry),this.g.Ob.next=n.entry,this.g.Ob=n.entry,this.size++),this},r.prototype.delete=function(e){return e=i(this,e),!(!e.entry||!e.list)&&(e.list.splice(e.index,1),e.list.length||delete this.h[e.id],e.entry.Ob.next=e.entry.next,e.entry.next.Ob=e.entry.Ob,e.entry.head=null,this.size--,!0)},r.prototype.clear=function(){this.h={},this.g=this.g.Ob=t(),this.size=0},r.prototype.has=function(e){return!!i(this,e).entry},r.prototype.get=function(e){return(e=i(this,e).entry)&&e.value},r.prototype.entries=function(){return n(this,function(e){return[e.key,e.value]})},r.prototype.keys=function(){return n(this,function(e){return e.key})},r.prototype.values=function(){return n(this,function(e){return e.value})},r.prototype.forEach=function(e,t){for(var n,i=this.entries();!(n=i.next()).done;)n=n.value,e.call(t,n[1],n[0],this)},r.prototype[Symbol.iterator]=r.prototype.entries;var a=0;return r}),l("Set",function(e){function t(e){if(this.g=new Map,e){e=c(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.g.size}return function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e(c([t]));if(!n.has(t)||1!=n.size||n.add(t)!=n||1!=n.size||n.add({x:4})!=n||2!=n.size)return!1;var i=n.entries(),r=i.next();return!r.done&&r.value[0]==t&&r.value[1]==t&&(r=i.next(),!r.done&&r.value[0]!=t&&4==r.value[0].x&&r.value[1]==r.value[0]&&i.next().done)}catch(e){return!1}}()?e:(t.prototype.add=function(e){return e=0===e?0:e,this.g.set(e,e),this.size=this.g.size,this},t.prototype.delete=function(e){return e=this.g.delete(e),this.size=this.g.size,e},t.prototype.clear=function(){this.g.clear(),this.size=0},t.prototype.has=function(e){return this.g.has(e)},t.prototype.entries=function(){return this.g.entries()},t.prototype.values=function(){return this.g.values()},t.prototype.keys=t.prototype.values,t.prototype[Symbol.iterator]=t.prototype.values,t.prototype.forEach=function(e,t){var n=this;this.g.forEach(function(i){return e.call(t,i,i,n)})},t)}),l("Array.prototype.keys",function(e){return e||function(){return B(this,function(e){return e})}}),l("Array.prototype.findIndex",function(e){return e||function(e,t){return j(this,e,t).Rg}}),l("Array.from",function(e){return e||function(e,t,n){t=null!=t?t:function(e){return e};var i=[],r="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];if("function"==typeof r){e=r.call(e);for(var s=0;!(r=e.next()).done;)i.push(t.call(n,r.value,s++))}else for(r=e.length,s=0;s<r;s++)i.push(t.call(n,e[s],s));return i}}),l("Array.prototype.values",function(e){return e||function(){return B(this,function(e,t){return t})}}),l("Object.is",function(e){return e||function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}}),l("Array.prototype.includes",function(e){return e||function(e,t){var n=this;n instanceof String&&(n=String(n));var i=n.length;for(t=t||0,0>t&&(t=Math.max(t+i,0));t<i;t++){var r=n[t];if(r===e||Object.is(r,e))return!0}return!1}}),l("String.prototype.includes",function(e){return e||function(e,t){return-1!==V(this,e,"includes").indexOf(e,t||0)}}),l("String.fromCodePoint",function(e){return e||function(e){for(var t="",n=0;n<arguments.length;n++){var i=Number(arguments[n]);if(0>i||1114111<i||i!==Math.floor(i))throw new RangeError("invalid_code_point "+i);65535>=i?t+=String.fromCharCode(i):(i-=65536,t+=String.fromCharCode(i>>>10&1023|55296),t+=String.fromCharCode(1023&i|56320))}return t}}),l("Array.prototype.find",function(e){return e||function(e,t){return j(this,e,t).v}}),l("String.prototype.startsWith",function(e){return e||function(e,t){var n=V(this,e,"startsWith"),i=n.length,r=e.length;t=Math.max(0,Math.min(0|t,n.length));for(var s=0;s<r&&t<i;)if(n[t++]!=e[s++])return!1;return s>=r}}),l("WeakSet",function(e){function t(e){if(this.g=new WeakMap,e){e=c(e);for(var t;!(t=e.next()).done;)this.add(t.value)}}return function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),n=Object.seal({}),i=new e([t]);return!(!i.has(t)||i.has(n))&&(i.delete(t),i.add(n),!i.has(t)&&i.has(n))}catch(e){return!1}}()?e:(t.prototype.add=function(e){return this.g.set(e,!0),this},t.prototype.has=function(e){return this.g.has(e)},t.prototype.delete=function(e){return this.g.delete(e)},t)});var H="function"==typeof Object.assign?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)F(i,r)&&(e[r]=i[r])}return e};l("Object.assign",function(e){return e||H}),l("Promise.prototype.finally",function(e){return e||function(e){return this.then(function(t){return Promise.resolve(e()).then(function(){return t})},function(t){return Promise.resolve(e()).then(function(){throw t})})}}),l("Array.prototype.entries",function(e){return e||function(){return B(this,function(e,t){return[e,t]})}}),l("Number.isNaN",function(e){return e||function(e){return"number"===typeof e&&isNaN(e)}}),l("String.prototype.repeat",function(e){return e||function(e){var t=V(this,null,"repeat");if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var n="";e;)1&e&&(n+=t),(e>>>=1)&&(t+=t);return n}}),l("Number.isFinite",function(e){return e||function(e){return"number"===typeof e&&(!isNaN(e)&&1/0!==e&&-1/0!==e)}}),l("Object.values",function(e){return e||function(e){var t,n=[];for(t in e)F(e,t)&&n.push(e[t]);return n}}),l("Math.log2",function(e){return e||function(e){return Math.log(e)/Math.LN2}}),l("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991}),l("Math.trunc",function(e){return e||function(e){if(e=Number(e),isNaN(e)||1/0===e||-1/0===e||0===e)return e;var t=Math.floor(Math.abs(e));return 0>e?-t:t}}),l("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)F(e,t)&&n.push([t,e[t]]);return n}});var $=this||self;function G(e,t){e=e.split(".");var n,i=$;e[0]in i||"undefined"==typeof i.execScript||i.execScript("var "+e[0]);for(;e.length&&(n=e.shift());)e.length||void 0===t?i=i[n]&&i[n]!==Object.prototype[n]?i[n]:i[n]={}:i[n]=t}
/*
 @license
 Shaka Player
 Copyright 2016 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
function z(){}function q(){}function W(e){this.g=Math.exp(Math.log(.5)/e),this.i=this.h=0}function K(e){return e.h/(1-Math.pow(e.g,e.i))}function Y(){this.h=new W(2),this.j=new W(5),this.g=0,this.i=128e3,this.l=16e3}function X(){}function Q(){}function Z(){}function J(e){var t=U.apply(1,arguments);ie.has(e)||(ie.add(e),Z.apply(X,d(t)))}function ee(){}function te(){}function ne(){}W.prototype.sample=function(e,t){var n=Math.pow(this.g,e);t=t*(1-n)+n*this.h,isNaN(t)||(this.h=t,this.i+=e)},Y.prototype.configure=function(e){this.i=e.minTotalBytes,this.l=e.minBytes,this.h.g=Math.exp(Math.log(.5)/e.fastHalfLife),this.j.g=Math.exp(Math.log(.5)/e.slowHalfLife)},Y.prototype.sample=function(e,t){if(!(t<this.l)){var n=8e3*t/e;e/=1e3,this.g+=t,this.h.sample(e,n),this.j.sample(e,n)}},Y.prototype.getBandwidthEstimate=function(e){return this.g<this.i?e:Math.min(K(this.h),K(this.j))};var ie=new Set;function re(){this.g={}}function se(){this.g=new re}function ae(e,t,n,i){this.target=e,this.type=t,this.listener=n,this.g=oe(e,i),this.target.addEventListener(t,n,this.g)}function oe(e,t){if(void 0==t)return!1;if("boolean"==typeof t)return t;var n=new Set(["passive","capture"]);return Object.keys(t).filter(function(e){return!n.has(e)}),le(e)?t:t.capture||!1}function le(e){var t=ue;if(void 0==t){t=!1;try{var n={},i={get:function(){return t=!0,!1}};Object.defineProperty(n,"passive",i),Object.defineProperty(n,"capture",i),i=function(){},e.addEventListener("test",i,n),e.removeEventListener("test",i,n)}catch(e){t=!1}ue=t}return t||!1}e.console&&(Z=function(){return console.warn.apply(console,d(U.apply(0,arguments)))},Q=function(){console.error.apply(console,d(U.apply(0,arguments)))}),i=re.prototype,i.push=function(e,t){this.g.hasOwnProperty(e)?this.g[e].push(t):this.g[e]=[t]},i.get=function(e){return(e=this.g[e])?e.slice():null},i.remove=function(e,t){e in this.g&&(this.g[e]=this.g[e].filter(function(e){return e!=t}),0==this.g[e].length&&delete this.g[e])},i.forEach=function(e){for(var t in this.g)e(t,this.g[t])},i.size=function(){return Object.keys(this.g).length},i.keys=function(){return Object.keys(this.g)},i=se.prototype,i.release=function(){this.Ra(),this.g=null},i.D=function(e,t,n,i){this.g&&(e=new ae(e,t,n,i),this.g.push(t,e))},i.ha=function(e,t,n,i){function r(i){s.lb(e,t,r),n(i)}var s=this;this.D(e,t,r,i)},i.lb=function(e,t,n){if(this.g){var i=this.g.get(t)||[];i=c(i);for(var r=i.next();!r.done;r=i.next())r=r.value,r.target!=e||n!=r.listener&&n||(r.lb(),this.g.remove(t,r))}},i.Ra=function(){if(this.g){var e,t=this.g,n=[];for(e in t.g)n.push.apply(n,d(t.g[e]));for(t=c(n),n=t.next();!n.done;n=t.next())n.value.lb();this.g.g={}}},G("shaka.util.EventManager",se),se.prototype.removeAll=se.prototype.Ra,se.prototype.unlisten=se.prototype.lb,se.prototype.listenOnce=se.prototype.ha,se.prototype.listen=se.prototype.D,se.prototype.release=se.prototype.release,ae.prototype.lb=function(){this.target.removeEventListener(this.type,this.listener,this.g),this.listener=this.target=null,this.g=!1};var ue=void 0;function ce(t){if(he.has(t))return he.get(t);if(e.ManagedMediaSource){var n=ManagedMediaSource.isTypeSupported(t);return he.set(t,n),n}return!!e.MediaSource&&(n=MediaSource.isTypeSupported(t),he.set(t,n),n)}function de(){return!!e.SourceBuffer&&!!SourceBuffer.prototype&&!!SourceBuffer.prototype.changeType}var he=new Map;function fe(e,t){this.g=e,this.h=t}function pe(e,t){var n=new fe(5,0),i=ve,r=i.g,s=n.h-r.h;(0<(n.g-r.g||s)?i.i:i.h)(i.g,n,e,t)}function ge(e,t,n,i){Z([n,"has been deprecated and will be removed in",t,". We are currently at version",e,". Additional information:",i].join(" "))}function me(e,t,n,i){Q([n,"has been deprecated and has been removed in",t,". We are now at version",e,". Additional information:",i].join(" "))}fe.prototype.toString=function(){return"v"+this.g+"."+this.h};var ve=null;function ye(){}function be(){}function _e(){}function Te(e,t){if(!e&&!t)return!0;if(!e||!t||e.byteLength!=t.byteLength)return!1;if(Se(e)==Se(t)&&(e.byteOffset||0)==(t.byteOffset||0))return!0;var n=Ee(e);t=Ee(t);for(var i=0;i<e.byteLength;i++)if(n[i]!=t[i])return!1;return!0}function Se(e){return e instanceof ArrayBuffer?e:e.buffer}function we(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}function Ee(e,t,n){return n=void 0===n?1/0:n,Ae(e,void 0===t?0:t,n,Uint8Array)}function xe(e,t,n){return n=void 0===n?1/0:n,Ae(e,void 0===t?0:t,n,Uint16Array)}function ke(e,t,n){return n=void 0===n?1/0:n,Ae(e,void 0===t?0:t,n,DataView)}function Ae(e,t,n,i){var r=Se(e),s=1;"BYTES_PER_ELEMENT"in i&&(s=i.BYTES_PER_ELEMENT);var a=((e.byteOffset||0)+e.byteLength)/s;return e=Math.floor(Math.max(0,Math.min(((e.byteOffset||0)+t)/s,a))),new i(r,e,Math.floor(Math.min(e+Math.max(n,0),a))-e)}function Ie(){}function Ce(e){this.l=new be,(e=De[e.toLowerCase()])&&(this.l=e()),this.h=new ye,(e=Re)&&(this.h=e())}ye.prototype.extract=function(){},ye.prototype.decode=function(){return[]},ye.prototype.clear=function(){},ye.prototype.getStreams=function(){return[]},be.prototype.init=function(){},be.prototype.parse=function(){return[]},G("shaka.util.BufferUtils",_e),_e.toDataView=ke,_e.toUint16=xe,_e.toUint8=Ee,_e.toArrayBuffer=we,_e.equal=Te,Ie.prototype.init=function(){},Ie.prototype.i=function(){},Ie.prototype.g=function(){},Ie.prototype.j=function(){},G("shaka.media.IClosedCaptionParser",Ie),Ce.prototype.init=function(e,t){void 0!==t&&t||(this.g(),this.l.init(e))},Ce.prototype.i=function(e){e=this.l.parse(e),e=c(e);for(var t=e.next();!t.done;t=e.next()){t=t.value;var n=Ee(t.packet);0<n.length&&this.h.extract(n,t.pts)}return this.h.decode()},Ce.prototype.g=function(){this.h.clear()},Ce.prototype.j=function(){return this.h.getStreams()},G("shaka.media.ClosedCaptionParser",Ce),Ce.findDecoder=function(){return Re},Ce.unregisterDecoder=function(){Re=null},Ce.registerDecoder=function(e){Re=e},Ce.findParser=function(e){return De[e]},Ce.unregisterParser=function(e){delete De[e]},Ce.registerParser=function(e,t){De[e]=t};var De={},Re=null;function Me(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=Le,this.scroll=Pe}G("shaka.text.CueRegion",Me);var Le=1;Me.units={PX:0,PERCENTAGE:Le,LINES:2};var Pe="";function Oe(e,t){return!("number"!==typeof e||"number"!==typeof t||!isNaN(e)||!isNaN(t))||e===t}function Ne(e,t){t=e.indexOf(t),-1<t&&e.splice(t,1)}function Ue(e,t,n){if(n||(n=Oe),e.length!=t.length)return!1;t=t.slice();var i={};e=c(e);for(var r=e.next();!r.done;i={Qe:i.Qe},r=e.next()){if(i.Qe=r.value,r=t.findIndex(function(e){return function(t){return n(e.Qe,t)}}(i)),-1==r)return!1;t[r]=t[t.length-1],t.pop()}return 0==t.length}function Fe(e,t,n){if(n||(n=Oe),e.length!=t.length)return!1;for(var i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}function Be(e,t,n){this.startTime=e,this.endTime=t,this.payload=n,this.region=new Me,this.position=null,this.positionAlign=He,this.size=0,this.textAlign=$e,this.direction=We,this.writingMode=Ke,this.lineInterpretation=Ye,this.line=null,this.lineHeight="",this.lineAlign=Xe,this.displayAlign=ze,this.fontSize=this.border=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=et,this.fontStyle=tt,this.linePadding=this.letterSpacing=this.fontFamily="",this.opacity=1,this.textCombineUpright="",this.textDecoration=[],this.textStrokeWidth=this.textStrokeColor=this.textShadow="",this.wrapLine=!0,this.id="",this.nestedCues=[],this.lineBreak=this.isContainer=!1,this.rubyTag=null,this.cellResolution={kc:32,rows:15}}function je(e,t){return e=new Be(e,t,""),e.lineBreak=!0,e}function Ve(e,t){if(e.startTime!=t.startTime||e.endTime!=t.endTime||e.payload!=t.payload)return!1;for(var n in e)if("startTime"!=n&&"endTime"!=n&&"payload"!=n)if("nestedCues"==n){if(!Fe(e.nestedCues,t.nestedCues,Ve))return!1}else if("region"==n||"cellResolution"==n){for(var i in e[n])if(e[n][i]!=t[n][i])return!1}else if(Array.isArray(e[n])){if(!Fe(e[n],t[n]))return!1}else if(e[n]!=t[n])return!1;return!0}Me.scrollMode={NONE:Pe,UP:"up"},Be.prototype.clone=function(){var e,t=new Be(0,0,"");for(e in this)t[e]=this[e],t[e]&&t[e].constructor==Array&&(t[e]=t[e].slice());return t},G("shaka.text.Cue",Be),Be.equal=Ve,Be.prototype.clone=Be.prototype.clone;var He="auto";Be.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:He};var $e="center",Ge={LEFT:"left",RIGHT:"right",CENTER:$e,START:"start",END:"end"};Be.textAlign=Ge;var ze="after",qe={BEFORE:"before",CENTER:"center",AFTER:ze};Be.displayAlign=qe;var We="ltr";Be.direction={HORIZONTAL_LEFT_TO_RIGHT:We,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var Ke="horizontal-tb";Be.writingMode={HORIZONTAL_TOP_TO_BOTTOM:Ke,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var Ye=0;Be.lineInterpretation={LINE_NUMBER:Ye,PERCENTAGE:1};var Xe="start",Qe={CENTER:"center",START:Xe,END:"end"};Be.lineAlign=Qe;var Ze={white:"white",lime:"lime",cyan:"cyan",red:"red",yellow:"yellow",magenta:"magenta",blue:"blue",black:"black"};Be.defaultTextColor=Ze;var Je={bg_white:"white",bg_lime:"lime",bg_cyan:"cyan",bg_red:"red",bg_yellow:"yellow",bg_magenta:"magenta",bg_blue:"blue",bg_black:"black"};Be.defaultTextBackgroundColor=Je;var et=400;Be.fontWeight={NORMAL:et,BOLD:700};var tt="normal",nt={NORMAL:tt,ITALIC:"italic",OBLIQUE:"oblique"};function it(){}function rt(e,t,n){at[e.toLowerCase().split(";")[0]+"-"+n]={priority:n,De:t}}function st(e,t){for(var n=e.toLowerCase().split(";")[0],i=c([ct,ut,lt,ot]),r=i.next();!r.done;r=i.next())if(r=at[n+"-"+r.value]){var s=r.De(),a=s.isSupported(e,t);if(s.destroy(),a)return r.De}return null}Be.fontStyle=nt,Be.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},it.prototype.destroy=function(){},G("shaka.transmuxer.TransmuxerEngine",it),it.findTransmuxer=st,it.unregisterTransmuxer=function(e,t){delete at[e.toLowerCase().split(";")[0]+"-"+t]},it.registerTransmuxer=rt,it.prototype.destroy=it.prototype.destroy;var at={},ot=1,lt=2,ut=3,ct=4;it.PluginPriority={FALLBACK:ot,PREFERRED_SECONDARY:lt,PREFERRED:ut,APPLICATION:ct};
/*
 @license
 Copyright 2008 The Closure Library Authors
 SPDX-License-Identifier: Apache-2.0
*/
var dt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$");
/*
 @license
 Copyright 2006 The Closure Library Authors
 SPDX-License-Identifier: Apache-2.0
*/function ht(e){var t;e instanceof ht?(ft(this,e.Db),this.yc=e.yc,pt(this,e.Gb),gt(this,e.Pc),this.Pa=e.Pa,mt(this,e.g.clone()),this.lc=e.lc):e&&(t=String(e).match(dt))?(ft(this,t[1]||"",!0),this.yc=vt(t[2]||""),pt(this,t[3]||"",!0),gt(this,t[4]),this.Pa=vt(t[5]||"",!0),mt(this,t[6]||"",!0),this.lc=vt(t[7]||"")):this.g=new xt(null)}function ft(e,t,n){e.Db=n?vt(t,!0):t,e.Db&&(e.Db=e.Db.replace(/:$/,""))}function pt(e,t,n){e.Gb=n?vt(t,!0):t}function gt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.Pc=t}else e.Pc=null}function mt(e,t,n){t instanceof xt?e.g=t:(n||(t=yt(t,wt)),e.g=new xt(t))}function vt(e,t){return e?t?decodeURI(e):decodeURIComponent(e):""}function yt(e,t,n){return null!=e?(e=encodeURI(e).replace(t,bt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function bt(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(15&e).toString(16)}i=ht.prototype,i.Db="",i.yc="",i.Gb="",i.Pc=null,i.Pa="",i.lc="",i.toString=function(){var e=[],t=this.Db;if(t&&e.push(yt(t,_t,!0),":"),t=this.Gb){e.push("//");var n=this.yc;n&&e.push(yt(n,_t,!0),"@"),e.push(encodeURIComponent(t).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.Pc,null!=t&&e.push(":",String(t))}return(t=this.Pa)&&(this.Gb&&"/"!=t.charAt(0)&&e.push("/"),e.push(yt(t,"/"==t.charAt(0)?St:Tt,!0))),(t=this.g.toString())&&e.push("?",t),(t=this.lc)&&e.push("#",yt(t,Et)),e.join("")},i.resolve=function(e){var t=this.clone();"data"===t.Db&&(t=new ht);var n=!!e.Db;n?ft(t,e.Db):n=!!e.yc,n?t.yc=e.yc:n=!!e.Gb,n?pt(t,e.Gb):n=null!=e.Pc;var i=e.Pa;if(n)gt(t,e.Pc);else if(n=!!e.Pa){if("/"!=i.charAt(0))if(this.Gb&&!this.Pa)i="/"+i;else{var r=t.Pa.lastIndexOf("/");-1!=r&&(i=t.Pa.substr(0,r+1)+i)}if(".."==i||"."==i)i="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var s=[],a=0;a<i.length;){var o=i[a++];"."==o?r&&a==i.length&&s.push(""):".."==o?((1<s.length||1==s.length&&""!=s[0])&&s.pop(),r&&a==i.length&&s.push("")):(s.push(o),r=!0)}i=s.join("/")}}return n?t.Pa=i:n=""!==e.g.toString(),n?mt(t,e.g.clone()):n=!!e.lc,n&&(t.lc=e.lc),t},i.clone=function(){return new ht(this)};var _t=/[#\/\?@]/g,Tt=/[#\?:]/g,St=/[#\?]/g,wt=/[#\?@]/g,Et=/#/g;function xt(e){this.g=e||null}function kt(e){if(!e.Ka&&(e.Ka={},e.pd=0,e.g))for(var t=e.g.split("&"),n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var s=t[n].substring(0,i);r=t[n].substring(i+1)}else s=t[n];s=decodeURIComponent(s.replace(/\+/g," ")),r=r||"",e.add(s,decodeURIComponent(r.replace(/\+/g," ")))}}function At(e){return kt(e),e.pd}function It(e,t,n){var i=U.apply(3,arguments);if(this.severity=e,this.category=t,this.code=n,this.data=i,this.handled=!1,this.message="Shaka Error "+this.code,Ct)try{throw Error(this.message||"Shaka Error")}catch(e){this.stack=e.stack}}i=xt.prototype,i.Ka=null,i.pd=null,i.add=function(e,t){kt(this),this.g=null;var n=this.Ka.hasOwnProperty(e)?this.Ka[e]:null;return n||(this.Ka[e]=n=[]),n.push(t),this.pd++,this},i.set=function(e,t){return kt(this),this.g=null,this.Ka.hasOwnProperty(e)?this.Ka[e]=[t]:this.add(e,t),this},i.get=function(e){return kt(this),this.Ka[e]||[]},i.toString=function(){if(this.g)return this.g;if(!this.Ka)return"";var e,t=[];for(e in this.Ka)for(var n=encodeURIComponent(e),i=this.Ka[e],r=0;r<i.length;r++){var s=n;""!==i[r]&&(s+="="+encodeURIComponent(i[r])),t.push(s)}return this.g=t.join("&")},i.clone=function(){var e=new xt;if(e.g=this.g,this.Ka){var t,n={};for(t in this.Ka)n[t]=this.Ka[t].concat();e.Ka=n,e.pd=this.pd}return e},It.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},G("shaka.util.Error",It);var Ct=!0;function Dt(e){this.h=e,this.g=void 0}function Rt(e,t){return!e.length||!t.length||e===t||0<Mt(e,t).length}function Mt(e,t){if(!e.length)return t;if(!t.length)return e;var n=[];e=c(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;for(var r=c(t),s=r.next();!s.done;s=r.next())if(s=s.value,i.keySystem==s.keySystem){r=new Map;for(var a=c((i.initData||[]).concat(s.initData||[])),o=a.next();!o.done;o=a.next())o=o.value,r.set(o.keyId,o);r=Array.from(r.values()),a=i.keyIds&&s.keyIds?new Set([].concat(d(i.keyIds),d(s.keyIds))):i.keyIds||s.keyIds,n.push({keySystem:i.keySystem,licenseServerUri:i.licenseServerUri||s.licenseServerUri,distinctiveIdentifierRequired:i.distinctiveIdentifierRequired||s.distinctiveIdentifierRequired,persistentStateRequired:i.persistentStateRequired||s.persistentStateRequired,videoRobustness:i.videoRobustness||s.videoRobustness,audioRobustness:i.audioRobustness||s.audioRobustness,serverCertificate:i.serverCertificate||s.serverCertificate,serverCertificateUri:i.serverCertificateUri||s.serverCertificateUri,initData:r,keyIds:a});break}}return n}function Lt(e){return!!e&&!!e.match(/^com\.(microsoft|chromecast)\.playready/)}It.Severity={RECOVERABLE:1,CRITICAL:2},It.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9,ADS:10},It.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,ATTEMPTS_EXHAUSTED:1010,SEGMENT_MISSING:1011,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,INVALID_MP4_CEA:2010,TEXT_COULD_NOT_GUESS_MIME_TYPE:2011,CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS:2012,TEXT_ONLY_WEBVTT_SRC_EQUALS:2013,MISSING_TEXT_PLUGIN:2014,CHAPTERS_TRACK_FAILED:2015,UNSUPPORTED_EXTERNAL_THUMBNAILS_URI:2017,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,CONTENT_TRANSFORMATION_FAILED:3019,MSS_MISSING_DATA_FOR_TRANSMUXING:3020,MSS_TRANSMUXING_FAILED:3022,TRANSMUXING_NO_VIDEO_DATA:3023,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,RESTRICTIONS_CANNOT_BE_MET:4012,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,NO_VARIANTS:4036,PERIOD_FLATTENING_FAILED:4037,INCONSISTENT_DRM_ACROSS_PERIODS:4038,HLS_VARIABLE_NOT_FOUND:4039,HLS_MSE_ENCRYPTED_MP2T_NOT_SUPPORTED:4040,HLS_MSE_ENCRYPTED_LEGACY_APPLE_MEDIA_KEYS_NOT_SUPPORTED:4041,NO_WEB_CRYPTO_API:4042,CANNOT_ADD_EXTERNAL_THUMBNAILS_TO_LIVE_STREAM:4045,MSS_INVALID_XML:4046,MSS_LIVE_CONTENT_NOT_SUPPORTED:4047,AES_128_INVALID_IV_LENGTH:4048,AES_128_INVALID_KEY_LENGTH:4049,DASH_CONFLICTING_AES_128:4050,DASH_UNSUPPORTED_AES_128:4051,DASH_INVALID_PATCH:4052,STREAMING_ENGINE_STARTUP_INVALID_STATE:5006,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,SERVER_CERTIFICATE_REQUEST_FAILED:6017,MIN_HDCP_VERSION_NOT_MATCH:6018,ERROR_CHECKING_HDCP_VERSION:6019,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,OBJECT_DESTROYED:7003,CONTENT_NOT_LOADED:7004,SRC_EQUALS_PRELOAD_NOT_SUPPORTED:7005,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013,STORAGE_LIMIT_REACHED:9014,DOWNLOAD_SIZE_CALLBACK_ERROR:9015,MODIFY_OPERATION_NOT_SUPPORTED:9016,INDEXED_DB_INIT_TIMED_OUT:9017,CS_IMA_SDK_MISSING:1e4,CS_AD_MANAGER_NOT_INITIALIZED:10001,SS_IMA_SDK_MISSING:10002,SS_AD_MANAGER_NOT_INITIALIZED:10003,CURRENT_DAI_REQUEST_NOT_FINISHED:10004,MT_AD_MANAGER_NOT_INITIALIZED:10005},Dt.prototype.value=function(){return void 0==this.g&&(this.g=this.h()),this.g};var Pt=new Dt(function(){return we(new Uint8Array([0]))}),Ot=new Map;function Nt(e){this.h=e,this.g=null}function Ut(e){this.h=e,this.g=null}function Ft(){var t=e.ManagedMediaSource||e.MediaSource;return!(!t||!t.isTypeSupported)}function Bt(e){return""!=an().canPlayType(e)}function jt(){return!!navigator.userAgent.match(/Edge?\//)}function Vt(){return sn("Xbox One")}function Ht(){return sn("Tizen")}function $t(){return sn("Tizen 3")}function Gt(){return sn("Tizen 2")}function zt(){return sn("Web0S")}function qt(){return zt()&&38===Kt()}function Wt(){return sn("CrKey")}function Kt(){if(!sn("Chrome")||navigator.userAgent.match(/Edge\//))return null;var e=navigator.userAgent.match(/Chrome\/(\d+)/);return e?parseInt(e[1],10):null}function Yt(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!Ht()&&!sn("PC=EOS")&&!sn("PC=APL")&&!sn("VirginMedia")&&!Jt()&&!Qt()&&!sn("AFT")&&!sn("WPE")&&!sn("DT_STB_BCM")}function Xt(){return sn("PlayStation 5")}function Qt(){return sn("PlayStation 4")}function Zt(){return sn("Hisense")||sn("VIDAA")}function Jt(){return sn("SOPOpenBrowser")}function en(){if(!Yt())return null;var e=navigator.userAgent.match(/Version\/(\d+)/);return e?parseInt(e[1],10):(e=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(e[1],10):null}function tn(){return navigator.userAgentData&&navigator.userAgentData.platform?"windows"==navigator.userAgentData.platform.toLowerCase():!!navigator.platform&&navigator.platform.toLowerCase().includes("windows")}function nn(){return sn("Android")}function rn(){return!!(Ht()||zt()||Vt()||Qt()||Xt()||sn("AFT")||sn("PC=EOS")||sn("PC=APL")||sn("VirginMedia")||Jt()||sn("WPE")||Wt()||Zt()||sn("DT_STB_BCM"))}function sn(e){return(navigator.userAgent||"").includes(e)}function an(){return cn||(un||(un=new Ut(function(){cn=null})),(cn=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0])||(cn=document.createElement("video")),un.Y(1),cn)}function on(t){return t?t===e.shakaMediaKeysPolyfill:!!e.shakaMediaKeysPolyfill}function ln(){var t,n,i,r,s,a,o,l,u,c,d,h,f,p;return N(function(g){switch(g.g){case 1:if(t={width:1/0,height:1/0},Wt()){if(d=e.cast&&cast.__platform__&&cast.__platform__.canDisplayType,t.width=1280,t.height=720,E(g,15),!(h=d)){g.u(17);break}return S(g,cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160'),18)}if(Ht()){t.width=1920,t.height=1080;try{webapis.systeminfo&&webapis.systeminfo.getMaxVideoResolution?(n=webapis.systeminfo.getMaxVideoResolution(),t.width=n.width,t.height=n.height):webapis.productinfo.is8KPanelSupported&&webapis.productinfo.is8KPanelSupported()?(t.width=7680,t.height=4320):webapis.productinfo.isUdPanelSupported&&webapis.productinfo.isUdPanelSupported()&&(t.width=3840,t.height=2160)}catch(e){Z("Tizen: Error detecting screen size, default screen size 1920x1080.")}g.u(3);break}if(Vt()){t.width=1920,t.height=1080;try{i=new Windows.Media.Protection.ProtectionCapabilities,r=Windows.Media.Protection.ProtectionCapabilityResult,s=null;do{s=i.isTypeSupported('video/mp4;codecs="hvc1,mp4a";features="decode-res-x=3840,decode-res-y=2160,decode-bitrate=20000,decode-fps=30,decode-bpc=10,display-res-x=3840,display-res-y=2160,display-bpc=8"',"com.microsoft.playready.recommendation")}while(s===r.maybe);s===r.probably&&(t.width=3840,t.height=2160)}catch(e){Z("Xbox: Error detecting screen size, default screen size 1920x1080.")}g.u(3);break}if(zt()){try{a=JSON.parse(e.PalmSystem.deviceInfo),t.width=Math.max(1920,a.screenWidth),t.height=Math.max(1080,a.screenHeight)}catch(e){Z("WebOS: Error detecting screen size, default screen size 1920x1080."),t.width=1920,t.height=1080}g.u(3);break}if(Zt()){e.Hisense_Get4KSupportState&&e.Hisense_Get4KSupportState()?(t.width=3840,t.height=2160):(t.width=1920,t.height=1080),g.u(3);break}if(!Qt()&&!Xt()){g.u(3);break}return o=!1,E(g,9),S(g,e.msdk.device.getDisplayInfo(),11);case 11:l=g.h,o="4K"===l.resolution,k(g,10);break;case 9:return A(g),E(g,12),S(g,e.msdk.device.getDisplayInfoImmediate(),14);case 14:u=g.h,o="4K"===u.resolution,k(g,10);break;case 12:c=A(g),Z("PlayStation: Failed to get the display info:",c);case 10:o?(t.width=3840,t.height=2160):(t.width=1920,t.height=1080),g.u(3);break;case 18:h=g.h;case 17:if(h){t.width=3840,t.height=2160,g.u(19);break}if(!(f=d)){g.u(20);break}return S(g,cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=1920; height=1080'),21);case 21:f=g.h;case 20:f&&(t.width=1920,t.height=1080);case 19:k(g,3);break;case 15:p=A(g),Q("Failed to check canDisplayType:",p);case 3:return g.return(t)}})}Nt.prototype.Y=function(t){var n=this;this.stop();var i=!0,r=null;return this.g=function(){e.clearTimeout(r),i=!1},r=e.setTimeout(function(){i&&n.h()},1e3*t),this},Nt.prototype.stop=function(){this.g&&(this.g(),this.g=null)},Ut.prototype.xc=function(){return this.stop(),this.h(),this},Ut.prototype.Y=function(e){var t=this;return this.stop(),this.g=new Nt(function(){t.h()}).Y(e),this},Ut.prototype.Sa=function(e){var t=this;return this.stop(),this.g=new Nt(function(){t.g.Y(e),t.h()}).Y(e),this},Ut.prototype.stop=function(){this.g&&(this.g.stop(),this.g=null)},G("shaka.util.Timer",Ut),Ut.prototype.stop=Ut.prototype.stop,Ut.prototype.tickEvery=Ut.prototype.Sa,Ut.prototype.tickAfter=Ut.prototype.Y,Ut.prototype.tickNow=Ut.prototype.xc;var un=null,cn=null;function dn(){}function hn(t){if(!t)return"";if(t=Ee(t),239==t[0]&&187==t[1]&&191==t[2]&&(t=t.subarray(3)),e.TextDecoder&&!Qt())return t=(new TextDecoder).decode(t),t.includes("")&&Q('Decoded string contains an "unknown character" codepoint.  That probably means the UTF8 encoding was incorrect!'),t;for(var n="",i=0;i<t.length;++i){var r=65533;if(0==(128&t[i])?r=t[i]:t.length>=i+2&&192==(224&t[i])&&128==(192&t[i+1])?(r=(31&t[i])<<6|63&t[i+1],i+=1):t.length>=i+3&&224==(240&t[i])&&128==(192&t[i+1])&&128==(192&t[i+2])?(r=(15&t[i])<<12|(63&t[i+1])<<6|63&t[i+2],i+=2):t.length>=i+4&&240==(241&t[i])&&128==(192&t[i+1])&&128==(192&t[i+2])&&128==(192&t[i+3])&&(r=(7&t[i])<<18|(63&t[i+1])<<12|(63&t[i+2])<<6|63&t[i+3],i+=3),65535>=r)n+=String.fromCharCode(r);else{r-=65536;var s=1023&r;n+=String.fromCharCode(55296+(r>>10)),n+=String.fromCharCode(56320+s)}}return n}function fn(e,t,n){if(!e)return"";if(!n&&0!=e.byteLength%2)throw new It(2,2,2004);n=Math.floor(e.byteLength/2);var i=new Uint16Array(n);e=ke(e);for(var r=0;r<n;r++)i[r]=e.getUint16(2*r,t);return vn(i)}function pn(e){function t(e){return n.byteLength<=e||32<=n[e]&&126>=n[e]}if(!e)return"";var n=Ee(e);if(239==n[0]&&187==n[1]&&191==n[2])return hn(n);if(254==n[0]&&255==n[1])return fn(n.subarray(2),!1);if(255==n[0]&&254==n[1])return fn(n.subarray(2),!0);if(0==n[0]&&0==n[2])return fn(e,!1);if(0==n[1]&&0==n[3])return fn(e,!0);if(t(0)&&t(1)&&t(2)&&t(3))return hn(e);throw new It(2,2,2003)}function gn(t){if(e.TextEncoder&&!Qt()){var n=new TextEncoder;return we(n.encode(t))}t=encodeURIComponent(t),t=unescape(t),n=new Uint8Array(t.length);for(var i=0;i<t.length;i++)n[i]=t[i].charCodeAt(0);return we(n)}function mn(e,t){for(var n=new ArrayBuffer(2*e.length),i=new DataView(n),r=0;r<e.length;++r)i.setUint16(2*r,e.charCodeAt(r),t);return n}function vn(e){return bn.value()(e)}function yn(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&nbsp;":"","&lrm;":"","&rlm;":""},n=/&(?:amp|lt|gt|quot|apos|nbsp|lrm|rlm|#[xX]?[0-9a-fA-F]+);/g,i=RegExp(n.source);return e&&i.test(e)?e.replace(n,function(e){return"#"==e[1]?(e="x"==e[2]||"X"==e[2]?parseInt(e.substring(3),16):parseInt(e.substring(2),10),0<=e&&1114111>=e?String.fromCodePoint(e):""):t[e]||"'"}):e||""}G("shaka.util.StringUtils",dn),dn.resetFromCharCode=function(){bn.g=void 0},dn.toUTF16=mn,dn.toUTF8=gn,dn.fromBytesAutoDetect=pn,dn.fromUTF16=fn,dn.fromUTF8=hn;var bn=new Dt(function(){function e(e){try{var t=new Uint8Array(e);return 0<String.fromCharCode.apply(null,t).length}catch(e){return!1}}for(var t={Tb:65536};0<t.Tb;t={Tb:t.Tb},t.Tb/=2)if(e(t.Tb))return function(e){return function(t){for(var n="",i=0;i<t.length;i+=e.Tb)n+=String.fromCharCode.apply(null,t.subarray(i,i+e.Tb));return n}}(t);return null});function _n(){}function Tn(e){return e=vn(Ee(e)),btoa(e)}function Sn(e,t){return t=void 0==t||t,e=Tn(e).replace(/\+/g,"-").replace(/\//g,"_"),t?e:e.replace(/[=]*$/,"")}function wn(t){t=e.atob(t.replace(/-/g,"+").replace(/_/g,"/"));for(var n=new Uint8Array(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}function En(t){for(var n=t.length/2,i=new Uint8Array(n),r=0;r<n;r++)i[r]=e.parseInt(t.substr(2*r,2),16);return i}function xn(e){var t=Ee(e);e="",t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value,n=n.toString(16),1==n.length&&(n="0"+n),e+=n;return e}function kn(){for(var e=U.apply(0,arguments),t=0,n=0;n<e.length;++n)t+=e[n].byteLength;t=new Uint8Array(t);for(var i=n=0;i<e.length;++i){var r=e[i];r instanceof Uint8Array?t.set(r,n):t.set(Ee(r),n),n+=r.byteLength}return t}function An(e,t){if(0==t.length)return e;if(1==e.length&&1==t.length){var n=new ht(e[0]);return t=new ht(t[0]),[n.resolve(t).toString()]}t=t.map(function(e){return new ht(e)}),n=[],e=c(e);for(var i=e.next();!i.done;i=e.next()){i=new ht(i.value);for(var r=c(t),s=r.next();!s.done;s=r.next())n.push(i.resolve(s.value).toString())}return n}function In(e,t,n,i){return e={keySystem:e,encryptionScheme:t,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:n||[],keyIds:new Set},i&&(e.keySystemUris=new Set([i])),e}function Cn(t,n){n=void 0===n?"cenc":n;var i=[],r=[],s=[];t.forEach(function(e,t){var n=t;22!=n.length&&(n=Sn(En(t),!1));var a=e;22!=a.length&&(a=Sn(En(e),!1)),e={kty:"oct",kid:n,k:a},i.push(e),r.push(e.kid),s.push(t)}),t=JSON.stringify({keys:i});var a=JSON.stringify({kids:r});return a=[{initData:Ee(gn(a)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",encryptionScheme:n,licenseServerUri:"data:application/json;base64,"+e.btoa(t),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:a,keyIds:new Set(s)}}function Dn(e,t){if(1==t.length)return t[0];if(e=Rn(e,t),null!=e)return e;throw new It(2,4,4025,t)}function Rn(e,t){for(var n=c(Nn[e]),i=n.next();!i.done;i=n.next()){i=i.value;for(var r=c(t),s=r.next();!s.done;s=r.next())if(s=s.value,i.test(s.trim()))return s.trim()}return e==Ln?"":null}function Mn(e,t){var n=[];e=c(Nn[e]);for(var i=e.next();!i.done;i=e.next()){i=i.value;for(var r=c(t),s=r.next();!s.done;s=r.next())s=s.value,i.test(s.trim())&&n.push(s.trim())}return n}G("shaka.util.Uint8ArrayUtils",_n),_n.concat=kn,_n.toHex=xn,_n.fromHex=En,_n.fromBase64=wn,_n.toBase64=Sn,_n.toStandardBase64=Tn;var Ln="text",Pn={ga:"video",X:"audio",ta:Ln,Ze:"image",nj:"application"},On=1/15,Nn={audio:[/^vorbis$/,/^Opus$/,/^opus$/,/^fLaC$/,/^flac$/,/^mp4a/,/^[ae]c-3$/,/^ac-4/,/^dts[cex]$/,/^iamf/,/^mhm[12]/],video:[/^avc/,/^hev/,/^hvc/,/^vvc/,/^vvi/,/^vp0?[89]/,/^av01/,/^dvh/,/^dva/,/^dav/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function Un(){}function Fn(e,t){var n=e;return t&&!Xn.includes(e)&&(n+='; codecs="'+t+'"'),n}function Bn(e,t){return t&&(e+='; codecs="'+t+'"'),e}function jn(e,t,n){var i=Fn(e,t);return t=Bn(e,t),st(t)?(e=st(t))?(e=e(),n=e.convertCodecs(n,t),e.destroy()):n=t:n="video/mp2t"!=e&&"audio"==n?i.replace("video","audio"):i,n}function Vn(e,t,n){var i=[t];return Yn.forEach(function(t,r){var s=e[r];"codecs"==r?Xn.includes(e.mimeType)||i.push('codecs="'+n+'"'):s&&i.push(t+'="'+s+'"')}),"PQ"==e.hdr&&i.push('eotf="smpte2084"'),i.join(";")}function Hn(e){return e.split(";")[0].split("/")[1]}function $n(e){var t=Kn(e);switch(e=t[0],t=t[1].toLowerCase(),!0){case"mp4a"===e&&"69"===t:case"mp4a"===e&&"6b"===t:case"mp4a"===e&&"40.34"===t:return"mp3";case"mp4a"===e&&"66"===t:case"mp4a"===e&&"67"===t:case"mp4a"===e&&"68"===t:case"mp4a"===e&&"40.2"===t:case"mp4a"===e&&"40.02"===t:case"mp4a"===e&&"40.5"===t:case"mp4a"===e&&"40.05"===t:case"mp4a"===e&&"40.29"===t:case"mp4a"===e&&"40.42"===t:return"aac";case"mp4a"===e&&"a5"===t:return"ac-3";case"mp4a"===e&&"a6"===t:return"ec-3";case"mp4a"===e&&"b2"===t:return"dtsx";case"mp4a"===e&&"a9"===t:return"dtsc";case"avc1"===e:case"avc3"===e:return"avc";case"hvc1"===e:case"hev1"===e:return"hevc";case"dvh1"===e:case"dvhe"===e:return"dovi-hevc";case"dvav"===e:case"dva1"===e:return"dovi-avc";case"dav1"===e:return"dovi-av1"}return e}function Gn(e){var t=[];e=c(e.split(","));for(var n=e.next();!n.done;n=e.next())n=Kn(n.value),t.push(n[0]);return t.sort().join(",")}function zn(e){return e.split(";")[0]}function qn(e){return e=e.split(/ *; */),e.shift(),(e=e.find(function(e){return e.startsWith("codecs=")}))?e.split("=")[1].replace(/^"|"$/g,""):""}function Wn(e){return"application/x-mpegurl"===e||"application/vnd.apple.mpegurl"===e}function Kn(e){e=e.split(".");var t=e[0];return e.shift(),[t,e.join(".")]}G("shaka.util.MimeUtils",Un),Un.getFullTypeWithAllCodecs=Bn,Un.getFullType=Fn;var Yn=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels"),Xn=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"];function Qn(e){this.i=null,this.j=e,this.B=!1,this.l=this.s=0,this.m=1/0,this.h=this.g=null,this.C="",this.A=function(){},this.o=new Map}function Zn(e){return!!ri[e]||("application/cea-608"==e||"application/cea-708"==e)&&!!Re}function Jn(e,t,n,i,r){var s,a,o,l,u,d,h;return N(function(f){if(1==f.g)return S(f,Promise.resolve(),2);if(!e.i||!e.j)return f.return();if(null==n||null==i)return e.i.parseInit(Ee(t)),f.return();for(s=e.B?n:e.s,a={periodStart:e.s,segmentStart:n,segmentEnd:i,vttOffset:s},o=e.i.parseMedia(Ee(t),a,r),l=c(o),u=l.next();!u.done;u=l.next())d=u.value,e.A(d,r||null,a);h=o.filter(function(t){return t.startTime>=e.l&&t.startTime<e.m}),e.j.append(h),null==e.g&&(e.g=Math.max(n,e.l)),e.h=Math.min(i,e.m),w(f)})}function ei(e,t,n){e.l=t,e.m=n}function ti(e,t,n){if(e.C=t,t=e.o.get(t))for(var i=c(t.keys()),r=i.next();!r.done;r=i.next())(r=t.get(r.value).filter(function(e){return e.endTime<=n}))&&e.j.append(r)}function ni(e,t,n){t.startTime+=n,t.endTime+=n,t=c(t.nestedCues);for(var i=t.next();!i.done;i=t.next())ni(e,i.value,n)}function ii(e,t,n,i,r){var s=n+" "+i,a=new Map;t=c(t);for(var o=t.next();!o.done;o=t.next()){var l=o.value;o=l.stream,l=l.cue,a.has(o)||a.set(o,new Map),a.get(o).has(s)||a.get(o).set(s,[]),ni(e,l,r),l.startTime>=e.l&&l.startTime<e.m&&(a.get(o).get(s).push(l),o==e.C&&e.j.append([l]))}for(r=c(a.keys()),s=r.next();!s.done;s=r.next())for(s=s.value,e.o.has(s)||e.o.set(s,new Map),t=c(a.get(s).keys()),o=t.next();!o.done;o=t.next())o=o.value,l=a.get(s).get(o),e.o.get(s).set(o,l);e.g=null==e.g?Math.max(n,e.l):Math.min(e.g,Math.max(n,e.l)),e.h=Math.max(e.h,Math.min(i,e.m))}Qn.prototype.destroy=function(){return this.j=this.i=null,this.o.clear(),Promise.resolve()},Qn.prototype.remove=function(e,t){var n=this;return N(function(i){if(1==i.g)return S(i,Promise.resolve(),2);!n.j||!n.j.remove(e,t)||null==n.g||t<=n.g||e>=n.h||(e<=n.g&&t>=n.h?n.g=n.h=null:e<=n.g&&t<n.h?n.g=t:e>n.g&&t>=n.h&&(n.h=e)),w(i)})},G("shaka.text.TextEngine",Qn),Qn.prototype.destroy=Qn.prototype.destroy,Qn.findParser=function(e){return ri[e]},Qn.unregisterParser=function(e){delete ri[e]},Qn.registerParser=function(e,t){ri[e]=t};var ri={};function si(e,t){return e.concat(t)}function ai(){}function oi(e){return null!=e}function li(){}function ui(e,t){return e=hi(e),t=hi(t),e.split("-")[0]==t.split("-")[0]}function ci(e,t){return e=hi(e),t=hi(t),e=e.split("-"),t=t.split("-"),e[0]==t[0]&&1==e.length&&2==t.length}function di(e,t){return e=hi(e),t=hi(t),e=e.split("-"),t=t.split("-"),2==e.length&&2==t.length&&e[0]==t[0]}function hi(e){e=c(e.split("-x-"));var t=e.next().value;t=void 0===t?"":t,e=e.next().value,e=void 0===e?"":e;var n=c(t.split("-"));return t=n.next().value,t=void 0===t?"":t,n=n.next().value,n=void 0===n?"":n,e=e?"x-"+e:"",t=t.toLowerCase(),t=vi.get(t)||t,n=n.toUpperCase(),(n?t+"-"+n:t)+(e?"-"+e:"")}function fi(e,t){return e=hi(e),t=hi(t),t==e?4:ci(t,e)?3:di(t,e)?2:ci(e,t)?1:0}function pi(e){var t=e.indexOf("-");return e=0<=t?e.substring(0,t):e,e=e.toLowerCase(),vi.get(e)||e}function gi(e){return e.language?hi(e.language):e.audio&&e.audio.language?hi(e.audio.language):e.video&&e.video.language?hi(e.video.language):"und"}function mi(e,t){e=hi(e);var n=new Set,i=c(t);for(t=i.next();!t.done;t=i.next())n.add(hi(t.value));for(i=c(n),t=i.next();!t.done;t=i.next())if(t=t.value,t==e)return t;for(i=c(n),t=i.next();!t.done;t=i.next())if(t=t.value,ci(t,e))return t;for(i=c(n),t=i.next();!t.done;t=i.next())if(t=t.value,di(t,e))return t;for(n=c(n),t=n.next();!t.done;t=n.next())if(t=t.value,ci(e,t))return t;return null}G("shaka.util.LanguageUtils",li),li.findClosestLocale=mi,li.getLocaleForVariant=gi,li.getLocaleForText=function(e){return hi(e.language||"und")},li.getBase=pi,li.relatedness=fi,li.areSiblings=function(e,t){var n=pi(e),i=pi(t);return e!=n&&t!=i&&n==i},li.normalize=hi,li.isSiblingOf=di,li.isParentOf=ci,li.areLanguageCompatible=ui,li.areLocaleCompatible=function(e,t){return e=hi(e),t=hi(t),e==t};var vi=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]);function yi(e){function t(e){switch(typeof e){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return e;default:if(!e||e.buffer instanceof ArrayBuffer)return e;if(n.has(e))return null;var i=e.constructor==Array;if(e.constructor!=Object&&!i)return null;n.add(e);var r,s=i?[]:{};for(r in e)s[r]=t(e[r]);return i&&(s.length=e.length),s}}var n=new WeakSet;return t(e)}function bi(e){var t,n={};for(t in e)n[t]=e[t];return n}function _i(){}function Ti(e,t,n,i){var r=e.variants;if((t.length||n.length)&&(r=Si(r,t,n)),i.length){for(t=new re,n=c(r),r=n.next();!r.done;r=n.next())r=r.value,t.push(String(r.video.width||0),r);var s=[];t.forEach(function(e,t){e=0;var n=[],r={};t=c(t);for(var a=t.next();!a.done;r={ld:r.ld},a=t.next())r.ld=a.value,a=i.filter(function(e){return function(t){return e.ld.decodingInfos[0][t]}}(r)).length,a>e?(e=a,n=[r.ld]):a==e&&n.push(r.ld);s.push.apply(s,d(n))}),r=s}n=new Set,t=new Set;var a=c(r);for(r=a.next();!r.done;r=a.next())r=r.value,r.audio&&n.add(r.audio),r.video&&t.add(r.video);n=Array.from(n).sort(function(e,t){return e.bandwidth-t.bandwidth});var o=[];for(r=new Map,n=c(n),a=n.next();!a.done;a=n.next()){a=a.value;var l=a.language+(a.channelsCount||0)+(a.audioSamplingRate||0)+a.roles.join(",")+a.label+a.groupId+a.fastSwitching,u=r.get(l)||[];if(u.length){var h=u[u.length-1],f=$n(h.codecs),p=$n(a.codecs);f!=p||a.bandwidth&&h.bandwidth&&!(a.bandwidth>h.bandwidth)||(u.push(a),o.push(a.id))}else u.push(a),o.push(a.id);r.set(l,u)}n=Array.from(t).sort(function(e,t){return e.bandwidth&&t.bandwidth?e.bandwidth-t.bandwidth:e.width-t.width}),t=de();var g=[];for(r=new Map,n=c(n),a=n.next();!a.done;a=n.next()){if(a=a.value,l=Math.round(a.frameRate||0)+(a.hdr||"")+a.fastSwitching,u=r.get(l)||[],u.length){if(h=u[u.length-1],!t&&(f=$n(h.codecs),p=$n(a.codecs),f!==p))continue;a.width>h.width||a.height>h.height?(u.push(a),g.push(a.id)):a.width==h.width&&a.height==h.height&&(f=$n(h.codecs),p=$n(a.codecs),f!=p||a.bandwidth&&h.bandwidth&&!(a.bandwidth>h.bandwidth)||(u.push(a),g.push(a.id)))}else u.push(a),g.push(a.id);r.set(l,u)}e.variants=e.variants.filter(function(e){var t=e.audio;return e=e.video,!(t&&!o.includes(t.id)||e&&!g.includes(e.id))})}function Si(e,t,n){var i={};t=c(t);for(var r=t.next();!r.done;i={Xe:i.Xe},r=t.next())if(i.Xe=r.value,r=e.filter(function(e){return function(t){return t.video&&t.video.codecs.startsWith(e.Xe)}}(i)),r.length){e=r;break}for(i={},n=c(n),t=n.next();!t.done;i={Pe:i.Pe},t=n.next())if(i.Pe=t.value,t=e.filter(function(e){return function(t){return t.audio&&t.audio.codecs.startsWith(e.Pe)}}(i)),t.length){e=t;break}return e}function wi(e,t,n){e.variants=e.variants.filter(function(e){return Ei(e,t,n)})}function Ei(e,t,n){function i(e,t,n){return e>=t&&e<=n}var r=e.video;if(r&&r.width&&r.height){var s=r.width,a=r.height;if(a>s&&(a=c([a,s]),s=a.next().value,a=a.next().value),!i(s,t.minWidth,Math.min(t.maxWidth,n.width))||!i(a,t.minHeight,Math.min(t.maxHeight,n.height))||!i(r.width*r.height,t.minPixels,t.maxPixels))return!1}return!(e&&e.video&&e.video.frameRate&&!i(e.video.frameRate,t.minFrameRate,t.maxFrameRate)||e&&e.audio&&e.audio.channelsCount&&!i(e.audio.channelsCount,t.minChannelsCount,t.maxChannelsCount)||!i(e.bandwidth,t.minBandwidth,t.maxBandwidth))}function xi(e,t,n){var i=!1;e=c(e);for(var r=e.next();!r.done;r=e.next()){r=r.value;var s=r.allowedByApplication;r.allowedByApplication=Ei(r,t,n),s!=r.allowedByApplication&&(i=!0)}return i}function ki(e,t,n){return n=void 0===n?[]:n,N(function(i){return 1==i.g?S(i,Ai(e,t,0<t.offlineSessionIds.length,n),2):(Ni(t),S(i,Ui(t),0))})}function Ai(e,t,n,i){var r,s;return N(function(a){if(1==a.g)return S(a,Mi(t.variants,n,!1,i),2);r=null,e&&(s=e.g)&&(r=s.keySystem),t.variants=t.variants.filter(function(e){var t=Ii(e,r);if(!t){var n=[];e.audio&&n.push(Xi(e.audio)),e.video&&n.push(Xi(e.video))}return t}),w(a)})}function Ii(e,t){var n=Vt(),i=sn("Firefox")&&nn(),r=e.video,s=r&&r.width||0,a=r&&r.height||0;if(n&&r&&(1920<s||1080<a)&&(r.codecs.includes("avc1.")||r.codecs.includes("avc3.")))return!1;if(r){if(n=Oi(r.codecs),r.codecs.includes(",")){if(s=r.codecs.split(","),n=Dn("video",s),n=Oi(n),s=Dn("audio",s),s=Pi(s,r.mimeType),a=jn(r.mimeType,s,"audio"),!ce(a))return!1;n=[n,s].join()}if(s=jn(r.mimeType,n,"video"),!ce(s))return!1;r.codecs=n}if(r=e.audio,i&&r&&r.encrypted&&r.codecs.toLowerCase().includes("opus"))return!1;if(r){if(i=Pi(r.codecs,r.mimeType),n=jn(r.mimeType,i,"audio"),!ce(n))return!1;r.codecs=i}return e.decodingInfos.some(function(e){return!(!e.supported||t&&(e=e.keySystemAccess)&&e.keySystem!=t)})}function Ci(e){var t=[];for(n in e)t.push(n);t.sort();var n=[];t=c(t);for(var i=t.next();!i.done;i=t.next()){var r=i.value;i=JSON.stringify(r),r=e[r],r instanceof Object?(r=Ci(r),n.push(i+":"+r)):(r=JSON.stringify(r),n.push(i+":"+r))}return"{"+n.join(",")+"}"}function Di(e,t){var n,i,r,s,a,o,l;return N(function(u){if(1==u.g){for(n=function(e,t){if(e){var n=bi(e);return n.supported=e.supported&&t.supported,n.powerEfficient=e.powerEfficient&&t.powerEfficient,n.smooth=e.smooth&&t.smooth,t.keySystemAccess&&!n.keySystemAccess&&(n.keySystemAccess=t.keySystemAccess),n}return t},i=null,r=[],s={},a=c(t),o=a.next();!o.done;s={Wc:s.Wc,Xc:s.Xc},o=a.next())l=o.value,s.Xc=Ci(l),s.Wc=Qi,s.Wc[s.Xc]?i=n(i,s.Wc[s.Xc]):r.push(Ri(l).then(function(e){return function(t){var r=null;t=c(t||[]);for(var s=t.next();!s.done;s=t.next())r=n(r,s.value);r&&(e.Wc[e.Xc]=r,i=n(i,r))}}(s)));return S(u,Promise.all(r),2)}i&&e.decodingInfos.push(i),w(u)})}function Ri(e){var t=[""];e.video&&(t=qn(e.video.contentType).split(","));var n=[""];e.audio&&(n=qn(e.audio.contentType).split(","));var i=[];t=c(t);for(var r=t.next();!r.done;r=t.next()){r=r.value;for(var s={},a=c(n),o=a.next();!o.done;s={fc:s.fc},o=a.next())o=o.value,s.fc=yi(e),e.video&&(s.fc.video.contentType=Fn(zn(s.fc.video.contentType),r)),e.audio&&(s.fc.audio.contentType=Fn(zn(s.fc.audio.contentType),o)),i.push(new Promise(function(e){return function(t,n){navigator.mediaCapabilities.decodingInfo(e.fc).then(function(e){t(e)}).catch(n)}}(s)))}return Promise.all(i).catch(function(){return JSON.stringify(e),null})}function Mi(e,t,n,i){var r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_;return N(function(T){switch(T.g){case 1:if(e.some(function(e){return e.decodingInfos.length}))return T.return();r={},s=c(i),a=s.next();case 2:if(a.done){T.u(4);break}r.Se=a.value,o=!1,l=c(e),u=l.next();case 5:if(u.done){T.u(7);break}d=u.value,h=Li(d,t,n).filter(function(e){return function(t){return t=t[0],(t.keySystemConfiguration&&t.keySystemConfiguration.keySystem)===e.Se}}(r)),f=c(h),p=f.next();case 8:if(p.done){T.u(10);break}return g=p.value,S(T,Di(d,g),9);case 9:p=f.next(),T.u(8);break;case 10:d.decodingInfos.length&&(o=!0),u=l.next(),T.u(5);break;case 7:if(o)return T.return();r={Se:r.Se},a=s.next(),T.u(2);break;case 4:m=c(e),u=m.next();case 12:if(u.done){T.u(0);break}v=u.value,y=Li(v,t,n).filter(function(e){return e=e[0],e=e.keySystemConfiguration&&e.keySystemConfiguration.keySystem,!e||!i.includes(e)}),b=c(y),p=b.next();case 15:if(p.done){u=m.next(),T.u(12);break}return _=p.value,S(T,Di(v,_),16);case 16:p=b.next(),T.u(15)}})}function Li(e,t,n){var i=e.audio,r=e.video,s=[],a=[];if(r)for(var o=c(r.fullMimeTypes),l=o.next();!l.done;l=o.next()){l=l.value;var u=qn(l);if(u.includes(",")&&!i){var d=u.split(","),h=zn(l);u=Dn("video",d),d=Dn("audio",d),d=Pi(d,h),h=jn(h,d,"audio"),a.push({contentType:h,channels:2,bitrate:e.bandwidth||1,samplerate:1,spatialRendering:!1})}if(u=Oi(u),l={contentType:jn(zn(l),u,"video"),width:r.width||64,height:r.height||64,bitrate:r.bandwidth||e.bandwidth||1,framerate:r.frameRate||1},r.hdr)switch(r.hdr){case"SDR":l.transferFunction="srgb";break;case"PQ":l.transferFunction="pq";break;case"HLG":l.transferFunction="hlg"}r.colorGamut&&(l.colorGamut=r.colorGamut),s.push(l)}if(i)for(o=c(i.fullMimeTypes),l=o.next();!l.done;l=o.next())u=l.value,l=zn(u),u=Pi(qn(u),l),l=jn(l,u,"audio"),a.push({contentType:l,channels:i.channelsCount||2,bitrate:i.bandwidth||e.bandwidth||1,samplerate:i.audioSamplingRate||1,spatialRendering:i.spatialAudio});for(o=[],0==s.length&&s.push(null),0==a.length&&a.push(null),s=c(s),l=s.next();!l.done;l=s.next())for(l=l.value,u=c(a),h=u.next();!h.done;h=u.next())h=h.value,d={type:n?"file":"media-source"},l&&(d.video=l),h&&(d.audio=h),o.push(d);if(a=(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[]),!a.length)return[o];e=[],n=new Map,a=c(a);for(var f=a.next();!f.done;f=a.next())s=f.value,n.get(s.keySystem)||n.set(s.keySystem,[]),n.get(s.keySystem).push(s);for(a=t?"required":"optional",t=t?["persistent-license"]:["temporary"],s=c(n.keys()),l=s.next();!l.done;l=s.next()){for(l=l.value,u=[],h=c(o),d=h.next();!d.done;d=h.next()){d=Object.assign({},d.value);var p=n.get(l),g={keySystem:l,initDataType:"cenc",persistentState:a,distinctiveIdentifier:"optional",sessionTypes:t};for(p=c(p),f=p.next();!f.done;f=p.next()){if(f=f.value,f.initData&&f.initData.length){for(var m=new Set,v=c(f.initData),y=v.next();!y.done;y=v.next())m.add(y.value.initDataType);g.initDataType=f.initData[0].initDataType}f.distinctiveIdentifierRequired&&(g.distinctiveIdentifier="required"),f.persistentStateRequired&&(g.persistentState="required"),f.sessionType&&(g.sessionTypes=[f.sessionType]),i&&(g.audio?(f.encryptionScheme&&(g.audio.encryptionScheme=g.audio.encryptionScheme||f.encryptionScheme),g.audio.robustness=g.audio.robustness||f.audioRobustness):(g.audio={robustness:f.audioRobustness},f.encryptionScheme&&(g.audio.encryptionScheme=f.encryptionScheme)),""==g.audio.robustness&&delete g.audio.robustness),r&&(g.video?(f.encryptionScheme&&(g.video.encryptionScheme=g.video.encryptionScheme||f.encryptionScheme),g.video.robustness=g.video.robustness||f.videoRobustness):(g.video={robustness:f.videoRobustness},f.encryptionScheme&&(g.video.encryptionScheme=f.encryptionScheme)),""==g.video.robustness&&delete g.video.robustness)}d.keySystemConfiguration=g,u.push(d)}e.push(u)}return e}function Pi(e,t){return"flac"==e.toLowerCase()?en()?"fLaC":"flac":"opus"===e.toLowerCase()?en()&&"mp4"==Hn(t)?"Opus":"opus":e}function Oi(e){if(e.includes("avc1")){var t=e.split(".");if(3==t.length)return e=t.shift()+".",e+=parseInt(t.shift(),10).toString(16),e+("000"+parseInt(t.shift(),10).toString(16)).slice(-4)}else if("vp9"==e)return"vp09.00.41.08";return e}function Ni(e){e.textStreams=e.textStreams.filter(function(e){return e=Fn(e.mimeType,e.codecs),Zn(e)})}function Ui(e){var t,n,i,r,s,a,o;return N(function(l){switch(l.g){case 1:t=[],n=c(e.imageStreams),i=n.next();case 2:if(i.done){l.u(4);break}if(r=i.value,s=r.mimeType,"application/mp4"==s&&"mjpg"==r.codecs&&(s="image/jpg"),Ji.has(s)){l.u(5);break}if(a=er.get(s),!a){Ji.set(s,!1),l.u(5);break}return S(l,Fi(a),7);case 7:o=l.h,Ji.set(s,o);case 5:Ji.get(s)&&t.push(r),i=n.next(),l.u(2);break;case 4:e.imageStreams=t,w(l)}})}function Fi(e){return new Promise(function(t){var n=new Image;n.src=e,"decode"in n?n.decode().then(function(){t(!0)}).catch(function(){t(!1)}):n.onload=n.onerror=function(){t(2===n.height)}})}function Bi(e){var t=e.audio,n=e.video,i=t?t.mimeType:null,r=n?n.mimeType:null,s=t?t.codecs:null,a=n?n.codecs:null,o=[];a&&o.push(a),s&&o.push(s);var l=[];n&&l.push(n.mimeType),t&&l.push(t.mimeType),l=l[0]||null;var u=[];t&&u.push(t.kind),n&&u.push(n.kind),u=u[0]||null;var d=new Set;if(t)for(var h=c(t.roles),f=h.next();!f.done;f=h.next())d.add(f.value);if(n)for(h=c(n.roles),f=h.next();!f.done;f=h.next())d.add(f.value);return e={id:e.id,active:!1,type:"variant",bandwidth:e.bandwidth,language:e.language,label:null,kind:u,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,colorGamut:null,videoLayout:null,mimeType:l,audioMimeType:i,videoMimeType:r,codecs:o.join(", "),audioCodec:s,videoCodec:a,primary:e.primary,roles:Array.from(d),audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null,accessibilityPurpose:null,originalLanguage:null},n&&(e.videoId=n.id,e.originalVideoId=n.originalId,e.width=n.width||null,e.height=n.height||null,e.frameRate=n.frameRate||null,e.pixelAspectRatio=n.pixelAspectRatio||null,e.videoBandwidth=n.bandwidth||null,e.hdr=n.hdr||null,e.colorGamut=n.colorGamut||null,e.videoLayout=n.videoLayout||null),t&&(e.audioId=t.id,e.originalAudioId=t.originalId,e.channelsCount=t.channelsCount,e.audioSamplingRate=t.audioSamplingRate,e.audioBandwidth=t.bandwidth||null,e.spatialAudio=t.spatialAudio,e.label=t.label,e.audioRoles=t.roles,e.accessibilityPurpose=t.accessibilityPurpose,e.originalLanguage=t.originalLanguage),e}function ji(e){return{id:e.id,active:!1,type:Ln,bandwidth:0,language:e.language,label:e.label,kind:e.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,colorGamut:null,videoLayout:null,mimeType:e.mimeType,audioMimeType:null,videoMimeType:null,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:e.primary,roles:e.roles,audioRoles:null,forced:e.forced,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:e.originalId,originalImageId:null,accessibilityPurpose:e.accessibilityPurpose,originalLanguage:e.originalLanguage}}function Vi(e){var t=e.width||null,n=e.height||null,i=null;e.segmentIndex&&(i=e.segmentIndex.get(0));var r=e.tilesLayout;return i&&(r=i.tilesLayout||r),r&&null!=t&&(t/=Number(r.split("x")[0])),r&&null!=n&&(n/=Number(r.split("x")[1])),{id:e.id,active:!1,type:"image",bandwidth:e.bandwidth||0,language:"",label:null,kind:null,width:t,height:n,frameRate:null,pixelAspectRatio:null,hdr:null,colorGamut:null,videoLayout:null,mimeType:e.mimeType,audioMimeType:null,videoMimeType:null,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:r||null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:e.originalId,accessibilityPurpose:null,originalLanguage:null}}function Hi(e){return e.__shaka_id||(e.__shaka_id=Zi++),e.__shaka_id}function $i(e){var t=zi(e);return t.active="disabled"!=e.mode,t.type="text",t.originalTextId=e.id,"captions"==e.kind&&(t.mimeType="unknown"),"subtitles"==e.kind&&(t.mimeType="text/vtt"),e.kind&&(t.roles=[e.kind]),"forced"==e.kind&&(t.forced=!0),t}function Gi(e){var t=zi(e);return t.active=e.enabled,t.type="variant",t.originalAudioId=e.id,"main"==e.kind&&(t.primary=!0),e.kind&&(t.roles=[e.kind],t.audioRoles=[e.kind],t.label=e.label),t}function zi(e){var t=e.language;return{id:Hi(e),active:!1,type:"",bandwidth:0,language:hi(t||"und"),label:e.label,kind:e.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,colorGamut:null,videoLayout:null,mimeType:null,audioMimeType:null,videoMimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],forced:!1,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null,accessibilityPurpose:null,originalLanguage:t}}function qi(e){return e.allowedByApplication&&e.allowedByKeySystem&&0==e.disabledUntilTime}function Wi(e){return e.filter(function(e){return qi(e)})}function Ki(e,t,n,i){var r=e,s=e.filter(function(e){return e.primary});s.length&&(r=s);var a=r.length?r[0].language:"";if(r=r.filter(function(e){return e.language==a}),t){var o=mi(hi(t),e.map(function(e){return e.language}));o&&(r=e.filter(function(e){return hi(e.language)==o}))}if(r=r.filter(function(e){return e.forced==i}),n){if(e=Yi(r,n),e.length)return e}else if(e=r.filter(function(e){return 0==e.roles.length}),e.length)return e;return e=r.map(function(e){return e.roles}).reduce(si,[]),e.length?Yi(r,e[0]):r}function Yi(e,t){return e.filter(function(e){return e.roles.includes(t)})}function Xi(e){return"audio"==e.type?"type=audio codecs="+e.codecs+" bandwidth="+e.bandwidth+" channelsCount="+e.channelsCount+" audioSamplingRate="+e.audioSamplingRate:"video"==e.type?"type=video codecs="+e.codecs+" bandwidth="+e.bandwidth+" frameRate="+e.frameRate+" width="+e.width+" height="+e.height:"unexpected stream type"}G("shaka.util.StreamUtils",_i),_i.meetsRestrictions=Ei;var Qi={},Zi=0,Ji=(new Map).set("image/svg+xml",!0).set("image/png",!0).set("image/jpeg",!0).set("image/jpg",!0),er=(new Map).set("image/webp","data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA").set("image/avif","data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=");function tr(){var e=this;this.A=null,this.s=!1,this.i=new Y,this.F=new se,navigator.connection&&navigator.connection.addEventListener&&this.F.D(navigator.connection,"change",function(){if(e.s&&e.g.useNetworkInformation){e.i=new Y,e.g&&e.i.configure(e.g.advanced);var t=e.chooseVariant();t&&navigator.onLine&&e.A(t,e.g.clearBufferSwitch,e.g.safeMarginSwitch)}}),this.o=[],this.B=1,this.G=!1,this.h=this.m=this.g=this.j=null,this.C=new Ut(function(){if(e.g.restrictToElementSize){var t=e.chooseVariant();t&&e.A(t,e.g.clearBufferSwitch,e.g.safeMarginSwitch)}}),this.l=null}function nr(e){if(!e.G){var t=e.i;if(!(t.g>=t.i))return;e.G=!0,e.j-=1e3*(e.g.switchInterval-e.g.minTimeToSwitch)}Date.now()-e.j<1e3*e.g.switchInterval||(t=e.chooseVariant(),e.getBandwidthEstimate(),t&&e.A(t,e.g.clearBufferSwitch,e.g.safeMarginSwitch))}function ir(e,t,n,i,r){if(e.l){var s=e.l.Ng();s&&(n=n.filter(function(e){return!e.bandwidth||!s||e.bandwidth<=s}))}return t&&(n=n.filter(function(e){return Ei(e,t,{width:r,height:i})})),n.sort(function(e,t){return e.bandwidth-t.bandwidth})}function rr(e){var t=[];e=c(e);for(var n=e.next();!n.done;n=e.next())(n=n.value.video)&&n.height&&n.width&&t.push({height:n.height,width:n.width});return t.sort(function(e,t){return e.width-t.width})}i=tr.prototype,i.stop=function(){this.A=null,this.s=!1,this.o=[],this.B=1,this.m=this.j=null,this.h&&(this.h.disconnect(),this.h=null),this.C.stop(),this.l=null},i.release=function(){this.F.release(),this.C=null},i.init=function(e){this.A=e},i.chooseVariant=function(t){t=void 0!==t&&t;var n=1/0,i=1/0;if(this.g.restrictToScreenSize&&(i=this.g.ignoreDevicePixelRatio?1:e.devicePixelRatio,n=e.screen.height*i,i*=e.screen.width),this.h&&this.g.restrictToElementSize){var r=this.g.ignoreDevicePixelRatio?1:e.devicePixelRatio;n=Math.min(n,this.m.clientHeight*r),i=Math.min(i,this.m.clientWidth*r)}var s=this.o.filter(function(e){return e&&!(e.audio&&e.audio.fastSwitching||e.video&&e.video.fastSwitching)});if(s.length||(s=this.o),r=s,t&&s.length!=this.o.length&&(r=this.o.filter(function(e){return e&&!!(e.audio&&e.audio.fastSwitching||e.video&&e.video.fastSwitching)})),t=ir(this,this.g.restrictions,r,1/0,1/0),1/0!=n||1/0!=i){for(t=rr(t),t=c(t),s=t.next();!s.done;s=t.next())if(s=s.value,s.height>=n&&s.width>=i){n=s.height,i=s.width;break}t=ir(this,this.g.restrictions,r,n,i)}for(n=this.getBandwidthEstimate(),r.length&&!t.length&&(t=ir(this,null,r,1/0,1/0),t=[t[0]]),i=t[0]||null,r=0;r<t.length;r++){s=t[r];for(var a=isNaN(this.B)?1:Math.abs(this.B),o=a*s.bandwidth/this.g.bandwidthDowngradeTarget,l={bandwidth:1/0},u=r+1;u<t.length;u++)if(s.bandwidth!=t[u].bandwidth){l=t[u];break}a=a*l.bandwidth/this.g.bandwidthUpgradeTarget,n>=o&&n<=a&&(i.bandwidth!=s.bandwidth||i.bandwidth==s.bandwidth&&i.video&&s.video&&(i.video.width<s.video.width||i.video.height<s.video.height))&&(i=s)}return this.j=Date.now(),i},i.enable=function(){this.s=!0},i.disable=function(){this.s=!1},i.segmentDownloaded=function(e,t,n){e<this.g.cacheLoadThreshold||(this.i.sample(e,t),n&&null!=this.j&&this.s&&nr(this))},i.trySuggestStreams=function(){null!=this.j&&this.s&&nr(this)},i.getBandwidthEstimate=function(){var e=this.g.defaultBandwidthEstimate;return navigator.connection&&navigator.connection.downlink&&this.g.useNetworkInformation&&(e=1e6*navigator.connection.downlink),e=this.i.getBandwidthEstimate(e),this.l?this.l.getBandwidthEstimate(e):e},i.setVariants=function(e){this.o=e},i.playbackRateChanged=function(e){this.B=e},i.setMediaElement=function(t){var n=this;this.m=t,this.h&&(this.h.disconnect(),this.h=null),this.m&&"ResizeObserver"in e&&(this.h=new ResizeObserver(function(){n.C.Y(sr)}),this.h.observe(this.m))},i.setCmsdManager=function(e){this.l=e},i.configure=function(e){this.g=e,this.i&&this.g&&this.i.configure(this.g.advanced)},G("shaka.abr.SimpleAbrManager",tr),tr.prototype.configure=tr.prototype.configure,tr.prototype.setCmsdManager=tr.prototype.setCmsdManager,tr.prototype.setMediaElement=tr.prototype.setMediaElement,tr.prototype.playbackRateChanged=tr.prototype.playbackRateChanged,tr.prototype.setVariants=tr.prototype.setVariants,tr.prototype.getBandwidthEstimate=tr.prototype.getBandwidthEstimate,tr.prototype.trySuggestStreams=tr.prototype.trySuggestStreams,tr.prototype.segmentDownloaded=tr.prototype.segmentDownloaded,tr.prototype.disable=tr.prototype.disable,tr.prototype.enable=tr.prototype.enable,tr.prototype.chooseVariant=tr.prototype.chooseVariant,tr.prototype.init=tr.prototype.init,tr.prototype.release=tr.prototype.release,tr.prototype.stop=tr.prototype.stop;var sr=1;function ar(e,t,n,i){for(n=void 0===n||n,i=void 0!==i&&i,this.h=e,this.g=new Set([e]),t=t||[],e=c(t),t=e.next();!t.done;t=e.next())this.add(t.value,n,i)}function or(e,t,n,i){var r;if(!(r=!!e.audio!=!!t.audio||!!e.video!=!!t.video||e.language!=t.language)&&(r=e.audio&&t.audio)){r=e.audio;var s=t.audio;r=!!((!r.channelsCount||!s.channelsCount||2<r.channelsCount||2<s.channelsCount)&&r.channelsCount!=s.channelsCount||r.spatialAudio!==s.spatialAudio||n&&!lr(r,s)||!ur(r.roles,s.roles)||i&&r.groupId!==s.groupId)}return!(i=r)&&(i=e.video&&t.video)&&(e=e.video,t=t.video,i=!((!n||lr(e,t))&&ur(e.roles,t.roles))),!i}function lr(e,t){if(e.mimeType!=t.mimeType)return!1;if(e=e.codecs.split(",").map(function(e){return Gn(e)}),t=t.codecs.split(",").map(function(e){return Gn(e)}),e.length!=t.length)return!1;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function ur(e,t){if(e=new Set(e),t=new Set(t),e.delete("main"),t.delete("main"),e.size!=t.size)return!1;e=c(e);for(var n=e.next();!n.done;n=e.next())if(!t.has(n.value))return!1;return!0}function cr(e,t,n){t=void 0===t?"reload":t,n=void 0!==n&&n,this.i=e,this.h=t,this.g=n,this.j=new dr(e.language,"",e.audio&&e.audio.channelsCount?e.audio.channelsCount:0,"",!1,"","","",t,n)}function dr(e,t,n,i,r,s,a,o,l,u,c){this.A=e,this.B=t,this.i=n,this.j=i,this.C=r,this.m=s,this.h=void 0===a?"":a,this.l=void 0===o?"":o,this.o=void 0===l?"reload":l,this.s=void 0!==u&&u,this.g=void 0===c?"":c}function hr(e,t){t=hi(t);var n=mi(t,e.map(function(e){return gi(e)}));return n?e.filter(function(e){return n==gi(e)}):[]}function fr(e,t){return e.filter(function(e){return!!e.audio&&(t?e.audio.roles.includes(t):0==e.audio.roles.length)})}function pr(e,t){return e.filter(function(e){return!(!e.audio||!e.audio.label)&&e.audio.label.toLowerCase()==t.toLowerCase()})}function gr(e,t){return e.filter(function(e){return!(!e.video||!e.video.label)&&e.video.label.toLowerCase()==t.toLowerCase()})}function mr(e,t){return e.filter(function(e){return!e.audio||!e.audio.channelsCount||e.audio.channelsCount==t})}function vr(t,n){return"AUTO"==n&&(n=e.matchMedia("(color-gamut: p3)").matches?"PQ":"SDR"),t.filter(function(e){return!e.video||!e.video.hdr||e.video.hdr==n})}function yr(e,t){return e.filter(function(e){return!e.video||!e.video.videoLayout||e.video.videoLayout==t})}function br(e,t){return e.filter(function(e){return!e.audio||e.audio.spatialAudio==t})}function _r(e,t){return e.filter(function(e){return!e.audio||e.audio.codecs==t})}function Tr(){this.g=Er,this.i=(new Map).set(Er,2).set(wr,1),this.h=0}function Sr(e,t,n){e.i.set(Er,n).set(wr,t)}G("shaka.config.AutoShowText",{NEVER:0,ALWAYS:1,IF_PREFERRED_TEXT_LANGUAGE:2,IF_SUBTITLES_MAY_BE_NEEDED:3}),G("shaka.config.CodecSwitchingStrategy",{Qj:"reload",yh:"smooth"}),ar.prototype.add=function(e,t,n){return!!or(this.h,e,void 0===t||t,void 0!==n&&n)&&(this.g.add(e),!0)},ar.prototype.values=function(){return this.g.values()},cr.prototype.create=function(e){var t=this,n="smooth"==this.h&&de(),i=e.filter(function(e){return or(t.i,e,!n,t.g)});return i.length?new ar(i[0],i,!n,this.g):this.j.create(e)},dr.prototype.create=function(e){var t=[];t=hr(e,this.A);var n=e.filter(function(e){return e.primary});return t=t.length?t:n.length?n:e,e=fr(t,this.B),e.length&&(t=e),this.m&&(e=yr(t,this.m),e.length&&(t=e)),this.j&&(e=vr(t,this.j),e.length&&(t=e)),this.i&&(e=mr(t,this.i),e.length&&(t=e)),this.h&&(e=pr(t,this.h),e.length&&(t=e)),this.l&&(e=gr(t,this.l),e.length&&(t=e)),e=br(t,this.C),e.length&&(t=e),this.g&&(e=_r(t,this.g),e.length&&(t=e)),new ar(t[0],t,!("smooth"==this.o&&de()),this.s)};var wr=0,Er=1;function xr(e,t){var n=Ar();this.l=null==e.maxAttempts?n.maxAttempts:e.maxAttempts,this.j=null==e.baseDelay?n.baseDelay:e.baseDelay,this.o=null==e.fuzzFactor?n.fuzzFactor:e.fuzzFactor,this.m=null==e.backoffFactor?n.backoffFactor:e.backoffFactor,this.g=0,this.h=this.j,(this.i=void 0!==t&&t)&&(this.g=1)}function kr(e){var t,n;return N(function(i){if(1==i.g){if(e.g>=e.l){if(!e.i)throw new It(2,7,1010);e.g=1,e.h=e.j}return t=e.g,e.g++,0==t?i.return():(n=e.h*(1+(2*Math.random()-1)*e.o),S(i,new Promise(function(e){new Ut(e).Y(n/1e3)}),2))}e.h*=e.m,w(i)})}function Ar(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4}}function Ir(){var e,t,n=new Promise(function(n,i){e=n,t=i});return n.resolve=e,n.reject=t,n}function Cr(e,t){this.promise=e,this.i=t,this.g=!1}function Dr(e){return new Cr(Promise.reject(e),function(){return Promise.resolve()})}function Rr(){var e=Promise.reject(new It(2,7,7001));return e.catch(function(){}),new Cr(e,function(){return Promise.resolve()})}function Mr(e){return new Cr(Promise.resolve(e),function(){return Promise.resolve()})}function Lr(e){return new Cr(e,function(){return e.catch(function(){})})}function Pr(e){return new Cr(Promise.all(e.map(function(e){return e.promise})),function(){return Promise.all(e.map(function(e){return e.abort()}))})}function Or(e,t,n){try{var i=e(t);return i&&i.promise&&i.abort?(n.resolve(i.promise),function(){return i.abort()}):(n.resolve(i),function(){return Promise.resolve(i).then(function(){},function(){})})}catch(e){return n.reject(e),function(){return Promise.resolve()}}}function Nr(t,n){if(n)if(n instanceof Map)for(var i=c(n.keys()),r=i.next();!r.done;r=i.next())r=r.value,Object.defineProperty(this,r,{value:n.get(r),writable:!0,enumerable:!0});else for(i in n)Object.defineProperty(this,i,{value:n[i],writable:!0,enumerable:!0});this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=e.performance&&e.performance.now?e.performance.now():Date.now(),this.type=t,this.isTrusted=!1,this.target=this.currentTarget=null,this.g=!1}function Ur(e){var t,n=new Nr(e.type);for(t in e)Object.defineProperty(n,t,{value:e[t],writable:!0,enumerable:!0});return n}Ir.prototype.resolve=function(){},Ir.prototype.reject=function(){},Cr.prototype.abort=function(){return this.g=!0,this.i()},Cr.prototype.finally=function(e){return this.promise.then(function(){return e(!0)},function(){return e(!1)}),this},Cr.prototype.Aa=function(e,t){function n(n){return function(o){if(r.g&&n)s.reject(a);else{var l=n?e:t;l?i=Or(l,o,s):(n?s.resolve:s.reject)(o)}}}function i(){return s.reject(a),r.abort()}var r=this,s=new Ir,a=new It(2,7,7001);return this.promise.then(n(!0),n(!1)),new Cr(s,function(){return i()})},G("shaka.util.AbortableOperation",Cr),Cr.prototype.chain=Cr.prototype.Aa,Cr.prototype["finally"]=Cr.prototype.finally,Cr.all=Pr,Cr.prototype.abort=Cr.prototype.abort,Cr.notAbortable=Lr,Cr.completed=Mr,Cr.aborted=Rr,Cr.failed=Dr,Nr.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},Nr.prototype.stopImmediatePropagation=function(){this.g=!0},Nr.prototype.stopPropagation=function(){},G("shaka.util.FakeEvent",Nr);var Fr={pj:"abrstatuschanged",qj:"adaptation",rj:"audiotrackchanged",sj:"buffering",tj:"complete",uj:"downloadfailed",vj:"downloadheadersreceived",wj:"drmsessionupdate",yj:"emsg",Pj:"prft",Error:"error",zj:"expirationupdated",Aj:"firstquartile",Bj:"gapjumped",Ej:"keystatuschanged",Gj:"loaded",Hj:"loading",Jj:"manifestparsed",Kj:"manifestupdated",Lj:"mediaqualitychanged",Metadata:"metadata",Mj:"midpoint",Nj:"nospatialvideoinfo",Oj:"onstatechange",Rj:"ratechange",Sj:"segmentappended",Tj:"sessiondata",Uj:"spatialvideoinfo",Vj:"stalldetected",Wj:"started",Xj:"statechanged",Yj:"streaming",Zj:"textchanged",$j:"texttrackvisibility",ak:"thirdquartile",bk:"timelineregionadded",ck:"timelineregionenter",dk:"timelineregionexit",ek:"trackschanged",gk:"unloading",ik:"variantchanged"};function Br(){this.ya=new re,this.Ge=this}function jr(){this.g=[]}function Vr(e,t){e.g.push(t.finally(function(){Ne(e.g,t)}))}function Hr(e,t,n,i,r,s){Br.call(this),this.i=!1,this.m=new jr,this.g=new Set,this.h=new Set,this.l=e||null,this.j=t||null,this.A=n||null,this.B=i||null,this.F=r||null,this.C=s||null,this.o=this.s=!1}function $r(e,t,n,i){n=n||Jr;var r=es[e];(!r||n>=r.priority)&&(es[e]={priority:n,De:t,Ki:void 0!==i&&i})}function Gr(e,t){for(var n=c(e.g),i=n.next();!i.done;i=n.next())t.g.add(i.value);for(e=c(e.h),i=e.next();!i.done;i=e.next())t.h.add(i.value)}function zr(e,t,n){return{uris:e,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:t,licenseRequestType:null,sessionId:null,drmInfo:null,initData:null,initDataType:null,streamDataCallback:void 0===n?null:n}}function qr(e,t,n,i){function r(e){s=s.Aa(function(){return n.body&&(n.body=we(n.body)),e(t,n,i)})}var s=Mr(void 0);e.B&&r(e.B),e=c(e.g);for(var a=e.next();!a.done;a=e.next())r(a.value);return s.Aa(void 0,function(e){if(e instanceof It&&7001==e.code)throw e;throw new It(2,1,1006,e)})}function Wr(e,t,n,i,r,s,a,o){e.s&&(n.uris[s]=n.uris[s].replace("https://","http://")),e.o&&(n.uris[s]=n.uris[s].replace("http://","https://")),0<s&&e.F&&e.F(t,i,n.uris[s],n.uris[s-1]);var l=new ht(n.uris[s]),u=l.Db,c=!1;u||(u=location.protocol,u=u.slice(0,-1),ft(l,u),n.uris[s]=l.toString()),u=u.toLowerCase();var d=(u=es[u])?u.De:null;if(!d)return Dr(new It(2,1,1e3,l));var h,f=u.Ki,p=null,g=null,m=!1,v=!1;return Lr(kr(r)).Aa(function(){if(e.i)return Rr();h=Date.now();var r=0;n.requestStartTime=Date.now();var a=d(n.uris[s],n,t,function(s,a,l){p&&p.stop(),g&&g.Y(u/1e3),e.l&&t==Zr&&(r++,n.packetNumber=r,e.l(s,a,Yr(i),n),c=!0,o.g=l)},function(i){e.j&&e.j(i,n,t),v=!0,n.timeToFirstByte=Date.now()-n.requestStartTime});if(!f)return a;var l=n.retryParameters.connectionTimeout;l&&(p=new Ut(function(){m=!0,a.abort()}),p.Y(l/1e3));var u=n.retryParameters.stallTimeout;return u&&(g=new Ut(function(){m=!0,a.abort()})),a}).Aa(function(i){p&&p.stop(),g&&g.stop(),void 0==i.timeMs&&(i.timeMs=Date.now()-h);var r={response:i,pi:c};return!v&&e.j&&e.j(i.headers,n,t),r},function(l){if(p&&p.stop(),g&&g.stop(),e.A){var u=null,c=0;l instanceof It&&(u=l,1001==l.code&&(c=l.data[1])),e.A(n,u,c,m)}if(e.i)return Rr();if(m&&(l=new It(1,1,1003,n.uris[s],t)),l instanceof It){if(7001==l.code)throw l;if(1010==l.code)throw a;if(1==l.severity)return u=(new Map).set("error",l),u=new Nr("retry",u),e.dispatchEvent(u),s=(s+1)%n.uris.length,Wr(e,t,n,i,r,s,l,o)}throw l})}function Kr(e,t,n,i){var r=Mr(void 0),s={};e=c(e.h);for(var a=e.next();!a.done;s={Ue:s.Ue},a=e.next())s.Ue=a.value,r=r.Aa(function(e){return function(){var r=n.response;return r.data&&(r.data=we(r.data)),e.Ue(t,r,i)}}(s));return r.Aa(function(){return n},function(e){var t=2;if(e instanceof It){if(7001==e.code)throw e;t=e.severity}throw new It(t,1,1007,e)})}function Yr(e){if(e){var t=e.segment;if(e=e.stream,t&&e&&e.fastSwitching&&t.Kd)return!1}return!0}function Xr(){this.g=0}function Qr(e,t,n){Cr.call(this,e,t),this.h=n}Br.prototype.addEventListener=function(e,t){this.ya&&this.ya.push(e,t)},Br.prototype.removeEventListener=function(e,t){this.ya&&this.ya.remove(e,t)},Br.prototype.dispatchEvent=function(e){if(!this.ya)return!0;var t=this.ya.get(e.type)||[],n=this.ya.get("All");for(n&&(t=t.concat(n)),t=c(t),n=t.next();!n.done;n=t.next()){n=n.value,e.target=this.Ge,e.currentTarget=this.Ge;try{n.handleEvent?n.handleEvent(e):n.call(this,e)}catch(e){}if(e.g)break}return e.defaultPrevented},Br.prototype.release=function(){this.ya=null},jr.prototype.destroy=function(){for(var e=[],t=c(this.g),n=t.next();!n.done;n=t.next())n=n.value,n.promise.catch(function(){}),e.push(n.abort());return this.g=[],Promise.all(e)},y(Hr,Br),i=Hr.prototype,i.fg=function(e){this.s=e},i.gg=function(e){this.o=e},i.Ni=function(e){this.g.add(e)},i.ij=function(e){this.g.delete(e)},i.Ag=function(){this.g.clear()},i.Oi=function(e){this.h.add(e)},i.jj=function(e){this.h.delete(e)},i.Bg=function(){this.h.clear()},i.destroy=function(){return this.i=!0,this.g.clear(),this.h.clear(),Br.prototype.release.call(this),this.m.destroy()},i.request=function(e,t,n){var i=this,r=new Xr;if(this.i){var s=Promise.reject(new It(2,7,7001));return s.catch(function(){}),new Qr(s,function(){return Promise.resolve()},r)}t.method=t.method||"GET",t.headers=t.headers||{},t.retryParameters=t.retryParameters?yi(t.retryParameters):Ar(),t.uris=yi(t.uris),s=qr(this,e,t,n);var a=s.Aa(function(){return Wr(i,e,t,n,new xr(t.retryParameters,!1),0,null,r)}),o=a.Aa(function(t){return Kr(i,e,t,n)}),l=Date.now(),u=0;s.promise.then(function(){u=Date.now()-l},function(){});var c=0;a.promise.then(function(){c=Date.now()},function(){});var d=o.Aa(function(r){var s=Date.now()-c,a=r.response;return a.timeMs+=u,a.timeMs+=s,r.pi||!i.l||a.fromCache||"HEAD"==t.method||e!=Zr||i.l(a.timeMs,a.data.byteLength,Yr(n)),i.C&&i.C(e,a,n),a},function(e){throw e&&(e.severity=2),e});return s=new Qr(d.promise,function(){return d.abort()},r),Vr(this.m,s),s},G("shaka.net.NetworkingEngine",Hr),Hr.prototype.request=Hr.prototype.request,Hr.prototype.destroy=Hr.prototype.destroy,Hr.makeRequest=zr,Hr.defaultRetryParameters=function(){return Ar()},Hr.prototype.clearAllResponseFilters=Hr.prototype.Bg,Hr.prototype.unregisterResponseFilter=Hr.prototype.jj,Hr.prototype.registerResponseFilter=Hr.prototype.Oi,Hr.prototype.clearAllRequestFilters=Hr.prototype.Ag,Hr.prototype.unregisterRequestFilter=Hr.prototype.ij,Hr.prototype.registerRequestFilter=Hr.prototype.Ni,Hr.unregisterScheme=function(e){delete es[e]},Hr.registerScheme=$r,Hr.prototype.setForceHTTPS=Hr.prototype.gg,Hr.prototype.setForceHTTP=Hr.prototype.fg,Hr.NumBytesRemainingClass=Xr,y(Qr,Cr),Hr.PendingRequest=Qr;var Zr=1;Hr.RequestType={MANIFEST:0,SEGMENT:Zr,LICENSE:2,APP:3,TIMING:4,SERVER_CERTIFICATE:5,KEY:6,ADS:7,CONTENT_STEERING:8},Hr.AdvancedRequestType={INIT_SEGMENT:0,MEDIA_SEGMENT:1,MEDIA_PLAYLIST:2,MASTER_PLAYLIST:3,MPD:4,MSS:5,MPD_PATCH:6};var Jr=3;Hr.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:Jr};var es={};function ts(e){this.g=!1,this.h=new Ir,this.i=e}function ns(e,t){if(e.g){if(t instanceof It&&7003==t.code)throw t;throw new It(2,7,7003,t)}}function is(e,t){var n=[];e=c(e);for(var i=e.next();!i.done;i=e.next())n.push(t(i.value));return n}function rs(e,t){e=c(e);for(var n=e.next();!n.done;n=e.next())if(!t(n.value))return!1;return!0}function ss(e){for(var t=new Map,n=c(Object.keys(e)),i=n.next();!i.done;i=n.next())i=i.value,t.set(i,e[i]);return t}function as(e){var t={};return e.forEach(function(e,n){t[n]=e}),t}function os(e,t){this.h=ke(e),this.i=t==us,this.g=0}function ls(){return new It(2,3,3e3)}ts.prototype.destroy=function(){var e=this;return this.g?this.h:(this.g=!0,this.i().then(function(){e.h.resolve()},function(){e.h.resolve()}))},i=os.prototype,i.oa=function(){return this.g<this.h.byteLength},i.ua=function(){return this.g},i.getLength=function(){return this.h.byteLength},i.T=function(){try{var e=this.h.getUint8(this.g);return this.g+=1,e}catch(e){throw ls()}},i.ka=function(){try{var e=this.h.getUint16(this.g,this.i);return this.g+=2,e}catch(e){throw ls()}},i.P=function(){try{var e=this.h.getUint32(this.g,this.i);return this.g+=4,e}catch(e){throw ls()}},i.bh=function(){try{var e=this.h.getInt32(this.g,this.i);return this.g+=4,e}catch(e){throw ls()}},i.Qc=function(){try{if(this.i)var e=this.h.getUint32(this.g,!0),t=this.h.getUint32(this.g+4,!0);else t=this.h.getUint32(this.g,!1),e=this.h.getUint32(this.g+4,!1)}catch(e){throw ls()}if(2097151<t)throw new It(2,3,3001);return this.g+=8,t*Math.pow(2,32)+e},i.rb=function(e){if(this.g+e>this.h.byteLength)throw ls();var t=Ee(this.h,this.g,e);return this.g+=e,t},i.skip=function(e){if(this.g+e>this.h.byteLength)throw ls();this.g+=e},i.Vi=function(e){if(this.g<e)throw ls();this.g-=e},i.seek=function(e){if(0>e||e>this.h.byteLength)throw ls();this.g=e},i.tc=function(){for(var e=this.g;this.oa()&&0!=this.h.getUint8(this.g);)this.g+=1;return e=Ee(this.h,e,this.g-e),this.g+=1,hn(e)},G("shaka.util.DataViewReader",os),os.prototype.readTerminatedString=os.prototype.tc,os.prototype.seek=os.prototype.seek,os.prototype.rewind=os.prototype.Vi,os.prototype.skip=os.prototype.skip,os.prototype.readBytes=os.prototype.rb,os.prototype.readUint64=os.prototype.Qc,os.prototype.readInt32=os.prototype.bh,os.prototype.readUint32=os.prototype.P,os.prototype.readUint16=os.prototype.ka,os.prototype.readUint8=os.prototype.T,os.prototype.getLength=os.prototype.getLength,os.prototype.getPosition=os.prototype.ua,os.prototype.hasMoreData=os.prototype.oa;var us=1;function cs(){this.i=[],this.h=[],this.g=!1}function ds(e){for(var t=ys(e);e.reader.oa()&&!e.parser.g;)e.parser.Oc(e.start+t,e.reader,e.partialOkay)}function hs(e){for(var t=ys(e),n=e.reader.P(),i=0;i<n&&(e.parser.Oc(e.start+t,e.reader,e.partialOkay),!e.parser.g);i++);}function fs(e){var t=ys(e);for(e.reader.skip(78);e.reader.oa()&&!e.parser.g;)e.parser.Oc(e.start+t,e.reader,e.partialOkay)}function ps(e){var t=ys(e);e.reader.skip(8);var n=e.reader.ka();for(e.reader.skip(6),2==n?e.reader.skip(48):e.reader.skip(12),1==n&&e.reader.skip(16);e.reader.oa()&&!e.parser.g;)e.parser.Oc(e.start+t,e.reader,e.partialOkay)}function gs(e){return function(t){e(t.reader.rb(t.reader.getLength()-t.reader.ua()))}}function ms(e){var t=0;e=c(e);for(var n=e.next();!n.done;n=e.next())t=t<<8|n.value.charCodeAt(0);return t}function vs(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}function ys(e){return 8+(e.has64BitSize?8:0)+(null!=e.flags?4:0)}os.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:us},i=cs.prototype,i.box=function(e,t){return e=ms(e),this.i[e]=bs,this.h[e]=t,this},i.S=function(e,t){return e=ms(e),this.i[e]=_s,this.h[e]=t,this},i.stop=function(){this.g=!0},i.parse=function(e,t,n){for(e=new os(e,0),this.g=!1;e.oa()&&!this.g;)this.Oc(0,e,t,n)},i.Oc=function(e,t,n,i){var r=t.ua();if(i&&r+8>t.getLength())this.g=!0;else{var s=t.P(),a=t.P(),o=vs(a),l=!1;switch(s){case 0:s=t.getLength()-r;break;case 1:if(i&&t.ua()+8>t.getLength())return void(this.g=!0);s=t.Qc(),l=!0}var u=this.h[a];if(u){var c=null,d=null;if(this.i[a]==_s){if(i&&t.ua()+4>t.getLength())return void(this.g=!0);d=t.P(),c=d>>>24,d&=16777215}a=r+s,n&&a>t.getLength()&&(a=t.getLength()),i&&a>t.getLength()?this.g=!0:(i=a-t.ua(),t=0<i?t.rb(i):new Uint8Array(0),t=new os(t,0),u({name:o,parser:this,partialOkay:n||!1,version:c,flags:d,reader:t,size:s,start:r+e,has64BitSize:l}))}else t.skip(Math.min(r+s-t.ua(),t.getLength()-t.ua()))}},G("shaka.util.Mp4Parser",cs),cs.headerSize=ys,cs.typeToString=vs,cs.allData=gs,cs.audioSampleEntry=ps,cs.visualSampleEntry=fs,cs.sampleDescription=hs,cs.children=ds,cs.prototype.parseNext=cs.prototype.Oc,cs.prototype.parse=cs.prototype.parse,cs.prototype.stop=cs.prototype.stop,cs.prototype.fullBox=cs.prototype.S,cs.prototype.box=cs.prototype.box;var bs=0,_s=1;function Ts(e){var t=this;this.g=[],this.h=[],this.data=[],(new cs).box("moov",ds).box("moof",ds).S("pssh",function(e){if(!(1<e.version)){var n=Ee(e.reader.h,-12,e.size);if(t.data.push(n),t.g.push(xn(e.reader.rb(16))),0<e.version){n=e.reader.P();for(var i=0;i<n;i++){var r=xn(e.reader.rb(16));t.h.push(r)}}}}).parse(e)}function Ss(e,t,n,i){var r=e.length,s=t.length+16+r;0<i&&(s+=4+16*n.size);var a=new Uint8Array(s),o=ke(a),l=0;if(o.setUint32(l,s),l+=4,o.setUint32(l,1886614376),l+=4,1>i?o.setUint32(l,0):o.setUint32(l,16777216),l+=4,a.set(t,l),l+=t.length,0<i)for(o.setUint32(l,n.size),l+=4,t=c(n),n=t.next();!n.done;n=t.next())n=En(n.value),a.set(n,l),l+=n.length;return o.setUint32(l,r),a.set(e,l+4),a}
/*
 @license
 tXml
 Copyright 2015 Tobias Nickel
 SPDX-License-Identifier: MIT
*/
function ws(e,t){return e=pn(e),Es(e,t)}function Es(e,t){return e=ks(e),!t&&e.length?e[0]:(e=e.find(function(e){return e.tagName===t}))?e:null}function xs(e){return Zs.has(e)?Zs.get(e):""}function ks(e){function t(r,s){s=void 0!==s&&s;for(var a=[];e[i];)if(60==e.charCodeAt(i)){if(47===e.charCodeAt(i+1)){s=i+2,i=e.indexOf(">",i),s=e.substring(s,i);var o=s.indexOf(r);if(-1==o){var l=r.indexOf(".");0<l&&(o=s.indexOf(r.substring(0,l)))}if(-1==o)throw r=e.substring(0,i).split("\n"),Error("Unexpected close tag\nLine: "+(r.length-1)+"\nColumn: "+(r[r.length-1].length+1)+"\nChar: "+e[i]);i+1&&(i+=1);break}if(33===e.charCodeAt(i+1)){if(45==e.charCodeAt(i+2)){for(;-1!==i&&(62!==e.charCodeAt(i)||45!=e.charCodeAt(i-1)||45!=e.charCodeAt(i-2)||-1==i);)i=e.indexOf(">",i+1);-1===i&&(i=e.length)}else if(91===e.charCodeAt(i+2)&&91===e.charCodeAt(i+8)&&"cdata"===e.substr(i+3,5).toLowerCase()){o=e.indexOf("]]>",i),-1==o?(a.push(e.substr(i+9)),i=e.length):(a.push(e.substring(i+9,o)),i=o+3);continue}i++;continue}e:{l=s,i++;var u=n(),c={};for(o=[];62!==e.charCodeAt(i)&&e[i];){var h=e.charCodeAt(i);if(64<h&&91>h||96<h&&123>h){h=n();for(var f=e.charCodeAt(i);f&&39!==f&&34!==f&&!(64<f&&91>f||96<f&&123>f)&&62!==f;)i++,f=e.charCodeAt(i);var p=i+1;if(i=e.indexOf(e[i],p),p=e.slice(p,i),39===f||34===f){if(-1===i){for(l={tagName:u,attributes:c,children:o,parent:null},u=0;u<o.length;u++)"string"!==typeof o[u]&&(o[u].parent=l);o=l;break e}}else p=null,i--;h.startsWith("xmlns:")&&Zs.set(p,h.split(":")[1]),"tt"===u&&"xml:space"===h&&"preserve"===p&&(l=!0),c[h]=p}i++}for(47!==e.charCodeAt(i-1)?(i++,o=t(u,l)):i++,l={tagName:u,attributes:c,children:o,parent:null},u=o.length,c=0;c<u;c++)h=o[c],"string"!==typeof h?h.parent=l:c==u-1&&"\n"==h&&o.pop();o=l}if(a.push(o),"string"===typeof o)break;"?"===o.tagName[0]&&o.children&&(a.push.apply(a,d(o.children)),o.children=[])}else o=i,i=e.indexOf("<",i)-1,-2===i&&(i=e.length),o=e.slice(o,i+1),s?0<o.length&&a.push(o):a.length&&1==o.length&&"\n"==o[0]?a.push(o):0<o.trim().length&&a.push(o),i++;return a}function n(){for(var t=i;-1==="\r\n\t>/= ".indexOf(e[i])&&e[i];)i++;return e.slice(t,i)}var i=0;return t("")}function As(e){return"string"===typeof e}function Is(e){var t=[];if(!e.children)return[];e=c(e.children);for(var n=e.next();!n.done;n=e.next())n=n.value,"string"!==typeof n&&t.push(n);return t}function Cs(e,t){var n=[];if(!e.children)return[];e=c(e.children);for(var i=e.next();!i.done;i=e.next())i=i.value,i.tagName===t&&n.push(i);return n}function Ds(e){return"string"===typeof e?yn(e):(e=e.children.reduce(function(e,t){return"string"===typeof t?e+t:e},""),""===e?null:yn(e))}function Rs(e){return Array.from(e.children).every(function(e){return"string"===typeof e})?((e=Ds(e))&&(e=e.trim()),e):null}function Ms(e,t,n){if(n=void 0===n?[]:n,e.tagName===t&&n.push(e),e.children){e=c(e.children);for(var i=e.next();!i.done;i=e.next())Ms(i.value,t,n)}return n}function Ls(e,t){return e=Cs(e,t),1!=e.length?null:e[0]}function Ps(e,t,n){return e=Us(e,t,n),1!=e.length?null:e[0]}function Os(e,t,n,i){i=void 0===i?null:i;var r=null;return e=e.attributes[t],null!=e&&(r=n(e)),null==r?i:r}function Ns(e,t,n){return t=xs(t),e.attributes[t+":"+n]||null}function Us(e,t,n){t=xs(t);var i=[];if(e.children){e=c(e.children);for(var r=e.next();!r.done;r=e.next())(r=r.value)&&r.tagName===t+":"+n&&i.push(r)}return i}function Fs(e,t,n){t=c(t);for(var i=t.next();!i.done;i=t.next())if(i=Ns(e,i.value,n))return i;return null}function Bs(e){return e?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),e=Date.parse(e),isNaN(e)?null:e/1e3):null}function js(e){return e?(e=RegExp("^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$").exec(e),e?(e=31536e3*Number(e[1]||null)+2592e3*Number(e[2]||null)+86400*Number(e[3]||null)+3600*Number(e[4]||null)+60*Number(e[5]||null)+Number(e[6]||null),isFinite(e)?e:null):null):null}function Vs(e){var t=/([0-9]+)-([0-9]+)/.exec(e);return t?(e=Number(t[1]),isFinite(e)?(t=Number(t[2]),isFinite(t)?{start:e,end:t}:null):null):null}function Hs(e){return e=Number(e),0===e%1?e:null}function $s(e){return e=Number(e),0===e%1&&0<e?e:null}function Gs(e){return e=Number(e),0===e%1&&0<=e?e:null}function zs(e){return e=Number(e),isNaN(e)?null:e}function qs(e){return!!e&&"true"===e.toLowerCase()}function Ws(e){var t,n=(t=e.match(/^(\d+)\/(\d+)$/))?Number(t[1])/Number(t[2]):Number(e);return isNaN(n)?null:n}function Ks(e){var t=[];e=yn(e).split(/\/+(?=(?:[^'"]*['"][^'"]*['"])*[^'"]*$)/),e=c(e);for(var n=e.next();!n.done;n=e.next()){n=n.value;var i=n.match(/^([\w]+)/);if(i){var r=n.match(/(@id='(.*?)')/),s=n.match(/\[(\d+)\]/);t.push({name:i[0],id:r?r[0].match(/'(.*?)'/)[0].replace(/'/gm,""):null,position:s?Number(s[1])-1:null,Vb:n.split("/@")[1]||null})}else n.startsWith("@")&&t.length&&(t[t.length-1].Vb=n.slice(1))}return t}function Ys(e,t){var n=Ks(t.attributes.sel||"");if(n.length){var i=n[n.length-1],r=t.attributes.pos||null;n=i.position,null===n?n="prepend"===r?0:e.length:"prepend"===r?--n:"after"===r&&++n,r=t.tagName,(i=i.Vb)?Xs(e[n],r,i,Rs(t)||""):("remove"!==r&&"replace"!==r||e.splice(n,1),"add"!==r&&"replace"!==r||e.splice.apply(e,[n,0].concat(d(t.children))))}}function Xs(e,t,n,i){"remove"===t?delete e.attributes[n]:"add"!==t&&"replace"!==t||(e.attributes[n]=i)}function Qs(e,t,n){t=void 0===t||t,n=void 0===n||n;var i,r=document.createElement(e.tagName);for(i in e.attributes)r.setAttribute(i,e.attributes[i]);if(t&&e.parent&&"?xml"!=e.parent.tagName&&Qs(e.parent,!0,!1).appendChild(r),n)for(e=c(e.children),t=e.next();!t.done;t=e.next())t=t.value,n=void 0,n="string"==typeof t?new Text(t):Qs(t,!1,!0),r.appendChild(n);return r}var Zs=new Map([]);function Js(e){var t=this;this.C=e,this.H=new Set,this.m=this.s=null,this.fa=this.da=!1,this.I=0,this.g=null,this.B=new se,this.i=new Map,this.A=new Map,this.l=new Ir,this.h=null,this.o=function(n){2==n.severity&&t.l.reject(n),e.onError(n)},this.Z=new Map,this.ea=new Map,this.L=new Ut(function(){return Sa(t)}),this.R=!1,this.N=[],this.U=!1,this.K=new Ut(function(){Aa(t)}),this.l.catch(function(){}),this.j=new ts(function(){return ea(t)}),this.aa=!1,this.F=this.G=null}function ea(e){return N(function(t){switch(t.g){case 1:return e.B.release(),e.B=null,e.l.reject(),e.K.stop(),e.K=null,e.L.stop(),e.L=null,S(t,xa(e),2);case 2:if(!e.m){t.u(3);break}return E(t,4),S(t,e.m.setMediaKeys(null),6);case 6:k(t,5);break;case 4:A(t);case 5:e.m=null;case 3:e.g=null,e.H.clear(),e.s=null,e.A=new Map,e.h=null,e.o=function(){},e.C=null,e.aa=!1,e.G=null,w(t)}})}function ta(e,t,n){return e.fa=!0,e.A=new Map,e.R=n,ra(e,t)}function na(e,t,n){e.A=new Map,n=c(n);for(var i=n.next();!i.done;i=n.next())e.A.set(i.value,{initData:null,initDataType:null});for(n=c(e.h.persistentSessionsMetadata),i=n.next();!i.done;i=n.next())i=i.value,e.A.set(i.sessionId,{initData:i.initData,initDataType:i.initDataType});return e.R=0<e.A.size,ra(e,t)}function ia(e,t,n,i,r,s){var a=new Map;return r={audioCapabilities:r,videoCapabilities:s,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:t},r.drmInfos=[{keySystem:t,licenseServerUri:n,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:i,serverCertificateUri:"",initData:null,keyIds:null}],a.set(t,r),ha(e,a,[])}function ra(e,t){var n,i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b;return N(function(_){if(1==_.g){if(n=ga(e))for(i=c(t),r=i.next();!r.done;r=i.next())s=r.value,s.video&&(s.video.drmInfos=[n]),s.audio&&(s.audio.drmInfos=[n]);for(a=t.some(function(e){return!!(e.video&&e.video.drmInfos.length||e.audio&&e.audio.drmInfos.length)}),a||(o=ss(e.h.servers),Da(t,o)),l=new Set,u=c(t),r=u.next();!r.done;r=u.next())for(d=r.value,h=ka(d),f=c(h),p=f.next();!p.done;p=f.next())g=p.value,l.add(g);for(m=c(l),p=m.next();!p.done;p=m.next())v=p.value,Ma(v,ss(e.h.servers),ss(e.h.advanced||{}),e.h.keySystemsMapping);return S(_,Mi(t,e.R,e.aa,e.h.preferredKeySystems),2)}return ns(e.j),y=a||Object.keys(e.h.servers).length,y?(b=ha(e,void 0,t),_.return(a?b:b.catch(function(){}))):(e.da=!0,_.return(Promise.resolve()))})}function sa(e){var t;return N(function(n){switch(n.g){case 1:if(e.m.mediaKeys)return n.return();if(!e.G){n.u(2);break}return S(n,e.G,3);case 3:return ns(e.j),n.return();case 2:return E(n,4),e.G=e.m.setMediaKeys(e.s),S(n,e.G,6);case 6:k(n,5);break;case 4:t=A(n),e.o(new It(2,6,6003,t.message));case 5:ns(e.j),w(n)}})}function aa(e,t){return N(function(n){if(1==n.g)return S(n,sa(e),2);ca(e,t.initDataType,Ee(t.initData)),w(n)})}function oa(e){var t,n,i,r,s;return N(function(a){switch(a.g){case 1:if(!e.s||!e.g)return a.return();if(!e.g.serverCertificateUri||e.g.serverCertificate&&e.g.serverCertificate.length){a.u(2);break}return t=zr([e.g.serverCertificateUri],e.h.retryParameters),E(a,3),n=e.C.Nb.request(5,t),S(a,n.promise,5);case 5:i=a.h,e.g.serverCertificate=Ee(i.data),k(a,4);break;case 3:throw r=A(a),new It(2,6,6017,r);case 4:if(e.j.g)return a.return();case 2:return e.g.serverCertificate&&e.g.serverCertificate.length?(E(a,6),S(a,e.s.setServerCertificate(e.g.serverCertificate),8)):a.return();case 8:k(a,0);break;case 6:throw s=A(a),new It(2,6,6004,s.message)}})}function la(e,t){var n,i,r;return N(function(s){return 1==s.g?S(s,ya(e,t,{initData:null,initDataType:null}),2):3!=s.g?(n=s.h,n?(i=[],(r=e.i.get(n))&&(r.mb=new Ir,i.push(r.mb)),i.push(n.remove()),S(s,Promise.all(i),3)):s.return()):(e.i.delete(n),void w(s))})}function ua(e){var t,n,i,r,s;return N(function(a){if(1==a.g)return e.A.size?(e.A.forEach(function(t,n){ya(e,n,t)}),S(a,e.l,3)):a.u(2);if(2!=a.g){if(t=e.g&&e.g.keyIds||new Set([]),0<t.size&&Ca(e))return a.return(e.l);e.l=new Ir,e.l.catch(function(){})}for(n=(e.g?e.g.initData:[])||[],i=c(n),r=i.next();!r.done;r=i.next())s=r.value,ca(e,s.initDataType,s.initData);return Ia(e)&&e.l.resolve(),a.return(e.l)})}function ca(e,t,n){if(n.length){if(e.h.ignoreDuplicateInitData){var i=e.i.values();i=c(i);for(var r=i.next();!r.done;r=i.next())if(Te(n,r.value.initData))return}0<e.i.size&&Ia(e)&&(e.l.resolve(),e.l=new Ir,e.l.catch(function(){})),ba(e,t,n,e.g.sessionType)}}function da(e){return e=e.i.keys(),e=is(e,function(e){return e.sessionId}),Array.from(e)}function ha(e,t,n){var i,r,s,a,o,l,u,d,h,f,p,g,m,v,y;return N(function(b){switch(b.g){case 1:if(i=new Map,n.length){r=fa(e,n,i),b.u(2);break}return S(b,pa(e,t),3);case 3:r=b.h;case 2:if(s=r,!s)throw new It(2,6,6001);for(ns(e.j),E(b,4),e.H.clear(),a=s.getConfiguration(),o=a.audioCapabilities||[],l=a.videoCapabilities||[],u=c(o),d=u.next();!d.done;d=u.next())h=d.value,e.H.add(h.contentType.toLowerCase());for(f=c(l),d=f.next();!d.done;d=f.next())p=d.value,e.H.add(p.contentType.toLowerCase());if(n.length){var _=s.keySystem,T=i.get(s.keySystem),w=[],x=[],I=[],C=[],D=[],R=new Set,M=new Set;Ra(T,w,x,C,I,D,R,M);var L=e.R?"persistent-license":"temporary";for(_={keySystem:_,encryptionScheme:w[0],licenseServerUri:x[0],distinctiveIdentifierRequired:T[0].distinctiveIdentifierRequired,persistentStateRequired:T[0].persistentStateRequired,sessionType:T[0].sessionType||L,audioRobustness:T[0].audioRobustness||"",videoRobustness:T[0].videoRobustness||"",serverCertificate:C[0],serverCertificateUri:I[0],initData:D,keyIds:R},0<M.size&&(_.keySystemUris=M),T=c(T),M=T.next();!M.done;M=T.next())M=M.value,M.distinctiveIdentifierRequired&&(_.distinctiveIdentifierRequired=M.distinctiveIdentifierRequired),M.persistentStateRequired&&(_.persistentStateRequired=M.persistentStateRequired);T=_}else T=s.keySystem,M=t.get(s.keySystem),_=[],w=[],x=[],I=[],C=[],D=new Set,Ra(M.drmInfos,_,w,I,x,C,D),T={keySystem:T,encryptionScheme:_[0],licenseServerUri:w[0],distinctiveIdentifierRequired:"required"==M.distinctiveIdentifier,persistentStateRequired:"required"==M.persistentState,sessionType:M.sessionTypes[0]||"temporary",audioRobustness:(M.audioCapabilities?M.audioCapabilities[0].robustness:"")||"",videoRobustness:(M.videoCapabilities?M.videoCapabilities[0].robustness:"")||"",serverCertificate:I[0],serverCertificateUri:x[0],initData:C,keyIds:D};if(e.g=T,!e.g.licenseServerUri)throw new It(2,6,6012,e.g.keySystem);return S(b,s.createMediaKeys(),6);case 6:if(g=b.h,ns(e.j),e.s=g,!(""!=e.h.minHdcpVersion&&"getStatusForPolicy"in e.s)){b.u(7);break}return E(b,8),S(b,e.s.getStatusForPolicy({minHdcpVersion:e.h.minHdcpVersion}),10);case 10:if(m=b.h,"usable"!=m)throw new It(2,6,6018);ns(e.j),k(b,7,4);break;case 8:if(v=A(b,4),v instanceof It)throw v;throw new It(2,6,6019,v.message);case 7:return e.da=!0,S(b,oa(e),11);case 11:ns(e.j),k(b,0);break;case 4:if(y=A(b),ns(e.j,y),e.g=null,e.H.clear(),y instanceof It)throw y;throw new It(2,6,6002,y.message)}})}function fa(e,t,n){for(var i=c(t),r=i.next();!r.done;r=i.next()){var s=c(ka(r.value));for(r=s.next();!r.done;r=s.next())r=r.value,n.has(r.keySystem)||n.set(r.keySystem,[]),n.get(r.keySystem).push(r)}if(1==n.size&&n.has(""))throw new It(2,6,6e3);for(i={},e=c(e.h.preferredKeySystems),r=e.next();!r.done;i={Te:i.Te},r=e.next())for(i.Te=r.value,s=c(t),r=s.next();!r.done;r=s.next())if(r=r.value.decodingInfos.find(function(e){return function(t){return t.supported&&null!=t.keySystemAccess&&t.keySystemAccess.keySystem==e.Te}}(i)))return r.keySystemAccess;for(e=c([!0,!1]),r=e.next();!r.done;r=e.next())for(i=r.value,s=c(t),r=s.next();!r.done;r=s.next()){var a=c(r.value.decodingInfos);for(r=a.next();!r.done;r=a.next()){var o=r.value;if(o.supported&&o.keySystemAccess){r=n.get(o.keySystemAccess.keySystem);var l=c(r);for(r=l.next();!r.done;r=l.next())if(!!r.value.licenseServerUri==i)return o.keySystemAccess}}}return null}function pa(e,t){var n,i,r,s,a,o,l,u,d,h,f,p,g,m,v;return N(function(y){switch(y.g){case 1:if(1==t.size&&t.has(""))throw new It(2,6,6e3);for(i=c(t.values()),r=i.next();!r.done;r=i.next())s=r.value,0==s.audioCapabilities.length&&delete s.audioCapabilities,0==s.videoCapabilities.length&&delete s.videoCapabilities;a=c(e.h.preferredKeySystems),o=a.next();case 2:if(o.done){y.u(4);break}if(l=o.value,!t.has(l)){y.u(3);break}return u=t.get(l),E(y,6),S(y,navigator.requestMediaKeySystemAccess(l,[u]),8);case 8:return n=y.h,y.return(n);case 6:A(y);case 7:ns(e.j);case 3:o=a.next(),y.u(2);break;case 4:d=c([!0,!1]),h=d.next();case 9:if(h.done){y.u(11);break}f=h.value,p=c(t.keys()),o=p.next();case 12:if(o.done){h=d.next(),y.u(9);break}if(g=o.value,m=t.get(g),v=m.drmInfos.some(function(e){return!!e.licenseServerUri}),v!=f){y.u(13);break}return E(y,15),S(y,navigator.requestMediaKeySystemAccess(g,[m]),17);case 17:return n=y.h,y.return(n);case 15:A(y);case 16:ns(e.j);case 13:o=p.next(),y.u(12);break;case 11:return y.return(n)}})}function ga(e){return e=ss(e.h.clearKeys),0==e.size?null:Cn(e)}function ma(e){Ia(e)&&e.l.resolve()}function va(e,t){new Ut(function(){t.loaded=!0,ma(e)}).Y(Pa)}function ya(e,t,n){var i,r,s,a,o,l,u;return N(function(c){switch(c.g){case 1:try{i=e.s.createSession("persistent-license")}catch(t){return r=new It(2,6,6005,t.message),e.o(r),c.return(Promise.reject(r))}return e.B.D(i,"message",function(t){e.m&&e.h.delayLicenseRequestUntilPlayed&&e.m.paused&&!e.U?e.N.push(t):_a(e,t)}),e.B.D(i,"keystatuseschange",function(t){return Ta(e,t)}),s={initData:n.initData,initDataType:n.initDataType,loaded:!1,Rf:1/0,mb:null,type:"persistent-license"},e.i.set(i,s),E(c,2),S(c,i.load(t),4);case 4:return a=c.h,ns(e.j),a||(e.i.delete(i),o=e.h.persistentSessionOnlinePlayback?1:2,e.o(new It(o,6,6013)),s.loaded=!0),va(e,s),ma(e),c.return(i);case 2:l=A(c),ns(e.j,l),e.i.delete(i),u=e.h.persistentSessionOnlinePlayback?1:2,e.o(new It(u,6,6005,l.message)),s.loaded=!0,ma(e);case 3:return c.return(Promise.resolve())}})}function ba(e,t,n,i){try{var r=e.s.createSession(i)}catch(t){return void e.o(new It(2,6,6005,t.message))}e.B.D(r,"message",function(t){e.m&&e.h.delayLicenseRequestUntilPlayed&&e.m.paused&&!e.U?e.N.push(t):_a(e,t)}),e.B.D(r,"keystatuseschange",function(t){return Ta(e,t)}),e.i.set(r,{initData:n,initDataType:t,loaded:!1,Rf:1/0,mb:null,type:i});try{n=e.h.initDataTransform(n,t,e.g)}catch(n){return t=n,n instanceof It||(t=new It(2,6,6016,n)),void e.o(t)}e.h.logLicenseExchange&&Sn(n),r.generateRequest(t,n).catch(function(t){if(!e.j.g){e.i.delete(r);var n=t.errorCode;if(n&&n.systemCode){var i=n.systemCode;0>i&&(i+=Math.pow(2,32)),i="0x"+i.toString(16)}e.o(new It(2,6,6006,t.message,t,i))}})}function _a(e,t){var n,i,r,s,a,o,l,u,d,h,f,p,g,m;N(function(v){switch(v.g){case 1:if(n=t.target,e.h.logLicenseExchange&&Sn(t.message),i=e.i.get(n),r=e.g.licenseServerUri,s=e.h.advanced[e.g.keySystem],"individualization-request"==t.messageType&&s&&s.individualizationServer&&(r=s.individualizationServer),a=zr([r],e.h.retryParameters),a.body=t.message,a.method="POST",a.licenseRequestType=t.messageType,a.sessionId=n.sessionId,a.drmInfo=e.g,i&&(a.initData=i.initData,a.initDataType=i.initDataType),s&&s.headers)for(o in s.headers)a.headers[o]=s.headers[o];if(Lt(e.g.keySystem)){var y=fn(a.body,!0,!0);if(y.includes("PlayReadyKeyMessage")){y=Es(y,"PlayReadyKeyMessage");var b=Ms(y,"HttpHeader");b=c(b);for(var _=b.next();!_.done;_=b.next()){var T=_.value;_=Ms(T,"name")[0],T=Ms(T,"value")[0],a.headers[Ds(_)]=Ds(T)}y=Ms(y,"Challenge")[0],a.body=wn(Ds(y))}else a.headers["Content-Type"]="text/xml; charset=utf-8"}return l=Date.now(),E(v,2),d=e.C.Nb.request(2,a),S(v,d.promise,4);case 4:u=v.h,k(v,3);break;case 2:return h=A(v),e.j.g?v.return():(f=new It(2,6,6007,h),1==e.i.size?(e.o(f),i&&i.mb&&i.mb.reject(f)):(i&&i.mb&&i.mb.reject(f),e.i.delete(n),Ia(e)&&(e.l.resolve(),e.L.Y(.1))),v.return());case 3:return e.j.g?v.return():(e.I+=(Date.now()-l)/1e3,e.h.logLicenseExchange&&Sn(u.data),E(v,5),S(v,n.update(u.data),7));case 7:k(v,6);break;case 5:return p=A(v),g=new It(2,6,6008,p.message),e.o(g),i&&i.mb&&i.mb.reject(g),v.return();case 6:if(e.j.g)return v.return();m=new Nr("drmsessionupdate"),e.C.onEvent(m),i&&(i.mb&&i.mb.resolve(),va(e,i)),w(v)}})}function Ta(e,t){t=t.target;var n=e.i.get(t),i=!1;t.keyStatuses.forEach(function(t,r){if("string"==typeof r){var s=r;r=t,t=s}if(Lt(e.g.keySystem)&&16==r.byteLength&&(jt()||Qt())){s=ke(r);var a=s.getUint32(0,!0),o=s.getUint16(4,!0),l=s.getUint16(6,!0);s.setUint32(0,a,!1),s.setUint16(4,o,!1),s.setUint16(6,l,!1)}"status-pending"!=t&&(n.loaded=!0),"expired"==t&&(i=!0),r=xn(r).slice(0,32),e.Z.set(r,t)});var r=t.expiration-Date.now();(0>r||i&&1e3>r)&&n&&!n.mb&&(e.i.delete(t),t.close().catch(function(){})),Ia(e)&&(e.l.resolve(),e.L.Y(Oa))}function Sa(e){var t=e.Z,n=e.ea;n.clear(),t.forEach(function(e,t){return n.set(t,e)}),t=Array.from(n.values()),t.length&&t.every(function(e){return"expired"==e})&&e.o(new It(2,6,6014)),e.C.Ae(as(n))}function wa(){var e,t,n,i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,x,I,C,D,R;return N(function(M){if(1==M.g){for(e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.microsoft.playready.hardware com.microsoft.playready.recommendation com.chromecast.playready com.apple.fps.1_0 com.apple.fps".split(" "),t=["SW_SECURE_CRYPTO","SW_SECURE_DECODE","HW_SECURE_CRYPTO","HW_SECURE_DECODE","HW_SECURE_ALL"],n=["150","2000","3000"],i={"com.widevine.alpha":t,"com.microsoft.playready.recommendation":n},r=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],s=[{contentType:'audio/mp4; codecs="mp4a.40.2"'},{contentType:'audio/webm; codecs="opus"'}],a={videoCapabilities:r,audioCapabilities:s,initDataTypes:["cenc","sinf","skd","keyids"]},o=[null,"cenc","cbcs","cbcs-1-9"],l=new Map,u=function(e,t){var n,i,r,s,a,o,u,c;return N(function(d){switch(d.g){case 1:return E(d,2),S(d,t.createMediaKeys(),4);case 4:k(d,3);break;case 2:return A(d),d.return();case 3:i=!!(n=t.getConfiguration().sessionTypes)&&n.includes("persistent-license"),$t()&&(i=!1),r=t.getConfiguration().videoCapabilities,s=t.getConfiguration().audioCapabilities,a={persistentState:i,encryptionSchemes:[],videoRobustnessLevels:[],audioRobustnessLevels:[]},l.has(e)&&l.get(e)?a=l.get(e):l.set(e,a),(o=r[0].encryptionScheme)&&!a.encryptionSchemes.includes(o)&&a.encryptionSchemes.push(o),(u=r[0].robustness)&&!a.videoRobustnessLevels.includes(u)&&a.videoRobustnessLevels.push(u),(c=s[0].robustness)&&!a.audioRobustnessLevels.includes(c)&&a.audioRobustnessLevels.push(c),w(d)}})},d=function(e,t,n,i){var r,s,o,l,d,h,f,p,g;return N(function(m){switch(m.g){case 1:for(E(m,2),r=yi(a),s=c(r.videoCapabilities),o=s.next();!o.done;o=s.next())l=o.value,l.encryptionScheme=t,l.robustness=n;for(d=c(r.audioCapabilities),o=d.next();!o.done;o=d.next())h=o.value,h.encryptionScheme=t,h.robustness=i;return f=yi(r),f.persistentState="required",f.sessionTypes=["persistent-license"],p=[f,r],S(m,navigator.requestMediaKeySystemAccess(e,p),4);case 4:return g=m.h,S(m,u(e,g),5);case 5:k(m,0);break;case 2:A(m),w(m)}})},h=function(e,t,n,i){var a,o,l;return N(function(c){switch(c.g){case 1:return E(c,2),a={type:"media-source",video:{contentType:r[0].contentType,width:640,height:480,bitrate:1,framerate:1},audio:{contentType:s[0].contentType,channels:2,bitrate:1,samplerate:1},keySystemConfiguration:{keySystem:e,video:{encryptionScheme:t,robustness:n},audio:{encryptionScheme:t,robustness:i}}},S(c,navigator.mediaCapabilities.decodingInfo(a),4);case 4:return o=c.h,l=o.keySystemAccess,S(c,u(e,l),5);case 5:k(c,0);break;case 2:A(c),w(c)}})},f=c(e),p=f.next();!p.done;p=f.next())g=p.value,l.set(g,null);for(m=[],v=c(o),y=v.next();!y.done;y=v.next())for(b=y.value,_=c(e),p=_.next();!p.done;p=_.next())T=p.value,"org.w3.clearkey"===T&&en()||(m.push(d(T,b,"","")),m.push(h(T,b,"","")));for(x=c(e),p=x.next();!p.done;p=x.next())for(I=p.value,C=c(i[I]||[]),D=C.next();!D.done;D=C.next())R=D.value,m.push(d(I,null,R,"")),m.push(d(I,null,"",R)),m.push(h(I,null,R,"")),m.push(h(I,null,"",R));return S(M,Promise.all(m),2)}return M.return(as(l))})}function Ea(e){var t;return N(function(n){return 1==n.g?(t=new Promise(function(e,t){new Ut(t).Y(La)}),E(n,2),S(n,Promise.race([Promise.all([e.close(),e.closed]),t]),4)):2!=n.g?k(n,0):(A(n),void w(n))})}function xa(e){var t;return N(function(n){return t=Array.from(e.i.entries()),e.i.clear(),S(n,Promise.all(t.map(function(t){t=c(t);var n=t.next().value,i=t.next().value;return N(function(t){return 1==t.g?(E(t,2),e.fa||e.A.has(n.sessionId)||"persistent-license"!==i.type||e.h.persistentSessionOnlinePlayback?S(t,Ea(n),5):S(t,n.remove(),5)):2!=t.g?k(t,0):(A(t),void w(t))})})),0)})}function ka(e){return(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[])}function Aa(e){e.i.forEach(function(t,n){var i=t.Rf,r=n.expiration;isNaN(r)&&(r=1/0),r!=i&&(e.C.onExpirationUpdated(n.sessionId,r),t.Rf=r)})}function Ia(e){return e=e.i.values(),rs(e,function(e){return e.loaded})}function Ca(e){for(var t=c(e.g&&e.g.keyIds||new Set([])),n=t.next();!n.done;n=t.next())if("usable"!==e.Z.get(n.value))return!1;return!0}function Da(e,t){var n=[];for(t.forEach(function(e,t){n.push({keySystem:t,licenseServerUri:e,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",initData:[],keyIds:new Set})}),e=c(e),t=e.next();!t.done;t=e.next())t=t.value,t.video&&(t.video.drmInfos=n),t.audio&&(t.audio.drmInfos=n)}function Ra(t,n,i,r,s,a,o,l){var u=[],h={};t=c(t);for(var f=t.next();!f.done;h={na:h.na},f=t.next()){if(h.na=f.value,n.includes(h.na.encryptionScheme)||n.push(h.na.encryptionScheme),"org.w3.clearkey"==h.na.keySystem&&h.na.licenseServerUri.startsWith("data:application/json;base64,")?u.includes(h.na.licenseServerUri)||u.push(h.na.licenseServerUri):i.includes(h.na.licenseServerUri)||i.push(h.na.licenseServerUri),s.includes(h.na.serverCertificateUri)||s.push(h.na.serverCertificateUri),h.na.serverCertificate&&(r.some(function(e){return function(t){return Te(t,e.na.serverCertificate)}}(h))||r.push(h.na.serverCertificate)),h.na.initData){f={};for(var p=c(h.na.initData),g=p.next();!g.done;f={Ud:f.Ud},g=p.next())f.Ud=g.value,a.some(function(e){return function(t){var n=e.Ud;return!(!t.keyId||t.keyId!=n.keyId)||t.initDataType==n.initDataType&&Te(t.initData,n.initData)}}(f))||a.push(f.Ud)}if(h.na.keyIds)for(f=c(h.na.keyIds),p=f.next();!p.done;p=f.next())o.add(p.value);if(h.na.keySystemUris&&l)for(f=c(h.na.keySystemUris),p=f.next();!p.done;p=f.next())l.add(p.value)}if(1==u.length)i.push(u[0]);else if(0<u.length){for(n=[],u=c(u),r=u.next();!r.done;r=u.next())r=e.atob(r.value.split("data:application/json;base64,").pop()),r=JSON.parse(r),n.push.apply(n,d(r.keys));u=JSON.stringify({keys:n}),i.push("data:application/json;base64,"+e.btoa(u))}}function Ma(t,n,i,r){var s=t.keySystem;!s||"org.w3.clearkey"==s&&t.licenseServerUri||(n.size&&(n=n.get(s)||"",t.licenseServerUri=n),t.keyIds||(t.keyIds=new Set),(i=i.get(s))&&(t.distinctiveIdentifierRequired||(t.distinctiveIdentifierRequired=i.distinctiveIdentifierRequired),t.persistentStateRequired||(t.persistentStateRequired=i.persistentStateRequired),t.videoRobustness||(t.videoRobustness=i.videoRobustness),t.audioRobustness||(t.audioRobustness=i.audioRobustness),t.serverCertificate||(t.serverCertificate=i.serverCertificate),i.sessionType&&(t.sessionType=i.sessionType),t.serverCertificateUri||(t.serverCertificateUri=i.serverCertificateUri)),r[s]&&(t.keySystem=r[s]),e.cast&&e.cast.__platform__&&"com.microsoft.playready"==s&&(t.keySystem="com.chromecast.playready"))}i=Js.prototype,i.destroy=function(){return this.j.destroy()},i.configure=function(e){this.h=e,this.K&&this.K.Sa(this.h.updateExpirationTime)},i.Ub=function(e){var t=this;return N(function(n){if(1==n.g)return t.s?(t.m=e,t.B.ha(t.m,"play",function(){for(var e=c(t.N),n=e.next();!n.done;n=e.next())_a(t,n.value);t.U=!0,t.N=[]}),"webkitCurrentPlaybackTargetIsWireless"in t.m&&t.B.D(t.m,"webkitcurrentplaybacktargetiswirelesschanged",function(){return xa(t)}),t.F=t.g&&t.g.initData.find(function(e){return 0<e.initData.length})||null,t.F||"com.apple.fps"!==t.g.keySystem||t.A.size?S(n,sa(t),2):n.u(2)):(t.B.ha(e,"encrypted",function(){t.o(new It(2,6,6010))}),n.return());ua(t).catch(function(){}),t.F||t.A.size||t.h.parseInbandPsshEnabled||t.B.D(t.m,"encrypted",function(e){return aa(t,e)}),w(n)})},i.Df=function(){var e=this,t=this.i.keys();return t=is(t,function(t){var n=e.i.get(t);return{sessionId:t.sessionId,sessionType:n.type,initData:n.initData,initDataType:n.initDataType}}),Array.from(t)},i.td=function(){var e=1/0,t=this.i.keys();t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value,isNaN(n.expiration)||(e=Math.min(e,n.expiration));return e},i.ge=function(){return as(this.ea)};var La=1,Pa=5,Oa=.5;
/*
 @license
 Shaka Player
 Copyright 2023 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/function Na(e,t,n){this.h=e,this.i=t,this.g=n}function Ua(e,t){return N(function(n){if(1==n.g)return S(n,ki(e.g,t,e.h.drm.preferredKeySystems),2);if(e.h.streaming.dontChooseCodecs||Ti(t,e.h.preferredVideoCodecs,e.h.preferredAudioCodecs,e.h.preferredDecodingAttributes),!t.variants.some(qi))throw new It(2,4,4032);return n.return(Fa(e,t))})}function Fa(e,t){var n=xi(t.variants,e.h.restrictions,e.i);if(t){var i=e.g?e.g.g:null;if(i&&e.g.s)for(var r=c(t.variants),s=r.next();!s.done;s=r.next())s=s.value,Ba(e,i.keySystem,s.video),Ba(e,i.keySystem,s.audio);ja(e,t)}return n}function Ba(e,t,n){if(n){n=c(n.drmInfos);for(var i=n.next();!i.done;i=n.next())if(i=i.value,i.keySystem==t){i=c(i.initData||[]);for(var r=i.next();!r.done;r=i.next())r=r.value,ca(e.g,r.initDataType,r.initData)}}}function ja(e,t){e=e.g?e.g.ge():{};var n=Object.keys(e);n=n.length&&"00"==n[0];var i=!1,r=!1,s=new Set,a=new Set;t=c(t.variants);for(var o=t.next();!o.done;o=t.next()){o=o.value;var l=[];o.audio&&l.push(o.audio),o.video&&l.push(o.video),l=c(l);for(var u=l.next();!u.done;u=l.next())if(u=u.value,u.keyIds.size){u=c(u.keyIds);for(var d=u.next();!d.done;d=u.next()){d=d.value;var h=e[n?"00":d];h?Va.includes(h)&&a.add(h):s.add(d)}}o.allowedByApplication?o.allowedByKeySystem&&(i=!0):r=!0}if(!i)throw e={hasAppRestrictions:r,missingKeys:Array.from(s),restrictedKeyStatuses:Array.from(a)},new It(2,4,4012,e)}var Va=["output-restricted","internal-error"];function Ha(){}function $a(e,t){if(t){var n=Ga[t.toLowerCase()];if(n)return n}throw new It(2,4,4e3,e,t)}G("shaka.media.ManifestParser",Ha),Ha.unregisterParserByMime=function(e){delete Ga[e]},Ha.registerParserByMime=function(e,t){Ga[e]=t},Ha.registerParserByExtension=function(){pe("ManifestParser.registerParserByExtension","Please use an ManifestParser with registerParserByMime function.")},Ha.AccessibilityPurpose={hk:"visually impaired",Cj:"hard of hearing"};var Ga={};function za(e,t){function n(){a=!0}function i(e){o.push(e),ds(e)}var r,s=e=Ee(e),a=!1,o=[],l=[];if((new cs).box("moov",i).box("trak",i).box("mdia",i).box("minf",i).box("stbl",i).S("stsd",function(e){r=e,o.push(e),hs(e)}).S("encv",n).S("enca",n).S("dvav",function(e){l.push({box:e,jb:1701733238})}).S("dva1",function(e){l.push({box:e,jb:1701733238})}).S("dvh1",function(e){l.push({box:e,jb:1701733238})}).S("dvhe",function(e){l.push({box:e,jb:1701733238})}).S("hev1",function(e){l.push({box:e,jb:1701733238})}).S("hvc1",function(e){l.push({box:e,jb:1701733238})}).S("avc1",function(e){l.push({box:e,jb:1701733238})}).S("avc3",function(e){l.push({box:e,jb:1701733238})}).S("ac-3",function(e){l.push({box:e,jb:1701733217})}).S("ec-3",function(e){l.push({box:e,jb:1701733217})}).S("ac-4",function(e){l.push({box:e,jb:1701733217})}).S("mp4a",function(e){l.push({box:e,jb:1701733217})}).parse(e),a)return e;if(0==l.length||!r)throw ne(xn(e)),new It(2,3,3019,t);l.reverse(),t=c(l);for(var u=t.next();!u.done;u=t.next())u=u.value,s=qa(s,r,u.box,o,u.jb);return jt()&&tn()?(t=new Uint8Array(e.byteLength+s.byteLength),t.set(s),t.set(e,s.byteLength),t):s}function qa(e,t,n,i,r){var s=Ka.value(),a=e.subarray(n.start,n.start+n.size),o=ke(a),l=new Uint8Array(n.size+s.byteLength);for(l.set(a,0),a=ke(l),a.setUint32(4,r),l.set(s,n.size),r=o.getUint32(4),a.setUint32(n.size+16,r),Wa(l,0,l.byteLength),r=new Uint8Array(e.byteLength+l.byteLength),n=Vt()||jt()?n.start:n.start+n.size,s=e.subarray(n),r.set(e.subarray(0,n)),r.set(l,n),r.set(s,n+l.byteLength),e=c(i),i=e.next();!i.done;i=e.next())i=i.value,Wa(r,i.start,i.size+l.byteLength);return l=ke(r,t.start),t=ys(t),e=l.getUint32(t),l.setUint32(t,e+1),r}function Wa(e,t,n){e=ke(e,t),t=e.getUint32(0),0!=t&&(1==t?(e.setUint32(8,n>>32),e.setUint32(12,4294967295&n)):e.setUint32(0,n))}var Ka=new Dt(function(){return new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])});function Ya(e,t,n,i,r,s,a){this.M=e,this.Ha=t,this.sa=n,this.Lc=void 0===i?null:i,this.timescale=void 0===r?null:r,this.g=void 0===s?null:s,this.aesKey=void 0===a?null:a,this.mimeType=this.codecs=null}function Xa(e,t){return e===t||(e&&t?e.$b()==t.$b()&&e.Xb()==t.Xb()&&Fe(e.M().sort(),t.M().sort())&&Te(e.vd(),t.vd()):e==t)}function Qa(e,t,n,i,r,s,a,o,l,u,d,h,f,p,g,m){for(u=void 0===u?[]:u,p=void 0===p?Ja:p,this.startTime=e,this.j=this.endTime=t,this.C=n,this.Ha=i,this.sa=r,this.$=s,this.timestampOffset=a,this.appendWindowStart=o,this.appendWindowEnd=l,this.g=u,this.tilesLayout=void 0===d?"":d,this.A=void 0===h?null:h,this.h=void 0===f?null:f,this.status=p,this.preload=!1,this.l=!0,this.m=!1,this.aesKey=void 0===g?null:g,this.s=null,this.i=0,this.o=void 0!==m&&m,this.pe=this.Kd=!1,e=c(this.g),t=e.next();!t.done;t=e.next())t.value.Xg();this.o&&this.g.length&&this.g[this.g.length-1].Wg(),this.B=this.mimeType=this.codecs=null}function Za(e,t){e.$=t,e=c(e.g);for(var n=e.next();!n.done;n=e.next())Za(n.value,t)}Ya.prototype.$b=function(){return this.Ha},Ya.prototype.Xb=function(){return this.sa},Ya.prototype.vd=function(){return this.g},G("shaka.media.InitSegmentReference",Ya),Ya.prototype.getEndByte=Ya.prototype.Xb,Ya.prototype.getStartByte=Ya.prototype.$b,i=Qa.prototype,i.M=function(){return this.C()},i.getStartTime=function(){return this.startTime},i.Th=function(){return this.endTime},i.$b=function(){return this.Ha},i.Xb=function(){return this.sa},i.ki=function(){return this.tilesLayout},i.ji=function(){return this.A},i.ac=function(){return this.status},i.Ei=function(){this.status=eo},i.Of=function(){this.preload=!0},i.yi=function(){return this.preload},i.se=function(){this.l=!1},i.vi=function(){return this.l},i.Xg=function(){this.Kd=!0},i.xi=function(){return this.Kd},i.Wg=function(){this.pe=!0},i.wi=function(){return this.pe},i.Vg=function(){this.m=!0},i.ri=function(){return this.m},i.oh=function(e){this.s=e},i.ii=function(){return this.s},i.offset=function(e){this.startTime+=e,this.endTime+=e,this.j+=e;for(var t=c(this.g),n=t.next();!n.done;n=t.next())n=n.value,n.startTime+=e,n.endTime+=e,n.j+=e},i.jg=function(e){null==this.h?Q("Sync attempted without sync time!"):(e=this.h-e-this.startTime,.001<=Math.abs(e)&&this.offset(e))},i.fj=function(e){this.B=e},i.vd=function(){return this.B},G("shaka.media.SegmentReference",Qa),Qa.prototype.getSegmentData=Qa.prototype.vd,Qa.prototype.setSegmentData=Qa.prototype.fj,Qa.prototype.syncAgainst=Qa.prototype.jg,Qa.prototype.offset=Qa.prototype.offset,Qa.prototype.getThumbnailSprite=Qa.prototype.ii,Qa.prototype.setThumbnailSprite=Qa.prototype.oh,Qa.prototype.hasByterangeOptimization=Qa.prototype.ri,Qa.prototype.markAsByterangeOptimization=Qa.prototype.Vg,Qa.prototype.isLastPartial=Qa.prototype.wi,Qa.prototype.markAsLastPartial=Qa.prototype.Wg,Qa.prototype.isPartial=Qa.prototype.xi,Qa.prototype.markAsPartial=Qa.prototype.Xg,Qa.prototype.isIndependent=Qa.prototype.vi,Qa.prototype.markAsNonIndependent=Qa.prototype.se,Qa.prototype.isPreload=Qa.prototype.yi,Qa.prototype.markAsPreload=Qa.prototype.Of,Qa.prototype.markAsUnavailable=Qa.prototype.Ei,Qa.prototype.getStatus=Qa.prototype.ac,Qa.prototype.getTileDuration=Qa.prototype.ji,Qa.prototype.getTilesLayout=Qa.prototype.ki,Qa.prototype.getEndByte=Qa.prototype.Xb,Qa.prototype.getStartByte=Qa.prototype.$b,Qa.prototype.getEndTime=Qa.prototype.Th,Qa.prototype.getStartTime=Qa.prototype.getStartTime,Qa.prototype.getUris=Qa.prototype.M;var Ja=0,eo=1;function to(e){return 1==e.length&&1e-4>e.end(0)-e.start(0)}function no(e){return!e||to(e)?null:e.length?e.end(e.length-1):null}function io(e,t){return!(!e||!e.length||to(e)||t>e.end(e.length-1))&&t>=e.start(0)}function ro(e,t){if(!e||!e.length||to(e))return 0;var n=0;e=c(ao(e));for(var i=e.next();!i.done;i=e.next()){var r=i.value;i=r.start,r=r.end,r>t&&(n+=r-Math.max(i,t))}return n}function so(e,t,n){return e&&e.length&&!to(e)?(e=ao(e).findIndex(function(e,i,r){return e.start>t&&(0==i||r[i-1].end-t<=n)}),0<=e?e:null):null}function ao(e){if(!e)return[];for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}
/*
 @license
 Shaka Player
 Copyright 2022 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
function oo(){}function lo(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9]}function uo(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9]}function co(e,t){var n=(127&e[t])<<21;return n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|127&e[t+3]}function ho(e){var t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if("APIC"===e.type){if(2>e.size||3!==e.data[0])return null;var n=e.data.subarray(1).indexOf(0);if(-1===n)return null;var i=hn(Ee(e.data,1,n)),r=e.data[2+n],s=e.data.subarray(3+n).indexOf(0);if(-1===s)return null;var a,o=hn(Ee(e.data,3+n,s));return a="--\x3e"===i?hn(Ee(e.data,4+n+s)):we(e.data.subarray(4+n+s)),t.mimeType=i,t.pictureType=r,t.description=o,t.data=a,t}return"TXXX"===e.type?2>e.size||3!==e.data[0]?null:(i=e.data.subarray(1).indexOf(0),-1===i?null:(n=hn(Ee(e.data,1,i)),e=hn(Ee(e.data,2+i)).replace(/\0*$/,""),t.description=n,t.data=e,t)):"WXXX"===e.type?2>e.size||3!==e.data[0]?null:(i=e.data.subarray(1).indexOf(0),-1===i?null:(n=hn(Ee(e.data,1,i)),e=hn(Ee(e.data,2+i)).replace(/\0*$/,""),t.description=n,t.data=e,t)):"PRIV"===e.type?2>e.size?null:(n=e.data.indexOf(0),-1===n?null:(n=hn(Ee(e.data,0,n)),t.description=n,"com.apple.streaming.transportStreamTimestamp"==n?(n=e.data.subarray(n.length+1),e=1&n[3],n=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7],n/=45,e&&(n+=47721858.84),t.data=n):(e=we(e.data.subarray(n.length+1)),t.data=e),t)):"T"===e.type[0]?2>e.size||3!==e.data[0]?null:(e=hn(e.data.subarray(1)).replace(/\0*$/,""),t.data=e,t):"W"===e.type[0]?(e=hn(e.data).replace(/\0*$/,""),t.data=e,t):e.data?(t.data=we(e.data),t):null}function fo(e){for(var t=0,n=[];lo(e,t);){var i=co(e,t+6);for(e[t+5]>>6&1&&(t+=10),t+=10,i=t+i;t+10<i;){var r=e.subarray(t),s=co(r,4);r={type:String.fromCharCode(r[0],r[1],r[2],r[3]),size:s,data:r.subarray(10,10+s)},(s=ho(r))&&n.push(s),t+=r.size+10}uo(e,t)&&(t+=10)}return n}function po(e,t){for(var n=t=void 0===t?0:t,i=0;lo(e,t);)e[t+5]>>6&1&&(i+=10),i+=10,i+=co(e,t+6),uo(e,t+10)&&(i+=10),t+=i;return 0<i?e.subarray(n,n+i):new Uint8Array([])}function go(e,t){var n=null,i=null,r=null,s=e.P();return 1&t&&(r=e.Qc()),2&t&&e.skip(4),8&t&&(n=e.P()),16&t&&(i=e.P()),{trackId:s,qd:n,fe:i,jk:r}}function mo(e,t){return 1==t?(t=e.P(),e=e.P(),{baseMediaDecodeTime:t*Math.pow(2,32)+e}):{baseMediaDecodeTime:e.P()}}function vo(e,t){return 1==t?(e.skip(8),e.skip(8)):(e.skip(4),e.skip(4)),t=e.P(),e.skip(4),e=e.ka(),{timescale:t,language:String.fromCharCode(96+(e>>10))+String.fromCharCode(96+((960&e)>>5))+String.fromCharCode(96+(31&e))}}function yo(e,t,n){var i=e.P(),r=[],s=null;1&n&&(s=e.P()),4&n&&e.skip(4);for(var a=0;a<i;a++){var o={$f:null,sampleSize:null,He:null};256&n&&(o.$f=e.P()),512&n&&(o.sampleSize=e.P()),1024&n&&e.skip(4),2048&n&&(o.He=0==t?e.P():e.bh()),r.push(o)}return{nk:i,fh:r,Mh:s}}function bo(e){e.skip(6),e.skip(2),e.skip(8);var t=e.ka();return e.skip(2),e.skip(2),e.skip(2),e=e.ka()+e.ka()/65536,{channelCount:t,sampleRate:e}}function _o(e){return e=e.P(),{Na:vs(e)}}function To(e){var t=null,n=null,i=e.rb(4),r=String.fromCharCode(i[0]);if(r+=String.fromCharCode(i[1]),r+=String.fromCharCode(i[2]),r+=String.fromCharCode(i[3]),"nclx"===r){switch(e.ka()){case 1:case 5:case 6:case 7:t="srgb";break;case 9:t="rec2020";break;case 11:case 12:t="p3"}switch(i=e.ka(),e.ka(),i){case 1:case 6:case 13:case 14:case 15:n="SDR";break;case 16:n="PQ";break;case 18:n="HLG"}}return{colorGamut:t,Qd:n}}function So(e,t){return t=void 0!==t&&t,e=e.toString(16).toUpperCase(),t?e:("0"+e).slice(-2)}function wo(e){return(10>e?"0":"")+e}function Eo(e,t){if(this.j=e,void 0!==t&&t){t=new Uint8Array(e.byteLength);for(var n=0,i=0;i<e.byteLength;i++)2<=i&&3==e[i]&&0==e[i-1]&&0==e[i-2]||(t[n]=e[i],n++);this.j=Ee(t,0,n)}this.i=this.j.byteLength,this.g=this.h=0}function xo(e){var t=e.j.byteLength-e.i,n=new Uint8Array(4),i=Math.min(4,e.i);0!==i&&(n.set(e.j.subarray(t,t+i)),e.h=new os(n,0).P(),e.g=8*i,e.i-=i)}function ko(e,t){if(e.g<=t){t-=e.g;var n=Math.floor(t/8);t-=8*n,e.g-=n,xo(e)}e.h<<=t,e.g-=t}function Ao(e,t){var n=Math.min(e.g,t),i=e.h>>>32-n;return e.g-=n,0<e.g?e.h<<=n:0<e.i&&xo(e),n=t-n,0<n?i<<n|Ao(e,n):i}function Io(e){var t;for(t=0;t<e.g;++t)if(0!==(e.h&2147483648>>>t))return e.h<<=t,e.g-=t,t;return xo(e),t+Io(e)}function Co(e){ko(e,1+Io(e))}function Do(e){var t=Io(e);return Ao(e,t+1)-1}function Ro(e){return e=Do(e),1&e?1+e>>>1:-1*(e>>>1)}function Mo(e){return 1===Ao(e,1)}function Lo(e){return Ao(e,8)}function Po(e,t){for(var n=8,i=8,r=0;r<t;r++)0!==i&&(i=Ro(e),i=(n+i+256)%256),n=0===i?n:i}function Oo(e){return Lo(e),Do(e),Do(e)}function No(){this.G=null,this.H=!1,this.m=this.I=null,this.j=[],this.g=[],this.A=this.B=null,this.i=[],this.h=[],this.C=null,this.l=[],this.F=this.o=this.s=null}function Uo(e,t){if(1!==(t[0]<<16|t[1]<<8|t[2]))return null;var n={data:new Uint8Array(0),packetLength:t[4]<<8|t[5],pts:null,dts:null,nalus:[]};if(n.packetLength&&n.packetLength>t.byteLength-6)return null;var i=t[7];if(192&i){var r=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2;null==e.s&&(e.s=r),n.pts=jo(r,e.s),e.s=n.pts,n.dts=n.pts,64&i&&(i=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,null==e.o&&(e.o=i),n.dts=jo(i,e.o)),e.o=n.dts}return e=t[8]+9,t.byteLength<=e?null:(n.data=t.subarray(e),n)}function Fo(e){var t={height:null,width:null,Na:null};if(e=e.ke(),!e.length)return t;if(e=e.find(function(e){return 7==e.type}),!e)return t;e=new Eo(e.data);var n=Lo(e),i=Lo(e),r=Lo(e);if(Co(e),$o.includes(n)){var s=Do(e);if(3===s&&ko(e,1),Co(e),Co(e),ko(e,1),Mo(e)){s=3!==s?8:12;for(var a=0;a<s;a++)Mo(e)&&Po(e,6>a?16:64)}}if(Co(e),s=Do(e),0===s)Do(e);else if(1===s)for(ko(e,1),Co(e),Co(e),s=Do(e),a=0;a<s;a++)Co(e);Co(e),ko(e,1),s=Do(e),a=Do(e);var o=Ao(e,1);0===o&&ko(e,1),ko(e,1);var l=0,u=0,c=0,d=0;return Mo(e)&&(l=Do(e),u=Do(e),c=Do(e),d=Do(e)),t.height=String((2-o)*(a+1)*16-2*c-2*d),t.width=String(16*(s+1)-2*l-2*u),t.Na="avc1."+("0"+n.toString(16).toUpperCase()).slice(-2)+("0"+i.toString(16).toUpperCase()).slice(-2)+("0"+r.toString(16).toUpperCase()).slice(-2),t}function Bo(e){var t={height:null,width:null,Na:null};if(e=e.ke(),!e.length)return t;if(e=e.find(function(e){return 33==e.type}),!e)return t;var n=new Eo(e.fullData,!0);Lo(n),Lo(n),Ao(n,4);var i=Ao(n,3);Mo(n);var r=Ao(n,2),s=Ao(n,1),a=Ao(n,5),o=Ao(n,32);e=Lo(n);for(var l=Lo(n),u=Lo(n),c=Lo(n),d=Lo(n),h=Lo(n),f=Lo(n),p=[],g=[],m=0;m<i;m++)p.push(Mo(n)),g.push(Mo(n));if(0<i)for(m=i;8>m;m++)Ao(n,2);for(m=0;m<i;m++)p[m]&&Ao(n,88),g[m]&&Lo(n);Do(n),i=Do(n),3==i&&Ao(n,1),p=Do(n),g=Do(n);var v=m=0,y=0,b=0;return Mo(n)&&(m+=Do(n),v+=Do(n),y+=Do(n),b+=Do(n)),t.width=String(p-(m+v)*(1===i||2===i?2:1)),t.height=String(g-(y+b)*(1===i?2:1)),n=function(e){for(var t=0,n=0;32>n;n++)t|=(e>>n&1)<<31-n;return t>>>0}(o),s=1==s?"H":"L",r="hvc1."+["","A","B","C"][r]+a,r+="."+n.toString(16).toUpperCase(),r+="."+s+f,h&&(r+="."+h.toString(16).toUpperCase()),d&&(r+="."+d.toString(16).toUpperCase()),c&&(r+="."+c.toString(16).toUpperCase()),u&&(r+="."+u.toString(16).toUpperCase()),l&&(r+="."+l.toString(16).toUpperCase()),e&&(r+="."+e.toString(16).toUpperCase()),t.Na=r,t}function jo(e,t){var n=1;for(e>t&&(n=-1);4294967296<Math.abs(t-e);)e+=8589934592*n;return e}function Vo(e){return!(0>Ho(e))}function Ho(e){for(var t=Math.min(1e3,e.length-564),n=0;n<t;){if(71==e[n]&&71==e[n+188]&&71==e[n+376])return n;n++}return-1}Qa.Status={oj:Ja,fk:eo,Ij:2},G("shaka.util.Id3Utils",oo),oo.getID3Data=po,oo.getID3Frames=fo,G("shaka.util.ExpGolomb",Eo),i=No.prototype,i.clearData=function(){this.j=[],this.g=[],this.i=[],this.h=[],this.l=[]},i.parse=function(e){if(564>e.length)return this;for(var t=Math.max(0,Ho(e)),n=e.length-(e.length+t)%188,i=!1,r=t;r<n;r+=188)if(71==e[r]){var s=!!(64&e[r+1]),a=((31&e[r+1])<<8)+e[r+2];if(1<(48&e[r+3])>>4){var o=r+5+e[r+4];if(o==r+188)continue}else o=r+4;switch(a){case 0:s&&(o+=e[o]+1),this.G=(31&e[o+10])<<8|e[o+11];break;case 17:case 8191:break;case this.G:s&&(o+=e[o]+1),s=e,a={audio:-1,video:-1,me:-1,audioCodec:"",videoCodec:""};var l=o+3+((15&s[o+1])<<8|s[o+2])-4;for(o+=12+((15&s[o+10])<<8|s[o+11]);o<l;){var u=(31&s[o+1])<<8|s[o+2],c=(15&s[o+3])<<8|s[o+4];switch(s[o]){case 6:if(0<c)for(var d=o+5,h=c;2<h;){var f=s[d+1]+2;switch(s[d]){case 5:var p=vn(s.subarray(d+2,d+f));-1==a.audio&&"Opus"===p?(a.audio=u,a.audioCodec="opus"):-1==a.video&&"AV01"===p&&(a.video=u,a.videoCodec="av1");break;case 106:-1==a.audio&&(a.audio=u,a.audioCodec="ac3");break;case 122:-1==a.audio&&(a.audio=u,a.audioCodec="ec3");break;case 124:-1==a.audio&&(a.audio=u,a.audioCodec="aac");break;case 127:"opus"==a.audioCodec&&(p=null,128===s[d+2]&&(p=s[d+3]),null!=p&&(this.F={channelCount:0===(15&p)?2:15&p,Jh:p,sampleRate:48e3}))}d+=f,h-=f}break;case 15:-1==a.audio&&(a.audio=u,a.audioCodec="aac");break;case 17:-1==a.audio&&(a.audio=u,a.audioCodec="aac-loas");break;case 21:-1==a.me&&(a.me=u);break;case 27:-1==a.video&&(a.video=u,a.videoCodec="avc");break;case 3:case 4:-1==a.audio&&(a.audio=u,a.audioCodec="mp3");break;case 36:-1==a.video&&(a.video=u,a.videoCodec="hvc");break;case 129:-1==a.audio&&(a.audio=u,a.audioCodec="ac3");break;case 132:case 135:-1==a.audio&&(a.audio=u,a.audioCodec="ec3")}o+=c+5}s=a,-1!=s.video&&(this.I=s.video,this.m=s.videoCodec),-1!=s.audio&&(this.B=s.audio,this.A=s.audioCodec),-1!=s.me&&(this.C=s.me),i&&!this.H&&(i=!1,r=t-188),this.H=!0;break;case this.I:o=e.subarray(o,r+188),s?this.j.push([o]):this.j.length&&this.j[this.j.length-1]&&this.j[this.j.length-1].push(o);break;case this.B:o=e.subarray(o,r+188),s?this.i.push([o]):this.i.length&&this.i[this.i.length-1]&&this.i[this.i.length-1].push(o);break;case this.C:o=e.subarray(o,r+188),s?this.l.push([o]):this.l.length&&this.l[this.l.length-1]&&this.l[this.l.length-1].push(o);break;default:i=!0}}return this},i.Ji=function(e){return pe("TsParser.parseAvcNalus","Please use parseNalus function instead."),this.Uf(e)},i.Uf=function(e,t,n){var i=e.pts?e.pts/9e4:null;e=e.data;var r=e.byteLength,s=1;"hvc"==this.m&&(s=2);for(var a,o=n||0,l=[],u=-1,c=0,d=0;d<r;++d){var h=e[d];if(h){if(2<=o&&1==h){if(t&&!l.length&&-1==u&&(h=d-(3<o?3:o),n&&0!=h&&(h=e.subarray(0,h),t.data=kn(t.data,h),t.fullData=kn(t.fullData,h))),0<=u?(o=d-((3<o?3:o)+1),l.push({data:e.subarray(u+s,o+1),fullData:e.subarray(u,o+1),type:c,time:i})):t&&!l.length&&(u=d-o,0<u&&(u=e.subarray(0,u),t.data=kn(t.data,u),t.fullData=kn(t.fullData,u))),d>=r-s)return l;d++,u=d,c="hvc"==this.m?e[d]>>1&63:31&e[d]}o=0}else o++;d>=r-1&&0<=u&&0<=o&&(a={data:e.subarray(u+s,r),fullData:e.subarray(u,r),type:c,time:i})}return a&&l.push(a),!l.length&&t&&(t.data=kn(t.data,e),t.fullData=kn(t.fullData,e)),l},i.getMetadata=function(){for(var e=[],t=c(this.l),n=t.next();!n.done;n=t.next())n=kn.apply(_n,d(n.value)),(n=Uo(this,n))&&e.push({cueTime:n.pts?n.pts/9e4:null,data:n.data,frames:fo(n.data),dts:n.dts,pts:n.pts});return e},i.Wb=function(){if(this.i.length&&!this.h.length){for(var e=!1,t=c(this.i),n=t.next();!n.done;n=t.next()){var i=kn.apply(_n,d(n.value)),r=Uo(this,i);n=this.h.length?this.h[this.h.length-1]:null,r&&null!=r.pts&&null!=r.dts&&(!n||n.pts!=r.pts&&n.dts!=r.dts)?(this.h.length&&r.dts<(n.dts||0)&&(e=!0),this.h.push(r)):this.h.length&&(i=r?r.data:i)&&(n=this.h.pop(),n.data=kn(n.data,i),this.h.push(n))}e&&(this.h=this.h.sort(function(e,t){var n=(e.pts||0)-(t.pts||0);return(e.dts||0)-(t.dts||0)||n}))}return this.h},i.Ic=function(e){if(e=void 0===e||e,this.j.length&&!this.g.length){for(var t=!1,n=c(this.j),i=n.next();!i.done;i=n.next()){var r=kn.apply(_n,d(i.value)),s=Uo(this,r);i=this.g.length?this.g[this.g.length-1]:null,s&&null!=s.pts&&null!=s.dts&&(!i||i.pts!=s.pts&&i.dts!=s.dts)?(this.g.length&&s.dts<(i.dts||0)&&(t=!0),this.g.push(s)):this.g.length&&(r=s?s.data:r)&&(i=this.g.pop(),i.data=kn(i.data,r),this.g.push(i))}if(e){for(n=[],i=c(this.g),r=i.next();!r.done;r=i.next())if(r=r.value,r.nalus=this.Uf(r,a,void 0),r.nalus.length){n.push(r);var a=r.nalus[r.nalus.length-1]}this.g=n}t&&(this.g=this.g.sort(function(e,t){var n=(e.pts||0)-(t.pts||0);return(e.dts||0)-(t.dts||0)||n}))}return e?this.g:(e=this.g,this.g=[],e)},i.getStartTime=function(e){if("audio"==e){e=null;var t=this.Wb();return t.length&&(e=t[0],e=Math.min(e.dts,e.pts)/9e4),e}return"video"==e?(e=null,t=this.Ic(!1),t.length&&(e=t[0],e=Math.min(e.dts,e.pts)/9e4),e):null},i.sd=function(){return{audio:this.A,video:this.m}},i.ke=function(){for(var e=[],t=c(this.Ic()),n=t.next();!n.done;n=t.next())e.push.apply(e,d(n.value.nalus));return e},i.ni=function(){pe("TsParser.getVideoResolution","Please use getVideoInfo function instead.");var e=this.Hf();return{height:e.height,width:e.width}},i.Hf=function(){return"hvc"==this.m?Bo(this):Fo(this)},G("shaka.util.TsParser",No),No.syncOffset=Ho,No.probe=Vo,No.prototype.getVideoInfo=No.prototype.Hf,No.prototype.getVideoResolution=No.prototype.ni,No.prototype.getVideoNalus=No.prototype.ke,No.prototype.getCodecs=No.prototype.sd,No.prototype.getStartTime=No.prototype.getStartTime,No.prototype.getVideoData=No.prototype.Ic,No.prototype.getAudioData=No.prototype.Wb,No.prototype.getMetadata=No.prototype.getMetadata,No.prototype.parseNalus=No.prototype.Uf,No.prototype.parseAvcNalus=No.prototype.Ji,No.prototype.parse=No.prototype.parse,No.prototype.clearData=No.prototype.clearData,No.Timescale=9e4;var $o=[100,110,122,244,44,83,86,118,128,138,139,134];function Go(e,t,n){this.g=null,this.o=-1,this.l=e,this.i=t,this.m=n,this.j=!1;e:{if("undefined"===typeof libDPIModule&&Z("Could not find LCEVC Library dependencies on this page"),"undefined"!==typeof LCEVCdec)this.h=LCEVCdec;else{if("undefined"===typeof LcevcDil){Z("Could not find LCEVC Library on this page"),e=!1;break e}this.h=LcevcDil,this.j=!0,pe("LcevcDil","lcevc_dil.js is deprecated, please use lcevc_dec.js instead")}"undefined"===typeof this.h.SupportObject?(Z("Could not find LCEVC Library on this page"),e=!1):(this.h.SupportObject.SupportStatus||Z(this.h.SupportObject.SupportError),e="undefined"!==typeof this.h&&"undefined"!==typeof libDPIModule&&this.i instanceof HTMLCanvasElement&&this.h.SupportObject.SupportStatus)}e&&!this.g&&this.h.SupportObject.webGLSupport(this.i)&&(this.i.classList.remove("shaka-hidden"),this.g=this.j?new this.h.LcevcDil(this.l,this.i,this.m):new this.h.LCEVCdec(this.l,this.i,this.m))}function zo(e){e.g&&e.i.classList.add("shaka-hidden")}function qo(e,t,n){var i=Wo,r=Zo;switch(t.mimeType){case"video/webm":i=Ko;break;case"video/mp4":i=Yo}switch(n){case"DASH":r=Qo;break;case"HLS":r=Xo}e.g&&(e.o=t.id,e.g.setLevelSwitching(t.id,!0),e.g.setContainerFormat(i),e.j||e.g.setStreamingFormat(r))}Go.prototype.release=function(){this.g&&(this.g.close(),this.g=null)},G("shaka.lcevc.Dec",Go),Go.prototype.release=Go.prototype.release;var Wo=0,Ko=1,Yo=2,Xo=0,Qo=1,Zo=-1;function Jo(e,t,n,i){var r=this;this.i=e,this.da=n,this.A=null,this.F=t,this.h={},this.G={},this.Da={},this.g=null,this.fa=!1,this.Z=i||null,this.l={},this.s=new se,this.j={},this.H=null,this.L=new Ir,this.N="",this.ra=!1,this.m=el(this,this.L),this.C=!1,this.I=new ts(function(){return nl(r)}),this.B=!1,this.aa="UNKNOWN",this.Ea=this.Fa=!1,this.za=new Ir,this.o=!1,this.xa=!0,this.qa=this.R=this.ya=this.U=this.K=this.ea=null,this.pa=new Ir}function el(t,n){if(e.ManagedMediaSource){t.i.disableRemotePlayback=!0;var i=new ManagedMediaSource;return t.s.D(i,"startstreaming",function(){t.xa=!0}),t.s.D(i,"endstreaming",function(){t.xa=!1}),t.s.ha(i,"sourceopen",function(){URL.revokeObjectURL(t.N),n.resolve()}),t.s.ha(t.i,"playing",function(){t.ra=!0}),t.N=Rl(i),t.i.src=t.N,i}return i=new MediaSource,t.s.ha(i,"sourceopen",function(){URL.revokeObjectURL(t.N),n.resolve()}),t.s.ha(t.i,"playing",function(){t.ra=!0}),t.N=Rl(i),t.i.src=t.N,i}function tl(e,t){var n,i,r,s,a,o,l,u,d,h,f;return N(function(p){if(1==p.g)return e.createSegmentIndex?S(p,e.createSegmentIndex(),2):p.u(2);if(!e.segmentIndex)return p.return(!1);if(0==e.segmentIndex.getNumReferences())return p.return(!0);for(n=Pn,i=new Set,r=c(e.segmentIndex),s=r.next();!s.done;s=r.next())if(a=s.value,o=a.mimeType||e.mimeType||"",l=a.codecs||e.codecs||"",u=o+":"+l,!i.has(u))if(i.add(u),t==n.ta){if(d=Fn(o,l),!Zn(d))return p.return(!1)}else if(t==n.ga?l=Oi(l):t==n.X&&(l=Pi(l,o)),h=Vn(e,o,l),f=Bn(o,l),!ce(h)&&!st(f))return p.return(!1);return p.return(!0)})}function nl(e){var t,n,i,r,s,a,o,l;return N(function(u){if(1==u.g){for(n in t=[],e.l)for(i=e.l[n],r=i[0],e.l[n]=i.slice(0,1),r&&t.push(r.p.catch(ai)),s=c(i.slice(1)),a=s.next();!a.done;a=s.next())o=a.value,o.p.reject(new It(2,7,7003,void 0));for(l in e.g&&t.push(e.g.destroy()),e.F&&t.push(e.F.destroy()),e.j)t.push(e.j[l].destroy());return S(u,Promise.all(t),2)}e.s&&(e.s.release(),e.s=null),e.i&&(e.i.removeAttribute("src"),e.i.load(),e.i=null),e.A=null,e.m=null,e.g=null,e.F=null,e.h={},e.j={},e.H=null,e.l={},e.Z=null,e.K=null,e.da=null,w(u)})}function il(e,t,n,i){var r,s,a,o,l,u,c,d,h,f,p,g;return N(function(m){switch(m.g){case 1:return r=Pn,s=z,a=q,S(m,tl(n,t),2);case 2:if(a.call(s,m.h,"Type negotiation should happen before MediaSourceEngine.init!"),o=Fn(n.mimeType,i),t==r.ta){rl(e,o,e.B,n.external),m.u(0);break}if(l=e.A.forceTransmux,(!ce(o)||!e.B&&Xn.includes(o))&&(l=!0),u=Bn(n.mimeType,i),!l){m.u(4);break}if(c=Rn(r.X,(i||"").split(",")),d=Rn(r.ga,(i||"").split(",")),!c||!d){m.u(5);break}return e.o=!0,S(m,il(e,r.X,n,c),6);case 6:return S(m,il(e,r.ga,n,d),7);case 7:return m.return();case 5:(h=st(u))&&(f=h(),e.j[t]=f,o=f.convertCodecs(t,u));case 4:p=o+e.A.addExtraFeaturesToSourceBuffer(o),ns(e.I);try{g=e.m.addSourceBuffer(p)}catch(t){throw new It(2,3,3015,t,"The mediaSource_ status was "+e.m.readyState+" expected 'open'",null)}e.B&&(g.mode=Ml),e.s.D(g,"error",function(){var n=e.l[t][0];n.p.reject(new It(2,3,3014,e.i.error?e.i.error.code:0,n.uri))}),e.s.D(g,"updateend",function(){return _l(e,t)}),e.h[t]=g,e.G[t]=o,e.Da[t]=!!n.drmInfos.length,w(m)}})}function rl(e,t,n,i){e.g||(e.g=new Qn(e.F),e.g&&(e.g.A=e.A.modifyCueCallback));var r=e.g;i=i||e.fa,e=e.aa,"application/cea-608"==t||"application/cea-708"==t?r.i=null:(r.i=(0,ri[t])(),r.i.setSequenceMode?r.i.setSequenceMode(n):pe("Text parsers w/ setSequenceMode",'Text parsers should have a "setSequenceMode" method!'),r.i.setManifestType?r.i.setManifestType(e):pe("Text parsers w/ setManifestType",'Text parsers should have a "setManifestType" method!'),r.B=i)}function sl(e){return!e.C&&(!e.m||"ended"==e.m.readyState)}function al(e,t){return e.C||!Object.keys(e.h).length?e=null:t==Ln?e=e.g.g:(e=ul(e,t),e=!e||to(e)?null:1==e.length&&0>e.start(0)?0:e.length?e.start(0):null),e}function ol(e,t){return e.C?null:t==Ln?e.g.h:no(ul(e,t))}function ll(e,t,n){return e.C?0:t==Ln?(e=e.g,null==e.h||e.h<n?0:e.h-Math.max(n,e.g)):(e=ul(e,t),ro(e,n))}function ul(e,t){try{return e.h[t].buffered}catch(e){return null}}function cl(e,t,n,i,r,s){var a=null,o=Ee(n);if(Xn.includes(r))s=fo(o),s.length&&i&&((t=s.find(function(e){return"com.apple.streaming.transportStreamTimestamp"===e.description}))&&t.data&&(a=Math.round(t.data)/1e3),e.da.onMetadata([{cueTime:i.startTime,data:o,frames:s,dts:i.startTime,pts:i.startTime}],0,i.endTime));else if(r.includes("/mp4")&&i&&0==i.timestampOffset&&i.$&&i.$.timescale){var l=i.$.timescale;if(!isNaN(l)){var u=0,c=!1;(new cs).box("moof",ds).box("traf",ds).S("tfdt",function(e){u=mo(e.reader,e.version).baseMediaDecodeTime/l,c=!0,e.parser.stop()}).parse(n,!0),c&&(a=u)}}else!r.includes("/mp4")&&!r.includes("/webm")&&Vo(o)&&(e.K?e.K.clearData():e.K=new No,o=e.K.parse(o),t=o.getStartTime(t),null!=t&&(a=t),o=o.getMetadata(),o.length)&&e.da.onMetadata(o,s,i?i.endTime:null);return a}function dl(e,t,n,i,r,s,a,o,l,u){var c,d,h,f,p,g,m,v,y,b,_,T,E,x;return a=void 0!==a&&a,o=void 0!==o&&o,l=void 0!==l&&l,u=void 0!==u&&u,N(function(k){switch(k.g){case 1:if(c=Pn,t!=c.ta){k.u(2);break}if(!e.B){k.u(3);break}return S(k,e.za,4);case 4:d=k.h,e.g.s=d;case 3:return S(k,Jn(e.g,n,i?i.startTime:null,i?i.endTime:null,i?i.M()[0]:null),5);case 5:return k.return();case 2:if(u||!e.o){k.u(6);break}return S(k,dl(e,c.X,n,i,r,s,a,o,l,!0),7);case 7:return S(k,dl(e,c.ga,n,i,r,s,a,o,l,!0),8);case 8:return k.return();case 6:if(!e.h[t])return k.return();if(h=e.h[t].timestampOffset,f=e.G[t],e.j[t]&&(f=e.j[t].getOriginalMimeType()),i&&(p=cl(e,t,n,i,f,h),null!=p&&(null==e.U&&t==c.ga&&(e.U=p,e.ya=i.startTime,null!=e.R&&(g=0,e.ya==e.qa&&(g=e.U-e.R),e.pa.resolve(g))),null==e.R&&t==c.X&&(e.R=p,e.qa=i.startTime,null!=e.U&&(m=0,e.ya==e.qa&&(m=e.U-e.R),e.pa.resolve(m))),v=i.startTime-p,y=Math.abs(h-v),(.001<=y||a||o)&&(!l||0<v||!h)&&(h=v,e.Ea&&(Tl(e,t,function(){return yl(e,t)},null),Tl(e,t,function(){return bl(e,t,h)},null))),b=t==c.ga||!(c.ga in e.h),e.B&&b&&e.za.resolve(h))),s&&t==c.ga&&(e.g||rl(e,"application/cea-608",e.B,!1),e.H||(_=f.split(";",1)[0],e.H=new Ce(_)),i?(T=e.H.i(n),T.length&&ii(e.g,T,i.startTime,i.endTime,h)):e.H.init(n,o)),!e.j[t]){k.u(9);break}return S(k,e.j[t].transmux(n,r,i,e.m.duration,t),10);case 10:n=k.h;case 9:if(n=xl(e,n,i?i.startTime:null,t,i?i.M()[0]:null),!i||!e.B||t==c.ta){k.u(11);break}if(!a&&!o){k.u(11);break}if(E=i.startTime,"HLS"!=e.aa||e.o||t!=c.X||!e.h[c.ga]){k.u(13);break}return S(k,e.pa,14);case 14:x=k.h,.1<Math.abs(x)&&(E-=x);case 13:Tl(e,t,function(){return yl(e,t)},null),Tl(e,t,function(){return bl(e,t,E)},null);case 11:return S(k,Tl(e,t,function(){var i=n;if("video"==t&&e.Z){var r=e.Z;r.g&&r.g.appendBuffer(i,"video",r.o,-h)}e.h[t].appendBuffer(i)},i?i.M()[0]:null),15);case 15:w(k)}})}function hl(e,t){var n=ol(e,"video")||0;ti(e.g,t,n)}function fl(e){e.g&&ti(e.g,"",0)}function pl(e,t){var n;return N(function(i){return 1==i.g?(n=Pn,t==n.ta?e.g?S(i,e.g.remove(0,1/0),0):i.return():S(i,Tl(e,t,function(){return vl(e,t,0,e.m.duration)},null),4)):e.o?S(i,Tl(e,n.X,function(){return vl(e,n.X,0,e.m.duration)},null),0):i.u(0)})}function gl(e,t,n,i,r,s,a,o,l){var u,c,d;return N(function(h){return 1==h.g?(u=Pn,t==u.ta?(s||(e.g.s=n),ei(e.g,i,r),h.return()):(c=[],S(h,Cl(e,t,a,o,l),2))):(d=h.h,d||(c.push(Tl(e,t,function(){return yl(e,t)},null)),e.o&&c.push(Tl(e,u.X,function(){return yl(e,u.X)},null))),s||(c.push(Tl(e,t,function(){return bl(e,t,n)},null)),e.o&&c.push(Tl(e,u.X,function(){return bl(e,u.X,n)},null))),c.push(Tl(e,t,function(){e.h[t].appendWindowStart=0,e.h[t].appendWindowEnd=r,e.h[t].appendWindowStart=i,_l(e,t)},null)),e.o&&c.push(Tl(e,u.X,function(){var t=u.X;e.h[t].appendWindowStart=0,e.h[t].appendWindowEnd=r,e.h[t].appendWindowStart=i,_l(e,t)},null)),S(h,Promise.all(c),0))})}function ml(e,t,n){var i;return N(function(r){return 1==r.g?(i=Pn,t==i.ta?r.return():(t==i.ga&&(e.za=new Ir),Tl(e,t,function(){return yl(e,t)},null),e.o&&Tl(e,i.X,function(){return yl(e,i.X)},null),S(r,Tl(e,t,function(){return bl(e,t,n)},null),2))):e.o?S(r,Tl(e,i.X,function(){return bl(e,i.X,n)},null),0):r.u(0)})}function vl(e,t,n,i){i<=n?_l(e,t):e.h[t].remove(n,i)}function yl(e,t){var n=e.h[t].appendWindowStart,i=e.h[t].appendWindowEnd;e.h[t].abort(),e.h[t].appendWindowStart=n,e.h[t].appendWindowEnd=i,_l(e,t)}function bl(e,t,n){0>n&&(n+=.001),e.h[t].timestampOffset=n,_l(e,t)}function _l(e,t){if(!e.C){var n=e.l[t][0];n&&(n.p.resolve(),wl(e,t))}}function Tl(e,t,n,i){return ns(e.I),n={start:n,p:new Ir,uri:i},e.l[t].push(n),1==e.l[t].length&&El(e,t),n.p}function Sl(e,t){var n,i,r,s,a,o,l;return N(function(u){switch(u.g){case 1:for(r in ns(e.I),n=[],i={},e.h)i.cd=new Ir,s={start:function(e){return function(){return e.cd.resolve()}}(i),p:i.cd,uri:null},e.l[r].push(s),n.push(i.cd),1==e.l[r].length&&s.start(),i={cd:i.cd};return E(u,2),S(u,Promise.all(n),4);case 4:k(u,3);break;case 2:throw a=A(u),a;case 3:return E(u,5,6),S(u,t(),6);case 6:for(o in I(u),e.h)wl(e,o);C(u,0);break;case 5:throw l=A(u),new It(2,3,3015,l,e.i.error||"No error in the media element",null)}})}function wl(e,t){e.l[t].shift(),El(e,t)}function El(e,t){var n=e.l[t][0];if(n)try{n.start()}catch(i){"QuotaExceededError"==i.name?n.p.reject(new It(2,3,3017,t)):n.p.reject(new It(2,3,3015,i,e.i.error||"No error in the media element",n.uri)),wl(e,t)}}function xl(e,t,n,i,r){var s=null==n,a=e.Da[i];return n=e.da.Xh(),(s=e.A.insertFakeEncryptionInInit&&s&&a)&&(n=Lt(n),s=Ht()||Vt()||Jt()||jt()&&tn()&&n),s&&"mp4"==Hn(e.G[i])&&(t=za(t,r)),t}function kl(e,t,n,i){return Tl(e,t,function(){t!==Ln&&(de()&&(e.j[t]&&(e.j[t].destroy(),delete e.j[t]),i&&(e.j[t]=i),e.h[t].changeType(n+e.A.addExtraFeaturesToSourceBuffer(n)),e.G[t]=n),_l(e,t))},null)}function Al(e,t){var n,i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,w,E,k,A,D;return N(function(R){switch(R.g){case 1:for(o in n=Pn,e.C=!0,e.o=!1,i=e.i.currentTime,r=e.i.autoplay,s=e.i.paused,e.ra&&(e.i.autoplay=!1),x(R,2),e.s.Ra(),a=[],e.j)a.push(e.j[o].destroy());for(l in e.l)for(u=e.l[l],d=u[0],e.l[l]=u.slice(0,1),d&&a.push(d.p.catch(ai)),h=c(u.slice(1)),f=h.next();!f.done;f=h.next())p=f.value,p.p.reject(new It(2,7,7003,void 0));for(g in e.h){m=e.h[g];try{e.m.removeSourceBuffer(m)}catch(e){}}return S(R,Promise.all(a),4);case 4:return e.j={},e.h={},v=e.m.duration,e.L=new Ir,e.m=el(e,e.L),S(R,e.L,5);case 5:!isNaN(v)&&v?e.m.duration=v:!isNaN(e.ea)&&e.ea&&(e.m.duration=e.ea),y=new Ir,b=e.m.sourceBuffers,_=t.size,T=0,w=function(){T++,T===_&&(y.resolve(),e.s.lb(b,"addsourcebuffer",w))},e.s.D(b,"addsourcebuffer",w),E=c(t.keys()),k=E.next();case 6:return k.done?(e.i.currentTime=i,S(R,y,2)):(A=k.value,D=t.get(A),S(R,il(e,A,D,D.codecs),9));case 9:e.o?(e.l[n.X]=[],e.l[n.ga]=[]):e.l[A]=[],k=E.next(),R.u(6);break;case 2:I(R),e.C=!1,ns(e.I),e.s.ha(e.i,"canplaythrough",function(){e.I.g||(e.i.autoplay=r,s||e.i.play())}),C(R,0)}})}function Il(e,t){return Sl(e,function(){return Al(e,t)})}function Cl(e,t,n,i,r){var s,a,o,l,u,c,d,h,f,p,g,m,v,y,b;return N(function(_){return 1==_.g?(s=Pn,t==s.ta?_.return(!1):(a=Gn(qn(e.G[t])),o=zn(e.G[t]),u=!1,c=Fn(n,i),d=e.A.forceTransmux,(!ce(c)||!e.B&&Xn.includes(c))&&(d=!0),d&&(h=Bn(n,i),f=st(h))&&(l=f(),p=Rn(s.X,(i||"").split(",")),g=Rn(s.ga,(i||"").split(",")),p&&g?(u=!0,m=g,t==s.X&&(m=p),c=l.convertCodecs(t,Bn(n,m))):c=l.convertCodecs(t,h)),v=Gn(qn(c)),y=zn(c),a===v&&o===y?(e.j[t]&&!l?(e.j[t].destroy(),delete e.j[t]):!e.j[t]&&l?e.j[t]=l:l&&(e.j[t]&&e.j[t].transmux!=l.transmux?(e.j[t].destroy(),delete e.j[t],e.j[t]=l):l.destroy()),_.return(!1)):(b=!0,(e.o||u&&l&&!e.j[t])&&(b=!1),b&&"smooth"===e.A.codecSwitchingStrategy&&de()?S(_,kl(e,t,c,l),3):(l&&l.destroy(),S(_,Il(e,r),3))))):_.return(!0)})}function Dl(e,t,n,i){if(t==Ln)var r=!1;else{r=Gn(qn(e.G[t]));var s=zn(e.G[t]),a=Fn(n,i),o=e.A.forceTransmux;(!ce(a)||!e.B&&Xn.includes(a))&&(o=!0),n=Bn(n,i),o&&(o=st(n))&&(o=o(),a=o.convertCodecs(t,n),o.destroy()),t=Gn(qn(a)),a=zn(a),r=r!==t||s!==a}return!!r&&("smooth"!==e.A.codecSwitchingStrategy||!de()||e.o)}i=Jo.prototype,i.destroy=function(){return this.I.destroy()},i.init=function(e,t,n,i){t=void 0!==t&&t,n=void 0===n?"UNKNOWN":n,i=void 0!==i&&i;var r,s,a,o,l,u=this;return N(function(d){switch(d.g){case 1:return r=Pn,S(d,u.L,2);case 2:u.B=t,u.aa=n,u.Fa=i,u.Ea=!u.B&&"HLS"==u.aa&&!u.Fa,u.K=null,s=c(e.keys()),a=s.next();case 3:if(a.done){d.u(0);break}return o=a.value,l=e.get(o),S(d,il(u,o,l,l.codecs),6);case 6:u.o?(u.l[r.X]=[],u.l[r.ga]=[]):u.l[o]=[],a=s.next(),d.u(3)}})},i.configure=function(e){this.A=e,this.g&&(this.g.A=e.modifyCueCallback)},i.yb=function(){var e={total:this.C?[]:ao(this.i.buffered),audio:this.C?[]:ao(ul(this,"audio")),video:this.C?[]:ao(ul(this,"video")),text:[]};if(this.g){var t=this.g.g,n=this.g.h;null!=t&&null!=n&&e.text.push({start:t,end:n})}return e},i.remove=function(e,t,n){var i,r=this;return N(function(s){return 1==s.g?(i=Pn,e==i.ta?S(s,r.g.remove(t,n),0):S(s,Tl(r,e,function(){return vl(r,e,t,n)},null),4)):r.o?S(s,Tl(r,i.X,function(){return vl(r,i.X,t,n)},null),0):s.u(0)})},i.flush=function(e){var t,n=this;return N(function(i){return 1==i.g?(t=Pn,e==t.ta?i.return():S(i,Tl(n,e,function(){n.i.currentTime-=.001,_l(n,e)},null),2)):n.o?S(i,Tl(n,t.X,function(){var e=t.X;n.i.currentTime-=.001,_l(n,e)},null),0):i.u(0)})},i.endOfStream=function(e){var t=this;return N(function(n){return S(n,Sl(t,function(){sl(t)||"closed"===t.m.readyState||(e?t.m.endOfStream(e):t.m.endOfStream())}),0)})},i.$a=function(e){var t=this;return N(function(n){return S(n,Sl(t,function(){if(e<t.m.duration)for(var n in t.h){var i={start:function(){},p:new Ir,uri:null};t.l[n].unshift(i)}t.m.duration=e,t.ea=e}),0)})},i.getDuration=function(){return this.m.duration};var Rl=e.URL.createObjectURL,Ml="sequence";function Ll(e,t,n){this.i=e,this.A=t,this.o=this.j=1/0,this.g=1,this.h=this.l=null,this.B=0,this.G=!0,this.H=0,this.C=void 0===n||n,this.F=0,this.s=!1,this.m=e}function Pl(e,t,n){this.j=n,this.l=e,this.s=Ul(e),this.g=e.g.currentTime,this.m=Date.now()/1e3,this.h=!1,this.o=0,this.A=t,this.i=function(){}}function Ol(e,t){e.i=t}function Nl(e){this.g=e}function Ul(e){if(e.g.paused||0==e.g.playbackRate||0==e.g.buffered.length)var t=!1;else e:{t=e.g.currentTime,e=c(ao(e.g.buffered));for(var n=e.next();!n.done;n=e.next())if(n=n.value,!(t<n.start-.1||t>n.end-.5)){t=!0;break e}t=!1}return t}function Fl(e,t,n,i,r){var s=this;this.A=r,this.g=e,this.B=t,this.s=n,this.l=new se,this.j=!1,this.F=e.readyState,this.C=this.i=0,this.h=i,this.o=!1,this.l.D(e,"waiting",function(){return Bl(s)}),this.m=new Ut(function(){Bl(s)}).Sa(this.s.gapJumpTimerTime)}function Bl(e){if(0!=e.g.readyState){if(e.g.seeking){if(!e.j)return}else e.j=!1;if(!e.g.paused||e.g.currentTime==e.i&&(e.g.autoplay||e.g.currentTime!=e.i)){var t;if(e.g.readyState!=e.F&&(e.F=e.g.readyState),!(t=!e.h)){t=e.h;var n=t.l,i=Ul(n),r=n.g.currentTime,s=Date.now()/1e3;t.g==r&&t.s==i||(t.m=s,t.g=r,t.s=i,t.h=!1),r=s-t.m,(i=r>=t.A&&i&&!t.h)&&(t.i(t.g,r),t.h=!0,t.g=n.g.currentTime,t.o++,t.j(new Nr("stalldetected"))),t=!i}t&&(t=e.g.currentTime,n=e.g.buffered,i=so(n,t,e.s.gapDetectionThreshold),null!=i&&(0!=i||e.o))&&(r=n.start(i),(navigator.userAgent.match(/Edge\//)||Vt())&&(r=Math.ceil(100*(r+.01))/100),r>=e.B.Ab()||.001>r-t||(0!=i&&n.end(i-1),e.g.currentTime=r,t==e.i&&(e.i=r),e.C++,e.A(new Nr("gapjumped"))))}}}function jl(e,t,n,i){t==HTMLMediaElement.HAVE_NOTHING||e.readyState>=t?i():(t=Vl.value().get(t),n.ha(e,t,i))}i=Ll.prototype,i.getDuration=function(){return this.j},i.Zh=function(){return this.g},i.mh=function(e){this.i=e},i.$a=function(e){this.j=e},i.di=function(){return this.i},i.kh=function(e){this.B=e},i.wc=function(e){this.G=e},i.Ie=function(e){this.o=e},i.je=function(){return this.o},i.eg=function(e){this.A=e},i.Sh=function(){return this.A},i.$g=function(e,t){if(0!=e.length){var n=(Date.now()+this.B)/1e3;if(e=e.filter(function(e){return e.start+t<n}),0!=e.length){var i=e[e.length-1].end+t;this.ye(e[0].start+t),this.g=e.reduce(function(e,t){return Math.max(e,t.end-t.start)},this.g),this.h=Math.max(this.h,i),null!=this.i&&this.C&&!this.s&&(this.i=n-this.h-this.g)}}},i.Jd=function(e){if(0!=e.length){var t=e[0].startTime,n=e[0].endTime,i=(Date.now()+this.B)/1e3;e=c(e);for(var r=e.next();!r.done;r=e.next())r=r.value,i<r.startTime||(t=Math.min(t,r.startTime),n=Math.max(n,r.endTime),this.g=Math.max(this.g,r.endTime-r.startTime));this.ye(t),this.h=Math.max(this.h,n),null!=this.i&&this.C&&!this.s&&(this.i=i-this.h-this.g)}},i.$h=function(){return this.h},i.re=function(){this.s=!0},i.zi=function(){return this.s},i.lh=function(e){this.m=e},i.Wh=function(){return this.m},i.ye=function(e){this.l=null==this.l?e:Math.min(this.l,e)},i.Pf=function(e){this.g=Math.max(this.g,e)},i.offset=function(e){null!=this.l&&(this.l+=e),null!=this.h&&(this.h+=e)},i.V=function(){return 1/0==this.j&&!this.G},i.qc=function(){return 1/0!=this.j&&!this.G},i.nb=function(){return Math.max(this.H,this.Zb()-this.o)},i.qh=function(e){this.H=e},i.Zb=function(){return this.V()||this.qc()?Math.min(Math.max(0,(Date.now()+this.B)/1e3-this.g-this.i)+this.F,this.j):this.h?Math.min(this.h,this.j):this.j},i.ud=function(e){var t=Math.max(this.l,this.H);return 1/0==this.o?Math.ceil(1e3*t)/1e3:Math.max(t,Math.min(this.Zb()-this.o+e,this.Ab()))},i.Yb=function(){return this.ud(0)},i.Ab=function(){return Math.max(0,this.Zb()-(this.V()||this.qc()?this.A:0))},i.uh=function(){return!(null==this.i||null!=this.h&&this.C)},i.jh=function(e){this.F=e},i.Qh=function(){return this.F},G("shaka.media.PresentationTimeline",Ll),Ll.prototype.getAvailabilityTimeOffset=Ll.prototype.Qh,Ll.prototype.setAvailabilityTimeOffset=Ll.prototype.jh,Ll.prototype.usingPresentationStartTime=Ll.prototype.uh,Ll.prototype.getSeekRangeEnd=Ll.prototype.Ab,Ll.prototype.getSeekRangeStart=Ll.prototype.Yb,Ll.prototype.getSafeSeekRangeStart=Ll.prototype.ud,Ll.prototype.getSegmentAvailabilityEnd=Ll.prototype.Zb,Ll.prototype.setUserSeekStart=Ll.prototype.qh,Ll.prototype.getSegmentAvailabilityStart=Ll.prototype.nb,Ll.prototype.isInProgress=Ll.prototype.qc,Ll.prototype.isLive=Ll.prototype.V,Ll.prototype.offset=Ll.prototype.offset,Ll.prototype.notifyMaxSegmentDuration=Ll.prototype.Pf,Ll.prototype.notifyMinSegmentStartTime=Ll.prototype.ye,Ll.prototype.getInitialProgramDateTime=Ll.prototype.Wh,Ll.prototype.setInitialProgramDateTime=Ll.prototype.lh,Ll.prototype.isStartTimeLocked=Ll.prototype.zi,Ll.prototype.lockStartTime=Ll.prototype.re,Ll.prototype.getMaxSegmentEndTime=Ll.prototype.$h,Ll.prototype.notifySegments=Ll.prototype.Jd,Ll.prototype.notifyTimeRange=Ll.prototype.$g,Ll.prototype.getDelay=Ll.prototype.Sh,Ll.prototype.setDelay=Ll.prototype.eg,Ll.prototype.getSegmentAvailabilityDuration=Ll.prototype.je,Ll.prototype.setSegmentAvailabilityDuration=Ll.prototype.Ie,Ll.prototype.setStatic=Ll.prototype.wc,Ll.prototype.setClockOffset=Ll.prototype.kh,Ll.prototype.getPresentationStartTime=Ll.prototype.di,Ll.prototype.setDuration=Ll.prototype.$a,Ll.prototype.setPresentationStartTime=Ll.prototype.mh,Ll.prototype.getMaxSegmentDuration=Ll.prototype.Zh,Ll.prototype.getDuration=Ll.prototype.getDuration,Pl.prototype.release=function(){this.j=this.l=null,this.i=function(){}},Fl.prototype.release=function(){this.l&&(this.l.release(),this.l=null),null!=this.m&&(this.m.stop(),this.m=null),this.h&&(this.h.release(),this.h=null),this.g=this.B=this.A=null},Fl.prototype.Sf=function(){this.o=!0,Bl(this)};var Vl=new Dt(function(){return new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]])});function Hl(e,t,n,i){var r=this;this.g=e,this.m=t,this.s=n,this.l=null,this.j=function(){return null==r.l&&(r.l=i()),r.l},this.o=!1,this.h=new se,this.i=new Wl(e),jl(this.g,HTMLMediaElement.HAVE_METADATA,this.h,function(){zl(r,r.j())})}function $l(e){return e.o?e.g.currentTime:e.j()}function Gl(e,t){0<e.g.readyState?Kl(e.i,t):jl(e.g,HTMLMediaElement.HAVE_METADATA,e.h,function(){zl(e,e.j())})}function zl(e,t){.001>Math.abs(e.g.currentTime-t)?ql(e):(e.h.ha(e.g,"seeking",function(){ql(e)}),Kl(e.i,e.g.currentTime&&0!=e.g.currentTime?e.g.currentTime:t))}function ql(e){e.o=!0,e.h.D(e.g,"seeking",function(){return e.m()}),e.s(e.g.currentTime)}function Wl(e){var t=this;this.h=e,this.m=10,this.l=this.j=this.i=0,this.g=new Ut(function(){0>=t.i?t.g.stop():t.h.currentTime!=t.j?t.g.stop():(t.h.currentTime=t.l,t.i--)})}function Kl(e,t){e.j=e.h.currentTime,e.l=t,e.i=e.m,e.h.currentTime=t,e.g.Sa(.1)}function Yl(e){this.h=e,this.j=!1,this.g=null,this.i=new se}function Xl(e,t,n,i,r,s){var a=this;this.i=e,this.g=t.presentationTimeline,this.B=t.minBufferTime||0,this.l=n,this.A=r,this.s=null,this.o=eu(e,n,s),this.j=new Fl(e,t.presentationTimeline,n,this.o,s),this.h=new Hl(e,function(){e:{var e=a.j;e.j=!0,e.o=!1;var t=$l(a.h);if(e=Zl(a,t),.001<Math.abs(e-t)){if(t=!1,!Wt()||Wt()&&nn())t=!0;else{var n=Date.now()/1e3;(!a.s||a.s<n-1)&&(a.s=n,t=!0)}if(t){Gl(a.h,e),e=void 0;break e}}a.A(),e=void 0}return e},function(e){var t=a.j;t.g.seeking&&!t.j&&(t.j=!0,t.i=e)},function(){var e=i;return null==e?e=1/0>a.g.getDuration()?a.g.Yb():a.g.Ab():0>e&&(e=a.g.Ab()+e),Ql(a,Jl(a,e))}),this.m=new Ut(function(){if(0!=a.i.readyState&&!a.i.paused){var e=$l(a.h),t=a.g.Yb(),n=a.g.Ab();3>n-t&&(t=n-3),e<t&&(e=Zl(a,e),a.i.currentTime=e)}})}function Ql(e,t){var n=e.g.getDuration();return t>=n?n-e.l.durationBackoff:t}function Zl(e,t){var n=Math.max(e.B,e.l.rebufferingGoal),i=e.l.safeSeekOffset,r=e.g.Yb(),s=e.g.Ab(),a=e.g.getDuration();3>s-r&&(r=s-3);var o=e.g.ud(n),l=e.g.ud(i);return n=e.g.ud(n+i),t>=a?Ql(e,t):t>s?s:t<r?io(e.i.buffered,l)?l:n:t>=o||io(e.i.buffered,t)?t:n}function Jl(e,t){var n=e.g.Yb();return t<n?n:(e=e.g.Ab(),t>e?e:t)}function eu(e,t,n){if(!t.stallEnabled)return null;var i=t.stallSkip;return t=new Pl(new Nl(e),t.stallThreshold,n),Ol(t,function(){i?e.currentTime+=i:(e.pause(),e.play())}),t}function tu(e){this.O=e,this.l=null,this.i=0,this.m=!1}function nu(e,t,n){return e=new Qa(e,e+t,function(){return n},0,null,null,e,e,e+t),new tu([e])}function iu(e,t,n,i){this.i=e,this.h=t,this.g=n,this.reverse=i}function ru(){tu.call(this,[]),this.g=[]}function su(e){var t=this;this.g=e,this.j=!1,this.i=this.g.ie(),this.h=new Ut(function(){t.g.Yg(.25*t.i)})}function au(e){e.h.stop();var t=e.j?0:e.i;if(0<=t)try{return void(e.g.ie()!=t&&e.g.hg(t))}catch(e){}e.h.Sa(.25),0!=e.g.ie()&&e.g.hg(0)}function ou(e){var t=this;this.h=e,this.g=new Set,this.i=new Ut(function(){lu(t,!1)}).Sa(.25)}function lu(e,t){for(var n=c(e.g),i=n.next();!i.done;i=n.next())i.value.j(e.h.currentTime,t)}function uu(){this.g=null,this.h=[]}function cu(e,t){var n=0;e.g&&e.g.state==t&&(n+=e.g.duration),e=c(e.h);for(var i=e.next();!i.done;i=e.next())i=i.value,n+=i.state==t?i.duration:0;return n}function du(e){function t(e){return{timestamp:e.timestamp,state:e.state,duration:e.duration}}for(var n=[],i=c(e.h),r=i.next();!r.done;r=i.next())n.push(t(r.value));return e.g&&n.push(t(e.g)),n}function hu(){this.i=this.h=null,this.g=[]}function fu(e,t,n){e.i!=t&&(e.i=t,e.g.push({timestamp:Date.now()/1e3,id:t.id,type:"text",fromAdaptation:n,bandwidth:null}))}function pu(){this.ae=this.Ug=this.A=this.B=this.I=this.C=this.s=this.j=this.H=this.m=this.i=this.U=this.Z=this.L=this.N=this.R=this.l=this.o=NaN,this.K=0,this.F=this.G=NaN,this.g=new uu,this.h=new hu}function gu(e,t,n,i){this.m=e,this.i=t,this.l=n,this.h=new Map,this.j=new Map,this.g=null,this.o=i}function mu(e,t){e.l=t,e=c(e.h.values());for(var n=e.next();!n.done;n=e.next())n.value.g=t}function vu(e,t,n){if(n=void 0!==n&&n,e.i.segmentIndex&&(e.g||(e.g=e.i.segmentIndex.Kb(t,!0,e.o)),e.g)){for(n&&e.g.next();e.h.size<e.m;){if(t=e.g.next().value,!t)break;if(n=!0,t.preload&&null!=t.sa&&(n=!1),2==t.ac()&&(n=!1),n&&t.$&&yu(e,t.$),n&&!e.h.has(t)&&(n=new xu(e.l),ku(n,t,e.i),e.h.set(t,n)),e.i.fastSwitching&&t.Kd&&t.pe)break}Tu(e)}}function yu(e,t){if(e.i.segmentIndex&&!Array.from(e.j.keys()).some(function(e){return Xa(e,t)})){var n=new xu(e.l);ku(n,t,e.i),e.j.set(t,n)}}function bu(e,t){t=c(t.keys());for(var n=t.next();!n.done;n=t.next())(n=n.value)&&Eu(e,n)}function _u(e){bu(e,e.h),bu(e,e.j),e.g=null}function Tu(e){for(var t=Array.from(e.h.keys()),n={},i=c(e.j.keys()),r=i.next();!r.done;n={Vd:n.Vd},r=i.next())n.Vd=r.value,t.some(function(e){return function(t){return Xa(t.$,e.Vd)}}(n))||Eu(e,n.Vd)}function Su(e,t){e.m=t;for(var n=Array.from(e.h.keys());n.length>t;){var i=n.pop();i&&Eu(e,i)}Tu(e)}function wu(e,t){t&&t!==e.i&&(_u(e),e.i=t)}function Eu(e,t){var n=e.h;t instanceof Ya&&(n=e.j),e=n.get(t),n.delete(t),e&&e.abort()}function xu(e){this.g=e,this.Be=this.ig=null}function ku(e,t,n){var i=new Uint8Array(0);e.Be=e.g(t,n,function(t){return N(function(n){if(1==n.g)return i=0<i.byteLength?kn(i,t):t,e.ig?S(n,e.ig(i),3):n.u(0);i=new Uint8Array(0),w(n)})})}function Au(e){Br.call(this);var t=this;this.g=new Set,this.i=e,this.h=new Ut(function(){for(var e=t.i(),n=c(t.g),i=n.next();!i.done;i=n.next())i=i.value,i.endTime<e.start&&(t.g.delete(i),i=new Nr("regionremove",new Map([["region",i]])),t.dispatchEvent(i))}).Sa(2)}function Iu(e){Br.call(this),this.g=new Map,this.h=e}function Cu(e,t){var n=e.g.get(t);return n||(n={Md:[],kf:null,contentType:t},e.g.set(t,n)),n}function Du(e,t,n){var i=Cu(e,t.contentType);Mu(e,i),e={Lc:t,position:n},i=i.Md,t=i.findIndex(function(e){return e.position>=n}),0<=t?i.splice(t,i[t].position==n?1:0,e):i.push(e)}function Ru(e,t,n){return!!((e=e.h()[n])&&0<e.length&&(n=e[e.length-1].end,t>=e[0].start&&t<n))}function Mu(e,t){if((e=e.h()[t.contentType])&&0<e.length){var n=e[0].start,i=e[e.length-1].end,r=t.Md;t.Md=r.filter(function(e,t){return!(e.position<=n&&t+1<r.length&&r[t+1].position<=n||e.position>=i)})}else t.Md=[]}function Lu(e){var t={bandwidth:e.bandwidth||0,audioSamplingRate:null,codecs:e.codecs,contentType:e.type,frameRate:null,height:null,mimeType:e.mimeType,channelsCount:null,pixelAspectRatio:null,width:null,label:null,roles:e.roles,language:null};return"video"==e.type&&(t.frameRate=e.frameRate||null,t.height=e.height||null,t.pixelAspectRatio=e.pixelAspectRatio||null,t.width=e.width||null),"audio"==e.type&&(t.audioSamplingRate=e.audioSamplingRate,t.channelsCount=e.channelsCount,t.label=e.label||null,t.language=e.language),t}function Pu(e){var t=zn(e),n=t.split("/")[0];return e=qn(e),{type:n,mimeType:t,codecs:e,language:null,height:null,width:null,channelCount:null,sampleRate:null,closedCaptions:new Map,Qd:null,colorGamut:null}}function Ou(e,t){function n(e){s=e.name;var t=e.reader;t.skip(24);var n=t.ka(),i=t.ka();t.skip(50),f=String(n),h=String(i),e.reader.oa()&&ds(e)}function i(e){var t=bo(e.reader);p=t.channelCount,g=t.sampleRate,r(e.name)}function r(e){switch(e=e.toLowerCase(),e){case"avc1":case"avc3":o.push(e+".42E01E"),u=!0;break;case"hev1":case"hvc1":o.push(e+".1.6.L93.90"),u=!0;break;case"dvh1":case"dvhe":o.push(e+".05.04"),u=!0;break;case"vp09":o.push(e+".00.10.08"),u=!0;break;case"av01":o.push(e+".0.01M.08"),u=!0;break;case"mp4a":a.push("mp4a.40.2"),l=!0;break;case"ac-3":case"ec-3":case"ac-4":case"opus":case"flac":a.push(e),l=!0}}var s,a=[],o=[],l=!1,u=!1,d=null,h=null,f=null,p=null,g=null,m=null,v=null;if((new cs).box("moov",ds).box("trak",ds).box("mdia",ds).S("mdhd",function(e){d=vo(e.reader,e.version).language}).box("minf",ds).box("stbl",ds).S("stsd",hs).box("mp4a",function(e){var t=bo(e.reader);p=t.channelCount,g=t.sampleRate,e.reader.oa()?ds(e):r(e.name)}).box("esds",function(e){e=e.reader;for(var t,n,i="mp4a";e.oa();){t=e.T();for(var r=e.T();128&r;)r=e.T();if(3==t)e.ka(),r=e.T(),128&r&&e.ka(),64&r&&e.skip(e.T()),32&r&&e.ka();else if(4==t)n=e.T(),e.skip(12);else if(5==t)break}n&&(i+="."+So(n),5==t&&e.oa()&&(t=e.T(),n=(248&t)>>3,31===n&&e.oa()&&(n=32+((7&t)<<3)+((224&e.T())>>5)),i+="."+n)),a.push(i),l=!0}).box("ac-3",i).box("ec-3",i).box("ac-4",i).box("Opus",i).box("fLaC",i).box("avc1",n).box("avc3",n).box("hev1",n).box("hvc1",n).box("dva1",n).box("dvav",n).box("dvh1",n).box("dvhe",n).box("vp09",n).box("av01",n).box("avcC",function(e){var t=s||"";switch(s){case"dvav":t="avc3";break;case"dva1":t="avc1"}e=e.reader,e.skip(1),e=t+"."+So(e.T())+So(e.T())+So(e.T()),o.push(e),u=!0}).box("hvcC",function(e){var t=s||"";switch(s){case"dvh1":t="hvc1";break;case"dvhe":t="hev1"}var n=e.reader;n.skip(1),e=n.T();var i=["","A","B","C"][e>>6],r=31&e,a=n.P(),l=(32&e)>>5?"H":"L";e=[n.T(),n.T(),n.T(),n.T(),n.T(),n.T()],n=n.T();for(var c=0,d=0;32>d;d++){if(c|=1&a,31==d)break;c<<=1,a>>=1}for(t=t+"."+i+r+"."+So(c,!0),t+="."+l+n,i="",r=e.length;r--;)((l=e[r])||i)&&(i="."+l.toString(16).toUpperCase()+i);t+=i,o.push(t),u=!0}).box("dvcC",function(e){var t=s||"";switch(s){case"hvc1":t="dvh1";break;case"hev1":t="dvhe";break;case"avc1":t="dva1";break;case"avc3":t="dvav";break;case"av01":t="dav1"}var n=e.reader;n.skip(2),e=n.T(),n=n.T(),o.push(t+"."+wo(e>>1&127)+"."+wo(e<<5&32|n>>3&31)),u=!0}).box("dvvC",function(e){var t=s||"";switch(s){case"hvc1":t="dvh1";break;case"hev1":t="dvhe";break;case"avc1":t="dva1";break;case"avc3":t="dvav";break;case"av01":t="dav1"}var n=e.reader;n.skip(2),e=n.T(),n=n.T(),o.push(t+"."+wo(e>>1&127)+"."+wo(e<<5&32|n>>3&31)),u=!0}).S("vpcC",function(e){var t=s||"",n=e.reader;e=n.T();var i=n.T();n=n.T()>>4&15,o.push(t+"."+wo(e)+"."+wo(i)+"."+wo(n)),u=!0}).box("av1C",function(e){var t=s||"";switch(s){case"dav1":t="av01"}var n=e.reader;n.skip(1),e=n.T(),n=n.T();var i=e>>>5,r=(64&n)>>6;o.push(t+"."+i+"."+wo(31&e)+(n>>>7?"H":"M")+"."+wo(2===i&&r?(32&n)>>5?12:10:r?10:8)+"."+((16&n)>>4)+"."+((8&n)>>3)+((4&n)>>2)+(3&n)+"."+wo(1)+"."+wo(1)+"."+wo(1)+".0"),u=!0}).box("enca",ps).box("encv",fs).box("sinf",ds).box("frma",function(e){e=_o(e.reader).Na,r(e)}).box("colr",function(e){o=o.map(function(t){if(t.startsWith("av01.")){var n=e.reader,i=n.ua(),r=n.rb(4),s=String.fromCharCode(r[0]);if(s+=String.fromCharCode(r[1]),s+=String.fromCharCode(r[2]),s+=String.fromCharCode(r[3]),"nclx"===s){r=n.ka(),s=n.ka();var a=n.ka(),o=n.T()>>7,l=t.split(".");10==l.length&&(l[6]=wo(r),l[7]=wo(s),l[8]=wo(a),l[9]=String(o),t=l.join("."))}n.seek(i)}return t});var t=To(e.reader),n=t.colorGamut;m=t.Qd,v=n}).parse(e||t,!0),!a.length&&!o.length)return null;var y=l&&!u,b=new Map;if(u){var _=new Ce("video/mp4");for(e&&_.init(e),_.i(t),e=c(_.j()),t=e.next();!t.done;t=e.next())t=t.value,b.set(t,t);_.g()}return{type:y?"audio":"video",mimeType:y?"audio/mp4":"video/mp4",codecs:Nu(a.concat(o)).join(", "),language:d,height:h,width:f,channelCount:p,sampleRate:g,closedCaptions:b,Qd:m,colorGamut:v}}function Nu(e){var t=new Set,n=[];e=c(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;var r=Gn(i);t.has(r)||(n.push(i),t.add(r))}return t=Mn("audio",n),i=Mn("video",n),e=Mn(Ln,n),i=Uu(i),t=t.concat(i).concat(e),n.length&&!t.length?n:t}function Uu(e){if(1>=e.length)return e;var t=e.find(function(e){return e.startsWith("dvh1.")||e.startsWith("dvhe.")||e.startsWith("dav1.")});return t?ce('video/mp4; codecs="'+t+'"')?[t]:e.filter(function(e){return e!=t}):e}function Fu(e){var t=null;return(new cs).box("moov",ds).box("trak",ds).box("mdia",ds).box("minf",ds).box("stbl",ds).S("stsd",hs).box("encv",fs).box("enca",ps).box("sinf",ds).box("schi",ds).S("tenc",function(e){e=e.reader,e.T(),e.T(),e.T(),e.T(),t=xn(e.rb(16))}).parse(e,!0),t}function Bu(t,n,i){var r,s,a,o,l;return N(function(u){if(1==u.g)return r=n,r.cryptoKey?u.u(2):S(u,r.fetchKey(),3);if(s=r.iv,!s)for(s=Ee(new ArrayBuffer(16)),a=r.firstMediaSequenceNumber+i,o=s.byteLength-1;0<=o;o--)s[o]=255&a,a>>=8;return l="CBC"==n.blockCipherMode?{name:"AES-CBC",iv:s}:{name:"AES-CTR",counter:s,length:64},u.return(e.crypto.subtle.decrypt(l,r.cryptoKey,t))})}function ju(e,t,n,i,r){return e=zr(e,i,r),0==t&&null==n||(e.headers.Range=n?"bytes="+t+"-"+n:"bytes="+t+"-"),e}function Vu(e,t){var n=this;this.g=t,this.l=e,this.h=null,this.B=1,this.s=this.j=null,this.H=0,this.F=!1,this.i=new Map,this.C=!1,this.I=null,this.A=!1,this.m=new ts(function(){return Hu(n)}),this.K=Date.now()/1e3,this.o=new Map,this.G={projection:null,hfov:null},this.N=0,this.L=1/0}function Hu(e){var t,n,i,r,s,a,o;return N(function(l){if(1==l.g){for(t=[],n=c(e.i.values()),i=n.next();!i.done;i=n.next())r=i.value,vc(r),t.push(yc(r)),r.W&&(_u(r.W),r.W=null);for(s=c(e.o.values()),a=s.next();!a.done;a=s.next())o=a.value,_u(o);return S(l,Promise.all(t),2)}e.i.clear(),e.o.clear(),e.g=null,e.l=null,e.h=null,w(l)})}function $u(e,t,n){e.l.presentationTimeline.V()||(e.N=t,e.L=n)}function Gu(e,t){var n,i,r,s,a,o;N(function(l){switch(l.g){case 1:return n=Pn,e.H++,i=e.H,E(l,2),S(l,pl(e.g.ca,n.ta),4);case 4:k(l,3);break;case 2:r=A(l),e.g&&e.g.onError(r);case 3:s=Fn(t.mimeType,t.codecs),rl(e.g.ca,s,e.l.sequenceMode,t.external),a=e.g.ca.F,(a.isTextVisible()||e.h.alwaysStreamText)&&e.H==i&&(o=Ju(e,t),e.i.set(n.ta,o),mc(e,o,0)),w(l)}})}function zu(e){var t=e.i.get(Ln);t&&(vc(t),yc(t).catch(function(){}),e.i.delete(Ln)),e.s=null}function qu(e,t){for(var n=0>e.g.fb(),i=c(e.i.values()),r=i.next();!r.done;r=i.next())r=r.value,r.ia&&r.ia.Uc(n),r.W&&r.W.Uc(n);for(i=c(e.o.values()),r=i.next();!r.done;r=i.next())r.value.Uc(n);(n=e.i.get("video"))&&(i=n.stream)&&(t?(t=i.trickModeVideo)&&!n.vc&&(Yu(e,t,!1,0,!1),n.vc=i):(t=n.vc)&&(n.vc=null,Yu(e,t,!0,0,!1)))}function Wu(e,t,n,i,r,s){n=void 0!==n&&n,i=void 0===i?0:i,r=void 0!==r&&r,s=void 0!==s&&s,e.j=t,e.C&&(t.video&&Yu(e,t.video,n,i,r,s),t.audio&&Yu(e,t.audio,n,i,r,s))}function Ku(e,t){N(function(n){if(1==n.g)return e.s=t,e.C?t.segmentIndex?n.u(2):S(n,t.createSegmentIndex(),2):n.return();Yu(e,t,!0,0,!1),w(n)})}function Yu(e,t,n,i,r,s){var a=e.i.get(t.type);a||t.type!=Ln?a&&(a.vc&&(t.trickModeVideo?(a.vc=t,t=t.trickModeVideo):a.vc=null),a.stream!=t||r)&&(e.o.has(t)?a.W=e.o.get(t):a.W&&wu(a.W,t),t.type==Ln&&(r=Fn(t.mimeType,t.codecs),rl(e.g.ca,r,e.l.sequenceMode,t.external)),e.o.has(a.stream)||a.stream.closeSegmentIndex&&a.stream.closeSegmentIndex(),a.stream=t,a.ia=null,a.wg=!!s,n?a.nd?a.Oe=!0:a.Qa?(a.ec=!0,a.ee=i,a.Oe=!0):(vc(a),gc(e,a,!0,i).catch(function(t){e.g&&e.g.onError(t)})):a.Qa||a.ub||mc(e,a,0),Xu(e,a).catch(function(t){e.g&&e.g.onError(t)})):Gu(e,t)}function Xu(e,t){var n,i;return N(function(r){if(1==r.g)return t.kb?(n=t.stream,i=t.kb,n.segmentIndex?r.u(2):S(r,n.createSegmentIndex(),2)):r.return();if(t.kb!=i||t.stream!=n)return r.return();var s=e.g.he(),a=ol(e.g.ca,t.type),o=t.stream.segmentIndex.find(t.Ya?t.Ya.endTime:s),l=null==o?null:t.stream.segmentIndex.get(o);o=l&&l.sa?l.sa-l.Ha:null,l&&!o&&(o=(l.endTime-l.getStartTime())*(t.stream.bandwidth||0)/8),o?((l=l.$)&&(o+=(l.sa?l.sa-l.Ha:null)||0),l=e.g.getBandwidthEstimate(),s=8*o/l<(a||0)-s-Math.max(e.l.minBufferTime||0,e.h.rebufferingGoal)||t.kb.h.g>o):s=!1,s&&t.kb.abort(),w(r)})}function Qu(e,t){t.nd||t.ec||(t.Qa?(t.ec=!0,t.ee=0):null==al(e.g.ca,t.type)?null==t.ub&&mc(e,t,0):(vc(t),gc(e,t,!1,0).catch(function(t){e.g&&e.g.onError(t)})))}function Zu(e,t){var n,i,r,s,a,o,l,u,d,h;return N(function(f){if(1==f.g){if(n=Pn,!e.j)throw new It(2,5,5006);return i=new Map,r=new Set,e.j.audio&&(i.set(n.X,e.j.audio),r.add(e.j.audio)),e.j.video&&(i.set(n.ga,e.j.video),r.add(e.j.video)),e.s&&(i.set(n.ta,e.s),r.add(e.s)),s=e.g.ca,S(f,s.init(i,e.l.sequenceMode,e.l.type,e.l.ignoreManifestTimestampsInSegmentsMode),2)}for(ns(e.m),e.updateDuration(),a=c(i.keys()),o=a.next();!o.done;o=a.next())l=o.value,u=i.get(l),e.i.has(l)||(d=Ju(e,u),t.has(u.id)&&(h=t.get(u.id),mu(h,function(t,n,i){return pc(t,n,i||null,e.h.retryParameters,e.g.Nb)}),d.W=h),e.i.set(l,d),mc(e,d,0));w(f)})}function Ju(e,t){return{stream:t,type:t.type,ia:null,W:ec(e,t),Ya:null,Kc:null,qe:null,oe:null,ne:null,vc:null,endOfStream:!1,Qa:!1,ub:null,ec:!1,ee:0,Oe:!1,nd:!1,Nd:!0,Yf:!1,yd:!1,kb:null}}function ec(e,t){if("video"===t.type&&e.h.disableVideoPrefetch||"audio"===t.type&&e.h.disableAudioPrefetch||t.type===Ln&&("application/cea-608"==t.mimeType||"application/cea-708"==t.mimeType)||t.type===Ln&&e.h.disableTextPrefetch)return null;if(e.o.has(t))return e.o.get(t);var n=e.i.get(t.type);return(n=n&&n.W)&&t===n.i?n:0<e.h.segmentPrefetchLimit?new gu(e.h.segmentPrefetchLimit,t,function(t,n,i){return pc(t,n,i||null,e.h.retryParameters,e.g.Nb)},0>e.g.fb()):null}function tc(e){for(var t=e.h.segmentPrefetchLimit,n=e.h.prefetchAudioLanguages,i={},r=c(e.l.variants),s=r.next();!s.done;i={Ta:i.Ta},s=r.next())if(i.Ta=s.value,i.Ta.audio)if(e.o.has(i.Ta.audio)){if(s=e.o.get(i.Ta.audio),Su(s,t),!(0<t&&n.some(function(e){return function(t){return ui(e.Ta.audio.language,t)}}(i)))){var a=e.i.get(i.Ta.audio.type);s!==(a&&a.W)&&_u(s),e.o.delete(i.Ta.audio)}}else 0>=t||!n.some(function(e){return function(t){return ui(e.Ta.audio.language,t)}}(i))||!(s=ec(e,i.Ta.audio))||(i.Ta.audio.segmentIndex||i.Ta.audio.createSegmentIndex(),e.o.set(i.Ta.audio,s))}function nc(e,t){var n,i,r,s,a,o;return N(function(l){switch(l.g){case 1:if(ns(e.m),t.Qa||null==t.ub||t.nd)return l.return();if(t.ub=null,!t.ec){l.u(2);break}return S(l,gc(e,t,t.Oe,t.ee),3);case 3:return l.return();case 2:if(t.stream.segmentIndex){l.u(4);break}return n=t.stream,E(l,5),S(l,t.stream.createSegmentIndex(),7);case 7:k(l,6);break;case 5:return i=A(l),S(l,bc(e,t,i),8);case 8:return l.return();case 6:if(n!=t.stream)return n.closeSegmentIndex&&n.closeSegmentIndex(),t.Qa||t.ub||mc(e,t,0),l.return();case 4:E(l,9),r=ic(e,t),null!=r&&(mc(e,t,r),t.yd=!1),k(l,10);break;case 9:return s=A(l),S(l,bc(e,t,s),11);case 11:return l.return();case 10:if(a=Array.from(e.i.values()),!e.C||!a.every(function(e){return e.endOfStream})){l.u(0);break}return S(l,e.g.ca.endOfStream(),13);case 13:ns(e.m),o=e.g.ca.getDuration(),0!=o&&o<e.l.presentationTimeline.getDuration()&&e.l.presentationTimeline.$a(o),w(l)}})}function ic(e,t){if(hc(t))return hl(e.g.ca,t.stream.originalId||""),null;if(t.type==Ln&&fl(e.g.ca),!e.g.ca.xa&&t.type!=Ln)return e.h.updateIntervalSeconds/2;var n=e.g.he();if("audio"===t.type)for(var i=c(e.o.keys()),r=i.next();!r.done;r=i.next())r=e.o.get(r.value),r.Oa(n,!0),vu(r,n);i=t.Ya?t.Ya.endTime:n,r=ll(e.g.ca,t.type,n);var s=Math.max(1,Math.max(e.l.minBufferTime||0,e.h.rebufferingGoal,e.h.bufferingGoal)*e.B),a=e.l.presentationTimeline.getDuration()-i,o=ol(e.g.ca,t.type);if(1e-6>a&&o)return t.endOfStream=!0,"video"==t.type&&(e=e.i.get(Ln))&&hc(e)&&(e.endOfStream=!0),null;if(t.endOfStream=!1,r>=s)return e.h.updateIntervalSeconds/2;if(r=rc(e,t,n,o),!r)return e.h.updateIntervalSeconds;for(s=1/0,a=Array.from(e.i.values()),a=c(a),o=a.next();!o.done;o=a.next())o=o.value,hc(o)||o.ia&&!o.ia.current()||(s=Math.min(s,o.Ya?o.Ya.endTime:n));return i>=s+e.l.presentationTimeline.g?e.h.updateIntervalSeconds:(t.W&&t.ia&&!e.o.has(t.stream)&&(t.W.Oa(r.startTime),vu(t.W,r.startTime)),sc(e,t,n,r).catch(function(){}),null)}function rc(e,t,n,i){if(t.ia)return t.ia.current();if(t.Ya||i)return t.ia=t.stream.segmentIndex.Kb(t.Ya?t.Ya.endTime:i,!1,0>e.g.fb()),t.ia&&t.ia.next().value;i=e.h.inaccurateManifestTolerance;var r=Math.max(n-i,0);e=0>e.g.fb();var s=null;return i&&(t.ia=t.stream.segmentIndex.Kb(r,!1,e),s=t.ia&&t.ia.next().value),s||(t.ia=t.stream.segmentIndex.Kb(n,!1,e),s=t.ia&&t.ia.next().value),s}function sc(t,n,i,r){var s,a,o,l,u,c,d,h,f,p,g,m,v,y,b,_;return N(function(T){switch(T.g){case 1:if(s=Pn,a=n.stream,o=n.ia,n.Qa=!0,E(T,2),2==r.ac())throw new It(1,1,1011);return S(T,lc(t,n,r),4);case 4:return ns(t.m),t.A?T.return():(l="video/mp4"==a.mimeType||"audio/mp4"==a.mimeType,u=e.ReadableStream,t.h.lowLatencyMode&&t.l.isLowLatency&&u&&l&&("HLS"!=t.l.type||r.m)?(h=new Uint8Array(0),p=f=!1,m=function(e){var s,o,l;return N(function(u){switch(u.g){case 1:if(f)return u.return();if(p=!0,ns(t.m),t.A)return u.return();if(E(u,2),h=ac(h,e),s=!1,o=0,(new cs).box("mdat",function(e){o=e.size+e.start,s=!0}).parse(h,!1,!0),!s){u.u(4);break}return l=h.subarray(0,o),h=h.subarray(o),S(u,cc(t,n,i,a,r,l,!0),5);case 5:n.W&&n.ia&&vu(n.W,r.startTime,!0);case 4:k(u,0);break;case 2:g=A(u),w(u)}})},S(T,fc(t,n,r,m),9)):(c=fc(t,n,r),S(T,c,7)));case 7:return d=T.h,ns(t.m),t.A?T.return():(ns(t.m),n.ec?(n.Qa=!1,mc(t,n,0),T.return()):S(T,cc(t,n,i,a,r,d),6));case 9:if(v=T.h,g)throw g;if(p){T.u(10);break}return f=!0,ns(t.m),t.A?T.return():n.ec?(n.Qa=!1,mc(t,n,0),T.return()):S(T,cc(t,n,i,a,r,v),10);case 10:n.W&&n.ia&&vu(n.W,r.startTime,!0);case 6:if(ns(t.m),t.A)return T.return();n.Ya=r,o.next(),n.Qa=!1,n.Yf=!1,y=t.g.ca.yb(),b=y[n.type],te(JSON.stringify(b)),n.ec||t.g.Sf(r,n.stream),mc(t,n,0),k(T,0);break;case 2:if(_=A(T),ns(t.m,_),t.A)return T.return();if(n.Qa=!1,7001==_.code)n.Qa=!1,vc(n),mc(t,n,0),T.u(0);else if(n.type==s.ta&&t.h.ignoreTextStreamFailures)t.i.delete(s.ta),T.u(0);else{if(3017!=_.code)return n.yd=!0,1==_.category&&n.W&&Eu(n.W,r),_.severity=2,S(T,bc(t,n,_),0);oc(t,n,_),T.u(0)}}})}function ac(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function oc(e,t,n){if(!Array.from(e.i.values()).some(function(e){return e!=t&&e.Yf})){if(e.g.disableStream(t.stream,e.h.maxDisabledTime))return;var i=Math.round(100*e.B);if(20<i)e.B-=.2;else{if(!(4<i))return t.yd=!0,e.A=!0,void e.g.onError(n);e.B-=.04}t.Yf=!0}mc(e,t,4)}function lc(e,t,n){var i,r,s,a,o,l,u,c,d,h,f,p;return N(function(g){switch(g.g){case 1:if(i=Pn,r=[],s=Math.max(0,Math.max(n.appendWindowStart,e.N)-.1),a=Math.min(n.appendWindowEnd,e.L)+.01,o=Gn(n.codecs||t.stream.codecs),l=zn(n.mimeType||t.stream.mimeType),u=n.timestampOffset,u==t.qe&&s==t.oe&&a==t.ne&&o==t.Lf&&l==t.Mf){g.u(2);break}if(c=t.Lf&&t.Mf&&Dl(e.g.ca,t.type,l,o),!c){g.u(3);break}if(d=null,t.type===i.ga?d=e.i.get(i.X):t.type===i.X&&(d=e.i.get(i.ga)),!d){g.u(3);break}return S(g,yc(d).catch(function(){}),5);case 5:d.Kc=null,Qu(e,d);case 3:return S(g,uc(e,t,u,s,a,n,o,l),2);case 2:return Xa(n.$,t.Kc)||(t.Kc=n.$,n.l&&n.$&&(h=fc(e,t,n.$),f=function(){var r,s,a,o,l,u,c;return N(function(d){switch(d.g){case 1:return E(d,2),S(d,h,4);case 4:return r=d.h,ns(e.m),s=null,a=new Map,o={projection:null,hfov:null},l=new cs,l.box("moov",ds).box("trak",ds).box("mdia",ds).S("mdhd",function(e){s=vo(e.reader,e.version).timescale}).box("hdlr",function(e){switch(e=e.reader,e.skip(8),e.tc()){case"soun":a.set(i.X,s);break;case"vide":a.set(i.ga,s)}s=null}).box("minf",ds).box("stbl",ds).S("stsd",hs).box("encv",fs).box("avc1",fs).box("avc3",fs).box("hev1",fs).box("hvc1",fs).box("dvav",fs).box("dva1",fs).box("dvh1",fs).box("dvhe",fs).box("vexu",ds).box("proj",ds).S("prji",function(e){e=e.reader.tc(),o.projection=e}).box("hfov",function(e){e=e.reader.P()/1e3,o.hfov=e}).parse(r),Tc(e,o),a.has(t.type)?n.$.timescale=a.get(t.type):null!=s&&(n.$.timescale=s),u=t.stream.closedCaptions&&0<t.stream.closedCaptions.size,S(d,e.g.yg(t.type,r),5);case 5:return S(d,dl(e.g.ca,t.type,r,null,t.stream,u),6);case 6:k(d,0);break;case 2:throw c=A(d),t.Kc=null,c}})},e.g.Hi(n.startTime,n.$),r.push(f()))),e.l.sequenceMode&&(p=t.Ya?t.Ya.i:null,n.i!=p&&r.push(ml(e.g.ca,t.type,n.startTime))),S(g,Promise.all(r),0)}})}function uc(e,t,n,i,r,s,a,o){var l,u,c,d;return N(function(h){if(1==h.g)return l=Pn,u=new Map,e.j.audio&&u.set(l.X,e.j.audio),e.j.video&&u.set(l.ga,e.j.video),E(h,2),t.oe=i,t.ne=r,a&&(t.Lf=a),o&&(t.Mf=o),t.qe=n,c=e.l.sequenceMode||"HLS"==e.l.type,S(h,gl(e.g.ca,t.type,n,i,r,c,s.mimeType||t.stream.mimeType,s.codecs||t.stream.codecs,u),4);if(2!=h.g)return k(h,0);throw d=A(h),t.oe=null,t.ne=null,t.Lf=null,t.Mf=null,t.qe=null,d})}function cc(e,t,n,i,r,s,a){var o,l,u,c,d,h,f,p,g;return a=void 0!==a&&a,N(function(m){switch(m.g){case 1:return o=i.closedCaptions&&0<i.closedCaptions.size,u=null!=i.emsgSchemeIdUris&&0<i.emsgSchemeIdUris.length||e.h.dispatchAllEmsgBoxes,c=e.h.parsePrftBox&&!e.F,d="video/mp4"==i.mimeType||"audio/mp4"==i.mimeType,h=null,r.$&&(h=r.$.timescale),f=d&&h&&"video"===i.type&&"DASH"==e.l.type&&e.h.shouldFixTimestampOffset,(u||c||f)&&(l=new cs),u&&l.S("emsg",function(t){var n=i.emsgSchemeIdUris;if(0===t.version)var s=t.reader.tc(),a=t.reader.tc(),o=t.reader.P(),l=t.reader.P(),u=t.reader.P(),c=t.reader.P(),d=r.startTime+l/o;else o=t.reader.P(),d=t.reader.Qc()/o+r.timestampOffset,l=d-r.startTime,u=t.reader.P(),c=t.reader.P(),s=t.reader.tc(),a=t.reader.tc();t=t.reader.rb(t.reader.getLength()-t.reader.ua()),(n&&n.includes(s)||e.h.dispatchAllEmsgBoxes)&&("urn:mpeg:dash:event:2012"==s?e.g.Ii():(n=d+u/o,o=(new Map).set("detail",{startTime:d,endTime:n,schemeIdUri:s,value:a,timescale:o,presentationTimeDelta:l,eventDuration:u,id:c,messageData:t}),o=new Nr("emsg",o),o.cancelable=!0,e.g.onEvent(o),o.defaultPrevented||"https://aomedia.org/emsg/ID3"!=s&&"https://developer.apple.com/streaming/emsg-id3"!=s||(s=fo(t),!s.length)||e.g.onMetadata([{cueTime:d,data:t,frames:s,dts:d,pts:d}],0,n)))}),c&&l.S("prft",function(t){if(!e.F&&r.$.timescale){var n=t.reader,i=t.version;n.P(),t=n.P();var s=n.P();t=1e3*t+s/Math.pow(2,32)*1e3,0===i?n=n.P():(i=n.P(),n=n.P(),n=i*Math.pow(2,32)+n),t=new Date(new Date(Date.UTC(1900,0,1,0,0,0)).getTime()+t).getTime(),n=(new Map).set("detail",{wallClockTime:t,programStartDate:new Date(t-n/r.$.timescale*1e3)}),n=new Nr("prft",n),e.g.onEvent(n),e.F=!0}}),f&&l.box("moof",ds).box("traf",ds).S("tfdt",function(n){var i,s,a,o,l,u;return N(function(c){return i=mo(n.reader,n.version),s=i.baseMediaDecodeTime,s?(a=-s/h,o=Number(t.qe)||0,o<a?(l=t.oe,u=t.ne,S(c,uc(e,t,a,l,u,r),0)):c.u(0)):c.return()})}),(u||c||f)&&l.parse(s,!1,a),S(m,dc(e,t,n),2);case 2:return ns(e.m),p=t.Nd,t.Nd=!1,g=t.wg,t.wg=!1,S(m,e.g.yg(t.type,s),3);case 3:return S(m,dl(e.g.ca,t.type,s,r,i,o,p,g,a),4);case 4:ns(e.m),w(m)}})}function dc(e,t,n){var i,r,s,a;return N(function(o){if(1==o.g)return i=Math.max(e.h.bufferBehind,e.l.presentationTimeline.g),r=al(e.g.ca,t.type),null==r?o.return():(s=n-r,a=s-i,a<=e.h.evictionGoal?o.return():S(o,e.g.ca.remove(t.type,r,r+a),2));ns(e.m),w(o)})}function hc(e){return e&&e.type==Ln&&("application/cea-608"==e.stream.mimeType||"application/cea-708"==e.stream.mimeType)}function fc(e,t,n,i){var r,s,a,o,l;return N(function(u){switch(u.g){case 1:if(r=n.vd())return u.return(r);if(s=null,t.W){var c=t.W,d=c.h;n instanceof Ya&&(d=c.j),d.has(n)?(c=d.get(n),i&&(c.ig=i),s=c.Be):s=null}return s||(s=pc(n,t.stream,i||null,e.h.retryParameters,e.g.Nb)),a=0,t.ia&&(a=t.ia.h),t.kb=s,S(u,s.promise,2);case 2:if(o=u.h,t.kb=null,l=o.data,!n.aesKey){u.u(3);break}return S(u,Bu(l,n.aesKey,a),4);case 4:l=u.h;case 3:return u.return(l)}})}function pc(e,t,n,i,r){var s=e instanceof Qa?e:void 0,a=s?1:0;return e=ju(e.M(),e.Ha,e.sa,i,n),e.contentType=t.type,r.request(Zr,e,{type:a,stream:t,segment:s})}function gc(e,t,n,i){var r,s;return N(function(a){return 1==a.g?(t.ec=!1,t.Oe=!1,t.ee=0,t.nd=!0,t.Ya=null,t.ia=null,t.W&&!e.o.has(t.stream)&&_u(t.W),i?(r=e.g.he(),s=e.g.ca.getDuration(),S(a,e.g.ca.remove(t.type,r+i,s),3)):S(a,pl(e.g.ca,t.type),4)):3!=a.g?(ns(e.m),n?S(a,e.g.ca.flush(t.type),3):a.u(3)):(ns(e.m),t.nd=!1,t.endOfStream=!1,t.Qa||t.ub||mc(e,t,0),void w(a))})}function mc(e,t,n){var i=t.type;(i!=Ln||e.i.has(i))&&(t.ub=new Nt(function(){var n;return N(function(i){return 1==i.g?(E(i,2),S(i,nc(e,t),4)):2!=i.g?k(i,0):(n=A(i),e.g&&e.g.onError(n),void w(i))})}).Y(n))}function vc(e){null!=e.ub&&(e.ub.stop(),e.ub=null)}function yc(e){return N(function(t){return e.kb?S(t,e.kb.abort(),0):t.u(0)})}function bc(e,t,n){var i;return N(function(r){if(1==r.g)return S(r,kr(e.I),2);ns(e.m),1===n.category&&(i=0===e.h.maxDisabledTime&&1011==n.code?1:e.h.maxDisabledTime,n.handled=e.g.disableStream(t.stream,i),n.handled&&(n.severity=1)),n.handled&&1011==n.code||e.g.onError(n),n.handled||e.h.failureCallback(n),w(r)})}function _c(e){var t,n,i,r,s,a;return N(function(o){return 1==o.g?(t=Date.now()/1e3,n=e.h.minTimeBetweenRecoveries,!e.h.allowMediaSourceRecoveries||t-e.K<n?o.return(!1):(e.K=t,i=Pn,(r=e.i.get(i.X))&&(r.Kc=null,Qu(e,r),yc(r).catch(function(){})),(s=e.i.get(i.ga))&&(s.Kc=null,Qu(e,s),yc(s).catch(function(){})),a=new Map,e.j.audio&&a.set(i.X,e.j.audio),e.j.video&&a.set(i.ga,e.j.video),S(o,Il(e.g.ca,a),2))):o.return(!0)})}function Tc(e,t){if(e.G.projection!=t.projection||e.G.hfov!=t.hfov){if(null!=t.projection||null!=t.hfov){var n=(new Map).set("detail",t);n=new Nr("spatialvideoinfo",n)}else n=new Nr("nospatialvideoinfo");n.cancelable=!0,e.g.onEvent(n),e.G=t}}function Sc(){}function wc(e,t,n,i,r){var s,a=r in i,o=a?n.constructor==Object&&0==Object.keys(i).length:n.constructor==Object&&0==Object.keys(n).length,l=a||o,u=!0;for(s in t){var c=r+"."+s,d=a?i[r]:n[s];l||s in n?void 0===t[s]?void 0===d||l?delete e[s]:e[s]=yi(d):o?e[s]=t[s]:d.constructor==Object&&t[s]&&t[s].constructor==Object?(e[s]||(e[s]=yi(d)),c=wc(e[s],t[s],d,i,c),u=u&&c):typeof t[s]!=typeof d||null==t[s]||"function"!=typeof t[s]&&t[s].constructor!=d.constructor?(Q("Invalid config, wrong type for "+c),u=!1):("function"==typeof n[s]&&n[s].length!=t[s].length&&Z("Unexpected number of arguments for "+c),e[s]=t[s]):(Q("Invalid config, unrecognized key "+c),u=!1)}return u}function Ec(e,t){for(var n={},i=n,r=0,s=0;;){if(r=e.indexOf(".",r),0>r)break;0!=r&&"\\"==e[r-1]||(s=e.substring(s,r).replace(/\\\./g,"."),i[s]={},i=i[s],s=r+1),r+=1}return i[e.substring(s).replace(/\\\./g,".")]=t,n}function xc(e,t){return e&&t}function kc(e,t){function n(e){for(var t=c(Object.keys(e)),i=t.next();!i.done;i=t.next())i=i.value,s(e[i])&&0===Object.keys(e[i]).length?delete e[i]:r(e[i])?delete e[i]:"function"==typeof e[i]?delete e[i]:s(e[i])&&(n(e[i]),0===Object.keys(e[i]).length&&delete e[i])}function i(e,t){return Object.keys(e).reduce(function(n,a){var o=e[a];return t.hasOwnProperty(a)?s(o)&&s(t[a])?(o=i(o,t[a]),(0<Object.keys(o).length||!s(o))&&(n[a]=o)):r(o)&&r(t[a])||Number.isNaN(o)&&Number.isNaN(t[a])||o!==t[a]&&(n[a]=o):n[a]=o,n},{})}function r(e){return Array.isArray(e)&&0===e.length}function s(e){return e&&"object"===typeof e&&!Array.isArray(e)}return e=i(e,t),n(e),e}function Ac(){}function Ic(e){return e=pn(e),new ht(e).Gb}function Cc(e,t,n){function i(e){ke(s).setUint32(a,e.byteLength,!0),a+=4,s.set(Ee(e),a),a+=e.byteLength}if(!n||!n.byteLength)throw new It(2,6,6015);var r;r="string"==typeof t?mn(t,!0):t,e=pn(e),e=mn(e,!0);var s=new Uint8Array(12+e.byteLength+r.byteLength+n.byteLength),a=0;return i(e),i(r),i(n),s}function Dc(e,t,n){return"skd"!==t?e:(t=n.serverCertificate,n=pn(e).split("skd://").pop(),Cc(e,n,t))}function Rc(e,t){2===e&&(t.headers["Content-Type"]="application/octet-stream")}function Mc(){}function Lc(){var e=1/0;navigator.connection&&navigator.connection.saveData&&(e=360);var t={retryParameters:Ar(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,persistentSessionOnlinePlayback:!1,persistentSessionsMetadata:[],initDataTransform:function(e,t,n){return on()&&"skd"==t&&(t=n.serverCertificate,n=Ic(e),e=Cc(e,n,t)),e},logLicenseExchange:!1,updateExpirationTime:1,preferredKeySystems:[],keySystemsMapping:{},parseInbandPsshEnabled:Vt(),minHdcpVersion:"",ignoreDuplicateInitData:!Gt()};(Vt()||Qt())&&t.preferredKeySystems.push("com.microsoft.playready");var n="reload",i=!1;Gt()||$t()||sn("Tizen 4")||sn("Tizen 5")||sn("Tizen 6")||qt()||zt()&&53===Kt()||zt()&&68===Kt()||!(!Wt()||Wt()&&nn()||Wt()&&sn("Fuchsia"))||tn()&&jt()||(n="smooth",i=!0),i={retryParameters:Ar(),availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,disableThumbnails:!1,defaultPresentationDelay:0,segmentRelativeVttTiming:!1,raiseFatalErrorOnManifestUpdateRequestFailure:!1,continueLoadingWhenPaused:!0,dash:{clockSyncUri:"",ignoreDrmInfo:!1,disableXlinkProcessing:!1,xlinkFailGracefully:!1,ignoreMinBufferTime:!1,autoCorrectDrift:!0,initialSegmentLimit:1e3,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1,ignoreMaxSegmentDuration:!1,keySystemsByURI:{"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95":"com.microsoft.playready"},manifestPreprocessor:Nc,manifestPreprocessorTXml:Uc,sequenceMode:!1,enableAudioGroups:!1,multiTypeVariantsAllowed:i,useStreamOnceInPeriodFlattening:!1,updatePeriod:-1,enableFastSwitching:!0},hls:{ignoreTextStreamFailures:!1,ignoreImageStreamFailures:!1,defaultAudioCodec:"mp4a.40.2",defaultVideoCodec:"avc1.42E01E",ignoreManifestProgramDateTime:!1,ignoreManifestProgramDateTimeForTypes:[],mediaPlaylistFullMimeType:'video/mp2t; codecs="avc1.42E01E, mp4a.40.2"',useSafariBehaviorForLive:!0,liveSegmentsDelay:3,sequenceMode:!($t()||Gt()||qt()||Qt()),ignoreManifestTimestampsInSegmentsMode:!1,disableCodecGuessing:!1,disableClosedCaptionsDetection:!1,allowLowLatencyByteRangeOptimization:!0},mss:{manifestPreprocessor:Nc,manifestPreprocessorTXml:Uc,sequenceMode:!1,keySystemsBySystemId:{"9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","79f0049a-4098-8642-ab92-e65be0885f95":"com.microsoft.playready"}}};var r={retryParameters:Ar(),failureCallback:function(e){return xc([e])},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,evictionGoal:1,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,gapDetectionThreshold:.5,gapJumpTimerTime:.25,durationBackoff:1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsForFairPlay:!0,inaccurateManifestTolerance:2,lowLatencyMode:!1,autoLowLatencyMode:!1,forceHTTP:!1,forceHTTPS:!1,preferNativeHls:!1,updateIntervalSeconds:1,dispatchAllEmsgBoxes:!1,observeQualityChanges:!1,maxDisabledTime:30,parsePrftBox:!1,segmentPrefetchLimit:0,prefetchAudioLanguages:[],disableAudioPrefetch:!1,disableTextPrefetch:!1,disableVideoPrefetch:!1,liveSync:{enabled:!1,targetLatency:.5,targetLatencyTolerance:.5,maxPlaybackRate:1.1,minPlaybackRate:.95,panicMode:!1,panicThreshold:60,dynamicTargetLatency:{enabled:!1,stabilityThreshold:60,rebufferIncrement:.5,maxAttempts:10,maxLatency:4,minLatency:1}},allowMediaSourceRecoveries:!0,minTimeBetweenRecoveries:5,vodDynamicPlaybackRate:!1,vodDynamicPlaybackRateLowBufferRate:.95,vodDynamicPlaybackRateBufferRatio:.5,infiniteLiveStreamDuration:!1,preloadNextUrlWindow:30,loadTimeout:30,clearDecodingCache:Qt()||Xt(),dontChooseCodecs:!1,shouldFixTimestampOffset:zt()||Ht()};(zt()||Ht()||Wt()||Zt())&&(r.stallSkip=0);var s={trackSelectionCallback:function(e){return N(function(t){return t.return(e)})},downloadSizeCallback:function(e){var t;return N(function(n){return 1==n.g?navigator.storage&&navigator.storage.estimate?S(n,navigator.storage.estimate(),3):n.return(!0):(t=n.h,n.return(t.usage+e<.95*t.quota))})},progressCallback:function(e,t){return xc([e,t])},usePersistentLicense:!0,numberOfParallelDownloads:5};e={enabled:!0,useNetworkInformation:!0,defaultBandwidthEstimate:1e6,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:e,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0,minChannelsCount:0,maxChannelsCount:1/0},advanced:{minTotalBytes:128e3,minBytes:16e3,fastHalfLife:2,slowHalfLife:5},restrictToElementSize:!1,restrictToScreenSize:!1,ignoreDevicePixelRatio:!1,clearBufferSwitch:!1,safeMarginSwitch:0,cacheLoadThreshold:20,minTimeToSwitch:Yt()?.5:0},n={codecSwitchingStrategy:n,addExtraFeaturesToSourceBuffer:function(e){return xc([e],"")},forceTransmux:!1,insertFakeEncryptionInInit:!0,modifyCueCallback:function(e,t){return xc([e,t])}};var a=!1,o=!1,l=!0;rn()&&(o=a=!0,l=!1);var u={drm:t,manifest:i,streaming:r,mediaSource:n,offline:s,abrFactory:function(){return new tr},abr:e,autoShowText:3,preferredAudioLanguage:"",preferredAudioLabel:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,preferredVideoHdrLevel:"AUTO",preferredVideoLayout:"",preferredVideoLabel:"",preferredVideoCodecs:[],preferredAudioCodecs:[],preferForcedSubs:!1,preferSpatialAudio:!1,preferredDecodingAttributes:[],restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0,minChannelsCount:0,maxChannelsCount:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayer:{captionsUpdatePeriod:.25},textDisplayFactory:function(){return null},cmcd:{enabled:!1,sessionId:"",contentId:"",rtpSafetyFactor:5,useHeaders:!1,includeKeys:[]},cmsd:{enabled:!0,applyMaximumSuggestedBitrate:!0,estimatedThroughputWeightRatio:.5},lcevc:{enabled:!1,dynamicPerformanceScaling:!0,logLevel:0,drawLogo:!1},ads:{customPlayheadTracker:a,skipPlayDetection:o,supportsMultipleMediaElements:l}};return s.trackSelectionCallback=function(e){return N(function(t){return t.return(Oc(e,u.preferredAudioLanguage,u.preferredVideoHdrLevel))})},u}function Pc(e,t,n){var i={".drm.keySystemsMapping":"",".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",sessionType:"",serverCertificate:new Uint8Array(0),serverCertificateUri:"",individualizationServer:"",headers:{}}};return wc(e,t,n||Lc(),i,"")}function Oc(t,n,i){var r=i;"AUTO"==r&&(r=e.matchMedia("(color-gamut: p3)").matches?"PQ":"SDR");var s=t.filter(function(e){return!("variant"!=e.type||e.hdr&&e.hdr!=r)});i=[];var a=mi(n,s.map(function(e){return e.language}));a&&(i=s.filter(function(e){return hi(e.language)==a})),0==i.length&&(i=s.filter(function(e){return e.primary})),0==i.length&&(s.map(function(e){return e.language}),i=s);var o=i.filter(function(e){return e.height&&480>=e.height});for(o.length&&(o.sort(function(e,t){return t.height-e.height}),i=o.filter(function(e){return e.height==o[0].height})),n=[],i.length&&(s=Math.floor(i.length/2),i.sort(function(e,t){return e.bandwidth-t.bandwidth}),n.push(i[s])),t=c(t),i=t.next();!i.done;i=t.next())i=i.value,i.type!=Ln&&"image"!=i.type||n.push(i);return n}function Nc(e){return xc([e],e)}function Uc(e){return xc([e],e)}function Fc(e,t,n,i){Br.call(this),this.L=e,this.U=t,this.xa=i.networkingEngine,this.A=n,this.o=null,this.ra=0,this.Fa=i.Dc,this.C=i.Ci,this.bb=i.Di,this.g=i.config,this.j=this.F=this.h=null,this.ea=!1,this.G=i.Mi,this.pa=!1,this.l=null,this.da=!1,this.i=this.B=null,this.aa=!1,this.K=new Map,this.qa=!1,this.za=i.Li,this.Z=new pu,this.m=new Ir,this.N=null,this.s=!1,this.Da=i.Fh,this.fa=null,this.Ea=i.Eh,this.R=!1,this.I=[],this.H=[]}function Bc(e,t,n){(e=t?e.H:e.I)?e.push(n):n()}function jc(e){if(e.H)for(var t=c(e.H),n=t.next();!n.done;n=t.next())n=n.value,n();e.H=null}function Vc(e,t){if(e.N=t,e.R=!0,e.I){t=c(e.I);for(var n=t.next();!n.done;n=t.next())n=n.value,n()}e.I=null}function Hc(e){return e.aa=!0,e.i}function $c(e){return e.ea=!0,e.j}function Gc(e){return e.pa=!0,e.G}function zc(e){return e.da=!0,e.l}function qc(e){return e.qa=!0,e.K}function Wc(e){if(e.s)throw new It(2,7,7003)}function Kc(e,t){e.dispatchEvent(new Nr("onstatechange",(new Map).set("state",t)))}function Yc(e){var t,n,i,r,s;return N(function(a){if(1==a.g)return Kc(e,"manifest-parser"),e.j||(e.F=$a(e.L,e.U),e.j=e.F(),e.j.configure(e.g.manifest)),t=Date.now()/1e3,Kc(e,"manifest"),e.h?a.u(2):(n=e,S(a,e.j.start(e.L,e.bb),3));if(2!=a.g&&(n.h=a.h),i=new Nr("manifestparsed",void 0),e.dispatchEvent(i),0==e.h.variants.length)throw new It(2,4,4036);Zc(e.h),r=Date.now()/1e3,s=r-t,e.Z.H=s,w(a)})}function Xc(e){var t,n,i,r,s;return N(function(a){switch(a.g){case 1:Kc(e,"drm-engine"),e.ra=Date.now()/1e3,e.l=e.Fa(),e.C.g=e.l,e.l.configure(e.g.drm);var o=e.C;if(t=xi(e.h.variants,o.h.restrictions,o.i),!t){a.u(2);break}return n=new Nr("trackschanged",void 0),S(a,Promise.resolve(),3);case 3:Wc(e),e.dispatchEvent(n);case 2:return i=Wi(e.h.variants),S(a,na(e.l,i,e.h.offlineSessionIds),4);case 4:return Wc(e),S(a,Ua(e.C,e.h),5);case 5:if(r=a.h,!r){a.u(0);break}return s=new Nr("trackschanged",void 0),S(a,Promise.resolve(),7);case 7:e.dispatchEvent(s),w(a)}})}function Qc(e,t,n){var i,r,s,a,o;N(function(l){if(1==l.g)return i=e.g.streaming.segmentPrefetchLimit||2,r=new gu(i,t,function(t,n,i){return pc(t,n,i||null,e.g.streaming.retryParameters,e.xa)},!1),e.K.set(t.id,r),S(l,t.createSegmentIndex(),2);s=e.A||0,(o=(a=t.segmentIndex.Kb(s))?a.current():null)||(o=t.segmentIndex.get(0)),o&&(n?o.$&&yu(r,o.$):vu(r,o.startTime)),w(l)})}function Zc(e){function t(e){return e.video&&e.audio||e.video&&e.video.codecs.includes(",")}e.variants.some(t)&&(e.variants=e.variants.filter(t))}function Jc(e,t){Br.call(this);var n=this;this.i=e,this.l=t,this.g=new Map,this.m=[{Ac:null,zc:nd,pc:function(e,t){return ed(n,"enter",e,t)}},{Ac:td,zc:nd,pc:function(e,t){return ed(n,"enter",e,t)}},{Ac:id,zc:nd,pc:function(e,t){return ed(n,"enter",e,t)}},{Ac:nd,zc:td,pc:function(e,t){return ed(n,"exit",e,t)}},{Ac:nd,zc:id,pc:function(e,t){return ed(n,"exit",e,t)}},{Ac:td,zc:id,pc:function(e,t){return ed(n,"skip",e,t)}},{Ac:id,zc:td,pc:function(e,t){return ed(n,"skip",e,t)}}],this.h=new se,this.h.D(this.i,"regionremove",function(e){n.g.delete(e.region)})}function ed(e,t,n,i){t=new Nr(t,new Map([["region",n],["seeking",i]])),e.dispatchEvent(t)}Hl.prototype.release=function(){this.h&&(this.h.release(),this.h=null),null!=this.i&&(this.i.release(),this.i=null),this.m=function(){},this.g=null},Wl.prototype.release=function(){this.g&&(this.g.stop(),this.g=null),this.h=null},i=Yl.prototype,i.$e=function(){function e(){if(null==t.g||0==t.g&&1/0!=t.h.duration)t.j=!0;else{var e=t.h.currentTime,n=t.g;0>t.g&&(n=Math.max(0,e+t.g)),e!=n?(t.i.ha(t.h,"seeking",function(){t.j=!0}),t.h.currentTime=n):t.j=!0}}var t=this;jl(this.h,HTMLMediaElement.HAVE_CURRENT_DATA,this.i,function(){e()})},i.release=function(){this.i&&(this.i.release(),this.i=null),this.h=null},i.af=function(e){this.g=this.j?this.g:e},i.$d=function(){return(this.j?this.h.currentTime:this.g)||0},i.vg=function(){return 0},i.ug=function(){return 0},i.Zg=function(){},i=Xl.prototype,i.$e=function(){this.m.Sa(.25)},i.release=function(){this.h&&(this.h.release(),this.h=null),this.j&&(this.j.release(),this.j=null),this.m&&(this.m.stop(),this.m=null),this.i=this.h=this.g=this.l=null,this.A=function(){}},i.af=function(e){Gl(this.h,e)},i.$d=function(){var e=$l(this.h);return 0<this.i.readyState&&!this.i.paused?Jl(this,e):e},i.vg=function(){return this.o?this.o.o:0},i.ug=function(){return this.j.C},i.Zg=function(){this.j.Sf()},i=tu.prototype,i.getNumReferences=function(){return this.O.length},i.getNumEvicted=function(){return this.i},i.release=function(){this.m||(this.O=[],this.l&&this.l.stop(),this.l=null)},i.Fi=function(){this.m=!0},i.Jb=function(e){for(var t=c(this.O),n=t.next();!n.done;n=t.next())e(n.value)},i.find=function(e){for(var t=this.O.length-1,n=t;0<=n;--n){var i=this.O[n],r=n<t?this.O[n+1].startTime:i.endTime;if(e>=i.startTime&&e<r)return n+this.i}return this.O.length&&e<this.O[0].startTime?this.i:null},i.get=function(e){return 0==this.O.length?null:(e-=this.i,0>e||e>=this.O.length?null:this.O[e])},i.offset=function(e){if(!this.m)for(var t=c(this.O),n=t.next();!n.done;n=t.next())n.value.offset(e)},i.ue=function(e){if(!this.m&&e.length){var t=Math.round(1e3*e[0].startTime)/1e3;this.O=this.O.filter(function(e){return Math.round(1e3*e.startTime)/1e3<t}),this.O.push.apply(this.O,d(e))}},i.Id=function(e,t){var n=this;e=e.filter(function(e){return e.endTime>t&&(0==n.O.length||e.endTime>n.O[0].startTime)}),this.ue(e),this.Oa(t)},i.Oa=function(e){if(!this.m){var t=this.O.length;this.O=this.O.filter(function(t){return t.endTime>e}),this.i+=t-this.O.length}},i.Ec=function(e,t,n){if(n=void 0!==n&&n,!this.m){for(;this.O.length;){if(!(this.O[this.O.length-1].startTime>=t))break;this.O.pop()}for(;this.O.length;){if(!(this.O[0].endTime<=e))break;this.O.shift(),n||this.i++}0!=this.O.length&&(e=this.O[this.O.length-1],t=new Qa(e.startTime,t,e.C,e.Ha,e.sa,e.$,e.timestampOffset,e.appendWindowStart,e.appendWindowEnd,e.g,e.tilesLayout,e.A,e.h,e.status,e.aesKey),t.mimeType=e.mimeType,t.codecs=e.codecs,t.i=e.i,this.O[this.O.length-1]=t)}},i.Me=function(e,t){var n=this;this.m||(this.l&&this.l.stop(),this.l=new Ut(function(){var e=t();e?n.O.push.apply(n.O,d(e)):(n.l.stop(),n.l=null)}),this.l.Sa(e))},tu.prototype[Symbol.iterator]=function(){return this.Kb(0)},tu.prototype.Kb=function(e,t,n){t=void 0!==t&&t,n=void 0!==n&&n;var i=this.find(e);if(null==i)return null;var r=this.get(i);n?i++:i--;var s=-1;if(r&&0<r.g.length)for(var a=r.g.length-1;0<=a;--a){var o=r.g[a];if(e>=o.startTime&&e<o.endTime){if(!t){for(;a&&!o.l;)a--,o=r.g[a];if(!o.l)return Q("No independent partial segment found!"),null}n?i--:i++,s=a-1;break}}return new iu(this,i,s,n)},G("shaka.media.SegmentIndex",tu),tu.forSingleSegment=nu,tu.prototype.getIteratorForTime=tu.prototype.Kb,tu.prototype.updateEvery=tu.prototype.Me,tu.prototype.fit=tu.prototype.Ec,tu.prototype.evict=tu.prototype.Oa,tu.prototype.mergeAndEvict=tu.prototype.Id,tu.prototype.offset=tu.prototype.offset,tu.prototype.get=tu.prototype.get,tu.prototype.find=tu.prototype.find,tu.prototype.markImmutable=tu.prototype.Fi,tu.prototype.release=tu.prototype.release,tu.prototype.getNumEvicted=tu.prototype.getNumEvicted,tu.prototype.getNumReferences=tu.prototype.getNumReferences,iu.prototype.Uc=function(e){this.reverse=e},iu.prototype.Lh=function(){return this.h},iu.prototype.current=function(){var e=this.i.get(this.h);return e&&0<e.g.length&&e.o&&this.g>=e.g.length&&(this.h++,this.g=0,e=this.i.get(this.h)),e&&0<e.g.length?e.g[this.g]:e},iu.prototype.next=function(){var e=this.i.get(this.h);return this.reverse?e&&0<e.g.length?(this.g--,0>this.g&&(this.h--,this.g=(e=this.i.get(this.h))&&0<e.g.length?e.g.length-1:0)):(this.h--,this.g=0):e&&0<e.g.length?(this.g++,e.o&&this.g==e.g.length&&(this.h++,this.g=0)):(this.h++,this.g=0),e=this.current(),{value:e,done:!e}},G("shaka.media.SegmentIterator",iu),iu.prototype.next=iu.prototype.next,iu.prototype.current=iu.prototype.current,iu.prototype.currentPosition=iu.prototype.Lh,iu.prototype.setReverse=iu.prototype.Uc,y(ru,tu),i=ru.prototype,i.clone=function(){var e=new ru;return e.g=this.g.slice(),e},i.release=function(){for(var e=c(this.g),t=e.next();!t.done;t=e.next())t.value.release();this.g=[]},i.Jb=function(e){for(var t=c(this.g),n=t.next();!n.done;n=t.next())n.value.Jb(e)},i.find=function(e){for(var t=0,n=c(this.g),i=n.next();!i.done;i=n.next()){i=i.value;var r=i.find(e);if(null!=r)return r+t;t+=i.getNumEvicted()+i.getNumReferences()}return null},i.get=function(e){for(var t=0,n=c(this.g),i=n.next();!i.done;i=n.next()){i=i.value;var r=i.get(e-t);if(r)return r;r=i.getNumReferences(),t+=i.getNumEvicted()+r}return null},i.offset=function(){},i.ue=function(){},i.Oa=function(){},i.Id=function(){},i.Ec=function(){},i.Me=function(){},G("shaka.media.MetaSegmentIndex",ru),ru.prototype.updateEvery=ru.prototype.Me,ru.prototype.fit=ru.prototype.Ec,ru.prototype.mergeAndEvict=ru.prototype.Id,ru.prototype.evict=ru.prototype.Oa,ru.prototype.merge=ru.prototype.ue,ru.prototype.offset=ru.prototype.offset,ru.prototype.get=ru.prototype.get,ru.prototype.find=ru.prototype.find,ru.prototype.forEachTopLevelReference=ru.prototype.Jb,ru.prototype.release=ru.prototype.release,su.prototype.release=function(){this.set(this.nc()),this.h&&(this.h.stop(),this.h=null),this.g=null},su.prototype.set=function(e){this.i=e,au(this)},su.prototype.nc=function(){return this.g.nc()},ou.prototype.release=function(){this.i.stop();for(var e=c(this.g),t=e.next();!t.done;t=e.next())t.value.release();this.g.clear()},gu.prototype.Oa=function(e,t){t=void 0!==t&&t;for(var n=c(this.h.keys()),i=n.next();!i.done;i=n.next())i=i.value,e>i.endTime&&Eu(this,i);t&&Tu(this)},gu.prototype.Uc=function(e){this.o=e,this.g&&this.g.Uc(e)},xu.prototype.abort=function(){this.Be&&this.Be.abort()},y(Au,Br),Au.prototype.release=function(){this.g.clear(),this.h.stop(),Br.prototype.release.call(this)},y(Iu,Br),Iu.prototype.release=function(){this.g.clear(),Br.prototype.release.call(this)},Iu.prototype.j=function(e){for(var t=c(this.g.values()),n=t.next();!n.done;n=t.next()){n=n.value;var i=n.kf;e:{for(var r=n.Md,s=r.length-1;0<=s;s--){var a=r[s];if(a.position<=e){r=a.Lc;break e}}r=null}s=r&&!(i===r||i&&r&&i.bandwidth==r.bandwidth&&i.audioSamplingRate==r.audioSamplingRate&&i.codecs==r.codecs&&i.contentType==r.contentType&&i.frameRate==r.frameRate&&i.height==r.height&&i.mimeType==r.mimeType&&i.channelsCount==r.channelsCount&&i.pixelAspectRatio==r.pixelAspectRatio&&i.width==r.width),a=r&&i&&r.label&&i.label&&i.label!==r.label;var o=r&&i&&r.language&&i.language&&i.language!==r.language;i=r&&i&&r.roles&&i.roles&&!Fe(i.roles,r.roles),(a||o||i)&&Ru(this,e,r.contentType)&&(n.kf=r,i=new Nr("audiotrackchange",new Map([["quality",r],["position",e]])),this.dispatchEvent(i)),s&&Ru(this,e,r.contentType)&&(n.kf=r,JSON.stringify(r),n=new Nr("qualitychange",new Map([["quality",r],["position",e]])),this.dispatchEvent(n))}},i=Vu.prototype,i.destroy=function(){return this.m.destroy()},i.configure=function(e){if(this.h=e,this.I=new xr({maxAttempts:Math.max(e.retryParameters.maxAttempts,2),baseDelay:e.retryParameters.baseDelay,backoffFactor:e.retryParameters.backoffFactor,fuzzFactor:e.retryParameters.fuzzFactor,timeout:0,stallTimeout:0,connectionTimeout:0},!0),e.disableAudioPrefetch){var t=this.i.get("audio");t&&t.W&&(_u(t.W),t.W=null),t=c(this.o.keys());for(var n=t.next();!n.done;n=t.next())n=n.value,_u(this.o.get(n)),this.o.delete(n)}for(e.disableTextPrefetch&&(t=this.i.get(Ln))&&t.W&&(_u(t.W),t.W=null),e.disableVideoPrefetch&&(t=this.i.get("video"))&&t.W&&(_u(t.W),t.W=null),t=c(this.i.keys()),n=t.next();!n.done;n=t.next())n=this.i.get(n.value),n.W?(Su(n.W,e.segmentPrefetchLimit),0<e.segmentPrefetchLimit||(_u(n.W),n.W=null)):0<e.segmentPrefetchLimit&&(n.W=ec(this,n.stream));e.disableAudioPrefetch||tc(this)},i.start=function(e){var t=this;return N(function(n){if(1==n.g)return S(n,Zu(t,e||new Map),2);ns(t.m),t.C=!0,w(n)})},i.Nd=function(){if(this.g)for(var e=this.g.he(),t=c(this.i.keys()),n=t.next();!n.done;n=t.next()){var i=n.value;n=this.i.get(i);var r=this.g.ca;if(r.C?r=!1:i==Ln?(r=r.g,r=null!=r.g&&null!=r.h&&(e>=r.g&&e<r.h)):(r=ul(r,i),r=io(r,e)),!r){if(n.W&&(n.W.g=null),"audio"===n.type){r=c(this.o.values());for(var s=r.next();!s.done;s=r.next())s.value.g=null}n.ia=null,(null!=ol(this.g.ca,i)||n.Qa)&&Qu(this,n),n.kb&&(n.kb.abort(),n.kb=null),i===Ln&&(i=this.g.ca,i.H&&i.H.g()),n.Nd=!0}}},i.updateDuration=function(){var e=this.l.presentationTimeline.getDuration();1/0>e?this.g.ca.$a(e):this.g.ca.$a(this.h.infiniteLiveStreamDuration?1/0:Math.pow(2,32))},G("shaka.util.ConfigUtils",Sc),Sc.getDifferenceFromConfigObjects=kc,Sc.convertToConfigObject=Ec,Sc.mergeConfigObjects=wc,G("shaka.util.FairPlayUtils",Ac),Ac.commonFairPlayResponse=function(e,t){if(2===e){try{var n=hn(t.data)}catch(e){return}e=!1,n=n.trim(),"<ckc>"===n.substr(0,5)&&"</ckc>"===n.substr(-6)&&(n=n.slice(5,-6),e=!0);try{var i=JSON.parse(n);i.ckc&&(n=i.ckc,e=!0),i.CkcMessage&&(n=i.CkcMessage,e=!0),i.License&&(n=i.License,e=!0)}catch(e){}e&&(t.data=we(wn(n)))}},Ac.expressplayFairPlayRequest=function(e,t){Rc(e,t)},Ac.conaxFairPlayRequest=function(e,t){Rc(e,t)},Ac.ezdrmFairPlayRequest=function(e,t){Rc(e,t)},Ac.verimatrixFairPlayRequest=function(e,t){2===e&&(e=Ee(t.body),e=Sn(e),t.headers["Content-Type"]="application/x-www-form-urlencoded",t.body=gn("spc="+e))},Ac.expressplayInitDataTransform=function(e,t,n){return Dc(e,t,n)},Ac.conaxInitDataTransform=function(t,n,i){if("skd"!==n)return t;n=i.serverCertificate,i=pn(t).split("skd://").pop().split("?").shift(),i=e.atob(i);var r=new ArrayBuffer(2*i.length);r=xe(r);for(var s=0,a=i.length;s<a;s++)r[s]=i.charCodeAt(s);return Cc(t,r,n)},Ac.ezdrmInitDataTransform=function(e,t,n){return"skd"!==t?e:(t=n.serverCertificate,n=pn(e).split(";").pop(),Cc(e,n,t))},Ac.verimatrixInitDataTransform=function(e,t,n){return Dc(e,t,n)},Ac.initDataTransform=Cc,Ac.defaultGetContentId=Ic,Ac.isFairPlaySupported=function(){var e;return N(function(t){return 1==t.g?(e={initDataTypes:["cenc","sinf","skd"],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42E01E"'}]},E(t,2),S(t,navigator.requestMediaKeySystemAccess("com.apple.fps",[e]),4)):2!=t.g?t.return(!0):(A(t),t.return(!1))})},G("shaka.util.PlayerConfiguration",Mc),Mc.mergeConfigObjects=Pc,Mc.createDefault=Lc,y(Fc,Br),i=Fc.prototype,i.getStartTime=function(){return this.A},i.Gc=function(){return this.L},i.Ef=function(){return this.h},i.getStats=function(){return this.Z},i.start=function(){var e=this;(function(){var t;N(function(n){switch(n.g){case 1:return S(n,Promise.resolve(),2);case 2:return E(n,3),S(n,Yc(e),5);case 5:return Wc(e),S(n,Xc(e),6);case 6:if(Wc(e),e.o||(e.o=new dr(e.g.preferredAudioLanguage,e.g.preferredVariantRole,e.g.preferredAudioChannelCount,e.g.preferredVideoHdrLevel,e.g.preferSpatialAudio,e.g.preferredVideoLayout,e.g.preferredAudioLabel,e.g.preferredVideoLabel,e.g.mediaSource.codecSwitchingStrategy,e.g.manifest.dash.enableAudioGroups)),e.Ea){var i=e.g.abrFactory;e.B=i,e.i=i(),e.i.configure(e.g.abr)}if(e.Da){i=e.h.presentationTimeline.V();var r=Wi(e.h.variants);r=e.o.create(r),e.i.configure(e.g.abr),e.i.setVariants(Array.from(r.values())),(r=e.i.chooseVariant(!0))&&(e.fa=r,r.video&&Qc(e,r.video,i),r.audio&&Qc(e,r.audio,i))}return S(n,void 0,7);case 7:Wc(e),e.m.resolve(),k(n,0);break;case 3:t=A(n),e.m.reject(t),w(n)}})})()},i.dispatchEvent=function(e){return this.N?this.N.dispatchEvent(e):Br.prototype.dispatchEvent.call(this,e)},i.onError=function(e){2===e.severity&&(this.m.reject(e),this.destroy());var t=(new Map).set("detail",e);t=new Nr("error",t),this.dispatchEvent(t),t.defaultPrevented&&(e.handled=!0)},i.configure=function(e,t){e=Ec(e,t),Pc(this.g,e)},i.getConfiguration=function(){return yi(this.g)},i.mj=function(){return this.m},i.destroy=function(){var e,t,n,i=this;return N(function(r){switch(r.g){case 1:if(i.s=!0,!i.j||i.ea){r.u(2);break}return S(r,i.j.stop(),2);case 2:if(!i.i||i.aa){r.u(4);break}return S(r,i.i.stop(),4);case 4:if(i.G&&!i.pa&&i.G.release(),!i.l||i.da){r.u(6);break}return S(r,i.l.destroy(),6);case 6:if(0<i.K.size&&!i.qa)for(e=c(i.K.values()),t=e.next();!t.done;t=e.next())n=t.value,_u(n);w(r)}})},G("shaka.media.PreloadManager",Fc),Fc.prototype.destroy=Fc.prototype.destroy,Fc.prototype.waitForFinish=Fc.prototype.mj,y(Jc,Br),Jc.prototype.release=function(){this.i=null,this.g.clear(),this.h.release(),this.h=null,Br.prototype.release.call(this)},Jc.prototype.j=function(e,t){if(!this.l||0!=e){this.l=!1;for(var n=c(this.i.g),i=n.next();!i.done;i=n.next()){i=i.value;var r=this.g.get(i),s=e<i.startTime?td:e>i.endTime?id:nd;this.g.set(i,s);for(var a=c(this.m),o=a.next();!o.done;o=a.next())o=o.value,o.Ac==r&&o.zc==s&&o.pc(i,t)}}};var td=1,nd=2,id=3;function rd(e,t,n){var i,r,s,a,o,l,u;return N(function(c){switch(c.g){case 1:var d=new ht(e).Pa.split("/").pop().split(".");return i=1==d.length?"":d.pop().toLowerCase(),(r=sd[i])?c.return(r):(s=0,a=zr([e],n),E(c,2),a.method="HEAD",S(c,t.request(s,a).promise,4));case 4:o=c.h,r=o.headers["content-type"],k(c,3);break;case 2:if(l=A(c),!l||1002!=l.code&&1001!=l.code){c.u(3);break}return a.method="GET",S(c,t.request(s,a).promise,6);case 6:u=c.h,r=u.headers["content-type"];case 3:return c.return(r?r.toLowerCase().split(";").shift():"")}})}var sd={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mpd:"application/dash+xml",ism:"application/vnd.ms-sstr+xml",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav",sbv:"text/x-subviewer",srt:"text/srt",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml",lrc:"application/x-subtitle-lrc",ssa:"text/x-ssa",ass:"text/x-ssa"};function ad(e,t){if(e.lineBreak)return"\n";if(e.nestedCues.length)return e.nestedCues.map(function(t){return ad(t,e)}).join("");var n=[],i=700<=e.fontWeight,r="italic"==e.fontStyle,s=e.textDecoration.includes("underline");return i&&n.push(["b"]),r&&n.push(["i"]),s&&n.push(["u"]),r=e.color,""==r&&t&&(r=t.color),i="",(r=od(r))&&(i+="."+r),r=e.backgroundColor,""==r&&t&&(r=t.backgroundColor),(t=od(r))&&(i+=".bg_"+t),i&&n.push(["c",i]),n.reduceRight(function(e,t){var n=c(t);return t=n.next().value,n=n.next().value,"<"+t+(void 0===n?"":n)+">"+e+"</"+t+">"},e.payload)}function od(e){e=e.toLowerCase();var t=e.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i);switch(t?e="#"+(256|parseInt(t[1],10)).toString(16).slice(1)+(256|parseInt(t[2],10)).toString(16).slice(1)+(256|parseInt(t[3],10)).toString(16).slice(1):e.startsWith("#")&&7<e.length&&(e=e.slice(0,7)),e){case"white":case"#fff":case"#ffffff":return"white";case"lime":case"#0f0":case"#00ff00":return"lime";case"cyan":case"#0ff":case"#00ffff":return"cyan";case"red":case"#f00":case"#ff0000":return"red";case"yellow":case"#ff0":case"#ffff00":return"yellow";case"magenta":case"#f0f":case"#ff00ff":return"magenta";case"blue":case"#00f":case"#0000ff":return"blue";case"black":case"#000":case"#000000":return"black"}return null}function ld(e,t){var n=[];e=c(ud(e));for(var i=e.next();!i.done;i=e.next())if(i=i.value,i.isContainer)n.push.apply(n,d(ld(i.nestedCues,i)));else{var r=i.clone();r.nestedCues=[],r.payload=ad(i,t),n.push(r)}return n}function ud(e){var t=[],n={};e=c(e);for(var i=e.next();!i.done;n={Sd:n.Sd},i=e.next())n.Sd=i.value,t.some(function(e){return function(t){return Ve(e.Sd,t)}}(n))||t.push(n.Sd);return t}function cd(e){function t(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()}if(e.startTime>=e.endTime)return null;var n=new VTTCue(e.startTime,e.endTime,e.payload);n.id=t(e.startTime.toString())+t(e.endTime.toString())+t(e.payload),n.lineAlign=e.lineAlign,n.positionAlign=e.positionAlign,e.size&&(n.size=e.size);try{n.align=e.textAlign}catch(e){}return"center"==e.textAlign&&"center"!=n.align&&(n.align="middle"),"vertical-lr"==e.writingMode?n.vertical="lr":"vertical-rl"==e.writingMode&&(n.vertical="rl"),1==e.lineInterpretation&&(n.snapToLines=!1),null!=e.line&&(n.line=e.line),null!=e.position&&(n.position=e.position),n}function dd(e,t){this.g=null;for(var n=c(Array.from(e.textTracks)),i=n.next();!i.done;i=n.next())i=i.value,"metadata"!==i.kind&&"chapters"!==i.kind&&(i.mode="disabled",i.label==t&&(this.g=i));this.g||(this.g=e.addTextTrack("subtitles",t)),this.g.mode="hidden"}function hd(e,t){var n=e.mode;e.mode="showing"==n?"showing":"hidden";for(var i=c(Array.from(e.cues)),r=i.next();!r.done;r=i.next())(r=r.value)&&t(r)&&e.removeCue(r);e.mode=n}function fd(){}function pd(){}function gd(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function md(t,n,i){var r=this;this.m=!1,this.h=[],this.A=t,this.s=n,this.l=null,this.g=document.createElement("div"),this.g.classList.add("shaka-text-container"),this.g.style.textAlign="center",this.g.style.display="flex",this.g.style.flexDirection="column",this.g.style.alignItems="center",this.g.style.justifyContent="flex-end",this.s.appendChild(this.g),i&&i.captionsUpdatePeriod||pe("UITextDisplayer w/ config","Please migrate to initializing UITextDisplayer with a config."),this.C=new Ut(function(){r.A.paused||bd(r)}).Sa(i&&i.captionsUpdatePeriod?i.captionsUpdatePeriod:.25),this.i=new Map,this.j=new se,this.j.D(document,"fullscreenchange",function(){bd(r,!0)}),this.j.D(this.A,"seeking",function(){bd(r,!0)}),this.j.D(this.A,"resize",function(){var e=r.A,t=e.videoWidth;e=e.videoHeight,r.l=t&&e?t/e:null}),this.o=null,"ResizeObserver"in e&&(this.o=new ResizeObserver(function(){bd(r,!0)}),this.o.observe(this.g)),this.B=new Map}function vd(e,t){for(;null!=t;){if(t==e.g)return!0;t=t.parentElement}return!1}function yd(e,t,n,i,r){var s=!1,a=[],o=[];t=c(t);for(var l=t.next();!l.done;l=t.next()){l=l.value,r.push(l);var u=e.i.get(l),d=l.startTime<=i&&l.endTime>i,h=u?u.wh:null;u&&(a.push(u.jf),u.uc&&a.push(u.uc),d||(s=!0,e.i.delete(l),u=null)),d&&(o.push(l),u?vd(e,h)||(s=!0):(_d(e,l,r),u=e.i.get(l),h=u.wh,s=!0)),0<l.nestedCues.length&&h&&yd(e,l.nestedCues,h,i,r),r.pop()}if(s){for(i=c(a),r=i.next();!r.done;r=i.next())r=r.value,r.parentElement&&r.parentElement.removeChild(r);for(o.sort(function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime-t.endTime}),o=c(o),l=o.next();!l.done;l=o.next())i=e.i.get(l.value),i.uc?(i.uc.contains(n)&&i.uc.removeChild(n),n.appendChild(i.uc),i.uc.appendChild(i.jf)):n.appendChild(i.jf)}}function bd(e,t){if(e.g){var n=e.A.currentTime;if(!e.m||void 0!==t&&t){t=c(e.B.values());for(var i=t.next();!i.done;i=t.next())gd(i.value);gd(e.g),e.i.clear(),e.B.clear()}e.m&&yd(e,e.h,e.g,n,[])}}function _d(e,t,n){var i=1<n.length,r=i?"span":"div";t.lineBreak&&(r="br"),t.rubyTag&&(r=t.rubyTag),i=!i&&0<t.nestedCues.length;var s=document.createElement(r);if("br"!=r&&Sd(e,s,t,n,i),n=null,t.region&&t.region.id){var a=t.region,o=e.l===4/3?2.5:1.9;if(n=a.id+"_"+a.width+"x"+a.height+(a.heightUnits==Le?"%":"px")+"-"+a.viewportAnchorX+"x"+a.viewportAnchorY+(a.viewportAnchorUnits==Le?"%":"px"),e.B.has(n))n=e.B.get(n);else{r=document.createElement("span");var l=a.heightUnits==Le?"%":"px",u=a.widthUnits==Le?"%":"px",c=a.viewportAnchorUnits==Le?"%":"px";r.id="shaka-text-region---"+n,r.classList.add("shaka-text-region"),r.style.position="absolute",r.style.height=2===a.heightUnits?5.33*a.height+"%":a.height+l,r.style.width=2===a.widthUnits?a.width*o+"%":a.width+u,2===a.viewportAnchorUnits?(l=a.viewportAnchorY/75*100,u=a.viewportAnchorX/(e.l===4/3?160:210)*100,l-=a.regionAnchorY*a.height*5.33/100,u-=a.regionAnchorX*a.width*o/100,r.style.top=l+"%",r.style.left=u+"%"):(r.style.top=a.viewportAnchorY-a.regionAnchorY*a.height/100+c,r.style.left=a.viewportAnchorX-a.regionAnchorX*a.width/100+c),0!==a.heightUnits&&0!==a.widthUnits&&0!==a.viewportAnchorUnits&&(a=Math.max(0,Math.min(100-(parseInt(r.style.width.slice(0,-1),10)||0),parseInt(r.style.left.slice(0,-1),10)||0)),r.style.top=Math.max(0,Math.min(100-(parseInt(r.style.height.slice(0,-1),10)||0),parseInt(r.style.top.slice(0,-1),10)||0))+"%",r.style.left=a+"%"),r.style.display="flex",r.style.flexDirection="column",r.style.alignItems="center",r.style.justifyContent="before"==t.displayAlign?"flex-start":"center"==t.displayAlign?"center":"flex-end",e.B.set(n,r),n=r}}r=s,i&&(r=document.createElement("span"),r.classList.add("shaka-text-wrapper"),r.style.backgroundColor=t.backgroundColor,r.style.lineHeight="normal",s.appendChild(r)),e.i.set(t,{jf:s,wh:r,uc:n})}function Td(e){var t=e.direction,n=e.positionAlign;return e=e.textAlign,n!==He?n:"left"===e||"start"===e&&t===We||"end"===e&&"rtl"===t?"line-left":"right"===e||"start"===e&&"rtl"===t||"end"===e&&t===We?"line-right":"center"}function Sd(e,t,n,i,r){var s=t.style,a=0==n.nestedCues.length,o=1<i.length;s.whiteSpace="pre-wrap";var l=n.payload.replace(/\s+$/g,function(e){return"".repeat(e.length)});if(s.webkitTextStrokeColor=n.textStrokeColor,s.webkitTextStrokeWidth=n.textStrokeWidth,s.color=n.color,s.direction=n.direction,s.opacity=n.opacity,s.paddingLeft=wd(n.linePadding,n,e.s),s.paddingRight=wd(n.linePadding,n,e.s),s.textCombineUpright=n.textCombineUpright,s.textShadow=n.textShadow,n.backgroundImage)s.backgroundImage="url('"+n.backgroundImage+"')",s.backgroundRepeat="no-repeat",s.backgroundSize="contain",s.backgroundPosition="center",n.backgroundColor&&(s.backgroundColor=n.backgroundColor),s.width="100%",s.height="100%";else{if(n.nestedCues.length)var u=t;else u=document.createElement("span"),t.appendChild(u);n.border&&(u.style.border=n.border),!r&&((t=Ed(i,function(e){return e.backgroundColor}))?u.style.backgroundColor=t:l&&(u.style.backgroundColor="rgba(0, 0, 0, 0.8)"),t=Ed(i,function(e){return e.fontFamily}))&&(u.style.fontFamily=t),l&&(u.textContent=l)}o&&!i[i.length-1].isContainer?s.display="inline":(s.display="flex",s.flexDirection="column",s.alignItems="center","left"==n.textAlign||"start"==n.textAlign?(s.width="100%",s.alignItems="start"):"right"!=n.textAlign&&"end"!=n.textAlign||(s.width="100%",s.alignItems="end"),s.justifyContent="before"==n.displayAlign?"flex-start":"center"==n.displayAlign?"center":"flex-end"),a||(s.margin="0"),s.fontFamily=n.fontFamily,s.fontWeight=n.fontWeight.toString(),s.fontStyle=n.fontStyle,s.letterSpacing=n.letterSpacing,s.fontSize=wd(n.fontSize,n,e.s),i=n.line,null!=i&&(a=n.lineInterpretation,a==Ye&&(a=1,o=16,e.l&&1>e.l&&(o=32),i=0>i?100+i/o*100:i/o*100),1==a&&(s.position="absolute",n.writingMode==Ke?(s.width="100%",n.lineAlign==Xe?s.top=i+"%":"end"==n.lineAlign&&(s.bottom=100-i+"%")):"vertical-lr"==n.writingMode?(s.height="100%",n.lineAlign==Xe?s.left=i+"%":"end"==n.lineAlign&&(s.right=100-i+"%")):(s.height="100%",n.lineAlign==Xe?s.right=i+"%":"end"==n.lineAlign&&(s.left=100-i+"%")))),s.lineHeight=n.lineHeight,e=Td(n),"line-left"==e?(s.cssFloat="left",null!==n.position&&(s.position="absolute",n.writingMode==Ke?(s.left=n.position+"%",s.width="auto"):s.top=n.position+"%")):"line-right"==e?(s.cssFloat="right",null!==n.position&&(s.position="absolute",n.writingMode==Ke?(s.right=n.position+"%",s.width="auto"):s.bottom=n.position+"%")):null!==n.position&&50!=n.position&&(s.position="absolute",n.writingMode==Ke?(s.left=n.position+"%",s.width="auto"):s.top=n.position+"%"),s.textAlign=n.textAlign,s.textDecoration=n.textDecoration.join(" "),s.writingMode=n.writingMode,"writingMode"in document.documentElement.style&&s.writingMode==n.writingMode||(s.webkitWritingMode=n.writingMode),n.size&&(n.writingMode==Ke?s.width=n.size+"%":s.height=n.size+"%")}function wd(e,t,n){var i=(i=new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(e))?{value:Number(i[1]),unit:i[2]}:null;if(!i)return e;var r=i.value;switch(i.unit){case"%":return r/100*n.clientHeight/t.cellResolution.rows+"px";case"c":return n.clientHeight*r/t.cellResolution.rows+"px";default:return e}}function Ed(e,t){for(var n=e.length-1;0<=n;n--){var i=t(e[n]);if(i||0===i)return i}return null}function xd(e,t){function n(e){for(var n=e,i=c(t),r=i.next();!r.done;r=i.next())r=r.value,r.end&&r.start<e&&(n+=r.end-r.start);return e=Math.floor(n/3600),i=Math.floor(n/60%60),r=Math.floor(n%60),n=Math.floor(1e3*n%1e3),(10>e?"0":"")+e+":"+(10>i?"0":"")+i+":"+(10>r?"0":"")+r+"."+(100>n?10>n?"00":"0":"")+n}var i=ld(e);e="WEBVTT\n\n",i=c(i);for(var r=i.next();!r.done;r=i.next())r=r.value,e+=n(r.startTime)+" --\x3e "+n(r.endTime)+function(e){var t=[];switch(e.textAlign){case"left":t.push("align:left");break;case"right":t.push("align:right");break;case $e:t.push("align:middle");break;case"start":t.push("align:start");break;case"end":t.push("align:end")}switch(e.writingMode){case"vertical-lr":t.push("vertical:lr");break;case"vertical-rl":t.push("vertical:rl")}return t.length?" "+t.join(" "):""}(r)+"\n",e+=r.payload+"\n\n";return e}function kd(e,t){this.h=e,this.g=t,this.m=void 0,this.i=!1,this.l=!0,this.j=!1}function Ad(e){e.i=!1,e.l=!0,e.j=!1}function Id(e,t,n){try{if(!e.g.enabled)return t;var i=Cd(e);e:{switch(n.toLowerCase()){case"audio/mp4":case"audio/webm":case"audio/ogg":case"audio/mpeg":case"audio/aac":case"audio/flac":case"audio/wav":var r=jd;break e;case"video/webm":case"video/mp4":case"video/mpeg":case"video/mp2t":r=Hd;break e;case"application/x-mpegurl":case"application/vnd.apple.mpegurl":case"application/dash+xml":case"video/vnd.mpeg.dash.mpd":case"application/vnd.ms-sstr+xml":r=Bd;break e}r=void 0}i.ot=r,i.su=!0;var s=Nd(i);return Fd(t,s)}catch(e){return J("CMCD_SRC_ERROR","Could not generate src CMCD data.",e),t}}function Cd(t){return t.g.sessionId||(t.g.sessionId=e.crypto.randomUUID()),{v:1,sf:t.m,sid:t.g.sessionId,cid:t.g.contentId,mtp:t.h.getBandwidthEstimate()/1e3}}function Dd(e,t,n){n=void 0===n?{}:n;var i=void 0===i?e.g.useHeaders:i;if(e.g.enabled){Object.assign(n,Cd(e)),n.pr=e.h.fb();var r=n.ot===Vd||n.ot===Hd;if(e.j&&r&&(n.bs=!0,n.su=!0,e.j=!1),null==n.su&&(n.su=e.l),e=Rd(e,n),i)i=Ud(e),Object.keys(i).length&&Object.assign(t.headers,i);else{var s=Nd(e);s&&(t.uris=t.uris.map(function(e){return Fd(e,s)}))}}}function Rd(e,t){var n=e.g.includeKeys;return n.length?Object.keys(t).reduce(function(e,i){return n.includes(i)&&(e[i]=t[i]),e},{}):t}function Md(e){if(0===e.type)return $d;if(e=e.stream){var t=e.type;if("video"==t)return e.codecs&&e.codecs.includes(",")?Hd:Vd;if("audio"==t)return jd;if("text"==t)return"application/mp4"===e.mimeType?zd:Gd}}function Ld(e,t){if(t=e.h.yb()[t],!t.length)return NaN;var n=e.h.getCurrentTime();return(e=t.find(function(e){return e.start<=n&&e.end>=n}))?1e3*(e.end-n):NaN}function Pd(e,t){if(t=e.h.yb()[t],!t.length)return 0;var n=e.h.getCurrentTime();return(e=t.find(function(e){return e.start<=n&&e.end>=n}))?1e3*(e.end-n):0}function Od(e,t){var n=e.h.oc();if(!n.length)return NaN;e=n[0],n=c(n);for(var i=n.next();!i.done;i=n.next())i=i.value,"variant"===i.type&&i.bandwidth>e.bandwidth&&(e=i);switch(t){case Vd:return e.videoBandwidth||NaN;case jd:return e.audioBandwidth||NaN;default:return e.bandwidth}}function Nd(e){function t(e){return 100*n(e/100)}function n(e){return Math.round(e)}function i(e){return!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e}var r=[],s={br:n,d:n,bl:t,dl:t,mtp:t,nor:function(e){return encodeURIComponent(e)},rtp:t,tb:n},a=Object.keys(e||{}).sort();a=c(a);for(var o=a.next();!o.done;o=a.next()){o=o.value;var l=e[o];if(i(l)&&("v"!==o||1!==l)&&("pr"!=o||1!==l)){var u=s[o];u&&(l=u(l)),u=typeof l;var d=void 0;d="string"===u&&"ot"!==o&&"sf"!==o&&"st"!==o?o+"="+JSON.stringify(l):"boolean"===u?o:"symbol"===u?o+"="+l.description:o+"="+l,r.push(d)}}return r.join(",")}function Ud(e){var t=Object.keys(e),n={},i=["Object","Request","Session","Status"],r=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};t=c(t);for(var a=t.next();!a.done;a=t.next())a=a.value,r[null!=s[a]?s[a]:1][a]=e[a];for(e=0;e<r.length;e++)(s=Nd(r[e]))&&(n["CMCD-"+i[e]]=s);return n}function Fd(e,t){return!t||e.includes("offline:")?e:(e=new ht(e),e.g.set("CMCD",t),e.toString())}i=dd.prototype,i.configure=function(){},i.remove=function(e,t){return!!this.g&&(hd(this.g,function(n){return n.startTime<t&&n.endTime>e}),!0)},i.append=function(e){var t=ld(e),n=[];e=this.g.cues?Array.from(this.g.cues):[];var i={};t=c(t);for(var r=t.next();!r.done;i={Cc:i.Cc},r=t.next())i.Cc=r.value,e.some(function(e){return function(t){return t.startTime==e.Cc.startTime&&t.endTime==e.Cc.endTime&&t.text==e.Cc.payload}}(i))||(r=cd(i.Cc))&&n.push(r);for(e=n.slice().sort(function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime!=t.endTime?e.endTime-t.startTime:"line"in VTTCue.prototype?n.indexOf(t)-n.indexOf(e):n.indexOf(e)-n.indexOf(t)}),e=c(e),i=e.next();!i.done;i=e.next())this.g.addCue(i.value)},i.destroy=function(){return this.g&&(hd(this.g,function(){return!0}),this.g.mode="disabled"),this.g=null,Promise.resolve()},i.isTextVisible=function(){return"showing"==this.g.mode},i.setTextVisibility=function(e){this.g.mode=e?"showing":"hidden"},G("shaka.text.SimpleTextDisplayer",dd),dd.prototype.setTextVisibility=dd.prototype.setTextVisibility,dd.prototype.isTextVisible=dd.prototype.isTextVisible,dd.prototype.destroy=dd.prototype.destroy,dd.prototype.append=dd.prototype.append,dd.prototype.remove=dd.prototype.remove,dd.prototype.configure=dd.prototype.configure,i=fd.prototype,i.configure=function(){},i.remove=function(){},i.append=function(){},i.destroy=function(){},i.isTextVisible=function(){return!1},i.setTextVisibility=function(){},G("shaka.text.StubTextDisplayer",fd),fd.prototype.setTextVisibility=fd.prototype.setTextVisibility,fd.prototype.isTextVisible=fd.prototype.isTextVisible,fd.prototype.destroy=fd.prototype.destroy,fd.prototype.append=fd.prototype.append,fd.prototype.remove=fd.prototype.remove,fd.prototype.configure=fd.prototype.configure,G("shaka.util.Dom",pd),pd.removeAllChildren=gd,i=md.prototype,i.configure=function(e){this.C&&this.C.Sa(e.captionsUpdatePeriod)},i.append=function(e){var t=[].concat(d(this.h)),n={};e=c(ud(e));for(var i=e.next();!i.done;n={Td:n.Td},i=e.next())n.Td=i.value,t.some(function(e){return function(t){return Ve(t,e.Td)}}(n))||this.h.push(n.Td);bd(this)},i.destroy=function(){return this.g?(this.s.removeChild(this.g),this.g=null,this.m=!1,this.h=[],this.C&&this.C.stop(),this.i.clear(),this.j&&(this.j.release(),this.j=null),this.o&&(this.o.disconnect(),this.o=null),Promise.resolve()):Promise.resolve()},i.remove=function(e,t){if(!this.g)return!1;var n=this.h.length;return this.h=this.h.filter(function(n){return n.startTime<e||n.endTime>=t}),bd(this,n>this.h.length),!0},i.isTextVisible=function(){return this.m},i.setTextVisibility=function(e){this.m=e},G("shaka.text.UITextDisplayer",md),md.prototype.setTextVisibility=md.prototype.setTextVisibility,md.prototype.isTextVisible=md.prototype.isTextVisible,md.prototype.remove=md.prototype.remove,md.prototype.destroy=md.prototype.destroy,md.prototype.append=md.prototype.append,md.prototype.configure=md.prototype.configure,G("shaka.text.WebVttGenerator",function(){}),kd.prototype.configure=function(e){this.g=e};var Bd="m",jd="a",Vd="v",Hd="av",$d="i",Gd="c",zd="tt";function qd(e){this.h=e,this.g=null}function Wd(e){return!e||"false"!==e.toLowerCase()&&(/^[-0-9]/.test(e)?parseInt(e,10):e.replace(/["]+/g,""))}G("shaka.util.CmcdManager.StreamingFormat",{DASH:"d",HLS:"h",yh:"s",OTHER:"o"}),i=qd.prototype,i.configure=function(e){this.h=e},i.Ng=function(){return this.h.enabled&&this.h.applyMaximumSuggestedBitrate&&this.g&&this.g.has(Yd)?1e3*this.g.get(Yd):null},i.Lg=function(){return this.h.enabled&&this.g&&this.g.has(Kd)?1e3*this.g.get(Kd):null},i.ei=function(){return this.h.enabled&&this.g&&this.g.has(Xd)?this.g.get(Xd):null},i.fi=function(){return this.h.enabled&&this.g&&this.g.has(Qd)?this.g.get(Qd):null},i.getBandwidthEstimate=function(e){var t=this.Lg();if(!t)return e;var n=this.h.estimatedThroughputWeightRatio;return 0<n&&1>=n?e*(1-n)+t*n:e},G("shaka.util.CmsdManager",qd),qd.prototype.getBandwidthEstimate=qd.prototype.getBandwidthEstimate,qd.prototype.getRoundTripTime=qd.prototype.fi,qd.prototype.getResponseDelay=qd.prototype.ei,qd.prototype.getEstimatedThroughput=qd.prototype.Lg,qd.prototype.getMaxBitrate=qd.prototype.Ng;var Kd="etp",Yd="mb",Xd="rd",Qd="rtt";function Zd(){this.g=null,this.h=[]}function Jd(e,t){return N(function(n){if(1==n.g)return e.g?S(n,new Promise(function(t){return e.h.push(t)}),2):n.u(2);e.g=t,w(n)})}function eh(t,n){Br.call(this);var i=this;this.l=gf,this.ze=this.h=null,this.pa=!1,this.Je=new se,this.zd=new se,this.m=new se,this.Fa=new se,this.wb=new se,this.C=this.G=this.B=this.H=null,this.Le=0,this.Z=new Zd,this.qa=this.pg=this.da=this.i=this.bb=this.F=this.j=this.rd=this.K=this.tg=this.ea=this.N=this.wd=this.L=this.Ce=this.I=this.Hb=null,this.Ea=!1,this.xa=this.o=null,this.rg=1e9,this.Hd=[],this.U=NaN,this.g=Bh(this),this.R=null,this.Ne=-1,this.Da=null,this.fa={width:1/0,height:1/0},this.xe=new Na(this.g,this.fa,null),this.Fe=[],this.s=null,this.za=new dr(this.g.preferredAudioLanguage,this.g.preferredVariantRole,this.g.preferredAudioChannelCount,this.g.preferredVideoHdrLevel,this.g.preferSpatialAudio,this.g.preferredVideoLayout,this.g.preferredAudioLabel,this.g.preferredVideoLabel,this.g.mediaSource.codecSwitchingStrategy,this.g.manifest.dash.enableAudioGroups),this.Fb=this.g.preferredTextLanguage,this.Gd=this.g.preferredTextRole,this.Fd=this.g.preferForcedSubs,this.Ed=[],n&&n(this),this.N=Ih(this),this.ea=new qd(this.g.cmsd),this.H=Sh(this),this.H.fg(this.g.streaming.forceHTTP),this.H.gg(this.g.streaming.forceHTTPS),this.Ib=this.aa=this.A=null,this.Ye=!1,this.sg=new Ut(function(){return N(function(e){return 1==e.g?i.aa?S(e,i.Ub(i.Ib,!0),3):e.u(0):4!=e.g?S(e,i.load(i.aa),4):(i.Ye?i.Ib.pause():i.Ib.play(),i.aa=null,i.Ye=!1,void w(e))})}),_f&&(this.A=_f(),this.A.configure(this.g.ads),this.wb.D(this.A,"ad-content-pause-requested",function(e){var t,n;return N(function(r){if(1==r.g)return i.sg.stop(),i.aa?r.u(0):(i.Ib=i.h,i.Ye=i.h.ended,t=e.saveLivePosition||!1,n=i,S(r,i.Eg(!0,t),3));n.aa=r.h,w(r)})}),this.wb.D(this.A,"ad-content-resume-requested",function(e){if(e=e.offset||0,i.aa){var t=i.aa;t.A&&e&&(t.A+=e)}i.sg.Y(.1)}),this.wb.D(this.A,"ad-content-attach-requested",function(){return N(function(e){return i.h||!i.Ib?e.u(0):S(e,i.Ub(i.Ib,!0),0)})})),this.Je.D(e,"online",function(){sf(i),i.Zf()}),this.Ee=new Ut(function(){for(var e=Date.now()/1e3,t=!1,n=!0,r=c(i.i.variants),s=r.next();!s.done;s=r.next())s=s.value,0<s.disabledUntilTime&&s.disabledUntilTime<=e&&(s.disabledUntilTime=0,t=!0),0<s.disabledUntilTime&&(n=!1);n&&i.Ee.stop(),t&&Yh(i,!1,void 0,!1,!1)}),this.ra=null,t&&(pe("Player w/ mediaElement","Please migrate from initializing Player with a mediaElement; use the attach method instead."),this.Ub(t,!0))}function th(e){null!=e.K&&(zo(e.K),e.K.release(),e.K=null)}function nh(e,t){t.lcevc.enabled?(th(e),null==e.K&&(e.K=new Go(e.h,e.tg,t.lcevc),e.G&&(e.G.Z=e.K))):th(e)}function ih(e,t){return new Nr(e,t)}function rh(e,t){e.dispatchEvent(ih("onstatechange",(new Map).set("state",t)))}function sh(e,t){var n;return N(function(i){return 1==i.g?(n=++e.Le,S(i,Jd(e.Z,t),2)):n!=e.Le?(e.Z.release(),i.return(!0)):i.return(!1)})}function ah(e){for(var t=c(e.i.variants),n=t.next();!n.done;n=t.next())n=n.value,n.video&&(n.video.closeSegmentIndex(),n.video=null),n.bandwidth=n.audio&&n.audio.bandwidth?n.audio.bandwidth:0;e.i.variants=e.i.variants.filter(function(e){return e.audio})}function oh(e,t){var n,i;return t=void 0!==t&&t,N(function(r){if(1==r.g)return n=null,e.i&&e.F&&e.bb&&e.da?(i=e.h.currentTime,e.V()&&!t&&(i=null),S(r,uh(e,e.da,i,e.pg,!0,!1,!1),3)):r.u(2);if(2!=r.g){n=r.h,e.Fe.push(n),e.F&&e.F.setMediaElement&&e.F.setMediaElement(null);var s=n,a=e.F,o=e.bb;s.h=e.i,s.j=a,s.F=o,s=n,a=e.xa,s.i=e.o,s.B=a,n.o=e.za,n.start(),e.i=null,e.F=null,e.bb=null,e.o=null,e.xa=null}return r.return(n)})}function lh(e,t,n,i,r){var s,a,o;return r=void 0!==r&&r,N(function(l){return 1==l.g?i?l.u(2):S(l,ch(e,t),3):(2!=l.g&&(i=l.h),dh(e,i)?l.return(null):(s=!1,a=!0,r&&(e.o&&e.xa==e.g.abrFactory&&(a=!1),e.h&&"AUDIO"===e.h.nodeName&&(s=!0)),o=uh(e,t,n,i||null,!r,s,a),r||(o=o.then(function(t){return e.Fe.push(t),t})),l.return(o)))})}function uh(e,t,n,i,r,s,a){var o,l,u,d,h,f,p,g,m,v,y,b,_,T,E;return r=void 0===r||r,s=void 0!==s&&s,a=void 0===a||a,N(function(x){return 1==x.g?(o=null,l=yi(e.g),s&&(l.manifest.disableVideo=!0),u=function(){return o.R&&o.s?null:o},d=function(){return u()?u().getConfiguration():e.g},h=function(t,n){u()?o.configure(t,n):e.configure(t,n)},1/0!=e.fa.width||1/0!=e.fa.height?x.u(2):S(x,ln(),3)):(2!=x.g&&(f=x.h,e.fa.width=f.width,e.fa.height=f.height),p=new Na(l,e.fa,null),g={networkingEngine:e.H,filter:function(e){var t,n;return N(function(i){return 1==i.g?S(i,Ua(p,e),2):4!=i.g?(t=i.h,t?(n=ih("trackschanged"),S(i,Promise.resolve(),4)):i.u(0)):(o.dispatchEvent(n),void w(i))})},makeTextStreamsForClosedCaptions:function(t){return jh(e,t)},onTimelineRegionAdded:function(e){var t=o.G;e:{for(var n=c(t.g),i=n.next();!i.done;i=n.next())if(i=i.value,i.schemeIdUri==e.schemeIdUri&&i.id==e.id&&i.startTime==e.startTime&&i.endTime==e.endTime){n=i;break e}n=null}null==n&&(t.g.add(e),e=new Nr("regionadd",new Map([["region",e]])),t.dispatchEvent(e))},onEvent:function(e){return o.dispatchEvent(e)},onError:function(e){return o.onError(e)},isLowLatencyMode:function(){return d().streaming.lowLatencyMode},isAutoLowLatencyMode:function(){return d().streaming.autoLowLatencyMode},enableLowLatencyMode:function(){h("streaming.lowLatencyMode",!0)},updateDuration:function(){e.j&&o.R&&e.j.updateDuration()},newDrmInfo:function(e){var t=o.l,n=t?t.g:null;n&&t.s&&Ba(p,n.keySystem,e)},onManifestUpdated:function(){var t=(new Map).set("isLive",e.V());o.dispatchEvent(ih("manifestupdated",t)),Bc(o,!1,function(){e.A&&e.A.onManifestUpdated(e.V())})},getBandwidthEstimate:function(){return e.o.getBandwidthEstimate()},onMetadata:function(t,n,i,r){var s=t;"com.apple.hls.interstitial"==t&&(s="com.apple.quicktime.HLS",t={startTime:n,endTime:i,values:r},e.A)&&e.A.onInterstitialMetadata(e,e.h,t),t={},r=c(r);for(var a=r.next();!a.done;t={Re:t.Re},a=r.next())t.Re=a.value,Bc(o,!1,function(t){return function(){_h(e,n,i,s,t.Re)}}(t))},disableStream:function(t){return e.disableStream(t,e.g.streaming.maxDisabledTime)}},m=new Au(function(){return e.Qb()}),m.addEventListener("regionadd",function(t){var n=t.region;of(e,"timelineregionadded",n,o),Bc(o,!1,function(){e.A&&e.A.onDashTimedMetadata(n)})}),v=null,l.streaming.observeQualityChanges&&(v=new Iu(function(){return e.yb()}),v.addEventListener("qualitychange",function(t){lf(e,t.quality,t.position)}),v.addEventListener("audiotrackchange",function(t){lf(e,t.quality,t.position,!0)})),y=!0,b={Nb:e.H,onError:function(e){return o.onError(e)},Ae:function(t){Bc(o,!0,function(){var n=t,i=ih("keystatuschanged");e.dispatchEvent(i);var r=Object.keys(n);1==r.length&&""==r[0]&&(r=["00"],n={"00":n[""]}),i=1==r.length&&"00"==r[0];var s=!1;if(r.length){r=c(e.i.variants);for(var a=r.next();!a.done;a=r.next()){a=a.value;var o=[];a.audio&&o.push(a.audio),a.video&&o.push(a.video),o=c(o);for(var l=o.next();!l.done;l=o.next()){var u=l.value;if(l=a.allowedByKeySystem,u.keyIds.size){a.allowedByKeySystem=!0,u=c(u.keyIds);for(var d=u.next();!d.done;d=u.next())d=d.value,((d=n[i?"00":d])||e.B.F)&&(a.allowedByKeySystem=a.allowedByKeySystem&&!!d&&!Va.includes(d))}l!=a.allowedByKeySystem&&(s=!0)}}}s&&(Jh(e),!Wh(e))||(n=e.j.j)&&!n.allowedByKeySystem&&Yh(e)})},onExpirationUpdated:function(e,t){var n=ih("expirationupdated");o.dispatchEvent(n),(n=o.j)&&n.onExpirationUpdated&&n.onExpirationUpdated(e,t)},onEvent:function(t){o.dispatchEvent(t),"drmsessionupdate"==t.type&&y&&(y=!1,t=Date.now()/1e3-o.ra,(e.s||o.getStats()).j=t,e.K&&zo(e.K))}},_=Sh(e,u),Gr(e.H,_),T=function(){return e.Dc(b)},E={config:l,Di:g,Mi:m,Li:v,Dc:T,Ci:p,networkingEngine:_,Fh:r,Eh:a},o=new Fc(t,i,n,E),x.return(o))})}function ch(e,t){var n,i;return N(function(r){return 1==r.g?(n=e.g.manifest.retryParameters,S(r,rd(t,e.H,n),2)):(i=r.h,"application/x-mpegurl"==i&&Yt()&&(i="application/vnd.apple.mpegurl"),r.return(i))})}function dh(e,t){if(!Ft())return!0;if(t){if(""==(e.h||an()).canPlayType(t))return!1;if(!(Ft()&&t in Ga))return!0;if(Wn(t))return Yt()&&(e.g.drm.servers["com.apple.fps"]||e.g.drm.servers["com.apple.fps.1_0"])?e.g.streaming.useNativeHlsForFairPlay:e.g.streaming.preferNativeHls}return!1}function hh(e){var t,n,i,r,s;return N(function(a){if(1==a.g)return rh(e,"media-source"),t=e.g.textDisplayFactory,n=t(),n.configure?n.configure(e.g.textDisplayer):pe("Text displayer w/ configure",'Text displayer should have a "configure" method!'),e.qg=t,i=Ah(e.h,n,{Xh:function(){return e.keySystem()},onMetadata:function(t,n,i){bh(e,t,n,i)}},e.K),i.configure(e.g.mediaSource),r=e.g.manifest,s=r.segmentRelativeVttTiming,i.fa=s,S(a,i.L,2);e.G=i,w(a)})}function fh(e,t,n,i){var r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,E,x,k,A,I;return N(function(C){switch(C.g){case 1:rh(e,"load"),r=e.h,e.I=new su({ie:function(){return r.playbackRate},nc:function(){return r.defaultPlaybackRate},hg:function(e){r.playbackRate=e},Yg:function(e){r.currentTime+=e}}),s=function(){return Gh(e)},a=function(){return $h(e)},e.m.D(r,"playing",s),e.m.D(r,"pause",s),e.m.D(r,"ended",s),e.m.D(r,"ratechange",a),nh(e,e.g),e.Fb=e.g.preferredTextLanguage,e.Gd=e.g.preferredTextRole,e.Fd=e.g.preferForcedSubs,cf(e.i.presentationTimeline,e.g.playRangeStart,e.g.playRangeEnd),e.o.init(function(t,n,i){e.i&&e.j&&t!=e.j.j&&Xh(e,t,!0,void 0!==n&&n,void 0===i?0:i)}),e.o.setMediaElement(r),e.o.setCmsdManager(e.ea),e.j=Ch(e),e.j.configure(e.g.streaming),e.l=mf,r.textTracks&&e.m.D(r.textTracks,"addtrack",function(t){if(t.track)switch(t=t.track,t.kind){case"chapters":Th(e,t)}}),e.dispatchEvent(ih("streaming")),o=n;case 2:for((u=e.j.j)||o||(o=Kh(e,!0)),d=[],l=u||o,h=c([l.video,l.audio]),f=h.next();!f.done;f=h.next())(p=f.value)&&!p.segmentIndex&&d.push(p.createSegmentIndex());if(!(0<d.length)){C.u(4);break}return S(C,Promise.all(d),4);case 4:if(!l||0!=l.disabledUntilTime){C.u(2);break}if(e.F&&e.F.onInitialVariantChosen&&e.F.onInitialVariantChosen(l),e.i.isLowLatency&&!e.g.streaming.lowLatencyMode&&Z("Low-latency live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."),cf(e.i.presentationTimeline,e.g.playRangeStart,e.g.playRangeEnd),$u(e.j,e.g.playRangeStart,e.g.playRangeEnd),g=function(t){e.C=wh(e,t),e.Hb=Eh(e,t),xh(e,r,Math.max(e.i.minBufferTime,e.g.streaming.rebufferingGoal))},e.g.streaming.startAtSegmentBoundary||g(e.qa),u){C.u(7);break}if(!e.g.streaming.startAtSegmentBoundary){C.u(8);break}return m=e.i.presentationTimeline,v=e.qa||e.h.currentTime,y=m.Yb(),b=m.Ab(),v<y?v=y:v>b&&(v=b),S(C,Vh(o,v),9);case 9:_=C.h,g(_);case 8:Xh(e,o,!0,!1,0);case 7:return e.C.$e(),T=e.Hc().find(function(e){return e.active}),T||((E=Ki(e.i.textStreams,e.Fb,e.Gd,e.Fd)[0]||null)&&fu(e.s.h,E,!0),o&&(E?(Zh(e,o.audio,E)&&(e.pa=!0),e.pa&&e.G.F.setTextVisibility(!0),nf(e)):e.pa=!1),E&&(e.g.streaming.alwaysStreamText||e.Kf())&&Ku(e.j,E)),S(C,e.j.start(i),10);case 10:e.g.abr.enabled&&(e.o.enable(),rf(e)),Jh(e),Wh(e),e.i.variants.some(function(e){return e.primary}),((x=e.V())&&(e.g.streaming.liveSync&&e.g.streaming.liveSync.enabled||e.i.serviceDescription||e.g.streaming.liveSync.panicMode)||e.g.streaming.vodDynamicPlaybackRate)&&(k=function(){return zh(e)},e.m.D(r,"timeupdate",k)),x||(A=function(){return qh(e)},e.m.D(r,"timeupdate",A),qh(e),e.i.nextUrl&&(0<e.g.streaming.preloadNextUrlWindow&&(I=function(){var t,n;return N(function(i){if(1==i.g)return t=e.h.duration-e.h.currentTime,!isNaN(t)&&t<=e.g.streaming.preloadNextUrlWindow?(e.m.lb(r,"timeupdate",I),n=e,S(i,e.preload(e.i.nextUrl),4)):i.u(0);n.ra=i.h,w(i)})},e.m.D(r,"timeupdate",I)),e.m.D(r,"ended",function(){e.load(e.ra||e.i.nextUrl)}))),e.A&&e.A.onManifestUpdated(x),e.Ea=!0,e.m.ha(r,"loadedmetadata",function(){e.s.m=Date.now()/1e3-t}),w(C)}})}function ph(e,t){var n,i,r,s,a;return N(function(o){return 1==o.g?(n=Pn,i=Date.now()/1e3,r=!0,e.B=e.Dc({Nb:e.H,onError:function(t){af(e,t)},Ae:function(){},onExpirationUpdated:function(){var t=ih("expirationupdated");e.dispatchEvent(t)},onEvent:function(t){e.dispatchEvent(t),"drmsessionupdate"==t.type&&r&&(r=!1,e.s.j=Date.now()/1e3-i)}}),e.B.configure(e.g.drm),s={id:0,language:"und",disabledUntilTime:0,primary:!1,audio:null,video:null,bandwidth:100,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},a={id:0,originalId:null,groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:t?zn(t):"",codecs:t?qn(t):"",encrypted:!0,drmInfos:[],keyIds:new Set,language:"und",originalLanguage:null,label:null,type:n.ga,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,accessibilityPurpose:null,external:!1,fastSwitching:!1,fullMimeTypes:new Set},a.fullMimeTypes.add(Fn(a.mimeType,a.codecs)),t.startsWith("audio/")?(a.type=n.X,s.audio=a):s.video=a,e.B.aa=!0,S(o,na(e.B,[s],[]),2)):S(o,e.B.Ub(e.h),0)})}function gh(e,t,n){var i,r,s,a,o,l,u,c,d,h,f;return N(function(p){if(1==p.g)return rh(e,"src-equals"),i=e.h,e.C=new Yl(i),r=!1,e.Ed.push(function(){r=!0}),null!=e.qa&&e.C.af(e.qa),e.I=new su({ie:function(){return i.playbackRate},nc:function(){return i.defaultPlaybackRate},hg:function(e){i.playbackRate=e},Yg:function(e){i.currentTime+=e}}),s=e.g.streaming.rebufferingGoal,xh(e,i,s),a=function(){return Gh(e)},o=function(){return $h(e)},e.m.D(i,"playing",a),e.m.D(i,"pause",a),e.m.D(i,"ended",a),e.m.D(i,"ratechange",o),"none"!=i.preload&&e.m.ha(i,"loadedmetadata",function(){e.s.m=Date.now()/1e3-t}),i.audioTracks&&(e.m.D(i.audioTracks,"addtrack",function(){return Jh(e)}),e.m.D(i.audioTracks,"removetrack",function(){return Jh(e)}),e.m.D(i.audioTracks,"change",function(){return Jh(e)})),i.textTracks&&(e.m.D(i.textTracks,"addtrack",function(t){if(t.track)switch(t=t.track,t.kind){case"metadata":yh(e,t);break;case"chapters":Th(e,t);break;default:Jh(e)}}),e.m.D(i.textTracks,"removetrack",function(){return Jh(e)}),e.m.D(i.textTracks,"change",function(){return Jh(e)})),i.src=Id(e.N,e.da,n),(Ht()||zt())&&i.load(),"none"!=i.preload&&!i.autoplay&&Wn(n)&&en()&&i.load(),e.l=vf,e.dispatchEvent(ih("streaming")),l=new Ir,jl(i,HTMLMediaElement.HAVE_METADATA,e.m,function(){e.C.$e(),l.resolve()}),jl(i,HTMLMediaElement.HAVE_CURRENT_DATA,e.m,function(){var t;return N(function(n){return 1==n.g?(mh(e),t=Mh(e),t.find(function(e){return"disabled"!=e.mode})?(0<t.length&&(e.pa=!0),n.u(2)):S(n,new Promise(function(t){e.m.ha(i.textTracks,"change",t),new Ut(t).Y(1)}),2)):r?n.return():(vh(e),void w(n))})}),i.error?l.reject(uf(e)):"none"==i.preload&&(Z('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),l.resolve()),e.m.ha(i,"error",function(){l.reject(uf(e))}),u=new Promise(function(t,n){new Ut(n).Y(e.g.streaming.loadTimeout)}),S(p,Promise.race([l,u]),2);((c=e.V())&&(e.g.streaming.liveSync&&e.g.streaming.liveSync.enabled||e.g.streaming.liveSync.panicMode)||e.g.streaming.vodDynamicPlaybackRate)&&(d=function(){return zh(e)},e.m.D(i,"timeupdate",d)),c||(h=function(){return qh(e)},e.m.D(i,"timeupdate",h),qh(e)),e.A&&(e.A.onManifestUpdated(c),c&&(f=e.Qb().end,e.m.D(i,"progress",function(){var t=e.Qb().end;f!=t&&(e.A.onManifestUpdated(e.V()),f=t)}))),e.Ea=!0,w(p)})}function mh(e){var t=e.g.preferredAudioLanguage;""!=t&&e.gh(t,e.g.preferredVariantRole)}function vh(e){var t=e.g.preferredTextLanguage;""!=t&&e.bg(t,e.g.preferredTextRole,e.g.preferForcedSubs)}function yh(e,t){if("metadata"==t.kind){t.mode="hidden",e.m.D(t,"cuechange",function(){if(t.activeCues){for(var n=[],i={},r=c(t.activeCues),s=r.next();!s.done;i={Ma:i.Ma},s=r.next())i.Ma=s.value,_h(e,i.Ma.startTime,i.Ma.endTime,i.Ma.type,i.Ma.value),e.A&&e.A.onCueMetadataChange(i.Ma.value),"com.apple.quicktime.HLS"==i.Ma.type&&null!=i.Ma.startTime&&(s=n.find(function(e){return function(t){return t.startTime==e.Ma.startTime&&t.endTime==e.Ma.endTime}}(i)),s||(s={startTime:i.Ma.startTime,endTime:i.Ma.endTime,values:[]},n.push(s)),s.values.push(i.Ma.value));for(n=c(n),i=n.next();!i.done;i=n.next())i=i.value,i.values.some(function(e){return"X-ASSET-URI"==e.key||"X-ASSET-LIST"==e.key})&&e.A&&(i.values.push({key:"CUE",description:"",data:"ONCE",mimeType:null,pictureType:null}),e.A.onInterstitialMetadata(e,e.h,i))}});var n=new Ut(function(){var t=Lh(e);t=c(t);for(var n=t.next();!n.done;n=t.next())n.value.mode="hidden"}).xc().Y(.5);e.Ed.push(function(){n.stop()})}}function bh(e,t,n,i){t=c(t);for(var r=t.next();!r.done;r=t.next())if(r=r.value,r.data&&"number"==typeof r.cueTime&&r.frames){var s=r.cueTime+n,a=i;a&&s>a&&(a=s);for(var o=c(r.frames),l=o.next();!l.done;l=o.next())_h(e,s,a,"org.id3",l.value);e.A&&e.A.onHlsTimedMetadata(r,s)}}function _h(e,t,n,i,r){t=(new Map).set("startTime",t).set("endTime",n).set("metadataType",i).set("payload",r),e.dispatchEvent(ih("metadata",t))}function Th(e,t){if(t&&"chapters"==t.kind){t.mode="hidden";var n=new Ut(function(){t.mode="hidden"}).xc().Y(.5);e.Ed.push(function(){n.stop()})}}function Sh(e,t){function n(n){t()?t().dispatchEvent(n):e.dispatchEvent(n)}function i(e){t()?Bc(t(),!0,e):e()}return t||(t=function(){return null}),new Hr(function(n,i,r,s){var a=t()?t().i:e.o;a&&a.segmentDownloaded(n,i,r,s)},function(t,r,s){r=(new Map).set("headers",t).set("request",r).set("requestType",s),n(ih("downloadheadersreceived",r)),i(function(){if(e.ea){var n=e.ea;if(n.h.enabled){var i=t["cmsd-static"];if(i)try{var r=new Map,s=i.split(",");for(i=0;i<s.length;i++){var a=s[i].split("=");r.set(a[0],Wd(a[1]))}}catch(e){}if(r=t["cmsd-dynamic"]){try{var o=new Map,l=r.split(";");for(r=1;r<l.length;r++){var u=l[r].split("=");o.set(u[0],Wd(u[1]))}var c=o}catch(e){c=null}c&&(n.g=c)}}}})},function(e,t,i,r){e=(new Map).set("request",e).set("error",t).set("httpResponseCode",i).set("aborted",r),n(ih("downloadfailed",e))},function(t,n,r){i(function(){var i=e.N,s=r;if(s=void 0===s?{}:s,i.g.enabled)if("HEAD"===n.method)Dd(i,n);else switch(t){case 0:try{if(i.g.enabled){if(s.type){e:{switch(s.type){case 4:var a="d";break e;case 3:case 2:a="h";break e;case 5:a="s";break e}a=void 0}i.m=a}Dd(i,n,{ot:Bd,su:!i.i})}}catch(e){J("CMCD_MANIFEST_ERROR","Could not generate manifest CMCD data.",e)}break;case Zr:try{if(i.g.enabled){var o=s.segment;a=0,o&&(a=o.endTime-o.startTime);var l={d:1e3*a,st:i.h.V()?"l":"v"};l.ot=Md(s);var u=l.ot===Vd||l.ot===jd||l.ot===Hd||l.ot===zd,c=s.stream;if(c){var d=i.h.fb();if(u&&(l.bl=Ld(i,c.type),l.ot!==zd)){var h=Pd(i,c.type);l.dl=d?h/Math.abs(d):h}if(c.bandwidth&&(l.br=c.bandwidth/1e3),c.segmentIndex&&o){var f=c.segmentIndex.Kb(o.endTime,!0,0>d);if(f){var p=f.next().value;if(p&&p!=o){if(!Fe(o.M(),p.M())){var g=p.M()[0],m=n.uris[0],v=new URL(g),y=new URL(m);if(v.origin!==y.origin)var b=g;else{for(var _=v.pathname.split("/").slice(1),T=y.pathname.split("/").slice(1,-1);_[0]===T[0];)_.shift(),T.shift();for(;T.length;)T.shift(),_.unshift("..");b=_.join("/")}l.nor=b}if((p.Ha||p.sa)&&(o.Ha!=p.Ha||o.sa!=p.sa)){var S=p.Ha+"-";p.sa&&(S+=p.sa),l.nrr=S}}}var w=i.h.fb()||1,E=Pd(i,c.type)||500,x=c.bandwidth,k=x?x*(o.endTime-o.startTime)/1e3/(E/w/1e3)*i.g.rtpSafetyFactor:NaN;isNaN(k)||(l.rtp=k)}}u&&l.ot!==zd&&(l.tb=Od(i,l.ot)/1e3),Dd(i,n,l)}}catch(e){J("CMCD_SEGMENT_ERROR","Could not generate segment CMCD data.",e)}break;case 2:case 5:case 6:Dd(i,n,{ot:"k"});break;case 4:Dd(i,n,{ot:"o"})}})},function(n,i,r,s){(n=t()?t().j:e.F)&&n.banLocation&&n.banLocation(s)},function(n,i){if(i.data){i=i.data.byteLength;var r=t()?t().getStats():e.s;r&&(r.ae=isNaN(r.ae)?i:r.ae+i,0===n&&(r.Ug=i))}})}function wh(e,t){return new Xl(e.h,e.i,e.g.streaming,t,function(){e.Hb&&lu(e.Hb,!0),e.j&&e.j.Nd(),e.L&&kh(e)},function(t){return e.dispatchEvent(t)})}function Eh(e,t){t=new Jc(e.wd,e.V()||0<t),t.addEventListener("enter",function(t){of(e,"timelineregionenter",t.region)}),t.addEventListener("exit",function(t){of(e,"timelineregionexit",t.region)}),t.addEventListener("skip",function(t){var n=t.region;t.seeking||(of(e,"timelineregionenter",n),of(e,"timelineregionexit",n))});var n=new ou(e.h);return n.g.add(t),e.rd&&n.g.add(e.rd),n}function xh(e,t,n){e.L=new Tr,e.L.g=wr,Sr(e.L,n,Math.min(.5,n/2)),Hh(e),e.Ce=new Ut(function(){kh(e)}).Sa(.25),e.m.D(t,"waiting",function(){return kh(e)}),e.m.D(t,"stalled",function(){return kh(e)}),e.m.D(t,"canplaythrough",function(){return kh(e)}),e.m.D(t,"progress",function(){return kh(e)})}function kh(e){switch(e.l){case vf:if(e.h.ended)var t=!0;else{var n=no(e.h.buffered);t=null!=n&&n>=e.h.duration-1}break;case mf:e:if(e.h.ended||sl(e.G))t=!0;else{if(e.i.presentationTimeline.V()){n=e.i.presentationTimeline.Zb();var i=no(e.h.buffered);if(null!=i&&i>=n){t=!0;break e}}t=!1}break;default:t=!1}i=ro(e.h.buffered,e.h.currentTime),n=e.L;var r=t,s=n.i.get(n.g);t=n.g,i=r||i>=s?Er:wr,n.g=i,(t=t!=i)&&i===Er&&(n.h=Date.now()),t&&Hh(e)}function Ah(e,t,n,i){return new Jo(e,t,n,i)}function Ih(e){return new kd({getBandwidthEstimate:function(){return e.o?e.o.getBandwidthEstimate():NaN},yb:function(){return e.yb()},getCurrentTime:function(){return e.h?e.h.currentTime:0},fb:function(){return e.fb()},zb:function(){return e.zb()},oc:function(){return e.oc()},V:function(){return e.V()}},e.g.cmcd)}function Ch(e){return new Vu(e.i,{he:function(){return e.C?e.C.$d():0},getBandwidthEstimate:function(){return e.o.getBandwidthEstimate()},fb:function(){return e.fb()},ca:e.G,Nb:e.H,onError:function(t){return af(e,t)},onEvent:function(t){return e.dispatchEvent(t)},Ii:function(){e.F&&e.F.update&&e.F.update()},Sf:function(t,n){var i=t.startTime,r=t.endTime,s=n.type,a=n.codecs.includes(",");if(e.C){e.C.Zg();var o=al(e.G,s);!e.V()&&e.h.paused&&null!=o&&0<o&&e.C.$d()<o&&e.C.af(o)}kh(e),i=(new Map).set("start",i).set("end",r).set("contentType",s).set("isMuxed",a),e.dispatchEvent(ih("segmentappended",i)),e.o&&n.fastSwitching&&t.Kd&&t.pe&&e.o.trySuggestStreams()},Hi:function(t,n){(n=n.Lc)&&e.rd&&Du(e.rd,n,t)},yg:function(t,n){var i=e.B;if(i.h.parseInbandPsshEnabled&&!i.F&&["audio","video"].includes(t)){n=new Ts(Ee(n));var r=0,s=c(n.data);for(t=s.next();!t.done;t=s.next())r+=t.value.length;if(0==r)i=Promise.resolve();else{for(r=new Uint8Array(r),s=0,n=c(n.data),t=n.next();!t.done;t=n.next())t=t.value,r.set(t,s),s+=t.length;ca(i,"cenc",r),i=i.l}}else i=Promise.resolve();return i},onMetadata:function(t,n,i){bh(e,t,n,i)},disableStream:function(t,n){return e.disableStream(t,n)}})}function Dh(e){if(e.xe=new Na(e.g,e.fa,e.B),e.F){var t=yi(e.g.manifest);e.h&&"AUDIO"===e.h.nodeName&&(t.disableVideo=!0),e.F.configure(t)}if(e.B&&e.B.configure(e.g.drm),e.j){e.j.configure(e.g.streaming);try{e.l!=pf&&Fa(e.xe,e.i)&&Jh(e)}catch(t){af(e,t)}e.o&&Wh(e),t=e.j.j,!t||t.allowedByApplication&&t.allowedByKeySystem||Yh(e)}if(e.H&&(e.H.fg(e.g.streaming.forceHTTP),e.H.gg(e.g.streaming.forceHTTPS)),e.G)if(e.G.configure(e.g.mediaSource),e.G.fa=e.g.manifest.segmentRelativeVttTiming,t=e.g.textDisplayFactory,e.qg!=t){var n=t();n.configure?n.configure(e.g.textDisplayer):pe("Text displayer w/ configure",'Text displayer should have a "configure" method!');var i=e.G,r=i.F;i.F=n,r&&(n.setTextVisibility(r.isTextVisible()),r.destroy()),i.g&&(i.g.j=n),e.qg=t,e.j&&(t=e.j,(n=t.i.get(Ln))&&Yu(t,n.stream,!0,0,!0))}else t=e.G.F,t.configure&&t.configure(e.g.textDisplayer);e.o&&(e.o.configure(e.g.abr),e.g.abr.enabled?e.o.enable():e.o.disable(),rf(e)),e.L&&(t=e.g.streaming.rebufferingGoal,e.i&&(t=Math.max(t,e.i.minBufferTime)),Sr(e.L,t,Math.min(.5,t/2))),e.i&&cf(e.i.presentationTimeline,e.g.playRangeStart,e.g.playRangeEnd),e.A&&e.A.configure(e.g.ads),e.N&&e.N.configure(e.g.cmcd),e.ea&&e.ea.configure(e.g.cmsd)}function Rh(e){return e&&(e=/(\d+)x(\d+)/.exec(e))?{kc:parseInt(e[1],10),rows:parseInt(e[2],10)}:null}function Mh(e){return Array.from(e.h.textTracks).filter(function(e){return"metadata"!=e.kind&&"chapters"!=e.kind&&"Shaka Player TextTrack"!=e.label})}function Lh(e){return Array.from(e.h.textTracks).filter(function(e){return"metadata"==e.kind})}function Ph(e){return Array.from(e.h.textTracks).filter(function(e){return"chapters"==e.kind})}function Oh(e,t){var n;return N(function(i){switch(i.g){case 1:return E(i,2),S(i,rd(t,e.H,e.g.streaming.retryParameters),4);case 4:n=i.h,k(i,3);break;case 2:A(i);case 3:if(n)return i.return(n);throw new It(1,2,2011,t)}})}function Nh(e,t,n,i,r,s,a){var o,l,u,c;return N(function(d){if(1==d.g)return"text/vtt"!=r||a.length?S(d,Uh(e,t,e.H,e.g.streaming.retryParameters),3):d.u(2);2!=d.g&&(o=d.h,l=Fh(e,o,r,a),u=new Blob([l],{type:"text/vtt"}),t=Rl(u),r="text/vtt"),c=document.createElement("track");var h=e.N,f=t;try{if(h.g.enabled){var p=Cd(h);p.ot=Gd,p.su=!0;var g=Nd(p),m=Fd(f,g)}else m=f}catch(e){J("CMCD_TEXT_TRACK_ERROR","Could not generate text track CMCD data.",e),m=f}return c.src=m,c.label=s,c.kind=i,c.srclang=n,e.h.getAttribute("crossorigin")||e.h.setAttribute("crossorigin","anonymous"),e.h.appendChild(c),d.return(c)})}function Uh(e,t,n,i){var r,s,a;return N(function(o){if(1==o.g){r=Zr,s=zr([t],i),s.method="GET";var l=e.N;try{l.g.enabled&&Dd(l,s,{ot:Gd,su:!0})}catch(e){J("CMCD_TEXT_ERROR","Could not generate text CMCD data.",e)}return S(o,n.request(r,s).promise,2)}return a=o.h,o.return(a.data)})}function Fh(e,t,n,i){var r=ri[n];if(r)return n=r(),e={periodStart:0,segmentStart:0,segmentEnd:e.h.duration,vttOffset:0},t=Ee(t),t=n.parseMedia(t,e,null),xd(t,i);throw new It(2,2,2014,n)}function Bh(e){var t=Lc();return t.streaming.failureCallback=function(t){if(e.V()){var n=null;1001==t.code||1002==t.code?(n=1,e.g.streaming.lowLatencyMode&&(n=.1)):1003==t.code&&(n=.1),null!=n&&(t.severity=1,e.Zf(n))}},t.textDisplayFactory=function(){if(e.ze){var t=e.getConfiguration();return new md(e.h,e.ze,t.textDisplayer)}return HTMLMediaElement.prototype.addTextTrack?new dd(e.h,"Shaka Player TextTrack"):new fd},t}function jh(e,t){for(var n=new Set,i=c(t.textStreams),r=i.next();!r.done;r=i.next())r=r.value,"application/cea-608"!=r.mimeType&&"application/cea-708"!=r.mimeType||n.add(r.originalId);for(i=c(t.variants),r=i.next();!r.done;r=i.next())if((r=r.value.video)&&r.closedCaptions)for(var s=c(r.closedCaptions.keys()),a=s.next();!a.done;a=s.next())if(a=a.value,!n.has(a)){var o=a.startsWith("CC")?"application/cea-608":"application/cea-708",l=new ru,u=r.closedCaptions.get(a);o={id:e.rg++,originalId:a,groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:l,mimeType:o,codecs:"",kind:"caption",encrypted:!1,drmInfos:[],keyIds:new Set,language:u,originalLanguage:u,label:null,type:Ln,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:r.roles,forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,accessibilityPurpose:null,external:!1,fastSwitching:!1,fullMimeTypes:new Set([Fn(o,"")])},t.textStreams.push(o),n.add(a)}}function Vh(e,t){var n,i,r,s,a;return N(function(o){return 1==o.g?(n=e.audio,i=e.video,r=function(e,t){var n,i,r;return N(function(s){return 1==s.g?e?S(s,e.createSegmentIndex(),2):s.return(null):(i=(n=e.segmentIndex.Kb(t))?n.next().value:null,i?(r=i.startTime,s.return(r)):s.return(null))})},S(o,r(n,t),2)):3!=o.g?(s=o.h,S(o,r(i,t),3)):(a=o.h,null!=a&&null!=s?o.return(Math.max(a,s)):null!=a?o.return(a):null!=s?o.return(s):o.return(t))})}function Hh(e){var t=e.Jf();if(e.s&&e.L&&e.C){var n=e.I;if(n.j=t,au(n),e.N&&(n=e.N,t||n.i||(n.i=!0),n.i&&t&&(n.j=!0),n.l=t),Gh(e),n=e.g.streaming.liveSync.dynamicTargetLatency.maxAttempts,e.g.streaming.liveSync.dynamicTargetLatency.enabled&&t&&e.Ne<n){n=e.g.streaming.liveSync.dynamicTargetLatency.maxLatency;var i=e.g.streaming.liveSync.targetLatencyTolerance,r=e.g.streaming.liveSync.dynamicTargetLatency.rebufferIncrement;e.R&&(e.R=Math.min(e.R+ ++e.Ne*r,n-i))}}t=(new Map).set("buffering",t),e.dispatchEvent(ih("buffering",t))}function $h(e){var t=e.h.playbackRate;0!=t&&(e.I&&e.I.set(t),t=ih("ratechange"),e.dispatchEvent(t))}function Gh(e){if(e.s&&e.L){var t=e.s.g,n="playing";e.L.g==wr?n="buffering":e.h.paused?n="paused":e.h.ended&&(n="ended");var i=n;if(null==t.g)t.g={timestamp:Date.now()/1e3,state:i,duration:0},t=!0;else{var r=Date.now()/1e3;t.g.duration=r-t.g.timestamp,t.g.state==i?t=!1:(t.h.push(t.g),t.g={timestamp:r,state:i,duration:0},t=!0)}t&&(n=(new Map).set("newstate",n),e.dispatchEvent(ih("statechanged",n)))}}function zh(e){var t=e.h.playbackRate,n=e.V();if(e.g.streaming.vodDynamicPlaybackRate&&!n){var i=e.g.streaming.vodDynamicPlaybackRateLowBufferRate,r=e.Jg();r<=e.g.streaming.vodDynamicPlaybackRateBufferRatio?t!=i&&e.Pd(i):1==r&&t!==e.I.nc()&&e.md()}if(n&&(n=e.Qb(),Number.isFinite(n.end)&&!(e.h.currentTime<n.start))){i=e.g.streaming.liveSync.targetLatencyTolerance,r=e.g.streaming.liveSync.dynamicTargetLatency.enabled;var s=e.g.streaming.liveSync.dynamicTargetLatency.stabilityThreshold;if(e.g.streaming.liveSync&&e.g.streaming.liveSync.enabled)var a=e.g.streaming.liveSync.targetLatency,o=a+i,l=Math.max(0,a-i),u=e.g.streaming.liveSync.maxPlaybackRate,c=e.g.streaming.liveSync.minPlaybackRate;else e.i&&e.i.serviceDescription&&(a=e.i.serviceDescription.targetLatency,null!=e.i.serviceDescription.targetLatency?o=e.i.serviceDescription.targetLatency+i:null!=e.i.serviceDescription.maxLatency&&(o=e.i.serviceDescription.maxLatency),null!=e.i.serviceDescription.targetLatency?l=Math.max(0,e.i.serviceDescription.targetLatency-i):null!=e.i.serviceDescription.minLatency&&(l=e.i.serviceDescription.minLatency),u=e.i.serviceDescription.maxPlaybackRate||e.g.streaming.liveSync.maxPlaybackRate,c=e.i.serviceDescription.minPlaybackRate||e.g.streaming.liveSync.minPlaybackRate);e.R||"number"!==typeof a||(e.R=a);var d=e.g.streaming.liveSync.dynamicTargetLatency.maxAttempts;r&&e.Da&&null!==e.R&&"number"===typeof a&&e.Ne<d&&Date.now()-e.Da>1e3*s&&(s=e.g.streaming.liveSync.dynamicTargetLatency.minLatency,e.R=Math.max(e.R-(a-s)/2,s+i),e.Da=Date.now()),r&&null!==e.R&&(o=e.R+i,l=e.R-i),a=n.end-e.h.currentTime,i=0,e.l==vf&&(r=e.h.buffered,0<r.length&&(i=r.end(r.length-1),i=Math.max(u,i-n.end))),n=e.g.streaming.liveSync.panicMode,r=1e3*e.g.streaming.liveSync.panicThreshold,s=Date.now()-e.L.h,n&&!c&&(c=e.g.streaming.liveSync.minPlaybackRate),n&&c&&s<=r?t!=c&&e.Pd(c):o&&u&&a-i>o?(t!=u&&e.Pd(u),e.Da=null):l&&c&&a-i<l?(t!=c&&e.Pd(c),e.Da=null):t!==e.I.nc()&&(e.md(),e.Da=Date.now())}}function qh(e){if(e.h){var t,n=!1,i=e.h.currentTime/e.h.duration;if(isNaN(i)||(i=Math.round(100*i),isNaN(e.U)?(e.U=i,n=!0):(i=Math.max(e.U,i),e.U!=i&&(e.U=i,n=!0))),n)0==e.U?t=ih("started"):25==e.U?t=ih("firstquartile"):50==e.U?t=ih("midpoint"):75==e.U?t=ih("thirdquartile"):100==e.U&&(t=ih("complete")),t&&e.dispatchEvent(t)}}function Wh(e){try{ja(e.xe,e.i)}catch(t){return af(e,t),!1}var t=Wi(e.i.variants);return t=e.za.create(t),e.o.setVariants(Array.from(t.values())),!0}function Kh(e,t){return t=void 0!==t&&t,Wh(e)?e.o.chooseVariant(t):null}function Yh(e,t,n,i,r){t=void 0===t||t,n=void 0===n?0:n,i=void 0!==i&&i,r=void 0===r||r;var s=Kh(e);s&&Xh(e,s,r,t,n,i)}function Xh(e,t,n,i,r,s){s=void 0!==s&&s;var a=e.j.j;if(t==a)i&&Wu(e.j,t,i,r,!0);else{var o=e.s.h;o.h!=t&&(o.h=t,o.g.push({timestamp:Date.now()/1e3,id:t.id,type:"variant",fromAdaptation:n,bandwidth:t.bandwidth})),Wu(e.j,t,i,r,s,n),i=null,a&&(i=Bi(a)),t=Bi(t),n?(n=(new Map).set("oldTrack",i).set("newTrack",t),e.K&&qo(e.K,t,e.Ff()),n=ih("adaptation",n),df(e,n)):ef(e,i,t)}}function Qh(e,t){var n=Array.from(e.h.audioTracks).find(function(e){return e.enabled});t.enabled=!0,n&&(t.id!==n.id&&(n.enabled=!1),n=Gi(n),t=Gi(t),ef(e,n,t))}function Zh(e,t,n){if(0==e.g.autoShowText)return!1;if(1==e.g.autoShowText)return!0;var i=hi(e.g.preferredTextLanguage);return n=hi(n.language),2==e.g.autoShowText?ui(n,i):3==e.g.autoShowText?!!t&&(e=hi(t.language),ui(n,i)&&!ui(e,n)):(Z("Invalid autoShowText setting!"),!1)}function Jh(e){var t=ih("trackschanged");df(e,t)}function ef(e,t,n){t=(new Map).set("oldTrack",t).set("newTrack",n),e.K&&qo(e.K,n,e.Ff()),n=ih("variantchanged",t),df(e,n)}function tf(e){var t=ih("textchanged");df(e,t)}function nf(e){var t=ih("texttrackvisibility");df(e,t)}function rf(e){e.g.abr.enabled||sf(e);var t=(new Map).set("newStatus",e.g.abr.enabled);df(e,ih("abrstatuschanged",t))}function sf(e,t){if(t=void 0===t||t,e.l==mf){e.Ee.stop();for(var n=c(e.i.variants),i=n.next();!i.done;i=n.next())i.value.disabledUntilTime=0;t&&Wh(e)}}function af(e,t){var n,i,r;return N(function(s){switch(s.g){case 1:if(e.l==pf)return s.return();if(1===t.severity&&e.s.K++,n=!0,!(e.Ea&&e.i&&e.j)||3016!=t.code&&3014!=t.code&&3015!=t.code&&3018!=t.code){s.u(2);break}return E(s,3),S(s,_c(e.j),5);case 5:i=s.h,n=!i,k(s,2);break;case 3:A(s),n=!0;case 2:if(!n)return s.return();2===t.severity&&sf(e,!1),r=ih("error",(new Map).set("detail",t)),e.dispatchEvent(r),r.defaultPrevented&&(t.handled=!0),w(s)}})}function of(e,t,n,i){i=void 0===i?e:i,e=(new Map).set("detail",{schemeIdUri:n.schemeIdUri,value:n.value,startTime:n.startTime,endTime:n.endTime,id:n.id,eventElement:n.eventElement,eventNode:n.eventNode}),i.dispatchEvent(ih(t,e))}function lf(e,t,n,i){i=void 0!==i&&i,t=(new Map).set("mediaQuality",{bandwidth:t.bandwidth,audioSamplingRate:t.audioSamplingRate,codecs:t.codecs,contentType:t.contentType,frameRate:t.frameRate,height:t.height,mimeType:t.mimeType,channelsCount:t.channelsCount,pixelAspectRatio:t.pixelAspectRatio,width:t.width,label:t.label,roles:t.roles,language:t.language}).set("position",n),e.dispatchEvent(ih(i?"audiotrackchanged":"mediaqualitychanged",t))}function uf(e){if(!e.h.error)return null;var t=e.h.error.code;if(1==t)return null;var n=e.h.error.msExtendedCode;return n&&(0>n&&(n+=Math.pow(2,32)),n=n.toString(16)),new It(2,3,3016,t,n,e.h.error.message)}function cf(e,t,n){0<t&&(e.V()||e.qh(t)),t=e.getDuration(),n<t&&(e.V()||e.$a(n))}function df(e,t){N(function(n){if(1==n.g)return S(n,Promise.resolve(),2);e.l!=pf&&e.dispatchEvent(t),w(n)})}function hf(e){var t=new Set;e=c(e);for(var n=e.next();!n.done;n=e.next())n=n.value,n.language?t.add(hi(n.language)):t.add("und");return t}function ff(e){var t=new Map,n=new Map;e=c(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;var r="und",s=[];i.language&&(r=hi(i.language)),s="variant"==i.type?i.audioRoles:i.roles,s&&s.length||(s=[""]),t.has(r)||t.set(r,new Set),s=c(s);for(var a=s.next();!a.done;a=s.next())a=a.value,t.get(r).add(a),i.label&&(n.has(r)||n.set(r,new Map),n.get(r).set(a,i.label))}var o=[];return t.forEach(function(e,t){e=c(e);for(var i=e.next();!i.done;i=e.next()){i=i.value;var r=null;n.has(t)&&n.get(t).has(i)&&(r=n.get(t).get(i)),o.push({language:t,role:i,label:r})}}),o}Zd.prototype.release=function(){0<this.h.length?this.h.shift()():this.g=null},y(eh,Br),i=eh.prototype,i.destroy=function(){var e,t=this;return N(function(n){switch(n.g){case 1:return t.l==pf?n.return():(th(t),e=t.detach(),t.l=pf,S(n,e,2));case 2:return S(n,t.lf(),3);case 3:if(t.Je&&(t.Je.release(),t.Je=null),t.zd&&(t.zd.release(),t.zd=null),t.m&&(t.m.release(),t.m=null),t.Fa&&(t.Fa.release(),t.Fa=null),t.wb&&(t.wb.release(),t.wb=null),t.xa=null,t.g=null,t.s=null,t.ze=null,t.N=null,t.ea=null,!t.H){n.u(4);break}return S(n,t.H.destroy(),5);case 5:t.H=null;case 4:t.o&&(t.o.release(),t.o=null),Br.prototype.release.call(t),w(n)}})},i.Ub=function(e,t){t=void 0===t||t;var n,i,r,s=this;return N(function(a){switch(a.g){case 1:if(s.l==pf)throw new It(2,7,7e3);if(n=s.h&&s.h==e,!s.h||s.h==e){a.u(2);break}return S(a,s.detach(),2);case 2:return S(a,sh(s,"attach"),4);case 4:if(a.h)return a.return();if(E(a,5,6),n||(rh(s,"attach"),i=function(){var e=uf(s);e&&af(s,e)},s.zd.D(e,"error",i),s.h=e),!t||!Ft()||s.G){a.u(6);break}return S(a,hh(s),6);case 6:I(a),s.Z.release(),C(a,0);break;case 5:return r=A(a),S(a,s.detach(),10);case 10:throw r}})},i.Gh=function(e){this.tg=e},i.detach=function(e){e=void 0!==e&&e;var t=this;return N(function(n){if(1==n.g){if(t.l==pf)throw new It(2,7,7e3);return S(n,t.dc(!1,e),2)}if(3!=n.g)return S(n,sh(t,"detach"),3);if(n.h)return n.return();try{t.h&&(t.zd.Ra(),t.h=null),rh(t,"detach"),t.A&&!e&&t.A.release()}finally{t.Z.release()}w(n)})},i.dc=function(e,t){e=void 0===e||e,t=void 0!==t&&t;var n,i,r,s,a,o,l,u,d,h=this;return N(function(f){switch(f.g){case 1:return h.l!=pf&&(h.l=gf),S(f,sh(h,"unload"),2);case 2:return f.h?f.return():(x(f,3),h.Ea=!1,rh(h,"unload"),e&&!Ft()&&(e=!1),th(h),n=h.Ed.map(function(e){return e()}),h.Ed=[],S(f,Promise.all(n),5));case 5:if(h.dispatchEvent(ih("unloading")),h.wd&&(h.wd.release(),h.wd=null),h.h&&(h.m.Ra(),h.Fa.Ra()),h.Ee.stop(),h.Hb&&(h.Hb.release(),h.Hb=null),h.Ce&&(h.Ce.stop(),h.Ce=null),!h.F){f.u(6);break}return S(f,h.F.stop(),7);case 7:h.F=null,h.bb=null;case 6:if(!h.o){f.u(8);break}return S(f,h.o.stop(),8);case 8:if(!h.j){f.u(10);break}return S(f,h.j.destroy(),11);case 11:h.j=null;case 10:if(h.I&&(h.I.release(),h.I=null),h.C&&(h.C.release(),h.C=null),!on("webkit")||!h.B){f.u(12);break}return S(f,h.B.destroy(),13);case 13:h.B=null;case 12:if(!h.G){f.u(14);break}return S(f,h.G.destroy(),15);case 15:h.G=null;case 14:if(h.A&&!t&&h.A.onAssetUnload(),h.aa&&!t&&(h.aa.destroy(),h.aa=null),t||h.sg.stop(),h.N&&Ad(h.N),h.ea&&(h.ea.g=null),h.h&&gd(h.h),!h.h||!h.h.src){f.u(16);break}return S(f,new Promise(function(e){return new Ut(e).Y(.1)}),17);case 17:h.h.removeAttribute("src"),h.h.load();case 16:if(!h.B){f.u(18);break}return S(f,h.B.destroy(),19);case 19:h.B=null;case 18:if(h.ra&&h.da!=h.ra.Gc()&&(h.ra.s||h.ra.destroy(),h.ra=null),h.da=null,h.pg=null,h.L=null,h.i){for(i=c(h.i.variants),r=i.next();!r.done;r=i.next())for(s=r.value,a=c([s.audio,s.video]),o=a.next();!o.done;o=a.next())(l=o.value)&&l.segmentIndex&&l.segmentIndex.release();for(u=c(h.i.textStreams),o=u.next();!o.done;o=u.next())d=o.value,d.segmentIndex&&d.segmentIndex.release()}h.g.streaming.clearDecodingCache&&(Qi={},Ot.clear()),h.i=null,h.s=new pu,h.qg=null,h.Da=null,h.R=null,h.Ne=-1,h.Hd=[],h.U=NaN,Hh(h);case 3:I(f),h.Z.release(),C(f,4);break;case 4:if(e&&Ft()&&!h.G&&h.h)return S(f,hh(h),0);f.u(0)}})},i.lj=function(e){this.qa=e},i.load=function(e,t,n){t=void 0===t?null:t;var i,r,s,a,o,l,u,c,d,h,f,p,g,m=this;return N(function(v){switch(v.g){case 1:if(m.l==pf)throw new It(2,7,7e3);return i=null,r="",e instanceof Fc?(i=e,r=i.Gc()||""):r=e||"",S(v,Jd(m.Z,"load"),2);case 2:if(m.Z.release(),!m.h)throw new It(2,7,7002);if(!m.da){v.u(3);break}return m.da=r,S(v,m.dc(!1),3);case 3:if(s=++m.Le,a=function(){return N(function(e){if(1==e.g)return m.Le==s?e.u(0):i?S(e,i.destroy(),3):e.u(3);throw new It(2,7,7e3)})},o=function(e,t){return N(function(n){switch(n.g){case 1:return x(n,2),S(n,Jd(m.Z,t),4);case 4:return S(n,a(),5);case 5:return S(n,e(),6);case 6:return S(n,a(),7);case 7:i&&m.g&&(i.g=m.g);case 2:I(n),m.Z.release(),C(n,0)}})},E(v,5,6),null==t&&i&&(t=i.getStartTime()),m.qa=t,m.Ea=!1,m.dispatchEvent(ih("loading")),i){n=i.U,v.u(8);break}if(n){v.u(8);break}return S(v,o(function(){return N(function(e){if(1==e.g)return S(e,ch(m,r),2);n=e.h,w(e)})},"guessMimeType_"),8);case 8:if(l=!!i,i){Vc(i,m),m.s=i.getStats(),v.u(11);break}return S(v,lh(m,r,t,n,!0),12);case 12:(i=v.h)?(Vc(i,m),m.s=i.getStats(),i.start(),i.m.catch(function(){})):m.s=new pu;case 11:if(u=!i,c=Date.now()/1e3,m.s=i?i.getStats():new pu,m.da=r,m.pg=n||null,u)return S(v,o(function(){return N(function(e){return S(e,ph(m,n),0)})},"initializeSrcEqualsDrmInner_"),20);if(m.G){v.u(15);break}return S(v,o(function(){return N(function(e){return S(e,hh(m),0)})},"initializeMediaSourceEngineInner_"),15);case 15:return S(v,o(function(){return N(function(e){return S(e,i.m,0)})},"waitForFinish"),17);case 17:return m.g=i.getConfiguration(),m.xe=i.C,m.bb=i.F,m.F=$c(i),m.F&&m.F.setMediaElement&&m.h&&m.F.setMediaElement(m.h),m.wd=Gc(i),m.rd=i.za,m.i=i.Ef(),(d=i.o)&&(m.za=d),l&&m.h&&"AUDIO"===m.h.nodeName&&(ah(m),m.configure("manifest.disableVideo",!0)),m.B=zc(i),S(v,o(function(){return N(function(e){return S(e,m.B.Ub(m.h),0)})},"drmEngine_.attach"),18);case 18:return!(h=i.B)||m.xa&&m.xa==h||(m.o=Hc(i),m.xa=i.B,"function"!=typeof m.o.setMediaElement&&(pe("AbrManager w/o setMediaElement","Please use an AbrManager with setMediaElement function."),m.o.setMediaElement=function(){}),"function"!=typeof m.o.setCmsdManager&&(pe("AbrManager w/o setCmsdManager","Please use an AbrManager with setCmsdManager function."),m.o.setCmsdManager=function(){}),"function"!=typeof m.o.trySuggestStreams&&(pe("AbrManager w/o trySuggestStreams","Please use an AbrManager with trySuggestStreams function."),m.o.trySuggestStreams=function(){})),f=qc(i),p=i.fa,S(v,o(function(){return N(function(e){return S(e,fh(m,c,p,f),0)})},"loadInner_"),19);case 19:jc(i),v.u(14);break;case 20:return S(v,o(function(){return N(function(e){return S(e,gh(m,c,n),0)})},"srcEqualsInner_"),14);case 14:m.dispatchEvent(ih("loaded"));case 6:if(I(v),!i){v.u(22);break}return S(v,i.destroy(),22);case 22:m.ra=null,C(v,0);break;case 5:if(g=A(v),7e3==g.code){v.u(24);break}return S(v,m.dc(!1),24);case 24:throw g}})},i.hj=function(e,t){e=void 0===e||e,t=void 0!==t&&t;var n,i=this;return N(function(r){return 1==r.g?S(r,oh(i),2):3!=r.g?(n=r.h,S(r,i.dc(e,t),3)):r.return(n)})},i.Eg=function(e,t){e=void 0!==e&&e,t=void 0!==t&&t;var n,i=this;return N(function(r){return 1==r.g?S(r,oh(i,t),2):3!=r.g?(n=r.h,S(r,i.detach(e),3)):r.return(n)})},i.preload=function(e,t,n){t=void 0===t?null:t;var i,r=this;return N(function(s){return 1==s.g?S(s,lh(r,e,t,n),2):((i=s.h)?i.start():af(r,new It(2,7,7005)),s.return(i))})},i.lf=function(){var e,t,n,i,r=this;return N(function(s){for(e=[],t=c(r.Fe),n=t.next();!n.done;n=t.next())i=n.value,i.s||e.push(i.destroy());return r.Fe=[],S(s,Promise.all(e),0)})},i.Qi=function(){for(var e=this.Z;e.g;)e.release()},i.Dc=function(e){return new Js(e)},i.configure=function(e,t){if(2==arguments.length&&"string"==typeof e&&(e=Ec(e,t)),e.streaming&&"forceTransmuxTS"in e.streaming&&(pe("streaming.forceTransmuxTS configuration","Please Use mediaSource.forceTransmux instead."),e.mediaSource.mediaSource=e.streaming.forceTransmuxTS,delete e.streaming.forceTransmuxTS),e.streaming&&"forceTransmux"in e.streaming&&(pe("streaming.forceTransmux configuration","Please Use mediaSource.forceTransmux instead."),e.mediaSource.mediaSource=e.streaming.forceTransmux,delete e.streaming.forceTransmux),e.streaming&&"useNativeHlsOnSafari"in e.streaming&&(pe("streaming.useNativeHlsOnSafari configuration","Please Use streaming.useNativeHlsForFairPlay or streaming.preferNativeHls instead."),e.streaming.preferNativeHls=e.streaming.useNativeHlsOnSafari&&Yt(),delete e.streaming.useNativeHlsOnSafari),e.streaming&&"boolean"==typeof e.streaming.liveSync){pe("streaming.liveSync","Please Use streaming.liveSync.enabled instead.");var n=e.streaming.liveSync;e.streaming.liveSync={},e.streaming.liveSync.enabled=n}if(e.streaming&&!(e.streaming.liveSync&&"targetLatency"in e.streaming.liveSync)&&("liveSyncMinLatency"in e.streaming||"liveSyncMaxLatency"in e.streaming)){n=e.streaming.liveSyncMinLatency||0;var i=Math.abs((e.streaming.liveSyncMaxLatency||1)-n)/2;e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.targetLatency=n+i,e.streaming.liveSync.targetLatencyTolerance=i}if(e.streaming&&"liveSyncMaxLatency"in e.streaming&&(pe("streaming.liveSyncMaxLatency","Please Use streaming.liveSync.targetLatency and streaming.liveSync.targetLatencyTolerance instead. Or, set the values in your DASH manifest"),delete e.streaming.liveSyncMaxLatency),e.streaming&&"liveSyncMinLatency"in e.streaming&&(pe("streaming.liveSyncMinLatency","Please Use streaming.liveSync.targetLatency and streaming.liveSync.targetLatencyTolerance instead. Or, set the values in your DASH manifest"),delete e.streaming.liveSyncMinLatency),e.streaming&&"liveSyncTargetLatency"in e.streaming&&(pe("streaming.liveSyncTargetLatency","Please Use streaming.liveSync.targetLatency instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.targetLatency=e.streaming.liveSyncTargetLatency,delete e.streaming.liveSyncTargetLatency),e.streaming&&"liveSyncTargetLatencyTolerance"in e.streaming&&(pe("streaming.liveSyncTargetLatencyTolerance","Please Use streaming.liveSync.targetLatencyTolerance instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.targetLatencyTolerance=e.streaming.liveSyncTargetLatencyTolerance,delete e.streaming.liveSyncTargetLatencyTolerance),e.streaming&&"liveSyncPlaybackRate"in e.streaming&&(pe("streaming.liveSyncPlaybackRate","Please Use streaming.liveSync.maxPlaybackRate instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.maxPlaybackRate=e.streaming.liveSyncPlaybackRate,delete e.streaming.liveSyncPlaybackRate),e.streaming&&"liveSyncMinPlaybackRate"in e.streaming&&(pe("streaming.liveSyncMinPlaybackRate","Please Use streaming.liveSync.minPlaybackRate instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.minPlaybackRate=e.streaming.liveSyncMinPlaybackRate,delete e.streaming.liveSyncMinPlaybackRate),e.streaming&&"liveSyncPanicMode"in e.streaming&&(pe("streaming.liveSyncPanicMode","Please Use streaming.liveSync.panicMode instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.panicMode=e.streaming.liveSyncPanicMode,delete e.streaming.liveSyncPanicMode),e.streaming&&"liveSyncPanicThreshold"in e.streaming&&(pe("streaming.liveSyncPanicThreshold","Please Use streaming.liveSync.panicThreshold instead."),e.streaming.liveSync=e.streaming.liveSync||{},e.streaming.liveSync.panicThreshold=e.streaming.liveSyncPanicThreshold,delete e.streaming.liveSyncPanicThreshold),e.mediaSource&&"sourceBufferExtraFeatures"in e.mediaSource){pe("mediaSource.sourceBufferExtraFeatures configuration","Please Use mediaSource.addExtraFeaturesToSourceBuffer() instead.");var r=e.mediaSource.sourceBufferExtraFeatures;e.mediaSource.addExtraFeaturesToSourceBuffer=function(){return r},delete e.mediaSource.sourceBufferExtraFeatures}return e.streaming&&e.streaming.lowLatencyMode&&(void 0==e.streaming.inaccurateManifestTolerance&&(e.streaming.inaccurateManifestTolerance=0),void 0==e.streaming.rebufferingGoal&&(e.streaming.rebufferingGoal=.01),void 0==e.streaming.segmentPrefetchLimit&&(e.streaming.segmentPrefetchLimit=2),void 0==e.streaming.updateIntervalSeconds&&(e.streaming.updateIntervalSeconds=.1),void 0==e.streaming.maxDisabledTime&&(e.streaming.maxDisabledTime=1),void 0==e.streaming.retryParameters&&(e.streaming.retryParameters={}),void 0==e.streaming.retryParameters.baseDelay&&(e.streaming.retryParameters.baseDelay=100),void 0==e.manifest&&(e.manifest={}),void 0==e.manifest.dash&&(e.manifest.dash={}),void 0==e.manifest.dash.autoCorrectDrift&&(e.manifest.dash.autoCorrectDrift=!1),void 0==e.manifest.retryParameters&&(e.manifest.retryParameters={}),void 0==e.manifest.retryParameters.baseDelay&&(e.manifest.retryParameters.baseDelay=100),void 0==e.drm&&(e.drm={}),void 0==e.drm.retryParameters&&(e.drm.retryParameters={}),void 0==e.drm.retryParameters.baseDelay&&(e.drm.retryParameters.baseDelay=100)),n=Pc(this.g,e,Bh(this)),Dh(this),n},i.getConfiguration=function(){var e=Bh(this);return Pc(e,this.g,Bh(this)),e},i.Og=function(){var e=Bh(this);return Pc(e,this.g,Bh(this)),kc(this.g,Bh(this))},i.Jg=function(){if(this.h){var e=this.h.buffered.length;e=e?this.h.buffered.end(e-1):0;var t=this.getConfiguration().streaming.bufferingGoal;if(t=Math.min(this.h.currentTime+t,this.Qb().end),e>=t)return 1;if(!(e<=this.h.currentTime)&&e<t)return(e-this.h.currentTime)/(t-this.h.currentTime)}return 0},i.Ui=function(){for(var e in this.g)delete this.g[e];Pc(this.g,Bh(this),Bh(this)),Dh(this)},i.Mg=function(){return this.l},i.Ff=function(){return this.i?this.i.type:null},i.ai=function(){return this.h},i.zb=function(){return this.H},i.Gc=function(){return this.da},i.Ig=function(){return this.A?this.A:null},i.V=function(){return this.i?this.i.presentationTimeline.V():!(!this.h||!this.h.src)&&1/0==this.h.duration},i.qc=function(){return!!this.i&&this.i.presentationTimeline.qc()},i.si=function(){if(this.i){var e=this.i.variants;return!!e.length&&!e[0].video}return!(!this.h||!this.h.src)&&(this.h.videoTracks?0==this.h.videoTracks.length:0==this.h.videoHeight)},i.Qb=function(){if(this.i){if(!this.Ea&&"HLS"==this.i.type)return{start:0,end:0};var e=this.i.presentationTimeline;return{start:e.Yb(),end:e.Ab()}}return this.h&&this.h.src&&(e=this.h.seekable,e.length)?{start:e.start(0),end:e.end(e.length-1)}:{start:0,end:0}},i.oi=function(){this.V()&&(this.h.currentTime=this.Qb().end)},i.ti=function(){return this.Ea},i.keySystem=function(){var e=this.drmInfo();return e?e.keySystem:""},i.drmInfo=function(){return this.B?this.B.g:null},i.td=function(){return this.B?this.B.td():1/0},i.Df=function(){return this.B?this.B.Df():[]},i.ge=function(){return this.B?this.B.ge():{}},i.Jf=function(){return!!this.L&&this.L.g==wr},i.fb=function(){return this.h?this.I?this.I.i:1:0},i.Pd=function(e){var t=this;0==e?Z("A trick play rate of 0 is unsupported!"):(this.Fa.Ra(),this.h.paused&&this.h.play(),this.I.set(e),this.l==mf&&(this.o.playbackRateChanged(e),qu(this.j,1<Math.abs(e))),this.V()&&this.Fa.D(this.h,"timeupdate",function(){var n=t.h.currentTime,i=t.Qb(),r=t.g.streaming.safeSeekOffset;0<e?Math.floor(n)>=Math.floor(i.end)&&t.md():Math.floor(n)<=Math.floor(i.start+r)&&t.md()}))},i.md=function(){var e=this.I.nc();this.l==vf&&this.I.set(e),this.l==mf&&(this.I.set(e),this.o.playbackRateChanged(e),qu(this.j,!1)),this.Fa.Ra()},i.oc=function(){if(this.i){for(var e=this.j?this.j.j:null,t=[],n=0,i=c(this.i.variants),r=i.next();!r.done;r=i.next())if(r=r.value,qi(r)){var s=Bi(r);s.active=r==e,s.active||1==n||null==e||r.video!=e.video||r.audio!=e.audio||(s.active=!0),s.active&&n++,t.push(s)}return t}return this.h&&this.h.audioTracks?Array.from(this.h.audioTracks).map(function(e){return Gi(e)}):[]},i.Hc=function(){if(this.i){for(var e=this.j?this.j.s:null,t=[],n=c(this.i.textStreams),i=n.next();!i.done;i=n.next()){i=i.value;var r=ji(i);r.active=i==e,t.push(r)}return t}return this.h&&this.h.src&&this.h.textTracks?Mh(this).map(function(e){return $i(e)}):[]},i.Vh=function(){var e=this.Hd;return this.i&&(e=this.i.imageStreams),e.map(function(e){return Vi(e)})},i.Nh=function(e){var t,n,i,r,s=this;return N(function(a){return 1==a.g?s.l!=mf&&s.l!=vf?a.return(null):(t=s.Hd,s.i&&(t=s.i.imageStreams),(n=t.find(function(t){return t.id==e}))?n.segmentIndex?a.u(2):S(a,n.createSegmentIndex(),2):a.return(null)):4!=a.g?(i=[],n.segmentIndex.Jb(function(t){var r=Rh(t.tilesLayout||n.tilesLayout);if(r){r=r.rows*r.kc;for(var a=t.j-t.startTime,o=0;o<r;o++)i.push(s.Qg(e,t.startTime+a*o/r))}}),S(a,Promise.all(i),4)):(r=a.h,a.return(r.filter(function(e){return e})))})},i.Qg=function(e,t){var n,i,r,s,a,o,l,u,c,d,h,f,p,g,m,v,y,b,_=this;return N(function(T){return 1==T.g?_.l!=mf&&_.l!=vf?T.return(null):(n=_.Hd,_.i&&(n=_.i.imageStreams),(i=n.find(function(t){return t.id==e}))?i.segmentIndex?T.u(2):S(T,i.createSegmentIndex(),2):T.return(null)):(r=i.segmentIndex.find(t),null==r?T.return(null):(s=i.segmentIndex.get(r),a=Rh(s.tilesLayout||i.tilesLayout),a?(o=i.width||0,l=i.height||0,u=o/a.kc,c=l/a.rows,d=a.kc*a.rows,h=s.j-s.startTime,f=s.A||h/d,p=s.startTime,m=g=0,1<d&&(v=Math.floor((t-s.startTime)/f),p=s.startTime+v*f,g=v%a.kc*u,m=Math.floor(v/a.kc)*c),y=!1,(b=s.s)&&(y=!0,c=b.height,g=b.positionX,m=b.positionY,u=b.width),T.return({segment:s,imageHeight:l,imageWidth:o,height:c,positionX:g,positionY:m,startTime:p,duration:f,uris:s.M(),width:u,sprite:y})):T.return(null)))})},i.hh=function(e){if(this.i&&this.j){var t=this.i.textStreams.find(function(t){return t.id==e.id});t&&t!=this.j.s&&(fu(this.s.h,t,!1),Ku(this.j,t),tf(this),this.Fb=t.language)}else if(this.h&&this.h.src&&this.h.textTracks){t=Mh(this),t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value,Hi(n)==e.id?n.mode=this.pa?"showing":"hidden":n.mode="disabled";tf(this)}},i.cg=function(e,t,n){if(t=void 0!==t&&t,n=void 0===n?0:n,this.i&&this.j){var i=this.i.variants.find(function(t){return t.id==e.id});if(i&&qi(i)){var r=this.j.j;this.g.abr.enabled&&(r.video!=i.video||r.audio&&i.audio&&r.audio.language==i.audio.language&&r.audio.channelsCount==i.audio.channelsCount)&&Z("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack()."),Xh(this,i,!1,t,n),this.za=new cr(i,this.g.mediaSource.codecSwitchingStrategy,this.g.manifest.dash.enableAudioGroups),Wh(this)}}else if(this.h&&this.h.audioTracks)for(t=Array.from(this.h.audioTracks),t=c(t),n=t.next();!n.done;n=t.next())if(n=n.value,Hi(n)==e.id){Qh(this,n);break}},i.Ph=function(){return ff(this.oc())},i.hi=function(){return ff(this.Hc())},i.Oh=function(){return Array.from(hf(this.oc()))},i.gi=function(){return Array.from(hf(this.Hc()))},i.gh=function(e,t,n,i,r){if(n=void 0===n?0:n,i=void 0===i?0:i,r=void 0===r?"":r,this.i&&this.C){this.za=new dr(e,t||"",n,"",!1,"","","",this.g.mediaSource.codecSwitchingStrategy,this.g.manifest.dash.enableAudioGroups,r),e=function(e,t){return e.video||t.video?e.video&&t.video?Math.abs((e.video.height||0)-(t.video.height||0))+Math.abs((e.video.width||0)-(t.video.width||0)):1/0:0},t=this.j.j,r=this.za.create(this.i.variants),n=null,r=c(r.values());for(var s=r.next();!s.done;s=r.next())s=s.value,qi(s)&&(!n||e(n,t)>e(s,t))&&(n=s);n!=t&&(n?(e=Bi(n),this.cg(e,!0,i)):Yh(this))}else this.h&&this.h.audioTracks&&(i=Ki(this.oc(),e,t||"",!1)[0])&&this.cg(i)},i.bg=function(e,t,n){n=void 0!==n&&n,this.i&&this.C?(this.Fb=e,this.Gd=t||"",this.Fd=n,(e=Ki(this.i.textStreams,this.Fb,this.Gd,this.Fd)[0]||null)&&e!=this.j.s&&(fu(this.s.h,e,!1),this.g.streaming.alwaysStreamText||this.Kf())&&(Ku(this.j,e),tf(this))):(e=Ki(this.Hc(),e,t||"",n)[0])&&this.hh(e)},i.$i=function(e,t,n){if(t=void 0===t||t,n=void 0===n?0:n,this.i&&this.C){for(var i=null,r=c(this.i.variants),s=r.next();!s.done;s=r.next())if(s=s.value,s.audio.label==e){i=s;break}null!=i&&(this.za=new dr(i.language,"",0,"",!1,"",e,"",this.g.mediaSource.codecSwitchingStrategy,this.g.manifest.dash.enableAudioGroups),Yh(this,t,n))}else if(this.h&&this.h.audioTracks){for(n=Array.from(this.h.audioTracks),t=null,n=c(n),i=n.next();!i.done;i=n.next())i=i.value,i.label==e&&(t=i);t&&Qh(this,t)}},i.Kf=function(){var e=this.pa;return this.G&&this.l==mf?this.G.F.isTextVisible():this.h&&this.h.src&&this.h.textTracks?Mh(this).some(function(e){return"showing"==e.mode}):e},i.Kg=function(){return this.h&&this.h.src&&this.h.textTracks?Ph(this).map(function(e){return $i(e)}):[]},i.Rh=function(e){if(!this.h||!this.h.src||!this.h.textTracks)return[];var t=hi(e),n=Ph(this).filter(function(e){return hi(e.language)==t});if(!n||!n.length)return[];e=[];var i=new Set;n=c(n);for(var r=n.next();!r.done;r=n.next())if((r=r.value)&&r.cues){r=c(r.cues);for(var s=r.next();!s.done;s=r.next()){var a=s.value;(s=a.id)&&""!=s||(s=a.startTime+"-"+a.endTime+"-"+a.text),a={id:s,title:a.text,startTime:a.startTime,endTime:a.endTime},i.has(s)||(e.push(a),i.add(s))}}return e},i.nh=function(e){if(e=!!e,this.pa!=e){if(this.pa=e,this.l==mf)this.G.F.setTextVisibility(e),this.g.streaming.alwaysStreamText||(e?this.j.s||(e=Ki(this.i.textStreams,this.Fb,this.Gd,this.Fd),0<e.length&&(Ku(this.j,e[0]),tf(this))):zu(this.j));else if(this.h&&this.h.src&&this.h.textTracks){var t=Mh(this);t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value,"disabled"!=n.mode&&(n.mode=e?"showing":"hidden")}nf(this)}},i.ci=function(){if(this.C)var e=this.C.$d();else{if(null==this.qa)return new Date;e=this.qa}if(this.i){var t=this.i.presentationTimeline;return new Date(1e3*((t.m||t.i)+e))}return this.h&&this.h.getStartDate?(t=this.h.getStartDate(),isNaN(t.getTime())?null:new Date(t.getTime()+1e3*e)):null},i.Pg=function(){if(this.i){var e=this.i.presentationTimeline;return new Date(1e3*(e.m||e.i))}return this.h&&this.h.getStartDate?(e=this.h.getStartDate(),isNaN(e.getTime())?null:e):null},i.je=function(){return this.V()&&this.i?this.i.presentationTimeline.je():null},i.yb=function(){if(this.l==mf)return this.G.yb();var e={total:[],audio:[],video:[],text:[]};return this.l==vf&&(e.total=ao(this.h.buffered)),e},i.getStats=function(){if(this.l!=mf&&this.l!=vf)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,stallsDetected:NaN,gapsJumped:NaN,estimatedBandwidth:NaN,completionPercent:NaN,loadLatency:NaN,manifestTimeSeconds:NaN,drmTimeSeconds:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,liveLatency:NaN,maxSegmentDuration:NaN,manifestSizeBytes:NaN,bytesDownloaded:NaN,nonFatalErrorCount:NaN,manifestPeriodCount:NaN,manifestGapCount:NaN,switchHistory:[],stateHistory:[]};Gh(this);var e=this.h,t=e.currentTime/e.duration;if(!isNaN(t)&&!this.V()){var n=this.s;t=Math.round(100*t),n.i=isNaN(n.i)?t:Math.max(n.i,t)}if(this.C&&(this.s.U=this.C.ug(),this.s.Z=this.C.vg()),e.getVideoPlaybackQuality){n=e.getVideoPlaybackQuality(),t=this.s;var i=Number(n.totalVideoFrames);t.R=Number(n.droppedVideoFrames),t.N=i,this.s.L=Number(n.corruptedVideoFrames)}if(this.B?(n=this.B,n=n.I?n.I:NaN):n=NaN,this.s.s=n,this.l==mf){if(n=this.j.j,t=this.j.s,n){i=this.I?this.I.i:1;var r=i*n.bandwidth;t&&t.bandwidth&&(r+=i*t.bandwidth),this.s.B=r}n&&n.video&&(t=this.s,i=n.video.height||NaN,t.o=n.video.width||NaN,t.l=i),this.V()&&(n=this.Pg().valueOf()+1e3*e.currentTime,this.s.C=(Date.now()-n)/1e3),this.i&&(this.s.G=this.i.periodCount,this.s.F=this.i.gapCount,this.i.presentationTimeline&&(this.s.I=this.i.presentationTimeline.g)),n=this.o.getBandwidthEstimate(),this.s.A=n}this.l==vf&&(n=this.s,t=e.videoHeight||NaN,n.o=e.videoWidth||NaN,n.l=t);var s=this.s;e=s.o,n=s.l,t=s.B,i=s.N,r=s.R;var a=s.L,o=s.Z,l=s.U,u=s.A,d=s.i,h=s.m,f=s.H,p=s.j,g=cu(s.g,"playing"),m=cu(s.g,"paused"),v=cu(s.g,"buffering"),y=s.s,b=s.C,_=s.I,T=s.Ug,S=s.ae,w=s.K,E=s.G,x=s.F,k=du(s.g),A=[];s=c(s.h.g);for(var I=s.next();!I.done;I=s.next())I=I.value,A.push({timestamp:I.timestamp,id:I.id,type:I.type,fromAdaptation:I.fromAdaptation,bandwidth:I.bandwidth});return{width:e,height:n,streamBandwidth:t,decodedFrames:i,droppedFrames:r,corruptedFrames:a,stallsDetected:o,gapsJumped:l,estimatedBandwidth:u,completionPercent:d,loadLatency:h,manifestTimeSeconds:f,drmTimeSeconds:p,playTime:g,pauseTime:m,bufferingTime:v,licenseTime:y,liveLatency:b,maxSegmentDuration:_,manifestSizeBytes:T,bytesDownloaded:S,nonFatalErrorCount:w,manifestPeriodCount:E,manifestGapCount:x,stateHistory:k,switchHistory:A}},i.Bh=function(e,t,n,i,r,s,a){a=void 0!==a&&a;var o,l,u,c,d,h,f,p,g,m,v,y,b=this;return N(function(_){switch(_.g){case 1:if(b.l!=mf&&b.l!=vf)throw new It(1,7,7004);if("subtitles"!=n&&"captions"!=n&&Z("Using a kind value different of `subtitles` or `captions` can cause unwanted issues."),i){_.u(2);break}return S(_,Oh(b,e),3);case 3:i=_.h;case 2:if(o=[],b.A&&(o=b.A.getCuePoints()),b.l!=vf){_.u(4);break}return a&&(n="forced"),S(_,Nh(b,e,t,n,i,s||"",o),5);case 5:if(l=hi(t),u=b.Hc(),c=u.find(function(e){return hi(e.language)==l&&e.label==(s||"")&&e.kind==n}))return Jh(b),_.return(c);throw new It(1,2,2012);case 4:if(d=Pn,h=b.h.duration,b.i&&(h=b.i.presentationTimeline.getDuration()),1/0==h)throw new It(1,4,4033);if(!o.length){_.u(6);break}return S(_,Uh(b,e,b.H,b.g.streaming.retryParameters),7);case 7:f=_.h,p=Fh(b,f,i,o),g=new Blob([p],{type:"text/vtt"}),e=Rl(g),i="text/vtt";case 6:if(m={id:b.rg++,originalId:null,groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:nu(0,h,[e]),mimeType:i||"",codecs:r||"",kind:n,encrypted:!1,drmInfos:[],keyIds:new Set,language:t,originalLanguage:t,label:s||null,type:d.ta,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!!a,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,accessibilityPurpose:null,external:!0,fastSwitching:!1,fullMimeTypes:new Set([Fn(i||"",r||"")])},v=Fn(m.mimeType,m.codecs),y=Zn(v),!y)throw new It(2,2,2014,i);return b.i.textStreams.push(m),Jh(b),_.return(ji(m))}})},i.Ch=function(e,t){var n,i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b=this;return N(function(_){switch(_.g){case 1:if(b.l!=mf&&b.l!=vf)throw new It(1,7,7004);if(t){_.u(2);break}return S(_,Oh(b,e),3);case 3:t=_.h;case 2:if("text/vtt"!=t)throw new It(1,2,2017,e);if(n=Pn,i=b.h.duration,b.i&&(i=b.i.presentationTimeline.getDuration()),1/0==i)throw new It(1,4,4045);return S(_,Uh(b,e,b.H,b.g.streaming.retryParameters),4);case 4:if(r=_.h,s=ri[t],!s)throw new It(2,2,2014,t);for(a=s(),o={periodStart:0,segmentStart:0,segmentEnd:i,vttOffset:0},l=Ee(r),u=a.parseMedia(l,o,e),d=[],h={},f=c(u),p=f.next();!p.done;h={hd:h.hd,hc:h.hc},p=f.next())h.hc=p.value,h.hd=null,g=function(t){return function(){return null==t.hd&&(t.hd=An([e],[t.hc.payload])),t.hd||[]}}(h),m=new Qa(h.hc.startTime,h.hc.endTime,g,0,null,null,0,0,1/0),h.hc.payload.includes("#xywh")&&(v=h.hc.payload.split("#xywh=")[1].split(","),4===v.length&&m.oh({height:parseInt(v[3],10),positionX:parseInt(v[0],10),positionY:parseInt(v[1],10),width:parseInt(v[2],10)})),d.push(m);return y={id:b.rg++,originalId:null,groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new tu(d),mimeType:t||"",codecs:"",kind:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"und",originalLanguage:null,label:null,type:n.Ze,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,tilesLayout:"1x1",accessibilityPurpose:null,external:!0,fastSwitching:!1,fullMimeTypes:new Set([Fn(t||"","")])},b.l==vf?b.Hd.push(y):b.i.imageStreams.push(y),Jh(b),_.return(Vi(y))}})},i.Ah=function(e,t,n){var i,r,s,a,o=this;return N(function(l){switch(l.g){case 1:if(o.l!=mf&&o.l!=vf)throw new It(1,7,7004);if(n){l.u(2);break}return S(l,Oh(o,e),3);case 3:n=l.h;case 2:return i=[],o.A&&(i=o.A.getCuePoints()),S(l,Nh(o,e,t,"chapters",n,"",i),4);case 4:if(r=l.h,s=o.Kg(),a=s.find(function(e){return e.language==t}),!a){l.u(5);break}return S(l,new Promise(function(e,t){o.m.ha(r,"load",e),o.m.ha(r,"error",function(){t(new It(1,2,2015))})}),6);case 6:return Jh(o),l.return(a);case 5:throw new It(1,2,2012)}})},i.ej=function(e,t){this.fa.width=e,this.fa.height=t},i.Zf=function(e){if(this.l==mf){var t=this.j;if(e=void 0===e?.1:e,t.m.g)t=!1;else if(t.A)t=!1;else{for(var n=c(t.i.values()),i=n.next();!i.done;i=n.next())i=i.value,!i.yd||i.Qa||i.ub||(i.yd=!1,mc(t,i,e));t=!0}}else t=!1;return t},i.Ef=function(){return Z("Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for."),this.i},i.Yh=function(){return this.bb},i.rh=function(e){this.ze=e},i.disableStream=function(e,t){if(!this.g.abr.enabled||this.l===pf||!navigator.onLine||0==t)return!1;if(this.i.variants.some(function(t){var n=t[e.type];return!(!n||n.id===e.id||t.disabledUntilTime)&&("audio"!=e.type||e.language===n.language)})){for(var n=c(this.i.variants),i=n.next();!i.done;i=n.next()){i=i.value;var r=i[e.type];r&&r.id===e.id&&(i.disabledUntilTime=Date.now()/1e3+t)}return this.Ee.Sa(1),t=this.yb().video.reduce(function(e,t){return e+t.end-t.start},0),Yh(this,!1,t,!0,!1),!0}return!1},G("shaka.Player",eh),eh.prototype.setVideoContainer=eh.prototype.rh,eh.prototype.getManifestParserFactory=eh.prototype.Yh,eh.prototype.getManifest=eh.prototype.Ef,eh.prototype.retryStreaming=eh.prototype.Zf,eh.prototype.setMaxHardwareResolution=eh.prototype.ej,eh.prototype.addChaptersTrack=eh.prototype.Ah,eh.prototype.addThumbnailsTrack=eh.prototype.Ch,eh.prototype.addTextTrackAsync=eh.prototype.Bh,eh.prototype.getStats=eh.prototype.getStats,eh.prototype.getBufferedInfo=eh.prototype.yb,eh.prototype.getSegmentAvailabilityDuration=eh.prototype.je,eh.prototype.getPresentationStartTimeAsDate=eh.prototype.Pg,eh.prototype.getPlayheadTimeAsDate=eh.prototype.ci,eh.prototype.setTextTrackVisibility=eh.prototype.nh,eh.prototype.getChapters=eh.prototype.Rh,eh.prototype.getChaptersTracks=eh.prototype.Kg,eh.prototype.isTextTrackVisible=eh.prototype.Kf,eh.prototype.selectVariantsByLabel=eh.prototype.$i,eh.prototype.selectTextLanguage=eh.prototype.bg,eh.prototype.selectAudioLanguage=eh.prototype.gh,eh.prototype.getTextLanguages=eh.prototype.gi,eh.prototype.getAudioLanguages=eh.prototype.Oh,eh.prototype.getTextLanguagesAndRoles=eh.prototype.hi,eh.prototype.getAudioLanguagesAndRoles=eh.prototype.Ph,eh.prototype.selectVariantTrack=eh.prototype.cg,eh.prototype.selectTextTrack=eh.prototype.hh,eh.prototype.getThumbnails=eh.prototype.Qg,eh.prototype.getAllThumbnails=eh.prototype.Nh,eh.prototype.getImageTracks=eh.prototype.Vh,eh.prototype.getTextTracks=eh.prototype.Hc,eh.prototype.getVariantTracks=eh.prototype.oc,eh.prototype.cancelTrickPlay=eh.prototype.md,eh.prototype.trickPlay=eh.prototype.Pd,eh.prototype.getPlaybackRate=eh.prototype.fb,eh.prototype.isBuffering=eh.prototype.Jf,eh.prototype.getKeyStatuses=eh.prototype.ge,eh.prototype.getActiveSessionsMetadata=eh.prototype.Df,eh.prototype.getExpiration=eh.prototype.td,eh.prototype.drmInfo=eh.prototype.drmInfo,eh.prototype.keySystem=eh.prototype.keySystem,eh.prototype.isFullyLoaded=eh.prototype.ti,eh.prototype.goToLive=eh.prototype.oi,eh.prototype.seekRange=eh.prototype.Qb,eh.prototype.isAudioOnly=eh.prototype.si,eh.prototype.isInProgress=eh.prototype.qc,eh.prototype.isLive=eh.prototype.V,eh.prototype.getAdManager=eh.prototype.Ig,eh.prototype.getAssetUri=eh.prototype.Gc,eh.prototype.getNetworkingEngine=eh.prototype.zb,eh.prototype.getMediaElement=eh.prototype.ai,eh.prototype.getManifestType=eh.prototype.Ff,eh.prototype.getLoadMode=eh.prototype.Mg,eh.prototype.resetConfiguration=eh.prototype.Ui,eh.prototype.getBufferFullness=eh.prototype.Jg,eh.prototype.getNonDefaultConfiguration=eh.prototype.Og,eh.prototype.getConfiguration=eh.prototype.getConfiguration,eh.prototype.configure=eh.prototype.configure,eh.prototype.releaseAllMutexes=eh.prototype.Qi,eh.prototype.destroyAllPreloads=eh.prototype.lf,eh.prototype.preload=eh.prototype.preload,eh.prototype.detachAndSavePreload=eh.prototype.Eg,eh.prototype.unloadAndSavePreload=eh.prototype.hj,eh.prototype.load=eh.prototype.load,eh.prototype.updateStartTime=eh.prototype.lj,eh.prototype.unload=eh.prototype.dc,eh.prototype.detach=eh.prototype.detach,eh.prototype.attachCanvas=eh.prototype.Gh,eh.prototype.attach=eh.prototype.Ub,eh.probeSupport=function(e){var t,n,i,r,s,a,o;return e=void 0===e||e,N(function(l){switch(l.g){case 1:if(t={},!e){l.u(2);break}return S(l,wa(),3);case 3:t=l.h;case 2:var u={};if(Ft())for(var h in Ga)u[h]=!0;h=c(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"]);for(var f=h.next();!f.done;f=h.next())f=f.value,u[f]=Ft()?!!Ga[f]:Bt(f);for(n=u,h='video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",video/mp4; codecs="dvh1.20.01",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="ac-4.02.01.01",audio/mp4; codecs="opus",audio/mp4; codecs="flac",audio/mp4; codecs="dtsc",audio/mp4; codecs="dtse",audio/mp4; codecs="dtsx",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",").concat(d(Xn)),u={},h=c(h),f=h.next();!f.done;f=h.next()){f=f.value,u[f]=!!Zn(f)||(Ft()?ce(f)||!!st(f):Bt(f));var p=f.split(";")[0];u[p]=u[p]||u[f]}return i=u,S(l,ln(),4);case 4:for(o in r=l.h,s={manifest:n,media:i,drm:t,hardwareResolution:r},a=bf,a)s[o]=a[o]();return l.return(s)}})},eh.isBrowserSupported=function(){if(e.Promise||Z("A Promise implementation or polyfill is required"),!(e.Promise&&e.Uint8Array&&Array.prototype.forEach)||sn("Trident/"))return!1;var t=en();return!(t&&9>t||!(e.MediaKeys&&e.navigator&&e.navigator.requestMediaKeySystemAccess&&e.MediaKeySystemAccess&&e.MediaKeySystemAccess.prototype.getConfiguration))&&(!!Ft()||Bt("application/x-mpegurl"))},eh.setAdManagerFactory=function(e){_f=e},eh.registerSupportPlugin=function(e,t){bf[e]=t},eh.prototype.destroy=eh.prototype.destroy;var pf=0,gf=1,mf=2,vf=3;eh.LoadMode={DESTROYED:pf,NOT_LOADED:gf,MEDIA_SOURCE:mf,SRC_EQUALS:vf},eh.version="v4.10.9";var yf=["4","10"];ve=new function(e){this.g=e,this.i=ge,this.h=me}(new fe(Number(yf[0]),Number(yf[1])));var bf={},_f=null;function Tf(){this.g=[],this.i=this.l=this.j=this.h=0}function Sf(e){return e.g.length?e.g.reduce(function(e,t){return e+t},0)/e.g.length:0}function wf(e,t,n){var i=this;this.g=e,this.h=t,this.j=n,this.i=!1,this.l=this.h.getVolume(),this.m=new se,this.m.D(this.h,google.ima.AdEvent.Type.PAUSED,function(){i.i=!0}),this.m.D(this.h,google.ima.AdEvent.Type.RESUMED,function(){i.i=!1})}function Ef(){}function xf(e,t,n,i,r){var s=this;this.s=e,this.i=t,this.F=!1,this.A=this.o=null,this.G=NaN,this.l=r,this.j=null,this.h=new se,google.ima.settings.setLocale(n),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),this.C=new google.ima.AdDisplayContainer(this.s,this.i),this.C.initialize(),this.m=new google.ima.AdsLoader(this.C),this.m.getSettings().setPlayerType("shaka-player"),this.m.getSettings().setPlayerVersion("v4.10.9"),this.g=null,this.B=i||new google.ima.AdsRenderingSettings,this.h.D(this.m,google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(e){Af(s,e)}),this.h.D(this.m,google.ima.AdErrorEvent.Type.AD_ERROR,function(e){kf(s,e)}),this.h.D(this.i,"ended",function(){s.m.contentComplete()}),this.h.ha(this.i,"play",function(){s.F=!0})}function kf(e,t){t.getError(),t=(new Map).set("originalEvent",t),e.l(new Nr("ad-error",t)),Rf(e,null),e.l(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",[])))}function Af(t,n){if(t.l(new Nr("ads-loaded",(new Map).set("loadTime",Date.now()/1e3-t.G))),t.o.customPlayheadTracker){var i={currentTime:t.i.currentTime};t.g=n.getAdsManager(i,t.B),t.i.muted?t.g.setVolume(0):t.g.setVolume(t.i.volume),t.h.D(t.i,"timeupdate",function(){t.i.duration&&(i.currentTime=t.i.currentTime)}),t.h.D(t.i,"volumechange",function(){t.j&&(t.j.setVolume(t.i.volume),t.i.muted&&t.j.setMuted(!0))})}else t.g=n.getAdsManager(t.i,t.B);t.l(new Nr("ima-ad-manager-loaded",(new Map).set("imaAdManager",t.g)));var r=t.g.getCuePoints();if(r.length){n=[],r=c(r);for(var s=r.next();!s.done;s=r.next())n.push({start:s.value,end:null});t.l(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",n)))}Cf(t);try{t.g.init(t.i.offsetWidth,t.i.offsetHeight,If(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),t.h.D(t.i,"loadeddata",function(){t.g.resize(t.i.offsetWidth,t.i.offsetHeight,If(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),"ResizeObserver"in e?(t.A=new ResizeObserver(function(){t.g.resize(t.i.offsetWidth,t.i.offsetHeight,If(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),t.A.observe(t.i)):t.h.D(document,"fullscreenchange",function(){t.g.resize(t.i.offsetWidth,t.i.offsetHeight,If(t)?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)}),t.F||t.o.skipPlayDetection?t.g.start():t.h.ha(t.i,"play",function(){t.F=!0,t.g.start()})}catch(e){Rf(t,null)}}function If(e){return document.fullscreenEnabled?!!document.fullscreenElement:(e=e.i,!!e.webkitSupportsFullscreen&&e.webkitDisplayingFullscreen)}function Cf(e){function t(t,n){t=(new Map).set("originalEvent",t),e.l(new Nr(n,t))}e.h.D(e.g,google.ima.AdErrorEvent.Type.AD_ERROR,function(t){kf(e,t)}),e.h.D(e.g,google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(t){Df(e,t)}),e.h.D(e.g,google.ima.AdEvent.Type.STARTED,function(t){Df(e,t)}),e.h.D(e.g,google.ima.AdEvent.Type.FIRST_QUARTILE,function(e){t(e,"ad-first-quartile")}),e.h.D(e.g,google.ima.AdEvent.Type.MIDPOINT,function(e){t(e,"ad-midpoint")}),e.h.D(e.g,google.ima.AdEvent.Type.THIRD_QUARTILE,function(e){t(e,"ad-third-quartile")}),e.h.D(e.g,google.ima.AdEvent.Type.COMPLETE,function(e){t(e,"ad-complete")}),e.h.D(e.g,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(t){Rf(e,t)}),e.h.D(e.g,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(t){Rf(e,t)}),e.h.D(e.g,google.ima.AdEvent.Type.SKIPPED,function(e){t(e,"ad-skipped")}),e.h.D(e.g,google.ima.AdEvent.Type.VOLUME_CHANGED,function(e){t(e,"ad-volume-changed")}),e.h.D(e.g,google.ima.AdEvent.Type.VOLUME_MUTED,function(e){t(e,"ad-muted")}),e.h.D(e.g,google.ima.AdEvent.Type.PAUSED,function(n){e.j&&(e.j.i=!0,t(n,"ad-paused"))}),e.h.D(e.g,google.ima.AdEvent.Type.RESUMED,function(n){e.j&&(e.j.i=!1,t(n,"ad-resumed"))}),e.h.D(e.g,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,function(n){e.j&&t(n,"ad-skip-state-changed")}),e.h.D(e.g,google.ima.AdEvent.Type.CLICK,function(e){t(e,"ad-clicked")}),e.h.D(e.g,google.ima.AdEvent.Type.AD_PROGRESS,function(e){t(e,"ad-progress")}),e.h.D(e.g,google.ima.AdEvent.Type.AD_BUFFERING,function(e){t(e,"ad-buffering")}),e.h.D(e.g,google.ima.AdEvent.Type.IMPRESSION,function(e){t(e,"ad-impression")}),e.h.D(e.g,google.ima.AdEvent.Type.DURATION_CHANGE,function(e){t(e,"ad-duration-changed")}),e.h.D(e.g,google.ima.AdEvent.Type.USER_CLOSE,function(e){t(e,"ad-closed")}),e.h.D(e.g,google.ima.AdEvent.Type.LOADED,function(e){t(e,"ad-loaded")}),e.h.D(e.g,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(e){t(e,"all-ads-completed")}),e.h.D(e.g,google.ima.AdEvent.Type.LINEAR_CHANGED,function(e){t(e,"ad-linear-changed")}),e.h.D(e.g,google.ima.AdEvent.Type.AD_METADATA,function(e){t(e,"ad-metadata")}),e.h.D(e.g,google.ima.AdEvent.Type.LOG,function(e){t(e,"ad-recoverable-error")}),e.h.D(e.g,google.ima.AdEvent.Type.AD_BREAK_READY,function(e){t(e,"ad-break-ready")}),e.h.D(e.g,google.ima.AdEvent.Type.INTERACTION,function(e){t(e,"ad-interaction")})}function Df(e,t){var n=t.getAd();n?(e.j=new wf(n,e.g,e.i),t.type!=google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED||e.o.supportsMultipleMediaElements||e.l(new Nr("ad-content-pause-requested")),t=(new Map).set("ad",e.j).set("sdkAdObject",n).set("originalEvent",t),e.l(new Nr("ad-started",t)),e.j.isLinear()&&(e.s.setAttribute("ad-active","true"),e.o.customPlayheadTracker||e.i.pause(),e.i.muted?(t=e.j,t.l=e.i.volume,t.h.setVolume(0)):e.j.setVolume(e.i.volume))):Z("The IMA SDK fired a "+t.type+" event with no associated ad. Unable to play ad!")}function Rf(e,t){t&&t.type==google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED&&!e.o.supportsMultipleMediaElements&&e.l(new Nr("ad-content-resume-requested")),e.l(new Nr("ad-stopped",(new Map).set("originalEvent",t))),e.j&&e.j.isLinear()&&(e.s.removeAttribute("ad-active"),e.o.customPlayheadTracker||e.i.ended||e.i.play())}function Mf(e,t,n,i,r){this.g=e,this.h=t,this.j=n,this.l=i,this.i=r}function Lf(e,t,n,i){var r=this;this.F=e,this.B=t,this.i=n,this.C=null,this.m=!0,this.s=this.i,this.g=i,this.G=new Set,this.A=new Set,this.o=new Map,this.h=new eh,Bf(this),this.I=new se,this.j=new se,this.H=!1,this.l=null,this.I.D(this.i,"timeupdate",function(){if(!r.H){var e=null==r.l||0==r.l;r.l=r.i.currentTime,(e=Of(r,e))&&Nf(r,e,1,1,Date.now())}}),new Ut(function(){var e,t,n,i,s,a,o,l,u,d;return N(function(h){switch(h.g){case 1:if(!r.A.size||r.H||null==r.l){h.u(0);break}e=!1,t=Array.from(r.A),n=r.B.Qb(),i=c(t),s=i.next();case 3:if(s.done){h.u(5);break}if(a=s.value,o=a.endTime||a.startTime,!(1<=n.start-o)){l=a.startTime-r.l,0<l&&10>=l&&(r.o.has(a)||r.o.set(a,r.h.preload(a.uri))),h.u(4);break}if(!r.o.has(a)){h.u(7);break}return S(h,r.o.get(a),8);case 8:(u=h.h)&&u.destroy(),r.o.delete(a);case 7:d=JSON.stringify(a),r.G.has(d)&&r.G.delete(d),r.A.delete(a),e=!0;case 4:s=i.next(),h.u(3);break;case 5:e&&Ff(r),w(h)}})}).Sa(1)}function Pf(e,t){var n,i,r,s,a,o,l,u;N(function(d){if(1==d.g)return e.B.Mg()==vf&&e.m?(Z("Unsupported interstitial when using single media element",t),d.return()):(Bf(e),n=!1,S(d,Uf(e,t),2));if(i=d.h,i.length)for(r=c(i),s=r.next();!s.done;s=r.next())a=s.value,o=JSON.stringify(a),e.G.has(o)||(n=!0,e.G.add(o),e.A.add(a),l=!1,t.Cb&&null==e.l?l=!0:0!=a.startTime||a.ef?null!=e.l&&(u=t.startTime-e.l,0<u&&10>=u&&(l=!0)):l=!0,l&&(e.o.has(a)||e.o.set(a,e.h.preload(a.uri))));else Z("Unsupported interstitial",t);n&&Ff(e),w(d)})}function Of(e,t,n){n=void 0===n?0:n;var i=0,r=null;if(e.A.size&&null!=e.l){var s=e.i.ended,a=Array.from(e.A).sort(function(e,t){return t.startTime-e.startTime});a=c(a);for(var o=a.next();!o.done;o=a.next()){o=o.value;var l=!1;if(t?l=o.Cb:s?l=o.sc:o.Cb||o.sc||(l=e.l-Math.round(1e3*o.startTime)/1e3,l=0<l&&(1>=l||!o.ef)),l){if(i==n){r=o;break}i++}}}return r}function Nf(e,t,n,i,r,s){var a,o,l,u,c,d,h,f,p,g,m,v,y,b;s=void 0===s?0:s,N(function(_){switch(_.g){case 1:if(a=Date.now(),!e.s.parentElement&&e.F&&e.F.appendChild(e.s),1==i&&1==n&&(n=Array.from(e.A).filter(function(e){return t.Cb?e.Cb==t.Cb:t.sc?e.sc==t.sc:.001>Math.abs(e.startTime-t.startTime)}).length),(t.once||t.Cb)&&(s++,e.A.delete(t),Ff(e)),e.H=!0,!e.m||1!=i){_.u(2);break}return e.g(new Nr("ad-content-pause-requested",(new Map).set("saveLivePosition",!0))),o=new Ir,l=function(t){return N(function(n){if(1==n.g)return"detach"!=t.state?n.u(0):rn()?S(n,new Promise(function(e){return new Ut(e).Y(.1)}),3):n.u(3);o.resolve(),e.j.lb(e.B,"onstatechange",l),w(n)})},e.j.D(e.B,"onstatechange",l),S(_,o,2);case 2:return e.m||(e.i.pause(),null!=t.Rc&&0!=t.Rc&&(e.i.currentTime+=t.Rc)),u=!1,c=null,d=function(){if(!e.m&&null==t.Rc)if(t.Ke&&t.endTime&&1/0!=t.endTime)e.i.currentTime!=t.endTime&&(e.i.currentTime=t.endTime);else{var n=Date.now();e.i.currentTime+=(n-r)/1e3,r=n}},h=function(){var a,o;return N(function(l){if(1==l.g)return d(),c&&c.stop(),(a=Of(e,t.Cb,i-s))?(e.g(new Nr("ad-stopped")),e.j.Ra(),Nf(e,a,n,++i,r,s),l.u(0)):e.m?S(l,e.h.detach(),4):S(l,e.h.dc(),4);e.m&&(o=t.Rc,null==o&&(o=t.Ke&&t.endTime&&1/0!=t.endTime?t.endTime-(e.l||0):(Date.now()-r)/1e3),e.g(new Nr("ad-content-resume-requested",(new Map).set("offset",o)))),e.g(new Nr("ad-stopped")),e.j.Ra(),e.H=!1,e.m||(d(),e.i.ended||e.i.play()),w(l)})},f=function(t){return N(function(n){return u?n.return():(u=!0,e.g(new Nr("ad-error",(new Map).set("originalEvent",t))),S(n,h(),0))})},p=function(){return N(function(t){if(1==t.g)return u?t.return():(u=!0,S(t,h(),2));e.g(new Nr("ad-complete")),w(t)})},g=function(){return N(function(t){return u?t.return():(u=!0,e.g(new Nr("ad-skipped")),S(t,h(),0))})},m=new Mf(e.s,t.isSkippable,g,n,i),e.m||(m.setMuted(e.i.muted),m.setVolume(e.i.volume)),e.g(new Nr("ad-started",(new Map).set("ad",m))),m.canSkipNow()&&e.g(new Nr("ad-skip-state-changed")),e.j.ha(e.h,"error",f),e.j.ha(e.h,"firstquartile",function(){d(),e.g(new Nr("ad-first-quartile"))}),e.j.ha(e.h,"midpoint",function(){d(),e.g(new Nr("ad-midpoint"))}),e.j.ha(e.h,"thirdquartile",function(){d(),e.g(new Nr("ad-third-quartile"))}),e.j.ha(e.h,"complete",p),e.j.D(e.s,"play",function(){e.g(new Nr("ad-resumed"))}),e.j.D(e.s,"pause",function(){e.g(new Nr("ad-paused"))}),e.j.D(e.s,"volumechange",function(){e.s.muted?e.g(new Nr("ad-muted")):e.g(new Nr("ad-volume-changed"))}),E(_,4),t.Wf&&(c=new Ut(function(){m.skip()}).Y(t.Wf)),Bf(e),S(_,e.h.Ub(e.s),6);case 6:return e.o.has(t)?S(_,e.o.get(t),10):S(_,e.h.load(t.uri),8);case 10:return v=_.h,e.o.delete(t),S(_,v?e.h.load(v):e.h.load(t.uri),8);case 8:y=(Date.now()-a)/1e3,e.g(new Nr("ads-loaded",(new Map).set("loadTime",y))),e.m&&e.i.play(),k(_,0);break;case 4:b=A(_),f(b),w(_)}})}function Uf(e,t){var n,i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,w,x,I,C,D,R,M,L,P,O,U,F;return N(function(N){switch(N.g){case 1:if(n=[],!t)return N.return(n);if(i=t.values.find(function(e){return"X-ASSET-URI"==e.key}),r=t.values.find(function(e){return"X-ASSET-LIST"==e.key}),!i&&!r)return N.return(n);if(s=t.values.find(function(e){return"X-RESTRICT"==e.key}),o=a=!0,s&&s.data&&(l=s.data,a=!l.includes("SKIP"),o=!l.includes("JUMP")),u=null,(d=t.values.find(function(e){return"X-RESUME-OFFSET"==e.key}))&&(h=d.data,u=parseFloat(h),isNaN(u)&&(u=null)),f=null,(p=t.values.find(function(e){return"X-PLAYOUT-LIMIT"==e.key}))&&(g=p.data,f=parseFloat(g),isNaN(f)&&(f=null)),y=v=m=!1,(b=t.values.find(function(e){return"CUE"==e.key}))&&(_=b.data,m=_.includes("ONCE"),v=_.includes("PRE"),y=_.includes("POST")),T=!1,(w=t.values.find(function(e){return"X-TIMELINE-OCCUPIES"==e.key}))?(x=w.data,T=x.includes("RANGE")):!d&&e.B.V()&&(T=!v&&!y),i){if(I=i.data,!I)return N.return(n);n.push({startTime:t.startTime,endTime:t.endTime,uri:I,isSkippable:a,ef:o,Rc:u,Wf:f,once:m,Cb:v,sc:y,Ke:T}),N.u(2);break}if(!r){N.u(2);break}return C=r.data,C?(D=zr([C],Ar()),R=e.B.zb().request(7,D),E(N,4),S(N,R.promise,6)):N.return(n);case 6:for(M=N.h,L=hn(M.data),P=JSON.parse(L),O=c(P.ASSETS),U=O.next();!U.done;U=O.next())F=U.value,F.URI&&n.push({startTime:t.startTime,endTime:t.endTime,uri:F.URI,isSkippable:a,ef:o,Rc:u,Wf:f,once:m,Cb:v,sc:y,Ke:T});k(N,2);break;case 4:A(N);case 2:return N.return(n)}})}function Ff(e){for(var t=[],n={},i=c(e.A),r=i.next();!r.done;n={vb:n.vb},r=i.next())r=r.value,n.vb={start:r.startTime,end:null},r.Cb?(n.vb.start=0,n.vb.end=null):r.sc?(n.vb.start=-1,n.vb.end=null):r.Ke&&(n.vb.end=r.endTime),t.find(function(e){return function(t){return e.vb.start==t.start&&e.vb.end==t.end}}(n))||t.push(n.vb);e.g(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",t)))}function Bf(e){e.h.configure(e.B.Og());var t=e.h.zb();t.Ag(),t.Bg(),Gr(e.B.zb(),t)}function jf(e){this.h=e||"",this.g=0}function Vf(e){Hf(e,/[ \t]+/gm)}function Hf(e,t){return t.lastIndex=e.g,t=t.exec(e.h),t=null==t?null:{position:t.index,length:t[0].length,results:t},e.g==e.h.length||null==t||t.position!=e.g?null:(e.g+=t.length,t.results)}function $f(e){return e.g==e.h.length?null:(e=Hf(e,/[^ \t\n]*/gm))?e[0]:null}function Gf(e,t,n,i,r){if(this.h=e,e=this.h.skipOffset)if(e=Hf(new jf(e),zf),null==e)e=null;else{var s=Number(e[2]),a=Number(e[3]);e=59<s||59<a?null:(Number(e[4])||0)/1e3+a+60*s+3600*(Number(e[1])||0)}else e=null;this.j=e,this.g=r,this.i=t,this.l=n,this.o=i,this.m=!1}i=wf.prototype,i.needsSkipUI=function(){return!1},i.getDuration=function(){return this.g.getDuration()},i.getMinSuggestedDuration=function(){return this.g.getMinSuggestedDuration()},i.getRemainingTime=function(){return this.h.getRemainingTime()},i.isPaused=function(){return this.i},i.isSkippable=function(){return 0<=this.g.getSkipTimeOffset()},i.getTimeUntilSkippable=function(){var e=this.g.getSkipTimeOffset();return e=this.getRemainingTime()-e,Math.max(e,0)},i.canSkipNow=function(){return this.h.getAdSkippableState()},i.skip=function(){return this.h.skip()},i.pause=function(){return this.h.pause()},i.play=function(){return this.h.resume()},i.getVolume=function(){return this.h.getVolume()},i.setVolume=function(e){return this.j.volume=e,this.h.setVolume(e)},i.isMuted=function(){return 0==this.h.getVolume()},i.isLinear=function(){return this.g.isLinear()},i.resize=function(e,t){var n=!1,i=this.j;document.fullscreenEnabled?n=!!document.fullscreenElement:i.webkitSupportsFullscreen&&(n=i.webkitDisplayingFullscreen),this.h.resize(e,t,n?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},i.setMuted=function(e){(this.j.muted=e)?(this.l=this.getVolume(),this.h.setVolume(0)):this.h.setVolume(this.l)},i.getSequenceLength=function(){var e=this.g.getAdPodInfo();return null==e?1:e.getTotalAds()},i.getPositionInSequence=function(){var e=this.g.getAdPodInfo();return null==e?1:e.getAdPosition()},i.getTitle=function(){return this.g.getTitle()},i.getDescription=function(){return this.g.getDescription()},i.getVastMediaBitrate=function(){return this.g.getVastMediaBitrate()},i.getVastMediaHeight=function(){return this.g.getVastMediaHeight()},i.getVastMediaWidth=function(){return this.g.getVastMediaWidth()},i.getAdId=function(){return this.g.getAdId()},i.getCreativeAdId=function(){return this.g.getCreativeAdId()},i.getAdvertiserName=function(){return this.g.getAdvertiserName()},i.getMediaUrl=function(){return this.g.getMediaUrl()},i.getTimeOffset=function(){var e=this.g.getAdPodInfo();return null==e?0:e.getTimeOffset()},i.getPodIndex=function(){var e=this.g.getAdPodInfo();return null==e?0:e.getPodIndex()},i.release=function(){this.h=this.g=null},G("shaka.ads.ClientSideAd",wf),wf.prototype.release=wf.prototype.release,wf.prototype.getPodIndex=wf.prototype.getPodIndex,wf.prototype.getTimeOffset=wf.prototype.getTimeOffset,wf.prototype.getMediaUrl=wf.prototype.getMediaUrl,wf.prototype.getAdvertiserName=wf.prototype.getAdvertiserName,wf.prototype.getCreativeAdId=wf.prototype.getCreativeAdId,wf.prototype.getAdId=wf.prototype.getAdId,wf.prototype.getVastMediaWidth=wf.prototype.getVastMediaWidth,wf.prototype.getVastMediaHeight=wf.prototype.getVastMediaHeight,wf.prototype.getVastMediaBitrate=wf.prototype.getVastMediaBitrate,wf.prototype.getDescription=wf.prototype.getDescription,wf.prototype.getTitle=wf.prototype.getTitle,wf.prototype.getPositionInSequence=wf.prototype.getPositionInSequence,wf.prototype.getSequenceLength=wf.prototype.getSequenceLength,wf.prototype.setMuted=wf.prototype.setMuted,wf.prototype.resize=wf.prototype.resize,wf.prototype.isLinear=wf.prototype.isLinear,wf.prototype.isMuted=wf.prototype.isMuted,wf.prototype.setVolume=wf.prototype.setVolume,wf.prototype.getVolume=wf.prototype.getVolume,wf.prototype.play=wf.prototype.play,wf.prototype.pause=wf.prototype.pause,wf.prototype.skip=wf.prototype.skip,wf.prototype.canSkipNow=wf.prototype.canSkipNow,wf.prototype.getTimeUntilSkippable=wf.prototype.getTimeUntilSkippable,wf.prototype.isSkippable=wf.prototype.isSkippable,wf.prototype.isPaused=wf.prototype.isPaused,wf.prototype.getRemainingTime=wf.prototype.getRemainingTime,wf.prototype.getMinSuggestedDuration=wf.prototype.getMinSuggestedDuration,wf.prototype.getDuration=wf.prototype.getDuration,wf.prototype.needsSkipUI=wf.prototype.needsSkipUI,G("shaka.ads.Utils",Ef),Ef.ADS_LOADED="ads-loaded",Ef.AD_STARTED="ad-started",Ef.AD_FIRST_QUARTILE="ad-first-quartile",Ef.AD_MIDPOINT="ad-midpoint",Ef.AD_THIRD_QUARTILE="ad-third-quartile",Ef.AD_COMPLETE="ad-complete",Ef.AD_STOPPED="ad-stopped",Ef.AD_SKIPPED="ad-skipped",Ef.AD_VOLUME_CHANGED="ad-volume-changed",Ef.AD_MUTED="ad-muted",Ef.AD_PAUSED="ad-paused",Ef.AD_RESUMED="ad-resumed",Ef.AD_SKIP_STATE_CHANGED="ad-skip-state-changed",Ef.CUEPOINTS_CHANGED="ad-cue-points-changed",Ef.IMA_AD_MANAGER_LOADED="ima-ad-manager-loaded",Ef.IMA_STREAM_MANAGER_LOADED="ima-stream-manager-loaded",Ef.AD_CLICKED="ad-clicked",Ef.AD_PROGRESS="ad-progress",Ef.AD_BUFFERING="ad-buffering",Ef.AD_IMPRESSION="ad-impression",Ef.AD_DURATION_CHANGED="ad-duration-changed",Ef.AD_CLOSED="ad-closed",Ef.AD_LOADED="ad-loaded",Ef.ALL_ADS_COMPLETED="all-ads-completed",Ef.AD_LINEAR_CHANGED="ad-linear-changed",Ef.AD_METADATA="ad-metadata",Ef.AD_RECOVERABLE_ERROR="ad-recoverable-error",Ef.AD_ERROR="ad-error",Ef.AD_BREAK_READY="ad-break-ready",Ef.AD_INTERACTION="ad-interaction",Ef.AD_CONTENT_PAUSE_REQUESTED="ad-content-pause-requested",Ef.AD_CONTENT_RESUME_REQUESTED="ad-content-resume-requested",Ef.AD_CONTENT_ATTACH_REQUESTED="ad-content-attach-requested",xf.prototype.configure=function(e){this.o=e},xf.prototype.stop=function(){this.g&&this.g.stop(),this.s&&gd(this.s)},xf.prototype.release=function(){this.stop(),this.A&&this.A.disconnect(),this.h&&this.h.release(),this.g&&this.g.destroy(),this.m.destroy(),this.C.destroy()},i=Mf.prototype,i.needsSkipUI=function(){return!0},i.getDuration=function(){var e=this.g.duration;return isNaN(e)?-1:e},i.getMinSuggestedDuration=function(){return this.getDuration()},i.getRemainingTime=function(){var e=this.g.duration;return isNaN(e)?-1:e-this.g.currentTime},i.isPaused=function(){return this.g.paused},i.isSkippable=function(){return this.h},i.getTimeUntilSkippable=function(){return this.h?0:Math.max(this.getRemainingTime(),0)},i.canSkipNow=function(){return 0==this.getTimeUntilSkippable()},i.skip=function(){this.j()},i.pause=function(){return this.g.pause()},i.play=function(){return this.g.play()},i.getVolume=function(){return this.g.volume},i.setVolume=function(e){this.g.volume=e},i.isMuted=function(){return this.g.muted},i.isLinear=function(){return!0},i.resize=function(){},i.setMuted=function(e){this.g.muted=e},i.getSequenceLength=function(){return this.l},i.getPositionInSequence=function(){return this.i},i.getTitle=function(){return""},i.getDescription=function(){return""},i.getVastMediaBitrate=function(){return 0},i.getVastMediaHeight=function(){return 0},i.getVastMediaWidth=function(){return 0},i.getAdId=function(){return""},i.getCreativeAdId=function(){return""},i.getAdvertiserName=function(){return""},i.getMediaUrl=function(){return null},i.getTimeOffset=function(){return 0},i.getPodIndex=function(){return 0},i.release=function(){this.g=null},G("shaka.ads.InterstitialAd",Mf),Mf.prototype.release=Mf.prototype.release,Mf.prototype.getPodIndex=Mf.prototype.getPodIndex,Mf.prototype.getTimeOffset=Mf.prototype.getTimeOffset,Mf.prototype.getMediaUrl=Mf.prototype.getMediaUrl,Mf.prototype.getAdvertiserName=Mf.prototype.getAdvertiserName,Mf.prototype.getCreativeAdId=Mf.prototype.getCreativeAdId,Mf.prototype.getAdId=Mf.prototype.getAdId,Mf.prototype.getVastMediaWidth=Mf.prototype.getVastMediaWidth,Mf.prototype.getVastMediaHeight=Mf.prototype.getVastMediaHeight,Mf.prototype.getVastMediaBitrate=Mf.prototype.getVastMediaBitrate,Mf.prototype.getDescription=Mf.prototype.getDescription,Mf.prototype.getTitle=Mf.prototype.getTitle,Mf.prototype.getPositionInSequence=Mf.prototype.getPositionInSequence,Mf.prototype.getSequenceLength=Mf.prototype.getSequenceLength,Mf.prototype.setMuted=Mf.prototype.setMuted,Mf.prototype.resize=Mf.prototype.resize,Mf.prototype.isLinear=Mf.prototype.isLinear,Mf.prototype.isMuted=Mf.prototype.isMuted,Mf.prototype.setVolume=Mf.prototype.setVolume,Mf.prototype.getVolume=Mf.prototype.getVolume,Mf.prototype.play=Mf.prototype.play,Mf.prototype.pause=Mf.prototype.pause,Mf.prototype.skip=Mf.prototype.skip,Mf.prototype.canSkipNow=Mf.prototype.canSkipNow,Mf.prototype.getTimeUntilSkippable=Mf.prototype.getTimeUntilSkippable,Mf.prototype.isSkippable=Mf.prototype.isSkippable,Mf.prototype.isPaused=Mf.prototype.isPaused,Mf.prototype.getRemainingTime=Mf.prototype.getRemainingTime,Mf.prototype.getMinSuggestedDuration=Mf.prototype.getMinSuggestedDuration,Mf.prototype.getDuration=Mf.prototype.getDuration,Mf.prototype.needsSkipUI=Mf.prototype.needsSkipUI,Lf.prototype.configure=function(e){this.F&&this.m==e.supportsMultipleMediaElements&&((this.m=!e.supportsMultipleMediaElements)?(this.s=this.i,this.C&&(this.C.parentElement&&this.F.removeChild(this.C),this.C=null)):(this.C||(e=document.createElement(this.i.tagName),e.autoplay=!0,e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgb(0, 0, 0)",e.setAttribute("playsinline",""),this.C=e),this.s=this.C))},Lf.prototype.stop=function(){this.j&&this.j.Ra(),this.G.clear(),this.A.clear(),this.h.lf(),this.o.clear(),this.h.detach(),this.H=!1,this.l=null},Lf.prototype.release=function(){this.stop(),this.I&&this.I.release(),this.j&&this.j.release(),this.F&&gd(this.F),this.h.destroy()},i=Gf.prototype,i.needsSkipUI=function(){return!0},i.getDuration=function(){return this.h.durationInSeconds},i.getMinSuggestedDuration=function(){return this.getDuration()},i.getRemainingTime=function(){return this.h.startTimeInSeconds+this.h.durationInSeconds-this.g.currentTime},i.isPaused=function(){return this.g.paused},i.isSkippable=function(){return"number"==typeof this.j},i.getTimeUntilSkippable=function(){if("number"!=typeof this.j)return this.getRemainingTime();var e=this.getRemainingTime()+this.j-this.getDuration();return Math.max(e,0)},i.canSkipNow=function(){return 0==this.getTimeUntilSkippable()},i.skip=function(){this.m=!0,this.g.currentTime+=this.getRemainingTime()},i.pause=function(){return this.g.pause()},i.play=function(){return this.g.play()},i.getVolume=function(){return this.g.volume},i.setVolume=function(e){this.g.volume=e},i.isMuted=function(){return this.g.muted},i.isLinear=function(){return this.o},i.resize=function(){},i.setMuted=function(e){this.g.muted=e},i.getSequenceLength=function(){return this.l?this.l:1},i.getPositionInSequence=function(){return this.i?this.i:1},i.getTitle=function(){return this.h.adTitle},i.getDescription=function(){return""},i.getVastMediaBitrate=function(){return 0},i.getVastMediaHeight=function(){return 0},i.getVastMediaWidth=function(){return 0},i.getAdId=function(){return this.h.adId},i.getCreativeAdId=function(){return this.h.creativeId},i.getAdvertiserName=function(){return""},i.getMediaUrl=function(){return null},i.getTimeOffset=function(){return 0},i.getPodIndex=function(){return 0},i.release=function(){this.l=this.i=this.g=this.h=null},G("shaka.ads.MediaTailorAd",Gf),Gf.prototype.release=Gf.prototype.release,Gf.prototype.getPodIndex=Gf.prototype.getPodIndex,Gf.prototype.getTimeOffset=Gf.prototype.getTimeOffset,Gf.prototype.getMediaUrl=Gf.prototype.getMediaUrl,Gf.prototype.getAdvertiserName=Gf.prototype.getAdvertiserName,Gf.prototype.getCreativeAdId=Gf.prototype.getCreativeAdId,Gf.prototype.getAdId=Gf.prototype.getAdId,Gf.prototype.getVastMediaWidth=Gf.prototype.getVastMediaWidth,Gf.prototype.getVastMediaHeight=Gf.prototype.getVastMediaHeight,Gf.prototype.getVastMediaBitrate=Gf.prototype.getVastMediaBitrate,Gf.prototype.getDescription=Gf.prototype.getDescription,Gf.prototype.getTitle=Gf.prototype.getTitle,Gf.prototype.getPositionInSequence=Gf.prototype.getPositionInSequence,Gf.prototype.getSequenceLength=Gf.prototype.getSequenceLength,Gf.prototype.setMuted=Gf.prototype.setMuted,Gf.prototype.resize=Gf.prototype.resize,Gf.prototype.isLinear=Gf.prototype.isLinear,Gf.prototype.isMuted=Gf.prototype.isMuted,Gf.prototype.setVolume=Gf.prototype.setVolume,Gf.prototype.getVolume=Gf.prototype.getVolume,Gf.prototype.play=Gf.prototype.play,Gf.prototype.pause=Gf.prototype.pause,Gf.prototype.skip=Gf.prototype.skip,Gf.prototype.canSkipNow=Gf.prototype.canSkipNow,Gf.prototype.getTimeUntilSkippable=Gf.prototype.getTimeUntilSkippable,Gf.prototype.isSkippable=Gf.prototype.isSkippable,Gf.prototype.isPaused=Gf.prototype.isPaused,Gf.prototype.getRemainingTime=Gf.prototype.getRemainingTime,Gf.prototype.getMinSuggestedDuration=Gf.prototype.getMinSuggestedDuration,Gf.prototype.getDuration=Gf.prototype.getDuration,Gf.prototype.needsSkipUI=Gf.prototype.needsSkipUI;var zf=/(?:(\d{1,}):)?(\d{2}):(\d{2})((\.(\d{1,3})))?/g;function qf(e,t,n,i){this.B=e,this.K=t,this.h=n,this.l=null,this.U=NaN,this.i=i,this.I=!1,this.A=null,this.j=[],this.N=[],this.L=this.C=this.g=null,this.F=new Map,this.m=[],this.s=[],this.G="",this.R=!0,this.H="",this.o=new se}function Wf(e,t,n){var i,r,s,a,o,l,u,c,d,h,f;N(function(p){if(1==p.g)return i=zr([t],Ar()),i.method="POST",n&&(r=JSON.stringify(n),i.body=gn(r)),s=e.K.request(7,i),E(p,2),S(p,s.promise,4);if(2!=p.g){if(a=p.h,o=hn(a.data),l=JSON.parse(o),!l.manifestUrl||!l.trackingUrl)throw Error("Insufficient data from MediaTailor.");return u=new ht(t),c=new ht(l.trackingUrl),e.G=u.resolve(c).toString(),d=Date.now()/1e3,h=d-e.U,e.i(new Nr("ads-loaded",(new Map).set("loadTime",h))),f=new ht(l.manifestUrl),e.l.resolve(u.resolve(f).toString()),e.l=null,k(p,0)}if(A(p),!e.H.length)return e.l.reject("MediaTailor request returned an error and there was no backup asset uri provided."),e.l=null,p.return();e.l.resolve(e.H),e.l=null,w(p)})}function Kf(e,t,n){var i,r,s,a,o,l,u,d,h,f,p,g,m,v,y;N(function(b){if(1==b.g)return i=zr([t],Ar()),r=e.K.request(7,i),E(b,2),S(b,r.promise,4);if(2!=b.g){if(s=b.h,a=[],o=hn(s.data),l=JSON.parse(o),0<l.avails.length){if(JSON.stringify(e.j)!=JSON.stringify(l.avails)){for(e.j=l.avails,u=c(e.j),d=u.next();!d.done;d=u.next())for(h=d.value,f=c(h.nonLinearAdsList),p=f.next();!p.done;p=f.next())for(g=p.value,m=c(g.nonLinearAdList),v=m.next();!v.done;v=m.next())y=v.value,Yf(e,y);a=e.getCuePoints(),e.i(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",a)))}}else e.j.length&&e.i(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",a))),ep(e),e.j=[];return n&&(e.I||0<a.length)&&Qf(e),k(b,0)}A(b),w(b)})}function Yf(e,t){var n,i,r,s,a,o,l;N(function(u){return 1==u.g?t.staticResource?(n=Xf(t),e.F.get(n)?u.return():(i=zr([t.staticResource],Ar()),r=e.K.request(7,i),E(u,2),e.F.set(n,[]),S(u,r.promise,4))):u.return():2!=u.g?(s=u.h,a=hn(s.data),o=JSON.parse(a),l=o.apps,e.F.set(n,l),k(u,0)):(A(u),e.F.delete(n),void w(u))})}function Xf(e){return[e.adId,e.adParameters,e.adSystem,e.adTitle,e.creativeAdId,e.creativeId,e.creativeSequence,e.height,e.width,e.staticResource].join("")}function Qf(e){Jf(e),e.I||(Zf(e),e.o.D(e.h,"seeked",function(){Zf(e)}),e.o.D(e.h,"ended",function(){ep(e)})),e.o.D(e.h,"timeupdate",function(){Jf(e)})}function Zf(e){var t=e.h.currentTime;if(0!=t&&null==e.A){for(var n,i,r=c(e.j),s=r.next();!s.done;s=r.next()){s=s.value;for(var a=c(s.ads),o=a.next();!o.done;o=a.next())if(o=o.value,i){if(o.startTimeInSeconds<t&&o.startTimeInSeconds>i.startTimeInSeconds+i.durationInSeconds){i=o,n=s;break}}else o.startTimeInSeconds<t&&(i=o,n=s)}n&&i&&!e.N.includes(i.adId)&&(e.A=t,e.h.currentTime=n.startTimeInSeconds)}}function Jf(e){if(e.h.duration&&(e.g||e.j.length)){var t=e.h.currentTime,n=!1;if(e.g){n=!0;var i=e.C,r=i.startTimeInSeconds+.5*i.durationInSeconds,s=i.startTimeInSeconds+.75*i.durationInSeconds;t>=i.startTimeInSeconds+.25*i.durationInSeconds&&!e.s.includes("firstQuartile")?(e.s.push("firstQuartile"),np(e,"firstQuartile")):t>=r&&!e.s.includes("midpoint")?(e.s.push("midpoint"),np(e,"midpoint")):t>=s&&!e.s.includes("thirdQuartile")&&(e.s.push("thirdQuartile"),np(e,"thirdQuartile")),i=e.g.getRemainingTime(),r=e.g.getDuration(),e.g.canSkipNow()&&0<i&&0<r&&np(e,"skipStateChanged"),0<r&&(0>=i||i>r)&&ep(e)}if(!e.g||!e.g.isLinear()){e:for(i=c(e.j),r=i.next();!r.done;r=i.next()){if(r=r.value,e.g&&e.g.isLinear())break;for(s=0;s<r.ads.length;s++){var a=r.ads[s],o=a.startTimeInSeconds+a.durationInSeconds;if(a.startTimeInSeconds<=t&&o>t){if(e.N.includes(a.adId)){if(e.h.ended)continue;e.h.currentTime=o;break e}ep(e),e.L=r,e.g=new Gf(a,s+1,r.ads.length,!0,e.h),e.C=a,0===s&&np(e,"breakStart"),tp(e);break}}}if(!e.g)for(i=c(e.j),r=i.next();!r.done;r=i.next()){if(r=r.value,e.g)break;for(s=0;s<r.nonLinearAdsList.length;s++)if(a=r.nonLinearAdsList[s],a.nonLinearAdList.length){o=r.startTimeInSeconds;var l=e.F.get(Xf(a.nonLinearAdList[0]));if(o<=t&&l&&l.length){ep(e),o=e,l=c(l);for(var u=l.next();!u.done;u=l.next())if(u=u.value,u.data.source.length){var d=document.createElement("img");d.src=u.data.source[0].url,d.style.top=(u.placeholder.top||0)+"%",d.style.height=100-(u.placeholder.top||0)+"%",d.style.left=(u.placeholder.left||0)+"%",d.style.maxWidth=100-(u.placeholder.left||0)+"%",d.style.objectFit="contain",d.style.position="absolute",o.B.appendChild(d)}e.L=r,e.g=new Gf(a,s+1,r.ads.length,!1,e.h),e.C=a,0===s&&np(e,"breakStart"),tp(e);break}}}n&&!e.g&&(t=e.h.currentTime,e.A&&e.A>t&&(e.h.currentTime=e.A),e.A=null)}}}function ep(e){if(e.g){for(;e.B.lastChild;)e.B.removeChild(e.B.firstChild);e.I||e.N.push(e.C.adId);var t=e.g.m;np(e,void 0!==t&&t?"skip":"complete"),t=c(e.m);for(var n=t.next();!n.done;n=t.next())n=n.value,e.o.lb(n.target,n.type,n.listener);e.m=[],e.s=[],t=e.g.getPositionInSequence(),n=e.g.getSequenceLength(),t===n&&np(e,"breakEnd"),e.g=null,e.C=null,e.L=null}}function tp(e){var t=!1;e.h.paused?t=!0:(np(e,"impression"),np(e,"start")),e.m.push({target:e.h,type:"volumechange",listener:function(){e.h.muted&&np(e,"mute")}}),e.m.push({target:e.h,type:"volumechange",listener:function(){e.h.muted||np(e,"unmute")}}),e.m.push({target:e.h,type:"play",listener:function(){t?(np(e,"impression"),np(e,"start"),t=!1):np(e,"resume")}}),e.m.push({target:e.h,type:"pause",listener:function(){np(e,"pause")}});for(var n=c(e.m),i=n.next();!i.done;i=n.next())i=i.value,e.o.D(i.target,i.type,i.listener)}function np(e,t){var n=e.C.trackingEvents.find(function(e){return e.eventType==t});if(n||(n=e.L.adBreakTrackingEvents.find(function(e){return e.eventType==t})),n){n=c(n.beaconUrls);for(var i=n.next();!i.done;i=n.next())(i=i.value)&&""!=i&&(i=zr([i],Ar()),i.method="POST",e.K.request(7,i))}switch(t){case"impression":e.i(new Nr("ad-impression"));break;case"start":e.i(new Nr("ad-started",(new Map).set("ad",e.g)));break;case"mute":e.i(new Nr("ad-muted"));break;case"unmute":e.i(new Nr("ad-volume-changed"));break;case"resume":e.i(new Nr("ad-resumed"));break;case"pause":e.i(new Nr("ad-paused"));break;case"firstQuartile":e.i(new Nr("ad-first-quartile"));break;case"midpoint":e.i(new Nr("ad-midpoint"));break;case"thirdQuartile":e.i(new Nr("ad-third-quartile"));break;case"complete":e.i(new Nr("ad-complete")),e.i(new Nr("ad-stopped"));break;case"skip":e.i(new Nr("ad-skipped")),e.i(new Nr("ad-stopped"));break;case"breakStart":e.B.setAttribute("ad-active","true");break;case"breakEnd":e.B.removeAttribute("ad-active");break;case"skipStateChanged":e.i(new Nr("ad-skip-state-changed"))}}function ip(e,t){this.g=e,this.i=null,this.h=t}function rp(e,t,n,i){var r=this;this.s=e,this.l=t,this.j=null,this.F=NaN,this.i=i,this.G=!1,this.A=this.m=this.o=null,this.B="",this.C=[],this.h=new se,e=new google.ima.dai.api.UiSettings,e.setLocale(n),this.g=new google.ima.dai.api.StreamManager(this.l,this.s,e),this.i(new Nr("ima-stream-manager-loaded",(new Map).set("imaStreamManager",this.g))),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.LOADED,function(e){sp(r,e)}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.ERROR,function(){r.B.length?r.j.resolve(r.B):r.j.reject("IMA Stream request returned an error and there was no backup asset uri provided."),r.j=null}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,function(){}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.STARTED,function(e){e=e.getAd(),r.m=new ip(e,r.l),r.A&&(r.m.i=r.A),r.i(new Nr("ad-started",(new Map).set("ad",r.m))),r.s.setAttribute("ad-active","true")}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,function(){r.s.removeAttribute("ad-active");var e=r.l.currentTime;r.o&&r.o>e&&(r.l.currentTime=r.o,r.o=null)}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,function(e){r.A=e.getStreamData().adProgressData,r.m&&(r.m.i=r.A)}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,function(){r.i(new Nr("ad-first-quartile"))}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.MIDPOINT,function(){r.i(new Nr("ad-midpoint"))}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE,function(){r.i(new Nr("ad-third-quartile"))}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.COMPLETE,function(){r.i(new Nr("ad-complete")),r.i(new Nr("ad-stopped")),r.s.removeAttribute("ad-active"),r.m=null}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.SKIPPED,function(){r.i(new Nr("ad-skipped")),r.i(new Nr("ad-stopped"))}),this.h.D(this.g,google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED,function(e){var t=e.getStreamData();e=[],t=c(t.cuepoints);for(var n=t.next();!n.done;n=t.next())n=n.value,e.push({start:n.start,end:n.end});r.C=e,r.i(new Nr("ad-cue-points-changed",(new Map).set("cuepoints",e)))})}function sp(e,t){e.i(new Nr("ads-loaded",(new Map).set("loadTime",Date.now()/1e3-e.F))),t=t.getStreamData().url,e.j.resolve(t),e.j=null,e.G||e.h.D(e.l,"seeked",function(){var t=e.l.currentTime;if(0!=t){e.g.streamTimeForContentTime(t);var n=e.g.previousCuePointForStreamTime(t);n&&!n.played&&(e.o=t,e.l.currentTime=n.start)}})}function ap(){Br.call(this),this.g=this.h=this.i=this.j=null,this.m=new Tf,this.o=navigator.language,this.l=null}function op(e,t){if(t&&t.type)switch(t.type){case"ads-loaded":e.m.g.push(t.loadTime);break;case"ad-started":e.m.h++;break;case"ad-complete":e.m.j++;break;case"ad-skipped":e.m.l++;break;case"ad-error":e.m.i++}e.dispatchEvent(t)}function lp(e){return JSON.stringify(e,function(e,t){if("function"!=typeof t){if(t instanceof Event||t instanceof Nr){var n={};for(i in t)(e=t[i])&&"object"==typeof e?"detail"==i&&(n[i]=e):i in Event||(n[i]=e);return n}if(t instanceof Error){var i=new Set(["name","message","stack"]);for(n in t)i.add(n);for(e=c(Object.getOwnPropertyNames(t)),n=e.next();!n.done;n=e.next())i.add(n.value);for(e={},i=c(i),n=i.next();!n.done;n=i.next())n=n.value,e[n]=t[n];t={__type__:"Error",contents:e}}else if(t instanceof TimeRanges){for(i={__type__:"TimeRanges",length:t.length,start:[],end:[]},t=c(ao(t)),n=t.next();!n.done;n=t.next())n=n.value,e=n.end,i.start.push(n.start),i.end.push(e);t=i}else t=t instanceof Uint8Array?{__type__:"Uint8Array",entries:Array.from(t)}:"number"==typeof t?isNaN(t)?"NaN":isFinite(t)?t:0>t?"-Infinity":"Infinity":t;return t}})}function up(e){return JSON.parse(e,function(e,t){if("NaN"==t)var n=NaN;else if("-Infinity"==t)n=-1/0;else if("Infinity"==t)n=1/0;else if(t&&"object"==typeof t&&"TimeRanges"==t.__type__)n=cp(t);else if(t&&"object"==typeof t&&"Uint8Array"==t.__type__)n=new Uint8Array(t.entries);else if(t&&"object"==typeof t&&"Error"==t.__type__){for(n in e=t.contents,t=Error(e.message),e)t[n]=e[n];n=t}else n=t;return n})}function cp(e){return{length:e.length,start:function(t){return e.start[t]},end:function(t){return e.end[t]}}}qf.prototype.stop=function(){for(var e=c(this.m),t=e.next();!t.done;t=e.next())t=t.value,this.o.lb(t.target,t.type,t.listener);ep(this),this.m=[],this.s=[],this.G="",this.R=!0,this.H="",this.A=null,this.j=[],this.N=[],this.F.clear()},qf.prototype.release=function(){this.stop(),this.o&&this.o.release()},qf.prototype.onManifestUpdated=function(e){this.I=e,""!=this.G&&(Kf(this,this.G,this.R),this.R=!1)},qf.prototype.getCuePoints=function(){for(var e=[],t=c(this.j),n=t.next();!n.done;n=t.next()){n=c(n.value.ads);for(var i=n.next();!i.done;i=n.next())i=i.value,e.push({start:i.startTimeInSeconds,end:i.startTimeInSeconds+i.durationInSeconds})}return e},i=ip.prototype,i.needsSkipUI=function(){return!0},i.getDuration=function(){return this.i?this.i.duration:-1},i.getMinSuggestedDuration=function(){return this.getDuration()},i.getRemainingTime=function(){return this.i?this.i.duration-this.i.currentTime:-1},i.isPaused=function(){return this.h.paused},i.isSkippable=function(){return this.g.isSkippable()},i.getTimeUntilSkippable=function(){var e=this.g.getSkipTimeOffset();return e=this.getRemainingTime()-e,Math.max(e,0)},i.canSkipNow=function(){return 0==this.getTimeUntilSkippable()},i.skip=function(){this.h.currentTime+=this.getRemainingTime()},i.pause=function(){return this.h.pause()},i.play=function(){return this.h.play()},i.getVolume=function(){return this.h.volume},i.setVolume=function(e){this.h.volume=e},i.isMuted=function(){return this.h.muted},i.isLinear=function(){return!0},i.resize=function(){},i.setMuted=function(e){this.h.muted=e},i.getSequenceLength=function(){var e=this.g.getAdPodInfo();return null==e?1:e.getTotalAds()},i.getPositionInSequence=function(){var e=this.g.getAdPodInfo();return null==e?1:e.getAdPosition()},i.getTitle=function(){return this.g.getTitle()},i.getDescription=function(){return this.g.getDescription()},i.getVastMediaBitrate=function(){return 0},i.getVastMediaHeight=function(){return this.g.getVastMediaHeight()},i.getVastMediaWidth=function(){return this.g.getVastMediaWidth()},i.getAdId=function(){return this.g.getAdId()},i.getCreativeAdId=function(){return this.g.getCreativeAdId()},i.getAdvertiserName=function(){return this.g.getAdvertiserName()},i.getMediaUrl=function(){return null},i.getTimeOffset=function(){var e=this.g.getAdPodInfo();return null==e?0:e.getTimeOffset()},i.getPodIndex=function(){var e=this.g.getAdPodInfo();return null==e?0:e.getPodIndex()},i.release=function(){this.h=this.i=this.g=null},G("shaka.ads.ServerSideAd",ip),ip.prototype.release=ip.prototype.release,ip.prototype.getPodIndex=ip.prototype.getPodIndex,ip.prototype.getTimeOffset=ip.prototype.getTimeOffset,ip.prototype.getMediaUrl=ip.prototype.getMediaUrl,ip.prototype.getAdvertiserName=ip.prototype.getAdvertiserName,ip.prototype.getCreativeAdId=ip.prototype.getCreativeAdId,ip.prototype.getAdId=ip.prototype.getAdId,ip.prototype.getVastMediaWidth=ip.prototype.getVastMediaWidth,ip.prototype.getVastMediaHeight=ip.prototype.getVastMediaHeight,ip.prototype.getVastMediaBitrate=ip.prototype.getVastMediaBitrate,ip.prototype.getDescription=ip.prototype.getDescription,ip.prototype.getTitle=ip.prototype.getTitle,ip.prototype.getPositionInSequence=ip.prototype.getPositionInSequence,ip.prototype.getSequenceLength=ip.prototype.getSequenceLength,ip.prototype.setMuted=ip.prototype.setMuted,ip.prototype.resize=ip.prototype.resize,ip.prototype.isLinear=ip.prototype.isLinear,ip.prototype.isMuted=ip.prototype.isMuted,ip.prototype.setVolume=ip.prototype.setVolume,ip.prototype.getVolume=ip.prototype.getVolume,ip.prototype.play=ip.prototype.play,ip.prototype.pause=ip.prototype.pause,ip.prototype.skip=ip.prototype.skip,ip.prototype.canSkipNow=ip.prototype.canSkipNow,ip.prototype.getTimeUntilSkippable=ip.prototype.getTimeUntilSkippable,ip.prototype.isSkippable=ip.prototype.isSkippable,ip.prototype.isPaused=ip.prototype.isPaused,ip.prototype.getRemainingTime=ip.prototype.getRemainingTime,ip.prototype.getMinSuggestedDuration=ip.prototype.getMinSuggestedDuration,ip.prototype.getDuration=ip.prototype.getDuration,ip.prototype.needsSkipUI=ip.prototype.needsSkipUI,i=rp.prototype,i.configure=function(){},i.stop=function(){this.B="",this.o=null,this.C=[]},i.release=function(){this.stop(),this.h&&this.h.release()},i.onCueMetadataChange=function(e){if(e.key&&e.data){var t={};t[e.key]=e.data,this.g.onTimedMetadata(t)}},i.getCuePoints=function(){return this.C},y(ap,Br),i=ap.prototype,i.setLocale=function(e){this.o=e},i.configure=function(e){this.l=e,this.j&&this.j.configure(this.l),this.i&&this.i.configure(this.l),this.g&&this.g.configure(this.l)},i.initInterstitial=function(e,t,n){var i=this;this.j&&this.j.release(),this.j=new Lf(e,t,n,function(e){return op(i,e)}),this.j.configure(this.l)},i.initClientSide=function(t,n,i){var r=this;if(!e.google||!google.ima||!google.ima.AdsLoader)throw new It(2,10,1e4);this.i&&this.i.release(),this.i=new xf(t,n,this.o,i,function(e){return op(r,e)}),this.i.configure(this.l)},i.release=function(){this.j&&(this.j.release(),this.j=null),this.i&&(this.i.release(),this.i=null),this.h&&(this.h.release(),this.h=null),this.g&&(this.g.release(),this.g=null),Br.prototype.release.call(this)},i.onAssetUnload=function(){this.j&&this.j.stop(),this.i&&this.i.stop(),this.h&&this.h.stop(),this.g&&this.g.stop(),this.dispatchEvent(new Nr("ad-stopped")),this.dispatchEvent(new Nr("ad-content-attach-requested")),this.m=new Tf},i.requestClientSideAds=function(e){if(!this.i)throw new It(1,10,10001);var t=this.i;t.g&&t.g.destroy(),t.m&&t.m.contentComplete(),t.G=Date.now()/1e3,t.m.requestAds(e)},i.updateClientSideAdsRenderingSettings=function(e){if(!this.i)throw new It(1,10,10001);var t=this.i;t.B=e,t.g&&t.g.updateAdsRenderingSettings(t.B)},i.initMediaTailor=function(e,t,n){var i=this;this.h&&this.h.release(),this.h=new qf(e,t,n,function(e){return op(i,e)})},i.requestMediaTailorStream=function(e,t,n){if(!this.h)throw new It(1,10,10005);var i=this.h;return n=void 0===n?"":n,i.l?e=Promise.reject(new It(1,10,10004)):(i.l=new Ir,Wf(i,e,t),i.H=n||"",i.U=Date.now()/1e3,e=i.l),e},i.addMediaTailorTrackingUrl=function(e){if(!this.h)throw new It(1,10,10005);var t=this.h;t.G=e,t.i(new Nr("ads-loaded",(new Map).set("loadTime",0)))},i.initServerSide=function(t,n){var i=this;if(!e.google||!google.ima||!google.ima.dai)throw new It(2,10,10002);this.g&&this.g.release(),this.g=new rp(t,n,this.o,function(e){return op(i,e)}),this.g.configure(this.l)},i.requestServerSideStream=function(e,t){if(t=void 0===t?"":t,!this.g)throw new It(1,10,10003);e.adTagParameters||(e.adTagParameters={});var n=e.adTagParameters;return(n.mpt||n.mpv)&&Z('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),e.adTagParameters.mpt="shaka-player",e.adTagParameters.mpv="v4.10.9",n=this.g,n.j?e=Promise.reject(new It(1,10,10004)):(e instanceof google.ima.dai.api.LiveStreamRequest&&(n.G=!0),n.j=new Ir,n.g.requestStream(e),n.B=t||"",n.F=Date.now()/1e3,e=n.j),e},i.replaceServerSideAdTagParameters=function(e){if(!this.g)throw new It(1,10,10003);(e.mpt||e.mpv)&&Z('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),e.mpt="Shaka Player",e.mpv="v4.10.9",this.g.g.replaceAdTagParameters(e)},i.getServerSideCuePoints=function(){return pe("AdManager.getServerSideCuePoints","Please use getCuePoints function."),this.getCuePoints()},i.getCuePoints=function(){var e=[];return this.g&&(e=e.concat(this.g.getCuePoints())),this.h&&(e=e.concat(this.h.getCuePoints())),e},i.getStats=function(){var e=this.m;return{loadTimes:e.g,averageLoadTime:Sf(e),started:e.h,playedCompletely:e.j,skipped:e.l,errors:e.i}},i.onManifestUpdated=function(e){this.h&&this.h.onManifestUpdated(e)},i.onDashTimedMetadata=function(e){this.g&&"urn:google:dai:2018"==e.schemeIdUri&&this.g.g.processMetadata(e.schemeIdUri,e.eventNode?e.eventNode.attributes.messageData:null,e.startTime)},i.onHlsTimedMetadata=function(e,t){this.g&&this.g.g.processMetadata("ID3",e.data,t)},i.onCueMetadataChange=function(e){this.g&&this.g.onCueMetadataChange(e)},i.onInterstitialMetadata=function(e,t,n){this.j||this.initInterstitial(null,e,t),this.j&&Pf(this.j,n)},G("shaka.ads.AdManager",ap),ap.prototype.onInterstitialMetadata=ap.prototype.onInterstitialMetadata,ap.prototype.onCueMetadataChange=ap.prototype.onCueMetadataChange,ap.prototype.onHlsTimedMetadata=ap.prototype.onHlsTimedMetadata,ap.prototype.onDashTimedMetadata=ap.prototype.onDashTimedMetadata,ap.prototype.onManifestUpdated=ap.prototype.onManifestUpdated,ap.prototype.getStats=ap.prototype.getStats,ap.prototype.getCuePoints=ap.prototype.getCuePoints,ap.prototype.getServerSideCuePoints=ap.prototype.getServerSideCuePoints,ap.prototype.replaceServerSideAdTagParameters=ap.prototype.replaceServerSideAdTagParameters,ap.prototype.requestServerSideStream=ap.prototype.requestServerSideStream,ap.prototype.initServerSide=ap.prototype.initServerSide,ap.prototype.addMediaTailorTrackingUrl=ap.prototype.addMediaTailorTrackingUrl,ap.prototype.requestMediaTailorStream=ap.prototype.requestMediaTailorStream,ap.prototype.initMediaTailor=ap.prototype.initMediaTailor,ap.prototype.updateClientSideAdsRenderingSettings=ap.prototype.updateClientSideAdsRenderingSettings,ap.prototype.requestClientSideAds=ap.prototype.requestClientSideAds,ap.prototype.onAssetUnload=ap.prototype.onAssetUnload,ap.prototype.release=ap.prototype.release,ap.prototype.initClientSide=ap.prototype.initClientSide,ap.prototype.initInterstitial=ap.prototype.initInterstitial,ap.prototype.configure=ap.prototype.configure,ap.prototype.setLocale=ap.prototype.setLocale,ap.ADS_LOADED="ads-loaded",ap.AD_STARTED="ad-started",ap.AD_FIRST_QUARTILE="ad-first-quartile",ap.AD_MIDPOINT="ad-midpoint",ap.AD_THIRD_QUARTILE="ad-third-quartile",ap.AD_COMPLETE="ad-complete",ap.AD_STOPPED="ad-stopped",ap.AD_SKIPPED="ad-skipped",ap.AD_VOLUME_CHANGED="ad-volume-changed",ap.AD_MUTED="ad-muted",ap.AD_PAUSED="ad-paused",ap.AD_RESUMED="ad-resumed",ap.AD_SKIP_STATE_CHANGED="ad-skip-state-changed",ap.CUEPOINTS_CHANGED="ad-cue-points-changed",ap.IMA_AD_MANAGER_LOADED="ima-ad-manager-loaded",ap.IMA_STREAM_MANAGER_LOADED="ima-stream-manager-loaded",ap.AD_CLICKED="ad-clicked",ap.AD_PROGRESS="ad-progress",ap.AD_BUFFERING="ad-buffering",ap.AD_IMPRESSION="ad-impression",ap.AD_DURATION_CHANGED="ad-duration-changed",ap.AD_CLOSED="ad-closed",ap.AD_LOADED="ad-loaded",ap.ALL_ADS_COMPLETED="all-ads-completed",ap.AD_LINEAR_CHANGED="ad-linear-changed",ap.AD_METADATA="ad-metadata",ap.AD_RECOVERABLE_ERROR="ad-recoverable-error",ap.AD_ERROR="ad-error",ap.AD_BREAK_READY="ad-break-ready",ap.AD_INTERACTION="ad-interaction",ap.AD_CONTENT_PAUSE_REQUESTED="ad-content-pause-requested",ap.AD_CONTENT_RESUME_REQUESTED="ad-content-resume-requested",ap.AD_CONTENT_ATTACH_REQUESTED="ad-content-attach-requested",_f=function(){return new ap};var dp="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),hp="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),fp=["loop","playbackRate"],pp=["pause","play"],gp={getAssetUri:2,getAudioLanguages:4,getAudioLanguagesAndRoles:4,getBufferFullness:1,getBufferedInfo:2,getExpiration:2,getKeyStatuses:2,getPlaybackRate:2,getTextLanguages:4,getTextLanguagesAndRoles:4,getImageTracks:2,getThumbnails:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,getLoadMode:10,getManifestType:10,isFullyLoaded:1},mp={getConfiguration:4,getStats:5,getTextTracks:2,getVariantTracks:2},vp={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20,getSegmentAvailabilityDuration:20},yp=[["getConfiguration","configure"]],bp=[["isTextTrackVisible","setTextTrackVisibility"]],_p="addChaptersTrack addTextTrackAsync addThumbnailsTrack cancelTrickPlay configure getChapters getChaptersTracks resetConfiguration retryStreaming selectAudioLanguage selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay updateStartTime goToLive".split(" "),Tp=["attach","attachCanvas","detach","load","unload"];function Sp(e,t,n,i,r,s,a){var o=this;this.G=e,this.K=a,this.l=new Ut(t),this.L=n,this.s=!1,this.A=i,this.F=r,this.N=s,this.h=this.m=!1,this.I="",this.o=null,this.B=function(){return Ap(o)},this.C=function(e,t){switch(e=up(t),e.type){case"event":var n=e.targetName,i=Ur(e.event);o.A(n,i);break;case"update":for(i in n=e.update,n)for(var r in e=o.g[i]||{},n[i])e[r]=n[i][r];o.s&&(o.L(),o.s=!1);break;case"asyncComplete":if(i=e.id,r=e.error,e=o.i[i],delete o.i[i],e)if(r){for(n in i=new It(r.severity,r.category,r.code),r)i[n]=r[n];e.reject(i)}else e.resolve()}},this.g={video:{},player:{}},this.H=0,this.i={},this.j=null,Pp.add(this)}function wp(e){e.h&&chrome.cast.requestSession(function(t){return Ep(e,t)},function(t){return xp(e,t)})}function Ep(e,t){var n=e.N();Mp=t,t.addUpdateListener(e.B),t.addMessageListener("urn:x-cast:com.google.shaka.v2",e.C),Ap(e),Cp(e,{type:"init",initState:n,appData:e.o}),e.j.resolve()}function xp(e,t){var n=8003;switch(t.code){case"cancel":n=8004;break;case"timeout":n=8005;break;case"receiver_unavailable":n=8006}e.j.reject(new It(2,8,n,t))}function kp(e){var t=Mp;t.removeUpdateListener(e.B),t.removeMessageListener("urn:x-cast:com.google.shaka.v2",e.C)}function Ap(e){var t=!!Mp&&"connected"==Mp.status;if(e.h&&!t){for(var n in e.F(),e.g)e.g[n]={};Ip(e)}e.h=t,e.I=t?Mp.receiver.friendlyName:"",e.l.xc()}function Ip(e){for(var t in e.i){var n=e.i[t];delete e.i[t],n.reject(new It(1,7,7e3))}}function Cp(e,t){t=lp(t);var n=Mp;try{n.sendMessage("urn:x-cast:com.google.shaka.v2",t,function(){},ee)}catch(i){throw t=new It(2,8,8005,i),n=new Nr("error",(new Map).set("detail",t)),e.A("player",n),e.Fc(),t}}i=Sp.prototype,i.destroy=function(){return Pp.delete(this),Ip(this),Mp&&kp(this),this.l&&(this.l.stop(),this.l=null),this.F=this.A=null,this.h=this.m=!1,this.C=this.B=this.j=this.i=this.g=this.o=null,Promise.resolve()},i.gb=function(){return this.h},i.Xf=function(){return this.I},i.init=function(){if(this.G.length)if(e.chrome&&chrome.cast&&chrome.cast.isAvailable){this.m=!0,this.l.xc();var t=new chrome.cast.SessionRequest(this.G,[],null,this.K,null);t=new chrome.cast.ApiConfig(t,function(e){for(var t=c(Pp),n=t.next();!n.done;n=t.next()){n=n.value;var i=e;n.j=new Ir,n.s=!0,Ep(n,i)}},function(e){for(var t=c(Pp),n=t.next();!n.done;n=t.next())n=n.value,Rp="available"==e,n.l.xc()},"origin_scoped"),chrome.cast.initialize(t,function(){},function(){}),Rp&&this.l.Y(Dp),(t=Mp)&&t.status!=chrome.cast.SessionStatus.STOPPED?(this.j=new Ir,this.s=!0,Ep(this,t)):Mp=null}else e.__onGCastApiAvailable!==Op&&(Lp=e.__onGCastApiAvailable||null,e.__onGCastApiAvailable=Op)},i.dg=function(e){this.o=e,this.h&&Cp(this,{type:"appData",appData:this.o})},i.cast=function(){var e=this;return N(function(t){if(!e.m)throw new It(1,8,8e3);if(!Rp)throw new It(1,8,8001);if(e.h)throw new It(1,8,8002);return e.j=new Ir,chrome.cast.requestSession(function(t){return Ep(e,t)},function(t){return xp(e,t)}),S(t,e.j,0)})},i.Fc=function(){if(this.h){if(Ip(this),Mp){kp(this);try{Mp.stop(function(){},function(){})}catch(e){}Mp=null}Ap(this)}},i.get=function(e,t){var n=this;if("video"==e){if(pp.includes(t))return function(){return n.eh.apply(n,[e,t].concat(d(U.apply(0,arguments))))}}else if("player"==e){if(vp[t]&&!this.get("player","isLive")())return function(){};if(_p.includes(t))return function(){return n.eh.apply(n,[e,t].concat(d(U.apply(0,arguments))))};if(Tp.includes(t))return function(){return n.Ri.apply(n,[e,t].concat(d(U.apply(0,arguments))))};if(gp[t]||mp[t])return function(){return n.g[e][t]}}return this.g[e][t]},i.set=function(e,t,n){this.g[e][t]=n,Cp(this,{type:"set",targetName:e,property:t,value:n})},i.eh=function(e,t){Cp(this,{type:"call",targetName:e,methodName:t,args:U.apply(2,arguments)})},i.Ri=function(e,t){var n=U.apply(2,arguments),i=new Ir,r=this.H.toString();this.H++,this.i[r]=i;try{Cp(this,{type:"asyncCall",targetName:e,methodName:t,args:n,id:r})}catch(e){i.reject(e)}return i};var Dp=.02,Rp=!1,Mp=null,Lp=null,Pp=new Set;function Op(t){if(Lp?e.__onGCastApiAvailable=Lp:delete e.__onGCastApiAvailable,Lp=null,t)for(var n=c(Pp),i=n.next();!i.done;i=n.next())i.value.init();"function"===typeof e.__onGCastApiAvailable&&e.__onGCastApiAvailable(t)}function Np(e,t,n,i){i=void 0!==i&&i,Br.call(this);var r=this;this.i=e,this.h=t,this.m=this.o=this.j=this.s=this.l=null,this.C=n,this.B=i,this.A=new Map,this.g=new Sp(n,function(){return Vp(r)},function(){return Hp(r)},function(e,t){return qp(r,e,t)},function(){return $p(r)},function(){return jp(r)},i),Up(this)}function Up(e){e.g.init(),e.m=new se;for(var t=c(dp),n=t.next();!n.done;n=t.next())e.m.D(e.i,n.value,function(t){e.g.gb()||(t=Ur(t),e.j.dispatchEvent(t))});for(var i in Fr)e.m.D(e.h,Fr[i],function(t){e.g.gb()||e.o.dispatchEvent(t)});for(var r in e.l={},t={},e.i)t.$c=r,Object.defineProperty(e.l,t.$c,{configurable:!1,enumerable:!0,get:function(t){return function(){return Gp(e,t.$c)}}(t),set:function(t){return function(n){var i=t.$c;e.g.gb()?e.g.set("video",i,n):e.i[i]=n}}(t)}),t={$c:t.$c};e.s={},Bp(e,function(t){Object.defineProperty(e.s,t,{configurable:!1,enumerable:!0,get:function(){return zp(e,t)}})}),Fp(e),e.j=new Br,e.j.Ge=e.l,e.o=new Br,e.o.Ge=e.s}function Fp(e){var t=new Map;Bp(e,function(n,i){t.has(i)?(i=t.get(i),n.length<i.length?e.A.set(n,i):e.A.set(i,n)):t.set(i,n)})}function Bp(e,t){function n(e){return"constructor"!=e&&"function"==typeof r[e]&&!s.has(e)}var i,r=e.h,s=new Set;for(i in r)n(i)&&(s.add(i),t(i,r[i]));for(e=Object.getPrototypeOf(r),i=Object.getPrototypeOf({});e&&e!=i;){for(var a=c(Object.getOwnPropertyNames(e)),o=a.next();!o.done;o=a.next())o=o.value,n(o)&&(s.add(o),t(o,r[o]));e=Object.getPrototypeOf(e)}}function jp(e){var t={video:{},player:{},playerAfterLoad:{},manifest:e.h.Gc(),startTime:null};e.i.pause();for(var n=c(fp),i=n.next();!i.done;i=n.next())i=i.value,t.video[i]=e.i[i];for(e.i.ended||(t.startTime=e.i.currentTime),n=c(yp),i=n.next();!i.done;i=n.next()){var r=i.value;i=r[1],r=e.h[r[0]](),t.player[i]=r}for(n=c(bp),i=n.next();!i.done;i=n.next())r=i.value,i=r[1],r=e.h[r[0]](),t.playerAfterLoad[i]=r;return t}function Vp(e){var t=new Nr("caststatuschanged");e.dispatchEvent(t)}function Hp(e){var t=new Nr(e.l.paused?"pause":"play");e.j.dispatchEvent(t)}function $p(e){for(var t=c(yp),n=t.next();!n.done;n=t.next()){var i=n.value;n=i[1],i=e.g.get("player",i[0])(),e.h[n](i)}var r=e.g.get("player","getAssetUri")();i=e.g.get("video","ended"),t=Promise.resolve();var s,a=e.i.autoplay;n=null,i||(n=e.g.get("video","currentTime")),(i=e.g.get("player","getTextTracks")())&&i.length&&(s=i.find(function(e){return e.active}));var o=e.g.get("player","isTextTrackVisible")();r&&(e.i.autoplay=!1,t=e.h.load(r,n));var l={};for(n=c(fp),i=n.next();!i.done;i=n.next())i=i.value,l[i]=e.g.get("video",i);t.then(function(){if(e.i){for(var t=c(fp),n=t.next();!n.done;n=t.next())n=n.value,e.i[n]=l[n];for(t=c(bp),n=t.next();!n.done;n=t.next()){var i=n.value;n=i[1],i=e.g.get("player",i[0])(),e.h[n](i)}e.h.nh(o),s&&e.h.bg(s.language,s.roles,s.forced),e.i.autoplay=a,r&&e.i.play()}},function(t){t=(new Map).set("detail",t),t=new Nr("error",t),e.h.dispatchEvent(t)})}function Gp(e,t){if("addEventListener"==t)return function(t,n,i){return e.j.addEventListener(t,n,i)};if("removeEventListener"==t)return function(t,n,i){return e.j.removeEventListener(t,n,i)};if(e.g.gb()&&0==Object.keys(e.g.g.video).length){var n=e.i[t];if("function"!=typeof n)return n}return e.g.gb()?e.g.get("video",t):(t=e.i[t],"function"==typeof t&&(t=t.bind(e.i)),t)}function zp(e,t){if(e.A.has(t)&&(t=e.A.get(t)),"addEventListener"==t)return function(t,n,i){return e.o.addEventListener(t,n,i)};if("removeEventListener"==t)return function(t,n,i){return e.o.removeEventListener(t,n,i)};if("getMediaElement"==t)return function(){return e.l};if("getSharedConfiguration"==t)return e.g.get("player","getConfiguration");if("getNetworkingEngine"==t)return function(){return e.h.zb()};if("getDrmEngine"==t)return function(){return e.h.B};if("getAdManager"==t)return function(){return e.h.Ig()};if("setVideoContainer"==t)return function(t){return e.h.rh(t)};if(e.g.gb()){if("getManifest"==t||"drmInfo"==t)return function(){return Z(t+"() does not work while casting!"),null};if("attach"==t||"detach"==t)return function(){return Z(t+"() does not work while casting!"),Promise.resolve()}}return e.g.gb()&&0==Object.keys(e.g.g.video).length&&(gp[t]||mp[t])||!e.g.gb()?e.h[t].bind(e.h):e.g.get("player",t)}function qp(e,t,n){e.g.gb()&&("video"==t?e.j.dispatchEvent(n):"player"==t&&e.o.dispatchEvent(n))}function Wp(e,t,n,i){Br.call(this);var r=this;this.g=e,this.h=t,this.j=new se,this.H={video:e,player:t},this.F=n||function(){},this.I=i||function(e){return e},this.i=null,this.G=!1,this.o=!0,this.m=0,this.B=!1,this.A=!0,this.s=this.l=null,this.C=new Ut(function(){Jp(r)}),Kp(this)}function Kp(e){var t=cast.receiver.CastReceiverManager.getInstance();t.onSenderConnected=function(){return Yp(e)},t.onSenderDisconnected=function(){return Yp(e)},t.onSystemVolumeChanged=function(){var t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();t&&sg(e,{type:"update",update:{video:{volume:t.level,muted:t.muted}}},e.l),sg(e,{type:"event",targetName:"video",event:{type:"volumechange"}},e.l)},e.s=t.getCastMessageBus("urn:x-cast:com.google.cast.media"),e.s.onMessage=function(t){return ig(e,t)},e.l=t.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),e.l.onMessage=function(t){return ng(e,t)},t.start(),t=c(dp);for(var n=t.next();!n.done;n=t.next())e.j.D(e.g,n.value,function(t){return Zp(e,"video",t)});for(var i in Fr)e.j.D(e.h,Fr[i],function(t){return Zp(e,"player",t)});e.j.D(e.g,"loadeddata",function(){e.B=!0}),e.j.D(e.h,"loading",function(){e.o=!1,Xp(e)}),e.j.D(e.g,"playing",function(){e.o=!1,Xp(e)}),e.j.D(e.g,"pause",function(){Xp(e)}),e.j.D(e.h,"unloading",function(){e.o=!0,Xp(e)}),e.j.D(e.g,"ended",function(){new Ut(function(){e.g&&e.g.ended&&(e.o=!0,Xp(e))}).Y(lg)})}function Yp(e){e.m=0,e.A=!0,e.G=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,Xp(e)}function Xp(e){var t;N(function(n){return 1==n.g?S(n,Promise.resolve(),2):e.h?(t=new Nr("caststatuschanged"),e.dispatchEvent(t),eg(e)||ag(e),void w(n)):n.return()})}function Qp(e,t,n){var i,r,s,a,o,l,u,c,d,h;N(function(f){switch(f.g){case 1:for(i in t.player)r=t.player[i],e.h[i](r);return e.F(n),s=e.g.autoplay,t.manifest?(e.g.autoplay=!1,E(f,5),S(f,e.h.load(t.manifest,t.startTime),7)):S(f,Promise.resolve(),3);case 7:k(f,3);break;case 5:return a=A(f),o=(new Map).set("detail",a),l=new Nr("error",o),e.h&&e.h.dispatchEvent(l),f.return();case 3:if(!e.h)return f.return();for(u in t.video)c=t.video[u],e.g[u]=c;for(d in t.playerAfterLoad)h=t.playerAfterLoad[d],e.h[d](h);e.g.autoplay=s,t.manifest&&(e.g.play(),ag(e)),w(f)}})}function Zp(e,t,n){e.h&&(Jp(e),sg(e,{type:"event",targetName:t,event:n},e.l))}function Jp(e){e.C.Y(og);for(var t={video:{},player:{}},n=c(hp),i=n.next();!i.done;i=n.next())i=i.value,t.video[i]=e.g[i];if(e.h.V())for(var r in vp)0==e.m%vp[r]&&(t.player[r]=e.h[r]());for(var s in gp)0==e.m%gp[s]&&(t.player[s]=e.h[s]());for(var a in(n=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(t.video.volume=n.level,t.video.muted=n.muted),sg(e,{type:"update",update:t},e.l),mp)0==e.m%mp[a]&&(t={player:{}},t.player[a]=e.h[a](),sg(e,{type:"update",update:t},e.l));e.B&&(e.m+=1),eg(e)}function eg(e){return!(!e.A||!e.g.duration&&!e.h.V())&&(tg(e),e.A=!1,!0)}function tg(e,t){var n={contentId:e.h.Gc(),streamType:e.h.V()?"LIVE":"BUFFERED",contentType:""};e.h.V()||(n.duration=e.g.duration),e.i&&(n.metadata=e.i),ag(e,void 0===t?0:t,n)}function ng(e,t){var n=up(t.data);switch(n.type){case"init":e.m=0,e.B=!1,e.A=!0,Qp(e,n.initState,n.appData),Jp(e);break;case"appData":e.F(n.appData);break;case"set":var i=n.targetName,r=n.property;if(n=n.value,"video"==i){if(t=cast.receiver.CastReceiverManager.getInstance(),"volume"==r){t.setSystemVolumeLevel(n);break}if("muted"==r){t.setSystemVolumeMuted(n);break}}e.H[i][r]=n;break;case"call":i=e.H[n.targetName],i[n.methodName].apply(i,n.args);break;case"asyncCall":i=n.targetName,r=n.methodName,"player"==i&&"load"==r&&(e.m=0,e.B=!1);var s=n.id,a=t.senderId;t=e.H[i],n=t[r].apply(t,n.args),"player"==i&&"load"==r&&(n=n.then(function(){e.A=!0})),n.then(function(){return rg(e,a,s,null)},function(t){return rg(e,a,s,t)})}}function ig(e,t){var n=up(t.data);switch(n.type){case"PLAY":e.g.play(),ag(e);break;case"PAUSE":e.g.pause(),ag(e);break;case"SEEK":t=n.currentTime;var i=n.resumeState;null!=t&&(e.g.currentTime=Number(t)),i&&"PLAYBACK_START"==i?(e.g.play(),ag(e)):i&&"PLAYBACK_PAUSE"==i&&(e.g.pause(),ag(e));break;case"STOP":e.h.dc().then(function(){e.h&&ag(e)});break;case"GET_STATUS":tg(e,Number(n.requestId));break;case"VOLUME":i=n.volume,t=i.level,i=i.muted;var r=e.g.volume,s=e.g.muted;null!=t&&(e.g.volume=Number(t)),null!=i&&(e.g.muted=i),r==e.g.volume&&s==e.g.muted||ag(e);break;case"LOAD":e.m=0,e.B=!1,e.A=!1,t=n.media,i=n.currentTime,r=e.I(t.contentId),s=n.autoplay||!0,e.F(t.customData),s&&(e.g.autoplay=!0),e.h.load(r,i).then(function(){e.h&&tg(e)}).catch(function(t){var i="LOAD_FAILED";7==t.category&&7e3==t.code&&(i="LOAD_CANCELLED"),sg(e,{requestId:Number(n.requestId),type:i},e.s)});break;default:sg(e,{requestId:Number(n.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},e.s)}}function rg(e,t,n,i){e.h&&sg(e,{type:"asyncComplete",id:n,error:i},e.l,t)}function sg(e,t,n,i){e.G&&(e=lp(t),i?n.getCastChannel(i).send(e):n.broadcast(e))}function ag(e,t,n){n=void 0===n?null:n;var i={mediaSessionId:0,playbackRate:e.g.playbackRate,playerState:e.o?ug:e.h.Jf()?dg:e.g.paused?hg:cg,currentTime:e.g.currentTime,supportedMediaCommands:63,volume:{level:e.g.volume,muted:e.g.muted}};n&&(i.media=n),sg(e,{requestId:void 0===t?0:t,type:"MEDIA_STATUS",status:[i]},e.s)}y(Np,Br),i=Np.prototype,i.destroy=function(e){return e&&this.g.Fc(),this.m&&(this.m.release(),this.m=null),e=[],this.h&&(e.push(this.h.destroy()),this.h=null),this.g&&(e.push(this.g.destroy()),this.g=null),this.s=this.l=this.i=null,Br.prototype.release.call(this),Promise.all(e)},i.mi=function(){return this.l},i.bi=function(){return this.s},i.Hh=function(){return this.g.m&&Rp},i.gb=function(){return this.g.gb()},i.Xf=function(){return this.g.Xf()},i.cast=function(){var e=this;return N(function(t){return 1==t.g?S(t,e.g.cast(),2):e.h?S(t,e.h.dc(),0):t.return()})},i.dg=function(e){this.g.dg(e)},i.gj=function(){wp(this.g)},i.Fc=function(){this.g.Fc()},i.Ih=function(e,t){t=void 0!==t&&t;var n=this;return N(function(i){if(1==i.g)return e==n.C&&t==n.B?i.return():(n.C=e,n.B=t,n.g.Fc(),S(i,n.g.destroy(),2));n.g=null,n.g=new Sp(e,function(){return Vp(n)},function(){return Hp(n)},function(e,t){return qp(n,e,t)},function(){return $p(n)},function(){return jp(n)},t),n.g.init(),w(i)})},G("shaka.cast.CastProxy",Np),Np.prototype.changeReceiverId=Np.prototype.Ih,Np.prototype.forceDisconnect=Np.prototype.Fc,Np.prototype.suggestDisconnect=Np.prototype.gj,Np.prototype.setAppData=Np.prototype.dg,Np.prototype.cast=Np.prototype.cast,Np.prototype.receiverName=Np.prototype.Xf,Np.prototype.isCasting=Np.prototype.gb,Np.prototype.canCast=Np.prototype.Hh,Np.prototype.getPlayer=Np.prototype.bi,Np.prototype.getVideo=Np.prototype.mi,Np.prototype.destroy=Np.prototype.destroy,y(Wp,Br),i=Wp.prototype,i.isConnected=function(){return this.G},i.ui=function(){return this.o},i.cj=function(e){this.i=e},i.Kh=function(){this.i=null},i.dj=function(e){this.i||(this.i={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.i.title=e},i.bj=function(e){this.i||(this.i={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.i.images=[{url:e}]},i.aj=function(e){this.i||(this.i={}),this.i.artist=e,this.i.metadataType=cast.receiver.media.MetadataType.MUSIC_TRACK},i.destroy=function(){var e,t,n=this;return N(function(i){if(1==i.g)return n.j&&(n.j.release(),n.j=null),e=[],n.h&&(e.push(n.h.destroy()),n.h=null),n.C&&(n.C.stop(),n.C=null),n.g=null,n.H=null,n.F=null,n.G=!1,n.o=!0,n.l=null,n.s=null,Br.prototype.release.call(n),S(i,Promise.all(e),2);t=cast.receiver.CastReceiverManager.getInstance(),t.stop(),w(i)})},G("shaka.cast.CastReceiver",Wp),Wp.prototype.destroy=Wp.prototype.destroy,Wp.prototype.setContentArtist=Wp.prototype.aj,Wp.prototype.setContentImage=Wp.prototype.bj,Wp.prototype.setContentTitle=Wp.prototype.dj,Wp.prototype.clearContentMetadata=Wp.prototype.Kh,Wp.prototype.setContentMetadata=Wp.prototype.cj,Wp.prototype.isIdle=Wp.prototype.ui,Wp.prototype.isConnected=Wp.prototype.isConnected;var og=.5,lg=5,ug="IDLE",cg="PLAYING",dg="BUFFERING",hg="PAUSED";function fg(e,t,n,i,r){if(i>=r)return null;for(var s=-1,a=-1,o=0;o<n.length;o++)if(n[o].some(function(e){return null!=e&&""!=e.g.trim()})){s=o;break}for(o=n.length-1;0<=o;o--)if(n[o].some(function(e){return null!=e&&""!=e.g.trim()})){a=o;break}if(-1===s||-1===a)return null;for(var l=o=!1,u="white",c="black",d=pg(i,r,o,l,u,c);s<=a;s++){for(var h=n[s],f=-1,p=-1,g=0;g<h.length;g++)if(null!=h[g]&&""!==h[g].g.trim()){f=g;break}for(g=h.length-1;0<=g;g--)if(null!=h[g]&&""!==h[g].g.trim()){p=g;break}if(-1===f||-1===p)h=gg(i,r),e.nestedCues.push(h);else{for(;f<=p;f++)if(g=h[f]){var m=g.l,v=g.i,y=g.j,b=g.h;m==o&&v==l&&y==u&&b==c||(d.payload&&e.nestedCues.push(d),d=pg(i,r,m,v,y,b),o=m,l=v,u=y,c=b),d.payload+=g.g}else d.payload+=" ";d.payload&&e.nestedCues.push(d),s!==a&&(d=gg(i,r),e.nestedCues.push(d)),d=pg(i,r,o,l,u,c)}}return e.nestedCues.length?{cue:e,stream:t}:null}function pg(e,t,n,i,r,s){return e=new Be(e,t,""),n&&e.textDecoration.push("underline"),i&&(e.fontStyle="italic"),e.color=r,e.backgroundColor=s,e}function gg(e,t){return e=new Be(e,t,""),e.lineBreak=!0,e}function mg(e,t,n,i,r){this.g=e,this.l=t,this.i=n,this.h=i,this.j=r}function vg(e,t){this.i=[],this.g=1,this.h=0,this.A=e,this.s=t,this.j=this.m=!1,this.l="white",this.o="black",bg(this)}function yg(e,t,n){var i="CC"+(1+(e.A<<1|e.s)),r=new Be(t,n,"");r.lineInterpretation=1;var s=Rg.get(e.g);return s&&(r.line=s),(t=fg(r,i,e.i,t,n))&&15<e.g+t.cue.nestedCues.length-3&&(s=Rg.get(e.g+3-t.cue.nestedCues.length))&&(r.line=s),t}function bg(e){Sg(e,0,15),e.g=1}function _g(e,t,n){if(!(32>n||127<n)){var i="";switch(t){case wg:i=Ag.has(n)?Ag.get(n):String.fromCharCode(n);break;case Eg:i=Ig.get(n);break;case xg:e.i[e.g].pop(),i=Cg.get(n);break;case kg:e.i[e.g].pop(),i=Dg.get(n)}i&&e.i[e.g].push(new mg(i,e.m,e.j,e.o,e.l))}}function Tg(e,t,n,i){if(!(0>n||0>t))if(t>=n)for(--i;0<=i;i--)e.i[t+i]=e.i[n+i].map(function(e){return e});else for(var r=0;r<i;r++)e.i[t+r]=e.i[n+r].map(function(e){return e})}function Sg(e,t,n){for(var i=0;i<=n;i++)e.i[t+i]=[]}var wg=0,Eg=1,xg=2,kg=3,Ag=new Map([[39,""],[42,""],[92,""],[92,""],[94,""],[95,""],[96,""],[123,""],[124,""],[125,""],[126,""],[127,""]]),Ig=new Map([[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[54,""],[55,""],[56,""],[57," "],[58,""],[59,""],[60,""],[61,""],[62,""],[63,""]]),Cg=new Map([[32,""],[33,""],[34,""],[35,""],[36,""],[37,""],[38,""],[39,""],[40,"*"],[41,"'"],[42,""],[43,""],[44,""],[45,""],[46,""],[47,""],[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[54,""],[55,""],[56,""],[57,""],[58,""],[59,""],[60,""],[61,""],[62,""],[63,""]]),Dg=new Map([[32,""],[33,""],[34,""],[35,""],[36,""],[37,""],[38,""],[39,""],[40,""],[41,"{"],[42,"}"],[43,"\\"],[44,"^"],[45,"_"],[46,"|"],[47,"~"],[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[54,""],[55,""],[56,""],[57,""],[58,""],[59,""],[60,""],[61,""],[62,""],[63,""]]),Rg=new Map([[1,10],[2,15.33],[3,20.66],[4,26],[5,31.33],[6,36.66],[7,42],[8,47.33],[9,52.66],[10,58],[11,63.33],[12,68.66],[13,74],[14,79.33],[15,84.66]]);function Mg(e,t){this.h=Ng,this.o=new vg(e,t),this.i=new vg(e,t),this.g=this.j=new vg(e,t),this.l=0,this.m=null}function Lg(e,t,n){e.g=e.i;var i=e.g,r=null;return e.h!==Fg&&e.h!==Bg&&(r=yg(i,e.l,n),n=e.i,n.g=0<n.h?n.h:0,Sg(n,0,15),n=e.j,n.g=0<n.h?n.h:0,Sg(n,0,15),i.g=15),e.h=Fg,i.h=t,r}function Pg(e){e.h=Ug,e.g=e.j,e.g.h=0}function Og(e){J("Cea608DataChannel","CEA-608 text mode entered, but is unsupported"),e.g=e.o,e.h=Bg}var Ng=0,Ug=1,Fg=3,Bg=4,jg="black green blue cyan red yellow magenta black".split(" "),Vg="white green blue cyan red yellow magenta white_italics".split(" ");function Hg(e,t){this.I=t,this.N=e,this.K=this.l=!1,this.m=this.o=this.G=this.L=this.H=0,this.F=Xg,this.i=[],this.g=this.h=this.j=0,this.C=this.A=!1,this.B="white",this.s="black",$g(this)}function $g(e){e.i=[];for(var t=0;16>t;t++)e.i.push(Gg())}function Gg(){for(var e=[],t=0;42>t;t++)e.push(null);return e}function zg(e,t){qg(e)&&(e.i[e.h][e.g]=new mg(t,e.C,e.A,e.s,e.B),e.g++)}function qg(e){var t=e.g<e.m&&0<=e.g;return e.h<e.o&&0<=e.h&&t}function Wg(e,t,n){var i=new Be(e.j,t,"");i.textAlign=e.F===Kg?"left":e.F===Yg?"right":$e;var r=i.region;switch(e.I&&(r.id+="svc"+e.I),r.id+="win"+e.N,r.height=e.o,r.width=e.m,r.heightUnits=2,r.widthUnits=2,r.viewportAnchorX=e.H,r.viewportAnchorY=e.L,r.viewportAnchorUnits=e.K?Le:2,e.G){case Qg:r.regionAnchorX=0,r.regionAnchorY=0;break;case Zg:r.regionAnchorX=50,r.regionAnchorY=0;break;case Jg:r.regionAnchorX=100,r.regionAnchorY=0;break;case em:r.regionAnchorX=0,r.regionAnchorY=50;break;case tm:r.regionAnchorX=50,r.regionAnchorY=50;break;case nm:r.regionAnchorX=100,r.regionAnchorY=50;break;case im:r.regionAnchorX=0,r.regionAnchorY=100;break;case rm:r.regionAnchorX=50,r.regionAnchorY=100;break;case sm:r.regionAnchorX=100,r.regionAnchorY=100}return(n=fg(i,"svc"+n,e.i,e.j,t))&&(e.j=t),n}Hg.prototype.isVisible=function(){return this.l};var Kg=0,Yg=1,Xg=2,Qg=0,Zg=1,Jg=2,em=3,tm=4,nm=5,im=6,rm=7,sm=8;function am(){this.i=[],this.h=null,this.g=0}function om(e,t){3===t.type?(e.g=2*(63&t.value)-1,e.h=[]):e.h&&(0<e.g&&(e.h.push(t),e.g--),0===e.g&&(e.i.push(new lm(e.h)),e.h=null,e.g=0))}function lm(e){this.g=0,this.h=e}function um(e){if(!e.oa())throw new It(2,2,3e3);return e.h[e.g++]}function cm(e){this.i=e,this.h=[null,null,null,null,null,null,null,null],this.g=null}function dm(e,t,n,i){if(128<=n&&135>=n)i=7&n,e.h[i]&&(e.g=e.h[i]);else{if(136===n){n=um(t).value,t=null,n=c(hm(e,n));for(var r=n.next();!r.done;r=n.next())r=e.h[r.value],r.isVisible()&&(t=Wg(r,i,e.i)),$g(r);return t}if(137===n)for(t=um(t).value,t=c(hm(e,t)),n=t.next();!n.done;n=t.next())n=e.h[n.value],n.isVisible()||(n.j=i),n.l=!0;else{if(138===n){for(n=um(t).value,t=null,n=c(hm(e,n)),r=n.next();!r.done;r=n.next())r=e.h[r.value],r.isVisible()&&(t=Wg(r,i,e.i)),r.l=!1;return t}if(139===n){for(n=um(t).value,t=null,n=c(hm(e,n)),r=n.next();!r.done;r=n.next())r=e.h[r.value],r.isVisible()?t=Wg(r,i,e.i):r.j=i,r.l=!r.l;return t}if(140===n)return t=um(t).value,fm(e,t,i);if(143===n)return i=fm(e,255,i),pm(e),i;if(144===n)t.skip(1),i=um(t).value,e.g&&(e.g.A=0<(128&i),e.g.C=0<(64&i));else if(145===n)i=um(t).value,n=um(t).value,t.skip(1),e.g&&(t=gm((48&n)>>4,(12&n)>>2,3&n),e.g.B=gm((48&i)>>4,(12&i)>>2,3&i),e.g.s=t);else if(146===n)i=um(t).value,t=um(t).value,e.g&&(e=e.g,e.h=15&i,e.g=63&t);else if(151===n)t.skip(1),t.skip(1),i=um(t).value,t.skip(1),e.g&&(e.g.F=3&i);else if(152<=n&&159>=n){if(n=(15&n)-8,r=null!==e.h[n],!r){var s=new Hg(n,e.i);s.j=i,e.h[n]=s}i=um(t).value,s=um(t).value;var a=um(t).value,o=um(t).value,l=um(t).value;t=um(t).value,r&&0===(7&t)||(t=e.h[n],t.h=0,t.g=0,t.C=!1,t.A=!1,t.B="white",t.s="black"),t=e.h[n],t.l=0<(32&i),t.L=127&s,t.H=a,t.G=(240&o)>>4,t.K=0<(128&s),t.o=1+(15&o),t.m=1+(63&l),e.g=e.h[n]}}}return null}function hm(e,t){for(var n=[],i=0;8>i;i++)1===(1&t)&&e.h[i]&&n.push(i),t>>=1;return n}function fm(e,t,n){var i=null;t=c(hm(e,t));for(var r=t.next();!r.done;r=t.next()){r=r.value;var s=e.h[r];s.isVisible()&&(i=Wg(s,n,e.i)),e.h[r]=null}return i}function pm(e){e.g=null,e.h=[null,null,null,null,null,null,null,null]}function gm(e,t,n){var i={0:0,1:0,2:1,3:1};return e=i[e],t=i[t],n=i[n],vm[e<<2|t<<1|n]}lm.prototype.oa=function(){return this.g<this.h.length},lm.prototype.ua=function(){return this.g},lm.prototype.skip=function(e){if(this.g+e>this.h.length)throw new It(2,2,3e3);this.g+=e};var mm=new Map([[32," "],[33,""],[37,""],[42,""],[44,""],[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[57,""],[58,""],[60,""],[61,""],[63,""],[118,""],[119,""],[120,""],[121,""],[122,""],[123,""],[124,""],[125,""],[126,""],[127,""]]),vm="black blue green cyan red magenta yellow white".split(" ");function ym(){this.h=[],this.g=[],this.i=new am,this.l=0,this.m=new Map([["CC1",new Mg(0,0)],["CC2",new Mg(0,1)],["CC3",new Mg(1,0)],["CC4",new Mg(1,1)]]),this.s=this.o=0,this.j=new Map,this.B=!0,this.A=new Set,bm(this)}function bm(e){e.o=0,e.s=0;for(var t=c(e.m.values()),n=t.next();!n.done;n=t.next())n=n.value,n.h=Ng,n.g=n.j,n.m=null,bg(n.i),bg(n.j),bg(n.o);e.B=!0}function _m(e,t){var n=t.type;if(16===(112&t.cb)){var i=t.cb>>3&1;0===n?e.o=i:e.s=i}if(i="CC"+(1+(n<<1|(n?e.s:e.o))),n=e.m.get(i),255===t.cb&&255===t.Eb||!t.cb&&!t.Eb||!Sm(t.cb)||!Sm(t.Eb))return 45<=++e.l&&bm(e),null;e.l=0,t.cb&=127,t.Eb&=127;var r=t.cb;if(1<=r&&15>=r||!t.cb&&!t.Eb)return null;if(r=null,16===(112&t.cb))e:{if(e.A.add(i),i=t.cb,e=t.Eb,n.m===(i<<8|e))n.m=null;else if(n.m=i<<8|e,16===(240&i)&&64===(192&e)){t=[11,11,1,2,3,4,12,13,14,15,5,6,7,8,9,10][(7&i)<<1|e>>5&1];var s=(30&e)>>1;i="white",r=!1,7>s?i=Vg[s]:7===s&&(r=!0),e=1===(1&e),n.h!==Bg&&(s=n.g,n.h===Fg&&t!==s.g&&(n=1+t-s.h,Tg(s,n,1+s.g-s.h,s.h),Sg(s,0,n-1),Sg(s,t+1,15-t)),s.g=t,s.m=e,s.j=r,s.l=i,s.o="black")}else if(17===(247&i)&&32===(240&e))n.g.m=!1,n.g.j=!1,n.g.l="white",_g(n.g,wg,32),i=!1,t=Vg[(14&e)>>1],"white_italics"===t&&(t="white",i=!0),n.g.m=1===(1&e),n.g.j=i,n.g.l=t;else if(16===(247&i)&&32===(240&e)||23===(247&i)&&45===(255&e))t="black",0===(7&i)&&(t=jg[(14&e)>>1]),n.g.o=t;else if(17===(247&i)&&48===(240&e))_g(n.g,Eg,e);else if(18===(246&i)&&32===(224&e))_g(n.g,1&i?kg:xg,e);else if(20===(246&i)&&32===(240&e)){switch(e=t.pts,i=null,t.Eb){case 32:Pg(n);break;case 33:n=n.g,n.i[n.g].pop();break;case 37:i=Lg(n,2,e);break;case 38:i=Lg(n,3,e);break;case 39:i=Lg(n,4,e);break;case 40:_g(n.g,wg,32);break;case 41:n.h=2,n.g=n.i,n.g.h=0,n.l=e;break;case 42:bg(n.o),Og(n);break;case 43:Og(n);break;case 44:t=n.i,i=null,n.h!==Bg&&(i=yg(t,n.l,e)),Sg(t,0,15);break;case 45:t=n.g,n.h!==Fg?i=null:(i=yg(t,n.l,e),r=t.g-t.h+1,Tg(t,r-1,r,t.h),Sg(t,0,r-1),Sg(t,t.g,15-t.g),n.l=e);break;case 46:Sg(n.j,0,15);break;case 47:t=null,n.h!==Bg&&(t=yg(n.i,n.l,e)),i=n.j,n.j=n.i,n.i=i,Pg(n),n.l=e,i=t}r=i;break e}r=null}else e=t.Eb,_g(n.g,wg,t.cb),_g(n.g,wg,e);return r}function Tm(e,t){var n=[];try{for(;t.oa();){var i=um(t).value,r=(224&i)>>5,s=31&i;if(7===r&&0!=s&&(r=63&um(t).value),0!=r){e.A.add("svc"+r),e.j.has(r)||e.j.set(r,new cm(r));for(var a=e.j.get(r),o=t.ua();t.ua()-o<s;){r=t;var l=um(r),u=l.value,c=l.pts;if(16===u){var d=um(r);u=u<<16|d.value}if(0<=u&&31>=u){var h=c;if(a.g){var f=a.g;switch(r=null,u){case 8:!qg(f)||0>=f.g&&0>=f.h||(0>=f.g?(f.g=f.m-1,f.h--):f.g--,f.i[f.h][f.g]=null);break;case 13:if(f.isVisible()&&(r=Wg(f,h,a.i)),f.h+1>=f.o){h=f;for(var p=0,g=1;16>g;g++,p++)h.i[p]=h.i[g];for(g=0;1>g;g++,p++)h.i[p]=Gg()}else f.h++;f.g=0;break;case 14:f.isVisible()&&(r=Wg(f,h,a.i)),f.i[f.h]=Gg(),f.g=0;break;case 12:f.isVisible()&&(r=Wg(f,h,a.i)),$g(f),h=f,h.h=0,h.g=0}var m=r}else m=null}else if(128<=u&&159>=u)m=dm(a,r,u,c);else{if(4096<=u&&4127>=u)h=255&u,8<=h&&15>=h?r.skip(1):16<=h&&23>=h?r.skip(2):24<=h&&31>=h&&r.skip(3);else if(4224<=u&&4255>=u)h=255&u,128<=h&&135>=h?r.skip(4):136<=h&&143>=h&&r.skip(5);else if(32<=u&&127>=u)r=u,a.g&&zg(a.g,127===r?"":String.fromCharCode(r));else if(160<=u&&255>=u)a.g&&zg(a.g,String.fromCharCode(u));else if(4128<=u&&4223>=u){if(r=255&u,a.g)if(mm.has(r)){var v=mm.get(r);zg(a.g,v)}else zg(a.g,"_")}else 4256<=u&&4351>=u&&a.g&&zg(a.g,160!=(255&u)?"_":"[CC]");m=null}(r=m)&&n.push(r)}}}}catch(e){if(!(e instanceof It&&3e3===e.code))throw e;J("CEA708_INVALID_DATA","Buffer read out of bounds / invalid CEA-708 Data.")}return n}function Sm(e){for(var t=0;e;)t^=1&e,e>>=1;return 1===t}function wm(e){for(var t=[],n=e,i=e=0;i<n.length;)2==e&&3==n[i]?(e=0,n=[].concat(d(n)),n.splice(i,1),n=new Uint8Array(n)):0==n[i]?e++:e=0,i++;for(e=n,i=0;i<e.length;){for(n=0;255==e[i];)n+=255,i++;n+=e[i++];for(var r=0;255==e[i];)r+=255,i++;r+=e[i++],4==n&&t.push(e.subarray(i,i+r)),i+=r}return t}function Em(){this.j=new Map,this.i=this.h=0,this.g=km}function xm(e,t,n,i,r,s,a,o,l){var u=0,h=s,f=o.map(function(e){return e.fh});for(f=[].concat.apply([],d(f)),f.length&&(h=f[0].sampleSize||s),t.skip(a+o[0].Mh);t.oa();){a=t.P();var p=t.T(),g=null;switch(g=!1,o=1,e.g){case Am:g=31&p,g=6==g;break;case Im:o=2,t.skip(1),g=p>>1&63,g=39==g||40==g;break;case Cm:o=2,t.skip(1),g=p>>1&63,g=23==g||24==g;break;default:return}if(g)for(p=0,u<f.length&&(p=f[u].He||0),p=(n+p)/i,o=c(wm(t.rb(a-o))),g=o.next();!g.done;g=o.next())l.push({packet:g.value,pts:p});else try{t.skip(a-o)}catch(e){break}h-=a+4,0==h&&(n=u<f.length?n+(f[u].$f||r):n+r,u++,h=u<f.length&&f[u].sampleSize||s)}}ym.prototype.clear=function(){this.l=0,this.h=[],this.g=[];var e=this.i;e.i=[],e.h=[],e.g=0,bm(this),e=c(this.j.values());for(var t=e.next();!t.done;t=e.next())pm(t.value)},ym.prototype.extract=function(e,t){if(this.B){for(var n=c(this.m.values()),i=n.next();!i.done;i=n.next())i.value.l=t;this.B=!1}if(e=new os(e,0),!(8>e.getLength())&&181===e.T()&&49===e.ka()&&1195456820===e.P()&&3===e.T()&&(n=e.T(),0!==(64&n)))for(n&=31,e.skip(1),i=0;i<n;i++){var r=e.T(),s=(4&r)>>2,a=e.T(),o=e.T();s&&(r&=3,0===r||1===r?this.h.push({pts:t,type:r,cb:a,Eb:o,order:this.h.length}):(this.g.push({pts:t,type:r,value:a,order:this.g.length}),this.g.push({pts:t,type:2,value:o,order:this.g.length})))}},ym.prototype.decode=function(){function e(e,t){return e.pts-t.pts||e.order-t.order}var t=[];this.h.sort(e),this.g.sort(e);for(var n=c(this.h),i=n.next();!i.done;i=n.next())(i=_m(this,i.value))&&t.push(i);for(n=c(this.g),i=n.next();!i.done;i=n.next())om(this.i,i.value);for(n=c(this.i.i),i=n.next();!i.done;i=n.next())i=Tm(this,i.value),t.push.apply(t,d(i));return this.i.i=[],this.h=[],this.g=[],t},ym.prototype.getStreams=function(){return Array.from(this.A)},G("shaka.cea.CeaDecoder",ym),Re=function(){return new ym},Em.prototype.init=function(e){function t(e){e=e.name,e in Dm&&(n.g=Dm[e])}var n=this,i=[],r=[];if((new cs).box("moov",ds).box("mvex",ds).S("trex",function(e){var t=e.reader;t.skip(4),t.skip(4),e=t.P(),t=t.P(),n.h=e,n.i=t}).box("trak",ds).S("tkhd",function(e){var t=e.reader;e=e.version,1==e?(t.skip(8),t.skip(8)):(t.skip(4),t.skip(4));var n=t.P();1==e?t.skip(8):t.skip(4),t.skip(4),t.skip(8),t.skip(2),t.skip(2),t.skip(2),t.skip(2),t.skip(36),t.ka(),t.ka(),t.ka(),t.ka(),i.push(n)}).box("mdia",ds).S("mdhd",function(e){e=vo(e.reader,e.version),r.push(e.timescale)}).box("minf",ds).box("stbl",ds).S("stsd",hs).box("avc1",t).box("avc3",t).box("hev1",t).box("hvc1",t).box("dvav",t).box("dva1",t).box("dvh1",t).box("dvhe",t).box("vvc1",t).box("vvi1",t).box("encv",fs).box("sinf",ds).box("frma",function(e){e=_o(e.reader).Na,e in Dm&&(n.g=Dm[e])}).parse(e,!0),!i.length||!r.length||i.length!=r.length)throw new It(2,2,2010);this.g==km&&Z("Unable to determine bitstream format for CEA parsing!"),i.forEach(function(e,t){n.j.set(e,r[t])})},Em.prototype.parse=function(e){var t=this;if(this.g==km)return[];var n=[],i=0,r=[];return(new cs).box("moof",function(e){i=e.start,r=[],ds(e)}).box("traf",function(e){r.push({baseMediaDecodeTime:null,qd:t.h,fe:t.i,ah:[],timescale:9e4}),ds(e)}).S("trun",function(e){var t=r[r.length-1];e=yo(e.reader,e.version,e.flags),t.ah.push(e)}).S("tfhd",function(e){var n=r[r.length-1];e=go(e.reader,e.flags),n.qd=e.qd||t.h,n.fe=e.fe||t.i,e=e.trackId,t.j.has(e)&&(n.timescale=t.j.get(e))}).S("tfdt",function(e){var t=r[r.length-1];e=mo(e.reader,e.version),t.baseMediaDecodeTime=e.baseMediaDecodeTime}).box("mdat",function(e){for(var s=i-e.start-8,a=e.reader.ua(),o=c(r),l=o.next();!l.done;l=o.next()){if(l=l.value,null===l.baseMediaDecodeTime)throw Z("Unable to find base media decode time for CEA captions!"),new It(2,2,2010);e.reader.seek(a),xm(t,e.reader,l.baseMediaDecodeTime,l.timescale,l.qd,l.fe,s,l.ah,n)}}).parse(e,!1),n},G("shaka.cea.Mp4CeaParser",Em);var km=0,Am=1,Im=2,Cm=3,Dm={avc1:Am,avc3:Am,hev1:Im,hvc1:Im,dvav:Am,dva1:Am,dvh1:Im,dvhe:Im,vvc1:Cm,vvi1:Cm};function Rm(){this.g=null}function Mm(e,t,n){var i=Fm(e),r=null;e=[];var s=[],a=null,o=new Set(i.map(function(e){return e.keyId}));o.delete(null);var l="cenc";if(1<o.size)throw new It(2,4,4010);if(!t){if(s=i.filter(function(e){return"urn:mpeg:dash:sea:2012"==e.Sc}),1<s.length)throw new It(2,4,4050);s.length&&(a=jm(s[0])),(s=i.find(function(e){return"urn:mpeg:dash:mp4protection:2011"==e.Sc}))&&s.encryptionScheme&&(l=s.encryptionScheme),s=i.filter(function(e){return"urn:mpeg:dash:mp4protection:2011"==e.Sc?(r=e.init||r,!1):"urn:mpeg:dash:sea:2012"!=e.Sc}),s.length&&(e=Um(r,l,s,n,o),0==e.length&&(e=[In("",l,r)]))}if(i.length&&!a&&(t||!s.length))for(e=[],t=c(Object.values(n)),n=t.next();!n.done;n=t.next())n=n.value,"org.w3.clearkey"!=n&&e.push(In(n,l,r));if(o=Array.from(o)[0]||null)for(l=c(e),t=l.next();!t.done;t=l.next())for(t=c(t.value.initData),n=t.next();!n.done;n=t.next())n.value.keyId=o;return{Dg:o,kk:r,drmInfos:e,bf:a,Hg:!0}}function Lm(e,t,n,i){var r=Mm(e,n,i);if(t.Hg)e=1==t.drmInfos.length&&!t.drmInfos[0].keySystem,n=0==r.drmInfos.length,(0==t.drmInfos.length||e&&!n)&&(t.drmInfos=r.drmInfos),t.Hg=!1;else if(0<r.drmInfos.length&&(t.drmInfos=t.drmInfos.filter(function(e){return r.drmInfos.some(function(t){return t.keySystem==e.keySystem})}),0==t.drmInfos.length))throw new It(2,4,4008);return r.Dg||t.Dg}function Pm(e){var t=0,n=ke(e),i=n.getUint32(t,!0);if(i!=e.byteLength)return[];e:{for(e=t+6,t=[];e<n.byteLength-1;){i=n.getUint16(e,!0),e+=2;var r=n.getUint16(e,!0);if(e+=2,0!=(1&r)||r+e>n.byteLength){n=[];break e}var s=Ee(n,e,r);t.push({type:i,value:s}),e+=r}n=t}return n}function Om(e){e=c(Ms(e,"DATA"));for(var t=e.next();!t.done;t=e.next())if(t=t.value,t.children){t=c(t.children);for(var n=t.next();!n.done;n=t.next())if(n=n.value,"LA_URL"==n.tagName)return Ds(n)}return""}function Nm(e){var t=Ps(e.node,"https://dashif.org/CPS","Laurl");return t&&(t=Ds(t))?t:(e=Ps(e.node,"urn:microsoft:playready","pro"),e&&Ds(e)?(e=Ds(e),e=wn(e),e=Pm(e).filter(function(e){return e.type===Vm})[0],e?(e=fn(e.value,!0),(e=Es(e,"WRMHEADER"))?Om(e):""):""):"")}function Um(e,t,n,i,r){var s=[];n=c(n);for(var a=n.next();!a.done;a=n.next()){a=a.value;var o=i[a.Sc];if(o){var l;if((l=Ps(a.node,"urn:microsoft:playready","pro"))&&Ds(l)){l=Ds(l),l=wn(l);var u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);l=[{initData:Ss(l,u,new Set,0),initDataType:"cenc",keyId:a.keyId}]}else l=null;if(u=null,"urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e"===a.Sc)if(u=r,0==u.size)u=null;else{var d=new Uint8Array([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75]),h=new Uint8Array([]);u=[{initData:Ss(h,d,u,1),initDataType:"cenc",keyId:a.keyId}]}l=In(o,t,a.init||e||l||u),(o=Hm.get(o))&&(l.licenseServerUri=o(a)),s.push(l)}}return s}function Fm(e){var t=[];e=c(e);for(var n=e.next();!n.done;n=e.next())(n=Bm(n.value))&&t.push(n);return t}function Bm(e){var t=e.attributes.schemeIdUri,n=Ns(e,"urn:mpeg:cenc:2013","default_KID"),i=Us(e,"urn:mpeg:cenc:2013","pssh").map(Rs),r=e.attributes.value;if(!t)return null;if(t=t.toLowerCase(),n&&(n=n.replace(/-/g,"").toLowerCase(),n.includes(" ")))throw new It(2,4,4009);var s=[];try{s=i.map(function(e){return{initDataType:"cenc",initData:wn(e),keyId:null}})}catch(e){throw new It(2,4,4007)}return{node:e,Sc:t,keyId:n,init:0<s.length?s:null,encryptionScheme:r}}function jm(t){if(!e.crypto||!e.crypto.subtle)throw Z("Web Crypto API is not available to decrypt AES-128. (Web Crypto only exists in secure origins like https)"),new It(2,4,4042);var n=Ps(t.node,"urn:mpeg:dash:schema:sea:2012","SegmentEncryption");if(!n)throw new It(2,4,4051);if("urn:mpeg:dash:sea:aes128-cbc:2013"!=n.attributes.schemeIdUri)throw new It(2,4,4051);if(n=Ps(t.node,"urn:mpeg:dash:schema:sea:2012","CryptoPeriod"),!n)throw new It(2,4,4051);if(t=n.attributes.IV,n=yn(n.attributes.keyUriTemplate),!t||!n)throw new It(2,4,4051);if(t=En(t.substr(2)),16!=t.byteLength)throw new It(2,4,4048);return{Ai:n,iv:t}}De["video/mp4"]=function(){return new Em},Rm.prototype.init=function(){},Rm.prototype.parse=function(e){this.g?this.g.clearData():this.g=new No;var t=[];if(e=Ee(e),!Vo(e))return t;e=this.g.parse(e);var n=e.sd(),i=e.ke();switch(e=[],n.video){case"avc":e.push(6);break;case"hvc":e.push(39),e.push(40)}if(!e.length)return t;for(n=c(i),i=n.next();!i.done;i=n.next())if(i=i.value,e.includes(i.type)&&null!=i.time)for(var r=c(wm(i.data)),s=r.next();!s.done;s=r.next())t.push({packet:s.value,pts:i.time});return t},G("shaka.cea.TsCeaParser",Rm),De["video/mp2t"]=function(){return new Rm};var Vm=1,Hm=(new Map).set("com.widevine.alpha",function(e){var t=Ps(e.node,"https://dashif.org/CPS","Laurl");return t&&(t=Ds(t))?t:(e=Ps(e.node,"urn:microsoft","laurl"))&&yn(e.attributes.licenseUrl)||""}).set("com.microsoft.playready",Nm).set("com.microsoft.playready.recommendation",Nm).set("com.microsoft.playready.software",Nm).set("com.microsoft.playready.hardware",Nm).set("org.w3.clearkey",function(e){var t=Ps(e.node,"https://dashif.org/CPS","Laurl");return t&&(t=Ds(t))?t:(e=Ps(e.node,"http://dashif.org/guidelines/clearKey","Laurl"))&&"EME-1.0"===e.attributes.Lic_type&&e&&(e=Ds(e))?e:""});function $m(t,n,i,r,s,a){var o={RepresentationID:n,Number:i,SubNumber:r,Bandwidth:s,Time:a};return t.replace(/\$(RepresentationID|Number|SubNumber|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(t,n,i,r){if("$$"==t)return"$";var s=o[n];if(null==s)return t;switch("RepresentationID"==n&&i&&(i=void 0),"Time"==n&&"bigint"!=typeof s&&(.2<=Math.abs(s-Math.round(s))&&Z("Calculated $Time$ values must be close to integers"),s=Math.round(s)),r){case void 0:case"d":case"i":case"u":t=s.toString();break;case"o":t=s.toString(8);break;case"x":t=s.toString(16);break;case"X":t=s.toString(16).toUpperCase();break;default:t=s.toString()}return i=e.parseInt(i,10)||1,Array(Math.max(0,i-t.length)+1).join("0")+t})}function Gm(e,t){var n=qm(e,t,"timescale"),i=1;n&&(i=$s(n)||1),n=qm(e,t,"duration"),(n=$s(n||""))&&(n/=i);var r=qm(e,t,"startNumber"),s=Number(qm(e,t,"presentationTimeOffset"))||0,a=Gs(r||"");if(null!=r&&null!=a||(a=1),r=null,t=Wm(e,t,"SegmentTimeline")){t=Cs(t,"S"),r=i,e=e.ja.duration||1/0;for(var o=a,l=[],u=-s,c=0;c<t.length;++c){var d=t[c],h=t[c+1],f=Os(d,"t",Gs),p=Os(d,"d",Gs),g=Os(d,"r",Hs);if(d=Os(d,"k",Hs)||0,null!=f&&(f-=s),p){if(f=null!=f?f:u,g=g||0,0>g)if(h){if(h=Os(h,"t",Gs),null==h)break;if(f>=h)break;g=Math.ceil((h-f)/p)-1}else{if(1/0==e)break;if(f/r>=e)break;g=Math.ceil((e*r-f)/p)-1}for(0<l.length&&f!=u&&(l[l.length-1].end=f/r),h=0;h<=g;++h)u=f+p,l.push({start:f/r,end:u/r,og:f,Bb:d,Zi:l.length+o}),f=u}}r=l}return{timescale:i,La:n,Od:a,Pb:s/i||0,ng:s,timeline:r}}function zm(e,t){return[t(e.J),t(e.la),t(e.va)].filter(oi)}function qm(e,t,n){t=zm(e,t),e=null,t=c(t);for(var i=t.next();!i.done&&!(e=i.value.attributes[n]);i=t.next());return e}function Wm(e,t,n){t=zm(e,t),e=null,t=c(t);for(var i=t.next();!i.done&&!(e=Ls(i.value,n));i=t.next());return e}function Km(e,t,n,i,r,s){for(var a=Ns(e,"http://www.w3.org/1999/xlink","href"),o=Ns(e,"http://www.w3.org/1999/xlink","actuate")||"onRequest",l=c(Object.keys(e.attributes)),u=l.next();!u.done;u=l.next()){u=u.value;var d=u.split(":"),h=xs("http://www.w3.org/1999/xlink");d[0]==h&&delete e.attributes[u]}if(5<=s)return Dr(new It(2,4,4028));if("onLoad"!=o)return Dr(new It(2,4,4027));var f=An([i],[a]);return r.request(0,zr(f,t)).Aa(function(i){if(i=ws(i.data,e.tagName),!i)return Dr(new It(2,4,4001,a));for(e.children=[];i.children.length;){var o=i.children.shift();o.tagName&&(o.parent=e),e.children.push(o)}o=c(Object.keys(i.attributes));for(var l=o.next();!l.done;l=o.next())l=l.value,e.attributes[l]=i.attributes[l];return Ym(e,t,n,f[0],r,s+1)})}function Ym(e,t,n,i,r,s){if(s=void 0===s?0:s,Ns(e,"http://www.w3.org/1999/xlink","href")){var a=Km(e,t,n,i,r,s);return n&&(a=a.Aa(void 0,function(){return Ym(e,t,n,i,r,s)})),a}a=[];for(var o={},l=c(Is(e)),u=l.next();!u.done;o={Bc:o.Bc},u=l.next())o.Bc=u.value,"urn:mpeg:dash:resolve-to-zero:2013"==Ns(o.Bc,"http://www.w3.org/1999/xlink","href")?e.children=e.children.filter(function(e){return function(t){return t!==e.Bc}}(o)):"SegmentTimeline"!=o.Bc.tagName&&a.push(Ym(o.Bc,t,n,i,r,s));return Pr(a).Aa(function(){return e})}function Xm(e,t,n,i,r,s,a){var o,l=(new cs).S("sidx",function(e){o=Qm(t,i,r,s,a,n,e)});if(e&&l.parse(e),o)return o;throw new It(2,3,3004)}function Qm(e,t,n,i,r,s,a){var o=[];a.reader.skip(4);var l=a.reader.P();if(0==l)throw new It(2,3,3005);if(0==a.version)var u=a.reader.P(),c=a.reader.P();else u=a.reader.Qc(),c=a.reader.Qc();a.reader.skip(2);var d=a.reader.ka();for(e=e+a.size+c,c=0;c<d;c++){var h=a.reader.P(),f=(2147483648&h)>>>31;h&=2147483647;var p=a.reader.P();if(a.reader.skip(4),1==f)throw new It(2,3,3006);o.push(new Qa(u/l+n,(u+p)/l+n,function(){return s},e,e+h-1,t,n,i,r)),u+=p,e+=h}return a.parser.stop(),o}function Zm(e){this.h=ke(e),this.g=new os(this.h,0)}function Jm(e){var t=ev(e);if(7<t.length)throw new It(2,3,3002);var n=0;t=c(t);for(var i=t.next();!i.done;i=t.next())n=256*n+i.value;t=ev(e);e:{i=c(tv);for(var r=i.next();!r.done;r=i.next())if(Te(t,new Uint8Array(r.value))){i=!0;break e}i=!1}if(i)t=e.h.byteLength-e.g.ua();else{if(8==t.length&&224&t[1])throw new It(2,3,3001);for(r=i=0;r<t.length;r++){var s=t[r];i=0==r?s&(1<<8-t.length)-1:256*i+s}t=i}return t=e.g.ua()+t<=e.h.byteLength?t:e.h.byteLength-e.g.ua(),i=ke(e.h,e.g.ua(),t),e.g.skip(t),new nv(n,i)}function ev(e){var t=e.g.ua(),n=e.g.T();if(0==n)throw new It(2,3,3002);return n=8-Math.floor(Math.log2(n)),e.g.skip(n-1),Ee(e.h,t,n)}Zm.prototype.oa=function(){return this.g.oa()};var tv=[[255],[127,255],[63,255,255],[31,255,255,255],[15,255,255,255,255],[7,255,255,255,255,255],[3,255,255,255,255,255,255],[1,255,255,255,255,255,255,255]];function nv(e,t){this.id=e,this.g=t}function iv(e){if(8<e.g.byteLength)throw new It(2,3,3002);if(8==e.g.byteLength&&224&e.g.getUint8(0))throw new It(2,3,3001);for(var t=0,n=0;n<e.g.byteLength;n++){var i=e.g.getUint8(n);t=256*t+i}return t}function rv(e,t,n,i,r,s,a,o,l){function u(){return r}var c=[];e=new Zm(e.g);for(var d=null,h=null;e.oa();){var f=Jm(e);if(187==f.id){var p=sv(f);p&&(f=n*p.kj,p=t+p.Pi,null!=d&&c.push(new Qa(d+a,f+a,u,h,p-1,s,a,o,l)),d=f,h=p)}}return null!=d&&c.push(new Qa(d+a,i+a,u,h,null,s,a,o,l)),c}function sv(e){var t=new Zm(e.g);if(e=Jm(t),179!=e.id)throw new It(2,3,3013);if(e=iv(e),t=Jm(t),183!=t.id)throw new It(2,3,3012);t=new Zm(t.g);for(var n=0;t.oa();){var i=Jm(t);if(241==i.id){n=iv(i);break}}return{kj:e,Pi:n}}function av(e,t,n){if(t=Wm(e,t,"Initialization"),!t)return null;var i=e.J.Ga(),r=t.attributes.sourceURL;r&&(i=An(i,[yn(r)])),r=0;var s=null;return(t=Os(t,"range",Vs))&&(r=t.start,s=t.end),n=new Ya(function(){return i},r,s,fv(e),null,null,n),n.codecs=e.J.codecs,n.mimeType=e.J.mimeType,n}function ov(e,t,n){var i=Number(qm(e,uv,"presentationTimeOffset"))||0,r=qm(e,uv,"timescale"),s=1;r&&(s=$s(r)||1);var a=i/s||0,o=av(e,uv,n);dv(e,o);var l=bi(e);return{mc:function(){var e=Wm(l,uv,"RepresentationIndex"),n=l.J.Ga();return e&&(e=yn(e.attributes.sourceURL))&&(n=An(n,[e])),e=cv(l),lv(l,t,o,n,e.start,e.end,a)}}}function lv(e,t,n,i,r,s,a){var o,l,u,d,h,f,p,g,m,v,y,b,_,T,w,E,x,k;return N(function(A){if(1==A.g)return o=e.presentationTimeline,l=!e.xb||!e.ja.Dd,u=e.ja.start,d=e.ja.duration,h=e.J.mimeType.split("/")[1],f=t,p=null,g=[f(i,r,s,!1),"webm"==h?f(n.M(),n.Ha,n.sa,!0):null],f=null,S(A,Promise.all(g),2);if(m=A.h,v=m[0],y=m[1]||null,b=null,_=u-a,T=u,w=d?u+d:1/0,"mp4"==h)var I=Xm(v,r,i,n,_,T,w);else{if(I=new Zm(y),440786851!=Jm(I).id)throw new It(2,3,3008);var C=Jm(I);if(408125543!=C.id)throw new It(2,3,3009);I=C.g.byteOffset,C=new Zm(C.g);for(var D=null;C.oa();){var R=Jm(C);if(357149030==R.id){D=R;break}}if(!D)throw new It(2,3,3010);for(D=new Zm(D.g),R=1e6,C=null;D.oa();){var M=Jm(D);if(2807729==M.id)R=iv(M);else if(17545==M.id)if(4==M.g.byteLength)C=M.g.getFloat32(0);else{if(8!=M.g.byteLength)throw new It(2,3,3003);C=M.g.getFloat64(0)}}if(null==C)throw new It(2,3,3011);if(D=R/1e9,C*=D,R=Jm(new Zm(v)),475249515!=R.id)throw new It(2,3,3007);I=rv(R,I,D,C,i,n,_,T,w)}for(b=I,E=c(b),x=E.next();!x.done;x=E.next())k=x.value,k.codecs=e.J.codecs,k.mimeType=e.J.mimeType;return o.Jd(b),p=new tu(b),l&&p.Ec(T,w,!0),A.return(p)})}function uv(e){return e.Tc}function cv(e){var t=Wm(e,uv,"RepresentationIndex");return e=qm(e,uv,"indexRange"),e=Vs(e||""),t&&(e=Os(t,"range",Vs,e)),e}function dv(e,t){if(hv(e,t),!cv(e))throw new It(2,4,4002)}function hv(e,t){var n=e.J.mimeType.split("/")[1];if(e.J.contentType!=Ln&&"mp4"!=n&&"webm"!=n)throw new It(2,4,4006);if("webm"==n&&!t)throw new It(2,4,4005)}function fv(e){var t=e.J;return{bandwidth:e.bandwidth,audioSamplingRate:t.audioSamplingRate,codecs:t.codecs,contentType:t.contentType,frameRate:t.frameRate||null,height:t.height||null,mimeType:t.mimeType,channelsCount:t.Nc,pixelAspectRatio:t.pixelAspectRatio||null,width:t.width||null,label:e.la.label||null,roles:e.roles||null,language:e.la.language||null}}function pv(e,t,n){var i=av(e,gv,n),r=mv(e);if(!r.La&&!r.timeline&&1<r.Mc.length)throw new It(2,4,4002);if(!r.La&&!e.ja.duration&&!r.timeline&&1==r.Mc.length)throw new It(2,4,4002);if(r.timeline&&0==r.timeline.length)throw new It(2,4,4002);var s=null,a=null;e.va.id&&e.J.id&&(a=t[e.va.id+","+e.J.id])&&(s=a.segmentIndex);var o=vv(e.ja.start,e.ja.duration,e.J.Ga,r,i,n,e.J.mimeType,e.J.codecs);return t=!s,s?s.Id(o,e.presentationTimeline.nb()):s=new tu(o),e.presentationTimeline.Jd(o),e.xb&&e.ja.Dd||s.Ec(e.ja.start,e.ja.duration?e.ja.start+e.ja.duration:1/0,t),a&&(a.segmentIndex=s),{mc:function(){return s&&0!=s.getNumReferences()||s.ue(o),Promise.resolve(s)}}}function gv(e){return e.Rb}function mv(e){var t=yv(e);e=Gm(e,gv);var n=e.Od;0==n&&(n=1);var i=0;return e.La?i=e.La*(n-1):e.timeline&&0<e.timeline.length&&(i=e.timeline[0].start),{La:e.La,startTime:i,Od:n,Pb:e.Pb,timeline:e.timeline,Mc:t}}function vv(e,t,n,i,r,s,a,o){var l=i.Mc.length;i.timeline&&i.timeline.length!=i.Mc.length&&(l=Math.min(i.timeline.length,i.Mc.length));for(var u=e-i.Pb,c=t?e+t:1/0,d=[],h=i.startTime,f={},p=0;p<l;f={jd:f.jd,ed:f.ed},p++){f.ed=i.Mc[p];var g=h;h=void 0,h=null!=i.La?g+i.La:i.timeline?i.timeline[p].end:g+t,f.jd=null,g=new Qa(e+g,e+h,function(e){return function(){return null==e.jd&&(e.jd=An(n(),[e.ed.Gi])),e.jd}}(f),f.ed.start,f.ed.end,r,u,e,c,[],"",null,null,Ja,s),g.codecs=o,g.mimeType=a,d.push(g)}return d}function yv(e){return[e.J.Rb,e.la.Rb,e.va.Rb].filter(oi).map(function(e){return Cs(e,"SegmentURL")}).reduce(function(e,t){return 0<e.length?e:t}).map(function(t){t.attributes.indexRange&&!e.If&&(e.If=!0);var n=yn(t.attributes.media);return t=Os(t,"mediaRange",Vs,{start:0,end:null}),{Gi:n,start:t.start,end:t.end}})}function bv(e,t,n,i,r,s,a,o,l){l||e.J.Jc||(e.J.Jc=qm(e,_v,"initialization"));var u=e.J.Jc?Ev(e,a):null,c=Tv(e);Sv(c);var d=bi(e);if(c.Bd)return hv(e,u),{mc:function(){var e=$m(c.Bd,d.J.id,null,null,d.bandwidth||null,null);return e=An(d.J.Ga(),[e]),lv(d,t,u,e,0,null,c.Pb)}};if(c.La)return i||"image"===e.la.contentType||(e.presentationTimeline.Pf(c.La),e.presentationTimeline.ye(e.ja.start)),{mc:function(){return wv(d,c,r,u,s,a,o)}};var h=null;i=i=null,e.va.id&&e.J.id&&(i=e.va.id+","+e.J.id,i=n[i])&&(h=i.segmentIndex);var f=e.ja.start,p=e.ja.duration?f+e.ja.duration:1/0,g=!(e.xb&&e.ja.Dd);return h?(n=h,kv(n,c,f,p,g,u),n.Oa(e.presentationTimeline.nb())):h=new xv(c,e.J.id,e.bandwidth,e.J.Ga,f,p,u,g,a,e.J.ag),c.timeline&&"image"!==e.la.contentType&&e.presentationTimeline.$g(c.timeline,f),i&&e.xb&&(i.segmentIndex=h),{mc:function(){return h instanceof xv&&0==h.getNumReferences()&&kv(h,c,f,p,g,u),Promise.resolve(h)}}}function _v(e){return e.cc}function Tv(e){var t=Gm(e,_v),n=qm(e,_v,"media"),i=qm(e,_v,"index");return{La:t.La,timescale:t.timescale,Od:t.Od,Pb:t.Pb,ng:t.ng,timeline:t.timeline,bc:n&&yn(n),Bd:i,mimeType:e.J.mimeType,codecs:e.J.codecs}}function Sv(e){var t=e.Bd?1:0;if(t+=e.timeline?1:0,t+=e.La?1:0,0==t)throw new It(2,4,4002);if(1!=t&&(e.Bd&&(e.timeline=null),e.La=null),!e.Bd&&!e.bc)throw new It(2,4,4002)}function wv(t,n,i,r,s,a,o){function l(i){var s=(i-v)*m,o=s+n.Pb,l=s+f;s=l+m;var u=Math.min(s,d());return l=new Qa(l,u,function(){var t=o*y;return"BigInt"in e&&t>Number.MAX_SAFE_INTEGER&&(t=BigInt(o)*BigInt(y)),t=$m(b,T,i,null,_,t),An(S(),[t])},0,null,r,w,f,d(),[],"",null,null,Ja,a),l.codecs=t.J.codecs,l.mimeType=t.J.mimeType,l.j=s,l}function u(){var e=[Math.max(h.nb(),f),Math.min(h.Zb(),d())].map(function(e){return e-f});return e=[Math.ceil(e[0]/m),Math.ceil(e[1]/m)-1],t.J.Ia&&e[1]++,e.map(function(e){return e+v})}function d(){var e=null!=p&&s[p]||g;return e?f+e:1/0}var h=t.presentationTimeline,f=t.ja.start,p=t.va.id,g=t.ja.duration,m=n.La,v=n.Od,y=n.timescale,b=n.bc,_=t.bandwidth||null,T=t.J.id,S=t.J.Ga,w=f-n.Pb,E=u();i=t.xb?Math.max(E[0],E[1]-i+1):E[0],o=o||E[1],E=[];for(var x=i;x<=o;++x){var k=l(x);E.push(k)}var A=new tu(E);if(E=h.Zb()<d(),x=h.V(),E||x){var I=Math.max(i,o+1);i=m,t.J.Ia&&(i=.1),A.Me(i,function(){var e=h.nb();A.Oa(e);var t=c(u());t.next(),t=t.next().value;for(var n=[];I<=t;){var i=l(I);n.push(i),I++}return e>d()&&!n.length?null:n})}return Promise.resolve(A)}function Ev(e,t){var n=e.J.Jc;if(n||(n=qm(e,_v,"initialization")),!n)return null;n=yn(n);var i=e.J.id,r=e.bandwidth||null,s=e.J.Ga;return t=new Ya(function(){var e=$m(n,i,null,null,r,null);return An(s(),[e])},0,null,fv(e),null,null,t),t.codecs=e.J.codecs,t.mimeType=e.J.mimeType,t}function xv(e,t,n,i,r,s,a,o,l,u){tu.call(this,[]),this.g=e,this.C=t,this.A=n,this.B=i,this.h=r,this.j=s,this.o=a,this.s=l,this.F=u,o&&Iv(this)}function kv(e,t,n,i,r,s){if(Av(e,s),e.g){if(n=e.g.timeline,e.g.bc!==t.bc&&(e.g.bc=t.bc),n.length){var a=n[n.length-1];t=t.timeline.filter(function(e){return e.start>=a.end})}else t=t.timeline.slice();0<t.length&&e.g.timeline.push.apply(e.g.timeline,d(t)),e.j!==i&&(e.j=i)}else e.g=t,e.h=n,e.j=i;r&&Iv(e)}function Av(e,t){if(e.o!==t){e.o=t,e=c(e.O);for(var n=e.next();!n.done;n=e.next())(n=n.value)&&Za(n,t)}}function Iv(e){if(!e.m){for(var t=e.g.timeline;t.length;){if(!(t[t.length-1].start>=e.j))break;t.pop()}e.Oa(e.h)}}function Cv(e,t,n,i,r,s,a){return e=$m(e,t,n,s,i||null,r),An(a(),[e]).map(function(e){return e.toString()})}function Dv(e){this.o=null,this.A=e,this.G=new jr,this.i=[],this.h=null,this.m=[],this.B=null,this.F=[],this.C=300,this.l=new Map,this.j=new Map,this.g=null,this.s="UNKNOWN"}function Rv(e,t){var n,i,r,s,a,o,l;return N(function(u){return 1==u.g?(n=An(e.i,[Mv(e,t)]),i=zr(n,e.o.retryParameters),r=e.A.networkingEngine.request(8,i),Vr(e.G,r),E(u,2),S(u,r.promise,4)):2!=u.g?(s=u.h,a=hn(s.data),o=JSON.parse(a),1==o.VERSION&&Lv(e,o,s.uri),k(u,0)):(l=A(u))&&7001==l.code?u.return():(null!=e.g&&(e.g.stop(),e.g=null),e.g=new Ut(function(){Rv(e,t)}),e.g.Y(e.C),void w(u))})}function Mv(e,t){if(!e.m.length)return t;t=new ht(t);var n=e.B||e.m[0],i=Math.round(e.A.getBandwidthEstimate()),r=t.g;return"DASH"==e.s?(r.add("_DASH_pathway",n),r.add("_DASH_throughput",String(i))):"HLS"==e.s&&(r.add("_HLS_pathway",n),r.add("_HLS_throughput",String(i))),At(r)&&mt(t,r),t.toString()}function Lv(e,t,n){null!=e.g&&(e.g.stop(),e.g=null);var i=t["RELOAD-URI"]||n;e.g=new Ut(function(){Rv(e,i)}),(n=t.TTL)&&(e.C=n),e.g.Y(e.C),e.m=t["PATHWAY-PRIORITY"]||[],e.F=t["PATHWAY-CLONES"]||[]}function Pv(e,t,n,i){var r=e.l.get(t);r||(r=new Map),r.set(n,i),e.l.set(t,r)}function Ov(e,t,n){n=void 0!==n&&n,t=e.l.get(t)||new Map;for(var i=[],r={},s=c(e.m),a=s.next();!a.done;r={jc:r.jc},a=s.next())if(r.jc=a.value,a=t.get(r.jc))i.push({Vf:r.jc,location:a});else if(a=e.F.find(function(e){return function(t){return t.Dj==e.jc}}(r))){var o=t.get(a["BASE-ID"]);o&&(a["URI-REPLACEMENT"].xh?(o=new ht(o),pt(o,a["URI-REPLACEMENT"].xh),i.push({Vf:r.jc,location:o.toString()})):i.push({Vf:r.jc,location:o}))}for(r=Date.now(),s=c(e.j.keys()),a=s.next();!a.done;a=s.next())a=a.value,o=e.j.get(a),r>o&&e.j.delete(a);if(i=i.filter(function(t){for(var n=c(e.j.keys()),i=n.next();!i.done;i=n.next())if(i.value.includes(new ht(t.location).Gb))return!1;return!0}),i.length&&(e.B=i[0].Vf),i=i.map(function(e){return e.location}),!i.length&&e.h)for(r=c(e.h.split(",")),a=r.next();!a.done;a=r.next())(s=t.get(a.value))&&(e.B=e.h,i.push(s));if(!i.length)for(t=c(t.values()),r=t.next();!r.done;r=t.next())i.push(r.value);return n?i:An(e.i,i)}function Nv(){this.j=[],this.h=[],this.g=[],this.l=[],this.i=[],this.s=this.o=!1,this.m=new Set}function Uv(e,t){var n=[],i=[],r=[],s=[];e=c(e);for(var a=e.next();!a.done;a=e.next()){var o=a.value;a=new Map(o.audioStreams.map(function(e){return[cy(e),e]}));var l=new Map(o.videoStreams.map(function(e){return[uy(e),e]})),u=new Map(o.textStreams.map(function(e){return[dy(e),e]}));if(o=new Map(o.imageStreams.map(function(e){return[hy(e),e]})),t){var d=sy(Ln);u.set(dy(d),d),d=sy("image"),o.set(hy(d),d)}n.push(a),i.push(l),r.push(u),s.push(o)}return{xg:n,vh:i,sh:r,Sg:s}}function Fv(e){var t,n,i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,w,E,x,k,A,I,C,D,R,M;return N(function(L){switch(L.g){case 1:if(t=Pn,1==e.length)return L.return(e[0]);for(n=e.map(function(e){return new Map(e.filter(function(e){return e.type===t.X}).map(function(e){return[cy(e),e]}))}),i=e.map(function(e){return new Map(e.filter(function(e){return e.type===t.ga}).map(function(e){return[uy(e),e]}))}),r=e.map(function(e){return new Map(e.filter(function(e){return e.type===t.ta}).map(function(e){return[dy(e),e]}))}),s=e.map(function(e){return new Map(e.filter(function(e){return e.type===t.Ze}).map(function(e){return[hy(e),e]}))}),a=c(r),o=a.next();!o.done;o=a.next())l=o.value,u=ry(t.ta),l.set(dy(u),u);for(d=c(s),h=d.next();!h.done;h=d.next())f=h.value,p=ry(t.Ze),f.set(hy(p),p);return g=new Nv,S(L,Bv(g,[],n,0,zv,Wv,0),2);case 2:return m=L.h,S(L,Bv(g,[],i,0,zv,Wv,0),3);case 3:return v=L.h,S(L,Bv(g,[],r,0,zv,Wv,0),4);case 4:return y=L.h,S(L,Bv(g,[],s,0,zv,Wv,0),5);case 5:if(b=L.h,_=0,v.length&&m.length)for(k=c(m),A=k.next();!A.done;A=k.next())for(I=A.value,C=c(v),D=C.next();!D.done;D=C.next())R=D.value,M=_++,R.variantIds.push(M),I.variantIds.push(M);else for(T=v.concat(m),w=c(T),E=w.next();!E.done;E=w.next())x=E.value,x.variantIds=[_++];return L.return(v.concat(m).concat(y).concat(b))}})}function Bv(e,t,n,i,r,s,a){var o,l,u,d,h,f,p,g,m,v,y,b,_,T,w,E,x;return N(function(k){switch(k.g){case 1:for(o=[],l=0;l<n.length;l++)l>=i?o.push(new Set(n[l].values())):o.push(new Set);u=c(t),d=u.next();case 2:if(d.done){k.u(4);break}return h=d.value,S(k,jv(e,h,n,i,s,o,a),5);case 5:if(f=k.h,!f)throw new It(2,4,4037);d=u.next(),k.u(2);break;case 4:for(p=c(o),g=p.next();!g.done;g=p.next())for(m=g.value,v=c(m),y=v.next();!y.done;y=v.next())b=y.value,(_=Hv(e,b,n,r,s,o))&&t.push(_);for(T=c(o),g=T.next();!g.done;g=T.next())for(w=g.value,E={},x=c(w),y=x.next();!y.done;E={Yd:E.Yd},y=x.next())if(E.Yd=y.value,!ly(E.Yd)&&t.some(function(t){return function(n){return Qv(e,t.Yd,n)}}(E)))throw new It(2,4,4037);return k.return(t)}})}function jv(e,t,n,i,r,s,a){return N(function(o){return 1==o.g?(Kv(e,n,t,0<a),t.matchedStreams?t.segmentIndex?S(o,Vv(t,i+a),2):o.u(2):o.return(!1)):($v(t,i,r,s,a),o.return(!0))})}function Vv(e,t){var n,i,r,s,a,o,l;return N(function(u){if(1==u.g){for(n=[],i=e.matchedStreams,r=c(i),s=r.next();!s.done;s=r.next())a=s.value,n.push(a.createSegmentIndex()),a.trickModeVideo&&!a.trickModeVideo.segmentIndex&&n.push(a.trickModeVideo.createSegmentIndex());return S(u,Promise.all(n),2)}if(e.segmentIndex instanceof ru)for(o=t;o<i.length;o++)l=i[o],l.segmentIndex&&e.segmentIndex.g.push(l.segmentIndex);w(u)})}function Hv(e,t,n,i,r,s){if(ly(t))return null;var a=i(t);return Kv(e,n,a),a.createSegmentIndex&&(a.createSegmentIndex=function(){return N(function(e){return a.segmentIndex?e.u(0):(a.segmentIndex=new ru,S(e,Vv(a,0),0))})}),a.matchedStreams&&a.matchedStreams.length?($v(a,0,r,s,0),a):null}function $v(e,t,n,i,r){var s=e.matchedStreams;for(t+=r;t<s.length;t++){var a=s[t];n(e,a);var o=!0;if("audio"==e.type&&0==fi(e.language,a.language)&&(o=!1),o&&(i[t-r].delete(a),a.fullMimeTypes))for(a=c(a.fullMimeTypes.values()),o=a.next();!o.done;o=a.next())e.fullMimeTypes.add(o.value)}}function Gv(e){var t=Object.assign({},e);return t.originalId=null,t.createSegmentIndex=function(){return Promise.resolve()},t.closeSegmentIndex=function(){if(t.segmentIndex&&(t.segmentIndex.release(),t.segmentIndex=null),t.matchedStreams)for(var e=c(t.matchedStreams),n=e.next();!n.done;n=e.next())n=n.value,n.segmentIndex&&(n.segmentIndex.release(),n.segmentIndex=null)},t.roles=t.roles.slice(),t.segmentIndex=null,t.emsgSchemeIdUris=[],t.keyIds=new Set,t.closedCaptions=null,t.trickModeVideo=null,t}function zv(e){return e=Object.assign({},e),e.roles=e.roles.slice(),e.keyIds=new Set,e.segments=[],e.variantIds=[],e.closedCaptions=null,e}function qv(e,t){function n(e,t){e||(e=[]),t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value,e.includes(n)||e.push(n);return e}e.roles=n(e.roles,t.roles),t.emsgSchemeIdUris&&(e.emsgSchemeIdUris=n(e.emsgSchemeIdUris,t.emsgSchemeIdUris));for(var i=c(t.keyIds),r=i.next();!r.done;r=i.next())e.keyIds.add(r.value);if(null==e.originalId?e.originalId=t.originalId:e.originalId+=","+(t.originalId||""),i=Mt(e.drmInfos,t.drmInfos),t.drmInfos.length&&e.drmInfos.length&&!i.length)throw new It(2,4,4038);if(e.drmInfos=i,e.encrypted=e.encrypted||t.encrypted,t.closedCaptions)for(e.closedCaptions||(e.closedCaptions=new Map),i=c(t.closedCaptions),r=i.next();!r.done;r=i.next()){var s=c(r.value);r=s.next().value,s=s.next().value,e.closedCaptions.set(r,s)}e.bandwidth&&t.bandwidth&&(e.bandwidth=Math.max(e.bandwidth,t.bandwidth)),t.trickModeVideo?(e.trickModeVideo||(e.trickModeVideo=Gv(t.trickModeVideo),e.trickModeVideo.createSegmentIndex=function(){return e.trickModeVideo.segmentIndex=e.segmentIndex.clone(),Promise.resolve()}),qv(e.trickModeVideo,t.trickModeVideo)):e.trickModeVideo&&qv(e.trickModeVideo,t)}function Wv(e,t){var n=e.roles;n||(n=[]);for(var i=c(t.roles),r=i.next();!r.done;r=i.next())r=r.value,n.includes(r)||n.push(r);for(e.roles=n,n=c(t.keyIds),i=n.next();!i.done;i=n.next())e.keyIds.add(i.value);if(e.encrypted=e.encrypted&&t.encrypted,e.segments.push.apply(e.segments,d(t.segments)),t.closedCaptions)for(e.closedCaptions||(e.closedCaptions=new Map),t=c(t.closedCaptions),n=t.next();!n.done;n=t.next())i=c(n.value),n=i.next().value,i=i.next().value,e.closedCaptions.set(n,i)}function Kv(e,t,n,i){i=void 0!==i&&i?n.matchedStreams:[],t=c(t);for(var r=t.next();!r.done;r=t.next()){if(r=Yv(e,r.value,n),!r)return;i.push(r)}n.matchedStreams=i}function Yv(e,t,n){var i={audio:cy,video:uy,text:dy,image:hy}[n.type],r=null,s=i(n);if(t.has(s))r=t.get(s);else{s={audio:function(t,n){return Qv(e,t,n)},video:function(t,n){return Qv(e,t,n)},text:Zv,image:Jv}[n.type];for(var a={audio:ey,video:ty,text:ny,image:iy}[n.type],o=c(t.values()),l=o.next();!l.done;l=o.next())l=l.value,!s(n,l)||n.fastSwitching!=l.fastSwitching||r&&!a(n,r,l)||(r=l)}return e.s&&!ly(r)&&t.delete(i(r)),r}function Xv(e,t){return e.mimeType==t.mimeType&&fy(e.codecs)===fy(t.codecs)}function Qv(e,t,n){return!(!Xv(t,n)&&!e.o||t.drmInfos&&!Rt(t.drmInfos,n.drmInfos))}function Zv(e,t){return!t.language||e.forced===t.forced&&0!=fi(e.language,t.language)&&t.kind==e.kind}function Jv(){return!0}function ey(e,t,n){var i=Xv(e,t),r=Xv(e,n);if(i&&!r)return!1;if(!i&&r)return!0;if(i=fi(e.language,t.language),r=fi(e.language,n.language),r>i)return!0;if(r<i)return!1;if(t.label!==n.label){if(e.label===t.label)return!1;if(e.label===n.label)return!0}if(e.roles.length){if(i=t.roles.filter(function(t){return e.roles.includes(t)}),r=n.roles.filter(function(t){return e.roles.includes(t)}),r.length>i.length)return!0;if(r.length<i.length)return!1;if(n.roles.length!==t.roles.length)return n.roles.length<t.roles.length}else{if(!n.roles.length&&t.roles.length)return!0;if(n.roles.length&&!t.roles.length)return!1}return!(t.primary||!n.primary)||!(t.primary&&!n.primary)&&(i=ay(e.channelsCount,t.channelsCount,n.channelsCount),i==py||i!=my&&(i=ay(e.audioSamplingRate,t.audioSamplingRate,n.audioSamplingRate),i==py||i!=my&&!(!e.bandwidth||oy(e.bandwidth,t.bandwidth,n.bandwidth)!=py)))}function ty(e,t,n){var i=Xv(e,t),r=Xv(e,n);if(i&&!r)return!1;if(!i&&r)return!0;if(i=ay(e.width*e.height,t.width*t.height,n.width*n.height),i==py)return!0;if(i==my)return!1;if(e.frameRate){if(i=ay(e.frameRate,t.frameRate,n.frameRate),i==py)return!0;if(i==my)return!1}return!(!e.bandwidth||oy(e.bandwidth,t.bandwidth,n.bandwidth)!=py)}function ny(e,t,n){var i=fi(e.language,t.language),r=fi(e.language,n.language);if(r>i)return!0;if(r<i)return!1;if(!t.primary&&n.primary)return!0;if(t.primary&&!n.primary)return!1;if(t.label!==n.label){if(e.label===t.label)return!1;if(e.label===n.label)return!0}if(e.roles.length){if(i=t.roles.filter(function(t){return e.roles.includes(t)}),r=n.roles.filter(function(t){return e.roles.includes(t)}),r.length>i.length)return!0;if(r.length<i.length)return!1}else{if(!n.roles.length&&t.roles.length)return!0;if(n.roles.length&&!t.roles.length)return!1}return n.mimeType==e.mimeType&&n.codecs==e.codecs&&(t.mimeType!=e.mimeType||t.codecs!=e.codecs)}function iy(e,t,n){return ay(e.width*e.height,t.width*t.height,n.width*n.height)==py}function ry(e){return{id:0,originalId:"",groupId:null,primary:!1,type:e,mimeType:"",codecs:"",language:"",originalLanguage:null,label:null,width:null,height:null,encrypted:!1,keyIds:new Set,segments:[],variantIds:[],roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,external:!1,fastSwitching:!1}}function sy(e){return{id:0,originalId:"",groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new tu([]),mimeType:"",codecs:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"",originalLanguage:null,label:null,type:e,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null,accessibilityPurpose:null,external:!1,fastSwitching:!1,fullMimeTypes:new Set}}function ay(e,t,n){if(t==e&&e!=n)return my;if(n==e&&e!=t)return py;if(t>e){if(n<=e||n-e<t-e)return py;if(n-e>t-e)return my}else{if(n>e)return my;if(e-n<e-t)return py;if(e-n>e-t)return my}return gy}function oy(e,t,n){return t=Math.abs(e-t),e=Math.abs(e-n),e<t?py:t<e?my:gy}function ly(e){switch(e.type){case Ln:return!e.language;case"image":return!e.tilesLayout;default:return!1}}function uy(e){return JSON.stringify([e.fastSwitching,e.width,e.frameRate,fy(e.codecs),e.mimeType,e.label,e.roles,e.closedCaptions?Array.from(e.closedCaptions.entries()):null,e.bandwidth])}function cy(e){return JSON.stringify([e.fastSwitching,e.channelsCount,e.language,e.bandwidth,e.label,fy(e.codecs),e.mimeType,e.roles,e.audioSamplingRate,e.primary])}function dy(e){return JSON.stringify([e.language,e.label,e.codecs,e.mimeType,e.bandwidth,e.roles])}function hy(e){return JSON.stringify([e.width,e.codecs,e.mimeType])}function fy(e){if(!vy.has(e)){var t=$n(e);vy.set(e,t)}return vy.get(e)}y(xv,tu),i=xv.prototype,i.getNumReferences=function(){return this.g?this.g.timeline.length:0},i.release=function(){tu.prototype.release.call(this),this.g=null},i.Oa=function(e){if(this.g){for(var t=0,n=this.g.timeline,i=0;i<n.length;i+=1){if(!(n[i].end+this.h<=e))break;t+=1}0<t&&(this.g.timeline=n.slice(t),this.O.length>=t&&(this.O=this.O.slice(t)),this.i+=t,0===this.getNumReferences()&&this.release())}},i.find=function(e){if(this.g&&this.g.timeline&&this.g.timeline.length&&e<this.g.timeline[0].start+this.h)return this.i;if(!this.g)return null;var t=this.g.timeline;if(e<this.h||e>=this.j)return null;for(var n=t.length-1,i=0;i<t.length;i++){var r=t[i],s=r.start+this.h;if(r=i<n?t[i+1].start+this.h:1/0===this.j?r.end+this.h:this.j,e>=s&&e<r)return i+this.i}return null},i.get=function(e){var t=this;if(e-=this.i,0>e||e>=this.getNumReferences()||!this.g)return null;var n=this.O[e];if(!n){var i=this.g.timeline[e],r=i.Zi,s=this.g.ng+i.og;n=this.h-this.g.Pb;var a=this.h+i.end,o=a;e===this.getNumReferences()-1&&1/0!==this.j&&(o=this.j);for(var l=this.g.codecs,u=this.g.mimeType,c=[],d=(i.end-i.start)/i.Bb,h={},f=0;f<i.Bb;h={kd:h.kd,We:h.We},f++){var p=i.start+d*f,g=p+d;h.We=f+1,h.kd=null,p=new Qa(this.h+p,this.h+g,function(e){return function(){return t.g?(null==e.kd&&(e.kd=Cv(t.g.bc,t.C,r,t.A,s,e.We,t.B)),e.kd):[]}}(h),0,null,this.o,n,this.h,this.j,[],"",null,null,Ja,this.s),p.codecs=l,p.mimeType=u,0==this.F?0<f&&p.se():0!=f%this.F&&p.se(),c.push(p)}n=new Qa(this.h+i.start,o,function(){return 0<i.Bb||!t.g?[]:Cv(t.g.bc,t.C,r,t.A,s,null,t.B)},0,null,this.o,n,this.h,this.j,c,"",null,null,Ja,this.s,0<i.Bb),n.codecs=l,n.mimeType=u,n.j=a,this.O[e]=n}return n},Dv.prototype.configure=function(e){this.o=e},Dv.prototype.destroy=function(){return this.A=this.o=null,this.i=[],this.h=null,this.m=[],this.F=[],this.l.clear(),null!=this.g&&(this.g.stop(),this.g=null),this.G.destroy()},Dv.prototype.setManifestType=function(e){this.s=e},Dv.prototype.banLocation=function(e){this.j.set(e,Date.now()+6e4)},i=Nv.prototype,i.release=function(){for(var e=c(this.h.concat(this.g,this.l,this.i)),t=e.next();!t.done;t=e.next())t=t.value,t.segmentIndex&&t.segmentIndex.release();this.h=[],this.g=[],this.l=[],this.i=[],this.j=[]},i.li=function(){return this.j},i.Gf=function(){return this.l.slice()},i.Uh=function(){return this.i},i.gf=function(e,t,n){n=void 0!==n&&n;var i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,E,x,k,A,I,C,D,R,M,L,P,O,U=this;return N(function(N){if(1==N.g){if(i=Pn,!t&&1==e.length)return r=Uv(e,!1),s=r.xg,a=r.vh,o=r.sh,l=r.Sg,U.h=Array.from(s[0].values()),U.g=Array.from(a[0].values()),U.l=Array.from(o[0].values()),U.i=Array.from(l[0].values()),N.u(2);for(u=n?U.m.size:0,d=-1,h=0;h<e.length;h++)f=e[h],U.m.has(f.id)||(U.m.add(f.id),-1==d&&(d=h));return-1==d?N.return():(p=Uv(e,!0),g=p.xg,m=p.vh,v=p.sh,y=p.Sg,S(N,Promise.all([Bv(U,U.h,g,d,Gv,qv,u),Bv(U,U.g,m,d,Gv,qv,u),Bv(U,U.l,v,d,Gv,qv,u),Bv(U,U.i,y,d,Gv,qv,u)]),2))}if(b=0,_=[],U.g.length&&U.h.length)for(I=c(U.h),C=I.next();!C.done;C=I.next())for(D=C.value,R=c(U.g),M=R.next();!M.done;M=R.next())L=M.value,P=Mt(D.drmInfos,L.drmInfos),D.drmInfos.length&&L.drmInfos.length&&!P.length||(O=b++,_.push({id:O,language:D.language,disabledUntilTime:0,primary:D.primary,audio:D,video:L,bandwidth:(D.bandwidth||0)+(L.bandwidth||0),drmInfos:P,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]}));else for(T=U.g.length?U.g:U.h,E=c(T),x=E.next();!x.done;x=E.next())k=x.value,A=b++,_.push({id:A,language:k.language,disabledUntilTime:0,primary:k.primary,audio:k.type==i.X?k:null,video:k.type==i.ga?k:null,bandwidth:k.bandwidth||0,drmInfos:k.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});U.j=_,w(N)})},i.ih=function(e){this.o=e},i.ph=function(e){this.s=e},G("shaka.util.PeriodCombiner",Nv),Nv.prototype.setUseStreamOnce=Nv.prototype.ph,Nv.prototype.setAllowMultiTypeVariants=Nv.prototype.ih,Nv.prototype.combinePeriods=Nv.prototype.gf,Nv.prototype.getImageStreams=Nv.prototype.Uh,Nv.prototype.getTextStreams=Nv.prototype.Gf,Nv.prototype.getVariants=Nv.prototype.li;var py=1,gy=0,my=-1,vy=new Map;function yy(e,t){var n=new DOMParser,i=_y.value()(e);e=null;try{e=n.parseFromString(i,"text/xml")}catch(e){return null}if(n=e.documentElement,!n||n.getElementsByTagName("parsererror").length||n.tagName!=t)return null;if(!("createNodeIterator"in document))return n;for(t=document.createNodeIterator(e,NodeFilter.SHOW_ALL);e=t.nextNode();)if(e instanceof HTMLElement||e instanceof SVGElement)return null;return n}function by(e,t){try{var n=pn(e);return yy(n,t)}catch(e){return null}}var _y=new Dt(function(){if("undefined"!==typeof trustedTypes){var e=trustedTypes.createPolicy("shaka-player#xml",{createHTML:function(e){return e}});return function(t){return e.createHTML(t)}}return function(e){return e}});function Ty(){var e=this;this.j=this.g=null,this.A=[],this.i=null,this.ea=1,this.B=[],this.l={we:"",type:"",profiles:[],Mb:null,Ia:0,Ga:null,Ld:0},this.o=new Map,this.s={},this.aa={},this.m=new Nv,this.H=0,this.da=new W(5),this.I=new Ut(function(){e.G&&!e.g.continueLoadingWhenPaused&&(e.C.lb(e.G,"timeupdate"),e.G.paused)?e.C.ha(e.G,"timeupdate",function(){return Uy(e)}):Uy(e)}),this.N=new jr,this.L=null,this.fa=[],this.R=1/0,this.F=!1,this.h=null,this.K=0,this.U=!1,this.C=new se,this.G=null,this.Z=!1}function Sy(e){var t,n,i,r,s,a,o,l,u,c;return N(function(d){return 1==d.g?(t=4,n="MPD",i=Yy(e),r=e.A,i.length?(r=i,n="Patch",t=6):1<e.A.length&&e.h&&(s=Ov(e.h,"Location",!0),s.length&&(r=s)),a=zr(r,e.g.retryParameters),o=Date.now(),S(d,Ky(e,a,0,{type:t}),2)):3!=d.g?(l=d.h,e.j?(l.uri&&l.uri!=l.originalUri&&!e.A.includes(l.uri)&&e.A.unshift(l.uri),S(d,wy(e,l.data,l.uri,n),3)):d.return(0)):(u=Date.now(),c=(u-o)/1e3,e.da.sample(1,c),d.return(c))})}function wy(e,t,n,i){var r,s,a,o,l,u,c,d,h,f;return N(function(p){if(1==p.g){if(r=t,s=e.g.dash.manifestPreprocessor,a=Nc,s!=a){if(pe("manifest.dash.manifestPreprocessor configuration","Please Use manifest.dash.manifestPreprocessorTXml instead."),o=by(r,i),!o)throw new It(2,4,4001,n);s(o),r=gn(o.outerHTML)}if(l=ws(r,i),!l)throw new It(2,4,4001,n);return u=e.g.dash.manifestPreprocessorTXml,c=Uc,u!=c&&u(l),"Patch"===i?p.return(ky(e,l)):e.g.dash.disableXlinkProcessing?p.return(Ey(e,l,n)):(d=e.g.dash.xlinkFailGracefully,h=Ym(l,e.g.retryParameters,d,n,e.j.networkingEngine),Vr(e.N,h),S(p,h.promise,2))}return f=p.h,p.return(Ey(e,f,n))})}function Ey(e,t,n){var i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,E,x,k,A,I,C,D,R,M,L,P,O,U,F,B,j,V,H,$,G,z,q,W,K,Y,X,Q,Z,J,ee,te,ne,ie,re,se;return N(function(N){switch(N.g){case 1:for(e.h&&e.h.l.clear(),i=[n],r=[],s=new Map,a=Cs(t,"Location"),o=c(a),l=o.next();!l.done;l=o.next())u=l.value,d=u.attributes.serviceLocation,(h=Rs(u))&&(f=An(i,[h])[0],d&&(e.h?Pv(e.h,"Location",d,f):s.set(d,f)),r.push(f));if(e.h?(p=Ov(e.h,"Location",!0),0<p.length&&(i=e.A=p)):r.length&&(i=e.A=r),e.l.we=t.attributes.id||"",e.l.Ld=Os(t,"publishTime",Bs)||0,e.B=Cs(t,"PatchLocation"),g=Promise.resolve(),(m=Ls(t,"ContentSteering"))&&e.j)for(v=m.attributes.defaultServiceLocation,e.h?(e.h.i=i,e.h.h=v):(e.h=new Dv(e.j),e.h.configure(e.g),e.h.setManifestType("DASH"),e.h.i=i,e.h.h=v,(y=Rs(m))&&(Os(m,"queryBeforeStart",qs,!1)?g=Rv(e.h,y):Rv(e.h,y))),b=c(s.keys()),_=b.next();!_.done;_=b.next())T=_.value,E=s.get(T),Pv(e.h,"Location",T,E);if(x=Cs(t,"BaseURL"),A=!1,e.h)for(I=c(x),C=I.next();!C.done;C=I.next())D=C.value,R=D.attributes.serviceLocation,M=Rs(D),R&&M&&(Pv(e.h,"BaseURL",R,M),A=!0);if(A&&e.h||(L=x.map(Rs),k=An(i,L)),P=function(){return e.h&&A?Ov(e.h,"BaseURL"):k||[]},e.l.Ga=P,O=0,x&&x.length&&(O=Os(x[0],"availabilityTimeOffset",zs)||0),e.l.Ia=O,U=e.g.dash.ignoreMinBufferTime,F=0,U||(F=Os(t,"minBufferTime",js)||0),e.H=Os(t,"minimumUpdatePeriod",js,-1),B=Os(t,"availabilityStartTime",Bs),j=Os(t,"timeShiftBufferDepth",js),V=e.g.dash.ignoreSuggestedPresentationDelay,H=null,V||(H=Os(t,"suggestedPresentationDelay",js)),$=e.g.dash.ignoreMaxSegmentDuration,G=null,$||(G=Os(t,"maxSegmentDuration",js)),z=t.attributes.type||"static",e.i&&e.i.presentationTimeline&&(e.Z=e.i.presentationTimeline.V()&&"static"==z),e.l.type=z,e.i)for(q=e.i.presentationTimeline,W=c(Object.values(e.s)),K=W.next();!K.done;K=W.next())Y=K.value,Y.segmentIndex&&Y.segmentIndex.Oa(q.nb());else X=e.g.defaultPresentationDelay||1.5*F,Q=null!=H?H:X,q=new Ll(B,Q,e.g.dash.autoCorrectDrift);return q.wc("static"==z),q.V()&&!isNaN(e.g.availabilityWindowOverride)&&(j=e.g.availabilityWindowOverride),null==j&&(j=1/0),q.Ie(j),Z=t.attributes.profiles||"",e.l.profiles=Z.split(","),J={xb:"static"!=z,presentationTimeline:q,va:null,ja:null,la:null,J:null,bandwidth:0,If:!1,Ia:O,Mb:null,profiles:Z.split(","),roles:null},e.K=0,ee=Ry(e,J,P,t),te=ee.duration,ne=ee.periods,("static"!=z||e.Z)&&ee.Fg||q.$a(te||1/0),e.U&&!e.F&&e.j.isAutoLowLatencyMode()&&(e.j.enableLowLatencyMode(),e.F=e.j.isLowLatencyMode()),e.F&&q.jh(e.R),q.Pf(G||1),S(N,g,2);case 2:return e.F&&(F=0,ie=null!=H?H:e.g.defaultPresentationDelay,q.eg(ie)),e.i?(e.i.periodCount=ne.length,e.i.gapCount=e.K,S(N,xy(e,ne,!1),4)):S(N,e.m.gf(ne,J.xb),6);case 6:if(e.i={presentationTimeline:q,variants:e.m.j,textStreams:e.m.Gf(),imageStreams:e.m.i,offlineSessionIds:[],minBufferTime:F||0,sequenceMode:e.g.dash.sequenceMode,ignoreManifestTimestampsInSegmentsMode:!1,type:"DASH",serviceDescription:Cy(t),nextUrl:Dy(t),periodCount:ne.length,gapCount:e.K,isLowLatency:e.U},!q.uh()){N.u(7);break}return re=Cs(t,"UTCTiming"),S(N,Gy(e,P,re),8);case 8:if(se=N.h,!e.j)return N.return();q.kh(se);case 7:q.re();case 4:e.j.makeTextStreamsForClosedCaptions(e.i),w(N)}})}function xy(e,t,n){var i;return N(function(r){if(1==r.g)return S(r,e.m.gf(t,!0,n),2);e.i.variants=e.m.j,i=e.m.Gf(),0<i.length&&(e.i.textStreams=i),e.i.imageStreams=e.m.i,e.j.filter(e.i),w(r)})}function ky(e,t){var n,i,r,s,a,o,l,u,h,f,p,g,m,v,y,b,_,T,E,x,k,A,I,C,D;return N(function(R){if(1==R.g){if(n=t.attributes.mpdId,i=Os(t,"originalPublishTime",Bs),!n||n!==e.l.we||i!==e.l.Ld)throw e.B=[],new It(1,4,4052);for(r=[],s=[],a=new Set,o=c(Is(t)),l=o.next();!l.done;l=o.next())if(u=l.value,h=Ks(u.attributes.sel||""),f=h[h.length-1],p=Rs(u)||"","MPD"===f.name)if("mediaPresentationDuration"===f.Vb){g=Rs(u)||"";var M=js(g);if(null!=M){e.l.Mb=M;for(var L=c(e.o.values()),P=L.next();!P.done;P=L.next())P.value.Mb=M}}else if("type"===f.Vb){for(e.i.presentationTimeline.wc("static"==p),e.l.type=p,M=c(e.o.values()),L=M.next();!L.done;L=M.next())L.value.xb="dynamic"==p;"static"==p&&(e.H=-1)}else"publishTime"===f.Vb?e.l.Ld=Bs(p)||0:null===f.Vb&&"add"===u.tagName&&s.push(u);else if("PatchLocation"===f.name)Ys(e.B,u);else if("Period"===f.name){if("add"===u.tagName)s.push(u);else if("remove"===u.tagName&&f.id)for(M=f.id,e.i.periodCount--,L=c(e.o.keys()),P=L.next();!P.done;P=L.next())if(P=P.value,P.startsWith(M)){var O=e.o.get(P);Wm(O,_v,"SegmentTimeline").children=[],Iy(e,P),e.o.delete(P)}}else if("SegmentTemplate"===f.name){if(L=Ks(u.attributes.sel||""),M=L[L.length-1],M.Vb){L=Ay(e,L),P=Rs(u)||"",O=c(L);for(var N=O.next();!N.done;N=O.next())N=e.o.get(N.value),Xs(N.J.cc,u.tagName,M.Vb,P);M=L}else M=[];for(m=M,v=c(m),y=v.next();!y.done;y=v.next())b=y.value,a.add(b)}else if("SegmentTimeline"===f.name||"S"===f.name){for(M=Ks(u.attributes.sel||""),M=Ay(e,M),L=c(M),P=L.next();!P.done;P=L.next())P=e.o.get(P.value),P=Wm(P,_v,"SegmentTimeline"),O=Cs(P,"S"),Ys(O,u),P.children=O;for(_=M,T=c(_),y=T.next();!y.done;y=T.next())E=y.value,a.add(E)}for(x=c(a),y=x.next();!y.done;y=x.next())k=y.value,Iy(e,k);for(A=c(s),I=A.next();!I.done;I=A.next())C=I.value,r.push.apply(r,d(Ry(e,{xb:"dynamic"==e.l.type,presentationTimeline:e.i.presentationTimeline,va:null,ja:null,la:null,J:null,bandwidth:0,If:!1,Ia:e.l.Ia,profiles:e.l.profiles,Mb:e.l.Mb,roles:null},e.l.Ga,C).periods));return r.length?(e.i.periodCount+=r.length,e.i.gapCount=e.K,S(R,xy(e,r,!0),2)):R.u(2)}"static"==e.l.type&&(D=e.l.Mb,e.i.presentationTimeline.$a(D||1/0)),w(R)})}function Ay(e,t){var n="",i="",r="";t=c(t);for(var s=t.next();!s.done;s=t.next())s=s.value,"Period"===s.name?n=s.id:"AdaptationSet"===s.name?i=s.id:"Representation"===s.name&&(r=s.id);if(t=[],r)t.push(n+","+r);else for(e=c(e.o.values()),r=e.next();!r.done;r=e.next())r=r.value,r.va.id===n&&r.la.id===i&&r.J.id&&t.push(n+","+r.J.id);return t}function Iy(e,t){var n=e.o.get(t),i=e.s[t];i.segmentIndex&&i.segmentIndex.Oa(e.i.presentationTimeline.nb());try{var r=bv(n,function(t,n,i,r){return qy(e,t,n,i,r)},e.s,!0,e.g.dash.initialSegmentLimit,e.aa,n.J.aesKey,null,!0);i.createSegmentIndex=function(){var e;return N(function(t){if(1==t.g)return i.segmentIndex?t.u(0):(e=i,S(t,r.mc(),3));e.segmentIndex=t.h,w(t)})}}catch(e){if(t=n.J.contentType,t!=Ln&&"application"!=t&&"image"!=t||4002!=e.code)throw e}}function Cy(e){var t=Ls(e,"ServiceDescription");if(!t)return null;if(e=Ls(t,"Latency"),t=Ls(t,"PlaybackRate"),!e&&!t)return null;var n={};return e&&("target"in e.attributes&&(n.targetLatency=parseInt(e.attributes.target,10)/1e3),"max"in e.attributes&&(n.maxLatency=parseInt(e.attributes.max,10)/1e3),"min"in e.attributes&&(n.minLatency=parseInt(e.attributes.min,10)/1e3)),t&&("max"in t.attributes&&(n.maxPlaybackRate=parseFloat(t.attributes.max)),"min"in t.attributes&&(n.minPlaybackRate=parseFloat(t.attributes.min))),n}function Dy(e){if(e=Cs(e,"SupplementalProperty"),!e.length)return null;e=c(e);for(var t=e.next();!t.done;t=e.next())if(t=t.value,"urn:mpeg:dash:chaining:2016"==t.attributes.schemeIdUri)return t.attributes.value;return null}function Ry(e,t,n,i){var r=t.Mb;r||(r=Os(i,"mediaPresentationDuration",js),e.l.Mb=r);var s=0;e.i&&e.i.presentationTimeline&&e.Z&&(s=e.i.presentationTimeline.Yb());var a=[],o=s;i=Cs(i,"Period");for(var l=0;l<i.length;l++){var u=i[l],c=i[l+1],d=Os(u,"start",js,o),h=u.attributes.id,f=Os(u,"duration",js),p=null;if(c){var g=Os(c,"start",js);null!=g&&(p=g-d)}else null!=r&&(p=r-d+s);if(g=On,p&&f&&Math.abs(p-f)>g&&p>f&&e.K++,null==p&&(p=f),!(null!==e.L&&null!==h&&null!==d&&d<e.L)||e.fa.includes(h)||l+1==i.length){if(null!==d&&(null===e.L||d>e.L)&&(e.L=d),o=My(e,t,n,{start:d,duration:p,node:u,Dd:null==p||!c}),a.push(o),t.va.id&&p&&(e.aa[t.va.id]=p),null==p){o=null;break}o=d+p}}return e.fa=a.map(function(e){return e.id}),null!=r?{periods:a,duration:r+s,Fg:!1}:{periods:a,duration:o,Fg:!0}}function My(e,t,n,i){t.va=By(e,i.node,null,n),t.ja=i,t.va.Ia=t.Ia,t.va.id||(t.va.id="__shaka_period_"+i.start);var r=Cs(i.node,"EventStream");n=t.presentationTimeline.nb(),r=c(r);for(var s=r.next();!s.done;s=r.next())zy(e,i.start,i.duration,s.value,n);if(n=Cs(i.node,"AdaptationSet").map(function(n){return Py(e,t,n)}).filter(oi),t.xb){for(i=[],r=c(n),s=r.next();!s.done;s=r.next()){s=c(s.value.Ti);for(var a=s.next();!a.done;a=s.next())i.push(a.value)}if(i.length!=new Set(i).size)throw new It(2,4,4018)}for(i=n.filter(function(e){return!e.mg}),n=n.filter(function(e){return e.mg}),n=c(n),r=n.next();!r.done;r=n.next()){r=r.value,s=r.mg.split(" "),a=c(i);for(var o=a.next();!o.done;o=a.next()){var l=o.value;if(s.includes(l.id)){o={},l=c(l.streams);for(var u=l.next();!u.done;o={Zd:o.Zd},u=l.next())o.Zd=u.value,o.Zd.trickModeVideo=r.streams.find(function(e){return function(t){return $n(e.Zd.codecs)==$n(t.codecs)}}(o))}}}if(n=Ly(e.g.disableAudio,i,"audio"),r=Ly(e.g.disableVideo,i,"video"),s=Ly(e.g.disableText,i,Ln),i=Ly(e.g.disableThumbnails,i,"image"),0===r.length&&0===n.length)throw new It(2,4,4004);return{id:t.va.id,audioStreams:n,videoStreams:r,textStreams:s,imageStreams:i}}function Ly(e,t,n){return e||!t.length?[]:t.reduce(function(e,t){return t.contentType!=n?e:(e.push.apply(e,d(t.streams)),e)},[])}function Py(e,t,n){function i(e){switch(e){case 1:case 5:case 6:case 7:return"srgb";case 9:return"rec2020";case 11:case 12:return"p3"}}function r(e){switch(e){case 1:case 6:case 13:case 14:case 15:return"SDR";case 16:return"PQ";case 18:return"HLG"}}t.la=By(e,n,t.va,null);var s,a,o=!1,l=Cs(n,"Role"),u=l.map(function(e){return e.attributes.value}).filter(oi),h=void 0,f=t.la.contentType==Ln;f&&(h="subtitle"),l=c(l);for(var p=l.next();!p.done;p=l.next()){p=p.value;var g=p.attributes.schemeIdUri;if(null==g||"urn:mpeg:dash:role:2011"==g)switch(p=p.attributes.value,p){case"main":o=!0;break;case"caption":case"subtitle":h=p}}g=Cs(n,"EssentialProperty"),l=null;var m=!1;p=!1,g=c(g);for(var v=g.next();!v.done;v=g.next()){v=v.value;var y=v.attributes.schemeIdUri;"http://dashif.org/guidelines/trickmode"==y?l=v.attributes.value:"urn:mpeg:mpegB:cicp:TransferCharacteristics"==y?s=r(parseInt(v.attributes.value,10)):"urn:mpeg:mpegB:cicp:ColourPrimaries"==y?a=i(parseInt(v.attributes.value,10)):"urn:mpeg:mpegB:cicp:MatrixCoefficients"!=y&&("urn:mpeg:dash:ssr:2023"==y&&e.g.dash.enableFastSwitching?m=!0:p=!0)}var b=null;for(g=Cs(n,"SupplementalProperty"),g=c(g),v=g.next();!v.done;v=g.next())v=v.value,y=v.attributes.schemeIdUri,"http://dashif.org/guidelines/last-segment-number"==y?b=parseInt(v.attributes.value,10)-1:"urn:mpeg:mpegB:cicp:TransferCharacteristics"==y?s=r(parseInt(v.attributes.value,10)):"urn:mpeg:mpegB:cicp:ColourPrimaries"==y&&(a=i(parseInt(v.attributes.value,10)));g=Cs(n,"Accessibility");var _,T=new Map;for(g=c(g),v=g.next();!v.done;v=g.next())if(y=v.value,v=y.attributes.schemeIdUri,y=y.attributes.value,"urn:scte:dash:cc:cea-608:2015"!=v||e.g.disableText)if("urn:scte:dash:cc:cea-708:2015"!=v||e.g.disableText)"urn:mpeg:dash:role:2011"==v?null!=y&&(u.push(y),"captions"==y&&(h="caption")):"urn:tva:metadata:cs:AudioPurposeCS:2007"==v&&("1"==y?_="visually impaired":"2"==y&&(_="hard of hearing"));else if(v=1,null!=y)for(y=c(y.split(";")),E=y.next();!E.done;E=y.next()){E=E.value;var S=void 0,w=void 0;E.includes("=")?(E=E.split("="),S="svc"+E[0],w=E[1].split(",")[0].split(":").pop()):(S="svc"+v,v++,w=E),T.set(S,hi(w))}else T.set("svc1","und");else if(v=1,null!=y){y=y.split(";"),S=c(y);for(var E=S.next();!E.done;E=S.next()){w=E.value;var x=E=void 0;w.includes("=")?(w=w.split("="),E=w[0].startsWith("CC")?w[0]:"CC"+w[0],x=w[1]||"und"):(E="CC"+v,2==y.length?v+=2:v++,x=w),T.set(E,hi(x))}}else T.set("CC1","und");if(p)return null;p=Cs(n,"ContentProtection");var k=Mm(p,e.g.dash.ignoreDrmInfo,e.g.dash.keySystemsByURI),A=hi(t.la.language||"und"),I=t.la.label;if(p=Cs(n,"Representation"),n=p.map(function(n){return(n=Oy(e,t,k,h,A,I,o,u,T,n,_,b))&&(n.hdr=n.hdr||s,n.colorGamut=n.colorGamut||a,n.fastSwitching=m),n}).filter(function(e){return!!e}),0==n.length){if(l="image"==t.la.contentType,e.g.dash.ignoreEmptyAdaptationSet||f||l)return null;throw new It(2,4,4003)}if(!t.la.contentType||"application"==t.la.contentType)for(t.la.contentType=Wy(n[0].mimeType,n[0].codecs),f=c(n),v=f.next();!v.done;v=f.next())v.value.type=t.la.contentType;for(f=t.la.id||"__fake__"+e.ea++,g=c(n),v=g.next();!v.done;v=g.next()){for(v=v.value,y=c(k.drmInfos),S=y.next();!S.done;S=y.next())S=S.value,S.keyIds=S.keyIds&&v.keyIds?new Set([].concat(d(S.keyIds),d(v.keyIds))):S.keyIds||v.keyIds;e.g.dash.enableAudioGroups&&(v.groupId=f)}return p=p.map(function(e){return e.attributes.id}).filter(oi),{id:f,contentType:t.la.contentType,language:A,lk:o,streams:n,drmInfos:k.drmInfos,mg:l,Ti:p}}function Oy(t,n,i,r,s,a,o,l,u,c,d,h){n.J=By(t,c,n.la,null);var f=n.J.id;if(t.R=Math.min(t.R,n.J.Ia),t.U=0<t.R,!Hy(n.J))return null;var p=n.ja.start;n.bandwidth=Os(c,"bandwidth",$s)||0,n.roles=l;var g,m,v=n.J.contentType,y=v==Ln||"application"==v;v="image"==v;try{var b=void 0;if(i.bf){var _=n.J.Ga,T=An(_(),[i.bf.Ai]),E=zr(T,t.g.retryParameters);b={bitsKey:128,blockCipherMode:"CBC",iv:i.bf.iv,firstMediaSequenceNumber:0,fetchKey:function(){var n,i,r;return N(function(s){if(1==s.g)return S(s,Ky(t,E,6),2);if(3!=s.g){if(n=s.h,!n.data||16!=n.data.byteLength)throw new It(2,4,4049);return i={name:"AES-CBC"},r=b,S(s,e.crypto.subtle.importKey("raw",n.data,i,!0,["decrypt"]),3)}r.cryptoKey=s.h,b.fetchKey=void 0,w(s)})}}}if(n.J.aesKey=b,_=function(e,n,i,r){return qy(t,e,n,i,r)},n.J.Tc)var x=ov(n,_,b);else if(n.J.Rb)x=pv(n,t.s,b);else if(n.J.cc)x=bv(n,_,t.s,!!t.i,t.g.dash.initialSegmentLimit,t.aa,b,h,!1);else{var k=n.ja.duration||0,A=n.J.Ga,I=n.J.mimeType,C=n.J.codecs;x={mc:function(){var e=nu(p,k,A());return e.Jb(function(e){e.mimeType=I,e.codecs=C}),Promise.resolve(e)}}}}catch(e){if((y||v)&&4002==e.code)return null;throw e}if(h=Cs(c,"ContentProtection"),h=Lm(h,i,t.g.dash.ignoreDrmInfo,t.g.dash.keySystemsByURI),h=new Set(h?[h]:[]),_=!1,Cs(c,"SupplementalProperty").some(function(e){return"tag:dolby.com,2018:dash:EC3_ExtensionType:2018"==e.attributes.schemeIdUri&&"JOC"==e.attributes.value})&&(_=!0),T=!1,y&&(T=l.includes("forced_subtitle")||l.includes("forced-subtitle")),v&&((c=Cs(c,"EssentialProperty").find(function(e){return["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"].includes(e.attributes.schemeIdUri)}))&&(g=c.attributes.value),!g))return null;c=n.J.codecs,n.profiles.includes("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10")&&(c.includes("hvc1.2.4.L153.B0")||c.includes("hev1.2.4.L153.B0"))&&(m="PQ"),y=n.J.id?n.va.id+","+n.J.id:"",t.B.length&&f&&t.o.set(n.va.id+","+f,Ny(n));var D=y&&t.s[y]?t.s[y]:{id:t.ea++,originalId:n.J.id,groupId:null,createSegmentIndex:function(){return Promise.resolve()},closeSegmentIndex:function(){D.segmentIndex&&(D.segmentIndex.release(),D.segmentIndex=null)},segmentIndex:null,mimeType:n.J.mimeType,codecs:c,frameRate:n.J.frameRate,pixelAspectRatio:n.J.pixelAspectRatio,bandwidth:n.bandwidth,width:n.J.width,height:n.J.height,kind:r,encrypted:0<i.drmInfos.length,drmInfos:i.drmInfos,keyIds:h,language:s,originalLanguage:n.la.language,label:a,type:n.la.contentType,primary:o,trickModeVideo:null,emsgSchemeIdUris:n.J.emsgSchemeIdUris,roles:l,forced:T,channelsCount:n.J.Nc,audioSamplingRate:n.J.audioSamplingRate,spatialAudio:_,closedCaptions:u,hdr:m,colorGamut:void 0,videoLayout:void 0,tilesLayout:g,accessibilityPurpose:d,external:!1,fastSwitching:!1,fullMimeTypes:new Set([Fn(n.J.mimeType,n.J.codecs)])};return D.createSegmentIndex=function(){var e;return N(function(t){if(1==t.g)return D.segmentIndex?t.u(0):(e=D,S(t,x.mc(),3));e.segmentIndex=t.h,w(t)})},y&&n.xb&&!t.s[y]&&(t.s[y]=D),D}function Ny(e){for(var t={},n=c(Object.keys(e)),i=n.next();!i.done;i=n.next())if(i=i.value,["period","adaptationSet","representation"].includes(i)){var r=e[i];t[i]={Tc:null,Rb:null,cc:r.cc,Ga:r.Ga,width:r.width,height:r.height,contentType:r.contentType,mimeType:r.mimeType,language:r.language,codecs:r.codecs,frameRate:r.frameRate,pixelAspectRatio:r.pixelAspectRatio,emsgSchemeIdUris:r.emsgSchemeIdUris,id:r.id,Nc:r.Nc,audioSamplingRate:r.audioSamplingRate,Ia:r.Ia,Jc:r.Jc}}else"periodInfo"==i?(r=e[i],t[i]={start:r.start,duration:r.duration,node:null,Dd:r.Dd}):t[i]=e[i];return t}function Uy(e){var t,n;return N(function(i){switch(i.g){case 1:return t=0,E(i,2),S(i,Sy(e),4);case 4:t=i.h,k(i,3);break;case 2:if(n=A(i),e.j){if(e.g.raiseFatalErrorOnManifestUpdateRequestFailure)return e.j.onError(n),i.return();n.severity=1,e.j.onError(n)}case 3:if(!e.j)return i.return();e.j.onManifestUpdated(),Fy(e,t),w(i)}})}function Fy(e,t){if(!(0>e.H)){var n=e.H;0<=e.g.dash.updatePeriod&&(n=e.g.dash.updatePeriod),e.I.Y(Math.max(n-t,K(e.da)))}}function By(e,t,n,i){n=n||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,pixelAspectRatio:void 0,Nc:null,audioSamplingRate:null,Ia:0,ag:0},i=i||n.Ga;var r,s=t.attributes.id,a=Cs(t,"BaseURL"),o=!1;if(e.h)for(var l=c(a),u=l.next();!u.done;u=l.next()){var d=u.value;u=d.attributes.serviceLocation,d=Rs(d),u&&d&&(Pv(e.h,s,u,d),o=!0)}o&&e.h||(r=a.map(Rs)),l=t.attributes.contentType||n.contentType,u=t.attributes.mimeType||n.mimeType,d=[t.attributes.codecs||n.codecs];var h=Ns(t,"urn:scte:dash:scte214-extensions","supplementalCodecs");h&&d.push(h),d=Nu(d).join(","),h=Os(t,"frameRate",Ws)||n.frameRate;var f=t.attributes.sar||n.pixelAspectRatio,p=jy(Cs(t,"InbandEventStream"),n.emsgSchemeIdUris),g=Cs(t,"AudioChannelConfiguration");g=Vy(g)||n.Nc;var m=Os(t,"audioSamplingRate",Gs)||n.audioSamplingRate;l||(l=Wy(u,d));var v=Ls(t,"SegmentBase"),y=Ls(t,"SegmentTemplate"),b=v&&Os(v,"availabilityTimeOffset",zs)||0,_=y&&Os(y,"availabilityTimeOffset",zs)||0,T=a&&a.length&&Os(a[0],"availabilityTimeOffset",zs)||0;b=n.Ia+T+b+_,_=null,(T=Ls(t,"SegmentSequenceProperties"))&&(T=Ls(T,"SAP"))&&(_=Os(T,"cadence",Hs)),T=t.attributes.label;var S=Cs(t,"Label");return S&&S.length&&(S=S[0],Ds(S)&&(T=Ds(S))),{Ga:function(){return An(i(),a.length?e.h&&o?Ov(e.h,s):r||[]:[])},Tc:v||n.Tc,Rb:Ls(t,"SegmentList")||n.Rb,cc:y||n.cc,width:Os(t,"width",Gs)||n.width,height:Os(t,"height",Gs)||n.height,contentType:l,mimeType:u,codecs:d,frameRate:h,pixelAspectRatio:f,emsgSchemeIdUris:p,id:s,language:t.attributes.lang,Nc:g,audioSamplingRate:m,Ia:b,Jc:null,ag:_||n.ag,label:T||null}}function jy(e,t){t=t.slice(),e=c(e);for(var n=e.next();!n.done;n=e.next())n=n.value.attributes.schemeIdUri,t.includes(n)||t.push(n);return t}function Vy(e){e=c(e);for(var t=e.next();!t.done;t=e.next()){var n=t.value;if((t=n.attributes.schemeIdUri)&&(n=n.attributes.value))switch(t){case"urn:mpeg:dash:outputChannelPositionList:2012":return n.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":if(t=parseInt(n,10),!t)continue;return t;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(t=parseInt(n,16),!t)continue;for(e=0;t;)1&t&&++e,t>>=1;return e;case"urn:mpeg:mpegB:cicp:ChannelConfiguration":if(t=[0,1,2,3,4,5,6,8,2,3,4,7,8,24,8,12,10,12,14,12,14],(n=parseInt(n,10))&&0<n&&n<t.length)return t[n]}}return null}function Hy(e){var t=e.Tc?1:0;return t+=e.Rb?1:0,t+=e.cc?1:0,0==t?e.contentType==Ln||"application"==e.contentType:(1!=t&&(e.Tc&&(e.Rb=null),e.cc=null),!0)}function $y(e,t,n,i){var r,s,a,o,l,u,c;return N(function(d){if(1==d.g)return r=[yn(n)],s=An(t(),r),a=zr(s,e.g.retryParameters),a.method=i,o=e.j.networkingEngine.request(4,a),Vr(e.N,o),S(d,o.promise,2);if(l=d.h,"HEAD"==i){if(!l.headers||!l.headers.date)return d.return(0);u=l.headers.date}else u=hn(l.data);return c=Date.parse(u),isNaN(c)?d.return(0):d.return(c-Date.now())})}function Gy(e,t,n){var i,r,s,a,o,l,u,d;return N(function(h){switch(h.g){case 1:i=n.map(function(e){return{scheme:e.attributes.schemeIdUri,value:e.attributes.value}}),r=e.g.dash.clockSyncUri,!i.length&&r&&i.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:r}),s=c(i),a=s.next();case 2:if(a.done){h.u(4);break}switch(o=a.value,E(h,5),l=o.scheme,u=o.value,l){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return h.u(7);case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return h.u(8);case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return d=Date.parse(u),h.return(isNaN(d)?0:d-Date.now());case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":Z("NTP UTCTiming scheme is not supported");break;default:Z("Unrecognized scheme in UTCTiming element",l)}h.u(9);break;case 7:return S(h,$y(e,t,u,"HEAD"),10);case 10:return h.return(h.h);case 8:return S(h,$y(e,t,u,"GET"),11);case 11:return h.return(h.h);case 9:k(h,3);break;case 5:A(h);case 3:a=s.next(),h.u(2);break;case 4:return Z("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),h.return(0)}})}function zy(e,t,n,i,r){var s=i.attributes.schemeIdUri||"",a=i.attributes.value||"",o=Os(i,"timescale",Gs)||1;i=c(Cs(i,"Event"));for(var l=i.next();!l.done;l=i.next()){l=l.value;var u=Os(l,"presentationTime",Gs)||0,d=Os(l,"duration",Gs)||0;u=u/o+t,d=u+d/o,null!=n&&(u=Math.min(u,t+n),d=Math.min(d,t+n)),d<r||(l={schemeIdUri:s,value:a,startTime:u,endTime:d,id:l.attributes.id||"",eventElement:Qs(l),eventNode:l},e.j.onTimelineRegionAdded(l))}}function qy(e,t,n,i,r){var s,a,o,l;return N(function(u){return 1==u.g?(s=Zr,a=r?0:1,o=ju(t,n,i,e.g.retryParameters),S(u,Ky(e,o,s,{type:a}),2)):(l=u.h,u.return(l.data))})}function Wy(e,t){return t=Fn(e,t),Zn(t)?Ln:e.split("/")[0]}function Ky(e,t,n,i){return t=e.j.networkingEngine.request(n,t,i),Vr(e.N,t),t.promise}function Yy(e){var t=e.l.Ld;if(!e.l.we||!t||!e.B.length)return[];var n=Date.now()/1e3,i=e.B.filter(function(e){return e=Gs(e.attributes.ttl),!e||t+e>n}).map(Rs).filter(oi);return i.length?An(e.A,i):[]}function Xy(){}i=Ty.prototype,i.configure=function(e){var t=this.j&&e.dash.updatePeriod!=this.g.dash.updatePeriod&&0<=e.dash.updatePeriod;this.g=e,t&&this.i&&this.i.presentationTimeline.V()&&this.I.xc(),this.h&&this.h.configure(this.g),this.m&&(this.m.ih(this.g.dash.multiTypeVariantsAllowed&&de()),this.m.ph(this.g.dash.useStreamOnceInPeriodFlattening))},i.start=function(e,t){var n,i=this;return N(function(r){if(1==r.g)return i.F=t.isLowLatencyMode(),i.A=[e],i.j=t,S(r,Sy(i),2);if(n=r.h,i.j&&Fy(i,n),!i.j)throw new It(2,7,7001);return r.return(i.i)})},i.stop=function(){for(var e=c(Object.values(this.s)),t=e.next();!t.done;t=e.next())t=t.value,t.segmentIndex&&t.segmentIndex.release();return this.m&&this.m.release(),this.g=this.j=null,this.A=[],this.i=null,this.s={},this.o.clear(),this.l={we:"",type:"",profiles:[],Mb:null,Ia:0,Ga:null,Ld:0},this.m=null,null!=this.I&&(this.I.stop(),this.I=null),this.h&&this.h.destroy(),this.C&&(this.C.release(),this.C=null),this.N.destroy()},i.update=function(){var e,t=this;return N(function(n){return 1==n.g?(E(n,2),S(n,Sy(t),4)):2!=n.g?k(n,0):(e=A(n),t.j&&e?(t.j.onError(e),void w(n)):n.return())})},i.onExpirationUpdated=function(){},i.onInitialVariantChosen=function(e){if(this.i&&this.i.presentationTimeline.V()){var t=e.video||e.audio;if(t&&t.segmentIndex){e=this.i.presentationTimeline.Zb();var n=t.segmentIndex.find(e);null!=n&&(t=t.segmentIndex.get(n))&&(this.H=t.endTime-e,Fy(this,0))}}},i.banLocation=function(e){this.h&&this.h.banLocation(e)},i.setMediaElement=function(e){this.G=e},G("shaka.dash.DashParser",Ty),Ga["application/dash+xml"]=function(){return new Ty},Ga["video/vnd.mpeg.dash.mpd"]=function(){return new Ty},G("shaka.dependencies",Xy),Xy.has=function(e){return Jy.has(e)},Xy.add=function(e,t){if(!Zy[e])throw Error(e+" is not supported");e==Qy?pe("mux.js","mux.js is no longer used in Shaka Player."):Jy.set(e,function(){return t})};var Qy="muxjs",Zy={mk:Qy,ISOBoxer:"ISOBoxer"};Xy.Allowed=Zy;var Jy=new Map([["ISOBoxer",function(){return e.ISOBoxer}]]);function eb(e,t,n){this.type=e,this.g=t,this.segments=n||null}function tb(e,t,n,i){this.id=e,this.name=t,this.attributes=n,this.value=void 0===i?null:i}function nb(e){var t=(new Set).add("AUDIO").add("VIDEO").add("SUBTITLES").add("PATHWAY-ID").add("GROUP-ID").add("URI");return e.toString(t)}function ib(e,t){return e=e.attributes.filter(function(e){return e.name==t}),e.length?e[0]:null}function rb(e,t,n){return(e=ib(e,t))?e.value:n||null}function sb(e,t){if(e=ib(e,t),!e)throw new It(2,4,4023,t);return e.value}function ab(e,t,n){n=void 0===n?[]:n,this.g=t,this.h=e,this.Bb=n}function ob(e,t){this.name=e,this.value=t}function lb(e,t){return e.filter(function(e){return e.name==t})}function ub(e,t){return e.filter(function(e){return sb(e,"TYPE")==t})}function cb(e,t){e=c(e);for(var n=e.next();!n.done;n=e.next())if(n=n.value,n.name===t)return n;return null}function db(e,t,n){return n=void 0===n?0:n,(e=cb(e,t))?Number(e.value):n}function hb(e,t,n){return t?fb(e,[t],n):[]}function fb(e,t,n){if(!t.length)return[];t=An(e,t),e=[],t=c(t);for(var i=t.next();!i.done;i=t.next())e.push(pb(i.value,n));return e}function pb(e,t){if(!t||!t.size)return e;e=String(e).replace(/%7B/g,"{").replace(/%7D/g,"}");var n=e.match(/{\$\w*}/g);if(n){n=c(n);for(var i=n.next();!i.done;i=n.next()){i=i.value;var r=i.slice(2,i.length-1),s=t.get(r);if(!s)throw new It(2,4,4039,r);e=e.replace(i,s)}}return e}function gb(){this.g=0}function mb(e,t){t=hn(t),t=t.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim();var n=t.split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(n[0]))throw new It(2,4,4015);t=0;for(var i=!0,r=c(n),s=r.next();!s.done;s=r.next())if(s=s.value,/^#(?!EXT)/m.test(s)||i)i=!1;else{if(s=vb(e,s),--e.g,yb.includes(s.name)){t=1;break}"EXT-X-STREAM-INF"==s.name&&(i=!0)}for(r=[],i=!0,s=0;s<n.length;s++){var a=n[s],o=n[s+1];if(/^#(?!EXT)/m.test(a)||i)i=!1;else{if(a=vb(e,a),bb.includes(a.name)){if(1!=t)throw new It(2,4,4017);a=n.splice(s,n.length-s),n=[],i=[],s=[],o=null,a=c(a);for(var l=a.next();!l.done;l=a.next())l=l.value,/^(#EXT)/.test(l)?(l=vb(e,l),yb.includes(l.name)?r.push(l):"EXT-X-MAP"==l.name?o=l:"EXT-X-PART"==l.name?s.push(l):"EXT-X-PRELOAD-HINT"==l.name?"PART"==rb(l,"TYPE")?s.push(l):"MAP"==rb(l,"TYPE")&&(l.name="EXT-X-MAP",o=l):i.push(l)):/^#(?!EXT)/m.test(l)||(l=l.trim(),o&&i.push(o),n.push(new ab(l,i,s)),i=[],s=[]);return s.length&&(o&&i.push(o),n.push(new ab("",i,s))),new eb(t,r,n)}r.push(a),"EXT-X-STREAM-INF"==a.name&&(a.attributes.push(new ob("URI",o)),i=!0)}}return new eb(t,r)}function vb(e,t){e=e.g++;var n=t.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!n)throw new It(2,4,4016,t);t=n[1];var i,r=n[2];if(n=[],r){var s;r=new jf(r),(s=Hf(r,/^([^,=]+)(?:,|$)/g))&&(i=s[1]);for(var a=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;s=Hf(r,a);)n.push(new ob(s[1],s[2]||s[3])),Vf(r)}return new tb(e,t,n,i)}tb.prototype.toString=function(e){function t(e){return e.name+"="+(isNaN(Number(e.value))?'"'+e.value+'"':e.value)}var n="#"+this.name,i=this.attributes?this.attributes.filter(function(t){return!e||!e.has(t.name)}).map(t):[];return this.value&&i.unshift(this.value),0<i.length&&(n+=":"+i.join(",")),n};var yb="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP EXT-X-PART-INF EXT-X-DATERANGE".split(" "),bb="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP EXT-X-GAP".split(" ");function _b(){}function Tb(e){try{var t=Sb(e);return Mr({uri:e,originalUri:e,data:t.data,headers:{"content-type":t.contentType}})}catch(e){return Dr(e)}}function Sb(t){var n=t.split(":");if(2>n.length||"data"!=n[0])throw new It(2,1,1004,t);if(n=n.slice(1).join(":").split(","),2>n.length)throw new It(2,1,1004,t);var i=n[0];t=e.decodeURIComponent(n.slice(1).join(",")),n=i.split(";"),i=n[0];var r,s=!1;return 1<n.length&&"base64"==n[n.length-1]&&(s=!0,n.pop()),r=s?wn(t):gn(t),{data:r,contentType:i}}function wb(){var e=this;this.g=this.h=null,this.B=1,this.s=new Map,this.G=new Map,this.N=new Map,this.N.set("video",new Map),this.N.set("audio",new Map),this.N.set(Ln,new Map),this.N.set("image",new Map),this.wb=new Set,this.i=new Map,this.j=null,this.L="",this.Fa=new gb,this.H=-1,this.fa=1/0,this.ea=this.Ib=!1,this.A=new Ut(function(){e.aa&&!e.g.continueLoadingWhenPaused&&(e.Z.lb(e.aa,"timeupdate"),e.aa.paused)?e.Z.ha(e.aa,"timeupdate",function(){return w_(e)}):w_(e)}),this.xa=L_,this.m=null,this.bb=0,this.o=1/0,this.Da=this.za=this.U=0,this.da=new jr,this.C=new Map,this.F=new Map,this.ra=new Map,this.pa=new Map,this.K=new Map,this.qa=new Map,this.ya=new Map,this.Hb=this.I=!1,this.Fb=new W(5),this.l=null,this.R=!0,this.Ea=new Set,this.Z=new se,this.aa=null}function Eb(e,t){return E_(e)?e.N.get(t.type):t.te}function xb(e,t){var n,i,r,s,a,o,l,u,h,f,p,g,m,v,y,b,_,T,x,I,C,D,R,M,L,P,O,U,F,B,j,V,H,$;return N(function(N){switch(N.g){case 1:for(n=[],i=c(t.M()),r=i.next();!r.done;r=i.next())s=r.value,a=new ht(s),o=a.g,t.ce&&(0<=t.pb&&o.add("_HLS_msn",String(t.pb)),0<=t.qb&&o.add("_HLS_part",String(t.qb))),t.de&&o.add("_HLS_skip","YES"),At(o)&&mt(a,o),n.push(a.toString());return E(N,2),S(N,S_(e,n,!0),4);case 4:l=N.h,k(N,3);break;case 2:throw u=A(N),e.h&&e.h.disableStream(t.stream),u;case 3:if(!t.stream.segmentIndex)return N.return();if(h=mb(e.Fa,l.data),1!=h.type)throw new It(2,4,4017);return f=l.uri,f==l.originalUri||t.M().includes(f)||t.dh.push(f),p=lb(h.g,"EXT-X-DEFINE"),g=Lb(e,p,f),m=t.stream,v=Eb(e,t),S(N,o_(e,h,m.mimeType,t.M,g),5);case 5:for(y=N.h,b=y.keyIds,_=y.drmInfos,T=function(e,t){return e.size===t.size&&[].concat(d(e)).every(function(e){return t.has(e)})},T(m.keyIds,b)||(m.keyIds=b,m.drmInfos=_,e.h.newDrmInfo(m)),x=m_(e,h,v,g,t.M,t.type),I=x.segments,(C=x.bandwidth)&&(m.bandwidth=C),D=Lu(m),R=c(I),M=R.next();!M.done;M=R.next())L=M.value,L.$&&(L.$.Lc=D);m.segmentIndex.Id(I,e.j.nb()),I.length&&(P=db(h.g,"EXT-X-MEDIA-SEQUENCE",0),U=(O=cb(h.g,"EXT-X-SKIP"))?Number(rb(O,"SKIPPED-SEGMENTS")):0,F=s_(P,I),B=F.pb,j=F.qb,t.pb=B+U,t.qb=j,V=v.get(P),m.segmentIndex.Oa(V)),(H=m.segmentIndex.O[0]||null)&&(t.rc=H.startTime,$=I[I.length-1],t.Lb=$.endTime),cb(h.g,"EXT-X-ENDLIST")&&(t.xd=!0),u_(e,h),g_(e,h.g,m.type,g,t.M),w(N)}})}function kb(e,t){for(var n=-1==e.H,i=c(t),r=i.next();!r.done;r=i.next()){r=r.value;var s=r.stream.segmentIndex,a=Eb(e,r);if(s=s.O[0]||null){a=c(a);for(var o=a.next();!o.done;o=a.next()){o=c(o.value);var l=o.next().value;if(o.next().value==s.startTime){n&&(e.H=Math.max(e.H,l)),r.mf=l;break}}}}if(!(0>e.H))for(t=c(t),r=t.next();!r.done;r=t.next())n=r.value,n_(e,n.type)&&(i=n.stream.segmentIndex)&&(r=e.H-n.mf,0<r&&(i.O.splice(0,r),i=i.O[0]||null)&&(i=-i.startTime,n.stream.segmentIndex.offset(i),Ib(e,n,i)))}function Ab(e,t){if(1/0==e.fa){t=c(t);for(var n=t.next();!n.done;n=t.next()){var i=n.value.stream.segmentIndex.O[0]||null;null!=i&&null!=i.h&&(e.fa=Math.min(e.fa,i.h))}}if(t=e.fa,1/0!=t)for(i=c(e.i.values()),n=i.next();!n.done;n=i.next())if(n=n.value,!n_(e,n.type)){var r=n.stream.segmentIndex;if(null!=r){var s=r.O[0]||null;if(null==s.h)Q("Missing EXT-X-PROGRAM-DATE-TIME for stream",n.M(),"Expect AV sync issues!");else for(Ib(e,n,s.h-t-s.startTime),n=c(r),r=n.next();!r.done;r=n.next())r.value.jg(t)}}}function Ib(e,t,n){t.rc+=n,t.Lb+=n,e=Eb(e,t);for(var i=c(e),r=i.next();!r.done;r=i.next()){var s=c(r.value);r=s.next().value,s=s.next().value,e.set(r,s+n)}t.M()}function Cb(e,t,n){var i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,w,E,x,k,A,I,C,D,R,M,L,P,O,U;return N(function(N){switch(N.g){case 1:return i=Pn,r=mb(e.Fa,t),s=lb(r.g,"EXT-X-DEFINE"),a=[],o=[],l=[],e.j=new Ll(null,0),e.j.wc(!0),u=function(){return[n]},d=null,h=new Map,1==r.type?(e.R=!1,_=lb(r.g,"EXT-X-DEFINE"),h=Lb(e,_,e.L),d=i.ga,T="",w=new Map,S(N,r_(e,e.B++,h,r,u,"",d,T,!0,"Media Playlist",null,w,null,!1,null,!1),7)):(Mb(e,s),f=lb(r.g,"EXT-X-MEDIA"),p=lb(r.g,"EXT-X-STREAM-INF"),g=lb(r.g,"EXT-X-IMAGE-STREAM-INF"),m=lb(r.g,"EXT-X-I-FRAME-STREAM-INF"),v=lb(r.g,"EXT-X-SESSION-KEY"),y=lb(r.g,"EXT-X-SESSION-DATA"),b=lb(r.g,"EXT-X-CONTENT-STEERING"),Ob(e,y),S(N,Nb(e,b),4));case 4:return Pb(e,p),Kb(e,f),S(N,Vb(e,p,v,f,u,e.s),5);case 5:return a=N.h,o=Ub(e,f),S(N,Bb(e,g,m),6);case 6:l=N.h,N.u(3);break;case 7:E=N.h,e.i.set(n,E),E.stream&&(x=Lu(E.stream),E.stream.segmentIndex.Jb(function(e){e.$&&(e.$.Lc=x)})),d=E.stream.type,a.push({id:0,language:hi(T||"und"),disabledUntilTime:0,primary:!0,audio:"audio"==d?E.stream:null,video:"video"==d?E.stream:null,bandwidth:E.stream.bandwidth||0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});case 3:if(!e.h)throw new It(2,7,7001);if(1==r.type&&(E_(e)&&(c_(e,r),k=e.o,e.A.Y(k)),A=Array.from(e.i.values()),t_(e,A),Rb(e),g_(e,r.g,d,h,u)),e.m={presentationTimeline:e.j,variants:a,textStreams:o,imageStreams:l,offlineSessionIds:[],minBufferTime:0,sequenceMode:e.g.hls.sequenceMode,ignoreManifestTimestampsInSegmentsMode:e.g.hls.ignoreManifestTimestampsInSegmentsMode,type:"HLS",serviceDescription:null,nextUrl:null,periodCount:1,gapCount:0,isLowLatency:!1},e.ea||!e.g.hls.disableCodecGuessing){N.u(8);break}for(I=[],C=c(e.m.variants),D=C.next();!D.done;D=C.next())R=D.value,R.audio&&""===R.audio.codecs&&I.push(R.audio.createSegmentIndex()),R.video&&""===R.video.codecs&&I.push(R.video.createSegmentIndex());return S(N,Promise.all(I),8);case 8:if(e.h.makeTextStreamsForClosedCaptions(e.m),1==a.length){for(M=[],L=a[0],P=c([L.video,L.audio]),O=P.next();!O.done;O=P.next())(U=O.value)&&!U.segmentIndex&&M.push(U.createSegmentIndex());if(0<M.length)return S(N,Promise.all(M),0)}N.u(0)}})}function Db(e,t){var n,i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,w,E,x,k;return N(function(A){switch(A.g){case 1:if(n=Pu(e.g.hls.mediaPlaylistFullMimeType),!t.length)return A.return(n);if(i=b_(e,t),r=i.segment,s=i.segmentIndex,a=r.M(),o=a[0],l=new ht(o),u=l.Pa.split(".").pop(),d=C_[u])return A.return(Pu(d));if(h=Zr,p=f=null,g=r.$,!g){A.u(2);break}return m=ju(g.M(),g.$b(),g.Xb(),e.g.retryParameters),S(A,k_(e,m,h,{type:0}),3);case 3:if(v=A.h,f=v.data,!g.aesKey){A.u(4);break}return S(A,Bu(f,g.aesKey,0),5);case 5:f=A.h;case 4:(p=v.headers["content-type"])&&(p=p.split(";")[0].toLowerCase());case 2:return y=ju(r.M(),r.$b(),r.Xb(),e.g.retryParameters),S(A,k_(e,y,h,{type:1}),6);case 6:if(b=A.h,_=b.data,!r.aesKey){A.u(7);break}return S(A,Bu(_,r.aesKey,s),8);case 8:_=A.h;case 7:if((T=b.headers["content-type"])&&(T=T.split(";")[0].toLowerCase()),w="mp4 mp4a m4s m4i m4a m4f cmfa mp4v m4v cmfv fmp4".split(" "),E=["audio/mp4","video/mp4","video/iso.segment"],Vo(Ee(_))){var I=_,C=Ee(I);C=(new No).parse(C);var D=C.sd();C=C.Hf();var R=[],M=!1,L=!1;switch(D.audio){case"aac":case"aac-loas":R.push("mp4a.40.2"),M=!0;break;case"mp3":R.push("mp4a.40.34"),M=!0;break;case"ac3":R.push("ac-3"),M=!0;break;case"ec3":R.push("ec-3"),M=!0;break;case"opus":R.push("opus"),M=!0}switch(D.video){case"avc":C.Na?R.push(C.Na):R.push("avc1.42E01E"),L=!0;break;case"hvc":C.Na?R.push(C.Na):R.push("hvc1.1.6.L93.90"),L=!0;break;case"av1":R.push("av01.0.01M.08"),L=!0}if(R.length){if(D=M&&!L,M=new Map,L){L=new Ce("video/mp2t"),L.i(I),I=c(L.j());for(var P=I.next();!P.done;P=I.next())P=P.value,M.set(P,P);L.g()}C={type:D?"audio":"video",mimeType:"video/mp2t",codecs:R.join(", "),language:null,height:C.height,width:C.width,channelCount:null,sampleRate:null,closedCaptions:M,Qd:null,colorGamut:null}}else C=null;if(x=C)return A.return(x)}else if((w.includes(u)||E.includes(T)||p&&E.includes(p))&&(k=Ou(f,_)))return A.return(k);return T?A.return(Pu(T)):p?A.return(Pu(p)):A.return(n)}})}function Rb(e){if(E_(e)){if(e.xa==O_){for(var t,n=t=1/0,i=c(e.i.values()),r=i.next();!r.done;r=i.next())r=r.value,r.stream.segmentIndex&&"text"!=r.stream.type&&(t=Math.min(t,r.Lb),n=Math.min(n,r.rc));t-=n,e.g.hls.useSafariBehaviorForLive&&(t=e.j.A),isNaN(e.g.availabilityWindowOverride)||(t=e.g.availabilityWindowOverride),e.j.Ie(t)}}else e.j.$a(Jb(e));if(!e.j.s)for(t=c(e.i.values()),n=t.next();!n.done;n=t.next())n=n.value,!n.stream.segmentIndex||"audio"!=n.type&&"video"!=n.type||(n=n.stream.segmentIndex.get(0))&&n.h&&e.j.lh(n.h);e.j.re()}function Mb(e,t){var n=new ht(e.L).g;t=c(t);for(var i=t.next();!i.done;i=t.next()){var r=i.value;i=rb(r,"NAME");var s=rb(r,"VALUE");r=rb(r,"QUERYPARAM"),i&&s&&(e.s.has(i)||e.s.set(i,s)),r&&(i=n.get(r)[0])&&!e.s.has(i)&&e.s.set(r,i)}}function Lb(e,t,n){n=new ht(n).g;var i=new Map;t=c(t);for(var r=t.next();!r.done;r=t.next()){var s=r.value,a=rb(s,"NAME"),o=rb(s,"VALUE");r=rb(s,"QUERYPARAM"),s=rb(s,"IMPORT"),a&&o&&(i.has(a)||i.set(a,o)),r&&(a=n.get(r)[0])&&!i.has(a)&&i.set(r,a),s&&(r=e.s.get(s))&&i.set(s,r)}return i}function Pb(e,t){t=c(t);for(var n=t.next();!n.done;n=t.next()){var i=n.value,r=rb(i,"AUDIO");n=rb(i,"VIDEO");var s=rb(i,"SUBTITLES");if(i=$b(e,i),s){var a=Rn(Ln,i);e.F.set(s,a),Ne(i,a)}r&&(s=Rn("audio",i),s||(s=e.g.hls.defaultAudioCodec),e.F.set(r,s)),n&&(r=Rn("video",i),r||(r=e.g.hls.defaultVideoCodec),e.F.set(n,r))}}function Ob(e,t){t=c(t);for(var n=t.next();!n.done;n=t.next()){var i=n.value,r=rb(i,"DATA-ID");n=rb(i,"URI");var s=rb(i,"LANGUAGE");i=rb(i,"VALUE"),r=(new Map).set("id",r),n&&r.set("uri",hb([e.L],n,e.s)[0]),s&&r.set("language",s),i&&r.set("value",i),n=new Nr("sessiondata",r),e.h&&e.h.onEvent(n)}}function Nb(e,t){var n,i,r,s,a,o;return N(function(l){if(!e.h||!e.g)return l.return();for(i=c(t),r=i.next();!r.done;r=i.next())if(s=r.value,a=rb(s,"PATHWAY-ID"),o=rb(s,"SERVER-URI"),a&&o){e.l=new Dv(e.h),e.l.configure(e.g),e.l.i=[e.L],e.l.setManifestType("HLS"),e.l.h=a,n=Rv(e.l,o);break}return S(l,n,0)})}function Ub(e,t){var n=ub(t,"SUBTITLES");t=n.map(function(t){if(e.g.disableText)return null;try{return Yb(e,[t],new Map).stream}catch(t){if(e.g.hls.ignoreTextStreamFailures)return null;throw t}}),n=c(n);for(var i=n.next();!i.done;i=n.next()){var r=sb(i.value,"GROUP-ID");if((i=e.F.get(r))&&(r=e.G.get(r))){r=c(r);for(var s=r.next();!s.done;s=r.next())s=s.value,s.stream.codecs=i,s.stream.mimeType=v_(Ln,i)||y_(Ln),Fb(s.stream)}}return t.filter(function(e){return e})}function Fb(e){var t=new Set([Fn(e.mimeType,e.codecs)]);e.segmentIndex&&e.segmentIndex.Jb(function(n){n.mimeType&&t.add(Fn(n.mimeType,e.codecs))}),e.fullMimeTypes=t}function Bb(e,t,n){var i,r;return N(function(s){return 1==s.g?(i=t.map(function(t){var n,i;return N(function(r){if(1==r.g)return e.g.disableThumbnails?r.return(null):(E(r,2),S(r,Xb(e,t),4));if(2!=r.g)return n=r.h,r.return(n.stream);if(i=A(r),e.g.hls.ignoreImageStreamFailures)return r.return(null);throw i})}).concat(n.map(function(t){if(e.g.disableThumbnails)return null;try{var n=sb(t,"URI"),i=rb(t,"CODECS")||"";if(e.i.has(n))var r=e.i.get(n);else{var s=rb(t,"LANGUAGE"),a=rb(t,"NAME"),o=rb(t,"CHARACTERISTICS"),l=Zb(e,e.B++,[n],i,"image",s,!1,a,null,null,o,!1,null,!1),u=rb(t,"RESOLUTION"),d=c(u?u.split("x"):[null,null]),h=d.next().value,f=d.next().value;l.stream.width=Number(h)||void 0,l.stream.height=Number(f)||void 0;var p=rb(t,"BANDWIDTH");p&&(l.stream.bandwidth=Number(p)),e.i.set(n,l),r=l}return t=r,"mjpg"!==t.stream.codecs?null:t.stream}catch(t){if(e.g.hls.ignoreImageStreamFailures)return null;throw t}})),S(s,Promise.all(i),2)):(r=s.h,s.return(r.filter(function(e){return e})))})}function jb(e,t,n){t=t.filter(function(e){var t=rb(e,"URI")||"";return"SUBTITLES"!=rb(e,"TYPE")&&""!=t});var i={};t=c(t);for(var r=t.next();!r.done;r=t.next()){r=r.value;var s=nb(r);i[s]?i[s].push(r):i[s]=[r]}for(var a in i)Yb(e,i[a],n)}function Vb(e,t,n,i,r,s){var a,o,l,u,h,f,p,g,m,v,y,b,_,T,w,E,x,k,A,I,C,D,R,M,L,P,O,U,F,B,j,V,H,$,G;return N(function(N){switch(N.g){case 1:if(a=[],o=new Set,!(0<n.length)){N.u(2);break}l=c(n),u=l.next();case 3:if(u.done){N.u(2);break}if(h=u.value,f=sb(h,"METHOD"),p=rb(h,"KEYFORMAT")||"identity",g=null,"NONE"==f){N.u(4);break}if(A_(f)){m=hb(r(),sb(h,"URI"),s),v=m.sort().join(""),e.K.has(v)||(y=zr(m,e.g.retryParameters),b=k_(e,y,6),e.K.set(v,b)),N.u(4);break}if("identity"!=p){g=(_=M_[p])?_(h,""):null,N.u(6);break}return S(N,I_(e,h,"",r,null,s),9);case 9:g=N.h;case 6:if(g){if(g.keyIds)for(T=c(g.keyIds),w=T.next();!w.done;w=T.next())E=w.value,o.add(E);a.push(g)}case 4:u=l.next(),N.u(3);break;case 2:for(x={},k=c(t),A=k.next();!A.done;A=k.next())I=A.value,C=nb(I),x[C]?x[C].push(I):x[C]=[I];for(R in D=[],x)M=x[R],L=M[0],P=rb(L,"FRAME-RATE"),O=Number(rb(L,"AVERAGE-BANDWIDTH"))||Number(sb(L,"BANDWIDTH")),U=rb(L,"RESOLUTION"),F=c(U?U.split("x"):[null,null]),B=F.next().value,j=F.next().value,V=rb(L,"VIDEO-RANGE"),(H=rb(L,"REQ-VIDEO-LAYOUT"))&&H.includes(",")&&($=H.split(",").filter(function(e){return"CH-STEREO"==e||"CH-MONO"==e}),H=$[0]),H=H||"CH-MONO",G=Hb(e,M,i),D.push.apply(D,d(Wb(e,G.audio,G.video,O,B,j,P,V,H,a,o)));return N.return(D.filter(function(e){return null!=e}))}})}function Hb(e,t,n){for(var i={audio:[],video:[]},r=new Map,s=[],a=!1,o=!1,l=c(t),u=l.next();!u.done;u=l.next()){var h=u.value;u=rb(h,"AUDIO");var f=rb(h,"VIDEO"),p=u||f;p&&(s.includes(p)||s.push(p),(h=rb(h,"PATHWAY-ID"))&&r.set(p,h),u?a=!0:f&&(o=!0))}s.length&&n.length&&(l=n.filter(function(e){return s.includes(sb(e,"GROUP-ID"))}),jb(e,l,r)),l=(r=s.sort().join(","))&&e.G.has(r)?e.G.get(r):[],a?i.audio.push.apply(i.audio,d(l)):o&&i.video.push.apply(i.video,d(l)),u=!1;var g=t.map(function(e){return sb(e,"URI")});if(o=i.audio.find(function(e){return e&&e.M().find(function(e){return g.includes(e)})}),a=$b(e,t[0]),f=Rn("video",a),(p=Rn("audio",a))&&!f?(o="audio",u=0<i.audio.length):!i.audio.length&&!i.video.length&&p&&f?(o="video",a=[[f,p].join()]):i.audio.length&&o?(o="audio",u=!0):o=i.video.length&&!i.audio.length?"audio":"video",!u){var m=h=p=f=u=null;!l.length&&(n=n.find(function(e){var t=rb(e,"URI")||"",n=rb(e,"TYPE");return e=sb(e,"GROUP-ID"),"SUBTITLES"!=n&&""==t&&s.includes(e)}))&&(u=rb(n,"LANGUAGE"),f=rb(n,"NAME"),p=Gb(n),qb(n),h=rb(n,"CHARACTERISTICS"),m=zb(n)),e=Qb(e,t,a,o,u,f,p,h,m),r&&(e.stream.groupId=r),i[e.stream.type]=[e]}return i}function $b(e,t){var n=rb(t,"CODECS")||"";return t=rb(t,"SUPPLEMENTAL-CODECS"),e.ea=0<n.length,e.ea||e.g.hls.disableCodecGuessing||(n=[],e.g.disableVideo||n.push(e.g.hls.defaultVideoCodec),e.g.disableAudio||n.push(e.g.hls.defaultAudioCodec),n=n.join(",")),e=n.split(/\s*,\s*/),t&&(t=t.split(/\s*,\s*/).map(function(e){return e.split("/")[0]}),e.push.apply(e,d(t))),Nu(e)}function Gb(e){return(e=rb(e,"CHANNELS"))?parseInt(e.split("/")[0],10):null}function zb(e){return(e=rb(e,"SAMPLE-RATE"))?parseInt(e,10):null}function qb(e){return!!(e=rb(e,"CHANNELS"))&&e.includes("/JOC")}function Wb(e,t,n,i,r,s,a,o,l,u,d){for(var h=c(n),f=h.next();!f.done;f=h.next())T_(f.value.stream,r,s,a,o,l,null);for(r=e.g.disableAudio,t.length&&!r||(t=[null]),r=e.g.disableVideo,n.length&&!r||(n=[null]),r=[],t=c(t),s=t.next();!s.done;s=t.next())for(s=s.value,a=c(n),o=a.next();!o.done;o=a.next()){var p=o.value;(o=s?s.stream:null)&&(o.drmInfos=u,o.keyIds=d),(l=p?p.stream:null)&&(l.drmInfos=u,l.keyIds=d),l&&!o&&(l.bandwidth=i),!l&&o&&(o.bandwidth=i),h=s?s.stream.drmInfos:null,f=p?p.stream.drmInfos:null,p=p?p.M().sort().join(","):"";var g=s?s.M().sort().join(","):"";p=p+" - "+g,o&&l&&!Rt(h,f)||e.wb.has(p)||(o={id:e.B++,language:o?o.language:"und",disabledUntilTime:0,primary:!!o&&o.primary||!!l&&l.primary,audio:o,video:l,bandwidth:i,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},r.push(o),e.wb.add(p))}return r}function Kb(e,t){t=ub(t,"CLOSED-CAPTIONS"),e.R=0==t.length,t=c(t);for(var n=t.next();!n.done;n=t.next()){var i=n.value,r=rb(i,"LANGUAGE");n=hi(r||"und"),r||(r=rb(i,"NAME"))&&(n=r),r=sb(i,"GROUP-ID"),i=sb(i,"INSTREAM-ID").replace("SERVICE","svc"),e.C.get(r)||e.C.set(r,new Map),e.C.get(r).set(i,n)}}function Yb(e,t,n){for(var i=[],r=[],s=new Map,a=c(t),o=a.next();!o.done;o=a.next()){var l=o.value;o=sb(l,"URI"),l=sb(l,"GROUP-ID"),i.push(o),r.push(l),s.set(l,o)}if(a=r.sort().join(","),o=t[0],t="",l=sb(o,"TYPE").toLowerCase(),"subtitles"==l&&(l=Ln),l==Ln)t=rb(o,"CODECS")||"";else{r=c(r);for(var u=r.next();!u.done;u=r.next())if(u=u.value,e.F.has(u)){t=e.F.get(u);break}}if(r=i.sort().join(","),e.i.has(r))return e.i.get(r);if(u=e.B++,e.l){s=c(s);for(var d=s.next();!d.done;d=s.next()){var h=c(d.value);d=h.next().value,h=h.next().value,(d=n.get(d))&&Pv(e.l,u,d,h)}}n=rb(o,"LANGUAGE"),s=rb(o,"NAME"),d="YES"==rb(o,"DEFAULT"),h="audio"==l?Gb(o):null;var f="audio"==l&&qb(o),p=rb(o,"CHARACTERISTICS"),g="YES"==rb(o,"FORCED");return o="audio"==l?zb(o):null,i=Zb(e,u,i,t,l,n,d,s,h,null,p,g,o,f),i.stream&&(i.stream.groupId=a),e.G.has(a)?e.G.get(a).push(i):e.G.set(a,[i]),e.i.set(r,i),i}function Xb(e,t){var n,i,r,s,a,o,l,u,c,d;return N(function(h){return 1==h.g?(n=sb(t,"URI"),i=rb(t,"CODECS","jpeg")||"",e.i.has(n)?h.return(e.i.get(n)):(r=rb(t,"LANGUAGE"),s=rb(t,"NAME"),a=rb(t,"CHARACTERISTICS"),o=Zb(e,e.B++,[n],i,"image",r,!1,s,null,null,a,!1,null,!1),(l=rb(t,"RESOLUTION"))?S(h,o.stream.createSegmentIndex(),3):h.u(2))):(2!=h.g&&(u=o.stream.segmentIndex.get(0),c=u.tilesLayout)&&(o.stream.width=Number(l.split("x")[0])*Number(c.split("x")[0]),o.stream.height=Number(l.split("x")[1])*Number(c.split("x")[1])),(d=rb(t,"BANDWIDTH"))&&(o.stream.bandwidth=Number(d)),e.i.set(n,o),h.return(o))})}function Qb(e,t,n,i,r,s,a,o,l){for(var u=e.B++,d=[],h=c(t),f=h.next();!f.done;f=h.next()){var p=f.value;f=sb(p,"URI"),p=rb(p,"PATHWAY-ID"),e.l&&p&&Pv(e.l,u,p,f),d.push(f)}if(h=d.sort().join(","),e.i.has(h))return e.i.get(h);e:{if(t=rb(t[0],"CLOSED-CAPTIONS"),"video"==i){if(e.g.disableText){e.R=!1,t=null;break e}if(t){if("NONE"!=t){t=e.C.get(t);break e}e.R=!1}else if(!t&&e.C.size)for(t=c(e.C.keys()).next();!t.done;){t=e.C.get(t.value);break e}}t=null}return n=Dn(i,n),i=Zb(e,u,d,n,i,r,!1,s,a,t,o,!1,l,!1),e.i.set(h,i),i}function Zb(e,t,n,i,r,s,a,o,l,u,d,h,f,p){function g(t){var n,g,_,T,x,I,C,D,R,M,L,P,O,U,F,B,j,V,H,$,G,z;return N(function(N){switch(N.g){case 1:return n=Pn,g=b.M(),E(N,2),S(N,S_(e,b.M(),!0),4);case 4:_=N.h,k(N,3);break;case 2:if(T=A(N),v.closeSegmentIndex(),e.h.disableStream(v))return N.return();throw T;case 3:if(t.aborted)return N.return();if(x=_.uri,x==_.originalUri||g.includes(x)||y.push(x),I=mb(e.Fa,_.data),1!=I.type)throw new It(2,4,4017);return C=lb(I.g,"EXT-X-DEFINE"),D=Lb(e,C,x),R=!1,(!e.ea&&e.g.hls.disableCodecGuessing||e.R&&r==n.ga&&!e.g.hls.disableClosedCaptionsDetection)&&0<I.segments.length&&(e.R=!1,R=!0),M=!e.ea&&e.g.hls.disableCodecGuessing,L=E_(e),S(N,r_(e,0,D,I,m,i,r,s,a,o,l,u,d,h,f,p,void 0,R,M),5);case 5:if(P=N.h,t.aborted)return N.return();if(O=P.stream,E_(e)&&!L&&c_(e,I),b.rc=P.rc,b.Lb=P.Lb,b.de=P.de,b.ce=P.ce,b.xd=P.xd,b.te=P.te,b.pb=P.pb,b.qb=P.qb,b.Nf=!0,v.segmentIndex=O.segmentIndex,v.encrypted=O.encrypted,v.drmInfos=O.drmInfos,v.keyIds=O.keyIds,v.mimeType=O.mimeType,v.bandwidth=v.bandwidth||O.bandwidth,v.codecs=v.codecs||O.codecs,v.closedCaptions=v.closedCaptions||O.closedCaptions,v.width=v.width||O.width,v.height=v.height||O.height,v.hdr=v.hdr||O.hdr,v.colorGamut=v.colorGamut||O.colorGamut,"und"==v.language&&"und"!=O.language&&(v.language=O.language),v.language=v.language||O.language,v.channelsCount=v.channelsCount||O.channelsCount,v.audioSamplingRate=v.audioSamplingRate||O.audioSamplingRate,Fb(v),v.drmInfos.length&&e.h.newDrmInfo(v),U=!1,(!u&&v.closedCaptions||u&&v.closedCaptions&&u.size!=v.closedCaptions.size)&&(U=!0),e.m&&U&&e.h.makeTextStreamsForClosedCaptions(e.m),r==n.ga||r==n.X)for(F=c(e.i.values()),B=F.next();!B.done;B=F.next())j=B.value,j.Nf||j.type!=r||(j.stream.mimeType=O.mimeType,Fb(j.stream));r==n.ta&&(V=O.segmentIndex.get(0))&&V.$&&(v.mimeType="application/mp4",Fb(v)),H=Lu(v),v.segmentIndex.Jb(function(e){e.$&&(e.$.Lc=H)}),i_(e)&&(e.Ib?t_(e,[b]):(e.Ib=!0,$=Array.from(e.i.values()),G=$.filter(function(e){return e.stream.segmentIndex}),t_(e,G),Rb(e),z=e.o,0<z&&e.A.Y(z))),g_(e,I.g,v.type,D,m),w(N)}})}function m(){return e.l&&1<n.length?Ov(e.l,t):y.concat(fb([e.L],n,e.s))}var v=a_(e,i,r,s,a,o,l,u,d,h,f,p),y=[],b={stream:v,type:r,dh:y,M:m,rc:0,Lb:0,te:new Map,de:!1,ce:!1,xd:!1,mf:-1,pb:-1,qb:-1,Nf:!1},_=null,T=new AbortController;return v.createSegmentIndex=function(){return _||(T=new AbortController,_=new Promise(function(e){e(g(T.signal))}))},v.closeSegmentIndex=function(){_&&!v.segmentIndex&&T.abort(),v.segmentIndex&&(v.segmentIndex.release(),v.segmentIndex=null),_=null},b}function Jb(e){var t=1/0;e=c(e.i.values());for(var n=e.next();!n.done;n=e.next())n=n.value,n.stream.segmentIndex&&"text"!=n.stream.type&&(t=Math.min(t,n.Lb));return t}function e_(e,t){var n=[];t=c(t);for(var i=t.next();!i.done;i=t.next())i=i.value,i.segmentIndex&&i.segmentIndex.Jb(function(e){n.push(e)});e.j.Jd(n)}function t_(e,t){if(!E_(e))for(var n=Jb(e),i=c(t),r=i.next();!r.done;r=i.next())r.value.stream.segmentIndex.Ec(0,n);e_(e,t.map(function(e){return e.stream})),e.g.hls.ignoreManifestProgramDateTime?kb(e,t):(Ab(e,t),0<e.g.hls.ignoreManifestProgramDateTimeForTypes.length&&kb(e,t))}function n_(e,t){return!!e.g.hls.ignoreManifestProgramDateTime||e.g.hls.ignoreManifestProgramDateTimeForTypes.includes(t)}function i_(e){if(!e.m)return!1;var t=[],n=[];e=c(e.m.variants);for(var i=e.next();!i.done;i=e.next())i=i.value,i.video&&t.push(i.video),i.audio&&n.push(i.audio);return!(0<t.length&&!t.some(function(e){return e.segmentIndex})||0<n.length&&!n.some(function(e){return e.segmentIndex}))}function r_(e,t,n,i,r,s,a,o,l,u,c,d,h,f,p,g,m,v,y){var b,_,T,w,E,x,k,A,I,C,D,R,M,L,P,O,U,F,B,j,V,H,$,G,z,q;return v=void 0===v||v,y=void 0===y||y,N(function(t){switch(t.g){case 1:var N=cb(i.g,"EXT-X-PLAYLIST-TYPE"),W=cb(i.g,"EXT-X-ENDLIST");if(W=N&&"VOD"==N.value||W,N=N&&"EVENT"==N.value&&!W,N=!W&&!N,x_(e,W?L_:N?O_:P_),E_(e)&&u_(e,i),b=E_(e)?e.N.get(a):new Map,_=m_(e,i,b,n,r,a),T=_.segments,w=_.bandwidth,A=k=x=E=null,!(0<T.length&&v)){t.u(2);break}return S(t,Db(e,T),3);case 3:I=t.h,a=I.type,o=I.language,c=I.channelCount,p=I.sampleRate,e.g.disableText||(d=I.closedCaptions),x=I.height,E=I.width,k=I.Qd,A=I.colorGamut,y&&(m=I.mimeType,s=I.codecs);case 2:if(m){t.u(4);break}return S(t,__(e,a,s,T),5);case 5:m=t.h;case 4:return S(t,o_(e,i,m,r,n),6);case 6:if(C=t.h,D=C.drmInfos,R=C.keyIds,M=C.encrypted,L=C.Dh,M&&!D.length&&!L)throw new It(2,4,4026);return P=a_(e,s,a,o,l,u,c,d,h,f,p,g),P.encrypted=M,P.drmInfos=D,P.keyIds=R,P.mimeType=m,w&&(P.bandwidth=w),Fb(P),"video"==a&&(E||x||k||A)&&T_(P,E,x,null,k,null,A),E_(e)&&u_(e,i),O=T[0].startTime,U=T[T.length-1],F=U.endTime,B=new tu(T),P.segmentIndex=B,V=!!(j=cb(i.g,"EXT-X-SERVER-CONTROL"))&&null!=ib(j,"CAN-SKIP-UNTIL"),H=!!j&&null!=ib(j,"CAN-BLOCK-RELOAD"),$=db(i.g,"EXT-X-MEDIA-SEQUENCE",0),G=s_($,T),z=G.pb,q=G.qb,t.return({stream:P,type:a,dh:[],M:r,rc:O,Lb:F,de:V,ce:H,xd:!1,mf:-1,pb:z,qb:q,te:b,Nf:!1})}})}function s_(e,t){e=e+t.length-1;var n=-1;if(!t.length)return e++,{pb:e,qb:n};t=t[t.length-1];var i=t.g;return t.g.length?(n=i.length-1,i[i.length-1].preload||(e++,n=0),{pb:e,qb:n}):(e++,t.m&&(n=0),{pb:e,qb:n})}function a_(e,t,n,i,r,s,a,o,l,u,d,h){var f=v_(n,t)||y_(n),p=[];if(l){l=c(l.split(","));for(var g=l.next();!g.done;g=l.next())p.push(g.value)}return l=void 0,g=null,n==Ln?l=p.includes("public.accessibility.transcribes-spoken-dialog")&&p.includes("public.accessibility.describes-music-and-sound")?"caption":"subtitle":p.includes("public.accessibility.describes-video")&&(g="visually impaired"),p.length||"subtitle"!==l||p.push("subtitle"),e={id:e.B++,originalId:s,groupId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:f,codecs:t,kind:n==Ln?"subtitle":void 0,encrypted:!1,drmInfos:[],keyIds:new Set,language:hi(i||"und"),originalLanguage:i,label:s,type:n,primary:r,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:p,forced:u,channelsCount:a,audioSamplingRate:d,spatialAudio:h,closedCaptions:o,hdr:void 0,colorGamut:void 0,videoLayout:void 0,tilesLayout:void 0,accessibilityPurpose:g,external:!1,fastSwitching:!1,fullMimeTypes:new Set},Fb(e),e}function o_(e,t,n,i,r){var s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,w,E,x,k,A,I,C,D,R,M,L,P;return N(function(O){switch(O.g){case 1:if(s=new Map,t.segments)for(a=c(t.segments),o=a.next();!o.done;o=a.next())if(l=o.value,u=lb(l.g,"EXT-X-KEY"),d=null,u.length)for(d=d_(e,t,l.g,i,r),h=c(u),f=h.next();!f.done;f=h.next())p=f.value,s.set(p,d);m=g=!1,v=[],y=new Set,b=c(s),_=b.next();case 2:if(_.done){O.u(4);break}if(T=_.value,w=c(T),E=w.next().value,x=w.next().value,k=E,A=x,I=sb(k,"METHOD"),"NONE"==I){O.u(3);break}if(g=!0,C=rb(k,"KEYFORMAT")||"identity",D=null,A_(I)){m=!0,O.u(3);break}if("identity"!=C){D=(R=M_[C])?R(k,n):null,O.u(6);break}return S(O,I_(e,k,n,i,A,r),8);case 8:D=O.h;case 6:if(D){if(D.keyIds)for(M=c(D.keyIds),L=M.next();!L.done;L=M.next())P=L.value,y.add(P);v.push(D)}case 3:_=b.next(),O.u(2);break;case 4:return O.return({drmInfos:v,keyIds:y,encrypted:g,Dh:m})}})}function l_(t,n,i,r,s){if(!e.crypto||!e.crypto.subtle)throw Z("Web Crypto API is not available to decrypt AES. (Web Crypto only exists in secure origins like https)"),new It(2,4,4042);var a=0,o=rb(n,"IV","");if(o){var l=En(o.substr(2));if(16!=l.byteLength)throw new It(2,4,4048)}else a=db(i.g,"EXT-X-MEDIA-SEQUENCE",0);if(i=n.toString()+"-"+a,!t.pa.has(i)){var u={bitsKey:128,blockCipherMode:"CBC",iv:l,firstMediaSequenceNumber:a};switch(sb(n,"METHOD")){case"AES-256":u.bitsKey=256;break;case"AES-256-CTR":u.bitsKey=256,u.blockCipherMode="CTR"}u.fetchKey=function(){var i,a,o,l,c,d,h;return N(function(f){if(1==f.g)return i=hb(r(),sb(n,"URI"),s),a=i.sort().join(""),t.K.has(a)||(o=zr(i,t.g.retryParameters),l=k_(t,o,6),t.K.set(a,l)),S(f,t.K.get(a),2);if(3!=f.g){if(c=f.h,!c.data||c.data.byteLength!=u.bitsKey/8)throw new It(2,4,4049);return d={name:"CTR"==u.blockCipherMode?"AES-CTR":"AES-CBC",length:u.bitsKey},h=u,S(f,e.crypto.subtle.importKey("raw",c.data,d,!0,["decrypt"]),3)}h.cryptoKey=f.h,u.fetchKey=void 0,w(f)})},t.pa.set(i,u)}return t.pa.get(i)}function u_(e,t){var n=1/0,i=t.segments;if(i.length)for(var r=i.length-1;0<=r;){var s=cb(i[r].g,"EXTINF");if(s){n=Number(s.value.split(",")[0]);break}r--}if(i=cb(t.g,"EXT-X-TARGETDURATION"),!i)throw new It(2,4,4024,"EXT-X-TARGETDURATION");i=Number(i.value),(r=cb(t.g,"EXT-X-PART-INF"))&&(e.U=Number(sb(r,"PART-TARGET"))),t=cb(t.g,"EXT-X-SERVER-CONTROL"),e.I&&e.U?(e.o=e.Hb?5*e.U<=n?Math.min(e.U,e.o):Math.min(n,e.o):Math.min(e.U,e.o),e.Da=t?Number(sb(t,"PART-HOLD-BACK")):0):(e.o=Math.min(n,e.o),n=t?ib(t,"HOLD-BACK"):null,e.za=n?Number(n.value):0),e.bb=Math.max(i,e.bb)}function c_(e,t){if(e.g.defaultPresentationDelay)t=e.g.defaultPresentationDelay;else if(e.Da)t=e.Da;else if(e.za)t=e.za;else{t=t.segments.length;var n=e.g.hls.liveSegmentsDelay;n>t-2&&(n=Math.max(1,t-2)),t=e.bb*n}e.j.mh(0),e.j.eg(t),e.j.wc(!1)}function d_(e,t,n,i,r){var s=cb(n,"EXT-X-MAP");if(!s)return null;var a=sb(s,"URI"),o=hb(i(),a,r);if(a=[o.toString(),rb(s,"BYTERANGE","")].join("-"),!e.ra.has(a)){var l=void 0,u=null;n=c(n);for(var d=n.next();!d.done;d=n.next())d=d.value,"EXT-X-KEY"==d.name?A_(sb(d,"METHOD"))&&d.id<s.id&&(l=l_(e,d,t,i,r)):"EXT-X-BYTERANGE"==d.name&&d.id<s.id&&(u=d);t=h_(o,s,u,l),e.ra.set(a,t)}return e.ra.get(a)}function h_(e,t,n,i){var r=0,s=null;return t=rb(t,"BYTERANGE"),!t&&n&&(t=n.value),t&&(r=t.split("@"),s=Number(r[0]),r=Number(r[1]),s=r+s-1,i&&(n=s+1-r,n%16&&(s+=16-n%16))),new Ya(function(){return e},r,s,null,null,null,i)}function f_(t,n,i,r,s,a,o,l,u){function d(e){e=new ht(e).Pa.split(".").pop();var t=D_[o][e];return t||(t=C_[e]),t}var h=r.g,f=cb(h,"EXTINF"),p=0,g=0,m=null;r.Bb.length&&(t.m.isLowLatency=!0);var v=null;if(!t.g.hls.ignoreManifestProgramDateTime){var y=cb(h,"EXT-X-PROGRAM-DATE-TIME");y&&y.value&&(v=Bs(y.value))}var b=Ja;if(cb(h,"EXT-X-GAP")&&(t.m.gapCount++,b=2),!f){if(0==r.Bb.length)throw new It(2,4,4024,"EXTINF");if(!t.I)return null}var _=[];y=!1;var T=null,S=!1,w=!1;if(t.I&&r.Bb.length){p=n&&e.ReadableStream&&t.g.hls.allowLowLatencyByteRangeOptimization;for(var E=v,x={},k=0;k<r.Bb.length;x={gd:x.gd,bd:x.bd},k++){var A=r.Bb[k],I=0==k?i:_[_.length-1],C=0==k?s:I.endTime,D=Number(rb(A,"DURATION"))||t.U;if(D){var R=C+D,M=0,L=null;if("EXT-X-PRELOAD-HINT"==A.name?(M=(M=rb(A,"BYTERANGE-START"))?Number(M):0,(I=rb(A,"BYTERANGE-LENGTH"))?L=M+Number(I)-1:M&&(L=Number.MAX_SAFE_INTEGER)):(M=rb(A,"BYTERANGE"),L=c(p_(I,M)),M=L.next().value,L=L.next().value),x.bd=rb(A,"URI"),x.bd){I=Ja,"YES"==rb(A,"GAP")&&(t.m.gapCount++,I=2,S=!0),x.gd=null;var P=function(e){return function(){return null==e.gd&&(e.gd=hb(l(),e.bd,a)),e.gd}}(x);p&&0<=M&&null!=L&&(T=P,y=!0),C=new Qa(C,R,P,M,L,n,0,0,1/0,[],"",null,E,I,u),"EXT-X-PRELOAD-HINT"==A.name&&(C.Of(),w=!0),"YES"!=rb(A,"INDEPENDENT")&&0<k&&C.se(),(A=d(x.bd))&&(C.mimeType=A,R_.has(A)&&(C.$=null)),_.push(C),E&&(E+=D)}}}}if(f){if(f=Number(f.value.split(",")[0]),0==f)return null;p=s+f}else{if(!_.length)return null;p=_[_.length-1].endTime}y&&(S||0!=_[0].Ha?(y=!1,T=null):_=[]),(f=cb(h,"EXT-X-BYTERANGE"))?(m=c(p_(i,f.value)),g=m.next().value,m=m.next().value):_.length&&(g=_[0].Ha,m=_[_.length-1].sa),i="",f=null,"image"==o&&(i="1x1",h=cb(h,"EXT-X-TILES"))&&(i=sb(h,"LAYOUT"),(h=rb(h,"DURATION"))&&(f=Number(h)));var O=null;return n=new Qa(s,p,function(){return T?T():(null==O&&(O=hb(l(),r.h,a)),O||[])},g,m,n,0,0,1/0,_,i,f,v,b,u,0<_.length&&!!r.h),(s=d(r.h))&&(n.mimeType=s,R_.has(s)&&(n.$=null)),y&&(t.Hb=!0,n.Vg(),w&&n.Of()),n}function p_(e,t){var n=0,i=null;return t&&(n=t.split("@"),t=Number(n[0]),n=n[1]?Number(n[1]):e.sa+1,i=n+t-1),[n,i]}function g_(e,t,n,i,r){if("video"==n||"audio"==n){var s=e.j.m;if(s&&!n_(e,n))for(t=lb(t,"EXT-X-DATERANGE"),t=t.sort(function(e,t){return e=sb(e,"START-DATE"),t=sb(t,"START-DATE"),e<t?-1:e>t?1:0}),n=0;n<t.length;n++){var a=t[n],o=sb(a,"ID");if(!e.Ea.has(o)){var l=sb(a,"START-DATE"),u=Bs(l);if(!isNaN(u)){l=Math.max(0,u-s);var d=null,h=rb(a,"END-DATE");if(h&&(h=Bs(h),!isNaN(h)&&(d=h-s,0>d)))continue;if(null==d&&(h=rb(a,"DURATION")||rb(a,"PLANNED-DURATION"))&&(h=parseFloat(h),isNaN(h)||(d=l+h),0>u-s+h))continue;h=rb(a,"CLASS")||"com.apple.quicktime.HLS";var f="YES"==rb(a,"END-ON-NEXT");if(null==d&&f){for(f=n+1;f<t.length;f++){var p=rb(t[f],"CLASS")||"com.apple.quicktime.HLS";if(h==p&&(p=sb(t[f],"START-DATE"),p=Bs(p),!isNaN(p)&&p&&p>u)){d=Math.max(0,p-s);break}}if(null==d)continue}for(u="ID CLASS START-DATE END-DATE DURATION END-ON-NEXT".split(" "),f=[],a=c(a.attributes),p=a.next();!p.done;p=a.next())if(p=p.value,!u.includes(p.name)){var g=pb(p.value,i);"X-ASSET-URI"!=p.name&&"X-ASSET-LIST"!=p.name||(g=hb(r(),p.value,i)[0]),f.push({key:p.name,description:"",data:g,mimeType:null,pictureType:null})}f.length&&e.h.onMetadata(h,l,d,f),e.Ea.add(o)}}}}}function m_(e,t,n,i,r,s){var a=t.segments,o=void 0,l=db(t.g,"EXT-X-DISCONTINUITY-SEQUENCE",0),u=db(t.g,"EXT-X-MEDIA-SEQUENCE",0),d=cb(t.g,"EXT-X-SKIP"),h=d?Number(rb(d,"SKIPPED-SEGMENTS")):0,f=u+h,p=0;E_(e)&&n.has(f)&&(p=n.get(f)),0===p&&e.xa==O_&&0<n.size&&!n.has(f)&&(p=e.j.nb());var g=[],m=null;d=[];for(var v=0;v<a.length;v++){var y=a[v],b=0==v?p:m.endTime;f=u+h+v,cb(y.g,"EXT-X-DISCONTINUITY")&&l++;for(var _=c(y.g),T=_.next();!T.done;T=_.next())T=T.value,"EXT-X-KEY"==T.name&&(o=A_(sb(T,"METHOD"))?l_(e,T,t,r,i):void 0);n.set(f,b),_=d_(e,t,y.g,r,i),!e.I&&e.h.isAutoLowLatencyMode()&&(e.h.enableLowLatencyMode(),e.I=e.h.isLowLatencyMode()),(b=f_(e,_,m,y,b,i,s,r,o))&&((m=db(y.g,"EXT-X-BITRATE"))?d.push({bitrate:m,duration:b.endTime-b.startTime}):d.length&&(m=d.pop(),m.duration+=b.endTime-b.startTime,d.push(m)),m=b,b.i=l,n_(e,s)&&null!=e.H&&f<e.H||g.push(b))}if(t=void 0,d.length&&(t=d.reduce(function(e,t){return e+t.duration},0),t=Math.round(d.reduce(function(e,t){return e+t.bitrate*t.duration},0)/t*1e3)),d=g.some(function(e){return null!=e.h}))for(n={},i=0;i<g.length;n={Zc:n.Zc,Yc:n.Yc,Rd:n.Rd,Sb:n.Sb,Vc:n.Vc},i++)if(n.Sb=g[i],null==n.Sb.h)for(n.Yc=0,n.Zc=i,r=function(e){return function(){var t=g[e.Zc];if(t){if(null!=t.h)return t.h+e.Yc;e.Yc-=t.endTime-t.startTime,e.Zc+=1}return null}}(n),n.Vc=0,n.Rd=i,a=function(e){return function(){var t=g[e.Rd];if(t){if(t!=e.Sb&&(e.Vc+=t.endTime-t.startTime),null!=t.h)return t.h+e.Vc;--e.Rd}return null}}(n);null==n.Sb.h;)n.Sb.h=a(),null==n.Sb.h&&(n.Sb.h=r());if(d)for(n=c(g),i=n.next();!i.done;i=n.next())for(r=i.value,i=r.h,r=c(r.g),a=r.next();!a.done;a=r.next())a=a.value,a.h=i,i+=a.endTime-a.startTime;if(n=e.fa,d&&1/0!=n&&!n_(e,s))for(e=c(g),i=e.next();!i.done;i=e.next())i.value.jg(n);return{segments:g,bandwidth:t}}function v_(e,t){if(e==Ln){if("vtt"==t||"wvtt"==t)return"text/vtt";if(t&&""!==t)return"application/mp4"}return"image"!=e||t&&"jpeg"!=t?"audio"==e&&"mp4a.40.34"==t?"audio/mpeg":"mjpg"==t?"application/mp4":null:"image/jpeg"}function y_(e){return e==Ln?"text/vtt":D_[e].mp4}function b_(e,t){e=E_(e)?Math.trunc((t.length-1)/2):0;for(var n=t[e];2==n.ac()&&e+1<t.length;)e++,n=t[e];return{segment:n,segmentIndex:e}}function __(e,t,n,i){var r,s,a,o,l,u,c,d,h,f,p,g,m,v;return N(function(y){switch(y.g){case 1:return r=Zr,s=b_(e,i),a=s.segment,2==a.status?y.return(y_(t)):(o=a.M(),l=new ht(o[0]),u=l.Pa.split(".").pop(),c=D_[t],(d=c[u])||(d=C_[u])||(d=v_(t,n))?y.return(d):(f=1,p=zr(o,e.g.retryParameters),E(y,2),p.method="HEAD",S(y,k_(e,p,r,{type:f}),4)));case 4:g=y.h,h=g.headers["content-type"],k(y,3);break;case 2:if(m=A(y),!m||1002!=m.code&&1001!=m.code){y.u(3);break}return p.method="GET",S(y,k_(e,p,r,{type:f}),6);case 6:v=y.h,h=v.headers["content-type"];case 3:return h?y.return(h.toLowerCase().split(";")[0]):y.return(y_(t))}})}function T_(e,t,n,i,r,s,a){e&&(e.width=Number(t)||void 0,e.height=Number(n)||void 0,e.frameRate=Number(i)||void 0,e.hdr=r||void 0,e.videoLayout=s||void 0,e.colorGamut=a||void 0)}function S_(e,t,n){return k_(e,zr(t,e.g.retryParameters),0,{type:n?2:3})}function w_(e){var t,n,i,r,s,a;return N(function(o){switch(o.g){case 1:return e.h?(E(o,2),t=Date.now(),S(o,e.update(),4)):o.return();case 4:n=Date.now(),E_(e)&&(i=(n-t)/1e3,e.Fb.sample(1,i),r=e.o,s=Math.max(0,r-K(e.Fb)),e.A.Y(s)),k(o,3);break;case 2:if(a=A(o),!e.h)return o.return();if(e.g.raiseFatalErrorOnManifestUpdateRequestFailure)return e.h.onError(a),o.return();a.severity=1,e.h.onError(a),e.A.Y(.1);case 3:if(!e.h)return o.return();e.h.onManifestUpdated(),w(o)}})}function E_(e){return e.xa!=L_}function x_(e,t){e.xa=t,e.j&&e.j.wc(!E_(e)),E_(e)||e.A.stop()}function k_(e,t,n,i){if(!e.da)throw new It(2,7,7001);return t=e.h.networkingEngine.request(n,t,i),Vr(e.da,t),t.promise}function A_(e){return"AES-128"==e||"AES-256"==e||"AES-256-CTR"==e}function I_(e,t,n,i,r,s){var a,o,l,u,c,d,h,f,p,g,m,v,y,b,_;return N(function(T){switch(T.g){case 1:if("video/mp2t"==n)throw new It(2,4,4040);if(on())throw new It(2,4,4041);if(a=sb(t,"METHOD"),o=["SAMPLE-AES","SAMPLE-AES-CTR"],!o.includes(a))return T.return(null);if(l=hb(i(),sb(t,"URI"),s),l[0].startsWith("data:text/plain;base64,")){u=xn(wn(l[0].split("data:text/plain;base64,").pop())),T.u(2);break}return c=l.sort().join(""),e.qa.has(c)||(d=zr(l,e.g.retryParameters),h=k_(e,d,6),e.qa.set(c,h)),S(T,e.qa.get(c),3);case 3:f=T.h,u=xn(f.data);case 2:if(p="00000000000000000000000000000000",!r){T.u(4);break}if(e.ya.has(r)){g=e.ya.get(r),T.u(5);break}return m=ju(r.M(),r.$b(),r.Xb(),e.g.retryParameters),v=Zr,S(T,k_(e,m,v,{type:0}),6);case 6:y=T.h,g=Fu(y.data),e.ya.set(r,g);case 5:g&&(p=g);case 4:return b=new Map,b.set(p,u),_="cenc","SAMPLE-AES"==a&&(_="cbcs"),T.return(Cn(b,_))}})}G("shaka.net.DataUriPlugin",_b),_b.parse=Tb,$r("data",Tb),i=wb.prototype,i.configure=function(e){this.g=e,this.l&&this.l.configure(this.g)},i.start=function(e,t){var n,i=this;return N(function(r){return 1==r.g?(i.h=t,i.I=t.isLowLatencyMode(),S(r,S_(i,[e]),2)):3!=r.g?(n=r.h,i.L=n.uri,S(r,Cb(i,n.data,e),3)):r.return(i.m)})},i.stop=function(){this.A&&(this.A.stop(),this.A=null);var e=[];return this.da&&(e.push(this.da.destroy()),this.da=null),this.g=this.h=null,this.wb.clear(),this.m=null,this.i.clear(),this.G.clear(),this.F.clear(),this.s.clear(),this.ra.clear(),this.pa.clear(),this.K.clear(),this.qa.clear(),this.ya.clear(),this.Ea.clear(),this.l&&this.l.destroy(),this.Z&&(this.Z.release(),this.Z=null),Promise.all(e)},i.update=function(){var e,t,n,i,r,s,a,o,l,u,h,f=this;return N(function(p){if(1==p.g){if(!E_(f))return p.return();for(e=[],t=Array.from(f.i.values()),f.o=1/0,f.m.gapCount=0,n=t.filter(function(e){return e.stream.segmentIndex}),i=c(n),r=i.next();!r.done;r=i.next())s=r.value,e.push(xb(f,s));return S(p,Promise.all(e),2)}for(e_(f,n.map(function(e){return e.stream})),a=n.some(function(e){return 0==e.xd}),n.length&&!a&&(o=N_,x_(f,o.zh),l=n.map(function(e){return e.Lb}),f.j.$a(Math.min.apply(Math,d(l))),f.h.updateDuration()),a&&Rb(f),u=c(n),r=u.next();!r.done;r=u.next())h=r.value,h.stream.segmentIndex&&!h.stream.segmentIndex.O[0]&&f.h.disableStream(h.stream);w(p)})},i.onExpirationUpdated=function(){},i.onInitialVariantChosen=function(){},i.banLocation=function(e){this.l&&this.l.banLocation(e)},i.setMediaElement=function(e){this.aa=e},G("shaka.hls.HlsParser",wb);var C_={aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},D_={audio:{mp4:"audio/mp4",mp4a:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",m4f:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",tsa:"video/mp2t"},video:{mp4:"video/mp4",mp4v:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",m4f:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t",tsv:"video/mp2t"},text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",m4f:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml"},image:{jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml",webp:"image/webp",avif:"image/avif"}},R_=new Set(["video/mp2t"].concat(d(Xn))),M_={"com.apple.streamingkeydelivery":function(e,t){if("video/mp2t"==t)throw new It(2,4,4040);if(on())throw new It(2,4,4041);if(t=sb(e,"METHOD"),!["SAMPLE-AES","SAMPLE-AES-CTR"].includes(t))return null;var n="cenc";return"SAMPLE-AES"==t&&(n="cbcs"),In("com.apple.fps",n,[{initDataType:"sinf",initData:new Uint8Array(0),keyId:null}],sb(e,"URI"))},"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(e){var t=sb(e,"METHOD");if(!["SAMPLE-AES","SAMPLE-AES-CTR"].includes(t))return null;var n="cenc";return"SAMPLE-AES"==t&&(n="cbcs"),t=sb(e,"URI"),t=Sb(t.split("?")[0]),t=Ee(t.data),n=In("com.widevine.alpha",n,[{initDataType:"cenc",initData:t}]),(e=rb(e,"KEYID"))&&(n.keyIds=new Set([e.toLowerCase().substr(2)])),n},"com.microsoft.playready":function(e){var t=sb(e,"METHOD");if(!["SAMPLE-AES","SAMPLE-AES-CTR"].includes(t))return null;var n="cenc";return"SAMPLE-AES"==t&&(n="cbcs"),e=sb(e,"URI"),e=Sb(e.split("?")[0]),e=Ee(e.data),t=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),e=Ss(e,t,new Set,0),In("com.microsoft.playready",n,[{initDataType:"cenc",initData:e}])}},L_="VOD",P_="EVENT",O_="LIVE",N_={zh:L_,xj:P_,Fj:O_};function U_(e){var t=0,n=ke(e),i=n.getUint32(t,!0);if(i!=e.byteLength)return[];e:{for(e=t+6,t=[];e<n.byteLength-1;){i=n.getUint16(e,!0),e+=2;var r=n.getUint16(e,!0);if(e+=2,0!=(1&r)||r+e>n.byteLength){n=[];break e}var s=Ee(n,e,r);t.push({type:i,value:s}),e+=r}n=t}return n}function F_(e){if(e=B_(e))e:{e=c(Ms(e,"DATA"));for(var t=e.next();!t.done;t=e.next())if(t=Ls(t.value,"LA_URL")){e=Ds(t);break e}e=""}else e="";return e}function B_(e){return e=wn(Ds(e)),e=U_(e).filter(function(e){return e.type===j_})[0],e?(e=fn(e.value,!0),(e=Es(e,"WRMHEADER"))?e:null):null}Ga["application/x-mpegurl"]=function(){return new wb},Ga["application/vnd.apple.mpegurl"]=function(){return new wb};var j_=1,V_=(new Map).set("com.microsoft.playready",F_).set("com.microsoft.playready.recommendation",F_).set("com.microsoft.playready.software",F_).set("com.microsoft.playready.hardware",F_);function H_(e){if(!J_){J_=!0;var t=new Uint8Array([105,115,111,109]),n=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);dT=Z_("ftyp",t,i,t,n),t=Z_("dref",hT),fT=Z_("dinf",t)}this.g=e}function $_(e){for(var t=[],n=c(e.g),i=n.next();!i.done;i=n.next()){var r=t,s=r.push,a=i.value;i=Z_;var o=a.id+1,l=a.stream.width||0,u=a.stream.height||0;"audio"==a.type&&(u=l=0);var h=a.duration*a.timescale,f=Math.floor(h/(eT+1));switch(h=Math.floor(h%(eT+1)),o=new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3].concat(d(X_(o,4)),[0,0,0,0],d(X_(f,4)),d(X_(h,4)),[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0],d(X_(l,2)),[0,0],d(X_(u,2)),[0,0])),o=Z_("tkhd",o),l=Z_,f=a.duration*a.timescale,u=Math.floor(f/(eT+1)),f=Math.floor(f%(eT+1)),h=a.stream.language,h=h.charCodeAt(0)-96<<10|h.charCodeAt(1)-96<<5|h.charCodeAt(2)-96,u=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3].concat(d(X_(a.timescale,4)),d(X_(u,4)),d(X_(f,4)),d(X_(h,2)),[0,0])),u=Z_("mdhd",u),f=a,h=new Uint8Array([]),f.type){case"video":h=nT;break;case"audio":h=iT}f=Z_("hdlr",h);e:{switch(a.type){case"video":a=Z_("minf",Z_("vmhd",lT),fT,G_(a));break e;case"audio":a=Z_("minf",Z_("smhd",uT),fT,G_(a));break e}a=new Uint8Array([])}a=l("mdia",u,f,a),i=i("trak",o,a),s.call(r,i)}for(t=kn.apply(_n,d(t)),s=e.g[0],n=Z_,i=s.duration*s.timescale,r=Math.floor(i/(eT+1)),i=Math.floor(i%(eT+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3].concat(d(X_(s.timescale,4)),d(X_(r,4)),d(X_(i,4)),[0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255])),r=Z_("mvhd",r),i=[],e=c(e.g),l=e.next();!l.done;l=e.next())a=i,o=a.push,l=new Uint8Array([0,0,0,0].concat(d(X_(l.value.id+1,4)),[0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1])),l=Z_("trex",l),o.call(a,l);if(e=kn.apply(_n,d(i)),e=Z_("mvex",e),i=[],s.encrypted){for(s=c(s.stream.drmInfos),a=s.next();!a.done;a=s.next())if(a=a.value,a.initData)for(a=c(a.initData),o=a.next();!o.done;o=a.next())i.push(o.value.initData);s=kn.apply(_n,d(i))}else s=new Uint8Array([]);return e=n("moov",r,t,e,s),t=new Uint8Array(dT.byteLength+e.byteLength),t.set(dT),t.set(e,dT.byteLength),t}function G_(e){var t=Z_,n=new Uint8Array([]);switch(e.type){case"video":if(e.codecs.includes("avc1")){n=e.stream.width||0;var i=e.stream.height||0;if(0<e.wa.byteLength)var r=Z_("avcC",e.wa);else{r=Z_;for(var s=7,a=[],o=[],l=0,u=0,c=0,h=0;h<e.ab.length;h++){var f=Q_(e.ab[h]);switch(31&f[0]){case 7:a.push(f),s+=f.length+2;break;case 8:o.push(f),s+=f.length+2}}for(0<a.length&&(l=a[0][1],c=a[0][2],u=a[0][3]),s=new Uint8Array(s),h=0,s[h++]=1,s[h++]=l,s[h++]=c,s[h++]=u,s[h++]=255,s[h++]=224|a.length,l=0;l<a.length;l++)s[h++]=(65280&a[l].length)>>8,s[h++]=255&a[l].length,s.set(a[l],h),h+=a[l].length;for(s[h++]=o.length,a=0;a<o.length;a++)s[h++]=(65280&o[a].length)>>8,s[h++]=255&o[a].length,s.set(o[a],h),h+=o[a].length;r=r("avcC",s)}n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].concat(d(X_(n,2)),d(X_(i,2)),[0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17])),i="avc1",o=z_(e),a=new Uint8Array([]),e.encrypted&&(a=W_(e),i="encv"),n=Z_(i,n,r,o,a)}else e.codecs.includes("hvc1")&&(i=e.stream.width||0,r=e.stream.height||0,n=new Uint8Array([]),0<e.wa.byteLength&&(n=Z_("hvcC",e.wa)),i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].concat(d(X_(i,2)),d(X_(r,2)),[0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17])),r="hvc1",o=z_(e),a=new Uint8Array([]),e.encrypted&&(a=W_(e),r="encv"),n=Z_(r,i,n,o,a));break;case"audio":e.codecs.includes("mp3")?e=Z_(".mp3",q_(e)):e.codecs.includes("ac-3")?(n=Z_("dac3",e.ma),i="ac-3",r=new Uint8Array([]),e.encrypted&&(r=W_(e),i="enca"),e=Z_(i,q_(e),n,r)):e.codecs.includes("ec-3")?(n=Z_("dec3",e.ma),i="ec-3",r=new Uint8Array([]),e.encrypted&&(r=W_(e),i="enca"),e=Z_(i,q_(e),n,r)):e.codecs.includes("opus")?(n=Z_("dOps",e.ma),i="Opus",r=new Uint8Array([]),e.encrypted&&(r=W_(e),i="enca"),e=Z_(i,q_(e),n,r)):(0<e.ma.byteLength?n=Z_("esds",e.ma):(n=Z_,i=e.id+1,r=e.stream.channelsCount||2,a=e.stream.audioSamplingRate||44100,l=Dn("audio",e.codecs.split(",")),u={96000:0,88200:1,64000:2,48000:3,44100:4,32000:5,24000:6,22050:7,16000:8,12000:9,11025:10,8000:11,7350:12},o=u[a],"mp4a.40.5"!==l&&"mp4a.40.29"!==l||(o=u[2*a]),a=parseInt(l.split(".").pop(),10),i=new Uint8Array([0,0,0,0,3,25].concat(d(X_(i,2)),[0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,a<<3|o>>>1,o<<7|r<<3,6,1,2])),n=n("esds",i)),i="mp4a",r=new Uint8Array([]),e.encrypted&&(r=W_(e),i="enca"),e=Z_(i,q_(e),n,r)),n=e}return e=Z_("stsd",cT,n),t("stbl",e,Z_("stts",rT),Z_("stsc",sT),Z_("stsz",oT),Z_("stco",aT))}function z_(e){if(!e.Ba&&!e.Ca)return new Uint8Array([]);var t=e.Ca;return e=new Uint8Array([].concat(d(X_(e.Ba,4)),d(X_(t,4)))),Z_("pasp",e)}function q_(e){return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.stream.channelsCount||2,0,16,0,0,0,0].concat(d(X_(e.stream.audioSamplingRate||44100,2)),[0,0]))}function W_(e){for(var t=Z_,n=e.codecs.substring(0,e.codecs.indexOf(".")),i=0,r=0;r<n.length;r+=1)i|=n.charCodeAt(r)<<8*(n.length-r-1);n=new Uint8Array([].concat(d(X_(i,4)))),n=Z_("frma",n),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),i=Z_("schm",i),r=Z_;var s=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);e=c(e.stream.drmInfos);for(var a=e.next();!a.done;a=e.next())if((a=a.value)&&a.keyIds&&a.keyIds.size){a=c(a.keyIds);for(var o=a.next();!o.done;o=a.next())s=Q_(o.value)}return e=new Uint8Array([0,0,0,0,0,0,1,8]),s=Z_("tenc",e,s),t("sinf",n,i,r("schi",s))}function K_(e){var t=[];e=c(e.g);for(var n=e.next();!n.done;n=e.next()){n=n.value;var i,r=t.push,s=r.apply,a=Z_,o=new Uint8Array([0,0,0,0].concat(d(X_(n.data?n.data.sb:0,4))));o=Z_("mfhd",o);var l=n.data?n.data.Za:[],u=new Uint8Array(4+l.length);for(i=0;i<l.length;i++){var h=l[i].flags;u[i+4]=h.Va<<4|h.Xa<<2|h.Wa}l=Z_("sdtp",u);var f=l.length+92;u=Z_,i=new Uint8Array([0,0,0,58].concat(d(X_(n.id+1,4)),[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),i=Z_("tfhd",i),h=n.data?n.data.baseMediaDecodeTime:0;var p=Math.floor(h%(eT+1));h=new Uint8Array([1,0,0,0].concat(d(X_(Math.floor(h/(eT+1)),4)),d(X_(p,4)))),h=Z_("tfdt",h);var g=f;f=n.data?n.data.Za:[],p=f.length;var m=12+16*p,v=new Uint8Array(m);for(g+=8+m,v.set(["video"===n.type?1:0,0,15,1].concat(d(X_(p,4)),d(X_(g,4))),0),g=0;g<p;g++){var y=f[g];m=X_(y.duration,4);var b=X_(y.size,4),_=y.flags;y=X_(y.eb,4),v.set([].concat(d(m),d(b),[_.hb<<2|_.Va,_.Xa<<6|_.Wa<<4|_.ib,61440&_.Ua,15&_.Ua],d(y)),12+16*g)}f=Z_("trun",v),l=u("traf",i,h,f,l),a=a("moof",o,l),s.call(r,t,[a,Y_(n)])}return kn.apply(_n,d(t))}function Y_(e){return e=(e.data?e.data.Za:[]).map(function(e){return e.data}),e=kn.apply(_n,d(e)),Z_("mdat",e)}function X_(e,t){var n=[];for(--t;0<=t;t--)n.push(e>>8*t&255);return n}function Q_(e){for(var t=new Uint8Array(e.length/2),n=0;n<e.length/2;n+=1)t[n]=parseInt(String(e[2*n]+e[2*n+1]),16);return t}function Z_(e){var t=U.apply(1,arguments),n=tT[e];n||(n=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)],tT[e]=n);for(var i=8,r=t.length-1;0<=r;r--)i+=t[r].byteLength;for(r=new Uint8Array(i),r[0]=i>>24&255,r[1]=i>>16&255,r[2]=i>>8&255,r[3]=255&i,r.set(n,4),n=0,i=8;n<t.length;n++)r.set(t[n],i),i+=t[n].byteLength;return r}var J_=!1,eT=Math.pow(2,32)-1,tT={},nT=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),iT=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),rT=new Uint8Array([0,0,0,0,0,0,0,0]),sT=new Uint8Array([0,0,0,0,0,0,0,0]),aT=new Uint8Array([0,0,0,0,0,0,0,0]),oT=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),lT=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),uT=new Uint8Array([0,0,0,0,0,0,0,0]),cT=new Uint8Array([0,0,0,0,0,0,0,1]),dT=new Uint8Array([]),hT=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),fT=new Uint8Array([]);function pT(){var e=this;this.h=this.g=null,this.l=[],this.j=null,this.s=1,this.i=null,this.B=new W(5),this.o=new Ut(function(){gT(e)}),this.A=new jr,this.m=new Map}function gT(e){var t;N(function(n){switch(n.g){case 1:return E(n,2),S(n,mT(e),4);case 4:k(n,3);break;case 2:t=A(n),e.h&&(t.severity=1,e.h.onError(t));case 3:if(!e.h)return n.return();w(n)}})}function mT(e){var t,n,i,r,s,a,o;return N(function(l){if(1==l.g)return t=zr(e.l,e.g.retryParameters),n=e.h.networkingEngine,i=Date.now(),r=n.request(0,t,{type:5}),Vr(e.A,r),S(l,r.promise,2);if(s=l.h,!e.h)return l.return();s.uri&&!e.l.includes(s.uri)&&e.l.unshift(s.uri);var u=s.uri,h=s.data,f=e.g.mss.manifestPreprocessor;if(f!=Nc){if(pe("manifest.mss.manifestPreprocessor configuration","Please Use manifest.mss.manifestPreprocessorTXml instead."),h=by(h,"SmoothStreamingMedia"),!h)throw new It(2,4,4046,u);f(h),h=gn(h.outerHTML)}var p=ws(h,"SmoothStreamingMedia");if(!p)throw new It(2,4,4046,u);if(u=e.g.mss.manifestPreprocessorTXml,u!=Uc&&u(p),e.i||(e.i=new Ll(null,0)),u=Os(p,"IsLive",qs,!1))throw new It(2,4,4047);e.i.wc(!u),f=Os(p,"TimeScale",Gs,1e7),h=Os(p,"DVRWindowLength",Gs),u&&(0===h||isNaN(h))&&(h=1/0);var g,m=Os(p,"CanSeek",qs,!1);for(0===h&&m&&(h=1/0),m=null,h&&0<h&&(m=h/f),u&&!isNaN(e.g.availabilityWindowOverride)&&(m=e.g.availabilityWindowOverride),null==m&&(m=1/0),e.i.Ie(m),h=Os(p,"Duration",Gs,1/0),u||e.i.$a(h/f),u={variants:[],textStreams:[],timescale:f,duration:h/f},m=Cs(p,"Protection"),f=e.g.mss.keySystemsBySystemId,h=[],m=c(m),g=m.next();!g.done;g=m.next())h=h.concat(Cs(g.value,"ProtectionHeader"));if(h.length){for(m=[],g=0;g<h.length;g++){var v=h[g],y=v.attributes.SystemID.toLowerCase(),b=f[y];if(b){var _=B_(v);if(_)e:{_=c(Ms(_,"DATA"));for(var T=_.next();!T.done;T=_.next())if(T=Ls(T.value,"KID")){_=wn(Ds(T)),_=new Uint8Array([_[3],_[2],_[1],_[0],_[5],_[4],_[7],_[6]].concat(d(_.slice(8)))),_=xn(_);break e}_=null}else _=null;T=wn(Ds(v)),y=En(y.replace(/-/g,"")),y=[{initData:Ss(T,y,new Set,0),initDataType:"cenc",keyId:_}],y=In(b,"cenc",y),_&&y.keyIds.add(_),(b=V_.get(b))&&(y.licenseServerUri=b(v)),m.push(y)}}f=m}else f=[];for(g=f,m=[],f=[],h=[],p=Cs(p,"StreamIndex"),p=c(p),v=p.next();!v.done;v=p.next()){v=v.value,b=Cs(v,"QualityLevel"),y=u.timescale,_=u.duration,T=Cs(v,"c");for(var E=[],x=0,k=0;k<T.length;++k){var A=T[k],I=T[k+1],C=Os(A,"t",Gs),D=Os(A,"d",Gs);if(A=Os(A,"r",Hs),!D)break;if(C=null!=C?C:x,A=A||0,0>A)if(I){if(I=Os(I,"t",Gs),null==I)break;if(C>=I)break;A=Math.ceil((I-C)/D)-1}else{if(1/0==_)break;if(C/y>=_)break;A=Math.ceil((_*y-C)/D)-1}for(I=0;I<=A;++I)x=C+D,E.push({start:C/y,end:x/y,og:C}),C=x}for(y=E,b=c(b),_=b.next();!_.done;_=b.next())(_=vT(e,v,_.value,y,g,u))&&("audio"!=_.type||e.g.disableAudio?"video"!=_.type||e.g.disableVideo?_.type!=Ln||e.g.disableText||h.push(_):f.push(_):m.push(_))}for(p=[],m=c(0<m.length?m:[null]),g=m.next();!g.done;g=m.next())for(g=g.value,v=c(0<f.length?f:[null]),_=v.next();!_.done;_=v.next())b=p,y=b.push,_=_.value,T=0,g&&g.bandwidth&&0<g.bandwidth&&(T+=g.bandwidth),_&&_.bandwidth&&0<_.bandwidth&&(T+=_.bandwidth),_={id:e.s++,language:g?g.language:"und",disabledUntilTime:0,primary:!!g&&g.primary||!!_&&_.primary,audio:g,video:_,bandwidth:T,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},y.call(b,_);u.variants=p,u.textStreams=h,e.j?(e.j.variants=u.variants,e.j.textStreams=u.textStreams,e.h.filter(e.j)):(e.j={presentationTimeline:e.i,variants:u.variants,textStreams:u.textStreams,imageStreams:[],offlineSessionIds:[],minBufferTime:0,sequenceMode:e.g.mss.sequenceMode,ignoreManifestTimestampsInSegmentsMode:!1,type:"MSS",serviceDescription:null,nextUrl:null,periodCount:1,gapCount:0,isLowLatency:!1},e.i.re()),Promise.resolve(),a=Date.now(),o=(a-i)/1e3,e.B.sample(1,o),w(l)})}function vT(e,t,n,i,r,s){var a=t.attributes.Type;if("audio"!==a&&"video"!==a&&"text"!==a)return Z("Ignoring unrecognized type:",a),null;var o=t.attributes.Language,l=e.s++,u=Os(n,"Bitrate",$s),c=Os(n,"MaxWidth",$s),d=Os(n,"MaxHeight",$s),h=Os(n,"Channels",$s),f=Os(n,"SamplingRate",$s),p=s.duration;i.length&&(p=i[i.length-1].end-i[0].start);var g=e.i.getDuration();e.i.$a(Math.min(p,g));var m={id:l,originalId:t.attributes.Name||String(l),groupId:null,createSegmentIndex:function(){return Promise.resolve()},closeSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:"",codecs:"",frameRate:void 0,pixelAspectRatio:void 0,bandwidth:u||0,width:c||void 0,height:d||void 0,kind:"",encrypted:0<r.length,drmInfos:r,keyIds:new Set,language:hi(o||"und"),originalLanguage:o,label:"",type:"",primary:!1,trickModeVideo:null,emsgSchemeIdUris:[],roles:[],forced:!1,channelsCount:h,audioSamplingRate:f,spatialAudio:!1,closedCaptions:null,hdr:void 0,colorGamut:void 0,videoLayout:void 0,tilesLayout:void 0,matchedStreams:[],mssPrivateData:{duration:p,timescale:s.timescale,codecPrivateData:null},accessibilityPurpose:null,external:!1,fastSwitching:!1,fullMimeTypes:new Set};if((r=t.attributes.Subtype)&&((r=wT[r])&&m.roles.push(r),"main"===r&&(m.primary=!0)),r=n.attributes.FourCC,null!==r&&""!==r||(r=t.attributes.FourCC),!r)if("audio"===a)r="AAC";else if("video"===a)return Z('FourCC is not defined whereas it is required for a QualityLevel element for a StreamIndex of type "video"'),null;if(!ST.includes(r.toUpperCase()))return Z("Codec not supported:",r),null;switch(n=yT(n,a,r,m),m.mssPrivateData.codecPrivateData=n,a){case"audio":if(!n)return Z("Quality unsupported without CodecPrivateData",a),null;m.type="audio",m.mimeType="mss/audio/mp4",m.codecs=bT(r,n);break;case"video":if(!n)return Z("Quality unsupported without CodecPrivateData",a),null;m.type="video",m.mimeType="mss/video/mp4",m.codecs=_T(n);break;case"text":m.type=Ln,m.mimeType="application/mp4",("TTML"===r||"DFXP"===r)&&(m.codecs="stpp")}return m.fullMimeTypes.add(Fn(m.mimeType,m.codecs)),m.createSegmentIndex=function(){if(m.segmentIndex)return Promise.resolve();if(e.m.has(m.id))var n=e.m.get(m.id);else n=[],"video"==m.type&&(n=m.mssPrivateData.codecPrivateData.split("00000001").slice(1)),n={id:m.id,type:m.type,codecs:m.codecs,encrypted:m.encrypted,timescale:m.mssPrivateData.timescale,duration:m.mssPrivateData.duration,ab:n,ma:new Uint8Array([]),wa:new Uint8Array([]),Ba:0,Ca:0,data:null,stream:m},n=$_(new H_([n])),e.m.set(m.id,n);return n=TT(e,new Ya(function(){return[]},0,null,Lu(m),m.mssPrivateData.timescale,n),m,t,i),m.segmentIndex=new tu(n),Promise.resolve()},m.closeSegmentIndex=function(){m.segmentIndex&&(m.segmentIndex.release(),m.segmentIndex=null)},m}function yT(e,t,n,i){if(e=e.attributes.CodecPrivateData)return e;if("audio"!==t)return null;t=i.channelsCount||2,e=i.audioSamplingRate||44100;var r={96000:0,88200:1,64000:2,48000:3,44100:4,32000:5,24000:6,22050:7,16000:8,12000:9,11025:10,8000:11,7350:12};return i=r[e],"AACH"===n?(n=new Uint8Array(4),e=r[2*e],n[0]=40|i>>1,n[1]=i<<7|t<<3|e>>1,n[2]=e<<7|8,n[3]=0,t=new Uint16Array(2),t[0]=(n[0]<<8)+n[1],t[1]=(n[2]<<8)+n[3],t[0].toString(16)+t[1].toString(16)):(n=new Uint8Array(2),n[0]=16|i>>1,n[1]=i<<7|t<<3,t=new Uint16Array(1),t[0]=(n[0]<<8)+n[1],t[0].toString(16))}function bT(e,t){var n=0;return"AACH"===e&&(n=5),t?0===n&&(n=(248&parseInt(t.substr(0,2),16))>>3):(n=2,"AACH"===e&&(n=5)),"mp4a.40."+n}function _T(e){var t=/00000001[0-9]7/.exec(e);return t.length&&e?"avc1."+e.substr(e.indexOf(t[0])+10,6):""}function TT(e,t,n,i,r){var s=i.attributes.Url.replace("{bitrate}",String(n.bandwidth));i=[];var a={};r=c(r);for(var o=r.next();!o.done;a={fd:a.fd},o=r.next())a.fd=o.value,i.push(new Qa(a.fd.start,a.fd.end,function(t){return function(){return An(e.l,[s.replace("{start time}",String(t.fd.og))])}}(a),0,null,t,0,0,n.mssPrivateData.duration));return i}i=pT.prototype,i.configure=function(e){this.g=e},i.start=function(e,t){var n=this;return N(function(i){if(1==i.g)return n.l=[e],n.h=t,S(i,mT(n),2);if(!n.h)throw new It(2,7,7001);return i.return(n.j)})},i.stop=function(){return this.g=this.h=null,this.l=[],this.j=null,null!=this.o&&(this.o.stop(),this.o=null),this.m.clear(),this.A.destroy()},i.update=function(){var e,t=this;return N(function(n){return 1==n.g?(E(n,2),S(n,mT(t),4)):2!=n.g?k(n,0):(e=A(n),t.h&&e?(t.h.onError(e),void w(n)):n.return())})},i.onExpirationUpdated=function(){},i.onInitialVariantChosen=function(){},i.banLocation=function(){},i.setMediaElement=function(){},G("shaka.mss.MssParser",pT);var ST="AAC AACL AACH AACP AVC1 H264 TTML DFXP".split(" "),wT={CAPT:"main",SUBT:"alternate",DESC:"main"};function ET(e,t,n,i,r,s){if(200<=n&&299>=n&&202!=n)return{uri:r||i,originalUri:i,data:t,status:n,headers:e,fromCache:!!e["x-shaka-from-cache"]};var a=null;try{a=pn(t)}catch(e){}throw new It(401==n||403==n?2:1,1,1001,i,n,a,e,s,r||i)}function xT(){}function kT(e,t,n,i,r){var s=new LT;ss(t.headers).forEach(function(e,t){s.append(t,e)});var a=new RT,o={zg:!1,th:!1};if(e=AT(e,n,{body:t.body||void 0,headers:s,method:t.method,signal:a.signal,credentials:t.allowCrossSiteCredentials?"include":void 0},o,i,r,t.streamDataCallback),e=new Cr(e,function(){return o.zg=!0,a.abort(),Promise.resolve()}),t=t.retryParameters.timeout){var l=new Ut(function(){o.th=!0,a.abort()});l.Y(t/1e3),e.finally(function(){l.stop()})}return e}function AT(e,t,n,i,r,s,a){var o,l,u,c,d,h,f,p,g,m,v,y,b;return N(function(_){switch(_.g){case 1:return o=DT,l=MT,h=d=0,f=Date.now(),E(_,2),S(_,o(e,n),4);case 4:if(u=_.h,s(IT(u.headers)),"HEAD"==n.method){_.u(5);break}return p=u.clone().body.getReader(),m=(g=u.headers.get("Content-Length"))?parseInt(g,10):0,v=function(e){function t(){var n,i,s;return N(function(o){switch(o.g){case 1:return E(o,2),S(o,p.read(),4);case 4:n=o.h,k(o,3);break;case 2:return A(o),o.return();case 3:if(n.done){o.u(5);break}if(d+=n.value.byteLength,!a){o.u(5);break}return S(o,a(n.value),5);case 5:i=Date.now(),(100<i-f||n.done)&&(s=n.done?0:m-d,r(i-f,d-h,s),h=d,f=i),n.done?e.close():(e.enqueue(n.value),t()),w(o)}})}t()},new l({start:v}),S(_,u.arrayBuffer(),6);case 6:c=_.h;case 5:k(_,3);break;case 2:if(y=A(_),i.zg)throw new It(1,1,7001,e,t);if(i.th)throw new It(1,1,1003,e,t);throw new It(1,1,1002,e,y,t);case 3:return b=IT(u.headers),_.return(ET(b,c,u.status,e,u.url,t))}})}function IT(e){var t={};return e.forEach(function(e,n){t[n.trim()]=e}),t}function CT(){if(!e.ReadableStream)return!1;try{new ReadableStream({})}catch(e){return!1}return!!e.Response&&(!!new Response("").body&&!(!e.fetch||"polyfill"in e.fetch||!e.AbortController))}Ga["application/vnd.ms-sstr+xml"]=function(){return new pT},G("shaka.net.HttpFetchPlugin",xT),xT.isSupported=CT,xT.parse=kT;var DT=e.fetch,RT=e.AbortController,MT=e.ReadableStream,LT=e.Headers;function PT(){}function OT(e,t,n,i,r){var s=new UT,a=Date.now(),o=0,l=new Promise(function(l,u){s.open(t.method,e,!0),s.responseType="arraybuffer",s.timeout=t.retryParameters.timeout,s.withCredentials=t.allowCrossSiteCredentials,s.onabort=function(){u(new It(1,1,7001,e,n))};var c=!1;for(var d in s.onreadystatechange=function(){if(2==s.readyState&&!c){var e=NT(s);r(e),c=!0}},s.onload=function(t){var r=NT(s),c=s.response;try{i(Date.now()-a,t.loaded-o,0);var d=ET(r,c,s.status,e,s.responseURL,n);l(d)}catch(e){u(e)}},s.onerror=function(t){u(new It(1,1,1002,e,t,n))},s.ontimeout=function(){u(new It(1,1,1003,e,n))},s.onprogress=function(e){var t=Date.now();(100<t-a||e.lengthComputable&&e.loaded==e.total)&&(i(t-a,e.loaded-o,4==s.readyState?0:e.total-e.loaded),o=e.loaded,a=t)},t.headers)s.setRequestHeader(d.toLowerCase(),t.headers[d]);s.send(t.body)});return new Cr(l,function(){return s.abort(),Promise.resolve()})}function NT(e){var t=e.getAllResponseHeaders().trim().split("\r\n");e={},t=c(t);for(var n=t.next();!n.done;n=t.next())n=n.value.split(": "),e[n[0].toLowerCase()]=n.slice(1).join(": ");return e}CT()&&($r("http",kT,2,!0),$r("https",kT,2,!0),$r("blob",kT,2,!0)),G("shaka.net.HttpXHRPlugin",PT),PT.parse=OT;var UT=e.XMLHttpRequest;function FT(e,t,n,i){this.g=e,this.i=t,this.groupId=n,this.h=i}function BT(e){return e.M().map(function(e){return"{"+encodeURI(e)+"}"}).join("")+":"+e.Ha+":"+e.sa}function jT(e,t){return ju(e.g.M(),e.g.Ha,e.g.sa,t.streaming.retryParameters)}function VT(){this.h=this.j=this.i=0,this.g=new Map,this.l=0}function HT(e,t){e.i+=t;var n=e.l;return e.l++,e.g.set(n,t),n}function $T(e){var t=this;this.o=e,this.j=new Map,this.i=new ts(function(){return zT(t).catch(function(){})}),this.h=[],this.m=function(){},this.l=function(){},this.g=new VT}function GT(e,t,n){e.m=t,e.l=n}function zT(e){var t=e.h.map(function(e){return e()});return e.h=[],Promise.all(t)}function qT(e,t,n,i,r,s){ns(e.i);var a=(e.j.get(t)||Promise.resolve()).then(function(){var t,a,o,l,u,c,d;return N(function(h){if(1==h.g)return S(h,KT(e,n),2);if(t=h.h,e.i.g)throw new It(2,9,7001);if(r)for(l in a=Ee(t),o=new Ts(a),o.data)u=Number(l),c=o.data[u],d=o.g[u],e.l(c,d);e.g.close(i,t.byteLength);var f=e.g;return e.m(0==f.i?0:f.j/f.i,e.g.h),h.return(s(t))})});e.j.set(t,a)}function WT(e){return N(function(t){return 1==t.g?S(t,Promise.all(e.j.values()),2):t.return(e.g.h)})}function KT(e,t){var n,i,r,s;return N(function(a){return 1==a.g?(n=Zr,i=e.o.request(n,t),r=function(){return i.abort()},e.h.push(r),S(a,i.promise,2)):(s=a.h,Ne(e.h,r),a.return(s.data))})}function YT(e,t){var n=this;this.i=e,this.h=e.objectStore(t),this.g=new Ir,e.onabort=function(e){e.preventDefault(),n.g.reject()},e.onerror=function(e){e.preventDefault(),n.g.reject()},e.oncomplete=function(){n.g.resolve()}}function XT(e,t){return new Promise(function(n,i){var r=e.h.openCursor();r.onerror=i,r.onsuccess=function(){var e;return N(function(i){if(1==i.g)return null==r.result?(n(),i.return()):(e=r.result,S(i,t(e.key,e.value,e),2));e.continue(),w(i)})}})}function QT(e){this.h=e,this.g=[]}function ZT(e,t){return JT(e,t,"readwrite")}function JT(e,t,n){n=e.h.transaction([t],n);var i=new YT(n,t);return e.g.push(i),i.promise().then(function(){Ne(e.g,i)},function(){Ne(e.g,i)}),i}function eS(e,t,n){this.h=new QT(e),this.i=t,this.g=n}function tS(e,t,n){e=ZT(e.h,e.g);var i=e.store();return i.get(t).onsuccess=function(){i.put(n,t)},e.promise()}function nS(e){return Promise.reject(new It(2,9,9011,"Cannot add new value to "+e))}function iS(e,t,n,i){e=ZT(e.h,t),t=e.store();var r={};n=c(n);for(var s=n.next();!s.done;r={Wd:r.Wd},s=n.next())r.Wd=s.value,t.delete(r.Wd).onsuccess=function(e){return function(){return i(e.Wd)}}(r);return e.promise()}function rS(e,t,n){var i,r,s,a,o,l,u;return N(function(d){if(1==d.g){for(i=JT(e.h,t,"readonly"),r=i.store(),s={},a=[],o={},l=c(n),u=l.next();!u.done;o={dd:o.dd,ad:o.ad},u=l.next())o.ad=u.value,o.dd=r.get(o.ad),o.dd.onsuccess=function(e){return function(){void 0==e.dd.result&&a.push(e.ad),s[e.ad]=e.dd.result}}(o);return S(d,i.promise(),2)}if(a.length)throw new It(2,9,9012,"Could not find values for "+a);return d.return(n.map(function(e){return s[e]}))})}function sS(e){this.g=new QT(e)}function aS(){this.g=new Map}function oS(e){var t=null;if(e.g.forEach(function(e,n){e.getCells().forEach(function(e,i){e.hasFixedKeySpace()||t||(t={path:{ob:n,Ja:i},Ja:e})})}),t)return t;throw new It(2,9,9013,"Could not find a cell that supports add-operations")}function lS(e,t){e.g.forEach(function(e,n){e.getCells().forEach(function(e,i){t({ob:n,Ja:i},e)})})}function uS(e,t,n){if(e=e.g.get(t),!e)throw new It(2,9,9013,"Could not find mechanism with name "+t);if(t=e.getCells().get(n),!t)throw new It(2,9,9013,"Could not find cell with name "+n);return t}function cS(e,t){e.g.forEach(function(e){t(e.getEmeSessionCell())})}function dS(e){var t=Array.from(e.g.keys());if(!t.length)throw new It(2,9,9e3,"No supported storage mechanisms found");return e.g.get(t[0]).getEmeSessionCell()}function hS(e){var t,n,i;return N(function(r){return 1==r.g?(t=Array.from(e.g.values()),n=0<t.length,n||(i=pS,i.forEach(function(e){(e=e())&&t.push(e)})),S(r,Promise.all(t.map(function(e){return e.erase()})),2)):n?r.u(0):S(r,Promise.all(t.map(function(e){return e.destroy()})),0)})}function fS(e,t){pS.set(e,t)}$r("http",OT,1,!0),$r("https",OT,1,!0),$r("blob",OT,1,!0),VT.prototype.close=function(e,t){if(this.g.has(e)){var n=this.g.get(e);this.g.delete(e),this.j+=n,this.h+=t}},$T.prototype.destroy=function(){return this.i.destroy()},YT.prototype.abort=function(){var e=this;return N(function(t){if(1==t.g){try{e.i.abort()}catch(e){}return E(t,2),S(t,e.g,4)}if(2!=t.g)return k(t,0);A(t),w(t)})},YT.prototype.store=function(){return this.h},YT.prototype.promise=function(){return this.g},QT.prototype.destroy=function(){return Promise.all(this.g.map(function(e){return e.abort()}))},i=eS.prototype,i.destroy=function(){return this.h.destroy()},i.hasFixedKeySpace=function(){return!0},i.addSegments=function(){return nS(this.i)},i.removeSegments=function(e,t){return iS(this,this.i,e,t)},i.getSegments=function(e){var t,n=this;return N(function(i){return 1==i.g?S(i,rS(n,n.i,e),2):(t=i.h,i.return(t.map(function(e){return n.Cg(e)})))})},i.addManifests=function(){return nS(this.g)},i.updateManifest=function(){return Promise.reject(new It(2,9,9016,"Cannot modify values in "+this.g))},i.updateManifestExpiration=function(e,t){var n=ZT(this.h,this.g),i=n.store();return i.get(e).onsuccess=function(n){(n=n.target.result)&&(n.expiration=t,i.put(n,e))},n.promise()},i.removeManifests=function(e,t){return iS(this,this.g,e,t)},i.getManifests=function(e){var t,n=this;return N(function(i){return 1==i.g?S(i,rS(n,n.g,e),2):(t=i.h,i.return(Promise.all(t.map(function(e){return n.od(e)}))))})},i.getAllManifests=function(){var e,t,n=this;return N(function(i){return 1==i.g?(e=JT(n.h,n.g,"readonly"),t=new Map,S(i,XT(e,function(e,i){var r;return N(function(s){if(1==s.g)return S(s,n.od(i),2);r=s.h,t.set(e,r),w(s)})}),2)):3!=i.g?S(i,e.promise(),3):i.return(t)})},i.Cg=function(e){return e},i.od=function(e){return Promise.resolve(e)},i.add=function(e,t){var n,i,r,s,a,o,l,u=this;return N(function(d){if(1==d.g){for(n=ZT(u.h,e),i=n.store(),r=[],s={},a=c(t),o=a.next();!o.done;s={Xd:s.Xd},o=a.next())l=o.value,s.Xd=i.add(l),s.Xd.onsuccess=function(e){return function(){r.push(e.Xd.result)}}(s);return S(d,n.promise(),2)}return d.return(r)})},sS.prototype.destroy=function(){return this.g.destroy()},sS.prototype.getAll=function(){var e,t,n=this;return N(function(i){return 1==i.g?(e=JT(n.g,"session-ids","readonly"),t=[],S(i,XT(e,function(e,n){t.push(n)}),2)):3!=i.g?S(i,e.promise(),3):i.return(t)})},sS.prototype.add=function(e){var t=ZT(this.g,"session-ids"),n=t.store();e=c(e);for(var i=e.next();!i.done;i=e.next())n.add(i.value);return t.promise()},sS.prototype.remove=function(e){var t,n=this;return N(function(i){return 1==i.g?(t=ZT(n.g,"session-ids"),S(i,XT(t,function(t,n,i){e.includes(n.sessionId)&&i.delete()}),2)):S(i,t.promise(),0)})},aS.prototype.destroy=function(){for(var e=[],t=c(this.g.values()),n=t.next();!n.done;n=t.next())e.push(n.value.destroy());return this.g.clear(),Promise.all(e)},aS.prototype.init=function(){var e=this;pS.forEach(function(t,n){(t=t())&&e.g.set(n,t)});for(var t=[],n=c(this.g.values()),i=n.next();!i.done;i=n.next())t.push(i.value.init());return Promise.all(t)},G("shaka.offline.StorageMuxer",aS),aS.unregister=function(e){pS.delete(e)},aS.register=fS,aS.prototype.destroy=aS.prototype.destroy;var pS=new Map;function gS(){eS.apply(this,arguments)}function mS(e,t){bS(e);for(var n=c(e.streams),i=n.next();!i.done;i=n.next());return e.streams.map(function(n){return vS(n,e.startTime,t)})}function vS(e,t,n){var i=e.initSegmentUri?yS(e.initSegmentUri):null,r=t+e.presentationTimeOffset,s=t+n;return{id:e.id,originalId:null,groupId:null,primary:e.primary,type:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:void 0,hdr:void 0,colorGamut:void 0,videoLayout:void 0,kind:e.kind,language:e.language,originalLanguage:e.language||null,label:e.label,width:e.width,height:e.height,initSegmentKey:i,encrypted:e.encrypted,keyIds:new Set([e.keyId]),segments:e.segments.map(function(e){var n=yS(e.uri);return{startTime:t+e.startTime,endTime:t+e.endTime,dataKey:n,initSegmentKey:i,appendWindowStart:t,appendWindowEnd:s,timestampOffset:r,tilesLayout:"",mimeType:null,codecs:null}}),variantIds:e.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0,external:!1,fastSwitching:!1}}function yS(e){var t;if((t=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e))||(t=/^offline:segment\/([0-9]+)$/.exec(e)))return Number(t[1]);throw new It(2,9,9004,"Could not parse uri "+e)}function bS(e){var t=e.streams.filter(function(e){return"audio"==e.contentType});if(e=e.streams.filter(function(e){return"video"==e.contentType}),!t.every(function(e){return e.variantIds})||!e.every(function(e){return e.variantIds})){for(var n=c(t),i=n.next();!i.done;i=n.next())i.value.variantIds=[];for(n=c(e),i=n.next();!i.done;i=n.next())i.value.variantIds=[];if(n=0,e.length&&!t.length){var r=n++,s=c(e);for(i=s.next();!i.done;i=s.next())i.value.variantIds.push(r)}if(!e.length&&t.length)for(r=n++,s=c(t),i=s.next();!i.done;i=s.next())i.value.variantIds.push(r);if(e.length&&t.length)for(t=c(t),i=t.next();!i.done;i=t.next())for(i=i.value,r=c(e),s=r.next();!s.done;s=r.next()){s=s.value;var a=n++;i.variantIds.push(a),s.variantIds.push(a)}}}function _S(){eS.apply(this,arguments)}function TS(e,t,n){return{id:e.id,originalId:e.originalId,groupId:null,primary:e.primary,type:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:e.pixelAspectRatio,hdr:void 0,colorGamut:void 0,videoLayout:void 0,kind:e.kind,language:e.language,originalLanguage:e.language||null,label:e.label,width:e.width,height:e.height,encrypted:e.encrypted,keyIds:new Set([e.keyId]),segments:e.segments.map(function(i){return{startTime:t+i.startTime,endTime:t+i.endTime,initSegmentKey:e.initSegmentKey,appendWindowStart:t,appendWindowEnd:n,timestampOffset:t-e.presentationTimeOffset,dataKey:i.dataKey,tilesLayout:"",mimeType:null,codecs:null}}),variantIds:e.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0,external:!1,fastSwitching:!1}}function SS(){eS.apply(this,arguments)}function wS(){this.m=this.j=this.i=this.h=this.g=this.l=null}function ES(){var t=new Ir,n=e.indexedDB.deleteDatabase("shaka_offline_db");return n.onblocked=function(){},n.onsuccess=function(){t.resolve()},n.onerror=function(e){t.reject(new It(2,9,9001,n.error)),e.preventDefault()},t}function xS(e,t,n,i){this.g=e,this.i=t,this.h=n,this.l=i,this.j=["offline:",e,"/",t,"/",n,"/",i].join("")}function kS(e){if(e=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e),null==e)return null;var t=e[1];if("manifest"!=t&&"segment"!=t)return null;var n=e[2];if(!n)return null;var i=e[3];return i&&null!=t?new xS(t,n,i,Number(e[4])):null}function AS(e,t){this.h=e,this.g=t}function IS(e,t){var n=new Ll(null,0);n.$a(t.duration);var i=t.streams.filter(function(e){return"audio"==e.type}),r=t.streams.filter(function(e){return"video"==e.type});i=CS(e,i,r,n),r=t.streams.filter(function(e){return e.type==Ln}).map(function(t){return DS(e,t,n)});var s=t.streams.filter(function(e){return"image"==e.type}).map(function(t){return DS(e,t,n)}),a=t.drmInfo?[t.drmInfo]:[];if(t.drmInfo)for(var o=c(i.values()),l=o.next();!l.done;l=o.next())l=l.value,l.audio&&l.audio.encrypted&&(l.audio.drmInfos=a),l.video&&l.video.encrypted&&(l.video.drmInfos=a);return{presentationTimeline:n,minBufferTime:2,offlineSessionIds:t.sessionIds,variants:Array.from(i.values()),textStreams:r,imageStreams:s,sequenceMode:t.sequenceMode||!1,ignoreManifestTimestampsInSegmentsMode:!1,type:t.type||"UNKNOWN",serviceDescription:null,nextUrl:null,periodCount:1,gapCount:0,isLowLatency:!1}}function CS(e,t,n,i){for(var r=new Set,s=c(t),a=s.next();!a.done;a=s.next()){var o=c(a.value.variantIds);for(a=o.next();!a.done;a=o.next())r.add(a.value)}for(s=c(n),a=s.next();!a.done;a=s.next())for(o=c(a.value.variantIds),a=o.next();!a.done;a=o.next())r.add(a.value);for(s=new Map,r=c(r),a=r.next();!a.done;a=r.next())a=a.value,s.set(a,{id:a,language:"",disabledUntilTime:0,primary:!1,audio:null,video:null,bandwidth:0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});for(t=c(t),r=t.next();!r.done;r=t.next())for(r=r.value,a=DS(e,r,i),o=c(r.variantIds),r=o.next();!r.done;r=o.next())r=s.get(r.value),r.language=a.language,r.primary=r.primary||a.primary,r.audio=a;for(n=c(n),t=n.next();!t.done;t=n.next())for(r=t.value,t=DS(e,r,i),a=c(r.variantIds),r=a.next();!r.done;r=a.next())r=s.get(r.value),r.primary=r.primary||t.primary,r.video=t;return s}function DS(e,t,n){var i=t.segments.map(function(n){return RS(e,n,t)});return n.Jd(i),{id:t.id,originalId:t.originalId,groupId:t.groupId,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new tu(i),mimeType:t.mimeType,codecs:t.codecs,width:t.width||void 0,height:t.height||void 0,frameRate:t.frameRate,pixelAspectRatio:t.pixelAspectRatio,hdr:t.hdr,colorGamut:t.colorGamut,videoLayout:t.videoLayout,kind:t.kind,encrypted:t.encrypted,drmInfos:[],keyIds:t.keyIds,language:t.language,originalLanguage:t.originalLanguage||null,label:t.label,type:t.type,primary:t.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:t.roles,forced:t.forced,channelsCount:t.channelsCount,audioSamplingRate:t.audioSamplingRate,spatialAudio:t.spatialAudio,closedCaptions:t.closedCaptions,tilesLayout:t.tilesLayout,accessibilityPurpose:null,external:t.external,fastSwitching:t.fastSwitching,fullMimeTypes:new Set([Fn(t.mimeType,t.codecs)])}}function RS(e,t,n){var i=new xS("segment",e.h,e.g,t.dataKey);return e=new Qa(t.startTime,t.endTime,function(){return[i.toString()]},0,null,null!=t.initSegmentKey?MS(e,t.initSegmentKey):null,t.timestampOffset,t.appendWindowStart,t.appendWindowEnd,[],t.tilesLayout||""),e.mimeType=t.mimeType||n.mimeType||"",e.codecs=t.codecs||n.codecs||"",e}function MS(e,t){var n=new xS("segment",e.h,e.g,t);return new Ya(function(){return[n.toString()]},0,null)}function LS(){this.g=null}function PS(){}function OS(e){var t=kS(e);return t&&"manifest"==t.g?(e={uri:e,originalUri:e,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}},e=Mr(e)):e=t&&"segment"==t.g?NS(t.key(),t):Dr(new It(2,1,9004,e)),e}function NS(e,t){var n=new aS;return Mr(void 0).Aa(function(){return n.init()}).Aa(function(){return uS(n,t.ob(),t.Ja())}).Aa(function(e){return e.getSegments([t.key()])}).Aa(function(e){return{uri:t,data:e[0].data,headers:{}}}).finally(function(){return n.destroy()})}function US(e,t,n){var i,r,s,a,o,l;return N(function(u){switch(u.g){case 1:i=[];for(var d=[],h=c(n),f=h.next();!f.done;f=h.next()){f=f.value;for(var p=!1,g=c(d),m=g.next();!m.done;m=g.next())if(m=m.value,BS(m.info,f)){m.sessionIds.push(f.sessionId),p=!0;break}p||d.push({info:f,sessionIds:[f.sessionId]})}r=c(d),s=r.next();case 2:if(s.done){u.u(4);break}return a=s.value,o=FS(e,t,a),S(u,o,5);case 5:l=u.h,i=i.concat(l),s=r.next(),u.u(2);break;case 4:return u.return(i)}})}function FS(e,t,n){var i,r;return N(function(s){switch(s.g){case 1:return i=new Js({Nb:t,onError:function(){},Ae:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),E(s,2),i.configure(e),S(s,ia(i,n.info.keySystem,n.info.licenseUri,n.info.serverCertificate,n.info.audioCapabilities,n.info.videoCapabilities),4);case 4:k(s,3);break;case 2:return A(s),S(s,i.destroy(),5);case 5:return s.return([]);case 3:return r=[],S(s,Promise.all(n.sessionIds.map(function(e){return N(function(t){return 1==t.g?(E(t,2),S(t,la(i,e),4)):2!=t.g?(r.push(e),k(t,0)):(A(t),void w(t))})})),6);case 6:return S(s,i.destroy(),7);case 7:return s.return(r)}})}function BS(e,t){function n(e,t){return e.robustness==t.robustness&&e.contentType==t.contentType}return e.keySystem==t.keySystem&&e.licenseUri==t.licenseUri&&Ue(e.audioCapabilities,t.audioCapabilities,n)&&Ue(e.videoCapabilities,t.videoCapabilities,n)}function jS(e,t,n){var i=t.presentationTimeline.getDuration();return t=HS(t),{offlineUri:null,originalManifestUri:e,duration:i,size:0,expiration:1/0,tracks:t,appMetadata:n,isIncomplete:!1}}function VS(e,t){var n=IS(new AS(e.ob(),e.Ja()),t),i=t.appMetadata||{};return n=HS(n),{offlineUri:e.toString(),originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:t.expiration,tracks:n,appMetadata:i,isIncomplete:t.isIncomplete||!1}}function HS(e){var t=[],n=Wi(e.variants);n=c(n);for(var i=n.next();!i.done;i=n.next())t.push(Bi(i.value));for(e=c(e.textStreams),n=e.next();!n.done;n=e.next())t.push(ji(n.value));return t}function $S(){this.g={}}function GS(e,t){var n=t.audio,i=t.video;if(n&&!i&&(e.g[n.id]=n.bandwidth||t.bandwidth),!n&&i&&(e.g[i.id]=i.bandwidth||t.bandwidth),n&&i){var r=n.bandwidth||393216,s=i.bandwidth||t.bandwidth-r;0>=s&&(s=t.bandwidth),e.g[n.id]=r,e.g[i.id]=s}}function zS(e,t){e.g[t.id]=t.bandwidth||2048}function qS(e,t){return e=e.g[t],null==e&&(e=0),e}function WS(e){var t=this;if(e&&e.constructor!=eh)throw new It(2,9,9008);this.g=this.h=null,e?(this.h=e.g,this.g=e.zb()):(this.h=Lc(),this.g=new Hr),this.i=[],this.j=[];var n=!e;this.l=new ts(function(){var e,i,r,s,a;return N(function(o){switch(o.g){case 1:return S(o,Promise.all(t.j.map(function(e){return zT(e)})),2);case 2:for(e=function(){},i=[],r=c(t.i),s=r.next();!s.done;s=r.next())a=s.value,i.push(a.then(e,e));return S(o,Promise.all(i),3);case 3:if(!n){o.u(4);break}return S(o,t.g.destroy(),4);case 4:t.h=null,t.g=null,w(o)}})})}function KS(){if(Ft())e:{for(var e=c(pS.values()),t=e.next();!t.done;t=e.next())if(t=t.value,t=t()){t.destroy(),e=!0;break e}e=!1}else e=!1;return e}function YS(e,t,n,i,r,s){var a,o,l,u,c,d,h,f,p,g,m,v,y,b;return N(function(_){switch(_.g){case 1:return gw(),o=a=null,l=new aS,d=c=u=null,E(_,2,3),S(_,i(),5);case 5:return a=_.h,S(_,cw(e,t,a,r),6);case 6:if(h=_.h,pw(e),f=!h.presentationTimeline.V()&&!h.presentationTimeline.qc(),!f)throw new It(2,9,9005,t);return S(_,e.Dc(h,function(e){d=d||e},r),7);case 7:if(o=_.h,pw(e),d)throw d;return S(_,JS(h,o,r),8);case 8:return S(_,l.init(),9);case 9:return pw(e),S(_,oS(l),10);case 10:return u=_.h,pw(e),p=ew(o,h,t,n,r,s),g=p.Bi,m=p.lg,S(_,u.Ja.addManifests([g]),11);case 11:if(v=_.h,pw(e),c=v[0],pw(e),d)throw d;return S(_,XS(e,m,c,g,s,r,u.Ja,h,o),12);case 12:return pw(e),iw(h,g,o,r),S(_,u.Ja.updateManifest(c,g),13);case 13:return pw(e),y=new xS("manifest",u.path.ob,u.path.Ja,c),_.return(VS(y,g));case 3:return I(_),S(_,l.destroy(),14);case 14:if(!a){_.u(15);break}return S(_,a.stop(),15);case 15:if(!o){_.u(17);break}return S(_,o.destroy(),17);case 17:C(_,0);break;case 2:if(b=A(_),null==c){_.u(19);break}return S(_,QS(c),19);case 19:throw d||b}})}function XS(e,t,n,i,r,s,a,o,l){var u,d,h,f,p,g,m,v,y,b;return N(function(_){switch(_.g){case 1:if(u={},d=0,h=function(t,h){var f,p,g,m,v,y,b;return N(function(_){if(1==_.g){for(f={},p=c(t),g=p.next();!g.done;f={ic:f.ic},g=p.next())f.ic=g.value,m=jT(f.ic,s),v=f.ic.i,y=f.ic.h,b=function(t){return function(n){var i,r,s;return N(function(o){if(1==o.g)return S(o,a.addSegments([{data:n}]),2);i=o.h,pw(e),r=t.ic.g,s=BT(r),u[s]=i[0],d+=n.byteLength,w(o)})}}(f),qT(r,f.ic.groupId,m,v,y,b);return S(_,WT(r),2)}return h?(pw(e),iw(o,i,l,s),S(_,a.updateManifest(n,i),0)):_.u(0)})},f=!1,E(_,2),!tw(o)||!f||nw(o)){_.u(4);break}return S(_,h(t.filter(function(e){return e.h}),!0),5);case 5:return pw(e),t=t.filter(function(e){return!e.h}),p=u,g=d,u={},d=0,S(_,ZS(a,n,i,p,g,function(){return pw(e)}),6);case 6:pw(e);case 4:if(f){_.u(7);break}return S(_,h(t,!1),8);case 8:return pw(e),m=u,v=d,u={},d=0,S(_,ZS(a,n,i,m,v,function(){return pw(e)}),9);case 9:pw(e);case 7:k(_,0);break;case 2:return y=A(_),b=Object.values(u),S(_,a.removeSegments(b,function(){}),10);case 10:throw y}})}function QS(e){var t,n,i,r;return N(function(s){switch(s.g){case 1:return t=new aS,S(s,t.init(),2);case 2:return S(s,oS(t),3);case 3:return n=s.h,i=new xS("manifest",n.path.ob,n.path.Ja,e),S(s,t.destroy(),4);case 4:return r=new WS,S(s,r.remove(i.toString()),0)}})}function ZS(e,t,n,i,r,s){var a,o,l,u,d,h,f,p,g,m,v;return N(function(y){switch(y.g){case 1:for(a=!1,E(y,2),o=!0,l=c(n.streams),u=l.next();!u.done;u=l.next())for(d=u.value,h=c(d.segments),f=h.next();!f.done;f=h.next())p=f.value,g=p.pendingSegmentRefId?i[p.pendingSegmentRefId]:null,null!=g&&(p.dataKey=g,p.pendingSegmentRefId=void 0),g=p.pendingInitSegmentRefId?i[p.pendingInitSegmentRefId]:null,null!=g&&(p.initSegmentKey=g,p.pendingInitSegmentRefId=void 0),p.pendingSegmentRefId&&(o=!1),p.pendingInitSegmentRefId&&(o=!1);return n.size+=r,o&&(n.isIncomplete=!1),S(y,e.updateManifest(t,n),4);case 4:a=!0,s(),k(y,0);break;case 2:return m=A(y),S(y,QS(t),5);case 5:if(a){y.u(6);break}return v=Object.values(i),S(y,e.removeSegments(v,function(){}),6);case 6:throw m}})}function JS(e,t,n){var i,r,s,a,o,l,u,d,h,f,p,g,m,v,y,b,_,T,x,I,C,D,R,M,L,P,O,U;return N(function(N){switch(N.g){case 1:return i={width:1/0,height:1/0},wi(e,n.restrictions,i),S(N,Ai(t,e,n.offline.usePersistentLicense,n.drm.preferredKeySystems),2);case 2:for(r=[],s=n.preferredDecodingAttributes,a=n.preferredVideoCodecs,o=n.preferredAudioCodecs,Ti(e,a,o,s),l=c(e.variants),u=l.next();!u.done;u=l.next())d=u.value,r.push(Bi(d));for(h=c(e.textStreams),f=h.next();!f.done;f=h.next())p=f.value,r.push(ji(p));for(g=c(e.imageStreams),m=g.next();!m.done;m=g.next())v=m.value,r.push(Vi(v));return S(N,n.offline.trackSelectionCallback(r),3);case 3:for(y=N.h,b=e.presentationTimeline.getDuration(),_=0,T=c(y),x=T.next();!x.done;x=T.next())I=x.value,C=I.bandwidth*b/8,_+=C;return E(N,4),S(N,n.offline.downloadSizeCallback(_),6);case 6:if(D=N.h,!D)throw new It(2,9,9014);k(N,5);break;case 4:if(R=A(N),R instanceof It)throw R;throw new It(2,9,9015);case 5:for(M=new Set,L=new Set,P=new Set,O=c(y),x=O.next();!x.done;x=O.next())U=x.value,"variant"==U.type&&M.add(U.id),"text"==U.type&&L.add(U.id),"image"==U.type&&P.add(U.id);e.variants=e.variants.filter(function(e){return M.has(e.id)}),e.textStreams=e.textStreams.filter(function(e){return L.has(e.id)}),e.imageStreams=e.imageStreams.filter(function(e){return P.has(e.id)}),Tw(e),w(N)}})}function ew(e,t,n,i,r,s){var a=jS(n,t,i),o=r.offline.progressCallback;GT(s,function(e,t){a.size=t,o(a,e)},function(t,n){l&&r.offline.usePersistentLicense&&u==n&&ca(e,"cenc",t)});var l=tw(t)&&!nw(t),u=null;l&&(u=Sw.get(e.g.keySystem));for(var d=new $S,h=c(t.textStreams),f=h.next();!f.done;f=h.next())d.g[f.value.id]=52;for(h=c(t.imageStreams),f=h.next();!f.done;f=h.next())zS(d,f.value);for(f=c(t.variants),h=f.next();!h.done;h=f.next())GS(d,h.value);return d=dw(s,d,t,r),s=d.streams,d=d.lg,f=e.g,h=r.offline.usePersistentLicense,f&&h&&(f.initData=[]),{Bi:{creationTime:Date.now(),originalManifestUri:n,duration:t.presentationTimeline.getDuration(),size:0,expiration:e.td(),streams:s,sessionIds:h?da(e):[],drmInfo:f,appMetadata:i,isIncomplete:!0,sequenceMode:t.sequenceMode,type:t.type},lg:d}}function tw(e){return e.variants.some(function(e){var t=e.audio&&e.audio.encrypted;return e.video&&e.video.encrypted||t})}function nw(e){return e.variants.some(function(e){return(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[]).some(function(e){return e.initData&&e.initData.length})})}function iw(e,t,n,i){if(t.expiration=n.td(),n=da(n),t.sessionIds=i.offline.usePersistentLicense?n:[],tw(e)&&i.offline.usePersistentLicense&&!n.length)throw new It(2,9,9007)}function rw(e,t){var n,i,r,s,a,o;return N(function(l){switch(l.g){case 1:if(gw(),n=kS(t),null==n||"manifest"!=n.g)throw new It(2,9,9004,t);return i=n,r=new aS,x(l,2),S(l,r.init(),4);case 4:return S(l,uS(r,i.ob(),i.Ja()),5);case 5:return s=l.h,S(l,s.getManifests([i.key()]),6);case 6:return a=l.h,o=a[0],S(l,Promise.all([aw(e,o,r),ow(s,i,o)]),2);case 2:return I(l),S(l,r.destroy(),8);case 8:C(l,0)}})}function sw(e,t){for(var n=[],i=c(e.streams),r=i.next();!r.done;r=i.next())r=r.value,t&&"video"==r.type?n.push({contentType:Fn(r.mimeType,r.codecs),robustness:e.drmInfo.videoRobustness}):t||"audio"!=r.type||n.push({contentType:Fn(r.mimeType,r.codecs),robustness:e.drmInfo.audioRobustness});return n}function aw(e,t,n){return N(function(i){return S(i,bw(e.g,e.h.drm,n,t),0)})}function ow(e,t,n){function i(){}var r=yw(n);return VS(t,n),Promise.all([e.removeSegments(r,i),e.removeManifests([t.key()],i)])}function lw(e){var t,n,i,r,s,a,o,l,u,d;return N(function(h){switch(h.g){case 1:return gw(),t=e.g,n=e.h.drm,i=new aS,r=!1,x(h,2),S(h,i.init(),4);case 4:s=[],cS(i,function(e){return s.push(e)}),a=c(s),o=a.next();case 5:if(o.done){h.u(2);break}return l=o.value,S(h,l.getAll(),8);case 8:return u=h.h,S(h,US(n,t,u),9);case 9:return d=h.h,S(h,l.remove(d),10);case 10:d.length!=u.length&&(r=!0),o=a.next(),h.u(5);break;case 2:return I(h),S(h,i.destroy(),11);case 11:C(h,3);break;case 3:return h.return(!r)}})}function uw(){var e,t,n;return N(function(i){switch(i.g){case 1:return gw(),e=[],t=new aS,x(i,2),S(i,t.init(),4);case 4:return n=Promise.resolve(),lS(t,function(t,i){n=n.then(function(){var n;return N(function(r){if(1==r.g)return S(r,i.getAllManifests(),2);n=r.h,n.forEach(function(n,i){n=VS(new xS("manifest",t.ob,t.Ja,i),n),e.push(n)}),w(r)})})}),S(i,n,2);case 2:return I(i),S(i,t.destroy(),6);case 6:C(i,3);break;case 3:return i.return(e)}})}function cw(e,t,n,i){var r,s,a,o,l;return N(function(u){if(1==u.g)return r=null,s=e.g,a={networkingEngine:s,filter:function(){return Promise.resolve()},makeTextStreamsForClosedCaptions:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(e){r=e},isLowLatencyMode:function(){return!1},isAutoLowLatencyMode:function(){return!1},enableLowLatencyMode:function(){},updateDuration:function(){},newDrmInfo:function(){},onManifestUpdated:function(){},getBandwidthEstimate:function(){return i.abr.defaultBandwidthEstimate},onMetadata:function(){},disableStream:function(){}},n.configure(i.manifest),pw(e),S(u,n.start(t,a),2);if(3!=u.g)return o=u.h,pw(e),l=_w(o),S(u,Promise.all(is(l,function(e){return e.createSegmentIndex()})),3);if(pw(e),r)throw r;return u.return(o)})}function dw(e,t,n,i){var r=new Map,s=_w(n),a=new Map;s=c(s);for(var o=s.next();!o.done;o=s.next()){o=o.value;var l=hw(e,t,n,o,i,r);a.set(o.id,l)}for(e=c(n.variants),t=e.next();!t.done;t=e.next())t=t.value,t.audio&&a.get(t.audio.id).variantIds.push(t.id),t.video&&a.get(t.video.id).variantIds.push(t.id);return{streams:Array.from(a.values()),lg:Array.from(r.values())}}function hw(e,t,n,i,r,s){var a={id:i.id,originalId:i.originalId,groupId:i.groupId,primary:i.primary,type:i.type,mimeType:i.mimeType,codecs:i.codecs,frameRate:i.frameRate,pixelAspectRatio:i.pixelAspectRatio,hdr:i.hdr,colorGamut:i.colorGamut,videoLayout:i.videoLayout,kind:i.kind,language:i.language,originalLanguage:i.originalLanguage,label:i.label,width:i.width||null,height:i.height||null,encrypted:i.encrypted,keyIds:i.keyIds,segments:[],variantIds:[],roles:i.roles,forced:i.forced,channelsCount:i.channelsCount,audioSamplingRate:i.audioSamplingRate,spatialAudio:i.spatialAudio,closedCaptions:i.closedCaptions,tilesLayout:i.tilesLayout,external:i.external,fastSwitching:i.fastSwitching},o=r.offline.numberOfParallelDownloads,l=0;return fw(i,n.presentationTimeline.nb(),function(n){var r=BT(n),u=void 0;if(!s.has(r)){var c=n.endTime-n.startTime;c=qS(t,i.id)*c,c=HT(e.g,c),s.set(r,new FT(n,c,l,!1))}n.$&&(u=BT(n.$),s.has(u)||(c=.5*qS(t,i.id),c=HT(e.g,c),s.set(u,new FT(n.$,c,l,!0)))),a.segments.push({pendingInitSegmentRefId:u,initSegmentKey:u?0:null,startTime:n.startTime,endTime:n.endTime,appendWindowStart:n.appendWindowStart,appendWindowEnd:n.appendWindowEnd,timestampOffset:n.timestampOffset,tilesLayout:n.tilesLayout,pendingSegmentRefId:r,dataKey:0,mimeType:n.mimeType,codecs:n.codecs}),l=(l+1)%o}),a}function fw(e,t,n){if(t=e.segmentIndex.find(t),null!=t)for(var i=e.segmentIndex.get(t);i;)n(i),i=e.segmentIndex.get(++t)}function pw(e){if(e.l.g)throw new It(2,9,7001)}function gw(){if(!KS())throw new It(2,9,9e3)}function mw(e,t){return N(function(n){return 1==n.g?(e.i.push(t),x(n,2),S(n,t,4)):2!=n.g?n.return(n.h):(I(n),Ne(e.i,t),C(n,0))})}function vw(e,t){var n=t.promise;return e.i.push(n),t.finally(function(){Ne(e.i,n)})}function yw(e){var t=new Set;e=c(e.streams);for(var n=e.next();!n.done;n=e.next()){n=c(n.value.segments);for(var i=n.next();!i.done;i=n.next())i=i.value,null!=i.initSegmentKey&&t.add(i.initSegmentKey),t.add(i.dataKey)}return Array.from(t)}function bw(e,t,n,i){var r,s,a;return N(function(o){return 1==o.g?i.drmInfo?(r=dS(n),s=i.sessionIds.map(function(e){return{sessionId:e,keySystem:i.drmInfo.keySystem,licenseUri:i.drmInfo.licenseServerUri,serverCertificate:i.drmInfo.serverCertificate,audioCapabilities:sw(i,!1),videoCapabilities:sw(i,!0)}}),S(o,US(t,e,s),2)):o.return():3!=o.g?(a=o.h,S(o,r.remove(a),3)):S(o,r.add(s.filter(function(e){return!a.includes(e.sessionId)})),0)})}function _w(e){for(var t=new Set,n=c(e.textStreams),i=n.next();!i.done;i=n.next())t.add(i.value);for(n=c(e.imageStreams),i=n.next();!i.done;i=n.next())t.add(i.value);for(e=c(e.variants),n=e.next();!n.done;n=e.next())n=n.value,n.audio&&t.add(n.audio),n.video&&t.add(n.video);return t}function Tw(e){e.variants.map(function(e){return e.video});var t=new Set(e.variants.map(function(e){return e.audio}));e=e.textStreams;for(var n=c(t),i=n.next();!i.done;i=n.next()){i=c(t);for(var r=i.next();!r.done;r=i.next());}for(t=c(e),n=t.next();!n.done;n=t.next())for(n=c(e),i=n.next();!i.done;i=n.next());}y(gS,eS),gS.prototype.updateManifestExpiration=function(e,t){var n,i,r,s=this;return N(function(a){return n=ZT(s.h,s.g),i=n.store(),r=new Ir,i.get(e).onsuccess=function(n){(n=n.target.result)?(n.expiration=t,i.put(n),r.resolve()):r.reject(new It(2,9,9012,"Could not find values for "+e))},S(a,Promise.all([n.promise(),r]),0)})},gS.prototype.od=function(e){var t,n,i,r,s,a;return N(function(o){if(1==o.g){for(t=[],n=0;n<e.periods.length;++n)i=n==e.periods.length-1?e.duration:e.periods[n+1].startTime,r=i-e.periods[n].startTime,s=mS(e.periods[n],r),t.push(s);return S(o,Fv(t),2)}return a=o.h,o.return({creationTime:0,originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:null==e.expiration?1/0:e.expiration,streams:a,sessionIds:e.sessionIds,drmInfo:e.drmInfo,appMetadata:e.appMetadata,sequenceMode:!1})})},gS.prototype.Cg=function(e){return{data:e.data}},y(_S,eS),_S.prototype.od=function(e){var t,n,i,r,s,a;return N(function(o){if(1==o.g){for(t=[],n=0;n<e.periods.length;++n){i=n==e.periods.length-1?e.duration:e.periods[n+1].startTime,r=i-e.periods[n].startTime;for(var l=e.periods[n],u=[],d=c(l.streams),h=d.next();!h.done;h=d.next())h=h.value,0!=h.variantIds.length&&u.push(TS(h,l.startTime,l.startTime+r));s=u,t.push(s)}return S(o,Fv(t),2)}return a=o.h,o.return({appMetadata:e.appMetadata,creationTime:0,drmInfo:e.drmInfo,duration:e.duration,expiration:null==e.expiration?1/0:e.expiration,originalManifestUri:e.originalManifestUri,sessionIds:e.sessionIds,size:e.size,streams:a,sequenceMode:!1})})},y(SS,eS),i=SS.prototype,i.hasFixedKeySpace=function(){return!1},i.addSegments=function(e){return this.add(this.i,e)},i.addManifests=function(e){return this.add(this.g,e)},i.updateManifest=function(e,t){return tS(this,e,t)},i.od=function(e){return null==e.expiration&&(e.expiration=1/0),Promise.resolve(e)},i=wS.prototype,i.init=function(){var t=this,n=new Ir,i=!1,r=new Ut(function(){i=!0,n.reject(new It(2,9,9017))});r.Y(5);var s=e.indexedDB.open("shaka_offline_db",5);return s.onsuccess=function(){if(!i){var e=s.result;t.l=e;var a=e.objectStoreNames;a=a.contains("manifest")&&a.contains("segment")?new gS(e,"segment","manifest"):null,t.g=a,a=e.objectStoreNames,a=a.contains("manifest-v2")&&a.contains("segment-v2")?new _S(e,"segment-v2","manifest-v2"):null,t.h=a,a=e.objectStoreNames,a=a.contains("manifest-v3")&&a.contains("segment-v3")?new _S(e,"segment-v3","manifest-v3"):null,t.i=a,a=e.objectStoreNames,a=a.contains("manifest-v5")&&a.contains("segment-v5")?new SS(e,"segment-v5","manifest-v5"):null,t.j=a,e=e.objectStoreNames.contains("session-ids")?new sS(e):null,t.m=e,r.stop(),n.resolve()}},s.onupgradeneeded=function(){for(var e=s.result,t=c(["segment-v5","manifest-v5","session-ids"]),n=t.next();!n.done;n=t.next())n=n.value,e.objectStoreNames.contains(n)||e.createObjectStore(n,{autoIncrement:!0})},s.onerror=function(e){i||(n.reject(new It(2,9,9001,s.error)),r.stop(),e.preventDefault())},n},i.destroy=function(){var e=this;return N(function(t){switch(t.g){case 1:if(!e.g){t.u(2);break}return S(t,e.g.destroy(),2);case 2:if(!e.h){t.u(4);break}return S(t,e.h.destroy(),4);case 4:if(!e.i){t.u(6);break}return S(t,e.i.destroy(),6);case 6:if(!e.j){t.u(8);break}return S(t,e.j.destroy(),8);case 8:if(!e.m){t.u(10);break}return S(t,e.m.destroy(),10);case 10:e.l&&e.l.close(),w(t)}})},i.getCells=function(){var e=new Map;return this.g&&e.set("v1",this.g),this.h&&e.set("v2",this.h),this.i&&e.set("v3",this.i),this.j&&e.set("v5",this.j),e},i.getEmeSessionCell=function(){return this.m},i.erase=function(){var e=this;return N(function(t){switch(t.g){case 1:if(!e.g){t.u(2);break}return S(t,e.g.destroy(),2);case 2:if(!e.h){t.u(4);break}return S(t,e.h.destroy(),4);case 4:if(!e.i){t.u(6);break}return S(t,e.i.destroy(),6);case 6:if(!e.j){t.u(8);break}return S(t,e.j.destroy(),8);case 8:return e.l&&e.l.close(),S(t,ES(),10);case 10:return e.l=null,e.g=null,e.h=null,e.i=null,e.j=null,S(t,e.init(),0)}})},fS("idb",function(){return Wt()||Vt()||!e.indexedDB?null:new wS}),xS.prototype.ob=function(){return this.i},xS.prototype.Ja=function(){return this.h},xS.prototype.key=function(){return this.l},xS.prototype.toString=function(){return this.j},i=LS.prototype,i.configure=function(){},i.start=function(e,t){var n,i,r,s,a,o,l,u=this;return N(function(c){switch(c.g){case 1:if(n=kS(e),u.g=n,null==n||"manifest"!=n.g)throw new It(2,1,9004,e);return i=new aS,x(c,2),S(c,i.init(),4);case 4:return S(c,uS(i,n.ob(),n.Ja()),5);case 5:return r=c.h,S(c,r.getManifests([n.key()]),6);case 6:return s=c.h,a=s[0],o=new AS(n.ob(),n.Ja()),l=IS(o,a),t.makeTextStreamsForClosedCaptions(l),c.return(l);case 2:return I(c),S(c,i.destroy(),7);case 7:C(c,0)}})},i.stop=function(){return Promise.resolve()},i.update=function(){},i.onExpirationUpdated=function(e,t){var n,i,r,s,a,o,l,u=this;return N(function(c){switch(c.g){case 1:return n=u.g,i=new aS,E(c,2,3),S(c,i.init(),5);case 5:return S(c,uS(i,n.ob(),n.Ja()),6);case 6:return r=c.h,S(c,r.getManifests([n.key()]),7);case 7:if(s=c.h,a=s[0],o=a.sessionIds.includes(e),l=void 0==a.expiration||a.expiration>t,!o||!l){c.u(3);break}return S(c,r.updateManifestExpiration(n.key(),t),3);case 3:return I(c),S(c,i.destroy(),10);case 10:C(c,0);break;case 2:A(c),c.u(3)}})},i.onInitialVariantChosen=function(){},i.banLocation=function(){},i.setMediaElement=function(){},Ga["application/x-offline-manifest"]=function(){return new LS},G("shaka.offline.OfflineScheme",PS),PS.plugin=OS,$r("offline",OS),i=WS.prototype,i.destroy=function(){return this.l.destroy()},i.configure=function(e,t){return 2==arguments.length&&"string"==typeof e&&(e=Ec(e,t)),Pc(this.h,e)},i.getConfiguration=function(){var e=Lc();return Pc(e,this.h,Lc()),e},i.zb=function(){return this.g},i.store=function(e,t,n){var i=this,r=this.getConfiguration(),s=new $T(this.g);return this.j.push(s),t=YS(this,e,t||{},function(){var t;return N(function(s){return 1==s.g?n?s.u(2):S(s,rd(e,i.g,r.manifest.retryParameters),3):(2!=s.g&&(n=s.h),t=$a(e,n||null),s.return(t()))})},r,s),t=new Cr(t,function(){return zT(s)}),t.finally(function(){Ne(i.j,s)}),vw(this,t)},i.remove=function(e){return mw(this,rw(this,e))},i.Si=function(){return mw(this,lw(this))},i.list=function(){return mw(this,uw())},i.Dc=function(e,t,n){var i,r=this;return N(function(s){return 1==s.g?(i=new Js({Nb:r.g,onError:t,Ae:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),i.configure(n.drm),S(s,ta(i,e.variants,n.offline.usePersistentLicense),2)):3!=s.g?S(s,ua(i),3):s.return(i)})},G("shaka.offline.Storage",WS),WS.deleteAll=function(){var e;return N(function(t){return 1==t.g?(e=new aS,x(t,2),S(t,hS(e),2)):5!=t.g?(I(t),S(t,e.destroy(),5)):C(t,0)})},WS.prototype.list=WS.prototype.list,WS.prototype.removeEmeSessions=WS.prototype.Si,WS.prototype.remove=WS.prototype.remove,WS.prototype.store=WS.prototype.store,WS.prototype.getNetworkingEngine=WS.prototype.zb,WS.prototype.getConfiguration=WS.prototype.getConfiguration,WS.prototype.configure=WS.prototype.configure,WS.prototype.destroy=WS.prototype.destroy,WS.support=KS;var Sw=(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.recommendation","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.software","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.hardware","9a04f07998404286ab92e65be0885f95");function ww(){}function Ew(e,t){for(e={priority:t||0,callback:e},t=0;t<xw.length;t++)if(xw[t].priority<e.priority)return void xw.splice(t,0,e);xw.push(e)}bf.offline=KS,G("shaka.polyfill",ww),ww.register=Ew,ww.installAll=function(){for(var e=c(xw),t=e.next();!t.done;t=e.next()){t=t.value;try{t.callback()}catch(e){Z("Error installing polyfill!",e)}}};var xw=[];function kw(){this.g=new Iw}function Aw(){e.AbortController||(e.AbortController=kw,e.AbortSignal=Iw)}function Iw(){Br.call(this),this.h=!1,this.g=void 0,this.onabort=null}function Cw(){}function Dw(){if(!Object.getOwnPropertyDescriptor(Element.prototype,"ariaHidden"))for(var e=c(["ariaHidden","ariaLabel","ariaPressed","ariaSelected"]),t=e.next();!t.done;t=e.next())Rw(t.value)}function Rw(e){var t="aria-"+e.toLowerCase().replace(/^aria/,"");Object.defineProperty(Element.prototype,e,{get:function(){return this.getAttribute(t)},set:function(e){null==e||void 0==e?this.removeAttribute(t):this.setAttribute(t,e)}})}function Mw(){}function Lw(){gA()}function Pw(){}function Ow(){if(e.Document){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,t=Document.prototype,t.exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",Nw),document.addEventListener("webkitfullscreenerror",Nw),document.addEventListener("mozfullscreenchange",Nw),document.addEventListener("mozfullscreenerror",Nw),document.addEventListener("MSFullscreenChange",Nw),document.addEventListener("MSFullscreenError",Nw)}}function Nw(e){var t=e.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),n=document.createEvent("Event");n.initEvent(t,e.bubbles,e.cancelable),e.target.dispatchEvent(n)}function Uw(){}function Fw(){var e=!0;!Wt()||Wt()&&nn()||Wt()&&sn("Fuchsia")||(e=!1),(Yt()||Xt()||Qt()||zt()||Ht()||sn("PC=EOS")||Zt())&&(e=!1),e&&navigator.mediaCapabilities||(navigator.mediaCapabilities||(navigator.mediaCapabilities={}),$w=navigator.mediaCapabilities,navigator.mediaCapabilities.decodingInfo=Bw)}function Bw(e){var t,n,i,r,s,a,o,l,u,c,d;return N(function(h){switch(h.g){case 1:if(t={supported:!1,powerEfficient:!0,smooth:!0,keySystemAccess:null,configuration:e},n=e.video,i=e.audio,"media-source"!=e.type){if("file"!=e.type)return h.return(t);if(n&&(r=n.contentType,s=Bt(r),!s)||i&&(a=i.contentType,o=Bt(a),!o))return h.return(t);h.u(2);break}if(!Ft())return h.return(t);if(!n){h.u(3);break}return S(h,jw(n),4);case 4:if(l=h.h,!l)return h.return(t);case 3:if(i){var f=i.contentType;if(Wt()&&i.spatialRendering&&(f+="; spatialRendering=true"),u=ce(f),!u)return h.return(t)}case 2:return e.keySystemConfiguration?(c=e.keySystemConfiguration,S(h,Vw(n,i,c),6)):(t.supported=!0,h.return(t));case 6:(d=h.h)&&(t.supported=!0,t.keySystemAccess=d);case 5:return h.return(t)}})}function jw(e){var t,n;return N(function(i){return 1==i.g?Wt()?S(i,Hw(e),3):Ht()?(t=e.contentType,e.width&&e.height&&(t+="; width="+e.width,t+="; height="+e.height),e.framerate&&(t+="; framerate="+e.framerate),e.bitrate&&(t+="; bitrate="+e.bitrate),i.return(ce(t))):i.u(2):2!=i.g?(n=i.h,i.return(n)):i.return(ce(e.contentType))})}function Vw(e,t,n){var i,r,s,a,o,l,u,c,d;return N(function(h){switch(h.g){case 1:if(i=[],r=[],n.audio&&(s={robustness:n.audio.robustness||"",contentType:t.contentType},Ht()&&t.contentType.includes('codecs="ac-3"')&&(s.contentType='audio/mp4; codecs="ec-3"'),n.audio.encryptionScheme&&(s.encryptionScheme=n.audio.encryptionScheme),i.push(s)),n.video&&(a={robustness:n.video.robustness||"",contentType:e.contentType},n.video.encryptionScheme&&(a.encryptionScheme=n.video.encryptionScheme),r.push(a)),o={initDataTypes:[n.initDataType],distinctiveIdentifier:n.distinctiveIdentifier,persistentState:n.persistentState,sessionTypes:n.sessionTypes},i.length&&(o.audioCapabilities=i),r.length&&(o.videoCapabilities=r),l=e?e.contentType:"",u=t?t.contentType:"",c=n.keySystem,d=null,E(h,2),Ot.has(l+"#"+u+"#"+c)){d=Ot.get(l+"#"+u+"#"+c)||null,h.u(4);break}return S(h,navigator.requestMediaKeySystemAccess(n.keySystem,[o]),5);case 5:d=h.h,Ot.set(l+"#"+u+"#"+c,d);case 4:k(h,3);break;case 2:A(h);case 3:return h.return(d)}})}function Hw(t){var n,i;return N(function(r){return 1==r.g?e.cast&&cast.__platform__&&cast.__platform__.canDisplayType?(n=t.contentType,t.width&&t.height&&(n+="; width="+t.width+"; height="+t.height),t.framerate&&(n+="; framerate="+t.framerate),"pq"===t.transferFunction&&(n+="; eotf=smpte2084"),i=!1,n in Xw?(i=Xw[n],r.u(2)):S(r,cast.__platform__.canDisplayType(n),3)):r.return(ce(t.contentType)):(2!=r.g&&(i=r.h,Xw[n]=i),r.return(i))})}kw.prototype.abort=function(e){var t=this.g;t.h||(t.h=!0,t.g=e,void 0===t.g&&(t.g=new DOMException("signal is aborted without reason","AbortError")),e=new Nr("abort"),t.onabort&&t.onabort(e),t.dispatchEvent(e))},o.Object.defineProperties(kw.prototype,{signal:{configurable:!0,enumerable:!0,get:function(){return this.g}}}),ww.AbortController=kw,kw.install=Aw,y(Iw,Br),o.Object.defineProperties(Iw.prototype,{aborted:{configurable:!0,enumerable:!0,get:function(){return this.h}},reason:{configurable:!0,enumerable:!0,get:function(){return this.g}}}),Ew(Aw),ww.Aria=Cw,Cw.install=Dw,Ew(Dw),ww.EncryptionScheme=Mw,Mw.install=Lw,Ew(Lw,-2),ww.Fullscreen=Pw,Pw.install=Ow,Ew(Ow),ww.MediaCapabilities=Uw,Uw.install=Fw;var $w=null;Uw.originalMcap=$w;var Gw,zw,qw,Ww,Kw,Yw,Xw={};function Qw(){}function Zw(){var t=en();(e.MediaSource||e.ManagedMediaSource)&&(t&&e.MediaSource?10>=t?e.MediaSource=null:12>=t?(Jw(),eE()):15>=t&&Jw():sn("DT_STB_BCM")?(Jw(),eE()):(Gt()||$t()||sn("Tizen 4"))&&nE()),(e.MediaSource||e.ManagedMediaSource)&&tE(),e.MediaSource&&MediaSource.isTypeSupported('video/webm; codecs="vp9"')&&!MediaSource.isTypeSupported('video/webm; codecs="vp09.00.10.08"')&&iE()}function Jw(){var e=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(){var t=e.apply(this,U.apply(0,arguments));return t.abort=function(){},t}}function eE(){var e=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(t,n){return e.call(this,t,n-.001)}}function tE(){if(e.MediaSource){var t=MediaSource.isTypeSupported.bind(MediaSource);MediaSource.isTypeSupported=function(e){return"mp2t"!=Hn(e)&&t(e)}}if(e.ManagedMediaSource){var n=ManagedMediaSource.isTypeSupported.bind(ManagedMediaSource);e.ManagedMediaSource.isTypeSupported=function(e){return"mp2t"!=Hn(e)&&n(e)}}}function nE(){var t=MediaSource.isTypeSupported.bind(MediaSource);if(MediaSource.isTypeSupported=function(e){return"opus"!=Gn(e)&&t(e)},e.ManagedMediaSource){var n=ManagedMediaSource.isTypeSupported.bind(ManagedMediaSource);e.ManagedMediaSource.isTypeSupported=function(e){return"opus"!=Gn(e)&&n(e)}}}function iE(){var e=MediaSource.isTypeSupported;zt()||(MediaSource.isTypeSupported=function(t){var n=t.split(/ *; */),i=n.findIndex(function(e){return e.startsWith("codecs=")});if(0>i)return e(t);var r=n[i].replace("codecs=","").replace(/"/g,"").split(/\s*,\s*/),s=r.findIndex(function(e){return e.startsWith("vp09")});return 0<=s&&(r[s]="vp9",n[i]='codecs="'+r.join(",")+'"',t=n.join("; ")),e(t)})}function rE(){}function sE(){screen.orientation&&screen.orientation.unlock||(void 0!=screen.orientation?aE():void 0!=e.orientation&&oE())}function aE(){void 0===screen.orientation.lock&&(screen.orientation.lock=function(){return Promise.resolve()}),void 0===screen.orientation.unlock&&(screen.orientation.unlock=function(){})}function oE(){function t(){switch(e.orientation){case-90:n.type="landscape-secondary",n.angle=270;break;case 0:n.type="portrait-primary",n.angle=0;break;case 90:n.type="landscape-primary",n.angle=90;break;case 180:n.type="portrait-secondary",n.angle=180}}var n=new lE;screen.orientation=n,t(),e.addEventListener("orientationchange",function(){t();var e=new Nr("change");n.dispatchEvent(e)})}function lE(){Br.call(this),this.type="",this.angle=0}function uE(){}function cE(e,t){try{var n=new fE(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function dE(e){var t=this.mediaKeys;return t&&t!=e&&gE(t,null),delete this.mediaKeys,(this.mediaKeys=e)?gE(e,this):Promise.resolve()}function hE(e){if(e=Ee(e.initData),ke(e).getUint32(0,!0)+4!=e.byteLength)throw new RangeError("Malformed FairPlay init data");e=fn(e.subarray(4),!0),e=gn(e);var t=new Event("encrypted");t.initDataType="skd",t.initData=we(e),this.dispatchEvent(t)}function fE(e,t){if(this.keySystem=e,e.startsWith("com.apple.fps"))for(e=c(t),t=e.next();!t.done;t=e.next()){var n=t.value;if("required"==n.persistentState)t=null;else{t={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:n.initDataTypes,sessionTypes:["temporary"],label:n.label};var i=!1,r=!1;if(n.audioCapabilities)for(var s=c(n.audioCapabilities),a=s.next();!a.done;a=s.next())a=a.value,a.contentType&&(i=!0,WebKitMediaKeys.isTypeSupported(this.keySystem,a.contentType.split(";")[0])&&(t.audioCapabilities.push(a),r=!0));if(n.videoCapabilities)for(n=c(n.videoCapabilities),a=n.next();!a.done;a=n.next())s=a.value,s.contentType&&(i=!0,WebKitMediaKeys.isTypeSupported(this.keySystem,s.contentType.split(";")[0])&&(t.videoCapabilities.push(s),r=!0));i||(r=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),t=r?t:null}if(t)return void(this.g=t)}throw e=Error("Unsupported keySystem"),e.name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e}function pE(e){this.h=new WebKitMediaKeys(e),this.g=new se}function gE(e,t){if(e.g.Ra(),!t)return Promise.resolve();e.g.D(t,"webkitneedkey",hE);try{return jl(t,HTMLMediaElement.HAVE_METADATA,e.g,function(){t.webkitSetMediaKeys(e.h)}),Promise.resolve()}catch(e){return Promise.reject(e)}}function mE(e){Br.call(this),this.i=null,this.l=e,this.g=this.h=null,this.j=new se,this.sessionId="",this.expiration=NaN,this.closed=new Ir,this.keyStatuses=new yE}function vE(e,t){var n=e.keyStatuses;n.size=void 0==t?0:1,n.g=t,t=new Nr("keystatuseschange"),e.dispatchEvent(t)}function yE(){this.size=0,this.g=void 0}Uw.memoizedCanDisplayTypeRequests_=Xw,Ew(Fw,-1),ww.MediaSource=Qw,Qw.install=Zw,Ew(Zw),ww.Orientation=rE,rE.install=sE,y(lE,Br),lE.prototype.lock=function(e){function t(e){return screen.lockOrientation?screen.lockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):!!screen.msLockOrientation&&screen.msLockOrientation(e)}var n=!1;switch(e){case"natural":n=t("default");break;case"any":n=!0,this.unlock();break;default:n=t(e)}return n?Promise.resolve():(e=Error("screen.orientation.lock() is not available on this device"),e.name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,Promise.reject(e))},lE.prototype.unlock=function(){screen.unlockOrientation?screen.unlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},Ew(sE),ww.PatchedMediaKeysApple=uE,uE.uninstall=function(){Gw&&(Gw=!1,Object.defineProperty(HTMLMediaElement.prototype,"mediaKeys",zw),HTMLMediaElement.prototype.setMediaKeys=qw,e.MediaKeys=Ww,e.MediaKeySystemAccess=Kw,navigator.requestMediaKeySystemAccess=Yw,zw=Yw=qw=Kw=Ww=null,e.shakaMediaKeysPolyfill="")},uE.install=function(t){e.HTMLVideoElement&&e.WebKitMediaKeys&&(void 0!==t&&t&&(Gw=!0,zw=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"mediaKeys"),qw=HTMLMediaElement.prototype.setMediaKeys,Ww=e.MediaKeys,Kw=e.MediaKeySystemAccess,Yw=navigator.requestMediaKeySystemAccess),delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=dE,e.MediaKeys=pE,e.MediaKeySystemAccess=fE,navigator.requestMediaKeySystemAccess=cE,e.shakaMediaKeysPolyfill=bE)},fE.prototype.createMediaKeys=function(){var e=new pE(this.keySystem);return Promise.resolve(e)},fE.prototype.getConfiguration=function(){return this.g},pE.prototype.createSession=function(e){if(e=e||"temporary","temporary"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");return new mE(this.h,e)},pE.prototype.setServerCertificate=function(){return Promise.resolve(!1)},pE.prototype.getStatusForPolicy=function(){return Promise.resolve("usable")},y(mE,Br),i=mE.prototype,i.generateRequest=function(e,t){var n=this;this.h=new Ir;try{var i=this.l.createSession("video/mp4",Ee(t));this.i=i,this.sessionId=i.sessionId||"",this.j.D(this.i,"webkitkeymessage",function(e){n.h&&(n.h.resolve(),n.h=null),e=(new Map).set("messageType",void 0==n.keyStatuses.ac()?"license-request":"license-renewal").set("message",we(e.message)),e=new Nr("message",e),n.dispatchEvent(e)}),this.j.D(i,"webkitkeyadded",function(){n.g&&(vE(n,"usable"),n.g.resolve(),n.g=null)}),this.j.D(i,"webkitkeyerror",function(){var e=Error("EME PatchedMediaKeysApple key error");if(e.errorCode=n.i.error,null!=n.h)n.h.reject(e),n.h=null;else if(null!=n.g)n.g.reject(e),n.g=null;else switch(n.i.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:vE(n,"output-not-allowed");break;default:vE(n,"internal-error")}}),vE(this,"status-pending")}catch(e){this.h.reject(e)}return this.h},i.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},i.update=function(e){this.g=new Ir;try{this.i.update(Ee(e))}catch(e){this.g.reject(e)}return this.g},i.close=function(){try{this.i.close(),this.closed.resolve(),this.j.Ra()}catch(e){this.closed.reject(e)}return this.closed},i.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},i=yE.prototype,i.ac=function(){return this.g},i.forEach=function(e){this.g&&e(this.g,Pt.value())},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=Pt.value();return!(!this.g||!Te(e,t))},i.entries=function(){},i.keys=function(){},i.values=function(){};var bE="apple";function _E(){}function TE(){e.MediaKeys&&(!MediaKeys.prototype.setServerCertificate||$t()||sn("Tizen 4")||sn("Tizen 5.0")||qt())&&(MediaKeys.prototype.setServerCertificate=SE)}function SE(){return Promise.resolve(!1)}function wE(){}function EE(){!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(navigator.requestMediaKeySystemAccess=xE,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=kE,e.MediaKeys=AE,e.MediaKeySystemAccess=IE,e.shakaMediaKeysPolyfill=CE)}function xE(){return Promise.reject(Error("The key system specified is not supported."))}function kE(e){return null==e?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function AE(){throw new TypeError("Illegal constructor.")}function IE(){throw this.keySystem="",new TypeError("Illegal constructor.")}ww.PatchedMediaKeysCert=_E,_E.install=TE,Ew(TE),ww.PatchedMediaKeysNop=wE,wE.install=EE,AE.prototype.createSession=function(){},AE.prototype.setServerCertificate=function(){},AE.prototype.getStatusForPolicy=function(){return Promise.resolve("usable")},IE.prototype.getConfiguration=function(){},IE.prototype.createMediaKeys=function(){};var CE="nop";function DE(){}function RE(){if(!(!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)GE="webkit";else if(!HTMLMediaElement.prototype.generateKeyRequest)return;navigator.requestMediaKeySystemAccess=LE,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=PE,e.MediaKeys=NE,e.MediaKeySystemAccess=OE,e.shakaMediaKeysPolyfill=zE}}function ME(e){var t=GE;return t?t+e.charAt(0).toUpperCase()+e.slice(1):e}function LE(e,t){try{var n=new OE(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function PE(e){var t=this.mediaKeys;return t&&t!=e&&UE(t,null),delete this.mediaKeys,(this.mediaKeys=e)&&UE(e,this),Promise.resolve()}function OE(e,t){this.g=this.keySystem=e;var n=!1;"org.w3.clearkey"==e&&(this.g="webkit-org.w3.clearkey",n=!1);var i=!1,r=document.getElementsByTagName("video");r=r.length?r[0]:document.createElement("video"),t=c(t);for(var s=t.next();!s.done;s=t.next()){s=s.value;var a={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:s.initDataTypes,sessionTypes:["temporary"],label:s.label},o=!1;if(s.audioCapabilities)for(var l=c(s.audioCapabilities),u=l.next();!u.done;u=l.next())u=u.value,u.contentType&&(o=!0,r.canPlayType(u.contentType.split(";")[0],this.g)&&(a.audioCapabilities.push(u),i=!0));if(s.videoCapabilities)for(l=c(s.videoCapabilities),u=l.next();!u.done;u=l.next())u=u.value,u.contentType&&(o=!0,r.canPlayType(u.contentType,this.g)&&(a.videoCapabilities.push(u),i=!0));if(o||(i=r.canPlayType("video/mp4",this.g)||r.canPlayType("video/webm",this.g)),"required"==s.persistentState&&(n?(a.persistentState="required",a.sessionTypes=["persistent-license"]):i=!1),i)return void(this.h=a)}throw n="Unsupported keySystem","org.w3.clearkey"!=e&&"com.widevine.alpha"!=e||(n="None of the requested configurations were supported."),e=Error(n),e.name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e}function NE(e){this.l=e,this.h=null,this.g=new se,this.i=[],this.j=new Map}function UE(e,t){e.h=t,e.g.Ra();var n=GE;t&&(e.g.D(t,n+"needkey",function(t){var n=new CustomEvent("encrypted");n.initDataType="cenc",n.initData=we(t.initData),e.h.dispatchEvent(n)}),e.g.D(t,n+"keymessage",function(t){var n=FE(e,t.sessionId);n&&(t=(new Map).set("messageType",void 0==n.keyStatuses.ac()?"licenserequest":"licenserenewal").set("message",t.message),t=new Nr("message",t),n.h&&(n.h.resolve(),n.h=null),n.dispatchEvent(t))}),e.g.D(t,n+"keyadded",function(t){(t=FE(e,t.sessionId))&&(HE(t,"usable"),t.g&&t.g.resolve(),t.g=null)}),e.g.D(t,n+"keyerror",function(t){var n=FE(e,t.sessionId);if(n){var i=Error("EME v0.1b key error"),r=t.errorCode;r.systemCode=t.systemCode,i.errorCode=r,!t.sessionId&&n.h?(45==t.systemCode&&(i.message="Unsupported session type."),n.h.reject(i),n.h=null):t.sessionId&&n.g?(n.g.reject(i),n.g=null):(i=t.systemCode,t.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?HE(n,"output-restricted"):HE(n,1==i?"expired":"internal-error"))}}))}function FE(e,t){var n=e.j.get(t);return n||((n=e.i.shift())?(n.sessionId=t,e.j.set(t,n),n):null)}function BE(e,t,n){Br.call(this),this.j=e,this.m=!1,this.g=this.h=null,this.i=t,this.l=n,this.sessionId="",this.expiration=NaN,this.closed=new Ir,this.keyStatuses=new $E}function jE(e,t,n){if(e.m)return Promise.reject(Error("The session is already initialized."));e.m=!0;try{if("persistent-license"==e.l)if(n)var i=Ee(gn("LOAD_SESSION|"+n));else{var r=gn("PERSISTENT|");i=kn(r,t)}else i=Ee(t)}catch(e){return Promise.reject(e)}e.h=new Ir;var s=ME("generateKeyRequest");try{e.j[s](e.i,i)}catch(t){if("InvalidStateError"!=t.name)return e.h=null,Promise.reject(t);new Ut(function(){try{e.j[s](e.i,i)}catch(t){e.h.reject(t),e.h=null}}).Y(.01)}return e.h}function VE(e,t,n){if(e.g)e.g.then(function(){return VE(e,t,n)}).catch(function(){return VE(e,t,n)});else{if(e.g=t,"webkit-org.w3.clearkey"==e.i){var i=hn(n),r=JSON.parse(i);"oct"!=r.keys[0].kty&&(e.g.reject(Error("Response is not a valid JSON Web Key Set.")),e.g=null),i=wn(r.keys[0].k),r=wn(r.keys[0].kid)}else i=Ee(n),r=null;var s=ME("addKey");try{e.j[s](e.i,i,r,e.sessionId)}catch(t){e.g.reject(t),e.g=null}}}function HE(e,t){var n=e.keyStatuses;n.size=void 0==t?0:1,n.g=t,t=new Nr("keystatuseschange"),e.dispatchEvent(t)}function $E(){this.size=0,this.g=void 0}Ew(EE,-10),ww.PatchedMediaKeysWebkit=DE,DE.install=RE,OE.prototype.createMediaKeys=function(){var e=new NE(this.g);return Promise.resolve(e)},OE.prototype.getConfiguration=function(){return this.h},NE.prototype.createSession=function(e){if(e=e||"temporary","temporary"!=e&&"persistent-license"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");var t=this.h||document.createElement("video");return t.src||(t.src="about:blank"),e=new BE(t,this.l,e),this.i.push(e),e},NE.prototype.setServerCertificate=function(){return Promise.resolve(!1)},NE.prototype.getStatusForPolicy=function(){return Promise.resolve("usable")},y(BE,Br),i=BE.prototype,i.generateRequest=function(e,t){return jE(this,t,null)},i.load=function(e){return"persistent-license"==this.l?jE(this,null,e):Promise.reject(Error("Not a persistent session."))},i.update=function(e){var t=new Ir;return VE(this,t,e),t},i.close=function(){if("persistent-license"!=this.l){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var e=ME("cancelKeyRequest");try{this.j[e](this.i,this.sessionId)}catch(e){}}return this.closed.resolve(),this.closed},i.remove=function(){return"persistent-license"!=this.l?Promise.reject(Error("Not a persistent session.")):this.close()},i=$E.prototype,i.ac=function(){return this.g},i.forEach=function(e){this.g&&e(this.g,Pt.value())},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=Pt.value();return!(!this.g||!Te(e,t))},i.entries=function(){},i.keys=function(){},i.values=function(){};var GE="",zE="webkit";function qE(){}function WE(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;t.requestPictureInPicture&&document.exitPictureInPicture||!t.webkitSupportsPresentationMode||(document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,t.requestPictureInPicture=YE,Object.defineProperty(t,"disablePictureInPicture",{get:QE,set:ZE,enumerable:!0,configurable:!0}),document.exitPictureInPicture=XE,document.addEventListener("webkitpresentationmodechanged",KE,!0))}}function KE(e){if(e=e.target,"picture-in-picture"==e.webkitPresentationMode){document.pictureInPictureElement=e;var t=new Event("enterpictureinpicture");e.dispatchEvent(t)}else document.pictureInPictureElement==e&&(document.pictureInPictureElement=null),t=new Event("leavepictureinpicture"),e.dispatchEvent(t)}function YE(){return this.webkitSupportsPresentationMode("picture-in-picture")?(this.webkitSetPresentationMode("picture-in-picture"),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))}function XE(){var e=document.pictureInPictureElement;return e?(e.webkitSetPresentationMode("inline"),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))}function QE(){return!!this.hasAttribute("disablePictureInPicture")||!this.webkitSupportsPresentationMode("picture-in-picture")}function ZE(e){e?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")}function JE(){}function ex(){e.crypto&&("randomUUID"in e.crypto||(e.crypto.randomUUID=tx))}function tx(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.substr(t.lastIndexOf("/")+1)}function nx(){}function ix(){var e=Symbol.prototype;"description"in e||Object.defineProperty(e,"description",{get:rx})}function rx(){var e=/\((.*)\)/.exec(this.toString());return e?e[1]:void 0}function sx(){}function ax(){if(e.HTMLMediaElement){var t=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var e=t.apply(this);return e&&e.catch(function(){}),e}}}function ox(){}function lx(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&("webkitDroppedFrameCount"in t||qt())&&(t.getVideoPlaybackQuality=ux)}}function ux(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function cx(){}function dx(){if(!e.VTTCue&&e.TextTrackCue){var t=null,n=TextTrackCue.length;if(3==n)t=hx;else if(6==n)t=fx;else{try{var i=!!hx(1,2,"")}catch(e){i=!1}i&&(t=hx)}t&&(e.VTTCue=function(e,n,i){return t(e,n,i)})}}function hx(t,n,i){return new e.TextTrackCue(t,n,i)}function fx(t,n,i){return new e.TextTrackCue(t+"-"+n+"-"+i,t,n,i)}function px(){}Ew(RE),ww.PiPWebkit=qE,qE.install=WE,Ew(WE),ww.RandomUUID=JE,JE.install=ex,Ew(ex),ww.Symbol=nx,nx.install=ix,Ew(ix),ww.VideoPlayPromise=sx,sx.install=ax,Ew(ax),ww.VideoPlaybackQuality=ox,ox.install=lx,Ew(lx),ww.VTTCue=cx,cx.install=dx,Ew(dx),px.prototype.parseInit=function(){},px.prototype.setSequenceMode=function(){},px.prototype.setManifestType=function(){},px.prototype.parseMedia=function(e,t){var n=null,i=[];e=hn(e).split(/\r?\n/),e=c(e);for(var r=e.next();!r.done;r=e.next())if((r=r.value)&&!/^\s+$/.test(r)&&(r=gx.exec(r))){var s=mx.exec(r[1]);s=60*parseInt(s[1],10)+parseFloat(s[2].replace(",",".")),r=new Be(s,t.segmentEnd?t.segmentEnd:s+2,r[2]),n&&(n.endTime=s,i.push(n)),n=r}return n&&i.push(n),i},G("shaka.text.LrcTextParser",px),px.prototype.parseMedia=px.prototype.parseMedia,px.prototype.setManifestType=px.prototype.setManifestType,px.prototype.setSequenceMode=px.prototype.setSequenceMode,px.prototype.parseInit=px.prototype.parseInit;var gx=/^\[(\d{1,2}:\d{1,2}(?:[.,]\d{1,3})?)\](.*)/,mx=/^(\d+):(\d{1,2}(?:[.,]\d{1,3})?)$/;function vx(){}function yx(e,t,n,i,r,s,a,o,l,u,d,h){var f=u;if(As(e)){if(!d)return null;var p={tagName:"span",children:[Ds(e)],attributes:{},parent:null}}else p=e;for(var g=null,m=c(zx),v=m.next();!v.done&&!(g=xx(p,"backgroundImage",i,"#",v.value)[0]);v=m.next());m=null;var y=Fs(p,zx,"backgroundImage");if(h&&y&&!y.startsWith("#")&&(v=new ht(h),y=new ht(y),(v=v.resolve(y).toString())&&(m=v)),("p"==e.tagName||g||m)&&(d=!0),e=d,v="default"==(p.attributes["xml:space"]||(o?"default":"preserve")),y=p.children.every(As),o=[],!y)for(var b=c(p.children),_=b.next();!_.done;_=b.next())(_=yx(_.value,t,n,i,r,s,a,v,l,p,d,h))&&o.push(_);if(i=null!=u,h=Ds(p),h=p.children.length&&h&&/\S/.test(h),_=p.attributes.begin||p.attributes.end||p.attributes.dur,!(_||h||"br"==p.tagName||0!=o.length||i&&!v))return null;for(b=Ax(p,n),h=b.start,b=b.end;f&&f.tagName&&"tt"!=f.tagName;)b=kx(f,n,h,b),h=b.start,b=b.end,f=f.parent;if(null==h&&(h=0),h+=t.periodStart,b=null==b?1/0:b+t.periodStart,h=Math.max(h,t.segmentStart),b=Math.min(b,t.segmentEnd),!_&&0<o.length)for(h=1/0,b=0,t=c(o),n=t.next();!n.done;n=t.next())n=n.value,h=Math.min(h,n.startTime),b=Math.max(b,n.endTime);if("br"==p.tagName)return r=new Be(h,b,""),r.lineBreak=!0,r;if(t="",y&&(t=yn(Ds(p)||""),v&&(t=t.replace(/\s+/g," "))),t=new Be(h,b,t),t.nestedCues=o,d||(t.isContainer=!0),l&&(t.cellResolution=l),l=xx(p,"region",s,"")[0],p.attributes.region&&l&&l.attributes["xml:id"]){var T=l.attributes["xml:id"];t.region=a.filter(function(e){return e.id==T})[0]}return a=l,u&&i&&!p.attributes.region&&!p.attributes.style&&(a=xx(u,"region",s,"")[0]),bx(t,p,a,g,m,r,e,0==o.length),t}function bx(e,t,n,i,r,s,a,o){if(a=a||o,"rtl"==Tx(t,n,s,"direction",a)&&(e.direction="rtl"),o=Tx(t,n,s,"writingMode",a),"tb"==o||"tblr"==o?e.writingMode="vertical-lr":"tbrl"==o?e.writingMode="vertical-rl":"rltb"==o||"rl"==o?e.direction="rtl":o&&(e.direction=We),(o=Tx(t,n,s,"textAlign",!0))?(e.positionAlign=Hx[o],e.lineAlign=Vx[o],e.textAlign=Ge[o.toUpperCase()]):e.textAlign=$e,(o=Tx(t,n,s,"displayAlign",!0))&&(e.displayAlign=qe[o.toUpperCase()]),(o=Tx(t,n,s,"color",a))&&(e.color=o),(o=Tx(t,n,s,"backgroundColor",a))&&(e.backgroundColor=o),(o=Tx(t,n,s,"border",a))&&(e.border=o),o=Tx(t,n,s,"fontFamily",a))switch(o){case"monospaceSerif":e.fontFamily="Courier New,Liberation Mono,Courier,monospace";break;case"proportionalSansSerif":e.fontFamily="Arial,Helvetica,Liberation Sans,sans-serif";break;case"sansSerif":e.fontFamily="sans-serif";break;case"monospaceSansSerif":e.fontFamily="Consolas,monospace";break;case"proportionalSerif":e.fontFamily="serif";break;default:e.fontFamily=o.split(",").filter(function(e){return"default"!=e}).join(",")}switch((o=Tx(t,n,s,"fontWeight",a))&&"bold"==o&&(e.fontWeight=700),o=Tx(t,n,s,"wrapOption",a),e.wrapLine=!o||"noWrap"!=o,(o=Tx(t,n,s,"lineHeight",a))&&o.match(Lx)&&(e.lineHeight=o),(o=Tx(t,n,s,"fontSize",a))&&(o.match(Lx)||o.match(Mx))&&(e.fontSize=o),(o=Tx(t,n,s,"fontStyle",a))&&(e.fontStyle=nt[o.toUpperCase()]),i?(r=i.attributes.imageType||i.attributes.imagetype,o=i.attributes.encoding,i=Ds(i).trim(),"PNG"==r&&"Base64"==o&&i&&(e.backgroundImage="data:image/png;base64,"+i)):r&&(e.backgroundImage=r),(i=Tx(t,n,s,"textOutline",a))&&(i=i.split(" "),i[0].match(Lx)?e.textStrokeColor=e.color:(e.textStrokeColor=i[0],i.shift()),i[0]&&i[0].match(Lx)?e.textStrokeWidth=i[0]:e.textStrokeColor=""),(i=Tx(t,n,s,"letterSpacing",a))&&i.match(Lx)&&(e.letterSpacing=i),(i=Tx(t,n,s,"linePadding",a))&&i.match(Lx)&&(e.linePadding=i),(i=Tx(t,n,s,"opacity",a))&&(e.opacity=parseFloat(i)),(i=Sx(n,s,"textDecoration"))&&_x(e,i),(i=wx(t,s,"textDecoration"))&&_x(e,i),(i=Tx(t,n,s,"textCombine",a))&&(e.textCombineUpright=i),Tx(t,n,s,"ruby",a)){case"container":e.rubyTag="ruby";break;case"text":e.rubyTag="rt"}}function _x(e,t){t=c(t.split(" "));for(var n=t.next();!n.done;n=t.next())switch(n.value){case"underline":e.textDecoration.includes("underline")||e.textDecoration.push("underline");break;case"noUnderline":e.textDecoration.includes("underline")&&Ne(e.textDecoration,"underline");break;case"lineThrough":e.textDecoration.includes("lineThrough")||e.textDecoration.push("lineThrough");break;case"noLineThrough":e.textDecoration.includes("lineThrough")&&Ne(e.textDecoration,"lineThrough");break;case"overline":e.textDecoration.includes("overline")||e.textDecoration.push("overline");break;case"noOverline":e.textDecoration.includes("overline")&&Ne(e.textDecoration,"overline")}}function Tx(e,t,n,i,r){return r=void 0===r||r,(e=wx(e,n,i))?e:r?Sx(t,n,i):null}function Sx(e,t,n){if(!e)return null;var i=Fs(e,Gx,n);return i||Ex(e,t,n)}function wx(e,t,n){var i=Fs(e,Gx,n);return i||Ex(e,t,n)}function Ex(e,t,n){e=xx(e,"style",t,"");for(var i=null,r=0;r<e.length;r++){var s=Ns(e[r],"urn:ebu:tt:style",n);s||(s=Fs(e[r],Gx,n)),s||(s=wx(e[r],t,n)),s&&(i=s)}return i}function xx(e,t,n,i,r){var s=[];if(!e||1>n.length)return s;var a=e;for(e=null;!e&&!(e=r?Ns(a,r,t):a.attributes[t])&&(a=a.parent,a););if(t=e)for(t=c(t.split(" ")),r=t.next();!r.done;r=t.next())for(r=r.value,e=c(n),a=e.next();!a.done;a=e.next())if(a=a.value,i+a.attributes["xml:id"]==r){s.push(a);break}return s}function kx(e,t,n,i){return e=Ax(e,t),null==n?n=e.start:null!=e.start&&(n+=e.start),null==i?i=e.end:null!=e.start&&(i+=e.start),{start:n,end:i}}function Ax(e,t){var n=Ix(e.attributes.begin,t),i=Ix(e.attributes.end,t);return e=Ix(e.attributes.dur,t),null==i&&null!=e&&(i=n+e),{start:n,end:i}}function Ix(e,t){var n=null;if(Ox.test(e)){e=Ox.exec(e),n=Number(e[1]);var i=Number(e[2]),r=Number(e[3]),s=Number(e[4]);s+=(Number(e[5])||0)/t.h,r+=s/t.frameRate,n=r+60*i+3600*n}else if(Nx.test(e))n=Cx(Nx,e);else if(Ux.test(e))n=Cx(Ux,e);else if(Fx.test(e))e=Fx.exec(e),n=Number(e[1])/t.frameRate;else if(Bx.test(e))e=Bx.exec(e),n=Number(e[1])/t.g;else if(jx.test(e))n=Cx(jx,e);else if(e)throw new It(2,2,2001,"Could not parse cue time range in TTML");return n}function Cx(e,t){return e=e.exec(t),null==e||""==e[0]?null:(Number(e[4])||0)/1e3+(Number(e[3])||0)+60*(Number(e[2])||0)+3600*(Number(e[1])||0)}function Dx(e,t,n,i){this.frameRate=Number(e)||30,this.h=Number(t)||1,this.g=Number(i),0==this.g&&(this.g=e?this.frameRate*this.h:1),n&&(e=/^(\d+) (\d+)$/g.exec(n))&&(this.frameRate*=Number(e[1])/Number(e[2]))}ri["application/x-subtitle-lrc"]=function(){return new px},vx.prototype.parseInit=function(){},vx.prototype.setSequenceMode=function(){},vx.prototype.setManifestType=function(){},vx.prototype.parseMedia=function(e,t,n){var i=hn(e);if(e=[],""==i)return e;var r=Es(i,"tt");if(!r)throw new It(2,2,2005,"Failed to parse TTML.");if(i=Ms(r,"body")[0],!i)return[];var s=Fs(r,$x,"frameRate"),a=Fs(r,$x,"subFrameRate"),o=Fs(r,$x,"frameRateMultiplier"),l=Fs(r,$x,"tickRate"),u=Fs(r,$x,"cellResolution"),d=r.attributes["xml:space"]||"default",h=Fs(r,Gx,"extent");if("default"!=d&&"preserve"!=d)throw new It(2,2,2005,"Invalid xml:space value: "+d);d="default"==d,s=new Dx(s,a,o,l),u=u&&(u=/^(\d+) (\d+)$/.exec(u))?{kc:parseInt(u[1],10),rows:parseInt(u[2],10)}:null,a=(a=Ms(r,"metadata")[0])?a.children:[],o=Ms(r,"style"),r=Ms(r,"region"),l=[];for(var f=c(r),p=f.next();!p.done;p=f.next()){var g=p.value;p=new Me;var m=g.attributes["xml:id"];if(m){p.id=m;var v=null;h&&(v=Rx.exec(h)||Px.exec(h)),m=v?Number(v[1]):null,v=v?Number(v[2]):null;var y,b=Sx(g,o,"extent");if(b){var _=(y=Rx.exec(b))||Px.exec(b);null!=_&&(p.width=Number(_[1]),p.height=Number(_[2]),y||(null!=m&&(p.width=100*p.width/m),null!=v&&(p.height=100*p.height/v)),p.widthUnits=y||null!=m?Le:0,p.heightUnits=y||null!=v?Le:0)}(g=Sx(g,o,"origin"))&&(_=(y=Rx.exec(g))||Px.exec(g),null!=_&&(p.viewportAnchorX=Number(_[1]),p.viewportAnchorY=Number(_[2]),y?b||(p.width=100-p.viewportAnchorX,p.widthUnits=Le,p.height=100-p.viewportAnchorY,p.heightUnits=Le):(null!=v&&(p.viewportAnchorY=100*p.viewportAnchorY/v),null!=m&&(p.viewportAnchorX=100*p.viewportAnchorX/m)),p.viewportAnchorUnits=y||null!=m?Le:0))}else p=null;p&&l.push(p)}if(Cs(i,"p").length)throw new It(2,2,2001,"<p> can only be inside <div> in TTML");for(h=c(Cs(i,"div")),f=h.next();!f.done;f=h.next())if(Cs(f.value,"span").length)throw new It(2,2,2001,"<span> can only be inside <p> in TTML");return(t=yx(i,t,s,a,o,r,l,d,u,null,!1,n))&&(t.backgroundColor||(t.backgroundColor="transparent"),e.push(t)),e},G("shaka.text.TtmlTextParser",vx),vx.prototype.parseMedia=vx.prototype.parseMedia,vx.prototype.setManifestType=vx.prototype.setManifestType,vx.prototype.setSequenceMode=vx.prototype.setSequenceMode,vx.prototype.parseInit=vx.prototype.parseInit;var Rx=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,Mx=/^(\d{1,4}(?:\.\d+)?|100)%$/,Lx=/^(\d+px|\d+em|\d*\.?\d+c)$/,Px=/^(\d+)px (\d+)px$/,Ox=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Nx=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,Ux=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d+)$/,Fx=/^(\d*(?:\.\d*)?)f$/,Bx=/^(\d*(?:\.\d*)?)t$/,jx=RegExp("^(?:(\\d*(?:\\.\\d*)?)h)?(?:(\\d*(?:\\.\\d*)?)m)?(?:(\\d*(?:\\.\\d*)?)s)?(?:(\\d*(?:\\.\\d*)?)ms)?$"),Vx={left:Xe,center:"center",right:"end",start:Xe,end:"end"},Hx={left:"line-left",center:"center",right:"line-right"},$x=["http://www.w3.org/ns/ttml#parameter","http://www.w3.org/2006/10/ttaf1#parameter"],Gx=["http://www.w3.org/ns/ttml#styling","http://www.w3.org/2006/10/ttaf1#styling"],zx=["http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt","http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"];function qx(){this.g=new vx}function Wx(){this.h=!1,this.g="UNKNOWN"}function Kx(e){for(var t=c(Object.entries(Ze)),n=t.next();!n.done;n=t.next()){var i=c(n.value);n=i.next().value,i=i.next().value;var r=new Be(0,0,"");r.color=i,e.set("."+n,r)}for(t=c(Object.entries(Je)),n=t.next();!n.done;n=t.next())i=c(n.value),n=i.next().value,i=i.next().value,r=new Be(0,0,""),r.backgroundColor=i,e.set("."+n,r)}function Yx(e,t,n){if(e.includes("<")){0===n.size&&Kx(n);var i=e;e=[];for(var r=-1,s=0;s<i.length;s++)"<"===i[s]?r=s+1:">"===i[s]&&0<r&&(r=i.substr(r,s-r),r.match(nk)&&e.push(r),r=-1);for(e=c(e),s=e.next();!s.done;s=e.next())s=s.value,i=i.replace("<"+s+">",'<div time="'+s+'">'),i+="</div>";e=i;e:{s=e,r=[];var a=-1;e="",i=!1;for(var o=0;o<s.length;o++)if("/"===s[o]){var l=s.indexOf(">",o);if(-1===l){e=s;break e}if((l=s.substring(o+1,l))&&"v"==l){i=!0;var u=null;if(r.length&&(u=r[r.length-1]),u){if(u===l)e+="/"+l+">";else{if(!u.startsWith("v")){e+=s[o];continue}e+="/"+u+">"}o+=l.length+1}else e+=s[o]}else e+=s[o]}else"<"===s[o]?(a=o+1,"v"!=s[a]&&(a=-1)):">"===s[o]&&0<a&&(r.push(s.substr(a,o-a)),a=-1),e+=s[o];for(s=c(r),r=s.next();!r.done;r=s.next())r=r.value,a=r.replace(" ",".voice-"),e=e.replace("<"+r+">","<"+a+">"),e=e.replace("</"+r+">","</"+a+">"),i||(e+="</"+a+">")}e=Xx(e);try{var d=Es("<span>"+e+"</span>","span")}catch(e){}if(d)if(d=d.children,1!=d.length||d[0].tagName)for(d=c(d),e=d.next();!e.done;e=d.next())Zx(e.value,t,n);else t.payload=yn(e);else t.payload=yn(e)}else t.payload=yn(e)}function Xx(e){var t={"< ":""," >":" &gt;"},n=/(< +>|<\s|\s>)/g,i=RegExp(n.source);return e&&i.test(e)?e.replace(n,function(e){return t[e]||""}):e||""}function Qx(e,t){return e&&0<e.length?e:t}function Zx(e,t,n){var i=t.clone();if(i.nestedCues=[],i.payload="",i.rubyTag="",i.line=null,i.region=new Me,i.position=null,i.size=0,e.tagName)for(var r=c(e.tagName.split(/(?=[ .])+/g)),s=r.next();!s.done;s=r.next()){var a=s=s.value;if(a.startsWith(".voice-")){var o=a.split("-").pop();a='v[voice="'+o+'"]',n.has(a)||(a="v[voice="+o+"]")}switch(n.has(a)&&(a=n.get(a))&&(i.backgroundColor=Qx(a.backgroundColor,i.backgroundColor),i.color=Qx(a.color,i.color),i.fontFamily=Qx(a.fontFamily,i.fontFamily),i.fontSize=Qx(a.fontSize,i.fontSize),i.textShadow=Qx(a.textShadow,i.textShadow),i.fontWeight=a.fontWeight,i.fontStyle=a.fontStyle,i.opacity=a.opacity,i.rubyTag=a.rubyTag,i.textCombineUpright=a.textCombineUpright,i.wrapLine=a.wrapLine),s){case"br":return i=je(i.startTime,i.endTime),void t.nestedCues.push(i);case"b":i.fontWeight=700;break;case"i":i.fontStyle="italic";break;case"u":i.textDecoration.push("underline");break;case"font":(s=e.attributes.color)&&(i.color=s);break;case"div":if(s=e.attributes.time,!s)break;(s=tk(new jf(s)))&&(i.startTime=s);break;case"ruby":case"rp":case"rt":i.rubyTag=s}}if(r=e.children,As(e)||1==r.length&&As(r[0]))for(n=Ds(e).split("\n"),e=!0,n=c(n),r=n.next();!r.done;r=n.next())r=r.value,e||(e=je(i.startTime,i.endTime),t.nestedCues.push(e)),0<r.length&&(e=i.clone(),e.payload=yn(r),t.nestedCues.push(e)),e=!1;else for(t.nestedCues.push(i),t=c(r),e=t.next();!e.done;e=t.next())Zx(e.value,i,n)}function Jx(e,t,n){var i;(i=/^align:(start|middle|center|end|left|right)$/.exec(t))?(t=i[1],e.textAlign="middle"==t?$e:Ge[t.toUpperCase()]):(i=/^vertical:(lr|rl)$/.exec(t))?e.writingMode="lr"==i[1]?"vertical-lr":"vertical-rl":(i=/^size:([\d.]+)%$/.exec(t))?e.size=Number(i[1]):(i=/^position:([\d.]+)%(?:,(line-left|line-right|middle|center|start|end|auto))?$/.exec(t))?(e.position=Number(i[1]),i[2]&&(t=i[2],e.positionAlign="line-left"==t||"start"==t?"line-left":"line-right"==t||"end"==t?"line-right":"center"==t||"middle"==t?"center":He)):(i=/^region:(.*)$/.exec(t))?(t=ek(n,i[1]))&&(e.region=t):(n=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))?(e.lineInterpretation=1,e.line=Number(n[1]),n[2]&&(e.lineAlign=Qe[n[2].toUpperCase()])):(n=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(t))&&(e.lineInterpretation=Ye,e.line=Number(n[1]),n[2]&&(e.lineAlign=Qe[n[2].toUpperCase()]))}function ek(e,t){return e=e.filter(function(e){return e.id==t}),e.length?e[0]:null}function tk(e){if(e=Hf(e,nk),null==e)return null;var t=Number(e[2]),n=Number(e[3]);return 59<t||59<n?null:Number(e[4])/1e3+n+60*t+3600*(Number(e[1])||0)}ri["application/ttml+xml"]=function(){return new vx},qx.prototype.parseInit=function(e){var t=!1;if((new cs).box("moov",ds).box("trak",ds).box("mdia",ds).box("minf",ds).box("stbl",ds).S("stsd",hs).box("stpp",function(e){t=!0,e.parser.stop()}).parse(e),!t)throw new It(2,2,2007)},qx.prototype.setSequenceMode=function(){},qx.prototype.setManifestType=function(){},qx.prototype.parseMedia=function(e,t,n){var i=this,r=!1,s=[];if((new cs).box("mdat",gs(function(e){r=!0,s=s.concat(i.g.parseMedia(e,t,n))})).parse(e,!1),!r)throw new It(2,2,2007);return s},G("shaka.text.Mp4TtmlParser",qx),qx.prototype.parseMedia=qx.prototype.parseMedia,qx.prototype.setManifestType=qx.prototype.setManifestType,qx.prototype.setSequenceMode=qx.prototype.setSequenceMode,qx.prototype.parseInit=qx.prototype.parseInit,ri['application/mp4; codecs="stpp"']=function(){return new qx},ri['application/mp4; codecs="stpp.ttml"']=function(){return new qx},ri['application/mp4; codecs="stpp.ttml.im1t"']=function(){return new qx},ri['application/mp4; codecs="stpp.ttml.im2t"']=function(){return new qx},ri['application/mp4; codecs="stpp.ttml.etd1"']=function(){return new qx},ri['application/mp4; codecs="stpp.ttml.etd1|im1t"']=function(){return new qx},ri['application/mp4; codecs="stpp.ttml.im1t|etd1"']=function(){return new qx},ri['application/mp4; codecs="stpp.TTML.im1t"']=function(){return new qx},Wx.prototype.parseInit=function(){},Wx.prototype.setSequenceMode=function(e){this.h=e},Wx.prototype.setManifestType=function(e){this.g=e},Wx.prototype.parseMedia=function(e,t){e=hn(e),e=e.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n");var n=e.split(/\n{2,}/m);if(!/^WEBVTT($|[ \t\n])/m.test(n[0]))throw new It(2,2,2e3);if(e=t.vttOffset,n[0].includes("X-TIMESTAMP-MAP")&&"HLS"==this.g)if(this.h){var i=n[0];if(e=i.match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),i=i.match(/MPEGTS:(\d+)/m),!e||!i)throw new It(2,2,2e3);if(e=tk(new jf(e[1])),null==e)throw new It(2,2,2e3);e=t.periodStart+Number(i[1])/9e4-e}else e=t.segmentStart;t=[],i=c(n[0].split("\n"));for(var r=i.next();!r.done;r=i.next())if(r=r.value,/^Region:/.test(r)){r=new jf(r);var s=new Me;$f(r),Vf(r);for(var a=$f(r);a;){var o=s,l=a;(a=/^id=(.*)$/.exec(l))?o.id=a[1]:(a=/^width=(\d{1,2}|100)%$/.exec(l))?o.width=Number(a[1]):(a=/^lines=(\d+)$/.exec(l))?(o.height=Number(a[1]),o.heightUnits=2):(a=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(l))?(o.regionAnchorX=Number(a[1]),o.regionAnchorY=Number(a[2])):(a=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(l))?(o.viewportAnchorX=Number(a[1]),o.viewportAnchorY=Number(a[2])):/^scroll=up$/.exec(l)&&(o.scroll="up"),Vf(r),a=$f(r)}t.push(s)}for(i=new Map,Kx(i),r=[],n=c(n.slice(1)),s=n.next();!s.done;s=n.next()){if(s=s.value.split("\n"),(1!=s.length||s[0])&&!/^NOTE($|[ \t])/.test(s[0])&&"STYLE"==s[0]){for(o=[],a=-1,l=1;l<s.length;l++)s[l].includes("::cue")&&(o.push([]),a=o.length-1),-1!=a&&(o[a].push(s[l]),s[l].includes("}")&&(a=-1));for(o=c(o),a=o.next();!a.done;a=o.next()){var u=a.value;a="global",(l=u[0].match(/\((.*)\)/))&&(a=l.pop()),l=u.slice(1,-1),u[0].includes("}")&&(u=/\{(.*?)\}/.exec(u[0]))&&(l=u[1].split(";")),(u=i.get(a))||(u=new Be(0,0,""));for(var d=!1,h=0;h<l.length;h++){var f=/^\s*([^:]+):\s*(.*)/.exec(l[h]);if(f){var p=f[2].trim().replace(";","");switch(f[1].trim()){case"background-color":case"background":d=!0,u.backgroundColor=p;break;case"color":d=!0,u.color=p;break;case"font-family":d=!0,u.fontFamily=p;break;case"font-size":d=!0,u.fontSize=p;break;case"font-weight":(700<=parseInt(p,10)||"bold"==p)&&(d=!0,u.fontWeight=700);break;case"font-style":switch(p){case"normal":d=!0,u.fontStyle=tt;break;case"italic":d=!0,u.fontStyle="italic";break;case"oblique":d=!0,u.fontStyle="oblique"}break;case"opacity":d=!0,u.opacity=parseFloat(p);break;case"text-combine-upright":d=!0,u.textCombineUpright=p;break;case"text-shadow":d=!0,u.textShadow=p;break;case"white-space":d=!0,u.wrapLine="noWrap"!=p}}}d&&i.set(a,u)}}if(d=e,1==s.length&&!s[0]||/^NOTE($|[ \t])/.test(s[0])||"STYLE"==s[0]||"REGION"==s[0])s=null;else if(o=null,s[0].includes("--\x3e")||(o=s[0],s.splice(0,1)),a=new jf(s[0]),l=tk(a),h=Hf(a,/[ \t]+--\x3e[ \t]+/g),u=tk(a),null==l||null==h||null==u)Z("Failed to parse VTT time code. Cue skipped:",o,s),s=null;else{for(l+=d,u+=d,s=s.slice(1).join("\n").trim(),i.has("global")?(d=i.get("global").clone(),d.startTime=l,d.endTime=u,d.payload=""):d=new Be(l,u,""),Vf(a),l=$f(a);l;)Jx(d,l,t),Vf(a),l=$f(a);Yx(s,d,i),null!=o&&(d.id=o),s=d}s&&r.push(s)}return r},G("shaka.text.VttTextParser",Wx),Wx.prototype.parseMedia=Wx.prototype.parseMedia,Wx.prototype.setManifestType=Wx.prototype.setManifestType,Wx.prototype.setSequenceMode=Wx.prototype.setSequenceMode,Wx.prototype.parseInit=Wx.prototype.parseInit;var nk=/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g;function ik(){this.g=null}function rk(e,t,n){var i,r,s;return(new cs).box("payl",gs(function(e){i=hn(e)})).box("iden",gs(function(e){r=hn(e)})).box("sttg",gs(function(e){s=hn(e)})).parse(e),i?sk(i,r,s,t,n):null}function sk(e,t,n,i,r){if(i=new Be(i,r,""),Yx(e,i,new Map),t&&(i.id=t),n)for(e=new jf(n),t=$f(e);t;)Jx(i,t,[]),Vf(e),t=$f(e);return i}function ak(){}function ok(e){if(e=Hf(e,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g),null==e)return null;var t=Number(e[2]),n=Number(e[3]);return 59<t||59<n?null:Number(e[4])/1e3+n+60*t+3600*(Number(e[1])||0)}function lk(){this.g=new Wx}function uk(e){var t="WEBVTT\n\n";if(""==e)return t;e=e.replace(/\r+/g,""),e=e.trim(),e=c(e.split("\n\n"));for(var n=e.next();!n.done;n=e.next())n=n.value.split(/\n/),n[0].match(/\d+/)&&n.shift(),n[0]=n[0].replace(/,/g,"."),t+=n.join("\n").replace(/{b}/g,"<b>").replace(/{\/b}/g,"</b>").replace(/{i}/g,"<i>").replace(/{\/i}/g,"</i>").replace(/{u}/g,"<u>").replace(/{\/u}/g,"</u>")+"\n\n";return t}function ck(){}function dk(e,t){var n=t.Fontname;if(n&&(e.fontFamily=n),(n=t.Fontsize)&&(e.fontSize=n+"px"),(n=t.PrimaryColour)&&(n=hk(n))&&(e.color=n),(n=t.BackColour)&&(n=hk(n))&&(e.backgroundColor=n),t.Bold&&(e.fontWeight=700),t.Italic&&(e.fontStyle="italic"),t.Underline&&e.textDecoration.push("underline"),(n=t.Spacing)&&(e.letterSpacing=n+"px"),n=t.Alignment)switch(parseInt(n,10)){case 1:e.displayAlign=ze,e.textAlign="start";break;case 2:e.displayAlign=ze,e.textAlign=$e;break;case 3:e.displayAlign=ze,e.textAlign="end";break;case 5:e.displayAlign="before",e.textAlign="start";break;case 6:e.displayAlign="before",e.textAlign=$e;break;case 7:e.displayAlign="before",e.textAlign="end";break;case 9:e.displayAlign="center",e.textAlign="start";break;case 10:e.displayAlign="center",e.textAlign=$e;break;case 11:e.displayAlign="center",e.textAlign="end"}(t=t.AlphaLevel)&&(e.opacity=parseFloat(t))}function hk(e){return e=parseInt(e.replace("&H",""),16),0<=e?"rgba("+(255&e)+","+(e>>8&255)+","+(e>>16&255)+","+(e>>24&255^255)/255+")":null}function fk(e){return e=vk.exec(e),3600*(e[1]?parseInt(e[1].replace(":",""),10):0)+60*parseInt(e[2],10)+parseFloat(e[3])}ri["text/vtt"]=function(){return new Wx},ri['text/vtt; codecs="vtt"']=function(){return new Wx},ri['text/vtt; codecs="wvtt"']=function(){return new Wx},ik.prototype.parseInit=function(e){var t=this,n=!1;if((new cs).box("moov",ds).box("trak",ds).box("mdia",ds).S("mdhd",function(e){e=vo(e.reader,e.version),t.g=e.timescale}).box("minf",ds).box("stbl",ds).S("stsd",hs).box("wvtt",function(){n=!0}).parse(e),!this.g)throw new It(2,2,2008);if(!n)throw new It(2,2,2008)},ik.prototype.setSequenceMode=function(){},ik.prototype.setManifestType=function(){},ik.prototype.parseMedia=function(e,t){if(!e.length)return[];if(!this.g)throw new It(2,2,2008);var n,i=0,r=[],s=[],a=!1,o=!1,l=!1,u=null;if((new cs).box("moof",ds).box("traf",ds).S("tfdt",function(e){a=!0,i=mo(e.reader,e.version).baseMediaDecodeTime}).S("tfhd",function(e){u=go(e.reader,e.flags).qd}).S("trun",function(e){o=!0,r=yo(e.reader,e.version,e.flags).fh}).box("mdat",gs(function(e){l=!0,n=e})).parse(e,!1),!l&&!a&&!o)throw new It(2,2,2008);e=i;for(var d=new os(n,0),h=c(r),f=h.next();!f.done;f=h.next()){f=f.value;var p=f.$f||u,g=f.He?i+f.He:e;e=g+(p||0);var m=0;do{var v=d.P();m+=v;var y=d.P(),b=null;"vttc"==vs(y)?8<v&&(b=d.rb(v-8)):d.skip(v-8),p&&b&&(v=rk(b,t.periodStart+g/this.g,t.periodStart+e/this.g),s.push(v))}while(f.sampleSize&&m<f.sampleSize)}return s.filter(oi)},G("shaka.text.Mp4VttParser",ik),ik.prototype.parseMedia=ik.prototype.parseMedia,ik.prototype.setManifestType=ik.prototype.setManifestType,ik.prototype.setSequenceMode=ik.prototype.setSequenceMode,ik.prototype.parseInit=ik.prototype.parseInit,ri['application/mp4; codecs="wvtt"']=function(){return new ik},ak.prototype.parseInit=function(){},ak.prototype.setSequenceMode=function(){},ak.prototype.setManifestType=function(){},ak.prototype.parseMedia=function(e){var t=hn(e).replace(/\r+/g,"");if(t=t.trim(),e=[],""==t)return e;t=c(t.split("\n\n"));for(var n=t.next();!n.done;n=t.next()){n=n.value.split("\n");var i=new jf(n[0]),r=ok(i),s=Hf(i,/,/g);if(i=ok(i),null==r||null==s||null==i)throw new It(2,2,2001,"Could not parse cue time range in SubViewer");e.push(new Be(r,i,n.slice(1).join("\n").trim()))}return e},G("shaka.text.SbvTextParser",ak),ak.prototype.parseMedia=ak.prototype.parseMedia,ak.prototype.setManifestType=ak.prototype.setManifestType,ak.prototype.setSequenceMode=ak.prototype.setSequenceMode,ak.prototype.parseInit=ak.prototype.parseInit,ri["text/x-subviewer"]=function(){return new ak},lk.prototype.parseInit=function(){},lk.prototype.setSequenceMode=function(){},lk.prototype.setManifestType=function(){},lk.prototype.parseMedia=function(e,t,n){return e=hn(e),e=uk(e),e=Ee(gn(e)),this.g.parseMedia(e,t,n)},G("shaka.text.SrtTextParser",lk),lk.srt2webvtt=uk,lk.prototype.parseMedia=lk.prototype.parseMedia,lk.prototype.setManifestType=lk.prototype.setManifestType,lk.prototype.setSequenceMode=lk.prototype.setSequenceMode,lk.prototype.parseInit=lk.prototype.parseInit,ri["text/srt"]=function(){return new lk},ck.prototype.parseInit=function(){},ck.prototype.setSequenceMode=function(){},ck.prototype.setManifestType=function(){},ck.prototype.parseMedia=function(e){var t="",n="",i=null,r=null;for(r=hn(e).split(/\r?\n\s*\r?\n/),e=c(r),r=e.next();!r.done;r=e.next()){var s=r.value;r=s,(s=pk.exec(s))&&(i=s[1],r=s[2]),"V4 Styles"==i||"V4+ Styles"==i?(t=r,t=n?t+"\n"+r:r):"Events"==i&&(n=n?n+"\n"+r:r)}for(i=[],r=null,t=c(t.split(/\r?\n/)),s=t.next();!s.done;s=t.next())if(e=s.value,!/^\s*;/.test(e)&&(s=gk.exec(e)))if(e=s[1].trim(),s=s[2].trim(),"Format"==e)r=s.split(mk);else if("Style"==e){e=s.split(mk),s={};for(var a=0;a<r.length&&a<e.length;a++)s[r[a]]=e[a];i.push(s)}for(r=[],t=null,e={},n=c(n.split(/\r?\n/)),s=n.next();!s.done;e={Ve:e.Ve},s=n.next())if(s=s.value,!/^\s*;/.test(s)&&(a=gk.exec(s)))if(s=a[1].trim(),a=a[2].trim(),"Format"==s)t=a.split(mk);else if("Dialogue"==s){a=a.split(mk),s={};for(var o=0;o<t.length&&o<a.length;o++)s[t[o]]=a[o];o=fk(s.Start);var l=fk(s.End);a=new Be(o,l,a.slice(t.length-1).join(",").replace(/\\N/g,"\n").replace(/\{[^}]+\}/g,"")),e.Ve=s.Style,(s=i.find(function(e){return function(t){return t.Name==e.Ve}}(e)))&&dk(a,s),r.push(a)}return r},G("shaka.text.SsaTextParser",ck),ck.prototype.parseMedia=ck.prototype.parseMedia,ck.prototype.setManifestType=ck.prototype.setManifestType,ck.prototype.setSequenceMode=ck.prototype.setSequenceMode,ck.prototype.parseInit=ck.prototype.parseInit;var pk=/^\s*\[([^\]]+)\]\r?\n([\s\S]*)/,gk=/^\s*([^:]+):\s*(.*)/,mk=/\s*,\s*/,vk=/^(\d+:)?(\d{1,2}):(\d{1,2}(?:[.]\d{1,3})?)?$/;function yk(e,t){var n=1&e[t+1]?7:9;return t+n<=e.length&&(e=((3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5)-n,0<e)?{le:n,ba:e}:null}function bk(e,t){var n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=(60&e[t+2])>>>2;if(i>n.length-1)return null;var r=1+((192&e[t+2])>>>6),s=(1&e[t+2])<<2;return s|=(192&e[t+3])>>>6,{sampleRate:n[i],channelCount:s,Na:"mp4a.40."+r}}function _k(e,t){if(t+1<e.length&&255===e[t]&&240===(246&e[t+1])){var n=1&e[t+1]?7:9;if(t+n>=e.length)return!1;var i=(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5;return!(i<=n)&&(t+=i,t===e.length||t+1<e.length&&255===e[t]&&240===(246&e[t+1]))}return!1}function Tk(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t||3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}function Sk(e){this.i=e,this.h=0,this.g=new Map}function wk(e,t){if(t+8>e.length||11!==e[t]||119!==e[t+1])return null;var n=e[t+4]>>6;if(3<=n)return null;var i=63&e[t+4],r=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*i+n];if(t+r>e.length)return null;var s=e[t+6]>>5,a=0;2===s?a+=2:(1&s&&1!==s&&(a+=2),4&s&&(a+=2)),a=(e[t+6]<<8|e[t+7])>>12-a&1;var o=7&e[t+5];return e=new Uint8Array([n<<6|e[t+5]>>3<<1|o>>2,(3&o)<<6|s<<3|a<<2|i>>4,i<<4&224]),{sampleRate:[48e3,44100,32e3][n],channelCount:[2,1,2,3,3,4,4,5][s]+a,ma:e,ba:r}}function Ek(e,t){if(11===e[t]&&119===e[t+1]){var n,i,r=0,s=5;for(t+=s;0<s;){i=e[t];var a=Math.min(s,8),o=8-a;n=4278190080>>>24+o<<o,n=(i&n)>>o,r=r?r<<a|n:n,t+=1,s-=a}if(16>r)return!0}return!1}function xk(e){this.i=e,this.h=0,this.g=new Map}function kk(e,t){if(t+8>e.length||2935!==(e[t]<<8|e[t+1]<<0))return null;var n=new Eo(e.subarray(t+2));ko(n,2),ko(n,3);var i=Ao(n,11)+1<<1,r=Ao(n,2);if(3==r){r=Ao(n,2),r=[24e3,22060,16e3][r];var s=3}else r=[48e3,44100,32e3][r],s=Ao(n,2);var a=Ao(n,3),o=Ao(n,1);return n=Ao(n,5),t+i>e.byteLength?null:(e=Math.floor(i*r/(16*[1,2,3,6][s])),e=new Uint8Array([(8160&e)>>5,(31&e)<<3,r<<6|n<<1|0,0|a<<1|o<<0,0]),{sampleRate:r,channelCount:[2,1,2,3,3,4,4,5][a]+o,ma:e,ba:i})}function Ak(e){this.i=e,this.h=0,this.g=new Map}function Ik(e){if(!e.length)return null;var t=e.find(function(e){return 7==e.type});if(e=e.find(function(e){return 8==e.type}),!t||!e)return null;var n=new Eo(t.data),i=Lo(n);if(Lo(n),Lo(n),Co(n),Dk.includes(i)&&(i=Do(n),3===i&&ko(n,1),Co(n),Co(n),ko(n,1),Mo(n))){i=3!==i?8:12;for(var r=0;r<i;r++)Mo(n)&&Po(n,6>r?16:64)}if(Co(n),i=Do(n),0===i)Do(n);else if(1===i)for(ko(n,1),Co(n),Co(n),i=Do(n),r=0;r<i;r++)Co(n);Co(n),ko(n,1);var s=Do(n),a=Do(n),o=Ao(n,1);0===o&&ko(n,1),ko(n,1);var l=0,u=0,c=0,h=0;if(Mo(n)&&(l=Do(n),u=Do(n),c=Do(n),h=Do(n)),r=i=1,Mo(n)&&Mo(n)){var f=Lo(n),p=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],g=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];0<f&&16>=f?(i=p[f-1],r=g[f-1]):255===f&&(i=Ao(n,16),r=Ao(n,16))}return n=(2-o)*(a+1)*16-2*c-2*h,s=16*(s+1)-2*l-2*u,l=[],t=t.fullData,l.push(t.byteLength>>>8&255),l.push(255&t.byteLength),l=l.concat.apply(l,d(t)),t=[],e=e.fullData,t.push(e.byteLength>>>8&255),t.push(255&e.byteLength),t=t.concat.apply(t,d(e)),e=new Uint8Array([1,l[3],l[4],l[5],255,225].concat(l,[1],t)),{height:n,width:s,wa:e,Ba:i,Ca:r}}function Ck(e){var t=!1,n=[],i=e.find(function(e){return 7==e.type}),r=!1;e=c(e);for(var s=e.next();!s.done;s=e.next()){s=s.value;var a=!1;switch(s.type){case 1:a=r=!0;var o=s.data;i&&4<o.length&&(o=Oo(new Eo(o)),2===o||4===o||7===o||9===o)&&(t=!0);break;case 5:t=a=r=!0;break;case 6:a=!0;break;case 7:a=!0;break;case 8:a=!0;break;case 9:r=a=!0;break;case 12:a=!0;break;default:a=!1}r&&a&&(a=s.fullData.byteLength,o=new Uint8Array(4),o[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=255&a,n.push(o),n.push(s.fullData))}return n.length?{data:kn.apply(_n,d(n)),Cd:t}:null}ri["text/x-ssa"]=function(){return new ck},i=Sk.prototype,i.destroy=function(){this.g.clear()},i.isSupported=function(e){return"audio/aac"==e.toLowerCase().split(";")[0]&&ce(this.convertCodecs("audio",e))},i.convertCodecs=function(e,t){return"audio/aac"==t.toLowerCase().split(";")[0]?'audio/mp4; codecs="'+(qn(t)||"mp4a.40.2")+'"':t},i.getOriginalMimeType=function(){return this.i},i.transmux=function(e,t,n,i){for(var r=Ee(e),s=po(r),a=s.length;a<r.length&&!_k(r,a);a++);if(e=1e3*n.endTime,s=fo(s),s.length&&n&&(s=s.find(function(e){return"com.apple.streaming.transportStreamTimestamp"===e.description}))&&(e=s.data),s=bk(r,a),!s)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));t.audioSamplingRate=s.sampleRate,t.channelsCount=s.channelCount;for(var o=[];a<r.length;){var l=yk(r,a);if(!l)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));var u=l.le+l.ba;a+u<=r.length&&o.push({data:r.subarray(a+l.le,a+u),size:l.ba,duration:1024,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),a+=u}return r=s.sampleRate,e=Math.floor(e*r/1e3),i={id:t.id,type:"audio",codecs:s.Na,encrypted:t.encrypted&&0<t.drmInfos.length,timescale:r,duration:i,ab:[],ma:new Uint8Array([]),wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.h,baseMediaDecodeTime:e,Za:o},stream:t},i=new H_([i]),n=t.id+"_"+n.i,this.g.has(n)?t=this.g.get(n):(t=$_(i),this.g.set(n,t)),n=K_(i),this.h++,t=kn(t,n),Promise.resolve(t)},G("shaka.transmuxer.AacTransmuxer",Sk),Sk.prototype.transmux=Sk.prototype.transmux,Sk.prototype.getOriginalMimeType=Sk.prototype.getOriginalMimeType,Sk.prototype.convertCodecs=Sk.prototype.convertCodecs,Sk.prototype.isSupported=Sk.prototype.isSupported,Sk.prototype.destroy=Sk.prototype.destroy,rt("audio/aac",function(){return new Sk("audio/aac")},ot),i=xk.prototype,i.destroy=function(){this.g.clear()},i.isSupported=function(e){return"audio/ac3"==e.toLowerCase().split(";")[0]&&ce(this.convertCodecs("audio",e))},i.convertCodecs=function(e,t){return"audio/ac3"==t.toLowerCase().split(";")[0]?'audio/mp4; codecs="ac-3"':t},i.getOriginalMimeType=function(){return this.i},i.transmux=function(e,t,n,i){e=Ee(e);for(var r=po(e),s=r.length;s<e.length&&!Ek(e,s);s++);var a=1e3*n.endTime;r=fo(r),r.length&&n&&(r=r.find(function(e){return"com.apple.streaming.transportStreamTimestamp"===e.description}))&&(a=r.data),r=0;for(var o=new Uint8Array([]),l=[];s<e.length;){var u=wk(e,s);if(!u)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));t.audioSamplingRate=u.sampleRate,t.channelsCount=u.channelCount,r=u.sampleRate,o=u.ma,l.push({data:e.subarray(s,s+u.ba),size:u.ba,duration:1536,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),s+=u.ba}return e=Math.floor(a*r/1e3),i={id:t.id,type:"audio",codecs:"ac-3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:r,duration:i,ab:[],ma:o,wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.h,baseMediaDecodeTime:e,Za:l},stream:t},i=new H_([i]),n=t.id+"_"+n.i,this.g.has(n)?t=this.g.get(n):(t=$_(i),this.g.set(n,t)),n=K_(i),this.h++,t=kn(t,n),Promise.resolve(t)},G("shaka.transmuxer.Ac3Transmuxer",xk),xk.prototype.transmux=xk.prototype.transmux,xk.prototype.getOriginalMimeType=xk.prototype.getOriginalMimeType,xk.prototype.convertCodecs=xk.prototype.convertCodecs,xk.prototype.isSupported=xk.prototype.isSupported,xk.prototype.destroy=xk.prototype.destroy,rt("audio/ac3",function(){return new xk("audio/ac3")},ot),i=Ak.prototype,i.destroy=function(){this.g.clear()},i.isSupported=function(e){return"audio/ec3"==e.toLowerCase().split(";")[0]&&ce(this.convertCodecs("audio",e))},i.convertCodecs=function(e,t){return"audio/ec3"==t.toLowerCase().split(";")[0]?'audio/mp4; codecs="ec-3"':t},i.getOriginalMimeType=function(){return this.i},i.transmux=function(e,t,n,i){e=Ee(e);for(var r=po(e),s=r.length;s<e.length&&2935!==(e[s]<<8|e[s+1]<<0);s++);var a=1e3*n.endTime;r=fo(r),r.length&&n&&(r=r.find(function(e){return"com.apple.streaming.transportStreamTimestamp"===e.description}))&&(a=r.data),r=0;for(var o=new Uint8Array([]),l=[];s<e.length;){var u=kk(e,s);if(!u)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));t.audioSamplingRate=u.sampleRate,t.channelsCount=u.channelCount,r=u.sampleRate,o=u.ma,l.push({data:e.subarray(s,s+u.ba),size:u.ba,duration:1536,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),s+=u.ba}return e=Math.floor(a*r/1e3),i={id:t.id,type:"audio",codecs:"ec-3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:r,duration:i,ab:[],ma:o,wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.h,baseMediaDecodeTime:e,Za:l},stream:t},i=new H_([i]),n=t.id+"_"+n.i,this.g.has(n)?t=this.g.get(n):(t=$_(i),this.g.set(n,t)),n=K_(i),this.h++,t=kn(t,n),Promise.resolve(t)},G("shaka.transmuxer.Ec3Transmuxer",Ak),Ak.prototype.transmux=Ak.prototype.transmux,Ak.prototype.getOriginalMimeType=Ak.prototype.getOriginalMimeType,Ak.prototype.convertCodecs=Ak.prototype.convertCodecs,Ak.prototype.isSupported=Ak.prototype.isSupported,Ak.prototype.destroy=Ak.prototype.destroy,rt("audio/ec3",function(){return new Ak("audio/ec3")},ot);var Dk=[100,110,122,244,44,83,86,118,128,138,139,134];function Rk(e){if(!e.length)return null;var t=e.find(function(e){return 32==e.type}),n=e.find(function(e){return 33==e.type}),i=e.find(function(e){return 34==e.type});if(!t||!n||!i)return null;var r=Mk(t.fullData);e=Lk(n.fullData);var s=Pk(i.fullData);return t=Ok(t.fullData,n.fullData,i.fullData,{Qf:r.Qf,kg:r.kg,Bf:e.Bf,Cf:e.Cf,vf:e.vf,Af:e.Af,wf:e.wf,xf:e.xf,yf:e.yf,zf:e.zf,nf:e.nf,pf:e.pf,qf:e.qf,rf:e.rf,tf:e.tf,uf:e.uf,hf:e.hf,ve:e.ve,ff:e.ff,df:e.df,cf:e.cf,Tf:s.Tf}),{height:e.height,width:e.width,wa:t,Ba:e.Yi,Ca:e.Xi}}function Mk(e){var t=new Eo(e,!0);return Lo(t),Lo(t),Ao(t,4),Ao(t,2),Ao(t,6),e=Ao(t,3),t=Mo(t),{Qf:e+1,kg:t}}function Lk(e){e=new Eo(e,!0),Lo(e),Lo(e);var t=0,n=0,i=0,r=0;Ao(e,4);var s=Ao(e,3);Mo(e);for(var a=Ao(e,2),o=Ao(e,1),l=Ao(e,5),u=Lo(e),c=Lo(e),d=Lo(e),h=Lo(e),f=Lo(e),p=Lo(e),g=Lo(e),m=Lo(e),v=Lo(e),y=Lo(e),b=Lo(e),_=[],T=[],S=0;S<s;S++)_.push(Mo(e)),T.push(Mo(e));if(0<s)for(S=s;8>S;S++)Ao(e,2);for(S=0;S<s;S++)_[S]&&Ao(e,88),T[S]&&Lo(e);Do(e),_=Do(e),3==_&&Ao(e,1),T=Do(e),S=Do(e),Mo(e)&&(t+=Do(e),n+=Do(e),i+=Do(e),r+=Do(e));var w=Do(e),E=Do(e),x=Do(e);if(Mo(e))for(var k=0;k<=s;k++)Do(e),Do(e),Do(e);else Do(e),Do(e),Do(e);if(Do(e),Do(e),Do(e),Do(e),Do(e),Do(e),Mo(e)&&Mo(e))for(k=0;4>k;k++)for(var A=0;A<(3===k?2:6);A++)if(Mo(e)){var I=Math.min(64,1<<4+(k<<1));1<k&&Ro(e);for(var C=0;C<I;C++)Ro(e)}else Do(e);for(Mo(e),Mo(e),Mo(e)&&(Lo(e),Do(e),Do(e),Mo(e)),k=Do(e),I=A=0;I<k;I++)if(C=!1,0!==I&&(C=Mo(e)),C){I===k&&Do(e),Mo(e),Do(e);for(var D=C=0;D<=A;D++){var R=Mo(e),M=!1;R||(M=Mo(e)),(R||M)&&C++}A=C}else{for(D=Do(e),C=Do(e),A=D+C,R=0;R<D;R++)Do(e),Mo(e);for(D=0;D<C;D++)Do(e),Mo(e)}if(Mo(e))for(k=Do(e),A=0;A<k;A++){for(I=0;I<x+4;I++)Ao(e,1);Ao(e,1)}if(k=x=1,A=0,Mo(e),Mo(e),Mo(e)){if(Mo(e)&&(I=Lo(e),C=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],D=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1],0<I&&16>=I?(x=C[I-1],k=D[I-1]):255===I&&(x=Ao(e,16),k=Ao(e,16))),Mo(e)&&Mo(e),Mo(e)&&(Ao(e,3),Mo(e),Mo(e)&&(Lo(e),Lo(e),Lo(e))),Mo(e)&&(Do(e),Do(e)),Mo(e),Mo(e),Mo(e),(I=Mo(e))&&(Do(e),Do(e),Do(e),Do(e)),Mo(e)&&(Ao(e,32),Ao(e,32),Mo(e)&&Do(e),Mo(e)))for(D=!1,I=Mo(e),C=Mo(e),(I||C)&&((D=Mo(e))&&(Lo(e),Ao(e,5),Mo(e),Ao(e,5)),Ao(e,4),Ao(e,4),D&&Ao(e,4),Ao(e,5),Ao(e,5),Ao(e,5)),R=0;R<=s;R++){var L=!0;M=1,Mo(e)||(L=Mo(e));var P=!1;if(L?Do(e):P=Mo(e),P||(M=Do(e)+1),I){for(L=0;L<M;L++)Do(e),Do(e),D&&(Do(e),Do(e));Mo(e)}if(C){for(L=0;L<M;L++)Do(e),Do(e),D&&(Do(e),Do(e));Mo(e)}}Mo(e)&&(Mo(e),Mo(e),Mo(e),A=Do(e),Do(e),Do(e),Do(e),Do(e))}return{vf:b,Bf:a,Cf:o,Af:l,wf:u,xf:c,yf:d,zf:h,nf:f,pf:p,qf:g,rf:m,tf:v,uf:y,ve:A,hf:0,ff:_,df:w,cf:E,width:T-(t+n)*(1===_||2===_?2:1),height:S-(i+r)*(1===_?2:1),Yi:x,Xi:k}}function Pk(e){var t=new Eo(e,!0);Lo(t),Lo(t),Do(t),Do(t),Mo(t),Mo(t),Ao(t,3),Mo(t),Mo(t),Do(t),Do(t),Ro(t),Mo(t),Mo(t),Mo(t)&&Do(t),Ro(t),Ro(t),Mo(t),Mo(t),Mo(t),Mo(t),e=Mo(t),t=Mo(t);var n=1;return t&&e?n=0:t?n=3:e&&(n=2),{Tf:n}}function Ok(e,t,n,i){var r=new Uint8Array(23+(5+e.byteLength)+(5+t.byteLength)+(5+n.byteLength));return r[0]=1,r[1]=(3&i.Bf)<<6|(i.Cf?1:0)<<5|31&i.Af,r[2]=i.wf,r[3]=i.xf,r[4]=i.yf,r[5]=i.zf,r[6]=i.nf,r[7]=i.pf,r[8]=i.qf,r[9]=i.rf,r[10]=i.tf,r[11]=i.uf,r[12]=i.vf,r[13]=240|(3840&i.ve)>>8,r[14]=255&i.ve,r[15]=252|3&i.Tf,r[16]=252|3&i.ff,r[17]=248|7&i.df,r[18]=248|7&i.cf,r[19]=0,r[20]=0,r[21]=(3&i.hf)<<6|(7&i.Qf)<<3|(i.kg?1:0)<<2|3,r[22]=3,r[23]=160,r[24]=0,r[25]=1,r[26]=(65280&e.byteLength)>>8,r[27]=(255&e.byteLength)>>0,r.set(e,28),r[23+(5+e.byteLength)]=161,r[e.byteLength+29]=0,r[e.byteLength+30]=1,r[e.byteLength+31]=(65280&t.byteLength)>>8,r[e.byteLength+32]=(255&t.byteLength)>>0,r.set(t,e.byteLength+33),r[23+(e.byteLength+10+t.byteLength)]=162,r[e.byteLength+10+t.byteLength+24]=0,r[e.byteLength+10+t.byteLength+25]=1,r[e.byteLength+10+t.byteLength+26]=(65280&n.byteLength)>>8,r[e.byteLength+10+t.byteLength+27]=(255&n.byteLength)>>0,r.set(n,e.byteLength+10+t.byteLength+28),r}function Nk(e,t){var n=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==n&&0!==r&&15!==r&&3!==s){var a=e[t+3]>>6;r=1e3*Bk[14*(3===n?3-i:3===i?3:4)+r-1],s=jk[3*(3===n?0:2===n?1:2)+s],n=Vk[n][i];var o=Hk[i],l=Math.floor(n*r/s+(e[t+2]>>1&1))*o,u=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);return(u=u?parseInt(u[1],10):0)&&87>=u&&2===i&&224e3<=r&&0===a&&(e[t+3]|=128),{sampleRate:s,channelCount:3===a?1:2,ba:l,Wi:8*n*o}}return null}function Uk(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function Fk(e,t){if(t+1<e.length&&Uk(e,t)){var n=Nk(e,t),i=4;return n&&n.ba&&(i=n.ba),t+=i,t===e.length||t+1<e.length&&Uk(e,t)}return!1}var Bk=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],jk=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Vk=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Hk=[0,1,1,4];function $k(e){this.i=e,this.h=0,this.g=new Map}function Gk(e){this.h=e,this.g=null}
/*
 @license
 MSS Transmuxer
 Copyright 2015 Dash Industry Forum
 SPDX-License-Identifier: BSD-3-Clause
*/
function zk(e){this.h=e,(this.g=Jy.get("ISOBoxer")())&&qk(this)}function qk(e){function t(){this._procFullBox(),1&this.flags&&(this._procField("AlgorithmID","uint",24),this._procField("IV_size","uint",8),this._procFieldArray("KID",16,"uint",8)),this._procField("sample_count","uint",32),this._procEntries("entry",this.sample_count,function(e){this._procEntryField(e,"InitializationVector","data",8),2&this.flags&&(this._procEntryField(e,"NumberOfEntries","uint",16),this._procSubEntries(e,"clearAndCryptedData",e.NumberOfEntries,function(e){this._procEntryField(e,"BytesOfClearData","uint",16),this._procEntryField(e,"BytesOfEncryptedData","uint",32)}))})}e.g.addBoxProcessor("saio",function(){this._procFullBox(),1&this.flags&&(this._procField("aux_info_type","uint",32),this._procField("aux_info_type_parameter","uint",32)),this._procField("entry_count","uint",32),this._procFieldArray("offset",this.entry_count,"uint",1===this.version?64:32)}),e.g.addBoxProcessor("saiz",function(){this._procFullBox(),1&this.flags&&(this._procField("aux_info_type","uint",32),this._procField("aux_info_type_parameter","uint",32)),this._procField("default_sample_info_size","uint",8),this._procField("sample_count","uint",32),0===this.default_sample_info_size&&this._procFieldArray("sample_info_size",this.sample_count,"uint",8)}),e.g.addBoxProcessor("senc",t),e.g.addBoxProcessor("uuid",function(){for(var e=!0,n=0;16>n;n++)this.usertype[n]!==Kk[n]&&(e=!1);e&&(this._parsing&&(this.type="sepiff"),t.call(this))})}function Wk(e,t){for(var n=8,i=0;i<e.boxes.length&&e.boxes[i].type!==t;i++)n+=e.boxes[i].size;return n}i=$k.prototype,i.destroy=function(){this.g.clear()},i.isSupported=function(e){return"audio/mpeg"==e.toLowerCase().split(";")[0]&&ce(this.convertCodecs("audio",e))},i.convertCodecs=function(e,t){return"audio/mpeg"==t.toLowerCase().split(";")[0]?'audio/mp4; codecs="mp3"':t},i.getOriginalMimeType=function(){return this.i},i.transmux=function(e,t,n,i){for(var r=Ee(e),s=po(r).length;s<r.length&&!Fk(r,s);s++);var a;for(e=[];s<r.length;){var o=Nk(r,s);if(!o)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));a||(a=o),s+o.ba<=r.length&&e.push({data:r.subarray(s,s+o.ba),size:o.ba,duration:1152,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),s+=o.ba}return a?(r=9e4*a.Wi/a.sampleRate*this.h,i={id:t.id,type:"audio",codecs:"mp3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:a.sampleRate,duration:i,ab:[],ma:new Uint8Array([]),wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.h,baseMediaDecodeTime:r,Za:e},stream:t},i=new H_([i]),n=t.id+"_"+n.i,this.g.has(n)?t=this.g.get(n):(t=$_(i),this.g.set(n,t)),n=K_(i),this.h++,t=kn(t,n),Promise.resolve(t)):Promise.reject(new It(2,3,3018,n?n.M()[0]:null))},G("shaka.transmuxer.Mp3Transmuxer",$k),$k.prototype.transmux=$k.prototype.transmux,$k.prototype.getOriginalMimeType=$k.prototype.getOriginalMimeType,$k.prototype.convertCodecs=$k.prototype.convertCodecs,$k.prototype.isSupported=$k.prototype.isSupported,$k.prototype.destroy=$k.prototype.destroy,rt("audio/mpeg",function(){return new $k("audio/mpeg")},ot),i=Gk.prototype,i.destroy=function(){},i.isSupported=function(e){if("video/mp2t"!=e.toLowerCase().split(";")[0])return!1;var t=qn(e).split(","),n=Rn("audio",t);return t=Rn("video",t),!(!n||t||"mp3"!=$n(n))&&ce(this.convertCodecs("audio",e))},i.convertCodecs=function(e,t){return"video/mp2t"==t.toLowerCase().split(";")[0]?"audio/mpeg":t},i.getOriginalMimeType=function(){return this.h},i.transmux=function(e,t,n,i,r){if(this.g?this.g.clearData():this.g=new No,e=Ee(e),e=this.g.parse(e),"mp3"!=e.sd().audio||"audio"!=r)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));for(n=new Uint8Array([]),r=c(e.Wb()),e=r.next();!e.done;e=r.next())if(e=e.value.data)for(t=0;t<e.length;)(i=Nk(e,t))?(t+i.ba<=e.length&&(n=kn(n,e.subarray(t,t+i.ba))),t+=i.ba):t++;return Promise.resolve(n)},G("shaka.transmuxer.MpegTsTransmuxer",Gk),Gk.prototype.transmux=Gk.prototype.transmux,Gk.prototype.getOriginalMimeType=Gk.prototype.getOriginalMimeType,Gk.prototype.convertCodecs=Gk.prototype.convertCodecs,Gk.prototype.isSupported=Gk.prototype.isSupported,Gk.prototype.destroy=Gk.prototype.destroy,rt("video/mp2t",function(){return new Gk("video/mp2t")},lt),i=zk.prototype,i.destroy=function(){},i.isSupported=function(e,t){var n=e.startsWith("mss/");return!(!this.g||!n)&&(t?ce(this.convertCodecs(t,e)):(t=this.convertCodecs("audio",e),e=this.convertCodecs("video",e),ce(t)||ce(e)))},i.convertCodecs=function(e,t){return t.replace("mss/","")},i.getOriginalMimeType=function(){return this.h},i.transmux=function(e,t,n){if(!n)return Promise.resolve(Ee(e));if(!t.mssPrivateData)return Promise.reject(new It(2,3,3020,n?n.M()[0]:null));try{var i,r=this.g.parseBuffer(e),s=r.fetch("tfhd");s.track_ID=t.id+1;var a=r.fetch("tfdt"),o=r.fetch("traf");null===a&&(a=this.g.createFullBox("tfdt",o,s),a.version=1,a.flags=0,a.baseMediaDecodeTime=Math.floor(n.startTime*t.mssPrivateData.timescale));var l=r.fetch("trun"),u=r.fetch("tfxd");u&&u._parent.boxes.splice(u._parent.boxes.indexOf(u),1);var c=r.fetch("tfrf");c&&c._parent.boxes.splice(c._parent.boxes.indexOf(c),1);var d=r.fetch("sepiff");if(null!==d){d.type="senc",d.usertype=void 0;var h=r.fetch("saio");if(null===h){h=this.g.createFullBox("saio",o),h.version=0,h.flags=0,h.entry_count=1,h.offset=[0];var f=this.g.createFullBox("saiz",o);if(f.version=0,f.flags=0,f.sample_count=d.sample_count,f.default_sample_info_size=0,f.sample_info_size=[],2&d.flags)for(i=0;i<d.sample_count;i+=1)f.sample_info_size[i]=10+6*d.entry[i].NumberOfEntries;else f.default_sample_info_size=8}}s.flags&=16777214,s.flags|=131072,l.flags|=1;var p=r.fetch("moof");l.data_offset=p.getLength()+8;var g=r.fetch("saio");null!==g&&(g.offset[0]=Wk(p,"traf")+Wk(o,"senc")+16);var m=Ee(r.write());return Promise.resolve(m)}catch(e){return e instanceof It?Promise.reject(e):Promise.reject(new It(2,3,3022,n?n.M()[0]:null))}},G("shaka.transmuxer.MssTransmuxer",zk),zk.prototype.transmux=zk.prototype.transmux,zk.prototype.getOriginalMimeType=zk.prototype.getOriginalMimeType,zk.prototype.convertCodecs=zk.prototype.convertCodecs,zk.prototype.isSupported=zk.prototype.isSupported,zk.prototype.destroy=zk.prototype.destroy;var Kk=new Uint8Array([162,57,79,82,90,155,79,20,162,68,108,66,124,100,141,244]);function Yk(e){this.l=e,this.g=0,this.i=new Map,this.h=this.j=null}rt("mss/audio/mp4",function(){return new zk("mss/audio/mp4")},ot),rt("mss/video/mp4",function(){return new zk("mss/video/mp4")},ot),i=Yk.prototype,i.destroy=function(){this.i.clear(),this.h&&this.h.destroy()},i.isSupported=function(e,t){if("video/mp2t"!=e.toLowerCase().split(";")[0])return!1;var n=e;t&&(n=this.convertCodecs(t,e));var i=qn(n).split(",");return n=Rn("audio",i),i=Rn("video",i),!(n&&(n=$n(n),!Zk.includes(n))||i&&(n=$n(i),!Jk.includes(n)))&&(t?ce(this.convertCodecs(t,e)):(t=this.convertCodecs("audio",e),e=this.convertCodecs("video",e),ce(t)||ce(e)))},i.convertCodecs=function(e,t){return"video/mp2t"==t.toLowerCase().split(";")[0]?(t=qn(t).replace("mp4a.40.34","mp3").split(",").map(function(e){return Pi(e,"audio/mp4")}).map(Oi).join(","),"audio"==e?'audio/mp4; codecs="'+t+'"':'video/mp4; codecs="'+t+'"'):t},i.getOriginalMimeType=function(){return this.l},i.transmux=function(e,t,n,i,r){var s=Ee(e);if("audio"==r&&!Vo(s)){for(var a=po(s),o=a.length;o<s.length;o++)if(Fk(s,o))return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));for(o=a.length;o<s.length;o++)if(_k(s,o))return this.h||(this.h=new Sk("audio/aac")),this.h.transmux(e,t,n,i,r);return Promise.reject(new It(2,3,3018,n?n.M()[0]:null))}this.j?this.j.clearData():this.j=new No;var l=this.j.parse(s),u=[],h=l.sd();try{var f=null;if("video"==r){switch(h.video){case"avc":var p=[],g=null,m=[],v=l.Ic();if(!v.length)throw new It(2,3,3023,n?n.M()[0]:null);for(var y=0;y<v.length;y++){var b=v[y],_=b.nalus;m.push.apply(m,d(_));var T=Ck(_);if(T){null==g&&(g=b.dts);var S=void 0;S=y+1<v.length?(v[y+1].dts||0)-(b.dts||0):1<v.length?(b.dts||0)-(v[y-1].dts||0):9e4*(n.endTime-n.startTime),p.push({data:T.data,size:T.data.byteLength,duration:S,eb:Math.round((b.pts||0)-(b.dts||0)),flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:T.Cd?2:1,ib:T.Cd?0:1}})}}var w=Ik(m);if(!w||null==g)throw new It(2,3,3018,n?n.M()[0]:null);t.height=w.height,t.width=w.width,f={id:t.id,type:"video",codecs:"avc1",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:9e4,duration:i,ab:[],ma:new Uint8Array([]),wa:w.wa,Ba:w.Ba,Ca:w.Ca,data:{sb:this.g,baseMediaDecodeTime:g,Za:p},stream:t};break;case"hvc":var E=[],x=null,k=[],A=l.Ic();if(!A.length)throw new It(2,3,3023,n?n.M()[0]:null);for(var I=0;I<A.length;I++){var C=A[I],D=C.nalus;k.push.apply(k,d(D));for(var R=!1,M=[],L=!1,P=c(D),O=P.next();!O.done;O=P.next()){var N=O.value;switch(N.type){case 1:case 0:var U=L=!0;break;case 19:case 20:case 21:R=U=L=!0;break;case 32:U=!0;break;case 33:U=!0;break;case 34:U=!0;break;case 35:L=U=!0;break;case 39:case 40:U=!0;break;default:U=!1}if(L&&U){var F=N.fullData.byteLength,B=new Uint8Array(4);B[0]=F>>24&255,B[1]=F>>16&255,B[2]=F>>8&255,B[3]=255&F,M.push(B),M.push(N.fullData)}}var j=M.length?{data:kn.apply(_n,d(M)),Cd:R}:null;if(j){null==x&&null!=C.dts&&(x=C.dts);var V=void 0;V=I+1<A.length?(A[I+1].dts||0)-(C.dts||0):1<A.length?(C.dts||0)-(A[I-1].dts||0):9e4*(n.endTime-n.startTime),E.push({data:j.data,size:j.data.byteLength,duration:V,eb:Math.round((C.pts||0)-(C.dts||0)),flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:j.Cd?2:1,ib:j.Cd?0:1}})}}var H=Rk(k);if(!H||null==x)throw new It(2,3,3018,n?n.M()[0]:null);t.height=H.height,t.width=H.width,f={id:t.id,type:"video",codecs:"hvc1",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:9e4,duration:i,ab:[],ma:new Uint8Array([]),wa:H.wa,Ba:H.Ba,Ca:H.Ca,data:{sb:this.g,baseMediaDecodeTime:x,Za:E},stream:t}}f&&(u.push(f),f=null)}if("audio"==r){switch(h.audio){case"aac":for(var $,G=[],z=null,q=c(l.Wb()),W=q.next();!W.done;W=q.next()){var K=W.value,Y=K.data;if(Y){var X=0;if($=bk(Y,X),!$)throw new It(2,3,3018,n?n.M()[0]:null);for(t.audioSamplingRate=$.sampleRate,t.channelsCount=$.channelCount,null==z&&null!==K.pts&&(z=K.pts);X<Y.length;){var Q=yk(Y,X);if(Q){var Z=Q.le+Q.ba;X+Z<=Y.length&&G.push({data:Y.subarray(X+Q.le,X+Z),size:Q.ba,duration:1024,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),X+=Z}else X++}}}if(!$||null==z){if(!l.Ic().length)throw new It(2,3,3018,n?n.M()[0]:null);z=9e4*n.startTime;var J=Rn("audio",t.codecs.split(","));if(!J||!t.channelsCount||!t.audioSamplingRate)throw new It(2,3,3018,n?n.M()[0]:null);$={sampleRate:t.audioSamplingRate,channelCount:t.channelsCount,Na:J};var ee=Tk(J,t.channelsCount);if(!ee)throw new It(2,3,3018,n?n.M()[0]:null);for(var te=z+9e4*(n.endTime-n.startTime),ne=z;ne<te;)G.push({data:ee,size:ee.byteLength,duration:1024,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),ne+=1024/$.sampleRate*9e4}var ie=$.sampleRate,re=z/9e4*ie;f={id:t.id,type:"audio",codecs:$.Na,encrypted:t.encrypted&&0<t.drmInfos.length,timescale:ie,duration:i,ab:[],ma:new Uint8Array([]),wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.g,baseMediaDecodeTime:re,Za:G},stream:t};break;case"ac3":for(var se=[],ae=0,oe=new Uint8Array([]),le=null,ue=c(l.Wb()),ce=ue.next();!ce.done;ce=ue.next()){var de=ce.value,he=de.data;null==le&&null!==de.pts&&(le=de.pts);for(var fe=0;fe<he.length;){var pe=wk(he,fe);pe?(t.audioSamplingRate=pe.sampleRate,t.channelsCount=pe.channelCount,ae=pe.sampleRate,oe=pe.ma,se.push({data:he.subarray(fe,fe+pe.ba),size:pe.ba,duration:1536,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),fe+=pe.ba):fe++}}if(0==ae||0==oe.byteLength||null==le)throw new It(2,3,3018,n?n.M()[0]:null);var ge=le/9e4*ae;f={id:t.id,type:"audio",codecs:"ac-3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:ae,duration:i,ab:[],ma:oe,wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.g,baseMediaDecodeTime:ge,Za:se},stream:t};break;case"ec3":for(var me=[],ve=0,ye=new Uint8Array([]),be=null,_e=c(l.Wb()),Te=_e.next();!Te.done;Te=_e.next()){var Se=Te.value,we=Se.data;null==be&&null!==Se.pts&&(be=Se.pts);for(var xe=0;xe<we.length;){var ke=kk(we,xe);ke?(t.audioSamplingRate=ke.sampleRate,t.channelsCount=ke.channelCount,ve=ke.sampleRate,ye=ke.ma,me.push({data:we.subarray(xe,xe+ke.ba),size:ke.ba,duration:1536,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),xe+=ke.ba):xe++}}if(0==ve||0==ye.byteLength||null==be)throw new It(2,3,3018,n?n.M()[0]:null);var Ae=be/9e4*ve;f={id:t.id,type:"audio",codecs:"ec-3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:ve,duration:i,ab:[],ma:ye,wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.g,baseMediaDecodeTime:Ae,Za:me},stream:t};break;case"mp3":for(var Ie,Ce=[],De=null,Re=c(l.Wb()),Me=Re.next();!Me.done;Me=Re.next()){var Le=Me.value,Pe=Le.data;if(Pe){null==De&&null!==Le.pts&&(De=Le.pts);for(var Oe=0;Oe<Pe.length;){var Ne=Nk(Pe,Oe);Ne?(Ie||(Ie=Ne),Oe+Ne.ba<=Pe.length&&Ce.push({data:Pe.subarray(Oe,Oe+Ne.ba),size:Ne.ba,duration:1152,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),Oe+=Ne.ba):Oe++}}}if(!Ie||null==De)throw new It(2,3,3018,n?n.M()[0]:null);var Ue=Ie.sampleRate,Fe=De/9e4*Ue;f={id:t.id,type:"audio",codecs:"mp3",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:Ue,duration:i,ab:[],ma:new Uint8Array([]),wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.g,baseMediaDecodeTime:Fe,Za:Ce},stream:t};break;case"opus":var Be=[],je=null,Ve=l.F;if(!Ve)throw new It(2,3,3018,n?n.M()[0]:null);var He=[];switch(Ve.Jh){case 1:case 2:He=[0];break;case 0:He=[255,1,1,0,1];break;case 128:He=[255,2,0,0,1];break;case 3:He=[1,2,1,0,2,1];break;case 4:He=[1,2,2,0,1,2,3];break;case 5:He=[1,3,2,0,4,1,2,3];break;case 6:He=[1,4,2,0,4,1,2,3,5];break;case 7:He=[1,4,2,0,4,1,2,3,5,6];break;case 8:He=[1,5,3,0,6,1,2,3,4,5,7];break;case 130:He=[1,1,2,0,1];break;case 131:He=[1,1,3,0,1,2];break;case 132:He=[1,1,4,0,1,2,3];break;case 133:He=[1,1,5,0,1,2,3,4];break;case 134:He=[1,1,6,0,1,2,3,4,5];break;case 135:He=[1,1,7,0,1,2,3,4,5,6];break;case 136:He=[1,1,8,0,1,2,3,4,5,6,7]}for(var $e=new Uint8Array([0,Ve.channelCount,0,0,Ve.sampleRate>>>24&255,Ve.sampleRate>>>17&255,Ve.sampleRate>>>8&255,Ve.sampleRate>>>0&255,0,0].concat(d(He))),Ge=Ve.sampleRate,ze=c(l.Wb()),qe=ze.next();!qe.done;qe=ze.next()){var We=qe.value,Ke=We.data;null==je&&null!==We.pts&&(je=We.pts);for(var Ye=0;Ye<Ke.length;){for(var Xe=0!==(16&Ke[Ye+1]),Qe=0!==(8&Ke[Ye+1]),Ze=Ye+2,Je=0;255===Ke[Ze];)Je+=255,Ze+=1;Je+=Ke[Ze],Ze+=1,Ze+=Xe?2:0,Ze+=Qe?2:0;var et=Ke.slice(Ze,Ze+Je);Be.push({data:et,size:et.byteLength,duration:960,eb:0,flags:{hb:0,Xa:0,Wa:0,Ua:0,Va:2,ib:0}}),Ye=Ze+Je}}if(0==$e.byteLength||null==je)throw new It(2,3,3018,n?n.M()[0]:null);t.audioSamplingRate=Ve.sampleRate,t.channelsCount=Ve.channelCount;var tt=je/9e4*Ge;f={id:t.id,type:"audio",codecs:"opus",encrypted:t.encrypted&&0<t.drmInfos.length,timescale:Ge,duration:i,ab:[],ma:$e,wa:new Uint8Array([]),Ba:0,Ca:0,data:{sb:this.g,baseMediaDecodeTime:tt,Za:Be},stream:t}}f&&(u.push(f),f=null)}}catch(e){return e&&3023==e.code?Promise.resolve(new Uint8Array([])):Promise.reject(e)}if(!u.length)return Promise.reject(new It(2,3,3018,n?n.M()[0]:null));var nt=new H_(u),it=t.id+"_"+n.i;if(this.i.has(it))var rt=this.i.get(it);else rt=$_(nt),this.i.set(it,rt);var st=K_(nt);this.g++;var at=kn(rt,st);return Promise.resolve(at)},G("shaka.transmuxer.TsTransmuxer",Yk),Yk.prototype.transmux=Yk.prototype.transmux,Yk.prototype.getOriginalMimeType=Yk.prototype.getOriginalMimeType,Yk.prototype.convertCodecs=Yk.prototype.convertCodecs,Yk.prototype.isSupported=Yk.prototype.isSupported,Yk.prototype.destroy=Yk.prototype.destroy;var Xk,Qk,Zk=["aac","ac-3","ec-3","mp3","opus"],Jk=["avc","hevc"];
/*
 @license
 EME Encryption Scheme Polyfill
 Copyright 2019 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
function eA(){}function tA(){Xk||navigator.emeEncryptionSchemePolyfilled?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(Xk=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=nA,navigator.emeEncryptionSchemePolyfilled=!0):console.debug("EmeEncryptionSchemePolyfill: EME not found")}function nA(e,t){var n,i=this;return N(function(r){return 1==r.g?(console.assert(i==navigator,'bad "this" for requestMediaKeySystemAccess'),S(r,Xk.call(i,e,t),2)):(n=r.h,hA(n)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=Xk,r.return(n)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=iA,r.return(iA.call(i,e,t))))})}function iA(e,t){var n,i,r,s,a,o,l,u,d,h,f,p,g=this;return N(function(m){if(1==m.g){for(console.assert(g==navigator,'bad "this" for requestMediaKeySystemAccess'),n=dA(e),i=[],r=c(t),s=r.next();!s.done;s=r.next())a=s.value,o=rA(a.videoCapabilities,n),l=rA(a.audioCapabilities,n),a.videoCapabilities&&a.videoCapabilities.length&&!o.length||a.audioCapabilities&&a.audioCapabilities.length&&!l.length||(u=Object.assign({},a),u.videoCapabilities=o,u.audioCapabilities=l,i.push(u));if(!i.length)throw d=Error("Unsupported keySystem or supportedConfigurations."),d.name="NotSupportedError",d.code=DOMException.NOT_SUPPORTED_ERR,d;return S(m,Xk.call(g,e,i),2)}return h=m.h,p=f=null,i[0]&&(i[0].videoCapabilities&&(f=i[0].videoCapabilities[0].encryptionScheme),i[0].audioCapabilities&&(p=i[0].audioCapabilities[0].encryptionScheme)),m.return(new cA(h,f,p))})}function rA(e,t){return e?e.filter(function(e){return fA(e.encryptionScheme,t)}):e}function sA(){}function aA(){Qk||navigator.mediaCapabilitiesEncryptionSchemePolyfilled?console.debug("McEncryptionSchemePolyfill: Already installed."):navigator.mediaCapabilities?(Qk=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=oA,navigator.mediaCapabilitiesEncryptionSchemePolyfilled=!0):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")}function oA(e){var t,n,i,r=this;return N(function(s){switch(s.g){case 1:return console.assert(r==navigator.mediaCapabilities,'bad "this" for decodingInfo'),S(s,Qk.call(r,e),2);case 2:if(t=s.h,!e.keySystemConfiguration)return s.return(t);if((n=t.keySystemAccess)&&hA(n))return console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=Qk,s.return(t);if(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=lA,n){s.u(3);break}return i=t,S(s,uA(e),4);case 4:return i.keySystemAccess=s.h,s.return(t);case 3:return s.return(lA.call(r,e))}})}function lA(e){var t,n,i,r,s,a,o,l,u=this;return N(function(c){switch(c.g){case 1:return console.assert(u==navigator.mediaCapabilities,'bad "this" for decodingInfo'),n=t=null,!e.keySystemConfiguration||(i=e.keySystemConfiguration,r=i.keySystem,n=i.audio&&i.audio.encryptionScheme,t=i.video&&i.video.encryptionScheme,s=dA(r),a={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:e},fA(n,s)&&fA(t,s))?S(c,Qk.call(u,e),2):c.return(a);case 2:if(o=c.h,o.keySystemAccess){o.keySystemAccess=new cA(o.keySystemAccess,t,n),c.u(3);break}if(!e.keySystemConfiguration){c.u(3);break}return l=o,S(c,uA(e),5);case 5:l.keySystemAccess=c.h;case 3:return c.return(o)}})}function uA(e){var t,n;return N(function(i){if(1==i.g){var r=e.keySystemConfiguration,s=[],a=[];return r.audio&&s.push({robustness:r.audio.robustness||"",contentType:e.audio.contentType,encryptionScheme:r.audio.encryptionScheme}),r.video&&a.push({robustness:r.video.robustness||"",contentType:e.video.contentType,encryptionScheme:r.video.encryptionScheme}),r={initDataTypes:r.initDataType?[r.initDataType]:[],distinctiveIdentifier:r.distinctiveIdentifier,persistentState:r.persistentState,sessionTypes:r.sessionTypes},s.length&&(r.audioCapabilities=s),a.length&&(r.videoCapabilities=a),t=r,S(i,navigator.requestMediaKeySystemAccess(e.keySystemConfiguration.keySystem,[t]),2)}return n=i.h,i.return(n)})}function cA(e,t,n){this.g=e,this.i=t||null,this.h=n||null,this.keySystem=e.keySystem}function dA(e){return e.startsWith("com.widevine")||e.startsWith("com.microsoft")||e.startsWith("com.chromecast")||e.startsWith("com.adobe")||e.startsWith("org.w3")?"cenc":e.startsWith("com.apple")?"cbcs":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",e,"Please contribute!"),null)}function hA(e){e=e.getConfiguration();var t=e.audioCapabilities&&e.audioCapabilities[0];return!(!(e=e.videoCapabilities&&e.videoCapabilities[0]||t)||void 0===e.encryptionScheme)}function fA(e,t){return!e||e==t||!("cbcs"!=e&&"cbcs-1-9"!=e||!vA&&!mA)}function pA(){}function gA(){tA(),aA()}rt("video/mp2t",function(){return new Yk("video/mp2t")},ut),G("EmeEncryptionSchemePolyfill",eA),eA.install=tA,G("McEncryptionSchemePolyfill",sA),sA.install=aA,cA.prototype.getConfiguration=function(){var e=this.g.getConfiguration();if(e.videoCapabilities)for(var t=c(e.videoCapabilities),n=t.next();!n.done;n=t.next())n.value.encryptionScheme=this.i;if(e.audioCapabilities)for(t=c(e.audioCapabilities),n=t.next();!n.done;n=t.next())n.value.encryptionScheme=this.h;return e},cA.prototype.createMediaKeys=function(){return this.g.createMediaKeys()},G("EncryptionSchemePolyfills",pA),pA.install=gA;var mA=navigator.userAgent.includes("CrKey"),vA=100<=parseInt(navigator.userAgent.split("Firefox/").pop(),10);"undefined"!==typeof n&&n.exports&&(n.exports=pA)}.call(i,n,n,void 0),i.shaka)t[r]=i.shaka[r]})()}).call(this,n("c8ba"))},4573:function(e,t,n){var i=n("cbe5"),r=i.extend({type:"ring",shape:{cx:0,cy:0,r:0,r0:0},buildPath:function(e,t){var n=t.cx,i=t.cy,r=2*Math.PI;e.moveTo(n+t.r,i),e.arc(n,i,t.r,0,r,!1),e.moveTo(n+t.r0,i),e.arc(n,i,t.r0,0,r,!0)}});e.exports=r},4588:function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},"45c1":function(e,t,n){"use strict";(function(e){var i=n("d708"),r=n("01e1");let s;s=r["a"]?self:i["a"]?e:window,t["a"]=s}).call(this,n("c8ba"))},4630:function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},4650:function(e,t,n){var i=n("3eba"),r=n("6d8b");function s(e,t,n){var i,s={},a="toggleSelected"===e;return n.eachComponent("legend",function(n){a&&null!=i?n[i?"select":"unSelect"](t.name):(n[e](t.name),i=n.isSelected(t.name));var o=n.getData();r.each(o,function(e){var t=e.get("name");if("\n"!==t&&""!==t){var i=n.isSelected(t);s.hasOwnProperty(t)?s[t]=s[t]&&i:s[t]=i}})}),{name:t.name,selected:s}}i.registerAction("legendToggleSelect","legendselectchanged",r.curry(s,"toggleSelected")),i.registerAction("legendSelect","legendselected",r.curry(s,"select")),i.registerAction("legendUnSelect","legendunselected",r.curry(s,"unSelect"))},"48a9":function(e,t,n){var i=n("6d8b"),r=n("42e5"),s=function(e,t,n,i,s,a){this.x=null==e?0:e,this.y=null==t?0:t,this.x2=null==n?1:n,this.y2=null==i?0:i,this.type="linear",this.global=a||!1,r.call(this,s)};s.prototype={constructor:s},i.inherits(s,r);var a=s;e.exports=a},"48ac":function(e,t,n){var i=n("3eba"),r=i.extendComponentModel({type:"axisPointer",coordSysAxesInfo:null,defaultOption:{show:"auto",triggerOn:null,zlevel:0,z:50,type:"line",snap:!1,triggerTooltip:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:"#aaa",width:1,type:"solid"},shadowStyle:{color:"rgba(150,150,150,0.3)"},label:{show:!0,formatter:null,precision:"auto",margin:3,color:"#fff",padding:[5,7,5,7],backgroundColor:"auto",borderColor:null,borderWidth:0,shadowBlur:3,shadowColor:"#aaa"},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:"#333",shadowBlur:3,shadowColor:"#aaa",shadowOffsetX:0,shadowOffsetY:2,throttle:40}}}),s=r;e.exports=s},"48c7":function(e,t,n){var i=n("6d8b"),r=n("6cb7"),s=n("9e47"),a=n("2023"),o=r.extend({type:"cartesian2dAxis",axis:null,init:function(){o.superApply(this,"init",arguments),this.resetRange()},mergeOption:function(){o.superApply(this,"mergeOption",arguments),this.resetRange()},restoreData:function(){o.superApply(this,"restoreData",arguments),this.resetRange()},getCoordSysModel:function(){return this.ecModel.queryComponents({mainType:"grid",index:this.option.gridIndex,id:this.option.gridId})[0]}});function l(e,t){return t.type||(t.data?"category":"value")}i.merge(o.prototype,a);var u={offset:0};s("x",o,l,u),s("y",o,l,u);var c=o;e.exports=c},4917:function(e,t,n){n("214f")("match",1,function(e,t,n){return[function(n){"use strict";var i=e(this),r=void 0==n?void 0:n[t];return void 0!==r?r.call(n,i):new RegExp(n)[t](String(i))},n]})},4942:function(e,t,n){var i=n("2cf4"),r=i.debugMode,s=function(){};1===r?s=function(){for(var e in arguments)throw new Error(arguments[e])}:r>1&&(s=function(){for(var e in arguments)console.log(arguments[e])});var a=s;e.exports=a},"4a3f":function(e,t,n){var i=n("401b"),r=i.create,s=i.distSquare,a=Math.pow,o=Math.sqrt,l=1e-8,u=1e-4,c=o(3),d=1/3,h=r(),f=r(),p=r();function g(e){return e>-l&&e<l}function m(e){return e>l||e<-l}function v(e,t,n,i,r){var s=1-r;return s*s*(s*e+3*r*t)+r*r*(r*i+3*s*n)}function y(e,t,n,i,r){var s=1-r;return 3*(((t-e)*s+2*(n-t)*r)*s+(i-n)*r*r)}function b(e,t,n,i,r,s){var l=i+3*(t-n)-e,u=3*(n-2*t+e),h=3*(t-e),f=e-r,p=u*u-3*l*h,m=u*h-9*l*f,v=h*h-3*u*f,y=0;if(g(p)&&g(m))if(g(u))s[0]=0;else{var b=-h/u;b>=0&&b<=1&&(s[y++]=b)}else{var _=m*m-4*p*v;if(g(_)){var T=m/p,S=(b=-u/l+T,-T/2);b>=0&&b<=1&&(s[y++]=b),S>=0&&S<=1&&(s[y++]=S)}else if(_>0){var w=o(_),E=p*u+1.5*l*(-m+w),x=p*u+1.5*l*(-m-w);E=E<0?-a(-E,d):a(E,d),x=x<0?-a(-x,d):a(x,d);b=(-u-(E+x))/(3*l);b>=0&&b<=1&&(s[y++]=b)}else{var k=(2*p*u-3*l*m)/(2*o(p*p*p)),A=Math.acos(k)/3,I=o(p),C=Math.cos(A),D=(b=(-u-2*I*C)/(3*l),S=(-u+I*(C+c*Math.sin(A)))/(3*l),(-u+I*(C-c*Math.sin(A)))/(3*l));b>=0&&b<=1&&(s[y++]=b),S>=0&&S<=1&&(s[y++]=S),D>=0&&D<=1&&(s[y++]=D)}}return y}function _(e,t,n,i,r){var s=6*n-12*t+6*e,a=9*t+3*i-3*e-9*n,l=3*t-3*e,u=0;if(g(a)){if(m(s)){var c=-l/s;c>=0&&c<=1&&(r[u++]=c)}}else{var d=s*s-4*a*l;if(g(d))r[0]=-s/(2*a);else if(d>0){var h=o(d),f=(c=(-s+h)/(2*a),(-s-h)/(2*a));c>=0&&c<=1&&(r[u++]=c),f>=0&&f<=1&&(r[u++]=f)}}return u}function T(e,t,n,i,r,s){var a=(t-e)*r+e,o=(n-t)*r+t,l=(i-n)*r+n,u=(o-a)*r+a,c=(l-o)*r+o,d=(c-u)*r+u;s[0]=e,s[1]=a,s[2]=u,s[3]=d,s[4]=d,s[5]=c,s[6]=l,s[7]=i}function S(e,t,n,i,r,a,l,c,d,g,m){var y,b,_,T,S,w=.005,E=1/0;h[0]=d,h[1]=g;for(var x=0;x<1;x+=.05)f[0]=v(e,n,r,l,x),f[1]=v(t,i,a,c,x),T=s(h,f),T<E&&(y=x,E=T);E=1/0;for(var k=0;k<32;k++){if(w<u)break;b=y-w,_=y+w,f[0]=v(e,n,r,l,b),f[1]=v(t,i,a,c,b),T=s(f,h),b>=0&&T<E?(y=b,E=T):(p[0]=v(e,n,r,l,_),p[1]=v(t,i,a,c,_),S=s(p,h),_<=1&&S<E?(y=_,E=S):w*=.5)}return m&&(m[0]=v(e,n,r,l,y),m[1]=v(t,i,a,c,y)),o(E)}function w(e,t,n,i){var r=1-i;return r*(r*e+2*i*t)+i*i*n}function E(e,t,n,i){return 2*((1-i)*(t-e)+i*(n-t))}function x(e,t,n,i,r){var s=e-2*t+n,a=2*(t-e),l=e-i,u=0;if(g(s)){if(m(a)){var c=-l/a;c>=0&&c<=1&&(r[u++]=c)}}else{var d=a*a-4*s*l;if(g(d)){c=-a/(2*s);c>=0&&c<=1&&(r[u++]=c)}else if(d>0){var h=o(d),f=(c=(-a+h)/(2*s),(-a-h)/(2*s));c>=0&&c<=1&&(r[u++]=c),f>=0&&f<=1&&(r[u++]=f)}}return u}function k(e,t,n){var i=e+n-2*t;return 0===i?.5:(e-t)/i}function A(e,t,n,i,r){var s=(t-e)*i+e,a=(n-t)*i+t,o=(a-s)*i+s;r[0]=e,r[1]=s,r[2]=o,r[3]=o,r[4]=a,r[5]=n}function I(e,t,n,i,r,a,l,c,d){var g,m=.005,v=1/0;h[0]=l,h[1]=c;for(var y=0;y<1;y+=.05){f[0]=w(e,n,r,y),f[1]=w(t,i,a,y);var b=s(h,f);b<v&&(g=y,v=b)}v=1/0;for(var _=0;_<32;_++){if(m<u)break;var T=g-m,S=g+m;f[0]=w(e,n,r,T),f[1]=w(t,i,a,T);b=s(f,h);if(T>=0&&b<v)g=T,v=b;else{p[0]=w(e,n,r,S),p[1]=w(t,i,a,S);var E=s(p,h);S<=1&&E<v?(g=S,v=E):m*=.5}}return d&&(d[0]=w(e,n,r,g),d[1]=w(t,i,a,g)),o(v)}t.cubicAt=v,t.cubicDerivativeAt=y,t.cubicRootAt=b,t.cubicExtrema=_,t.cubicSubdivide=T,t.cubicProjectPoint=S,t.quadraticAt=w,t.quadraticDerivativeAt=E,t.quadraticRootAt=x,t.quadraticExtremum=k,t.quadraticSubdivide=A,t.quadraticProjectPoint=I},"4a59":function(e,t,n){var i=n("9b43"),r=n("1fa8"),s=n("33a4"),a=n("cb7c"),o=n("9def"),l=n("27ee"),u={},c={};t=e.exports=function(e,t,n,d,h){var f,p,g,m,v=h?function(){return e}:l(e),y=i(n,d,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(s(v)){for(f=o(e.length);f>b;b++)if(m=t?y(a(p=e[b])[0],p[1]):y(e[b]),m===u||m===c)return m}else for(g=v.call(e);!(p=g.next()).done;)if(m=r(g,y,p.value,t),m===u||m===c)return m};t.BREAK=u,t.RETURN=c},"4a9d":function(e,t,n){var i=n("2306"),r=n("dcb3"),s=n("ff2e"),a=n("0156"),o=n("6679"),l=r.extend({makeElOption:function(e,t,n,i,r){var o=n.axis,l=o.grid,d=i.get("type"),h=u(l,o).getOtherAxis(o).getGlobalExtent(),f=o.toGlobalCoord(o.dataToCoord(t,!0));if(d&&"none"!==d){var p=s.buildElStyle(i),g=c[d](o,f,h,p);g.style=p,e.graphicKey=g.type,e.pointer=g}var m=a.layout(l.model,n);s.buildCartesianSingleLabelElOption(t,e,m,n,i,r)},getHandleTransform:function(e,t,n){var i=a.layout(t.axis.grid.model,t,{labelInside:!1});return i.labelMargin=n.get("handle.margin"),{position:s.getTransformedPosition(t.axis,e,i),rotation:i.rotation+(i.labelDirection<0?Math.PI:0)}},updateHandleTransform:function(e,t,n,i){var r=n.axis,s=r.grid,a=r.getGlobalExtent(!0),o=u(s,r).getOtherAxis(r).getGlobalExtent(),l="x"===r.dim?0:1,c=e.position;c[l]+=t[l],c[l]=Math.min(a[1],c[l]),c[l]=Math.max(a[0],c[l]);var d=(o[1]+o[0])/2,h=[d,d];h[l]=c[l];var f=[{verticalAlign:"middle"},{align:"center"}];return{position:c,rotation:e.rotation,cursorPoint:h,tooltipOption:f[l]}}});function u(e,t){var n={};return n[t.dim+"AxisIndex"]=t.index,e.getCartesian(n)}var c={line:function(e,t,n,r){var a=s.makeLineShape([t,n[0]],[t,n[1]],d(e));return i.subPixelOptimizeLine({shape:a,style:r}),{type:"Line",shape:a}},shadow:function(e,t,n,i){var r=Math.max(1,e.getBandWidth()),a=n[1]-n[0];return{type:"Rect",shape:s.makeRectShape([t-r/2,n[0]],[r,a],d(e))}}};function d(e){return"x"===e.dim?0:1}o.registerAxisPointerClass("CartesianAxisPointer",l);var h=l;e.exports=h},"4aa2":function(e,t,n){var i=n("cbe5"),r=n("897a"),s=i.extend({type:"sector",shape:{cx:0,cy:0,r0:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},brush:r(i.prototype.brush),buildPath:function(e,t){var n=t.cx,i=t.cy,r=Math.max(t.r0||0,0),s=Math.max(t.r,0),a=t.startAngle,o=t.endAngle,l=t.clockwise,u=Math.cos(a),c=Math.sin(a);e.moveTo(u*r+n,c*r+i),e.lineTo(u*s+n,c*s+i),e.arc(n,i,s,a,o,!l),e.lineTo(Math.cos(o)*r+n,Math.sin(o)*r+i),0!==r&&e.arc(n,i,r,o,a,l),e.closePath()}});e.exports=s},"4ada":function(e,t){function n(){return e.exports=n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},e.exports.__esModule=!0,e.exports["default"]=e.exports,n.apply(null,arguments)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"4b08":function(e,t,n){var i=n("7dcf"),r=i.extend({type:"dataZoom.select"});e.exports=r},"4bf8":function(e,t,n){var i=n("be13");e.exports=function(e){return Object(i(e))}},"4e08":function(e,t,n){(function(e){var n;"undefined"!==typeof window?n=window.__DEV__:"undefined"!==typeof e&&(n=e.__DEV__),"undefined"===typeof n&&(n=!0);var i=n;t.__DEV__=i}).call(this,n("c8ba"))},"4e9f":function(e,t,n){var i=n("22d1"),r=n("29a8"),s=n("2145"),a=r.toolbox.saveAsImage;function o(e){this.model=e}o.defaultOption={show:!0,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:a.title,type:"png",name:"",excludeComponents:["toolbox"],pixelRatio:1,lang:a.lang.slice()},o.prototype.unusable=!i.canvasSupported;var l=o.prototype;l.onclick=function(e,t){var n=this.model,r=n.get("name")||e.get("title.0.text")||"echarts",s=document.createElement("a"),a=n.get("type",!0)||"png";s.download=r+"."+a,s.target="_blank";var o=t.getConnectedDataURL({type:a,backgroundColor:n.get("backgroundColor",!0)||e.get("backgroundColor")||"#fff",excludeComponents:n.get("excludeComponents"),pixelRatio:n.get("pixelRatio")});if(s.href=o,"function"!==typeof MouseEvent||i.browser.ie||i.browser.edge)if(window.navigator.msSaveOrOpenBlob){var l=atob(o.split(",")[1]),u=l.length,c=new Uint8Array(u);while(u--)c[u]=l.charCodeAt(u);var d=new Blob([c]);window.navigator.msSaveOrOpenBlob(d,r+"."+a)}else{var h=n.get("lang"),f='<body style="margin:0;"><img src="'+o+'" style="max-width:100%;" title="'+(h&&h[0]||"")+'" /></body>',p=window.open();p.document.write(f)}else{var g=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});s.dispatchEvent(g)}},s.register("saveAsImage",o);var u=o;e.exports=u},"4f85":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=n("22d1"),a=n("eda2"),o=a.formatTime,l=a.encodeHTML,u=a.addCommas,c=a.getTooltipMarker,d=n("e0d3"),h=n("6cb7"),f=n("e47b"),p=n("38a2"),g=n("f934"),m=g.getLayoutParams,v=g.mergeLayoutParam,y=n("f47d"),b=y.createTask,_=n("0f99"),T=_.prepareSource,S=_.getSource,w=n("2b17"),E=w.retrieveRawValue,x=d.makeInner(),k=h.extend({type:"series.__base__",seriesIndex:0,coordinateSystem:null,defaultOption:null,legendDataProvider:null,visualColorAccessPath:"itemStyle.color",layoutMode:null,init:function(e,t,n,i){this.seriesIndex=this.componentIndex,this.dataTask=b({count:C,reset:D}),this.dataTask.context={model:this},this.mergeDefaultAndTheme(e,n),T(this);var r=this.getInitialData(e,n);M(r,this),this.dataTask.context.data=r,x(this).dataBeforeProcessed=r,A(this)},mergeDefaultAndTheme:function(e,t){var n=this.layoutMode,i=n?m(e):{},s=this.subType;h.hasClass(s)&&(s+="Series"),r.merge(e,t.getTheme().get(this.subType)),r.merge(e,this.getDefaultOption()),d.defaultEmphasis(e,"label",["show"]),this.fillDataTextStyle(e.data),n&&v(e,i,n)},mergeOption:function(e,t){e=r.merge(this.option,e,!0),this.fillDataTextStyle(e.data);var n=this.layoutMode;n&&v(this.option,e,n),T(this);var i=this.getInitialData(e,t);M(i,this),this.dataTask.dirty(),this.dataTask.context.data=i,x(this).dataBeforeProcessed=i,A(this)},fillDataTextStyle:function(e){if(e&&!r.isTypedArray(e))for(var t=["show"],n=0;n<e.length;n++)e[n]&&e[n].label&&d.defaultEmphasis(e[n],"label",t)},getInitialData:function(){},appendData:function(e){var t=this.getRawData();t.appendData(e.data)},getData:function(e){var t=P(this);if(t){var n=t.context.data;return null==e?n:n.getLinkedData(e)}return x(this).data},setData:function(e){var t=P(this);if(t){var n=t.context;n.data!==e&&t.modifyOutputEnd&&t.setOutputEnd(e.count()),n.outputData=e,t!==this.dataTask&&(n.data=e)}x(this).data=e},getSource:function(){return S(this)},getRawData:function(){return x(this).dataBeforeProcessed},getBaseAxis:function(){var e=this.coordinateSystem;return e&&e.getBaseAxis&&e.getBaseAxis()},formatTooltip:function(e,t,n){function i(n){var i=r.reduce(n,function(e,t,n){var i=a.getDimensionInfo(n);return e|(i&&!1!==i.tooltip&&null!=i.displayName)},0),s=[];function d(e,n){var r=a.getDimensionInfo(n);if(r&&!1!==r.otherDims.tooltip){var d=r.type,h=c({color:m,type:"subItem"}),f=(i?h+l(r.displayName||"-")+": ":"")+l("ordinal"===d?e+"":"time"===d?t?"":o("yyyy/MM/dd hh:mm:ss",e):u(e));f&&s.push(f)}}return h.length?r.each(h,function(t){d(E(a,e,t),t)}):r.each(n,d),(i?"<br/>":"")+s.join(i?"<br/>":", ")}function s(e){return l(u(e))}var a=this.getData(),h=a.mapDimension("defaultedTooltip",!0),f=h.length,p=this.getRawValue(e),g=r.isArray(p),m=a.getItemVisual(e,"color");r.isObject(m)&&m.colorStops&&(m=(m.colorStops[0]||{}).color),m=m||"transparent";var v=f>1||g&&!f?i(p):s(f?E(a,e,h[0]):g?p[0]:p),y=c(m),b=a.getName(e),_=this.name;return d.isNameSpecified(this)||(_=""),_=_?l(_)+(t?": ":"<br/>"):"",t?y+_+v:_+y+(b?l(b)+": "+v:v)},isAnimationEnabled:function(){if(s.node)return!1;var e=this.getShallow("animation");return e&&this.getData().count()>this.getShallow("animationThreshold")&&(e=!1),e},restoreData:function(){this.dataTask.dirty()},getColorFromPalette:function(e,t,n){var i=this.ecModel,r=f.getColorFromPalette.call(this,e,t,n);return r||(r=i.getColorFromPalette(e,t,n)),r},coordDimToDataDim:function(e){return this.getRawData().mapDimension(e,!0)},getProgressive:function(){return this.get("progressive")},getProgressiveThreshold:function(){return this.get("progressiveThreshold")},getAxisTooltipData:null,getTooltipPosition:null,pipeTask:null,preventIncremental:null,pipelineContext:null});function A(e){var t=e.name;d.isNameSpecified(e)||(e.name=I(e)||t)}function I(e){var t=e.getRawData(),n=t.mapDimension("seriesName",!0),i=[];return r.each(n,function(e){var n=t.getDimensionInfo(e);n.displayName&&i.push(n.displayName)}),i.join(" ")}function C(e){return e.model.getRawData().count()}function D(e){var t=e.model;return t.setData(t.getRawData().cloneShallow()),R}function R(e,t){e.end>t.outputData.count()&&t.model.getRawData().cloneShallow(t.outputData)}function M(e,t){r.each(e.CHANGABLE_METHODS,function(n){e.wrapMethod(n,r.curry(L,t))})}function L(e){var t=P(e);t&&t.setOutputEnd(this.count())}function P(e){var t=(e.ecModel||{}).scheduler,n=t&&t.getPipeline(e.uid);if(n){var i=n.currentTask;if(i){var r=i.agentStubMap;r&&(i=r.get(e.uid))}return i}}r.mixin(k,p),r.mixin(k,f);var O=k;e.exports=O},"4fac":function(e,t,n){var i=n("620b"),r=n("9c2c");function s(e,t,n){var s=t.points,a=t.smooth;if(s&&s.length>=2){if(a&&"spline"!==a){var o=r(s,a,n,t.smoothConstraint);e.moveTo(s[0][0],s[0][1]);for(var l=s.length,u=0;u<(n?l:l-1);u++){var c=o[2*u],d=o[2*u+1],h=s[(u+1)%l];e.bezierCurveTo(c[0],c[1],d[0],d[1],h[0],h[1])}}else{"spline"===a&&(s=i(s,n)),e.moveTo(s[0][0],s[0][1]);u=1;for(var f=s.length;u<f;u++)e.lineTo(s[u][0],s[u][1])}n&&e.closePath()}}t.buildPath=s},"50e5":function(e,t,n){var i=n("6d8b"),r=n("eda2"),s=["x","y","z","radius","angle","single"],a=["cartesian2d","polar","singleAxis"];function o(e){return i.indexOf(a,e)>=0}function l(e,t){e=e.slice();var n=i.map(e,r.capitalFirst);t=(t||[]).slice();var s=i.map(t,r.capitalFirst);return function(r,a){i.each(e,function(e,i){for(var o={name:e,capital:n[i]},l=0;l<t.length;l++)o[t[l]]=e+s[l];r.call(a,o)})}}var u=l(s,["axisIndex","axis","index","id"]);function c(e,t,n){return function(n){var i,o={nodes:[],records:{}};if(t(function(e){o.records[e.name]={}}),!n)return o;a(n,o);do{i=!1,e(l)}while(i);function l(e){!r(e,o)&&s(e,o)&&(a(e,o),i=!0)}return o};function r(e,t){return i.indexOf(t.nodes,e)>=0}function s(e,r){var s=!1;return t(function(t){i.each(n(e,t)||[],function(e){r.records[t.name][e]&&(s=!0)})}),s}function a(e,r){r.nodes.push(e),t(function(t){i.each(n(e,t)||[],function(e){r.records[t.name][e]=!0})})}}t.isCoordSupported=o,t.createNameEach=l,t.eachAxisDim=u,t.createLinkedNodesFinder=c},5147:function(e,t,n){var i=n("2b4c")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[i]=!1,!"/./"[e](t)}catch(e){}}return!0}},"52a7":function(e,t){t.f={}.propertyIsEnumerable},"551c":function(e,t,n){"use strict";var i,r,s,a,o=n("2d00"),l=n("7726"),u=n("9b43"),c=n("23c6"),d=n("5ca1"),h=n("d3f4"),f=n("d8e8"),p=n("f605"),g=n("4a59"),m=n("ebd6"),v=n("1991").set,y=n("8079")(),b=n("a5b8"),_=n("9c80"),T=n("a25f"),S=n("bcaa"),w="Promise",E=l.TypeError,x=l.process,k=x&&x.versions,A=k&&k.v8||"",I=l[w],C="process"==c(x),D=function(){},R=r=b.f,M=!!function(){try{var e=I.resolve(1),t=(e.constructor={})[n("2b4c")("species")]=function(e){e(D,D)};return(C||"function"==typeof PromiseRejectionEvent)&&e.then(D)instanceof t&&0!==A.indexOf("6.6")&&-1===T.indexOf("Chrome/66")}catch(e){}}(),L=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},P=function(e,t){if(!e._n){e._n=!0;var n=e._c;y(function(){var i=e._v,r=1==e._s,s=0,a=function(t){var n,s,a,o=r?t.ok:t.fail,l=t.resolve,u=t.reject,c=t.domain;try{o?(r||(2==e._h&&U(e),e._h=1),!0===o?n=i:(c&&c.enter(),n=o(i),c&&(c.exit(),a=!0)),n===t.promise?u(E("Promise-chain cycle")):(s=L(n))?s.call(n,l,u):l(n)):u(i)}catch(e){c&&!a&&c.exit(),u(e)}};while(n.length>s)a(n[s++]);e._c=[],e._n=!1,t&&!e._h&&O(e)})}},O=function(e){v.call(l,function(){var t,n,i,r=e._v,s=N(e);if(s&&(t=_(function(){C?x.emit("unhandledRejection",r,e):(n=l.onunhandledrejection)?n({promise:e,reason:r}):(i=l.console)&&i.error&&i.error("Unhandled promise rejection",r)}),e._h=C||N(e)?2:1),e._a=void 0,s&&t.e)throw t.v})},N=function(e){return 1!==e._h&&0===(e._a||e._c).length},U=function(e){v.call(l,function(){var t;C?x.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})})},F=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),P(t,!0))},B=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw E("Promise can't be resolved itself");(t=L(e))?y(function(){var i={_w:n,_d:!1};try{t.call(e,u(B,i,1),u(F,i,1))}catch(e){F.call(i,e)}}):(n._v=e,n._s=1,P(n,!1))}catch(e){F.call({_w:n,_d:!1},e)}}};M||(I=function(e){p(this,I,w,"_h"),f(e),i.call(this);try{e(u(B,this,1),u(F,this,1))}catch(e){F.call(this,e)}},i=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},i.prototype=n("dcbc")(I.prototype,{then:function(e,t){var n=R(m(this,I));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=C?x.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&P(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),s=function(){var e=new i;this.promise=e,this.resolve=u(B,e,1),this.reject=u(F,e,1)},b.f=R=function(e){return e===I||e===a?new s(e):r(e)}),d(d.G+d.W+d.F*!M,{Promise:I}),n("7f20")(I,w),n("7a56")(w),a=n("8378")[w],d(d.S+d.F*!M,w,{reject:function(e){var t=R(this),n=t.reject;return n(e),t.promise}}),d(d.S+d.F*(o||!M),w,{resolve:function(e){return S(o&&this===a?I:this,e)}}),d(d.S+d.F*!(M&&n("5cc5")(function(e){I.all(e)["catch"](D)})),w,{all:function(e){var t=this,n=R(t),i=n.resolve,r=n.reject,s=_(function(){var n=[],s=0,a=1;g(e,!1,function(e){var o=s++,l=!1;n.push(void 0),a++,t.resolve(e).then(function(e){l||(l=!0,n[o]=e,--a||i(n))},r)}),--a||i(n)});return s.e&&r(s.v),n.promise},race:function(e){var t=this,n=R(t),i=n.reject,r=_(function(){g(e,!1,function(e){t.resolve(e).then(n.resolve,i)})});return r.e&&i(r.v),n.promise}})},"551f":function(e,t,n){var i=n("282b"),r=i([["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["textPosition"],["textAlign"]]),s={getItemStyle:function(e,t){var n=r(this,e,t),i=this.getBorderLineDash();return i&&(n.lineDash=i),n},getBorderLineDash:function(){var e=this.get("borderType");return"solid"===e||null==e?null:"dashed"===e?[5,5]:[1,1]}};e.exports=s},5537:function(e,t,n){var i=n("8378"),r=n("7726"),s="__core-js_shared__",a=r[s]||(r[s]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:i.version,mode:n("2d00")?"pure":"global",copyright:" 2018 Denis Pushkarev (zloirock.ru)"})},5693:function(e,t){function n(e,t){var n,i,r,s,a,o=t.x,l=t.y,u=t.width,c=t.height,d=t.r;u<0&&(o+=u,u=-u),c<0&&(l+=c,c=-c),"number"===typeof d?n=i=r=s=d:d instanceof Array?1===d.length?n=i=r=s=d[0]:2===d.length?(n=r=d[0],i=s=d[1]):3===d.length?(n=d[0],i=s=d[1],r=d[2]):(n=d[0],i=d[1],r=d[2],s=d[3]):n=i=r=s=0,n+i>u&&(a=n+i,n*=u/a,i*=u/a),r+s>u&&(a=r+s,r*=u/a,s*=u/a),i+r>c&&(a=i+r,i*=c/a,r*=c/a),n+s>c&&(a=n+s,n*=c/a,s*=c/a),e.moveTo(o+n,l),e.lineTo(o+u-i,l),0!==i&&e.arc(o+u-i,l+i,i,-Math.PI/2,0),e.lineTo(o+u,l+c-r),0!==r&&e.arc(o+u-r,l+c-r,r,0,Math.PI/2),e.lineTo(o+s,l+c),0!==s&&e.arc(o+s,l+c-s,s,Math.PI/2,Math.PI),e.lineTo(o,l+n),0!==n&&e.arc(o+n,l+n,n,Math.PI,1.5*Math.PI)}t.buildPath=n},"5aa9":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=r.isObject,a=r.each,o=r.map,l=r.indexOf,u=(r.retrieve,n("f934")),c=u.getLayoutRect,d=n("697e"),h=d.createScaleByModel,f=d.ifAxisCrossZero,p=d.niceScaleExtent,g=d.estimateLabelUnionRect,m=n("cbe9"),v=n("ec02"),y=n("2039"),b=n("ee1a"),_=b.getStackedDimension;function T(e,t,n){return e.getCoordSysModel()===t}function S(e,t,n){this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this._initCartesian(e,t,n),this.model=e}n("8ed2");var w=S.prototype;function E(e,t,n){n.getAxesOnZeroOf=function(){return i?[i]:[]};var i,r=e[t],s=n.model,a=s.get("axisLine.onZero"),o=s.get("axisLine.onZeroAxisIndex");if(a)if(null==o){for(var l in r)if(r.hasOwnProperty(l)&&x(r[l])){i=r[l];break}}else x(r[o])&&(i=r[o])}function x(e){return e&&"category"!==e.type&&"time"!==e.type&&f(e)}function k(e,t){var n=e.getExtent(),i=n[0]+n[1];e.toGlobalCoord="x"===e.dim?function(e){return e+t}:function(e){return i-e+t},e.toLocalCoord="x"===e.dim?function(e){return e-t}:function(e){return i-e+t}}w.type="grid",w.axisPointerEnabled=!0,w.getRect=function(){return this._rect},w.update=function(e,t){var n=this._axesMap;this._updateScale(e,this.model),a(n.x,function(e){p(e.scale,e.model)}),a(n.y,function(e){p(e.scale,e.model)}),a(n.x,function(e){E(n,"y",e)}),a(n.y,function(e){E(n,"x",e)}),this.resize(this.model,t)},w.resize=function(e,t,n){var i=c(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()});this._rect=i;var r=this._axesList;function s(){a(r,function(e){var t=e.isHorizontal(),n=t?[0,i.width]:[0,i.height],r=e.inverse?1:0;e.setExtent(n[r],n[1-r]),k(e,t?i.x:i.y)})}s(),!n&&e.get("containLabel")&&(a(r,function(e){if(!e.model.get("axisLabel.inside")){var t=g(e);if(t){var n=e.isHorizontal()?"height":"width",r=e.model.get("axisLabel.margin");i[n]-=t[n]+r,"top"===e.position?i.y+=t.height+r:"left"===e.position&&(i.x+=t.width+r)}}}),s())},w.getAxis=function(e,t){var n=this._axesMap[e];if(null!=n){if(null==t)for(var i in n)if(n.hasOwnProperty(i))return n[i];return n[t]}},w.getAxes=function(){return this._axesList.slice()},w.getCartesian=function(e,t){if(null!=e&&null!=t){var n="x"+e+"y"+t;return this._coordsMap[n]}s(e)&&(t=e.yAxisIndex,e=e.xAxisIndex);for(var i=0,r=this._coordsList;i<r.length;i++)if(r[i].getAxis("x").index===e||r[i].getAxis("y").index===t)return r[i]},w.getCartesians=function(){return this._coordsList.slice()},w.convertToPixel=function(e,t,n){var i=this._findConvertTarget(e,t);return i.cartesian?i.cartesian.dataToPoint(n):i.axis?i.axis.toGlobalCoord(i.axis.dataToCoord(n)):null},w.convertFromPixel=function(e,t,n){var i=this._findConvertTarget(e,t);return i.cartesian?i.cartesian.pointToData(n):i.axis?i.axis.coordToData(i.axis.toLocalCoord(n)):null},w._findConvertTarget=function(e,t){var n,i,r=t.seriesModel,s=t.xAxisModel||r&&r.getReferringComponents("xAxis")[0],a=t.yAxisModel||r&&r.getReferringComponents("yAxis")[0],o=t.gridModel,u=this._coordsList;if(r)n=r.coordinateSystem,l(u,n)<0&&(n=null);else if(s&&a)n=this.getCartesian(s.componentIndex,a.componentIndex);else if(s)i=this.getAxis("x",s.componentIndex);else if(a)i=this.getAxis("y",a.componentIndex);else if(o){var c=o.coordinateSystem;c===this&&(n=this._coordsList[0])}return{cartesian:n,axis:i}},w.containPoint=function(e){var t=this._coordsList[0];if(t)return t.containPoint(e)},w._initCartesian=function(e,t,n){var i={left:!1,right:!1,top:!1,bottom:!1},r={x:{},y:{}},s={x:0,y:0};if(t.eachComponent("xAxis",o("x"),this),t.eachComponent("yAxis",o("y"),this),!s.x||!s.y)return this._axesMap={},void(this._axesList=[]);function o(n){return function(a,o){if(T(a,e,t)){var l=a.get("position");"x"===n?"top"!==l&&"bottom"!==l&&(l="bottom",i[l]&&(l="top"===l?"bottom":"top")):"left"!==l&&"right"!==l&&(l="left",i[l]&&(l="left"===l?"right":"left")),i[l]=!0;var u=new v(n,h(a),[0,0],a.get("type"),l),c="category"===u.type;u.onBand=c&&a.get("boundaryGap"),u.inverse=a.get("inverse"),a.axis=u,u.model=a,u.grid=this,u.index=o,this._axesList.push(u),r[n][o]=u,s[n]++}}}this._axesMap=r,a(r.x,function(t,n){a(r.y,function(i,r){var s="x"+n+"y"+r,a=new m(s);a.grid=this,a.model=e,this._coordsMap[s]=a,this._coordsList.push(a),a.addAxis(t),a.addAxis(i)},this)},this)},w._updateScale=function(e,t){function n(e,t,n){a(e.mapDimension(t.dim,!0),function(n){t.scale.unionExtentFromData(e,_(e,n))})}a(this._axesList,function(e){e.scale.setExtent(1/0,-1/0)}),e.eachSeries(function(i){if(C(i)){var r=I(i,e),s=r[0],a=r[1];if(!T(s,t,e)||!T(a,t,e))return;var o=this.getCartesian(s.componentIndex,a.componentIndex),l=i.getData(),u=o.getAxis("x"),c=o.getAxis("y");"list"===l.type&&(n(l,u,i),n(l,c,i))}},this)},w.getTooltipAxes=function(e){var t=[],n=[];return a(this.getCartesians(),function(i){var r=null!=e&&"auto"!==e?i.getAxis(e):i.getBaseAxis(),s=i.getOtherAxis(r);l(t,r)<0&&t.push(r),l(n,s)<0&&n.push(s)}),{baseAxes:t,otherAxes:n}};var A=["xAxis","yAxis"];function I(e,t){return o(A,function(t){var n=e.getReferringComponents(t)[0];return n})}function C(e){return"cartesian2d"===e.get("coordinateSystem")}S.create=function(e,t){var n=[];return e.eachComponent("grid",function(i,r){var s=new S(i,e,t);s.name="grid_"+r,s.resize(i,t,!0),i.coordinateSystem=s,n.push(s)}),e.eachSeries(function(t){if(C(t)){var n=I(t,e),i=n[0],r=n[1],s=i.getCoordSysModel(),a=s.coordinateSystem;t.coordinateSystem=a.getCartesian(i.componentIndex,r.componentIndex)}}),n},S.dimensions=S.prototype.dimensions=m.prototype.dimensions,y.register("cartesian2d",S);var D=S;e.exports=D},"5ca1":function(e,t,n){var i=n("7726"),r=n("8378"),s=n("32e9"),a=n("2aba"),o=n("9b43"),l="prototype",u=function(e,t,n){var c,d,h,f,p=e&u.F,g=e&u.G,m=e&u.S,v=e&u.P,y=e&u.B,b=g?i:m?i[t]||(i[t]={}):(i[t]||{})[l],_=g?r:r[t]||(r[t]={}),T=_[l]||(_[l]={});for(c in g&&(n=t),n)d=!p&&b&&void 0!==b[c],h=(d?b:n)[c],f=y&&d?o(h,i):v&&"function"==typeof h?o(Function.call,h):h,b&&a(b,c,h,e&u.U),_[c]!=h&&s(_,c,f),v&&T[c]!=h&&(T[c]=h)};i.core=r,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},"5cc5":function(e,t,n){var i=n("2b4c")("iterator"),r=!1;try{var s=[7][i]();s["return"]=function(){r=!0},Array.from(s,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var s=[7],a=s[i]();a.next=function(){return{done:n=!0}},s[i]=function(){return a},e(s)}catch(e){}return n}},"5dbc":function(e,t,n){var i=n("d3f4"),r=n("8b97").set;e.exports=function(e,t,n){var s,a=t.constructor;return a!==n&&"function"==typeof a&&(s=a.prototype)!==n.prototype&&i(s)&&r&&r(e,s),e}},"5e68":function(e,t,n){var i=n("6d8b"),r=n("2cf4"),s=r.devicePixelRatio,a=n("2b61"),o=n("dc2f");function l(){return!1}function u(e,t,n){var r=i.createCanvas(),s=t.getWidth(),a=t.getHeight(),o=r.style;return o&&(o.position="absolute",o.left=0,o.top=0,o.width=s+"px",o.height=a+"px",r.setAttribute("data-zr-dom-id",e)),r.width=s*n,r.height=a*n,r}var c=function(e,t,n){var r;n=n||s,"string"===typeof e?r=u(e,t,n):i.isObject(e)&&(r=e,e=r.id),this.id=e,this.dom=r;var a=r.style;a&&(r.onselectstart=l,a["-webkit-user-select"]="none",a["user-select"]="none",a["-webkit-touch-callout"]="none",a["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",a["padding"]=0,a["margin"]=0,a["border-width"]=0),this.domBack=null,this.ctxBack=null,this.painter=t,this.config=null,this.clearColor=0,this.motionBlur=!1,this.lastFrameAlpha=.7,this.dpr=n};c.prototype={constructor:c,__dirty:!0,__used:!1,__drawIndex:0,__startIndex:0,__endIndex:0,incremental:!1,getElementCount:function(){return this.__endIndex-this.__startIndex},initContext:function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},createBackBuffer:function(){var e=this.dpr;this.domBack=u("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),1!=e&&this.ctxBack.scale(e,e)},resize:function(e,t){var n=this.dpr,i=this.dom,r=i.style,s=this.domBack;r&&(r.width=e+"px",r.height=t+"px"),i.width=e*n,i.height=t*n,s&&(s.width=e*n,s.height=t*n,1!=n&&this.ctxBack.scale(n,n))},clear:function(e,t){var n,i=this.dom,r=this.ctx,s=i.width,l=i.height,u=(t=t||this.clearColor,this.motionBlur&&!e),c=this.lastFrameAlpha,d=this.dpr;(u&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(i,0,0,s/d,l/d)),r.clearRect(0,0,s,l),t&&"transparent"!==t)&&(t.colorStops?(n=t.__canvasGradient||a.getGradient(r,t,{x:0,y:0,width:s,height:l}),t.__canvasGradient=n):t.image&&(n=o.prototype.getCanvasPattern.call(t,r)),r.save(),r.fillStyle=n||t,r.fillRect(0,0,s,l),r.restore());if(u){var h=this.domBack;r.save(),r.globalAlpha=c,r.drawImage(h,0,0,s,l),r.restore()}}};var d=c;e.exports=d},"5e76":function(e,t,n){var i=n("d51b"),r=new i(50);function s(e){if("string"===typeof e){var t=r.get(e);return t&&t.image}return e}function a(e,t,n,i,s){if(e){if("string"===typeof e){if(t&&t.__zrImageSrc===e||!n)return t;var a=r.get(e),u={hostEl:n,cb:i,cbPayload:s};return a?(t=a.image,!l(t)&&a.pending.push(u)):(!t&&(t=new Image),t.onload=o,r.put(e,t.__cachedImgObj={image:t,pending:[u]}),t.src=t.__zrImageSrc=e),t}return e}return t}function o(){var e=this.__cachedImgObj;this.onload=this.__cachedImgObj=null;for(var t=0;t<e.pending.length;t++){var n=e.pending[t],i=n.cb;i&&i(this,n.cbPayload),n.hostEl.dirty()}e.pending.length=0}function l(e){return e&&e.width&&e.height}t.findExistImage=s,t.createOrUpdateImage=a,t.isImageReady=l},"5e97":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("3eba")),s=n("6d8b"),a=n("a15a"),o=a.createSymbol,l=n("2306"),u=n("7919"),c=u.makeBackground,d=n("f934"),h=s.curry,f=s.each,p=l.Group,g=r.extendComponentView({type:"legend.plain",newlineDisabled:!1,init:function(){this.group.add(this._contentGroup=new p),this._backgroundEl},getContentGroup:function(){return this._contentGroup},render:function(e,t,n){if(this.resetInner(),e.get("show",!0)){var i=e.get("align");i&&"auto"!==i||(i="right"===e.get("left")&&"vertical"===e.get("orient")?"right":"left"),this.renderInner(i,e,t,n);var r=e.getBoxLayoutParams(),a={width:n.getWidth(),height:n.getHeight()},o=e.get("padding"),l=d.getLayoutRect(r,a,o),u=this.layoutInner(e,i,l),h=d.getLayoutRect(s.defaults({width:u.width,height:u.height},r),a,o);this.group.attr("position",[h.x-u.x,h.y-u.y]),this.group.add(this._backgroundEl=c(u,e))}},resetInner:function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl)},renderInner:function(e,t,n,i){var r=this.getContentGroup(),a=s.createHashMap(),o=t.get("selectedMode"),l=[];n.eachRawSeries(function(e){!e.get("legendHoverLink")&&l.push(e.id)}),f(t.getData(),function(s,u){var c=s.get("name");if(this.newlineDisabled||""!==c&&"\n"!==c){var d=n.getSeriesByName(c)[0];if(!a.get(c))if(d){var f=d.getData(),g=f.getVisual("color");"function"===typeof g&&(g=g(d.getDataParams(0)));var b=f.getVisual("legendSymbol")||"roundRect",_=f.getVisual("symbol"),T=this._createItem(c,u,s,t,b,_,e,g,o);T.on("click",h(m,c,i)).on("mouseover",h(v,d,null,i,l)).on("mouseout",h(y,d,null,i,l)),a.set(c,!0)}else n.eachRawSeries(function(n){if(!a.get(c)&&n.legendDataProvider){var r=n.legendDataProvider(),d=r.indexOfName(c);if(d<0)return;var f=r.getItemVisual(d,"color"),p="roundRect",g=this._createItem(c,u,s,t,p,null,e,f,o);g.on("click",h(m,c,i)).on("mouseover",h(v,n,c,i,l)).on("mouseout",h(y,n,c,i,l)),a.set(c,!0)}},this)}else r.add(new p({newline:!0}))},this)},_createItem:function(e,t,n,i,r,a,u,c,d){var h=i.get("itemWidth"),f=i.get("itemHeight"),g=i.get("inactiveColor"),m=i.get("symbolKeepAspect"),v=i.isSelected(e),y=new p,b=n.getModel("textStyle"),_=n.get("icon"),T=n.getModel("tooltip"),S=T.parentModel;if(r=_||r,y.add(o(r,0,0,h,f,v?c:g,null==m||m)),!_&&a&&(a!==r||"none"==a)){var w=.8*f;"none"===a&&(a="circle"),y.add(o(a,(h-w)/2,(f-w)/2,w,w,v?c:g,null==m||m))}var E="left"===u?h+5:-5,x=u,k=i.get("formatter"),A=e;"string"===typeof k&&k?A=k.replace("{name}",null!=e?e:""):"function"===typeof k&&(A=k(e)),y.add(new l.Text({style:l.setTextStyle({},b,{text:A,x:E,y:f/2,textFill:v?b.getTextColor():g,textAlign:x,textVerticalAlign:"middle"})}));var I=new l.Rect({shape:y.getBoundingRect(),invisible:!0,tooltip:T.get("show")?s.extend({content:e,formatter:S.get("formatter",!0)||function(){return e},formatterParams:{componentType:"legend",legendIndex:i.componentIndex,name:e,$vars:["name"]}},T.option):null});return y.add(I),y.eachChild(function(e){e.silent=!0}),I.silent=!d,this.getContentGroup().add(y),l.setHoverStyle(y),y.__legendDataIndex=t,y},layoutInner:function(e,t,n){var i=this.getContentGroup();d.box(e.get("orient"),i,e.get("itemGap"),n.width,n.height);var r=i.getBoundingRect();return i.attr("position",[-r.x,-r.y]),this.group.getBoundingRect()}});function m(e,t){t.dispatchAction({type:"legendToggleSelect",name:e})}function v(e,t,n,i){var r=n.getZr().storage.getDisplayList()[0];r&&r.useHoverLayer||n.dispatchAction({type:"highlight",seriesName:e.name,name:t,excludeSeriesId:i})}function y(e,t,n,i){var r=n.getZr().storage.getDisplayList()[0];r&&r.useHoverLayer||n.dispatchAction({type:"downplay",seriesName:e.name,name:t,excludeSeriesId:i})}e.exports=g},"607d":function(e,t,n){var i=n("1fab");t.Dispatcher=i;var r=n("22d1"),s="undefined"!==typeof window&&!!window.addEventListener,a=/^(?:mouse|pointer|contextmenu|drag|drop)|click/;function o(e){return e.getBoundingClientRect?e.getBoundingClientRect():{left:0,top:0}}function l(e,t,n,i){return n=n||{},i||!r.canvasSupported?u(e,t,n):r.browser.firefox&&null!=t.layerX&&t.layerX!==t.offsetX?(n.zrX=t.layerX,n.zrY=t.layerY):null!=t.offsetX?(n.zrX=t.offsetX,n.zrY=t.offsetY):u(e,t,n),n}function u(e,t,n){var i=o(e);n.zrX=t.clientX-i.left,n.zrY=t.clientY-i.top}function c(e,t,n){if(t=t||window.event,null!=t.zrX)return t;var i=t.type,r=i&&i.indexOf("touch")>=0;if(r){var s="touchend"!=i?t.targetTouches[0]:t.changedTouches[0];s&&l(e,s,t,n)}else l(e,t,t,n),t.zrDelta=t.wheelDelta?t.wheelDelta/120:-(t.detail||0)/3;var o=t.button;return null==t.which&&void 0!==o&&a.test(t.type)&&(t.which=1&o?1:2&o?3:4&o?2:0),t}function d(e,t,n){s?e.addEventListener(t,n):e.attachEvent("on"+t,n)}function h(e,t,n){s?e.removeEventListener(t,n):e.detachEvent("on"+t,n)}var f=s?function(e){e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0}:function(e){e.returnValue=!1,e.cancelBubble=!0};function p(e){return e.which>1}t.clientToLocal=l,t.normalizeEvent=c,t.addEventListener=d,t.removeEventListener=h,t.stop=f,t.notLeftMouse=p},"613b":function(e,t,n){var i=n("5537")("keys"),r=n("ca5a");e.exports=function(e){return i[e]||(i[e]=r(e))}},6179:function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=n("4319"),a=n("80f0"),o=n("ec6f"),l=n("2b17"),u=l.defaultDimValueGetters,c=l.DefaultDataProvider,d=n("2f45"),h=d.summarizeDimensions,f=r.isObject,p="undefined",g="e\0\0",m={float:typeof Float64Array===p?Array:Float64Array,int:typeof Int32Array===p?Array:Int32Array,ordinal:Array,number:Array,time:Array},v=typeof Uint32Array===p?Array:Uint32Array,y=typeof Uint16Array===p?Array:Uint16Array;function b(e){return e._rawCount>65535?v:y}function _(e){var t=e.constructor;return t===Array?e.slice():new t(e)}var T=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_rawData","_chunkSize","_chunkCount","_dimValueGetter","_count","_rawCount","_nameDimIdx","_idDimIdx"],S=["_extent","_approximateExtent","_rawExtent"];function w(e,t){r.each(T.concat(t.__wrappedMethods||[]),function(n){t.hasOwnProperty(n)&&(e[n]=t[n])}),e.__wrappedMethods=t.__wrappedMethods,r.each(S,function(n){e[n]=r.clone(t[n])}),e._calculationInfo=r.extend(t._calculationInfo)}var E=function(e,t){e=e||["x","y"];for(var n={},i=[],s={},a=0;a<e.length;a++){var o=e[a];r.isString(o)&&(o={name:o});var l=o.name;o.type=o.type||"float",o.coordDim||(o.coordDim=l,o.coordDimIndex=0),o.otherDims=o.otherDims||{},i.push(l),n[l]=o,o.index=a,o.createInvertedIndices&&(s[l]=[])}this.dimensions=i,this._dimensionInfos=n,this.hostModel=t,this.dataType,this._indices=null,this._count=0,this._rawCount=0,this._storage={},this._nameList=[],this._idList=[],this._optionModels=[],this._visual={},this._layout={},this._itemVisuals=[],this.hasItemVisual={},this._itemLayouts=[],this._graphicEls=[],this._chunkSize=1e5,this._chunkCount=0,this._rawData,this._rawExtent={},this._extent={},this._approximateExtent={},this._dimensionsSummary=h(this),this._invertedIndicesMap=s,this._calculationInfo={}},x=E.prototype;function k(e){var t=e._invertedIndicesMap;r.each(t,function(n,i){var r=e._dimensionInfos[i],s=r.ordinalMeta;if(s){n=t[i]=new v(s.categories.length);for(var a=0;a<n.length;a++)n[a]=NaN;for(a=0;a<e._count;a++)n[e.get(i,a)]=a}})}function A(e,t,n){var i;if(null!=t){var r=e._chunkSize,s=Math.floor(n/r),a=n%r,o=e.dimensions[t],l=e._storage[o][s];if(l){i=l[a];var u=e._dimensionInfos[o].ordinalMeta;u&&u.categories.length&&(i=u.categories[i])}}return i}function I(e){return e}function C(e){return e<this._count&&e>=0?this._indices[e]:-1}function D(e,t){var n=e._idList[t];return null==n&&(n=A(e,e._idDimIdx,t)),null==n&&(n=g+t),n}function R(e){return r.isArray(e)||(e=[e]),e}function M(e,t){var n=e.dimensions,i=new E(r.map(n,e.getDimensionInfo,e),e.hostModel);w(i,e);for(var s=i._storage={},a=e._storage,o=0;o<n.length;o++){var l=n[o];a[l]&&(r.indexOf(t,l)>=0?(s[l]=L(a[l]),i._rawExtent[l]=P(),i._extent[l]=null):s[l]=a[l])}return i}function L(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=_(e[n]);return t}function P(){return[1/0,-1/0]}x.type="list",x.hasItemOption=!0,x.getDimension=function(e){return isNaN(e)||(e=this.dimensions[e]||e),e},x.getDimensionInfo=function(e){return this._dimensionInfos[this.getDimension(e)]},x.getDimensionsOnCoord=function(){return this._dimensionsSummary.dataDimsOnCoord.slice()},x.mapDimension=function(e,t){var n=this._dimensionsSummary;if(null==t)return n.encodeFirstDimNotExtra[e];var i=n.encode[e];return!0===t?(i||[]).slice():i&&i[t]},x.initData=function(e,t,n){var i=o.isInstance(e)||r.isArrayLike(e);i&&(e=new c(e,this.dimensions.length)),this._rawData=e,this._storage={},this._indices=null,this._nameList=t||[],this._idList=[],this._nameRepeatCount={},n||(this.hasItemOption=!1),this.defaultDimValueGetter=u[this._rawData.getSource().sourceFormat],this._dimValueGetter=n=n||this.defaultDimValueGetter,this._rawExtent={},this._initDataFromProvider(0,e.count()),e.pure&&(this.hasItemOption=!1)},x.getProvider=function(){return this._rawData},x.appendData=function(e){var t=this._rawData,n=this.count();t.appendData(e);var i=t.count();t.persistent||(i+=n),this._initDataFromProvider(n,i)},x._initDataFromProvider=function(e,t){if(!(e>=t)){for(var n,i=this._chunkSize,r=this._rawData,s=this._storage,a=this.dimensions,o=a.length,l=this._dimensionInfos,u=this._nameList,c=this._idList,d=this._rawExtent,h=this._nameRepeatCount={},f=this._chunkCount,p=f-1,g=0;g<o;g++){var v=a[g];d[v]||(d[v]=P());var y=l[v];0===y.otherDims.itemName&&(n=this._nameDimIdx=g),0===y.otherDims.itemId&&(this._idDimIdx=g);var b=m[y.type];s[v]||(s[v]=[]);var _=s[v][p];if(_&&_.length<i){for(var T=new b(Math.min(t-p*i,i)),S=0;S<_.length;S++)T[S]=_[S];s[v][p]=T}for(var w=f*i;w<t;w+=i)s[v].push(new b(Math.min(t-w,i)));this._chunkCount=s[v].length}for(var E=new Array(o),x=e;x<t;x++){E=r.getItem(x,E);var A=Math.floor(x/i),I=x%i;for(w=0;w<o;w++){v=a[w];var C=s[v][A],D=this._dimValueGetter(E,v,x,w);C[I]=D;var R=d[v];D<R[0]&&(R[0]=D),D>R[1]&&(R[1]=D)}if(!r.pure){var M=u[x];if(E&&null==M)if(null!=E.name)u[x]=M=E.name;else if(null!=n){var L=a[n],O=s[L][A];if(O){M=O[I];var N=l[L].ordinalMeta;N&&N.categories.length&&(M=N.categories[M])}}var U=null==E?null:E.id;null==U&&null!=M&&(h[M]=h[M]||0,U=M,h[M]>0&&(U+="__ec__"+h[M]),h[M]++),null!=U&&(c[x]=U)}}!r.persistent&&r.clean&&r.clean(),this._rawCount=this._count=t,this._extent={},k(this)}},x.count=function(){return this._count},x.getIndices=function(){var e=this._indices;if(e){var t=e.constructor,n=this._count;if(t===Array){r=new t(n);for(var i=0;i<n;i++)r[i]=e[i]}else r=new t(e.buffer,0,n)}else{t=b(this);var r=new t(this.count());for(i=0;i<r.length;i++)r[i]=i}return r},x.get=function(e,t){if(!(t>=0&&t<this._count))return NaN;var n=this._storage;if(!n[e])return NaN;t=this.getRawIndex(t);var i=Math.floor(t/this._chunkSize),r=t%this._chunkSize,s=n[e][i],a=s[r];return a},x.getByRawIndex=function(e,t){if(!(t>=0&&t<this._rawCount))return NaN;var n=this._storage[e];if(!n)return NaN;var i=Math.floor(t/this._chunkSize),r=t%this._chunkSize,s=n[i];return s[r]},x._getFast=function(e,t){var n=Math.floor(t/this._chunkSize),i=t%this._chunkSize,r=this._storage[e][n];return r[i]},x.getValues=function(e,t){var n=[];r.isArray(e)||(t=e,e=this.dimensions);for(var i=0,s=e.length;i<s;i++)n.push(this.get(e[i],t));return n},x.hasValue=function(e){for(var t=this._dimensionsSummary.dataDimsOnCoord,n=this._dimensionInfos,i=0,r=t.length;i<r;i++)if("ordinal"!==n[t[i]].type&&isNaN(this.get(t[i],e)))return!1;return!0},x.getDataExtent=function(e){e=this.getDimension(e);var t=this._storage[e],n=P();if(!t)return n;var i,r=this.count(),s=!this._indices;if(s)return this._rawExtent[e].slice();if(i=this._extent[e],i)return i.slice();i=n;for(var a=i[0],o=i[1],l=0;l<r;l++){var u=this._getFast(e,this.getRawIndex(l));u<a&&(a=u),u>o&&(o=u)}return i=[a,o],this._extent[e]=i,i},x.getApproximateExtent=function(e){return e=this.getDimension(e),this._approximateExtent[e]||this.getDataExtent(e)},x.setApproximateExtent=function(e,t){t=this.getDimension(t),this._approximateExtent[t]=e.slice()},x.getCalculationInfo=function(e){return this._calculationInfo[e]},x.setCalculationInfo=function(e,t){f(e)?r.extend(this._calculationInfo,e):this._calculationInfo[e]=t},x.getSum=function(e){var t=this._storage[e],n=0;if(t)for(var i=0,r=this.count();i<r;i++){var s=this.get(e,i);isNaN(s)||(n+=s)}return n},x.getMedian=function(e){var t=[];this.each(e,function(e,n){isNaN(e)||t.push(e)});var n=[].concat(t).sort(function(e,t){return e-t}),i=this.count();return 0===i?0:i%2===1?n[(i-1)/2]:(n[i/2]+n[i/2-1])/2},x.rawIndexOf=function(e,t){var n=e&&this._invertedIndicesMap[e],i=n[t];return null==i||isNaN(i)?-1:i},x.indexOfName=function(e){for(var t=0,n=this.count();t<n;t++)if(this.getName(t)===e)return t;return-1},x.indexOfRawIndex=function(e){if(!this._indices)return e;if(e>=this._rawCount||e<0)return-1;var t=this._indices,n=t[e];if(null!=n&&n<this._count&&n===e)return e;var i=0,r=this._count-1;while(i<=r){var s=(i+r)/2|0;if(t[s]<e)i=s+1;else{if(!(t[s]>e))return s;r=s-1}}return-1},x.indicesOfNearest=function(e,t,n){var i=this._storage,r=i[e],s=[];if(!r)return s;null==n&&(n=1/0);for(var a=Number.MAX_VALUE,o=-1,l=0,u=this.count();l<u;l++){var c=t-this.get(e,l),d=Math.abs(c);c<=n&&d<=a&&((d<a||c>=0&&o<0)&&(a=d,o=c,s.length=0),s.push(l))}return s},x.getRawIndex=I,x.getRawDataItem=function(e){if(this._rawData.persistent)return this._rawData.getItem(this.getRawIndex(e));for(var t=[],n=0;n<this.dimensions.length;n++){var i=this.dimensions[n];t.push(this.get(i,e))}return t},x.getName=function(e){var t=this.getRawIndex(e);return this._nameList[t]||A(this,this._nameDimIdx,t)||""},x.getId=function(e){return D(this,this.getRawIndex(e))},x.each=function(e,t,n,i){"use strict";if(this._count){"function"===typeof e&&(i=n,n=t,t=e,e=[]),n=n||i||this,e=r.map(R(e),this.getDimension,this);for(var s=e.length,a=0;a<this.count();a++)switch(s){case 0:t.call(n,a);break;case 1:t.call(n,this.get(e[0],a),a);break;case 2:t.call(n,this.get(e[0],a),this.get(e[1],a),a);break;default:for(var o=0,l=[];o<s;o++)l[o]=this.get(e[o],a);l[o]=a,t.apply(n,l)}}},x.filterSelf=function(e,t,n,i){"use strict";if(this._count){"function"===typeof e&&(i=n,n=t,t=e,e=[]),n=n||i||this,e=r.map(R(e),this.getDimension,this);for(var s=this.count(),a=b(this),o=new a(s),l=[],u=e.length,c=0,d=e[0],h=0;h<s;h++){var f,p=this.getRawIndex(h);if(0===u)f=t.call(n,h);else if(1===u){var g=this._getFast(d,p);f=t.call(n,g,h)}else{for(var m=0;m<u;m++)l[m]=this._getFast(d,p);l[m]=h,f=t.apply(n,l)}f&&(o[c++]=p)}return c<s&&(this._indices=o),this._count=c,this._extent={},this.getRawIndex=this._indices?C:I,this}},x.selectRange=function(e){"use strict";if(this._count){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);var i=t.length;if(i){var r=this.count(),s=b(this),a=new s(r),o=0,l=t[0],u=e[l][0],c=e[l][1],d=!1;if(!this._indices){var h=0;if(1===i){for(var f=this._storage[t[0]],p=0;p<this._chunkCount;p++)for(var g=f[p],m=Math.min(this._count-p*this._chunkSize,this._chunkSize),v=0;v<m;v++){var y=g[v];(y>=u&&y<=c||isNaN(y))&&(a[o++]=h),h++}d=!0}else if(2===i){f=this._storage[l];var _=this._storage[t[1]],T=e[t[1]][0],S=e[t[1]][1];for(p=0;p<this._chunkCount;p++){g=f[p];var w=_[p];for(m=Math.min(this._count-p*this._chunkSize,this._chunkSize),v=0;v<m;v++){y=g[v];var E=w[v];(y>=u&&y<=c||isNaN(y))&&(E>=T&&E<=S||isNaN(E))&&(a[o++]=h),h++}}d=!0}}if(!d)if(1===i)for(v=0;v<r;v++){var x=this.getRawIndex(v);y=this._getFast(l,x);(y>=u&&y<=c||isNaN(y))&&(a[o++]=x)}else for(v=0;v<r;v++){var k=!0;for(x=this.getRawIndex(v),p=0;p<i;p++){var A=t[p];y=this._getFast(n,x);(y<e[A][0]||y>e[A][1])&&(k=!1)}k&&(a[o++]=this.getRawIndex(v))}return o<r&&(this._indices=a),this._count=o,this._extent={},this.getRawIndex=this._indices?C:I,this}}},x.mapArray=function(e,t,n,i){"use strict";"function"===typeof e&&(i=n,n=t,t=e,e=[]),n=n||i||this;var r=[];return this.each(e,function(){r.push(t&&t.apply(this,arguments))},n),r},x.map=function(e,t,n,i){"use strict";n=n||i||this,e=r.map(R(e),this.getDimension,this);var s=M(this,e);s._indices=this._indices,s.getRawIndex=s._indices?C:I;for(var a=s._storage,o=[],l=this._chunkSize,u=e.length,c=this.count(),d=[],h=s._rawExtent,f=0;f<c;f++){for(var p=0;p<u;p++)d[p]=this.get(e[p],f);d[u]=f;var g=t&&t.apply(n,d);if(null!=g){"object"!==typeof g&&(o[0]=g,g=o);for(var m=this.getRawIndex(f),v=Math.floor(m/l),y=m%l,b=0;b<g.length;b++){var _=e[b],T=g[b],S=h[_],w=a[_];w&&(w[v][y]=T),T<S[0]&&(S[0]=T),T>S[1]&&(S[1]=T)}}}return s},x.downSample=function(e,t,n,i){for(var r=M(this,[e]),s=r._storage,a=[],o=Math.floor(1/t),l=s[e],u=this.count(),c=this._chunkSize,d=r._rawExtent[e],h=new(b(this))(u),f=0,p=0;p<u;p+=o){o>u-p&&(o=u-p,a.length=o);for(var g=0;g<o;g++){var m=this.getRawIndex(p+g),v=Math.floor(m/c),y=m%c;a[g]=l[v][y]}var _=n(a),T=this.getRawIndex(Math.min(p+i(a,_)||0,u-1)),S=Math.floor(T/c),w=T%c;l[S][w]=_,_<d[0]&&(d[0]=_),_>d[1]&&(d[1]=_),h[f++]=T}return r._count=f,r._indices=h,r.getRawIndex=C,r},x.getItemModel=function(e){var t=this.hostModel;return new s(this.getRawDataItem(e),t,t&&t.ecModel)},x.diff=function(e){var t=this;return new a(e?e.getIndices():[],this.getIndices(),function(t){return D(e,t)},function(e){return D(t,e)})},x.getVisual=function(e){var t=this._visual;return t&&t[e]},x.setVisual=function(e,t){if(f(e))for(var n in e)e.hasOwnProperty(n)&&this.setVisual(n,e[n]);else this._visual=this._visual||{},this._visual[e]=t},x.setLayout=function(e,t){if(f(e))for(var n in e)e.hasOwnProperty(n)&&this.setLayout(n,e[n]);else this._layout[e]=t},x.getLayout=function(e){return this._layout[e]},x.getItemLayout=function(e){return this._itemLayouts[e]},x.setItemLayout=function(e,t,n){this._itemLayouts[e]=n?r.extend(this._itemLayouts[e]||{},t):t},x.clearItemLayouts=function(){this._itemLayouts.length=0},x.getItemVisual=function(e,t,n){var i=this._itemVisuals[e],r=i&&i[t];return null!=r||n?r:this.getVisual(t)},x.setItemVisual=function(e,t,n){var i=this._itemVisuals[e]||{},r=this.hasItemVisual;if(this._itemVisuals[e]=i,f(t))for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s],r[s]=!0);else i[t]=n,r[t]=!0},x.clearAllVisual=function(){this._visual={},this._itemVisuals=[],this.hasItemVisual={}};var O=function(e){e.seriesIndex=this.seriesIndex,e.dataIndex=this.dataIndex,e.dataType=this.dataType};x.setItemGraphicEl=function(e,t){var n=this.hostModel;t&&(t.dataIndex=e,t.dataType=this.dataType,t.seriesIndex=n&&n.seriesIndex,"group"===t.type&&t.traverse(O,t)),this._graphicEls[e]=t},x.getItemGraphicEl=function(e){return this._graphicEls[e]},x.eachItemGraphicEl=function(e,t){r.each(this._graphicEls,function(n,i){n&&e&&e.call(t,n,i)})},x.cloneShallow=function(e){if(!e){var t=r.map(this.dimensions,this.getDimensionInfo,this);e=new E(t,this.hostModel)}if(e._storage=this._storage,w(e,this),this._indices){var n=this._indices.constructor;e._indices=new n(this._indices)}else e._indices=null;return e.getRawIndex=e._indices?C:I,e},x.wrapMethod=function(e,t){var n=this[e];"function"===typeof n&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(e),this[e]=function(){var e=n.apply(this,arguments);return t.apply(this,[e].concat(r.slice(arguments)))})},x.TRANSFERABLE_METHODS=["cloneShallow","downSample","map"],x.CHANGABLE_METHODS=["filterSelf","selectRange"];var N=E;e.exports=N},"620b":function(e,t,n){var i=n("401b"),r=i.distance;function s(e,t,n,i,r,s,a){var o=.5*(n-e),l=.5*(i-t);return(2*(t-n)+o+l)*a+(-3*(t-n)-2*o-l)*s+o*r+t}function a(e,t){for(var n=e.length,i=[],a=0,o=1;o<n;o++)a+=r(e[o-1],e[o]);var l=a/2;l=l<n?n:l;for(o=0;o<l;o++){var u,c,d,h=o/(l-1)*(t?n:n-1),f=Math.floor(h),p=h-f,g=e[f%n];t?(u=e[(f-1+n)%n],c=e[(f+1)%n],d=e[(f+2)%n]):(u=e[0===f?f:f-1],c=e[f>n-2?n-1:f+1],d=e[f>n-3?n-1:f+2]);var m=p*p,v=p*m;i.push([s(u[0],g[0],c[0],d[0],p,m,v),s(u[1],g[1],c[1],d[1],p,m,v)])}return i}e.exports=a},"625e":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=".",a="___EC__COMPONENT__CONTAINER___";function o(e){var t={main:"",sub:""};return e&&(e=e.split(s),t.main=e[0]||"",t.sub=e[1]||""),t}function l(e){r.assert(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(e),'componentType "'+e+'" illegal')}function u(e,t){e.$constructor=e,e.extend=function(e){var t=this,n=function(){e.$constructor?e.$constructor.apply(this,arguments):t.apply(this,arguments)};return r.extend(n.prototype,e),n.extend=this.extend,n.superCall=h,n.superApply=f,r.inherits(n,this),n.superClass=t,n}}var c=0;function d(e){var t=["__\0is_clz",c++,Math.random().toFixed(3)].join("_");e.prototype[t]=!0,e.isInstance=function(e){return!(!e||!e[t])}}function h(e,t){var n=r.slice(arguments,2);return this.superClass.prototype[t].apply(e,n)}function f(e,t,n){return this.superClass.prototype[t].apply(e,n)}function p(e,t){t=t||{};var n={};function i(e){var t=n[e.main];return t&&t[a]||(t=n[e.main]={},t[a]=!0),t}if(e.registerClass=function(e,t){if(t)if(l(t),t=o(t),t.sub){if(t.sub!==a){var r=i(t);r[t.sub]=e}}else n[t.main]=e;return e},e.getClass=function(e,t,i){var r=n[e];if(r&&r[a]&&(r=t?r[t]:null),i&&!r)throw new Error(t?"Component "+e+"."+(t||"")+" not exists. Load it first.":e+".type should be specified.");return r},e.getClassesByMainType=function(e){e=o(e);var t=[],i=n[e.main];return i&&i[a]?r.each(i,function(e,n){n!==a&&t.push(e)}):t.push(i),t},e.hasClass=function(e){return e=o(e),!!n[e.main]},e.getAllClassMainTypes=function(){var e=[];return r.each(n,function(t,n){e.push(n)}),e},e.hasSubTypes=function(e){e=o(e);var t=n[e.main];return t&&t[a]},e.parseClassType=o,t.registerWhenExtend){var s=e.extend;s&&(e.extend=function(t){var n=s.call(this,t);return e.registerClass(n,t.type)})}return e}function g(e,t){}t.parseClassType=o,t.enableClassExtend=u,t.enableClassCheck=d,t.enableClassManagement=p,t.setReadOnly=g},"626a":function(e,t,n){var i=n("2d95");e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},"63ec":function(e,t,n){"use strict";var i=n("be09"),r=n.n(i),s="https://example.com",a=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=r.a.location&&r.a.location.href||"");var n=/^\/\//.test(e),i=!r.a.location&&!/\/\//i.test(e);e=new r.a.URL(e,r.a.location||s);var a=new URL(t,e);return i?a.href.slice(s.length):n?a.href.slice(a.protocol.length):a.href};t["a"]=a},6679:function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("3eba")),s=n("cd33"),a=r.extendComponentView({type:"axis",_axisPointer:null,axisPointerClass:null,render:function(e,t,n,i){this.axisPointerClass&&s.fixValue(e),a.superApply(this,"render",arguments),o(this,e,t,n,i,!0)},updateAxisPointer:function(e,t,n,i,r){o(this,e,t,n,i,!1)},remove:function(e,t){var n=this._axisPointer;n&&n.remove(t),a.superApply(this,"remove",arguments)},dispose:function(e,t){l(this,t),a.superApply(this,"dispose",arguments)}});function o(e,t,n,i,r,o){var u=a.getAxisPointerClass(e.axisPointerClass);if(u){var c=s.getAxisPointerModel(t);c?(e._axisPointer||(e._axisPointer=new u)).render(t,c,i,o):l(e,i)}}function l(e,t,n){var i=e._axisPointer;i&&i.dispose(t,n),e._axisPointer=null}var u=[];a.registerAxisPointerClass=function(e,t){u[e]=t},a.getAxisPointerClass=function(e){return e&&u[e]};var c=a;e.exports=c},"67cc":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("3eba")),s=n("6d8b"),a=n("2306"),o=n("e7aa"),l=o.setLabel,u=n("4319"),c=n("b5c7"),d=n("cbe5"),h=["itemStyle","barBorderWidth"];s.extend(u.prototype,c);var f=r.extendChartView({type:"bar",render:function(e,t,n){this._updateDrawMode(e);var i=e.get("coordinateSystem");return"cartesian2d"!==i&&"polar"!==i||(this._isLargeDraw?this._renderLarge(e,t,n):this._renderNormal(e,t,n)),this.group},incrementalPrepareRender:function(e,t,n){this._clear(),this._updateDrawMode(e)},incrementalRender:function(e,t,n,i){this._incrementalRenderLarge(e,t)},_updateDrawMode:function(e){var t=e.pipelineContext.large;(null==this._isLargeDraw||t^this._isLargeDraw)&&(this._isLargeDraw=t,this._clear())},_renderNormal:function(e,t,n){var i,r=this.group,s=e.getData(),o=this._data,l=e.coordinateSystem,u=l.getBaseAxis();"cartesian2d"===l.type?i=u.isHorizontal():"polar"===l.type&&(i="angle"===u.dim);var c=e.isAnimationEnabled()?e:null;s.diff(o).add(function(t){if(s.hasValue(t)){var n=s.getItemModel(t),a=v[l.type](s,t,n),o=p[l.type](s,t,n,a,i,c);s.setItemGraphicEl(t,o),r.add(o),y(o,s,t,n,a,e,i,"polar"===l.type)}}).update(function(t,n){var u=o.getItemGraphicEl(n);if(s.hasValue(t)){var d=s.getItemModel(t),h=v[l.type](s,t,d);u?a.updateProps(u,{shape:h},c,t):u=p[l.type](s,t,d,h,i,c,!0),s.setItemGraphicEl(t,u),r.add(u),y(u,s,t,d,h,e,i,"polar"===l.type)}else r.remove(u)}).remove(function(e){var t=o.getItemGraphicEl(e);"cartesian2d"===l.type?t&&g(e,c,t):t&&m(e,c,t)}).execute(),this._data=s},_renderLarge:function(e,t,n){this._clear(),T(e,this.group)},_incrementalRenderLarge:function(e,t){T(t,this.group,!0)},dispose:s.noop,remove:function(e){this._clear(e)},_clear:function(e){var t=this.group,n=this._data;e&&e.get("animation")&&n&&!this._isLargeDraw?n.eachItemGraphicEl(function(t){"sector"===t.type?m(t.dataIndex,e,t):g(t.dataIndex,e,t)}):t.removeAll(),this._data=null}}),p={cartesian2d:function(e,t,n,i,r,o,l){var u=new a.Rect({shape:s.extend({},i)});if(o){var c=u.shape,d=r?"height":"width",h={};c[d]=0,h[d]=i[d],a[l?"updateProps":"initProps"](u,{shape:h},o,t)}return u},polar:function(e,t,n,i,r,o,l){var u=i.startAngle<i.endAngle,c=new a.Sector({shape:s.defaults({clockwise:u},i)});if(o){var d=c.shape,h=r?"r":"endAngle",f={};d[h]=r?0:i.startAngle,f[h]=i[h],a[l?"updateProps":"initProps"](c,{shape:f},o,t)}return c}};function g(e,t,n){n.style.text=null,a.updateProps(n,{shape:{width:0}},t,e,function(){n.parent&&n.parent.remove(n)})}function m(e,t,n){n.style.text=null,a.updateProps(n,{shape:{r:n.shape.r0}},t,e,function(){n.parent&&n.parent.remove(n)})}var v={cartesian2d:function(e,t,n){var i=e.getItemLayout(t),r=b(n,i),s=i.width>0?1:-1,a=i.height>0?1:-1;return{x:i.x+s*r/2,y:i.y+a*r/2,width:i.width-s*r,height:i.height-a*r}},polar:function(e,t,n){var i=e.getItemLayout(t);return{cx:i.cx,cy:i.cy,r0:i.r0,r:i.r,startAngle:i.startAngle,endAngle:i.endAngle}}};function y(e,t,n,i,r,o,u,c){var d=t.getItemVisual(n,"color"),h=t.getItemVisual(n,"opacity"),f=i.getModel("itemStyle"),p=i.getModel("emphasis.itemStyle").getBarItemStyle();c||e.setShape("r",f.get("barBorderRadius")||0),e.useStyle(s.defaults({fill:d,opacity:h},f.getBarItemStyle()));var g=i.getShallow("cursor");g&&e.attr("cursor",g);var m=u?r.height>0?"bottom":"top":r.width>0?"left":"right";c||l(e.style,p,i,d,o,n,m),a.setHoverStyle(e,p)}function b(e,t){var n=e.get(h)||0;return Math.min(n,Math.abs(t.width),Math.abs(t.height))}var _=d.extend({type:"largeBar",shape:{points:[]},buildPath:function(e,t){for(var n=t.points,i=this.__startPoint,r=this.__valueIdx,s=0;s<n.length;s+=2)i[this.__valueIdx]=n[s+r],e.moveTo(i[0],i[1]),e.lineTo(n[s],n[s+1])}});function T(e,t,n){var i=e.getData(),r=[],s=i.getLayout("valueAxisHorizontal")?1:0;r[1-s]=i.getLayout("valueAxisStart");var a=new _({shape:{points:i.getLayout("largePoints")},incremental:!!n,__startPoint:r,__valueIdx:s});t.add(a),S(a,e,i)}function S(e,t,n){var i=n.getVisual("borderColor")||n.getVisual("color"),r=t.getModel("itemStyle").getItemStyle(["color","borderColor"]);e.useStyle(r),e.style.fill=null,e.style.stroke=i,e.style.lineWidth=n.getLayout("barWidth")}e.exports=f},6821:function(e,t,n){var i=n("626a"),r=n("be13");e.exports=function(e){return i(r(e))}},"68ab":function(e,t,n){var i=n("4a3f"),r=i.quadraticProjectPoint;function s(e,t,n,i,s,a,o,l,u){if(0===o)return!1;var c=o;if(u>t+c&&u>i+c&&u>a+c||u<t-c&&u<i-c&&u<a-c||l>e+c&&l>n+c&&l>s+c||l<e-c&&l<n-c&&l<s-c)return!1;var d=r(e,t,n,i,s,a,l,u,null);return d<=c/2}t.containStroke=s},6932:function(e,t,n){var i=n("6cb7");i.registerSubTypeDefaulter("dataZoom",function(){return"slider"})},"697e":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=n("18c0"),a=n("89e3"),o=n("e0d8"),l=n("3842"),u=n("9d57"),c=u.prepareLayoutBarSeries,d=u.makeColumnLayout,h=u.retrieveColumnLayout,f=n("9850");function p(e,t){var n,i,s,a=e.type,o=t.getMin(),u=t.getMax(),h=null!=o,f=null!=u,p=e.getExtent();"ordinal"===a?n=t.getCategories().length:(i=t.get("boundaryGap"),r.isArray(i)||(i=[i||0,i||0]),"boolean"===typeof i[0]&&(i=[0,0]),i[0]=l.parsePercent(i[0],1),i[1]=l.parsePercent(i[1],1),s=p[1]-p[0]||Math.abs(p[0])),null==o&&(o="ordinal"===a?n?0:NaN:p[0]-i[0]*s),null==u&&(u="ordinal"===a?n?n-1:NaN:p[1]+i[1]*s),"dataMin"===o?o=p[0]:"function"===typeof o&&(o=o({min:p[0],max:p[1]})),"dataMax"===u?u=p[1]:"function"===typeof u&&(u=u({min:p[0],max:p[1]})),(null==o||!isFinite(o))&&(o=NaN),(null==u||!isFinite(u))&&(u=NaN),e.setBlank(r.eqNaN(o)||r.eqNaN(u)||"ordinal"===a&&!e.getOrdinalMeta().categories.length),t.getNeedCrossZero()&&(o>0&&u>0&&!h&&(o=0),o<0&&u<0&&!f&&(u=0));var m=t.ecModel;if(m&&"time"===a){var v,y=c("bar",m);if(r.each(y,function(e){v|=e.getBaseAxis()===t.axis}),v){var b=d(y),_=g(o,u,t,b);o=_.min,u=_.max}}return[o,u]}function g(e,t,n,i){var s=n.axis.getExtent(),a=s[1]-s[0],o=h(i,n.axis);if(void 0===o)return{min:e,max:t};var l=1/0;r.each(o,function(e){l=Math.min(e.offset,l)});var u=-1/0;r.each(o,function(e){u=Math.max(e.offset+e.width,u)}),l=Math.abs(l),u=Math.abs(u);var c=l+u,d=t-e,f=1-(l+u)/a,p=d/f-d;return t+=p*(u/c),e-=p*(l/c),{min:e,max:t}}function m(e,t){var n=p(e,t),i=null!=t.getMin(),r=null!=t.getMax(),s=t.get("splitNumber");"log"===e.type&&(e.base=t.get("logBase"));var a=e.type;e.setExtent(n[0],n[1]),e.niceExtent({splitNumber:s,fixMin:i,fixMax:r,minInterval:"interval"===a||"time"===a?t.get("minInterval"):null,maxInterval:"interval"===a||"time"===a?t.get("maxInterval"):null});var o=t.get("interval");null!=o&&e.setInterval&&e.setInterval(o)}function v(e,t){if(t=t||e.get("type"),t)switch(t){case"category":return new s(e.getOrdinalMeta?e.getOrdinalMeta():e.getCategories(),[1/0,-1/0]);case"value":return new a;default:return(o.getClass(t)||a).create(e)}}function y(e){var t=e.scale.getExtent(),n=t[0],i=t[1];return!(n>0&&i>0||n<0&&i<0)}function b(e){var t=e.getLabelModel().get("formatter"),n="category"===e.type?e.scale.getExtent()[0]:null;return"string"===typeof t?(t=function(e){return function(t){return e.replace("{value}",null!=t?t:"")}}(t),t):"function"===typeof t?function(i,r){return null!=n&&(r=i-n),t(_(e,i),r)}:function(t){return e.scale.getLabel(t)}}function _(e,t){return"category"===e.type?e.scale.getLabel(t):t}function T(e){var t=e.model,n=e.scale;if(t.get("axisLabel.show")&&!n.isBlank()){var i,r,s="category"===e.type,a=n.getExtent();s?r=n.count():(i=n.getTicks(),r=i.length);var o,l=e.getLabelModel(),u=b(e),c=1;r>40&&(c=Math.ceil(r/40));for(var d=0;d<r;d+=c){var h=i?i[d]:a[0]+d,f=u(h),p=l.getTextRect(f),g=S(p,l.get("rotate")||0);o?o.union(g):o=g}return o}}function S(e,t){var n=t*Math.PI/180,i=e.plain(),r=i.width,s=i.height,a=r*Math.cos(n)+s*Math.sin(n),o=r*Math.sin(n)+s*Math.cos(n),l=new f(i.x,i.y,a,o);return l}n("216a"),n("8c2a"),t.getScaleExtent=p,t.niceScaleExtent=m,t.createScaleByModel=v,t.ifAxisCrossZero=y,t.makeLabelFormatter=b,t.getAxisRawValue=_,t.estimateLabelUnionRect=T},"697e7":function(e,t,n){var i=n("de00"),r=n("22d1"),s=n("6d8b"),a=n("d2cf"),o=n("afa0"),l=n("ed21"),u=n("30a3"),c=n("cdaa"),d=!r.canvasSupported,h={canvas:l},f={},p="4.0.4";function g(e,t){var n=new _(i(),e,t);return f[n.id]=n,n}function m(e){if(e)e.dispose();else{for(var t in f)f.hasOwnProperty(t)&&f[t].dispose();f={}}return this}function v(e){return f[e]}function y(e,t){h[e]=t}function b(e){delete f[e]}var _=function(e,t,n){n=n||{},this.dom=t,this.id=e;var i=this,l=new o,f=n.renderer;if(d){if(!h.vml)throw new Error("You need to require 'zrender/vml/vml' to support IE8");f="vml"}else f&&h[f]||(f="canvas");var p=new h[f](t,l,n,e);this.storage=l,this.painter=p;var g=r.node||r.worker?null:new c(p.getViewportRoot());this.handler=new a(l,p,g,p.root),this.animation=new u({stage:{update:s.bind(this.flush,this)}}),this.animation.start(),this._needsRefresh;var m=l.delFromStorage,v=l.addToStorage;l.delFromStorage=function(e){m.call(l,e),e&&e.removeSelfFromZr(i)},l.addToStorage=function(e){v.call(l,e),e.addSelfToZr(i)}};_.prototype={constructor:_,getId:function(){return this.id},add:function(e){this.storage.addRoot(e),this._needsRefresh=!0},remove:function(e){this.storage.delRoot(e),this._needsRefresh=!0},configLayer:function(e,t){this.painter.configLayer&&this.painter.configLayer(e,t),this._needsRefresh=!0},setBackgroundColor:function(e){this.painter.setBackgroundColor&&this.painter.setBackgroundColor(e),this._needsRefresh=!0},refreshImmediately:function(){this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},refresh:function(){this._needsRefresh=!0},flush:function(){var e;this._needsRefresh&&(e=!0,this.refreshImmediately()),this._needsRefreshHover&&(e=!0,this.refreshHoverImmediately()),e&&this.trigger("rendered")},addHover:function(e,t){this.painter.addHover&&(this.painter.addHover(e,t),this.refreshHover())},removeHover:function(e){this.painter.removeHover&&(this.painter.removeHover(e),this.refreshHover())},clearHover:function(){this.painter.clearHover&&(this.painter.clearHover(),this.refreshHover())},refreshHover:function(){this._needsRefreshHover=!0},refreshHoverImmediately:function(){this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.refreshHover()},resize:function(e){e=e||{},this.painter.resize(e.width,e.height),this.handler.resize()},clearAnimation:function(){this.animation.clear()},getWidth:function(){return this.painter.getWidth()},getHeight:function(){return this.painter.getHeight()},pathToImage:function(e,t){return this.painter.pathToImage(e,t)},setCursorStyle:function(e){this.handler.setCursorStyle(e)},findHover:function(e,t){return this.handler.findHover(e,t)},on:function(e,t,n){this.handler.on(e,t,n)},off:function(e,t){this.handler.off(e,t)},trigger:function(e,t){this.handler.trigger(e,t)},clear:function(){this.storage.delRoot(),this.painter.clear()},dispose:function(){this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,b(this.id)}},t.version=p,t.init=g,t.dispose=m,t.getInstance=v,t.registerPainter=y},"69a8":function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},"69ff":function(e,t,n){var i=n("6d8b"),r=i.each,s=i.map,a=(i.isArray,i.isFunction),o=i.createHashMap,l=i.noop,u=n("f47d"),c=u.createTask,d=n("8918"),h=d.getUID,f=n("7e63"),p=n("843e"),g=n("e0d3"),m=g.normalizeToArray;function v(e,t,n,i){this.ecInstance=e,this.api=t,this.unfinished;n=this._dataProcessorHandlers=n.slice(),i=this._visualHandlers=i.slice();this._allHandlers=n.concat(i),this._stageTaskMap=o()}var y=v.prototype;function b(e,t,n,i,s){var a;function o(e,t){return e.setDirty&&(!e.dirtyMap||e.dirtyMap.get(t.__pipeline.id))}s=s||{},r(t,function(t,r){if(!s.visualType||s.visualType===t.visualType){var l=e._stageTaskMap.get(t.uid),u=l.seriesTaskMap,c=l.overallTask;if(c){var d,h=c.agentStubMap;h.each(function(e){o(s,e)&&(e.dirty(),d=!0)}),d&&c.dirty(),_(c,i);var f=e.getPerformArgs(c,s.block);h.each(function(e){e.perform(f)}),a|=c.perform(f)}else u&&u.each(function(r,l){o(s,r)&&r.dirty();var u=e.getPerformArgs(r,s.block);u.skip=!t.performRawSeries&&n.isSeriesFiltered(r.context.model),_(r,i),a|=r.perform(u)})}}),e.unfinished|=a}y.restoreData=function(e,t){e.restoreData(t),this._stageTaskMap.each(function(e){var t=e.overallTask;t&&t.dirty()})},y.getPerformArgs=function(e,t){if(e.__pipeline){var n=this._pipelineMap.get(e.__pipeline.id),i=n.context,r=!t&&n.progressiveEnabled&&(!i||i.progressiveRender)&&e.__idxInPipeline>n.blockIndex,s=r?n.step:null,a=i&&i.modDataCount,o=null!=a?Math.ceil(a/s):null;return{step:s,modBy:o,modDataCount:a}}},y.getPipeline=function(e){return this._pipelineMap.get(e)},y.updateStreamModes=function(e,t){var n=this._pipelineMap.get(e.uid),i=e.getData(),r=i.count(),s=n.progressiveEnabled&&t.incrementalPrepareRender&&r>=n.threshold,a=e.get("large")&&r>=e.get("largeThreshold"),o="mod"===e.get("progressiveChunkMode")?r:null;e.pipelineContext=n.context={progressiveRender:s,modDataCount:o,large:a}},y.restorePipelines=function(e){var t=this,n=t._pipelineMap=o();e.eachSeries(function(e){var i=e.getProgressive(),r=e.uid;n.set(r,{id:r,head:null,tail:null,threshold:e.getProgressiveThreshold(),progressiveEnabled:i&&!(e.preventIncremental&&e.preventIncremental()),blockIndex:-1,step:Math.round(i||700),count:0}),M(t,e,e.dataTask)})},y.prepareStageTasks=function(){var e=this._stageTaskMap,t=this.ecInstance.getModel(),n=this.api;r(this._allHandlers,function(i){var r=e.get(i.uid)||e.set(i.uid,[]);i.reset&&T(this,i,r,t,n),i.overallReset&&S(this,i,r,t,n)},this)},y.prepareView=function(e,t,n,i){var r=e.renderTask,s=r.context;s.model=t,s.ecModel=n,s.api=i,r.__block=!e.incrementalPrepareRender,M(this,t,r)},y.performDataProcessorTasks=function(e,t){b(this,this._dataProcessorHandlers,e,t,{block:!0})},y.performVisualTasks=function(e,t,n){b(this,this._visualHandlers,e,t,n)},y.performSeriesTasks=function(e){var t;e.eachSeries(function(e){t|=e.dataTask.perform()}),this.unfinished|=t},y.plan=function(){this._pipelineMap.each(function(e){var t=e.tail;do{if(t.__block){e.blockIndex=t.__idxInPipeline;break}t=t.getUpstream()}while(t)})};var _=y.updatePayload=function(e,t){"remain"!==t&&(e.context.payload=t)};function T(e,t,n,i,r){var s=n.seriesTaskMap||(n.seriesTaskMap=o()),a=t.seriesType,l=t.getTargetSeries;function u(n){var a=n.uid,o=s.get(a)||s.set(a,c({plan:A,reset:I,count:R}));o.context={model:n,ecModel:i,api:r,useClearVisual:t.isVisual&&!t.isLayout,plan:t.plan,reset:t.reset,scheduler:e},M(e,n,o)}t.createOnAllSeries?i.eachRawSeries(u):a?i.eachRawSeriesByType(a,u):l&&l(i,r).each(u);var d=e._pipelineMap;s.each(function(e,t){d.get(t)||(e.dispose(),s.removeKey(t))})}function S(e,t,n,i,s){var a=n.overallTask=n.overallTask||c({reset:w});a.context={ecModel:i,api:s,overallReset:t.overallReset,scheduler:e};var l=a.agentStubMap=a.agentStubMap||o(),u=t.seriesType,d=t.getTargetSeries,h=!0,f=t.modifyOutputEnd;function p(t){var n=t.uid,i=l.get(n);i||(i=l.set(n,c({reset:E,onDirty:k})),a.dirty()),i.context={model:t,overallProgress:h,modifyOutputEnd:f},i.agent=a,i.__block=h,M(e,t,i)}u?i.eachRawSeriesByType(u,p):d?d(i,s).each(p):(h=!1,r(i.getSeries(),p));var g=e._pipelineMap;l.each(function(e,t){g.get(t)||(e.dispose(),a.dirty(),l.removeKey(t))})}function w(e){e.overallReset(e.ecModel,e.api,e.payload)}function E(e,t){return e.overallProgress&&x}function x(){this.agent.dirty(),this.getDownstream().dirty()}function k(){this.agent&&this.agent.dirty()}function A(e){return e.plan&&e.plan(e.model,e.ecModel,e.api,e.payload)}function I(e){e.useClearVisual&&e.data.clearAllVisual();var t=e.resetDefines=m(e.reset(e.model,e.ecModel,e.api,e.payload));return t.length>1?s(t,function(e,t){return D(t)}):C}var C=D(0);function D(e){return function(t,n){var i=n.data,r=n.resetDefines[e];if(r&&r.dataEach)for(var s=t.start;s<t.end;s++)r.dataEach(i,s);else r&&r.progress&&r.progress(t,i)}}function R(e){return e.data.count()}function M(e,t,n){var i=t.uid,r=e._pipelineMap.get(i);!r.head&&(r.head=n),r.tail&&r.tail.pipe(n),r.tail=n,n.__idxInPipeline=r.count++,n.__pipeline=r}function L(e){P=null;try{e(O,N)}catch(e){}return P}v.wrapStageHandler=function(e,t){return a(e)&&(e={overallReset:e,seriesType:L(e)}),e.uid=h("stageHandler"),t&&(e.visualType=t),e};var P,O={},N={};function U(e,t){for(var n in t.prototype)e[n]=l}U(O,f),U(N,p),O.eachSeriesByType=O.eachRawSeriesByType=function(e){P=e},O.eachComponent=function(e){"series"===e.mainType&&e.subType&&(P=e.subType)};var F=v;e.exports=F},"6a99":function(e,t,n){var i=n("d3f4");e.exports=function(e,t){if(!i(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!i(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},"6b54":function(e,t,n){"use strict";n("3846");var i=n("cb7c"),r=n("0bfb"),s=n("9e1e"),a="toString",o=/./[a],l=function(e){n("2aba")(RegExp.prototype,a,e,!0)};n("79e5")(function(){return"/a/b"!=o.call({source:"a",flags:"b"})})?l(function(){var e=i(this);return"/".concat(e.source,"/","flags"in e?e.flags:!s&&e instanceof RegExp?r.call(e):void 0)}):o.name!=a&&l(function(){return o.call(this)})},"6cb7":function(e,t,n){var i=n("6d8b"),r=n("4319"),s=n("8918"),a=n("625e"),o=a.enableClassManagement,l=a.parseClassType,u=n("e0d3"),c=u.makeInner,d=n("f934"),h=n("de1c"),f=c(),p=r.extend({type:"component",id:"",name:"",mainType:"",subType:"",componentIndex:0,defaultOption:null,ecModel:null,dependentModels:[],uid:null,layoutMode:null,$constructor:function(e,t,n,i){r.call(this,e,t,n,i),this.uid=s.getUID("ec_cpt_model")},init:function(e,t,n,i){this.mergeDefaultAndTheme(e,n)},mergeDefaultAndTheme:function(e,t){var n=this.layoutMode,r=n?d.getLayoutParams(e):{},s=t.getTheme();i.merge(e,s.get(this.mainType)),i.merge(e,this.getDefaultOption()),n&&d.mergeLayoutParam(e,r,n)},mergeOption:function(e,t){i.merge(this.option,e,!0);var n=this.layoutMode;n&&d.mergeLayoutParam(this.option,e,n)},optionUpdated:function(e,t){},getDefaultOption:function(){var e=f(this);if(!e.defaultOption){var t=[],n=this.constructor;while(n){var r=n.prototype.defaultOption;r&&t.push(r),n=n.superClass}for(var s={},a=t.length-1;a>=0;a--)s=i.merge(s,t[a],!0);e.defaultOption=s}return e.defaultOption},getReferringComponents:function(e){return this.ecModel.queryComponents({mainType:e,index:this.get(e+"Index",!0),id:this.get(e+"Id",!0)})}});function g(e){var t=[];return i.each(p.getClassesByMainType(e),function(e){t=t.concat(e.prototype.dependencies||[])}),t=i.map(t,function(e){return l(e).main}),"dataset"!==e&&i.indexOf(t,"dataset")<=0&&t.unshift("dataset"),t}o(p,{registerWhenExtend:!0}),s.enableSubTypeDefaulter(p),s.enableTopologicalTravel(p,g),i.mixin(p,h);var m=p;e.exports=m},"6d8b":function(e,t){var n={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},i={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},r=Object.prototype.toString,s=Array.prototype,a=s.forEach,o=s.filter,l=s.slice,u=s.map,c=s.reduce,d={};function h(e,t){"createCanvas"===e&&(y=null),d[e]=t}function f(e){if(null==e||"object"!=typeof e)return e;var t=e,s=r.call(e);if("[object Array]"===s){if(!Y(e)){t=[];for(var a=0,o=e.length;a<o;a++)t[a]=f(e[a])}}else if(i[s]){if(!Y(e)){var l=e.constructor;if(e.constructor.from)t=l.from(e);else{t=new l(e.length);for(a=0,o=e.length;a<o;a++)t[a]=f(e[a])}}}else if(!n[s]&&!Y(e)&&!F(e))for(var u in t={},e)e.hasOwnProperty(u)&&(t[u]=f(e[u]));return t}function p(e,t,n){if(!O(t)||!O(e))return n?f(t):e;for(var i in t)if(t.hasOwnProperty(i)){var r=e[i],s=t[i];!O(s)||!O(r)||M(s)||M(r)||F(s)||F(r)||N(s)||N(r)||Y(s)||Y(r)?!n&&i in e||(e[i]=f(t[i],!0)):p(r,s,n)}return e}function g(e,t){for(var n=e[0],i=1,r=e.length;i<r;i++)n=p(n,e[i],t);return n}function m(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function v(e,t,n){for(var i in t)t.hasOwnProperty(i)&&(n?null!=t[i]:null==e[i])&&(e[i]=t[i]);return e}var y,b=function(){return d.createCanvas()};function _(){return y||(y=b().getContext("2d")),y}function T(e,t){if(e){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n}return-1}function S(e,t){var n=e.prototype;function i(){}for(var r in i.prototype=t.prototype,e.prototype=new i,n)e.prototype[r]=n[r];e.prototype.constructor=e,e.superClass=t}function w(e,t,n){e="prototype"in e?e.prototype:e,t="prototype"in t?t.prototype:t,v(e,t,n)}function E(e){if(e)return"string"!=typeof e&&"number"==typeof e.length}function x(e,t,n){if(e&&t)if(e.forEach&&e.forEach===a)e.forEach(t,n);else if(e.length===+e.length)for(var i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e);else for(var s in e)e.hasOwnProperty(s)&&t.call(n,e[s],s,e)}function k(e,t,n){if(e&&t){if(e.map&&e.map===u)return e.map(t,n);for(var i=[],r=0,s=e.length;r<s;r++)i.push(t.call(n,e[r],r,e));return i}}function A(e,t,n,i){if(e&&t){if(e.reduce&&e.reduce===c)return e.reduce(t,n,i);for(var r=0,s=e.length;r<s;r++)n=t.call(i,n,e[r],r,e);return n}}function I(e,t,n){if(e&&t){if(e.filter&&e.filter===o)return e.filter(t,n);for(var i=[],r=0,s=e.length;r<s;r++)t.call(n,e[r],r,e)&&i.push(e[r]);return i}}function C(e,t,n){if(e&&t)for(var i=0,r=e.length;i<r;i++)if(t.call(n,e[i],i,e))return e[i]}function D(e,t){var n=l.call(arguments,2);return function(){return e.apply(t,n.concat(l.call(arguments)))}}function R(e){var t=l.call(arguments,1);return function(){return e.apply(this,t.concat(l.call(arguments)))}}function M(e){return"[object Array]"===r.call(e)}function L(e){return"function"===typeof e}function P(e){return"[object String]"===r.call(e)}function O(e){var t=typeof e;return"function"===t||!!e&&"object"==t}function N(e){return!!n[r.call(e)]}function U(e){return!!i[r.call(e)]}function F(e){return"object"===typeof e&&"number"===typeof e.nodeType&&"object"===typeof e.ownerDocument}function B(e){return e!==e}function j(e){for(var t=0,n=arguments.length;t<n;t++)if(null!=arguments[t])return arguments[t]}function V(e,t){return null!=e?e:t}function H(e,t,n){return null!=e?e:null!=t?t:n}function $(){return Function.call.apply(l,arguments)}function G(e){if("number"===typeof e)return[e,e,e,e];var t=e.length;return 2===t?[e[0],e[1],e[0],e[1]]:3===t?[e[0],e[1],e[2],e[1]]:e}function z(e,t){if(!e)throw new Error(t)}function q(e){return null==e?null:"function"===typeof e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}d.createCanvas=function(){return document.createElement("canvas")};var W="__ec_primitive__";function K(e){e[W]=!0}function Y(e){return e[W]}function X(e){var t=M(e),n=this;function i(e,i){t?n.set(e,i):n.set(i,e)}e instanceof X?e.each(i):e&&x(e,i)}function Q(e){return new X(e)}function Z(e,t){for(var n=new e.constructor(e.length+t.length),i=0;i<e.length;i++)n[i]=e[i];var r=e.length;for(i=0;i<t.length;i++)n[i+r]=t[i];return n}function J(){}X.prototype={constructor:X,get:function(e){return this.hasOwnProperty(e)?this[e]:null},set:function(e,t){return this[e]=t},each:function(e,t){for(var n in void 0!==t&&(e=D(e,t)),this)this.hasOwnProperty(n)&&e(this[n],n)},removeKey:function(e){delete this[e]}},t.$override=h,t.clone=f,t.merge=p,t.mergeAll=g,t.extend=m,t.defaults=v,t.createCanvas=b,t.getContext=_,t.indexOf=T,t.inherits=S,t.mixin=w,t.isArrayLike=E,t.each=x,t.map=k,t.reduce=A,t.filter=I,t.find=C,t.bind=D,t.curry=R,t.isArray=M,t.isFunction=L,t.isString=P,t.isObject=O,t.isBuiltInObject=N,t.isTypedArray=U,t.isDom=F,t.eqNaN=B,t.retrieve=j,t.retrieve2=V,t.retrieve3=H,t.slice=$,t.normalizeCssArray=G,t.assert=z,t.trim=q,t.setAsPrimitive=K,t.isPrimitive=Y,t.createHashMap=Q,t.concatArray=Z,t.noop=J},"6fda":function(e,t,n){var i=n("6d8b"),r=i.each,s="\0_ec_hist_store";function a(e,t){var n=c(e);r(t,function(t,i){for(var r=n.length-1;r>=0;r--){var s=n[r];if(s[i])break}if(r<0){var a=e.queryComponents({mainType:"dataZoom",subType:"select",id:i})[0];if(a){var o=a.getPercentRange();n[0][i]={dataZoomId:i,start:o[0],end:o[1]}}}}),n.push(t)}function o(e){var t=c(e),n=t[t.length-1];t.length>1&&t.pop();var i={};return r(n,function(e,n){for(var r=t.length-1;r>=0;r--){e=t[r][n];if(e){i[n]=e;break}}}),i}function l(e){e[s]=null}function u(e){return c(e).length}function c(e){var t=e[s];return t||(t=e[s]=[{}]),t}t.push=a,t.pop=o,t.clear=l,t.count=u},7102:function(e,t){function n(){return e.exports=n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},e.exports.__esModule=!0,e.exports["default"]=e.exports,n.apply(null,arguments)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"71ad":function(e,t,n){var i=n("6d8b"),r={show:!0,zlevel:0,z:0,inverse:!1,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:!1,triggerEvent:!1,tooltip:{show:!1},axisPointer:{},axisLine:{show:!0,onZero:!0,onZeroAxisIndex:null,lineStyle:{color:"#333",width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15]},axisTick:{show:!0,inside:!1,length:5,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12},splitLine:{show:!0,lineStyle:{color:["#ccc"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.3)"]}}},s={};s.categoryAxis=i.merge({boundaryGap:!0,deduplication:null,splitLine:{show:!1},axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"}},r),s.valueAxis=i.merge({boundaryGap:[0,0],splitNumber:5},r),s.timeAxis=i.defaults({scale:!0,min:"dataMin",max:"dataMax"},s.valueAxis),s.logAxis=i.defaults({scale:!0,logBase:10},s.valueAxis);var a=s;e.exports=a},"74cb":function(e,t){var n={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quarticIn:function(e){return e*e*e*e},quarticOut:function(e){return 1- --e*e*e*e},quarticInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quinticIn:function(e){return e*e*e*e*e},quinticOut:function(e){return--e*e*e*e*e+1},quinticInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},sinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},sinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},exponentialIn:function(e){return 0===e?0:Math.pow(1024,e-1)},exponentialOut:function(e){return 1===e?1:1-Math.pow(2,-10*e)},exponentialInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circularIn:function(e){return 1-Math.sqrt(1-e*e)},circularOut:function(e){return Math.sqrt(1- --e*e)},circularInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:function(e){var t,n=.1,i=.4;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=i/4):t=i*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i))},elasticOut:function(e){var t,n=.1,i=.4;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=i/4):t=i*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/i)+1)},elasticInOut:function(e){var t,n=.1,i=.4;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=i/4):t=i*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/i)*.5+1)},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:function(e){return 1-n.bounceOut(1-e)},bounceOut:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bounceInOut:function(e){return e<.5?.5*n.bounceIn(2*e):.5*n.bounceOut(2*e-1)+.5}},i=n;e.exports=i},"767c":function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("607d"),a=n("29a8"),o=n("2145"),l=a.toolbox.dataView,u=new Array(60).join("-"),c="\t";function d(e){var t={},n=[],i=[];return e.eachRawSeries(function(e){var r=e.coordinateSystem;if(!r||"cartesian2d"!==r.type&&"polar"!==r.type)n.push(e);else{var s=r.getBaseAxis();if("category"===s.type){var a=s.dim+"_"+s.index;t[a]||(t[a]={categoryAxis:s,valueAxis:r.getOtherAxis(s),series:[]},i.push({axisDim:s.dim,axisIndex:s.index})),t[a].series.push(e)}else n.push(e)}}),{seriesGroupByCategoryAxis:t,other:n,meta:i}}function h(e){var t=[];return r.each(e,function(e,n){var i=e.categoryAxis,s=e.valueAxis,a=s.dim,o=[" "].concat(r.map(e.series,function(e){return e.name})),l=[i.model.getCategories()];r.each(e.series,function(e){l.push(e.getRawData().mapArray(a,function(e){return e}))});for(var u=[o.join(c)],d=0;d<l[0].length;d++){for(var h=[],f=0;f<l.length;f++)h.push(l[f][d]);u.push(h.join(c))}t.push(u.join("\n"))}),t.join("\n\n"+u+"\n\n")}function f(e){return r.map(e,function(e){var t=e.getRawData(),n=[e.name],i=[];return t.each(t.dimensions,function(){for(var e=arguments.length,r=arguments[e-1],s=t.getName(r),a=0;a<e-1;a++)i[a]=arguments[a];n.push((s?s+c:"")+i.join(c))}),n.join("\n")}).join("\n\n"+u+"\n\n")}function p(e){var t=d(e);return{value:r.filter([h(t.seriesGroupByCategoryAxis),f(t.other)],function(e){return e.replace(/[\n\t\s]/g,"")}).join("\n\n"+u+"\n\n"),meta:t.meta}}function g(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function m(e){var t=e.slice(0,e.indexOf("\n"));if(t.indexOf(c)>=0)return!0}var v=new RegExp("["+c+"]+","g");function y(e){for(var t=e.split(/\n+/g),n=g(t.shift()).split(v),i=[],s=r.map(n,function(e){return{name:e,data:[]}}),a=0;a<t.length;a++){var o=g(t[a]).split(v);i.push(o.shift());for(var l=0;l<o.length;l++)s[l]&&(s[l].data[a]=o[l])}return{series:s,categories:i}}function b(e){for(var t=e.split(/\n+/g),n=g(t.shift()),i=[],r=0;r<t.length;r++){var s,a=g(t[r]).split(v),o="",l=!1;isNaN(a[0])?(l=!0,o=a[0],a=a.slice(1),i[r]={name:o,value:[]},s=i[r].value):s=i[r]=[];for(var u=0;u<a.length;u++)s.push(+a[u]);1===s.length&&(l?i[r].value=s[0]:i[r]=s[0])}return{name:n,data:i}}function _(e,t){var n=e.split(new RegExp("\n*"+u+"\n*","g")),i={series:[]};return r.each(n,function(e,n){if(m(e)){var r=y(e),s=t[n],a=s.axisDim+"Axis";s&&(i[a]=i[a]||[],i[a][s.axisIndex]={data:r.categories},i.series=i.series.concat(r.series))}else{r=b(e);i.series.push(r)}}),i}function T(e){this._dom=null,this.model=e}function S(e,t){return r.map(e,function(e,n){var i=t&&t[n];return r.isObject(i)&&!r.isArray(i)?(r.isObject(e)&&!r.isArray(e)&&(e=e.value),r.defaults({value:e},i)):e})}T.defaultOption={show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:r.clone(l.title),lang:r.clone(l.lang),backgroundColor:"#fff",textColor:"#000",textareaColor:"#fff",textareaBorderColor:"#333",buttonColor:"#c23531",buttonTextColor:"#fff"},T.prototype.onclick=function(e,t){var n=t.getDom(),i=this.model;this._dom&&n.removeChild(this._dom);var a=document.createElement("div");a.style.cssText="position:absolute;left:5px;top:5px;bottom:5px;right:5px;",a.style.backgroundColor=i.get("backgroundColor")||"#fff";var o=document.createElement("h4"),l=i.get("lang")||[];o.innerHTML=l[0]||i.get("title"),o.style.cssText="margin: 10px 20px;",o.style.color=i.get("textColor");var u=document.createElement("div"),d=document.createElement("textarea");u.style.cssText="display:block;width:100%;overflow:auto;";var h=i.get("optionToContent"),f=i.get("contentToOption"),g=p(e);if("function"===typeof h){var m=h(t.getOption());"string"===typeof m?u.innerHTML=m:r.isDom(m)&&u.appendChild(m)}else u.appendChild(d),d.readOnly=i.get("readOnly"),d.style.cssText="width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;",d.style.color=i.get("textColor"),d.style.borderColor=i.get("textareaBorderColor"),d.style.backgroundColor=i.get("textareaColor"),d.value=g.value;var v=g.meta,y=document.createElement("div");y.style.cssText="position:absolute;bottom:0;left:0;right:0;";var b="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px",T=document.createElement("div"),S=document.createElement("div");b+=";background-color:"+i.get("buttonColor"),b+=";color:"+i.get("buttonTextColor");var w=this;function E(){n.removeChild(a),w._dom=null}s.addEventListener(T,"click",E),s.addEventListener(S,"click",function(){var e;try{e="function"===typeof f?f(u,t.getOption()):_(d.value,v)}catch(e){throw E(),new Error("Data view format error "+e)}e&&t.dispatchAction({type:"changeDataView",newOption:e}),E()}),T.innerHTML=l[1],S.innerHTML=l[2],S.style.cssText=b,T.style.cssText=b,!i.get("readOnly")&&y.appendChild(S),y.appendChild(T),s.addEventListener(d,"keydown",function(e){if(9===(e.keyCode||e.which)){var t=this.value,n=this.selectionStart,i=this.selectionEnd;this.value=t.substring(0,n)+c+t.substring(i),this.selectionStart=this.selectionEnd=n+1,s.stop(e)}}),a.appendChild(o),a.appendChild(u),a.appendChild(y),u.style.height=n.clientHeight-80+"px",n.appendChild(a),this._dom=a},T.prototype.remove=function(e,t){this._dom&&t.getDom().removeChild(this._dom)},T.prototype.dispose=function(e,t){this.remove(e,t)},o.register("dataView",T),i.registerAction({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},function(e,t){var n=[];r.each(e.newOption.series,function(e){var i=t.getSeriesByName(e.name)[0];if(i){var s=i.get("data");n.push({name:e.name,data:S(e.data,s)})}else n.push(r.extend({type:"scatter"},e))}),t.mergeOption(r.defaults({series:n},e.newOption))});var w=T;e.exports=w},"76a5":function(e,t,n){var i=n("19eb"),r=n("6d8b"),s=n("e86a"),a=n("a73c"),o=function(e){i.call(this,e)};o.prototype={constructor:o,type:"text",brush:function(e,t){var n=this.style;this.__dirty&&a.normalizeTextStyle(n,!0),n.fill=n.stroke=n.shadowBlur=n.shadowColor=n.shadowOffsetX=n.shadowOffsetY=null;var i=n.text;null!=i&&(i+=""),n.bind(e,this,t),a.needDrawText(i,n)&&(this.setTransform(e),a.renderText(this,e,i,n),this.restoreTransform(e))},getBoundingRect:function(){var e=this.style;if(this.__dirty&&a.normalizeTextStyle(e,!0),!this._rect){var t=e.text;null!=t?t+="":t="";var n=s.getBoundingRect(e.text+"",e.font,e.textAlign,e.textVerticalAlign,e.textPadding,e.rich);if(n.x+=e.x||0,n.y+=e.y||0,a.getStroke(e.textStroke,e.textStrokeWidth)){var i=e.textStrokeWidth;n.x-=i/2,n.y-=i/2,n.width+=i,n.height+=i}this._rect=n}return this._rect}},r.inherits(o,i);var l=o;e.exports=l},7726:function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},"77f1":function(e,t,n){var i=n("4588"),r=Math.max,s=Math.min;e.exports=function(e,t){return e=i(e),e<0?r(e+t,0):s(e,t)}},7919:function(e,t,n){var i=n("f934"),r=i.getLayoutRect,s=i.box,a=i.positionElement,o=n("eda2"),l=n("2306");function u(e,t,n){var i=t.getBoxLayoutParams(),o=t.get("padding"),l={width:n.getWidth(),height:n.getHeight()},u=r(i,l,o);s(t.get("orient"),e,t.get("itemGap"),u.width,u.height),a(e,i,l,o)}function c(e,t){var n=o.normalizeCssArray(t.get("padding")),i=t.getItemStyle(["color","opacity"]);i.fill=t.get("backgroundColor");e=new l.Rect({shape:{x:e.x-n[3],y:e.y-n[0],width:e.width+n[1]+n[3],height:e.height+n[0]+n[2],r:t.get("borderRadius")},style:i,silent:!0,z2:-1});return e}t.layout=u,t.makeBackground=c},"79e5":function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},"7a56":function(e,t,n){"use strict";var i=n("7726"),r=n("86cc"),s=n("9e1e"),a=n("2b4c")("species");e.exports=function(e){var t=i[e];s&&t&&!t[a]&&r.f(t,a,{configurable:!0,get:function(){return this}})}},"7c4d":function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("fc82"),a=n("bd9e"),o=n("6fda"),l=n("ef6a"),u=n("29a8"),c=n("2145");n("dd39");var d=u.toolbox.dataZoom,h=r.each,f="\0_ec_\0toolbox-dataZoom_";function p(e,t,n){(this._brushController=new s(n.getZr())).on("brush",r.bind(this._onBrush,this)).mount(),this._isZoomActive}p.defaultOption={show:!0,icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:r.clone(d.title)};var g=p.prototype;g.render=function(e,t,n,i){this.model=e,this.ecModel=t,this.api=n,b(e,t,this,i,n),y(e,t)},g.onclick=function(e,t,n){m[n].call(this)},g.remove=function(e,t){this._brushController.unmount()},g.dispose=function(e,t){this._brushController.dispose()};var m={zoom:function(){var e=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:e})},back:function(){this._dispatchZoomAction(o.pop(this.ecModel))}};function v(e){var t={};return r.each(["xAxisIndex","yAxisIndex"],function(n){t[n]=e[n],null==t[n]&&(t[n]="all"),(!1===t[n]||"none"===t[n])&&(t[n]=[])}),t}function y(e,t){e.setIconStatus("back",o.count(t)>1?"emphasis":"normal")}function b(e,t,n,i,r){var s=n._isZoomActive;i&&"takeGlobalCursor"===i.type&&(s="dataZoomSelect"===i.key&&i.dataZoomSelectActive),n._isZoomActive=s,e.setIconStatus("zoom",s?"emphasis":"normal");var o=new a(v(e.option),t,{include:["grid"]});n._brushController.setPanels(o.makePanelOpts(r,function(e){return e.xAxisDeclared&&!e.yAxisDeclared?"lineX":!e.xAxisDeclared&&e.yAxisDeclared?"lineY":"rect"})).enableBrush(!!s&&{brushType:"auto",brushStyle:{lineWidth:0,fill:"rgba(0,0,0,0.2)"}})}g._onBrush=function(e,t){if(t.isEnd&&e.length){var n={},i=this.ecModel;this._brushController.updateCovers([]);var r=new a(v(this.model.option),i,{include:["grid"]});r.matchOutputRanges(e,i,function(e,t,n){if("cartesian2d"===n.type){var i=e.brushType;"rect"===i?(s("x",n,t[0]),s("y",n,t[1])):s({lineX:"x",lineY:"y"}[i],n,t)}}),o.push(i,n),this._dispatchZoomAction(n)}function s(e,t,r){var s=t.getAxis(e),a=s.model,o=u(e,a,i),c=o.findRepresentativeAxisProxy(a).getMinMaxSpan();null==c.minValueSpan&&null==c.maxValueSpan||(r=l(0,r.slice(),s.scale.getExtent(),0,c.minValueSpan,c.maxValueSpan)),o&&(n[o.id]={dataZoomId:o.id,startValue:r[0],endValue:r[1]})}function u(e,t,n){var i;return n.eachComponent({mainType:"dataZoom",subType:"select"},function(n){var r=n.getAxisModel(e,t.componentIndex);r&&(i=n)}),i}},g._dispatchZoomAction=function(e){var t=[];h(e,function(e,n){t.push(r.clone(e))}),t.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:t})},c.register("dataZoom",p),i.registerPreprocessor(function(e){if(e){var t=e.dataZoom||(e.dataZoom=[]);r.isArray(t)||(e.dataZoom=t=[t]);var n=e.toolbox;if(n&&(r.isArray(n)&&(n=n[0]),n&&n.feature)){var i=n.feature.dataZoom;s("xAxis",i),s("yAxis",i)}}function s(e,n){if(n){var i=e+"Index",s=n[i];null==s||"all"==s||r.isArray(s)||(s=!1===s||"none"===s?[]:[s]),a(e,function(n,a){if(null==s||"all"==s||-1!==r.indexOf(s,a)){var o={type:"select",$fromToolbox:!0,id:f+e+a};o[i]=a,t.push(o)}})}}function a(t,n){var i=e[t];r.isArray(i)||(i=i?[i]:[]),h(i,n)}});var _=p;e.exports=_},"7d6d":function(e,t){var n={shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1,textShadowBlur:1,textShadowOffsetX:1,textShadowOffsetY:1,textBoxShadowBlur:1,textBoxShadowOffsetX:1,textBoxShadowOffsetY:1};function i(e,t,i){return n.hasOwnProperty(t)?i*e.dpr:i}e.exports=i},"7dcf":function(e,t,n){var i=n("b12f"),r=i.extend({type:"dataZoom",render:function(e,t,n,i){this.dataZoomModel=e,this.ecModel=t,this.api=n},getTargetCoordInfo:function(){var e=this.dataZoomModel,t=this.ecModel,n={};function i(e,t,n,i){for(var r,s=0;s<n.length;s++)if(n[s].model===e){r=n[s];break}r||n.push(r={model:e,axisModels:[],coordIndex:i}),r.axisModels.push(t)}return e.eachTargetAxis(function(e,r){var s=t.getComponent(e.axis,r);if(s){var a=s.getCoordSysModel();a&&i(a,s,n[a.mainType]||(n[a.mainType]=[]),a.componentIndex)}},this),n}});e.exports=r},"7e63":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=r.each,a=r.filter,o=r.map,l=r.isArray,u=r.indexOf,c=r.isObject,d=r.isString,h=r.createHashMap,f=r.assert,p=r.clone,g=r.merge,m=r.extend,v=r.mixin,y=n("e0d3"),b=n("4319"),_=n("6cb7"),T=n("8971"),S=n("e47b"),w=n("0f99"),E=w.resetSourceDefaulter,x="\0_ec_inner",k=b.extend({init:function(e,t,n,i){n=n||{},this.option=null,this._theme=new b(n),this._optionManager=i},setOption:function(e,t){f(!(x in e),"please use chart.getOption()"),this._optionManager.setOption(e,t),this.resetOption(null)},resetOption:function(e){var t=!1,n=this._optionManager;if(!e||"recreate"===e){var i=n.mountOption("recreate"===e);this.option&&"recreate"!==e?(this.restoreData(),this.mergeOption(i)):C.call(this,i),t=!0}if("timeline"!==e&&"media"!==e||this.restoreData(),!e||"recreate"===e||"timeline"===e){var r=n.getTimelineOption(this);r&&(this.mergeOption(r),t=!0)}if(!e||"recreate"===e||"media"===e){var a=n.getMediaOption(this,this._api);a.length&&s(a,function(e){this.mergeOption(e,t=!0)},this)}return t},mergeOption:function(e){var t=this.option,n=this._componentsMap,i=[];function r(i,r){var a=y.normalizeToArray(e[i]),o=y.mappingToExists(n.get(i),a);y.makeIdAndName(o),s(o,function(e,t){var n=e.option;c(n)&&(e.keyInfo.mainType=i,e.keyInfo.subType=R(i,n,e.exist))});var l=D(n,r);t[i]=[],n.set(i,[]),s(o,function(e,r){var s=e.exist,a=e.option;if(f(c(a)||s,"Empty component definition"),a){var o=_.getClass(i,e.keyInfo.subType,!0);if(s&&s instanceof o)s.name=e.keyInfo.name,s.mergeOption(a,this),s.optionUpdated(a,!1);else{var u=m({dependentModels:l,componentIndex:r},e.keyInfo);s=new o(a,this,this,u),m(s,u),s.init(a,this,this,u),s.optionUpdated(null,!0)}}else s.mergeOption({},this),s.optionUpdated({},!1);n.get(i)[r]=s,t[i][r]=s.option},this),"series"===i&&M(this,n.get("series"))}E(this),s(e,function(e,n){null!=e&&(_.hasClass(n)?n&&i.push(n):t[n]=null==t[n]?p(e):g(t[n],e,!0))}),_.topologicalTravel(i,_.getAllClassMainTypes(),r,this),this._seriesIndicesMap=h(this._seriesIndices=this._seriesIndices||[])},getOption:function(){var e=p(this.option);return s(e,function(t,n){if(_.hasClass(n)){t=y.normalizeToArray(t);for(var i=t.length-1;i>=0;i--)y.isIdInner(t[i])&&t.splice(i,1);e[n]=t}}),delete e[x],e},getTheme:function(){return this._theme},getComponent:function(e,t){var n=this._componentsMap.get(e);if(n)return n[t||0]},queryComponents:function(e){var t=e.mainType;if(!t)return[];var n,i=e.index,r=e.id,s=e.name,c=this._componentsMap.get(t);if(!c||!c.length)return[];if(null!=i)l(i)||(i=[i]),n=a(o(i,function(e){return c[e]}),function(e){return!!e});else if(null!=r){var d=l(r);n=a(c,function(e){return d&&u(r,e.id)>=0||!d&&e.id===r})}else if(null!=s){var h=l(s);n=a(c,function(e){return h&&u(s,e.name)>=0||!h&&e.name===s})}else n=c.slice();return L(n,e)},findComponents:function(e){var t=e.query,n=e.mainType,i=s(t),r=i?this.queryComponents(i):this._componentsMap.get(n);return o(L(r,e));function s(e){var t=n+"Index",i=n+"Id",r=n+"Name";return!e||null==e[t]&&null==e[i]&&null==e[r]?null:{mainType:n,index:e[t],id:e[i],name:e[r]}}function o(t){return e.filter?a(t,e.filter):t}},eachComponent:function(e,t,n){var i=this._componentsMap;if("function"===typeof e)n=t,t=e,i.each(function(e,i){s(e,function(e,r){t.call(n,i,e,r)})});else if(d(e))s(i.get(e),t,n);else if(c(e)){var r=this.findComponents(e);s(r,t,n)}},getSeriesByName:function(e){var t=this._componentsMap.get("series");return a(t,function(t){return t.name===e})},getSeriesByIndex:function(e){return this._componentsMap.get("series")[e]},getSeriesByType:function(e){var t=this._componentsMap.get("series");return a(t,function(t){return t.subType===e})},getSeries:function(){return this._componentsMap.get("series").slice()},getSeriesCount:function(){return this._componentsMap.get("series").length},eachSeries:function(e,t){P(this),s(this._seriesIndices,function(n){var i=this._componentsMap.get("series")[n];e.call(t,i,n)},this)},eachRawSeries:function(e,t){s(this._componentsMap.get("series"),e,t)},eachSeriesByType:function(e,t,n){P(this),s(this._seriesIndices,function(i){var r=this._componentsMap.get("series")[i];r.subType===e&&t.call(n,r,i)},this)},eachRawSeriesByType:function(e,t,n){return s(this.getSeriesByType(e),t,n)},isSeriesFiltered:function(e){return P(this),null==this._seriesIndicesMap.get(e.componentIndex)},getCurrentSeriesIndices:function(){return(this._seriesIndices||[]).slice()},filterSeries:function(e,t){P(this);var n=a(this._componentsMap.get("series"),e,t);M(this,n)},restoreData:function(e){var t=this._componentsMap;M(this,t.get("series"));var n=[];t.each(function(e,t){n.push(t)}),_.topologicalTravel(n,_.getAllClassMainTypes(),function(n,i){s(t.get(n),function(t){("series"!==n||!A(t,e))&&t.restoreData()})})}});function A(e,t){if(t){var n=t.seiresIndex,i=t.seriesId,r=t.seriesName;return null!=n&&e.componentIndex!==n||null!=i&&e.id!==i||null!=r&&e.name!==r}}function I(e,t){var n=e.color&&!e.colorLayer;s(t,function(t,i){"colorLayer"===i&&n||_.hasClass(i)||("object"===typeof t?e[i]=e[i]?g(e[i],t,!1):p(t):null==e[i]&&(e[i]=t))})}function C(e){e=e,this.option={},this.option[x]=1,this._componentsMap=h({series:[]}),this._seriesIndices,this._seriesIndicesMap,I(e,this._theme.option),g(e,T,!1),this.mergeOption(e)}function D(e,t){l(t)||(t=t?[t]:[]);var n={};return s(t,function(t){n[t]=(e.get(t)||[]).slice()}),n}function R(e,t,n){var i=t.type?t.type:n?n.subType:_.determineSubType(e,t);return i}function M(e,t){e._seriesIndicesMap=h(e._seriesIndices=o(t,function(e){return e.componentIndex})||[])}function L(e,t){return t.hasOwnProperty("subType")?a(e,function(e){return e.subType===t.subType}):e}function P(e){}v(k,S);var O=k;e.exports=O},"7f20":function(e,t,n){var i=n("86cc").f,r=n("69a8"),s=n("2b4c")("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,s)&&i(e,s,{configurable:!0,value:t})}},"7f96":function(e,t){function n(e,t,n){return{seriesType:e,performRawSeries:!0,reset:function(e,i,r){var s=e.getData(),a=e.get("symbol")||t,o=e.get("symbolSize"),l=e.get("symbolKeepAspect");if(s.setVisual({legendSymbol:n||a,symbol:a,symbolSize:o,symbolKeepAspect:l}),!i.isSeriesFiltered(e)){var u="function"===typeof o;return{dataEach:s.hasItemOption||u?c:null}}function c(t,n){if("function"===typeof o){var i=e.getRawValue(n),r=e.getDataParams(n);t.setItemVisual(n,"symbolSize",o(i,r))}if(t.hasItemOption){var s=t.getItemModel(n),a=s.getShallow("symbol",!0),l=s.getShallow("symbolSize",!0),u=s.getShallow("symbolKeepAspect",!0);null!=a&&t.setItemVisual(n,"symbol",a),null!=l&&t.setItemVisual(n,"symbolSize",l),null!=u&&t.setItemVisual(n,"symbolKeepAspect",u)}}}}}e.exports=n},8079:function(e,t,n){var i=n("7726"),r=n("1991").set,s=i.MutationObserver||i.WebKitMutationObserver,a=i.process,o=i.Promise,l="process"==n("2d95")(a);e.exports=function(){var e,t,n,u=function(){var i,r;l&&(i=a.domain)&&i.exit();while(e){r=e.fn,e=e.next;try{r()}catch(i){throw e?n():t=void 0,i}}t=void 0,i&&i.enter()};if(l)n=function(){a.nextTick(u)};else if(!s||i.navigator&&i.navigator.standalone)if(o&&o.resolve){var c=o.resolve(void 0);n=function(){c.then(u)}}else n=function(){r.call(i,u)};else{var d=!0,h=document.createTextNode("");new s(u).observe(h,{characterData:!0}),n=function(){h.data=d=!d}}return function(i){var r={fn:i,next:void 0};t&&(t.next=r),e||(e=r,n()),t=r}}},"80f0":function(e,t){function n(e){return e}function i(e,t,i,r,s){this._old=e,this._new=t,this._oldKeyGetter=i||n,this._newKeyGetter=r||n,this.context=s}function r(e,t,n,i,r){for(var s=0;s<e.length;s++){var a="_ec_"+r[i](e[s],s),o=t[a];null==o?(n.push(a),t[a]=s):(o.length||(t[a]=o=[o]),o.push(s))}}i.prototype={constructor:i,add:function(e){return this._add=e,this},update:function(e){return this._update=e,this},remove:function(e){return this._remove=e,this},execute:function(){var e=this._old,t=this._new,n={},i={},s=[],a=[];for(r(e,n,s,"_oldKeyGetter",this),r(t,i,a,"_newKeyGetter",this),c=0;c<e.length;c++){var o=s[c],l=i[o];if(null!=l){var u=l.length;u?(1===u&&(i[o]=null),l=l.unshift()):i[o]=null,this._update&&this._update(l,c)}else this._remove&&this._remove(c)}for(var c=0;c<a.length;c++){o=a[c];if(i.hasOwnProperty(o)){l=i[o];if(null==l)continue;if(l.length){var d=0;for(u=l.length;d<u;d++)this._add&&this._add(l[d])}else this._add&&this._add(l)}}}};var s=i;e.exports=s},"81c0":function(e,t,n){var i=n("a968").getUint64,r=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},r=12;0===n.version?(n.earliestPresentationTime=t.getUint32(r),n.firstOffset=t.getUint32(r+4),r+=8):(n.earliestPresentationTime=i(e.subarray(r)),n.firstOffset=i(e.subarray(r+8)),r+=16),r+=2;var s=t.getUint16(r);for(r+=2;s>0;r+=12,s--)n.references.push({referenceType:(128&e[r])>>>7,referencedSize:2147483647&t.getUint32(r),subsegmentDuration:t.getUint32(r+4),startsWithSap:!!(128&e[r+8]),sapType:(112&e[r+8])>>>4,sapDeltaTime:268435455&t.getUint32(r+8)});return n};e.exports=r},8362:function(e,t){e.exports=i;var n=Object.prototype.toString;function i(e){if(!e)return!1;var t=n.call(e);return"[object Function]"===t||"function"===typeof e&&"[object RegExp]"!==t||"undefined"!==typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}},8378:function(e,t){var n=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)},"843e":function(e,t,n){var i=n("6d8b"),r=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isDisposed","on","off","getDataURL","getConnectedDataURL","getModel","getOption","getViewOfComponentModel","getViewOfSeriesModel"];function s(e){i.each(r,function(t){this[t]=i.bind(e[t],e)},this)}var a=s;e.exports=a},8484:function(e,t,n){"use strict";var i=n("63ec"),r=n("be09"),s=n.n(r),a=function(e,t,n){t.forEach(function(t){for(var i in e.mediaGroups[t])for(var r in e.mediaGroups[t][i]){var s=e.mediaGroups[t][i][r];n(s,t,i,r)}})},o=n("ffdf"),l=n("210b");n.d(t,"a",function(){return x}),n.d(t,"b",function(){return P}),n.d(t,"c",function(){return Ie}),n.d(t,"d",function(){return Ce});const u=e=>{return!!e&&"object"===typeof e},c=(...e)=>{return e.reduce((e,t)=>{return"object"!==typeof t?e:(Object.keys(t).forEach(n=>{Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=e[n].concat(t[n]):u(e[n])&&u(t[n])?e[n]=c(e[n],t[n]):e[n]=t[n]}),e)},{})},d=e=>Object.keys(e).map(t=>e[t]),h=(e,t)=>{const n=[];for(let i=e;i<t;i++)n.push(i);return n},f=e=>e.reduce((e,t)=>e.concat(t),[]),p=e=>{if(!e.length)return[];const t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t},g=(e,t)=>e.reduce((e,n,i)=>{return n[t]&&e.push(i),e},[]),m=(e,t)=>{return d(e.reduce((e,n)=>{return n.forEach(n=>{e[t(n)]=n}),e},{}))};var v={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",INVALID_NUMBER_OF_CONTENT_STEERING:"INVALID_NUMBER_OF_CONTENT_STEERING",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"};const y=({baseUrl:e="",source:t="",range:n="",indexRange:r=""})=>{const a={uri:t,resolvedUri:Object(i["a"])(e||"",t)};if(n||r){const e=n||r,t=e.split("-");let i,o=s.a.BigInt?s.a.BigInt(t[0]):parseInt(t[0],10),l=s.a.BigInt?s.a.BigInt(t[1]):parseInt(t[1],10);o<Number.MAX_SAFE_INTEGER&&"bigint"===typeof o&&(o=Number(o)),l<Number.MAX_SAFE_INTEGER&&"bigint"===typeof l&&(l=Number(l)),i="bigint"===typeof l||"bigint"===typeof o?s.a.BigInt(l)-s.a.BigInt(o)+s.a.BigInt(1):l-o+1,"bigint"===typeof i&&i<Number.MAX_SAFE_INTEGER&&(i=Number(i)),a.byterange={length:i,offset:o}}return a},b=e=>{let t;return t="bigint"===typeof e.offset||"bigint"===typeof e.length?s.a.BigInt(e.offset)+s.a.BigInt(e.length)-s.a.BigInt(1):e.offset+e.length-1,`${e.offset}-${t}`},_=e=>{return e&&"number"!==typeof e&&(e=parseInt(e,10)),isNaN(e)?null:e},T={static(e){const{duration:t,timescale:n=1,sourceDuration:i,periodDuration:r}=e,s=_(e.endNumber),a=t/n;return"number"===typeof s?{start:0,end:s}:"number"===typeof r?{start:0,end:r/a}:{start:0,end:i/a}},dynamic(e){const{NOW:t,clientOffset:n,availabilityStartTime:i,timescale:r=1,duration:s,periodStart:a=0,minimumUpdatePeriod:o=0,timeShiftBufferDepth:l=1/0}=e,u=_(e.endNumber),c=(t+n)/1e3,d=i+a,h=c+o,f=h-d,p=Math.ceil(f*r/s),g=Math.floor((c-d-l)*r/s),m=Math.floor((c-d)*r/s);return{start:Math.max(0,g),end:"number"===typeof u?u:Math.min(p,m)}}},S=e=>t=>{const{duration:n,timescale:i=1,periodStart:r,startNumber:s=1}=e;return{number:s+t,duration:n/i,timeline:r,time:t*n}},w=e=>{const{type:t,duration:n,timescale:i=1,periodDuration:r,sourceDuration:s}=e,{start:a,end:o}=T[t](e),l=h(a,o).map(S(e));if("static"===t){const e=l.length-1,t="number"===typeof r?r:s;l[e].duration=t-n/i*e}return l},E=e=>{const{baseUrl:t,initialization:n={},sourceDuration:i,indexRange:r="",periodStart:s,presentationTime:a,number:o=0,duration:l}=e;if(!t)throw new Error(v.NO_BASE_URL);const u=y({baseUrl:t,source:n.sourceURL,range:n.range}),c=y({baseUrl:t,source:t,indexRange:r});if(c.map=u,l){const t=w(e);t.length&&(c.duration=t[0].duration,c.timeline=t[0].timeline)}else i&&(c.duration=i,c.timeline=s);return c.presentationTime=a||s,c.number=o,[c]},x=(e,t,n)=>{const i=e.sidx.map?e.sidx.map:null,r=e.sidx.duration,a=e.timeline||0,o=e.sidx.byterange,l=o.offset+o.length,u=t.timescale,c=t.references.filter(e=>1!==e.referenceType),d=[],h=e.endList?"static":"dynamic",f=e.sidx.timeline;let p,g=f,m=e.mediaSequence||0;p="bigint"===typeof t.firstOffset?s.a.BigInt(l)+t.firstOffset:l+t.firstOffset;for(let v=0;v<c.length;v++){const e=t.references[v],o=e.referencedSize,l=e.subsegmentDuration;let c;c="bigint"===typeof p?p+s.a.BigInt(o)-s.a.BigInt(1):p+o-1;const y=`${p}-${c}`,b={baseUrl:n,timescale:u,timeline:a,periodStart:f,presentationTime:g,number:m,duration:l,sourceDuration:r,indexRange:y,type:h},_=E(b)[0];i&&(_.map=i),d.push(_),p+="bigint"===typeof p?s.a.BigInt(o):o,g+=l/u,m++}return e.segments=d,e},k=["AUDIO","SUBTITLES"],A=1/60,I=e=>{return m(e,({timeline:e})=>e).sort((e,t)=>e.timeline>t.timeline?1:-1)},C=(e,t)=>{for(let n=0;n<e.length;n++)if(e[n].attributes.NAME===t)return e[n];return null},D=e=>{let t=[];return a(e,k,(e,n,i,r)=>{t=t.concat(e.playlists||[])}),t},R=({playlist:e,mediaSequence:t})=>{e.mediaSequence=t,e.segments.forEach((t,n)=>{t.number=e.mediaSequence+n})},M=({oldPlaylists:e,newPlaylists:t,timelineStarts:n})=>{t.forEach(t=>{t.discontinuitySequence=n.findIndex(function({timeline:e}){return e===t.timeline});const i=C(e,t.attributes.NAME);if(!i)return;if(t.sidx)return;const r=t.segments[0],s=i.segments.findIndex(function(e){return Math.abs(e.presentationTime-r.presentationTime)<A});if(-1===s)return R({playlist:t,mediaSequence:i.mediaSequence+i.segments.length}),t.segments[0].discontinuity=!0,t.discontinuityStarts.unshift(0),void((!i.segments.length&&t.timeline>i.timeline||i.segments.length&&t.timeline>i.segments[i.segments.length-1].timeline)&&t.discontinuitySequence--);const a=i.segments[s];a.discontinuity&&!r.discontinuity&&(r.discontinuity=!0,t.discontinuityStarts.unshift(0),t.discontinuitySequence--),R({playlist:t,mediaSequence:i.segments[s].number})})},L=({oldManifest:e,newManifest:t})=>{const n=e.playlists.concat(D(e)),i=t.playlists.concat(D(t));return t.timelineStarts=I([e.timelineStarts,t.timelineStarts]),M({oldPlaylists:n,newPlaylists:i,timelineStarts:t.timelineStarts}),t},P=e=>e&&e.uri+"-"+b(e.byterange),O=e=>{const t=e.reduce(function(e,t){return e[t.attributes.baseUrl]||(e[t.attributes.baseUrl]=[]),e[t.attributes.baseUrl].push(t),e},{});let n=[];return Object.values(t).forEach(e=>{const t=d(e.reduce((e,t)=>{const n=t.attributes.id+(t.attributes.lang||"");return e[n]?(t.segments&&(t.segments[0]&&(t.segments[0].discontinuity=!0),e[n].segments.push(...t.segments)),t.attributes.contentProtection&&(e[n].attributes.contentProtection=t.attributes.contentProtection)):(e[n]=t,e[n].attributes.timelineStarts=[]),e[n].attributes.timelineStarts.push({start:t.attributes.periodStart,timeline:t.attributes.periodStart}),e},{}));n=n.concat(t)}),n.map(e=>{return e.discontinuityStarts=g(e.segments||[],"discontinuity"),e})},N=(e,t)=>{const n=P(e.sidx),i=n&&t[n]&&t[n].sidx;return i&&x(e,i,e.sidx.resolvedUri),e},U=(e,t={})=>{if(!Object.keys(t).length)return e;for(const n in e)e[n]=N(e[n],t);return e},F=({attributes:e,segments:t,sidx:n,mediaSequence:i,discontinuitySequence:r,discontinuityStarts:s},a)=>{const o={attributes:{NAME:e.id,BANDWIDTH:e.bandwidth,CODECS:e.codecs,["PROGRAM-ID"]:1},uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,discontinuitySequence:r,discontinuityStarts:s,timelineStarts:e.timelineStarts,mediaSequence:i,segments:t};return e.contentProtection&&(o.contentProtection=e.contentProtection),e.serviceLocation&&(o.attributes.serviceLocation=e.serviceLocation),n&&(o.sidx=n),a&&(o.attributes.AUDIO="audio",o.attributes.SUBTITLES="subs"),o},B=({attributes:e,segments:t,mediaSequence:n,discontinuityStarts:i,discontinuitySequence:r})=>{"undefined"===typeof t&&(t=[{uri:e.baseUrl,timeline:e.periodStart,resolvedUri:e.baseUrl||"",duration:e.sourceDuration,number:0}],e.duration=e.sourceDuration);const s={NAME:e.id,BANDWIDTH:e.bandwidth,["PROGRAM-ID"]:1};e.codecs&&(s.CODECS=e.codecs);const a={attributes:s,uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,timelineStarts:e.timelineStarts,discontinuityStarts:i,discontinuitySequence:r,mediaSequence:n,segments:t};return e.serviceLocation&&(a.attributes.serviceLocation=e.serviceLocation),a},j=(e,t={},n=!1)=>{let i;const r=e.reduce((e,r)=>{const s=r.attributes.role&&r.attributes.role.value||"",a=r.attributes.lang||"";let o=r.attributes.label||"main";if(a&&!r.attributes.label){const e=s?` (${s})`:"";o=`${r.attributes.lang}${e}`}e[o]||(e[o]={language:a,autoselect:!0,default:"main"===s,playlists:[],uri:""});const l=N(F(r,n),t);return e[o].playlists.push(l),"undefined"===typeof i&&"main"===s&&(i=r,i.default=!0),e},{});if(!i){const e=Object.keys(r)[0];r[e].default=!0}return r},V=(e,t={})=>{return e.reduce((e,n)=>{const i=n.attributes.label||n.attributes.lang||"text",r=n.attributes.lang||"und";return e[i]||(e[i]={language:r,default:!1,autoselect:!1,playlists:[],uri:""}),e[i].playlists.push(N(B(n),t)),e},{})},H=e=>e.reduce((e,t)=>{return t?(t.forEach(t=>{const{channel:n,language:i}=t;e[i]={autoselect:!1,default:!1,instreamId:n,language:i},t.hasOwnProperty("aspectRatio")&&(e[i].aspectRatio=t.aspectRatio),t.hasOwnProperty("easyReader")&&(e[i].easyReader=t.easyReader),t.hasOwnProperty("3D")&&(e[i]["3D"]=t["3D"])}),e):e},{}),$=({attributes:e,segments:t,sidx:n,discontinuityStarts:i})=>{const r={attributes:{NAME:e.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:e.width,height:e.height},CODECS:e.codecs,BANDWIDTH:e.bandwidth,["PROGRAM-ID"]:1},uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:e.baseUrl||"",targetDuration:e.duration,discontinuityStarts:i,timelineStarts:e.timelineStarts,segments:t};return e.frameRate&&(r.attributes["FRAME-RATE"]=e.frameRate),e.contentProtection&&(r.contentProtection=e.contentProtection),e.serviceLocation&&(r.attributes.serviceLocation=e.serviceLocation),n&&(r.sidx=n),r},G=({attributes:e})=>"video/mp4"===e.mimeType||"video/webm"===e.mimeType||"video"===e.contentType,z=({attributes:e})=>"audio/mp4"===e.mimeType||"audio/webm"===e.mimeType||"audio"===e.contentType,q=({attributes:e})=>"text/vtt"===e.mimeType||"text"===e.contentType,W=(e,t)=>{e.forEach(e=>{e.mediaSequence=0,e.discontinuitySequence=t.findIndex(function({timeline:t}){return t===e.timeline}),e.segments&&e.segments.forEach((e,t)=>{e.number=t})})},K=e=>{return e?Object.keys(e).reduce((t,n)=>{const i=e[n];return t.concat(i.playlists)},[]):[]},Y=({dashPlaylists:e,locations:t,contentSteering:n,sidxMapping:i={},previousManifest:r,eventStream:s})=>{if(!e.length)return{};const{sourceDuration:a,type:o,suggestedPresentationDelay:l,minimumUpdatePeriod:u}=e[0].attributes,c=O(e.filter(G)).map($),d=O(e.filter(z)),h=O(e.filter(q)),f=e.map(e=>e.attributes.captionServices).filter(Boolean),p={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},["CLOSED-CAPTIONS"]:{},SUBTITLES:{}},uri:"",duration:a,playlists:U(c,i)};u>=0&&(p.minimumUpdatePeriod=1e3*u),t&&(p.locations=t),n&&(p.contentSteering=n),"dynamic"===o&&(p.suggestedPresentationDelay=l),s&&s.length>0&&(p.eventStream=s);const g=0===p.playlists.length,m=d.length?j(d,i,g):null,v=h.length?V(h,i):null,y=c.concat(K(m),K(v)),b=y.map(({timelineStarts:e})=>e);return p.timelineStarts=I(b),W(y,p.timelineStarts),m&&(p.mediaGroups.AUDIO.audio=m),v&&(p.mediaGroups.SUBTITLES.subs=v),f.length&&(p.mediaGroups["CLOSED-CAPTIONS"].cc=H(f)),r?L({oldManifest:r,newManifest:p}):p},X=(e,t,n)=>{const{NOW:i,clientOffset:r,availabilityStartTime:s,timescale:a=1,periodStart:o=0,minimumUpdatePeriod:l=0}=e,u=(i+r)/1e3,c=s+o,d=u+l,h=d-c;return Math.ceil((h*a-t)/n)},Q=(e,t)=>{const{type:n,minimumUpdatePeriod:i=0,media:r="",sourceDuration:s,timescale:a=1,startNumber:o=1,periodStart:l}=e,u=[];let c=-1;for(let d=0;d<t.length;d++){const h=t[d],f=h.d,p=h.r||0,g=h.t||0;let m;if(c<0&&(c=g),g&&g>c&&(c=g),p<0){const o=d+1;m=o===t.length?"dynamic"===n&&i>0&&r.indexOf("$Number$")>0?X(e,c,f):(s*a-c)/f:(t[o].t-c)/f}else m=p+1;const v=o+u.length+m;let y=o+u.length;while(y<v)u.push({number:y,duration:f/a,time:c,timeline:l}),c+=f,y++}return u},Z=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,J=e=>(t,n,i,r)=>{if("$$"===t)return"$";if("undefined"===typeof e[n])return t;const s=""+e[n];return"RepresentationID"===n?s:(r=i?parseInt(r,10):1,s.length>=r?s:`${new Array(r-s.length+1).join("0")}${s}`)},ee=(e,t)=>e.replace(Z,J(t)),te=(e,t)=>{return e.duration||t?e.duration?w(e):Q(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodStart}]},ne=(e,t)=>{const n={RepresentationID:e.id,Bandwidth:e.bandwidth||0},{initialization:r={sourceURL:"",range:""}}=e,s=y({baseUrl:e.baseUrl,source:ee(r.sourceURL,n),range:r.range}),a=te(e,t);return a.map(t=>{n.Number=t.number,n.Time=t.time;const r=ee(e.media||"",n),a=e.timescale||1,o=e.presentationTimeOffset||0,l=e.periodStart+(t.time-o)/a,u={uri:r,timeline:t.timeline,duration:t.duration,resolvedUri:Object(i["a"])(e.baseUrl||"",r),map:s,number:t.number,presentationTime:l};return u})},ie=(e,t)=>{const{baseUrl:n,initialization:i={}}=e,r=y({baseUrl:n,source:i.sourceURL,range:i.range}),s=y({baseUrl:n,source:t.media,range:t.mediaRange});return s.map=r,s},re=(e,t)=>{const{duration:n,segmentUrls:i=[],periodStart:r}=e;if(!n&&!t||n&&t)throw new Error(v.SEGMENT_TIME_UNSPECIFIED);const s=i.map(t=>ie(e,t));let a;n&&(a=w(e)),t&&(a=Q(e,t));const o=a.map((t,n)=>{if(s[n]){const i=s[n],a=e.timescale||1,o=e.presentationTimeOffset||0;return i.timeline=t.timeline,i.duration=t.duration,i.number=t.number,i.presentationTime=r+(t.time-o)/a,i}}).filter(e=>e);return o},se=({attributes:e,segmentInfo:t})=>{let n,i;t.template?(i=ne,n=c(e,t.template)):t.base?(i=E,n=c(e,t.base)):t.list&&(i=re,n=c(e,t.list));const r={attributes:e};if(!i)return r;const s=i(n,t.segmentTimeline);if(n.duration){const{duration:e,timescale:t=1}=n;n.duration=e/t}else s.length?n.duration=s.reduce((e,t)=>{return Math.max(e,Math.ceil(t.duration))},0):n.duration=0;return r.attributes=n,r.segments=s,t.base&&n.indexRange&&(r.sidx=s[0],r.segments=[]),r},ae=e=>e.map(se),oe=(e,t)=>p(e.childNodes).filter(({tagName:e})=>e===t),le=e=>e.textContent.trim(),ue=e=>{return parseFloat(e.split("/").reduce((e,t)=>e/t))},ce=e=>{const t=31536e3,n=2592e3,i=86400,r=3600,s=60,a=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/,o=a.exec(e);if(!o)return 0;const[l,u,c,d,h,f]=o.slice(1);return parseFloat(l||0)*t+parseFloat(u||0)*n+parseFloat(c||0)*i+parseFloat(d||0)*r+parseFloat(h||0)*s+parseFloat(f||0)},de=e=>{const t=/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/;return t.test(e)&&(e+="Z"),Date.parse(e)},he={mediaPresentationDuration(e){return ce(e)},availabilityStartTime(e){return de(e)/1e3},minimumUpdatePeriod(e){return ce(e)},suggestedPresentationDelay(e){return ce(e)},type(e){return e},timeShiftBufferDepth(e){return ce(e)},start(e){return ce(e)},width(e){return parseInt(e,10)},height(e){return parseInt(e,10)},bandwidth(e){return parseInt(e,10)},frameRate(e){return ue(e)},startNumber(e){return parseInt(e,10)},timescale(e){return parseInt(e,10)},presentationTimeOffset(e){return parseInt(e,10)},duration(e){const t=parseInt(e,10);return isNaN(t)?ce(e):t},d(e){return parseInt(e,10)},t(e){return parseInt(e,10)},r(e){return parseInt(e,10)},presentationTime(e){return parseInt(e,10)},DEFAULT(e){return e}},fe=e=>{return e&&e.attributes?p(e.attributes).reduce((e,t)=>{const n=he[t.name]||he.DEFAULT;return e[t.name]=n(t.value),e},{}):{}},pe={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},ge=(e,t)=>{return t.length?f(e.map(function(e){return t.map(function(t){const n=le(t),r=Object(i["a"])(e.baseUrl,n),s=c(fe(t),{baseUrl:r});return r!==n&&!s.serviceLocation&&e.serviceLocation&&(s.serviceLocation=e.serviceLocation),s})})):e},me=e=>{const t=oe(e,"SegmentTemplate")[0],n=oe(e,"SegmentList")[0],i=n&&oe(n,"SegmentURL").map(e=>c({tag:"SegmentURL"},fe(e))),r=oe(e,"SegmentBase")[0],s=n||t,a=s&&oe(s,"SegmentTimeline")[0],o=n||r||t,l=o&&oe(o,"Initialization")[0],u=t&&fe(t);u&&l?u.initialization=l&&fe(l):u&&u.initialization&&(u.initialization={sourceURL:u.initialization});const d={template:u,segmentTimeline:a&&oe(a,"S").map(e=>fe(e)),list:n&&c(fe(n),{segmentUrls:i,initialization:fe(l)}),base:r&&c(fe(r),{initialization:fe(l)})};return Object.keys(d).forEach(e=>{d[e]||delete d[e]}),d},ve=(e,t,n)=>i=>{const r=oe(i,"BaseURL"),s=ge(t,r),a=c(e,fe(i)),o=me(i);return s.map(e=>{return{segmentInfo:c(n,o),attributes:c(a,e)}})},ye=e=>{return e.reduce((e,t)=>{const n=fe(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());const i=pe[n.schemeIdUri];if(i){e[i]={attributes:n};const r=oe(t,"cenc:pssh")[0];if(r){const t=le(r);e[i].pssh=t&&Object(o["a"])(t)}}return e},{})},be=e=>{if("urn:scte:dash:cc:cea-608:2015"===e.schemeIdUri){const t="string"!==typeof e.value?[]:e.value.split(";");return t.map(e=>{let t,n;return n=e,/^CC\d=/.test(e)?[t,n]=e.split("="):/^CC\d$/.test(e)&&(t=e),{channel:t,language:n}})}if("urn:scte:dash:cc:cea-708:2015"===e.schemeIdUri){const t="string"!==typeof e.value?[]:e.value.split(";");return t.map(e=>{const t={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){const[n,i=""]=e.split("=");t.channel=n,t.language=e,i.split(",").forEach(e=>{const[n,i]=e.split(":");"lang"===n?t.language=i:"er"===n?t.easyReader=Number(i):"war"===n?t.aspectRatio=Number(i):"3D"===n&&(t["3D"]=Number(i))})}else t.language=e;return t.channel&&(t.channel="SERVICE"+t.channel),t})}},_e=e=>{return f(oe(e.node,"EventStream").map(t=>{const n=fe(t),i=n.schemeIdUri;return oe(t,"Event").map(t=>{const r=fe(t),s=r.presentationTime||0,a=n.timescale||1,o=r.duration||0,l=s/a+e.attributes.start;return{schemeIdUri:i,value:n.value,id:r.id,start:l,end:l+o/a,messageData:le(t)||r.messageData,contentEncoding:n.contentEncoding,presentationTimeOffset:n.presentationTimeOffset||0}})}))},Te=(e,t,n)=>i=>{const r=fe(i),s=ge(t,oe(i,"BaseURL")),a=oe(i,"Role")[0],o={role:fe(a)};let l=c(e,r,o);const u=oe(i,"Accessibility")[0],d=be(fe(u));d&&(l=c(l,{captionServices:d}));const h=oe(i,"Label")[0];if(h&&h.childNodes.length){const e=h.childNodes[0].nodeValue.trim();l=c(l,{label:e})}const p=ye(oe(i,"ContentProtection"));Object.keys(p).length&&(l=c(l,{contentProtection:p}));const g=me(i),m=oe(i,"Representation"),v=c(n,g);return f(m.map(ve(l,s,v)))},Se=(e,t)=>(n,i)=>{const r=ge(t,oe(n.node,"BaseURL")),s=c(e,{periodStart:n.attributes.start});"number"===typeof n.attributes.duration&&(s.periodDuration=n.attributes.duration);const a=oe(n.node,"AdaptationSet"),o=me(n.node);return f(a.map(Te(s,r,o)))},we=(e,t)=>{if(e.length>1&&t({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!e.length)return null;const n=c({serverURL:le(e[0])},fe(e[0]));return n.queryBeforeStart="true"===n.queryBeforeStart,n},Ee=({attributes:e,priorPeriodAttributes:t,mpdType:n})=>{return"number"===typeof e.start?e.start:t&&"number"===typeof t.start&&"number"===typeof t.duration?t.start+t.duration:t||"static"!==n?null:0},xe=(e,t={})=>{const{manifestUri:n="",NOW:i=Date.now(),clientOffset:r=0,eventHandler:s=function(){}}=t,a=oe(e,"Period");if(!a.length)throw new Error(v.INVALID_NUMBER_OF_PERIOD);const o=oe(e,"Location"),l=fe(e),u=ge([{baseUrl:n}],oe(e,"BaseURL")),c=oe(e,"ContentSteering");l.type=l.type||"static",l.sourceDuration=l.mediaPresentationDuration||0,l.NOW=i,l.clientOffset=r,o.length&&(l.locations=o.map(le));const d=[];return a.forEach((e,t)=>{const n=fe(e),i=d[t-1];n.start=Ee({attributes:n,priorPeriodAttributes:i?i.attributes:null,mpdType:l.type}),d.push({node:e,attributes:n})}),{locations:l.locations,contentSteeringInfo:we(c,s),representationInfo:f(d.map(Se(l,u))),eventStream:f(d.map(_e))}},ke=e=>{if(""===e)throw new Error(v.DASH_EMPTY_MANIFEST);const t=new l["DOMParser"];let n,i;try{n=t.parseFromString(e,"application/xml"),i=n&&"MPD"===n.documentElement.tagName?n.documentElement:null}catch(e){}if(!i||i&&i.getElementsByTagName("parsererror").length>0)throw new Error(v.DASH_INVALID_XML);return i},Ae=e=>{const t=oe(e,"UTCTiming")[0];if(!t)return null;const n=fe(t);switch(n.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":n.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":n.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":n.method="DIRECT",n.value=Date.parse(n.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(v.UNSUPPORTED_UTC_TIMING_SCHEME)}return n},Ie=(e,t={})=>{const n=xe(ke(e),t),i=ae(n.representationInfo);return Y({dashPlaylists:i,locations:n.locations,contentSteering:n.contentSteeringInfo,sidxMapping:t.sidxMapping,previousManifest:t.previousManifest,eventStream:n.eventStream})},Ce=e=>Ae(ke(e))},"84ce":function(e,t,n){var i=n("6d8b"),r=i.each,s=i.map,a=n("3842"),o=a.linearMap,l=a.getPixelPrecision,u=n("e073"),c=u.createAxisTicks,d=u.createAxisLabels,h=u.calculateCategoryInterval,f=[0,1],p=function(e,t,n){this.dim=e,this.scale=t,this._extent=n||[0,0],this.inverse=!1,this.onBand=!1};function g(e,t){var n=e[1]-e[0],i=t,r=n/i/2;e[0]+=r,e[1]-=r}function m(e,t,n,i,s){var a=t.length;if(e.onBand&&!i&&a){var o,l=e.getExtent();if(1===a)t[0].coord=l[0],o=t[1]={coord:l[0]};else{var u=t[1].coord-t[0].coord;r(t,function(e){e.coord-=u/2;var t=t||0;t%2>0&&(e.coord-=u/(2*(t+1)))}),o={coord:t[a-1].coord+u},t.push(o)}var c=l[0]>l[1];d(t[0].coord,l[0])&&(s?t[0].coord=l[0]:t.shift()),s&&d(l[0],t[0].coord)&&t.unshift({coord:l[0]}),d(l[1],o.coord)&&(s?o.coord=l[1]:t.pop()),s&&d(o.coord,l[1])&&t.push({coord:l[1]})}function d(e,t){return c?e>t:e<t}}p.prototype={constructor:p,contain:function(e){var t=this._extent,n=Math.min(t[0],t[1]),i=Math.max(t[0],t[1]);return e>=n&&e<=i},containData:function(e){return this.contain(this.dataToCoord(e))},getExtent:function(){return this._extent.slice()},getPixelPrecision:function(e){return l(e||this.scale.getExtent(),this._extent)},setExtent:function(e,t){var n=this._extent;n[0]=e,n[1]=t},dataToCoord:function(e,t){var n=this._extent,i=this.scale;return e=i.normalize(e),this.onBand&&"ordinal"===i.type&&(n=n.slice(),g(n,i.count())),o(e,f,n,t)},coordToData:function(e,t){var n=this._extent,i=this.scale;this.onBand&&"ordinal"===i.type&&(n=n.slice(),g(n,i.count()));var r=o(e,n,f,t);return this.scale.scale(r)},pointToData:function(e,t){},getTicksCoords:function(e){e=e||{};var t=e.tickModel||this.getTickModel(),n=c(this,t),i=n.ticks,r=s(i,function(e){return{coord:this.dataToCoord(e),tickValue:e}},this),a=t.get("alignWithLabel");return m(this,r,n.tickCategoryInterval,a,e.clamp),r},getViewLabels:function(){return d(this).labels},getLabelModel:function(){return this.model.getModel("axisLabel")},getTickModel:function(){return this.model.getModel("axisTick")},getBandWidth:function(){var e=this._extent,t=this.scale.getExtent(),n=t[1]-t[0]+(this.onBand?1:0);0===n&&(n=1);var i=Math.abs(e[1]-e[0]);return Math.abs(i)/n},isHorizontal:null,getRotate:null,calculateCategoryInterval:function(){return h(this)}};var v=p;e.exports=v},"84d5":function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("4319"),a=n("e0d3"),o=a.isNameSpecified,l=i.extendComponentModel({type:"legend.plain",dependencies:["series"],layoutMode:{type:"box",ignoreSize:!0},init:function(e,t,n){this.mergeDefaultAndTheme(e,n),e.selected=e.selected||{}},mergeOption:function(e){l.superCall(this,"mergeOption",e)},optionUpdated:function(){this._updateData(this.ecModel);var e=this._data;if(e[0]&&"single"===this.get("selectedMode")){for(var t=!1,n=0;n<e.length;n++){var i=e[n].get("name");if(this.isSelected(i)){this.select(i),t=!0;break}}!t&&this.select(e[0].get("name"))}},_updateData:function(e){var t=[],n=[];e.eachRawSeries(function(i){var r,s=i.name;if(n.push(s),i.legendDataProvider){var a=i.legendDataProvider(),l=a.mapArray(a.getName);e.isSeriesFiltered(i)||(n=n.concat(l)),l.length?t=t.concat(l):r=!0}else r=!0;r&&o(i)&&t.push(i.name)}),this._availableNames=n;var i=this.get("data")||t,a=r.map(i,function(e){return"string"!==typeof e&&"number"!==typeof e||(e={name:e}),new s(e,this,this.ecModel)},this);this._data=a},getData:function(){return this._data},select:function(e){var t=this.option.selected,n=this.get("selectedMode");if("single"===n){var i=this._data;r.each(i,function(e){t[e.get("name")]=!1})}t[e]=!0},unSelect:function(e){"single"!==this.get("selectedMode")&&(this.option.selected[e]=!1)},toggleSelected:function(e){var t=this.option.selected;t.hasOwnProperty(e)||(t[e]=!0),this[t[e]?"unSelect":"select"](e)},isSelected:function(e){var t=this.option.selected;return!(t.hasOwnProperty(e)&&!t[e])&&r.indexOf(this._availableNames,e)>=0},defaultOption:{zlevel:0,z:4,show:!0,orient:"horizontal",left:"center",top:0,align:"auto",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemGap:10,itemWidth:25,itemHeight:14,inactiveColor:"#ccc",textStyle:{color:"#333"},selectedMode:!0,tooltip:{show:!1}}}),u=l;e.exports=u},"84f2":function(e,t){e.exports={}},"857d":function(e,t){var n=2*Math.PI;function i(e){return e%=n,e<0&&(e+=n),e}t.normalizeRadian=i},"862d":function(e,t,n){var i=n("6d8b"),r=i.createHashMap,s=i.each,a=i.isString,o=i.defaults,l=i.extend,u=i.isObject,c=i.clone,d=n("e0d3"),h=d.normalizeToArray,f=n("0f99"),p=f.guessOrdinal,g=n("ec6f"),m=n("2f45"),v=m.OTHER_DIMENSIONS;function y(e,t,n){g.isInstance(t)||(t=g.seriesDataToSource(t)),n=n||{},e=(e||[]).slice();for(var i=(n.dimsDef||[]).slice(),d=r(n.encodeDef),f=r(),m=r(),y=[],T=b(t,e,i,n.dimCount),S=0;S<T;S++){var w=i[S]=l({},u(i[S])?i[S]:{name:i[S]}),E=w.name,x=y[S]={otherDims:{}};null!=E&&null==f.get(E)&&(x.name=x.displayName=E,f.set(E,S)),null!=w.type&&(x.type=w.type),null!=w.displayName&&(x.displayName=w.displayName)}d.each(function(e,t){e=h(e).slice();var n=d.set(t,[]);s(e,function(e,i){a(e)&&(e=f.get(e)),null!=e&&e<T&&(n[i]=e,A(y[e],t,i))})});var k=0;function A(e,t,n){null!=v.get(t)?e.otherDims[t]=n:(e.coordDim=t,e.coordDimIndex=n,m.set(t,!0))}s(e,function(e,t){var n,i,r;if(a(e))n=e,e={};else{n=e.name;var l=e.ordinalMeta;e.ordinalMeta=null,e=c(e),e.ordinalMeta=l,i=e.dimsDef,r=e.otherDims,e.name=e.coordDim=e.coordDimIndex=e.dimsDef=e.otherDims=null}var f=h(d.get(n));if(!f.length)for(var p=0;p<(i&&i.length||1);p++){while(k<y.length&&null!=y[k].coordDim)k++;k<y.length&&f.push(k++)}s(f,function(t,s){var a=y[t];if(A(o(a,e),n,s),null==a.name&&i){var l=i[s];!u(l)&&(l={name:l}),a.name=a.displayName=l.name,a.defaultTooltip=l.defaultTooltip}r&&o(a.otherDims,r)})});var I=n.generateCoord,C=n.generateCoordCount,D=null!=C;C=I?C||1:0;for(var R=I||"value",M=0;M<T;M++){x=y[M]=y[M]||{};var L=x.coordDim;null==L&&(x.coordDim=_(R,m,D),x.coordDimIndex=0,(!I||C<=0)&&(x.isExtraCoord=!0),C--),null==x.name&&(x.name=_(x.coordDim,f)),null==x.type&&p(t,M,x.name)&&(x.type="ordinal")}return y}function b(e,t,n,i){var r=Math.max(e.dimensionsDetectCount||1,t.length,n.length,i||0);return s(t,function(e){var t=e.dimsDef;t&&(r=Math.max(r,t.length))}),r}function _(e,t,n){if(n||null!=t.get(e)){var i=0;while(null!=t.get(e+i))i++;e+=i}return t.set(e,!0),e}var T=y;e.exports=T},"86cc":function(e,t,n){var i=n("cb7c"),r=n("c69a"),s=n("6a99"),a=Object.defineProperty;t.f=n("9e1e")?Object.defineProperty:function(e,t,n){if(i(e),t=s(t,!0),i(n),r)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},8728:function(e,t){function n(e,t,n,i,r,s){if(s>t&&s>i||s<t&&s<i)return 0;if(i===t)return 0;var a=i<t?1:-1,o=(s-t)/(i-t);1!==o&&0!==o||(a=i<t?.5:-.5);var l=o*(n-e)+e;return l===r?1/0:l>r?a:0}e.exports=n},"87b1":function(e,t,n){var i=n("cbe5"),r=n("4fac"),s=i.extend({type:"polygon",shape:{points:null,smooth:!1,smoothConstraint:null},buildPath:function(e,t){r.buildPath(e,t,!0)}});e.exports=s},"87c3":function(e,t,n){var i=n("6d8b"),r=i.map,s=n("cccd"),a=n("ee1a"),o=a.isDimensionStacked;function l(e){return{seriesType:e,plan:s(),reset:function(e){var t=e.getData(),n=e.coordinateSystem,i=e.pipelineContext,s=i.large;if(n){var a=r(n.dimensions,function(e){return t.mapDimension(e)}).slice(0,2),l=a.length,u=t.getCalculationInfo("stackResultDimension");return o(t,a[0])&&(a[0]=u),o(t,a[1])&&(a[1]=u),l&&{progress:c}}function c(e,t){for(var i=e.end-e.start,r=s&&new Float32Array(i*l),o=e.start,u=0,c=[],d=[];o<e.end;o++){var h;if(1===l){var f=t.get(a[0],o);h=!isNaN(f)&&n.dataToPoint(f,null,d)}else{f=c[0]=t.get(a[0],o);var p=c[1]=t.get(a[1],o);h=!isNaN(f)&&!isNaN(p)&&n.dataToPoint(c,null,d)}s?(r[u++]=h?h[0]:NaN,r[u++]=h?h[1]:NaN):t.setItemLayout(o,h&&h.slice()||[NaN,NaN])}s&&t.setLayout("symbolPoints",r)}}}}e.exports=l},"88b3":function(e,t){var n="\0__throttleOriginMethod",i="\0__throttleRate",r="\0__throttleType";function s(e,t,n){var i,r,s,a,o,l=0,u=0,c=null;function d(){u=(new Date).getTime(),c=null,e.apply(s,a||[])}t=t||0;var h=function(){i=(new Date).getTime(),s=this,a=arguments;var e=o||t,h=o||n;o=null,r=i-(h?l:u)-e,clearTimeout(c),h?c=setTimeout(d,e):r>=0?d():c=setTimeout(d,-r),l=i};return h.clear=function(){c&&(clearTimeout(c),c=null)},h.debounceNextCall=function(e){o=e},h}function a(e,t,a,o){var l=e[t];if(l){var u=l[n]||l,c=l[r],d=l[i];if(d!==a||c!==o){if(null==a||!o)return e[t]=u;l=e[t]=s(u,a,"debounce"===o),l[n]=u,l[r]=o,l[i]=a}return l}}function o(e,t){var i=e[t];i&&i[n]&&(e[t]=i[n])}t.throttle=s,t.createOrUpdate=a,t.clear=o},8918:function(e,t,n){var i=n("6d8b"),r=n("625e"),s=r.parseClassType,a=0;function o(e){return[e||"",a++,Math.random().toFixed(5)].join("_")}function l(e){var t={};return e.registerSubTypeDefaulter=function(e,n){e=s(e),t[e.main]=n},e.determineSubType=function(n,i){var r=i.type;if(!r){var a=s(n).main;e.hasSubTypes(n)&&t[a]&&(r=t[a](i))}return r},e}function u(e,t){function n(e){var n={},a=[];return i.each(e,function(o){var l=r(n,o),u=l.originalDeps=t(o),c=s(u,e);l.entryCount=c.length,0===l.entryCount&&a.push(o),i.each(c,function(e){i.indexOf(l.predecessor,e)<0&&l.predecessor.push(e);var t=r(n,e);i.indexOf(t.successor,e)<0&&t.successor.push(o)})}),{graph:n,noEntryList:a}}function r(e,t){return e[t]||(e[t]={predecessor:[],successor:[]}),e[t]}function s(e,t){var n=[];return i.each(e,function(e){i.indexOf(t,e)>=0&&n.push(e)}),n}e.topologicalTravel=function(e,t,r,s){if(e.length){var a=n(t),o=a.graph,l=a.noEntryList,u={};i.each(e,function(e){u[e]=!0});while(l.length){var c=l.pop(),d=o[c],h=!!u[c];h&&(r.call(s,c,d.originalDeps.slice()),delete u[c]),i.each(d.successor,h?p:f)}i.each(u,function(){throw new Error("Circle dependency may exists")})}function f(e){o[e].entryCount--,0===o[e].entryCount&&l.push(e)}function p(e){u[e]=!0,f(e)}}}t.getUID=o,t.enableSubTypeDefaulter=l,t.enableTopologicalTravel=u},8971:function(e,t){var n="";"undefined"!==typeof navigator&&(n=navigator.platform||"");var i={color:["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"],gradientColor:["#f6efa6","#d88273","#bf444c"],textStyle:{fontFamily:n.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,animation:"auto",animationDuration:1e3,animationDurationUpdate:300,animationEasing:"exponentialOut",animationEasingUpdate:"cubicOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:!1};e.exports=i},"897a":function(e,t,n){var i=n("22d1"),r=[["shadowBlur",0],["shadowColor","#000"],["shadowOffsetX",0],["shadowOffsetY",0]];function s(e){return i.browser.ie&&i.browser.version>=11?function(){var t,n=this.__clipPaths,i=this.style;if(n)for(var s=0;s<n.length;s++){var a=n[s],o=a&&a.shape,l=a&&a.type;if(o&&("sector"===l&&o.startAngle===o.endAngle||"rect"===l&&(!o.width||!o.height))){for(var u=0;u<r.length;u++)r[u][2]=i[r[u][0]],i[r[u][0]]=r[u][1];t=!0;break}}if(e.apply(this,arguments),t)for(u=0;u<r.length;u++)i[r[u][0]]=r[u][2]}:e}e.exports=s},"89a7":function(e,t,n){"use strict";function i(e,t,n){if(void 0===n&&(n=Array.prototype),e&&"function"===typeof n.find)return n.find.call(e,t);for(var i=0;i<e.length;i++)if(Object.prototype.hasOwnProperty.call(e,i)){var r=e[i];if(t.call(void 0,r,i,e))return r}}function r(e,t){return void 0===t&&(t=Object),t&&"function"===typeof t.freeze?t.freeze(e):e}function s(e,t){if(null===e||"object"!==typeof e)throw new TypeError("target is not an object");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}var a=r({HTML:"text/html",isHTML:function(e){return e===a.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),o=r({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(e){return e===o.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});t.assign=s,t.find=i,t.freeze=r,t.MIME_TYPE=a,t.NAMESPACE=o},"89e3":function(e,t,n){var i=n("3842"),r=n("eda2"),s=n("e0d8"),a=n("944e"),o=i.round,l=s.extend({type:"interval",_interval:0,_intervalPrecision:2,setExtent:function(e,t){var n=this._extent;isNaN(e)||(n[0]=parseFloat(e)),isNaN(t)||(n[1]=parseFloat(t))},unionExtent:function(e){var t=this._extent;e[0]<t[0]&&(t[0]=e[0]),e[1]>t[1]&&(t[1]=e[1]),l.prototype.setExtent.call(this,t[0],t[1])},getInterval:function(){return this._interval},setInterval:function(e){this._interval=e,this._niceExtent=this._extent.slice(),this._intervalPrecision=a.getIntervalPrecision(e)},getTicks:function(){return a.intervalScaleGetTicks(this._interval,this._extent,this._niceExtent,this._intervalPrecision)},getLabel:function(e,t){if(null==e)return"";var n=t&&t.precision;return null==n?n=i.getPrecisionSafe(e)||0:"auto"===n&&(n=this._intervalPrecision),e=o(e,n,!0),r.addCommas(e)},niceTicks:function(e,t,n){e=e||5;var i=this._extent,r=i[1]-i[0];if(isFinite(r)){r<0&&(r=-r,i.reverse());var s=a.intervalScaleNiceTicks(i,e,t,n);this._intervalPrecision=s.intervalPrecision,this._interval=s.interval,this._niceExtent=s.niceTickExtent}},niceExtent:function(e){var t=this._extent;if(t[0]===t[1])if(0!==t[0]){var n=t[0];e.fixMax?t[0]-=n/2:(t[1]+=n/2,t[0]-=n/2)}else t[1]=1;var i=t[1]-t[0];isFinite(i)||(t[0]=0,t[1]=1),this.niceTicks(e.splitNumber,e.minInterval,e.maxInterval);var r=this._interval;e.fixMin||(t[0]=o(Math.floor(t[0]/r)*r)),e.fixMax||(t[1]=o(Math.ceil(t[1]/r)*r))}});l.create=function(){return new l};var u=l;e.exports=u},"8b53":function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,r=/^application\/dash\+xml/i,s=function(e){return i.test(e)?"hls":r.test(e)?"dash":"application/vnd.videojs.vhs+json"===e?"vhs-json":null}},"8b7f":function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=r.createHashMap,a=(r.retrieve,r.each);function o(e){var t=e.get("coordinateSystem"),n={coordSysName:t,coordSysDims:[],axisMap:s(),categoryAxisMap:s()},i=l[t];if(i)return i(e,n,n.axisMap,n.categoryAxisMap),n}var l={cartesian2d:function(e,t,n,i){var r=e.getReferringComponents("xAxis")[0],s=e.getReferringComponents("yAxis")[0];t.coordSysDims=["x","y"],n.set("x",r),n.set("y",s),u(r)&&(i.set("x",r),t.firstCategoryDimIndex=0),u(s)&&(i.set("y",s),t.firstCategoryDimIndex=1)},singleAxis:function(e,t,n,i){var r=e.getReferringComponents("singleAxis")[0];t.coordSysDims=["single"],n.set("single",r),u(r)&&(i.set("single",r),t.firstCategoryDimIndex=0)},polar:function(e,t,n,i){var r=e.getReferringComponents("polar")[0],s=r.findAxisModel("radiusAxis"),a=r.findAxisModel("angleAxis");t.coordSysDims=["radius","angle"],n.set("radius",s),n.set("angle",a),u(s)&&(i.set("radius",s),t.firstCategoryDimIndex=0),u(a)&&(i.set("angle",a),t.firstCategoryDimIndex=1)},geo:function(e,t,n,i){t.coordSysDims=["lng","lat"]},parallel:function(e,t,n,i){var r=e.ecModel,s=r.getComponent("parallel",e.get("parallelIndex")),o=t.coordSysDims=s.dimensions.slice();a(s.parallelAxisIndex,function(e,s){var a=r.getComponent("parallelAxis",e),l=o[s];n.set(l,a),u(a)&&null==t.firstCategoryDimIndex&&(i.set(l,a),t.firstCategoryDimIndex=s)})}};function u(e){return"category"===e.get("type")}t.getCoordSysDefineBySeries=o},"8b97":function(e,t,n){var i=n("d3f4"),r=n("cb7c"),s=function(e,t){if(r(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,i){try{i=n("9b43")(Function.call,n("11e9").f(Object.prototype,"__proto__").set,2),i(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return s(e,n),t?e.__proto__=n:i(e,n),e}}({},!1):void 0),check:s}},"8c00":function(e,t,n){"use strict";var i=n("be09"),r=function(e,t){return void 0===t&&(t=!1),function(n,r,a){if(n)e(n);else if(r.statusCode>=400&&r.statusCode<=599){var o=a;if(t)if(i.TextDecoder){var l=s(r.headers&&r.headers["content-type"]);try{o=new TextDecoder(l).decode(a)}catch(e){}}else o=String.fromCharCode.apply(null,new Uint8Array(a));e({cause:o})}else e(null,a)}};function s(e){return void 0===e&&(e=""),e.toLowerCase().split(";").reduce(function(e,t){var n=t.split("="),i=n[0],r=n[1];return"charset"===i.trim()?r.trim():e},"utf-8")}e.exports=r},"8c2a":function(e,t,n){var i=n("6d8b"),r=n("e0d8"),s=n("3842"),a=n("89e3"),o=r.prototype,l=a.prototype,u=s.getPrecisionSafe,c=s.round,d=Math.floor,h=Math.ceil,f=Math.pow,p=Math.log,g=r.extend({type:"log",base:10,$constructor:function(){r.apply(this,arguments),this._originalScale=new a},getTicks:function(){var e=this._originalScale,t=this._extent,n=e.getExtent();return i.map(l.getTicks.call(this),function(i){var r=s.round(f(this.base,i));return r=i===t[0]&&e.__fixMin?m(r,n[0]):r,r=i===t[1]&&e.__fixMax?m(r,n[1]):r,r},this)},getLabel:l.getLabel,scale:function(e){return e=o.scale.call(this,e),f(this.base,e)},setExtent:function(e,t){var n=this.base;e=p(e)/p(n),t=p(t)/p(n),l.setExtent.call(this,e,t)},getExtent:function(){var e=this.base,t=o.getExtent.call(this);t[0]=f(e,t[0]),t[1]=f(e,t[1]);var n=this._originalScale,i=n.getExtent();return n.__fixMin&&(t[0]=m(t[0],i[0])),n.__fixMax&&(t[1]=m(t[1],i[1])),t},unionExtent:function(e){this._originalScale.unionExtent(e);var t=this.base;e[0]=p(e[0])/p(t),e[1]=p(e[1])/p(t),o.unionExtent.call(this,e)},unionExtentFromData:function(e,t){this.unionExtent(e.getApproximateExtent(t))},niceTicks:function(e){e=e||10;var t=this._extent,n=t[1]-t[0];if(!(n===1/0||n<=0)){var i=s.quantity(n),r=e/n*i;r<=.5&&(i*=10);while(!isNaN(i)&&Math.abs(i)<1&&Math.abs(i)>0)i*=10;var a=[s.round(h(t[0]/i)*i),s.round(d(t[1]/i)*i)];this._interval=i,this._niceExtent=a}},niceExtent:function(e){l.niceExtent.call(this,e);var t=this._originalScale;t.__fixMin=e.fixMin,t.__fixMax=e.fixMax}});function m(e,t){return c(e,u(t))}i.each(["contain","normalize"],function(e){g.prototype[e]=function(t){return t=p(t)/p(this.base),o[e].call(this,t)}}),g.create=function(){return new g};var v=g;e.exports=v},"8d32":function(e,t,n){var i=n("cbe5"),r=i.extend({type:"arc",shape:{cx:0,cy:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},style:{stroke:"#000",fill:null},buildPath:function(e,t){var n=t.cx,i=t.cy,r=Math.max(t.r,0),s=t.startAngle,a=t.endAngle,o=t.clockwise,l=Math.cos(s),u=Math.sin(s);e.moveTo(l*r+n,u*r+i),e.arc(n,i,r,s,a,!o)}});e.exports=r},"8e43":function(e,t,n){var i=n("6d8b"),r=i.createHashMap,s=i.isObject,a=i.map;function o(e){this.categories=e.categories||[],this._needCollect=e.needCollect,this._deduplication=e.deduplication,this._map}o.createByAxisModel=function(e){var t=e.option,n=t.data,i=n&&a(n,c);return new o({categories:i,needCollect:!i,deduplication:!1!==t.dedplication})};var l=o.prototype;function u(e){return e._map||(e._map=r(e.categories))}function c(e){return s(e)&&null!=e.value?e.value:e+""}l.getOrdinal=function(e){return u(this).get(e)},l.parseAndCollect=function(e){var t,n=this._needCollect;if("string"!==typeof e&&!n)return e;if(n&&!this._deduplication)return t=this.categories.length,this.categories[t]=e,t;var i=u(this);return t=i.get(e),null==t&&(n?(t=this.categories.length,this.categories[t]=e,i.set(e,t)):t=NaN),t};var d=o;e.exports=d},"8ec5":function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("2145"),a=i.extendComponentModel({type:"toolbox",layoutMode:{type:"box",ignoreSize:!0},optionUpdated:function(){a.superApply(this,"optionUpdated",arguments),r.each(this.option.feature,function(e,t){var n=s.get(t);n&&r.merge(e,n.defaultOption)})},defaultOption:{show:!0,z:6,zlevel:0,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemSize:15,itemGap:8,showTitle:!0,iconStyle:{borderColor:"#666",color:"none"},emphasis:{iconStyle:{borderColor:"#3E98C5"}}}}),o=a;e.exports=o},"8ed2":function(e,t,n){n("48c7");var i=n("6cb7"),r=i.extend({type:"grid",dependencies:["xAxis","yAxis"],layoutMode:"box",coordinateSystem:null,defaultOption:{show:!1,zlevel:0,z:0,left:"10%",top:60,right:"10%",bottom:60,containLabel:!1,backgroundColor:"rgba(0,0,0,0)",borderWidth:1,borderColor:"#ccc"}});e.exports=r},"903c":function(e,t){function n(e){var t=e.findComponents({mainType:"legend"});t&&t.length&&e.filterSeries(function(e){for(var n=0;n<t.length;n++)if(!t[n].isSelected(e.name))return!1;return!0})}e.exports=n},9093:function(e,t,n){var i=n("ce10"),r=n("e11e").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,r)}},9152:function(e,t){t.read=function(e,t,n,i,r){var s,a,o=8*r-i-1,l=(1<<o)-1,u=l>>1,c=-7,d=n?r-1:0,h=n?-1:1,f=e[t+d];for(d+=h,s=f&(1<<-c)-1,f>>=-c,c+=o;c>0;s=256*s+e[t+d],d+=h,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=i;c>0;a=256*a+e[t+d],d+=h,c-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),s-=u}return(f?-1:1)*a*Math.pow(2,s-i)},t.write=function(e,t,n,i,r,s){var a,o,l,u=8*s-r-1,c=(1<<u)-1,d=c>>1,h=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:s-1,p=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),t+=a+d>=1?h/l:h*Math.pow(2,1-d),t*l>=2&&(a++,l/=2),a+d>=c?(o=0,a=c):a+d>=1?(o=(t*l-1)*Math.pow(2,r),a+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,r),a=0));r>=8;e[n+f]=255&o,f+=p,o/=256,r-=8);for(a=a<<r|o,u+=r;u>0;e[n+f]=255&a,f+=p,a/=256,u-=8);e[n+f-p]|=128*g}},"93d0":function(e,t){var n="original",i="arrayRows",r="objectRows",s="keyedColumns",a="unknown",o="typedArray",l="column",u="row";t.SOURCE_FORMAT_ORIGINAL=n,t.SOURCE_FORMAT_ARRAY_ROWS=i,t.SOURCE_FORMAT_OBJECT_ROWS=r,t.SOURCE_FORMAT_KEYED_COLUMNS=s,t.SOURCE_FORMAT_UNKNOWN=a,t.SOURCE_FORMAT_TYPED_ARRAY=o,t.SERIES_LAYOUT_BY_COLUMN=l,t.SERIES_LAYOUT_BY_ROW=u},"944e":function(e,t,n){var i=n("3842"),r=i.round;function s(e,t,n,s){var o={},u=e[1]-e[0],c=o.interval=i.nice(u/t,!0);null!=n&&c<n&&(c=o.interval=n),null!=s&&c>s&&(c=o.interval=s);var d=o.intervalPrecision=a(c),h=o.niceTickExtent=[r(Math.ceil(e[0]/c)*c,d),r(Math.floor(e[1]/c)*c,d)];return l(h,e),o}function a(e){return i.getPrecisionSafe(e)+2}function o(e,t,n){e[t]=Math.max(Math.min(e[t],n[1]),n[0])}function l(e,t){!isFinite(e[0])&&(e[0]=t[0]),!isFinite(e[1])&&(e[1]=t[1]),o(e,0,t),o(e,1,t),e[0]>e[1]&&(e[0]=e[1])}function u(e,t,n,i){var s=[];if(!e)return s;var a=1e4;t[0]<n[0]&&s.push(t[0]);var o=n[0];while(o<=n[1]){if(s.push(o),o=r(o+e,i),o===s[s.length-1])break;if(s.length>a)return[]}return t[1]>(s.length?s[s.length-1]:n[1])&&s.push(t[1]),s}t.intervalScaleNiceTicks=s,t.getIntervalPrecision=a,t.fixExtent=l,t.intervalScaleGetTicks=u},"94b1":function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("9d57"),a=s.layout,o=s.largeLayout;n("5aa9"),n("17b8"),n("67cc"),n("01ed"),i.registerLayout(r.curry(a,"bar")),i.registerLayout(o),i.registerVisual({seriesType:"bar",reset:function(e){e.getData().setVisual("legendSymbol","roundRect")}})},9680:function(e,t){function n(e,t,n,i,r,s,a){if(0===r)return!1;var o=r,l=0,u=e;if(a>t+o&&a>i+o||a<t-o&&a<i-o||s>e+o&&s>n+o||s<e-o&&s<n-o)return!1;if(e===n)return Math.abs(s-e)<=o/2;l=(t-i)/(e-n),u=(e*i-n*t)/(e-n);var c=l*s-a+u,d=c*c/(l*l+1);return d<=o/2*o/2}t.containStroke=n},"96cf":function(e,t,n){var i=function(e){"use strict";var t,n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"===typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var s=t&&t.prototype instanceof v?t:v,a=Object.create(s.prototype),o=new D(i||[]);return r(a,"_invoke",{value:k(e,n,o)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h="suspendedStart",f="suspendedYield",p="executing",g="completed",m={};function v(){}function y(){}function b(){}var _={};u(_,a,function(){return this});var T=Object.getPrototypeOf,S=T&&T(T(R([])));S&&S!==n&&i.call(S,a)&&(_=S);var w=b.prototype=v.prototype=Object.create(_);function E(e){["next","throw","return"].forEach(function(t){u(e,t,function(e){return this._invoke(t,e)})})}function x(e,t){function n(r,s,a,o){var l=d(e[r],e,s);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"===typeof c&&i.call(c,"__await")?t.resolve(c.__await).then(function(e){n("next",e,a,o)},function(e){n("throw",e,a,o)}):t.resolve(c).then(function(e){u.value=e,a(u)},function(e){return n("throw",e,a,o)})}o(l.arg)}var s;function a(e,i){function r(){return new t(function(t,r){n(e,i,t,r)})}return s=s?s.then(r,r):r()}r(this,"_invoke",{value:a})}function k(e,t,n){var i=h;return function(r,s){if(i===p)throw new Error("Generator is already running");if(i===g){if("throw"===r)throw s;return M()}n.method=r,n.arg=s;while(1){var a=n.delegate;if(a){var o=A(a,n);if(o){if(o===m)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var l=d(e,t,n);if("normal"===l.type){if(i=n.done?g:f,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=g,n.method="throw",n.arg=l.arg)}}}function A(e,n){var i=n.method,r=e.iterator[i];if(r===t)return n.delegate=null,"throw"===i&&e.iterator["return"]&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)?m:("return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m);var s=d(r,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,m;var a=s.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function R(e){if(null!=e){var n=e[a];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function n(){while(++r<e.length)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}throw new TypeError(typeof e+" is not iterable")}function M(){return{value:t,done:!0}}return y.prototype=b,r(w,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:y,configurable:!0}),y.displayName=u(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u(e,l,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},E(x.prototype),u(x.prototype,o,function(){return this}),e.AsyncIterator=x,e.async=function(t,n,i,r,s){void 0===s&&(s=Promise);var a=new x(c(t,n,i,r),s);return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},E(w),u(w,l,"Generator"),u(w,a,function(){return this}),u(w,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){while(n.length){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=R,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return o.type="throw",o.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:R(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=i}catch(e){"object"===typeof globalThis?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},9850:function(e,t,n){var i=n("401b"),r=n("1687"),s=i.applyTransform,a=Math.min,o=Math.max;function l(e,t,n,i){n<0&&(e+=n,n=-n),i<0&&(t+=i,i=-i),this.x=e,this.y=t,this.width=n,this.height=i}l.prototype={constructor:l,union:function(e){var t=a(e.x,this.x),n=a(e.y,this.y);this.width=o(e.x+e.width,this.x+this.width)-t,this.height=o(e.y+e.height,this.y+this.height)-n,this.x=t,this.y=n},applyTransform:function(){var e=[],t=[],n=[],i=[];return function(r){if(r){e[0]=n[0]=this.x,e[1]=i[1]=this.y,t[0]=i[0]=this.x+this.width,t[1]=n[1]=this.y+this.height,s(e,e,r),s(t,t,r),s(n,n,r),s(i,i,r),this.x=a(e[0],t[0],n[0],i[0]),this.y=a(e[1],t[1],n[1],i[1]);var l=o(e[0],t[0],n[0],i[0]),u=o(e[1],t[1],n[1],i[1]);this.width=l-this.x,this.height=u-this.y}}}(),calculateTransform:function(e){var t=this,n=e.width/t.width,i=e.height/t.height,s=r.create();return r.translate(s,s,[-t.x,-t.y]),r.scale(s,s,[n,i]),r.translate(s,s,[e.x,e.y]),s},intersect:function(e){if(!e)return!1;e instanceof l||(e=l.create(e));var t=this,n=t.x,i=t.x+t.width,r=t.y,s=t.y+t.height,a=e.x,o=e.x+e.width,u=e.y,c=e.y+e.height;return!(i<a||o<n||s<u||c<r)},contain:function(e,t){var n=this;return e>=n.x&&e<=n.x+n.width&&t>=n.y&&t<=n.y+n.height},clone:function(){return new l(this.x,this.y,this.width,this.height)},copy:function(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},l.create=function(e){return new l(e.x,e.y,e.width,e.height)};var u=l;e.exports=u},"98b7":function(e,t){var n="undefined"!==typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){setTimeout(e,16)};e.exports=n},"998c":function(e,t,n){var i=n("6d8b"),r=n("2306"),s=Math.PI;function a(e,t){t=t||{},i.defaults(t,{text:"loading",color:"#c23531",textColor:"#000",maskColor:"rgba(255, 255, 255, 0.8)",zlevel:0});var n=new r.Rect({style:{fill:t.maskColor},zlevel:t.zlevel,z:1e4}),a=new r.Arc({shape:{startAngle:-s/2,endAngle:-s/2+.1,r:10},style:{stroke:t.color,lineCap:"round",lineWidth:5},zlevel:t.zlevel,z:10001}),o=new r.Rect({style:{fill:"none",text:t.text,textPosition:"right",textDistance:10,textFill:t.textColor},zlevel:t.zlevel,z:10001});a.animateShape(!0).when(1e3,{endAngle:3*s/2}).start("circularInOut"),a.animateShape(!0).when(1e3,{startAngle:3*s/2}).delay(300).start("circularInOut");var l=new r.Group;return l.add(a),l.add(o),l.add(n),l.resize=function(){var t=e.getWidth()/2,i=e.getHeight()/2;a.setShape({cx:t,cy:i});var r=a.shape.r;o.setShape({x:t-r,y:i-r,width:2*r,height:2*r}),n.setShape({x:0,y:0,width:e.getWidth(),height:e.getHeight()})},l.resize(),l}e.exports=a},"9b43":function(e,t,n){var i=n("d8e8");e.exports=function(e,t,n){if(i(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)}}return function(){return e.apply(t,arguments)}}},"9bdb":function(e,t,n){var i=n("282b"),r=i([["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]]),s={getAreaStyle:function(e,t){return r(this,e,t)}};e.exports=s},"9c2c":function(e,t,n){var i=n("401b"),r=i.min,s=i.max,a=i.scale,o=i.distance,l=i.add,u=i.clone,c=i.sub;function d(e,t,n,i){var d,h,f,p,g=[],m=[],v=[],y=[];if(i){f=[1/0,1/0],p=[-1/0,-1/0];for(var b=0,_=e.length;b<_;b++)r(f,f,e[b]),s(p,p,e[b]);r(f,f,i[0]),s(p,p,i[1])}for(b=0,_=e.length;b<_;b++){var T=e[b];if(n)d=e[b?b-1:_-1],h=e[(b+1)%_];else{if(0===b||b===_-1){g.push(u(e[b]));continue}d=e[b-1],h=e[b+1]}c(m,h,d),a(m,m,t);var S=o(T,d),w=o(T,h),E=S+w;0!==E&&(S/=E,w/=E),a(v,m,-S),a(y,m,w);var x=l([],T,v),k=l([],T,y);i&&(s(x,x,f),r(x,x,p),s(k,k,f),r(k,k,p)),g.push(x),g.push(k)}return n&&g.push(g.shift()),g}e.exports=d},"9c6c":function(e,t,n){var i=n("2b4c")("unscopables"),r=Array.prototype;void 0==r[i]&&n("32e9")(r,i,{}),e.exports=function(e){r[i][e]=!0}},"9c80":function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},"9d57":function(e,t,n){var i=n("6d8b"),r=n("3842"),s=r.parsePercent,a=n("ee1a"),o=a.isDimensionStacked,l=n("cccd"),u="__ec_stack_",c=.5,d="undefined"!==typeof Float32Array?Float32Array:Array;function h(e){return e.get("stack")||u+e.seriesIndex}function f(e){return e.dim+e.index}function p(e){var t=[],n=e.axis,r="axis0";if("category"===n.type){for(var s=n.getBandWidth(),a=0;a<e.count;a++)t.push(i.defaults({bandWidth:s,axisKey:r,stackId:u+a},e));var o=v(t),l=[];for(a=0;a<e.count;a++){var c=o[r][u+a];c.offsetCenter=c.offset+c.width/2,l.push(c)}return l}}function g(e,t){var n=[];return t.eachSeriesByType(e,function(e){T(e)&&!S(e)&&n.push(e)}),n}function m(e){var t=[];return i.each(e,function(e){var n=e.getData(),i=e.coordinateSystem,r=i.getBaseAxis(),a=r.getExtent(),o="category"===r.type?r.getBandWidth():Math.abs(a[1]-a[0])/n.count(),l=s(e.get("barWidth"),o),u=s(e.get("barMaxWidth"),o),c=e.get("barGap"),d=e.get("barCategoryGap");t.push({bandWidth:o,barWidth:l,barMaxWidth:u,barGap:c,barCategoryGap:d,axisKey:f(r),stackId:h(e)})}),v(t)}function v(e){var t={};i.each(e,function(e,n){var i=e.axisKey,r=e.bandWidth,s=t[i]||{bandWidth:r,remainedWidth:r,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},a=s.stacks;t[i]=s;var o=e.stackId;a[o]||s.autoWidthCount++,a[o]=a[o]||{width:0,maxWidth:0};var l=e.barWidth;l&&!a[o].width&&(a[o].width=l,l=Math.min(s.remainedWidth,l),s.remainedWidth-=l);var u=e.barMaxWidth;u&&(a[o].maxWidth=u);var c=e.barGap;null!=c&&(s.gap=c);var d=e.barCategoryGap;null!=d&&(s.categoryGap=d)});var n={};return i.each(t,function(e,t){n[t]={};var r=e.stacks,a=e.bandWidth,o=s(e.categoryGap,a),l=s(e.gap,1),u=e.remainedWidth,c=e.autoWidthCount,d=(u-o)/(c+(c-1)*l);d=Math.max(d,0),i.each(r,function(e,t){var n=e.maxWidth;n&&n<d&&(n=Math.min(n,u),e.width&&(n=Math.min(n,e.width)),u-=n,e.width=n,c--)}),d=(u-o)/(c+(c-1)*l),d=Math.max(d,0);var h,f=0;i.each(r,function(e,t){e.width||(e.width=d),h=e,f+=e.width*(1+l)}),h&&(f-=h.width*l);var p=-f/2;i.each(r,function(e,i){n[t][i]=n[t][i]||{offset:p,width:e.width},p+=e.width*(1+l)})}),n}function y(e,t,n){if(e&&t){var i=e[f(t)];return null!=i&&null!=n&&(i=i[h(n)]),i}}function b(e,t){var n=g(e,t),r=m(n),s={},a={};i.each(n,function(e){var t=e.getData(),n=e.coordinateSystem,i=n.getBaseAxis(),l=h(e),u=r[f(i)][l],c=u.offset,d=u.width,p=n.getOtherAxis(i),g=e.get("barMinHeight")||0;s[l]=s[l]||[],a[l]=a[l]||[],t.setLayout({offset:c,size:d});for(var m=t.mapDimension(p.dim),v=t.mapDimension(i.dim),y=o(t,m),b=p.isHorizontal(),_=w(i,p,y),T=0,S=t.count();T<S;T++){var E=t.get(m,T),x=t.get(v,T);if(!isNaN(E)){var k,A,I,C,D=E>=0?"p":"n",R=_;if(y&&(s[l][x]||(s[l][x]={p:_,n:_}),R=s[l][x][D]),b){var M=n.dataToPoint([E,x]);k=R,A=M[1]+c,I=M[0]-_,C=d,Math.abs(I)<g&&(I=(I<0?-1:1)*g),y&&(s[l][x][D]+=I)}else{M=n.dataToPoint([x,E]);k=M[0]+c,A=R,I=d,C=M[1]-_,Math.abs(C)<g&&(C=(C<=0?-1:1)*g),y&&(s[l][x][D]+=C)}t.setItemLayout(T,{x:k,y:A,width:I,height:C})}}},this)}var _={seriesType:"bar",plan:l(),reset:function(e){if(T(e)&&S(e)){var t=e.getData(),n=e.coordinateSystem,i=n.getBaseAxis(),r=n.getOtherAxis(i),s=t.mapDimension(r.dim),a=t.mapDimension(i.dim),o=r.isHorizontal(),l=o?0:1,u=y(m([e]),i,e).width;return u>c||(u=c),{progress:h}}function h(e,t){var c,h=new d(2*e.count),f=[],p=[],g=0;while(null!=(c=e.next()))p[l]=t.get(s,c),p[1-l]=t.get(a,c),f=n.dataToPoint(p,null,f),h[g++]=f[0],h[g++]=f[1];t.setLayout({largePoints:h,barWidth:u,valueAxisStart:w(i,r,!1),valueAxisHorizontal:o})}}};function T(e){return e.coordinateSystem&&"cartesian2d"===e.coordinateSystem.type}function S(e){return e.pipelineContext&&e.pipelineContext.large}function w(e,t,n){return i.indexOf(e.getAxesOnZeroOf(),t)>=0||n?t.toGlobalCoord(t.dataToCoord(0)):t.getGlobalExtent()[0]}t.getLayoutOnAxis=p,t.prepareLayoutBarSeries=g,t.makeColumnLayout=m,t.retrieveColumnLayout=y,t.layout=b,t.largeLayout=_},"9def":function(e,t,n){var i=n("4588"),r=Math.min;e.exports=function(e){return e>0?r(i(e),9007199254740991):0}},"9e1e":function(e,t,n){e.exports=!n("79e5")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},"9e2e":function(e,t,n){var i=n("a73c"),r=n("9850"),s=new r,a=function(){};a.prototype={constructor:a,drawRectText:function(e,t){var n=this.style;t=n.textRect||t,this.__dirty&&i.normalizeTextStyle(n,!0);var r=n.text;if(null!=r&&(r+=""),i.needDrawText(r,n)){e.save();var a=this.transform;n.transformText?this.setTransform(e):a&&(s.copy(t),s.applyTransform(a),t=s),i.renderText(this,e,r,n,t),e.restore()}}};var o=a;e.exports=o},"9e47":function(e,t,n){var i=n("6d8b"),r=n("71ad"),s=n("6cb7"),a=n("f934"),o=a.getLayoutParams,l=a.mergeLayoutParam,u=n("8e43"),c=["value","category","time","log"];function d(e,t,n,a){i.each(c,function(s){t.extend({type:e+"Axis."+s,mergeDefaultAndTheme:function(t,r){var a=this.layoutMode,u=a?o(t):{},c=r.getTheme();i.merge(t,c.get(s+"Axis")),i.merge(t,this.getDefaultOption()),t.type=n(e,t),a&&l(t,u,a)},optionUpdated:function(){var e=this.option;"category"===e.type&&(this.__ordinalMeta=u.createByAxisModel(this))},getCategories:function(e){var t=this.option;if("category"===t.type)return e?t.data:this.__ordinalMeta.categories},getOrdinalMeta:function(){return this.__ordinalMeta},defaultOption:i.mergeAll([{},r[s+"Axis"],a],!0)})}),s.registerSubTypeDefaulter(e+"Axis",i.curry(n,e))}e.exports=d},"9e87":function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("50e5");i.registerAction("dataZoom",function(e,t){var n=s.createLinkedNodesFinder(r.bind(t.eachComponent,t,"dataZoom"),s.eachAxisDim,function(e,t){return e.get(t.axisIndex)}),i=[];t.eachComponent({mainType:"dataZoom",query:e},function(e,t){i.push.apply(i,n(e).nodes)}),r.each(i,function(t,n){t.setRawRange({start:e.start,end:e.end,startValue:e.startValue,endValue:e.endValue})})})},"9f51":function(e,t,n){var i=n("857d"),r=i.normalizeRadian,s=2*Math.PI;function a(e,t,n,i,a,o,l,u,c){if(0===l)return!1;var d=l;u-=e,c-=t;var h=Math.sqrt(u*u+c*c);if(h-d>n||h+d<n)return!1;if(Math.abs(i-a)%s<1e-4)return!0;if(o){var f=i;i=r(a),a=r(f)}else i=r(i),a=r(a);i>a&&(a+=s);var p=Math.atan2(c,u);return p<0&&(p+=s),p>=i&&p<=a||p+s>=i&&p+s<=a}t.containStroke=a},"9f82":function(e,t,n){var i=n("ee1a"),r=i.isDimensionStacked,s=n("6d8b"),a=s.map;function o(e,t,n){var i,s=e.getBaseAxis(),o=e.getOtherAxis(s),u=l(o,n),c=s.dim,d=o.dim,h=t.mapDimension(d),f=t.mapDimension(c),p="x"===d||"radius"===d?1:0,g=a(e.dimensions,function(e){return t.mapDimension(e)}),m=t.getCalculationInfo("stackResultDimension");return(i|=r(t,g[0]))&&(g[0]=m),(i|=r(t,g[1]))&&(g[1]=m),{dataDimsForPoint:g,valueStart:u,valueAxisDim:d,baseAxisDim:c,stacked:!!i,valueDim:h,baseDim:f,baseDataOffset:p,stackedOverDimension:t.getCalculationInfo("stackedOverDimension")}}function l(e,t){var n=0,i=e.scale.getExtent();return"start"===t?n=i[0]:"end"===t?n=i[1]:i[0]>0?n=i[0]:i[1]<0&&(n=i[1]),n}function u(e,t,n,i){var r=NaN;e.stacked&&(r=n.get(n.getCalculationInfo("stackedOverDimension"),i)),isNaN(r)&&(r=e.valueStart);var s=e.baseDataOffset,a=[];return a[s]=n.get(e.baseDim,i),a[1-s]=r,t.dataToPoint(a)}t.prepareDataCoordInfo=o,t.getStackedOnPoint=u},a15a:function(e,t,n){var i=n("6d8b"),r=n("2306"),s=n("9850"),a=r.extendShape({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(e,t){var n=t.cx,i=t.cy,r=t.width/2,s=t.height/2;e.moveTo(n,i-s),e.lineTo(n+r,i+s),e.lineTo(n-r,i+s),e.closePath()}}),o=r.extendShape({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(e,t){var n=t.cx,i=t.cy,r=t.width/2,s=t.height/2;e.moveTo(n,i-s),e.lineTo(n+r,i),e.lineTo(n,i+s),e.lineTo(n-r,i),e.closePath()}}),l=r.extendShape({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var n=t.x,i=t.y,r=t.width/5*3,s=Math.max(r,t.height),a=r/2,o=a*a/(s-a),l=i-s+a+o,u=Math.asin(o/a),c=Math.cos(u)*a,d=Math.sin(u),h=Math.cos(u),f=.6*a,p=.7*a;e.moveTo(n-c,l+o),e.arc(n,l,a,Math.PI-u,2*Math.PI+u),e.bezierCurveTo(n+c-d*f,l+o+h*f,n,i-p,n,i),e.bezierCurveTo(n,i-p,n-c+d*f,l+o+h*f,n-c,l+o),e.closePath()}}),u=r.extendShape({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var n=t.height,i=t.width,r=t.x,s=t.y,a=i/3*2;e.moveTo(r,s),e.lineTo(r+a,s+n),e.lineTo(r,s+n/4*3),e.lineTo(r-a,s+n),e.lineTo(r,s),e.closePath()}}),c={line:r.Line,rect:r.Rect,roundRect:r.Rect,square:r.Rect,circle:r.Circle,diamond:o,pin:l,arrow:u,triangle:a},d={line:function(e,t,n,i,r){r.x1=e,r.y1=t+i/2,r.x2=e+n,r.y2=t+i/2},rect:function(e,t,n,i,r){r.x=e,r.y=t,r.width=n,r.height=i},roundRect:function(e,t,n,i,r){r.x=e,r.y=t,r.width=n,r.height=i,r.r=Math.min(n,i)/4},square:function(e,t,n,i,r){var s=Math.min(n,i);r.x=e,r.y=t,r.width=s,r.height=s},circle:function(e,t,n,i,r){r.cx=e+n/2,r.cy=t+i/2,r.r=Math.min(n,i)/2},diamond:function(e,t,n,i,r){r.cx=e+n/2,r.cy=t+i/2,r.width=n,r.height=i},pin:function(e,t,n,i,r){r.x=e+n/2,r.y=t+i/2,r.width=n,r.height=i},arrow:function(e,t,n,i,r){r.x=e+n/2,r.y=t+i/2,r.width=n,r.height=i},triangle:function(e,t,n,i,r){r.cx=e+n/2,r.cy=t+i/2,r.width=n,r.height=i}},h={};i.each(c,function(e,t){h[t]=new e});var f=r.extendShape({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},beforeBrush:function(){var e=this.style,t=this.shape;"pin"===t.symbolType&&"inside"===e.textPosition&&(e.textPosition=["50%","40%"],e.textAlign="center",e.textVerticalAlign="middle")},buildPath:function(e,t,n){var i=t.symbolType,r=h[i];"none"!==t.symbolType&&(r||(i="rect",r=h[i]),d[i](t.x,t.y,t.width,t.height,r.shape),r.buildPath(e,r.shape,n))}});function p(e,t){if("image"!==this.type){var n=this.style,i=this.shape;i&&"line"===i.symbolType?n.stroke=e:this.__isEmptyBrush?(n.stroke=e,n.fill=t||"#fff"):(n.fill&&(n.fill=e),n.stroke&&(n.stroke=e)),this.dirty(!1)}}function g(e,t,n,i,a,o,l){var u,c=0===e.indexOf("empty");return c&&(e=e.substr(5,1).toLowerCase()+e.substr(6)),u=0===e.indexOf("image://")?r.makeImage(e.slice(8),new s(t,n,i,a),l?"center":"cover"):0===e.indexOf("path://")?r.makePath(e.slice(7),{},new s(t,n,i,a),l?"center":"cover"):new f({shape:{symbolType:e,x:t,y:n,width:i,height:a}}),u.__isEmptyBrush=c,u.setColor=p,u.setColor(o),u}t.createSymbol=g},a25f:function(e,t,n){var i=n("7726"),r=i.navigator;e.exports=r&&r.userAgent||""},a481:function(e,t,n){n("214f")("replace",2,function(e,t,n){return[function(i,r){"use strict";var s=e(this),a=void 0==i?void 0:i[t];return void 0!==a?a.call(i,s,r):n.call(String(s),i,r)},n]})},a4fe:function(e,t,n){var i=n("3eba"),r="\0_ec_interaction_mutex";function s(e,t,n){var i=l(e);i[t]=n}function a(e,t,n){var i=l(e),r=i[t];r===n&&(i[t]=null)}function o(e,t){return!!l(e)[t]}function l(e){return e[r]||(e[r]={})}i.registerAction({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},function(){}),t.take=s,t.release=a,t.isTaken=o},a567:function(e,t,n){"use strict";function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}n.d(t,"a",function(){return kl});var r={exports:{}};(function(e,t){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),t=t.trim(),!t){if(!n.alwaysNormalize)return e;var r=a.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=a.normalizePath(r.path),a.buildURLFromParts(r)}var s=a.parseURL(t);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return n.alwaysNormalize?(s.path=a.normalizePath(s.path),a.buildURLFromParts(s)):t;var o=a.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(u.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+s.path;u.path=a.normalizePath(d)}else u.path=o.path,s.params||(u.params=o.params,s.query||(u.query=o.query));return null===u.path&&(u.path=n.alwaysNormalize?a.normalizePath(s.path):s.path),a.buildURLFromParts(u)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){e=e.split("").reverse().join("").replace(r,"");while(e.length!==(e=e.replace(s,"")).length);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=a})()})(r);var s=r.exports;function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function u(e){var t=l(e,"string");return"symbol"==typeof t?t:String(t)}function c(e,t,n){return t=u(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},d.apply(this,arguments)}const h=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},f=Number.isSafeInteger||function(e){return"number"===typeof e&&Math.abs(e)<=p},p=Number.MAX_SAFE_INTEGER||9007199254740991;let g=function(e){return e["MEDIA_ATTACHING"]="hlsMediaAttaching",e["MEDIA_ATTACHED"]="hlsMediaAttached",e["MEDIA_DETACHING"]="hlsMediaDetaching",e["MEDIA_DETACHED"]="hlsMediaDetached",e["BUFFER_RESET"]="hlsBufferReset",e["BUFFER_CODECS"]="hlsBufferCodecs",e["BUFFER_CREATED"]="hlsBufferCreated",e["BUFFER_APPENDING"]="hlsBufferAppending",e["BUFFER_APPENDED"]="hlsBufferAppended",e["BUFFER_EOS"]="hlsBufferEos",e["BUFFER_FLUSHING"]="hlsBufferFlushing",e["BUFFER_FLUSHED"]="hlsBufferFlushed",e["MANIFEST_LOADING"]="hlsManifestLoading",e["MANIFEST_LOADED"]="hlsManifestLoaded",e["MANIFEST_PARSED"]="hlsManifestParsed",e["LEVEL_SWITCHING"]="hlsLevelSwitching",e["LEVEL_SWITCHED"]="hlsLevelSwitched",e["LEVEL_LOADING"]="hlsLevelLoading",e["LEVEL_LOADED"]="hlsLevelLoaded",e["LEVEL_UPDATED"]="hlsLevelUpdated",e["LEVEL_PTS_UPDATED"]="hlsLevelPtsUpdated",e["LEVELS_UPDATED"]="hlsLevelsUpdated",e["AUDIO_TRACKS_UPDATED"]="hlsAudioTracksUpdated",e["AUDIO_TRACK_SWITCHING"]="hlsAudioTrackSwitching",e["AUDIO_TRACK_SWITCHED"]="hlsAudioTrackSwitched",e["AUDIO_TRACK_LOADING"]="hlsAudioTrackLoading",e["AUDIO_TRACK_LOADED"]="hlsAudioTrackLoaded",e["SUBTITLE_TRACKS_UPDATED"]="hlsSubtitleTracksUpdated",e["SUBTITLE_TRACKS_CLEARED"]="hlsSubtitleTracksCleared",e["SUBTITLE_TRACK_SWITCH"]="hlsSubtitleTrackSwitch",e["SUBTITLE_TRACK_LOADING"]="hlsSubtitleTrackLoading",e["SUBTITLE_TRACK_LOADED"]="hlsSubtitleTrackLoaded",e["SUBTITLE_FRAG_PROCESSED"]="hlsSubtitleFragProcessed",e["CUES_PARSED"]="hlsCuesParsed",e["NON_NATIVE_TEXT_TRACKS_FOUND"]="hlsNonNativeTextTracksFound",e["INIT_PTS_FOUND"]="hlsInitPtsFound",e["FRAG_LOADING"]="hlsFragLoading",e["FRAG_LOAD_EMERGENCY_ABORTED"]="hlsFragLoadEmergencyAborted",e["FRAG_LOADED"]="hlsFragLoaded",e["FRAG_DECRYPTED"]="hlsFragDecrypted",e["FRAG_PARSING_INIT_SEGMENT"]="hlsFragParsingInitSegment",e["FRAG_PARSING_USERDATA"]="hlsFragParsingUserdata",e["FRAG_PARSING_METADATA"]="hlsFragParsingMetadata",e["FRAG_PARSED"]="hlsFragParsed",e["FRAG_BUFFERED"]="hlsFragBuffered",e["FRAG_CHANGED"]="hlsFragChanged",e["FPS_DROP"]="hlsFpsDrop",e["FPS_DROP_LEVEL_CAPPING"]="hlsFpsDropLevelCapping",e["MAX_AUTO_LEVEL_UPDATED"]="hlsMaxAutoLevelUpdated",e["ERROR"]="hlsError",e["DESTROYING"]="hlsDestroying",e["KEY_LOADING"]="hlsKeyLoading",e["KEY_LOADED"]="hlsKeyLoaded",e["LIVE_BACK_BUFFER_REACHED"]="hlsLiveBackBufferReached",e["BACK_BUFFER_REACHED"]="hlsBackBufferReached",e["STEERING_MANIFEST_LOADED"]="hlsSteeringManifestLoaded",e}({}),m=function(e){return e["NETWORK_ERROR"]="networkError",e["MEDIA_ERROR"]="mediaError",e["KEY_SYSTEM_ERROR"]="keySystemError",e["MUX_ERROR"]="muxError",e["OTHER_ERROR"]="otherError",e}({}),v=function(e){return e["KEY_SYSTEM_NO_KEYS"]="keySystemNoKeys",e["KEY_SYSTEM_NO_ACCESS"]="keySystemNoAccess",e["KEY_SYSTEM_NO_SESSION"]="keySystemNoSession",e["KEY_SYSTEM_NO_CONFIGURED_LICENSE"]="keySystemNoConfiguredLicense",e["KEY_SYSTEM_LICENSE_REQUEST_FAILED"]="keySystemLicenseRequestFailed",e["KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED"]="keySystemServerCertificateRequestFailed",e["KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED"]="keySystemServerCertificateUpdateFailed",e["KEY_SYSTEM_SESSION_UPDATE_FAILED"]="keySystemSessionUpdateFailed",e["KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED"]="keySystemStatusOutputRestricted",e["KEY_SYSTEM_STATUS_INTERNAL_ERROR"]="keySystemStatusInternalError",e["MANIFEST_LOAD_ERROR"]="manifestLoadError",e["MANIFEST_LOAD_TIMEOUT"]="manifestLoadTimeOut",e["MANIFEST_PARSING_ERROR"]="manifestParsingError",e["MANIFEST_INCOMPATIBLE_CODECS_ERROR"]="manifestIncompatibleCodecsError",e["LEVEL_EMPTY_ERROR"]="levelEmptyError",e["LEVEL_LOAD_ERROR"]="levelLoadError",e["LEVEL_LOAD_TIMEOUT"]="levelLoadTimeOut",e["LEVEL_PARSING_ERROR"]="levelParsingError",e["LEVEL_SWITCH_ERROR"]="levelSwitchError",e["AUDIO_TRACK_LOAD_ERROR"]="audioTrackLoadError",e["AUDIO_TRACK_LOAD_TIMEOUT"]="audioTrackLoadTimeOut",e["SUBTITLE_LOAD_ERROR"]="subtitleTrackLoadError",e["SUBTITLE_TRACK_LOAD_TIMEOUT"]="subtitleTrackLoadTimeOut",e["FRAG_LOAD_ERROR"]="fragLoadError",e["FRAG_LOAD_TIMEOUT"]="fragLoadTimeOut",e["FRAG_DECRYPT_ERROR"]="fragDecryptError",e["FRAG_PARSING_ERROR"]="fragParsingError",e["FRAG_GAP"]="fragGap",e["REMUX_ALLOC_ERROR"]="remuxAllocError",e["KEY_LOAD_ERROR"]="keyLoadError",e["KEY_LOAD_TIMEOUT"]="keyLoadTimeOut",e["BUFFER_ADD_CODEC_ERROR"]="bufferAddCodecError",e["BUFFER_INCOMPATIBLE_CODECS_ERROR"]="bufferIncompatibleCodecsError",e["BUFFER_APPEND_ERROR"]="bufferAppendError",e["BUFFER_APPENDING_ERROR"]="bufferAppendingError",e["BUFFER_STALLED_ERROR"]="bufferStalledError",e["BUFFER_FULL_ERROR"]="bufferFullError",e["BUFFER_SEEK_OVER_HOLE"]="bufferSeekOverHole",e["BUFFER_NUDGE_ON_STALL"]="bufferNudgeOnStall",e["INTERNAL_EXCEPTION"]="internalException",e["INTERNAL_ABORTED"]="aborted",e["UNKNOWN"]="unknown",e}({});const y=function(){},b={trace:y,debug:y,log:y,warn:y,info:y,error:y};let _=b;function T(e){const t=self.console[e];return t?t.bind(self.console,`[${e}] >`):y}function S(e,...t){t.forEach(function(t){_[t]=e[t]?e[t].bind(e):T(t)})}function w(e,t){if("object"===typeof console&&!0===e||"object"===typeof e){S(e,"debug","log","info","warn","error");try{_.log(`Debug logs enabled for "${t}" in hls.js version 1.5.14`)}catch(e){_=b}}else _=b}const E=_,x=/^(\d+)x(\d+)$/,k=/(.+?)=(".*?"|.*?)(?:,|$)/g;class A{constructor(e){"string"===typeof e&&(e=A.parseAttrList(e)),d(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const n=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)n[e]=parseInt(t.slice(2*e,2*e+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}bool(e){return"YES"===this[e]}decimalResolution(e){const t=x.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const n={},i='"';k.lastIndex=0;while(null!==(t=k.exec(e))){let e=t[2];0===e.indexOf(i)&&e.lastIndexOf(i)===e.length-1&&(e=e.slice(1,-1));const r=t[1].trim();n[r]=e}return n}}function I(e){return"ID"!==e&&"CLASS"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function C(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}class D{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const n=t.attr;for(const t in n)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==n[t]){E.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=d(new A({}),n,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=new Date(this.attr["END-DATE"]);h(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(h(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&h(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class R{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var M={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class L{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[M.AUDIO]:null,[M.VIDEO]:null,[M.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const n=e.split("@",2);let i;i=1===n.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=s.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class P extends L{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new R,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!h(this.programDateTime))return null;const e=h(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,n,i,r,s=!1){const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,r)):a[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:r,partial:s}}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[M.AUDIO]=null,e[M.VIDEO]=null,e[M.AUDIOVIDEO]=null}}class O extends L{constructor(e,t,n,i,r){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new R,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const s=e.enumeratedString("BYTERANGE");s&&this.setByteRange(s,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const N=10;class U{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&h(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||N}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){const t=this.driftEnd-this.driftStart;return 1e3*t/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function F(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function B(e){const t=H(e).subarray(0,16),n=new Uint8Array(16);return n.set(t,16-t.length),n}function j(e){const t=function(e,t,n){const i=e[t];e[t]=e[n],e[n]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function V(e){const t=e.split(":");let n=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){const t="base64"===i[0],r=i[1];t?(e.splice(-1,1),n=F(r)):n=B(r)}}return n}function H(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}const $="undefined"!==typeof self?self:void 0;var G={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},z={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function q(e){switch(e){case z.FAIRPLAY:return G.FAIRPLAY;case z.PLAYREADY:return G.PLAYREADY;case z.WIDEVINE:return G.WIDEVINE;case z.CLEARKEY:return G.CLEARKEY}}var W={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function K(e){if(e===W.WIDEVINE)return G.WIDEVINE}function Y(e){switch(e){case G.FAIRPLAY:return z.FAIRPLAY;case G.PLAYREADY:return z.PLAYREADY;case G.WIDEVINE:return z.WIDEVINE;case G.CLEARKEY:return z.CLEARKEY}}function X(e){const{drmSystems:t,widevineLicenseUrl:n}=e,i=t?[G.FAIRPLAY,G.WIDEVINE,G.PLAYREADY,G.CLEARKEY].filter(e=>!!t[e]):[];return!i[G.WIDEVINE]&&n&&i.push(G.WIDEVINE),i}const Q=function(e){return null!=$&&null!=(e=$.navigator)&&e.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Z(e,t,n,i){let r;switch(e){case G.FAIRPLAY:r=["cenc","sinf"];break;case G.WIDEVINE:case G.PLAYREADY:r=["cenc"];break;case G.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return J(r,t,n,i)}function J(e,t,n,i){const r={initDataTypes:e,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:`audio/mp4; codecs="${e}"`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:n.map(e=>({contentType:`video/mp4; codecs="${e}"`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))};return[r]}function ee(e,t,n){return Uint8Array.prototype.slice?e.slice(t,n):new Uint8Array(Array.prototype.slice.call(e,t,n))}const te=(e,t)=>{return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},ne=(e,t)=>{return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},ie=(e,t)=>{const n=t;let i=0;while(te(e,t)){i+=10;const n=re(e,t+6);i+=n,ne(e,t+10)&&(i+=10),t+=i}if(i>0)return e.subarray(n,n+i)},re=(e,t)=>{let n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3],n},se=(e,t)=>{return te(e,t)&&re(e,t+6)+10<=e.length-t},ae=e=>{const t=ue(e);for(let n=0;n<t.length;n++){const e=t[n];if(oe(e))return pe(e)}},oe=e=>{return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},le=e=>{const t=String.fromCharCode(e[0],e[1],e[2],e[3]),n=re(e,4),i=10;return{type:t,size:n,data:e.subarray(i,i+n)}},ue=e=>{let t=0;const n=[];while(te(e,t)){const i=re(e,t+6);t+=10;const r=t+i;while(t+8<r){const i=le(e.subarray(t)),r=ce(i);r&&n.push(r),t+=i.size+10}ne(e,t)&&(t+=10)}return n},ce=e=>{return"PRIV"===e.type?de(e):"W"===e.type[0]?fe(e):he(e)},de=e=>{if(e.size<2)return;const t=ge(e.data,!0),n=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:n.buffer}},he=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1;const n=ge(e.data.subarray(t),!0);t+=n.length+1;const i=ge(e.data.subarray(t));return{key:e.type,info:n,data:i}}const t=ge(e.data.subarray(1));return{key:e.type,data:t}},fe=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1;const n=ge(e.data.subarray(t),!0);t+=n.length+1;const i=ge(e.data.subarray(t));return{key:e.type,info:n,data:i}}const t=ge(e.data);return{key:e.type,data:t}},pe=e=>{if(8===e.data.byteLength){const t=new Uint8Array(e.data),n=1&t[3];let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,n&&(i+=47721858.84),Math.round(i)}},ge=(e,t=!1)=>{const n=ve();if(n){const i=n.decode(e);if(t){const e=i.indexOf("\0");return-1!==e?i.substring(0,e):i}return i.replace(/\0/g,"")}const i=e.length;let r,s,a,o="",l=0;while(l<i){if(r=e[l++],0===r&&t)return o;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:s=e[l++],o+=String.fromCharCode((31&r)<<6|63&s);break;case 14:s=e[l++],a=e[l++],o+=String.fromCharCode((15&r)<<12|(63&s)<<6|(63&a)<<0);break}}return o};let me;function ve(){if(!navigator.userAgent.includes("PlayStation 4"))return me||"undefined"===typeof self.TextDecoder||(me=new self.TextDecoder("utf-8")),me}const ye={hexDump:function(e){let t="";for(let n=0;n<e.length;n++){let i=e[n].toString(16);i.length<2&&(i="0"+i),t+=i}return t}},be=Math.pow(2,32)-1,_e=[].push,Te={video:1,audio:2,id3:3,text:4};function Se(e){return String.fromCharCode.apply(null,e)}function we(e,t){const n=e[t]<<8|e[t+1];return n<0?65536+n:n}function Ee(e,t){const n=ke(e,t);return n<0?4294967296+n:n}function xe(e,t){let n=Ee(e,t);return n*=Math.pow(2,32),n+=Ee(e,t+4),n}function ke(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Ae(e,t,n){e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}function Ie(e){const t=e.byteLength;for(let n=0;n<t;){const i=Ee(e,n);if(i>8&&109===e[n+4]&&111===e[n+5]&&111===e[n+6]&&102===e[n+7])return!0;n=i>1?n+i:t}return!1}function Ce(e,t){const n=[];if(!t.length)return n;const i=e.byteLength;for(let r=0;r<i;){const s=Ee(e,r),a=Se(e.subarray(r+4,r+8)),o=s>1?r+s:i;if(a===t[0])if(1===t.length)n.push(e.subarray(r+8,o));else{const i=Ce(e.subarray(r+8,o),t.slice(1));i.length&&_e.apply(n,i)}r=o}return n}function De(e){const t=[],n=e[0];let i=8;const r=Ee(e,i);i+=4;let s=0,a=0;0===n?(s=Ee(e,i),a=Ee(e,i+4),i+=8):(s=xe(e,i),a=xe(e,i+8),i+=16),i+=2;let o=e.length+a;const l=we(e,i);i+=2;for(let u=0;u<l;u++){let n=i;const s=Ee(e,n);n+=4;const a=2147483647&s,l=(2147483648&s)>>>31;if(1===l)return E.warn("SIDX has hierarchical references (not supported)"),null;const u=Ee(e,n);n+=4,t.push({referenceSize:a,subsegmentDuration:u,info:{duration:u/r,start:o,end:o+a-1}}),o+=a,n+=4,i=n}return{earliestPresentationTime:s,timescale:r,version:n,referencesCount:l,references:t}}function Re(e){const t=[],n=Ce(e,["moov","trak"]);for(let r=0;r<n.length;r++){const e=n[r],i=Ce(e,["tkhd"])[0];if(i){let n=i[0];const r=Ee(i,0===n?12:20),s=Ce(e,["mdia","mdhd"])[0];if(s){n=s[0];const i=Ee(s,0===n?12:20),a=Ce(e,["mdia","hdlr"])[0];if(a){const n=Se(a.subarray(8,12)),s={soun:M.AUDIO,vide:M.VIDEO}[n];if(s){const n=Ce(e,["mdia","minf","stbl","stsd"])[0],a=Me(n);t[r]={timescale:i,type:s},t[s]=o({timescale:i,id:r},a)}}}}}const i=Ce(e,["moov","mvex","trex"]);return i.forEach(e=>{const n=Ee(e,4),i=t[n];i&&(i.default={duration:Ee(e,12),flags:Ee(e,20)})}),t}function Me(e){const t=e.subarray(8),n=t.subarray(86),i=Se(t.subarray(4,8));let r=i;const s="enca"===i||"encv"===i;if(s){const e=Ce(t,[i])[0],n=e.subarray("enca"===i?28:78),s=Ce(n,["sinf"]);s.forEach(e=>{const t=Ce(e,["schm"])[0];if(t){const n=Se(t.subarray(4,8));if("cbcs"===n||"cenc"===n){const t=Ce(e,["frma"])[0];t&&(r=Se(t))}}})}switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const e=Ce(n,["avcC"])[0];r+="."+Pe(e[1])+Pe(e[2])+Pe(e[3]);break}case"mp4a":{const e=Ce(t,[i])[0],n=Ce(e.subarray(28),["esds"])[0];if(n&&n.length>12){let e=4;if(3!==n[e++])break;e=Le(n,e),e+=2;const t=n[e++];if(128&t&&(e+=2),64&t&&(e+=n[e++]),4!==n[e++])break;e=Le(n,e);const i=n[e++];if(64!==i)break;if(r+="."+Pe(i),e+=12,5!==n[e++])break;e=Le(n,e);const s=n[e++];let a=(248&s)>>3;31===a&&(a+=1+((7&s)<<3)+((224&n[e])>>5)),r+="."+a}break}case"hvc1":case"hev1":{const e=Ce(n,["hvcC"])[0],t=e[1],i=["","A","B","C"][t>>6],s=31&t,a=Ee(e,2),o=(32&t)>>5?"H":"L",l=e[12],u=e.subarray(6,12);r+="."+i+s,r+="."+a.toString(16).toUpperCase(),r+="."+o+l;let c="";for(let n=u.length;n--;){const e=u[n];if(e||c){const t=e.toString(16).toUpperCase();c="."+t+c}}r+=c;break}case"dvh1":case"dvhe":{const e=Ce(n,["dvcC"])[0],t=e[2]>>1&127,i=e[2]<<5&32|e[3]>>3&31;r+="."+Oe(t)+"."+Oe(i);break}case"vp09":{const e=Ce(n,["vpcC"])[0],t=e[4],i=e[5],s=e[6]>>4&15;r+="."+Oe(t)+"."+Oe(i)+"."+Oe(s);break}case"av01":{const e=Ce(n,["av1C"])[0],t=e[1]>>>5,i=31&e[1],s=e[2]>>>7?"H":"M",a=(64&e[2])>>6,o=(32&e[2])>>5,l=2===t&&a?o?12:10:a?10:8,u=(16&e[2])>>4,c=(8&e[2])>>3,d=(4&e[2])>>2,h=3&e[2],f=1,p=1,g=1,m=0;r+="."+t+"."+Oe(i)+s+"."+Oe(l)+"."+u+"."+c+d+h+"."+Oe(f)+"."+Oe(p)+"."+Oe(g)+"."+m;break}}return{codec:r,encrypted:s}}function Le(e,t){const n=t+5;while(128&e[t++]&&t<n);return t}function Pe(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function Oe(e){return(e<10?"0":"")+e}function Ne(e,t){if(!e||!t)return e;const n=t.keyId;if(n&&t.isCommonEncryption){const t=Ce(e,["moov","trak"]);t.forEach(e=>{const t=Ce(e,["mdia","minf","stbl","stsd"])[0],i=t.subarray(8);let r=Ce(i,["enca"]);const s=r.length>0;s||(r=Ce(i,["encv"])),r.forEach(e=>{const t=s?e.subarray(28):e.subarray(78),i=Ce(t,["sinf"]);i.forEach(e=>{const t=Ue(e);if(t){const e=t.subarray(8,24);e.some(e=>0!==e)||(E.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${ye.hexDump(e)} -> ${ye.hexDump(n)}`),t.set(n,8))}})})})}return e}function Ue(e){const t=Ce(e,["schm"])[0];if(t){const n=Se(t.subarray(4,8));if("cbcs"===n||"cenc"===n)return Ce(e,["schi","tenc"])[0]}return E.error("[eme] missing 'schm' box"),null}function Fe(e,t){return Ce(t,["moof","traf"]).reduce((t,n)=>{const i=Ce(n,["tfdt"])[0],r=i[0],s=Ce(n,["tfhd"]).reduce((t,n)=>{const s=Ee(n,4),a=e[s];if(a){let e=Ee(i,4);if(1===r){if(e===be)return E.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=be+1,e+=Ee(i,8)}const n=a.timescale||9e4,s=e/n;if(h(s)&&(null===t||s<t))return s}return t},null);return null!==s&&h(s)&&(null===t||s<t)?s:t},null)}function Be(e,t){let n=0,i=0,r=0;const s=Ce(e,["moof","traf"]);for(let a=0;a<s.length;a++){const e=s[a],o=Ce(e,["tfhd"])[0],l=Ee(o,4),u=t[l];if(!u)continue;const c=u.default,d=Ee(o,0)|(null==c?void 0:c.flags);let h=null==c?void 0:c.duration;8&d&&(h=Ee(o,2&d?12:8));const f=u.timescale||9e4,p=Ce(e,["trun"]);for(let t=0;t<p.length;t++){if(n=je(p[t]),!n&&h){const e=Ee(p[t],4);n=h*e}u.type===M.VIDEO?i+=n/f:u.type===M.AUDIO&&(r+=n/f)}}if(0===i&&0===r){let t=1/0,n=0,i=0;const r=Ce(e,["sidx"]);for(let e=0;e<r.length;e++){const s=De(r[e]);if(null!=s&&s.references){t=Math.min(t,s.earliestPresentationTime/s.timescale);const e=s.references.reduce((e,t)=>e+t.info.duration||0,0);n=Math.max(n,e+s.earliestPresentationTime/s.timescale),i=n-t}}if(i&&h(i))return i}return i||r}function je(e){const t=Ee(e,0);let n=8;1&t&&(n+=4),4&t&&(n+=4);let i=0;const r=Ee(e,4);for(let s=0;s<r;s++){if(256&t){const t=Ee(e,n);i+=t,n+=4}512&t&&(n+=4),1024&t&&(n+=4),2048&t&&(n+=4)}return i}function Ve(e,t,n){Ce(t,["moof","traf"]).forEach(t=>{Ce(t,["tfhd"]).forEach(i=>{const r=Ee(i,4),s=e[r];if(!s)return;const a=s.timescale||9e4;Ce(t,["tfdt"]).forEach(e=>{const t=e[0],i=n*a;if(i){let n=Ee(e,4);if(0===t)n-=i,n=Math.max(n,0),Ae(e,4,n);else{n*=Math.pow(2,32),n+=Ee(e,8),n-=i,n=Math.max(n,0);const t=Math.floor(n/(be+1)),r=Math.floor(n%(be+1));Ae(e,4,t),Ae(e,8,r)}}})})})}function He(e){const t={valid:null,remainder:null},n=Ce(e,["moof"]);if(n.length<2)return t.remainder=e,t;const i=n[n.length-1];return t.valid=ee(e,0,i.byteOffset-8),t.remainder=ee(e,i.byteOffset-8),t}function $e(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function Ge(e,t){const n=[],i=t.samples,r=t.timescale,s=t.id;let a=!1;const o=Ce(i,["moof"]);return o.map(o=>{const l=o.byteOffset-8,u=Ce(o,["traf"]);u.map(o=>{const u=Ce(o,["tfdt"]).map(e=>{const t=e[0];let n=Ee(e,4);return 1===t&&(n*=Math.pow(2,32),n+=Ee(e,8)),n/r})[0];return void 0!==u&&(e=u),Ce(o,["tfhd"]).map(u=>{const c=Ee(u,4),d=16777215&Ee(u,0),h=0!==(1&d),f=0!==(2&d),p=0!==(8&d);let g=0;const m=0!==(16&d);let v=0;const y=0!==(32&d);let b=8;c===s&&(h&&(b+=8),f&&(b+=4),p&&(g=Ee(u,b),b+=4),m&&(v=Ee(u,b),b+=4),y&&(b+=4),"video"===t.type&&(a=ze(t.codec)),Ce(o,["trun"]).map(s=>{const o=s[0],u=16777215&Ee(s,0),c=0!==(1&u);let d=0;const h=0!==(4&u),f=0!==(256&u);let p=0;const m=0!==(512&u);let y=0;const b=0!==(1024&u),_=0!==(2048&u);let T=0;const S=Ee(s,4);let w=8;c&&(d=Ee(s,w),w+=4),h&&(w+=4);let E=d+l;for(let l=0;l<S;l++){if(f?(p=Ee(s,w),w+=4):p=g,m?(y=Ee(s,w),w+=4):y=v,b&&(w+=4),_&&(T=0===o?Ee(s,w):ke(s,w),w+=4),t.type===M.VIDEO){let t=0;while(t<y){const s=Ee(i,E);if(E+=4,qe(a,i[E])){const t=i.subarray(E,E+s);We(t,a?2:1,e+T/r,n)}E+=s,t+=s+4}}e+=p/r}}))})})}),n}function ze(e){if(!e)return!1;const t=e.indexOf("."),n=t<0?e:e.substring(0,t);return"hvc1"===n||"hev1"===n||"dvh1"===n||"dvhe"===n}function qe(e,t){if(e){const e=t>>1&63;return 39===e||40===e}{const e=31&t;return 6===e}}function We(e,t,n,i){const r=Ke(e);let s=0;s+=t;let a=0,o=0,l=0;while(s<r.length){a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(255===l);o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(255===l);const e=r.length-s;let t=s;if(o<e)s+=o;else if(o>e){E.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===a){const e=r[t++];if(181===e){const e=we(r,t);if(t+=2,49===e){const e=Ee(r,t);if(t+=4,1195456820===e){const e=r[t++];if(3===e){const s=r[t++],o=31&s,l=64&s,u=l?2+3*o:0,c=new Uint8Array(u);if(l){c[0]=s;for(let e=1;e<u;e++)c[e]=r[t++]}i.push({type:e,payloadType:a,pts:n,bytes:c})}}}}}else if(5===a&&o>16){const e=[];for(let n=0;n<16;n++){const i=r[t++].toString(16);e.push(1==i.length?"0"+i:i),3!==n&&5!==n&&7!==n&&9!==n||e.push("-")}const s=o-16,l=new Uint8Array(s);for(let n=0;n<s;n++)l[n]=r[t++];i.push({payloadType:a,pts:n,uuid:e.join(""),userData:ge(l),userDataBytes:l})}}}function Ke(e){const t=e.byteLength,n=[];let i=1;while(i<t-2)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(0===n.length)return e;const r=t-n.length,s=new Uint8Array(r);let a=0;for(i=0;i<r;a++,i++)a===n[0]&&(a++,n.shift()),s[i]=e[a];return s}function Ye(e){const t=e[0];let n="",i="",r=0,s=0,a=0,o=0,l=0,u=0;if(0===t){while("\0"!==Se(e.subarray(u,u+1)))n+=Se(e.subarray(u,u+1)),u+=1;n+=Se(e.subarray(u,u+1)),u+=1;while("\0"!==Se(e.subarray(u,u+1)))i+=Se(e.subarray(u,u+1)),u+=1;i+=Se(e.subarray(u,u+1)),u+=1,r=Ee(e,12),s=Ee(e,16),o=Ee(e,20),l=Ee(e,24),u=28}else if(1===t){u+=4,r=Ee(e,u),u+=4;const t=Ee(e,u);u+=4;const s=Ee(e,u);u+=4,a=2**32*t+s,f(a)||(a=Number.MAX_SAFE_INTEGER,E.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Ee(e,u),u+=4,l=Ee(e,u),u+=4;while("\0"!==Se(e.subarray(u,u+1)))n+=Se(e.subarray(u,u+1)),u+=1;n+=Se(e.subarray(u,u+1)),u+=1;while("\0"!==Se(e.subarray(u,u+1)))i+=Se(e.subarray(u,u+1)),u+=1;i+=Se(e.subarray(u,u+1)),u+=1}const c=e.subarray(u,e.byteLength);return{schemeIdUri:n,value:i,timeScale:r,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:c}}function Xe(e,...t){const n=t.length;let i=8,r=n;while(r--)i+=t[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=255&i,s.set(e,4),r=0,i=8;r<n;r++)s.set(t[r],i),i+=t[r].byteLength;return s}function Qe(e,t,n){if(16!==e.byteLength)throw new RangeError("Invalid system id");let i,r,s;if(t){i=1,r=new Uint8Array(16*t.length);for(let e=0;e<t.length;e++){const n=t[e];if(16!==n.byteLength)throw new RangeError("Invalid key");r.set(n,16*e)}}else i=0,r=new Uint8Array;i>0?(s=new Uint8Array(4),t.length>0&&new DataView(s.buffer).setUint32(0,t.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return n&&n.byteLength>0&&new DataView(a.buffer).setUint32(0,n.byteLength,!1),Xe([112,115,115,104],new Uint8Array([i,0,0,0]),e,s,r,a,n||new Uint8Array)}function Ze(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},n=new DataView(e),i=n.getUint32(0);if(e.byteLength!==i&&i>44)return null;const r=n.getUint32(4);if(1886614376!==r)return null;if(t.version=n.getUint32(8)>>>24,t.version>1)return null;t.systemId=ye.hexDump(new Uint8Array(e,12,16));const s=n.getUint32(28);if(0===t.version){if(i-32<s)return null;t.data=new Uint8Array(e,32,s)}else if(1===t.version){t.kids=[];for(let n=0;n<s;n++)t.kids.push(new Uint8Array(e,32+16*n,16))}return t}let Je={};class et{static clearKeyUriToKeyIdMap(){Je={}}constructor(e,t,n,i=[1],r=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case z.FAIRPLAY:case z.WIDEVINE:case z.PLAYREADY:case z.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!==typeof e&&("AES-128"!==this.method||this.iv||E.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=tt(e),n=new et(this.method,this.uri,"identity",this.keyFormatVersions,t);return n}const t=V(this.uri);if(t)switch(this.keyFormat){case z.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case z.PLAYREADY:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Qe(e,null,t);const n=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),i=String.fromCharCode.apply(null,Array.from(n)),r=i.substring(i.indexOf("<"),i.length),s=new DOMParser,a=s.parseFromString(r,"text/xml"),o=a.getElementsByTagName("KID")[0];if(o){const e=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(e){const t=F(e).subarray(0,16);j(t),this.keyId=t}}break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=Je[this.uri];if(!e){const t=Object.keys(Je).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);const n=new DataView(e.buffer,12,4);n.setUint32(0,t),Je[this.uri]=e}this.keyId=e}return this}}function tt(e){const t=new Uint8Array(16);for(let n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}const nt=/\{\$([a-zA-Z0-9-_]+)\}/g;function it(e){return nt.test(e)}function rt(e,t,n){if(null!==e.variableList||e.hasVariableRefs)for(let i=n.length;i--;){const r=n[i],s=t[r];s&&(t[r]=st(e,s))}}function st(e,t){if(null!==e.variableList||e.hasVariableRefs){const n=e.variableList;return t.replace(nt,t=>{const i=t.substring(2,t.length-1),r=null==n?void 0:n[i];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),t):r})}return t}function at(e,t,n){let i,r,s=e.variableList;if(s||(e.variableList=s={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{const t=new self.URL(n).searchParams;if(!t.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${n}"`);r=t.get(i)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else i=t.NAME,r=t.VALUE;i in s?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):s[i]=r||""}function ot(e,t,n){const i=t.IMPORT;if(n&&i in n){let t=e.variableList;t||(e.variableList=t={}),t[i]=n[i]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function lt(e=!0){if("undefined"===typeof self)return;const t=(e||!self.MediaSource)&&self.ManagedMediaSource;return t||self.MediaSource||self.WebKitMediaSource}function ut(e){return"undefined"!==typeof self&&e===self.ManagedMediaSource}const ct={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function dt(e,t){const n=ct[t];return!!n&&!!n[e.slice(0,4)]}function ht(e,t,n=!0){return!e.split(",").some(e=>!ft(e,t,n))}function ft(e,t,n=!0){var i;const r=lt(n);return null!=(i=null==r?void 0:r.isTypeSupported(pt(e,t)))&&i}function pt(e,t){return`${t}/mp4;codecs="${e}"`}function gt(e){if(e){const t=e.substring(0,4);return ct.video[t]}return 2}function mt(e){return e.split(",").reduce((e,t)=>{const n=ct.video[t];return n?(2*n+e)/(e?3:2):(ct.audio[t]+e)/(e?2:1)},0)}const vt={};function yt(e,t=!0){if(vt[e])return vt[e];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[e];for(let i=0;i<n.length;i++)if(ft(n[i],"audio",t))return vt[e]=n[i],n[i];return e}const bt=/flac|opus/i;function _t(e,t=!0){return e.replace(bt,e=>yt(e.toLowerCase(),t))}function Tt(e,t){return e&&"mp4a"!==e?e:t?t.split(",")[0]:t}function St(e){const t=e.split(",");for(let n=0;n<t.length;n++){const e=t[n].split(".");if(e.length>2){let i=e.shift()+".";i+=parseInt(e.shift()).toString(16),i+=("000"+parseInt(e.shift()).toString(16)).slice(-4),t[n]=i}}return t.join(",")}const wt=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Et=/#EXT-X-MEDIA:(.*)/g,xt=/^#EXT(?:INF|-X-TARGETDURATION):/m,kt=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),At=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class It{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return s.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return xt.test(e)}static parseMasterPlaylist(e,t){const n=it(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},r=[];let s;wt.lastIndex=0;while(null!=(s=wt.exec(e)))if(s[1]){var a;const e=new A(s[1]);rt(i,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const n=st(i,s[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:It.resolve(n,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),Rt(e.CODECS,o),null!=(a=o.unknownCodecs)&&a.length||r.push(o),i.levels.push(o)}else if(s[3]){const e=s[3],n=s[4];switch(e){case"SESSION-DATA":{const e=new A(n);rt(i,e,["DATA-ID","LANGUAGE","VALUE","URI"]);const t=e["DATA-ID"];t&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[t]=e);break}case"SESSION-KEY":{const e=Ct(n,t,i);e.encrypted&&e.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(e)):E.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${n}"`);break}case"DEFINE":{const e=new A(n);rt(i,e,["NAME","VALUE","QUERYPARAM"]),at(i,e,t)}break;case"CONTENT-STEERING":{const e=new A(n);rt(i,e,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:It.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":i.startTimeOffset=Dt(n);break}}const o=r.length>0&&r.length<i.levels.length;return i.levels=o?r:i.levels,0===i.levels.length&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,n){let i;const r={},s=n.levels,a={AUDIO:s.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:s.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;Et.lastIndex=0;while(null!==(i=Et.exec(e))){const e=new A(i[1]),s=e.TYPE;if(s){const i=a[s],l=r[s]||[];r[s]=l,rt(n,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const u=e.LANGUAGE,c=e["ASSOC-LANGUAGE"],d=e.CHANNELS,h=e.CHARACTERISTICS,f=e["INSTREAM-ID"],p={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||u||"",type:s,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:u,url:e.URI?It.resolve(e.URI,t):""};if(c&&(p.assocLang=c),d&&(p.channels=d),h&&(p.characteristics=h),f&&(p.instreamId=f),null!=i&&i.length){const e=It.findGroup(i,p.groupId)||i[0];Mt(p,e,"audioCodec"),Mt(p,e,"textCodec")}l.push(p)}}return r}static parseLevelPlaylist(e,t,n,i,r,s){const a=new U(t),o=a.fragments;let l,u,c,f=null,p=0,g=0,m=0,v=0,y=null,b=new P(i,t),_=-1,T=!1,S=null;kt.lastIndex=0,a.m3u8=e,a.hasVariableRefs=it(e);while(null!==(l=kt.exec(e))){T&&(T=!1,b=new P(i,t),b.start=m,b.sn=p,b.cc=v,b.level=n,f&&(b.initSegment=f,b.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null,S&&(b.setByteRange(S),S=null)));const e=l[1];if(e){b.duration=parseFloat(e);const t=(" "+l[2]).slice(1);b.title=t||null,b.tagList.push(t?["INF",e,t]:["INF",e])}else if(l[3]){if(h(b.duration)){b.start=m,c&&Nt(b,c,a),b.sn=p,b.level=n,b.cc=v,o.push(b);const e=(" "+l[3]).slice(1);b.relurl=st(a,e),Pt(b,y),y=b,m+=b.duration,p++,g=0,T=!0}}else if(l[4]){const e=(" "+l[4]).slice(1);y?b.setByteRange(e,y):b.setByteRange(e)}else if(l[5])b.rawProgramDateTime=(" "+l[5]).slice(1),b.tagList.push(["PROGRAM-DATE-TIME",b.rawProgramDateTime]),-1===_&&(_=o.length);else{if(l=l[0].match(At),!l){E.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<l.length;u++)if("undefined"!==typeof l[u])break;const e=(" "+l[u]).slice(1),r=(" "+l[u+1]).slice(1),m=l[u+2]?(" "+l[u+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":a.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":p=a.startSN=parseInt(r);break;case"SKIP":{const e=new A(r);rt(a,e,["RECENTLY-REMOVED-DATERANGES"]);const t=e.decimalInteger("SKIPPED-SEGMENTS");if(h(t)){a.skippedSegments=t;for(let e=t;e--;)o.unshift(null);p+=t}const n=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");n&&(a.recentlyRemovedDateranges=n.split("\t"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(r),1);break;case"VERSION":a.version=parseInt(r);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(r||m)&&b.tagList.push(m?[r,m]:[r]);break;case"DISCONTINUITY":v++,b.tagList.push(["DIS"]);break;case"GAP":b.gap=!0,b.tagList.push([e]);break;case"BITRATE":b.tagList.push([e,r]);break;case"DATERANGE":{const e=new A(r);rt(a,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),rt(a,e,e.clientAttrs);const t=new D(e,a.dateRanges[e.ID]);t.isValid||a.skippedSegments?a.dateRanges[t.id]=t:E.warn(`Ignoring invalid DATERANGE tag: "${r}"`),b.tagList.push(["EXT-X-DATERANGE",r]);break}case"DEFINE":{const e=new A(r);rt(a,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?ot(a,e,s):at(a,e,t)}break;case"DISCONTINUITY-SEQUENCE":v=parseInt(r);break;case"KEY":{const e=Ct(r,t,a);if(e.isSupported()){if("NONE"===e.method){c=void 0;break}c||(c={}),c[e.keyFormat]&&(c=d({},c)),c[e.keyFormat]=e}else E.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${r}"`);break}case"START":a.startTimeOffset=Dt(r);break;case"MAP":{const e=new A(r);if(rt(a,e,["BYTERANGE","URI"]),b.duration){const r=new P(i,t);Ot(r,e,n,c),f=r,b.initSegment=f,f.rawProgramDateTime&&!b.rawProgramDateTime&&(b.rawProgramDateTime=f.rawProgramDateTime)}else{const t=b.byteRangeEndOffset;if(t){const e=b.byteRangeStartOffset;S=`${t-e}@${e}`}else S=null;Ot(b,e,n,c),f=b,T=!0}break}case"SERVER-CONTROL":{const e=new A(r);a.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),a.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const e=new A(r);a.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=a.partList;e||(e=a.partList=[]);const n=g>0?e[e.length-1]:void 0,i=g++,s=new A(r);rt(a,s,["BYTERANGE","URI"]);const o=new O(s,b,t,i,n);e.push(o),b.duration+=o.duration;break}case"PRELOAD-HINT":{const e=new A(r);rt(a,e,["URI"]),a.preloadHint=e;break}case"RENDITION-REPORT":{const e=new A(r);rt(a,e,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(e);break}default:E.warn(`line parsed but not handled: ${l}`);break}}}y&&!y.relurl?(o.pop(),m-=y.duration,a.partList&&(a.fragmentHint=y)):a.partList&&(Pt(b,y),b.cc=v,a.fragmentHint=b,c&&Nt(b,c,a));const w=o.length,x=o[0],k=o[w-1];if(m+=a.skippedSegments*a.targetduration,m>0&&w&&k){a.averagetargetduration=m/w;const e=k.sn;a.endSN="initSegment"!==e?e:0,a.live||(k.endList=!0),x&&(a.startCC=x.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(m+=a.fragmentHint.duration),a.totalduration=m,a.endCC=v,_>0&&Lt(o,_),a}}function Ct(e,t,n){var i,r;const s=new A(e);rt(n,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=null!=(i=s.METHOD)?i:"",o=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=null!=(r=s.KEYFORMAT)?r:"identity";o&&s.IV&&!l&&E.error(`Invalid IV: ${s.IV}`);const d=o?It.resolve(o,t):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new et(a,d,c,h,l)}function Dt(e){const t=new A(e),n=t.decimalFloatingPoint("TIME-OFFSET");return h(n)?n:null}function Rt(e,t){let n=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const i=n.filter(t=>dt(t,e));i.length&&(t[`${e}Codec`]=i.join(","),n=n.filter(e=>-1===i.indexOf(e)))}),t.unknownCodecs=n}function Mt(e,t,n){const i=t[n];i&&(e[n]=i)}function Lt(e,t){let n=e[t];for(let i=t;i--;){const t=e[i];if(!t)return;t.programDateTime=n.programDateTime-1e3*t.duration,n=t}}function Pt(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),h(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function Ot(e,t,n,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=n,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function Nt(e,t,n){e.levelkeys=t;const{encryptedFragments:i}=n;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||i.push(e)}var Ut={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ft={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Bt(e){const{type:t}=e;switch(t){case Ut.AUDIO_TRACK:return Ft.AUDIO;case Ut.SUBTITLE_TRACK:return Ft.SUBTITLE;default:return Ft.MAIN}}function jt(e,t){let n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n}class Vt{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(g.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_LOADING,this.onLevelLoading,this),e.off(g.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(g.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,r=n||i,s=new r(t);return this.loaders[e.type]=s,s}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ut.MANIFEST,url:n,deliveryDirectives:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:r,url:s,deliveryDirectives:a}=t;this.load({id:n,level:i,pathwayId:r,responseType:"text",type:Ut.LEVEL,url:s,deliveryDirectives:a})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:r,deliveryDirectives:s}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:Ut.AUDIO_TRACK,url:r,deliveryDirectives:s})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:r,deliveryDirectives:s}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:Ut.SUBTITLE_TRACK,url:r,deliveryDirectives:s})}load(e){var t;const n=this.hls.config;let i,r=this.getInternalLoader(e);if(r){const t=r.context;if(t&&t.url===e.url&&t.level===e.level)return void E.trace("[playlist-loader]: playlist request ongoing");E.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}if(i=e.type===Ut.MANIFEST?n.manifestLoadPolicy.default:d({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),h(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===Ut.LEVEL&&null!==e.level?t=this.hls.levels[e.level].details:e.type===Ut.AUDIO_TRACK&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===Ut.SUBTITLE_TRACK&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,n=t.targetduration;if(e&&n){const t=1e3*Math.max(3*e,.8*n);i=d({},i,{maxTimeToFirstByteMs:Math.min(t,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,i.maxTimeToFirstByteMs)})}}}const s=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},o={onSuccess:(e,t,n,i)=>{const r=this.getInternalLoader(n);this.resetInternalLoader(n.type);const s=e.data;0===s.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),It.isMediaPlaylist(s)?this.handleTrackOrLevelPlaylist(e,t,n,i||null,r):this.handleMasterPlaylist(e,t,n,i)):this.handleManifestParsingError(e,n,new Error("no EXTM3U delimiter"),i||null,t)},onError:(e,t,n,i)=>{this.handleNetworkError(t,n,!1,e,i)},onTimeout:(e,t,n)=>{this.handleNetworkError(t,n,!0,void 0,e)}};r.load(e,a,o)}handleMasterPlaylist(e,t,n,i){const r=this.hls,s=e.data,a=jt(e,n),o=It.parseMasterPlaylist(s,a);if(o.playlistParsingError)return void this.handleManifestParsingError(e,n,o.playlistParsingError,i,t);const{contentSteering:l,levels:u,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f}=o;this.variableList=f;const{AUDIO:p=[],SUBTITLES:m,"CLOSED-CAPTIONS":v}=It.parseMasterPlaylistMedia(s,a,o);if(p.length){const e=p.some(e=>!e.url);e||!u[0].audioCodec||u[0].attrs.AUDIO||(E.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new A({}),bitrate:0,url:""}))}r.trigger(g.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:m,captions:v,contentSteering:l,url:a,stats:t,networkDetails:i,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f})}handleTrackOrLevelPlaylist(e,t,n,i,r){const s=this.hls,{id:a,level:o,type:l}=n,u=jt(e,n),c=0,d=h(o)?o:h(a)?a:0,f=Bt(n),p=It.parseLevelPlaylist(e.data,u,d,f,c,this.variableList);if(l===Ut.MANIFEST){const e={attrs:new A({}),bitrate:0,details:p,name:"",url:u};s.trigger(g.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:u,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=p,this.handlePlaylistLoaded(p,e,t,n,i,r)}handleManifestParsingError(e,t,n,i,r){this.hls.trigger(g.ERROR,{type:m.NETWORK_ERROR,details:v.MANIFEST_PARSING_ERROR,fatal:t.type===Ut.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t,n=!1,i,r){let s=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Ut.LEVEL?s+=`: ${e.level} id: ${e.id}`:e.type!==Ut.AUDIO_TRACK&&e.type!==Ut.SUBTITLE_TRACK||(s+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(s);E.warn(`[playlist-loader]: ${s}`);let l=v.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case Ut.MANIFEST:l=n?v.MANIFEST_LOAD_TIMEOUT:v.MANIFEST_LOAD_ERROR,u=!0;break;case Ut.LEVEL:l=n?v.LEVEL_LOAD_TIMEOUT:v.LEVEL_LOAD_ERROR,u=!1;break;case Ut.AUDIO_TRACK:l=n?v.AUDIO_TRACK_LOAD_TIMEOUT:v.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Ut.SUBTITLE_TRACK:l=n?v.SUBTITLE_TRACK_LOAD_TIMEOUT:v.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:m.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:r};if(i){const n=(null==t?void 0:t.url)||e.url;d.response=o({url:n,data:void 0},i)}this.hls.trigger(g.ERROR,d)}handlePlaylistLoaded(e,t,n,i,r,s){const a=this.hls,{type:o,level:l,id:u,groupId:c,deliveryDirectives:d}=i,h=jt(t,i),f=Bt(i),p="number"===typeof i.level&&f===Ft.MAIN?l:void 0;if(!e.fragments.length){const e=new Error("No Segments found in Playlist");return void a.trigger(g.ERROR,{type:m.NETWORK_ERROR,details:v.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:e,reason:e.message,response:t,context:i,level:p,parent:f,networkDetails:r,stats:n})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const y=e.playlistParsingError;if(y)a.trigger(g.ERROR,{type:m.NETWORK_ERROR,details:v.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:y,reason:y.message,response:t,context:i,level:p,parent:f,networkDetails:r,stats:n});else switch(e.live&&s&&(s.getCacheAge&&(e.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Ut.MANIFEST:case Ut.LEVEL:a.trigger(g.LEVEL_LOADED,{details:e,level:p||0,id:u||0,stats:n,networkDetails:r,deliveryDirectives:d});break;case Ut.AUDIO_TRACK:a.trigger(g.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:n,networkDetails:r,deliveryDirectives:d});break;case Ut.SUBTITLE_TRACK:a.trigger(g.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:n,networkDetails:r,deliveryDirectives:d});break}}}function Ht(e,t){let n;try{n=new Event("addtrack")}catch(e){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function $t(e,t){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(n){E.debug(`[texttrack-utils]: ${n}`);try{const n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(e){E.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===n&&(e.mode=n)}function Gt(e){const t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let n=e.cues.length;n--;)e.removeCue(e.cues[n]);"disabled"===t&&(e.mode=t)}function zt(e,t,n,i){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=Wt(e.cues,t,n);for(let t=0;t<r.length;t++)i&&!i(r[t])||e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}function qt(e,t){if(t<e[0].startTime)return 0;const n=e.length-1;if(t>e[n].endTime)return-1;let i=0,r=n;while(i<=r){const s=Math.floor((r+i)/2);if(t<e[s].startTime)r=s-1;else{if(!(t>e[s].startTime&&i<n))return s;i=s+1}}return e[i].startTime-t<t-e[r].startTime?i:r}function Wt(e,t,n){const i=[],r=qt(e,t);if(r>-1)for(let s=r,a=e.length;s<a;s++){const r=e[s];if(r.startTime>=t&&r.endTime<=n)i.push(r);else if(r.startTime>n)return i}return i}function Kt(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[n])}return t}var Yt={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const Xt=.25;function Qt(){if("undefined"!==typeof self)return self.VTTCue||self.TextTrackCue}function Zt(e,t,n,i,r){let s=new e(t,n,"");try{s.value=i,r&&(s.type=r)}catch(a){s=new e(t,n,JSON.stringify(r?o({type:r},i):i))}return s}const Jt=(()=>{const e=Qt();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function en(e,t){return e.getTime()/1e3-t}function tn(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class nn{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Gt(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if("metadata"===n.kind&&"id3"===n.label)return Ht(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:i}}}=this;if(!n&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=Qt();if(s)for(let a=0;a<r.length;a++){const e=r[a].type;if(e===Yt.emsg&&!n||!i)continue;const t=ue(r[a].data);if(t){const n=r[a].pts;let i=n+r[a].duration;i>Jt&&(i=Jt);const o=i-n;o<=0&&(i=n+Xt);for(let r=0;r<t.length;r++){const a=t[r];if(!oe(a)){this.updateId3CueEnds(n,e);const t=Zt(s,n,i,a,e);t&&this.id3Track.addCue(t)}}}}}updateId3CueEnds(e,t){var n;const i=null==(n=this.id3Track)?void 0:n.cues;if(i)for(let r=i.length;r--;){const n=i[r];n.type===t&&n.startTime<e&&n.endTime===Jt&&(n.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:i}){const{id3Track:r,hls:s}=this;if(!s)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:o}}=s;if(r&&(a||o)){let e;e="audio"===i?e=>e.type===Yt.audioId3&&o:"video"===i?e=>e.type===Yt.emsg&&a:e=>e.type===Yt.audioId3&&o||e.type===Yt.emsg&&a,zt(r,t,n,e)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:n,id3Track:i}=this,{dateRanges:r}=t,s=Object.keys(r);if(i){const e=Object.keys(n).filter(e=>!s.includes(e));for(let t=e.length;t--;){const r=e[t];Object.keys(n[r].cues).forEach(e=>{i.removeCue(n[r].cues[e])}),delete n[r]}}const a=t.fragments[t.fragments.length-1];if(0===s.length||!h(null==a?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=a.programDateTime/1e3-a.start,l=Qt();for(let u=0;u<s.length;u++){const e=s[u],t=r[e],i=en(t.startDate,o),a=n[e],c=(null==a?void 0:a.cues)||{};let d=(null==a?void 0:a.durationKnown)||!1,h=Jt;const f=t.endDate;if(f)h=en(f,o),d=!0;else if(t.endOnNext&&!d){const e=s.reduce((e,n)=>{if(n!==t.id){const i=r[n];if(i.class===t.class&&i.startDate>t.startDate&&(!e||t.startDate<e.startDate))return i}return e},null);e&&(h=en(e.startDate,o),d=!0)}const p=Object.keys(t.attr);for(let n=0;n<p.length;n++){const r=p[n];if(!I(r))continue;const s=c[r];if(s)d&&!a.durationKnown&&(s.endTime=h);else if(l){let n=t.attr[r];C(r)&&(n=tn(n));const s=Zt(l,i,h,{key:r,data:n},Yt.dateRange);s&&(s.id=e,this.id3Track.addCue(s),c[r]=s)}}n[e]={cues:c,dateRange:t,durationKnown:d}}}}class rn{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=(()=>this.timeupdate()),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(null===e)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:s,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&n||t;(o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:s*i);const u=i,c=1;return l+Math.min(this.stallCount*c,u)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,n=this.levelDetails;if(null===e||null===t||null===n)return null;const i=n.edge,r=e-t-this.edgeStalled,s=i-n.totalduration,a=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(s,r),a)}get drift(){const{levelDetails:e}=this;return null===e?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(g.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(g.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(g.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(g.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var n;t.details===v.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(n=this.levelDetails)&&n.live&&E.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:r}=this.config;if(!i||1===r||!t.live)return;const s=this.targetLatency;if(null===s)return;const a=n-s,o=Math.min(this.maxLatency,s+t.targetduration),l=a<o;if(l&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),n=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(t,Math.max(1,n))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const sn=["NONE","TYPE-0","TYPE-1",null];function an(e){return sn.indexOf(e)>-1}const on=["SDR","PQ","HLG"];function ln(e){return!!e&&on.indexOf(e)>-1}var un={No:"",Yes:"YES",v2:"v2"};function cn(e){const{canSkipUntil:t,canSkipDateRanges:n,age:i}=e,r=i<t/2;return t&&r?n?un.v2:un.Yes:un.No}class dn{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class hn{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return fn(this._audioGroups,e)}hasSubtitleGroup(e){return fn(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function fn(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function pn(e,t){const n=t.startPTS;if(h(n)){let i,r=0;t.sn>e.sn?(r=n-e.start,i=e):(r=e.start-n,i=t),i.duration!==r&&(i.duration=r)}else if(t.sn>e.sn){const n=e.cc===t.cc;n&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function gn(e,t,n,i,r,s){const a=i-n;a<=0&&(E.warn("Fragment should have a positive duration",t),i=n+t.duration,s=r+t.duration);let o=n,l=i;const u=t.startPTS,c=t.endPTS;if(h(u)){const e=Math.abs(u-n);h(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,o=Math.max(n,u),n=Math.min(n,u),r=Math.min(r,t.startDTS),l=Math.min(i,c),i=Math.max(i,c),s=Math.max(s,t.endDTS)}const d=n-t.start;0!==t.start&&(t.start=n),t.duration=i-t.start,t.startPTS=n,t.maxStartPTS=o,t.startDTS=r,t.endPTS=i,t.minEndPTS=l,t.endDTS=s;const f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;let p;const g=f-e.startSN,m=e.fragments;for(m[g]=t,p=g;p>0;p--)pn(m[p],m[p-1]);for(p=g;p<m.length-1;p++)pn(m[p],m[p+1]);return e.fragmentHint&&pn(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function mn(e,t){let n=null;const i=e.fragments;for(let l=i.length-1;l>=0;l--){const e=i[l].initSegment;if(e){n=e;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;let r,s=0;if(bn(e,t,(e,i)=>{e.relurl&&(s=e.cc-i.cc),h(e.startPTS)&&h(e.endPTS)&&(i.start=i.startPTS=e.startPTS,i.startDTS=e.startDTS,i.maxStartPTS=e.maxStartPTS,i.endPTS=e.endPTS,i.endDTS=e.endDTS,i.minEndPTS=e.minEndPTS,i.duration=e.endPTS-e.startPTS,i.duration&&(r=i),t.PTSKnown=t.alignedSliding=!0),i.elementaryStreams=e.elementaryStreams,i.loader=e.loader,i.stats=e.stats,e.initSegment&&(i.initSegment=e.initSegment,n=e.initSegment)}),n){const e=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;e.forEach(e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=n)?void 0:t.relurl)||(e.initSegment=n)})}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(e=>!e),t.deltaUpdateFailed){E.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=vn(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const a=t.fragments;if(s){E.warn("discontinuity sliding from playlist, take drift into account");for(let e=0;e<a.length;e++)a[e].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),yn(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),r?gn(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):_n(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const e=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=e),t.driftEndTime=o,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function vn(e,t,n){const i=d({},e);return n&&n.forEach(e=>{delete i[e]}),Object.keys(t).forEach(e=>{const n=new D(t[e].attr,i[e]);n.isValid?i[e]=n:E.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)}),i}function yn(e,t,n){if(e&&t){let i=0;for(let r=0,s=e.length;r<=s;r++){const s=e[r],a=t[r+i];s&&a&&s.index===a.index&&s.fragment.sn===a.fragment.sn?n(s,a):i--}}}function bn(e,t,n){const i=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,s=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let u=r;u<=s;u++){const e=l[a+u];let r=o[u];i&&!r&&u<i&&(r=t.fragments[u]=e),e&&r&&n(e,r)}}function _n(e,t){const n=t.startSN+t.skippedSegments-e.startSN,i=e.fragments;n<0||n>=i.length||Tn(t,i[n].start)}function Tn(e,t){if(t){const n=e.fragments;for(let i=e.skippedSegments;i<n.length;i++)n[i].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function Sn(e,t=1/0){let n=1e3*e.targetduration;if(e.updated){const i=e.fragments,r=4;if(i.length&&n*r>t){const e=1e3*i[i.length-1].duration;e<n&&(n=e)}}else n/=2;return Math.round(n)}function wn(e,t,n){if(null==e||!e.details)return null;const i=e.details;let r=i.fragments[t-i.startSN];return r||(r=i.fragmentHint,r&&r.sn===t?r:t<i.startSN&&n&&n.sn===t?n:null)}function En(e,t,n){var i;return null!=e&&e.details?xn(null==(i=e.details)?void 0:i.partList,t,n):null}function xn(e,t,n){if(e)for(let i=e.length;i--;){const r=e[i];if(r.index===n&&r.fragment.sn===t)return r}return null}function kn(e){e.forEach((e,t)=>{const{details:n}=e;null!=n&&n.fragments&&n.fragments.forEach(e=>{e.level=t})})}function An(e){switch(e.details){case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_TIMEOUT:case v.LEVEL_LOAD_TIMEOUT:case v.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function In(e,t){const n=An(t);return e.default[`${n?"timeout":"error"}Retry`]}function Cn(e,t){const n="linear"===e.backoff?1:Math.pow(2,t);return Math.min(n*e.retryDelayMs,e.maxRetryDelayMs)}function Dn(e){return o(o({},e),{errorRetry:null,timeoutRetry:null})}function Rn(e,t,n,i){if(!e)return!1;const r=null==i?void 0:i.code,s=t<e.maxNumRetry&&(Mn(r)||!!n);return e.shouldRetry?e.shouldRetry(e,t,n,i,s):s}function Mn(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}const Ln={search:function(e,t){let n=0,i=e.length-1,r=null,s=null;while(n<=i){r=(n+i)/2|0,s=e[r];const a=t(s);if(a>0)n=r+1;else{if(!(a<0))return s;i=r-1}}return null}};function Pn(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!h(t))return null;const i=e[0].programDateTime;if(t<(i||0))return null;const r=e[e.length-1].endProgramDateTime;if(t>=(r||0))return null;n=n||0;for(let s=0;s<e.length;++s){const i=e[s];if(Fn(t,n,i))return i}return null}function On(e,t,n=0,i=0,r=.005){let s=null;if(e){s=t[e.sn-t[0].sn+1]||null;const i=e.endDTS-n;i>0&&i<15e-7&&(n+=15e-7)}else 0===n&&0===t[0].start&&(s=t[0]);if(s&&((!e||e.level===s.level)&&0===Un(n,i,s)||Nn(s,e,Math.min(r,i))))return s;const a=Ln.search(t,Un.bind(null,n,i));return!a||a===e&&s?s:a}function Nn(e,t,n){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const i=t.tagList.reduce((e,t)=>{return"INF"===t[0]&&(e+=parseFloat(t[1])),e},n);return e.start<=i}return!1}function Un(e=0,t=0,n){if(n.start<=e&&n.start+n.duration>e)return 0;const i=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-i<=e?1:n.start-i>e&&n.start?-1:0}function Fn(e,t,n){const i=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0)),r=n.endProgramDateTime||0;return r-i>e}function Bn(e,t){return Ln.search(e,e=>{return e.cc<t?1:e.cc>t?-1:0})}var jn={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Vn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class Hn{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=E.log.bind(E,"[info]:"),this.warn=E.warn.bind(E,"[warning]:"),this.error=E.error.bind(E,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(g.ERROR,this.onError,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(g.ERROR,this.onError,this),e.off(g.ERROR,this.onErrorOut,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===Ft.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var n,i;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case v.FRAG_LOAD_ERROR:case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_ERROR:case v.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case v.FRAG_PARSING_ERROR:if(null!=(n=t.frag)&&n.gap)return void(t.errorAction={action:jn.DoNothing,flags:Vn.None});case v.FRAG_GAP:case v.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=jn.SendAlternateToPenaltyBox);case v.LEVEL_EMPTY_ERROR:case v.LEVEL_PARSING_ERROR:{var a,o;const e=t.parent===Ft.MAIN?t.level:r.loadLevel;t.details===v.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(o=a.levelDetails)&&o.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case v.LEVEL_LOAD_ERROR:case v.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==s?void 0:s.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level)));case v.AUDIO_TRACK_LOAD_ERROR:case v.AUDIO_TRACK_LOAD_TIMEOUT:case v.SUBTITLE_LOAD_ERROR:case v.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const e=r.levels[r.loadLevel];if(e&&(s.type===Ut.AUDIO_TRACK&&e.hasAudioGroup(s.groupId)||s.type===Ut.SUBTITLE_TRACK&&e.hasSubtitleGroup(s.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=jn.SendAlternateToPenaltyBox,void(t.errorAction.flags=Vn.MoveAllAlternatesMatchingHost)}return;case v.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=r.levels[r.loadLevel],n=null==e?void 0:e.attrs["HDCP-LEVEL"];n?t.errorAction={action:jn.SendAlternateToPenaltyBox,flags:Vn.MoveAllAlternatesMatchingHDCP,hdcpLevel:n}:this.keySystemError(t)}return;case v.BUFFER_ADD_CODEC_ERROR:case v.REMUX_ALLOC_ERROR:case v.BUFFER_APPEND_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(i=t.level)?i:r.loadLevel));case v.INTERNAL_EXCEPTION:case v.BUFFER_APPENDING_ERROR:case v.BUFFER_FULL_ERROR:case v.LEVEL_SWITCH_ERROR:case v.BUFFER_STALLED_ERROR:case v.BUFFER_SEEK_OVER_HOLE:case v.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:jn.DoNothing,flags:Vn.None})}t.type===m.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,i=In(n.config.playlistLoadPolicy,e),r=this.playlistError++,s=Rn(i,r,An(e),e.response);if(s)return{action:jn.RetryRequest,flags:Vn.None,retryConfig:i,retryCount:r};const a=this.getLevelSwitchAction(e,t);return i&&(a.retryConfig=i,a.retryCount=r),a}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:r,keyLoadPolicy:s}=t.config,a=In(e.details.startsWith("key")?s:r,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(i){e.details!==v.FRAG_GAP&&i.fragmentError++;const t=Rn(a,o,An(e),e.response);if(t)return{action:jn.RetryRequest,flags:Vn.None,retryConfig:a,retryCount:o}}const l=this.getLevelSwitchAction(e,n);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(e,t){const n=this.hls;null!==t&&void 0!==t||(t=n.loadLevel);const i=this.hls.levels[t];if(i){var r,s;const t=e.details;i.loadError++,t===v.BUFFER_APPEND_ERROR&&i.fragmentError++;let l=-1;const{levels:u,loadLevel:c,minAutoLevel:d,maxAutoLevel:h}=n;n.autoLevelEnabled||(n.loadLevel=-1);const f=null==(r=e.frag)?void 0:r.type,p=f===Ft.AUDIO&&t===v.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===v.BUFFER_ADD_CODEC_ERROR||t===v.BUFFER_APPEND_ERROR),g=p&&u.some(({audioCodec:e})=>i.audioCodec!==e),m="video"===e.sourceBufferName&&(t===v.BUFFER_ADD_CODEC_ERROR||t===v.BUFFER_APPEND_ERROR),y=m&&u.some(({codecSet:e,audioCodec:t})=>i.codecSet!==e&&i.audioCodec===t),{type:b,groupId:_}=null!=(s=e.context)?s:{};for(let n=u.length;n--;){const r=(n+c)%u.length;if(r!==c&&r>=d&&r<=h&&0===u[r].loadError){var a,o;const n=u[r];if(t===v.FRAG_GAP&&f===Ft.MAIN&&e.frag){const t=u[r].details;if(t){const n=On(e.frag,t.fragments,e.frag.start);if(null!=n&&n.gap)continue}}else{if(b===Ut.AUDIO_TRACK&&n.hasAudioGroup(_)||b===Ut.SUBTITLE_TRACK&&n.hasSubtitleGroup(_))continue;if(f===Ft.AUDIO&&null!=(a=i.audioGroups)&&a.some(e=>n.hasAudioGroup(e))||f===Ft.SUBTITLE&&null!=(o=i.subtitleGroups)&&o.some(e=>n.hasSubtitleGroup(e))||g&&i.audioCodec===n.audioCodec||!g&&i.audioCodec!==n.audioCodec||y&&i.codecSet===n.codecSet)continue}l=r;break}}if(l>-1&&n.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:jn.SendAlternateToPenaltyBox,flags:Vn.None,nextAutoLevel:l}}return{action:jn.SendAlternateToPenaltyBox,flags:Vn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch(null==(n=t.errorAction)?void 0:n.action){case jn.DoNothing:break;case jn.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===v.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0;break;case jn.RetryRequest:break}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i,hdcpLevel:r,nextAutoLevel:s}=n;switch(i){case Vn.None:this.switchLevel(e,s);break;case Vn.MoveAllAlternatesMatchingHDCP:r&&(t.maxHdcpLevel=sn[sn.indexOf(r)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(e,s)}switchLevel(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class $n{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=E.log.bind(E,`${t}:`),this.warn=E.warn.bind(E,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=null==t?void 0:t.renditionReports;if(i){let r=-1;for(let n=0;n<i.length;n++){const s=i[n];let a;try{a=new self.URL(s.URI,t.url).href}catch(e){E.warn(`Could not construct new URL for Rendition Report: ${e}`),a=s.URI||""}if(a===e){r=n;break}a===e.substring(0,a.length)&&(r=n)}if(-1!==r){const e=i[r],s=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let a=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=n&&cn(n);return new dn(s,a>=0?a:void 0,o)}}}loadPlaylist(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,n){const{details:i,stats:r}=t,s=self.performance.now(),a=r.loading.first?Math.max(0,s-r.loading.first):0;if(i.advancedDateTime=Date.now()-a,i.live||null!=n&&n.live){if(i.reloaded(n),n&&this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),n&&i.fragments.length>0&&mn(n,i),!this.canLoad||!i.live)return;let a,o=void 0,l=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){const e=this.hls.config.lowLatencyMode,r=i.lastPartSn,s=i.endSN,u=i.lastPartIndex,c=-1!==u,d=r===s,h=e?0:u;c?(o=d?s+1:r,l=d?h:u+1):o=s+1;const f=i.age,p=f+i.ageHeader;let g=Math.min(p-i.partTarget,1.5*i.targetduration);if(g>0){if(n&&g>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${g} with playlist age: ${i.age}`),g=0;else{const e=Math.floor(g/i.targetduration);if(o+=e,void 0!==l){const e=Math.round(g%i.targetduration/i.partTarget);l+=e}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${f.toFixed(2)}s goal: ${g} skip sn ${e} to part ${l}`)}i.tuneInGoal=g}if(a=this.getDeliveryDirectives(i,t.deliveryDirectives,o,l),e||!d)return void this.loadPlaylist(a)}else(i.canBlockReload||i.canSkipUntil)&&(a=this.getDeliveryDirectives(i,t.deliveryDirectives,o,l));const u=this.hls.mainForwardBufferInfo,c=u?u.end-u.len:0,d=1e3*(i.edge-c),h=Sn(i,d);i.updated&&s>this.requestScheduled+h&&(this.requestScheduled=r.loading.start),void 0!==o&&i.canBlockReload?this.requestScheduled=r.loading.first+h-(1e3*i.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+h<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=h);let f=this.requestScheduled-s;f=Math.max(0,f),this.log(`reload live playlist ${e} in ${Math.round(f)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(a),f)}else this.clearTimer()}getDeliveryDirectives(e,t,n,i){let r=cn(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,r=un.No),new dn(n,i,r)}checkRetry(e){const t=e.details,n=An(e),i=e.errorAction,{action:r,retryCount:s=0,retryConfig:a}=i||{},o=!!i&&!!a&&(r===jn.RetryRequest||!i.resolved&&r===jn.SendAlternateToPenaltyBox);if(o){var l;if(this.requestScheduled=-1,s>=a.maxNumRetry)return!1;if(n&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${s+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=Cn(a,s);this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn(`Retrying playlist loading ${s+1}/${a.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,i.resolved=!0}return o}}class Gn{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class zn{constructor(e,t,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Gn(e),this.fast_=new Gn(t),this.defaultTTFB_=i,this.ttfb_=new Gn(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:r}=this;n.halfLife!==e&&(this.slow_=new Gn(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Gn(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Gn(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,i=e/1e3,r=n/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const qn={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},Wn={};function Kn(e,t,n,i,r,s){const a=e.audioCodec?e.audioGroups:null,o=null==s?void 0:s.audioCodec,l=null==s?void 0:s.channels,u=l?parseInt(l):o?1/0:2;let c=null;if(null!=a&&a.length)try{c=1===a.length&&a[0]?t.groups[a[0]].channels:a.reduce((e,n)=>{if(n){const i=t.groups[n];if(!i)throw new Error(`Audio track group ${n} not found`);Object.keys(i.channels).forEach(t=>{e[t]=(e[t]||0)+i.channels[t]})}return e},{2:0})}catch(e){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(i,30)||"SDR"!==e.videoRange&&e.videoRange!==n||e.bitrate>Math.max(r,8e6))||!!c&&h(u)&&Object.keys(c).some(e=>parseInt(e)>u)}function Yn(e,t,n){const i=e.videoCodec,r=e.audioCodec;if(!i||!r||!n)return Promise.resolve(qn);const s={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),framerate:e.frameRate||30},a=e.videoRange;"SDR"!==a&&(s.transferFunction=a.toLowerCase());const l=i.split(",").map(e=>({type:"media-source",video:o(o({},s),{},{contentType:pt(e,"video")})}));return r&&e.audioGroups&&e.audioGroups.forEach(e=>{var n;e&&(null==(n=t.groups[e])||n.tracks.forEach(t=>{if(t.groupId===e){const e=t.channels||"",n=parseFloat(e);h(n)&&n>2&&l.push.apply(l,r.split(",").map(e=>({type:"media-source",audio:{contentType:pt(e,"audio"),channels:""+n}})))}}))}),Promise.all(l.map(e=>{const t=Xn(e);return Wn[t]||(Wn[t]=n.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:l,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:l,decodingInfoResults:[],error:e}))}function Xn(e){const{audio:t,video:n}=e,i=n||t;if(i){const e=i.contentType.split('"')[1];if(n)return`r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${e}_${Math.ceil(n.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${e}`}return""}function Qn(){if("function"===typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}function Zn(e,t){let n=!1,i=[];return e&&(n="SDR"!==e,i=[e]),t&&(i=t.allowedVideoRanges||on.slice(0),n=void 0!==t.preferHDR?t.preferHDR:Qn(),i=n?i.filter(e=>"SDR"!==e):["SDR"]),{preferHDR:n,allowedVideoRanges:i}}function Jn(e,t,n,i,r){const s=Object.keys(e),a=null==i?void 0:i.channels,o=null==i?void 0:i.audioCodec,l=a&&2===parseInt(a);let u=!0,c=!1,d=1/0,f=1/0,p=1/0,g=0,m=[];const{preferHDR:v,allowedVideoRanges:y}=Zn(t,r);for(let h=s.length;h--;){const t=e[s[h]];u=t.channels[2]>0,d=Math.min(d,t.minHeight),f=Math.min(f,t.minFramerate),p=Math.min(p,t.minBitrate);const n=y.filter(e=>t.videoRanges[e]>0);n.length>0&&(c=!0,m=n)}d=h(d)?d:0,f=h(f)?f:0;const b=Math.max(1080,d),_=Math.max(30,f);p=h(p)?p:n,n=Math.max(p,n),c||(t=void 0,m=[]);const T=s.reduce((t,i)=>{const r=e[i];if(i===t)return t;if(r.minBitrate>n)return ei(i,`min bitrate of ${r.minBitrate} > current estimate of ${n}`),t;if(!r.hasDefaultAudio)return ei(i,"no renditions with default or auto-select sound found"),t;if(o&&i.indexOf(o.substring(0,4))%5!==0)return ei(i,`audio codec preference "${o}" not found`),t;if(a&&!l){if(!r.channels[a])return ei(i,`no renditions with ${a} channel sound found (channels options: ${Object.keys(r.channels)})`),t}else if((!o||l)&&u&&0===r.channels["2"])return ei(i,"no renditions with stereo sound found"),t;return r.minHeight>b?(ei(i,`min resolution of ${r.minHeight} > maximum of ${b}`),t):r.minFramerate>_?(ei(i,`min framerate of ${r.minFramerate} > maximum of ${_}`),t):m.some(e=>r.videoRanges[e]>0)?r.maxScore<g?(ei(i,`max score of ${r.maxScore} < selected max of ${g}`),t):t&&(mt(i)>=mt(t)||r.fragmentError>e[t].fragmentError)?t:(g=r.maxScore,i):(ei(i,`no variants with VIDEO-RANGE of ${JSON.stringify(m)} found`),t)},void 0);return{codecSet:T,videoRanges:m,preferHDR:v,minFramerate:f,minBitrate:p}}function ei(e,t){E.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function ti(e){return e.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function ni(e,t,n,i){return e.slice(n,i+1).reduce((e,n)=>{if(!n.codecSet)return e;const i=n.audioGroups;let r=e[n.codecSet];r||(e[n.codecSet]=r={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),r.minBitrate=Math.min(r.minBitrate,n.bitrate);const s=Math.min(n.height,n.width);return r.minHeight=Math.min(r.minHeight,s),r.minFramerate=Math.min(r.minFramerate,n.frameRate),r.maxScore=Math.max(r.maxScore,n.score),r.fragmentError+=n.fragmentError,r.videoRanges[n.videoRange]=(r.videoRanges[n.videoRange]||0)+1,i&&i.forEach(e=>{if(!e)return;const n=t.groups[e];n&&(r.hasDefaultAudio=r.hasDefaultAudio||t.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(n.channels).forEach(e=>{r.channels[e]=(r.channels[e]||0)+n.channels[e]}))}),e},{})}function ii(e,t,n){if("attrs"in e){const n=t.indexOf(e);if(-1!==n)return n}for(let i=0;i<t.length;i++){const r=t[i];if(ri(e,r,n))return i}return-1}function ri(e,t,n){const{groupId:i,name:r,lang:s,assocLang:a,characteristics:o,default:l}=e,u=e.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===s||t.lang===s)&&(void 0===s||t.assocLang===a)&&(void 0===l||t.default===l)&&(void 0===u||t.forced===u)&&(void 0===o||si(o,t.characteristics))&&(void 0===n||n(e,t))}function si(e,t=""){const n=e.split(","),i=t.split(",");return n.length===i.length&&!n.some(e=>-1===i.indexOf(e))}function ai(e,t){const{audioCodec:n,channels:i}=e;return(void 0===n||(t.audioCodec||"").substring(0,4)===n.substring(0,4))&&(void 0===i||i===(t.channels||"2"))}function oi(e,t,n,i,r){const s=t[i],a=t.reduce((e,t,n)=>{const i=t.uri,r=e[i]||(e[i]=[]);return r.push(n),e},{}),o=a[s.uri];o.length>1&&(i=Math.max.apply(Math,o));const l=s.videoRange,u=s.frameRate,c=s.codecSet.substring(0,4),d=li(t,i,t=>{if(t.videoRange!==l||t.frameRate!==u||t.codecSet.substring(0,4)!==c)return!1;const i=t.audioGroups,s=n.filter(e=>!i||-1!==i.indexOf(e.groupId));return ii(e,s,r)>-1});return d>-1?d:li(t,i,t=>{const i=t.audioGroups,s=n.filter(e=>!i||-1!==i.indexOf(e.groupId));return ii(e,s,r)>-1})}function li(e,t,n){for(let i=t;i;i--)if(n(e[i]))return i;for(let i=t+1;i<e.length;i++)if(n(e[i]))return i;return-1}class ui{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=(()=>{const{fragCurrent:e,partCurrent:t,hls:n}=this,{autoLevelEnabled:i,media:r}=n;if(!e||!r)return;const s=performance.now(),a=t?t.stats:e.stats,o=t?t.duration:e.duration,l=s-a.loading.start,u=n.minAutoLevel;if(a.aborted||a.loaded&&a.loaded===a.total||e.level<=u)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!i||r.paused||!r.playbackRate||!r.readyState)return;const c=n.mainForwardBufferInfo;if(null===c)return;const d=this.bwEstimator.getEstimateTTFB(),f=Math.abs(r.playbackRate);if(l<=Math.max(d,o/(2*f)*1e3))return;const p=c.len/f,m=a.loading.first?a.loading.first-a.loading.start:-1,v=a.loaded&&m>-1,y=this.getBwEstimate(),b=n.levels,_=b[e.level],T=a.total||Math.max(a.loaded,Math.round(o*_.averageBitrate/8));let S=v?l-m:l;S<1&&v&&(S=Math.min(l,8*a.loaded/y));const w=v?1e3*a.loaded/S:0,x=w?(T-a.loaded)/w:8*T/y+d/1e3;if(x<=p)return;const k=w?8*w:y;let A,I=Number.POSITIVE_INFINITY;for(A=e.level-1;A>u;A--){const e=b[A].maxBitrate;if(I=this.getTimeToLoadFrag(d/1e3,k,o*e,!b[A].details),I<p)break}if(I>=x)return;if(I>10*o)return;n.nextLoadLevel=n.nextAutoLevel=A,v?this.bwEstimator.sample(l-Math.min(d,m),a.loaded):this.bwEstimator.sampleTTFB(l);const C=b[A].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>C&&this.resetEstimator(C),this.clearTimer(),E.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${p.toFixed(3)} s\n      Estimated load time for current fragment: ${x.toFixed(3)} s\n      Estimated load time for down switch fragment: ${I.toFixed(3)} s\n      TTFB estimate: ${0|m} ms\n      Current BW estimate: ${h(y)?0|y:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${A} @ ${0|C} bps`),n.trigger(g.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:a})}),this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(E.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new zn(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.FRAG_LOADING,this.onFragLoading,this),e.on(g.FRAG_LOADED,this.onFragLoaded,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this),e.on(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(g.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.FRAG_LOADING,this.onFragLoading,this),e.off(g.FRAG_LOADED,this.onFragLoaded,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this),e.off(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(g.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(g.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){var i;if(!n.bitrateTest)this.fragCurrent=n,this.partCurrent=null!=(i=t.part)?i:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case v.BUFFER_ADD_CODEC_ERROR:case v.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case v.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:n,partCurrent:i}=this;if(e&&n&&e.sn===n.sn&&e.level===n.level){const t=performance.now(),n=i?i.stats:e.stats,r=t-n.loading.start,s=n.loading.first?n.loading.first-n.loading.start:-1,a=n.loaded&&s>-1;if(a){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(e,s),n.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}getTimeToLoadFrag(e,t,n,i){const r=e+n/t,s=i?this.lastLevelLoadSec:0;return r+s}onLevelLoaded(e,t){const n=this.hls.config,{loading:i}=t.stats,r=i.end-i.start;h(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:n}){const i=n?n.stats:t.stats;if(t.type===Ft.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=n?n.duration:t.duration,r=this.hls.levels[t.level],s=(r.loaded?r.loaded.bytes:0)+i.loaded,a=(r.loaded?r.loaded.duration:0)+e;r.loaded={bytes:s,duration:a},r.realBitrate=Math.round(8*s/a)}if(t.bitrateTest){const e={stats:i,frag:t,part:n,id:t.type};this.onFragBuffered(g.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,r=null!=i&&i.stats.loaded?i.stats:n.stats;if(r.aborted)return;if(this.ignoreFragment(n))return;const s=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,r.loaded),r.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Ft.MAIN||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(n,t,e,0,i,1,1);if(r>-1)return r;const s=this.hls.firstLevel,a=Math.min(Math.max(s,t),e);return E.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${s} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator,n=t.canEstimate(),i=this.lastLoadedFragLevel>-1;if(-1!==e&&(!n||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=n&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,r)&&t[e].loadError<=t[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this,{maxAutoLevel:i,config:r,minAutoLevel:s}=n,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let u=r.abrBandWidthFactor,c=r.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,s,i,l,0,u,c);if(e>=0)return e}let d=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){const t=a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay;d=t-e,E.info(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*d)} ms`),u=c=1}}const h=this.findBestLevel(o,s,i,l,d,u,c);if(E.info(`[abr] ${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`),h>-1)return h;const f=n.levels[s],p=n.levels[n.loadLevel];return(null==f?void 0:f.bitrate)<(null==p?void 0:p.bitrate)?s:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,i,r,s,a){var o;const l=i+r,u=this.lastLoadedFragLevel,c=-1===u?this.hls.firstLevel:u,{fragCurrent:d,partCurrent:f}=this,{levels:p,allAudioTracks:g,loadLevel:m,config:v}=this.hls;if(1===p.length)return 0;const y=p[c],b=!(null==y||null==(o=y.details)||!o.live),_=-1===m||-1===u;let T,S="SDR",w=(null==y?void 0:y.frameRate)||0;const{audioPreference:x,videoPreference:k}=v,A=this.audioTracksByGroup||(this.audioTracksByGroup=ti(g));if(_){if(-1!==this.firstSelection)return this.firstSelection;const i=this.codecTiers||(this.codecTiers=ni(p,A,t,n)),r=Jn(i,S,e,x,k),{codecSet:s,videoRanges:a,minFramerate:o,minBitrate:l,preferHDR:u}=r;T=s,S=u?a[a.length-1]:a[0],w=o,e=Math.max(e,l),E.log(`[abr] picked start tier ${JSON.stringify(r)}`)}else T=null==y?void 0:y.codecSet,S=null==y?void 0:y.videoRange;const I=f?f.duration:d?d.duration:0,C=this.bwEstimator.getEstimateTTFB()/1e3,D=[];for(let M=n;M>=t;M--){var R;const t=p[M],o=M>c;if(!t)continue;if(v.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const n=navigator.mediaCapabilities;"function"===typeof(null==n?void 0:n.decodingInfo)&&Kn(t,A,S,w,e,x)?(t.supportedPromise=Yn(t,A,n),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const n=this.hls.levels,i=n.indexOf(t);e.error?E.warn(`[abr] MediaCapabilities decodingInfo error: "${e.error}" for level ${i} ${JSON.stringify(e)}`):e.supported||(E.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${i} ${JSON.stringify(e)}`),i>-1&&n.length>1&&(E.log(`[abr] Removing unsupported level ${i}`),this.hls.removeLevel(i)))})):t.supportedResult=qn}if(T&&t.codecSet!==T||S&&t.videoRange!==S||o&&w>t.frameRate||!o&&w>0&&w<t.frameRate||t.supportedResult&&(null==(R=t.supportedResult.decodingInfoResults)||!R[0].smooth)){D.push(M);continue}const d=t.details,g=(f?null==d?void 0:d.partTarget:null==d?void 0:d.averagetargetduration)||I;let k;k=o?a*e:s*e;const L=I&&i>=2*I&&0===r?p[M].averageBitrate:p[M].maxBitrate,P=this.getTimeToLoadFrag(C,k,L*g,void 0===d),O=k>=L&&(M===u||0===t.loadError&&0===t.fragmentError)&&(P<=C||!h(P)||b&&!this.bitrateTestDelay||P<l);if(O){const e=this.forcedAutoLevel;return M===m||-1!==e&&e===m||(D.length&&E.trace(`[abr] Skipped level(s) ${D.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${p[D[0]].codecs}" ${p[D[0]].videoRange}; not compatible with "${y.codecs}" ${S}`),E.info(`[abr] switch candidate:${c}->${M} adjustedbw(${Math.round(k)})-bitrate=${Math.round(k-L)} ttfb:${C.toFixed(1)} avgDuration:${g.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${P.toFixed(1)} firstSelection:${_} codecSet:${T} videoRange:${S} hls.loadLevel:${m}`)),_&&(this.firstSelection=M),M}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls,i=Math.min(Math.max(e,n),t);this._nextAutoLevel!==i&&(this.nextAutoLevelKey="",this._nextAutoLevel=i)}}class ci{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var di={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class hi{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(g.BUFFER_APPENDED,this.onBufferAppended,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this),e.on(g.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.BUFFER_APPENDED,this.onBufferAppended,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this),e.off(g.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let i=n.length;i--;){const t=n[i];if(!t)break;const r=t.end;if(t.start<=e&&null!==r&&e<=r)return t}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:n}=this,i=Object.keys(n);for(let r=i.length;r--;){const s=n[i[r]];if((null==s?void 0:s.body.type)===t&&s.buffered){const t=s.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,n,i){this.timeRanges&&(this.timeRanges[e]=t);const r=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(i=>{const s=this.fragments[i];if(!s)return;if(r>=s.body.sn)return;if(!s.buffered&&!s.loaded)return void(s.body.type===n&&this.removeFragment(s.body));const a=s.range[e];a&&a.time.some(e=>{const n=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return n&&this.removeFragment(s.body),n})})}detectPartialFragments(e){const t=this.timeRanges,{frag:n,part:i}=e;if(!t||"initSegment"===n.sn)return;const r=pi(n),s=this.fragments[r];if(!s||s.buffered&&n.gap)return;const a=!n.relurl;if(Object.keys(t).forEach(e=>{const r=n.elementaryStreams[e];if(!r)return;const o=t[e],l=a||!0===r.partial;s.range[e]=this.getBufferedTimes(n,i,l,o)}),s.loaded=null,Object.keys(s.range).length){s.buffered=!0;const e=s.body.endList=n.endList||s.body.endList;e&&(this.endListFragments[s.body.type]=s),fi(s)||this.removeParts(n.sn-1,n.type)}else this.removeFragment(s.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=n.filter(t=>t.fragment.sn>=e))}fragBuffered(e,t){const n=pi(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,n,i){const r={time:[],partial:n},s=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||s;for(let u=0;u<i.length;u++){const e=i.start(u)-this.bufferPadding,t=i.end(u)+this.bufferPadding;if(l>=e&&o<=t){r.time.push({startPTS:Math.max(s,i.start(u)),endPTS:Math.min(a,i.end(u))});break}if(s<t&&a>e){const e=Math.max(s,i.start(u)),t=Math.min(a,i.end(u));t>e&&(r.partial=!0,r.time.push({startPTS:e,endPTS:t}))}else if(a<=e)break}return r}getPartialFragment(e){let t,n,i,r=null,s=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach(l=>{const u=o[l];u&&fi(u)&&(n=u.body.start-a,i=u.body.end+a,e>=n&&e<=i&&(t=Math.min(e-n,i-e),s<=t&&(r=u.body,s=t)))}),r}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||fi(t))}getState(e){const t=pi(e),n=this.fragments[t];return n?n.buffered?fi(n)?di.PARTIAL:di.OK:di.APPENDING:di.NOT_LOADED}isTimeBuffered(e,t,n){let i,r;for(let s=0;s<n.length;s++){if(i=n.start(s)-this.bufferPadding,r=n.end(s)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onFragLoaded(e,t){const{frag:n,part:i}=t;if("initSegment"===n.sn||n.bitrateTest)return;const r=i?null:t,s=pi(n);this.fragments[s]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:r}=t;if("initSegment"===n.sn)return;const s=n.type;if(i){let e=this.activePartLists[s];e||(this.activePartLists[s]=e=[]),e.push(i)}this.timeRanges=r,Object.keys(r).forEach(e=>{const t=r[e];this.detectEvictedFragments(e,t,s,i)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=pi(e);return!!this.fragments[t]}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,n,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach(s=>{const a=this.fragments[s];if(!a)return;const o=a.body;o.type!==n||i&&!o.gap||o.start<t&&o.end>e&&(a.buffered||r)&&this.removeFragment(o)})}removeFragment(e){const t=pi(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const t=e.sn;this.activePartLists[e.type]=n.filter(e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function fi(e){var t,n,i;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(n=e.range.audio)?void 0:n.partial)||(null==(i=e.range.audiovideo)?void 0:i.partial))}function pi(e){return`${e.type}_${e.level}_${e.sn}`}const gi={length:0,start:()=>0,end:()=>0};class mi{static isBuffered(e,t){try{if(e){const n=mi.getBuffered(e);for(let e=0;e<n.length;e++)if(t>=n.start(e)&&t<=n.end(e))return!0}}catch(e){}return!1}static bufferInfo(e,t,n){try{if(e){const i=mi.getBuffered(e),r=[];let s;for(s=0;s<i.length;s++)r.push({start:i.start(s),end:i.end(s)});return this.bufferedInfo(r,t,n)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.sort(function(e,t){const n=e.start-t.start;return n||t.end-e.end});let i=[];if(n)for(let l=0;l<e.length;l++){const t=i.length;if(t){const r=i[t-1].end;e[l].start-r<n?e[l].end>r&&(i[t-1].end=e[l].end):i.push(e[l])}else i.push(e[l])}else i=e;let r,s=0,a=t,o=t;for(let l=0;l<i.length;l++){const e=i[l].start,u=i[l].end;if(t+n>=e&&t<u)a=e,o=u,s=o-t;else if(t+n<e){r=e;break}}return{len:s,start:a||0,end:o||0,nextStart:r}}static getBuffered(e){try{return e.buffered}catch(e){return E.log("failed to get media.buffered",e),gi}}}class vi{constructor(e,t,n,i=0,r=-1,s=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=yi(),this.buffering={audio:yi(),video:yi(),audiovideo:yi()},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=r,this.partial=s}}function yi(){return{start:0,executeStart:0,executeEnd:0,end:0}}function bi(e,t){for(let i=0,r=e.length;i<r;i++){var n;if((null==(n=e[i])?void 0:n.cc)===t)return e[i]}return null}function _i(e,t,n){return!(!t||!(n.endCC>n.startCC||e&&e.cc<n.startCC))}function Ti(e,t){const n=e.fragments,i=t.fragments;if(!i.length||!n.length)return void E.log("No fragments to align");const r=bi(n,i[0].cc);if(r&&(!r||r.startPTS))return r;E.log("No frag in previous level to align on")}function Si(e,t){if(e){const n=e.start+t;e.start=e.startPTS=n,e.endPTS=n+e.duration}}function wi(e,t){const n=t.fragments;for(let i=0,r=n.length;i<r;i++)Si(n[i],e);t.fragmentHint&&Si(t.fragmentHint,e),t.alignedSliding=!0}function Ei(e,t,n){t&&(xi(e,n,t),!n.alignedSliding&&t&&ki(n,t),n.alignedSliding||!t||n.skippedSegments||_n(t,n))}function xi(e,t,n){if(_i(e,n,t)){const e=Ti(n,t);e&&h(e.start)&&(E.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),wi(e.start,t))}}function ki(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const n=e.fragments,i=t.fragments;if(!n.length||!i.length)return;let r,s;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(r=bi(i,a),s=bi(n,a)),r&&s||(r=i[Math.floor(i.length/2)],s=bi(n,r.cc)||n[Math.floor(n.length/2)]);const o=r.programDateTime,l=s.programDateTime;if(!o||!l)return;const u=(l-o)/1e3-(s.start-r.start);wi(u,e)}const Ai=Math.pow(2,17);class Ii{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Ri({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,s=i.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void l(Di(e));e.gap=!1}const u=this.loader=e.loader=r?new r(i):new s(i),c=Ci(e),d=Dn(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:Ai};e.stats=u.stats,u.load(c,h,{onSuccess:(t,n,i,r)=>{this.resetLoader(e,u);let s=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),a({frag:e,part:null,payload:s,networkDetails:r})},onError:(t,i,r,s)=>{this.resetLoader(e,u),l(new Ri({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:o({url:n,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:r,stats:s}))},onAbort:(t,n,i)=>{this.resetLoader(e,u),l(new Ri({type:m.NETWORK_ERROR,details:v.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:(t,n,i)=>{this.resetLoader(e,u),l(new Ri({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:i,stats:t}))},onProgress:(n,i,r,s)=>{t&&t({frag:e,part:null,payload:r,networkDetails:s})}})})}loadPart(e,t,n){this.abort();const i=this.config,r=i.fLoader,s=i.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void l(Di(e,t));const u=this.loader=e.loader=r?new r(i):new s(i),c=Ci(e,t),d=Dn(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ai};t.stats=u.stats,u.load(c,h,{onSuccess:(i,r,s,o)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const l={frag:e,part:t,payload:i.data,networkDetails:o};n(l),a(l)},onError:(n,i,r,s)=>{this.resetLoader(e,u),l(new Ri({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:o({url:c.url,data:void 0},n),error:new Error(`HTTP Error ${n.code} ${n.text}`),networkDetails:r,stats:s}))},onAbort:(n,i,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Ri({type:m.NETWORK_ERROR,details:v.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:r,stats:n}))},onTimeout:(n,i,r)=>{this.resetLoader(e,u),l(new Ri({type:m.NETWORK_ERROR,details:v.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:n}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,r=i.total;if(n.loaded+=i.loaded,r){const i=Math.round(e.duration/t.duration),s=Math.min(Math.round(n.loaded/r),i),a=i-s,o=a*Math.round(n.loaded/s);n.total=n.loaded+o}else n.total=Math.max(n.loaded,n.total);const s=n.loading,a=i.loading;s.start?s.first+=a.first-a.start:(s.start=a.start,s.first=a.first),s.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Ci(e,t=null){const n=t||e,i={frag:e,part:t,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},r=n.byteRangeStartOffset,s=n.byteRangeEndOffset;if(h(r)&&h(s)){var a;let t=r,n=s;if("initSegment"===e.sn&&"AES-128"===(null==(a=e.decryptdata)?void 0:a.method)){const e=s-r;e%16&&(n=s+(16-e%16)),0!==r&&(i.resetIV=!0,t=r-16)}i.rangeStart=t,i.rangeEnd=n}return i}function Di(e,t){const n=new Error(`GAP ${e.gap?"tag":"attribute"} found`),i={type:m.MEDIA_ERROR,details:v.FRAG_GAP,fatal:!1,frag:e,error:n,networkDetails:null};return t&&(i.part=t),(t||e).stats.aborted=!0,new Ri(i)}class Ri extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Mi{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class Li{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function Pi(e){const t=e.byteLength,n=t&&new DataView(e.buffer).getUint8(t-1);return n?ee(e,0,t-n):e}class Oi{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(4*i);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],r=n[1],s=n[2],a=n[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=new Uint32Array(256);let f=0,p=0,g=0;for(g=0;g<256;g++)h[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let n=p^p<<1^p<<2^p<<3^p<<4;n=n>>>8^255&n^99,e[f]=n,t[n]=f;const o=h[f],g=h[o],m=h[g];let v=257*h[n]^16843008*n;i[f]=v<<24|v>>>8,r[f]=v<<16|v>>>16,s[f]=v<<8|v>>>24,a[f]=v,v=16843009*m^65537*g^257*o^16843008*f,l[n]=v<<24|v>>>8,u[n]=v<<16|v>>>16,c[n]=v<<8|v>>>24,d[n]=v,f?(f=o^h[h[h[m^o]]],p^=h[h[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;while(i<t.length&&n)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const s=this.ksRows=4*(r+6+1);let a,o;const l=this.keySchedule=new Uint32Array(s),u=this.invKeySchedule=new Uint32Array(s),c=this.sBox,d=this.rcon,h=this.invSubMix,f=h[0],p=h[1],g=h[2],m=h[3];let v,y;for(a=0;a<s;a++)a<r?v=l[a]=t[a]:(y=v,a%r===0?(y=y<<8|y>>>24,y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y],y^=d[a/r|0]<<24):r>6&&a%r===4&&(y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y]),l[a]=v=(l[a-r]^y)>>>0);for(o=0;o<s;o++)a=s-o,y=3&o?l[a]:l[a-4],u[o]=o<4||a<=4?y:f[c[y>>>24]]^p[c[y>>>16&255]]^g[c[y>>>8&255]]^m[c[255&y]],u[o]=u[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,r=this.invKeySchedule,s=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],u=a[2],c=a[3],d=this.uint8ArrayToUint32Array_(n);let h=d[0],f=d[1],p=d[2],g=d[3];const m=new Int32Array(e),v=new Int32Array(m.length);let y,b,_,T,S,w,E,x,k,A,I,C,D,R;const M=this.networkToHostOrderSwap;while(t<m.length){for(k=M(m[t]),A=M(m[t+1]),I=M(m[t+2]),C=M(m[t+3]),S=k^r[0],w=C^r[1],E=I^r[2],x=A^r[3],D=4,R=1;R<i;R++)y=o[S>>>24]^l[w>>16&255]^u[E>>8&255]^c[255&x]^r[D],b=o[w>>>24]^l[E>>16&255]^u[x>>8&255]^c[255&S]^r[D+1],_=o[E>>>24]^l[x>>16&255]^u[S>>8&255]^c[255&w]^r[D+2],T=o[x>>>24]^l[S>>16&255]^u[w>>8&255]^c[255&E]^r[D+3],S=y,w=b,E=_,x=T,D+=4;y=s[S>>>24]<<24^s[w>>16&255]<<16^s[E>>8&255]<<8^s[255&x]^r[D],b=s[w>>>24]<<24^s[E>>16&255]<<16^s[x>>8&255]<<8^s[255&S]^r[D+1],_=s[E>>>24]<<24^s[x>>16&255]<<16^s[S>>8&255]<<8^s[255&w]^r[D+2],T=s[x>>>24]<<24^s[S>>16&255]<<16^s[w>>8&255]<<8^s[255&E]^r[D+3],v[t]=M(y^h),v[t+1]=M(T^f),v[t+2]=M(_^p),v[t+3]=M(b^g),h=k,f=A,p=I,g=C,t+=4}return v.buffer}}const Ni=16;class Ui{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Pi(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n){return this.useSoftware?new Promise((i,r)=>{this.softwareDecrypt(new Uint8Array(e),t,n);const s=this.flush();s?i(s.buffer):r(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n)}softwareDecrypt(e,t,n){const{currentIV:i,currentResult:r,remainderData:s}=this;this.logOnce("JS AES decrypt"),s&&(e=$e(s,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;i&&(n=i);let o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new Oi),o.expandKey(t);const l=r;return this.currentResult=o.decrypt(a.buffer,0,n),this.currentIV=ee(a,-16).buffer,l||null}webCryptoDecrypt(e,t,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n));this.key=t,this.fastAesKey=new Li(this.subtle,t)}return this.fastAesKey.expandKey().then(t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");const i=new Mi(this.subtle,new Uint8Array(n));return i.decrypt(e.buffer,t)}).catch(i=>{return E.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,n)})}onWebCryptoError(e,t,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n);const i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%Ni;return n!==e.length&&(t=ee(e,0,n),this.remainderData=ee(e,n)),t}logOnce(e){this.logEnabled&&(E.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Fi={toString:function(e){let t="";const n=e.length;for(let i=0;i<n;i++)t+=`[${e.start(i).toFixed(3)}-${e.end(i).toFixed(3)}]`;return t}},Bi={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class ji extends ci{constructor(e,t,n,i,r){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Bi.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=r,this.logPrefix=i,this.log=E.log.bind(E,`${i}:`),this.warn=E.warn.bind(E,`${i}:`),this.hls=e,this.fragmentLoader=new Ii(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ui(e.config),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Bi.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const n=t.partList;if(null!=n&&n.length){const e=n[n.length-1],t=mi.isBuffered(this.media,e.start+e.duration/2);return t}const i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)}getLevelDetails(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);const i=this.config;this.levels&&i.autoStartLoad&&this.state===Bi.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:n,mediaBuffer:i,state:r}=this,s=n?n.currentTime:0,a=mi.bufferInfo(i||n,s,e.maxBufferHole);if(this.log(`media seeking to ${h(s)?s.toFixed(3):s}, state: ${r}`),this.state===Bi.ENDED)this.resetLoadingState();else if(t){const n=e.maxFragLookUpTolerance,i=t.start-n,r=t.start+t.duration+n;if(!a.len||r<a.start||i>a.end){const e=s>r;(s<i||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}n&&(this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0),this.lastCurrentTime=s),this.loadedmetadata||a.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=Bi.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const i=t=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)};this._doFragLoad(e,t,n,i).then(t=>{if(!t)return;const n=this.state;this.fragContextChanged(e)?(n===Bi.FRAG_LOADING||!this.fragCurrent&&n===Bi.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=Bi.IDLE):("payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(g.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))}).catch(t=>{this.state!==Bi.STOPPED&&this.state!==Bi.ERROR&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this,i=n.getState(e);if(i===di.APPENDING){const t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,i?i.len:this.config.maxBufferLength),s=this.backtrackFragment,a=s?e.sn-s.sn:0;(1===a||this.reduceMaxBufferLength(r,e.duration))&&n.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===di.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:n};this.hls.trigger(g.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t}).then(t=>{const{hls:n}=this,{payload:i}=t,r=e.decryptdata;if(i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&"AES-128"===r.method){const s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).catch(t=>{throw n.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t}).then(i=>{const r=self.performance.now();return n.trigger(g.FRAG_DECRYPTED,{frag:e,payload:i,stats:{tstart:s,tdecrypt:r}}),t.payload=i,this.completeInitSegmentLoad(t)})}return this.completeInitSegmentLoad(t)}).catch(t=>{this.state!==Bi.STOPPED&&this.state!==Bi.ERROR&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state=Bi.IDLE,e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var n,i,r,s;const a=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===Ft.MAIN?"level":"track"} ${e.level} (frag:[${(null!=(n=e.startPTS)?n:NaN).toFixed(3)}-${(null!=(i=e.endPTS)?i:NaN).toFixed(3)}] > buffer:${a?Fi.toString(mi.getBuffered(a)):"(detached)"})`),"initSegment"!==e.sn){var o;if(e.type!==Ft.SUBTITLE){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=Bi.IDLE)}const t=null==(o=this.levels)?void 0:o[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=Bi.IDLE,a&&(!this.loadedmetadata&&e.type==Ft.MAIN&&a.buffered.length&&(null==(r=this.fragCurrent)?void 0:r.sn)===(null==(s=this.fragPrevious)?void 0:s.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:r}=e,s=!r||0===r.length||r.some(e=>!e),a=new vi(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!s);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,i){var r;const s=null==t?void 0:t.details;if(!this.levels||!s)throw new Error(`frag load aborted, missing level${s?"":" detail"}s`);let a=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&s.encryptedFragments.length&&this.keyLoader.loadClear(e,s.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${s.startSN}-${s.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=Bi.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(g.KEY_LOADED,e),this.state===Bi.KEY_LOADING&&(this.state=Bi.IDLE),e}),this.hls.trigger(g.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),n=Math.max(e.start,n||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const r=s.partList;if(r&&i){n>e.end&&s.fragmentHint&&(e=s.fragmentHint);const o=this.getNextPart(r,e,n);if(o>-1){const l=r[o];let u;return this.log(`Loading part sn: ${e.sn} p: ${l.index} cc: ${e.cc} of playlist [${s.startSN}-${s.endSN}] parts [0-${o}-${r.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=Bi.FRAG_LOADING,u=a?a.then(n=>{return!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(e,l,t,i)}).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,l,t,i).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(g.FRAG_LOADING,{frag:e,part:l,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):u}if(!e.url||this.loadedEndOfParts(r,n))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${s?"of ["+s.startSN+"-"+s.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),h(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Bi.FRAG_LOADING;const o=this.config.progressive;let l;return l=o&&a?a.then(t=>{return!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,i)}).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,o?i:void 0),a]).then(([e])=>{return!o&&e&&i&&i(e),e}).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(g.FRAG_LOADING,{frag:e,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(e,t,n,i){return new Promise((r,s)=>{var a;const o=[],l=null==(a=n.details)?void 0:a.partList,u=t=>{this.fragmentLoader.loadPart(e,t,i).then(i=>{o[t.index]=i;const s=i.part;this.hls.trigger(g.FRAG_LOADED,i);const a=En(n,e.sn,t.index+1)||xn(l,e.sn,t.index+1);if(!a)return r({frag:e,part:s,partsLoaded:o});u(a)}).catch(s)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===v.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(g.ERROR,t)}else this.hls.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Bi.PARSING)return void(this.fragCurrent||this.state===Bi.STOPPED||this.state===Bi.ERROR||(this.state=Bi.IDLE));const{frag:n,part:i,level:r}=t,s=self.performance.now();n.stats.parsing.end=s,i&&(i.stats.parsing.end=s),this.updateLevelTiming(n,i,r,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:r,part:s}=e;if(null==t||!t[i])return this.warn(`Levels object was unset while buffering fragment ${r} of level ${i}. The current chunk will not be buffered.`),null;const a=t[i],o=s>-1?En(a,r,s):null,l=o?o.fragment:wn(a,r,n);return l?(n&&n!==l&&(l.stats=n.stats),{frag:l,part:o,level:a}):null}bufferFragmentData(e,t,n,i,r){var s;if(!e||this.state!==Bi.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(a&&o&&(l=$e(a,o)),null==(s=l)||!s.length)return;const u={type:e.type,frag:t,part:n,chunkMeta:i,parent:t.type,data:l};if(this.hls.trigger(g.BUFFER_APPENDING,u),e.dropped&&e.independent&&!n){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!mi.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const n=t.currentTime,i=mi.bufferInfo(t,n,0),r=e.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),a=Math.max(Math.min(e.start-s,i.end-s),n+s);e.start-a>s&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const n=this.getLoadPosition();return h(n)?this.getFwdBufferInfoAtPos(e,n,t):null}getFwdBufferInfoAtPos(e,t,n){const{config:{maxBufferHole:i}}=this,r=mi.bufferInfo(e,t,i);if(0===r.len&&void 0!==r.nextStart){const s=this.fragmentTracker.getBufferedFrag(t,n);if(s&&r.nextStart<s.end)return mi.bufferInfo(e,t,Math.max(r.nextStart,i))}return r}getMaxBufferLength(e){const{config:t}=this;let n;return n=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,i=Math.max(Math.min(e-t,n.maxBufferLength),t),r=Math.max(e-3*t,n.maxMaxBufferLength/2,i);return r>=i&&(n.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0)}getAppendedFrag(e,t=Ft.MAIN){const n=this.fragmentTracker.getAppendedFrag(e,Ft.MAIN);return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:r}=this,s=n[0].start;let a;if(t.live){const o=r.initialLiveManifestSize;if(i<o)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${o})`),null;(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<s)&&(a=this.getInitialLiveFragment(t,n),this.startPosition=this.nextLoadPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=s&&(a=n[0]);if(!a){const n=r.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,n,t)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===di.OK||n===di.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,r){const s=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(null===a)return a;if(e=a,s&&e&&!e.gap&&n.nextStart){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i);if(null!==t&&n.len+t.len>=r)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,n){let i=-1,r=!1,s=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(s=s&&!o.independent,i>-1&&n<o.start)break;const l=o.loaded;l?i=-1:(r||o.independent||s)&&o.fragment===t&&(i=a),r=l}return i}loadedEndOfParts(e,t){const n=e[e.length-1];return n&&t>n.start&&n.loaded}getInitialLiveFragment(e,t){const n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=Pn(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=n.sn+1;if(r>=e.startSN&&r<=e.endSN){const s=t[r-e.startSN];n.cc===s.cc&&(i=s,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Bn(t,n.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(i=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:r}=this,{fragments:s,endSN:a}=n;const{fragmentHint:o}=n,{maxFragLookUpTolerance:l}=i,u=n.partList,c=!!(i.lowLatencyMode&&null!=u&&u.length&&o);let d;if(c&&o&&!this.bitrateTest&&(s=s.concat(o),a=o.sn),e<t){const n=e>t-l?0:l;d=On(r,s,e,n)}else d=s[s.length-1];if(d){const e=d.sn-n.startSN,t=this.fragmentTracker.getState(d);if((t===di.OK||t===di.PARTIAL&&d.gap)&&(r=d),r&&d.sn===r.sn&&(!c||u[0].fragment.sn>d.sn)){const t=r&&d.level===r.level;if(t){const t=s[e+1];d=d.sn<a&&this.fragmentTracker.getState(t)!==di.OK?t:null}}}return d}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,r=n.currentTime,s=e.fragments[0].start,a=e.edge,o=r>=s-t.maxFragLookUpTolerance&&r<=a;if(null!==i&&n.duration>i&&(r<i||!o)){const s=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&n.readyState<4||r<a-s)&&(this.loadedmetadata||(this.nextLoadPosition=i),n.readyState&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),n.currentTime=i))}}alignPlaylists(e,t,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragments[0].start,s=!t,a=e.alignedSliding&&h(r);if(s||!a&&!r){const{fragPrevious:r}=this;Ei(r,n,e);const s=e.fragments[0].start;return this.log(`Live playlist sliding: ${s.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${r?r.sn:"na"} fragments: ${i}`),s}return r}waitForCdnTuneIn(e){const t=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*t)}setStartPosition(e,t){let n=this.startPosition;if(n<t&&(n=-1),-1===n||-1===this.lastCurrentTime){const i=null!==this.startTimeOffset,r=i?this.startTimeOffset:e.startTimeOffset;null!==r&&h(r)?(n=t+r,r<0&&(n+=e.totalduration),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Start time offset ${r} found in ${i?"multivariant":"media"} playlist, adjust startPosition to ${n}`),this.startPosition=n):e.live?n=this.hls.liveSyncPosition||t:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Bi.FRAG_LOADING_WAITING_RETRY)||(this.state=Bi.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;var i;if(this.fragContextChanged(n))return void this.warn(`Frag load error must match current frag to retry ${n.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const r=t.details===v.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(n,!0);const s=t.errorAction,{action:a,retryCount:o=0,retryConfig:l}=s||{};if(s&&a===jn.RetryRequest&&l){this.resetStartWhenNotLoaded(this.levelLastLoaded);const i=Cn(l,o);this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${o+1}/${l.maxNumRetry} in ${i}ms`),s.resolved=!0,this.retryDate=self.performance.now()+i,this.state=Bi.FRAG_LOADING_WAITING_RETRY}else if(l&&s){if(this.resetFragmentErrors(e),!(o<l.maxNumRetry))return void E.warn(`${t.details} reached or exceeded max retry (${o})`);r||a===jn.RemoveAlternatePermanently||(s.resolved=!0)}else(null==s?void 0:s.action)===jn.SendAlternateToPenaltyBox?this.state=Bi.WAITING_LEVEL:this.state=Bi.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Bi.PARSING||this.state===Bi.PARSED){const t=e.frag,n=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);const s=!r;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===Ft.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Bi.STOPPED&&(this.state=Bi.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const i=mi.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===Bi.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Bi.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){var r;const s=n.details;if(!s)return void this.warn("level.details undefined");const a=Object.keys(e.elementaryStreams).reduce((t,r)=>{const a=e.elementaryStreams[r];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${r} duration reliably (${o})`),t||!1;const l=i?0:gn(s,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS);return this.hls.trigger(g.LEVEL_PTS_UPDATED,{details:s,level:n,drift:l,type:r,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t},!1);if(!a&&null===(null==(r=this.transmuxer)?void 0:r.error)){const t=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===n.fragmentError&&(n.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(t.message),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of level "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=Bi.PARSED,this.hls.trigger(g.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class Vi{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;return e.length?(n=1===e.length?e[0]:Hi(e,t),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function Hi(e,t){const n=new Uint8Array(t);let i=0;for(let r=0;r<e.length;r++){const t=e[r];n.set(t,i),i+=t.length}return n}function $i(){return"function"===typeof __HLS_WORKER_BUNDLE__}function Gi(){const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n=new self.Worker(t);return{worker:n,objectURL:t}}function zi(e){const t=new self.URL(e,self.location.href).href,n=new self.Worker(t);return{worker:n,scriptURL:t}}function qi(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Wi{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=$e(this.cachedData,e),this.cachedData=null);let n,i=ie(e,0),r=i?i.length:0;const s=this._audioTrack,a=this._id3Track,o=i?ae(i):void 0,l=e.length;(null===this.basePTS||0===this.frameIndex&&h(o))&&(this.basePTS=Ki(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Yt.audioId3,duration:Number.POSITIVE_INFINITY});while(r<l){if(this.canParse(e,r)){const t=this.appendFrame(s,e,r);t?(this.frameIndex++,this.lastPTS=t.sample.pts,r+=t.length,n=r):r=l}else se(e,r)?(i=ie(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Yt.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,n=r):r++;if(r===l&&n!==l){const t=ee(e,n);this.cachedData?this.cachedData=$e(this.cachedData,t):this.cachedData=t}}return{audioTrack:s,videoTrack:qi(),id3Track:a,textTrack:qi()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:qi(),id3Track:this._id3Track,textTrack:qi()}}destroy(){}}const Ki=(e,t,n)=>{if(h(e))return 90*e;const i=n?9e4*n.baseTime/n.timescale:0;return 9e4*t+i};function Yi(e,t,n,i){let r,s,a,o;const l=navigator.userAgent.toLowerCase(),u=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=1+((192&t[n+2])>>>6);const d=(60&t[n+2])>>>2;if(!(d>c.length-1))return a=(1&t[n+2])<<2,a|=(192&t[n+3])>>>6,E.log(`manifest codec:${i}, ADTS type:${r}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(r=5,o=new Array(4),s=d-3):(r=2,o=new Array(2),s=d):-1!==l.indexOf("android")?(r=2,o=new Array(2),s=d):(r=5,o=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&d>=6?s=d-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(d>=6&&1===a||/vivaldi/i.test(l))||!i&&1===a)&&(r=2,o=new Array(2)),s=d)),o[0]=r<<3,o[0]|=(14&d)>>1,o[1]|=(1&d)<<7,o[1]|=a<<3,5===r&&(o[1]|=(14&s)>>1,o[2]=(1&s)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:c[d],channelCount:a,codec:"mp4a.40."+r,manifestCodec:u};{const t=new Error(`invalid ADTS sampling index:${d}`);e.emit(g.ERROR,g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}}function Xi(e,t){return 255===e[t]&&240===(246&e[t+1])}function Qi(e,t){return 1&e[t+1]?7:9}function Zi(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function Ji(e,t){return t+5<e.length}function er(e,t){return t+1<e.length&&Xi(e,t)}function tr(e,t){return Ji(e,t)&&Xi(e,t)&&Zi(e,t)<=e.length-t}function nr(e,t){if(er(e,t)){const n=Qi(e,t);if(t+n>=e.length)return!1;const i=Zi(e,t);if(i<=n)return!1;const r=t+i;return r===e.length||er(e,r)}return!1}function ir(e,t,n,i,r){if(!e.samplerate){const s=Yi(t,n,i,r);if(!s)return;e.config=s.config,e.samplerate=s.samplerate,e.channelCount=s.channelCount,e.codec=s.codec,e.manifestCodec=s.manifestCodec,E.log(`parsed codec:${e.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function rr(e){return 9216e4/e}function sr(e,t){const n=Qi(e,t);if(t+n<=e.length){const i=Zi(e,t)-n;if(i>0)return{headerLength:n,frameLength:i}}}function ar(e,t,n,i,r){const s=rr(e.samplerate),a=i+r*s,o=sr(t,n);let l;if(o){const{frameLength:i,headerLength:r}=o,s=r+i,u=Math.max(0,n+s-t.length);u?(l=new Uint8Array(s-r),l.set(t.subarray(n+r,t.length),0)):l=t.subarray(n+r,n+s);const c={unit:l,pts:a};return u||e.samples.push(c),{sample:c,length:s,missing:u}}const u=t.length-n;l=new Uint8Array(u),l.set(t.subarray(n,t.length),0);const c={unit:l,pts:a};return{sample:c,length:u,missing:-1}}let or=null;const lr=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],ur=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],cr=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],dr=[0,1,1,4];function hr(e,t,n,i,r){if(n+24>t.length)return;const s=fr(t,n);if(s&&n+s.frameLength<=t.length){const a=9e4*s.samplesPerFrame/s.sampleRate,o=i+r*a,l={unit:t.subarray(n,n+s.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function fr(e,t){const n=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,s=e[t+2]>>2&3;if(1!==n&&0!==r&&15!==r&&3!==s){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=3===n?3-i:3===i?3:4,u=1e3*lr[14*l+r-1],c=3===n?0:2===n?1:2,d=ur[3*c+s],h=3===o?1:2,f=cr[n][i],p=dr[i],g=8*f*p,m=Math.floor(f*u/d+a)*p;if(null===or){const e=navigator.userAgent||"",t=e.match(/Chrome\/(\d+)/i);or=t?parseInt(t[1]):0}const v=!!or&&or<=87;return v&&2===i&&u>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:d,channelCount:h,frameLength:m,samplesPerFrame:g}}}function pr(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function gr(e,t){return t+1<e.length&&pr(e,t)}function mr(e,t){const n=4;return pr(e,t)&&n<=e.length-t}function vr(e,t){if(t+1<e.length&&pr(e,t)){const n=4,i=fr(e,t);let r=n;null!=i&&i.frameLength&&(r=i.frameLength);const s=t+r;return s===e.length||gr(e,s)}return!1}class yr extends Wi{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ie(e,0);let n=(null==t?void 0:t.length)||0;if(vr(e,n))return!1;for(let i=e.length;n<i;n++)if(nr(e,n))return E.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return tr(e,t)}appendFrame(e,t,n){ir(e,this.observer,t,n,e.manifestCodec);const i=ar(e,t,n,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}}const br=/\/emsg[-/]ID3/i;class _r{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const r=this.videoTrack=qi("video",1),s=this.audioTrack=qi("audio",1),a=this.txtTrack=qi("text",1);if(this.id3Track=qi("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=Re(e);if(o.video){const{id:e,timescale:t,codec:n}=o.video;r.id=e,r.timescale=a.timescale=t,r.codec=n}if(o.audio){const{id:e,timescale:t,codec:n}=o.audio;s.id=e,s.timescale=t,s.codec=n}a.id=Te.text,r.sampleDuration=0,r.duration=s.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return Ie(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=$e(this.remainderData,e));const t=He(n);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=n;const s=this.extractID3Track(i,t);return r.samples=Ge(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=Ge(e,t),{videoTrack:t,audioTrack:qi(),id3Track:i,textTrack:qi()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=Ce(e.samples,["emsg"]);i&&i.forEach(e=>{const i=Ye(e);if(br.test(i.schemeIdUri)){const e=h(i.presentationTime)?i.presentationTime/i.timeScale:t+i.presentationTimeDelta/i.timeScale;let r=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const s=i.payload;n.samples.push({data:s,len:s.byteLength,dts:e,pts:e,type:Yt.emsg,duration:r})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const Tr=(e,t)=>{let n=0,i=5;t+=i;const r=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);while(i>0){a[0]=e[t];const o=Math.min(i,8),l=8-o;s[0]=4278190080>>>24+l<<l,r[0]=(a[0]&s[0])>>l,n=n?n<<o|r[0]:r[0],t+=1,i-=o}return n};class Sr extends Wi{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=wr(e,t,n,this.basePTS,this.frameIndex);if(-1!==i){const t=e.samples[e.samples.length-1];return{sample:t,length:i,missing:0}}}static probe(e){if(!e)return!1;const t=ie(e,0);if(!t)return!1;const n=t.length;return 11===e[n]&&119===e[n+1]&&void 0!==ae(t)&&Tr(e,n)<16}}function wr(e,t,n,i,r){if(n+8>t.length)return-1;if(11!==t[n]||119!==t[n+1])return-1;const s=t[n+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3],o=a[s],l=63&t[n+4],u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920],c=2*u[3*l+s];if(n+c>t.length)return-1;const d=t[n+6]>>5;let h=0;2===d?h+=2:(1&d&&1!==d&&(h+=2),4&d&&(h+=2));const f=(t[n+6]<<8|t[n+7])>>12-h&1,p=[2,1,2,3,3,4,4,5],g=p[d]+f,m=t[n+5]>>3,v=7&t[n+5],y=new Uint8Array([s<<6|m<<1|v>>2,(3&v)<<6|d<<3|f<<2|l>>4,l<<4&224]),b=1536/o*9e4,_=i+r*b,T=t.subarray(n,n+c);return e.config=y,e.channelCount=g,e.samplerate=o,e.samples.push({unit:T,pts:_}),c}class Er{constructor(){this.VideoSample=null}createVideoSample(e,t,n,i){return{key:e,frame:!1,pts:t,dts:n,units:[],debug:i,length:0}}getLastNalUnit(e){var t;let n,i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){const e=i.units;n=e[e.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const n=t.samples,i=n.length;if(!i)return void t.dropped++;{const t=n[i-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}e.debug.length&&E.log(e.pts+"/"+e.dts+":"+e.debug)}}class xr{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");i.set(e.subarray(n,n+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&E.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t,n=8,i=8;for(let r=0;r<e;r++)0!==i&&(t=this.readEG(),i=(n+t+256)%256),n=0===i?n:i}readSPS(){let e,t,n,i=0,r=0,s=0,a=0;const o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),d=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();const g=o();if(l(5),d(3),o(),f(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){const e=u();if(3===e&&d(1),f(),f(),d(1),c())for(t=3!==e?8:12,n=0;n<t;n++)c()&&p(n<6?16:64)}f();const m=u();if(0===m)u();else if(1===m)for(d(1),h(),h(),e=u(),n=0;n<e;n++)h();f(),d(1);const v=u(),y=u(),b=l(1);0===b&&d(1),d(1),c()&&(i=u(),r=u(),s=u(),a=u());let _=[1,1];if(c()&&c()){const e=o();switch(e){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[o()<<8|o(),o()<<8|o()];break}}return{width:Math.ceil(16*(v+1)-2*i-2*r),height:(2-b)*(y+1)*16-(b?2:4)*(s+a),pixelRatio:_}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class kr extends Er{parseAVCPES(e,t,n,i,r){const s=this.parseAVCNALu(e,n.data);let a,o=this.VideoSample,l=!1;n.data=null,o&&s.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"")),s.forEach(i=>{var s;switch(i.type){case 1:{let t=!1;a=!0;const r=i.data;if(l&&r.length>4){const e=new xr(r).readSliceType();2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var u;if(t)null!=(u=o)&&u.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null);o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts,"")),o.frame=!0,o.key=t;break}case 5:a=!0,null!=(s=o)&&s.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts,"")),o.key=!0,o.frame=!0;break;case 6:a=!0,We(i.data,1,n.pts,t.samples);break;case 7:{var c,d;a=!0,l=!0;const t=i.data,n=new xr(t),s=n.readSPS();if(!e.sps||e.width!==s.width||e.height!==s.height||(null==(c=e.pixelRatio)?void 0:c[0])!==s.pixelRatio[0]||(null==(d=e.pixelRatio)?void 0:d[1])!==s.pixelRatio[1]){e.width=s.width,e.height=s.height,e.pixelRatio=s.pixelRatio,e.sps=[t],e.duration=r;const n=t.subarray(1,4);let i="avc1.";for(let e=0;e<3;e++){let t=n[e].toString(16);t.length<2&&(t="0"+t),i+=t}e.codec=i}break}case 8:a=!0,e.pps=[i.data];break;case 9:a=!0,e.audFound=!0,o&&this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"");break;case 12:a=!0;break;default:a=!1,o&&(o.debug+="unknown NAL "+i.type+" ");break}if(o&&a){const e=o.units;e.push(i)}}),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}parseAVCNALu(e,t){const n=t.byteLength;let i=e.naluState||0;const r=i,s=[];let a,o,l,u=0,c=-1,d=0;-1===i&&(c=0,d=31&t[0],i=0,u=1);while(u<n)if(a=t[u++],i)if(1!==i)if(a)if(1===a){if(o=u-i-1,c>=0){const e={data:t.subarray(c,o),type:d};s.push(e)}else{const n=this.getLastNalUnit(e.samples);n&&(r&&u<=4-r&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-r)),o>0&&(n.data=$e(n.data,t.subarray(0,o)),n.state=0))}u<n?(l=31&t[u],c=u,d=l,i=0):i=-1}else i=0;else i=3;else i=a?0:2;else i=a?0:1;if(c>=0&&i>=0){const e={data:t.subarray(c,n),type:d,state:i};s.push(e)}if(0===s.length){const n=this.getLastNalUnit(e.samples);n&&(n.data=$e(n.data,t))}return e.naluState=i,s}}class Ar{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Ui(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),s=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(s).then(r=>{const s=new Uint8Array(r);i.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)})}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)n.set(e.subarray(r,r+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)e.set(n.subarray(i,i+16),r);return e}decryptAvcSample(e,t,n,i,r){const s=Ke(r.data),a=this.getAvcEncryptedData(s);this.decryptBuffer(a.buffer).then(a=>{r.data=this.getAvcDecryptedUnit(s,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)})}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length)return void i();const r=e[t].units;for(;;n++){if(n>=r.length)break;const s=r[n];if(!(s.data.length<=48||1!==s.type&&5!==s.type)&&(this.decryptAvcSample(e,t,n,i,s),!this.decrypter.isSync()))return}}}}const Ir=188;class Cr{constructor(e,t,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.videoParser=new kr}static probe(e){const t=Cr.syncOffset(e);return t>0&&E.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static syncOffset(e){const t=e.length;let n=Math.min(5*Ir,t-Ir)+1,i=0;while(i<n){let r=!1,s=-1,a=0;for(let o=i;o<t;o+=Ir){if(71!==e[o]||t-o!==Ir&&71!==e[o+Ir]){if(a)return-1;break}if(a++,-1===s&&(s=o,0!==s&&(n=Math.min(s+99*Ir,e.length-Ir)+1)),r||(r=0===Dr(e,o)),r&&a>1&&(0===s&&a>2||o+Ir>n))return s}i++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Te[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Cr.createTrack("video"),this._audioTrack=Cr.createTrack("audio",i),this._id3Track=Cr.createTrack("id3"),this._txtTrack=Cr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n,this._duration=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,i=!1){let r;n||(this.sampleAes=null);const s=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let u=s.pid,c=s.pesData,d=a.pid,h=o.pid,f=a.pesData,p=o.pesData,g=null,m=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(e=$e(this.remainderData,e),y=e.length,this.remainderData=null),y<Ir&&!i)return this.remainderData=e,{audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};const b=Math.max(0,Cr.syncOffset(e));y-=(y-b)%Ir,y<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let _=0;for(let S=b;S<y;S+=Ir)if(71===e[S]){const t=!!(64&e[S+1]),i=Dr(e,S),y=(48&e[S+3])>>4;let _;if(y>1){if(_=S+5+e[S+4],_===S+Ir)continue}else _=S+4;switch(i){case u:t&&(c&&(r=Or(c))&&this.videoParser.parseAVCPES(s,l,r,!1,this._duration),c={data:[],size:0}),c&&(c.data.push(e.subarray(_,S+Ir)),c.size+=S+Ir-_);break;case d:if(t){if(f&&(r=Or(f)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r);break;case"ac3":this.parseAC3PES(a,r);break}f={data:[],size:0}}f&&(f.data.push(e.subarray(_,S+Ir)),f.size+=S+Ir-_);break;case h:t&&(p&&(r=Or(p))&&this.parseID3PES(o,r),p={data:[],size:0}),p&&(p.data.push(e.subarray(_,S+Ir)),p.size+=S+Ir-_);break;case 0:t&&(_+=e[_]+1),v=this._pmtId=Rr(e,_);break;case v:{t&&(_+=e[_]+1);const i=Mr(e,_,this.typeSupported,n,this.observer);u=i.videoPid,u>0&&(s.pid=u,s.segmentCodec=i.segmentVideoCodec),d=i.audioPid,d>0&&(a.pid=d,a.segmentCodec=i.segmentAudioCodec),h=i.id3Pid,h>0&&(o.pid=h),null===g||m||(E.warn(`MPEG-TS PMT found at ${S} after unknown PID '${g}'. Backtracking to sync byte @${b} to parse all TS packets.`),g=null,S=b-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=i;break}}else _++;_>0&&Lr(this.observer,new Error(`Found ${_} TS packet/s that do not start with 0x47`)),s.pesData=c,a.pesData=f,o.pesData=p;const T={audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(T),T}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:r}=e,s=n.pesData,a=t.pesData,o=i.pesData;let l;if(s&&(l=Or(s))?(this.videoParser.parseAVCPES(n,r,l,!0,this._duration),n.pesData=null):n.pesData=s,a&&(l=Or(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l);break}t.pesData=null}else null!=a&&a.size&&E.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=Or(o))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),r=this.sampleAes=new Ar(this.observer,this.config,t);return this.decrypt(i,r)}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{n(e)}):n(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{n(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let r,s,a,o=t.data;if(i){this.aacOverFlow=null;const t=i.missing,r=i.sample.unit.byteLength;if(-1===t)o=$e(i.sample.unit,o);else{const s=r-t;i.sample.unit.set(o.subarray(0,t),s),e.samples.push(i.sample),n=i.missing}}for(r=n,s=o.length;r<s-1;r++)if(er(o,r))break;if(r!==n){let e;const t=r<s-1;if(e=t?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES",Lr(this.observer,new Error(e),t),!t)return}if(ir(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!i)return void E.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=rr(e.samplerate);a=i.sample.pts+t}}let l,u=0;while(r<s){if(l=ar(e,o,r,a,u),r+=l.length,l.missing){this.aacOverFlow=l;break}for(u++;r<s-1;r++)if(er(o,r))break}}parseMPEGPES(e,t){const n=t.data,i=n.length;let r=0,s=0;const a=t.pts;if(void 0!==a)while(s<i)if(gr(n,s)){const t=hr(e,n,s,a,r);if(!t)break;s+=t.length,r++}else s++;else E.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(void 0===i)return void E.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=n.length;let s,a=0,o=0;while(o<r&&(s=wr(e,n,o,i,a++))>0)o+=s}}parseID3PES(e,t){if(void 0===t.pts)return void E.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=d({},t,{type:this._videoTrack?Yt.emsg:Yt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function Dr(e,t){return((31&e[t+1])<<8)+e[t+2]}function Rr(e,t){return(31&e[t+10])<<8|e[t+11]}function Mr(e,t,n,i,r){const s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(15&e[t+1])<<8|e[t+2],o=t+3+a-4,l=(15&e[t+10])<<8|e[t+11];t+=12+l;while(t<o){const a=Dr(e,t),o=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){Pr("ADTS AAC");break}case 15:-1===s.audioPid&&(s.audioPid=a);break;case 21:-1===s.id3Pid&&(s.id3Pid=a);break;case 219:if(!i){Pr("H.264");break}case 27:-1===s.videoPid&&(s.videoPid=a,s.segmentVideoCodec="avc");break;case 3:case 4:n.mpeg||n.mp3?-1===s.audioPid&&(s.audioPid=a,s.segmentAudioCodec="mp3"):E.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){Pr("AC-3");break}case 129:n.ac3?-1===s.audioPid&&(s.audioPid=a,s.segmentAudioCodec="ac3"):E.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===s.audioPid&&o>0){let i=t+5,r=o;while(r>2){const t=e[i];switch(t){case 106:!0!==n.ac3?E.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=a,s.segmentAudioCodec="ac3");break}const o=e[i+1]+2;i+=o,r-=o}}break;case 194:case 135:return Lr(r,new Error("Unsupported EC-3 in M2TS found")),s;case 36:return Lr(r,new Error("Unsupported HEVC in M2TS found")),s}t+=o+5}return s}function Lr(e,t,n){E.warn(`parsing error: ${t.message}`),e.emit(g.ERROR,g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:t,reason:t.message})}function Pr(e){E.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function Or(e){let t,n,i,r,s,a=0;const o=e.data;if(!e||0===e.size)return null;while(o[0].length<19&&o.length>1)o[0]=$e(o[0],o[1]),o.splice(1,1);t=o[0];const l=(t[0]<<16)+(t[1]<<8)+t[2];if(1===l){if(n=(t[4]<<8)+t[5],n&&n>e.size-6)return null;const l=t[7];192&l&&(r=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,r-s>54e5&&(E.warn(`${Math.round((r-s)/9e4)}s delta between PTS and DTS, align them`),r=s)):s=r),i=t[8];let u=i+9;if(e.size<=u)return null;e.size-=u;const c=new Uint8Array(e.size);for(let e=0,n=o.length;e<n;e++){t=o[e];let n=t.byteLength;if(u){if(u>n){u-=n;continue}t=t.subarray(u),n-=u,u=0}c.set(t,a),a+=n}return n&&(n-=i+3),{data:c,pts:r,dts:s,len:n}}return null}class Nr extends Wi{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ie(e,0);let n=(null==t?void 0:t.length)||0;if(t&&11===e[n]&&119===e[n+1]&&void 0!==ae(t)&&Tr(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(vr(e,n))return E.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return mr(e,t)}appendFrame(e,t,n){if(null!==this.basePTS)return hr(e,t,n,this.basePTS,this.frameIndex)}}class Ur{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Fr=Math.pow(2,32)-1;class Br{static init(){let e;for(e in Br.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Br.types)Br.types.hasOwnProperty(e)&&(Br.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Br.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Br.STTS=Br.STSC=Br.STCO=r,Br.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Br.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Br.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Br.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);Br.FTYP=Br.box(Br.types.ftyp,s,o,s,a),Br.DINF=Br.box(Br.types.dinf,Br.box(Br.types.dref,i))}static box(e,...t){let n=8,i=t.length;const r=i;while(i--)n+=t[i].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=255&n,s.set(e,4),i=0,n=8;i<r;i++)s.set(t[i],n),n+=t[i].byteLength;return s}static hdlr(e){return Br.box(Br.types.hdlr,Br.HDLR_TYPES[e])}static mdat(e){return Br.box(Br.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(Fr+1)),i=Math.floor(t%(Fr+1));return Br.box(Br.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(e){return Br.box(Br.types.mdia,Br.mdhd(e.timescale,e.duration),Br.hdlr(e.type),Br.minf(e))}static mfhd(e){return Br.box(Br.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?Br.box(Br.types.minf,Br.box(Br.types.smhd,Br.SMHD),Br.DINF,Br.stbl(e)):Br.box(Br.types.minf,Br.box(Br.types.vmhd,Br.VMHD),Br.DINF,Br.stbl(e))}static moof(e,t,n){return Br.box(Br.types.moof,Br.mfhd(e),Br.traf(n,t))}static moov(e){let t=e.length;const n=[];while(t--)n[t]=Br.trak(e[t]);return Br.box.apply(null,[Br.types.moov,Br.mvhd(e[0].timescale,e[0].duration)].concat(n).concat(Br.mvex(e)))}static mvex(e){let t=e.length;const n=[];while(t--)n[t]=Br.trex(e[t]);return Br.box.apply(null,[Br.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(Fr+1)),i=Math.floor(t%(Fr+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Br.box(Br.types.mvhd,r)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return Br.box(Br.types.sdtp,n)}static stbl(e){return Br.box(Br.types.stbl,Br.stsd(e),Br.box(Br.types.stts,Br.STTS),Br.box(Br.types.stsc,Br.STSC),Br.box(Br.types.stsz,Br.STSZ),Br.box(Br.types.stco,Br.STCO))}static avc1(e){let t,n,i,r=[],s=[];for(t=0;t<e.sps.length;t++)n=e.sps[t],i=n.byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(n));for(t=0;t<e.pps.length;t++)n=e.pps[t],i=n.byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(n));const a=Br.box(Br.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(s))),o=e.width,l=e.height,u=e.pixelRatio[0],c=e.pixelRatio[1];return Br.box(Br.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,Br.box(Br.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Br.box(Br.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return Br.box(Br.types.mp4a,Br.audioStsd(e),Br.box(Br.types.esds,Br.esds(e)))}static mp3(e){return Br.box(Br.types[".mp3"],Br.audioStsd(e))}static ac3(e){return Br.box(Br.types["ac-3"],Br.audioStsd(e),Br.box(Br.types.dac3,e.config))}static stsd(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?Br.box(Br.types.stsd,Br.STSD,Br.mp3(e)):"ac3"===e.segmentCodec?Br.box(Br.types.stsd,Br.STSD,Br.ac3(e)):Br.box(Br.types.stsd,Br.STSD,Br.mp4a(e)):Br.box(Br.types.stsd,Br.STSD,Br.avc1(e))}static tkhd(e){const t=e.id,n=e.duration*e.timescale,i=e.width,r=e.height,s=Math.floor(n/(Fr+1)),a=Math.floor(n%(Fr+1));return Br.box(Br.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,r>>8&255,255&r,0,0]))}static traf(e,t){const n=Br.sdtp(e),i=e.id,r=Math.floor(t/(Fr+1)),s=Math.floor(t%(Fr+1));return Br.box(Br.types.traf,Br.box(Br.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),Br.box(Br.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,s>>24,s>>16&255,s>>8&255,255&s])),Br.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,Br.box(Br.types.trak,Br.tkhd(e),Br.mdia(e))}static trex(e){const t=e.id;return Br.box(Br.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,r=12+16*i,s=new Uint8Array(r);let a,o,l,u,c,d;for(t+=8+r,s.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<i;a++)o=n[a],l=o.duration,u=o.size,c=o.flags,d=o.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*a);return Br.box(Br.types.trun,s)}static initSegment(e){Br.types||Br.init();const t=Br.moov(e),n=$e(Br.FTYP,t);return n}}Br.types=void 0,Br.HDLR_TYPES=void 0,Br.STTS=void 0,Br.STSC=void 0,Br.STCO=void 0,Br.STSZ=void 0,Br.VMHD=void 0,Br.SMHD=void 0,Br.STSD=void 0,Br.FTYP=void 0,Br.DINF=void 0;const jr=9e4;function Vr(e,t,n=1,i=!1){const r=e*t*n;return i?Math.round(r):r}function Hr(e,t,n=1,i=!1){return Vr(e,t,1/n,i)}function $r(e,t=!1){return Vr(e,1e3,1/jr,t)}function Gr(e,t=1){return Vr(e,jr,1/t)}const zr=1e4,qr=1024,Wr=1152,Kr=1536;let Yr,Xr=null,Qr=null;class Zr{constructor(e,t,n,i=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===Xr){const e=navigator.userAgent||"",t=e.match(/Chrome\/(\d+)/i);Xr=t?parseInt(t[1]):0}if(null===Qr){const e=navigator.userAgent.match(/Safari\/(\d+)/i);Qr=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){E.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){E.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){E.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e.reduce((e,n)=>{const i=n.pts-e;return i<-4294967296?(t=!0,Jr(e,n.pts)):i>0?e:n.pts},e[0].pts);return t&&E.debug("PTS rollover detected"),n}remux(e,t,n,i,r,s,a,o){let l,u,c,d,h,f,p=r,g=r;const m=e.pid>-1,v=t.pid>-1,y=t.samples.length,b=e.samples.length>0,_=a&&y>0||y>1,T=(!m||b)&&(!v||_)||this.ISGenerated||a;if(T){if(this.ISGenerated){var S,w,x,k;const e=this.videoTrackConfig;!e||t.width===e.width&&t.height===e.height&&(null==(S=t.pixelRatio)?void 0:S[0])===(null==(w=e.pixelRatio)?void 0:w[0])&&(null==(x=t.pixelRatio)?void 0:x[1])===(null==(k=e.pixelRatio)?void 0:k[1])||this.resetInitSegment()}else c=this.generateIS(e,t,r,s);const n=this.isVideoContiguous;let i,a=-1;if(_&&(a=es(t.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){E.warn(`[mp4-remuxer]: Dropped ${a} out of ${y} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,g+=(t.samples[0].pts-e)/t.inputTimeScale,i=g}else-1===a&&(E.warn(`[mp4-remuxer]: No keyframe found out of ${y} video samples`),f=!1);if(this.ISGenerated){if(b&&_){const n=this.getVideoStartPts(t.samples),i=Jr(e.samples[0].pts,n)-n,r=i/t.inputTimeScale;p+=Math.max(0,r),g+=Math.max(0,-r)}if(b){if(e.samplerate||(E.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,r,s)),u=this.remuxAudio(e,p,this.isAudioContiguous,s,v||_||o===Ft.AUDIO?g:void 0),_){const i=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(E.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,r,s)),l=this.remuxVideo(t,g,n,i)}}else _&&(l=this.remuxVideo(t,g,n,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(h=ts(n,r,this._initPTS,this._initDTS)),i.samples.length&&(d=ns(i,r,this._initPTS))),{audio:u,video:l,initSegment:c,independent:f,text:d,id3:h}}generateIS(e,t,n,i){const r=e.samples,s=t.samples,a=this.typeSupported,o={},l=this._initPTS;let u,c,d,h=!l||i,f="audio/mp4";if(h&&(u=c=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):Br.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(d=e.inputTimeScale,l&&d===l.timescale?h=!1:u=c=r[0].pts-Math.round(d*n))}if(t.sps&&t.pps&&s.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Br.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(d=t.inputTimeScale,l&&d===l.timescale)h=!1;else{const e=this.getVideoStartPts(s),t=Math.round(d*n);c=Math.min(c,Jr(s[0].dts,e)-t),u=Math.min(u,e-t)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:u,timescale:d},this._initDTS={baseTime:c,timescale:d}):u=d=void 0,{tracks:o,initPTS:u,timescale:d}}remuxVideo(e,t,n,i){const r=e.inputTimeScale,s=e.samples,a=[],o=s.length,l=this._initPTS;let u,c,h=this.nextAvcDts,f=8,p=this.videoSampleDuration,y=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,_=!1;if(!n||null===h){const e=t*r,i=s[0].pts-Jr(s[0].dts,s[0].pts);Xr&&null!==h&&Math.abs(e-i-h)<15e3?n=!0:h=e-i}const T=l.baseTime*r/l.timescale;for(let d=0;d<o;d++){const e=s[d];e.pts=Jr(e.pts-T,h),e.dts=Jr(e.dts-T,h),e.dts<s[d>0?d-1:d].dts&&(_=!0)}_&&s.sort(function(e,t){const n=e.dts-t.dts,i=e.pts-t.pts;return n||i}),u=s[0].dts,c=s[s.length-1].dts;const S=c-u,w=S?Math.round(S/(o-1)):p||e.inputTimeScale/30;if(n){const e=u-h,n=e>w,i=e<-1;if((n||i)&&(n?E.warn(`AVC: ${$r(e,!0)} ms (${e}dts) hole between fragments detected at ${t.toFixed(3)}`):E.warn(`AVC: ${$r(-e,!0)} ms (${e}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!i||h>=s[0].pts||Xr)){u=h;const t=s[0].pts-e;if(n)s[0].dts=u,s[0].pts=t;else for(let n=0;n<s.length;n++){if(s[n].dts>t)break;s[n].dts-=e,s[n].pts-=e}E.log(`Video: Initial PTS/DTS adjusted: ${$r(t,!0)}/${$r(u,!0)}, delta: ${$r(e,!0)} ms`)}}u=Math.max(0,u);let x=0,k=0,A=u;for(let d=0;d<o;d++){const e=s[d],t=e.units,n=t.length;let i=0;for(let r=0;r<n;r++)i+=t[r].data.length;k+=i,x+=n,e.length=i,e.dts<A?(e.dts=A,A+=w/4|0||1):A=e.dts,y=Math.min(e.pts,y),b=Math.max(e.pts,b)}c=s[o-1].dts;const I=k+4*x+8;let C;try{C=new Uint8Array(I)}catch(e){return void this.observer.emit(g.ERROR,g.ERROR,{type:m.MUX_ERROR,details:v.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:I,reason:`fail allocating video mdat ${I}`})}const D=new DataView(C.buffer);D.setUint32(0,I),C.set(Br.types.mdat,4);let R=!1,M=Number.POSITIVE_INFINITY,L=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY,O=Number.NEGATIVE_INFINITY;for(let d=0;d<o;d++){const e=s[d],t=e.units;let n,l=0;for(let i=0,r=t.length;i<r;i++){const e=t[i],n=e.data,r=e.data.byteLength;D.setUint32(f,r),f+=4,C.set(n,f),f+=r,l+=4+r}if(d<o-1)p=s[d+1].dts-e.dts,n=s[d+1].pts-e.pts;else{const t=this.config,a=d>0?e.dts-s[d-1].dts:w;if(n=d>0?e.pts-s[d-1].pts:w,t.stretchShortVideoTrack&&null!==this.nextAudioPts){const n=Math.floor(t.maxBufferHole*r),s=(i?y+i*r:this.nextAudioPts)-e.pts;s>n?(p=s-a,p<0?p=a:R=!0,E.log(`[mp4-remuxer]: It is approximately ${s/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=a}else p=a}const u=Math.round(e.pts-e.dts);M=Math.min(M,p),P=Math.max(P,p),L=Math.min(L,n),O=Math.max(O,n),a.push(new is(e.key,p,l,u))}if(a.length)if(Xr){if(Xr<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Qr&&O-L<P-M&&w/P<.025&&0===a[0].cts){E.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=u;for(let t=0,n=a.length;t<n;t++){const i=e+a[t].duration,r=e+a[t].cts;if(t<n-1){const e=i+a[t+1].cts;a[t].duration=e-r}else a[t].duration=t?a[t-1].duration:w;a[t].cts=0,e=i}}p=R||!p?w:p,this.nextAvcDts=h=c+p,this.videoSampleDuration=p,this.isVideoContiguous=!0;const N=Br.moof(e.sequenceNumber++,u,d({},e,{samples:a})),U="video",F={data1:N,data2:C,startPTS:y/r,endPTS:(b+p)/r,startDTS:u/r,endDTS:h/r,type:U,hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,F}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Wr;case"ac3":return Kr;default:return qr}}remuxAudio(e,t,n,i,r){const s=e.inputTimeScale,a=e.samplerate?e.samplerate:s,o=s/a,l=this.getSamplesPerFrame(e),u=l*o,c=this._initPTS,h="mp3"===e.segmentCodec&&this.typeSupported.mpeg,f=[],p=void 0!==r;let y=e.samples,b=h?0:8,_=this.nextAudioPts||-1;const T=t*s,S=c.baseTime*s/c.timescale;if(this.isAudioContiguous=n=n||y.length&&_>0&&(i&&Math.abs(T-_)<9e3||Math.abs(Jr(y[0].pts-S,T)-_)<20*u),y.forEach(function(e){e.pts=Jr(e.pts-S,T)}),!n||_<0){if(y=y.filter(e=>e.pts>=0),!y.length)return;_=0===r?0:i&&!p?Math.max(0,T):y[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let n=0,i=_;n<y.length;n++){const r=y[n],a=r.pts,o=a-i,l=Math.abs(1e3*o/s);if(o<=-t*u&&p)0===n&&(E.warn(`Audio frame @ ${(a/s).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/s)} ms.`),this.nextAudioPts=_=i=a);else if(o>=t*u&&l<zr&&p){let t=Math.round(o/u);i=a-t*u,i<0&&(t--,i+=u),0===n&&(this.nextAudioPts=_=i),E.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(i/s).toFixed(3)}s due to ${Math.round(1e3*o/s)} ms gap.`);for(let s=0;s<t;s++){const t=Math.max(i,0);let s=Ur.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);s||(E.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),s=r.unit.subarray()),y.splice(n,0,{unit:s,pts:t}),i+=u,n++}}r.pts=i,i+=u}}let w,x=null,k=null,A=0,I=y.length;while(I--)A+=y[I].unit.byteLength;for(let d=0,E=y.length;d<E;d++){const t=y[d],i=t.unit;let r=t.pts;if(null!==k){const e=f[d-1];e.duration=Math.round((r-k)/o)}else{if(n&&"aac"===e.segmentCodec&&(r=_),x=r,!(A>0))return;A+=b;try{w=new Uint8Array(A)}catch(e){return void this.observer.emit(g.ERROR,g.ERROR,{type:m.MUX_ERROR,details:v.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:A,reason:`fail allocating audio mdat ${A}`})}if(!h){const e=new DataView(w.buffer);e.setUint32(0,A),w.set(Br.types.mdat,4)}}w.set(i,b);const s=i.byteLength;b+=s,f.push(new is(!0,l,s,0)),k=r}const C=f.length;if(!C)return;const D=f[f.length-1];this.nextAudioPts=_=k+o*D.duration;const R=h?new Uint8Array(0):Br.moof(e.sequenceNumber++,x/o,d({},e,{samples:f}));e.samples=[];const M=x/s,L=_/s,P="audio",O={data1:R,data2:w,startPTS:M,endPTS:L,startDTS:M,endDTS:L,type:P,hasAudio:!0,hasVideo:!1,nb:C};return this.isAudioContiguous=!0,O}remuxEmptyAudio(e,t,n,i){const r=e.inputTimeScale,s=e.samplerate?e.samplerate:r,a=r/s,o=this.nextAudioPts,l=this._initDTS,u=9e4*l.baseTime/l.timescale,c=(null!==o?o:i.startDTS*r)+u,d=i.endDTS*r+u,h=a*qr,f=Math.ceil((d-c)/h),p=Ur.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(E.warn("[mp4-remuxer]: remux empty Audio"),!p)return void E.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const g=[];for(let m=0;m<f;m++){const e=c+m*h;g.push({unit:p,pts:e,dts:e})}return e.samples=g,this.remuxAudio(e,t,n,!1)}}function Jr(e,t){let n;if(null===t)return e;n=t<e?-8589934592:8589934592;while(Math.abs(e-t)>4294967296)e+=n;return e}function es(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}function ts(e,t,n,i){const r=e.samples.length;if(!r)return;const s=e.inputTimeScale;for(let o=0;o<r;o++){const r=e.samples[o];r.pts=Jr(r.pts-n.baseTime*s/n.timescale,t*s)/s,r.dts=Jr(r.dts-i.baseTime*s/i.timescale,t*s)/s}const a=e.samples;return e.samples=[],{samples:a}}function ns(e,t,n){const i=e.samples.length;if(!i)return;const r=e.inputTimeScale;for(let a=0;a<i;a++){const i=e.samples[a];i.pts=Jr(i.pts-n.baseTime*r/n.timescale,t*r)/r}e.samples.sort((e,t)=>e.pts-t.pts);const s=e.samples;return e.samples=[],{samples:s}}class is{constructor(e,t,n,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=n,this.cts=i,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class rs{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(Ne(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:n}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const i=this.initData=Re(e);i.audio&&(t=as(i.audio,M.AUDIO)),i.video&&(n=as(i.video,M.VIDEO));const r={};i.audio&&i.video?r.audiovideo={container:"video/mp4",codec:t+","+n,initSegment:e,id:"main"}:i.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?r.video={container:"video/mp4",codec:n,initSegment:e,id:"main"}:E.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r}remux(e,t,n,i,r,s){var a,o;let{initPTS:l,lastEndTime:u}=this;const c={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};h(u)||(u=this.lastEndTime=r||0);const d=t.samples;if(null==d||!d.length)return c;const f={initPTS:void 0,timescale:1};let p=this.initData;if(null!=(a=p)&&a.length||(this.generateInitSegment(d),p=this.initData),null==(o=p)||!o.length)return E.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const g=Be(d,p),m=Fe(p,d),v=null===m?r:m;(ss(l,v,r,g)||f.timescale!==l.timescale&&s)&&(f.initPTS=v-r,l&&1===l.timescale&&E.warn(`Adjusting initPTS by ${f.initPTS-l.baseTime}`),this.initPTS=l={baseTime:f.initPTS,timescale:1});const y=e?v-l.baseTime/l.timescale:u,b=y+g;Ve(p,d,l.baseTime/l.timescale),g>0?this.lastEndTime=b:(E.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const _=!!p.audio,T=!!p.video;let S="";_&&(S+="audio"),T&&(S+="video");const w={data1:d,startPTS:y,startDTS:y,endPTS:b,endDTS:b,type:S,hasAudio:_,hasVideo:T,nb:1,dropped:0};return c.audio="audio"===w.type?w:void 0,c.video="audio"!==w.type?w:void 0,c.initSegment=f,c.id3=ts(n,r,l,l),i.samples.length&&(c.text=ns(i,r,l)),c}}function ss(e,t,n,i){if(null===e)return!0;const r=Math.max(i,1),s=t-e.baseTime/e.timescale;return Math.abs(s-n)>r}function as(e,t){const n=null==e?void 0:e.codec;if(n&&n.length>4)return n;if(t===M.AUDIO){if("ec-3"===n||"ac-3"===n||"alac"===n)return n;if("fLaC"===n||"Opus"===n){const e=!1;return _t(n,e)}const e="mp4a.40.5";return E.info(`Parsed audio codec "${n}" or audio object type not handled. Using "${e}"`),e}return E.warn(`Unhandled video codec "${n}"`),"hvc1"===n||"hev1"===n?"hvc1.1.6.L120.90":"av01"===n?"av01.0.04M.08":"avc1.42e01e"}try{Yr=self.performance.now.bind(self.performance)}catch(e){E.debug("Unable to use Performance API on this environment"),Yr=null==$?void 0:$.Date.now}const os=[{demux:_r,remux:rs},{demux:Cr,remux:Zr},{demux:yr,remux:Zr},{demux:Nr,remux:Zr}];os.splice(2,0,{demux:Sr,remux:Zr});class ls{constructor(e,t,n,i,r){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.vendor=i,this.id=r}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const r=n.transmuxing;r.executeStart=Yr();let s=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:u,trackSwitch:c,accurateTimeOffset:d,timeOffset:h,initSegmentChange:f}=i||a,{audioCodec:p,videoCodec:y,defaultInitPts:b,duration:_,initSegmentData:T}=o,S=us(s,t);if(S&&"AES-128"===S.method){const e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(s,S.key.buffer,S.iv.buffer).then(e=>{const t=this.push(e,null,n);return this.decryptionPromise=null,t}),this.decryptionPromise;{let t=e.softwareDecrypt(s,S.key.buffer,S.iv.buffer);const i=n.part>-1;if(i&&(t=e.flush()),!t)return r.executeEnd=Yr(),cs(n);s=new Uint8Array(t)}}const w=this.needsProbing(u,c);if(w){const e=this.configureTransmuxer(s);if(e)return E.warn(`[transmuxer] ${e.message}`),this.observer.emit(g.ERROR,g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),r.executeEnd=Yr(),cs(n)}(u||c||f||w)&&this.resetInitSegment(T,p,y,_,t),(u||f||w)&&this.resetInitialTimestamp(b),l||this.resetContiguity();const x=this.transmux(s,S,h,d,n),k=this.currentTransmuxState;return k.contiguous=!0,k.discontinuity=!1,k.trackSwitch=!1,r.executeEnd=Yr(),x}flush(e){const t=e.transmuxing;t.executeStart=Yr();const{decrypter:n,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return r.then(()=>{return this.flush(e)});const s=[],{timeOffset:a}=i;if(n){const t=n.flush();t&&s.push(this.push(t,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l)return t.executeEnd=Yr(),[cs(e)];const u=o.flush(a);return ds(u)?u.then(t=>{return this.flushRemux(s,t,e),s}):(this.flushRemux(s,u,e),s)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:r,id3Track:s,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;E.log(`[transmuxer.ts]: Flushed fragment ${n.sn}${n.part>-1?" p: "+n.part:""} of level ${n.level}`);const u=this.remuxer.remux(i,r,s,a,l,o,!0,this.id);e.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=Yr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;t&&n&&(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,r){const{demuxer:s,remuxer:a}=this;s&&a&&(s.resetInitSegment(e,t,n,i),a.resetInitSegment(e,t,n,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,r){let s;return s=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,n,i,r):this.transmuxUnencrypted(e,n,i,r),s}transmuxUnencrypted(e,t,n,i){const{audioTrack:r,videoTrack:s,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive),l=this.remuxer.remux(r,s,a,o,t,n,!1,this.id);return{remuxResult:l,chunkMeta:i}}transmuxSampleAes(e,t,n,i,r){return this.demuxer.demuxSampleAes(e,t,n).then(e=>{const t=this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,n,i,!1,this.id);return{remuxResult:t,chunkMeta:r}})}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i,vendor:r}=this;let s;for(let d=0,h=os.length;d<h;d++){var a;if(null!=(a=os[d].demux)&&a.probe(e)){s=os[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=s.remux,c=s.demux;l&&l instanceof u||(this.remuxer=new u(n,t,i,r)),o&&o instanceof c||(this.demuxer=new c(n,t,i),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ui(this.config)),e}}function us(e,t){let n=null;return e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(n=t),n}const cs=e=>({remuxResult:{},chunkMeta:e});function ds(e){return"then"in e&&e.then instanceof Function}class hs{constructor(e,t,n,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=r||null}}class fs{constructor(e,t,n,i,r,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=s}}var ps={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,i,s,a){if("function"!==typeof i)throw new TypeError("The listener must be a function");var o=new r(i,s||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,s=i.length,a=new Array(s);r<s;r++)a[r]=i[r].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,r,s,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,r),!0;case 5:return c.fn.call(c.context,t,i,r,s),!0;case 6:return c.fn.call(c.context,t,i,r,s,a),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,i);break;case 4:c[u].fn.call(c[u].context,t,i,r);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,i,r){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||r&&!o.once||i&&o.context!==i||a(this,s);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||r&&!o[l].once||i&&o[l].context!==i)&&u.push(o[l]);u.length?this._events[s]=1===u.length?u[0]:u:a(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o})(ps);var gs=ps.exports,ms=i(gs);class vs{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const s=(e,t)=>{t=t||{},t.frag=this.frag,t.id=this.id,e===g.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new ms,this.observer.on(g.FRAG_DECRYPTED,s),this.observer.on(g.ERROR,s);const a=lt(r.preferManagedMediaSource)||{isTypeSupported:()=>!1},o={mpeg:a.isTypeSupported("audio/mpeg"),mp3:a.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:a.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&"undefined"!==typeof Worker){const e=r.workerPath||$i();if(e){try{r.workerPath?(E.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=zi(r.workerPath)):(E.log(`injecting Web Worker for "${t}"`),this.workerContext=Gi()),this.onwmsg=(e=>this.onWorkerMessage(e));const{worker:e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=(e=>{const n=new Error(`${e.message}  (${e.filename}:${e.lineno})`);r.enableWorker=!1,E.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:n})}),e.postMessage({cmd:"init",typeSupported:o,vendor:"",id:t,config:JSON.stringify(r)})}catch(e){E.warn(`Error setting up "${t}" Web Worker, fallback to inline`,e),this.resetWorker(),this.error=null,this.transmuxer=new ls(this.observer,o,r,"",t)}return}}this.transmuxer=new ls(this.observer,o,r,"",t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,n,i,r,s,a,o,l,u){var c,d;l.transmuxing.start=self.performance.now();const{transmuxer:h}=this,f=s?s.start:r.start,p=r.decryptdata,g=this.frag,m=!(g&&r.cc===g.cc),v=!(g&&l.level===g.level),y=g?l.sn-g.sn:-1,b=this.part?l.part-this.part.index:-1,_=0===y&&l.id>1&&l.id===(null==g?void 0:g.stats.chunkCount),T=!v&&(1===y||0===y&&(1===b||_&&b<=0)),S=self.performance.now();(v||y||0===r.stats.parsing.start)&&(r.stats.parsing.start=S),!s||!b&&T||(s.stats.parsing.start=S);const w=!(g&&(null==(c=r.initSegment)?void 0:c.url)===(null==(d=g.initSegment)?void 0:d.url)),x=new fs(m,T,o,v,f,w);if(!T||m||w){E.log(`[transmuxer-interface, ${r.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}\n        discontinuity: ${m}\n        trackSwitch: ${v}\n        contiguous: ${T}\n        accurateTimeOffset: ${o}\n        timeOffset: ${f}\n        initSegmentChange: ${w}`);const e=new hs(n,i,t,a,u);this.configureTransmuxer(e)}if(this.frag=r,this.part=s,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:x},e instanceof ArrayBuffer?[e]:[]);else if(h){const t=h.push(e,p,l,x);ds(t)?(h.async=!0,t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")})):(h.async=!1,this.handleTransmuxComplete(t))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let n=t.flush(e);const i=ds(n);i||t.async?(ds(n)||(n=Promise.resolve(n)),n.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")})):this.handleFlushResult(n,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data;if(null==t||!t.event)return void E.warn(`worker message received with no ${t?"event name":"data"}`);const n=this.hls;if(this.hls)switch(t.event){case"init":{var i;const e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":E[t.data.logType]&&E[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data);break}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function ys(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!bs(e[n].attrs,t[n].attrs))return!1;return!0}function bs(e,t,n){const i=e["STABLE-RENDITION-ID"];return i&&!n?i===t["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>e[n]!==t[n])}function _s(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}const Ts=100;class Ss extends ji{constructor(e,t,n){super(e,t,n,"[audio-stream-controller]",Ft.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(g.ERROR,this.onError,this),e.on(g.BUFFER_RESET,this.onBufferReset,this),e.on(g.BUFFER_CREATED,this.onBufferCreated,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(g.ERROR,this.onError,this),e.off(g.BUFFER_RESET,this.onBufferReset,this),e.off(g.BUFFER_CREATED,this.onBufferCreated,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:r}){if("main"===n){const e=t.cc;this.initPTS[t.cc]={baseTime:i,timescale:r},this.log(`InitPTS for cc: ${e} found from main: ${i}`),this.videoTrackCC=e,this.state===Bi.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels)return this.startPosition=e,void(this.state=Bi.STOPPED);const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(Ts),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=Bi.IDLE):(this.loadedmetadata=!1,this.state=Bi.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case Bi.IDLE:this.doTickIdle();break;case Bi.WAITING_TRACK:{var e;const{levels:t,trackId:n}=this,i=null==t?void 0:null==(e=t[n])?void 0:e.details;if(i){if(this.waitForCdnTuneIn(i))break;this.state=Bi.WAITING_INIT_PTS}break}case Bi.FRAG_LOADING_WAITING_RETRY:{var t;const e=performance.now(),n=this.retryDate;if(!n||e>=n||null!=(t=this.media)&&t.seeking){const{levels:e,trackId:t}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==e?void 0:e[t])||null),this.state=Bi.IDLE}break}case Bi.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:i,complete:r}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=Bi.FRAG_LOADING;const e=i.flush(),s={frag:t,part:n,payload:e,networkDetails:null};this._handleFragmentLoadProgress(s),r&&super._handleFragmentLoadComplete(s)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const e=this.getLoadPosition(),n=mi.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole),i=Un(n.end,this.config.maxFragLookUpTolerance,t);i<0&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${n.end} is needed`),this.clearWaitingFragment())}}else this.state=Bi.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Bi.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:n,trackId:i}=this,r=e.config;if(!n&&(this.startFragRequested||!r.startFragPrefetch)||null==t||!t[i])return;const s=t[i],a=s.details;if(!a||a.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(a))return void(this.state=Bi.WAITING_TRACK);const o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,M.AUDIO,Ft.AUDIO));const l=this.getFwdBufferInfo(o,Ft.AUDIO);if(null===l)return;const{bufferedTrack:u,switchingTrack:c}=this;if(!c&&this._streamEnded(l,a))return e.trigger(g.BUFFER_EOS,{type:"audio"}),void(this.state=Bi.ENDED);const d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Ft.MAIN),h=l.len,f=this.getMaxBufferLength(null==d?void 0:d.len),p=a.fragments,m=p[0].start;let v=this.flushing?this.getLoadPosition():l.end;if(c&&n){const e=this.getLoadPosition();u&&!bs(c.attrs,u.attrs)&&(v=e),a.PTSKnown&&e<m&&(l.end>m||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=m+.05)}if(h>=f&&!c&&v<p[p.length-1].start)return;let y=this.getNextFragment(v,a),b=!1;if(y&&this.isLoopLoading(y,v)&&(b=!!y.gap,y=this.getNextFragmentLoopLoading(y,a,l,Ft.MAIN,f)),!y)return void(this.bufferFlushed=!0);const _=d&&y.start>d.end+a.targetduration;if(_||(null==d||!d.len)&&l.len){const e=this.getAppendedFrag(y.start,Ft.MAIN);if(null===e)return;if(b||(b=!!e.gap||!!_&&0===d.len),_&&!b||b&&l.nextStart&&l.nextStart<e.end)return}this.loadFragment(y,s,v)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(e=>new hn(e))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?this.setInterval(Ts):this.resetTransmuxer(),n?(this.switchingTrack=t,this.state=Bi.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=Bi.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(g.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var n;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{levels:i}=this,{details:r,id:s}=t;if(!i)return void this.warn(`Audio tracks were reset while loading level ${s}`);this.log(`Audio track ${s} loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const a=i[s];let o=0;if(r.live||null!=(n=a.details)&&n.live){this.checkLiveUpdate(r);const e=this.mainDetails;if(r.deltaUpdateFailed||!e)return;var l;if(!a.details&&r.hasProgramDateTime&&e.hasProgramDateTime)ki(r,e),o=r.fragments[0].start;else o=this.alignPlaylists(r,a.details,null==(l=this.levelLastLoaded)?void 0:l.details)}a.details=r,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(this.mainDetails||r,o),this.state!==Bi.WAITING_TRACK||this.waitForCdnTuneIn(r)||(this.state=Bi.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:n,part:i,payload:r}=e,{config:s,trackId:a,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);const c=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new vs(this.hls,Ft.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[n.cc],f=null==(t=n.initSegment)?void 0:t.data;if(void 0!==h){const e=!1,t=i?i.index:-1,s=-1!==t,a=new vi(n.level,n.sn,n.stats.chunkCount,r.byteLength,t,s);d.push(r,f,c,"",n,i,u.totalduration,e,a,h)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:e}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new Vi,complete:!1};e.push(new Uint8Array(r)),this.waitingVideoCC=this.videoTrackCC,this.state=Bi.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type===Ft.AUDIO)if(this.fragContextChanged(n))this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==n.sn){this.fragPrevious=n;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(g.AUDIO_TRACK_SWITCHED,o({},e)))}this.fragBufferedComplete(n,i)}else if(!this.loadedmetadata&&n.type===Ft.MAIN){const e=this.videoBuffer||this.media;if(e){const t=mi.getBuffered(e);t.length&&(this.loadedmetadata=!0)}}}onError(e,t){var n;if(t.fatal)this.state=Bi.ERROR;else switch(t.details){case v.FRAG_GAP:case v.FRAG_PARSING_ERROR:case v.FRAG_DECRYPT_ERROR:case v.FRAG_LOAD_ERROR:case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_ERROR:case v.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ft.AUDIO,t);break;case v.AUDIO_TRACK_LOAD_ERROR:case v.AUDIO_TRACK_LOAD_TIMEOUT:case v.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Bi.WAITING_TRACK||(null==(n=t.context)?void 0:n.type)!==Ut.AUDIO_TRACK||(this.state=Bi.IDLE);break;case v.BUFFER_APPEND_ERROR:case v.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;if(t.details===v.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case v.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==M.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==M.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Bi.ENDED&&(this.state=Bi.IDLE);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,Ft.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:r,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:l,level:u}=a,{details:c}=u,{audio:h,text:f,id3:p,initSegment:m}=r;if(!this.fragContextChanged(o)&&c){if(this.state=Bi.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const e=o.initSegment||o;this._bufferInitSegment(u,m.tracks,e,s),i.trigger(g.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:n,tracks:m.tracks})}if(h){const{startPTS:e,endPTS:t,startDTS:n,endDTS:i}=h;l&&(l.elementaryStreams[M.AUDIO]={startPTS:e,endPTS:t,startDTS:n,endDTS:i}),o.setElementaryStreamInfo(M.AUDIO,e,t,n,i),this.bufferFragmentData(h,o,l,s)}if(null!=p&&null!=(t=p.samples)&&t.length){const e=d({id:n,frag:o,details:c},p);i.trigger(g.FRAG_PARSING_METADATA,e)}if(f){const e=d({id:n,frag:o,details:c},f);i.trigger(g.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,n,i){if(this.state!==Bi.PARSING)return;t.video&&delete t.video;const r=t.audio;if(!r)return;r.id="audio";const s=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${s}/${r.codec}]`),s&&1===s.split(",").length&&(r.levelCodec=s),this.hls.trigger(g.BUFFER_CODECS,t);const a=r.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:a};this.hls.trigger(g.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);var r;if(this.fragCurrent=e,this.switchingTrack||i===di.NOT_LOADED||i===di.PARTIAL)if("initSegment"===e.sn)this._loadInitSegment(e,t);else if(null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Bi.WAITING_INIT_PTS;const n=this.mainDetails;n&&n.fragments[0].start!==t.details.fragments[0].start&&ki(t.details,n)}else this.startFragRequested=!0,super.loadFragment(e,t,n);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:t,bufferedTrack:n}=this,i=null==n?void 0:n.attrs,r=e.attrs;t&&i&&(i.CHANNELS!==r.CHANNELS||n.name!==e.name||n.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(g.AUDIO_TRACK_SWITCHED,o({},e))}}class ws extends $n{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVEL_LOADING,this.onLevelLoading,this),e.off(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(g.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(g.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:r}=t,s=this.tracksInGroup[n];if(!s||s.groupId!==i)return void this.warn(`Audio track with id:${n} and group:${i} not found in active group ${null==s?void 0:s.groupId}`);const a=s.details;s.details=t.details,this.log(`Audio track ${n} "${s.name}" lang:${s.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==i?void 0:i.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!r&&t){const n=ii(t,e,ai);if(n>-1)r=e[n];else{const e=ii(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const a={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==n?void 0:n.join(",")}`),this.hls.trigger(g.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==i&&-1===o)this.setAudioTrack(i);else if(e.length&&-1===o){var s;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(s=this.groupIds)?void 0:s.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}else this.shouldReloadPlaylist(r)&&this.setAudioTrack(this.trackId)}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Ut.AUDIO_TRACK||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||(this.requestScheduled=-1,this.checkRetry(t)))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&ri(e,i,ai))return i;const r=ii(e,this.tracksInGroup,ai);if(r>-1){const e=this.tracksInGroup[r];return this.setAudioTrack(r),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);const r=oi(e,t.levels,n,i,ai);if(-1===r)return null;t.nextLoadLevel=r}if(e.channels||e.audioCodec){const t=ii(e,n);if(t>-1)return n[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===n&&r)return;if(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(g.AUDIO_TRACK_SWITCHING,o({},i)),r)return;const s=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(s)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if((!this.selectDefaultTrack||i.default)&&(!e||ri(e,i,ai)))return n}if(e){const{name:n,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++){const l=t[e];if(ri({name:n,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:o},l,ai))return e}for(let l=0;l<t.length;l++){const n=t[l];if(bs(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const n=t[l];if(bs(e.attrs,n.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const n=t.id,i=t.groupId;let r=t.url;if(e)try{r=e.addDirectives(r)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`loading audio-track playlist ${n} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(g.AUDIO_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:e||null})}}}const Es=500;class xs extends ji{constructor(e,t,n){super(e,t,n,"[subtitle-stream-controller]",Ft.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.ERROR,this.onError,this),e.on(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(g.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(g.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.ERROR,this.onError,this),e.off(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(g.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(g.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=Bi.IDLE,this.setInterval(Es),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(this.fragPrevious=n,this.state=Bi.IDLE,!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let s;const a=n.start;for(let l=0;l<r.length;l++)if(a>=r[l].start&&a<=r[l].end){s=r[l];break}const o=n.start+n.duration;s?s.end=o:(s={start:a,end:o},r.push(s)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null)}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(0===n&&i!==Number.POSITIVE_INFINITY){const e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let n=0;n<t.length;)if(t[n].end<=e)t.shift();else{if(!(t[n].start<e))break;t[n].start=e,n++}}),this.fragmentTracker.removeFragmentsInRange(n,e,Ft.SUBTITLE)}}onFragBuffered(e,t){var n;this.loadedmetadata||t.frag.type!==Ft.MAIN||null!=(n=this.media)&&n.buffered.length&&(this.loadedmetadata=!0)}onError(e,t){const n=t.frag;(null==n?void 0:n.type)===Ft.SUBTITLE&&(t.details===v.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Bi.STOPPED&&(this.state=Bi.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&ys(this.levels,t)?this.levels=t.map(e=>new hn(e)):(this.tracksBuffered=[],this.levels=t.map(e=>{const t=new hn(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ft.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,null==(n=this.levels)||!n.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(Es)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:r}=this,{details:s,id:a}=t;if(!r)return void this.warn(`Subtitle tracks were reset while loading level ${a}`);const o=r[a];if(a>=r.length||!o)return;this.log(`Subtitle track ${a} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(s.live||null!=(n=o.details)&&n.live){const e=this.mainDetails;if(s.deltaUpdateFailed||!e)return;const t=e.fragments[0];var u;if(o.details)l=this.alignPlaylists(s,o.details,null==(u=this.levelLastLoaded)?void 0:u.details),0===l&&t&&(l=t.start,Tn(s,l));else s.hasProgramDateTime&&e.hasProgramDateTime?(ki(s,e),l=s.fragments[0].start):t&&(l=t.start,Tn(s,l))}if(o.details=s,this.levelLastLoaded=o,a===i&&(this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(this.mainDetails||s,l),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===Bi.IDLE)){const e=On(null,s.fragments,this.media.currentTime,0);e||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&null!=i&&i.key&&i.iv&&"AES-128"===i.method){const e=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer).catch(e=>{throw r.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(n=>{const i=performance.now();r.trigger(g.FRAG_DECRYPTED,{frag:t,payload:n,stats:{tstart:e,tdecrypt:i}})}).catch(e=>{this.warn(`${e.name}: ${e.message}`),this.state=Bi.IDLE})}}doTick(){if(this.media){if(this.state===Bi.IDLE){const{currentTrackId:e,levels:t}=this,n=null==t?void 0:t[e];if(!n||!t.length||!n.details)return;const{config:i}=this,r=this.getLoadPosition(),s=mi.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:a,len:o}=s,l=this.getFwdBufferInfo(this.media,Ft.MAIN),u=n.details,c=this.getMaxBufferLength(null==l?void 0:l.len)+u.levelTargetDuration;if(o>c)return;const d=u.fragments,h=d.length,f=u.edge;let p=null;const g=this.fragPrevious;if(a<f){const e=i.maxFragLookUpTolerance,t=a>f-e?0:e;p=On(g,d,Math.max(d[0].start,a),t),!p&&g&&g.start<d[0].start&&(p=d[0])}else p=d[h-1];if(!p)return;if(p=this.mapToInitFragWhenRequired(p),"initSegment"!==p.sn){const e=p.sn-u.startSN,t=d[e-1];t&&t.cc===p.cc&&this.fragmentTracker.getState(t)===di.NOT_LOADED&&(p=t)}this.fragmentTracker.getState(p)===di.NOT_LOADED&&this.loadFragment(p,n,a)}}else this.state=Bi.IDLE}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,n){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,n))}get mediaBufferTimeRanges(){return new ks(this.tracksBuffered[this.currentTrackId]||[])}}class ks{constructor(e){this.buffered=void 0;const t=(t,n,i)=>{if(n>>>=0,n>i-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${i})`);return e[n][t]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}class As extends $n{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=(()=>this.pollTrackChange(0)),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=(()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=Kt(this.media.textTracks);for(let i=0;i<t.length;i++)if("hidden"===t[i].mode)e=t[i];else if("showing"===t[i].mode){e=t[i];break}const n=this.findTrackForTextTrack(e);this.subtitleTrack!==n&&this.setSubtitleTrack(n)}),this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVEL_LOADING,this.onLevelLoading,this),e.off(g.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(g.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(g.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);const e=Kt(this.media.textTracks);e.forEach(e=>{Gt(e)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:r}=t,s=this.tracksInGroup[n];if(!s||s.groupId!==i)return void this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${null==s?void 0:s.groupId}`);const a=s.details;s.details=t.details,this.log(`Subtitle track ${n} "${s.name}" lang:${s.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(e=>-1===(null==i?void 0:i.indexOf(e)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!n||-1!==n.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!r&&t){this.selectDefaultTrack=!1;const n=ii(t,e);if(n>-1)r=e[n];else{const e=ii(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const s={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==n?void 0:n.join(",")}" group-id`),this.hls.trigger(g.SUBTITLE_TRACKS_UPDATED,s),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}else this.shouldReloadPlaylist(r)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if((!n||r.default)&&(n||e)&&(!e||ri(r,e)))return i}if(e){for(let n=0;n<t.length;n++){const i=t[n];if(bs(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const i=t[n];if(bs(e.attrs,i.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(_s(i,e))return n}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Ut.SUBTITLE_TRACK||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&ri(e,n))return n;const i=ii(e,this.tracksInGroup);if(i>-1){const e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(n)return null;{const n=ii(e,t);if(n>-1)return t[n]}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const n=t.id,i=t.groupId;let r=t.url;if(e)try{r=e.addDirectives(r)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(g.SUBTITLE_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Kt(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(e=>_s(n,e))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==i&&(e.mode="disabled")}),i){const e=this.subtitleDisplay?"showing":"hidden";i.mode!==e&&(i.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!h(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i)return void this.hls.trigger(g.SUBTITLE_TRACK_SWITCH,{id:e});const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&r)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:s,groupId:a="",name:o,type:l,url:u}=i;this.hls.trigger(g.SUBTITLE_TRACK_SWITCH,{id:s,groupId:a,name:o,type:l,url:u});const c=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(c)}}class Is{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,n){const i=this.queues[t];i.push(e),1!==i.length||n||this.executeNext(t)}insertAbort(e,t){const n=this.queues[t];n.unshift(e),this.executeNext(t)}appendBlocker(e){let t;const n=new Promise(e=>{t=e}),i={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(i,e),n}executeNext(e){const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(t){E.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${t}`),n.onError(t);const i=this.buffers[e];null!=i&&i.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const Cs=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class Ds{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=(e=>{this.hls&&this.hls.pauseBuffering()}),this._onStartStreaming=(e=>{this.hls&&this.hls.resumeBuffering()}),this._onMediaSourceOpen=(()=>{const{media:e,mediaSource:t}=this;this.log("Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(g.MEDIA_ATTACHED,{media:e,mediaSource:t})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()}),this._onMediaSourceClose=(()=>{this.log("Media source closed")}),this._onMediaSourceEnded=(()=>{this.log("Media source ended")}),this._onMediaEmptied=(()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&E.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)}),this.hls=e;const t="[buffer-controller]";this.appendSource=ut(lt(e.config.preferManagedMediaSource)),this.log=E.log.bind(E,t),this.warn=E.warn.bind(E,t),this.error=E.error.bind(E,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.BUFFER_RESET,this.onBufferReset,this),e.on(g.BUFFER_APPENDING,this.onBufferAppending,this),e.on(g.BUFFER_CODECS,this.onBufferCodecs,this),e.on(g.BUFFER_EOS,this.onBufferEos,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(g.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(g.FRAG_PARSED,this.onFragParsed,this),e.on(g.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.BUFFER_RESET,this.onBufferReset,this),e.off(g.BUFFER_APPENDING,this.onBufferAppending,this),e.off(g.BUFFER_CODECS,this.onBufferCodecs,this),e.off(g.BUFFER_EOS,this.onBufferEos,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(g.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(g.FRAG_PARSED,this.onFragParsed,this),e.off(g.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new Is(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const n=this.media=t.media,i=lt(this.appendSource);if(n&&i){var r;const e=this.mediaSource=new i;this.log(`created media source: ${null==(r=e.constructor)?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming));const t=this._objectUrl=self.URL.createObjectURL(e);if(this.appendSource)try{n.removeAttribute("src");const i=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||i&&e instanceof i,Rs(n),Ms(n,t),n.load()}catch(e){n.src=t}else n.src=t;n.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:n}=this;if(t){if(this.log("media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){this.warn(`onMediaDetaching: ${e.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(e.removeAttribute("src"),this.appendSource&&Rs(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(g.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer()}resetBuffer(e){const t=this.sourceBuffer[e];try{var n;if(t)this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,null!=(n=this.mediaSource)&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}catch(t){this.warn(`onBufferReset ${e}`,t)}}onBufferCodecs(e,t){const n=this.getSourceBufferTypes().length,i=Object.keys(t);if(i.forEach(e=>{if(n){const n=this.tracks[e];if(n&&"function"===typeof n.buffer.changeType){var i;const{id:r,codec:s,levelCodec:a,container:o,metadata:l}=t[e],u=Tt(n.codec,n.levelCodec),c=null==u?void 0:u.replace(Cs,"$1");let d=Tt(s,a);const h=null==(i=d)?void 0:i.replace(Cs,"$1");if(d&&c!==h){"audio"===e.slice(0,5)&&(d=_t(d,this.appendSource));const t=`${o};codecs=${d}`;this.appendChangeType(e,t),this.log(`switching codec ${u} to ${d}`),this.tracks[e]={buffer:n.buffer,codec:s,container:o,levelCodec:a,metadata:l,id:r}}}}else this.pendingTracks[e]=t[e]}),n)return;const r=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==r&&(this.log(`${r} bufferCodec event(s) expected ${i.join(",")}`),this.bufferCodecEventsExpected=r),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:n}=this,i={execute:()=>{const i=this.sourceBuffer[e];i&&(this.log(`changing ${e} sourceBuffer type to ${t}`),i.changeType(t)),n.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};n.append(i,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:n,operationQueue:i,tracks:r}=this,{data:s,type:a,frag:o,part:l,chunkMeta:u}=t,c=u.buffering[a],d=self.performance.now();c.start=d;const h=o.stats.buffering,f=l?l.stats.buffering:null;0===h.start&&(h.start=d),f&&0===f.start&&(f.start=d);const p=r.audio;let y=!1;"audio"===a&&"audio/mpeg"===(null==p?void 0:p.container)&&(y=!this.lastMpegAudioChunk||1===u.id||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const b=o.start,_={execute:()=>{if(c.executeStart=self.performance.now(),y){const e=this.sourceBuffer[a];if(e){const t=b-e.timestampOffset;Math.abs(t)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${b} (delta: ${t}) sn: ${o.sn})`),e.timestampOffset=b)}}this.appendExecutor(s,a)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();c.executeEnd=c.end=e,0===h.first&&(h.first=e),f&&0===f.first&&(f.first=e);const{sourceBuffer:t}=this,n={};for(const i in t)n[i]=mi.getBuffered(t[i]);this.appendErrors[a]=0,"audio"===a||"video"===a?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(g.BUFFER_APPENDED,{type:a,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:n})},onError:e=>{const t={type:m.MEDIA_ERROR,parent:o.type,details:v.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:o,part:l,chunkMeta:u,error:e,err:e,fatal:!1};if(e.code===DOMException.QUOTA_EXCEEDED_ERR)t.details=v.BUFFER_FULL_ERROR;else{const e=++this.appendErrors[a];t.details=v.BUFFER_APPEND_ERROR,this.warn(`Failed ${e}/${n.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer`),e>=n.config.appendErrorMaxRetry&&(t.fatal=!0)}n.trigger(g.ERROR,t)}};i.append(_,a,!!this.pendingTracks[a])}onBufferFlushing(e,t){const{operationQueue:n}=this,i=e=>({execute:this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(g.BUFFER_FLUSHED,{type:e})},onError:t=>{this.warn(`Failed to remove from ${e} SourceBuffer`,t)}});t.type?n.append(i(t.type),t.type):this.getSourceBufferTypes().forEach(e=>{n.append(i(e),e)})}onFragParsed(e,t){const{frag:n,part:i}=t,r=[],s=i?i.elementaryStreams:n.elementaryStreams;s[M.AUDIOVIDEO]?r.push("audiovideo"):(s[M.AUDIO]&&r.push("audio"),s[M.VIDEO]&&r.push("video"));const a=()=>{const e=self.performance.now();n.stats.buffering.end=e,i&&(i.stats.buffering.end=e);const t=i?i.stats:n.stats;this.hls.trigger(g.FRAG_BUFFERED,{frag:n,part:i,stats:t,id:n.type})};0===r.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(a,r)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){const n=this.getSourceBufferTypes().reduce((e,n)=>{const i=this.sourceBuffer[n];return!i||t.type&&t.type!==n||(i.ending=!0,i.ended||(i.ended=!0,this.log(`${n} sourceBuffer now EOS`))),e&&!(i&&!i.ended)},!0);n&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(e=>{const t=this.sourceBuffer[e];t&&(t.ending=!1)});const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream()):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||null===t)return;const i=this.getSourceBufferTypes();if(!i.length)return;const r=e.config,s=n.currentTime,a=t.levelTargetDuration,o=t.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(h(o)&&o>0){const e=Math.max(o,a),t=Math.floor(s/a)*a-e;this.flushBackBuffer(s,a,t)}if(h(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){const e=Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),t=Math.max(e,a),n=Math.floor(s/a)*a+t;this.flushFrontBuffer(s,a,n)}}flushBackBuffer(e,t,n){const{details:i,sourceBuffer:r}=this,s=this.getSourceBufferTypes();s.forEach(s=>{const a=r[s];if(a){const r=mi.getBuffered(a);if(r.length>0&&n>r.start(0)){if(this.hls.trigger(g.BACK_BUFFER_REACHED,{bufferEnd:n}),null!=i&&i.live)this.hls.trigger(g.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(a.ended&&r.end(r.length-1)-e<2*t)return void this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);this.hls.trigger(g.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:s})}}})}flushFrontBuffer(e,t,n){const{sourceBuffer:i}=this,r=this.getSourceBufferTypes();r.forEach(r=>{const s=i[r];if(s){const i=mi.getBuffered(s),a=i.length;if(a<2)return;const o=i.start(a-1),l=i.end(a-1);if(n>o||e>=o&&e<=l)return;if(s.ended&&e-l<2*t)return void this.log(`Cannot flush ${r} front buffer while SourceBuffer is in ended state`);this.hls.trigger(g.BUFFER_FLUSHING,{startOffset:o,endOffset:1/0,type:r})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:e,hls:t,media:n,mediaSource:i}=this,r=e.fragments[0].start+e.totalduration,s=n.duration,a=h(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(i.duration=1/0,this.updateSeekableRange(e)):(r>a&&r>s||!h(s))&&(this.log(`Updating Media Source duration to ${r.toFixed(3)}`),i.duration=r)}updateSeekableRange(e){const t=this.mediaSource,n=e.fragments,i=n.length;if(i&&e.live&&null!=t&&t.setLiveSeekableRange){const i=Math.max(0,n[0].start),r=Math.max(i,i+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${i}-${r}.`),t.setLiveSeekableRange(i,r)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:n}=this,i=Object.keys(n).length;if(i&&(!e||2===i||"audiovideo"in n)){this.createSourceBuffers(n),this.pendingTracks={};const e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(g.BUFFER_CREATED,{tracks:this.tracks}),e.forEach(e=>{t.executeNext(e)});else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(const r in e)if(!t[r]){var i;const s=e[r];if(!s)throw Error(`source buffer exists for track ${r}, however track does not`);let a=-1===(null==(i=s.levelCodec)?void 0:i.indexOf(","))?s.levelCodec:s.codec;a&&"audio"===r.slice(0,5)&&(a=_t(a,this.appendSource));const o=`${s.container};codecs=${a}`;this.log(`creating sourceBuffer(${o})`);try{const e=t[r]=n.addSourceBuffer(o),i=r;this.addBufferListener(i,"updatestart",this._onSBUpdateStart),this.addBufferListener(i,"updateend",this._onSBUpdateEnd),this.addBufferListener(i,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(i,"bufferedchange",(e,t)=>{const n=t.removedRanges;null!=n&&n.length&&this.hls.trigger(g.BUFFER_FLUSHED,{type:r})}),this.tracks[r]={buffer:e,codec:a,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(e){this.error(`error while trying to add sourceBuffer: ${e.message}`),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:r,mimeType:o})}}}get mediaSrc(){var e,t;const n=(null==(e=this.media)?void 0:null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==n?void 0:n.src}_onSBUpdateStart(e){const{operationQueue:t}=this,n=t.current(e);n.onStart()}_onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const{operationQueue:n}=this,i=n.current(e);i.onComplete(),n.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var n;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(n=this.mediaSource)?void 0:n.readyState}`);this.error(`${i}`,t),this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.operationQueue.current(e);r&&r.onError(i)}removeExecutor(e,t,n){const{media:i,mediaSource:r,operationQueue:s,sourceBuffer:a}=this,o=a[e];if(!i||!r||!o)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void s.shiftAndExecuteNext(e);const l=h(i.duration)?i.duration:1/0,u=h(r.duration)?r.duration:1/0,c=Math.max(0,t),d=Math.min(n,l,u);d>c&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):s.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.sourceBuffer[t];if(n)n.ended=!1,n.appendBuffer(e);else if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{operationQueue:n}=this,i=t.map(e=>n.appendBlocker(e));Promise.all(i).then(()=>{e(),t.forEach(e=>{const t=this.sourceBuffer[e];null!=t&&t.updating||n.shiftAndExecuteNext(e)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,n){const i=this.sourceBuffer[e];if(!i)return;const r=n.bind(this,e);this.listeners[e].push({event:t,listener:r}),i.addEventListener(t,r)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(e=>{t.removeEventListener(e.event,e.listener)})}}function Rs(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function Ms(e,t){const n=self.document.createElement("source");n.type="video/mp4",n.src=t,e.appendChild(n)}const Ls={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ps=e=>String.fromCharCode(Ls[e]||e),Os=15,Ns=100,Us={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Fs={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Bs={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},js={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Vs=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Hs{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n="function"===typeof t?t():t;E.log(`${this.time} [${e}] ${n}`)}}}const $s=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class Gs{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class zs{constructor(){this.uchar=" ",this.penState=new Gs}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class qs{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Gs,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Ns;t++)this.chars.push(new zs);this.logger=e}equals(e){for(let t=0;t<Ns;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Ns;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Ns;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ns&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ns)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Ps(e);this.pos>=Ns?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<Ns;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Ns;n++){const i=this.chars[n].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);const t=this.chars[this.pos];t.setPenState(this.currPenState)}}class Ws{constructor(e){this.rows=[],this.currRow=Os-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Os;t++)this.rows.push(new qs(e));this.logger=e}reset(){for(let e=0;e<Os;e++)this.rows[e].clear();this.currRow=Os-1}equals(e){let t=!0;for(let n=0;n<Os;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Os;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Os;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){const e=this.rows[this.currRow];e.backSpace()}clearToEndOfRow(){const e=this.rows[this.currRow];e.clearToEndOfRow()}insertChar(e){const t=this.rows[this.currRow];t.insertChar(e)}setPen(e){const t=this.rows[this.currRow];t.setPenStyles(e)}moveCursor(e){const t=this.rows[this.currRow];t.moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);const t=this.rows[this.currRow];t.setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let t=0;t<Os;t++)this.rows[t].clear();const e=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const i=n.rows[e].cueStartTime,r=this.logger.time;if(null!==i&&null!==r&&i<r)for(let s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(n.rows[e+s])}}this.currRow=t;const n=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,i=Math.max(t-1,0);n.setCursor(e.indent),e.color=n.chars[i].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let r=0;r<Os;r++){const n=this.rows[r].getTextString();n&&(i=r+1,e?t.push("Row "+i+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}getTextAndFormat(){return this.rows}}class Ks{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ws(n),this.nonDisplayedMemory=new Ws(n),this.lastOutputScreen=new Ws(n),this.currRollUpRow=this.displayedMemory.rows[Os-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Os-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Ys{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Zs(),this.logger=void 0;const i=this.logger=new Hs;this.channels=[null,new Ks(e,t,i),new Ks(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const e=127&t[n],i=127&t[n+1];let r=!1,s=null;if(0===e&&0===i)continue;this.logger.log(3,()=>"["+$s([t[n],t[n+1]])+"] -> ("+$s([e,i])+")");const a=this.cmdHistory,o=e>=16&&e<=31;if(o){if(Qs(e,i,a)){Xs(null,null,a),this.logger.log(3,()=>"Repeated command ("+$s([e,i])+") is dropped");continue}Xs(e,i,this.cmdHistory),r=this.parseCmd(e,i),r||(r=this.parseMidrow(e,i)),r||(r=this.parsePAC(e,i)),r||(r=this.parseBackgroundAttributes(e,i))}else Xs(null,null,a);if(!r&&(s=this.parseChars(e,i),s)){const e=this.currentChannel;if(e&&e>0){const t=this.channels[e];t.insertChars(s)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||s||this.logger.log(2,()=>"Couldn't parse cleaned data "+$s([e,i])+" orig: "+$s([t[n],t[n+1]]))}}parseCmd(e,t){const n=(20===e||28===e||21===e||29===e)&&t>=32&&t<=47,i=(23===e||31===e)&&t>=33&&t<=35;if(!n&&!i)return!1;const r=20===e||21===e||23===e?1:2,s=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?s.ccRCL():33===t?s.ccBS():34===t?s.ccAOF():35===t?s.ccAON():36===t?s.ccDER():37===t?s.ccRU(2):38===t?s.ccRU(3):39===t?s.ccRU(4):40===t?s.ccFON():41===t?s.ccRDC():42===t?s.ccTR():43===t?s.ccRTD():44===t?s.ccEDM():45===t?s.ccCR():46===t?s.ccENM():47===t&&s.ccEOC():s.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let n=0;if((17===e||25===e)&&t>=32&&t<=47){if(n=17===e?1:2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return!!i&&(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+$s([e,t])+")"),!0)}return!1}parsePAC(e,t){let n;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(16===e||24===e)&&t>=64&&t<=95;if(!i&&!r)return!1;const s=e<=23?1:2;n=t>=64&&t<=95?1===s?Us[e]:Bs[e]:1===s?Fs[e]:js[e];const a=this.channels[s];return!!a&&(a.setPAC(this.interpretPAC(n,t)),this.currentChannel=s,!0)}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,i.underline=1===(1&n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i}parseChars(e,t){let n,i=null,r=null;if(e>=25?(n=2,r=e-8):(n=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,()=>"Special char '"+Ps(e)+"' in channel "+n),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+$s(i).join(",")),i}parseBackgroundAttributes(e,t){const n=(16===e||24===e)&&t>=32&&t<=47,i=(23===e||31===e)&&t>=45&&t<=47;if(!n&&!i)return!1;let r;const s={};16===e||24===e?(r=Math.floor((t-32)/2),s.background=Vs[r],t%2===1&&(s.background=s.background+"_semi")):45===t?s.background="transparent":(s.foreground="black",47===t&&(s.underline=!0));const a=e<=23?1:2,o=this.channels[a];return o.setBkgData(s),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Xs(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Xs(e,t,n){n.a=e,n.b=t}function Qs(e,t,n){return n.a===e&&n.b===t}function Zs(){return{a:null,b:null}}class Js{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var ea=function(){if(null!=$&&$.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function n(e,t){if("string"!==typeof t)return!1;if(!Array.isArray(e))return!1;const n=t.toLowerCase();return!!~e.indexOf(n)&&n}function i(t){return n(e,t)}function r(e){return n(t,e)}function s(e,...t){let n=1;for(;n<arguments.length;n++){const t=arguments[n];for(const n in t)e[n]=t[n]}return e}function a(e,t,n){const a=this,o={enumerable:!0};a.hasBeenReset=!1;let l="",u=!1,c=e,d=t,h=n,f=null,p="",g=!0,m="auto",v="start",y=50,b="middle",_=50,T="middle";Object.defineProperty(a,"id",s({},o,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(a,"pauseOnExit",s({},o,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(a,"startTime",s({},o,{get:function(){return c},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",s({},o,{get:function(){return d},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",s({},o,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",s({},o,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",s({},o,{get:function(){return p},set:function(e){const t=i(e);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",s({},o,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",s({},o,{get:function(){return m},set:function(e){if("number"!==typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",s({},o,{get:function(){return v},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",s({},o,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",s({},o,{get:function(){return b},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",s({},o,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",s({},o,{get:function(){return T},set:function(e){const t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),a.displayState=void 0}return a.prototype.getCueAsHTML=function(){const e=self.WebVTT;return e.convertCueToDOMTree(self,this.text)},a}();class ta{decode(e,t){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function na(e){function t(e,t,n,i){return 3600*(0|e)+60*(0|t)+(0|n)+parseFloat(i||0)}const n=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?t(n[2],n[3],0,n[4]):t(n[1],n[2],n[3],n[4]):null}class ia{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function ra(e,t,n,i){const r=i?e.split(i):[e];for(const s in r){if("string"!==typeof r[s])continue;const e=r[s].split(n);if(2!==e.length)continue;const i=e[0],a=e[1];t(i,a)}}const sa=new ea(0,0,""),aa="middle"===sa.align?"middle":"center";function oa(e,t,n){const i=e;function r(){const t=na(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(e,t){const i=new ia;ra(e,function(e,t){let r;switch(e){case"region":for(let r=n.length-1;r>=0;r--)if(n[r].id===t){i.set(e,n[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),i.integer(e,r[0]),i.percent(e,r[0])&&i.set("snapToLines",!1),i.alt(e,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",aa,"end"]);break;case"position":r=t.split(","),i.percent(e,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",aa,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",aa,"end","left","right"]);break}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let r=i.get("line","auto");"auto"===r&&-1===sa.line&&(r=-1),t.line=r,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",aa);let s=i.get("position","auto");"auto"===s&&50===sa.position&&(s="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=s}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=r(),a(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),a(),t.endTime=r(),a(),s(e,t)}function la(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class ua{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new ta,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function n(){let e=t.buffer,n=0;e=la(e);while(n<e.length&&"\r"!==e[n]&&"\n"!==e[n])++n;const i=e.slice(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.slice(n),i}function i(e){ra(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=n();const i=e.match(/^()?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let r=!1;while(t.buffer){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:e=n(),t.state){case"HEADER":/:/.test(e)?i(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new ea(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{oa(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const n=-1!==e.indexOf("--\x3e");if(!e||n&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const ca=/\r\n|\n\r|\n|\r/g,da=function(e,t,n=0){return e.slice(n,n+t.length)===t},ha=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!h(t)||!h(n)||!h(i)||!h(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=6e4*i,t+=36e5*r,t},fa=function(e){let t=5381,n=e.length;while(n)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()};function pa(e,t,n){return fa(e.toString())+fa(t.toString())+fa(n)}const ga=function(e,t,n){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);while(null!=(s=r)&&s.new){var s;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=n};function ma(e,t,n,i,r,s,a){const o=new ua,l=ge(new Uint8Array(e)).trim().replace(ca,"\n").split("\n"),u=[],c=t?Gr(t.baseTime,t.timescale):0;let d,h="00:00.000",f=0,p=0,g=!0;o.oncue=function(e){const s=n[i];let a=n.ccOffset;const o=(f-c)/9e4;if(null!=s&&s.new&&(void 0!==p?a=n.ccOffset=s.start:ga(n,i,o)),o){if(!t)return void(d=new Error("Missing initPTS for VTT MPEGTS"));a=o-n.presentationOffset}const l=e.endTime-e.startTime,h=Jr(9e4*(e.startTime+a-p),9e4*r)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const g=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(g)),e.id||(e.id=pa(e.startTime,e.endTime,g)),e.endTime>0&&u.push(e)},o.onparsingerror=function(e){d=e},o.onflush=function(){d?a(d):s(u)},l.forEach(e=>{if(g){if(da(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach(e=>{da(e,"LOCAL:")?h=e.slice(6):da(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))});try{p=ha(h)/1e3}catch(e){d=e}return}""===e&&(g=!1)}o.parse(e+"\n")}),o.flush()}const va="stpp.ttml.im1t",ya=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ba=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,_a={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ta(e,t,n,i){const r=Ce(new Uint8Array(e),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const s=r.map(e=>ge(e)),a=Hr(t.baseTime,1,t.timescale);try{s.forEach(e=>n(Sa(e,a)))}catch(e){i(e)}}function Sa(e,t){const n=new DOMParser,i=n.parseFromString(e,"text/xml"),r=i.getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((e,t)=>{return e[t]=r.getAttribute(`ttp:${t}`)||s[t],e},{}),o="preserve"!==r.getAttribute("xml:space"),l=Ea(wa(r,"styling","style")),u=Ea(wa(r,"layout","region")),c=wa(r,"body","[begin]");return[].map.call(c,e=>{const n=xa(e,o);if(!n||!e.hasAttribute("begin"))return null;const i=Ca(e.getAttribute("begin"),a),r=Ca(e.getAttribute("dur"),a);let s=Ca(e.getAttribute("end"),a);if(null===i)throw Ia(e);if(null===s){if(null===r)throw Ia(e);s=i+r}const c=new ea(i-t,s-t,n);c.id=pa(c.startTime,c.endTime,c.text);const h=u[e.getAttribute("region")],f=l[e.getAttribute("style")],p=ka(h,f,l),{textAlign:g}=p;if(g){const e=_a[g];e&&(c.lineAlign=e),c.align=g}return d(c,p),c}).filter(e=>null!==e)}function wa(e,t,n){const i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(n)):[]}function Ea(e){return e.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function xa(e,t){return[].slice.call(e.childNodes).reduce((e,n,i)=>{var r;return"br"===n.nodeName&&i?e+"\n":null!=(r=n.childNodes)&&r.length?xa(n,t):t?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent},"")}function ka(e,t,n){const i="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return a&&n.hasOwnProperty(a)&&(r=n[a]),s.reduce((n,s)=>{const a=Aa(t,i,s)||Aa(e,i,s)||Aa(r,i,s);return a&&(n[s]=a),n},{})}function Aa(e,t,n){return e&&e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function Ia(e){return new Error(`Could not parse ttml timestamp ${e}`)}function Ca(e,t){if(!e)return null;let n=na(e);return null===n&&(ya.test(e)?n=Da(e,t):ba.test(e)&&(n=Ra(e,t))),n}function Da(e,t){const n=ya.exec(e),i=(0|n[4])+(0|n[5])/t.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+i/t.frameRate}function Ra(e,t){const n=ba.exec(e),i=Number(n[1]),r=n[2];switch(r){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}class Ma{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Na(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(g.FRAG_LOADING,this.onFragLoading,this),e.on(g.FRAG_LOADED,this.onFragLoaded,this),e.on(g.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(g.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(g.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(g.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(g.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(g.FRAG_LOADING,this.onFragLoading,this),e.off(g.FRAG_LOADED,this.onFragLoaded,this),e.off(g.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(g.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(g.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(g.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(g.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new Js(this,"textTrack1"),t=new Js(this,"textTrack2"),n=new Js(this,"textTrack3"),i=new Js(this,"textTrack4");this.cea608Parser1=new Ys(1,e,t),this.cea608Parser2=new Ys(3,n,i)}}addCues(e,t,n,i,r){let s=!1;for(let a=r.length;a--;){const e=r[a],i=Oa(e[0],e[1],t,n);if(i>=0&&(e[0]=Math.min(e[0],t),e[1]=Math.max(e[1],n),s=!0,i/(n-t)>.5))return}if(s||r.push([t,n]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,n,i)}else{const r=this.Cues.newCue(null,t,n,i);this.hls.trigger(g.CUES_PARSED,{type:"captions",cues:r,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:r}){const{unparsedVttFrags:s}=this;"main"===n&&(this.initPTS[t.cc]={baseTime:i,timescale:r}),s.length&&(this.unparsedVttFrags=[],s.forEach(e=>{this.onFragLoaded(g.FRAG_LOADED,e)}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const r=n.textTracks[i];if(Pa(r,{name:e,lang:t,attrs:{}}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:r,languageCode:s}=t[e],a=this.getExistingTrack(r,s);if(a)n[e]=a,Gt(n[e]),Ht(n[e],i);else{const t=this.createTextTrack("captions",r,s);t&&(t[e]=!0,n[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,i={_id:e,label:n,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(g.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Gt(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Na(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)Gt(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(e=>e.textCodec===va);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){const e=ys(this.tracks,n);if(e)return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const e=this.media,t=e?Kt(e.textTracks):null;if(this.tracks.forEach((e,n)=>{let i;if(t){let n=null;for(let i=0;i<t.length;i++)if(t[i]&&Pa(t[i],e)){n=t[i],t[i]=null;break}n&&(i=n)}if(i)Gt(i);else{const t=La(e);i=this.createTextTrack(t,e.name,e.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&E.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map(e=>{return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}});this.hls.trigger(g.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const n=`textTrack${t[1]}`,i=this.captionsProperties[n];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Ft.MAIN){var n,i;const{cea608Parser1:e,cea608Parser2:r,lastSn:s}=this,{cc:a,sn:o}=t.frag,l=null!=(n=null==(i=t.part)?void 0:i.index)?n:-1;e&&r&&(o!==s+1||o===s&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),r.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===Ft.SUBTITLE)if(i.byteLength){const e=n.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[n.level],r=this.vttCCs;r[n.cc]||(r[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),e&&e.textCodec===va?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Ta(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),n.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{E.log(`Failed to parse IMSC1: ${t}`),n.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:r,unparsedVttFrags:s}=this,a=r.length-1;if(!r[n.cc]&&-1===a)return void s.push(e);const o=this.hls,l=null!=(t=n.initSegment)&&t.data?$e(n.initSegment.data,new Uint8Array(i)):i;ma(l,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,e=>{this._appendCues(e,n.level),o.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?s.push(e):this._fallbackToIMSC1(n,i),E.log(`Failed to parse VTT cue: ${t}`),r&&a>n.cc||o.trigger(g.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:t})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Ta(t,this.initPTS[e.cc],()=>{n.textCodec=va,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||"disabled"===n.mode)return;e.forEach(e=>$t(n,e))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;n.trigger(g.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===Ft.SUBTITLE&&this.onFragLoaded(g.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:n,cea608Parser2:i}=this;if(!this.enabled||!n||!i)return;const{frag:r,samples:s}=t;if(r.type!==Ft.MAIN||"NONE"!==this.closedCaptionsForLevel(r))for(let a=0;a<s.length;a++){const e=s[a].bytes;if(e){const t=this.extractCea608Data(e);n.addData(s[a].pts,t[0]),i.addData(s[a].pts,t[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:i,type:r}){const{media:s}=this;if(s&&!(s.currentTime<n)){if(!r||"video"===r){const{captionsTracks:e}=this;Object.keys(e).forEach(i=>zt(e[i],t,n))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){const{textTracks:e}=this;Object.keys(e).forEach(n=>zt(e[n],t,i))}}}extractCea608Data(e){const t=[[],[]],n=31&e[0];let i=2;for(let r=0;r<n;r++){const n=e[i++],r=127&e[i++],s=127&e[i++];if(0===r&&0===s)continue;const a=0!==(4&n);if(a){const e=3&n;0!==e&&1!==e||(t[e].push(r),t[e].push(s))}}return t}}function La(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function Pa(e,t){return!!e&&e.kind===La(t)&&_s(t,e)}function Oa(e,t,n,i){return Math.min(t,i)-Math.max(e,n)}function Na(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Ua{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(g.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(g.BUFFER_CODECS,this.onBufferCodecs,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(g.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(g.BUFFER_CODECS,this.onBufferCodecs,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&h(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){const n=this.hls;n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&E.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((t,n)=>this.isLevelAllowed(t)&&n<=e);return this.clientRect=null,Ua.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}isLevelAllowed(e){const t=this.restrictedLevels;return!t.some(t=>{return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height})}static getMaxLevelByMediaSize(e,t,n){if(null==e||!e.length)return-1;const i=(e,t)=>{return!t||(e.width!==t.width||e.height!==t.height)};let r=e.length-1;const s=Math.max(t,n);for(let a=0;a<e.length;a+=1){const t=e[a];if((t.width>=s||t.height>=s)&&i(t,e[a+1])){r=a;break}}return r}}class Fa{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(g.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(g.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"===typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const e=i-this.lastTime,r=n-this.lastDroppedFrames,s=t-this.lastDecodedFrames,a=1e3*r/e,o=this.hls;if(o.trigger(g.FPS_DROP,{currentDropped:r,currentDecoded:s,totalDroppedFrames:n}),a>0&&r>o.config.fpsDroppedMonitoringThreshold*s){let e=o.currentLevel;E.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(g.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const Ba="[eme]";class ja{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=ja.CDMCleanupPromise?[ja.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=E.debug.bind(E,Ba),this.log=E.log.bind(E,Ba),this.warn=E.warn.bind(E,Ba),this.error=E.error.bind(E,Ba),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(g.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(g.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(g.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(g.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===G.WIDEVINE&&n)return n;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(e,t,n)=>!!e&&n.indexOf(e)===t,i=t.map(e=>e.audioCodec).filter(n),r=t.map(e=>e.videoCodec).filter(n);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise((t,n)=>{const s=e=>{const a=e.shift();this.getMediaKeysPromise(a,i,r).then(e=>t({keySystem:a,mediaKeys:e})).catch(t=>{e.length?s(e):n(t instanceof Va?t:new Va({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};s(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!==typeof n){let e=`Configured requestMediaKeySystemAccess is not a function ${n}`;return null===Q&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return n(e,t)}getMediaKeysPromise(e,t,n){const i=Z(e,t,n,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let s=null==r?void 0:r.keySystemAccess;if(!s){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(i)}`),s=this.requestMediaKeySystemAccess(e,i);const t=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch(t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)}),s.then(n=>{this.log(`Access for key-system "${n.keySystem}" obtained`);const i=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=n.createMediaKeys().then(t=>{return this.log(`Media-keys created for "${e}"`),i.then(n=>{return n?this.setMediaKeysServerCertificate(t,e,n):t})}),t.mediaKeys.catch(t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)}),t.mediaKeys})}return s.then(()=>r.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${ye.hexDump(e.keyId||[])}`);const i=n.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,r,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return ye.hexDump(e.keyId)}updateKeySession(e,t){var n;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${ye.hexDump((null==(n=e.decryptdata)?void 0:n.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,n)=>{const i=X(this.config),r=e.map(q).filter(e=>!!e&&-1!==i.indexOf(e));return this.getKeySystemSelectionPromise(r).then(({keySystem:e})=>{const i=Y(e);i?t(i):n(new Error(`Unable to find format for key-system "${e}"`))}).catch(n)})}loadKey(e){const t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),i=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let r=this.keyIdToKeySessionPromise[n];return r||(r=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(t).then(({keySystem:n,mediaKeys:r})=>{return this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(n,r).then(()=>{this.throwIfDestroyed();const e=this.createMediaKeySessionContext({keySystem:n,mediaKeys:r,decryptdata:t}),i="cenc";return this.generateRequestWithPreferredKeySession(e,i,t.pssh,"playlist-key")})}),r.catch(e=>this.handleError(e))),r}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Va?this.hls.trigger(g.ERROR,e.data):this.hls.trigger(g.ERROR,{type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){const t=q(e.keyFormat),n=t?[t]:X(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=X(this.config)),0===e.length)throw new Va({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:n}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),null===n)return;let i,r;if("sinf"===t&&this.config.drmSystems[G.FAIRPLAY]){const e=Se(new Uint8Array(n));try{const t=F(JSON.parse(e).sinf),n=Ue(new Uint8Array(t));if(!n)return;i=n.subarray(8,24),r=G.FAIRPLAY}catch(e){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{const e=Ze(n);if(null===e)return;0===e.version&&e.systemId===W.WIDEVINE&&e.data&&(i=e.data.subarray(8,24)),r=K(e.systemId)}if(!r||!i)return;const s=ye.hexDump(i),{keyIdToKeySessionPromise:a,mediaKeySessions:o}=this;let l=a[s];for(let u=0;u<o.length;u++){const e=o[u],r=e.decryptdata;if(r.pssh||!r.keyId)continue;const c=ye.hexDump(r.keyId);if(s===c||-1!==r.uri.replace(/-/g,"").indexOf(s)){l=a[c],delete a[c],r.pssh=new Uint8Array(n),r.keyId=i,l=a[s]=l.then(()=>{return this.generateRequestWithPreferredKeySession(e,t,n,"encrypted-event-key-match")});break}}l||(l=a[s]=this.getKeySystemSelectionPromise([r]).then(({keySystem:e,mediaKeys:r})=>{var a;this.throwIfDestroyed();const o=new et("ISO-23001-7",s,null!=(a=Y(e))?a:"");return o.pssh=new Uint8Array(n),o.keyId=i,this.attemptSetMediaKeys(e,r).then(()=>{this.throwIfDestroyed();const i=this.createMediaKeySessionContext({decryptdata:o,keySystem:e,mediaKeys:r});return this.generateRequestWithPreferredKeySession(i,t,n,"encrypted-event-no-match")})})),l.catch(e=>this.handleError(e))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(n).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===n.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,n,i){var r,s;const a=null==(r=this.config.drmSystems)?void 0:null==(s=r[e.keySystem])?void 0:s.generateRequest;if(a)try{const i=a.call(this.hls,t,n,e);if(!i)throw new Error("Invalid response from configured generateRequest filter");t=i.initDataType,n=e.decryptdata.pssh=i.initData?new Uint8Array(i.initData):null}catch(e){var o;if(this.warn(e.message),null!=(o=this.hls)&&o.config.debug)throw e}if(null===n)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${l} (init data type: ${t} length: ${n?n.byteLength:null})`);const u=new ms,c=e._onmessage=(t=>{const n=e.mediaKeysSession;if(!n)return void u.emit("error",new Error("invalid state"));const{messageType:i,message:r}=t;this.log(`"${i}" message event for session "${n.sessionId}" message size: ${r.byteLength}`),"license-request"===i||"license-renewal"===i?this.renewLicense(e,r).catch(e=>{this.handleError(e),u.emit("error",e)}):"license-release"===i?e.keySystem===G.FAIRPLAY&&(this.updateKeySession(e,H("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${i}"`)}),d=e._onkeystatuseschange=(t=>{const n=e.mediaKeysSession;if(!n)return void u.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const i=e.keyStatus;u.emit("keyStatus",i),"expired"===i&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))});e.mediaKeysSession.addEventListener("message",c),e.mediaKeysSession.addEventListener("keystatuseschange",d);const h=new Promise((e,t)=>{u.on("error",t),u.on("keyStatus",n=>{n.startsWith("usable")?e():"output-restricted"===n?t(new Va({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===n?t(new Va({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${n}"`)):"expired"===n?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${n}"`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)}).catch(e=>{throw new Va({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},`Error generating key-session request: ${e}`)}).then(()=>h).catch(t=>{throw u.removeAllListeners(),this.removeSession(e),t}).then(()=>{return u.removeAllListeners(),e})}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,n)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${ye.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${ye.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,n=t.loader,i=new n(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((n,s)=>{const a={responseType:"arraybuffer",url:r},l=t.certLoadPolicy.default,u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,i,r)=>{n(e.data)},onError:(t,n,i,l)=>{s(new Va({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:o({url:a.url,data:void 0},t)},`"${e}" certificate request failed (${r}). Status: ${t.code} (${t.text})`))},onTimeout:(t,n,i)=>{s(new Va({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:a.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(e,t,n)=>{s(new Error("aborted"))}};i.load(a,u,c)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,r)=>{e.setServerCertificate(n).then(r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${null==n?void 0:n.byteLength}) on "${t}"`),i(e)}).catch(e=>{r(new Va({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>{return this.updateKeySession(e,new Uint8Array(t)).catch(e=>{throw new Va({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)})})}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=(new DOMParser).parseFromString(n,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let t;for(let n=0,i=r.length;n<i;n++){var s,a;t=r[n];const i=null==(s=t.querySelector("name"))?void 0:s.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;i&&o&&e.setRequestHeader(i,o)}}const o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return H(atob(l))}setupLicenseXHR(e,t,n,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,n,i)}).catch(s=>{if(!n.decryptdata)throw s;return e.open("POST",t,!0),r.call(this.hls,e,t,n,i)}).then(n=>{e.readyState||e.open("POST",t,!0);const r=n||i;return{xhr:e,licenseChallenge:r}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,r)=>{const s=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${s}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=(()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const n=this.config.licenseResponseCallback;if(n)try{t=n.call(this.hls,a,s,e)}catch(e){this.error(e)}i(t)}else{const o=n.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)r(new Va({type:m.KEY_SYSTEM_ERROR,details:v.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:s,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${s}). Status: ${a.status} (${a.statusText})`));else{const n=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${n} attempts left`),this.requestLicense(e,t).then(i,r)}}}),e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,s,e,t).then(({xhr:t,licenseChallenge:n})=>{e.keySystem==G.PLAYREADY&&(n=this.unpackPlayReadyKeyMessage(t,n)),t.send(n)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},et.clearKeyUriToKeyIdMap();const n=t.length;ja.CDMCleanupPromise=Promise.all(t.map(e=>this.removeSession(e)).concat(null==e?void 0:e.setMediaKeys(null).catch(e=>{this.log(`Could not clear media keys: ${e}`)}))).then(()=>{n&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(e=>{this.log(`Could not close sessions and clear media keys: ${e}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce((e,t)=>{return-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e},[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),t.remove().catch(e=>{this.log(`Could not remove session: ${e}`)}).then(()=>{return t.close()}).catch(e=>{this.log(`Could not close session: ${e}`)})}}}ja.CDMCleanupPromise=void 0;class Va extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var Ha,$a,Ga;(function(e){e["MANIFEST"]="m",e["AUDIO"]="a",e["VIDEO"]="v",e["MUXED"]="av",e["INIT"]="i",e["CAPTION"]="c",e["TIMED_TEXT"]="tt",e["KEY"]="k",e["OTHER"]="o"})(Ha||(Ha={})),function(e){e["DASH"]="d",e["HLS"]="h",e["SMOOTH"]="s",e["OTHER"]="o"}($a||($a={})),function(e){e["OBJECT"]="CMCD-Object",e["REQUEST"]="CMCD-Request",e["SESSION"]="CMCD-Session",e["STATUS"]="CMCD-Status"}(Ga||(Ga={}));const za={[Ga.OBJECT]:["br","d","ot","tb"],[Ga.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Ga.SESSION]:["cid","pr","sf","sid","st","v"],[Ga.STATUS]:["bs","rtp"]};class qa{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(e=>e instanceof qa?e:new qa(e))),this.value=e,this.params=t}}class Wa{constructor(e){this.description=void 0,this.description=e}}const Ka="Dict";function Ya(e){return Array.isArray(e)?JSON.stringify(e):e instanceof Map?"Map{}":e instanceof Set?"Set{}":"object"===typeof e?JSON.stringify(e):String(e)}function Xa(e,t,n,i){return new Error(`failed to ${e} "${Ya(t)}" as ${n}`,{cause:i})}const Qa="Bare Item",Za="Boolean",Ja="Byte Sequence",eo="Decimal",to="Integer";function no(e){return e<-999999999999999||999999999999999<e}const io=/[\x00-\x1f\x7f]+/,ro="Token",so="Key";function ao(e,t,n){return Xa("serialize",e,t,n)}function oo(e){if("boolean"!==typeof e)throw ao(e,Za);return e?"?1":"?0"}function lo(e){return btoa(String.fromCharCode(...e))}function uo(e){if(!1===ArrayBuffer.isView(e))throw ao(e,Ja);return`:${lo(e)}:`}function co(e){if(no(e))throw ao(e,to);return e.toString()}function ho(e){return`@${co(e.getTime()/1e3)}`}function fo(e,t){if(e<0)return-fo(-e,t);const n=Math.pow(10,t),i=Math.abs(e*n%1-.5)<Number.EPSILON;if(i){const t=Math.floor(e*n);return(t%2===0?t:t+1)/n}return Math.round(e*n)/n}function po(e){const t=fo(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw ao(e,eo);const n=t.toString();return n.includes(".")?n:`${n}.0`}const go="String";function mo(e){if(io.test(e))throw ao(e,go);return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function vo(e){return e.description||e.toString().slice(7,-1)}function yo(e){const t=vo(e);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw ao(t,ro);return t}function bo(e){switch(typeof e){case"number":if(!h(e))throw ao(e,Qa);return Number.isInteger(e)?co(e):po(e);case"string":return mo(e);case"symbol":return yo(e);case"boolean":return oo(e);case"object":if(e instanceof Date)return ho(e);if(e instanceof Uint8Array)return uo(e);if(e instanceof Wa)return yo(e);default:throw ao(e,Qa)}}function _o(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw ao(e,so);return e}function To(e){return null==e?"":Object.entries(e).map(([e,t])=>{return!0===t?`;${_o(e)}`:`;${_o(e)}=${bo(t)}`}).join("")}function So(e){return e instanceof qa?`${bo(e.value)}${To(e.params)}`:bo(e)}function wo(e){return`(${e.value.map(So).join(" ")})${To(e.params)}`}function Eo(e,t={whitespace:!0}){if("object"!==typeof e)throw ao(e,Ka);const n=e instanceof Map?e.entries():Object.entries(e),i=null!=t&&t.whitespace?" ":"";return Array.from(n).map(([e,t])=>{t instanceof qa===!1&&(t=new qa(t));let n=_o(e);return!0===t.value?n+=To(t.params):(n+="=",Array.isArray(t.value)?n+=wo(t):n+=So(t)),n}).join(`,${i}`)}function xo(e,t){return Eo(e,t)}const ko=e=>"ot"===e||"sf"===e||"st"===e,Ao=e=>{return"number"===typeof e?h(e):null!=e&&""!==e&&!1!==e};function Io(e,t){const n=new URL(e),i=new URL(t);if(n.origin!==i.origin)return e;const r=n.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);while(r[0]===s[0])r.shift(),s.shift();while(s.length)s.shift(),r.unshift("..");return r.join("/")}function Co(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();const n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return n}}}const Do=e=>Math.round(e),Ro=(e,t)=>{return null!=t&&t.baseUrl&&(e=Io(e,t.baseUrl)),encodeURIComponent(e)},Mo=e=>100*Do(e/100),Lo={br:Do,d:Do,bl:Mo,dl:Mo,mtp:Mo,nor:Ro,rtp:Mo,tb:Do};function Po(e,t){const n={};if(null==e||"object"!==typeof e)return n;const i=Object.keys(e).sort(),r=d({},Lo,null==t?void 0:t.formatters),s=null==t?void 0:t.filter;return i.forEach(i=>{if(null!=s&&s(i))return;let a=e[i];const o=r[i];o&&(a=o(a,t)),"v"===i&&1===a||"pr"==i&&1===a||Ao(a)&&(ko(i)&&"string"===typeof a&&(a=new Wa(a)),n[i]=a)}),n}function Oo(e,t={}){return e?xo(Po(e,t),d({whitespace:!1},t)):""}function No(e,t={}){if(!e)return{};const n=Object.entries(e),i=Object.entries(za).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{})),r=n.reduce((e,t)=>{var n;const[r,s]=t,a=(null==(n=i.find(e=>e[1].includes(r)))?void 0:n[0])||Ga.REQUEST;return null!=e[a]||(e[a]={}),e[a][r]=s,e},{});return Object.entries(r).reduce((e,[n,i])=>{return e[n]=Oo(i,t),e},{})}function Uo(e,t,n){return d(e,No(t,n))}const Fo="CMCD";function Bo(e,t={}){if(!e)return"";const n=Oo(e,t);return`${Fo}=${encodeURIComponent(n)}`}const jo=/CMCD=[^&#]+/;function Vo(e,t,n){const i=Bo(t,n);if(!i)return e;if(jo.test(e))return e.replace(jo,i);const r=e.includes("?")?"&":"?";return`${e}${r}${i}`}class Ho{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=(()=>{this.initialized&&(this.starved=!0),this.buffering=!0}),this.onPlaying=(()=>{this.initialized||(this.initialized=!0),this.buffering=!1}),this.applyPlaylistData=(e=>{try{this.apply(e,{ot:Ha.MANIFEST,su:!this.initialized})}catch(e){E.warn("Could not generate manifest CMCD data.",e)}}),this.applyFragmentData=(e=>{try{const t=e.frag,n=this.hls.levels[t.level],i=this.getObjectType(t),r={d:1e3*t.duration,ot:i};i!==Ha.VIDEO&&i!==Ha.AUDIO&&i!=Ha.MUXED||(r.br=n.bitrate/1e3,r.tb=this.getTopBandwidth(i)/1e3,r.bl=this.getBufferLength(i)),this.apply(e,r)}catch(e){E.warn("Could not generate segment CMCD data.",e)}}),this.hls=e;const t=this.config=e.config,{cmcd:n}=t;null!=n&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||Co(),this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHED,this.onMediaDetached,this),e.on(g.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHED,this.onMediaDetached,this),e.off(g.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=null==(n=t.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}createData(){var e;return{v:1,sf:$a.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){d(t,this.createData());const n=t.ot===Ha.INIT||t.ot===Ha.VIDEO||t.ot===Ha.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((e,n)=>{return i.includes(n)&&(e[n]=t[n]),e},{})),this.useHeaders?(e.headers||(e.headers={}),Uo(e.headers,t)):e.url=Vo(e.url,t)}getObjectType(e){const{type:t}=e;return"subtitle"===t?Ha.TIMED_TEXT:"initSegment"===e.sn?Ha.INIT:"audio"===t?Ha.AUDIO:"main"===t?this.hls.audioTracks.length?Ha.VIDEO:Ha.MUXED:void 0}getTopBandwidth(e){let t,n=0;const i=this.hls;if(e===Ha.AUDIO)t=i.audioTracks;else{const e=i.maxAutoLevel,n=e>-1?e+1:i.levels.length;t=i.levels.slice(0,n)}for(const r of t)r.bitrate>n&&(n=r.bitrate);return n>0?n:NaN}getBufferLength(e){const t=this.hls.media,n=e===Ha.AUDIO?this.audioBuffer:this.videoBuffer;if(!n||!t)return NaN;const i=mi.bufferInfo(n,t.currentTime,this.config.maxBufferHole);return 1e3*i.len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,i){t(e),this.loader.load(e,n,i)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new n(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,n,i){t(e),this.loader.load(e,n,i)}}}}const $o=3e5;class Go{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=E.log.bind(E,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((null==n?void 0:n.action)===jn.SendAlternateToPenaltyBox&&n.flags===Vn.MoveAllAlternatesMatchingHost){const e=this.levels;let i=this.pathwayPriority,r=this.pathwayId;if(t.context){const{groupId:n,pathwayId:i,type:s}=t.context;n&&e?r=this.getPathwayForGroupId(n,s,r):i&&(r=i)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!i&&e&&(i=e.reduce((e,t)=>{return-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e},[])),i&&i.length>1&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==r),n.resolved||E.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${r} levels: ${e?e.length:e} priorities: ${JSON.stringify(i)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this.pathwayPriority=e;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(e=>{i-n[e]>$o&&delete n[e]});for(let r=0;r<e.length;r++){const i=e[r];if(i in n)continue;if(i===this.pathwayId)return;const s=this.hls.nextLoadLevel,a=this.hls.levels[s];if(t=this.getLevelsForPathway(i),t.length>0){this.log(`Setting Pathway to "${i}"`),this.pathwayId=i,kn(t),this.hls.trigger(g.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[s];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=s);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===Ut.AUDIO_TRACK&&i[r].hasAudioGroup(e)||t===Ut.SUBTITLE_TRACK&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(e=>{const{ID:r,"BASE-ID":s,"URI-REPLACEMENT":a}=e;if(t.some(e=>e.pathwayId===r))return;const o=this.getLevelsForPathway(s).map(e=>{const t=new A(e.attrs);t["PATHWAY-ID"]=r;const s=t.AUDIO&&`${t.AUDIO}_clone_${r}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${r}`;s&&(n[t.AUDIO]=s,t.AUDIO=s),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);const l=qo(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),u=new hn({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let n=1;n<e.audioGroups.length;n++)u.addGroupId("audio",`${e.audioGroups[n]}_clone_${r}`);if(e.subtitleGroups)for(let n=1;n<e.subtitleGroups.length;n++)u.addGroupId("text",`${e.subtitleGroups[n]}_clone_${r}`);return u});t.push(...o),zo(this.audioTracks,n,a,r),zo(this.subtitleTracks,i,a,r)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new n(t);try{i=new self.URL(e)}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==i.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+e)}const r={responseType:"json",url:i.href},s=t.steeringManifestLoadPolicy.default,a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,n,r)=>{this.log(`Loaded steering manifest: "${i}"`);const s=e.data;if(1!==s.VERSION)return void this.log(`Steering VERSION ${s.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=s.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=s;if(a)try{this.uri=new self.URL(a,i).href}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||n.url),o&&this.clonePathways(o);const u={steeringManifest:s,url:i.toString()};this.hls.trigger(g.STEERING_MANIFEST_LOADED,u),l&&this.updatePathwayPriority(l)},onError:(e,t,n,i)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let r=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,r);else{const e=this.loader;if("function"===typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},onTimeout:(e,t,n)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const n=null==(t=this.hls)?void 0:t.media;!n||n.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}}function zo(e,t,n,i){e&&Object.keys(t).forEach(r=>{const s=e.filter(e=>e.groupId===r).map(e=>{const s=d({},e);return s.details=void 0,s.attrs=new A(s.attrs),s.url=s.attrs.URI=qo(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),s.groupId=s.attrs["GROUP-ID"]=t[r],s.attrs["PATHWAY-ID"]=i,s});e.push(...s)})}function qo(e,t,n,i){const{HOST:r,PARAMS:s,[n]:a}=i;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return r&&!o&&(l.host=r),s&&Object.keys(s).sort().forEach(e=>{e&&l.searchParams.set(e,s[e])}),l.href}const Wo=/^age:\s*[\d.]+\s*$/im;class Ko{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new R,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(this.loader===n&&!this.stats.aborted)return r(n,t.url)}).catch(e=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",t.url,!0),r(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(e=>{this.callbacks.onError({code:n.status,text:e.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:s}=n.loadPolicy;if(i)for(const a in i)e.setRequestHeader(a,i[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=r&&h(r)?r:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!n.aborted&&i>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const i=t.status,s="text"!==t.responseType;if(i>=200&&i<300&&(s&&t.response||null!==t.responseText)){n.loading.end=Math.max(self.performance.now(),n.loading.first);const r=s?t.response:t.responseText,a="arraybuffer"===t.responseType?r.byteLength:r.length;if(n.loaded=n.total=a,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first),!this.callbacks)return;const o=this.callbacks.onProgress;if(o&&o(n,e,r,t),!this.callbacks)return;const l={url:t.responseURL,data:r,code:i};this.callbacks.onSuccess(l,n,e,t)}else{const s=r.loadPolicy.errorRetry,a=n.retry,o={url:e.url,data:void 0,code:i};Rn(s,a,!1,o)?this.retry(s):(E.error(`${i} while loading ${e.url}`),this.callbacks.onError({code:i,text:t.statusText},e,t,n))}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Rn(e,t,!0))this.retry(e);else{var n;E.warn(`timeout while loading ${null==(n=this.context)?void 0:n.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=Cn(e,n.retry),n.retry++,E.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&Wo.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function Yo(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}const Xo=/(\d+)-(\d+)\/(\d+)/;class Qo{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||tl,this.controller=new self.AbortController,this.stats=new R}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=Zo(e,this.controller.signal),s=n.onProgress,a="arraybuffer"===e.responseType,o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=l&&h(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(i,e,this.response)},t.timeout),self.fetch(this.request).then(r=>{this.response=this.loader=r;const o=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(i,e,this.response)},u-(o-i.loading.start)),!r.ok){const{status:e,statusText:t}=r;throw new nl(t||"fetch, bad network response",e,r)}return i.loading.first=o,i.total=el(r.headers)||i.total,s&&h(t.highWaterMark)?this.loadProgressively(r,i,e,t.highWaterMark,s):a?r.arrayBuffer():"json"===e.responseType?r.json():r.text()}).then(r=>{const a=this.response;if(!a)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=r[o];l&&(i.loaded=i.total=l);const u={url:a.url,data:r,code:a.status};s&&!h(t.highWaterMark)&&s(i,e,r,a),n.onSuccess(u,i,e,a)}).catch(t=>{if(self.clearTimeout(this.requestTimeout),i.aborted)return;const r=t&&t.code||0,s=t?t.message:null;n.onError({code:r,text:s},e,t?t.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,i=0,r){const s=new Vi,a=e.body.getReader(),o=()=>{return a.read().then(a=>{if(a.done)return s.dataLength&&r(t,n,s.flush(),e),Promise.resolve(new ArrayBuffer(0));const l=a.value,u=l.length;return t.loaded+=u,u<i||s.dataLength?(s.push(l),s.dataLength>=i&&r(t,n,s.flush(),e)):r(t,n,l,e),o()}).catch(()=>{return Promise.reject()})};return o()}}function Zo(e,t){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(d({},e.headers))};return e.rangeEnd&&n.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),n}function Jo(e){const t=Xo.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}function el(e){const t=e.get("Content-Range");if(t){const e=Jo(t);if(h(e))return e}const n=e.get("Content-Length");if(n)return parseInt(n)}function tl(e,t){return new self.Request(e.url,t)}class nl extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const il=/\s/,rl={newCue(e,t,n,i){const r=[];let s,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<i.rows.length;h++)if(s=i.rows[h],o=!0,l=0,u="",!s.isEmpty()){var d;for(let e=0;e<s.chars.length;e++)il.test(s.chars[e].uchar)&&o?l++:(u+=s.chars[e].uchar,o=!1);s.cueStartTime=t,t===n&&(n+=1e-4),l>=16?l--:l++;const i=la(u.trim()),f=pa(t,n,i);null!=e&&null!=(d=e.cues)&&d.getCueById(f)||(a=new c(t,n,i),a.id=f,a.line=h+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(a))}return e&&r.length&&(r.sort((e,t)=>{return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line}),r.forEach(t=>$t(e,t))),r}},sl={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},al=o(o({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ko,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ui,bufferController:Ds,capLevelController:Ua,errorController:Hn,fpsController:Fa,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Q,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:sl},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},ol()),{},{subtitleStreamController:xs,subtitleTrackController:As,timelineController:Ma,audioStreamController:Ss,audioTrackController:ws,emeController:ja,cmcdController:Ho,contentSteeringController:Go});function ol(){return{cueHandler:rl,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function ll(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=ul(e),i=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(e=>{const i=`${"level"===e?"playlist":e}LoadPolicy`,s=void 0===t[i],a=[];r.forEach(r=>{const o=`${e}Loading${r}`,l=t[o];if(void 0!==l&&s){a.push(o);const e=n[i].default;switch(t[i]={default:e},r){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l;break}}}),a.length&&E.warn(`hls.js config: "${a.join('", "')}" setting(s) are deprecated, use "${i}": ${JSON.stringify(t[i])}`)}),o(o({},n),t)}function ul(e){return e&&"object"===typeof e?Array.isArray(e)?e.map(ul):Object.keys(e).reduce((t,n)=>{return t[n]=ul(e[n]),t},{}):e}function cl(e){const t=e.loader;if(t!==Qo&&t!==Ko)E.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{const t=Yo();t&&(e.loader=Qo,e.progressive=!0,e.enableSoftwareAES=!0,E.log("[config]: Progressive streaming enabled, using FetchLoader"))}}let dl;class hl extends $n{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this),e.on(g.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this),e.off(g.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){const e=this._levels;e.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],r={},s={};let a=!1,o=!1,l=!1;t.levels.forEach(e=>{var t,u;const c=e.attrs;let{audioCodec:d,videoCodec:h}=e;-1!==(null==(t=d)?void 0:t.indexOf("mp4a.40.34"))&&(dl||(dl=/chrome|firefox/i.test(navigator.userAgent)),dl&&(e.audioCodec=d=void 0)),d&&(e.audioCodec=d=_t(d,n)),0===(null==(u=h)?void 0:u.indexOf("avc1"))&&(h=e.videoCodec=St(h));const{width:f,height:p,unknownCodecs:g}=e;if(a||(a=!(!f||!p)),o||(o=!!h),l||(l=!!d),null!=g&&g.length||d&&!ht(d,"audio",n)||h&&!ht(h,"video",n))return;const{CODECS:m,"FRAME-RATE":v,"HDCP-LEVEL":y,"PATHWAY-ID":b,RESOLUTION:_,"VIDEO-RANGE":T}=c,S=`${b||"."}-`,w=`${S}${e.bitrate}-${_}-${v}-${m}-${T}-${y}`;if(r[w])if(r[w].uri===e.url||e.attrs["PATHWAY-ID"])r[w].addGroupId("audio",c.AUDIO),r[w].addGroupId("text",c.SUBTITLES);else{const t=s[w]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const n=new hn(e);r[w]=n,i.push(n)}else{const t=new hn(e);r[w]=t,s[w]=1,i.push(t)}}),this.filterAndSortMediaOptions(i,t,a,o,l)}filterAndSortMediaOptions(e,t,n,i,r){let s=[],a=[],o=e;if((n||i)&&r&&(o=o.filter(({videoCodec:e,videoRange:t,width:n,height:i})=>(!!e||!(!n||!i))&&ln(t))),0===o.length)return void Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const e=new Error("no level with compatible codecs found in manifest");this.hls.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}});if(t.audioTracks){const{preferManagedMediaSource:e}=this.hls.config;s=t.audioTracks.filter(t=>!t.audioCodec||ht(t.audioCodec,"audio",e)),fl(s)}t.subtitles&&(a=t.subtitles,fl(a));const l=o.slice(0);o.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return on.indexOf(e.videoRange)-on.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const n=gt(e.videoCodec),i=gt(t.videoCodec);if(n!==i)return i-n}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const n=mt(e.codecSet),i=mt(t.codecSet);if(n!==i)return i-n}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let u=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let f=0;f<l.length;f++)if(l[f].pathwayId===o[0].pathwayId){u=l[f];break}this._levels=o;for(let f=0;f<o.length;f++)if(o[f]===u){var c;this._firstLevel=f;const e=u.bitrate,t=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${e}`),void 0===(null==(c=this.hls.userConfig)?void 0:c.abrEwmaDefaultEstimate)){const n=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);n>t&&t===al.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=n)}break}const d=r&&!i,h={levels:o,audioTracks:s,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:!d&&s.some(e=>!!e.url)};this.hls.trigger(g.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const n=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.LEVEL_SWITCH_ERROR,level:e,fatal:i,error:n,reason:n.message}),i)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,s=t[e],a=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=s,n===e&&s.details&&i&&r===a)return;this.log(`Switching to level ${e} (${s.height?s.height+"p ":""}${s.videoRange?s.videoRange+" ":""}${s.codecSet?s.codecSet+" ":""}@${s.bitrate})${a?" with Pathway "+a:""} from level ${n}${r?" with Pathway "+r:""}`);const o={level:e,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(g.LEVEL_SWITCHING,o);const l=s.details;if(!l||l.live){const e=this.switchParams(s.uri,null==i?void 0:i.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){!t.fatal&&t.context&&t.context.type===Ut.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===Ft.MAIN){const e=t.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const n=this._levels[t.level];null!=n&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:r}=t,s=this._levels[i];var a;if(!s)return this.warn(`Invalid level index ${i}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(r.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0),this.playlistLoaded(i,t,s.details)):null!=(n=t.deliveryDirectives)&&n.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){let i=n.uri;if(e)try{i=e.addDirectives(i)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}const r=n.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""} with${r?" Pathway "+r:""} ${i}`),this.clearTimer(),this.hls.trigger(g.LEVEL_LOADING,{url:i,level:t,pathwayId:n.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const n=this._levels.filter((t,n)=>{return n!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1)});kn(n),this._levels=n,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(g.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(g.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function fl(e){const t={};e.forEach(e=>{const n=e.groupId||"";e.id=t[n]=t[n]||0,t[n]++})}class pl{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[n].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=v.KEY_LOAD_ERROR,n,i,r){return new Ri({type:m.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:n,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:n,cc:i}=e;for(let e=0;e<t.length;e++){const r=t[e];if(i<=r.cc&&("initSegment"===n||"initSegment"===r.sn||n<r.sn)){this.emeController.selectKeySystemFormat(r).then(e=>{r.setKeyFormat(e)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>{return this.loadInternal(e,t)}):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const n=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,v.KEY_LOAD_ERROR,n))}const s=r.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,v.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${s}"`)));let a=this.keyUriToKeyInfo[s];if(null!=(n=a)&&n.decryptdata.key)return r.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});var o;if(null!=(i=a)&&i.keyLoadPromise)switch(null==(o=a.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(t=>{return r.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:a}})}switch(a=this.keyUriToKeyInfo[s]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,v.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(n);if(t)return(e.keyLoadPromise=t.then(t=>{return e.mediaKeySessionContext=t,n})).catch(t=>{throw e.keyLoadPromise=null,t})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=n.loader,r=new i(n);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((i,s)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=n.keyLoadPolicy.default,u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,t,n,r)=>{const{frag:a,keyInfo:o,url:l}=n;if(!a.decryptdata||o!==this.keyUriToKeyInfo[l])return s(this.createKeyLoadError(a,v.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,i({frag:a,keyInfo:o})},onError:(e,n,i,r)=>{this.resetLoader(n),s(this.createKeyLoadError(t,v.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),i,o({url:a.url,data:void 0},e)))},onTimeout:(e,n,i)=>{this.resetLoader(n),s(this.createKeyLoadError(t,v.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:(e,n,i)=>{this.resetLoader(n),s(this.createKeyLoadError(t,v.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};r.load(a,u,c)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,r=n.loader;t.keyLoader===r&&(t.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[i],r&&r.destroy()}}function gl(){return self.SourceBuffer||self.WebKitSourceBuffer}function ml(){const e=lt();if(!e)return!1;const t=gl();return!t||t.prototype&&"function"===typeof t.prototype.appendBuffer&&"function"===typeof t.prototype.remove}function vl(){if(!ml())return!1;const e=lt();return"function"===typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(pt(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(pt(t,"audio"))))}function yl(){var e;const t=gl();return"function"===typeof(null==t?void 0:null==(e=t.prototype)?void 0:e.changeType)}const bl=250,_l=2,Tl=.1,Sl=.05;class wl{constructor(e,t,n,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=n,this.hls=i}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:n,media:i,stalled:r}=this;if(null===i)return;const{currentTime:s,seeking:a}=i,o=this.seeking&&!a,l=!this.seeking&&a;if(this.seeking=a,s!==e){if(this.moved=!0,a||(this.nudgeRetry=0),null!==r){if(this.stallReported){const e=self.performance.now()-r;E.warn(`playback not stuck anymore @${s}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null}return}if(l||o)return void(this.stalled=null);if(i.paused&&!a||i.ended||0===i.playbackRate||!mi.getBuffered(i).length)return void(this.nudgeRetry=0);const u=mi.bufferInfo(i,s,0),c=u.nextStart||0;if(a){const e=u.len>_l,n=!c||t&&t.start<=s||c-s>_l&&!this.fragmentTracker.getPartialFragment(s);if(e||n)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var d;const e=u.len>0;if(!e&&!c)return;const t=Math.max(c,u.start||0)-s,n=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,r=null==n?void 0:null==(d=n.details)?void 0:d.live,a=r?2*n.details.targetduration:_l,o=this.fragmentTracker.getPartialFragment(s);if(t>0&&(t<=a||o))return void(i.paused||this._trySkipBufferHole(o))}const h=self.performance.now();if(null===r)return void(this.stalled=h);const f=h-r;if(!a&&f>=bl&&(this._reportStall(u),!this.media))return;const p=mi.bufferInfo(i,s,n.maxBufferHole);this._tryFixBufferStall(p,f)}_tryFixBufferStall(e,t){const{config:n,fragmentTracker:i,media:r}=this;if(null===r)return;const s=r.currentTime,a=i.getPartialFragment(s);if(a){const e=this._trySkipBufferHole(a);if(e||!this.media)return}(e.len>n.maxBufferHole||e.nextStart&&e.nextStart-s<n.maxBufferHole)&&t>1e3*n.highBufferWatchdogPeriod&&(E.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:n,stallReported:i}=this;if(!i&&n){this.stallReported=!0;const i=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${JSON.stringify(e)})`);E.warn(i.message),t.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:n,media:i}=this;if(null===i)return 0;const r=i.currentTime,s=mi.bufferInfo(i,r,0),a=r<s.start?s.start:s.nextStart;if(a){const o=s.len<=t.maxBufferHole,l=s.len>0&&s.len<1&&i.readyState<3,u=a-r;if(u>0&&(o||l)){if(u>t.maxBufferHole){const{fragmentTracker:t}=this;let n=!1;if(0===r){const e=t.getAppendedFrag(0,Ft.MAIN);e&&a<e.end&&(n=!0)}if(!n){const n=e||t.getAppendedFrag(r,Ft.MAIN);if(n){let e=!1,i=n.end;while(i<a){const n=t.getPartialFragment(i);if(!n){e=!0;break}i+=n.duration}if(e)return 0}}}const s=Math.max(a+Sl,r+Tl);if(E.warn(`skipping hole, adjusting currentTime from ${r} to ${s}`),this.moved=!0,this.stalled=null,i.currentTime=s,e&&!e.gap){const t=new Error(`fragment loaded with buffer holes, seeking from ${r} to ${s}`);n.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:t,reason:t.message,frag:e})}return s}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:n,nudgeRetry:i}=this;if(null===n)return;const r=n.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){const s=r+(i+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${r} to ${s}`);E.warn(a.message),n.currentTime=s,t.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const n=new Error(`Playhead still not moving while enough data buffered @${r} after ${e.nudgeMaxRetry} nudges`);E.error(n.message),t.trigger(g.ERROR,{type:m.MEDIA_ERROR,details:v.BUFFER_STALLED_ERROR,error:n,fatal:!0})}}}const El=100;class xl extends ji{constructor(e,t,n){super(e,t,n,"[stream-controller]",Ft.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(g.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.MANIFEST_PARSED,this.onManifestParsed,this),e.on(g.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.LEVEL_LOADED,this.onLevelLoaded,this),e.on(g.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(g.ERROR,this.onError,this),e.on(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(g.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(g.BUFFER_CREATED,this.onBufferCreated,this),e.on(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(g.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(g.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(g.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(g.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.MANIFEST_PARSED,this.onManifestParsed,this),e.off(g.LEVEL_LOADED,this.onLevelLoaded,this),e.off(g.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(g.ERROR,this.onError,this),e.off(g.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(g.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(g.BUFFER_CREATED,this.onBufferCreated,this),e.off(g.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(g.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(g.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:n}=this;if(this.stopLoad(),this.setInterval(El),this.level=-1,!this.startFragRequested){let e=n.startLevel;-1===e&&(n.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=n.firstAutoLevel),n.nextLoadLevel=e,this.level=n.loadLevel,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=Bi.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Bi.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Bi.WAITING_LEVEL:{const{levels:e,level:t}=this,n=null==e?void 0:e[t],i=null==n?void 0:n.details;if(i&&(!i.live||this.levelLastLoaded===n)){if(this.waitForCdnTuneIn(i))break;this.state=Bi.IDLE;break}if(this.hls.nextLoadLevel!==this.level){this.state=Bi.IDLE;break}break}case Bi.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),n=this.retryDate;if(!n||t>=n||null!=(e=this.media)&&e.seeking){const{levels:e,level:t}=this,n=null==e?void 0:e[t];this.resetStartWhenNotLoaded(n||null),this.state=Bi.IDLE}}break}this.state===Bi.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(null===t||!i&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const r=e.nextLoadLevel;if(null==n||!n[r])return;const s=n[r],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return this.altAudio&&(e.type="video"),this.hls.trigger(g.BUFFER_EOS,e),void(this.state=Bi.ENDED)}e.loadLevel!==r&&-1===e.manualLevel&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const l=s.details;if(!l||this.state===Bi.WAITING_LEVEL||l.live&&this.levelLastLoaded!==s)return this.level=r,void(this.state=Bi.WAITING_LEVEL);const u=a.len,c=this.getMaxBufferLength(s.maxBitrate);if(u>=c)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(d,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&"initSegment"!==h.sn&&this.fragmentTracker.getState(h)!==di.OK){var f;const e=(null!=(f=this.backtrackFragment)?f:h).sn,t=e-l.startSN,n=l.fragments[t-1];n&&h.cc===n.cc&&(h=n,this.fragmentTracker.removeFragment(n))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,d)){const e=h.gap;if(!e){const e=this.audioOnly&&!this.altAudio?M.AUDIO:M.VIDEO,t=(e===M.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,Ft.MAIN)}h=this.getNextFragmentLoopLoading(h,l,a,Ft.MAIN,c)}h&&(!h.initSegment||h.initSegment.data||this.bitrateTest||(h=h.initSegment),this.loadFragment(h,s,d))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===di.NOT_LOADED||i===di.PARTIAL?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,n)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Ft.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=this.hls.nextLoadLevel,i=e[t],r=this.fragLastKbps;n=r&&this.fragCurrent?this.fragCurrent.duration*i.maxBitrate/(1e3*r)+1:0}else n=0;const s=this.getBufferedFrag(t.currentTime+n);if(s){const e=this.followingBufferedFrag(s);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,n=e.duration,i=Math.max(s.end,t+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Bi.KEY_LOADING:case Bi.FRAG_LOADING:case Bi.FRAG_LOADING_WAITING_RETRY:case Bi.PARSING:case Bi.PARSED:this.state=Bi.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new wl(this.config,n,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;h(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const n=this.getMainFwdBufferInfo();null!==n&&0!==n.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${n?n.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(g.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let n=!1,i=!1;t.levels.forEach(e=>{const t=e.audioCodec;t&&(n=n||-1!==t.indexOf("mp4a.40.2"),i=i||-1!==t.indexOf("mp4a.40.5"))}),this.audioCodecSwitch=n&&i&&!yl(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==Bi.IDLE)return;const i=n[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(i.details))&&(this.state=Bi.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:i}=this,r=t.level,s=t.details,a=s.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${r}`);this.log(`Level ${r} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""}, cc [${s.startCC}, ${s.endCC}] duration:${a}`);const o=i[r],l=this.fragCurrent;!l||this.state!==Bi.FRAG_LOADING&&this.state!==Bi.FRAG_LOADING_WAITING_RETRY||l.level!==t.level&&l.loader&&this.abortCurrentFrag();let u=0;if(s.live||null!=(n=o.details)&&n.live){var c;if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;u=this.alignPlaylists(s,o.details,null==(c=this.levelLastLoaded)?void 0:c.details)}if(o.details=s,this.levelLastLoaded=o,this.hls.trigger(g.LEVEL_UPDATED,{details:s,level:r}),this.state===Bi.WAITING_LEVEL){if(this.waitForCdnTuneIn(s))return;this.state=Bi.IDLE}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,u),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:n,part:i,payload:r}=e,{levels:s}=this;if(!s)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);const a=s[n.level],o=a.details;if(!o)return this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),void this.fragmentTracker.removeFragment(n);const l=a.videoCodec,u=o.PTSKnown||!o.live,c=null==(t=n.initSegment)?void 0:t.data,d=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new vs(this.hls,Ft.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,p=-1!==f,g=new vi(n.level,n.sn,n.stats.chunkCount,r.byteLength,f,p),m=this.initPTS[n.cc];h.push(r,c,d,l,n,i,o.totalduration,u,g,m)}onAudioTrackSwitching(e,t){const n=this.altAudio,i=!!t.url;if(!i){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const e=this.hls;n&&(e.trigger(g.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),e.trigger(g.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=t.id,i=!!this.hls.audioTracks[n].url;if(i){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=i,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,r,s=!1;for(const a in n){const e=n[a];if("main"===e.id){if(r=a,i=e,"video"===a){const e=n[a];e&&(this.videoBuffer=e.buffer)}}else s=!0}s&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n&&n.type!==Ft.MAIN)return;if(this.fragContextChanged(n))return this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===Bi.PARSED&&(this.state=Bi.IDLE));const r=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}onError(e,t){var n;if(t.fatal)this.state=Bi.ERROR;else switch(t.details){case v.FRAG_GAP:case v.FRAG_PARSING_ERROR:case v.FRAG_DECRYPT_ERROR:case v.FRAG_LOAD_ERROR:case v.FRAG_LOAD_TIMEOUT:case v.KEY_LOAD_ERROR:case v.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ft.MAIN,t);break;case v.LEVEL_LOAD_ERROR:case v.LEVEL_LOAD_TIMEOUT:case v.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Bi.WAITING_LEVEL||(null==(n=t.context)?void 0:n.type)!==Ut.LEVEL||(this.state=Bi.IDLE);break;case v.BUFFER_APPEND_ERROR:case v.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;if(t.details===v.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case v.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!mi.getBuffered(e).length){const e=this.state!==Bi.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=Bi.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==M.AUDIO||this.audioOnly&&!this.altAudio){const e=(t===M.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,Ft.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking)return void this.log(`could not seek to ${n}, already seeking at ${t}`);const i=mi.getBuffered(e),r=i.length?i.start(0):0,s=r-n;s>0&&(s<this.config.maxBufferHole||s<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${s} to match buffer start`),n+=s,this.startPosition=n),this.log(`seek to target start position ${n} from current time ${t}`),e.currentTime=n}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:i}=this;if(!n||this.fragContextChanged(e))return;t.fragmentError=0,this.state=Bi.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const r=e.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),i.trigger(g.FRAG_LOADED,n),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const n="main",{hls:i}=this,{remuxResult:r,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:l,level:u}=a,{video:c,text:d,id3:f,initSegment:p}=r,{details:m}=u,v=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Bi.PARSING,p){if(null!=p&&p.tracks){const e=o.initSegment||o;this._bufferInitSegment(u,p.tracks,e,s),i.trigger(g.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:n,tracks:p.tracks})}const e=p.initPTS,t=p.timescale;h(e)&&(this.initPTS[o.cc]={baseTime:e,timescale:t},i.trigger(g.INIT_PTS_FOUND,{frag:o,id:n,initPTS:e,timescale:t}))}if(c&&m&&"initSegment"!==o.sn){const e=m.fragments[o.sn-1-m.startSN],t=o.sn===m.startSN,n=!e||o.cc>e.cc;if(!1!==r.independent){const{startPTS:e,endPTS:i,startDTS:r,endDTS:a}=c;if(l)l.elementaryStreams[c.type]={startPTS:e,endPTS:i,startDTS:r,endDTS:a};else if(c.firstKeyFrame&&c.independent&&1===s.id&&!n&&(this.couldBacktrack=!0),c.dropped&&c.independent){const r=this.getMainFwdBufferInfo(),s=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,l=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&s<l-this.config.maxBufferHole&&!n)return void this.backtrack(o);n&&(o.gap=!0),o.setElementaryStreamInfo(c.type,o.start,i,o.start,a,!0)}else t&&e>_l&&(o.gap=!0);o.setElementaryStreamInfo(c.type,e,i,r,a),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,s,t||n)}else{if(!t&&!n)return void this.backtrack(o);o.gap=!0}}if(v){const{startPTS:e,endPTS:t,startDTS:n,endDTS:i}=v;l&&(l.elementaryStreams[M.AUDIO]={startPTS:e,endPTS:t,startDTS:n,endDTS:i}),o.setElementaryStreamInfo(M.AUDIO,e,t,n,i),this.bufferFragmentData(v,o,l,s)}if(m&&null!=f&&null!=(t=f.samples)&&t.length){const e={id:n,frag:o,details:m,samples:f.samples};i.trigger(g.FRAG_PARSING_METADATA,e)}if(m&&d){const e={id:n,frag:o,details:m,samples:d.samples};i.trigger(g.FRAG_PARSING_USERDATA,e)}}}_bufferInitSegment(e,t,n,i){if(this.state!==Bi.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:r,video:s,audiovideo:a}=t;if(r){let t=e.audioCodec;const n=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=r.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===n.indexOf("firefox")&&(t="mp4a.40.5")}t&&-1!==t.indexOf("mp4a.40.5")&&-1!==n.indexOf("android")&&"audio/mpeg"!==r.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),r.levelCodec=t,r.id="main",this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${r.codec}]`)}s&&(s.levelCodec=e.videoCodec,s.id="main",this.log(`Init video buffer, container:${s.container}, codecs[level/parsed]=[${e.videoCodec||""}/${s.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),this.hls.trigger(g.BUFFER_CODECS,t),Object.keys(t).forEach(e=>{const r=t[e],s=r.initSegment;null!=s&&s.byteLength&&this.hls.trigger(g.BUFFER_APPENDING,{type:e,data:s,frag:n,part:null,chunkMeta:i,parent:n.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Ft.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Bi.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const n=e.currentTime;if(mi.isBuffered(e,n)?t=this.getAppendedFrag(n):mi.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,n=t.level;e&&t.sn===e.sn&&e.level===n||(this.fragPlaying=t,this.hls.trigger(g.FRAG_CHANGED,{frag:t}),e&&e.level===n||this.hls.trigger(g.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,n=this.currentFrag;if(n&&h(t)&&h(n.programDateTime)){const e=n.programDateTime+1e3*(t-n.start);return new Date(e)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class kl{static get version(){return"1.5.14"}static isMSESupported(){return ml()}static isSupported(){return vl()}static getMediaSource(){return lt()}static get Events(){return g}static get ErrorTypes(){return m}static get ErrorDetails(){return v}static get DefaultConfig(){return kl.defaultConfig?kl.defaultConfig:al}static set DefaultConfig(e){kl.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new ms,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,w(e.debug||!1,"Hls instance");const t=this.config=ll(kl.DefaultConfig,e);this.userConfig=e,t.progressive&&cl(t);const{abrController:n,bufferController:i,capLevelController:r,errorController:s,fpsController:a}=t,o=new s(this),l=this.abrController=new n(this),u=this.bufferController=new i(this),c=this.capLevelController=new r(this),d=new a(this),h=new Vt(this),f=new nn(this),p=t.contentSteeringController,m=p?new p(this):null,v=this.levelController=new hl(this,m),y=new hi(this),b=new pl(this.config),_=this.streamController=new xl(this,y,b);c.setStreamController(_),d.setStreamController(_);const T=[h,v,_];m&&T.splice(1,0,m),this.networkControllers=T;const S=[l,u,c,d,f,y];this.audioTrackController=this.createController(t.audioTrackController,T);const E=t.audioStreamController;E&&T.push(new E(this,y,b)),this.subtitleTrackController=this.createController(t.subtitleTrackController,T);const x=t.subtitleStreamController;x&&T.push(new x(this,y,b)),this.createController(t.timelineController,S),b.emeController=this.emeController=this.createController(t.emeController,S),this.cmcdController=this.createController(t.cmcdController,S),this.latencyController=this.createController(rn,S),this.coreComponents=S,T.push(o);const k=o.onErrorOut;"function"===typeof k&&this.on(g.ERROR,k,o)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,i){this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(E.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;const n=e===g.ERROR;this.trigger(g.ERROR,{type:m.OTHER_ERROR,details:v.INTERNAL_EXCEPTION,fatal:n,event:e,error:t}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){E.log("destroy"),this.trigger(g.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){E.log("attachMedia"),this._media=e,this.trigger(g.MEDIA_ATTACHING,{media:e})}detachMedia(){E.log("detachMedia"),this.trigger(g.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,n=this.url,i=this.url=s.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,E.log(`loadSource:${i}`),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(g.MANIFEST_LOADING,{url:e})}startLoad(e=-1){E.log(`startLoad(${e})`),this.started=!0,this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){E.log("stopLoad"),this.started=!1,this.networkControllers.forEach(e=>{e.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.stopLoad()})}swapAudioCodec(){E.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){E.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){E.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){E.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){E.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){E.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){E.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(E.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){an(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(i=-1===t&&null!=e&&e.length?e.length-1:t,n)for(let r=i;r--;){const t=e[r].attrs["HDCP-LEVEL"];if(t&&t<=n)return r}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return null==(t=this.audioTrackController)?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return null==(t=this.subtitleTrackController)||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}kl.defaultConfig=void 0},a5b8:function(e,t,n){"use strict";var i=n("d8e8");function r(e){var t,n;this.promise=new e(function(e,i){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=i}),this.resolve=i(t),this.reject=i(n)}e.exports.f=function(e){return new r(e)}},a73c:function(e,t,n){var i=n("6d8b"),r=i.retrieve2,s=i.retrieve3,a=i.each,o=i.normalizeCssArray,l=i.isString,u=i.isObject,c=n("e86a"),d=n("5693"),h=n("5e76"),f=n("7d6d"),p={left:1,right:1,center:1},g={top:1,bottom:1,middle:1};function m(e){return v(e),a(e.rich,v),e}function v(e){if(e){e.font=c.makeFont(e);var t=e.textAlign;"middle"===t&&(t="center"),e.textAlign=null==t||p[t]?t:"left";var n=e.textVerticalAlign||e.textBaseline;"center"===n&&(n="middle"),e.textVerticalAlign=null==n||g[n]?n:"top";var i=e.textPadding;i&&(e.textPadding=o(e.textPadding))}}function y(e,t,n,i,r){i.rich?_(e,t,n,i,r):b(e,t,n,i,r)}function b(e,t,n,i,r){var s=I(t,"font",i.font||c.DEFAULT_FONT),a=i.textPadding,o=e.__textCotentBlock;o&&!e.__dirty||(o=e.__textCotentBlock=c.parsePlainText(n,s,a,i.truncate));var l=o.outerHeight,u=o.lines,d=o.lineHeight,h=A(l,i,r),f=h.baseX,p=h.baseY,g=h.textAlign,m=h.textVerticalAlign;S(t,i,r,f,p);var v=c.adjustTextY(p,l,m),y=f,b=v,_=E(i);if(_||a){var T=c.getWidth(n,s),w=T;a&&(w+=a[1]+a[3]);var k=c.adjustTextX(f,w,g);_&&x(e,t,i,k,v,w,l),a&&(y=M(f,g,a),b+=a[0])}I(t,"textAlign",g||"left"),I(t,"textBaseline","middle"),I(t,"shadowBlur",i.textShadowBlur||0),I(t,"shadowColor",i.textShadowColor||"transparent"),I(t,"shadowOffsetX",i.textShadowOffsetX||0),I(t,"shadowOffsetY",i.textShadowOffsetY||0),b+=d/2;var R=i.textStrokeWidth,L=C(i.textStroke,R),P=D(i.textFill);L&&(I(t,"lineWidth",R),I(t,"strokeStyle",L)),P&&I(t,"fillStyle",P);for(var O=0;O<u.length;O++)L&&t.strokeText(u[O],y,b),P&&t.fillText(u[O],y,b),b+=d}function _(e,t,n,i,r){var s=e.__textCotentBlock;s&&!e.__dirty||(s=e.__textCotentBlock=c.parseRichText(n,i)),T(e,t,s,i,r)}function T(e,t,n,i,r){var s=n.width,a=n.outerWidth,o=n.outerHeight,l=i.textPadding,u=A(o,i,r),d=u.baseX,h=u.baseY,f=u.textAlign,p=u.textVerticalAlign;S(t,i,r,d,h);var g=c.adjustTextX(d,a,f),m=c.adjustTextY(h,o,p),v=g,y=m;l&&(v+=l[3],y+=l[0]);var b=v+s;E(i)&&x(e,t,i,g,m,a,o);for(var _=0;_<n.lines.length;_++){var T,k=n.lines[_],I=k.tokens,C=I.length,D=k.lineHeight,R=k.width,M=0,L=v,P=b,O=C-1;while(M<C&&(T=I[M],!T.textAlign||"left"===T.textAlign))w(e,t,T,i,D,y,L,"left"),R-=T.width,L+=T.width,M++;while(O>=0&&(T=I[O],"right"===T.textAlign))w(e,t,T,i,D,y,P,"right"),R-=T.width,P-=T.width,O--;L+=(s-(L-v)-(b-P)-R)/2;while(M<=O)T=I[M],w(e,t,T,i,D,y,L+T.width/2,"center"),L+=T.width,M++;y+=D}}function S(e,t,n,i,r){if(n&&t.textRotation){var s=t.textOrigin;"center"===s?(i=n.width/2+n.x,r=n.height/2+n.y):s&&(i=s[0]+n.x,r=s[1]+n.y),e.translate(i,r),e.rotate(-t.textRotation),e.translate(-i,-r)}}function w(e,t,n,i,a,o,l,u){var d=i.rich[n.styleName]||{},h=n.textVerticalAlign,f=o+a/2;"top"===h?f=o+n.height/2:"bottom"===h&&(f=o+a-n.height/2),!n.isLineHolder&&E(d)&&x(e,t,d,"right"===u?l-n.width:"center"===u?l-n.width/2:l,f-n.height/2,n.width,n.height);var p=n.textPadding;p&&(l=M(l,u,p),f-=n.height/2-p[2]-n.textHeight/2),I(t,"shadowBlur",s(d.textShadowBlur,i.textShadowBlur,0)),I(t,"shadowColor",d.textShadowColor||i.textShadowColor||"transparent"),I(t,"shadowOffsetX",s(d.textShadowOffsetX,i.textShadowOffsetX,0)),I(t,"shadowOffsetY",s(d.textShadowOffsetY,i.textShadowOffsetY,0)),I(t,"textAlign",u),I(t,"textBaseline","middle"),I(t,"font",n.font||c.DEFAULT_FONT);var g=C(d.textStroke||i.textStroke,v),m=D(d.textFill||i.textFill),v=r(d.textStrokeWidth,i.textStrokeWidth);g&&(I(t,"lineWidth",v),I(t,"strokeStyle",g),t.strokeText(n.text,l,f)),m&&(I(t,"fillStyle",m),t.fillText(n.text,l,f))}function E(e){return e.textBackgroundColor||e.textBorderWidth&&e.textBorderColor}function x(e,t,n,i,r,s,a){var o=n.textBackgroundColor,c=n.textBorderWidth,f=n.textBorderColor,p=l(o);if(I(t,"shadowBlur",n.textBoxShadowBlur||0),I(t,"shadowColor",n.textBoxShadowColor||"transparent"),I(t,"shadowOffsetX",n.textBoxShadowOffsetX||0),I(t,"shadowOffsetY",n.textBoxShadowOffsetY||0),p||c&&f){t.beginPath();var g=n.textBorderRadius;g?d.buildPath(t,{x:i,y:r,width:s,height:a,r:g}):t.rect(i,r,s,a),t.closePath()}if(p)I(t,"fillStyle",o),t.fill();else if(u(o)){var m=o.image;m=h.createOrUpdateImage(m,null,e,k,o),m&&h.isImageReady(m)&&t.drawImage(m,i,r,s,a)}c&&f&&(I(t,"lineWidth",c),I(t,"strokeStyle",f),t.stroke())}function k(e,t){t.image=e}function A(e,t,n){var i=t.x||0,r=t.y||0,s=t.textAlign,a=t.textVerticalAlign;if(n){var o=t.textPosition;if(o instanceof Array)i=n.x+R(o[0],n.width),r=n.y+R(o[1],n.height);else{var l=c.adjustTextPositionOnRect(o,n,t.textDistance);i=l.x,r=l.y,s=s||l.textAlign,a=a||l.textVerticalAlign}var u=t.textOffset;u&&(i+=u[0],r+=u[1])}return{baseX:i,baseY:r,textAlign:s,textVerticalAlign:a}}function I(e,t,n){return e[t]=f(e,t,n),e[t]}function C(e,t){return null==e||t<=0||"transparent"===e||"none"===e?null:e.image||e.colorStops?"#000":e}function D(e){return null==e||"none"===e?null:e.image||e.colorStops?"#000":e}function R(e,t){return"string"===typeof e?e.lastIndexOf("%")>=0?parseFloat(e)/100*t:parseFloat(e):e}function M(e,t,n){return"right"===t?e-n[1]:"center"===t?e+n[3]/2-n[1]/2:e+n[3]}function L(e,t){return null!=e&&(e||t.textBackgroundColor||t.textBorderWidth&&t.textBorderColor||t.textPadding)}t.normalizeTextStyle=m,t.renderText=y,t.getStroke=C,t.getFill=D,t.needDrawText=L},a968:function(e,t){var n=Math.pow(2,32),i=function(e){var t,i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.getBigUint64?(t=i.getBigUint64(0),t<Number.MAX_SAFE_INTEGER?Number(t):t):i.getUint32(0)*n+i.getUint32(4)};e.exports={getUint64:i,MAX_UINT32:n}},a96b:function(e,t,n){var i=n("3eba"),r=i.extendComponentModel({type:"tooltip",dependencies:["axisPointer"],defaultOption:{zlevel:0,z:8,show:!0,showContent:!0,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:!1,displayMode:"single",confine:!1,showDelay:0,hideDelay:100,transitionDuration:.4,enterable:!1,backgroundColor:"rgba(50,50,50,0.7)",borderColor:"#333",borderRadius:4,borderWidth:0,padding:5,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:"#999",width:1,type:"dashed",textStyle:{}}},textStyle:{color:"#fff",fontSize:14}}});e.exports=r},aa77:function(e,t,n){var i=n("5ca1"),r=n("be13"),s=n("79e5"),a=n("fdef"),o="["+a+"]",l="",u=RegExp("^"+o+o+"*"),c=RegExp(o+o+"*$"),d=function(e,t,n){var r={},o=s(function(){return!!a[e]()||l[e]()!=l}),u=r[e]=o?t(h):a[e];n&&(r[n]=u),i(i.P+i.F*o,"String",r)},h=d.trim=function(e,t){return e=String(r(e)),1&t&&(e=e.replace(u,"")),2&t&&(e=e.replace(c,"")),e};e.exports=d},aae3:function(e,t,n){var i=n("d3f4"),r=n("2d95"),s=n("2b4c")("match");e.exports=function(e){var t;return i(e)&&(void 0!==(t=e[s])?!!t:"RegExp"==r(e))}},ac0f:function(e,t,n){var i=n("cbe5"),r=n("401b"),s=n("4a3f"),a=s.quadraticSubdivide,o=s.cubicSubdivide,l=s.quadraticAt,u=s.cubicAt,c=s.quadraticDerivativeAt,d=s.cubicDerivativeAt,h=[];function f(e,t,n){var i=e.cpx2,r=e.cpy2;return null===i||null===r?[(n?d:u)(e.x1,e.cpx1,e.cpx2,e.x2,t),(n?d:u)(e.y1,e.cpy1,e.cpy2,e.y2,t)]:[(n?c:l)(e.x1,e.cpx1,e.x2,t),(n?c:l)(e.y1,e.cpy1,e.y2,t)]}var p=i.extend({type:"bezier-curve",shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(e,t){var n=t.x1,i=t.y1,r=t.x2,s=t.y2,l=t.cpx1,u=t.cpy1,c=t.cpx2,d=t.cpy2,f=t.percent;0!==f&&(e.moveTo(n,i),null==c||null==d?(f<1&&(a(n,l,r,f,h),l=h[1],r=h[2],a(i,u,s,f,h),u=h[1],s=h[2]),e.quadraticCurveTo(l,u,r,s)):(f<1&&(o(n,l,c,r,f,h),l=h[1],c=h[2],r=h[3],o(i,u,d,s,f,h),u=h[1],d=h[2],s=h[3]),e.bezierCurveTo(l,u,c,d,r,s)))},pointAt:function(e){return f(this.shape,e,!1)},tangentAt:function(e){var t=f(this.shape,e,!0);return r.normalize(t,t)}});e.exports=p},ac6a:function(e,t,n){for(var i=n("cadf"),r=n("0d58"),s=n("2aba"),a=n("7726"),o=n("32e9"),l=n("84f2"),u=n("2b4c"),c=u("iterator"),d=u("toStringTag"),h=l.Array,f={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=r(f),g=0;g<p.length;g++){var m,v=p[g],y=f[v],b=a[v],_=b&&b.prototype;if(_&&(_[c]||o(_,c,h),_[d]||o(_,d,v),l[v]=h,y))for(m in i)_[m]||s(_,m,i[m],!0)}},aef6:function(e,t,n){"use strict";var i=n("5ca1"),r=n("9def"),s=n("d2c8"),a="endsWith",o=""[a];i(i.P+i.F*n("5147")(a),"String",{endsWith:function(e){var t=s(this,e,a),n=arguments.length>1?arguments[1]:void 0,i=r(t.length),l=void 0===n?i:Math.min(r(n),i),u=String(e);return o?o.call(t,u,l):t.slice(l-u.length,l)===u}})},af24:function(e,t,n){n("48c7"),n("f273")},afa0:function(e,t,n){var i=n("6d8b"),r=n("22d1"),s=n("e1fc"),a=n("04f6");function o(e,t){return e.zlevel===t.zlevel?e.z===t.z?e.z2-t.z2:e.z-t.z:e.zlevel-t.zlevel}var l=function(){this._roots=[],this._displayList=[],this._displayListLen=0};l.prototype={constructor:l,traverse:function(e,t){for(var n=0;n<this._roots.length;n++)this._roots[n].traverse(e,t)},getDisplayList:function(e,t){return t=t||!1,e&&this.updateDisplayList(t),this._displayList},updateDisplayList:function(e){this._displayListLen=0;for(var t=this._roots,n=this._displayList,i=0,s=t.length;i<s;i++)this._updateAndAddDisplayable(t[i],null,e);n.length=this._displayListLen,r.canvasSupported&&a(n,o)},_updateAndAddDisplayable:function(e,t,n){if(!e.ignore||n){e.beforeUpdate(),e.__dirty&&e.update(),e.afterUpdate();var i=e.clipPath;if(i){t=t?t.slice():[];var r=i,s=e;while(r)r.parent=s,r.updateTransform(),t.push(r),s=r,r=r.clipPath}if(e.isGroup){for(var a=e._children,o=0;o<a.length;o++){var l=a[o];e.__dirty&&(l.__dirty=!0),this._updateAndAddDisplayable(l,t,n)}e.__dirty=!1}else e.__clipPaths=t,this._displayList[this._displayListLen++]=e}},addRoot:function(e){e.__storage!==this&&(e instanceof s&&e.addChildrenToStorage(this),this.addToStorage(e),this._roots.push(e))},delRoot:function(e){if(null==e){for(var t=0;t<this._roots.length;t++){var n=this._roots[t];n instanceof s&&n.delChildrenFromStorage(this)}return this._roots=[],this._displayList=[],void(this._displayListLen=0)}if(e instanceof Array){t=0;for(var r=e.length;t<r;t++)this.delRoot(e[t])}else{var a=i.indexOf(this._roots,e);a>=0&&(this.delFromStorage(e),this._roots.splice(a,1),e instanceof s&&e.delChildrenFromStorage(this))}},addToStorage:function(e){return e&&(e.__storage=this,e.dirty(!1)),this},delFromStorage:function(e){return e&&(e.__storage=null),this},dispose:function(){this._renderList=this._roots=null},displayableSortFunc:o};var u=l;e.exports=u},b03c:function(e,t){var n="auto",i={"":1,lr:1,rl:1},r={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function s(e){if("string"!==typeof e)return!1;var t=i[e.toLowerCase()];return!!t&&e.toLowerCase()}function a(e){if("string"!==typeof e)return!1;var t=r[e.toLowerCase()];return!!t&&e.toLowerCase()}function o(e,t,i){this.hasBeenReset=!1;var r="",o=!1,l=e,u=t,c=i,d=null,h="",f=!0,p="auto",g="start",m="auto",v="auto",y=100,b="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return r},set:function(e){r=""+e}},pauseOnExit:{enumerable:!0,get:function(){return o},set:function(e){o=!!e}},startTime:{enumerable:!0,get:function(){return l},set:function(e){if("number"!==typeof e)throw new TypeError("Start time must be set to a number.");l=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return u},set:function(e){if("number"!==typeof e)throw new TypeError("End time must be set to a number.");u=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return c},set:function(e){c=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return d},set:function(e){d=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return h},set:function(e){var t=s(e);if(!1===t)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");h=t,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return f},set:function(e){f=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return p},set:function(e){if("number"!==typeof e&&e!==n)throw new SyntaxError("Line: an invalid number or illegal string was specified.");p=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return g},set:function(e){var t=a(e);t?(g=t,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return m},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");m=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return v},set:function(e){var t=a(e);t?(v=t,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");y=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return b},set:function(e){var t=a(e);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");b=t,this.hasBeenReset=!0}}}),this.displayState=void 0}o.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},e.exports=o},b074:function(e,t,n){var i=n("89a7"),r=n("e1c8"),s=n("b30f"),a=n("e003"),o=r.DOMImplementation,l=i.NAMESPACE,u=a.ParseError,c=a.XMLReader;function d(e){return e.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function h(e){this.options=e||{locator:{}}}function f(e,t,n){if(!e){if(t instanceof p)return t;e=t}var i={},r=e instanceof Function;function s(t){var s=e[t];!s&&r&&(s=2==e.length?function(n){e(t,n)}:e),i[t]=s&&function(e){s("[xmldom "+t+"]\t"+e+m(n))}||function(){}}return n=n||{},s("warning"),s("error"),s("fatalError"),i}function p(){this.cdata=!1}function g(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function m(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function v(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function y(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}h.prototype.parseFromString=function(e,t){var n=this.options,i=new c,r=n.domBuilder||new p,a=n.errorHandler,o=n.locator,u=n.xmlns||{},h=/\/x?html?$/.test(t),g=h?s.HTML_ENTITIES:s.XML_ENTITIES;o&&r.setDocumentLocator(o),i.errorHandler=f(a,r,o),i.domBuilder=n.domBuilder||r,h&&(u[""]=l.HTML),u.xml=u.xml||l.XML;var m=n.normalizeLineEndings||d;return e&&"string"===typeof e?i.parse(m(e),u,g):i.errorHandler.error("invalid doc source"),r.doc},p.prototype={startDocument:function(){this.doc=(new o).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,i){var r=this.doc,s=r.createElementNS(e,n||t),a=i.length;y(this,s),this.currentElement=s,this.locator&&g(this.locator,s);for(var o=0;o<a;o++){e=i.getURI(o);var l=i.getValue(o),u=(n=i.getQName(o),r.createAttributeNS(e,n));this.locator&&g(i.getLocator(o),u),u.value=u.nodeValue=l,s.setAttributeNode(u)}},endElement:function(e,t,n){var i=this.currentElement;i.tagName;this.currentElement=i.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&g(this.locator,n),y(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=v.apply(this,arguments),e){if(this.cdata)var i=this.doc.createCDATASection(e);else i=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(i):/^\s*$/.test(e)&&this.doc.appendChild(i),this.locator&&g(this.locator,i)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=v.apply(this,arguments);var i=this.doc.createComment(e);this.locator&&g(this.locator,i),y(this,i)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var i=this.doc.implementation;if(i&&i.createDocumentType){var r=i.createDocumentType(e,t,n);this.locator&&g(this.locator,r),y(this,r),this.doc.doctype=r}},warning:function(e){console.warn("[xmldom warning]\t"+e,m(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,m(this.locator))},fatalError:function(e){throw new u(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){p.prototype[e]=function(){return null}}),t.__DOMHandler=p,t.normalizeLineEndings=d,t.DOMParser=h},b11c:function(e,t,n){n("8ec5"),n("db9e"),n("4e9f"),n("d3a0"),n("767c"),n("7c4d"),n("df70")},b12f:function(e,t,n){var i=n("e1fc"),r=n("8918"),s=n("625e"),a=function(){this.group=new i,this.uid=r.getUID("viewComponent")};a.prototype={constructor:a,init:function(e,t){},render:function(e,t,n,i){},dispose:function(){}};var o=a.prototype;o.updateView=o.updateLayout=o.updateVisual=function(e,t,n,i){},s.enableClassExtend(a),s.enableClassManagement(a,{registerWhenExtend:!0});var l=a;e.exports=l},b1d4:function(e,t,n){var i=n("862d");function r(e,t){return t=t||{},i(t.coordDimensions||[],e,{dimsDef:t.dimensionsDefine||e.dimensionsDefine,encodeDef:t.encodeDefine||e.encodeDefine,dimCount:t.dimensionsCount,generateCoord:t.generateCoord,generateCoordCount:t.generateCoordCount})}e.exports=r},b30f:function(e,t,n){"use strict";var i=n("89a7").freeze;t.XML_ENTITIES=i({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),t.HTML_ENTITIES=i({Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",AMP:"&",amp:"&",And:"",and:"",andand:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsd:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",ap:"",apacir:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",Barwed:"",barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",Because:"",because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxDL:"",boxDl:"",boxdL:"",boxdl:"",boxDR:"",boxDr:"",boxdR:"",boxdr:"",boxH:"",boxh:"",boxHD:"",boxHd:"",boxhD:"",boxhd:"",boxHU:"",boxHu:"",boxhU:"",boxhu:"",boxminus:"",boxplus:"",boxtimes:"",boxUL:"",boxUl:"",boxuL:"",boxul:"",boxUR:"",boxUr:"",boxuR:"",boxur:"",boxV:"",boxv:"",boxVH:"",boxVh:"",boxvH:"",boxvh:"",boxVL:"",boxVl:"",boxvL:"",boxvl:"",boxVR:"",boxVr:"",boxvR:"",boxvr:"",bprime:"",Breve:"",breve:"",brvbar:"",Bscr:"",bscr:"",bsemi:"",bsim:"",bsime:"",bsol:"\\",bsolb:"",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",Cap:"",cap:"",capand:"",capbrcup:"",capcap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",CenterDot:"",centerdot:"",Cfr:"",cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",cir:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",Colon:"",colon:":",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",Conint:"",conint:"",ContourIntegral:"",Copf:"",copf:"",coprod:"",Coproduct:"",COPY:"",copy:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",Cross:"",cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",Cup:"",cup:"",cupbrcap:"",CupCap:"",cupcap:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",Dagger:"",dagger:"",daleth:"",Darr:"",dArr:"",darr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",DD:"",dd:"",ddagger:"",ddarr:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",Diamond:"",diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrow:"",Downarrow:"",downarrow:"",DownArrowBar:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVector:"",DownLeftVectorBar:"",DownRightTeeVector:"",DownRightVector:"",DownRightVectorBar:"",DownTee:"",DownTeeArrow:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",ecir:"",Ecirc:"",ecirc:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",eDot:"",edot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp:"",emsp13:"",emsp14:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",Escr:"",escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",ExponentialE:"",exponentiale:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",ForAll:"",forall:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",Fscr:"",fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",gE:"",ge:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",ges:"",gescc:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",Gg:"",gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gl:"",gla:"",glE:"",glj:"",gnap:"",gnapprox:"",gnE:"",gne:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",Gt:"",GT:">",gt:">",gtcc:"",gtcir:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",hArr:"",harr:"",harrcir:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",Hfr:"",hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",Hopf:"",hopf:"",horbar:"",HorizontalLine:"",Hscr:"",hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",Ifr:"",ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Im:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",imof:"",imped:"",Implies:"",in:"",incare:"",infin:"",infintie:"",inodot:"",Int:"",int:"",intcal:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",Iscr:"",iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",Lang:"",lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",Larr:"",lArr:"",larr:"",larrb:"",larrbfs:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",lat:"",lAtail:"",latail:"",late:"",lates:"",lBarr:"",lbarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",lE:"",le:"",LeftAngleBracket:"",LeftArrow:"",Leftarrow:"",leftarrow:"",LeftArrowBar:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVector:"",LeftDownVectorBar:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTee:"",LeftTeeArrow:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangle:"",LeftTriangleBar:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVector:"",LeftUpVectorBar:"",LeftVector:"",LeftVectorBar:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",les:"",lescc:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",Ll:"",ll:"",llarr:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoust:"",lmoustache:"",lnap:"",lnapprox:"",lnE:"",lne:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",LongLeftArrow:"",Longleftarrow:"",longleftarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longleftrightarrow:"",longmapsto:"",LongRightArrow:"",Longrightarrow:"",longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",Lscr:"",lscr:"",Lsh:"",lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",Lt:"",LT:"<",lt:"<",ltcc:"",ltcir:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",mid:"",midast:"*",midcir:"",middot:"",minus:"",minusb:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",Mscr:"",mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natur:"",natural:"",naturals:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",ne:"",nearhk:"",neArr:"",nearr:"",nearrow:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nhArr:"",nharr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlArr:"",nlarr:"",nldr:"",nlE:"",nle:"",nLeftarrow:"",nleftarrow:"",nLeftrightarrow:"",nleftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",Nopf:"",nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangle:"",NotLeftTriangleBar:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangle:"",NotRightTriangleBar:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",npar:"",nparallel:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",npre:"",nprec:"",npreceq:"",nrArr:"",nrarr:"",nrarrc:"",nrarrw:"",nRightarrow:"",nrightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nVDash:"",nVdash:"",nvDash:"",nvdash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwArr:"",nwarr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",ocir:"",Ocirc:"",ocirc:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",Or:"",or:"",orarr:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",Otimes:"",otimes:"",otimesas:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",par:"",para:"",parallel:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plus:"+",plusacir:"",plusb:"",pluscir:"",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",Popf:"",popf:"",pound:"",Pr:"",pr:"",prap:"",prcue:"",prE:"",pre:"",prec:"",precapprox:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",precsim:"",Prime:"",prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportion:"",Proportional:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",Qopf:"",qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",QUOT:'"',quot:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",Rang:"",rang:"",rangd:"",range:"",rangle:"",raquo:"",Rarr:"",rArr:"",rarr:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",rAtail:"",ratail:"",ratio:"",rationals:"",RBarr:"",rBarr:"",rbarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",Re:"",real:"",realine:"",realpart:"",reals:"",rect:"",REG:"",reg:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",Rfr:"",rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrow:"",Rightarrow:"",rightarrow:"",RightArrowBar:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVector:"",RightDownVectorBar:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTee:"",RightTeeArrow:"",RightTeeVector:"",rightthreetimes:"",RightTriangle:"",RightTriangleBar:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVector:"",RightUpVectorBar:"",RightVector:"",RightVectorBar:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoust:"",rmoustache:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",Ropf:"",ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",Rscr:"",rscr:"",Rsh:"",rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",Sc:"",sc:"",scap:"",Scaron:"",scaron:"",sccue:"",scE:"",sce:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdot:"",sdotb:"",sdote:"",searhk:"",seArr:"",searr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",sol:"/",solb:"",solbar:"",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",squ:"",Square:"",square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",Sub:"",sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",Subset:"",subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succ:"",succapprox:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",Sum:"",sum:"",sung:"",Sup:"",sup:"",sup1:"",sup2:"",sup3:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",Supset:"",supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swArr:"",swarr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",Therefore:"",therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",thinsp:"",ThinSpace:"",thkap:"",thksim:"",THORN:"",thorn:"",Tilde:"",tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",times:"",timesb:"",timesbar:"",timesd:"",tint:"",toea:"",top:"",topbot:"",topcir:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",TRADE:"",trade:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",Uarr:"",uArr:"",uarr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrow:"",Uparrow:"",uparrow:"",UpArrowBar:"",UpArrowDownArrow:"",UpDownArrow:"",Updownarrow:"",updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",Upsi:"",upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTee:"",UpTeeArrow:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",vArr:"",varr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",Vbar:"",vBar:"",vBarv:"",Vcy:"",vcy:"",VDash:"",Vdash:"",vDash:"",vdash:"",Vdashl:"",Vee:"",vee:"",veebar:"",veeeq:"",vellip:"",Verbar:"",verbar:"|",Vert:"",vert:"|",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",Wedge:"",wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xhArr:"",xharr:"",Xi:"",xi:"",xlArr:"",xlarr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrArr:"",xrarr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",Yuml:"",yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",Zfr:"",zfr:"",ZHcy:"",zhcy:"",zigrarr:"",Zopf:"",zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}),t.entityMap=t.HTML_ENTITIES},b5c7:function(e,t,n){var i=n("282b"),r=i([["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["stroke","barBorderColor"],["lineWidth","barBorderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),s={getBarItemStyle:function(e){var t=r(this,e);if(this.getBorderLineDash){var n=this.getBorderLineDash();n&&(t.lineDash=n)}return t}};e.exports=s},b639:function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var i=n("1fb5"),r=n("9152"),s=n("e3db");function a(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function l(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=u.prototype):(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return c(this,e,t,n)}function c(e,t,n,i){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?m(e,t,n,i):"string"===typeof t?p(e,t,n):v(e,t)}function d(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t,n,i){return d(t),t<=0?l(e,t):void 0!==n?"string"===typeof i?l(e,t).fill(n,i):l(e,t).fill(n):l(e,t)}function f(e,t){if(d(t),e=l(e,t<0?0:0|y(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t,n){if("string"===typeof n&&""!==n||(n="utf8"),!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|_(t,n);e=l(e,i);var r=e.write(t,n);return r!==i&&(e=e.slice(0,r)),e}function g(e,t){var n=t.length<0?0:0|y(t.length);e=l(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function m(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),u.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=u.prototype):e=g(e,t),e}function v(e,t){if(u.isBuffer(t)){var n=0|y(t.length);return e=l(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||te(t.length)?l(e,0):g(e,t);if("Buffer"===t.type&&s(t.data))return g(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function y(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function b(e){return+e!=e&&(e=0),u.alloc(+e)}function _(e,t){if(u.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return X(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return J(e).length;default:if(i)return X(e).length;t=(""+t).toLowerCase(),i=!0}}function T(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";e||(e="utf8");while(1)switch(e){case"hex":return U(this,t,n);case"utf8":case"utf-8":return M(this,t,n);case"ascii":return O(this,t,n);case"latin1":case"binary":return N(this,t,n);case"base64":return R(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function S(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function w(e,t,n,i,r){if(0===e.length)return-1;if("string"===typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"===typeof t&&(t=u.from(t,i)),u.isBuffer(t))return 0===t.length?-1:E(e,t,n,i,r);if("number"===typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):E(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function E(e,t,n,i,r){var s,a=1,o=e.length,l=t.length;if(void 0!==i&&(i=String(i).toLowerCase(),"ucs2"===i||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,o/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var c=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===l)return c*a}else-1!==c&&(s-=s-c),c=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){for(var d=!0,h=0;h<l;h++)if(u(e,s+h)!==u(t,h)){d=!1;break}if(d)return s}return-1}function x(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i),i>r&&(i=r)):i=r;var s=t.length;if(s%2!==0)throw new TypeError("Invalid hex string");i>s/2&&(i=s/2);for(var a=0;a<i;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[n+a]=o}return a}function k(e,t,n,i){return ee(X(t,e.length-n),e,n,i)}function A(e,t,n,i){return ee(Q(t),e,n,i)}function I(e,t,n,i){return A(e,t,n,i)}function C(e,t,n,i){return ee(J(t),e,n,i)}function D(e,t,n,i){return ee(Z(t,e.length-n),e,n,i)}function R(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function M(e,t,n){n=Math.min(e.length,n);var i=[],r=t;while(r<n){var s,a,o,l,u=e[r],c=null,d=u>239?4:u>223?3:u>191?2:1;if(r+d<=n)switch(d){case 1:u<128&&(c=u);break;case 2:s=e[r+1],128===(192&s)&&(l=(31&u)<<6|63&s,l>127&&(c=l));break;case 3:s=e[r+1],a=e[r+2],128===(192&s)&&128===(192&a)&&(l=(15&u)<<12|(63&s)<<6|63&a,l>2047&&(l<55296||l>57343)&&(c=l));break;case 4:s=e[r+1],a=e[r+2],o=e[r+3],128===(192&s)&&128===(192&a)&&128===(192&o)&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o,l>65535&&l<1114112&&(c=l))}null===c?(c=65533,d=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),r+=d}return P(i)}t.Buffer=u,t.SlowBuffer=b,t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:a(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return h(null,e,t,n)},u.allocUnsafe=function(e){return f(null,e)},u.allocUnsafeSlow=function(e){return f(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=u.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var a=e[n];if(!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,r),r+=a.length}return i},u.byteLength=_,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)S(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)S(this,t,t+3),S(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)S(this,t,t+7),S(this,t+1,t+6),S(this,t+2,t+5),S(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?M(this,0,e):T.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,i,r){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var s=r-i,a=n-t,o=Math.min(s,a),l=this.slice(i,r),c=e.slice(t,n),d=0;d<o;++d)if(l[d]!==c[d]){s=l[d],a=c[d];break}return s<a?-1:a<s?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return w(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return w(this,e,t,n,!1)},u.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return x(this,e,t,n);case"utf8":case"utf-8":return k(this,e,t,n);case"ascii":return A(this,e,t,n);case"latin1":case"binary":return I(this,e,t,n);case"base64":return C(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var L=4096;function P(e){var t=e.length;if(t<=L)return String.fromCharCode.apply(String,e);var n="",i=0;while(i<t)n+=String.fromCharCode.apply(String,e.slice(i,i+=L));return n}function O(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function N(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function U(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",s=t;s<n;++s)r+=Y(e[s]);return r}function F(e,t,n){for(var i=e.slice(t,n),r="",s=0;s<i.length;s+=2)r+=String.fromCharCode(i[s]+256*i[s+1]);return r}function B(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function j(e,t,n,i,r,s){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function V(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,s=Math.min(e.length-n,2);r<s;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function H(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,s=Math.min(e.length-n,4);r<s;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function $(e,t,n,i,r,s){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function G(e,t,n,i,s){return s||$(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),r.write(e,t,n,i,23,4),n+4}function z(e,t,n,i,s){return s||$(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),r.write(e,t,n,i,52,8),n+8}u.prototype.slice=function(e,t){var n,i=this.length;if(e=~~e,t=void 0===t?i:~~t,e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)n=this.subarray(e,t),n.__proto__=u.prototype;else{var r=t-e;n=new u(r,void 0);for(var s=0;s<r;++s)n[s]=this[s+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||B(e,t,this.length);var i=this[e],r=1,s=0;while(++s<t&&(r*=256))i+=this[e+s]*r;return i},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||B(e,t,this.length);var i=this[e+--t],r=1;while(t>0&&(r*=256))i+=this[e+--t]*r;return i},u.prototype.readUInt8=function(e,t){return t||B(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||B(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||B(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||B(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||B(e,t,this.length);var i=this[e],r=1,s=0;while(++s<t&&(r*=256))i+=this[e+s]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||B(e,t,this.length);var i=t,r=1,s=this[e+--i];while(i>0&&(r*=256))s+=this[e+--i]*r;return r*=128,s>=r&&(s-=Math.pow(2,8*t)),s},u.prototype.readInt8=function(e,t){return t||B(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||B(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||B(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||B(e,4,this.length),r.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||B(e,4,this.length),r.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||B(e,8,this.length),r.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||B(e,8,this.length),r.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t|=0,n|=0,!i){var r=Math.pow(2,8*n)-1;j(this,e,t,n,r,0)}var s=1,a=0;this[t]=255&e;while(++a<n&&(s*=256))this[t+a]=e/s&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t|=0,n|=0,!i){var r=Math.pow(2,8*n)-1;j(this,e,t,n,r,0)}var s=n-1,a=1;this[t+s]=255&e;while(--s>=0&&(a*=256))this[t+s]=e/a&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):V(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):V(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):H(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):H(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);j(this,e,t,n,r-1,-r)}var s=0,a=1,o=0;this[t]=255&e;while(++s<n&&(a*=256))e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+n},u.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);j(this,e,t,n,r-1,-r)}var s=n-1,a=1,o=0;this[t+s]=255&e;while(--s>=0&&(a*=256))e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):V(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):V(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):H(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||j(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):H(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return G(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return G(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return z(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return z(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,s=i-n;if(this===e&&n<t&&t<i)for(r=s-1;r>=0;--r)e[r+t]=this[r+n];else if(s<1e3||!u.TYPED_ARRAY_SUPPORT)for(r=0;r<s;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},u.prototype.fill=function(e,t,n,i){if("string"===typeof e){if("string"===typeof t?(i=t,t=0,n=this.length):"string"===typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!==typeof i)throw new TypeError("encoding must be a string");if("string"===typeof i&&!u.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=u.isBuffer(e)?e:X(new u(e,i).toString()),o=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%o]}return this};var q=/[^+\/0-9A-Za-z-_]/g;function W(e){if(e=K(e).replace(q,""),e.length<2)return"";while(e.length%4!==0)e+="=";return e}function K(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Y(e){return e<16?"0"+e.toString(16):e.toString(16)}function X(e,t){var n;t=t||1/0;for(var i=e.length,r=null,s=[],a=0;a<i;++a){if(n=e.charCodeAt(a),n>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function Q(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function Z(e,t){for(var n,i,r,s=[],a=0;a<e.length;++a){if((t-=2)<0)break;n=e.charCodeAt(a),i=n>>8,r=n%256,s.push(r),s.push(i)}return s}function J(e){return i.toByteArray(W(e))}function ee(e,t,n,i){for(var r=0;r<i;++r){if(r+n>=t.length||r>=e.length)break;t[r+n]=e[r]}return r}function te(e){return e!==e}}).call(this,n("c8ba"))},b719:function(e,t,n){var i=n("697e7");t.zrender=i;var r=n("1687");t.matrix=r;var s=n("401b");t.vector=s;var a=n("6d8b"),o=n("41ef");t.color=o;var l=n("2306");t.graphic=l;var u=n("3842");t.number=u;var c=n("eda2");t.format=c;var d=n("88b3");d.throttle;t.throttle=d.throttle;var h=n("1548");t.helper=h;var f=n("bda7");t.parseGeoJSON=f;var p=n("6179");t.List=p;var g=n("4319");t.Model=g;var m=n("84ce");t.Axis=m;var v=n("22d1");t.env=v;var y=f,b={};a.each(["map","each","filter","indexOf","inherits","reduce","filter","bind","curry","isArray","isString","isObject","isFunction","extend","defaults","clone","merge"],function(e){b[e]=a[e]}),t.parseGeoJson=y,t.util=b},b809:function(e,t,n){var i=n("6d8b"),r=n("29a8"),s=n("2b17"),a=s.retrieveRawValue;function o(e,t){var n=t.getModel("aria");if(n.get("show"))if(n.get("description"))e.setAttribute("aria-label",n.get("description"));else{var s=0;t.eachSeries(function(e,t){++s},this);var o,l=n.get("data.maxCount")||10,u=n.get("series.maxCount")||10,c=Math.min(s,u);if(!(s<1)){var d=m();o=d?p(g("general.withTitle"),{title:d}):g("general.withoutTitle");var h=[],f=s>1?"series.multiple.prefix":"series.single.prefix";o+=p(g(f),{seriesCount:s}),t.eachSeries(function(e,t){if(t<c){var n,i=e.get("name"),r="series."+(s>1?"multiple":"single")+".";n=g(i?r+"withName":r+"withoutName"),n=p(n,{seriesId:e.seriesIndex,seriesName:e.get("name"),seriesType:v(e.subType)});var o=e.getData();window.data=o,o.count()>l?n+=p(g("data.partialData"),{displayCnt:l}):n+=g("data.allData");for(var u=[],d=0;d<o.count();d++)if(d<l){var f=o.getName(d),m=a(o,d);u.push(p(g(f?"data.withName":"data.withoutName"),{name:f,value:m}))}n+=u.join(g("data.separator.middle"))+g("data.separator.end"),h.push(n)}}),o+=h.join(g("series.multiple.separator.middle"))+g("series.multiple.separator.end"),e.setAttribute("aria-label",o)}}function p(e,t){if("string"!==typeof e)return e;var n=e;return i.each(t,function(e,t){n=n.replace(new RegExp("\\{\\s*"+t+"\\s*\\}","g"),e)}),n}function g(e){var t=n.get(e);if(null==t){for(var i=e.split("."),s=r.aria,a=0;a<i.length;++a)s=s[i[a]];return s}return t}function m(){var e=t.getModel("title").option;return e&&e.length&&(e=e[0]),e&&e.text}function v(e){return r.series.typeNames[e]||""}}e.exports=o},bcaa:function(e,t,n){var i=n("cb7c"),r=n("d3f4"),s=n("a5b8");e.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var n=s.f(e),a=n.resolve;return a(t),n.promise}},bd6b:function(e,t,n){var i=n("06ad"),r=n("4942"),s=n("6d8b"),a=s.isString,o=s.isFunction,l=s.isObject,u=s.isArrayLike,c=s.indexOf,d=function(){this.animators=[]};d.prototype={constructor:d,animate:function(e,t){var n,s=!1,a=this,o=this.__zr;if(e){var l=e.split("."),u=a;s="shape"===l[0];for(var d=0,h=l.length;d<h;d++)u&&(u=u[l[d]]);u&&(n=u)}else n=a;if(n){var f=a.animators,p=new i(n,t);return p.during(function(e){a.dirty(s)}).done(function(){f.splice(c(f,p),1)}),f.push(p),o&&o.animation.addAnimator(p),p}r('Property "'+e+'" is not existed in element '+a.id)},stopAnimation:function(e){for(var t=this.animators,n=t.length,i=0;i<n;i++)t[i].stop(e);return t.length=0,this},animateTo:function(e,t,n,i,r,s){a(n)?(r=i,i=n,n=0):o(i)?(r=i,i="linear",n=0):o(n)?(r=n,n=0):o(t)?(r=t,t=500):t||(t=500),this.stopAnimation(),this._animateToShallow("",this,e,t,n);var l=this.animators.slice(),u=l.length;function c(){u--,u||r&&r()}u||r&&r();for(var d=0;d<l.length;d++)l[d].done(c).start(i,s)},_animateToShallow:function(e,t,n,i,r){var s={},a=0;for(var o in n)if(n.hasOwnProperty(o))if(null!=t[o])l(n[o])&&!u(n[o])?this._animateToShallow(e?e+"."+o:o,t[o],n[o],i,r):(s[o]=n[o],a++);else if(null!=n[o])if(e){var c={};c[e]={},c[e][o]=n[o],this.attr(c)}else this.attr(o,n[o]);return a>0&&this.animate(e,!1).when(null==i?500:i,s).delay(r||0),this}};var h=d;e.exports=h},bd9e:function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=n("2306"),a=n("e0d3"),o=n("f4a2"),l=r.each,u=r.indexOf,c=r.curry,d=["dataToPoint","pointToData"],h=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"];function f(e,t,n){var i=this._targetInfoList=[],r={},s=m(t,e);l(v,function(e,t){(!n||!n.include||u(n.include,t)>=0)&&e(s,i,r)})}var p=f.prototype;function g(e){return e[0]>e[1]&&e.reverse(),e}function m(e,t){return a.parseFinder(e,t,{includeMainTypes:h})}p.setOutputRanges=function(e,t){this.matchOutputRanges(e,t,function(e,t,n){if((e.coordRanges||(e.coordRanges=[])).push(t),!e.coordRange){e.coordRange=t;var i=_[e.brushType](0,n,t);e.__rangeOffset={offset:S[e.brushType](i.values,e.range,[1,1]),xyMinMax:i.xyMinMax}}})},p.matchOutputRanges=function(e,t,n){l(e,function(e){var i=this.findTargetInfo(e,t);i&&!0!==i&&r.each(i.coordSyses,function(i){var r=_[e.brushType](1,i,e.range);n(e,r.values,i,t)})},this)},p.setInputRanges=function(e,t){l(e,function(e){var n=this.findTargetInfo(e,t);if(e.range=e.range||[],n&&!0!==n){e.panelId=n.panelId;var i=_[e.brushType](0,n.coordSys,e.coordRange),r=e.__rangeOffset;e.range=r?S[e.brushType](i.values,r.offset,E(i.xyMinMax,r.xyMinMax)):i.values}},this)},p.makePanelOpts=function(e,t){return r.map(this._targetInfoList,function(n){var i=n.getPanelRect();return{panelId:n.panelId,defaultBrushType:t&&t(n),clipPath:o.makeRectPanelClipPath(i),isTargetByCursor:o.makeRectIsTargetByCursor(i,e,n.coordSysModel),getLinearBrushOtherExtent:o.makeLinearBrushOtherExtent(i)}})},p.controlSeries=function(e,t,n){var i=this.findTargetInfo(e,n);return!0===i||i&&u(i.coordSyses,t.coordinateSystem)>=0},p.findTargetInfo=function(e,t){for(var n=this._targetInfoList,i=m(t,e),r=0;r<n.length;r++){var s=n[r],a=e.panelId;if(a){if(s.panelId===a)return s}else for(r=0;r<y.length;r++)if(y[r](i,s))return s}return!0};var v={grid:function(e,t){var n=e.xAxisModels,i=e.yAxisModels,s=e.gridModels,a=r.createHashMap(),o={},c={};(n||i||s)&&(l(n,function(e){var t=e.axis.grid.model;a.set(t.id,t),o[t.id]=!0}),l(i,function(e){var t=e.axis.grid.model;a.set(t.id,t),c[t.id]=!0}),l(s,function(e){a.set(e.id,e),o[e.id]=!0,c[e.id]=!0}),a.each(function(e){var r=e.coordinateSystem,s=[];l(r.getCartesians(),function(e,t){(u(n,e.getAxis("x").model)>=0||u(i,e.getAxis("y").model)>=0)&&s.push(e)}),t.push({panelId:"grid--"+e.id,gridModel:e,coordSysModel:e,coordSys:s[0],coordSyses:s,getPanelRect:b.grid,xAxisDeclared:o[e.id],yAxisDeclared:c[e.id]})}))},geo:function(e,t){l(e.geoModels,function(e){var n=e.coordinateSystem;t.push({panelId:"geo--"+e.id,geoModel:e,coordSysModel:e,coordSys:n,coordSyses:[n],getPanelRect:b.geo})})}},y=[function(e,t){var n=e.xAxisModel,i=e.yAxisModel,r=e.gridModel;return!r&&n&&(r=n.axis.grid.model),!r&&i&&(r=i.axis.grid.model),r&&r===t.gridModel},function(e,t){var n=e.geoModel;return n&&n===t.geoModel}],b={grid:function(){return this.coordSys.grid.getRect().clone()},geo:function(){var e=this.coordSys,t=e.getBoundingRect().clone();return t.applyTransform(s.getTransform(e)),t}},_={lineX:c(T,0),lineY:c(T,1),rect:function(e,t,n){var i=t[d[e]]([n[0][0],n[1][0]]),r=t[d[e]]([n[0][1],n[1][1]]),s=[g([i[0],r[0]]),g([i[1],r[1]])];return{values:s,xyMinMax:s}},polygon:function(e,t,n){var i=[[1/0,-1/0],[1/0,-1/0]],s=r.map(n,function(n){var r=t[d[e]](n);return i[0][0]=Math.min(i[0][0],r[0]),i[1][0]=Math.min(i[1][0],r[1]),i[0][1]=Math.max(i[0][1],r[0]),i[1][1]=Math.max(i[1][1],r[1]),r});return{values:s,xyMinMax:i}}};function T(e,t,n,i){var s=n.getAxis(["x","y"][e]),a=g(r.map([0,1],function(e){return t?s.coordToData(s.toLocalCoord(i[e])):s.toGlobalCoord(s.dataToCoord(i[e]))})),o=[];return o[e]=a,o[1-e]=[NaN,NaN],{values:a,xyMinMax:o}}var S={lineX:c(w,0),lineY:c(w,1),rect:function(e,t,n){return[[e[0][0]-n[0]*t[0][0],e[0][1]-n[0]*t[0][1]],[e[1][0]-n[1]*t[1][0],e[1][1]-n[1]*t[1][1]]]},polygon:function(e,t,n){return r.map(e,function(e,i){return[e[0]-n[0]*t[i][0],e[1]-n[1]*t[i][1]]})}};function w(e,t,n,i){return[t[0]-i[e]*n[0],t[1]-i[e]*n[1]]}function E(e,t){var n=x(e),i=x(t),r=[n[0]/i[0],n[1]/i[1]];return isNaN(r[0])&&(r[0]=1),isNaN(r[1])&&(r[1]=1),r}function x(e){return e?[e[0][1]-e[0][0],e[1][1]-e[1][0]]:[NaN,NaN]}var k=f;e.exports=k},bda7:function(e,t,n){var i=n("6d8b"),r=n("f279");function s(e){if(!e.UTF8Encoding)return e;var t=e.UTF8Scale;null==t&&(t=1024);for(var n=e.features,i=0;i<n.length;i++)for(var r=n[i],s=r.geometry,o=s.coordinates,l=s.encodeOffsets,u=0;u<o.length;u++){var c=o[u];if("Polygon"===s.type)o[u]=a(c,l[u],t);else if("MultiPolygon"===s.type)for(var d=0;d<c.length;d++){var h=c[d];c[d]=a(h,l[u][d],t)}}return e.UTF8Encoding=!1,e}function a(e,t,n){for(var i=[],r=t[0],s=t[1],a=0;a<e.length;a+=2){var o=e.charCodeAt(a)-64,l=e.charCodeAt(a+1)-64;o=o>>1^-(1&o),l=l>>1^-(1&l),o+=r,l+=s,r=o,s=l,i.push([o/n,l/n])}return i}function o(e){return s(e),i.map(i.filter(e.features,function(e){return e.geometry&&e.properties&&e.geometry.coordinates.length>0}),function(e){var t=e.properties,n=e.geometry,s=n.coordinates,a=[];"Polygon"===n.type&&a.push({type:"polygon",exterior:s[0],interiors:s.slice(1)}),"MultiPolygon"===n.type&&i.each(s,function(e){e[0]&&a.push({type:"polygon",exterior:e[0],interiors:e.slice(1)})});var o=new r(t.name,a,t.cp);return o.properties=t,o})}e.exports=o},be09:function(e,t,n){(function(t){var n;n="undefined"!==typeof window?window:"undefined"!==typeof t?t:"undefined"!==typeof self?self:{},e.exports=n}).call(this,n("c8ba"))},be13:function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},be24:function(e,t,n){"use strict";function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var a=function(){function e(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1}var t=e.prototype;return t.getIsEnabled=function(){return this.enabled_},t.enable=function(){this.enabled_=!0},t.disable=function(){this.enabled_=!1},t.reset=function(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1},t.addInterceptor=function(e,t){this.typeToInterceptorsMap_.has(e)||this.typeToInterceptorsMap_.set(e,new Set);var n=this.typeToInterceptorsMap_.get(e);return!n.has(t)&&(n.add(t),!0)},t.removeInterceptor=function(e,t){var n=this.typeToInterceptorsMap_.get(e);return!(!n||!n.has(t))&&(n.delete(t),!0)},t.clearInterceptorsByType=function(e){var t=this.typeToInterceptorsMap_.get(e);return!!t&&(this.typeToInterceptorsMap_.delete(e),this.typeToInterceptorsMap_.set(e,new Set),!0)},t.clear=function(){return!!this.typeToInterceptorsMap_.size&&(this.typeToInterceptorsMap_=new Map,!0)},t.getForType=function(e){return this.typeToInterceptorsMap_.get(e)||new Set},t.execute=function(e,t){for(var n,r=this.getForType(e),s=i(r);!(n=s()).done;){var a=n.value;try{t=a(t)}catch(e){}}return t},e}();e.exports=a},c366:function(e,t,n){var i=n("6821"),r=n("9def"),s=n("77f1");e.exports=function(e){return function(t,n,a){var o,l=i(t),u=r(l.length),c=s(a,u);if(e&&n!=n){while(u>c)if(o=l[c++],o!=o)return!0}else for(;u>c;c++)if((e||c in l)&&l[c]===n)return e||c||0;return!e&&-1}}},c526:function(e,t){var n={axisPointer:1,tooltip:1,brush:1};function i(e,t,i){var r=t.getComponentByElement(e.topTarget),s=r&&r.coordinateSystem;return r&&r!==i&&!n[r.mainType]&&s&&s.model!==i}t.onIrrelevantElement=i},c533:function(e,t){var n=["#37A2DA","#32C5E9","#67E0E3","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#E062AE","#E690D1","#e7bcf3","#9d96f5","#8378EA","#96BFFF"],i={color:n,colorLayer:[["#37A2DA","#ffd85c","#fd7b5f"],["#37A2DA","#67E0E3","#FFDB5C","#ff9f7f","#E062AE","#9d96f5"],["#37A2DA","#32C5E9","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#e7bcf3","#8378EA","#96BFFF"],n]};e.exports=i},c5f6:function(e,t,n){"use strict";var i=n("7726"),r=n("69a8"),s=n("2d95"),a=n("5dbc"),o=n("6a99"),l=n("79e5"),u=n("9093").f,c=n("11e9").f,d=n("86cc").f,h=n("aa77").trim,f="Number",p=i[f],g=p,m=p.prototype,v=s(n("2aeb")(m))==f,y="trim"in String.prototype,b=function(e){var t=o(e,!1);if("string"==typeof t&&t.length>2){t=y?t.trim():h(t,3);var n,i,r,s=t.charCodeAt(0);if(43===s||45===s){if(n=t.charCodeAt(2),88===n||120===n)return NaN}else if(48===s){switch(t.charCodeAt(1)){case 66:case 98:i=2,r=49;break;case 79:case 111:i=8,r=55;break;default:return+t}for(var a,l=t.slice(2),u=0,c=l.length;u<c;u++)if(a=l.charCodeAt(u),a<48||a>r)return NaN;return parseInt(l,i)}}return+t};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof p&&(v?l(function(){m.valueOf.call(n)}):s(n)!=f)?a(new g(b(t)),n,p):b(t)};for(var _,T=n("9e1e")?u(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;T.length>S;S++)r(g,_=T[S])&&!r(p,_)&&d(p,_,c(g,_));p.prototype=m,m.constructor=p,n("2aba")(i,f,p)}},c69a:function(e,t,n){e.exports=!n("9e1e")&&!n("79e5")(function(){return 7!=Object.defineProperty(n("230e")("div"),"a",{get:function(){return 7}}).a})},c775:function(e,t,n){var i=n("2b17"),r=i.retrieveRawValue;function s(e,t){var n=e.mapDimension("defaultedLabel",!0),i=n.length;if(1===i)return r(e,t,n[0]);if(i){for(var s=[],a=0;a<n.length;a++){var o=r(e,t,n[a]);s.push(o)}return s.join(" ")}}t.getDefaultLabel=s},c7a2:function(e,t,n){var i=n("cbe5"),r=n("5693"),s=i.extend({type:"rect",shape:{r:0,x:0,y:0,width:0,height:0},buildPath:function(e,t){var n=t.x,i=t.y,s=t.width,a=t.height;t.r?r.buildPath(e,t):e.rect(n,i,s,a),e.closePath()}});e.exports=s},c8ba:function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"===typeof window&&(n=window)}e.exports=n},ca5a:function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},ca98:function(e,t,n){var i=n("6d8b"),r=n("e0d3"),s=n("6cb7"),a=i.each,o=i.clone,l=i.map,u=i.merge,c=/^(min|max)?(.+)$/;function d(e){this._api=e,this._timelineOptions=[],this._mediaList=[],this._mediaDefault,this._currentMediaIndices=[],this._optionBackup,this._newBaseOption}function h(e,t,n){var r,s,o=[],l=[],u=e.timeline;if(e.baseOption&&(s=e.baseOption),(u||e.options)&&(s=s||{},o=(e.options||[]).slice()),e.media){s=s||{};var c=e.media;a(c,function(e){e&&e.option&&(e.query?l.push(e):r||(r=e))})}return s||(s=e),s.timeline||(s.timeline=u),a([s].concat(o).concat(i.map(l,function(e){return e.option})),function(e){a(t,function(t){t(e,n)})}),{baseOption:s,timelineOptions:o,mediaDefault:r,mediaList:l}}function f(e,t,n){var r={width:t,height:n,aspectratio:t/n},s=!0;return i.each(e,function(e,t){var n=t.match(c);if(n&&n[1]&&n[2]){var i=n[1],a=n[2].toLowerCase();p(r[a],e,i)||(s=!1)}}),s}function p(e,t,n){return"min"===n?e>=t:"max"===n?e<=t:e===t}function g(e,t){return e.join(",")===t.join(",")}function m(e,t){t=t||{},a(t,function(t,n){if(null!=t){var i=e[n];if(s.hasClass(n)){t=r.normalizeToArray(t),i=r.normalizeToArray(i);var a=r.mappingToExists(i,t);e[n]=l(a,function(e){return e.option&&e.exist?u(e.exist,e.option,!0):e.exist||e.option})}else e[n]=u(i,t,!0)}})}d.prototype={constructor:d,setOption:function(e,t){e&&i.each(r.normalizeToArray(e.series),function(e){e&&e.data&&i.isTypedArray(e.data)&&i.setAsPrimitive(e.data)}),e=o(e,!0);var n=this._optionBackup,s=h.call(this,e,t,!n);this._newBaseOption=s.baseOption,n?(m(n.baseOption,s.baseOption),s.timelineOptions.length&&(n.timelineOptions=s.timelineOptions),s.mediaList.length&&(n.mediaList=s.mediaList),s.mediaDefault&&(n.mediaDefault=s.mediaDefault)):this._optionBackup=s},mountOption:function(e){var t=this._optionBackup;return this._timelineOptions=l(t.timelineOptions,o),this._mediaList=l(t.mediaList,o),this._mediaDefault=o(t.mediaDefault),this._currentMediaIndices=[],o(e?t.baseOption:this._newBaseOption)},getTimelineOption:function(e){var t,n=this._timelineOptions;if(n.length){var i=e.getComponent("timeline");i&&(t=o(n[i.getCurrentIndex()],!0))}return t},getMediaOption:function(e){var t=this._api.getWidth(),n=this._api.getHeight(),i=this._mediaList,r=this._mediaDefault,s=[],a=[];if(!i.length&&!r)return a;for(var u=0,c=i.length;u<c;u++)f(i[u].query,t,n)&&s.push(u);return!s.length&&r&&(s=[-1]),s.length&&!g(s,this._currentMediaIndices)&&(a=l(s,function(e){return o(-1===e?r.option:i[e].option)})),this._currentMediaIndices=s,a}};var v=d;e.exports=v},cadf:function(e,t,n){"use strict";var i=n("9c6c"),r=n("d53b"),s=n("84f2"),a=n("6821");e.exports=n("01f9")(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,r(1)):r(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),s.Arguments=s.Array,i("keys"),i("values"),i("entries")},cb0c:function(e,t,n){"use strict";function i(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var s=e.apply(t,n);function a(e,t){try{var n=s[e](t),a=n.value}catch(e){return void r(e)}n.done?i(a):Promise.resolve(a).then(o,l)}function o(e){a("next",e)}function l(e){a("throw",e)}o()})}}n.d(t,"a",function(){return i})},cb11:function(e,t,n){var i=n("cbe5"),r=i.extend({type:"line",shape:{x1:0,y1:0,x2:0,y2:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(e,t){var n=t.x1,i=t.y1,r=t.x2,s=t.y2,a=t.percent;0!==a&&(e.moveTo(n,i),a<1&&(r=n*(1-a)+r*a,s=i*(1-a)+s*a),e.lineTo(r,s))},pointAt:function(e){var t=this.shape;return[t.x1*(1-e)+t.x2*e,t.y1*(1-e)+t.y2*e]}});e.exports=r},cb6d:function(e,t){function n(){this.on("mousedown",this._dragStart,this),this.on("mousemove",this._drag,this),this.on("mouseup",this._dragEnd,this),this.on("globalout",this._dragEnd,this)}function i(e,t){return{target:e,topTarget:t&&t.topTarget}}n.prototype={constructor:n,_dragStart:function(e){var t=e.target;t&&t.draggable&&(this._draggingTarget=t,t.dragging=!0,this._x=e.offsetX,this._y=e.offsetY,this.dispatchToElement(i(t,e),"dragstart",e.event))},_drag:function(e){var t=this._draggingTarget;if(t){var n=e.offsetX,r=e.offsetY,s=n-this._x,a=r-this._y;this._x=n,this._y=r,t.drift(s,a,e),this.dispatchToElement(i(t,e),"drag",e.event);var o=this.findHover(n,r,t).target,l=this._dropTarget;this._dropTarget=o,t!==o&&(l&&o!==l&&this.dispatchToElement(i(l,e),"dragleave",e.event),o&&o!==l&&this.dispatchToElement(i(o,e),"dragenter",e.event))}},_dragEnd:function(e){var t=this._draggingTarget;t&&(t.dragging=!1),this.dispatchToElement(i(t,e),"dragend",e.event),this._dropTarget&&this.dispatchToElement(i(this._dropTarget,e),"drop",e.event),this._draggingTarget=null,this._dropTarget=null}};var r=n;e.exports=r},cb7c:function(e,t,n){var i=n("d3f4");e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},cb8f:function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("cd33"),a=n("eb6b");n("48ac"),n("d4b1"),n("4a9d"),i.registerPreprocessor(function(e){if(e){(!e.axisPointer||0===e.axisPointer.length)&&(e.axisPointer={});var t=e.axisPointer.link;t&&!r.isArray(t)&&(e.axisPointer.link=[t])}}),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,function(e,t){e.getComponent("axisPointer").coordSysAxesInfo=s.collect(e,t)}),i.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},a)},cbe5:function(e,t,n){var i=n("19eb"),r=n("6d8b"),s=n("20c8"),a=n("d833"),o=n("dc2f"),l=o.prototype.getCanvasPattern,u=Math.abs,c=new s(!0);function d(e){i.call(this,e),this.path=null}d.prototype={constructor:d,type:"path",__dirtyPath:!0,strokeContainThreshold:5,brush:function(e,t){var n,i=this.style,r=this.path||c,s=i.hasStroke(),a=i.hasFill(),o=i.fill,u=i.stroke,d=a&&!!o.colorStops,h=s&&!!u.colorStops,f=a&&!!o.image,p=s&&!!u.image;(i.bind(e,this,t),this.setTransform(e),this.__dirty)&&(d&&(n=n||this.getBoundingRect(),this._fillGradient=i.getGradient(e,o,n)),h&&(n=n||this.getBoundingRect(),this._strokeGradient=i.getGradient(e,u,n)));d?e.fillStyle=this._fillGradient:f&&(e.fillStyle=l.call(o,e)),h?e.strokeStyle=this._strokeGradient:p&&(e.strokeStyle=l.call(u,e));var g=i.lineDash,m=i.lineDashOffset,v=!!e.setLineDash,y=this.getGlobalScale();r.setScale(y[0],y[1]),this.__dirtyPath||g&&!v&&s?(r.beginPath(e),g&&!v&&(r.setLineDash(g),r.setLineDashOffset(m)),this.buildPath(r,this.shape,!1),this.path&&(this.__dirtyPath=!1)):(e.beginPath(),this.path.rebuildPath(e)),a&&r.fill(e),g&&v&&(e.setLineDash(g),e.lineDashOffset=m),s&&r.stroke(e),g&&v&&e.setLineDash([]),null!=i.text&&(this.restoreTransform(e),this.drawRectText(e,this.getBoundingRect()))},buildPath:function(e,t,n){},createPathProxy:function(){this.path=new s},getBoundingRect:function(){var e=this._rect,t=this.style,n=!e;if(n){var i=this.path;i||(i=this.path=new s),this.__dirtyPath&&(i.beginPath(),this.buildPath(i,this.shape,!1)),e=i.getBoundingRect()}if(this._rect=e,t.hasStroke()){var r=this._rectWithStroke||(this._rectWithStroke=e.clone());if(this.__dirty||n){r.copy(e);var a=t.lineWidth,o=t.strokeNoScale?this.getLineScale():1;t.hasFill()||(a=Math.max(a,this.strokeContainThreshold||4)),o>1e-10&&(r.width+=a/o,r.height+=a/o,r.x-=a/o/2,r.y-=a/o/2)}return r}return e},contain:function(e,t){var n=this.transformCoordToLocal(e,t),i=this.getBoundingRect(),r=this.style;if(e=n[0],t=n[1],i.contain(e,t)){var s=this.path.data;if(r.hasStroke()){var o=r.lineWidth,l=r.strokeNoScale?this.getLineScale():1;if(l>1e-10&&(r.hasFill()||(o=Math.max(o,this.strokeContainThreshold)),a.containStroke(s,o/l,e,t)))return!0}if(r.hasFill())return a.contain(s,e,t)}return!1},dirty:function(e){null==e&&(e=!0),e&&(this.__dirtyPath=e,this._rect=null),this.__dirty=!0,this.__zr&&this.__zr.refresh(),this.__clipTarget&&this.__clipTarget.dirty()},animateShape:function(e){return this.animate("shape",e)},attrKV:function(e,t){"shape"===e?(this.setShape(t),this.__dirtyPath=!0,this._rect=null):i.prototype.attrKV.call(this,e,t)},setShape:function(e,t){var n=this.shape;if(n){if(r.isObject(e))for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);else n[e]=t;this.dirty(!0)}return this},getLineScale:function(){var e=this.transform;return e&&u(e[0]-1)>1e-10&&u(e[3]-1)>1e-10?Math.sqrt(u(e[0]*e[3]-e[2]*e[1])):1}},d.extend=function(e){var t=function(t){d.call(this,t),e.style&&this.style.extendFrom(e.style,!1);var n=e.shape;if(n){this.shape=this.shape||{};var i=this.shape;for(var r in n)!i.hasOwnProperty(r)&&n.hasOwnProperty(r)&&(i[r]=n[r])}e.init&&e.init.call(this,t)};for(var n in r.inherits(t,d),e)"style"!==n&&"shape"!==n&&(t.prototype[n]=e[n]);return t},r.inherits(d,i);var h=d;e.exports=h},cbe9:function(e,t,n){var i=n("6d8b"),r=n("cf7e");function s(e){r.call(this,e)}s.prototype={constructor:s,type:"cartesian2d",dimensions:["x","y"],getBaseAxis:function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")},containPoint:function(e){var t=this.getAxis("x"),n=this.getAxis("y");return t.contain(t.toLocalCoord(e[0]))&&n.contain(n.toLocalCoord(e[1]))},containData:function(e){return this.getAxis("x").containData(e[0])&&this.getAxis("y").containData(e[1])},dataToPoint:function(e,t,n){var i=this.getAxis("x"),r=this.getAxis("y");return n=n||[],n[0]=i.toGlobalCoord(i.dataToCoord(e[0])),n[1]=r.toGlobalCoord(r.dataToCoord(e[1])),n},clampData:function(e,t){var n=this.getAxis("x").scale,i=this.getAxis("y").scale,r=n.getExtent(),s=i.getExtent(),a=n.parse(e[0]),o=i.parse(e[1]);return t=t||[],t[0]=Math.min(Math.max(Math.min(r[0],r[1]),a),Math.max(r[0],r[1])),t[1]=Math.min(Math.max(Math.min(s[0],s[1]),o),Math.max(s[0],s[1])),t},pointToData:function(e,t){var n=this.getAxis("x"),i=this.getAxis("y");return t=t||[],t[0]=n.coordToData(n.toLocalCoord(e[0])),t[1]=i.coordToData(i.toLocalCoord(e[1])),t},getOtherAxis:function(e){return this.getAxis("x"===e.dim?"y":"x")}},i.inherits(s,r);var a=s;e.exports=a},cc39:function(e,t,n){var i=n("6d8b"),r=n("3842"),s=n("50e5"),a=i.each,o=r.asc,l=function(e,t,n,i){this._dimName=e,this._axisIndex=t,this._valueWindow,this._percentWindow,this._dataExtent,this._minMaxSpan,this.ecModel=i,this._dataZoomModel=n};function u(e,t,n){var i=[1/0,-1/0];return a(n,function(e){var n=e.getData();n&&a(n.mapDimension(t,!0),function(e){var t=n.getApproximateExtent(e);t[0]<i[0]&&(i[0]=t[0]),t[1]>i[1]&&(i[1]=t[1])})}),i[1]<i[0]&&(i=[NaN,NaN]),c(e,i),i}function c(e,t){var n=e.getAxisModel(),i=n.getMin(!0),r="category"===n.get("type"),s=r&&n.getCategories().length;null!=i&&"dataMin"!==i&&"function"!==typeof i?t[0]=i:r&&(t[0]=s>0?0:NaN);var a=n.getMax(!0);return null!=a&&"dataMax"!==a&&"function"!==typeof a?t[1]=a:r&&(t[1]=s>0?s-1:NaN),n.get("scale",!0)||(t[0]>0&&(t[0]=0),t[1]<0&&(t[1]=0)),t}function d(e,t){var n=e.getAxisModel(),i=e._percentWindow,s=e._valueWindow;if(i){var a=r.getPixelPrecision(s,[0,500]);a=Math.min(a,20);var o=t||0===i[0]&&100===i[1];n.setRange(o?null:+s[0].toFixed(a),o?null:+s[1].toFixed(a))}}function h(e){var t=e._minMaxSpan={},n=e._dataZoomModel;a(["min","max"],function(i){t[i+"Span"]=n.get(i+"Span");var s=n.get(i+"ValueSpan");if(null!=s&&(t[i+"ValueSpan"]=s,s=e.getAxisModel().axis.scale.parse(s),null!=s)){var a=e._dataExtent;t[i+"Span"]=r.linearMap(a[0]+s,a,[0,100],!0)}})}l.prototype={constructor:l,hostedBy:function(e){return this._dataZoomModel===e},getDataValueWindow:function(){return this._valueWindow.slice()},getDataPercentWindow:function(){return this._percentWindow.slice()},getTargetSeriesModels:function(){var e=[],t=this.ecModel;return t.eachSeries(function(n){if(s.isCoordSupported(n.get("coordinateSystem"))){var i=this._dimName,r=t.queryComponents({mainType:i+"Axis",index:n.get(i+"AxisIndex"),id:n.get(i+"AxisId")})[0];this._axisIndex===(r&&r.componentIndex)&&e.push(n)}},this),e},getAxisModel:function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},getOtherAxisModel:function(){var e,t,n,i=this._dimName,r=this.ecModel,s=this.getAxisModel(),a="x"===i||"y"===i;return a?(t="gridIndex",e="x"===i?"y":"x"):(t="polarIndex",e="angle"===i?"radius":"angle"),r.eachComponent(e+"Axis",function(e){(e.get(t)||0)===(s.get(t)||0)&&(n=e)}),n},getMinMaxSpan:function(){return i.clone(this._minMaxSpan)},calculateDataWindow:function(e){var t=this._dataExtent,n=this.getAxisModel(),i=n.axis.scale,s=this._dataZoomModel.getRangePropMode(),l=[0,100],u=[e.start,e.end],c=[];return a(["startValue","endValue"],function(t){c.push(null!=e[t]?i.parse(e[t]):null)}),a([0,1],function(e){var n=c[e],a=u[e];"percent"===s[e]?(null==a&&(a=l[e]),n=i.parse(r.linearMap(a,l,t,!0))):a=r.linearMap(n,t,l,!0),c[e]=n,u[e]=a}),{valueWindow:o(c),percentWindow:o(u)}},reset:function(e){if(e===this._dataZoomModel){var t=this.getTargetSeriesModels();this._dataExtent=u(this,this._dimName,t);var n=this.calculateDataWindow(e.option);this._valueWindow=n.valueWindow,this._percentWindow=n.percentWindow,h(this),d(this)}},restore:function(e){e===this._dataZoomModel&&(this._valueWindow=this._percentWindow=null,d(this,!0))},filterData:function(e,t){if(e===this._dataZoomModel){var n=this._dimName,i=this.getTargetSeriesModels(),r=e.get("filterMode"),s=this._valueWindow;"none"!==r&&a(i,function(e){var t=e.getData(),i=t.mapDimension(n,!0);"weakFilter"===r?t.filterSelf(function(e){for(var n,r,a,o=0;o<i.length;o++){var l=t.get(i[o],e),u=!isNaN(l),c=l<s[0],d=l>s[1];if(u&&!c&&!d)return!0;u&&(a=!0),c&&(n=!0),d&&(r=!0)}return a&&n&&r}):a(i,function(n){if("empty"===r)e.setData(t.map(n,function(e){return o(e)?e:NaN}));else{var i={};i[n]=s,t.selectRange(i)}}),a(i,function(e){t.setApproximateExtent(s,e)})})}function o(e){return e>=s[0]&&e<=s[1]}}};var f=l;e.exports=f},cccd:function(e,t,n){var i=n("e0d3"),r=i.makeInner;function s(){var e=r();return function(t){var n=e(t),i=t.pipelineContext,r=n.large,s=n.progressiveRender,a=n.large=i.large,o=n.progressiveRender=i.progressiveRender;return!!(r^a||s^o)&&"reset"}}e.exports=s},cd33:function(e,t,n){var i=n("6d8b"),r=n("4319"),s=i.each,a=i.curry;function o(e,t){var n={axesInfo:{},seriesInvolved:!1,coordSysAxesInfo:{},coordSysMap:{}};return l(n,e,t),n.seriesInvolved&&c(n,e),n}function l(e,t,n){var i=t.getComponent("tooltip"),r=t.getComponent("axisPointer"),o=r.get("link",!0)||[],l=[];s(n.getCoordinateSystems(),function(n){if(n.axisPointerEnabled){var c=v(n.model),h=e.coordSysAxesInfo[c]={};e.coordSysMap[c]=n;var f=n.model,p=f.getModel("tooltip",i);if(s(n.getAxes(),a(_,!1,null)),n.getTooltipAxes&&i&&p.get("show")){var g="axis"===p.get("trigger"),y="cross"===p.get("axisPointer.type"),b=n.getTooltipAxes(p.get("axisPointer.axis"));(g||y)&&s(b.baseAxes,a(_,!y||"cross",g)),y&&s(b.otherAxes,a(_,"cross",!1))}}function _(i,s,a){var c=a.model.getModel("axisPointer",r),f=c.get("show");if(f&&("auto"!==f||i||m(c))){null==s&&(s=c.get("triggerTooltip")),c=i?u(a,p,r,t,i,s):c;var g=c.get("snap"),y=v(a.model),b=s||g||"category"===a.type,_=e.axesInfo[y]={key:y,axis:a,coordSys:n,axisPointerModel:c,triggerTooltip:s,involveSeries:b,snap:g,useHandle:m(c),seriesModels:[]};h[y]=_,e.seriesInvolved|=b;var T=d(o,a);if(null!=T){var S=l[T]||(l[T]={axesInfo:{}});S.axesInfo[y]=_,S.mapper=o[T].mapper,_.linkGroup=S}}}})}function u(e,t,n,a,o,l){var u=t.getModel("axisPointer"),c={};s(["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"],function(e){c[e]=i.clone(u.get(e))}),c.snap="category"!==e.type&&!!l,"cross"===u.get("type")&&(c.type="line");var d=c.label||(c.label={});if(null==d.show&&(d.show=!1),"cross"===o){var h=u.get("label.show");if(d.show=null==h||h,!l){var f=c.lineStyle=u.get("crossStyle");f&&i.defaults(d,f.textStyle)}}return e.model.getModel("axisPointer",new r(c,n,a))}function c(e,t){t.eachSeries(function(t){var n=t.coordinateSystem,i=t.get("tooltip.trigger",!0),r=t.get("tooltip.show",!0);n&&"none"!==i&&!1!==i&&"item"!==i&&!1!==r&&!1!==t.get("axisPointer.show",!0)&&s(e.coordSysAxesInfo[v(n.model)],function(e){var i=e.axis;n.getAxis(i.dim)===i&&(e.seriesModels.push(t),null==e.seriesDataCount&&(e.seriesDataCount=0),e.seriesDataCount+=t.getData().count())})},this)}function d(e,t){for(var n=t.model,i=t.dim,r=0;r<e.length;r++){var s=e[r]||{};if(h(s[i+"AxisId"],n.id)||h(s[i+"AxisIndex"],n.componentIndex)||h(s[i+"AxisName"],n.name))return r}}function h(e,t){return"all"===e||i.isArray(e)&&i.indexOf(e,t)>=0||e===t}function f(e){var t=p(e);if(t){var n=t.axisPointerModel,i=t.axis.scale,r=n.option,s=n.get("status"),a=n.get("value");null!=a&&(a=i.parse(a));var o=m(n);null==s&&(r.status=o?"show":"hide");var l=i.getExtent().slice();l[0]>l[1]&&l.reverse(),(null==a||a>l[1])&&(a=l[1]),a<l[0]&&(a=l[0]),r.value=a,o&&(r.status=t.axis.scale.isBlank()?"hide":"show")}}function p(e){var t=(e.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return t&&t.axesInfo[v(e)]}function g(e){var t=p(e);return t&&t.axisPointerModel}function m(e){return!!e.get("handle.show")}function v(e){return e.type+"||"+e.id}t.collect=o,t.fixValue=f,t.getAxisInfo=p,t.getAxisPointerModel=g,t.makeKey=v},cdaa:function(e,t,n){var i=n("607d"),r=i.addEventListener,s=i.removeEventListener,a=i.normalizeEvent,o=n("6d8b"),l=n("1fab"),u=n("22d1"),c=n("0b44"),d=300,h=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],f=["touchstart","touchend","touchmove"],p={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},g=o.map(h,function(e){var t=e.replace("mouse","pointer");return p[t]?t:e});function m(e){return"mousewheel"===e&&u.browser.firefox?"DOMMouseScroll":e}function v(e,t,n){var i=e._gestureMgr;"start"===n&&i.clear();var r=i.recognize(t,e.handler.findHover(t.zrX,t.zrY,null).target,e.dom);if("end"===n&&i.clear(),r){var s=r.type;t.gestureEvent=s,e.handler.dispatchToElement({target:r.target},s,r.event)}}function y(e){e._touching=!0,clearTimeout(e._touchTimer),e._touchTimer=setTimeout(function(){e._touching=!1},700)}var b={mousemove:function(e){e=a(this.dom,e),this.trigger("mousemove",e)},mouseout:function(e){e=a(this.dom,e);var t=e.toElement||e.relatedTarget;if(t!=this.dom)while(t&&9!=t.nodeType){if(t===this.dom)return;t=t.parentNode}this.trigger("mouseout",e)},touchstart:function(e){e=a(this.dom,e),e.zrByTouch=!0,this._lastTouchMoment=new Date,v(this,e,"start"),b.mousemove.call(this,e),b.mousedown.call(this,e),y(this)},touchmove:function(e){e=a(this.dom,e),e.zrByTouch=!0,v(this,e,"change"),b.mousemove.call(this,e),y(this)},touchend:function(e){e=a(this.dom,e),e.zrByTouch=!0,v(this,e,"end"),b.mouseup.call(this,e),+new Date-this._lastTouchMoment<d&&b.click.call(this,e),y(this)},pointerdown:function(e){b.mousedown.call(this,e)},pointermove:function(e){_(e)||b.mousemove.call(this,e)},pointerup:function(e){b.mouseup.call(this,e)},pointerout:function(e){_(e)||b.mouseout.call(this,e)}};function _(e){var t=e.pointerType;return"pen"===t||"touch"===t}function T(e){function t(e,t){return function(){if(!t._touching)return e.apply(t,arguments)}}o.each(f,function(t){e._handlers[t]=o.bind(b[t],e)}),o.each(g,function(t){e._handlers[t]=o.bind(b[t],e)}),o.each(h,function(n){e._handlers[n]=t(b[n],e)})}function S(e){function t(t,n){o.each(t,function(t){r(e,m(t),n._handlers[t])},n)}l.call(this),this.dom=e,this._touching=!1,this._touchTimer,this._gestureMgr=new c,this._handlers={},T(this),u.pointerEventsSupported?t(g,this):(u.touchEventsSupported&&t(f,this),t(h,this))}o.each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(e){b[e]=function(t){t=a(this.dom,t),this.trigger(e,t)}});var w=S.prototype;w.dispose=function(){for(var e=h.concat(f),t=0;t<e.length;t++){var n=e[t];s(this.dom,m(n),this._handlers[n])}},w.setCursor=function(e){this.dom.style&&(this.dom.style.cursor=e||"default")},o.mixin(S,l);var E=S;e.exports=E},ce10:function(e,t,n){var i=n("69a8"),r=n("6821"),s=n("c366")(!1),a=n("613b")("IE_PROTO");e.exports=function(e,t){var n,o=r(e),l=0,u=[];for(n in o)n!=a&&i(o,n)&&u.push(n);while(t.length>l)i(o,n=t[l++])&&(~s(u,n)||u.push(n));return u}},cf7e:function(e,t,n){var i=n("6d8b");function r(e){return this._axes[e]}var s=function(e){this._axes={},this._dimList=[],this.name=e||""};s.prototype={constructor:s,type:"cartesian",getAxis:function(e){return this._axes[e]},getAxes:function(){return i.map(this._dimList,r,this)},getAxesByScale:function(e){return e=e.toLowerCase(),i.filter(this.getAxes(),function(t){return t.scale.type===e})},addAxis:function(e){var t=e.dim;this._axes[t]=e,this._dimList.push(t)},dataToCoord:function(e){return this._dataCoordConvert(e,"dataToCoord")},coordToData:function(e){return this._dataCoordConvert(e,"coordToData")},_dataCoordConvert:function(e,t){for(var n=this._dimList,i=e instanceof Array?[]:{},r=0;r<n.length;r++){var s=n[r],a=this._axes[s];i[s]=a[t](e[s])}return i}};var a=s;e.exports=a},d02c:function(e,t,n){var i=n("ef34"),r=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function s(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function a(e){function t(e,t,n,i){return 3600*(0|e)+60*(0|t)+(0|n)+(0|i)/1e3}var n=e.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}function o(){this.values=r(null)}function l(e,t,n,i){var r=i?e.split(i):[e];for(var s in r)if("string"===typeof r[s]){var a=r[s].split(n);if(2===a.length){var o=a[0].trim(),l=a[1].trim();t(o,l)}}}function u(e,t,n){var i=e;function r(){var t=a(e);if(null===t)throw new s(s.Errors.BadTimeStamp,"Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function u(e,t){var i=new o;l(e,function(e,t){switch(e){case"region":for(var r=n.length-1;r>=0;r--)if(n[r].id===t){i.set(e,n[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var s=t.split(","),a=s[0];i.integer(e,a),i.percent(e,a)&&i.set("snapToLines",!1),i.alt(e,a,["auto"]),2===s.length&&i.alt("lineAlign",s[1],["start","center","end"]);break;case"position":s=t.split(","),i.percent(e,s[0]),2===s.length&&i.alt("positionAlign",s[1],["start","center","end"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start","center","end","left","right"]);break}},/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");try{t.line=i.get("line","auto")}catch(e){}t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100);try{t.align=i.get("align","center")}catch(e){t.align=i.get("align","middle")}try{t.position=i.get("position","auto")}catch(e){t.position=i.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},t.align)}t.positionAlign=i.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},t.align)}function c(){e=e.replace(/^\s+/,"")}if(c(),t.startTime=r(),c(),"--\x3e"!==e.substr(0,3))throw new s(s.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),c(),t.endTime=r(),c(),u(e,t)}s.prototype=r(Error.prototype),s.prototype.constructor=s,s.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},o.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t),t>=0&&t<=100))&&(this.set(e,t),!0)}};var c=i.createElement&&i.createElement("textarea"),d={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},h={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},f={v:"title",lang:"lang"},p={rt:"ruby"};function g(e,t){function n(){if(!t)return null;function e(e){return t=t.substr(e.length),e}var n=t.match(/^([^<]*)(<[^>]*>?)?/);return e(n[1]?n[1]:n[2])}function i(e){return c.innerHTML=e,e=c.textContent,c.textContent="",e}function r(e,t){return!p[t.localName]||p[t.localName]===e.localName}function s(t,n){var i=d[t];if(!i)return null;var r=e.document.createElement(i),s=f[t];return s&&n&&(r[s]=n.trim()),r}var o,l=e.document.createElement("div"),u=l,g=[];while(null!==(o=n()))if("<"!==o[0])u.appendChild(e.document.createTextNode(i(o)));else{if("/"===o[1]){g.length&&g[g.length-1]===o.substr(2).replace(">","")&&(g.pop(),u=u.parentNode);continue}var m,v=a(o.substr(1,o.length-2));if(v){m=e.document.createProcessingInstruction("timestamp",v),u.appendChild(m);continue}var y=o.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!y)continue;if(m=s(y[1],y[3]),!m)continue;if(!r(u,m))continue;if(y[2]){var b=y[2].split(".");b.forEach(function(e){var t=/^bg_/.test(e),n=t?e.slice(3):e;if(h.hasOwnProperty(n)){var i=t?"background-color":"color",r=h[n];m.style[i]=r}}),m.className=b.join(" ")}g.push(y[1]),u.appendChild(m),u=m}return l}var m=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function v(e){for(var t=0;t<m.length;t++){var n=m[t];if(e>=n[0]&&e<=n[1])return!0}return!1}function y(e){var t,n=[],i="";if(!e||!e.childNodes)return"ltr";function r(e,t){for(var n=t.childNodes.length-1;n>=0;n--)e.push(t.childNodes[n])}function s(e){if(!e||!e.length)return null;var t=e.pop(),n=t.textContent||t.innerText;if(n){var i=n.match(/^.*(\n|\r)/);return i?(e.length=0,i[0]):n}return"ruby"===t.tagName?s(e):t.childNodes?(r(e,t),s(e)):void 0}r(n,e);while(i=s(n))for(var a=0;a<i.length;a++)if(t=i.charCodeAt(a),v(t))return"rtl";return"ltr"}function b(e){if("number"===typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,n=t.textTrackList,i=0,r=0;r<n.length&&n[r]!==t;r++)"showing"===n[r].mode&&i++;return-1*++i}function _(){}function T(e,t,n){_.call(this),this.cue=t,this.cueDiv=g(e,t.text);var i={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(i,this.cueDiv),this.div=e.document.createElement("div"),i={direction:y(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:n.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(i),this.div.appendChild(this.cueDiv);var r=0;switch(t.positionAlign){case"start":case"line-left":r=t.position;break;case"center":r=t.position-t.size/2;break;case"end":case"line-right":r=t.position-t.size;break}""===t.vertical?this.applyStyles({left:this.formatStyle(r,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(r,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function S(e){var t,n,i,r;if(e.div){n=e.div.offsetHeight,i=e.div.offsetWidth,r=e.div.offsetTop;var s=(s=e.div.childNodes)&&(s=s[0])&&s.getClientRects&&s.getClientRects();e=e.div.getBoundingClientRect(),t=s?Math.max(s[0]&&s[0].height||0,e.height/s.length):0}this.left=e.left,this.right=e.right,this.top=e.top||r,this.height=e.height||n,this.bottom=e.bottom||r+(e.height||n),this.width=e.width||i,this.lineHeight=void 0!==t?t:e.lineHeight}function w(e,t,n,i){function r(e,t){for(var r,s=new S(e),a=1,o=0;o<t.length;o++){while(e.overlapsOppositeAxis(n,t[o])||e.within(n)&&e.overlapsAny(i))e.move(t[o]);if(e.within(n))return e;var l=e.intersectPercentage(n);a>l&&(r=new S(e),a=l),e=new S(s)}return r||s}var s=new S(t),a=t.cue,o=b(a),l=[];if(a.snapToLines){var u;switch(a.vertical){case"":l=["+y","-y"],u="height";break;case"rl":l=["+x","-x"],u="width";break;case"lr":l=["-x","+x"],u="width";break}var c=s.lineHeight,d=c*Math.round(o),h=n[u]+c,f=l[0];Math.abs(d)>h&&(d=d<0?-1:1,d*=Math.ceil(h/c)*c),o<0&&(d+=""===a.vertical?n.height:n.width,l=l.reverse()),s.move(f,d)}else{var p=s.lineHeight/n.height*100;switch(a.lineAlign){case"center":o-=p/2;break;case"end":o-=p;break}switch(a.vertical){case"":t.applyStyles({top:t.formatStyle(o,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(o,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(o,"%")});break}l=["+y","-x","+x","-y"],s=new S(t)}var g=r(s,l);t.move(g.toCSSCompatValues(n))}function E(){}_.prototype.applyStyles=function(e,t){for(var n in t=t||this.div,e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},_.prototype.formatStyle=function(e,t){return 0===e?0:e+t},T.prototype=r(_.prototype),T.prototype.constructor=T,S.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t;break}},S.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},S.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},S.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},S.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},S.prototype.intersectPercentage=function(e){var t=Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left)),n=Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top)),i=t*n;return i/(this.height*this.width)},S.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},S.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,n=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,i=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e;var r={left:e.left,right:e.right,top:e.top||i,height:e.height||t,bottom:e.bottom||i+(e.height||t),width:e.width||n};return r},E.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!==typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},E.convertCueToDOMTree=function(e,t){return e&&t?g(e,t):null};var x=.05,k="sans-serif",A="1.5%";E.processCues=function(e,t,n){if(!e||!t||!n)return null;while(n.firstChild)n.removeChild(n.firstChild);var i=e.document.createElement("div");function r(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}if(i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0",i.style.margin=A,n.appendChild(i),r(t)){var s=[],a=S.getSimpleBoxPosition(i),o=Math.round(a.height*x*100)/100,l={font:o+"px "+k};(function(){for(var n,r,o=0;o<t.length;o++)r=t[o],n=new T(e,r,l),i.appendChild(n.div),w(e,n,a,s),r.displayState=n.div,s.push(S.getSimpleBoxPosition(n))})()}else for(var u=0;u<t.length;u++)i.appendChild(t[u].displayState)},E.Parser=function(e,t,n){n||(n=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=n||new TextDecoder("utf8"),this.regionList=[]},E.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof s))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function n(){var e=t.buffer,n=0;while(n<e.length&&"\r"!==e[n]&&"\n"!==e[n])++n;var i=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),i}function i(e){var n=new o;if(l(e,function(e,t){switch(e){case"id":n.set(e,t);break;case"width":n.percent(e,t);break;case"lines":n.integer(e,t);break;case"regionanchor":case"viewportanchor":var i=t.split(",");if(2!==i.length)break;var r=new o;if(r.percent("x",i[0]),r.percent("y",i[1]),!r.has("x")||!r.has("y"))break;n.set(e+"X",r.get("x")),n.set(e+"Y",r.get("y"));break;case"scroll":n.alt(e,t,["up"]);break}},/=/,/\s/),n.has("id")){var i=new(t.vttjs.VTTRegion||t.window.VTTRegion);i.width=n.get("width",100),i.lines=n.get("lines",3),i.regionAnchorX=n.get("regionanchorX",0),i.regionAnchorY=n.get("regionanchorY",100),i.viewportAnchorX=n.get("viewportanchorX",0),i.viewportAnchorY=n.get("viewportanchorY",100),i.scroll=n.get("scroll",""),t.onregion&&t.onregion(i),t.regionList.push({id:n.get("id"),region:i})}}function r(e){var n=new o;l(e,function(e,t){switch(e){case"MPEGT":n.integer(e+"S",t);break;case"LOCA":n.set(e+"L",a(t));break}},/[^\d]:/,/,/),t.ontimestampmap&&t.ontimestampmap({MPEGTS:n.get("MPEGTS"),LOCAL:n.get("LOCAL")})}function c(e){e.match(/X-TIMESTAMP-MAP/)?l(e,function(e,t){switch(e){case"X-TIMESTAMP-MAP":r(t);break}},/=/):l(e,function(e,t){switch(e){case"Region":i(t);break}},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var d;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;d=n();var h=d.match(/^WEBVTT([ \t].*)?$/);if(!h||!h[0])throw new s(s.Errors.BadSignature);t.state="HEADER"}var f=!1;while(t.buffer){if(!/\r\n|\n/.test(t.buffer))return this;switch(f?f=!1:d=n(),t.state){case"HEADER":/:/.test(d)?c(d):d||(t.state="ID");continue;case"NOTE":d||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(d)){t.state="NOTE";break}if(!d)continue;t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,"");try{t.cue.align="center"}catch(e){t.cue.align="middle"}if(t.state="CUE",-1===d.indexOf("--\x3e")){t.cue.id=d;continue}case"CUE":try{u(d,t.cue,t.regionList)}catch(e){t.reportOrThrowError(e),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var p=-1!==d.indexOf("--\x3e");if(!d||p&&(f=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=d.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":d||(t.state="ID");continue}}}catch(e){t.reportOrThrowError(e),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new s(s.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}},e.exports=E},d136:function(e,t,n){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),t=t.trim(),!t){if(!n.alwaysNormalize)return e;var r=a.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=a.normalizePath(r.path),a.buildURLFromParts(r)}var s=a.parseURL(t);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return n.alwaysNormalize?(s.path=a.normalizePath(s.path),a.buildURLFromParts(s)):t;var o=a.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(u.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+s.path;u.path=a.normalizePath(d)}else u.path=o.path,s.params||(u.params=o.params,s.query||(u.query=o.query));return null===u.path&&(u.path=n.alwaysNormalize?a.normalizePath(s.path):s.path),a.buildURLFromParts(u)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){e=e.split("").reverse().join("").replace(r,"");while(e.length!==(e=e.replace(s,"")).length);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=a})()},d15d:function(e,t,n){var i=n("6d8b"),r=i.createHashMap,s=i.each;function a(e){var t=r();e.eachSeries(function(e){var n=e.get("stack");if(n){var i=t.get(n)||t.set(n,[]),r=e.getData(),s={stackResultDimension:r.getCalculationInfo("stackResultDimension"),stackedOverDimension:r.getCalculationInfo("stackedOverDimension"),stackedDimension:r.getCalculationInfo("stackedDimension"),stackedByDimension:r.getCalculationInfo("stackedByDimension"),isStackedByIndex:r.getCalculationInfo("isStackedByIndex"),data:r,seriesModel:e};if(!s.stackedDimension||!s.isStackedByIndex&&!s.stackedByDimension)return;i.length&&r.setCalculationInfo("stackedOnSeries",i[i.length-1].seriesModel),i.push(s)}}),t.each(o)}function o(e){s(e,function(t,n){var i=[],r=[NaN,NaN],s=[t.stackResultDimension,t.stackedOverDimension],a=t.data,o=t.isStackedByIndex,l=a.map(s,function(s,l,u){var c,d,h=a.get(t.stackedDimension,u);if(isNaN(h))return r;o?d=a.getRawIndex(u):c=a.get(t.stackedByDimension,u);for(var f=NaN,p=n-1;p>=0;p--){var g=e[p];if(o||(d=g.data.rawIndexOf(g.stackedByDimension,c)),d>=0){var m=g.data.getByRawIndex(g.stackResultDimension,d);if(h>=0&&m>0||h<=0&&m<0){h+=m,f=m;break}}}return i[0]=h,i[1]=f,i});a.hostModel.setData(l),t.data=l})}e.exports=a},d28f:function(e,t,n){var i=n("3eba");n("84d5"),n("4650"),n("5e97");var r=n("903c"),s=n("6cb7");i.registerProcessor(r),s.registerSubTypeDefaulter("legend",function(){return"plain"})},d2c8:function(e,t,n){var i=n("aae3"),r=n("be13");e.exports=function(e,t,n){if(i(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(r(e))}},d2cf:function(e,t,n){var i=n("6d8b"),r=n("401b"),s=n("cb6d"),a=n("1fab"),o="silent";function l(e,t,n){return{type:e,event:n,target:t.target,topTarget:t.topTarget,cancelBubble:!1,offsetX:n.zrX,offsetY:n.zrY,gestureEvent:n.gestureEvent,pinchX:n.pinchX,pinchY:n.pinchY,pinchScale:n.pinchScale,wheelDelta:n.zrDelta,zrByTouch:n.zrByTouch,which:n.which}}function u(){}u.prototype.dispose=function(){};var c=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],d=function(e,t,n,i){a.call(this),this.storage=e,this.painter=t,this.painterRoot=i,n=n||new u,this.proxy=null,this._hovered={},this._lastTouchMoment,this._lastX,this._lastY,s.call(this),this.setHandlerProxy(n)};function h(e,t,n){if(e[e.rectHover?"rectContain":"contain"](t,n)){var i,r=e;while(r){if(r.clipPath&&!r.clipPath.contain(t,n))return!1;r.silent&&(i=!0),r=r.parent}return!i||o}return!1}d.prototype={constructor:d,setHandlerProxy:function(e){this.proxy&&this.proxy.dispose(),e&&(i.each(c,function(t){e.on&&e.on(t,this[t],this)},this),e.handler=this),this.proxy=e},mousemove:function(e){var t=e.zrX,n=e.zrY,i=this._hovered,r=i.target;r&&!r.__zr&&(i=this.findHover(i.x,i.y),r=i.target);var s=this._hovered=this.findHover(t,n),a=s.target,o=this.proxy;o.setCursor&&o.setCursor(a?a.cursor:"default"),r&&a!==r&&this.dispatchToElement(i,"mouseout",e),this.dispatchToElement(s,"mousemove",e),a&&a!==r&&this.dispatchToElement(s,"mouseover",e)},mouseout:function(e){this.dispatchToElement(this._hovered,"mouseout",e);var t,n=e.toElement||e.relatedTarget;do{n=n&&n.parentNode}while(n&&9!=n.nodeType&&!(t=n===this.painterRoot));!t&&this.trigger("globalout",{event:e})},resize:function(e){this._hovered={}},dispatch:function(e,t){var n=this[e];n&&n.call(this,t)},dispose:function(){this.proxy.dispose(),this.storage=this.proxy=this.painter=null},setCursorStyle:function(e){var t=this.proxy;t.setCursor&&t.setCursor(e)},dispatchToElement:function(e,t,n){e=e||{};var i=e.target;if(!i||!i.silent){var r="on"+t,s=l(t,e,n);while(i)if(i[r]&&(s.cancelBubble=i[r].call(i,s)),i.trigger(t,s),i=i.parent,s.cancelBubble)break;s.cancelBubble||(this.trigger(t,s),this.painter&&this.painter.eachOtherLayer(function(e){"function"==typeof e[r]&&e[r].call(e,s),e.trigger&&e.trigger(t,s)}))}},findHover:function(e,t,n){for(var i=this.storage.getDisplayList(),r={x:e,y:t},s=i.length-1;s>=0;s--){var a;if(i[s]!==n&&!i[s].ignore&&(a=h(i[s],e,t))&&(!r.topTarget&&(r.topTarget=i[s]),a!==o)){r.target=i[s];break}}return r}},i.each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(e){d.prototype[e]=function(t){var n=this.findHover(t.zrX,t.zrY),i=n.target;if("mousedown"===e)this._downEl=i,this._downPoint=[t.zrX,t.zrY],this._upEl=i;else if("mouseup"===e)this._upEl=i;else if("click"===e){if(this._downEl!==this._upEl||!this._downPoint||r.dist(this._downPoint,[t.zrX,t.zrY])>4)return;this._downPoint=null}this.dispatchToElement(n,e,t)}}),i.mixin(d,a),i.mixin(d,s);var f=d;e.exports=f},d3a0:function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("29a8"),a=n("2145"),o=s.toolbox.magicType;function l(e){this.model=e}l.defaultOption={show:!0,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z",tiled:"M2.3,2.2h22.8V25H2.3V2.2z M35,2.2h22.8V25H35V2.2zM2.3,35h22.8v22.8H2.3V35z M35,35h22.8v22.8H35V35z"},title:r.clone(o.title),option:{},seriesIndex:{}};var u=l.prototype;u.getIcons=function(){var e=this.model,t=e.get("icon"),n={};return r.each(e.get("type"),function(e){t[e]&&(n[e]=t[e])}),n};var c={line:function(e,t,n,i){if("bar"===e)return r.merge({id:t,type:"line",data:n.get("data"),stack:n.get("stack"),markPoint:n.get("markPoint"),markLine:n.get("markLine")},i.get("option.line")||{},!0)},bar:function(e,t,n,i){if("line"===e)return r.merge({id:t,type:"bar",data:n.get("data"),stack:n.get("stack"),markPoint:n.get("markPoint"),markLine:n.get("markLine")},i.get("option.bar")||{},!0)},stack:function(e,t,n,i){if("line"===e||"bar"===e)return r.merge({id:t,stack:"__ec_magicType_stack__"},i.get("option.stack")||{},!0)},tiled:function(e,t,n,i){if("line"===e||"bar"===e)return r.merge({id:t,stack:""},i.get("option.tiled")||{},!0)}},d=[["line","bar"],["stack","tiled"]];u.onclick=function(e,t,n){var i=this.model,s=i.get("seriesIndex."+n);if(c[n]){var a={series:[]},o=function(t){var s=t.subType,o=t.id,l=c[n](s,o,t,i);l&&(r.defaults(l,t.option),a.series.push(l));var u=t.coordinateSystem;if(u&&"cartesian2d"===u.type&&("line"===n||"bar"===n)){var d=u.getAxesByScale("ordinal")[0];if(d){var h=d.dim,f=h+"Axis",p=e.queryComponents({mainType:f,index:t.get(name+"Index"),id:t.get(name+"Id")})[0],g=p.componentIndex;a[f]=a[f]||[];for(var m=0;m<=g;m++)a[f][g]=a[f][g]||{};a[f][g].boundaryGap="bar"===n}}};r.each(d,function(e){r.indexOf(e,n)>=0&&r.each(e,function(e){i.setIconStatus(e,"normal")})}),i.setIconStatus(n,"emphasis"),e.eachComponent({mainType:"series",query:null==s?null:{seriesIndex:s}},o),t.dispatchAction({type:"changeMagicType",currentType:n,newOption:a})}},i.registerAction({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},function(e,t){t.mergeOption(e.newOption)}),a.register("magicType",l);var h=l;e.exports=h},d3f4:function(e,t){e.exports=function(e){return"object"===typeof e?null!==e:"function"===typeof e}},d498:function(e,t,n){var i=n("cbe5"),r=n("4fac"),s=i.extend({type:"polyline",shape:{points:null,smooth:!1,smoothConstraint:null},style:{stroke:"#000",fill:null},buildPath:function(e,t){r.buildPath(e,t,!1)}});e.exports=s},d4b1:function(e,t,n){var i=n("3eba"),r=n("17d6"),s=i.extendComponentView({type:"axisPointer",render:function(e,t,n){var i=t.getComponent("tooltip"),s=e.get("triggerOn")||i&&i.get("triggerOn")||"mousemove|click";r.register("axisPointer",n,function(e,t,n){"none"!==s&&("leave"===e||s.indexOf(e)>=0)&&n({type:"updateAxisPointer",currTrigger:e,x:t&&t.offsetX,y:t&&t.offsetY})})},remove:function(e,t){r.unregister(t.getZr(),"axisPointer"),s.superApply(this._model,"remove",arguments)},dispose:function(e,t){r.unregister("axisPointer",t),s.superApply(this._model,"dispose",arguments)}}),a=s;e.exports=a},d4c6:function(e,t,n){var i=n("cbe5"),r=i.extend({type:"compound",shape:{paths:null},_updatePathDirty:function(){for(var e=this.__dirtyPath,t=this.shape.paths,n=0;n<t.length;n++)e=e||t[n].__dirtyPath;this.__dirtyPath=e,this.__dirty=this.__dirty||e},beforeBrush:function(){this._updatePathDirty();for(var e=this.shape.paths||[],t=this.getGlobalScale(),n=0;n<e.length;n++)e[n].path||e[n].createPathProxy(),e[n].path.setScale(t[0],t[1])},buildPath:function(e,t){for(var n=t.paths||[],i=0;i<n.length;i++)n[i].buildPath(e,n[i].shape,!0)},afterBrush:function(){for(var e=this.shape.paths||[],t=0;t<e.length;t++)e[t].__dirtyPath=!1},getBoundingRect:function(){return this._updatePathDirty(),i.prototype.getBoundingRect.call(this)}});e.exports=r},d4d1:function(e,t,n){var i=n("cbe5"),r=n("401b"),s=n("897a"),a=r.min,o=r.max,l=r.scaleAndAdd,u=r.copy,c=[],d=[],h=[];function f(e){return isNaN(e[0])||isNaN(e[1])}function p(e,t,n,i,r,s,a,o,l,u,c){return"none"!==u&&u?g.apply(this,arguments):m.apply(this,arguments)}function g(e,t,n,i,r,s,a,o,l,c,p){for(var g=0,m=n,v=0;v<i;v++){var y=t[m];if(m>=r||m<0)break;if(f(y)){if(p){m+=s;continue}break}if(m===n)e[s>0?"moveTo":"lineTo"](y[0],y[1]);else if(l>0){var b=t[g],_="y"===c?1:0,T=(y[_]-b[_])*l;u(d,b),d[_]=b[_]+T,u(h,y),h[_]=y[_]-T,e.bezierCurveTo(d[0],d[1],h[0],h[1],y[0],y[1])}else e.lineTo(y[0],y[1]);g=m,m+=s}return v}function m(e,t,n,i,s,p,g,m,v,y,b){for(var _=0,T=n,S=0;S<i;S++){var w=t[T];if(T>=s||T<0)break;if(f(w)){if(b){T+=p;continue}break}if(T===n)e[p>0?"moveTo":"lineTo"](w[0],w[1]),u(d,w);else if(v>0){var E=T+p,x=t[E];if(b)while(x&&f(t[E]))E+=p,x=t[E];var k=.5,A=t[_];x=t[E];if(!x||f(x))u(h,w);else{var I,C;if(f(x)&&!b&&(x=w),r.sub(c,x,A),"x"===y||"y"===y){var D="x"===y?0:1;I=Math.abs(w[D]-A[D]),C=Math.abs(w[D]-x[D])}else I=r.dist(w,A),C=r.dist(w,x);k=C/(C+I),l(h,w,c,-v*(1-k))}a(d,d,m),o(d,d,g),a(h,h,m),o(h,h,g),e.bezierCurveTo(d[0],d[1],h[0],h[1],w[0],w[1]),l(d,w,c,v*k)}else e.lineTo(w[0],w[1]);_=T,T+=p}return S}function v(e,t){var n=[1/0,1/0],i=[-1/0,-1/0];if(t)for(var r=0;r<e.length;r++){var s=e[r];s[0]<n[0]&&(n[0]=s[0]),s[1]<n[1]&&(n[1]=s[1]),s[0]>i[0]&&(i[0]=s[0]),s[1]>i[1]&&(i[1]=s[1])}return{min:t?n:i,max:t?i:n}}var y=i.extend({type:"ec-polyline",shape:{points:[],smooth:0,smoothConstraint:!0,smoothMonotone:null,connectNulls:!1},style:{fill:null,stroke:"#000"},brush:s(i.prototype.brush),buildPath:function(e,t){var n=t.points,i=0,r=n.length,s=v(n,t.smoothConstraint);if(t.connectNulls){for(;r>0;r--)if(!f(n[r-1]))break;for(;i<r;i++)if(!f(n[i]))break}while(i<r)i+=p(e,n,i,r,r,1,s.min,s.max,t.smooth,t.smoothMonotone,t.connectNulls)+1}}),b=i.extend({type:"ec-polygon",shape:{points:[],stackedOnPoints:[],smooth:0,stackedOnSmooth:0,smoothConstraint:!0,smoothMonotone:null,connectNulls:!1},brush:s(i.prototype.brush),buildPath:function(e,t){var n=t.points,i=t.stackedOnPoints,r=0,s=n.length,a=t.smoothMonotone,o=v(n,t.smoothConstraint),l=v(i,t.smoothConstraint);if(t.connectNulls){for(;s>0;s--)if(!f(n[s-1]))break;for(;r<s;r++)if(!f(n[r]))break}while(r<s){var u=p(e,n,r,s,s,1,o.min,o.max,t.smooth,a,t.connectNulls);p(e,i,r+u-1,u,s,-1,l.min,l.max,t.stackedOnSmooth,a,t.connectNulls),r+=u+1,e.closePath()}}});t.Polyline=y,t.Polygon=b},d51b:function(e,t){var n=function(){this.head=null,this.tail=null,this._len=0},i=n.prototype;i.insert=function(e){var t=new r(e);return this.insertEntry(t),t},i.insertEntry=function(e){this.head?(this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e):this.head=this.tail=e,this._len++},i.remove=function(e){var t=e.prev,n=e.next;t?t.next=n:this.head=n,n?n.prev=t:this.tail=t,e.next=e.prev=null,this._len--},i.len=function(){return this._len},i.clear=function(){this.head=this.tail=null,this._len=0};var r=function(e){this.value=e,this.next,this.prev},s=function(e){this._list=new n,this._map={},this._maxSize=e||10,this._lastRemovedEntry=null},a=s.prototype;a.put=function(e,t){var n=this._list,i=this._map,s=null;if(null==i[e]){var a=n.len(),o=this._lastRemovedEntry;if(a>=this._maxSize&&a>0){var l=n.head;n.remove(l),delete i[l.key],s=l.value,this._lastRemovedEntry=l}o?o.value=t:o=new r(t),o.key=e,n.insertEntry(o),i[e]=o}return s},a.get=function(e){var t=this._map[e],n=this._list;if(null!=t)return t!==n.tail&&(n.remove(t),n.insertEntry(t)),t.value},a.clear=function(){this._list.clear(),this._map={}};var o=s;e.exports=o},d53b:function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},d5b7:function(e,t,n){var i=n("de00"),r=n("1fab"),s=n("0cde"),a=n("bd6b"),o=n("6d8b"),l=function(e){s.call(this,e),r.call(this,e),a.call(this,e),this.id=e.id||i()};l.prototype={type:"element",name:"",__zr:null,ignore:!1,clipPath:null,isGroup:!1,drift:function(e,t){switch(this.draggable){case"horizontal":t=0;break;case"vertical":e=0;break}var n=this.transform;n||(n=this.transform=[1,0,0,1,0,0]),n[4]+=e,n[5]+=t,this.decomposeTransform(),this.dirty(!1)},beforeUpdate:function(){},afterUpdate:function(){},update:function(){this.updateTransform()},traverse:function(e,t){},attrKV:function(e,t){if("position"===e||"scale"===e||"origin"===e){if(t){var n=this[e];n||(n=this[e]=[]),n[0]=t[0],n[1]=t[1]}}else this[e]=t},hide:function(){this.ignore=!0,this.__zr&&this.__zr.refresh()},show:function(){this.ignore=!1,this.__zr&&this.__zr.refresh()},attr:function(e,t){if("string"===typeof e)this.attrKV(e,t);else if(o.isObject(e))for(var n in e)e.hasOwnProperty(n)&&this.attrKV(n,e[n]);return this.dirty(!1),this},setClipPath:function(e){var t=this.__zr;t&&e.addSelfToZr(t),this.clipPath&&this.clipPath!==e&&this.removeClipPath(),this.clipPath=e,e.__zr=t,e.__clipTarget=this,this.dirty(!1)},removeClipPath:function(){var e=this.clipPath;e&&(e.__zr&&e.removeSelfFromZr(e.__zr),e.__zr=null,e.__clipTarget=null,this.clipPath=null,this.dirty(!1))},addSelfToZr:function(e){this.__zr=e;var t=this.animators;if(t)for(var n=0;n<t.length;n++)e.animation.addAnimator(t[n]);this.clipPath&&this.clipPath.addSelfToZr(e)},removeSelfFromZr:function(e){this.__zr=null;var t=this.animators;if(t)for(var n=0;n<t.length;n++)e.animation.removeAnimator(t[n]);this.clipPath&&this.clipPath.removeSelfFromZr(e)}},o.mixin(l,a),o.mixin(l,s),o.mixin(l,r);var u=l;e.exports=u},d708:function(e,t,n){"use strict";var i=n("01e1");const r="undefined"===typeof window&&!i["a"];t["a"]=r},d749:function(e,t,n){"use strict";var i=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),r=n("7102"),s=n.n(r),a=n("ffdf");n.d(t,"a",function(){return v});
/*! @name m3u8-parser @version 7.2.0 @license Apache-2.0 */
class o extends i{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const l=String.fromCharCode(9),u=function(e){const t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),n={};return t[1]&&(n.length=parseInt(t[1],10)),t[2]&&(n.offset=parseInt(t[2],10)),n},c=function(){const e="[^=]*",t='"[^"]*"|[^,]*',n="(?:"+e+")=(?:"+t+")";return new RegExp("(?:^|,)("+n+")")},d=function(e){const t={};if(!e)return t;const n=e.split(c());let i,r=n.length;while(r--)""!==n[r]&&(i=/([^=]*)=(.*)/.exec(n[r]).slice(1),i[0]=i[0].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^['"](.*)['"]$/g,"$1"),t[i[0]]=i[1]);return t},h=e=>{const t=e.split("x"),n={};return t[0]&&(n.width=parseInt(t[0],10)),t[1]&&(n.height=parseInt(t[1],10)),n};class f extends i{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,n;if(e=e.trim(),0===e.length)return;if("#"!==e[0])return void this.trigger("data",{type:"uri",uri:e});const i=this.tagMappers.reduce((t,n)=>{const i=n(e);return i===e?t:t.concat([i])},[e]);i.forEach(e=>{for(let t=0;t<this.customParsers.length;t++)if(this.customParsers[t].call(this,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e),t)this.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(e),t)return n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),void this.trigger("data",n);if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),void this.trigger("data",n);if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(e),t)return n=s()(u(t[1]),{type:"tag",tagType:"byterange"}),void this.trigger("data",n);if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(e),t)return n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-MAP:(.*)$/.exec(e),t){if(n={type:"tag",tagType:"map"},t[1]){const e=d(t[1]);e.URI&&(n.uri=e.URI),e.BYTERANGE&&(n.byterange=u(e.BYTERANGE))}this.trigger("data",n)}else{if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(e),t)return n={type:"tag",tagType:"stream-inf"},t[1]&&(n.attributes=d(t[1]),n.attributes.RESOLUTION&&(n.attributes.RESOLUTION=h(n.attributes.RESOLUTION)),n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))),void this.trigger("data",n);if(t=/^#EXT-X-MEDIA:(.*)$/.exec(e),t)return n={type:"tag",tagType:"media"},t[1]&&(n.attributes=d(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-ENDLIST/.exec(e),t)this.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(e),t)return n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-KEY:(.*)$/.exec(e),t)return n={type:"tag",tagType:"key"},t[1]&&(n.attributes=d(t[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void this.trigger("data",n);if(t=/^#EXT-X-START:(.*)$/.exec(e),t)return n={type:"tag",tagType:"start"},t[1]&&(n.attributes=d(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out-cont"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-in"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-SKIP:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"skip"},n.attributes=d(t[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(l)),void this.trigger("data",n);if(t=/^#EXT-X-PART:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part"},n.attributes=d(t[1]),["DURATION"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),["INDEPENDENT","GAP"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))}),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=u(n.attributes.BYTERANGE)),void this.trigger("data",n);if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"server-control"},n.attributes=d(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))}),void this.trigger("data",n);if(t=/^#EXT-X-PART-INF:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part-inf"},n.attributes=d(t[1]),["PART-TARGET"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),void this.trigger("data",n);if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"preload-hint"},n.attributes=d(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(e){if(n.attributes.hasOwnProperty(e)){n.attributes[e]=parseInt(n.attributes[e],10);const t="BYTERANGE-LENGTH"===e?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[t]=n.attributes[e],delete n.attributes[e]}}),void this.trigger("data",n);if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"rendition-report"},n.attributes=d(t[1]),["LAST-MSN","LAST-PART"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseInt(n.attributes[e],10))}),void this.trigger("data",n);if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(e),t&&t[1]){n={type:"tag",tagType:"daterange"},n.attributes=d(t[1]),["ID","CLASS"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=String(n.attributes[e]))}),["START-DATE","END-DATE"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=new Date(n.attributes[e]))}),["DURATION","PLANNED-DURATION"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))}),["END-ON-NEXT"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/i.test(n.attributes[e]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=n.attributes[e].toString(16))});const e=/^X-([A-Z]+-)+[A-Z]+$/;for(const t in n.attributes){if(!e.test(t))continue;const i=/[0-9A-Fa-f]{6}/g.test(n.attributes[t]),r=/^\d+(\.\d+)?$/.test(n.attributes[t]);n.attributes[t]=i?n.attributes[t].toString(16):r?parseFloat(n.attributes[t]):String(n.attributes[t])}this.trigger("data",n)}else if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(e),t)this.trigger("data",{type:"tag",tagType:"independent-segments"});else if(t=/^#EXT-X-I-FRAMES-ONLY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"i-frames-only"});else{if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(e),t)return n={type:"tag",tagType:"content-steering"},n.attributes=d(t[1]),void this.trigger("data",n);if(t=/^#EXT-X-I-FRAME-STREAM-INF:(.*)$/.exec(e),t)return n={type:"tag",tagType:"i-frame-playlist"},n.attributes=d(t[1]),n.attributes.URI&&(n.uri=n.attributes.URI),n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes.RESOLUTION&&(n.attributes.RESOLUTION=h(n.attributes.RESOLUTION)),n.attributes["AVERAGE-BANDWIDTH"]&&(n.attributes["AVERAGE-BANDWIDTH"]=parseInt(n.attributes["AVERAGE-BANDWIDTH"],10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),void this.trigger("data",n);if(t=/^#EXT-X-DEFINE:(.*)$/.exec(e),t)return n={type:"tag",tagType:"define"},n.attributes=d(t[1]),void this.trigger("data",n);this.trigger("data",{type:"tag",data:e.slice(4)})}}}}else this.trigger("data",{type:"comment",text:e.slice(1)})})}addParser({expression:e,customType:t,dataParser:n,segment:i}){"function"!==typeof n&&(n=(e=>e)),this.customParsers.push(r=>{const s=e.exec(r);if(s)return this.trigger("data",{type:"custom",data:n(r),customType:t,segment:i}),!0})}addTagMapper({expression:e,map:t}){const n=n=>{return e.test(n)?t(n):n};this.tagMappers.push(n)}}const p=e=>e.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()),g=function(e){const t={};return Object.keys(e).forEach(function(n){t[p(n)]=e[n]}),t},m=function(e){const{serverControl:t,targetDuration:n,partTargetDuration:i}=e;if(!t)return;const r="#EXT-X-SERVER-CONTROL",s="holdBack",a="partHoldBack",o=n&&3*n,l=i&&2*i;n&&!t.hasOwnProperty(s)&&(t[s]=o,this.trigger("info",{message:`${r} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&t[s]<o&&(this.trigger("warn",{message:`${r} clamping HOLD-BACK (${t[s]}) to targetDuration * 3 (${o})`}),t[s]=o),i&&!t.hasOwnProperty(a)&&(t[a]=3*i,this.trigger("info",{message:`${r} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${t[a]}).`})),i&&t[a]<l&&(this.trigger("warn",{message:`${r} clamping PART-HOLD-BACK (${t[a]}) to partTargetDuration * 2 (${l}).`}),t[a]=l)};class v extends i{constructor(e={}){super(),this.lineStream=new o,this.parseStream=new f,this.lineStream.pipe(this.parseStream),this.mainDefinitions=e.mainDefinitions||{},this.params=new URL(e.uri,"https://a.com").searchParams,this.lastProgramDateTime=null;const t=this,n=[];let i,r,l={},u=!1;const c=function(){},d={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},h="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";let p=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],iFramePlaylists:[],segments:[]};let v=0,y=0;const b={};this.on("end",()=>{l.uri||!l.parts&&!l.preloadHints||(!l.map&&i&&(l.map=i),!l.key&&r&&(l.key=r),l.timeline||"number"!==typeof p||(l.timeline=p),this.manifest.preloadSegment=l)}),this.parseStream.on("data",function(e){let o,f;if(t.manifest.definitions)for(const n in t.manifest.definitions)if(e.uri&&(e.uri=e.uri.replace(`{$${n}}`,t.manifest.definitions[n])),e.attributes)for(const i in e.attributes)"string"===typeof e.attributes[i]&&(e.attributes[i]=e.attributes[i].replace(`{$${n}}`,t.manifest.definitions[n]));({tag(){(({version(){e.version&&(this.manifest.version=e.version)},"allow-cache"(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const t={};"length"in e&&(l.byterange=t,t.length=e.length,"offset"in e||(e.offset=v)),"offset"in e&&(l.byterange=t,t.offset=e.offset),v=t.offset+t.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),e.title&&(l.title=e.title),e.duration>0&&(l.duration=e.duration),0===e.duration&&(l.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=n},key(){if(e.attributes)if("NONE"!==e.attributes.METHOD)if(e.attributes.URI){if("com.apple.streamingkeydelivery"===e.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:e.attributes});if("com.microsoft.playready"===e.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:e.attributes.URI});if(e.attributes.KEYFORMAT===h){const t=["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"];return-1===t.indexOf(e.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===e.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==e.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):e.attributes.KEYID&&"0x"===e.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:e.attributes.KEYFORMAT,keyId:e.attributes.KEYID.substring(2)},pssh:Object(a["a"])(e.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},"undefined"!==typeof e.attributes.IV&&(r.iv=e.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else r=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence"(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence"(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,p=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type"(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map(){i={},e.uri&&(i.uri=e.uri),e.byterange&&(i.byterange=e.byterange),r&&(i.key=r)},"stream-inf"(){this.manifest.playlists=n,this.manifest.mediaGroups=this.manifest.mediaGroups||d,e.attributes?(l.attributes||(l.attributes={}),s()(l.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||d,!(e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});const t=this.manifest.mediaGroups[e.attributes.TYPE];t[e.attributes["GROUP-ID"]]=t[e.attributes["GROUP-ID"]]||{},o=t[e.attributes["GROUP-ID"]],f={default:/yes/i.test(e.attributes.DEFAULT)},f.default?f.autoselect=!0:f.autoselect=/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(f.language=e.attributes.LANGUAGE),e.attributes.URI&&(f.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(f.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(f.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(f.forced=/yes/i.test(e.attributes.FORCED)),o[e.attributes.NAME]=f},discontinuity(){p+=1,l.discontinuity=!0,this.manifest.discontinuityStarts.push(n.length)},"program-date-time"(){"undefined"===typeof this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),l.dateTimeString=e.dateTimeString,l.dateTimeObject=e.dateTimeObject;const{lastProgramDateTime:t}=this;this.lastProgramDateTime=new Date(e.dateTimeString).getTime(),null===t&&this.manifest.segments.reduceRight((e,t)=>{return t.programDateTime=e-1e3*t.duration,t.programDateTime},this.lastProgramDateTime)},targetduration(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):(this.manifest.targetDuration=e.duration,m.call(this,this.manifest))},start(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out"(){l.cueOut=e.data},"cue-out-cont"(){l.cueOutCont=e.data},"cue-in"(){l.cueIn=e.data},skip(){this.manifest.skip=g(e.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",e.attributes,["SKIPPED-SEGMENTS"])},part(){u=!0;const t=this.manifest.segments.length,n=g(e.attributes);l.parts=l.parts||[],l.parts.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=y),y=n.byterange.offset+n.byterange.length);const i=l.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${i} for segment #${t}`,e.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((e,t)=>{e.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${t} lacks required attribute(s): LAST-PART`})})},"server-control"(){const t=this.manifest.serverControl=g(e.attributes);t.hasOwnProperty("canBlockReload")||(t.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),m.call(this,this.manifest),t.canSkipDateranges&&!t.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const t=this.manifest.segments.length,n=g(e.attributes),i=n.type&&"PART"===n.type;l.preloadHints=l.preloadHints||[],l.preloadHints.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=i?y:0,i&&(y=n.byterange.offset+n.byterange.length)));const r=l.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${r} for segment #${t}`,e.attributes,["TYPE","URI"]),n.type)for(let e=0;e<l.preloadHints.length-1;e++){const i=l.preloadHints[e];i.type&&(i.type===n.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${r} for segment #${t} has the same TYPE ${n.type} as preload hint #${e}`}))}},"rendition-report"(){const t=g(e.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(t);const n=this.manifest.renditionReports.length-1,i=["LAST-MSN","URI"];u&&i.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${n}`,e.attributes,i)},"part-inf"(){this.manifest.partInf=g(e.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",e.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),m.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(g(e.attributes));const t=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${t}`,e.attributes,["ID","START-DATE"]);const n=this.manifest.dateRanges[t];n.endDate&&n.startDate&&new Date(n.endDate)<new Date(n.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),n.duration&&n.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),n.plannedDuration&&n.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const i=!!n.endOnNext;if(i&&!n.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),i&&(n.duration||n.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),n.duration&&n.endDate){const e=n.startDate,i=e.getTime()+1e3*n.duration;this.manifest.dateRanges[t].endDate=new Date(i)}if(b[n.id]){for(const t in b[n.id])if(n[t]&&JSON.stringify(b[n.id][t])!==JSON.stringify(n[t])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const e=this.manifest.dateRanges.findIndex(e=>e.id===n.id);this.manifest.dateRanges[e]=s()(this.manifest.dateRanges[e],n),b[n.id]=s()(b[n.id],n),this.manifest.dateRanges.pop()}else b[n.id]=n},"independent-segments"(){this.manifest.independentSegments=!0},"i-frames-only"(){this.manifest.iFramesOnly=!0,this.requiredCompatibilityversion(this.manifest.version,4)},"content-steering"(){this.manifest.contentSteering=g(e.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",e.attributes,["SERVER-URI"])},define(){this.manifest.definitions=this.manifest.definitions||{};const t=(e,t)=>{e in this.manifest.definitions?this.trigger("error",{message:`EXT-X-DEFINE: Duplicate name ${e}`}):this.manifest.definitions[e]=t};if("QUERYPARAM"in e.attributes){if("NAME"in e.attributes||"IMPORT"in e.attributes)return void this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});const n=this.params.get(e.attributes.QUERYPARAM);return n?void t(e.attributes.QUERYPARAM,decodeURIComponent(n)):void this.trigger("error",{message:`EXT-X-DEFINE: No query param ${e.attributes.QUERYPARAM}`})}return"NAME"in e.attributes?"IMPORT"in e.attributes?void this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"}):"VALUE"in e.attributes&&"string"===typeof e.attributes.VALUE?void t(e.attributes.NAME,e.attributes.VALUE):void this.trigger("error",{message:`EXT-X-DEFINE: No value for ${e.attributes.NAME}`}):"IMPORT"in e.attributes?this.mainDefinitions[e.attributes.IMPORT]?void t(e.attributes.IMPORT,this.mainDefinitions[e.attributes.IMPORT]):void this.trigger("error",{message:`EXT-X-DEFINE: No value ${e.attributes.IMPORT} to import, or IMPORT used on main playlist`}):void this.trigger("error",{message:"EXT-X-DEFINE: No attribute"})},"i-frame-playlist"(){this.manifest.iFramePlaylists.push({attributes:e.attributes,uri:e.uri,timeline:p}),this.warnOnMissingAttributes_("#EXT-X-I-FRAME-STREAM-INF",e.attributes,["BANDWIDTH","URI"])}})[e.tagType]||c).call(t)},uri(){l.uri=e.uri,n.push(l),!this.manifest.targetDuration||"duration"in l||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),l.duration=this.manifest.targetDuration),r&&(l.key=r),l.timeline=p,i&&(l.map=i),y=0,null!==this.lastProgramDateTime&&(l.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=1e3*l.duration),l={}},comment(){},custom(){e.segment?(l.custom=l.custom||{},l.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(t)})}requiredCompatibilityversion(e,t){(e<t||!e)&&this.trigger("warn",{message:`manifest must be at least version ${t}`})}warnOnMissingAttributes_(e,t,n){const i=[];n.forEach(function(e){t.hasOwnProperty(e)||i.push(e)}),i.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${i.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push("\n"),this.manifest.dateRanges.length&&null===this.lastProgramDateTime&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}},d833:function(e,t,n){var i=n("20c8"),r=n("9680"),s=n("e7d2"),a=n("68ab"),o=n("9f51"),l=n("857d"),u=l.normalizeRadian,c=n("4a3f"),d=n("8728"),h=i.CMD,f=2*Math.PI,p=1e-4;function g(e,t){return Math.abs(e-t)<p}var m=[-1,-1,-1],v=[-1,-1];function y(){var e=v[0];v[0]=v[1],v[1]=e}function b(e,t,n,i,r,s,a,o,l,u){if(u>t&&u>i&&u>s&&u>o||u<t&&u<i&&u<s&&u<o)return 0;var d=c.cubicRootAt(t,i,s,o,u,m);if(0===d)return 0;for(var h,f,p=0,g=-1,b=0;b<d;b++){var _=m[b],T=0===_||1===_?.5:1,S=c.cubicAt(e,n,r,a,_);S<l||(g<0&&(g=c.cubicExtrema(t,i,s,o,v),v[1]<v[0]&&g>1&&y(),h=c.cubicAt(t,i,s,o,v[0]),g>1&&(f=c.cubicAt(t,i,s,o,v[1]))),2==g?_<v[0]?p+=h<t?T:-T:_<v[1]?p+=f<h?T:-T:p+=o<f?T:-T:_<v[0]?p+=h<t?T:-T:p+=o<h?T:-T)}return p}function _(e,t,n,i,r,s,a,o){if(o>t&&o>i&&o>s||o<t&&o<i&&o<s)return 0;var l=c.quadraticRootAt(t,i,s,o,m);if(0===l)return 0;var u=c.quadraticExtremum(t,i,s);if(u>=0&&u<=1){for(var d=0,h=c.quadraticAt(t,i,s,u),f=0;f<l;f++){var p=0===m[f]||1===m[f]?.5:1,g=c.quadraticAt(e,n,r,m[f]);g<a||(m[f]<u?d+=h<t?p:-p:d+=s<h?p:-p)}return d}p=0===m[0]||1===m[0]?.5:1,g=c.quadraticAt(e,n,r,m[0]);return g<a?0:s<t?p:-p}function T(e,t,n,i,r,s,a,o){if(o-=t,o>n||o<-n)return 0;var l=Math.sqrt(n*n-o*o);m[0]=-l,m[1]=l;var c=Math.abs(i-r);if(c<1e-4)return 0;if(c%f<1e-4){i=0,r=f;var d=s?1:-1;return a>=m[0]+e&&a<=m[1]+e?d:0}if(s){l=i;i=u(r),r=u(l)}else i=u(i),r=u(r);i>r&&(r+=f);for(var h=0,p=0;p<2;p++){var g=m[p];if(g+e>a){var v=Math.atan2(o,g);d=s?1:-1;v<0&&(v=f+v),(v>=i&&v<=r||v+f>=i&&v+f<=r)&&(v>Math.PI/2&&v<1.5*Math.PI&&(d=-d),h+=d)}}return h}function S(e,t,n,i,l){for(var u=0,c=0,f=0,p=0,m=0,v=0;v<e.length;){var y=e[v++];switch(y===h.M&&v>1&&(n||(u+=d(c,f,p,m,i,l))),1==v&&(c=e[v],f=e[v+1],p=c,m=f),y){case h.M:p=e[v++],m=e[v++],c=p,f=m;break;case h.L:if(n){if(r.containStroke(c,f,e[v],e[v+1],t,i,l))return!0}else u+=d(c,f,e[v],e[v+1],i,l)||0;c=e[v++],f=e[v++];break;case h.C:if(n){if(s.containStroke(c,f,e[v++],e[v++],e[v++],e[v++],e[v],e[v+1],t,i,l))return!0}else u+=b(c,f,e[v++],e[v++],e[v++],e[v++],e[v],e[v+1],i,l)||0;c=e[v++],f=e[v++];break;case h.Q:if(n){if(a.containStroke(c,f,e[v++],e[v++],e[v],e[v+1],t,i,l))return!0}else u+=_(c,f,e[v++],e[v++],e[v],e[v+1],i,l)||0;c=e[v++],f=e[v++];break;case h.A:var S=e[v++],w=e[v++],E=e[v++],x=e[v++],k=e[v++],A=e[v++],I=(e[v++],1-e[v++]),C=Math.cos(k)*E+S,D=Math.sin(k)*x+w;v>1?u+=d(c,f,C,D,i,l):(p=C,m=D);var R=(i-S)*x/E+S;if(n){if(o.containStroke(S,w,x,k,k+A,I,t,R,l))return!0}else u+=T(S,w,x,k,k+A,I,R,l);c=Math.cos(k+A)*E+S,f=Math.sin(k+A)*x+w;break;case h.R:p=c=e[v++],m=f=e[v++];var M=e[v++],L=e[v++];C=p+M,D=m+L;if(n){if(r.containStroke(p,m,C,m,t,i,l)||r.containStroke(C,m,C,D,t,i,l)||r.containStroke(C,D,p,D,t,i,l)||r.containStroke(p,D,p,m,t,i,l))return!0}else u+=d(C,m,C,D,i,l),u+=d(p,D,p,m,i,l);break;case h.Z:if(n){if(r.containStroke(c,f,p,m,t,i,l))return!0}else u+=d(c,f,p,m,i,l);c=p,f=m;break}}return n||g(f,m)||(u+=d(c,f,p,m,i,l)||0),0!==u}function w(e,t,n){return S(e,0,!1,t,n)}function E(e,t,n,i){return S(e,t,!0,n,i)}t.contain=w,t.containStroke=E},d8e8:function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},d9fc:function(e,t,n){var i=n("cbe5"),r=i.extend({type:"circle",shape:{cx:0,cy:0,r:0},buildPath:function(e,t,n){n&&e.moveTo(t.cx+t.r,t.cy),e.arc(t.cx,t.cy,t.r,0,2*Math.PI,!0)}});e.exports=r},db9e:function(e,t,n){var i=n("3eba"),r=n("6d8b"),s=n("e86a"),a=n("2145"),o=n("2306"),l=n("4319"),u=n("80f0"),c=n("7919"),d=i.extendComponentView({type:"toolbox",render:function(e,t,n,i){var d=this.group;if(d.removeAll(),e.get("show")){var f=+e.get("itemSize"),p=e.get("feature")||{},g=this._features||(this._features={}),m=[];r.each(p,function(e,t){m.push(t)}),new u(this._featureNames||[],m).add(v).update(v).remove(r.curry(v,null)).execute(),this._featureNames=m,c.layout(d,e,n),d.add(c.makeBackground(d.getBoundingRect(),e)),d.eachChild(function(e){var t=e.__title,i=e.hoverStyle;if(i&&t){var r=s.getBoundingRect(t,s.makeFont(i)),a=e.position[0]+d.position[0],o=e.position[1]+d.position[1]+f,l=!1;o+r.height>n.getHeight()&&(i.textPosition="top",l=!0);var u=l?-5-r.height:f+8;a+r.width/2>n.getWidth()?(i.textPosition=["100%",u],i.textAlign="right"):a-r.width/2<0&&(i.textPosition=[0,u],i.textAlign="left")}})}function v(r,s){var o,u=m[r],c=m[s],d=p[u],f=new l(d,e,e.ecModel);if(u&&!c){if(h(u))o={model:f,onclick:f.option.onclick,featureName:u};else{var v=a.get(u);if(!v)return;o=new v(f,t,n)}g[u]=o}else{if(o=g[c],!o)return;o.model=f,o.ecModel=t,o.api=n}u||!c?f.get("show")&&!o.unusable?(y(f,o,u),f.setIconStatus=function(e,t){var n=this.option,i=this.iconPaths;n.iconStatus=n.iconStatus||{},n.iconStatus[e]=t,i[e]&&i[e].trigger(t)},o.render&&o.render(f,t,n,i)):o.remove&&o.remove(t,n):o.dispose&&o.dispose(t,n)}function y(i,s,a){var l=i.getModel("iconStyle"),u=i.getModel("emphasis.iconStyle"),c=s.getIcons?s.getIcons():i.get("icon"),h=i.get("title")||{};if("string"===typeof c){var p=c,g=h;c={},h={},c[a]=p,h[a]=g}var m=i.iconPaths={};r.each(c,function(a,c){var p=o.createIcon(a,{},{x:-f/2,y:-f/2,width:f,height:f});p.setStyle(l.getItemStyle()),p.hoverStyle=u.getItemStyle(),o.setHoverStyle(p),e.get("showTitle")&&(p.__title=h[c],p.on("mouseover",function(){var e=u.getItemStyle();p.setStyle({text:h[c],textPosition:e.textPosition||"bottom",textFill:e.fill||e.stroke||"#000",textAlign:e.textAlign||"center"})}).on("mouseout",function(){p.setStyle({textFill:null})})),p.trigger(i.get("iconStatus."+c)||"normal"),d.add(p),p.on("click",r.bind(s.onclick,s,t,n,c)),m[c]=p})}},updateView:function(e,t,n,i){r.each(this._features,function(e){e.updateView&&e.updateView(e.model,t,n,i)})},remove:function(e,t){r.each(this._features,function(n){n.remove&&n.remove(e,t)}),this.group.removeAll()},dispose:function(e,t){r.each(this._features,function(n){n.dispose&&n.dispose(e,t)})}});function h(e){return 0===e.indexOf("my")}e.exports=d},dc2f:function(e,t){var n=function(e,t){this.image=e,this.repeat=t,this.type="pattern"};n.prototype.getCanvasPattern=function(e){return e.createPattern(this.image,this.repeat||"repeat")};var i=n;e.exports=i},dcb3:function(e,t,n){var i=n("6d8b"),r=n("625e"),s=n("2306"),a=n("cd33"),o=n("607d"),l=n("88b3"),u=n("e0d3"),c=u.makeInner,d=c(),h=i.clone,f=i.bind;function p(){}function g(e,t,n,i){m(d(n).lastProp,i)||(d(n).lastProp=i,t?s.updateProps(n,i,e):(n.stopAnimation(),n.attr(i)))}function m(e,t){if(i.isObject(e)&&i.isObject(t)){var n=!0;return i.each(t,function(t,i){n=n&&m(e[i],t)}),!!n}return e===t}function v(e,t){e[t.get("label.show")?"show":"hide"]()}function y(e){return{position:e.position.slice(),rotation:e.rotation||0}}function b(e,t,n){var i=t.get("z"),r=t.get("zlevel");e&&e.traverse(function(e){"group"!==e.type&&(null!=i&&(e.z=i),null!=r&&(e.zlevel=r),e.silent=n)})}p.prototype={_group:null,_lastGraphicKey:null,_handle:null,_dragging:!1,_lastValue:null,_lastStatus:null,_payloadInfo:null,animationThreshold:15,render:function(e,t,n,r){var a=t.get("value"),o=t.get("status");if(this._axisModel=e,this._axisPointerModel=t,this._api=n,r||this._lastValue!==a||this._lastStatus!==o){this._lastValue=a,this._lastStatus=o;var l=this._group,u=this._handle;if(!o||"hide"===o)return l&&l.hide(),void(u&&u.hide());l&&l.show(),u&&u.show();var c={};this.makeElOption(c,a,e,t,n);var d=c.graphicKey;d!==this._lastGraphicKey&&this.clear(n),this._lastGraphicKey=d;var h=this._moveAnimation=this.determineAnimation(e,t);if(l){var f=i.curry(g,t,h);this.updatePointerEl(l,c,f,t),this.updateLabelEl(l,c,f,t)}else l=this._group=new s.Group,this.createPointerEl(l,c,e,t),this.createLabelEl(l,c,e,t),n.getZr().add(l);b(l,t,!0),this._renderHandle(a)}},remove:function(e){this.clear(e)},dispose:function(e){this.clear(e)},determineAnimation:function(e,t){var n=t.get("animation"),i=e.axis,r="category"===i.type,s=t.get("snap");if(!s&&!r)return!1;if("auto"===n||null==n){var o=this.animationThreshold;if(r&&i.getBandWidth()>o)return!0;if(s){var l=a.getAxisInfo(e).seriesDataCount,u=i.getExtent();return Math.abs(u[0]-u[1])/l>o}return!1}return!0===n},makeElOption:function(e,t,n,i,r){},createPointerEl:function(e,t,n,i){var r=t.pointer;if(r){var a=d(e).pointerEl=new s[r.type](h(t.pointer));e.add(a)}},createLabelEl:function(e,t,n,i){if(t.label){var r=d(e).labelEl=new s.Rect(h(t.label));e.add(r),v(r,i)}},updatePointerEl:function(e,t,n){var i=d(e).pointerEl;i&&(i.setStyle(t.pointer.style),n(i,{shape:t.pointer.shape}))},updateLabelEl:function(e,t,n,i){var r=d(e).labelEl;r&&(r.setStyle(t.label.style),n(r,{shape:t.label.shape,position:t.label.position}),v(r,i))},_renderHandle:function(e){if(!this._dragging&&this.updateHandleTransform){var t,n=this._axisPointerModel,r=this._api.getZr(),a=this._handle,u=n.getModel("handle"),c=n.get("status");if(!u.get("show")||!c||"hide"===c)return a&&r.remove(a),void(this._handle=null);this._handle||(t=!0,a=this._handle=s.createIcon(u.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(e){o.stop(e.event)},onmousedown:f(this._onHandleDragMove,this,0,0),drift:f(this._onHandleDragMove,this),ondragend:f(this._onHandleDragEnd,this)}),r.add(a)),b(a,n,!1);var d=["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];a.setStyle(u.getItemStyle(null,d));var h=u.get("size");i.isArray(h)||(h=[h,h]),a.attr("scale",[h[0]/2,h[1]/2]),l.createOrUpdate(this,"_doDispatchAxisPointer",u.get("throttle")||0,"fixRate"),this._moveHandleToValue(e,t)}},_moveHandleToValue:function(e,t){g(this._axisPointerModel,!t&&this._moveAnimation,this._handle,y(this.getHandleTransform(e,this._axisModel,this._axisPointerModel)))},_onHandleDragMove:function(e,t){var n=this._handle;if(n){this._dragging=!0;var i=this.updateHandleTransform(y(n),[e,t],this._axisModel,this._axisPointerModel);this._payloadInfo=i,n.stopAnimation(),n.attr(y(i)),d(n).lastProp=null,this._doDispatchAxisPointer()}},_doDispatchAxisPointer:function(){var e=this._handle;if(e){var t=this._payloadInfo,n=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:t.cursorPoint[0],y:t.cursorPoint[1],tooltipOption:t.tooltipOption,axesInfo:[{axisDim:n.axis.dim,axisIndex:n.componentIndex}]})}},_onHandleDragEnd:function(e){this._dragging=!1;var t=this._handle;if(t){var n=this._axisPointerModel.get("value");this._moveHandleToValue(n),this._api.dispatchAction({type:"hideTip"})}},getHandleTransform:null,updateHandleTransform:null,clear:function(e){this._lastValue=null,this._lastStatus=null;var t=e.getZr(),n=this._group,i=this._handle;t&&n&&(this._lastGraphicKey=null,n&&t.remove(n),i&&t.remove(i),this._group=null,this._handle=null,this._payloadInfo=null)},doClear:function(){},buildLabel:function(e,t,n){return n=n||0,{x:e[n],y:e[1-n],width:t[n],height:t[1-n]}}},p.prototype.constructor=p,r.enableClassExtend(p);var _=p;e.exports=_},dcbc:function(e,t,n){var i=n("2aba");e.exports=function(e,t,n){for(var r in t)i(e,r,t[r],n);return e}},dd39:function(e,t,n){n("6932"),n("3a56"),n("7dcf"),n("414c"),n("4b08"),n("2c17"),n("9e87")},dded:function(e,t,n){var i=n("6d8b"),r=n("42e5"),s=function(e,t,n,i,s){this.x=null==e?.5:e,this.y=null==t?.5:t,this.r=null==n?.5:n,this.type="radial",this.global=s||!1,r.call(this,i)};s.prototype={constructor:s},i.inherits(s,r);var a=s;e.exports=a},de00:function(e,t){var n=2311;function i(){return n++}e.exports=i},de1c:function(e,t){var n={getBoxLayoutParams:function(){return{left:this.get("left"),top:this.get("top"),right:this.get("right"),bottom:this.get("bottom"),width:this.get("width"),height:this.get("height")}}};e.exports=n},de66:function(e,t,n){"use strict";n.d(t,"g",function(){return l}),n.d(t,"e",function(){return u}),n.d(t,"k",function(){return d}),n.d(t,"j",function(){return h}),n.d(t,"i",function(){return f}),n.d(t,"b",function(){return m}),n.d(t,"f",function(){return v}),n.d(t,"c",function(){return y}),n.d(t,"h",function(){return b}),n.d(t,"d",function(){return _}),n.d(t,"a",function(){return T});var i=n("be09"),r=n.n(i),s=function(e,t){var n="";while(t--)n+=e;return n},a=function(e){return e.toString(2).length},o=function(e){return Math.ceil(a(e)/8)},l=function(e,t,n){return void 0===n&&(n=" "),(s(n,t)+e.toString()).slice(-t)},u=function(e){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},c=function(e){return u(e)},d=function(e){return e instanceof Uint8Array?e:(Array.isArray(e)||c(e)||e instanceof ArrayBuffer||(e="number"!==typeof e||"number"===typeof e&&e!==e?0:[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},h=function(e){e=d(e);for(var t="",n=0;n<e.length;n++)t+=l(e[n].toString(16),2,"0");return t},f=function(e){e=d(e);for(var t="",n=0;n<e.length;n++)t+=l(e[n].toString(2),8,"0");return t},p=r.a.BigInt||Number,g=[p("0x1"),p("0x100"),p("0x10000"),p("0x1000000"),p("0x100000000"),p("0x10000000000"),p("0x1000000000000"),p("0x100000000000000"),p("0x10000000000000000")],m=(function(){var e=new Uint16Array([65484]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);255===t[0]||t[0]}(),function(e,t){var n=void 0===t?{}:t,i=n.signed,r=void 0!==i&&i,s=n.le,a=void 0!==s&&s;e=d(e);var o=a?"reduce":"reduceRight",l=e[o]?e[o]:Array.prototype[o],u=l.call(e,function(t,n,i){var r=a?i:Math.abs(i+1-e.length);return t+p(n)*g[r]},p(0));if(r){var c=g[e.length]/p(2)-p(1);u=p(u),u>c&&(u-=c,u-=c,u-=p(2))}return Number(u)}),v=function(e,t){var n=void 0===t?{}:t,i=n.le,r=void 0!==i&&i;("bigint"!==typeof e&&"number"!==typeof e||"number"===typeof e&&e!==e)&&(e=0),e=p(e);for(var s=o(e),a=new Uint8Array(new ArrayBuffer(s)),l=0;l<s;l++){var u=r?l:Math.abs(l+1-a.length);a[u]=Number(e/g[l]&p(255)),e<0&&(a[u]=Math.abs(~a[u]),a[u]-=0===l?1:2)}return a},y=function(e){if(!e)return"";e=Array.prototype.slice.call(e);var t=String.fromCharCode.apply(null,d(e));try{return decodeURIComponent(escape(t))}catch(e){}return t},b=function(e,t){if("string"!==typeof e&&e&&"function"===typeof e.toString&&(e=e.toString()),"string"!==typeof e)return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n},_=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t=t.filter(function(e){return e&&(e.byteLength||e.length)&&"string"!==typeof e}),t.length<=1)return d(t[0]);var i=t.reduce(function(e,t,n){return e+(t.byteLength||t.length)},0),r=new Uint8Array(i),s=0;return t.forEach(function(e){e=d(e),r.set(e,s),s+=e.byteLength}),r},T=function(e,t,n){var i=void 0===n?{}:n,r=i.offset,s=void 0===r?0:r,a=i.mask,o=void 0===a?[]:a;e=d(e),t=d(t);var l=t.every?t.every:Array.prototype.every;return t.length&&e.length-s>=t.length&&l.call(t,function(t,n){var i=o[n]?o[n]&e[s+n]:e[s+n];return t===i})}},df70:function(e,t,n){var i=n("3eba"),r=n("6fda"),s=n("29a8"),a=n("2145"),o=s.toolbox.restore;function l(e){this.model=e}l.defaultOption={show:!0,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:o.title};var u=l.prototype;u.onclick=function(e,t,n){r.clear(e),t.dispatchAction({type:"restore",from:this.uid})},a.register("restore",l),i.registerAction({type:"restore",event:"restore",update:"prepareAndUpdate"},function(e,t){t.resetOption("recreate")});var c=l;e.exports=c},e003:function(e,t,n){var i=n("89a7").NAMESPACE,r=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,s=new RegExp("[\\-\\.0-9"+r.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),a=new RegExp("^"+r.source+s.source+"*(?::"+r.source+s.source+"*)?$"),o=0,l=1,u=2,c=3,d=4,h=5,f=6,p=7;function g(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,g)}function m(){}function v(e,t,n,r,s){function a(e){if(e>65535){e-=65536;var t=55296+(e>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}function o(e){var t=e.slice(1,-1);return Object.hasOwnProperty.call(n,t)?n[t]:"#"===t.charAt(0)?a(parseInt(t.substr(1).replace("x","0x"))):(s.error("entity not found:"+e),e)}function l(t){if(t>v){var n=e.substring(v,t).replace(/&#?\w+;/g,o);f&&u(v),r.characters(n,0,t-v),v=t}}function u(t,n){while(t>=d&&(n=h.exec(e)))c=n.index,d=c+n[0].length,f.lineNumber++;f.columnNumber=t-c+1}var c=0,d=0,h=/.*(?:\r\n?|\n)|.*$/g,f=r.locator,p=[{currentNSMap:t}],m={},v=0;while(1){try{var w=e.indexOf("<",v);if(w<0){if(!e.substr(v).match(/^\s*$/)){var A=r.doc,I=A.createTextNode(e.substr(v));A.appendChild(I),r.currentElement=I}return}switch(w>v&&l(w),e.charAt(w+1)){case"/":var C=e.indexOf(">",w+3),D=e.substring(w+2,C).replace(/[ \t\n\r]+$/g,""),R=p.pop();C<0?(D=e.substring(w+2).replace(/[\s<].*/,""),s.error("end tag name: "+D+" is not complete:"+R.tagName),C=w+1+D.length):D.match(/\s</)&&(D=D.replace(/[\s<].*/,""),s.error("end tag name: "+D+" maybe not complete"),C=w+1+D.length);var M=R.localNSMap,L=R.tagName==D,P=L||R.tagName&&R.tagName.toLowerCase()==D.toLowerCase();if(P){if(r.endElement(R.uri,R.localName,D),M)for(var O in M)Object.prototype.hasOwnProperty.call(M,O)&&r.endPrefixMapping(O);L||s.fatalError("end tag name: "+D+" is not match the current start tagName:"+R.tagName)}else p.push(R);C++;break;case"?":f&&u(w),C=x(e,w,r);break;case"!":f&&u(w),C=E(e,w,r,s);break;default:f&&u(w);var N=new k,U=p[p.length-1].currentNSMap,F=(C=b(e,w,N,U,o,s),N.length);if(!N.closed&&S(e,C,N.tagName,m)&&(N.closed=!0,n.nbsp||s.warning("unclosed xml attribute")),f&&F){for(var B=y(f,{}),j=0;j<F;j++){var V=N[j];u(V.offset),V.locator=y(f,{})}r.locator=B,_(N,r,U)&&p.push(N),r.locator=f}else _(N,r,U)&&p.push(N);i.isHTML(N.uri)&&!N.closed?C=T(e,C,N.tagName,o,r):C++}}catch(e){if(e instanceof g)throw e;s.error("element parse error: "+e),C=-1}C>v?v=C:l(Math.max(w,v)+1)}}function y(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function b(e,t,n,r,s,a){function g(e,t,i){n.attributeNames.hasOwnProperty(e)&&a.fatalError("Attribute "+e+" redefined"),n.addValue(e,t.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,s),i)}var m,v=++t,y=o;while(1){var b=e.charAt(v);switch(b){case"=":if(y===l)m=e.slice(t,v),y=c;else{if(y!==u)throw new Error("attribute equal must after attrName");y=c}break;case"'":case'"':if(y===c||y===l){if(y===l&&(a.warning('attribute value must after "="'),m=e.slice(t,v)),t=v+1,v=e.indexOf(b,t),!(v>0))throw new Error("attribute value no end '"+b+"' match");_=e.slice(t,v),g(m,_,t-1),y=h}else{if(y!=d)throw new Error('attribute value must after "="');_=e.slice(t,v),g(m,_,t),a.warning('attribute "'+m+'" missed start quot('+b+")!!"),t=v+1,y=h}break;case"/":switch(y){case o:n.setTagName(e.slice(t,v));case h:case f:case p:y=p,n.closed=!0;case d:case l:break;case u:n.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),y==o&&n.setTagName(e.slice(t,v)),v;case">":switch(y){case o:n.setTagName(e.slice(t,v));case h:case f:case p:break;case d:case l:_=e.slice(t,v),"/"===_.slice(-1)&&(n.closed=!0,_=_.slice(0,-1));case u:y===u&&(_=m),y==d?(a.warning('attribute "'+_+'" missed quot(")!'),g(m,_,t)):(i.isHTML(r[""])&&_.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+_+'" missed value!! "'+_+'" instead!!'),g(_,_,t));break;case c:throw new Error("attribute value missed!!")}return v;case"":b=" ";default:if(b<=" ")switch(y){case o:n.setTagName(e.slice(t,v)),y=f;break;case l:m=e.slice(t,v),y=u;break;case d:var _=e.slice(t,v);a.warning('attribute "'+_+'" missed quot(")!!'),g(m,_,t);case h:y=f;break}else switch(y){case u:n.tagName;i.isHTML(r[""])&&m.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+m+'" missed value!! "'+m+'" instead2!!'),g(m,m,t),t=v,y=l;break;case h:a.warning('attribute space is required"'+m+'"!!');case f:y=l,t=v;break;case c:y=d,t=v;break;case p:throw new Error("elements closed character '/' and '>' must be connected to")}}v++}}function _(e,t,n){var r=e.tagName,s=null,a=e.length;while(a--){var o=e[a],l=o.qName,u=o.value,c=l.indexOf(":");if(c>0)var d=o.prefix=l.slice(0,c),h=l.slice(c+1),f="xmlns"===d&&h;else h=l,d=null,f="xmlns"===l&&"";o.localName=h,!1!==f&&(null==s&&(s={},w(n,n={})),n[f]=s[f]=u,o.uri=i.XMLNS,t.startPrefixMapping(f,u))}a=e.length;while(a--){o=e[a];d=o.prefix;d&&("xml"===d&&(o.uri=i.XML),"xmlns"!==d&&(o.uri=n[d||""]))}c=r.indexOf(":");c>0?(d=e.prefix=r.slice(0,c),h=e.localName=r.slice(c+1)):(d=null,h=e.localName=r);var p=e.uri=n[d||""];if(t.startElement(p,h,r,e),!e.closed)return e.currentNSMap=n,e.localNSMap=s,!0;if(t.endElement(p,h,r),s)for(d in s)Object.prototype.hasOwnProperty.call(s,d)&&t.endPrefixMapping(d)}function T(e,t,n,i,r){if(/^(?:script|textarea)$/i.test(n)){var s=e.indexOf("</"+n+">",t),a=e.substring(t+1,s);if(/[&<]/.test(a))return/^script$/i.test(n)?(r.characters(a,0,a.length),s):(a=a.replace(/&#?\w+;/g,i),r.characters(a,0,a.length),s)}return t+1}function S(e,t,n,i){var r=i[n];return null==r&&(r=e.lastIndexOf("</"+n+">"),r<t&&(r=e.lastIndexOf("</"+n)),i[n]=r),r<t}function w(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function E(e,t,n,i){var r=e.charAt(t+2);switch(r){case"-":if("-"===e.charAt(t+3)){var s=e.indexOf("--\x3e",t+4);return s>t?(n.comment(e,t+4,s-t-4),s+3):(i.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==e.substr(t+3,6)){s=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,s-t-9),n.endCDATA(),s+3}var a=A(e,t),o=a.length;if(o>1&&/!doctype/i.test(a[0][0])){var l=a[1][0],u=!1,c=!1;o>3&&(/^public$/i.test(a[2][0])?(u=a[3][0],c=o>4&&a[4][0]):/^system$/i.test(a[2][0])&&(c=a[3][0]));var d=a[o-1];return n.startDTD(l,u,c),n.endDTD(),d.index+d[0].length}}return-1}function x(e,t,n){var i=e.indexOf("?>",t);if(i){var r=e.substring(t,i).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(r){r[0].length;return n.processingInstruction(r[1],r[2]),i+2}return-1}return-1}function k(){this.attributeNames={}}function A(e,t){var n,i=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;r.lastIndex=t,r.exec(e);while(n=r.exec(e))if(i.push(n),n[1])return i}g.prototype=new Error,g.prototype.name=g.name,m.prototype={parse:function(e,t,n){var i=this.domBuilder;i.startDocument(),w(t,t={}),v(e,t,n,i,this.errorHandler),i.endDocument()}},k.prototype={setTagName:function(e){if(!a.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,n){if(!a.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},t.XMLReader=m,t.ParseError=g},e073:function(e,t,n){var i=n("6d8b"),r=n("e86a"),s=n("e0d3"),a=s.makeInner,o=n("697e"),l=o.makeLabelFormatter,u=a();function c(e){return"category"===e.type?h(e):g(e)}function d(e,t){return"category"===e.type?p(e,t):{ticks:e.scale.getTicks()}}function h(e){var t=e.getLabelModel(),n=f(e,t);return!t.get("show")||e.scale.isBlank()?{labels:[],labelCategoryInterval:n.labelCategoryInterval}:n}function f(e,t){var n,r,s=m(e,"labels"),a=E(t),o=v(s,a);return o||(i.isFunction(a)?n=w(e,a):(r="auto"===a?b(e):a,n=S(e,r)),y(s,a,{labels:n,labelCategoryInterval:r}))}function p(e,t){var n,r,s=m(e,"ticks"),a=E(t),o=v(s,a);if(o)return o;if(t.get("show")&&!e.scale.isBlank()||(n=[]),i.isFunction(a))n=w(e,a,!0);else if("auto"===a){var l=f(e,e.getLabelModel());r=l.labelCategoryInterval,n=i.map(l.labels,function(e){return e.tickValue})}else r=a,n=S(e,r,!0);return y(s,a,{ticks:n,tickCategoryInterval:r})}function g(e){var t=e.scale.getTicks(),n=l(e);return{labels:i.map(t,function(t,i){return{formattedLabel:n(t,i),rawLabel:e.scale.getLabel(t),tickValue:t}})}}function m(e,t){return u(e)[t]||(u(e)[t]=[])}function v(e,t){for(var n=0;n<e.length;n++)if(e[n].key===t)return e[n].value}function y(e,t,n){return e.push({key:t,value:n}),n}function b(e){var t=u(e).autoInterval;return null!=t?t:u(e).autoInterval=e.calculateCategoryInterval()}function _(e){var t=T(e),n=l(e),i=(t.axisRotate-t.labelRotate)/180*Math.PI,s=e.scale,a=s.getExtent(),o=s.count();if(a[1]-a[0]<1)return 0;var c=1;o>40&&(c=Math.max(1,Math.floor(o/40)));for(var d=a[0],h=e.dataToCoord(d+1)-e.dataToCoord(d),f=Math.abs(h*Math.cos(i)),p=Math.abs(h*Math.sin(i)),g=0,m=0;d<=a[1];d+=c){var v=0,y=0,b=r.getBoundingRect(n(d),t.font,"center","top");v=1.3*b.width,y=1.3*b.height,g=Math.max(g,v,7),m=Math.max(m,y,7)}var _=g/f,S=m/p;isNaN(_)&&(_=1/0),isNaN(S)&&(S=1/0);var w=Math.max(0,Math.floor(Math.min(_,S))),E=u(e.model),x=E.lastAutoInterval,k=E.lastTickCount;return null!=x&&null!=k&&Math.abs(x-w)<=1&&Math.abs(k-o)<=1&&x>w?w=x:(E.lastTickCount=o,E.lastAutoInterval=w),w}function T(e){var t=e.getLabelModel();return{axisRotate:e.getRotate?e.getRotate():e.isHorizontal&&!e.isHorizontal()?90:0,labelRotate:t.get("rotate")||0,font:t.getFont()}}function S(e,t,n){var i=l(e),r=e.scale,s=r.getExtent(),a=e.getLabelModel(),o=[],u=Math.max((t||0)+1,1),c=s[0],d=r.count();0!==c&&u>1&&d/u>2&&(c=Math.round(Math.ceil(c/u)*u));var h={min:a.get("showMinLabel"),max:a.get("showMaxLabel")};h.min&&c!==s[0]&&p(s[0]);for(var f=c;f<=s[1];f+=u)p(f);function p(e){o.push(n?e:{formattedLabel:i(e),rawLabel:r.getLabel(e),tickValue:e})}return h.max&&f!==s[1]&&p(s[1]),o}function w(e,t,n){var r=e.scale,s=l(e),a=[];return i.each(r.getTicks(),function(e){var i=r.getLabel(e);t(e,i)&&a.push(n?e:{formattedLabel:s(e),rawLabel:i,tickValue:e})}),a}function E(e){var t=e.get("interval");return null==t?"auto":t}t.createAxisLabels=c,t.createAxisTicks=d,t.calculateCategoryInterval=_},e0d3:function(e,t,n){var i=n("6d8b"),r=i.each,s=i.isObject,a=i.isArray,o="series\0";function l(e){return e instanceof Array?e:null==e?[]:[e]}function u(e,t,n){if(e){e[t]=e[t]||{},e.emphasis=e.emphasis||{},e.emphasis[t]=e.emphasis[t]||{};for(var i=0,r=n.length;i<r;i++){var s=n[i];!e.emphasis[t].hasOwnProperty(s)&&e[t].hasOwnProperty(s)&&(e.emphasis[t][s]=e[t][s])}}}var c=["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"];function d(e){return!s(e)||a(e)||e instanceof Date?e:e.value}function h(e){return s(e)&&!(e instanceof Array)}function f(e,t){t=(t||[]).slice();var n=i.map(e||[],function(e,t){return{exist:e}});return r(t,function(e,i){if(s(e)){for(var r=0;r<n.length;r++)if(!n[r].option&&null!=e.id&&n[r].exist.id===e.id+"")return n[r].option=e,void(t[i]=null);for(r=0;r<n.length;r++){var a=n[r].exist;if(!n[r].option&&(null==a.id||null==e.id)&&null!=e.name&&!m(e)&&!m(a)&&a.name===e.name+"")return n[r].option=e,void(t[i]=null)}}}),r(t,function(e,t){if(s(e)){for(var i=0;i<n.length;i++){var r=n[i].exist;if(!n[i].option&&!m(r)&&null==e.id){n[i].option=e;break}}i>=n.length&&n.push({option:e})}}),n}function p(e){var t=i.createHashMap();r(e,function(e,n){var i=e.exist;i&&t.set(i.id,e)}),r(e,function(e,n){var r=e.option;i.assert(!r||null==r.id||!t.get(r.id)||t.get(r.id)===e,"id duplicates: "+(r&&r.id)),r&&null!=r.id&&t.set(r.id,e),!e.keyInfo&&(e.keyInfo={})}),r(e,function(e,n){var i=e.exist,r=e.option,a=e.keyInfo;if(s(r)){if(a.name=null!=r.name?r.name+"":i?i.name:o+n,i)a.id=i.id;else if(null!=r.id)a.id=r.id+"";else{var l=0;do{a.id="\0"+a.name+"\0"+l++}while(t.get(a.id))}t.set(a.id,e)}})}function g(e){var t=e.name;return!(!t||!t.indexOf(o))}function m(e){return s(e)&&e.id&&0===(e.id+"").indexOf("\0_ec_\0")}function v(e,t){var n={},i={};return r(e||[],n),r(t||[],i,n),[s(n),s(i)];function r(e,t,n){for(var i=0,r=e.length;i<r;i++)for(var s=e[i].seriesId,a=l(e[i].dataIndex),o=n&&n[s],u=0,c=a.length;u<c;u++){var d=a[u];o&&o[d]?o[d]=null:(t[s]||(t[s]={}))[d]=1}}function s(e,t){var n=[];for(var i in e)if(e.hasOwnProperty(i)&&null!=e[i])if(t)n.push(+i);else{var r=s(e[i],!0);r.length&&n.push({seriesId:i,dataIndex:r})}return n}}function y(e,t){return null!=t.dataIndexInside?t.dataIndexInside:null!=t.dataIndex?i.isArray(t.dataIndex)?i.map(t.dataIndex,function(t){return e.indexOfRawIndex(t)}):e.indexOfRawIndex(t.dataIndex):null!=t.name?i.isArray(t.name)?i.map(t.name,function(t){return e.indexOfName(t)}):e.indexOfName(t.name):void 0}function b(){var e="__\0ec_inner_"+_+++"_"+Math.random().toFixed(5);return function(t){return t[e]||(t[e]={})}}var _=0;function T(e,t,n){if(i.isString(t)){var s={};s[t+"Index"]=0,t=s}var a=n&&n.defaultMainType;!a||S(t,a+"Index")||S(t,a+"Id")||S(t,a+"Name")||(t[a+"Index"]=0);var o={};return r(t,function(r,s){r=t[s];if("dataIndex"!==s&&"dataIndexInside"!==s){var a=s.match(/^(\w+)(Index|Id|Name)$/)||[],l=a[1],u=(a[2]||"").toLowerCase();if(!(!l||!u||null==r||"index"===u&&"none"===r||n&&n.includeMainTypes&&i.indexOf(n.includeMainTypes,l)<0)){var c={mainType:l};"index"===u&&"all"===r||(c[u]=r);var d=e.queryComponents(c);o[l+"Models"]=d,o[l+"Model"]=d[0]}}else o[s]=r}),o}function S(e,t){return e&&e.hasOwnProperty(t)}function w(e,t,n){e.setAttribute?e.setAttribute(t,n):e[t]=n}function E(e,t){return e.getAttribute?e.getAttribute(t):e[t]}t.normalizeToArray=l,t.defaultEmphasis=u,t.TEXT_STYLE_OPTIONS=c,t.getDataItemValue=d,t.isDataItemOption=h,t.mappingToExists=f,t.makeIdAndName=p,t.isNameSpecified=g,t.isIdInner=m,t.compressBatches=v,t.queryDataIndex=y,t.makeInner=b,t.parseFinder=T,t.setAttribute=w,t.getAttribute=E},e0d8:function(e,t,n){var i=n("625e");function r(e){this._setting=e||{},this._extent=[1/0,-1/0],this._interval=0,this.init&&this.init.apply(this,arguments)}r.prototype.parse=function(e){return e},r.prototype.getSetting=function(e){return this._setting[e]},r.prototype.contain=function(e){var t=this._extent;return e>=t[0]&&e<=t[1]},r.prototype.normalize=function(e){var t=this._extent;return t[1]===t[0]?.5:(e-t[0])/(t[1]-t[0])},r.prototype.scale=function(e){var t=this._extent;return e*(t[1]-t[0])+t[0]},r.prototype.unionExtent=function(e){var t=this._extent;e[0]<t[0]&&(t[0]=e[0]),e[1]>t[1]&&(t[1]=e[1])},r.prototype.unionExtentFromData=function(e,t){this.unionExtent(e.getApproximateExtent(t))},r.prototype.getExtent=function(){return this._extent.slice()},r.prototype.setExtent=function(e,t){var n=this._extent;isNaN(e)||(n[0]=e),isNaN(t)||(n[1]=t)},r.prototype.isBlank=function(){return this._isBlank},r.prototype.setBlank=function(e){this._isBlank=e},r.prototype.getLabel=null,i.enableClassExtend(r),i.enableClassManagement(r,{registerWhenExtend:!0});var s=r;e.exports=s},e11e:function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},e1c8:function(e,t,n){var i=n("89a7"),r=i.find,s=i.NAMESPACE;function a(e){return""!==e}function o(e){return e?e.split(/[\t\n\f\r ]+/).filter(a):[]}function l(e,t){return e.hasOwnProperty(t)||(e[t]=!0),e}function u(e){if(!e)return[];var t=o(e);return Object.keys(t.reduce(l,{}))}function c(e){return function(t){return e&&-1!==e.indexOf(t)}}function d(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function h(e,t){var n=e.prototype;if(!(n instanceof t)){function i(){}i.prototype=t.prototype,i=new i,d(n,i),e.prototype=n=i}n.constructor!=e&&("function"!=typeof e&&console.error("unknown Class:"+e),n.constructor=e)}var f={},p=f.ELEMENT_NODE=1,g=f.ATTRIBUTE_NODE=2,m=f.TEXT_NODE=3,v=f.CDATA_SECTION_NODE=4,y=f.ENTITY_REFERENCE_NODE=5,b=f.ENTITY_NODE=6,_=f.PROCESSING_INSTRUCTION_NODE=7,T=f.COMMENT_NODE=8,S=f.DOCUMENT_NODE=9,w=f.DOCUMENT_TYPE_NODE=10,E=f.DOCUMENT_FRAGMENT_NODE=11,x=f.NOTATION_NODE=12,k={},A={},I=(k.INDEX_SIZE_ERR=(A[1]="Index size error",1),k.DOMSTRING_SIZE_ERR=(A[2]="DOMString size error",2),k.HIERARCHY_REQUEST_ERR=(A[3]="Hierarchy request error",3)),C=(k.WRONG_DOCUMENT_ERR=(A[4]="Wrong document",4),k.INVALID_CHARACTER_ERR=(A[5]="Invalid character",5),k.NO_DATA_ALLOWED_ERR=(A[6]="No data allowed",6),k.NO_MODIFICATION_ALLOWED_ERR=(A[7]="No modification allowed",7),k.NOT_FOUND_ERR=(A[8]="Not found",8)),D=(k.NOT_SUPPORTED_ERR=(A[9]="Not supported",9),k.INUSE_ATTRIBUTE_ERR=(A[10]="Attribute in use",10));k.INVALID_STATE_ERR=(A[11]="Invalid state",11),k.SYNTAX_ERR=(A[12]="Syntax error",12),k.INVALID_MODIFICATION_ERR=(A[13]="Invalid modification",13),k.NAMESPACE_ERR=(A[14]="Invalid namespace",14),k.INVALID_ACCESS_ERR=(A[15]="Invalid access",15);function R(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,A[e]),this.message=A[e],Error.captureStackTrace&&Error.captureStackTrace(this,R);return n.code=e,t&&(this.message=this.message+": "+t),n}function M(){}function L(e,t){this._node=e,this._refresh=t,P(this)}function P(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!==t){var n=e._refresh(e._node);if(xe(e,"length",n.length),!e.$$length||n.length<e.$$length)for(var i=n.length;i in e;i++)Object.prototype.hasOwnProperty.call(e,i)&&delete e[i];d(n,e),e._inc=t}}function O(){}function N(e,t){var n=e.length;while(n--)if(e[n]===t)return n}function U(e,t,n,i){if(i?t[N(t,i)]=n:t[t.length++]=n,e){n.ownerElement=e;var r=e.ownerDocument;r&&(i&&z(r,e,i),G(r,e,n))}}function F(e,t,n){var i=N(t,n);if(!(i>=0))throw new R(C,new Error(e.tagName+"@"+n));var r=t.length-1;while(i<r)t[i]=t[++i];if(t.length=r,e){var s=e.ownerDocument;s&&(z(s,e,n),n.ownerElement=null)}}function B(){}function j(){}function V(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function H(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(H(e,t))return!0}while(e=e.nextSibling)}function $(){this.ownerDocument=this}function G(e,t,n){e&&e._inc++;var i=n.namespaceURI;i===s.XMLNS&&(t._nsMap[n.prefix?n.localName:""]=n.value)}function z(e,t,n,i){e&&e._inc++;var r=n.namespaceURI;r===s.XMLNS&&delete t._nsMap[n.prefix?n.localName:""]}function q(e,t,n){if(e&&e._inc){e._inc++;var i=t.childNodes;if(n)i[i.length++]=n;else{var r=t.firstChild,s=0;while(r)i[s++]=r,r=r.nextSibling;i.length=s,delete i[i.length]}}}function W(e,t){var n=t.previousSibling,i=t.nextSibling;return n?n.nextSibling=i:e.firstChild=i,i?i.previousSibling=n:e.lastChild=n,t.parentNode=null,t.previousSibling=null,t.nextSibling=null,q(e.ownerDocument,e),t}function K(e){return e&&(e.nodeType===j.DOCUMENT_NODE||e.nodeType===j.DOCUMENT_FRAGMENT_NODE||e.nodeType===j.ELEMENT_NODE)}function Y(e){return e&&(Q(e)||Z(e)||X(e)||e.nodeType===j.DOCUMENT_FRAGMENT_NODE||e.nodeType===j.COMMENT_NODE||e.nodeType===j.PROCESSING_INSTRUCTION_NODE)}function X(e){return e&&e.nodeType===j.DOCUMENT_TYPE_NODE}function Q(e){return e&&e.nodeType===j.ELEMENT_NODE}function Z(e){return e&&e.nodeType===j.TEXT_NODE}function J(e,t){var n=e.childNodes||[];if(r(n,Q)||X(t))return!1;var i=r(n,X);return!(t&&i&&n.indexOf(i)>n.indexOf(t))}function ee(e,t){var n=e.childNodes||[];function i(e){return Q(e)&&e!==t}if(r(n,i))return!1;var s=r(n,X);return!(t&&s&&n.indexOf(s)>n.indexOf(t))}function te(e,t,n){if(!K(e))throw new R(I,"Unexpected parent node type "+e.nodeType);if(n&&n.parentNode!==e)throw new R(C,"child not in parent");if(!Y(t)||X(t)&&e.nodeType!==j.DOCUMENT_NODE)throw new R(I,"Unexpected node type "+t.nodeType+" for parent node type "+e.nodeType)}function ne(e,t,n){var i=e.childNodes||[],s=t.childNodes||[];if(t.nodeType===j.DOCUMENT_FRAGMENT_NODE){var a=s.filter(Q);if(a.length>1||r(s,Z))throw new R(I,"More than one element or text in fragment");if(1===a.length&&!J(e,n))throw new R(I,"Element in fragment can not be inserted before doctype")}if(Q(t)&&!J(e,n))throw new R(I,"Only one element can be added and only after doctype");if(X(t)){if(r(i,X))throw new R(I,"Only one doctype is allowed");var o=r(i,Q);if(n&&i.indexOf(o)<i.indexOf(n))throw new R(I,"Doctype can only be inserted before an element");if(!n&&o)throw new R(I,"Doctype can not be appended since element is present")}}function ie(e,t,n){var i=e.childNodes||[],s=t.childNodes||[];if(t.nodeType===j.DOCUMENT_FRAGMENT_NODE){var a=s.filter(Q);if(a.length>1||r(s,Z))throw new R(I,"More than one element or text in fragment");if(1===a.length&&!ee(e,n))throw new R(I,"Element in fragment can not be inserted before doctype")}if(Q(t)&&!ee(e,n))throw new R(I,"Only one element can be added and only after doctype");if(X(t)){function o(e){return X(e)&&e!==n}if(r(i,o))throw new R(I,"Only one doctype is allowed");var l=r(i,Q);if(n&&i.indexOf(l)<i.indexOf(n))throw new R(I,"Doctype can only be inserted before an element")}}function re(e,t,n,i){te(e,t,n),e.nodeType===j.DOCUMENT_NODE&&(i||ne)(e,t,n);var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===E){var s=t.firstChild;if(null==s)return t;var a=t.lastChild}else s=a=t;var o=n?n.previousSibling:e.lastChild;s.previousSibling=o,a.nextSibling=n,o?o.nextSibling=s:e.firstChild=s,null==n?e.lastChild=a:n.previousSibling=a;do{s.parentNode=e}while(s!==a&&(s=s.nextSibling));return q(e.ownerDocument||e,e),t.nodeType==E&&(t.firstChild=t.lastChild=null),t}function se(e,t){return t.parentNode&&t.parentNode.removeChild(t),t.parentNode=e,t.previousSibling=e.lastChild,t.nextSibling=null,t.previousSibling?t.previousSibling.nextSibling=t:e.firstChild=t,e.lastChild=t,q(e.ownerDocument,e,t),t}function ae(){this._nsMap={}}function oe(){}function le(){}function ue(){}function ce(){}function de(){}function he(){}function fe(){}function pe(){}function ge(){}function me(){}function ve(){}function ye(){}function be(e,t){var n=[],i=9==this.nodeType&&this.documentElement||this,r=i.prefix,s=i.namespaceURI;if(s&&null==r){r=i.lookupPrefix(s);if(null==r)var a=[{namespace:s,prefix:null}]}return Se(this,n,e,t,a),n.join("")}function _e(e,t,n){var i=e.prefix||"",r=e.namespaceURI;if(!r)return!1;if("xml"===i&&r===s.XML||r===s.XMLNS)return!1;var a=n.length;while(a--){var o=n[a];if(o.prefix===i)return o.namespace!==r}return!0}function Te(e,t,n){e.push(" ",t,'="',n.replace(/[<>&"\t\n\r]/g,V),'"')}function Se(e,t,n,i,r){if(r||(r=[]),i){if(e=i(e),!e)return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case p:var a=e.attributes,o=a.length,l=e.firstChild,u=e.tagName;n=s.isHTML(e.namespaceURI)||n;var c=u;if(!n&&!e.prefix&&e.namespaceURI){for(var d,h=0;h<a.length;h++)if("xmlns"===a.item(h).name){d=a.item(h).value;break}if(!d)for(var f=r.length-1;f>=0;f--){var b=r[f];if(""===b.prefix&&b.namespace===e.namespaceURI){d=b.namespace;break}}if(d!==e.namespaceURI)for(f=r.length-1;f>=0;f--){b=r[f];if(b.namespace===e.namespaceURI){b.prefix&&(c=b.prefix+":"+u);break}}}t.push("<",c);for(var x=0;x<o;x++){var k=a.item(x);"xmlns"==k.prefix?r.push({prefix:k.localName,namespace:k.value}):"xmlns"==k.nodeName&&r.push({prefix:"",namespace:k.value})}for(x=0;x<o;x++){k=a.item(x);if(_e(k,n,r)){var A=k.prefix||"",I=k.namespaceURI;Te(t,A?"xmlns:"+A:"xmlns",I),r.push({prefix:A,namespace:I})}Se(k,t,n,i,r)}if(u===c&&_e(e,n,r)){A=e.prefix||"",I=e.namespaceURI;Te(t,A?"xmlns:"+A:"xmlns",I),r.push({prefix:A,namespace:I})}if(l||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(u)){if(t.push(">"),n&&/^script$/i.test(u))while(l)l.data?t.push(l.data):Se(l,t,n,i,r.slice()),l=l.nextSibling;else while(l)Se(l,t,n,i,r.slice()),l=l.nextSibling;t.push("</",c,">")}else t.push("/>");return;case S:case E:l=e.firstChild;while(l)Se(l,t,n,i,r.slice()),l=l.nextSibling;return;case g:return Te(t,e.name,e.value);case m:return t.push(e.data.replace(/[<&>]/g,V));case v:return t.push("<![CDATA[",e.data,"]]>");case T:return t.push("\x3c!--",e.data,"--\x3e");case w:var C=e.publicId,D=e.systemId;if(t.push("<!DOCTYPE ",e.name),C)t.push(" PUBLIC ",C),D&&"."!=D&&t.push(" ",D),t.push(">");else if(D&&"."!=D)t.push(" SYSTEM ",D,">");else{var R=e.internalSubset;R&&t.push(" [",R,"]"),t.push(">")}return;case _:return t.push("<?",e.target," ",e.data,"?>");case y:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function we(e,t,n){var i;switch(t.nodeType){case p:i=t.cloneNode(!1),i.ownerDocument=e;case E:break;case g:n=!0;break}if(i||(i=t.cloneNode(!1)),i.ownerDocument=e,i.parentNode=null,n){var r=t.firstChild;while(r)i.appendChild(we(e,r,n)),r=r.nextSibling}return i}function Ee(e,t,n){var i=new t.constructor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var s=t[r];"object"!=typeof s&&s!=i[r]&&(i[r]=s)}switch(t.childNodes&&(i.childNodes=new M),i.ownerDocument=e,i.nodeType){case p:var a=t.attributes,o=i.attributes=new O,l=a.length;o._ownerElement=i;for(var u=0;u<l;u++)i.setAttributeNode(Ee(e,a.item(u),!0));break;case g:n=!0}if(n){var c=t.firstChild;while(c)i.appendChild(Ee(e,c,n)),c=c.nextSibling}return i}function xe(e,t,n){e[t]=n}R.prototype=Error.prototype,d(k,R),M.prototype={length:0,item:function(e){return e>=0&&e<this.length?this[e]:null},toString:function(e,t){for(var n=[],i=0;i<this.length;i++)Se(this[i],n,e,t);return n.join("")},filter:function(e){return Array.prototype.filter.call(this,e)},indexOf:function(e){return Array.prototype.indexOf.call(this,e)}},L.prototype.item=function(e){return P(this),this[e]||null},h(L,M),O.prototype={length:0,item:M.prototype.item,getNamedItem:function(e){var t=this.length;while(t--){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new R(D);var n=this.getNamedItem(e.nodeName);return U(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new R(D);return t=this.getNamedItemNS(e.namespaceURI,e.localName),U(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return F(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return F(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){var n=this.length;while(n--){var i=this[n];if(i.localName==t&&i.namespaceURI==e)return i}return null}},B.prototype={hasFeature:function(e,t){return!0},createDocument:function(e,t,n){var i=new $;if(i.implementation=this,i.childNodes=new M,i.doctype=n||null,n&&i.appendChild(n),t){var r=i.createElementNS(e,t);i.appendChild(r)}return i},createDocumentType:function(e,t,n){var i=new he;return i.name=e,i.nodeName=e,i.publicId=t||"",i.systemId=n||"",i}},j.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return re(this,e,t)},replaceChild:function(e,t){re(this,e,t,ie),t&&this.removeChild(t)},removeChild:function(e){return W(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return Ee(this.ownerDocument||this,this,e)},normalize:function(){var e=this.firstChild;while(e){var t=e.nextSibling;t&&t.nodeType==m&&e.nodeType==m?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){var t=this;while(t){var n=t._nsMap;if(n)for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&n[i]===e)return i;t=t.nodeType==g?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){var t=this;while(t){var n=t._nsMap;if(n&&Object.prototype.hasOwnProperty.call(n,e))return n[e];t=t.nodeType==g?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){var t=this.lookupPrefix(e);return null==t}},d(f,j),d(f,j.prototype),$.prototype={nodeName:"#document",nodeType:S,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==E){var n=e.firstChild;while(n){var i=n.nextSibling;this.insertBefore(n,t),n=i}return e}return re(this,e,t),e.ownerDocument=this,null===this.documentElement&&e.nodeType===p&&(this.documentElement=e),e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),W(this,e)},replaceChild:function(e,t){re(this,e,t,ie),e.ownerDocument=this,t&&this.removeChild(t),Q(e)&&(this.documentElement=e)},importNode:function(e,t){return we(this,e,t)},getElementById:function(e){var t=null;return H(this.documentElement,function(n){if(n.nodeType==p&&n.getAttribute("id")==e)return t=n,!0}),t},getElementsByClassName:function(e){var t=u(e);return new L(this,function(n){var i=[];return t.length>0&&H(n.documentElement,function(r){if(r!==n&&r.nodeType===p){var s=r.getAttribute("class");if(s){var a=e===s;if(!a){var o=u(s);a=t.every(c(o))}a&&i.push(r)}}}),i})},createElement:function(e){var t=new ae;t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.localName=e,t.childNodes=new M;var n=t.attributes=new O;return n._ownerElement=t,t},createDocumentFragment:function(){var e=new me;return e.ownerDocument=this,e.childNodes=new M,e},createTextNode:function(e){var t=new ue;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new ce;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new de;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new ve;return n.ownerDocument=this,n.tagName=n.nodeName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new oe;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new ge;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new ae,i=t.split(":"),r=n.attributes=new O;return n.childNodes=new M,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=t,r._ownerElement=n,n},createAttributeNS:function(e,t){var n=new oe,i=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==i.length?(n.prefix=i[0],n.localName=i[1]):n.localName=t,n}},h($,j),ae.prototype={nodeType:p,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===E?this.insertBefore(e,null):se(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var i=this.ownerDocument.createAttributeNS(e,t);i.value=i.nodeValue=""+n,this.setAttributeNode(i)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new L(this,function(t){var n=[];return H(t,function(i){i===t||i.nodeType!=p||"*"!==e&&i.tagName!=e||n.push(i)}),n})},getElementsByTagNameNS:function(e,t){return new L(this,function(n){var i=[];return H(n,function(r){r===n||r.nodeType!==p||"*"!==e&&r.namespaceURI!==e||"*"!==t&&r.localName!=t||i.push(r)}),i})}},$.prototype.getElementsByTagName=ae.prototype.getElementsByTagName,$.prototype.getElementsByTagNameNS=ae.prototype.getElementsByTagNameNS,h(ae,j),oe.prototype.nodeType=g,h(oe,j),le.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(A[I])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){var i=this.data.substring(0,e),r=this.data.substring(e+t);n=i+n+r,this.nodeValue=this.data=n,this.length=n.length}},h(le,j),ue.prototype={nodeName:"#text",nodeType:m,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var i=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(i,this.nextSibling),i}},h(ue,le),ce.prototype={nodeName:"#comment",nodeType:T},h(ce,le),de.prototype={nodeName:"#cdata-section",nodeType:v},h(de,le),he.prototype.nodeType=w,h(he,j),fe.prototype.nodeType=x,h(fe,j),pe.prototype.nodeType=b,h(pe,j),ge.prototype.nodeType=y,h(ge,j),me.prototype.nodeName="#document-fragment",me.prototype.nodeType=E,h(me,j),ve.prototype.nodeType=_,h(ve,j),ye.prototype.serializeToString=function(e,t,n){return be.call(e,t,n)},j.prototype.toString=be;try{if(Object.defineProperty){function ke(e){switch(e.nodeType){case p:case E:var t=[];e=e.firstChild;while(e)7!==e.nodeType&&8!==e.nodeType&&t.push(ke(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(L.prototype,"length",{get:function(){return P(this),this.$$length}}),Object.defineProperty(j.prototype,"textContent",{get:function(){return ke(this)},set:function(e){switch(this.nodeType){case p:case E:while(this.firstChild)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),xe=function(e,t,n){e["$$"+t]=n}}}catch(e){}t.DocumentType=he,t.DOMException=R,t.DOMImplementation=B,t.Element=ae,t.Node=j,t.NodeList=M,t.XMLSerializer=ye},e1fc:function(e,t,n){var i=n("6d8b"),r=n("d5b7"),s=n("9850"),a=function(e){for(var t in e=e||{},r.call(this,e),e)e.hasOwnProperty(t)&&(this[t]=e[t]);this._children=[],this.__storage=null,this.__dirty=!0};a.prototype={constructor:a,isGroup:!0,type:"group",silent:!1,children:function(){return this._children.slice()},childAt:function(e){return this._children[e]},childOfName:function(e){for(var t=this._children,n=0;n<t.length;n++)if(t[n].name===e)return t[n]},childCount:function(){return this._children.length},add:function(e){return e&&e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),this},addBefore:function(e,t){if(e&&e!==this&&e.parent!==this&&t&&t.parent===this){var n=this._children,i=n.indexOf(t);i>=0&&(n.splice(i,0,e),this._doAdd(e))}return this},_doAdd:function(e){e.parent&&e.parent.remove(e),e.parent=this;var t=this.__storage,n=this.__zr;t&&t!==e.__storage&&(t.addToStorage(e),e instanceof a&&e.addChildrenToStorage(t)),n&&n.refresh()},remove:function(e){var t=this.__zr,n=this.__storage,r=this._children,s=i.indexOf(r,e);return s<0?this:(r.splice(s,1),e.parent=null,n&&(n.delFromStorage(e),e instanceof a&&e.delChildrenFromStorage(n)),t&&t.refresh(),this)},removeAll:function(){var e,t,n=this._children,i=this.__storage;for(t=0;t<n.length;t++)e=n[t],i&&(i.delFromStorage(e),e instanceof a&&e.delChildrenFromStorage(i)),e.parent=null;return n.length=0,this},eachChild:function(e,t){for(var n=this._children,i=0;i<n.length;i++){var r=n[i];e.call(t,r,i)}return this},traverse:function(e,t){for(var n=0;n<this._children.length;n++){var i=this._children[n];e.call(t,i),"group"===i.type&&i.traverse(e,t)}return this},addChildrenToStorage:function(e){for(var t=0;t<this._children.length;t++){var n=this._children[t];e.addToStorage(n),n instanceof a&&n.addChildrenToStorage(e)}},delChildrenFromStorage:function(e){for(var t=0;t<this._children.length;t++){var n=this._children[t];e.delFromStorage(n),n instanceof a&&n.delChildrenFromStorage(e)}},dirty:function(){return this.__dirty=!0,this.__zr&&this.__zr.refresh(),this},getBoundingRect:function(e){for(var t=null,n=new s(0,0,0,0),i=e||this._children,r=[],a=0;a<i.length;a++){var o=i[a];if(!o.ignore&&!o.invisible){var l=o.getBoundingRect(),u=o.getLocalTransform(r);u?(n.copy(l),n.applyTransform(u),t=t||n.clone(),t.union(n)):(t=t||l.clone(),t.union(l))}}return t||n}},i.inherits(a,r);var o=a;e.exports=o},e263:function(e,t,n){var i=n("401b"),r=n("4a3f"),s=Math.min,a=Math.max,o=Math.sin,l=Math.cos,u=2*Math.PI,c=i.create(),d=i.create(),h=i.create();function f(e,t,n){if(0!==e.length){var i,r=e[0],o=r[0],l=r[0],u=r[1],c=r[1];for(i=1;i<e.length;i++)r=e[i],o=s(o,r[0]),l=a(l,r[0]),u=s(u,r[1]),c=a(c,r[1]);t[0]=o,t[1]=u,n[0]=l,n[1]=c}}function p(e,t,n,i,r,o){r[0]=s(e,n),r[1]=s(t,i),o[0]=a(e,n),o[1]=a(t,i)}var g=[],m=[];function v(e,t,n,i,o,l,u,c,d,h){var f,p=r.cubicExtrema,v=r.cubicAt,y=p(e,n,o,u,g);for(d[0]=1/0,d[1]=1/0,h[0]=-1/0,h[1]=-1/0,f=0;f<y;f++){var b=v(e,n,o,u,g[f]);d[0]=s(b,d[0]),h[0]=a(b,h[0])}for(y=p(t,i,l,c,m),f=0;f<y;f++){var _=v(t,i,l,c,m[f]);d[1]=s(_,d[1]),h[1]=a(_,h[1])}d[0]=s(e,d[0]),h[0]=a(e,h[0]),d[0]=s(u,d[0]),h[0]=a(u,h[0]),d[1]=s(t,d[1]),h[1]=a(t,h[1]),d[1]=s(c,d[1]),h[1]=a(c,h[1])}function y(e,t,n,i,o,l,u,c){var d=r.quadraticExtremum,h=r.quadraticAt,f=a(s(d(e,n,o),1),0),p=a(s(d(t,i,l),1),0),g=h(e,n,o,f),m=h(t,i,l,p);u[0]=s(e,o,g),u[1]=s(t,l,m),c[0]=a(e,o,g),c[1]=a(t,l,m)}function b(e,t,n,r,s,a,f,p,g){var m=i.min,v=i.max,y=Math.abs(s-a);if(y%u<1e-4&&y>1e-4)return p[0]=e-n,p[1]=t-r,g[0]=e+n,void(g[1]=t+r);if(c[0]=l(s)*n+e,c[1]=o(s)*r+t,d[0]=l(a)*n+e,d[1]=o(a)*r+t,m(p,c,d),v(g,c,d),s%=u,s<0&&(s+=u),a%=u,a<0&&(a+=u),s>a&&!f?a+=u:s<a&&f&&(s+=u),f){var b=a;a=s,s=b}for(var _=0;_<a;_+=Math.PI/2)_>s&&(h[0]=l(_)*n+e,h[1]=o(_)*r+t,m(p,h,p),v(g,h,g))}t.fromPoints=f,t.fromLine=p,t.fromCubic=v,t.fromQuadratic=y,t.fromArc=b},e3db:function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},e47b:function(e,t,n){var i=n("e0d3"),r=i.makeInner,s=i.normalizeToArray,a=r();function o(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i].length>t)return e[i];return e[n-1]}var l={clearColorPalette:function(){a(this).colorIdx=0,a(this).colorNameMap={}},getColorFromPalette:function(e,t,n){t=t||this;var i=a(t),r=i.colorIdx||0,l=i.colorNameMap=i.colorNameMap||{};if(l.hasOwnProperty(e))return l[e];var u=s(this.get("color",!0)),c=this.get("colorLayer",!0),d=null!=n&&c?o(c,n):u;if(d=d||u,d&&d.length){var h=d[r];return e&&(l[e]=h),i.colorIdx=(r+1)%d.length,h}}};e.exports=l},e7aa:function(e,t,n){var i=n("2306"),r=n("c775"),s=r.getDefaultLabel;function a(e,t,n,r,a,l,u){var c=n.getModel("label"),d=n.getModel("emphasis.label");i.setLabelStyle(e,t,c,d,{labelFetcher:a,labelDataIndex:l,defaultText:s(a.getData(),l),isRectText:!0,autoColor:r}),o(e),o(t)}function o(e,t){"outside"===e.textPosition&&(e.textPosition=t)}t.setLabel=a},e7d2:function(e,t,n){var i=n("4a3f");function r(e,t,n,r,s,a,o,l,u,c,d){if(0===u)return!1;var h=u;if(d>t+h&&d>r+h&&d>a+h&&d>l+h||d<t-h&&d<r-h&&d<a-h&&d<l-h||c>e+h&&c>n+h&&c>s+h&&c>o+h||c<e-h&&c<n-h&&c<s-h&&c<o-h)return!1;var f=i.cubicProjectPoint(e,t,n,r,s,a,o,l,c,d,null);return f<=h/2}t.containStroke=r},e86a:function(e,t,n){var i=n("9850"),r=n("5e76"),s=n("6d8b"),a=s.getContext,o=s.extend,l=s.retrieve2,u=s.retrieve3,c=s.trim,d={},h=0,f=5e3,p=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g,g="12px sans-serif",m={};function v(e,t){m[e]=t}function y(e,t){t=t||g;var n=e+":"+t;if(d[n])return d[n];for(var i=(e+"").split("\n"),r=0,s=0,a=i.length;s<a;s++)r=Math.max(D(i[s],t).width,r);return h>f&&(h=0,d={}),h++,d[n]=r,r}function b(e,t,n,i,r,s,a){return s?T(e,t,n,i,r,s,a):_(e,t,n,i,r,a)}function _(e,t,n,r,s,a){var o=R(e,t,s,a),l=y(e,t);s&&(l+=s[1]+s[3]);var u=o.outerHeight,c=S(0,l,n),d=w(0,u,r),h=new i(c,d,l,u);return h.lineHeight=o.lineHeight,h}function T(e,t,n,r,s,a,o){var l=M(e,{rich:a,truncate:o,font:t,textAlign:n,textPadding:s}),u=l.outerWidth,c=l.outerHeight,d=S(0,u,n),h=w(0,c,r);return new i(d,h,u,c)}function S(e,t,n){return"right"===n?e-=t:"center"===n&&(e-=t/2),e}function w(e,t,n){return"middle"===n?e-=t/2:"bottom"===n&&(e-=t),e}function E(e,t,n){var i=t.x,r=t.y,s=t.height,a=t.width,o=s/2,l="left",u="top";switch(e){case"left":i-=n,r+=o,l="right",u="middle";break;case"right":i+=n+a,r+=o,u="middle";break;case"top":i+=a/2,r-=n,l="center",u="bottom";break;case"bottom":i+=a/2,r+=s+n,l="center";break;case"inside":i+=a/2,r+=o,l="center",u="middle";break;case"insideLeft":i+=n,r+=o,u="middle";break;case"insideRight":i+=a-n,r+=o,l="right",u="middle";break;case"insideTop":i+=a/2,r+=n,l="center";break;case"insideBottom":i+=a/2,r+=s-n,l="center",u="bottom";break;case"insideTopLeft":i+=n,r+=n;break;case"insideTopRight":i+=a-n,r+=n,l="right";break;case"insideBottomLeft":i+=n,r+=s-n,u="bottom";break;case"insideBottomRight":i+=a-n,r+=s-n,l="right",u="bottom";break}return{x:i,y:r,textAlign:l,textVerticalAlign:u}}function x(e,t,n,i,r){if(!t)return"";var s=(e+"").split("\n");r=k(t,n,i,r);for(var a=0,o=s.length;a<o;a++)s[a]=A(s[a],r);return s.join("\n")}function k(e,t,n,i){i=o({},i),i.font=t;n=l(n,"...");i.maxIterations=l(i.maxIterations,2);var r=i.minChar=l(i.minChar,0);i.cnCharWidth=y("",t);var s=i.ascCharWidth=y("a",t);i.placeholder=l(i.placeholder,"");for(var a=e=Math.max(0,e-1),u=0;u<r&&a>=s;u++)a-=s;var c=y(n);return c>a&&(n="",c=0),a=e-c,i.ellipsis=n,i.ellipsisWidth=c,i.contentWidth=a,i.containerWidth=e,i}function A(e,t){var n=t.containerWidth,i=t.font,r=t.contentWidth;if(!n)return"";var s=y(e,i);if(s<=n)return e;for(var a=0;;a++){if(s<=r||a>=t.maxIterations){e+=t.ellipsis;break}var o=0===a?I(e,r,t.ascCharWidth,t.cnCharWidth):s>0?Math.floor(e.length*r/s):0;e=e.substr(0,o),s=y(e,i)}return""===e&&(e=t.placeholder),e}function I(e,t,n,i){for(var r=0,s=0,a=e.length;s<a&&r<t;s++){var o=e.charCodeAt(s);r+=0<=o&&o<=127?n:i}return s}function C(e){return y("",e)}function D(e,t){return m.measureText(e,t)}function R(e,t,n,i){null!=e&&(e+="");var r=C(t),s=e?e.split("\n"):[],a=s.length*r,o=a;if(n&&(o+=n[0]+n[2]),e&&i){var l=i.outerHeight,u=i.outerWidth;if(null!=l&&o>l)e="",s=[];else if(null!=u)for(var c=k(u-(n?n[1]+n[3]:0),t,i.ellipsis,{minChar:i.minChar,placeholder:i.placeholder}),d=0,h=s.length;d<h;d++)s[d]=A(s[d],c)}return{lines:s,height:a,outerHeight:o,lineHeight:r}}function M(e,t){var n={lines:[],width:0,height:0};if(null!=e&&(e+=""),!e)return n;var i,s=p.lastIndex=0;while(null!=(i=p.exec(e))){var a=i.index;a>s&&L(n,e.substring(s,a)),L(n,i[2],i[1]),s=p.lastIndex}s<e.length&&L(n,e.substring(s,e.length));var o=n.lines,c=0,d=0,h=[],f=t.textPadding,g=t.truncate,m=g&&g.outerWidth,v=g&&g.outerHeight;f&&(null!=m&&(m-=f[1]+f[3]),null!=v&&(v-=f[0]+f[2]));for(var b=0;b<o.length;b++){for(var _=o[b],T=0,S=0,w=0;w<_.tokens.length;w++){var E=_.tokens[w],k=E.styleName&&t.rich[E.styleName]||{},A=E.textPadding=k.textPadding,I=E.font=k.font||t.font,D=E.textHeight=l(k.textHeight,C(I));if(A&&(D+=A[0]+A[2]),E.height=D,E.lineHeight=u(k.textLineHeight,t.textLineHeight,D),E.textAlign=k&&k.textAlign||t.textAlign,E.textVerticalAlign=k&&k.textVerticalAlign||"middle",null!=v&&c+E.lineHeight>v)return{lines:[],width:0,height:0};E.textWidth=y(E.text,I);var R=k.textWidth,M=null==R||"auto"===R;if("string"===typeof R&&"%"===R.charAt(R.length-1))E.percentWidth=R,h.push(E),R=0;else{if(M){R=E.textWidth;var P=k.textBackgroundColor,O=P&&P.image;O&&(O=r.findExistImage(O),r.isImageReady(O)&&(R=Math.max(R,O.width*D/O.height)))}var N=A?A[1]+A[3]:0;R+=N;var U=null!=m?m-S:null;null!=U&&U<R&&(!M||U<N?(E.text="",E.textWidth=R=0):(E.text=x(E.text,U-N,I,g.ellipsis,{minChar:g.minChar}),E.textWidth=y(E.text,I),R=E.textWidth+N))}S+=E.width=R,k&&(T=Math.max(T,E.lineHeight))}_.width=S,_.lineHeight=T,c+=T,d=Math.max(d,S)}n.outerWidth=n.width=l(t.textWidth,d),n.outerHeight=n.height=l(t.textHeight,c),f&&(n.outerWidth+=f[1]+f[3],n.outerHeight+=f[0]+f[2]);for(b=0;b<h.length;b++){E=h[b];var F=E.percentWidth;E.width=parseInt(F,10)/100*d}return n}function L(e,t,n){for(var i=""===t,r=t.split("\n"),s=e.lines,a=0;a<r.length;a++){var o=r[a],l={styleName:n,text:o,isLineHolder:!o&&!i};if(a)s.push({tokens:[l]});else{var u=(s[s.length-1]||(s[0]={tokens:[]})).tokens,c=u.length;1===c&&u[0].isLineHolder?u[0]=l:(o||!c||i)&&u.push(l)}}}function P(e){var t=(e.fontSize||e.fontFamily)&&[e.fontStyle,e.fontWeight,(e.fontSize||12)+"px",e.fontFamily||"sans-serif"].join(" ");return t&&c(t)||e.textFont||e.font}m.measureText=function(e,t){var n=a();return n.font=t||g,n.measureText(e)},t.DEFAULT_FONT=g,t.$override=v,t.getWidth=y,t.getBoundingRect=b,t.adjustTextX=S,t.adjustTextY=w,t.adjustTextPositionOnRect=E,t.truncateText=x,t.getLineHeight=C,t.measureText=D,t.parsePlainText=R,t.parseRichText=M,t.makeFont=P},e887:function(e,t,n){var i=n("6d8b"),r=i.each,s=n("e1fc"),a=n("8918"),o=n("625e"),l=n("e0d3"),u=n("f47d"),c=u.createTask,d=n("cccd"),h=l.makeInner(),f=d();function p(){this.group=new s,this.uid=a.getUID("viewChart"),this.renderTask=c({plan:y,reset:b}),this.renderTask.context={view:this}}p.prototype={type:"chart",init:function(e,t){},render:function(e,t,n,i){},highlight:function(e,t,n,i){v(e.getData(),i,"emphasis")},downplay:function(e,t,n,i){v(e.getData(),i,"normal")},remove:function(e,t){this.group.removeAll()},dispose:function(){},incrementalPrepareRender:null,incrementalRender:null,updateTransform:null};var g=p.prototype;function m(e,t){if(e&&(e.trigger(t),"group"===e.type))for(var n=0;n<e.childCount();n++)m(e.childAt(n),t)}function v(e,t,n){var i=l.queryDataIndex(e,t);null!=i?r(l.normalizeToArray(i),function(t){m(e.getItemGraphicEl(t),n)}):e.eachItemGraphicEl(function(e){m(e,n)})}function y(e){return f(e.model)}function b(e){var t=e.model,n=e.ecModel,i=e.api,r=e.payload,s=t.pipelineContext.progressiveRender,a=e.view,o=r&&h(r).updateMethod,l=s?"incrementalPrepareRender":o&&a[o]?o:"render";return"render"!==l&&a[l](t,n,i,r),_[l]}g.updateView=g.updateLayout=g.updateVisual=function(e,t,n,i){this.render(e,t,n,i)},o.enableClassExtend(p,["dispose"]),o.enableClassManagement(p,{registerWhenExtend:!0}),p.markUpdateMethod=function(e,t){h(e).updateMethod=t};var _={incrementalPrepareRender:{progress:function(e,t){t.view.incrementalRender(e,t.model,t.ecModel,t.api,t.payload)}},render:{forceFirstProgress:!0,progress:function(e,t){t.view.render(t.model,t.ecModel,t.api,t.payload)}}},T=p;e.exports=T},eb6b:function(e,t,n){var i=n("6d8b"),r=n("e0d3"),s=r.makeInner,a=n("cd33"),o=n("133d"),l=i.each,u=i.curry,c=s();function d(e,t,n){var r=e.currTrigger,s=[e.x,e.y],a=e,c=e.dispatchAction||i.bind(n.dispatchAction,n),d=t.getComponent("axisPointer").coordSysAxesInfo;if(d){T(s)&&(s=o({seriesIndex:a.seriesIndex,dataIndex:a.dataIndex},t).point);var f=T(s),S=a.axesInfo,w=d.axesInfo,E="leave"===r||T(s),x={},k={},A={list:[],map:{}},I={showPointer:u(p,k),showTooltip:u(g,A)};l(d.coordSysMap,function(e,t){var n=f||e.containPoint(s);l(d.coordSysAxesInfo[t],function(e,t){var i=e.axis,r=b(S,e);if(!E&&n&&(!S||r)){var a=r&&r.value;null!=a||f||(a=i.pointToData(s)),null!=a&&h(e,a,I,!1,x)}})});var C={};return l(w,function(e,t){var n=e.linkGroup;n&&!k[t]&&l(n.axesInfo,function(t,i){var r=k[i];if(t!==e&&r){var s=r.value;n.mapper&&(s=e.axis.scale.parse(n.mapper(s,_(t),_(e)))),C[e.key]=s}})}),l(C,function(e,t){h(w[t],e,I,!0,x)}),m(k,w,x),v(A,s,e,c),y(w,c,n),x}}function h(e,t,n,r,s){var a=e.axis;if(!a.scale.isBlank()&&a.containData(t))if(e.involveSeries){var o=f(t,e),l=o.payloadBatch,u=o.snapToValue;l[0]&&null==s.seriesIndex&&i.extend(s,l[0]),!r&&e.snap&&a.containData(u)&&null!=u&&(t=u),n.showPointer(e,t,l,s),n.showTooltip(e,o,u)}else n.showPointer(e,t)}function f(e,t){var n=t.axis,i=n.dim,r=e,s=[],a=Number.MAX_VALUE,o=-1;return l(t.seriesModels,function(t,u){var c,d,h=t.getData().mapDimension(i,!0);if(t.getAxisTooltipData){var f=t.getAxisTooltipData(h,e,n);d=f.dataIndices,c=f.nestestValue}else{if(d=t.getData().indicesOfNearest(h[0],e,"category"===n.type?.5:null),!d.length)return;c=t.getData().get(h[0],d[0])}if(null!=c&&isFinite(c)){var p=e-c,g=Math.abs(p);g<=a&&((g<a||p>=0&&o<0)&&(a=g,o=p,r=c,s.length=0),l(d,function(e){s.push({seriesIndex:t.seriesIndex,dataIndexInside:e,dataIndex:t.getData().getRawIndex(e)})}))}}),{payloadBatch:s,snapToValue:r}}function p(e,t,n,i){e[t.key]={value:n,payloadBatch:i}}function g(e,t,n,i){var r=n.payloadBatch,s=t.axis,o=s.model,l=t.axisPointerModel;if(t.triggerTooltip&&r.length){var u=t.coordSys.model,c=a.makeKey(u),d=e.map[c];d||(d=e.map[c]={coordSysId:u.id,coordSysIndex:u.componentIndex,coordSysType:u.type,coordSysMainType:u.mainType,dataByAxis:[]},e.list.push(d)),d.dataByAxis.push({axisDim:s.dim,axisIndex:o.componentIndex,axisType:o.type,axisId:o.id,value:i,valueLabelOpt:{precision:l.get("label.precision"),formatter:l.get("label.formatter")},seriesDataIndices:r.slice()})}}function m(e,t,n){var i=n.axesInfo=[];l(t,function(t,n){var r=t.axisPointerModel.option,s=e[n];s?(!t.useHandle&&(r.status="show"),r.value=s.value,r.seriesDataIndices=(s.payloadBatch||[]).slice()):!t.useHandle&&(r.status="hide"),"show"===r.status&&i.push({axisDim:t.axis.dim,axisIndex:t.axis.model.componentIndex,value:r.value})})}function v(e,t,n,i){if(!T(t)&&e.list.length){var r=((e.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};i({type:"showTip",escapeConnect:!0,x:t[0],y:t[1],tooltipOption:n.tooltipOption,position:n.position,dataIndexInside:r.dataIndexInside,dataIndex:r.dataIndex,seriesIndex:r.seriesIndex,dataByCoordSys:e.list})}else i({type:"hideTip"})}function y(e,t,n){var r=n.getZr(),s="axisPointerLastHighlights",a=c(r)[s]||{},o=c(r)[s]={};l(e,function(e,t){var n=e.axisPointerModel.option;"show"===n.status&&l(n.seriesDataIndices,function(e){var t=e.seriesIndex+" | "+e.dataIndex;o[t]=e})});var u=[],d=[];i.each(a,function(e,t){!o[t]&&d.push(e)}),i.each(o,function(e,t){!a[t]&&u.push(e)}),d.length&&n.dispatchAction({type:"downplay",escapeConnect:!0,batch:d}),u.length&&n.dispatchAction({type:"highlight",escapeConnect:!0,batch:u})}function b(e,t){for(var n=0;n<(e||[]).length;n++){var i=e[n];if(t.axis.dim===i.axisDim&&t.axis.model.componentIndex===i.axisIndex)return i}}function _(e){var t=e.axis.model,n={},i=n.axisDim=e.axis.dim;return n.axisIndex=n[i+"AxisIndex"]=t.componentIndex,n.axisName=n[i+"AxisName"]=t.name,n.axisId=n[i+"AxisId"]=t.id,n}function T(e){return!e||null==e[0]||isNaN(e[0])||null==e[1]||isNaN(e[1])}e.exports=d},ebd6:function(e,t,n){var i=n("cb7c"),r=n("d8e8"),s=n("2b4c")("species");e.exports=function(e,t){var n,a=i(e).constructor;return void 0===a||void 0==(n=i(a)[s])?t:r(n)}},ec02:function(e,t,n){var i=n("6d8b"),r=n("84ce"),s=function(e,t,n,i,s){r.call(this,e,t,n),this.type=i||"value",this.position=s||"bottom"};s.prototype={constructor:s,index:0,getAxesOnZeroOf:null,model:null,isHorizontal:function(){var e=this.position;return"top"===e||"bottom"===e},getGlobalExtent:function(e){var t=this.getExtent();return t[0]=this.toGlobalCoord(t[0]),t[1]=this.toGlobalCoord(t[1]),e&&t[0]>t[1]&&t.reverse(),t},getOtherAxis:function(){this.grid.getOtherAxis()},pointToData:function(e,t){return this.coordToData(this.toLocalCoord(e["x"===this.dim?0:1]),t)},toLocalCoord:null,toGlobalCoord:null},i.inherits(s,r);var a=s;e.exports=a},ec6f:function(e,t,n){var i=n("6d8b"),r=i.createHashMap,s=i.isTypedArray,a=n("625e"),o=a.enableClassCheck,l=n("93d0"),u=l.SOURCE_FORMAT_ORIGINAL,c=l.SERIES_LAYOUT_BY_COLUMN,d=l.SOURCE_FORMAT_UNKNOWN,h=l.SOURCE_FORMAT_TYPED_ARRAY,f=l.SOURCE_FORMAT_KEYED_COLUMNS;function p(e){this.fromDataset=e.fromDataset,this.data=e.data||(e.sourceFormat===f?{}:[]),this.sourceFormat=e.sourceFormat||d,this.seriesLayoutBy=e.seriesLayoutBy||c,this.dimensionsDefine=e.dimensionsDefine,this.encodeDefine=e.encodeDefine&&r(e.encodeDefine),this.startIndex=e.startIndex||0,this.dimensionsDetectCount=e.dimensionsDetectCount}p.seriesDataToSource=function(e){return new p({data:e,sourceFormat:s(e)?h:u,fromDataset:!1})},o(p);var g=p;e.exports=g},ed21:function(e,t,n){var i=n("2cf4"),r=i.devicePixelRatio,s=n("6d8b"),a=n("4942"),o=n("9850"),l=n("04f6"),u=n("5e68"),c=n("98b7"),d=n("0da8"),h=n("22d1"),f=1e5,p=314159,g=.01,m=.001;function v(e){return parseInt(e,10)}function y(e){return!!e&&(!!e.__builtin__||"function"===typeof e.resize&&"function"===typeof e.refresh)}var b=new o(0,0,0,0),_=new o(0,0,0,0);function T(e,t,n){return b.copy(e.getBoundingRect()),e.transform&&b.applyTransform(e.transform),_.width=t,_.height=n,!b.intersect(_)}function S(e,t){if(e==t)return!1;if(!e||!t||e.length!==t.length)return!0;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!0}function w(e,t){for(var n=0;n<e.length;n++){var i=e[n];i.setTransform(t),t.beginPath(),i.buildPath(t,i.shape),t.clip(),i.restoreTransform(t)}}function E(e,t){var n=document.createElement("div");return n.style.cssText=["position:relative","overflow:hidden","width:"+e+"px","height:"+t+"px","padding:0","margin:0","border-width:0"].join(";")+";",n}var x=function(e,t,n){this.type="canvas";var i=!e.nodeName||"CANVAS"===e.nodeName.toUpperCase();this._opts=n=s.extend({},n||{}),this.dpr=n.devicePixelRatio||r,this._singleCanvas=i,this.root=e;var a=e.style;a&&(a["-webkit-tap-highlight-color"]="transparent",a["-webkit-user-select"]=a["user-select"]=a["-webkit-touch-callout"]="none",e.innerHTML=""),this.storage=t;var o=this._zlevelList=[],l=this._layers={};if(this._layerConfig={},this._needsManuallyCompositing=!1,i){var c=e.width,d=e.height;null!=n.width&&(c=n.width),null!=n.height&&(d=n.height),this.dpr=n.devicePixelRatio||1,e.width=c*this.dpr,e.height=d*this.dpr,this._width=c,this._height=d;var h=new u(e,this,this.dpr);h.__builtin__=!0,h.initContext(),l[p]=h,h.zlevel=p,o.push(p),this._domRoot=e}else{this._width=this._getSize(0),this._height=this._getSize(1);var f=this._domRoot=E(this._width,this._height);e.appendChild(f)}this._hoverlayer=null,this._hoverElements=[]};x.prototype={constructor:x,getType:function(){return"canvas"},isSingleCanvas:function(){return this._singleCanvas},getViewportRoot:function(){return this._domRoot},getViewportRootOffset:function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},refresh:function(e){var t=this.storage.getDisplayList(!0),n=this._zlevelList;this._redrawId=Math.random(),this._paintList(t,e,this._redrawId);for(var i=0;i<n.length;i++){var r=n[i],s=this._layers[r];if(!s.__builtin__&&s.refresh){var a=0===i?this._backgroundColor:null;s.refresh(a)}}return this.refreshHover(),this},addHover:function(e,t){if(!e.__hoverMir){var n=new e.constructor({style:e.style,shape:e.shape});n.__from=e,e.__hoverMir=n,n.setStyle(t),this._hoverElements.push(n)}},removeHover:function(e){var t=e.__hoverMir,n=this._hoverElements,i=s.indexOf(n,t);i>=0&&n.splice(i,1),e.__hoverMir=null},clearHover:function(e){for(var t=this._hoverElements,n=0;n<t.length;n++){var i=t[n].__from;i&&(i.__hoverMir=null)}t.length=0},refreshHover:function(){var e=this._hoverElements,t=e.length,n=this._hoverlayer;if(n&&n.clear(),t){l(e,this.storage.displayableSortFunc),n||(n=this._hoverlayer=this.getLayer(f));var i={};n.ctx.save();for(var r=0;r<t;){var s=e[r],a=s.__from;a&&a.__zr?(r++,a.invisible||(s.transform=a.transform,s.invTransform=a.invTransform,s.__clipPaths=a.__clipPaths,this._doPaintEl(s,n,!0,i))):(e.splice(r,1),a.__hoverMir=null,t--)}n.ctx.restore()}},getHoverLayer:function(){return this.getLayer(f)},_paintList:function(e,t,n){if(this._redrawId===n){t=t||!1,this._updateLayerStatus(e);var i=this._doPaintList(e,t);if(this._needsManuallyCompositing&&this._compositeManually(),!i){var r=this;c(function(){r._paintList(e,t,n)})}}},_compositeManually:function(){var e=this.getLayer(p).ctx,t=this._domRoot.width,n=this._domRoot.height;e.clearRect(0,0,t,n),this.eachBuiltinLayer(function(i){i.virtual&&e.drawImage(i.dom,0,0,t,n)})},_doPaintList:function(e,t){for(var n=[],i=0;i<this._zlevelList.length;i++){var r=this._zlevelList[i],a=this._layers[r];a.__builtin__&&a!==this._hoverlayer&&(a.__dirty||t)&&n.push(a)}for(var o=!0,l=0;l<n.length;l++){a=n[l];var u=a.ctx,c={};u.save();var d=t?a.__startIndex:a.__drawIndex,f=!t&&a.incremental&&Date.now,p=f&&Date.now(),g=a.zlevel===this._zlevelList[0]?this._backgroundColor:null;if(a.__startIndex===a.__endIndex)a.clear(!1,g);else if(d===a.__startIndex){var m=e[d];m.incremental&&m.notClear&&!t||a.clear(!1,g)}-1===d&&(console.error("For some unknown reason. drawIndex is -1"),d=a.__startIndex);for(var v=d;v<a.__endIndex;v++){var y=e[v];if(this._doPaintEl(y,a,t,c),y.__dirty=!1,f){var b=Date.now()-p;if(b>15)break}}a.__drawIndex=v,a.__drawIndex<a.__endIndex&&(o=!1),c.prevElClipPaths&&u.restore(),u.restore()}return h.wxa&&s.each(this._layers,function(e){e&&e.ctx&&e.ctx.draw&&e.ctx.draw()}),o},_doPaintEl:function(e,t,n,i){var r=t.ctx,s=e.transform;if((t.__dirty||n)&&!e.invisible&&0!==e.style.opacity&&(!s||s[0]||s[3])&&(!e.culling||!T(e,this._width,this._height))){var a=e.__clipPaths;i.prevElClipPaths&&!S(a,i.prevElClipPaths)||(i.prevElClipPaths&&(t.ctx.restore(),i.prevElClipPaths=null,i.prevEl=null),a&&(r.save(),w(a,r),i.prevElClipPaths=a)),e.beforeBrush&&e.beforeBrush(r),e.brush(r,i.prevEl||null),i.prevEl=e,e.afterBrush&&e.afterBrush(r)}},getLayer:function(e,t){this._singleCanvas&&!this._needsManuallyCompositing&&(e=p);var n=this._layers[e];return n||(n=new u("zr_"+e,this,this.dpr),n.zlevel=e,n.__builtin__=!0,this._layerConfig[e]&&s.merge(n,this._layerConfig[e],!0),t&&(n.virtual=t),this.insertLayer(e,n),n.initContext()),n},insertLayer:function(e,t){var n=this._layers,i=this._zlevelList,r=i.length,s=null,o=-1,l=this._domRoot;if(n[e])a("ZLevel "+e+" has been used already");else if(y(t)){if(r>0&&e>i[0]){for(o=0;o<r-1;o++)if(i[o]<e&&i[o+1]>e)break;s=n[i[o]]}if(i.splice(o+1,0,e),n[e]=t,!t.virtual)if(s){var u=s.dom;u.nextSibling?l.insertBefore(t.dom,u.nextSibling):l.appendChild(t.dom)}else l.firstChild?l.insertBefore(t.dom,l.firstChild):l.appendChild(t.dom)}else a("Layer of zlevel "+e+" is not valid")},eachLayer:function(e,t){var n,i,r=this._zlevelList;for(i=0;i<r.length;i++)n=r[i],e.call(t,this._layers[n],n)},eachBuiltinLayer:function(e,t){var n,i,r,s=this._zlevelList;for(r=0;r<s.length;r++)i=s[r],n=this._layers[i],n.__builtin__&&e.call(t,n,i)},eachOtherLayer:function(e,t){var n,i,r,s=this._zlevelList;for(r=0;r<s.length;r++)i=s[r],n=this._layers[i],n.__builtin__||e.call(t,n,i)},getLayers:function(){return this._layers},_updateLayerStatus:function(e){function t(e){r&&(r.__endIndex!==e&&(r.__dirty=!0),r.__endIndex=e)}if(this.eachBuiltinLayer(function(e,t){e.__dirty=e.__used=!1}),this._singleCanvas)for(var n=1;n<e.length;n++){var i=e[n];if(i.zlevel!==e[n-1].zlevel||i.incremental){this._needsManuallyCompositing=!0;break}}var r=null,s=0;for(n=0;n<e.length;n++){i=e[n];var o,l=i.zlevel;i.incremental?(o=this.getLayer(l+m,this._needsManuallyCompositing),o.incremental=!0,s=1):o=this.getLayer(l+(s>0?g:0),this._needsManuallyCompositing),o.__builtin__||a("ZLevel "+l+" has been used by unkown layer "+o.id),o!==r&&(o.__used=!0,o.__startIndex!==n&&(o.__dirty=!0),o.__startIndex=n,o.incremental?o.__drawIndex=-1:o.__drawIndex=n,t(n),r=o),i.__dirty&&(o.__dirty=!0,o.incremental&&o.__drawIndex<0&&(o.__drawIndex=n))}t(n),this.eachBuiltinLayer(function(e,t){!e.__used&&e.getElementCount()>0&&(e.__dirty=!0,e.__startIndex=e.__endIndex=e.__drawIndex=0),e.__dirty&&e.__drawIndex<0&&(e.__drawIndex=e.__startIndex)})},clear:function(){return this.eachBuiltinLayer(this._clearLayer),this},_clearLayer:function(e){e.clear()},setBackgroundColor:function(e){this._backgroundColor=e},configLayer:function(e,t){if(t){var n=this._layerConfig;n[e]?s.merge(n[e],t,!0):n[e]=t;for(var i=0;i<this._zlevelList.length;i++){var r=this._zlevelList[i];if(r===e||r===e+g){var a=this._layers[r];s.merge(a,n[e],!0)}}}},delLayer:function(e){var t=this._layers,n=this._zlevelList,i=t[e];i&&(i.dom.parentNode.removeChild(i.dom),delete t[e],n.splice(s.indexOf(n,e),1))},resize:function(e,t){if(this._domRoot.style){var n=this._domRoot;n.style.display="none";var i=this._opts;if(null!=e&&(i.width=e),null!=t&&(i.height=t),e=this._getSize(0),t=this._getSize(1),n.style.display="",this._width!=e||t!=this._height){for(var r in n.style.width=e+"px",n.style.height=t+"px",this._layers)this._layers.hasOwnProperty(r)&&this._layers[r].resize(e,t);s.each(this._progressiveLayers,function(n){n.resize(e,t)}),this.refresh(!0)}this._width=e,this._height=t}else{if(null==e||null==t)return;this._width=e,this._height=t,this.getLayer(p).resize(e,t)}return this},clearLayer:function(e){var t=this._layers[e];t&&t.clear()},dispose:function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},getRenderedCanvas:function(e){if(e=e||{},this._singleCanvas&&!this._compositeManually)return this._layers[p].dom;var t=new u("image",this,e.pixelRatio||this.dpr);if(t.initContext(),t.clear(!1,e.backgroundColor||this._backgroundColor),e.pixelRatio<=this.dpr){this.refresh();var n=t.dom.width,i=t.dom.height,r=t.ctx;this.eachLayer(function(e){e.__builtin__?r.drawImage(e.dom,0,0,n,i):e.renderToCanvas&&(t.ctx.save(),e.renderToCanvas(t.ctx),t.ctx.restore())})}else for(var s={},a=this.storage.getDisplayList(!0),o=0;o<a.length;o++){var l=a[o];this._doPaintEl(l,t,!0,s)}return t.dom},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(e){var t=this._opts,n=["width","height"][e],i=["clientWidth","clientHeight"][e],r=["paddingLeft","paddingTop"][e],s=["paddingRight","paddingBottom"][e];if(null!=t[n]&&"auto"!==t[n])return parseFloat(t[n]);var a=this.root,o=document.defaultView.getComputedStyle(a);return(a[i]||v(o[n])||v(a.style[n]))-(v(o[r])||0)-(v(o[s])||0)|0},pathToImage:function(e,t){t=t||this.dpr;var n=document.createElement("canvas"),i=n.getContext("2d"),r=e.getBoundingRect(),s=e.style,a=s.shadowBlur*t,o=s.shadowOffsetX*t,l=s.shadowOffsetY*t,u=s.hasStroke()?s.lineWidth:0,c=Math.max(u/2,-o+a),h=Math.max(u/2,o+a),f=Math.max(u/2,-l+a),p=Math.max(u/2,l+a),g=r.width+c+h,m=r.height+f+p;n.width=g*t,n.height=m*t,i.scale(t,t),i.clearRect(0,0,g,m),i.dpr=t;var v={position:e.position,rotation:e.rotation,scale:e.scale};e.position=[c-r.x,f-r.y],e.rotation=0,e.scale=[1,1],e.updateTransform(),e&&e.brush(i);var y=d,b=new y({style:{x:0,y:0,image:n}});return null!=v.position&&(b.position=e.position=v.position),null!=v.rotation&&(b.rotation=e.rotation=v.rotation),null!=v.scale&&(b.scale=e.scale=v.scale),b}};var k=x;e.exports=k},eda2:function(e,t,n){var i=n("6d8b"),r=n("e86a"),s=n("3842");function a(e){return isNaN(e)?"-":(e=(e+"").split("."),e[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(e.length>1?"."+e[1]:""))}function o(e,t){return e=(e||"").toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()}),t&&e&&(e=e.charAt(0).toUpperCase()+e.slice(1)),e}var l=i.normalizeCssArray,u=/([&<>"'])/g,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function d(e){return null==e?"":(e+"").replace(u,function(e,t){return c[t]})}var h=["a","b","c","d","e","f","g"],f=function(e,t){return"{"+e+(null==t?"":t)+"}"};function p(e,t,n){i.isArray(t)||(t=[t]);var r=t.length;if(!r)return"";for(var s=t[0].$vars||[],a=0;a<s.length;a++){var o=h[a];e=e.replace(f(o),f(o,0))}for(var l=0;l<r;l++)for(var u=0;u<s.length;u++){var c=t[l][s[u]];e=e.replace(f(h[u],l),n?d(c):c)}return e}function g(e,t,n){return i.each(t,function(t,i){e=e.replace("{"+i+"}",n?d(t):t)}),e}function m(e,t){e=i.isString(e)?{color:e,extraCssText:t}:e||{};var n=e.color,r=e.type;t=e.extraCssText;return n?"subItem"===r?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+d(n)+";"+(t||"")+'"></span>':'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+d(n)+";"+(t||"")+'"></span>':""}function v(e,t){return e+="","0000".substr(0,t-e.length)+e}function y(e,t,n){"week"!==e&&"month"!==e&&"quarter"!==e&&"half-year"!==e&&"year"!==e||(e="MM-dd\nyyyy");var i=s.parseDate(t),r=n?"UTC":"",a=i["get"+r+"FullYear"](),o=i["get"+r+"Month"]()+1,l=i["get"+r+"Date"](),u=i["get"+r+"Hours"](),c=i["get"+r+"Minutes"](),d=i["get"+r+"Seconds"](),h=i["get"+r+"Milliseconds"]();return e=e.replace("MM",v(o,2)).replace("M",o).replace("yyyy",a).replace("yy",a%100).replace("dd",v(l,2)).replace("d",l).replace("hh",v(u,2)).replace("h",u).replace("mm",v(c,2)).replace("m",c).replace("ss",v(d,2)).replace("s",d).replace("SSS",v(h,3)),e}function b(e){return e?e.charAt(0).toUpperCase()+e.substr(1):e}var _=r.truncateText,T=r.getBoundingRect;t.addCommas=a,t.toCamelCase=o,t.normalizeCssArray=l,t.encodeHTML=d,t.formatTpl=p,t.formatTplSimple=g,t.getTooltipMarker=m,t.formatTime=y,t.capitalFirst=b,t.truncateText=_,t.getTextRect=T},ee1a:function(e,t,n){var i=n("6d8b"),r=i.each,s=i.isString;function a(e,t,n){n=n||{};var i,a,o,l,u=n.byIndex,c=n.stackedCoordDimension,d=!(!e||!e.get("stack"));if(r(t,function(e,n){s(e)&&(t[n]=e={name:e}),d&&!e.isExtraCoord&&(u||i||!e.ordinalMeta||(i=e),a||"ordinal"===e.type||"time"===e.type||c&&c!==e.coordDim||(a=e))}),!a||u||i||(u=!0),a){o="__\0ecstackresult",l="__\0ecstackedover",i&&(i.createInvertedIndices=!0);var h=a.coordDim,f=a.type,p=0;r(t,function(e){e.coordDim===h&&p++}),t.push({name:o,coordDim:h,coordDimIndex:p,type:f,isExtraCoord:!0,isCalculationCoord:!0}),p++,t.push({name:l,coordDim:l,coordDimIndex:p,type:f,isExtraCoord:!0,isCalculationCoord:!0})}return{stackedDimension:a&&a.name,stackedByDimension:i&&i.name,isStackedByIndex:u,stackedOverDimension:l,stackResultDimension:o}}function o(e,t){return!!t&&t===e.getCalculationInfo("stackedDimension")}function l(e,t){return o(e,t)?e.getCalculationInfo("stackResultDimension"):t}t.enableDataStack=a,t.isDimensionStacked=o,t.getStackedDimension=l},ee84:function(e,t,n){var i=n("20c8"),r=n("401b"),s=r.applyTransform,a=i.CMD,o=[[],[],[]],l=Math.sqrt,u=Math.atan2;function c(e,t){var n,i,r,c,d,h=e.data,f=a.M,p=a.C,g=a.L,m=a.R,v=a.A,y=a.Q;for(r=0,c=0;r<h.length;){switch(n=h[r++],c=r,i=0,n){case f:i=1;break;case g:i=1;break;case p:i=3;break;case y:i=2;break;case v:var b=t[4],_=t[5],T=l(t[0]*t[0]+t[1]*t[1]),S=l(t[2]*t[2]+t[3]*t[3]),w=u(-t[1]/S,t[0]/T);h[r]*=T,h[r++]+=b,h[r]*=S,h[r++]+=_,h[r++]*=T,h[r++]*=S,h[r++]+=w,h[r++]+=w,r+=2,c=r;break;case m:E[0]=h[r++],E[1]=h[r++],s(E,E,t),h[c++]=E[0],h[c++]=E[1],E[0]+=h[r++],E[1]+=h[r++],s(E,E,t),h[c++]=E[0],h[c++]=E[1]}for(d=0;d<i;d++){var E=o[d];E[0]=h[r++],E[1]=h[r++],s(E,E,t),h[c++]=E[0],h[c++]=E[1]}}}e.exports=c},eeb9:function(e,t,n){"use strict";var i=function(){function e(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1}var t=e.prototype;return t.getIsEnabled=function(){return this.enabled_},t.enable=function(){this.enabled_=!0},t.disable=function(){this.enabled_=!1},t.reset=function(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1},t.getMaxAttempts=function(){return this.maxAttempts_},t.setMaxAttempts=function(e){this.maxAttempts_=e},t.getDelayFactor=function(){return this.delayFactor_},t.setDelayFactor=function(e){this.delayFactor_=e},t.getFuzzFactor=function(){return this.fuzzFactor_},t.setFuzzFactor=function(e){this.fuzzFactor_=e},t.getInitialDelay=function(){return this.initialDelay_},t.setInitialDelay=function(e){this.initialDelay_=e},t.createRetry=function(e){var t=void 0===e?{}:e,n=t.maxAttempts,i=t.delayFactor,s=t.fuzzFactor,a=t.initialDelay;return new r({maxAttempts:n||this.maxAttempts_,delayFactor:i||this.delayFactor_,fuzzFactor:s||this.fuzzFactor_,initialDelay:a||this.initialDelay_})},e}(),r=function(){function e(e){this.maxAttempts_=e.maxAttempts,this.delayFactor_=e.delayFactor,this.fuzzFactor_=e.fuzzFactor,this.currentDelay_=e.initialDelay,this.currentAttempt_=1}var t=e.prototype;return t.moveToNextAttempt=function(){this.currentAttempt_++;var e=this.currentDelay_*this.delayFactor_;this.currentDelay_=this.currentDelay_+e},t.shouldRetry=function(){return this.currentAttempt_<this.maxAttempts_},t.getCurrentDelay=function(){return this.currentDelay_},t.getCurrentMinPossibleDelay=function(){return(1-this.fuzzFactor_)*this.currentDelay_},t.getCurrentMaxPossibleDelay=function(){return(1+this.fuzzFactor_)*this.currentDelay_},t.getCurrentFuzzedDelay=function(){var e=this.getCurrentMinPossibleDelay(),t=this.getCurrentMaxPossibleDelay();return e+Math.random()*(t-e)},e}();e.exports=i},ef34:function(e,t,n){(function(t){var i,r="undefined"!==typeof t?t:"undefined"!==typeof window?window:{},s=n(2);"undefined"!==typeof document?i=document:(i=r["__GLOBAL_DOCUMENT_CACHE@4"],i||(i=r["__GLOBAL_DOCUMENT_CACHE@4"]=s)),e.exports=i}).call(this,n("c8ba"))},ef6a:function(e,t){function n(e,t,n,s,a,o){t[0]=r(t[0],n),t[1]=r(t[1],n),e=e||0;var l=n[1]-n[0];null!=a&&(a=r(a,[0,l])),null!=o&&(o=Math.max(o,null!=a?a:0)),"all"===s&&(a=o=Math.abs(t[1]-t[0]),s=0);var u=i(t,s);t[s]+=e;var c=a||0,d=n.slice();u.sign<0?d[0]+=c:d[1]-=c,t[s]=r(t[s],d);var h=i(t,s);null!=a&&(h.sign!==u.sign||h.span<a)&&(t[1-s]=t[s]+u.sign*a);h=i(t,s);return null!=o&&h.span>o&&(t[1-s]=t[s]+h.sign*o),t}function i(e,t){var n=e[t]-e[1-t];return{span:Math.abs(n),sign:n>0?-1:n<0?1:t?-1:1}}function r(e,t){return Math.min(t[1],Math.max(t[0],e))}e.exports=n},ef97:function(e,t,n){var i=n("3eba");n("217b"),n("f17f");var r=n("7f96"),s=n("87c3"),a=n("fdde");n("01ed"),i.registerVisual(r("line","circle","line")),i.registerLayout(s("line")),i.registerProcessor(i.PRIORITY.PROCESSOR.STATISTIC,a("line"))},f0e2:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return Ps});var i=n("be09"),r=n.n(i),s=n("ef34"),a=n.n(s),o=n("3603"),l=n.n(o),u=n("2b8c"),c=n.n(u),d=n("4ada"),h=n.n(d),f=n("63ec"),p=n("d749"),g=n("17a3"),m=n("8b53"),v=n("de66"),y=n("8484"),b=n("81c0"),_=n.n(b),T=n("321f"),S=n("f8a8"),w=n("36c6"),E="8.22.0";const x={},k=function(e,t){return x[e]=x[e]||[],t&&(x[e]=x[e].concat(t)),x[e]},A=function(e,t){k(e,t)},I=function(e,t){const n=k(e).indexOf(t);return!(n<=-1)&&(x[e]=x[e].slice(),x[e].splice(n,1),!0)},C=function(e,t){k(e,[].concat(t).map(t=>{const n=(...i)=>{return I(e,n),t(...i)};return n}))},D={prefixed:!0},R=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],M=R[0];let L;for(let t=0;t<R.length;t++)if(R[t][1]in a.a){L=R[t];break}if(L){for(let e=0;e<L.length;e++)D[M[e]]=L[e];D.prefixed=L[0]!==M[0]}let P=[];const O=(e,t,n)=>(i,s,a)=>{const o=t.levels[s],l=new RegExp(`^(${o})$`);let u=e;if("log"!==i&&a.unshift(i.toUpperCase()+":"),n&&(u=`%c${e}`,a.unshift(n)),a.unshift(u+":"),P){P.push([].concat(a));const e=P.length-1e3;P.splice(0,e>0?e:0)}if(!r.a.console)return;let c=r.a.console[i];c||"debug"!==i||(c=r.a.console.info||r.a.console.log),c&&o&&l.test(i)&&c[Array.isArray(a)?"apply":"call"](r.a.console,a)};function N(e,t=":",n=""){let i,r="info";function s(...e){i("log",r,e)}return i=O(e,s,n),s.createLogger=((i,r,s)=>{const a=void 0!==r?r:t,o=void 0!==s?s:n,l=`${e} ${a} ${i}`;return N(l,a,o)}),s.createNewLogger=((e,t,n)=>{return N(e,t,n)}),s.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:r},s.level=(e=>{if("string"===typeof e){if(!s.levels.hasOwnProperty(e))throw new Error(`"${e}" in not a valid log level`);r=e}return r}),s.history=(()=>P?[].concat(P):[]),s.history.filter=(e=>{return(P||[]).filter(t=>{return new RegExp(`.*${e}.*`).test(t[0])})}),s.history.clear=(()=>{P&&(P.length=0)}),s.history.disable=(()=>{null!==P&&(P.length=0,P=null)}),s.history.enable=(()=>{null===P&&(P=[])}),s.error=((...e)=>i("error",r,e)),s.warn=((...e)=>i("warn",r,e)),s.debug=((...e)=>i("debug",r,e)),s}const U=N("VIDEOJS"),F=U.createLogger,B=Object.prototype.toString,j=function(e){return $(e)?Object.keys(e):[]};function V(e,t){j(e).forEach(n=>t(e[n],n))}function H(e,t,n=0){return j(e).reduce((n,i)=>t(n,e[i],i),n)}function $(e){return!!e&&"object"===typeof e}function G(e){return $(e)&&"[object Object]"===B.call(e)&&e.constructor===Object}function z(...e){const t={};return e.forEach(e=>{e&&V(e,(e,n)=>{G(e)?(G(t[n])||(t[n]={}),t[n]=z(t[n],e)):t[n]=e})}),t}function q(e={}){const t=[];for(const n in e)if(e.hasOwnProperty(n)){const i=e[n];t.push(i)}return t}function W(e,t,n,i=!0){const r=n=>Object.defineProperty(e,t,{value:n,enumerable:!0,writable:!0}),s={configurable:!0,enumerable:!0,get(){const e=n();return r(e),e}};return i&&(s.set=r),Object.defineProperty(e,t,s)}var K=Object.freeze({__proto__:null,each:V,reduce:H,isObject:$,isPlain:G,merge:z,values:q,defineLazyProperty:W});let Y,X=!1,Q=null,Z=!1,J=!1,ee=!1,te=!1,ne=!1,ie=null,re=null;const se=Boolean(r.a.cast&&r.a.cast.framework&&r.a.cast.framework.CastReceiverContext);let ae=null,oe=!1,le=!1,ue=!1,ce=!1,de=!1,he=!1,fe=!1;const pe=Boolean(Te()&&("ontouchstart"in r.a||r.a.navigator.maxTouchPoints||r.a.DocumentTouch&&r.a.document instanceof r.a.DocumentTouch)),ge=r.a.navigator&&r.a.navigator.userAgentData;if(ge&&ge.platform&&ge.brands&&(Z="Android"===ge.platform,ee=Boolean(ge.brands.find(e=>"Microsoft Edge"===e.brand)),te=Boolean(ge.brands.find(e=>"Chromium"===e.brand)),ne=!ee&&te,ie=re=(ge.brands.find(e=>"Chromium"===e.brand)||{}).version||null,le="Windows"===ge.platform),!te){const e=r.a.navigator&&r.a.navigator.userAgent||"";X=/iPod/i.test(e),Q=function(){const t=e.match(/OS (\d+)_/i);return t&&t[1]?t[1]:null}(),Z=/Android/i.test(e),Y=function(){const t=e.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const n=t[1]&&parseFloat(t[1]),i=t[2]&&parseFloat(t[2]);return n&&i?parseFloat(t[1]+"."+t[2]):n||null}(),J=/Firefox/i.test(e),ee=/Edg/i.test(e),te=/Chrome/i.test(e)||/CriOS/i.test(e),ne=!ee&&te,ie=re=function(){const t=e.match(/(Chrome|CriOS)\/(\d+)/);return t&&t[2]?parseFloat(t[2]):null}(),ae=function(){const t=/MSIE\s(\d+)\.\d/.exec(e);let n=t&&parseFloat(t[1]);return!n&&/Trident\/7.0/i.test(e)&&/rv:11.0/.test(e)&&(n=11),n}(),de=/Tizen/i.test(e),he=/Web0S/i.test(e),fe=de||he,oe=/Safari/i.test(e)&&!ne&&!Z&&!ee&&!fe,le=/Windows/i.test(e),ue=/iPad/i.test(e)||oe&&pe&&!/iPhone/i.test(e),ce=/iPhone/i.test(e)&&!ue}const me=ce||ue||X,ve=(oe||me)&&!ne;var ye=Object.freeze({__proto__:null,get IS_IPOD(){return X},get IOS_VERSION(){return Q},get IS_ANDROID(){return Z},get ANDROID_VERSION(){return Y},get IS_FIREFOX(){return J},get IS_EDGE(){return ee},get IS_CHROMIUM(){return te},get IS_CHROME(){return ne},get CHROMIUM_VERSION(){return ie},get CHROME_VERSION(){return re},IS_CHROMECAST_RECEIVER:se,get IE_VERSION(){return ae},get IS_SAFARI(){return oe},get IS_WINDOWS(){return le},get IS_IPAD(){return ue},get IS_IPHONE(){return ce},get IS_TIZEN(){return de},get IS_WEBOS(){return he},get IS_SMART_TV(){return fe},TOUCH_ENABLED:pe,IS_IOS:me,IS_ANY_SAFARI:ve});function be(e){return"string"===typeof e&&Boolean(e.trim())}function _e(e){if(e.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function Te(){return a.a===r.a.document}function Se(e){return $(e)&&1===e.nodeType}function we(){try{return r.a.parent!==r.a.self}catch(e){return!0}}function Ee(e){return function(t,n){if(!be(t))return a.a[e](null);be(n)&&(n=a.a.querySelector(n));const i=Se(n)?n:a.a;return i[e]&&i[e](t)}}function xe(e="div",t={},n={},i){const r=a.a.createElement(e);return Object.getOwnPropertyNames(t).forEach(function(e){const n=t[e];"textContent"===e?ke(r,n):r[e]===n&&"tabIndex"!==e||(r[e]=n)}),Object.getOwnPropertyNames(n).forEach(function(e){r.setAttribute(e,n[e])}),i&&ze(r,i),r}function ke(e,t){return"undefined"===typeof e.textContent?e.innerText=t:e.textContent=t,e}function Ae(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function Ie(e,t){return _e(t),e.classList.contains(t)}function Ce(e,...t){return e.classList.add(...t.reduce((e,t)=>e.concat(t.split(/\s+/)),[])),e}function De(e,...t){return e?(e.classList.remove(...t.reduce((e,t)=>e.concat(t.split(/\s+/)),[])),e):(U.warn("removeClass was called with an element that doesn't exist"),null)}function Re(e,t,n){return"function"===typeof n&&(n=n(e,t)),"boolean"!==typeof n&&(n=void 0),t.split(/\s+/).forEach(t=>e.classList.toggle(t,n)),e}function Me(e,t){Object.getOwnPropertyNames(t).forEach(function(n){const i=t[n];null===i||"undefined"===typeof i||!1===i?e.removeAttribute(n):e.setAttribute(n,!0===i?"":i)})}function Le(e){const t={},n=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(e&&e.attributes&&e.attributes.length>0){const i=e.attributes;for(let e=i.length-1;e>=0;e--){const r=i[e].name;let s=i[e].value;n.includes(r)&&(s=null!==s),t[r]=s}}return t}function Pe(e,t){return e.getAttribute(t)}function Oe(e,t,n){e.setAttribute(t,n)}function Ne(e,t){e.removeAttribute(t)}function Ue(){a.a.body.focus(),a.a.onselectstart=function(){return!1}}function Fe(){a.a.onselectstart=function(){return!0}}function Be(e){if(e&&e.getBoundingClientRect&&e.parentNode){const t=e.getBoundingClientRect(),n={};return["bottom","height","left","right","top","width"].forEach(e=>{void 0!==t[e]&&(n[e]=t[e])}),n.height||(n.height=parseFloat(Xe(e,"height"))),n.width||(n.width=parseFloat(Xe(e,"width"))),n}}function je(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};const t=e.offsetWidth,n=e.offsetHeight;let i=0,r=0;while(e.offsetParent&&e!==a.a[D.fullscreenElement])i+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return{left:i,top:r,width:t,height:n}}function Ve(e,t){const n={x:0,y:0};if(me){let t=e;while(t&&"html"!==t.nodeName.toLowerCase()){const e=Xe(t,"transform");if(/^matrix/.test(e)){const t=e.slice(7,-1).split(/,\s/).map(Number);n.x+=t[4],n.y+=t[5]}else if(/^matrix3d/.test(e)){const t=e.slice(9,-1).split(/,\s/).map(Number);n.x+=t[12],n.y+=t[13]}if(t.assignedSlot&&t.assignedSlot.parentElement&&r.a.WebKitCSSMatrix){const e=r.a.getComputedStyle(t.assignedSlot.parentElement).transform,i=new r.a.WebKitCSSMatrix(e);n.x+=i.m41,n.y+=i.m42}t=t.parentNode||t.host}}const i={},s=je(t.target),a=je(e),o=a.width,l=a.height;let u=t.offsetY-(a.top-s.top),c=t.offsetX-(a.left-s.left);return t.changedTouches&&(c=t.changedTouches[0].pageX-a.left,u=t.changedTouches[0].pageY+a.top,me&&(c-=n.x,u-=n.y)),i.y=1-Math.max(0,Math.min(1,u/l)),i.x=Math.max(0,Math.min(1,c/o)),i}function He(e){return $(e)&&3===e.nodeType}function $e(e){while(e.firstChild)e.removeChild(e.firstChild);return e}function Ge(e){return"function"===typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map(e=>{return"function"===typeof e&&(e=e()),Se(e)||He(e)?e:"string"===typeof e&&/\S/.test(e)?a.a.createTextNode(e):void 0}).filter(e=>e)}function ze(e,t){return Ge(t).forEach(t=>e.appendChild(t)),e}function qe(e,t){return ze($e(e),t)}function We(e){return void 0===e.button&&void 0===e.buttons||(0===e.button&&void 0===e.buttons||("mouseup"===e.type&&0===e.button&&0===e.buttons||("mousedown"===e.type&&0===e.button&&0===e.buttons||0===e.button&&1===e.buttons)))}const Ke=Ee("querySelector"),Ye=Ee("querySelectorAll");function Xe(e,t){if(!e||!t)return"";if("function"===typeof r.a.getComputedStyle){let n;try{n=r.a.getComputedStyle(e)}catch(e){return""}return n?n.getPropertyValue(t)||n[t]:""}return""}function Qe(e){[...a.a.styleSheets].forEach(t=>{try{const n=[...t.cssRules].map(e=>e.cssText).join(""),i=a.a.createElement("style");i.textContent=n,e.document.head.appendChild(i)}catch(n){const i=a.a.createElement("link");i.rel="stylesheet",i.type=t.type,i.media=t.media.mediaText,i.href=t.href,e.document.head.appendChild(i)}})}var Ze=Object.freeze({__proto__:null,isReal:Te,isEl:Se,isInFrame:we,createEl:xe,textContent:ke,prependTo:Ae,hasClass:Ie,addClass:Ce,removeClass:De,toggleClass:Re,setAttributes:Me,getAttributes:Le,getAttribute:Pe,setAttribute:Oe,removeAttribute:Ne,blockTextSelection:Ue,unblockTextSelection:Fe,getBoundingClientRect:Be,findPosition:je,getPointerPosition:Ve,isTextNode:He,emptyEl:$e,normalizeContent:Ge,appendContent:ze,insertContent:qe,isSingleLeftClick:We,$:Ke,$$:Ye,computedStyle:Xe,copyStyleSheetsToWindow:Qe});let Je,et=!1;const tt=function(){if(!1===Je.options.autoSetup)return;const e=Array.prototype.slice.call(a.a.getElementsByTagName("video")),t=Array.prototype.slice.call(a.a.getElementsByTagName("audio")),n=Array.prototype.slice.call(a.a.getElementsByTagName("video-js")),i=e.concat(t,n);if(i&&i.length>0)for(let r=0,s=i.length;r<s;r++){const e=i[r];if(!e||!e.getAttribute){nt(1);break}if(void 0===e.player){const t=e.getAttribute("data-setup");null!==t&&Je(e)}}else et||nt(1)};function nt(e,t){Te()&&(t&&(Je=t),r.a.setTimeout(tt,e))}function it(){et=!0,r.a.removeEventListener("load",it)}Te()&&("complete"===a.a.readyState?it():r.a.addEventListener("load",it));const rt=function(e){const t=a.a.createElement("style");return t.className=e,t},st=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t};var at=new WeakMap;const ot=3;let lt,ut=ot;function ct(){return ut++}function dt(e,t){if(!at.has(e))return;const n=at.get(e);0===n.handlers[t].length&&(delete n.handlers[t],e.removeEventListener?e.removeEventListener(t,n.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,n.dispatcher)),Object.getOwnPropertyNames(n.handlers).length<=0&&(delete n.handlers,delete n.dispatcher,delete n.disabled),0===Object.getOwnPropertyNames(n).length&&at.delete(e)}function ht(e,t,n,i){n.forEach(function(n){e(t,n,i)})}function ft(e){if(e.fixed_)return e;function t(){return!0}function n(){return!1}if(!e||!e.isPropagationStopped||!e.isImmediatePropagationStopped){const i=e||r.a.event;e={};const s=["layerX","layerY","keyLocation","path","webkitMovementX","webkitMovementY","mozPressure","mozInputSource"];for(const t in i)s.includes(t)||"returnValue"===t&&i.preventDefault||(e[t]=i[t]);if(e.target||(e.target=e.srcElement||a.a),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){i.preventDefault&&i.preventDefault(),e.returnValue=!1,i.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){i.stopPropagation&&i.stopPropagation(),e.cancelBubble=!0,i.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=n,e.stopImmediatePropagation=function(){i.stopImmediatePropagation&&i.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=n,null!==e.clientX&&void 0!==e.clientX){const t=a.a.documentElement,n=a.a.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t&&t.clientLeft||n&&n.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t&&t.clientTop||n&&n.clientTop||0)}e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e.fixed_=!0,e}const pt=function(){if("boolean"!==typeof lt){lt=!1;try{const e=Object.defineProperty({},"passive",{get(){lt=!0}});r.a.addEventListener("test",null,e),r.a.removeEventListener("test",null,e)}catch(e){}}return lt},gt=["touchstart","touchmove"];function mt(e,t,n){if(Array.isArray(t))return ht(mt,e,t,n);at.has(e)||at.set(e,{});const i=at.get(e);if(i.handlers||(i.handlers={}),i.handlers[t]||(i.handlers[t]=[]),n.guid||(n.guid=ct()),i.handlers[t].push(n),i.dispatcher||(i.disabled=!1,i.dispatcher=function(t,n){if(i.disabled)return;t=ft(t);const r=i.handlers[t.type];if(r){const i=r.slice(0);for(let r=0,s=i.length;r<s;r++){if(t.isImmediatePropagationStopped())break;try{i[r].call(e,t,n)}catch(e){U.error(e)}}}}),1===i.handlers[t].length)if(e.addEventListener){let n=!1;pt()&&gt.indexOf(t)>-1&&(n={passive:!0}),e.addEventListener(t,i.dispatcher,n)}else e.attachEvent&&e.attachEvent("on"+t,i.dispatcher)}function vt(e,t,n){if(!at.has(e))return;const i=at.get(e);if(!i.handlers)return;if(Array.isArray(t))return ht(vt,e,t,n);const r=function(e,t){i.handlers[t]=[],dt(e,t)};if(void 0===t){for(const t in i.handlers)Object.prototype.hasOwnProperty.call(i.handlers||{},t)&&r(e,t);return}const s=i.handlers[t];if(s)if(n){if(n.guid)for(let e=0;e<s.length;e++)s[e].guid===n.guid&&s.splice(e--,1);dt(e,t)}else r(e,t)}function yt(e,t,n){const i=at.has(e)?at.get(e):{},r=e.parentNode||e.ownerDocument;if("string"===typeof t?t={type:t,target:e}:t.target||(t.target=e),t=ft(t),i.dispatcher&&i.dispatcher.call(e,t,n),r&&!t.isPropagationStopped()&&!0===t.bubbles)yt.call(null,r,t,n);else if(!r&&!t.defaultPrevented&&t.target&&t.target[t.type]){at.has(t.target)||at.set(t.target,{});const e=at.get(t.target);t.target[t.type]&&(e.disabled=!0,"function"===typeof t.target[t.type]&&t.target[t.type](),e.disabled=!1)}return!t.defaultPrevented}function bt(e,t,n){if(Array.isArray(t))return ht(bt,e,t,n);const i=function(){vt(e,t,i),n.apply(this,arguments)};i.guid=n.guid=n.guid||ct(),mt(e,t,i)}function _t(e,t,n){const i=function(){vt(e,t,i),n.apply(this,arguments)};i.guid=n.guid=n.guid||ct(),mt(e,t,i)}var Tt=Object.freeze({__proto__:null,fixEvent:ft,on:mt,off:vt,trigger:yt,one:bt,any:_t});const St=30,wt=function(e,t,n){t.guid||(t.guid=ct());const i=t.bind(e);return i.guid=n?n+"_"+t.guid:t.guid,i},Et=function(e,t){let n=r.a.performance.now();const i=function(...i){const s=r.a.performance.now();s-n>=t&&(e(...i),n=s)};return i},xt=function(e,t,n,i=r.a){let s;const a=()=>{i.clearTimeout(s),s=null},o=function(){const r=this,a=arguments;let o=function(){s=null,o=null,n||e.apply(r,a)};!s&&n&&e.apply(r,a),i.clearTimeout(s),s=i.setTimeout(o,t)};return o.cancel=a,o};var kt=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL:St,bind_:wt,throttle:Et,debounce:xt});let At;class It{on(e,t){const n=this.addEventListener;this.addEventListener=(()=>{}),mt(this,e,t),this.addEventListener=n}off(e,t){vt(this,e,t)}one(e,t){const n=this.addEventListener;this.addEventListener=(()=>{}),bt(this,e,t),this.addEventListener=n}any(e,t){const n=this.addEventListener;this.addEventListener=(()=>{}),_t(this,e,t),this.addEventListener=n}trigger(e){const t=e.type||e;"string"===typeof e&&(e={type:t}),e=ft(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),yt(this,e)}queueTrigger(e){At||(At=new Map);const t=e.type||e;let n=At.get(this);n||(n=new Map,At.set(this,n));const i=n.get(t);n.delete(t),r.a.clearTimeout(i);const s=r.a.setTimeout(()=>{n.delete(t),0===n.size&&(n=null,At.delete(this)),this.trigger(e)},0);n.set(t,s)}}It.prototype.allowedEvents_={},It.prototype.addEventListener=It.prototype.on,It.prototype.removeEventListener=It.prototype.off,It.prototype.dispatchEvent=It.prototype.trigger;const Ct=e=>{return"function"===typeof e.name?e.name():"string"===typeof e.name?e.name:e.name_?e.name_:e.constructor&&e.constructor.name?e.constructor.name:typeof e},Dt=e=>e instanceof It||!!e.eventBusEl_&&["on","one","off","trigger"].every(t=>"function"===typeof e[t]),Rt=(e,t)=>{Dt(e)?t():(e.eventedCallbacks||(e.eventedCallbacks=[]),e.eventedCallbacks.push(t))},Mt=e=>"string"===typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length,Lt=(e,t,n)=>{if(!e||!e.nodeName&&!Dt(e))throw new Error(`Invalid target for ${Ct(t)}#${n}; must be a DOM node or evented object.`)},Pt=(e,t,n)=>{if(!Mt(e))throw new Error(`Invalid event type for ${Ct(t)}#${n}; must be a non-empty string or array.`)},Ot=(e,t,n)=>{if("function"!==typeof e)throw new Error(`Invalid listener for ${Ct(t)}#${n}; must be a function.`)},Nt=(e,t,n)=>{const i=t.length<3||t[0]===e||t[0]===e.eventBusEl_;let r,s,a;return i?(r=e.eventBusEl_,t.length>=3&&t.shift(),[s,a]=t):(r=t[0],s=t[1],a=t[2]),Lt(r,e,n),Pt(s,e,n),Ot(a,e,n),a=wt(e,a),{isTargetingSelf:i,target:r,type:s,listener:a}},Ut=(e,t,n,i)=>{Lt(e,e,t),e.nodeName?Tt[t](e,n,i):e[t](n,i)},Ft={on(...e){const{isTargetingSelf:t,target:n,type:i,listener:r}=Nt(this,e,"on");if(Ut(n,"on",i,r),!t){const e=()=>this.off(n,i,r);e.guid=r.guid;const t=()=>this.off("dispose",e);t.guid=r.guid,Ut(this,"on","dispose",e),Ut(n,"on","dispose",t)}},one(...e){const{isTargetingSelf:t,target:n,type:i,listener:r}=Nt(this,e,"one");if(t)Ut(n,"one",i,r);else{const e=(...t)=>{this.off(n,i,e),r.apply(null,t)};e.guid=r.guid,Ut(n,"one",i,e)}},any(...e){const{isTargetingSelf:t,target:n,type:i,listener:r}=Nt(this,e,"any");if(t)Ut(n,"any",i,r);else{const e=(...t)=>{this.off(n,i,e),r.apply(null,t)};e.guid=r.guid,Ut(n,"any",i,e)}},off(e,t,n){if(!e||Mt(e))vt(this.eventBusEl_,e,t);else{const i=e,r=t;Lt(i,this,"off"),Pt(r,this,"off"),Ot(n,this,"off"),n=wt(this,n),this.off("dispose",n),i.nodeName?(vt(i,r,n),vt(i,"dispose",n)):Dt(i)&&(i.off(r,n),i.off("dispose",n))}},trigger(e,t){Lt(this.eventBusEl_,this,"trigger");const n=e&&"string"!==typeof e?e.type:e;if(!Mt(n))throw new Error(`Invalid event type for ${Ct(this)}#trigger; `+"must be a non-empty string or object with a type key that has a non-empty value.");return yt(this.eventBusEl_,e,t)}};function Bt(e,t={}){const{eventBusKey:n}=t;if(n){if(!e[n].nodeName)throw new Error(`The eventBusKey "${n}" does not refer to an element.`);e.eventBusEl_=e[n]}else e.eventBusEl_=xe("span",{className:"vjs-event-bus"});return Object.assign(e,Ft),e.eventedCallbacks&&e.eventedCallbacks.forEach(e=>{e()}),e.on("dispose",()=>{e.off(),[e,e.el_,e.eventBusEl_].forEach(function(e){e&&at.has(e)&&at.delete(e)}),r.a.setTimeout(()=>{e.eventBusEl_=null},0)}),e}const jt={state:{},setState(e){let t;return"function"===typeof e&&(e=e()),V(e,(e,n)=>{this.state[n]!==e&&(t=t||{},t[n]={from:this.state[n],to:e}),this.state[n]=e}),t&&Dt(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function Vt(e,t){return Object.assign(e,jt),e.state=Object.assign({},e.state,t),"function"===typeof e.handleStateChanged&&Dt(e)&&e.on("statechanged",e.handleStateChanged),e}const Ht=function(e){return"string"!==typeof e?e:e.replace(/./,e=>e.toLowerCase())},$t=function(e){return"string"!==typeof e?e:e.replace(/./,e=>e.toUpperCase())},Gt=function(e,t){return $t(e)===$t(t)};var zt=Object.freeze({__proto__:null,toLowerCase:Ht,toTitleCase:$t,titleCaseEquals:Gt});class qt{constructor(e,t,n){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=z({},this.options_),t=this.options_=z(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const t=e&&e.id&&e.id()||"no_player";this.id_=`${t}_component_${ct()}`}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(e=>this.addClass(e)),["on","off","one","any","trigger"].forEach(e=>{this[e]=void 0}),!1!==t.evented&&(Bt(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),Vt(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(n),!1!==t.reportTouchActivity&&this.enableTouchActivity()}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return Boolean(this.isDisposed_)}player(){return this.player_}options(e){return e?(this.options_=z(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,n){return xe(e,t,n)}localize(e,t,n=e){const i=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),s=r&&r[i],a=i&&i.split("-")[0],o=r&&r[a];let l=n;return s&&s[e]?l=s[e]:o&&o[e]&&(l=o[e]),t&&(l=l.replace(/\{(\d+)\}/g,function(e,n){const i=t[n-1];let r=i;return"undefined"===typeof i&&(r=e),r})),l}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((e,t)=>e.concat(t),[]);let t=this;for(let n=0;n<e.length;n++)if(t=t.getChild(e[n]),!t||!t.getChild)return;return t}setIcon(e,t=this.el()){if(!this.player_.options_.experimentalSvgIcons)return;const n="http://www.w3.org/2000/svg",i=xe("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),r=a.a.createElementNS(n,"svg");r.setAttributeNS(null,"viewBox","0 0 512 512");const s=a.a.createElementNS(n,"use");return r.appendChild(s),s.setAttributeNS(null,"href",`#vjs-icon-${e}`),i.appendChild(r),this.iconIsSet_?t.replaceChild(i,t.querySelector(".vjs-icon-placeholder")):t.appendChild(i),this.iconIsSet_=!0,i}addChild(e,t={},n=this.children_.length){let i,r;if("string"===typeof e){r=$t(e);const n=t.componentClass||r;t.name=r;const s=qt.getComponent(n);if(!s)throw new Error(`Component ${n} does not exist`);if("function"!==typeof s)return null;i=new s(this.player_||this,t)}else i=e;if(i.parentComponent_&&i.parentComponent_.removeChild(i),this.children_.splice(n,0,i),i.parentComponent_=this,"function"===typeof i.id&&(this.childIndex_[i.id()]=i),r=r||i.name&&$t(i.name()),r&&(this.childNameIndex_[r]=i,this.childNameIndex_[Ht(r)]=i),"function"===typeof i.el&&i.el()){let e=null;this.children_[n+1]&&(this.children_[n+1].el_?e=this.children_[n+1].el_:Se(this.children_[n+1])&&(e=this.children_[n+1])),this.contentEl().insertBefore(i.el(),e)}return i}removeChild(e){if("string"===typeof e&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let i=this.children_.length-1;i>=0;i--)if(this.children_[i]===e){t=!0,this.children_.splice(i,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[$t(e.name())]=null,this.childNameIndex_[Ht(e.name())]=null;const n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,n=e=>{const n=e.name;let i=e.opts;if(void 0!==t[n]&&(i=t[n]),!1===i)return;!0===i&&(i={}),i.playerOptions=this.options_.playerOptions;const r=this.addChild(n,i);r&&(this[n]=r)};let i;const r=qt.getComponent("Tech");i=Array.isArray(e)?e:Object.keys(e),i.concat(Object.keys(this.options_).filter(function(e){return!i.some(function(t){return"string"===typeof t?e===t:e===t.name})})).map(t=>{let n,i;return"string"===typeof t?(n=t,i=e[n]||this.options_[n]||{}):(n=t.name,i=t),{name:n,opts:i}}).filter(e=>{const t=qt.getComponent(e.opts.componentClass||$t(e.name));return t&&!r.isTech(t)}).forEach(n)}}buildCSSClass(){return""}ready(e,t=!1){if(e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)}$(e,t){return Ke(e,t||this.contentEl())}$$(e,t){return Ye(e,t||this.contentEl())}hasClass(e){return Ie(this.el_,e)}addClass(...e){Ce(this.el_,...e)}removeClass(...e){De(this.el_,...e)}toggleClass(e,t){Re(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return Pe(this.el_,e)}setAttribute(e,t){Oe(this.el_,e,t)}removeAttribute(e){Ne(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,n){if(void 0!==t)return null!==t&&t===t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(n||this.trigger("componentresize"));if(!this.el_)return 0;const i=this.el_.style[e],r=i.indexOf("px");return-1!==r?parseInt(i.slice(0,r),10):parseInt(this.el_["offset"+$t(e)],10)}currentDimension(e){let t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=Xe(this.el_,e),t=parseFloat(t),0===t||isNaN(t)){const n=`offset${$t(e)}`;t=this.el_[n]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}getPositions(){const e=this.el_.getBoundingClientRect(),t={x:e.x,y:e.y,width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left},n={x:e.left+e.width/2,y:e.top+e.height/2,width:0,height:0,top:e.top+e.height/2,right:e.left+e.width/2,bottom:e.top+e.height/2,left:e.left+e.width/2};return{boundingClientRect:t,center:n}}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&("Tab"===e.key||this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled||e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;const n=10,i=200;let s;this.on("touchstart",function(n){1===n.touches.length&&(t={pageX:n.touches[0].pageX,pageY:n.touches[0].pageY},e=r.a.performance.now(),s=!0)}),this.on("touchmove",function(e){if(e.touches.length>1)s=!1;else if(t){const i=e.touches[0].pageX-t.pageX,r=e.touches[0].pageY-t.pageY,a=Math.sqrt(i*i+r*r);a>n&&(s=!1)}});const a=function(){s=!1};this.on("touchleave",a),this.on("touchcancel",a),this.on("touchend",function(n){if(t=null,!0===s){const t=r.a.performance.now()-e;t<i&&(n.preventDefault(),this.trigger("tap"))}})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=wt(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const n=function(n){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)}setTimeout(e,t){var n;return e=wt(this,e),this.clearTimersOnDispose_(),n=r.a.setTimeout(()=>{this.setTimeoutIds_.has(n)&&this.setTimeoutIds_.delete(n),e()},t),this.setTimeoutIds_.add(n),n}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),r.a.clearTimeout(e)),e}setInterval(e,t){e=wt(this,e),this.clearTimersOnDispose_();const n=r.a.setInterval(e,t);return this.setIntervalIds_.add(n),n}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),r.a.clearInterval(e)),e}requestAnimationFrame(e){var t;return this.clearTimersOnDispose_(),e=wt(this,e),t=r.a.requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){this.namedRafs_.has(e)&&this.cancelNamedAnimationFrame(e),this.clearTimersOnDispose_(),t=wt(this,t);const n=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),r.a.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,t])=>{this[e].forEach((e,n)=>this[t](n))}),this.clearingTimersOnDispose_=!1}))}getIsDisabled(){return Boolean(this.el_.disabled)}getIsExpresslyInert(){return this.el_.inert&&!this.el_.ownerDocument.documentElement.inert}getIsFocusable(e){const t=e||this.el_;return t.tabIndex>=0&&!(this.getIsDisabled()||this.getIsExpresslyInert())}getIsAvailableToBeFocused(e){function t(e){const t=r.a.getComputedStyle(e,null),n=t.getPropertyValue("visibility"),i=t.getPropertyValue("display"),s=["hidden","collapse"];return"none"!==i&&!s.includes(n)}function n(e){return!!t(e.parentElement)&&!(!t(e)||"0"===e.style.opacity||"0px"===r.a.getComputedStyle(e).height||"0px"===r.a.getComputedStyle(e).width)}function i(e){if(e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)return!1;const t={x:e.getBoundingClientRect().left+e.offsetWidth/2,y:e.getBoundingClientRect().top+e.offsetHeight/2};if(t.x<0)return!1;if(t.x>(a.a.documentElement.clientWidth||r.a.innerWidth))return!1;if(t.y<0)return!1;if(t.y>(a.a.documentElement.clientHeight||r.a.innerHeight))return!1;let n=a.a.elementFromPoint(t.x,t.y);while(n){if(n===e)return!0;if(!n.parentNode)return!1;n=n.parentNode}}return e||(e=this.el()),!(!i(e)||!n(e)||e.parentElement&&!(e.tabIndex>=0))}static registerComponent(e,t){if("string"!==typeof e||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const n=qt.getComponent("Tech"),i=n&&n.isTech(t),r=qt===t||qt.prototype.isPrototypeOf(t.prototype);if(i||!r){let t;throw t=i?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error(`Illegal component, "${e}"; ${t}.`)}e=$t(e),qt.components_||(qt.components_={});const s=qt.getComponent("Player");if("Player"===e&&s&&s.players){const e=s.players,t=Object.keys(e);if(e&&t.length>0)for(let n=0;n<t.length;n++)if(null!==e[t[n]])throw new Error("Can not register Player component after player has been created.")}return qt.components_[e]=t,qt.components_[Ht(e)]=t,t}static getComponent(e){if(e&&qt.components_)return qt.components_[e]}}function Wt(e,t,n){if("number"!==typeof t||t<0||t>n)throw new Error(`Failed to execute '${e}' on 'TimeRanges': The index provided (${t}) is non-numeric or out of bounds (0-${n}).`)}function Kt(e,t,n,i){return Wt(e,i,n.length-1),n[i][t]}function Yt(e){let t;return t=void 0===e||0===e.length?{length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:Kt.bind(null,"start",0,e),end:Kt.bind(null,"end",1,e)},r.a.Symbol&&r.a.Symbol.iterator&&(t[r.a.Symbol.iterator]=(()=>(e||[]).values())),t}function Xt(e,t){return Array.isArray(e)?Yt(e):void 0===e||void 0===t?Yt():Yt([[e,t]])}qt.registerComponent("Component",qt);const Qt=function(e,t){e=e<0?0:e;let n=Math.floor(e%60),i=Math.floor(e/60%60),r=Math.floor(e/3600);const s=Math.floor(t/60%60),a=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(r=i=n="-"),r=r>0||a>0?r+":":"",i=((r||s>=10)&&i<10?"0"+i:i)+":",n=n<10?"0"+n:n,r+i+n};let Zt=Qt;function Jt(e){Zt=e}function en(){Zt=Qt}function tn(e,t=e){return Zt(e,t)}var nn=Object.freeze({__proto__:null,createTimeRanges:Xt,createTimeRange:Xt,setFormatTime:Jt,resetFormatTime:en,formatTime:tn});function rn(e,t){let n,i,r=0;if(!t)return 0;e&&e.length||(e=Xt(0,0));for(let s=0;s<e.length;s++)n=e.start(s),i=e.end(s),i>t&&(i=t),r+=i-n;return r/t}function sn(e){if(e instanceof sn)return e;"number"===typeof e?this.code=e:"string"===typeof e?this.message=e:$(e)&&("number"===typeof e.code&&(this.code=e.code),Object.assign(this,e)),this.message||(this.message=sn.defaultMessages[this.code]||"")}function an(e){return void 0!==e&&null!==e&&"function"===typeof e.then}function on(e){an(e)&&e.then(null,e=>{})}sn.prototype.code=0,sn.prototype.message="",sn.prototype.status=null,sn.prototype.metadata=null,sn.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],sn.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."},sn.MEDIA_ERR_CUSTOM=0,sn.prototype.MEDIA_ERR_CUSTOM=0,sn.MEDIA_ERR_ABORTED=1,sn.prototype.MEDIA_ERR_ABORTED=1,sn.MEDIA_ERR_NETWORK=2,sn.prototype.MEDIA_ERR_NETWORK=2,sn.MEDIA_ERR_DECODE=3,sn.prototype.MEDIA_ERR_DECODE=3,sn.MEDIA_ERR_SRC_NOT_SUPPORTED=4,sn.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED=4,sn.MEDIA_ERR_ENCRYPTED=5,sn.prototype.MEDIA_ERR_ENCRYPTED=5;const ln=function(e){const t=["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((t,n,i)=>{return e[n]&&(t[n]=e[n]),t},{cues:e.cues&&Array.prototype.map.call(e.cues,function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}})});return t},un=function(e){const t=e.$$("track"),n=Array.prototype.map.call(t,e=>e.track),i=Array.prototype.map.call(t,function(e){const t=ln(e.track);return e.src&&(t.src=e.src),t});return i.concat(Array.prototype.filter.call(e.textTracks(),function(e){return-1===n.indexOf(e)}).map(ln))},cn=function(e,t){return e.forEach(function(e){const n=t.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach(e=>n.addCue(e))}),t.textTracks()};var dn={textTracksToJson:un,jsonToTextTracks:cn,trackToJson_:ln};const hn="vjs-modal-dialog";class fn extends qt{constructor(e,t){super(e,t),this.handleKeyDown_=(e=>this.handleKeyDown(e)),this.close_=(e=>this.close(e)),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=xe("div",{className:`${hn}-content`},{role:"document"}),this.descEl_=xe("p",{className:`${hn}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),ke(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog","aria-live":"polite"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${hn} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(this.opened_)return void(this.options_.fillAlways&&this.fill());const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}opened(e){return"boolean"===typeof e&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger({type:"modalclose",bubbles:!0}),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if("boolean"===typeof e){const t=this.closeable_=!!e;let n=this.getChild("closeButton");if(t&&!n){const e=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=e,this.on(n,"close",this.close_)}!t&&n&&(this.off(n,"close",this.close_),this.removeChild(n),n.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),n=t.parentNode,i=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(t),this.empty(),qe(t,e),this.trigger("modalfill"),i?n.insertBefore(t,i):n.appendChild(t);const r=this.getChild("closeButton");r&&n.appendChild(r.el_),this.trigger("aftermodalfill")}empty(){this.trigger("beforemodalempty"),$e(this.contentEl()),this.trigger("modalempty")}content(e){return"undefined"!==typeof e&&(this.content_=e),this.content_}conditionalFocus_(){const e=a.a.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(this.trigger({type:"modalKeydown",originalEvent:e,target:this,bubbles:!0}),e.stopPropagation(),"Escape"===e.key&&this.closeable())return e.preventDefault(),void this.close();if("Tab"!==e.key)return;const t=this.focusableEls_(),n=this.el_.querySelector(":focus");let i;for(let r=0;r<t.length;r++)if(n===t[r]){i=r;break}a.a.activeElement===this.el_&&(i=0),e.shiftKey&&0===i?(t[t.length-1].focus(),e.preventDefault()):e.shiftKey||i!==t.length-1||(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,e=>{return(e instanceof r.a.HTMLAnchorElement||e instanceof r.a.HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof r.a.HTMLInputElement||e instanceof r.a.HTMLSelectElement||e instanceof r.a.HTMLTextAreaElement||e instanceof r.a.HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof r.a.HTMLIFrameElement||e instanceof r.a.HTMLObjectElement||e instanceof r.a.HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable")})}}fn.prototype.options_={pauseOnOpen:!0,temporary:!0},qt.registerComponent("ModalDialog",fn);class pn extends It{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=(()=>{this.trigger({track:e,type:"labelchange",target:this})}),Dt(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let n=0,i=this.length;n<i;n++)if(this[n]===e){t=this[n],t.off&&t.off(),this.tracks_.splice(n,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let n=0,i=this.length;n<i;n++){const i=this[n];if(i.id===e){t=i;break}}return t}}pn.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const t in pn.prototype.allowedEvents_)pn.prototype["on"+t]=null;const gn=function(e,t){for(let n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].enabled=!1)};class mn extends pn{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){gn(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&gn(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=(()=>{this.changing_||(this.changing_=!0,gn(this,e),this.changing_=!1,this.trigger("change"))}),e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const vn=function(e,t){for(let n=0;n<e.length;n++)Object.keys(e[n]).length&&t.id!==e[n].id&&(e[n].selected=!1)};class yn extends pn{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){vn(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set(){}})}addTrack(e){e.selected&&vn(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=(()=>{this.changing_||(this.changing_=!0,vn(this,e),this.changing_=!1,this.trigger("change"))}),e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class bn extends pn{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=(()=>this.queueTrigger("change"))),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=(()=>this.trigger("selectedlanguagechange"))),e.addEventListener("modechange",this.queueChange_);const t=["metadata","chapters"];-1===t.indexOf(e.kind)&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}}class _n{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,n=e.length;t<n;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let n=0,i=this.trackElements_.length;n<i;n++)if(e===this.trackElements_[n].track){t=this.trackElements_[n];break}return t}removeTrackElement_(e){for(let t=0,n=this.trackElements_.length;t<n;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"===typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"===typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}}class Tn{constructor(e){Tn.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let n=0;const i=e.length;this.cues_=e,this.length_=e.length;const r=function(e){""+e in this||Object.defineProperty(this,""+e,{get(){return this.cues_[e]}})};if(t<i)for(n=t;n<i;n++)r.call(this,n)}getCueById(e){let t=null;for(let n=0,i=this.length;n<i;n++){const i=this[n];if(i.id===e){t=i;break}}return t}}const Sn={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},wn={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},En={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},xn={disabled:"disabled",hidden:"hidden",showing:"showing"};class kn extends It{constructor(e={}){super();const t={id:e.id||"vjs_track_"+ct(),kind:e.kind||"",language:e.language||""};let n=e.label||"";for(const i in t)Object.defineProperty(this,i,{get(){return t[i]},set(){}});Object.defineProperty(this,"label",{get(){return n},set(e){e!==n&&(n=e,this.trigger("labelchange"))}})}}const An=function(e){return new URL(e,a.a.baseURI)},In=function(e){return new URL(e,a.a.baseURI).href},Cn=function(e){if("string"===typeof e){const t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/,n=t.exec(e);if(n)return n.pop().toLowerCase()}return""},Dn=function(e,t=r.a.location){return An(e).origin!==t.origin};var Rn=Object.freeze({__proto__:null,parseUrl:An,getAbsoluteURL:In,getFileExtension:Cn,isCrossOrigin:Dn});const Mn=function(e,t){const n=new r.a.WebVTT.Parser(r.a,r.a.vttjs,r.a.WebVTT.StringDecoder()),i=[];n.oncue=function(e){t.addCue(e)},n.onparsingerror=function(e){i.push(e)},n.onflush=function(){t.trigger({type:"loadeddata",target:t})},n.parse(e),i.length>0&&(r.a.console&&r.a.console.groupCollapsed&&r.a.console.groupCollapsed(`Text Track parsing errors for ${t.src}`),i.forEach(e=>U.error(e)),r.a.console&&r.a.console.groupEnd&&r.a.console.groupEnd()),n.flush()},Ln=function(e,t){const n={uri:e},i=Dn(e);i&&(n.cors=i);const s="use-credentials"===t.tech_.crossOrigin();s&&(n.withCredentials=s),l()(n,wt(this,function(e,n,i){if(e)return U.error(e,n);t.loaded_=!0,"function"!==typeof r.a.WebVTT?t.tech_&&t.tech_.any(["vttjsloaded","vttjserror"],e=>{if("vttjserror"!==e.type)return Mn(i,t);U.error(`vttjs failed to load, stopping trying to process ${t.src}`)}):Mn(i,t)}))};class Pn extends kn{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=z(e,{kind:En[e.kind]||"subtitles",language:e.language||e.srclang||""});let n=xn[t.mode]||"disabled";const i=t.default;"metadata"!==t.kind&&"chapters"!==t.kind||(n="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=!1!==this.tech_.preloadTextTracks;const r=new Tn(this.cues_),s=new Tn(this.activeCues_);let a=!1;this.timeupdateHandler=wt(this,function(e={}){this.tech_.isDisposed()||(this.tech_.isReady_?(this.activeCues=this.activeCues,a&&(this.trigger("cuechange"),a=!1),"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))):"timeupdate"!==e.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)))});const o=()=>{this.stopTracking()};this.tech_.one("dispose",o),"disabled"!==n&&this.startTracking(),Object.defineProperties(this,{default:{get(){return i},set(){}},mode:{get(){return n},set(e){xn[e]&&n!==e&&(n=e,this.preload_||"disabled"===n||0!==this.cues.length||Ln(this.src,this),this.stopTracking(),"disabled"!==n&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?r:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(0===this.cues.length)return s;const e=this.tech_.currentTime(),t=[];for(let n=0,i=this.cues.length;n<i;n++){const i=this.cues[n];i.startTime<=e&&i.endTime>=e&&t.push(i)}if(a=!1,t.length!==this.activeCues_.length)a=!0;else for(let n=0;n<t.length;n++)-1===this.activeCues_.indexOf(t[n])&&(a=!0);return this.activeCues_=t,s.setCues_(this.activeCues_),s},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||"subtitles"!==t.kind&&"captions"!==t.kind)&&Ln(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(!("getCueAsHTML"in t)){t=new r.a.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const n in e)n in t||(t[n]=e[n]);t.id=e.id,t.originalCue_=e}const n=this.tech_.textTracks();for(let i=0;i<n.length;i++)n[i]!==this&&n[i].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}removeCue(e){let t=this.cues_.length;while(t--){const n=this.cues_[t];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}Pn.prototype.allowedEvents_={cuechange:"cuechange"};class On extends kn{constructor(e={}){const t=z(e,{kind:wn[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"enabled",{get(){return n},set(e){"boolean"===typeof e&&e!==n&&(n=e,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class Nn extends kn{constructor(e={}){const t=z(e,{kind:Sn[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"selected",{get(){return n},set(e){"boolean"===typeof e&&e!==n&&(n=e,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class Un extends It{constructor(e={}){let t;super();const n=new Pn(e);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get(){return t}},track:{get(){return n}}}),t=Un.NONE,n.addEventListener("loadeddata",()=>{t=Un.LOADED,this.trigger({type:"load",target:this})})}}Un.prototype.allowedEvents_={load:"load"},Un.NONE=0,Un.LOADING=1,Un.LOADED=2,Un.ERROR=3;const Fn={audio:{ListClass:mn,TrackClass:On,capitalName:"Audio"},video:{ListClass:yn,TrackClass:Nn,capitalName:"Video"},text:{ListClass:bn,TrackClass:Pn,capitalName:"Text"}};Object.keys(Fn).forEach(function(e){Fn[e].getterName=`${e}Tracks`,Fn[e].privateName=`${e}Tracks_`});const Bn={remoteText:{ListClass:bn,TrackClass:Pn,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:_n,TrackClass:Un,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},jn=Object.assign({},Fn,Bn);function Vn(e,t,n,i,r={}){const s=e.textTracks();r.kind=t,n&&(r.label=n),i&&(r.language=i),r.tech=e;const a=new jn.text.TrackClass(r);return s.addTrack(a),a}Bn.names=Object.keys(Bn),Fn.names=Object.keys(Fn),jn.names=[].concat(Bn.names).concat(Fn.names);class Hn extends qt{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=(e=>this.onDurationChange(e)),this.trackProgress_=(e=>this.trackProgress(e)),this.trackCurrentTime_=(e=>this.trackCurrentTime(e)),this.stopTrackingCurrentTime_=(e=>this.stopTrackingCurrentTime(e)),this.disposeSourceHandler_=(e=>this.disposeSourceHandler(e)),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),jn.names.forEach(t=>{const n=jn[t];e&&e[n.getterName]&&(this[n.privateName]=e[n.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(t=>{!1===e[`native${t}Tracks`]&&(this[`featuresNative${t}Tracks`]=!1)}),!1===e.nativeCaptions||!1===e.nativeTextTracks?this.featuresNativeTextTracks=!1:!0!==e.nativeCaptions&&!0!==e.nativeTextTracks||(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=!1!==e.preloadTextTracks,this.autoRemoteTextTracks_=new jn.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(wt(this,function(){const e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return Xt(0,0)}bufferedPercent(){return rn(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(Fn.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){e=[].concat(e),e.forEach(e=>{const t=this[`${e}Tracks`]()||[];let n=t.length;while(n--){const i=t[n];"text"===e&&this.removeRemoteTextTrack(i),t.removeTrack(i)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;while(t--){const n=e[t];this.removeRemoteTextTrack(n)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return void 0!==e&&(this.error_=new sn(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?Xt(0,0):Xt()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){Fn.names.forEach(e=>{const t=Fn[e],n=()=>{this.trigger(`${e}trackchange`)},i=this[t.getterName]();i.addEventListener("removetrack",n),i.addEventListener("addtrack",n),this.on("dispose",()=>{i.removeEventListener("removetrack",n),i.removeEventListener("addtrack",n)})})}addWebVttScript_(){if(!r.a.WebVTT)if(a.a.body.contains(this.el())){if(!this.options_["vtt.js"]&&G(c.a)&&Object.keys(c.a).length>0)return void this.trigger("vttjsloaded");const e=a.a.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=(()=>{this.trigger("vttjsloaded")}),e.onerror=(()=>{this.trigger("vttjserror")}),this.on("dispose",()=>{e.onload=null,e.onerror=null}),r.a.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),n=t=>e.addTrack(t.track),i=t=>e.removeTrack(t.track);t.on("addtrack",n),t.on("removetrack",i),this.addWebVttScript_();const r=()=>this.trigger("texttrackchange"),s=()=>{r();for(let t=0;t<e.length;t++){const n=e[t];n.removeEventListener("cuechange",r),"showing"===n.mode&&n.addEventListener("cuechange",r)}};s(),e.addEventListener("change",s),e.addEventListener("addtrack",s),e.addEventListener("removetrack",s),this.on("dispose",function(){t.off("addtrack",n),t.off("removetrack",i),e.removeEventListener("change",s),e.removeEventListener("addtrack",s),e.removeEventListener("removetrack",s);for(let t=0;t<e.length;t++){const n=e[t];n.removeEventListener("cuechange",r)}})}addTextTrack(e,t,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return Vn(this,e,t,n)}createRemoteTextTrack(e){const t=z(e,{tech:this});return new Bn.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const n=this.createRemoteTextTrack(e);return"boolean"!==typeof t&&(t=!1),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),!1===t&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(n.track)),n}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=ct();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())})):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return Hn.canPlayType(e.type)}static isTech(e){return e.prototype instanceof Hn||e instanceof Hn||e===Hn}static registerTech(e,t){if(Hn.techs_||(Hn.techs_={}),!Hn.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!Hn.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!Hn.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=$t(e),Hn.techs_[e]=t,Hn.techs_[Ht(e)]=t,"Tech"!==e&&Hn.defaultTechOrder_.push(e),t}static getTech(e){if(e)return Hn.techs_&&Hn.techs_[e]?Hn.techs_[e]:(e=$t(e),r.a&&r.a.videojs&&r.a.videojs[e]?(U.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),r.a.videojs[e]):void 0)}}jn.names.forEach(function(e){const t=jn[e];Hn.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}}),Hn.prototype.featuresVolumeControl=!0,Hn.prototype.featuresMuteControl=!0,Hn.prototype.featuresFullscreenResize=!1,Hn.prototype.featuresPlaybackRate=!1,Hn.prototype.featuresProgressEvents=!1,Hn.prototype.featuresSourceset=!1,Hn.prototype.featuresTimeupdateEvents=!1,Hn.prototype.featuresNativeTextTracks=!1,Hn.prototype.featuresVideoFrameCallback=!1,Hn.withSourceHandlers=function(e){e.registerSourceHandler=function(t,n){let i=e.sourceHandlers;i||(i=e.sourceHandlers=[]),void 0===n&&(n=i.length),i.splice(n,0,t)},e.canPlayType=function(t){const n=e.sourceHandlers||[];let i;for(let e=0;e<n.length;e++)if(i=n[e].canPlayType(t),i)return i;return""},e.selectSourceHandler=function(t,n){const i=e.sourceHandlers||[];let r;for(let e=0;e<i.length;e++)if(r=i[e].canHandleSource(t,n),r)return i[e];return null},e.canPlaySource=function(t,n){const i=e.selectSourceHandler(t,n);return i?i.canHandleSource(t,n):""};const t=["seekable","seeking","duration"];t.forEach(function(e){const t=this[e];"function"===typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})},e.prototype),e.prototype.setSource=function(t){let n=e.selectSourceHandler(t,this.options_);n||(e.nativeSourceHandler?n=e.nativeSourceHandler:U.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),n!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=n.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},qt.registerComponent("Tech",Hn),Hn.registerTech("Tech",Hn),Hn.defaultTechOrder_=[];const $n={},Gn={},zn={};function qn(e,t){$n[e]=$n[e]||[],$n[e].push(t)}function Wn(e,t,n){e.setTimeout(()=>si(t,$n[t.type],n,e),1)}function Kn(e,t){e.forEach(e=>e.setTech&&e.setTech(t))}function Yn(e,t,n){return e.reduceRight(ti(n),t[n]())}function Xn(e,t,n,i){return t[n](e.reduce(ti(n),i))}function Qn(e,t,n,i=null){const r="call"+$t(n),s=e.reduce(ti(r),i),a=s===zn,o=a?null:t[n](s);return ni(e,n,o,a),o}const Zn={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},Jn={setCurrentTime:1,setMuted:1,setVolume:1},ei={play:1,pause:1};function ti(e){return(t,n)=>{return t===zn?zn:n[e]?n[e](t):t}}function ni(e,t,n,i){for(let r=e.length-1;r>=0;r--){const s=e[r];s[t]&&s[t](i,n)}}function ii(e){Gn.hasOwnProperty(e.id())&&delete Gn[e.id()]}function ri(e,t){const n=Gn[e.id()];let i=null;if(void 0===n||null===n)return i=t(e),Gn[e.id()]=[[t,i]],i;for(let r=0;r<n.length;r++){const[e,s]=n[r];e===t&&(i=s)}return null===i&&(i=t(e),n.push([t,i])),i}function si(e={},t=[],n,i,r=[],s=!1){const[a,...o]=t;if("string"===typeof a)si(e,$n[a],n,i,r,s);else if(a){const t=ri(i,a);if(!t.setSource)return r.push(t),si(e,o,n,i,r,s);t.setSource(Object.assign({},e),function(a,l){if(a)return si(e,o,n,i,r,s);r.push(t),si(l,e.type===l.type?o:$n[l.type],n,i,r,s)})}else o.length?si(e,o,n,i,r,s):s?n(e,r):si(e,$n["*"],n,i,r,!0)}const ai={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},oi=function(e=""){const t=Cn(e),n=ai[t.toLowerCase()];return n||""},li=(e,t)=>{if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;const n=e.cache_.sources.filter(e=>e.src===t);if(n.length)return n[0].type;const i=e.$$("source");for(let r=0;r<i.length;r++){const e=i[r];if(e.type&&e.src&&e.src===t)return e.type}return oi(t)},ui=function(e){if(Array.isArray(e)){let t=[];e.forEach(function(e){e=ui(e),Array.isArray(e)?t=t.concat(e):$(e)&&t.push(e)}),e=t}else e="string"===typeof e&&e.trim()?[ci({src:e})]:$(e)&&"string"===typeof e.src&&e.src&&e.src.trim()?[ci(e)]:[];return e};function ci(e){if(!e.type){const t=oi(e.src);t&&(e.type=t)}return e}var di='<svg xmlns="http://www.w3.org/2000/svg">\n  <defs>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play">\n      <path d="M16 10v28l22-14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">\n      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">\n      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">\n      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">\n      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">\n      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">\n      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">\n      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">\n      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">\n      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">\n      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">\n      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">\n      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>\n    </symbol>\n    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">\n      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">\n      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>\n    </symbol>\n    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">\n      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">\n      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">\n      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">\n      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-share">\n      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">\n      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-square">\n      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">\n      <circle cx="24" cy="24" r="20"></circle>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">\n      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">\n      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">\n      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">\n      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">\n      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">\n      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">\n      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">\n      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">\n      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>\n    </symbol>\n    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">\n      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>\n    </symbol>\n    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">\n      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">\n      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">\n      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">\n      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">\n      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>\n    </symbol>\n    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">\n      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">\n      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>\n      <path fill="none" d="M-1-3h24v24H-1z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">\n      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">\n      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1200 1227" id="vjs-icon-twitter">\n      <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">\n      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>\n    </symbol>\n    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">\n      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>\n    </symbol>\n  </defs>\n</svg>';const hi=de?10009:he?461:8,fi={codes:{play:415,pause:19,ff:417,rw:412,back:hi},names:{415:"play",19:"pause",417:"ff",412:"rw",[hi]:"back"},isEventKey(e,t){return t=t.toLowerCase(),!(!this.names[e.keyCode]||this.names[e.keyCode]!==t)},getEventName(e){if(this.names[e.keyCode])return this.names[e.keyCode];if(this.codes[e.code]){const t=this.codes[e.code];return this.names[t]}return null}},pi=5;class gi extends It{constructor(e){super(),this.player_=e,this.focusableComponents=[],this.isListening_=!1,this.isPaused_=!1,this.onKeyDown_=this.onKeyDown_.bind(this),this.lastFocusedComponent_=null}start(){this.isListening_||(this.player_.on("keydown",this.onKeyDown_),this.player_.on("modalKeydown",this.onKeyDown_),this.player_.on("loadedmetadata",()=>{this.focus(this.updateFocusableComponents()[0])}),this.player_.on("modalclose",()=>{this.refocusComponent()}),this.player_.on("focusin",this.handlePlayerFocus_.bind(this)),this.player_.on("focusout",this.handlePlayerBlur_.bind(this)),this.isListening_=!0,this.player_.errorDisplay&&this.player_.errorDisplay.on("aftermodalfill",()=>{this.updateFocusableComponents(),this.focusableComponents.length&&(this.focusableComponents.length>1?this.focusableComponents[1].focus():this.focusableComponents[0].focus())}))}stop(){this.player_.off("keydown",this.onKeyDown_),this.isListening_=!1}onKeyDown_(e){const t=e.originalEvent?e.originalEvent:e;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)){if(this.isPaused_)return;t.preventDefault();const e=t.key.substring(5).toLowerCase();this.move(e)}else if(fi.isEventKey(t,"play")||fi.isEventKey(t,"pause")||fi.isEventKey(t,"ff")||fi.isEventKey(t,"rw")){t.preventDefault();const e=fi.getEventName(t);this.performMediaAction_(e)}else fi.isEventKey(t,"Back")&&e.target&&"function"===typeof e.target.closeable&&e.target.closeable()&&(t.preventDefault(),e.target.close())}performMediaAction_(e){if(this.player_)switch(e){case"play":this.player_.paused()&&this.player_.play();break;case"pause":this.player_.paused()||this.player_.pause();break;case"ff":this.userSeek_(this.player_.currentTime()+pi);break;case"rw":this.userSeek_(this.player_.currentTime()-pi);break}}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}pause(){this.isPaused_=!0}resume(){this.isPaused_=!1}handlePlayerBlur_(e){const t=e.relatedTarget;let n=null;const i=this.getCurrentComponent(e.target);t&&(n=Boolean(t.closest(".video-js")),t.classList.contains("vjs-text-track-settings")&&!this.isPaused_&&this.searchForTrackSelect_()),(e.currentTarget.contains(e.relatedTarget)||n)&&t||(i&&"CloseButton"===i.name()?this.refocusComponent():(this.pause(),i&&i.el()&&(this.lastFocusedComponent_=i)))}handlePlayerFocus_(){this.getCurrentComponent()&&this.getCurrentComponent().getIsFocusable()&&this.resume()}updateFocusableComponents(){const e=this.player_,t=[];function n(e){for(const i of e)i.hasOwnProperty("el_")&&i.getIsFocusable()&&i.getIsAvailableToBeFocused(i.el())&&t.push(i),i.hasOwnProperty("children_")&&i.children_.length>0&&n(i.children_)}return e.children_.forEach(e=>{if(e.hasOwnProperty("el_")){if(e.getIsFocusable&&e.getIsAvailableToBeFocused&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el()))return void t.push(e);e.hasOwnProperty("children_")&&e.children_.length>0?n(e.children_):e.hasOwnProperty("items")&&e.items.length>0?n(e.items):this.findSuitableDOMChild(e)&&t.push(e)}if("ErrorDisplay"===e.name_&&e.opened_){const n=e.el_.querySelector(".vjs-errors-ok-button-container");if(n){const e=n.querySelectorAll("button");e.forEach((e,n)=>{t.push({name:()=>{return"ModalButton"+(n+1)},el:()=>e,getPositions:()=>{const t=e.getBoundingClientRect(),n={x:t.x,y:t.y,width:t.width,height:t.height,top:t.top,right:t.right,bottom:t.bottom,left:t.left},i={x:t.left+t.width/2,y:t.top+t.height/2,width:0,height:0,top:t.top+t.height/2,right:t.left+t.width/2,bottom:t.top+t.height/2,left:t.left+t.width/2};return{boundingClientRect:n,center:i}},getIsAvailableToBeFocused:()=>!0,getIsFocusable:e=>!0,focus:()=>e.focus()})})}}}),this.focusableComponents=t,this.focusableComponents}findSuitableDOMChild(e){function t(n){if(e.getIsFocusable(n)&&e.getIsAvailableToBeFocused(n))return n;for(let e=0;e<n.children.length;e++){const i=n.children[e],r=t(i);if(r)return r}return null}return e.el()?t(e.el()):null}getCurrentComponent(e){this.updateFocusableComponents();const t=e||document.activeElement;if(this.focusableComponents.length)for(const n of this.focusableComponents)if(n.el()===t)return n}add(e){const t=[...this.focusableComponents];e.hasOwnProperty("el_")&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el())&&t.push(e),this.focusableComponents=t,this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}remove(e){for(let t=0;t<this.focusableComponents.length;t++)if(this.focusableComponents[t].name()===e.name())return this.focusableComponents.splice(t,1),void this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}clear(){this.focusableComponents.length>0&&(this.focusableComponents=[],this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents}))}move(e){const t=this.getCurrentComponent();if(!t)return;const n=t.getPositions(),i=this.focusableComponents.filter(i=>i!==t&&this.isInDirection_(n.boundingClientRect,i.getPositions().boundingClientRect,e)),r=this.findBestCandidate_(n.center,i,e);r?this.focus(r):this.trigger({type:"endOfFocusableComponents",direction:e,focusedComponent:t})}findBestCandidate_(e,t,n){let i=1/0,r=null;for(const s of t){const t=s.getPositions().center,a=this.calculateDistance_(e,t,n);a<i&&(i=a,r=s)}return r}isInDirection_(e,t,n){switch(n){case"right":return t.left>=e.right;case"left":return t.right<=e.left;case"down":return t.top>=e.bottom;case"up":return t.bottom<=e.top;default:return!1}}refocusComponent(){if(this.lastFocusedComponent_){this.player_.userActive()||this.player_.userActive(!0),this.updateFocusableComponents();for(let e=0;e<this.focusableComponents.length;e++)if(this.focusableComponents[e].name()===this.lastFocusedComponent_.name())return void this.focus(this.focusableComponents[e])}else this.focus(this.updateFocusableComponents()[0])}focus(e){"object"===typeof e&&(e.getIsAvailableToBeFocused(e.el())?e.focus():this.findSuitableDOMChild(e)&&this.findSuitableDOMChild(e).focus())}calculateDistance_(e,t,n){const i=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);let s;switch(n){case"right":case"left":s=i+100*r;break;case"up":s=2*r+.5*i;break;case"down":s=5*r+i;break;default:s=i+r}return s}searchForTrackSelect_(){const e=this;for(const t of e.updateFocusableComponents())if("TextTrackSelect"===t.constructor.name){e.focus(t);break}}}class mi extends qt{constructor(e,t,n){const i=z({createEl:!1},t);if(super(e,i,n),t.playerOptions.sources&&0!==t.playerOptions.sources.length)e.src(t.playerOptions.sources);else for(let r=0,s=t.playerOptions.techOrder;r<s.length;r++){const t=$t(s[r]);let n=Hn.getTech(t);if(t||(n=qt.getComponent(t)),n&&n.isSupported()){e.loadTech_(t);break}}}}qt.registerComponent("MediaLoader",mi);class vi extends qt{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=(e=>this.handleMouseOver(e)),this.handleMouseOut_=(e=>this.handleMouseOut(e)),this.handleClick_=(e=>this.handleClick(e)),this.handleKeyDown_=(e=>this.handleKeyDown(e)),this.emitTapEvents(),this.enable()}createEl(e="div",t={},n={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),"button"===e&&U.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),n=Object.assign({role:"button"},n),this.tabIndex_=t.tabIndex;const i=xe(e,t,n);return this.player_.options_.experimentalSvgIcons||i.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(i),i}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=xe("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(void 0===e)return this.controlText_||"Need Text";const n=this.localize(e);this.controlText_=e,ke(this.controlTextEl_,n),this.nonIconControl||this.player_.options_.noUITitleAttributes||t.setAttribute("title",n)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),"undefined"!==typeof this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),"undefined"!==typeof this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){" "===e.key||"Enter"===e.key?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}qt.registerComponent("ClickableComponent",vi);class yi extends vi{constructor(e,t){super(e,t),this.update(),this.update_=(e=>this.update(e)),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return xe("div",{className:"vjs-poster"})}crossOrigin(e){if("undefined"===typeof e)return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;null===e||"anonymous"===e||"use-credentials"===e?this.$("img")&&(this.$("img").crossOrigin=e):this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){e?(this.$("img")||this.el_.appendChild(xe("picture",{className:"vjs-poster",tabIndex:-1},{},xe("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e):this.el_.textContent=""}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?on(this.player_.play()):this.player_.pause())}}yi.prototype.crossorigin=yi.prototype.crossOrigin,qt.registerComponent("PosterImage",yi);const bi="#222",_i="#ccc",Ti={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Si(e,t){let n;if(4===e.length)n=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");n=e.slice(1)}return"rgba("+parseInt(n.slice(0,2),16)+","+parseInt(n.slice(2,4),16)+","+parseInt(n.slice(4,6),16)+","+t+")"}function wi(e,t,n){try{e.style[t]=n}catch(e){return}}function Ei(e){return e?`${e}px`:""}class xi extends qt{constructor(e,t,n){super(e,t,n);const i=e=>this.updateDisplay(e),s=e=>{this.updateDisplayOverlay(),this.updateDisplay(e)};e.on("loadstart",e=>this.toggleDisplay(e)),e.on("texttrackchange",i),e.on("loadedmetadata",e=>{this.updateDisplayOverlay(),this.preselectTrack(e)}),e.ready(wt(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks)return void this.hide();e.on("fullscreenchange",s),e.on("playerresize",s);const t=r.a.screen.orientation||r.a,n=r.a.screen.orientation?"change":"orientationchange";t.addEventListener(n,s),e.on("dispose",()=>t.removeEventListener(n,s));const i=this.options_.playerOptions.tracks||[];for(let e=0;e<i.length;e++)this.player_.addRemoteTextTrack(i[e],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),n=this.player_.cache_.selectedLanguage;let i,r,s;for(let a=0;a<t.length;a++){const o=t[a];n&&n.enabled&&n.language&&n.language===o.language&&o.kind in e?o.kind===n.kind?s=o:s||(s=o):n&&!n.enabled?(s=null,i=null,r=null):o.default&&("descriptions"!==o.kind||i?o.kind in e&&!r&&(r=o):i=o)}s?s.mode="showing":r?r.mode="showing":i&&(i.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){"function"===typeof r.a.WebVTT&&r.a.WebVTT.processCues(r.a,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const t=[];for(let n=0;n<e.length;++n){const i=e[n];"showing"===i.mode&&t.push(i)}return void this.updateForTrack(t)}let n=null,i=null,s=e.length;while(s--){const t=e[s];"showing"===t.mode&&("descriptions"===t.kind?n=t:i=t)}if(i?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(i)):n&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(n)),!r.a.CSS.supports("inset","10px")){const e=this.el_,t=e.querySelectorAll(".vjs-text-track-cue"),n=this.player_.controlBar.el_.getBoundingClientRect().height,i=this.player_.el_.getBoundingClientRect().height;e.style="",wi(e,"position","relative"),wi(e,"height",i-n+"px"),wi(e,"top","unset"),wi(e,"bottom",fe?i+"px":"0px"),t.length>0&&t.forEach(e=>{if(e.style.inset){const t=e.style.inset.split(" ");3===t.length&&Object.assign(e.style,{top:t[0],right:t[1],bottom:t[2],left:"unset"})}})}}updateDisplayOverlay(){if(!this.player_.videoHeight()||!r.a.CSS.supports("inset-inline: 10px"))return;const e=this.player_.currentWidth(),t=this.player_.currentHeight(),n=e/t,i=this.player_.videoWidth()/this.player_.videoHeight();let s=0,a=0;Math.abs(n-i)>.1&&(n>i?s=Math.round((e-t*i)/2):a=Math.round((t-e/i)/2)),wi(this.el_,"insetInline",Ei(s)),wi(this.el_,"insetBlock",Ei(a))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),n=e.activeCues;let i=n.length;while(i--){const e=n[i];if(!e)continue;const s=e.displayState;if(t.color&&(s.firstChild.style.color=t.color),t.textOpacity&&wi(s.firstChild,"color",Si(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(s.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&wi(s.firstChild,"backgroundColor",Si(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?wi(s,"backgroundColor",Si(t.windowColor,t.windowOpacity)):s.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?s.firstChild.style.textShadow=`2px 2px 3px ${bi}, 2px 2px 4px ${bi}, 2px 2px 5px ${bi}`:"raised"===t.edgeStyle?s.firstChild.style.textShadow=`1px 1px ${bi}, 2px 2px ${bi}, 3px 3px ${bi}`:"depressed"===t.edgeStyle?s.firstChild.style.textShadow=`1px 1px ${_i}, 0 1px ${_i}, -1px -1px ${bi}, 0 -1px ${bi}`:"uniform"===t.edgeStyle&&(s.firstChild.style.textShadow=`0 0 4px ${bi}, 0 0 4px ${bi}, 0 0 4px ${bi}, 0 0 4px ${bi}`)),t.fontPercent&&1!==t.fontPercent){const e=r.a.parseFloat(s.style.fontSize);s.style.fontSize=e*t.fontPercent+"px",s.style.height="auto",s.style.top="auto"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?s.firstChild.style.fontVariant="small-caps":s.firstChild.style.fontFamily=Ti[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),"function"!==typeof r.a.WebVTT||e.every(e=>{return!e.activeCues}))return;const t=[];for(let n=0;n<e.length;++n){const i=e[n];for(let e=0;e<i.activeCues.length;++e)t.push(i.activeCues[e])}r.a.WebVTT.processCues(r.a,t,this.el_);for(let n=0;n<e.length;++n){const t=e[n];for(let e=0;e<t.activeCues.length;++e){const i=t.activeCues[e].displayState;Ce(i,"vjs-text-track-cue","vjs-text-track-cue-"+(t.language?t.language:n)),t.language&&Oe(i,"lang",t.language)}this.player_.textTrackSettings&&this.updateDisplayState(t)}}}qt.registerComponent("TextTrackDisplay",xi);class ki extends qt{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),n=xe("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),i=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return i.appendChild(n),i}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}}qt.registerComponent("LoadingSpinner",ki);class Ai extends vi{createEl(e,t={},n={}){e="button",t=Object.assign({className:this.buildCSSClass()},t),n=Object.assign({type:"button"},n);const i=xe(e,t,n);return this.player_.options_.experimentalSvgIcons||i.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(i),i}addChild(e,t={}){const n=this.constructor.name;return U.warn(`Adding an actionable (user controllable) child to a Button (${n}) is not supported; use a ClickableComponent instead.`),qt.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){" "!==e.key&&"Enter"!==e.key?super.handleKeyDown(e):e.stopPropagation()}}qt.registerComponent("Button",Ai);class Ii extends Ai{constructor(e,t){super(e,t),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",e=>this.handleMouseDown(e))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if(this.mouseused_&&"clientX"in e&&"clientY"in e)return on(t),void(this.player_.tech(!0)&&this.player_.tech(!0).focus());const n=this.player_.getChild("controlBar"),i=n&&n.getChild("playToggle");if(!i)return void this.player_.tech(!0).focus();const r=()=>i.focus();an(t)?t.then(r,()=>{}):this.setTimeout(r,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}Ii.prototype.controlText_="Play Video",qt.registerComponent("BigPlayButton",Ii);class Ci extends Ai{constructor(e,t){super(e,t),this.setIcon("cancel"),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){"Escape"===e.key?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}qt.registerComponent("CloseButton",Ci);class Di extends Ai{constructor(e,t={}){super(e,t),t.replay=void 0===t.replay||t.replay,this.setIcon("play"),this.on(e,"play",e=>this.handlePlay(e)),this.on(e,"pause",e=>this.handlePause(e)),t.replay&&this.on(e,"ended",e=>this.handleEnded(e))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?on(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",e=>this.handleSeeked(e))}}Di.prototype.controlText_="Play",qt.registerComponent("PlayToggle",Di);class Ri extends qt{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended","seeking"],e=>this.update(e)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),n=xe("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)}`},{role:"presentation"});return t.appendChild(n),this.contentEl_=xe("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){(this.player_.options_.enableSmoothSeeking||"seeking"!==e.type)&&this.updateContent(e)}updateTextNode_(e=0){e=tn(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let e=this.textNode_;e&&this.contentEl_.firstChild!==e&&(e=null,U.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=a.a.createTextNode(this.formattedTime_),this.textNode_&&(e?this.contentEl_.replaceChild(this.textNode_,e):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}}Ri.prototype.labelText_="Time",Ri.prototype.controlText_="Time",qt.registerComponent("TimeDisplay",Ri);class Mi extends Ri{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;t=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}Mi.prototype.labelText_="Current Time",Mi.prototype.controlText_="Current Time",qt.registerComponent("CurrentTimeDisplay",Mi);class Li extends Ri{constructor(e,t){super(e,t);const n=e=>this.updateContent(e);this.on(e,"durationchange",n),this.on(e,"loadstart",n),this.on(e,"loadedmetadata",n)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}Li.prototype.labelText_="Duration",Li.prototype.controlText_="Duration",qt.registerComponent("DurationDisplay",Li);class Pi extends qt{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),n=super.createEl("span",{textContent:"/"});return t.appendChild(n),e.appendChild(t),e}}qt.registerComponent("TimeDivider",Pi);class Oi extends Ri{constructor(e,t){super(e,t),this.on(e,"durationchange",e=>this.updateContent(e))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return!1!==this.options_.displayNegative&&e.insertBefore(xe("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if("number"!==typeof this.player_.duration())return;let t;t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t)}}Oi.prototype.labelText_="Remaining Time",Oi.prototype.controlText_="Remaining Time",qt.registerComponent("RemainingTimeDisplay",Oi);class Ni extends qt{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",e=>this.updateShowing(e))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=xe("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(xe("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")}`})),this.contentEl_.appendChild(a.a.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}}qt.registerComponent("LiveDisplay",Ni);class Ui extends Ai{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=(e=>this.updateLiveEdgeStatus(e)),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=xe("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}function Fi(e,t,n){return e=Number(e),Math.min(n,Math.max(t,isNaN(e)?t:e))}Ui.prototype.controlText_="Seek to live, currently playing live",qt.registerComponent("SeekToLive",Ui);var Bi=Object.freeze({__proto__:null,clamp:Fi});class ji extends qt{constructor(e,t){super(e,t),this.handleMouseDown_=(e=>this.handleMouseDown(e)),this.handleMouseUp_=(e=>this.handleMouseUp(e)),this.handleKeyDown_=(e=>this.handleKeyDown(e)),this.handleClick_=(e=>this.handleClick(e)),this.handleMouseMove_=(e=>this.handleMouseMove(e)),this.update_=(e=>this.update(e)),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},n={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),n=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},n),super.createEl(e,t,n)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||ne||e.preventDefault(),Ue(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;Fe(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_?e:(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(100*e).toFixed(2)+"%"}),e)}getProgress(){return Number(Fi(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=Ve(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){const t=this.options_.playerOptions.spatialNavigation,n=t&&t.enabled,i=t&&t.horizontalSeek;n?i&&"ArrowLeft"===e.key||!i&&"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepBack()):i&&"ArrowRight"===e.key||!i&&"ArrowUp"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e):"ArrowLeft"===e.key||"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepBack()):"ArrowUp"===e.key||"ArrowRight"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}qt.registerComponent("Slider",ji);const Vi=(e,t)=>Fi(e/t*100,0,100).toFixed(2)+"%";class Hi extends qt{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",e=>this.update(e))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=xe("span",{className:"vjs-control-text"}),n=xe("span",{textContent:this.localize("Loaded")}),i=a.a.createTextNode(": ");return this.percentageEl_=xe("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(n),t.appendChild(i),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const e=this.player_.liveTracker,t=this.player_.buffered(),n=e&&e.isLive()?e.seekableEnd():this.player_.duration(),i=this.player_.bufferedEnd(),r=this.partEls_,s=Vi(i,n);this.percent_!==s&&(this.el_.style.width=s,ke(this.percentageEl_,s),this.percent_=s);for(let a=0;a<t.length;a++){const e=t.start(a),n=t.end(a);let s=r[a];s||(s=this.el_.appendChild(xe()),r[a]=s),s.dataset.start===e&&s.dataset.end===n||(s.dataset.start=e,s.dataset.end=n,s.style.left=Vi(e,i),s.style.width=Vi(n-e,i))}for(let a=r.length;a>t.length;a--)this.el_.removeChild(r[a-1]);r.length=t.length})}}qt.registerComponent("LoadProgressBar",Hi);class $i extends qt{constructor(e,t){super(e,t),this.update=Et(wt(this,this.update),St)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,n){const i=je(this.el_),r=Be(this.player_.el()),s=e.width*t;if(!r||!i)return;let a=e.left-r.left+s,o=e.width-s+(r.right-e.right);o||(o=e.width-s,a=s);let l=i.width/2;a<l?l+=l-a:o<l&&(l=o),l<0?l=0:l>i.width&&(l=i.width),l=Math.round(l),this.el_.style.right=`-${l}px`,this.write(n)}write(e){ke(this.el_,e)}updateTime(e,t,n,i){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let r;const s=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const e=this.player_.liveTracker.liveWindow(),n=e-t*e;r=(n<1?"":"-")+tn(n,e)}else r=tn(n,s);this.update(e,t,r),i&&i()})}}qt.registerComponent("TimeTooltip",$i);class Gi extends qt{constructor(e,t){super(e,t),this.setIcon("circle"),this.update=Et(wt(this,this.update),St)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t){const n=this.getChild("timeTooltip");if(!n)return;const i=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();n.updateTime(e,t,i)}}Gi.prototype.options_={children:[]},me||Z||Gi.prototype.options_.children.push("timeTooltip"),qt.registerComponent("PlayProgressBar",Gi);class zi extends qt{constructor(e,t){super(e,t),this.update=Et(wt(this,this.update),St)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,()=>{this.el_.style.left=`${e.width*t}px`})}}zi.prototype.options_={children:["timeTooltip"]},qt.registerComponent("MouseTimeDisplay",zi);class qi extends ji{constructor(e,t){t=z(qi.prototype.options_,t),t.children=[...t.children];const n=e.options_.disableSeekWhileScrubbingOnMobile&&(me||Z);(!me&&!Z||n)&&t.children.splice(1,0,"mouseTimeDisplay"),super(e,t),this.shouldDisableSeekWhileScrubbingOnMobile_=n,this.pendingSeekTime_=null,this.setEventHandlers_()}setEventHandlers_(){this.update_=wt(this,this.update),this.update=Et(this.update_,St),this.on(this.player_,["durationchange","timeupdate"],this.update),this.on(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=(e=>this.enableInterval_(e)),this.disableIntervalHandler_=(e=>this.disableInterval_(e)),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in a.a&&"visibilityState"in a.a&&this.on(a.a,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){"hidden"===a.a.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,St))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if("hidden"===a.a.visibilityState)return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const e=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),n=this.player_.liveTracker;let i=this.player_.duration();n&&n.isLive()&&(i=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(100*t).toFixed(2)),this.percent_=t),this.currentTime_===e&&this.duration_===i||(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[tn(e,i),tn(i,i)],"{1} of {2}")),this.currentTime_=e,this.duration_=i),this.bar&&this.bar.update(Be(this.el()),this.getProgress())}),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}getPercent(){if(this.pendingSeekTime_)return this.pendingSeekTime_/this.player_.duration();const e=this.getCurrentTime_();let t;const n=this.player_.liveTracker;return n&&n.isLive()?(t=(e-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){We(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.shouldDisableSeekWhileScrubbingOnMobile_||this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!We(e)||isNaN(this.player_.duration()))return;let n;t||this.player_.scrubbing()||this.player_.scrubbing(!0);const i=this.calculateDistance(e),r=this.player_.liveTracker;if(r&&r.isLive()){if(i>=.99)return void r.seekToLiveEdge();const e=r.seekableStart(),t=r.liveCurrentTime();if(n=e+i*r.liveWindow(),n>=t&&(n=t),n<=e&&(n=e+.1),n===1/0)return}else n=i*this.player_.duration(),n===this.player_.duration()&&(n-=.1);this.shouldDisableSeekWhileScrubbingOnMobile_?this.pendingSeekTime_=n:this.userSeek_(n),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.pendingSeekTime_&&(this.userSeek_(this.pendingSeekTime_),this.pendingSeekTime_=null),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?on(this.player_.play()):this.update_()}stepForward(){this.userSeek_(this.player_.currentTime()+this.options().stepSeconds)}stepBack(){this.userSeek_(this.player_.currentTime()-this.options().stepSeconds)}handleAction(e){this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(" "===e.key||"Enter"===e.key)e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if("Home"===e.key)e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if("End"===e.key)e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(e.key)){e.preventDefault(),e.stopPropagation();const n=.1*parseInt(e.key,10);t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else"PageDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-this.options().stepSeconds*this.options().pageMultiplier)):"PageUp"===e.key?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+this.options().stepSeconds*this.options().pageMultiplier)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["durationchange","timeupdate"],this.update),this.off(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in a.a&&"visibilityState"in a.a&&this.off(a.a,"visibilitychange",this.toggleVisibility_),super.dispose()}}qi.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar",stepSeconds:5,pageMultiplier:12},qt.registerComponent("SeekBar",qi);class Wi extends qt{constructor(e,t){super(e,t),this.handleMouseMove=Et(wt(this,this.handleMouseMove),St),this.throttledHandleMouseSeek=Et(wt(this,this.handleMouseSeek),St),this.handleMouseUpHandler_=(e=>this.handleMouseUp(e)),this.handleMouseDownHandler_=(e=>this.handleMouseDown(e)),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const n=t.getChild("playProgressBar"),i=t.getChild("mouseTimeDisplay");if(!n&&!i)return;const r=t.el(),s=je(r);let a=Ve(r,e).x;a=Fi(a,0,1),i&&i.update(s,a),n&&n.update(s,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&on(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}Wi.prototype.options_={children:["seekBar"]},qt.registerComponent("ProgressControl",Wi);class Ki extends Ai{constructor(e,t){super(e,t),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],e=>this.handlePictureInPictureChange(e)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],e=>this.handlePictureInPictureEnabledChange(e)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>this.handlePictureInPictureAudioModeChange()),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control vjs-hidden ${super.buildCSSClass()}`}handlePictureInPictureAudioModeChange(){const e="audio"===this.player_.currentType().substring(0,5),t=e||this.player_.audioPosterMode()||this.player_.audioOnlyMode();t?(this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()):this.show()}handlePictureInPictureEnabledChange(){a.a.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in r.a?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){"function"===typeof a.a.exitPictureInPicture&&super.show()}}Ki.prototype.controlText_="Picture-in-Picture",qt.registerComponent("PictureInPictureToggle",Ki);class Yi extends Ai{constructor(e,t){super(e,t),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",e=>this.handleFullscreenChange(e)),!1===a.a[e.fsApi_.fullscreenEnabled]&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}Yi.prototype.controlText_="Fullscreen",qt.registerComponent("FullscreenToggle",Yi);const Xi=function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})};class Qi extends qt{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}}qt.registerComponent("VolumeLevel",Qi);class Zi extends qt{constructor(e,t){super(e,t),this.update=Et(wt(this,this.update),St)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,n,i){if(!n){const n=Be(this.el_),i=Be(this.player_.el()),r=e.width*t;if(!i||!n)return;const s=e.left-i.left+r,a=e.width-r+(i.right-e.right);let o=n.width/2;s<o?o+=o-s:a<o&&(o=a),o<0?o=0:o>n.width&&(o=n.width),this.el_.style.right=`-${o}px`}this.write(`${i}%`)}write(e){ke(this.el_,e)}updateVolume(e,t,n,i,r){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,t,n,i.toFixed(0)),r&&r()})}}qt.registerComponent("VolumeLevelTooltip",Zi);class Ji extends qt{constructor(e,t){super(e,t),this.update=Et(wt(this,this.update),St)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,n){const i=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,n,i,()=>{n?this.el_.style.bottom=`${e.height*t}px`:this.el_.style.left=`${e.width*t}px`})}}Ji.prototype.options_={children:["volumeLevelTooltip"]},qt.registerComponent("MouseVolumeLevelDisplay",Ji);class er extends ji{constructor(e,t){super(e,t),this.on("slideractive",e=>this.updateLastVolume_(e)),this.on(e,"volumechange",e=>this.updateARIAAttributes(e)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){We(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const n=this.el(),i=Be(n),r=this.vertical();let s=Ve(n,e);s=r?s.y:s.x,s=Fi(s,0,1),t.update(i,s,r)}We(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(100*this.player_.volume())}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{0===this.player_.volume()&&this.player_.lastVolume_(e)})}}er.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},me||Z||er.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),er.prototype.playerEvent="volumechange",qt.registerComponent("VolumeBar",er);class tr extends qt{constructor(e,t={}){t.vertical=t.vertical||!1,("undefined"===typeof t.volumeBar||G(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),Xi(this,e),this.throttledHandleMouseMove=Et(wt(this,this.handleMouseMove),St),this.handleMouseUpHandler_=(e=>this.handleMouseUp(e)),this.on("mousedown",e=>this.handleMouseDown(e)),this.on("touchstart",e=>this.handleMouseDown(e)),this.on("mousemove",e=>this.handleMouseMove(e)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}tr.prototype.options_={children:["volumeBar"]},qt.registerComponent("VolumeControl",tr);const nr=function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")})};class ir extends Ai{constructor(e,t){super(e,t),nr(this,e),this.on(e,["loadstart","volumechange"],e=>this.update(e))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),n=this.player_.lastVolume_();if(0===t){const e=n<.1?.1:n;this.player_.volume(e),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;this.setIcon("volume-high"),me&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?(this.setIcon("volume-mute"),t=0):e<.33?(this.setIcon("volume-low"),t=1):e<.67&&(this.setIcon("volume-medium"),t=2),De(this.el_,[0,1,2,3].reduce((e,t)=>e+`${t?" ":""}vjs-vol-${t}`,"")),Ce(this.el_,`vjs-vol-${t}`)}updateControlText_(){const e=this.player_.muted()||0===this.player_.volume(),t=e?"Unmute":"Mute";this.controlText()!==t&&this.controlText(t)}}ir.prototype.controlText_="Mute",qt.registerComponent("MuteToggle",ir);class rr extends qt{constructor(e,t={}){"undefined"!==typeof t.inline?t.inline=t.inline:t.inline=!0,("undefined"===typeof t.volumeControl||G(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=(e=>this.handleKeyPress(e)),this.on(e,["loadstart"],e=>this.volumePanelState_(e)),this.on(this.muteToggle,"keyup",e=>this.handleKeyPress(e)),this.on(this.volumeControl,"keyup",e=>this.handleVolumeControlKeyUp(e)),this.on("keydown",e=>this.handleKeyPress(e)),this.on("mouseover",e=>this.handleMouseOver(e)),this.on("mouseout",e=>this.handleMouseOut(e)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){"Escape"===e.key&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),mt(a.a,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),vt(a.a,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){"Escape"===e.key&&this.handleMouseOut()}}rr.prototype.options_={children:["muteToggle","volumeControl"]},qt.registerComponent("VolumePanel",rr);class sr extends Ai{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`forward-${this.skipTime}`),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){if(isNaN(this.player_.duration()))return;const t=this.player_.currentTime(),n=this.player_.liveTracker,i=n&&n.isLive()?n.seekableEnd():this.player_.duration();let r;r=t+this.skipTime<=i?t+this.skipTime:i,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}sr.prototype.controlText_="Skip Forward",qt.registerComponent("SkipForward",sr);class ar extends Ai{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`replay-${this.skipTime}`),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,i=n&&n.isLive()&&n.seekableStart();let r;r=i&&t-this.skipTime<=i?i:t>=this.skipTime?t-this.skipTime:0,this.player_.currentTime(r)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}ar.prototype.controlText_="Skip Backward",qt.registerComponent("SkipBackward",ar);class or extends qt{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",e=>this.handleKeyDown(e)),this.boundHandleBlur_=(e=>this.handleBlur(e)),this.boundHandleTapClick_=(e=>this.handleTapClick(e))}addEventListenerForItem(e){e instanceof qt&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof qt&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){"string"===typeof e&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=xe(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),mt(t,"click",function(e){e.preventDefault(),e.stopImmediatePropagation()}),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||a.a.activeElement;if(!this.children().some(e=>{return e.el()===t})){const e=this.menuButton_;e&&e.buttonPressed_&&t!==e.el().firstChild&&e.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const n=t.filter(t=>t.el()===e.target)[0];if(!n)return;"CaptionSettingsMenuItem"!==n.name()&&this.menuButton_.focus()}}handleKeyDown(e){"ArrowLeft"===e.key||"ArrowDown"===e.key?(e.preventDefault(),e.stopPropagation(),this.stepForward()):"ArrowRight"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice(),n=t.length&&t[0].hasClass("vjs-menu-title");n&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}qt.registerComponent("Menu",or);class lr extends qt{constructor(e,t={}){super(e,t),this.menuButton_=new Ai(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const n=Ai.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+n,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const i=e=>this.handleClick(e);this.handleMenuKeyUp_=(e=>this.handleMenuKeyUp(e)),this.on(this.menuButton_,"tap",i),this.on(this.menuButton_,"click",i),this.on(this.menuButton_,"keydown",e=>this.handleKeyDown(e)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),mt(a.a,"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",e=>this.handleMouseLeave(e)),this.on("keydown",e=>this.handleSubmenuKeyDown(e))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new or(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=xe("li",{className:"vjs-menu-title",textContent:$t(this.options_.title),tabIndex:-1}),n=new qt(this.player_,{el:t});e.addItem(n)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";!0===this.options_.inline?e+="-inline":e+="-popup";const t=Ai.prototype.buildCSSClass();return`vjs-menu-button ${e} ${t} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return!0===this.options_.inline?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),vt(a.a,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){"Escape"===e.key||"Tab"===e.key?(this.buttonPressed_&&this.unpressButton(),"Tab"===!e.key&&(e.preventDefault(),this.menuButton_.focus())):"Up"!==e.key&&("Down"!==e.key||this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled)||this.buttonPressed_||(e.preventDefault(),this.pressButton())}handleMenuKeyUp(e){"Escape"!==e.key&&"Tab"!==e.key||this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){"Escape"!==e.key&&"Tab"!==e.key||(this.buttonPressed_&&this.unpressButton(),"Tab"===!e.key&&(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),me&&we())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}qt.registerComponent("MenuButton",lr);class ur extends lr{constructor(e,t){const n=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!n)return;const i=wt(this,this.update);n.addEventListener("removetrack",i),n.addEventListener("addtrack",i),n.addEventListener("labelchange",i),this.player_.on("ready",i),this.player_.on("dispose",function(){n.removeEventListener("removetrack",i),n.removeEventListener("addtrack",i),n.removeEventListener("labelchange",i)})}}qt.registerComponent("TrackButton",ur);class cr extends vi{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,n){this.nonIconControl=!0;const i=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),n),r=xe("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?i.appendChild(r):i.replaceChild(r,i.querySelector(".vjs-icon-placeholder")),i}handleKeyDown(e){["Tab","Escape","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"].includes(e.key)||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}qt.registerComponent("MenuItem",cr);class dr extends cr{constructor(e,t){const n=t.track,i=e.textTracks();t.label=n.label||n.language||"Unknown",t.selected="showing"===n.mode,super(e,t),this.track=n,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const s=(...e)=>{this.handleTracksChange.apply(this,e)},o=(...e)=>{this.handleSelectedLanguageChange.apply(this,e)};if(e.on(["loadstart","texttrackchange"],s),i.addEventListener("change",s),i.addEventListener("selectedlanguagechange",o),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],s),i.removeEventListener("change",s),i.removeEventListener("selectedlanguagechange",o)}),void 0===i.onchange){let e;this.on(["tap","click"],function(){if("object"!==typeof r.a.Event)try{e=new r.a.Event("change")}catch(e){}e||(e=a.a.createEvent("Event"),e.initEvent("change",!0,!0)),i.dispatchEvent(e)})}this.handleTracksChange()}handleClick(e){const t=this.track,n=this.player_.textTracks();if(super.handleClick(e),n)for(let i=0;i<n.length;i++){const e=n[i];-1!==this.kinds.indexOf(e.kind)&&(e===t?"showing"!==e.mode&&(e.mode="showing"):"disabled"!==e.mode&&(e.mode="disabled"))}}handleTracksChange(e){const t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if("showing"===this.track.mode){const e=this.player_.cache_.selectedLanguage;if(e&&e.enabled&&e.language===this.track.language&&e.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}qt.registerComponent("TextTrackMenuItem",dr);class hr extends dr{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let n=!0;for(let i=0,r=t.length;i<r;i++){const e=t[i];if(this.options_.kinds.indexOf(e.kind)>-1&&"showing"===e.mode){n=!1;break}}n!==this.isSelected_&&this.selected(n)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let n=!0;for(let i=0,r=t.length;i<r;i++){const e=t[i];if(["captions","descriptions","subtitles"].indexOf(e.kind)>-1&&"showing"===e.mode){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}qt.registerComponent("OffTextTrackMenuItem",hr);class fr extends ur{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=dr){let n;this.label_&&(n=`${this.label_} off`),e.push(new hr(this.player_,{kinds:this.kinds_,kind:this.kind_,label:n})),this.hideThreshold_+=1;const i=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let r=0;r<i.length;r++){const n=i[r];if(this.kinds_.indexOf(n.kind)>-1){const i=new t(this.player_,{track:n,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});i.addClass(`vjs-${n.kind}-menu-item`),e.push(i)}}return e}}qt.registerComponent("TextTrackButton",fr);class pr extends cr{constructor(e,t){const n=t.track,i=t.cue,r=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=i.text,t.selected=i.startTime<=r&&r<i.endTime,super(e,t),this.track=n,this.cue=i}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}qt.registerComponent("ChaptersTrackMenuItem",pr);class gr extends fr{constructor(e,t,n){super(e,t,n),this.setIcon("chapters"),this.selectCurrentItem_=(()=>{this.items.forEach(e=>{e.selected(this.track_.activeCues[0]===e.cue)})})}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&"chapters"!==e.track.kind)return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);e&&e.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.kind===this.kind_)return n}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize($t(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new pr(this.player_,{track:this.track_,cue:i});e.push(r)}return e}}gr.prototype.kind_="chapters",gr.prototype.controlText_="Chapters",qt.registerComponent("ChaptersButton",gr);class mr extends fr{constructor(e,t,n){super(e,t,n),this.setIcon("audio-description");const i=e.textTracks(),r=wt(this,this.handleTracksChange);i.addEventListener("change",r),this.on("dispose",function(){i.removeEventListener("change",r)})}handleTracksChange(e){const t=this.player().textTracks();let n=!1;for(let i=0,r=t.length;i<r;i++){const e=t[i];if(e.kind!==this.kind_&&"showing"===e.mode){n=!0;break}}n?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}mr.prototype.kind_="descriptions",mr.prototype.controlText_="Descriptions",qt.registerComponent("DescriptionsButton",mr);class vr extends fr{constructor(e,t,n){super(e,t,n),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}vr.prototype.kind_="subtitles",vr.prototype.controlText_="Subtitles",qt.registerComponent("SubtitlesButton",vr);class yr extends dr{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}qt.registerComponent("CaptionSettingsMenuItem",yr);class br extends fr{constructor(e,t,n){super(e,t,n),this.setIcon("captions")}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new yr(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}br.prototype.kind_="captions",br.prototype.controlText_="Captions",qt.registerComponent("CaptionsButton",br);class _r extends dr{createEl(e,t,n){const i=super.createEl(e,t,n),r=i.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",i):r.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(xe("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),i}}qt.registerComponent("SubsCapsMenuItem",_r);class Tr extends fr{constructor(e,t={}){super(e,t),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText($t(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(e.push(new yr(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,_r),e}}Tr.prototype.kinds_=["captions","subtitles"],Tr.prototype.controlText_="Subtitles",qt.registerComponent("SubsCapsButton",Tr);class Sr extends cr{constructor(e,t){const n=t.track,i=e.audioTracks();t.label=n.label||n.language||"Unknown",t.selected=n.enabled,super(e,t),this.track=n,this.addClass(`vjs-${n.kind}-menu-item`);const r=(...e)=>{this.handleTracksChange.apply(this,e)};i.addEventListener("change",r),this.on("dispose",()=>{i.removeEventListener("change",r)})}createEl(e,t,n){const i=super.createEl(e,t,n),r=i.querySelector(".vjs-menu-item-text");return["main-desc","descriptions"].indexOf(this.options_.track.kind)>=0&&(r.appendChild(xe("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),r.appendChild(xe("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),i}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const e=this.player_.audioTracks();for(let t=0;t<e.length;t++){const n=e[t];n!==this.track&&(n.enabled=n===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}qt.registerComponent("AudioTrackMenuItem",Sr);class wr extends ur{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t),this.setIcon("audio")}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const i=t[n];e.push(new Sr(this.player_,{track:i,selectable:!0,multiSelectable:!1}))}return e}}wr.prototype.controlText_="Audio Track",qt.registerComponent("AudioTrackButton",wr);class Er extends cr{constructor(e,t){const n=t.rate,i=parseFloat(n,10);t.label=n,t.selected=i===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=n,this.rate=i,this.on(e,"ratechange",e=>this.update(e))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}Er.prototype.contentElType="button",qt.registerComponent("PlaybackRateMenuItem",Er);class xr extends lr{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",e=>this.updateVisibility(e)),this.on(e,"ratechange",e=>this.updateLabel(e)),this.on(e,"playbackrateschange",e=>this.handlePlaybackRateschange(e))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=xe("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let n=e.length-1;n>=0;n--)t.push(new Er(this.player(),{rate:e[n]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}xr.prototype.controlText_="Playback Rate",qt.registerComponent("PlaybackRateMenuButton",xr);class kr extends qt{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},n={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,n)}}qt.registerComponent("Spacer",kr);class Ar extends kr{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:""})}}qt.registerComponent("CustomControlSpacer",Ar);class Ir extends qt{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}Ir.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]},qt.registerComponent("ControlBar",Ir);class Cr extends fn{constructor(e,t){super(e,t),this.on(e,"error",e=>{this.open(e)})}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}Cr.prototype.options_=Object.assign({},fn.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),qt.registerComponent("ErrorDisplay",Cr);class Dr extends qt{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-labelledby",this.selectLabelledbyIds)}createEl(){this.selectLabelledbyIds=[this.options_.legendId,this.options_.labelId].join(" ").trim();const e=xe("select",{id:this.options_.id},{},this.options_.SelectOptions.map(e=>{const t=(this.options_.labelId?this.options_.labelId:`vjs-track-option-${ct()}`)+"-"+e[1].replace(/\W+/g,""),n=xe("option",{id:t,value:this.localize(e[0]),textContent:this.localize(e[1])});return n.setAttribute("aria-labelledby",`${this.selectLabelledbyIds} ${t}`),n}));return e}}qt.registerComponent("TextTrackSelect",Dr);class Rr extends qt{constructor(e,t={}){super(e,t);const n=xe("legend",{textContent:this.localize(this.options_.legendText),id:this.options_.legendId});this.el().appendChild(n);const i=this.options_.selects;for(const r of i){const t=this.options_.selectConfigs[r],n=t.className,i=t.id.replace("%s",this.options_.id_);let s=null;const a=`vjs_select_${ct()}`;if("colors"===this.options_.type){s=xe("span",{className:n});const e=xe("label",{id:i,className:"vjs-label",textContent:this.localize(t.label)});e.setAttribute("for",a),s.appendChild(e)}const o=new Dr(e,{SelectOptions:t.options,legendId:this.options_.legendId,id:a,labelId:i});this.addChild(o),"colors"===this.options_.type&&(s.appendChild(o.el()),this.el().appendChild(s))}}createEl(){const e=xe("fieldset",{className:this.options_.className});return e}}qt.registerComponent("TextTrackFieldset",Rr);class Mr extends qt{constructor(e,t={}){super(e,t);const n=this.options_.textTrackComponentid,i=new Rr(e,{id_:n,legendId:`captions-text-legend-${n}`,legendText:this.localize("Text"),className:"vjs-fg vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(i);const r=new Rr(e,{id_:n,legendId:`captions-background-${n}`,legendText:this.localize("Text Background"),className:"vjs-bg vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(r);const s=new Rr(e,{id_:n,legendId:`captions-window-${n}`,legendText:this.localize("Caption Area Background"),className:"vjs-window vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(s)}createEl(){const e=xe("div",{className:"vjs-track-settings-colors"});return e}}qt.registerComponent("TextTrackSettingsColors",Mr);class Lr extends qt{constructor(e,t={}){super(e,t);const n=this.options_.textTrackComponentid,i=new Rr(e,{id_:n,legendId:`captions-font-size-${n}`,legendText:"Font Size",className:"vjs-font-percent vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(i);const r=new Rr(e,{id_:n,legendId:`captions-edge-style-${n}`,legendText:this.localize("Text Edge Style"),className:"vjs-edge-style vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(r);const s=new Rr(e,{id_:n,legendId:`captions-font-family-${n}`,legendText:this.localize("Font Family"),className:"vjs-font-family vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(s)}createEl(){const e=xe("div",{className:"vjs-track-settings-font"});return e}}qt.registerComponent("TextTrackSettingsFont",Lr);class Pr extends qt{constructor(e,t={}){super(e,t);const n=this.localize("restore all settings to the default values"),i=new Ai(e,{controlText:n,className:"vjs-default-button"});i.el().classList.remove("vjs-control","vjs-button"),i.el().textContent=this.localize("Reset"),this.addChild(i);const r=new Ai(e,{controlText:n,className:"vjs-done-button"});r.el().classList.remove("vjs-control","vjs-button"),r.el().textContent=this.localize("Done"),this.addChild(r)}createEl(){const e=xe("div",{className:"vjs-track-settings-controls"});return e}}qt.registerComponent("TrackSettingsControls",Pr);const Or="vjs-text-track-settings",Nr=["#000","Black"],Ur=["#00F","Blue"],Fr=["#0FF","Cyan"],Br=["#0F0","Green"],jr=["#F0F","Magenta"],Vr=["#F00","Red"],Hr=["#FFF","White"],$r=["#FF0","Yellow"],Gr=["1","Opaque"],zr=["0.5","Semi-Transparent"],qr=["0","Transparent"],Wr={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[Nr,Hr,Vr,Br,Ur,$r,jr,Fr],className:"vjs-bg-color"},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[Gr,zr,qr],className:"vjs-bg-opacity vjs-opacity"},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Hr,Nr,Vr,Br,Ur,$r,jr,Fr],className:"vjs-text-color"},edgeStyle:{selector:".vjs-edge-style > select",id:"",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:e=>"1.00"===e?null:Number(e)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[Gr,zr],className:"vjs-text-opacity vjs-opacity"},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color",className:"vjs-window-color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[qr,zr,Gr],className:"vjs-window-opacity vjs-opacity"}};function Kr(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}function Yr(e,t){const n=e.options[e.options.selectedIndex].value;return Kr(n,t)}function Xr(e,t,n){if(t)for(let i=0;i<e.options.length;i++)if(Kr(e.options[i].value,n)===t){e.selectedIndex=i;break}}Wr.windowColor.options=Wr.backgroundColor.options;class Qr extends fn{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.renderModalComponents(e),this.endDialog=xe("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),void 0===t.persistTextTrackSettings&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.bindFunctionsToSelectsAndButtons(),this.options_.persistTextTrackSettings&&this.restoreSettings()}renderModalComponents(e){const t=new Mr(e,{textTrackComponentid:this.id_,selectConfigs:Wr,fieldSets:[["color","textOpacity"],["backgroundColor","backgroundOpacity"],["windowColor","windowOpacity"]]});this.addChild(t);const n=new Lr(e,{textTrackComponentid:this.id_,selectConfigs:Wr,fieldSets:[["fontPercent"],["edgeStyle"],["fontFamily"]]});this.addChild(n);const i=new Pr(e);this.addChild(i)}bindFunctionsToSelectsAndButtons(){this.on(this.$(".vjs-done-button"),["click","tap"],()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),["click","tap"],()=>{this.setDefaults(),this.updateDisplay()}),V(Wr,e=>{this.on(this.$(e.selector),"change",this.updateDisplay)})}dispose(){this.endDialog=null,super.dispose()}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return H(Wr,(e,t,n)=>{const i=Yr(this.$(t.selector),t.parser);return void 0!==i&&(e[n]=i),e},{})}setValues(e){V(Wr,(t,n)=>{Xr(this.$(t.selector),e[n],t.parser)})}setDefaults(){V(Wr,e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t})}restoreSettings(){let e;try{e=JSON.parse(r.a.localStorage.getItem(Or))}catch(e){U.warn(e)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?r.a.localStorage.setItem(Or,JSON.stringify(e)):r.a.localStorage.removeItem(Or)}catch(e){U.warn(e)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}handleLanguagechange(){this.fill(),this.renderModalComponents(this.player_),this.bindFunctionsToSelectsAndButtons()}}qt.registerComponent("TextTrackSettings",Qr);class Zr extends qt{constructor(e,t){let n=t.ResizeObserver||r.a.ResizeObserver;null===t.ResizeObserver&&(n=!1);const i=z({createEl:!n,reportTouchActivity:!1},t);super(e,i),this.ResizeObserver=t.ResizeObserver||r.a.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=xt(()=>{this.resizeHandler()},100,!1,this),n?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=(()=>{if(!this.el_||!this.el_.contentWindow)return;const e=this.debouncedHandler_;let t=this.unloadListener_=function(){vt(this,"resize",e),vt(this,"unload",t),t=null};mt(this.el_.contentWindow,"unload",t),mt(this.el_.contentWindow,"resize",e)}),this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}}qt.registerComponent("ResizeManager",Zr);const Jr={trackingThreshold:20,liveTolerance:15};class es extends qt{constructor(e,t){const n=z(Jr,t,{createEl:!1});super(e,n),this.trackLiveHandler_=(()=>this.trackLive_()),this.handlePlay_=(e=>this.handlePlay(e)),this.handleFirstTimeupdate_=(e=>this.handleFirstTimeupdate(e)),this.handleSeeked_=(e=>this.handleSeeked(e)),this.seekToLiveEdge_=(e=>this.seekToLiveEdge(e)),this.reset_(),this.on(this.player_,"durationchange",e=>this.handleDurationchange(e)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(r.a.performance.now().toFixed(4)),n=-1===this.lastTime_?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+n;const i=this.liveCurrentTime(),s=this.player_.currentTime();let a=this.player_.paused()||this.seekedBehindLive_||Math.abs(i-s)>this.options_.liveTolerance;this.timeupdateSeen_&&i!==1/0||(a=!1),a!==this.behindLiveEdge_&&(this.behindLiveEdge_=a,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,St),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;while(n--)t.push(e.end(n));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;while(n--)t.push(e.start(n));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return"number"===typeof this.trackingInterval_}seekToLiveEdge(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}}qt.registerComponent("LiveTracker",es);class ts extends qt{constructor(e,t){super(e,t),this.on("statechanged",e=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:xe("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${ct()}`}),description:xe("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${ct()}`})},xe("div",{className:"vjs-title-bar"},{},q(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,n={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(e=>{const i=this.state[e],r=this.els[e],s=n[e];$e(r),i&&ke(r,i),t&&(t.removeAttribute(s),i&&t.setAttribute(s,r.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}}qt.registerComponent("TitleBar",ts);const ns={initialDisplay:4e3,position:[],takeFocus:!1};class is extends Ai{constructor(e,t){t=z(ns,t),super(e,t),this.controlText(t.controlText),this.hide(),this.on(this.player_,["useractive","userinactive"],e=>{this.removeClass("force-display")})}buildCSSClass(){return`vjs-transient-button focus-visible ${this.options_.position.map(e=>`vjs-${e}`).join(" ")}`}createEl(){const e=xe("button",{},{type:"button",class:this.buildCSSClass()},xe("span"));return this.controlTextEl_=e.querySelector("span"),e}show(){super.show(),this.addClass("force-display"),this.options_.takeFocus&&this.el().focus({preventScroll:!0}),this.forceDisplayTimeout=this.player_.setTimeout(()=>{this.removeClass("force-display")},this.options_.initialDisplay)}hide(){this.removeClass("force-display"),super.hide()}dispose(){this.player_.clearTimeout(this.forceDisplayTimeout),super.dispose()}}qt.registerComponent("TransientButton",is);const rs=e=>{const t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;const n=e.$$("source"),i=[];let r="";if(!n.length)return!1;for(let s=0;s<n.length;s++){const e=n[s].src;e&&-1===i.indexOf(e)&&i.push(e)}return!!i.length&&(1===i.length&&(r=i[0]),e.triggerSourceset(r),!0)},ss=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(e){const t=a.a.createElement(this.nodeName.toLowerCase());t.innerHTML=e;const n=a.a.createDocumentFragment();while(t.childNodes.length)n.appendChild(t.childNodes[0]);return this.innerText="",r.a.Element.prototype.appendChild.call(this,n),this.innerHTML}}),as=(e,t)=>{let n={};for(let i=0;i<e.length;i++)if(n=Object.getOwnPropertyDescriptor(e[i],t),n&&n.set&&n.get)break;return n.enumerable=!0,n.configurable=!0,n},os=e=>as([e.el(),r.a.HTMLMediaElement.prototype,r.a.Element.prototype,ss],"innerHTML"),ls=function(e){const t=e.el();if(t.resetSourceWatch_)return;const n={},i=os(e),r=n=>(...i)=>{const r=n.apply(t,i);return rs(e),r};["append","appendChild","insertAdjacentHTML"].forEach(e=>{t[e]&&(n[e]=t[e],t[e]=r(n[e]))}),Object.defineProperty(t,"innerHTML",z(i,{set:r(i.set)})),t.resetSourceWatch_=(()=>{t.resetSourceWatch_=null,Object.keys(n).forEach(e=>{t[e]=n[e]}),Object.defineProperty(t,"innerHTML",i)}),e.one("sourceset",t.resetSourceWatch_)},us=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?In(r.a.Element.prototype.getAttribute.call(this,"src")):""},set(e){return r.a.Element.prototype.setAttribute.call(this,"src",e),e}}),cs=e=>as([e.el(),r.a.HTMLMediaElement.prototype,us],"src"),ds=function(e){if(!e.featuresSourceset)return;const t=e.el();if(t.resetSourceset_)return;const n=cs(e),i=t.setAttribute,r=t.load;Object.defineProperty(t,"src",z(n,{set:i=>{const r=n.set.call(t,i);return e.triggerSourceset(t.src),r}})),t.setAttribute=((n,r)=>{const s=i.call(t,n,r);return/src/i.test(n)&&e.triggerSourceset(t.src),s}),t.load=(()=>{const n=r.call(t);return rs(e)||(e.triggerSourceset(""),ls(e)),n}),t.currentSrc?e.triggerSourceset(t.currentSrc):rs(e)||ls(e),t.resetSourceset_=(()=>{t.resetSourceset_=null,t.load=r,t.setAttribute=i,Object.defineProperty(t,"src",n),t.resetSourceWatch_&&t.resetSourceWatch_()})};class hs extends Hn{constructor(e,t){super(e,t);const n=e.source;let i=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&"VIDEO"===this.el_.tagName,n&&(this.el_.currentSrc!==n.src||e.tag&&3===e.tag.initNetworkState_)?this.setSource(n):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const e=this.el_.childNodes;let t=e.length;const n=[];while(t--){const r=e[t],s=r.nodeName.toLowerCase();"track"===s&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(r),this.remoteTextTracks().addTrack(r.track),this.textTracks().addTrack(r.track),i||this.el_.hasAttribute("crossorigin")||!Dn(r.src)||(i=!0)):n.push(r))}for(let i=0;i<n.length;i++)this.el_.removeChild(n[i])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&i&&U.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),this.restoreMetadataTracksInIOSNativePlayer_(),(pe||ce)&&!0===e.nativeControlsForTouch&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),hs.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){ds(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const n=()=>{t=[];for(let n=0;n<e.length;n++){const i=e[n];"metadata"===i.kind&&t.push({track:i,storedMode:i.mode})}};n(),e.addEventListener("change",n),this.on("dispose",()=>e.removeEventListener("change",n));const i=()=>{for(let e=0;e<t.length;e++){const n=t[e];"disabled"===n.track.mode&&n.track.mode!==n.storedMode&&(n.track.mode=n.storedMode)}e.removeEventListener("change",i)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",n),e.removeEventListener("change",i),e.addEventListener("change",i)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",n),e.addEventListener("change",n),e.removeEventListener("change",i)})}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const n=e.toLowerCase();this[`${n}TracksListeners_`]&&Object.keys(this[`${n}TracksListeners_`]).forEach(e=>{const t=this.el()[`${n}Tracks`];t.removeEventListener(e,this[`${n}TracksListeners_`][e])}),this[`featuresNative${e}Tracks`]=!t,this[`${n}TracksListeners_`]=null,this.proxyNativeTracksForType_(n)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=Fn[e],n=this.el()[t.getterName],i=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!n||!n.addEventListener)return;const r={change:t=>{const n={type:"change",target:i,currentTarget:i,srcElement:i};i.trigger(n),"text"===e&&this[Bn.remoteText.getterName]().trigger(n)},addtrack(e){i.addTrack(e.track)},removetrack(e){i.removeTrack(e.track)}},s=function(){const e=[];for(let t=0;t<i.length;t++){let r=!1;for(let e=0;e<n.length;e++)if(n[e]===i[t]){r=!0;break}r||e.push(i[t])}while(e.length)i.removeTrack(e.shift())};this[t.getterName+"Listeners_"]=r,Object.keys(r).forEach(e=>{const t=r[e];n.addEventListener(e,t),this.on("dispose",i=>n.removeEventListener(e,t))}),this.on("loadstart",s),this.on("dispose",e=>this.off("loadstart",s))}proxyNativeTracks_(){Fn.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){const t=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(t,e),hs.disposeMediaElement(e),e=t}else{e=a.a.createElement("video");const t=this.options_.tag&&Le(this.options_.tag),n=z({},t);pe&&!0===this.options_.nativeControlsForTouch||delete n.controls,Me(e,Object.assign(n,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}"undefined"!==typeof this.options_.preload&&Oe(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let n=0;n<t.length;n++){const i=t[n],r=this.options_[i];"undefined"!==typeof r&&(r?Oe(e,i,i):Ne(e,i),e[i]=r)}return e}handleLateInit_(e){if(0===e.networkState||3===e.networkState)return;if(0===e.readyState){let e=!1;const t=function(){e=!0};this.on("loadstart",t);const n=function(){e||this.trigger("loadstart")};return this.on("loadedmetadata",n),void this.ready(function(){this.off("loadstart",t),this.off("loadedmetadata",n),e||this.trigger("loadstart")})}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready(function(){t.forEach(function(e){this.trigger(e)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&ve?this.el_.fastSeek(e):this.el_.currentTime=e}catch(e){U(e,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&Z&&ne&&0===this.el_.currentTime){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return"function"===typeof this.el_.webkitEnterFullScreen}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)on(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(e){this.trigger("fullscreenerror",e)}},0);else try{e.webkitEnterFullScreen()}catch(e){this.trigger("fullscreenerror",e)}}exitFullScreen(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(void 0===e)return this.el_.src;this.setSrc(e)}addSourceElement(e,t){if(!e)return U.error("Invalid source URL."),!1;const n={src:e};t&&(n.type=t);const i=xe("source",{},n);return this.el_.appendChild(i),!0}removeSourceElement(e){if(!e)return U.error("Source URL is required to remove the source element."),!1;const t=this.el_.querySelectorAll("source");for(const n of t)if(n.src===e)return this.el_.removeChild(n),!0;return U.warn(`No matching source element found with src: ${e}`),!1}reset(){hs.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):super.addTextTrack(e,t,n)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=a.a.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const n=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(n),n}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let n=t.length;while(n--)e!==t[n]&&e!==t[n].track||this.el().removeChild(t[n])}}getVideoPlaybackQuality(){if("function"===typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();const e={};return"undefined"!==typeof this.el().webkitDroppedFrameCount&&"undefined"!==typeof this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),r.a.performance&&(e.creationTime=r.a.performance.now()),e}}W(hs,"TEST_VID",function(){if(!Te())return;const e=a.a.createElement("video"),t=a.a.createElement("track");return t.kind="captions",t.srclang="en",t.label="English",e.appendChild(t),e}),hs.isSupported=function(){try{hs.TEST_VID.volume=.5}catch(e){return!1}return!(!hs.TEST_VID||!hs.TEST_VID.canPlayType)},hs.canPlayType=function(e){return hs.TEST_VID.canPlayType(e)},hs.canPlaySource=function(e,t){return hs.canPlayType(e.type)},hs.canControlVolume=function(){try{const e=hs.TEST_VID.volume;hs.TEST_VID.volume=e/2+.1;const t=e!==hs.TEST_VID.volume;return t&&me?(r.a.setTimeout(()=>{hs&&hs.prototype&&(hs.prototype.featuresVolumeControl=e!==hs.TEST_VID.volume)}),!1):t}catch(e){return!1}},hs.canMuteVolume=function(){try{const e=hs.TEST_VID.muted;return hs.TEST_VID.muted=!e,hs.TEST_VID.muted?Oe(hs.TEST_VID,"muted","muted"):Ne(hs.TEST_VID,"muted","muted"),e!==hs.TEST_VID.muted}catch(e){return!1}},hs.canControlPlaybackRate=function(){if(Z&&ne&&re<58)return!1;try{const e=hs.TEST_VID.playbackRate;return hs.TEST_VID.playbackRate=e/2+.1,e!==hs.TEST_VID.playbackRate}catch(e){return!1}},hs.canOverrideAttributes=function(){try{const e=()=>{};Object.defineProperty(a.a.createElement("video"),"src",{get:e,set:e}),Object.defineProperty(a.a.createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(a.a.createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(a.a.createElement("audio"),"innerHTML",{get:e,set:e})}catch(e){return!1}return!0},hs.supportsNativeTextTracks=function(){return ve||me&&ne},hs.supportsNativeVideoTracks=function(){return!(!hs.TEST_VID||!hs.TEST_VID.videoTracks)},hs.supportsNativeAudioTracks=function(){return!(!hs.TEST_VID||!hs.TEST_VID.audioTracks)},hs.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function([e,t]){W(hs.prototype,e,()=>hs[t](),!0)}),hs.prototype.featuresVolumeControl=hs.canControlVolume(),hs.prototype.movingMediaElementInDOM=!me,hs.prototype.featuresFullscreenResize=!0,hs.prototype.featuresProgressEvents=!0,hs.prototype.featuresTimeupdateEvents=!0,hs.prototype.featuresVideoFrameCallback=!(!hs.TEST_VID||!hs.TEST_VID.requestVideoFrameCallback),hs.disposeMediaElement=function(e){if(e){e.parentNode&&e.parentNode.removeChild(e);while(e.hasChildNodes())e.removeChild(e.firstChild);e.removeAttribute("src"),"function"===typeof e.load&&function(){try{e.load()}catch(e){}}()}},hs.resetMediaElement=function(e){if(!e)return;const t=e.querySelectorAll("source");let n=t.length;while(n--)e.removeChild(t[n]);e.removeAttribute("src"),"function"===typeof e.load&&function(){try{e.load()}catch(e){}}()},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(e){hs.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(e){hs.prototype["set"+$t(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(e){hs.prototype[e]=function(){return this.el_[e]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(e){hs.prototype["set"+$t(e)]=function(t){this.el_[e]=t}}),["pause","load","play"].forEach(function(e){hs.prototype[e]=function(){return this.el_[e]()}}),Hn.withSourceHandlers(hs),hs.nativeSourceHandler={},hs.nativeSourceHandler.canPlayType=function(e){try{return hs.TEST_VID.canPlayType(e)}catch(e){return""}},hs.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return hs.nativeSourceHandler.canPlayType(e.type);if(e.src){const t=Cn(e.src);return hs.nativeSourceHandler.canPlayType(`video/${t}`)}return""},hs.nativeSourceHandler.handleSource=function(e,t,n){t.setSrc(e.src)},hs.nativeSourceHandler.dispose=function(){},hs.registerSourceHandler(hs.nativeSourceHandler),Hn.registerTech("Html5",hs);const fs=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],ps={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},gs=["tiny","xsmall","small","medium","large","xlarge","huge"],ms={};gs.forEach(e=>{const t="x"===e.charAt(0)?`x-${e.substring(1)}`:e;ms[e]=`vjs-layout-${t}`});const vs={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class ys extends qt{constructor(e,t,n){if(e.id=e.id||t.id||`vjs_video_${ct()}`,t=Object.assign(ys.getTagSettings(e),t),t.initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const n=e.closest("[lang]");n&&(t.language=n.getAttribute("lang"))}if(super(null,t,n),this.boundDocumentFullscreenChange_=(e=>this.documentFullscreenChange_(e)),this.boundFullWindowOnEscKey_=(e=>this.fullWindowOnEscKey(e)),this.boundUpdateStyleEl_=(e=>this.updateStyleEl_(e)),this.boundApplyInitTime_=(e=>this.applyInitTime_(e)),this.boundUpdateCurrentBreakpoint_=(e=>this.updateCurrentBreakpoint_(e)),this.boundHandleTechClick_=(e=>this.handleTechClick_(e)),this.boundHandleTechDoubleClick_=(e=>this.handleTechDoubleClick_(e)),this.boundHandleTechTouchStart_=(e=>this.handleTechTouchStart_(e)),this.boundHandleTechTouchMove_=(e=>this.handleTechTouchMove_(e)),this.boundHandleTechTouchEnd_=(e=>this.handleTechTouchEnd_(e)),this.boundHandleTechTap_=(e=>this.handleTechTap_(e)),this.boundUpdatePlayerHeightOnAudioOnlyMode_=(e=>this.updatePlayerHeightOnAudioOnlyMode_(e)),this.isFullscreen_=!1,this.log=F(this.id_),this.fsApi_=D,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={controlBarHeight:null,playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&Le(e),this.language(this.options_.language),t.languages){const e={};Object.getOwnPropertyNames(t.languages).forEach(function(n){e[n.toLowerCase()]=t.languages[n]}),this.languages_=e}else this.languages_=ys.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(e=>{if("function"!==typeof this[e])throw new Error(`plugin "${e}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),Bt(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(mt(a.a,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const i=z(this.options_);if(t.plugins&&Object.keys(t.plugins).forEach(e=>{this[e](t.plugins[e])}),t.debug&&this.debug(!0),this.options_.playerOptions=i,this.middleware_=[],this.playbackRates(t.playbackRates),t.experimentalSvgIcons){const e=new r.a.DOMParser,t=e.parseFromString(di,"image/svg+xml"),n=t.querySelector("parsererror");if(n)U.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const e=t.documentElement;e.style.display="none",this.el_.appendChild(e),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio("audio"===e.nodeName.toLowerCase()),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),t.spatialNavigation&&t.spatialNavigation.enabled&&(this.spatialNavigation=new gi(this),this.addClass("vjs-spatial-navigation-enabled")),pe&&this.addClass("vjs-touch-enabled"),me||this.addClass("vjs-workinghover"),ys.players[this.id_]=this;const s=E.split(".")[0];this.addClass(`vjs-v${s}`),this.userActive(!0),this.reportUserActivity(),this.one("play",e=>this.listenForUserActivity_(e)),this.on("keydown",e=>this.handleKeyDown(e)),this.on("languagechange",e=>this.handleLanguagechange(e)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){this.trigger("dispose"),this.off("dispose"),vt(a.a,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),vt(a.a,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),ys.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),ii(this),jn.names.forEach(e=>{const t=jn[e],n=this[t.getterName]();n&&n.off&&n.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e,t=this.tag,n=this.playerElIngest_=t.parentNode&&t.parentNode.hasAttribute&&t.parentNode.hasAttribute("data-vjs-player");const i="video-js"===this.tag.tagName.toLowerCase();n?e=this.el_=t.parentNode:i||(e=this.el_=super.createEl("div"));const s=Le(t);if(i){e=this.el_=t,t=this.tag=a.a.createElement("video");while(e.children.length)t.appendChild(e.firstChild);Ie(e,"video-js")||Ce(e,"video-js"),e.appendChild(t),n=this.playerElIngest_=e,Object.keys(e).forEach(n=>{try{t[n]=e[n]}catch(e){}})}t.setAttribute("tabindex","-1"),s.tabindex="-1",ne&&le&&(t.setAttribute("role","application"),s.role="application"),t.removeAttribute("width"),t.removeAttribute("height"),"width"in s&&delete s.width,"height"in s&&delete s.height,Object.getOwnPropertyNames(s).forEach(function(n){i&&"class"===n||e.setAttribute(n,s[n]),i&&t.setAttribute(n,s[n])}),t.playerId=t.id,t.id+="_html5_api",t.className="vjs-tech",t.player=e.player=this,this.addClass("vjs-paused");const o=["IS_SMART_TV","IS_TIZEN","IS_WEBOS","IS_ANDROID","IS_IPAD","IS_IPHONE","IS_CHROMECAST_RECEIVER"].filter(e=>ye[e]).map(e=>{return"vjs-device-"+e.substring(3).toLowerCase().replace(/\_/g,"-")});if(this.addClass(...o),!0!==r.a.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=rt("vjs-styles-dimensions");const e=Ke(".vjs-styles-defaults"),t=Ke("head");t.insertBefore(this.styleEl_,e?e.nextSibling:t.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const l=t.getElementsByTagName("a");for(let r=0;r<l.length;r++){const e=l.item(r);Ce(e,"vjs-hidden"),e.setAttribute("hidden","hidden")}return t.initNetworkState_=t.networkState,t.parentNode&&!n&&t.parentNode.insertBefore(e,t),Ae(t,e),this.children_.unshift(t),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=e,e}crossOrigin(e){if("undefined"===typeof e)return this.techGet_("crossOrigin");null===e||"anonymous"===e||"use-credentials"===e?(this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)):U.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const n=e+"_";if(void 0===t)return this[n]||0;if(""===t||"auto"===t)return this[n]=void 0,void this.updateStyleEl_();const i=parseFloat(t);isNaN(i)?U.error(`Improper value "${t}" supplied for for ${e}`):(this[n]=i,this.updateStyleEl_())}fluid(e){if(void 0===e)return!!this.fluid_;this.fluid_=!!e,Dt(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),Rt(this,()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(!0===r.a.VIDEOJS_NO_DYNAMIC_STYLE){const e="number"===typeof this.width_?this.width_:this.options_.width,t="number"===typeof this.height_?this.height_:this.options_.height,n=this.tech_&&this.tech_.el();return void(n&&(e>=0&&(n.width=e),t>=0&&(n.height=t)))}let e,t,n,i;n=void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9";const s=n.split(":"),a=s[1]/s[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/a:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*a,i=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(i),st(this.styleEl_,`\n      .${i} {\n        width: ${e}px;\n        height: ${t}px;\n      }\n\n      .${i}.vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: ${100*a}%;\n      }\n    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const n=$t(e),i=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==n&&this.tag&&(Hn.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;let r=this.autoplay();("string"===typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(r=!1);const s={source:t,autoplay:r,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${i}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};jn.names.forEach(e=>{const t=jn[e];s[t.getterName]=this[t.privateName]}),Object.assign(s,this.options_[n]),Object.assign(s,this.options_[i]),Object.assign(s,this.options_[e.toLowerCase()]),this.tag&&(s.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(s.startTime=this.cache_.currentTime);const a=Hn.getTech(e);if(!a)throw new Error(`No Tech named '${n}' exists! '${n}' should be registered using videojs.registerTech()'`);this.tech_=new a(s),this.tech_.ready(wt(this,this.handleTechReady_),!0),dn.jsonToTextTracks(this.textTracksJson_||[],this.tech_),fs.forEach(e=>{this.on(this.tech_,e,t=>this[`handleTech${$t(e)}_`](t))}),Object.keys(ps).forEach(e=>{this.on(this.tech_,e,t=>{0===this.tech_.playbackRate()&&this.tech_.seeking()?this.queuedCallbacks_.push({callback:this[`handleTech${ps[e]}_`].bind(this),event:t}):this[`handleTech${ps[e]}_`](t)})}),this.on(this.tech_,"loadstart",e=>this.handleTechLoadStart_(e)),this.on(this.tech_,"sourceset",e=>this.handleTechSourceset_(e)),this.on(this.tech_,"waiting",e=>this.handleTechWaiting_(e)),this.on(this.tech_,"ended",e=>this.handleTechEnded_(e)),this.on(this.tech_,"seeking",e=>this.handleTechSeeking_(e)),this.on(this.tech_,"play",e=>this.handleTechPlay_(e)),this.on(this.tech_,"pause",e=>this.handleTechPause_(e)),this.on(this.tech_,"durationchange",e=>this.handleTechDurationChange_(e)),this.on(this.tech_,"fullscreenchange",(e,t)=>this.handleTechFullscreenChange_(e,t)),this.on(this.tech_,"fullscreenerror",(e,t)=>this.handleTechFullscreenError_(e,t)),this.on(this.tech_,"enterpictureinpicture",e=>this.handleTechEnterPictureInPicture_(e)),this.on(this.tech_,"leavepictureinpicture",e=>this.handleTechLeavePictureInPicture_(e)),this.on(this.tech_,"error",e=>this.handleTechError_(e)),this.on(this.tech_,"posterchange",e=>this.handleTechPosterChange_(e)),this.on(this.tech_,"textdata",e=>this.handleTechTextData_(e)),this.on(this.tech_,"ratechange",e=>this.handleTechRateChange_(e)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===n&&this.tag||Ae(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){jn.names.forEach(e=>{const t=jn[e];this[t.privateName]=this[t.getterName]()}),this.textTracksJson_=dn.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return void 0===e&&U.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_}version(){return{"video.js":E}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||"string"!==typeof e)return;const t=()=>{const e=this.muted();this.muted(!0);const t=()=>{this.muted(e)};this.playTerminatedQueue_.push(t);const n=this.play();if(an(n))return n.catch(e=>{throw t(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${e||""}`)})};let n;return"any"!==e||this.muted()?n="muted"!==e||this.muted()?this.play():t():(n=this.play(),an(n)&&(n=n.catch(t))),an(n)?n.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})}):void 0}updateSourceCaches_(e=""){let t=e,n="";"string"!==typeof t&&(t=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!n&&(n=li(this,t)),this.cache_.source=z({},e,{src:t,type:n});const i=this.cache_.sources.filter(e=>e.src&&e.src===t),r=[],s=this.$$("source"),a=[];for(let o=0;o<s.length;o++){const e=Le(s[o]);r.push(e),e.src&&e.src===t&&a.push(e.src)}a.length&&!i.length?this.cache_.sources=r:i.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=e=>this.updateSourceCaches_(e);const n=this.currentSource().src,i=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(i)&&(!this.lastSource_||this.lastSource_.tech!==i&&this.lastSource_.player!==n)&&(t=(()=>{})),t(i),e.src||this.tech_.any(["sourceset","loadstart"],e=>{if("sourceset"===e.type)return;const t=this.techGet_("currentSrc");this.lastSource_.tech=t,this.updateSourceCaches_(t)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.click&&!1===this.options_.userActions.click||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"===typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?on(this.play()):this.pause()))}handleTechDoubleClick_(e){if(!this.controls_)return;const t=Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),t=>t.contains(e.target));t||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"===typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isInPictureInPicture()&&!a.a.pictureInPictureElement?this.exitPictureInPicture():this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const n=this.el();let i=a.a[this.fsApi_.fullscreenElement]===n;!i&&n.matches&&(i=n.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(i)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready(function(){if(e in Jn)return Xn(this.middleware_,this.tech_,e,t);if(e in ei)return Qn(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(e){throw U(e),e}},!0)}techGet_(e){if(this.tech_&&this.tech_.isReady_){if(e in Zn)return Yn(this.middleware_,this.tech_,e);if(e in ei)return Qn(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){if(void 0===this.tech_[e])throw U(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,t),t;if("TypeError"===t.name)throw U(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,t),this.tech_.isReady_=!1,t;throw U(t),t}}}play(){return new Promise(e=>{this.play_(e)})}play_(e=on){this.playCallbacks_.push(e);const t=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc())),n=Boolean(ve||me);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t)return this.waitToPlay_=(e=>{this.play_()}),this.one(["ready","loadstart"],this.waitToPlay_),void(!t&&n&&this.load());const i=this.techGet_("play"),r=n&&this.hasClass("vjs-ended");r&&this.resetProgressBar_(),null===i?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(i)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(e){e()})}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(t){t(e)})}pause(){this.techCall_("pause")}paused(){return!1!==this.techGet_("paused")}played(){return this.techGet_("played")||Xt(0,0)}scrubbing(e){if("undefined"===typeof e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){return void 0===e?(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime):(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),this.cache_.initTime=0,void(isFinite(e)&&(this.cache_.currentTime=Number(e)))):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_)))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;e=parseFloat(e),e<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return e&&e.length||(e=Xt(0,0)),e}seekable(){let e=this.techGet_("seekable");return e&&e.length||(e=Xt(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return rn(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let n=e.end(e.length-1);return n>t&&(n=t),n}volume(e){let t;return void 0!==e?(t=Math.max(0,Math.min(1,e)),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)}muted(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)}defaultMuted(e){return void 0!==e&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(void 0!==e){const t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise((n,i)=>{function r(){t.off("fullscreenerror",a),t.off("fullscreenchange",s)}function s(){r(),n()}function a(e,t){r(),i(t)}t.one("fullscreenchange",s),t.one("fullscreenerror",a);const o=t.requestFullscreenHelper_(e);o&&(o.then(r,r),o.then(n,i))})}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),this.fsApi_.requestFullscreen){const e=this.el_[this.fsApi_.requestFullscreen](t);return e&&e.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),e}this.tech_.supportsFullScreen()&&!0===!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((t,n)=>{function i(){e.off("fullscreenerror",s),e.off("fullscreenchange",r)}function r(){i(),t()}function s(e,t){i(),n(t)}e.one("fullscreenchange",r),e.one("fullscreenerror",s);const a=e.exitFullscreenHelper_();a&&(a.then(i,i),a.then(t,n))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=a.a[this.fsApi_.exitFullscreen]();return e&&on(e.then(()=>this.isFullscreen(!1))),e}this.tech_.supportsFullScreen()&&!0===!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=a.a.documentElement.style.overflow,mt(a.a,"keydown",this.boundFullWindowOnEscKey_),a.a.documentElement.style.overflow="hidden",Ce(a.a.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){"Escape"===e.key&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,vt(a.a,"keydown",this.boundFullWindowOnEscKey_),a.a.documentElement.style.overflow=this.docOrigOverflow,De(a.a.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&r.a.documentPictureInPicture){const e=a.a.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(xe("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),r.a.documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then(t=>{return Qe(t),this.el_.parentNode.insertBefore(e,this.el_),t.document.body.appendChild(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger({type:"enterpictureinpicture",pipWindow:t}),t.addEventListener("pagehide",t=>{const n=t.target.querySelector(".video-js");e.parentNode.replaceChild(n,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),t})}return"pictureInPictureEnabled"in a.a&&!1===this.disablePictureInPicture()?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){return r.a.documentPictureInPicture&&r.a.documentPictureInPicture.window?(r.a.documentPictureInPicture.window.close(),Promise.resolve()):"pictureInPictureEnabled"in a.a?a.a.exitPictureInPicture():void 0}handleKeyDown(e){const{userActions:t}=this.options_;if(!t||!t.hotkeys)return;const n=e=>{const t=e.tagName.toLowerCase();if(e.isContentEditable)return!0;const n=["button","checkbox","hidden","radio","reset","submit"];if("input"===t)return-1===n.indexOf(e.type);const i=["textarea"];return-1!==i.indexOf(t)};n(this.el_.ownerDocument.activeElement)||("function"===typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:n=(t=>"f"===e.key.toLowerCase()),muteKey:i=(t=>"m"===e.key.toLowerCase()),playPauseKey:r=(t=>"k"===e.key.toLowerCase()||" "===e.key.toLowerCase())}=t;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();const t=qt.getComponent("FullscreenToggle");!1!==a.a[this.fsApi_.fullscreenEnabled]&&t.prototype.handleClick.call(this,e)}else if(i.call(this,e)){e.preventDefault(),e.stopPropagation();const t=qt.getComponent("MuteToggle");t.prototype.handleClick.call(this,e)}else if(r.call(this,e)){e.preventDefault(),e.stopPropagation();const t=qt.getComponent("PlayToggle");t.prototype.handleClick.call(this,e)}}canPlayType(e){let t;for(let n=0,i=this.options_.techOrder;n<i.length;n++){const r=i[n];let s=Hn.getTech(r);if(s||(s=qt.getComponent(r)),s){if(s.isSupported()&&(t=s.canPlayType(e),t))return t}else U.error(`The "${r}" tech is undefined. Skipped browser support check for that tech.`)}return""}selectSource(e){const t=this.options_.techOrder.map(e=>{return[e,Hn.getTech(e)]}).filter(([e,t])=>{return t?t.isSupported():(U.error(`The "${e}" tech is undefined. Skipped browser support check for that tech.`),!1)}),n=function(e,t,n){let i;return e.some(e=>{return t.some(t=>{if(i=n(e,t),i)return!0})}),i};let i;const r=e=>(t,n)=>e(n,t),s=([e,t],n)=>{if(t.canPlaySource(n,this.options_[e.toLowerCase()]))return{source:n,tech:e}};return i=this.options_.sourceOrder?n(e,t,r(s)):n(t,e,s),i||!1}handleSrc_(e,t){if("undefined"===typeof e)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const n=ui(e);if(n.length){if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),Wn(this,n[0],(e,i)=>{this.middleware_=i,t||(this.cache_.sources=n),this.updateSourceCaches_(e);const r=this.src_(e);if(r)return n.length>1?this.handleSrc_(n.slice(1)):(this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),void this.triggerReady());Kn(i,this.tech_)}),n.length>1){const e=()=>{this.error(null),this.handleSrc_(n.slice(1),!0)},t=()=>{this.off("error",e)};this.one("error",e),this.one("playing",t),this.resetRetryOnError_=(()=>{this.off("error",e),this.off("playing",t)})}}else this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0)}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return!t||(Gt(t.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1))}addSourceElement(e,t){return!!this.tech_&&this.tech_.addSourceElement(e,t)}removeSourceElement(e){return!!this.tech_&&this.tech_.removeSourceElement(e)}load(){this.tech_&&this.tech_.vhs?this.src(this.currentSource()):this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{const e=this.play();on(e.then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),Dt(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:n,remainingTimeDisplay:i}=this.controlBar||{},{seekBar:r}=n||{};e&&e.updateContent(),t&&t.updateContent(),i&&i.updateContent(),r&&(r.update(),r.loadProgressBar&&r.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")}autoplay(e){if(void 0===e)return this.options_.autoplay||!1;let t;"string"===typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"===typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t="undefined"===typeof t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return void 0!==e&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")}poster(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(void 0===e)return this.error_||null;if(k("beforeerror").forEach(t=>{const n=t(this,e);$(n)&&!Array.isArray(n)||"string"===typeof n||"number"===typeof n||null===n?e=n:this.log.error("please return a value that MediaError expects in beforeerror hooks")}),this.options_.suppressNotSupportedError&&e&&4===e.code){const t=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),void this.one("loadstart",function(){this.off(["click","touchstart"],t)})}if(null===e)return this.error_=null,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new sn(e),this.addClass("vjs-error"),U.error(`(CODE:${this.error_.code} ${sn.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),k("error").forEach(e=>e(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(void 0===e)return this.userActive_;if(e=!!e,e!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(e){e.stopPropagation(),e.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,n;const i=wt(this,this.reportUserActivity),r=function(e){e.screenX===t&&e.screenY===n||(t=e.screenX,n=e.screenY,i())},s=function(){i(),this.clearInterval(e),e=this.setInterval(i,250)},a=function(t){i(),this.clearInterval(e)};this.on("mousedown",s),this.on("mousemove",r),this.on("mouseup",a),this.on("mouseleave",a);const o=this.getChild("controlBar");let l;!o||me||Z||(o.on("mouseenter",function(e){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),o.on("mouseleave",function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",i),this.on("keyup",i);const u=function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(l);const e=this.options_.inactivityTimeout;e<=0||(l=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},e))};this.setInterval(u,250)}playbackRate(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)}defaultPlaybackRate(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e}updatePlayerHeightOnAudioOnlyMode_(){const e=this.getChild("ControlBar");e&&this.audioOnlyCache_.controlBarHeight!==e.currentHeight()&&(this.audioOnlyCache_.controlBarHeight=e.currentHeight(),this.height(this.audioOnlyCache_.controlBarHeight))}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),n=t&&t.currentHeight();e.forEach(e=>{e!==t&&e.el_&&!e.hasClass("vjs-hidden")&&(e.hide(),this.audioOnlyCache_.hiddenChildren.push(e))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.audioOnlyCache_.controlBarHeight=n,this.on("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.height(n),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.off("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if("boolean"!==typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const e=[];return this.isInPictureInPicture()&&e.push(this.exitPictureInPicture()),this.isFullscreen()&&e.push(this.exitFullscreen()),this.audioPosterMode()&&e.push(this.audioPosterMode(!1)),Promise.all(e).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){const e=this.tech_&&this.tech_;e.hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){const e=this.tech_&&this.tech_;e.show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){if("boolean"!==typeof e||e===this.audioPosterMode_)return this.audioPosterMode_;if(this.audioPosterMode_=e,e){if(this.audioOnlyMode()){const e=this.audioOnlyMode(!1);return e.then(()=>{this.enablePosterModeUI_()})}return Promise.resolve().then(()=>{this.enablePosterModeUI_()})}return Promise.resolve().then(()=>{this.disablePosterModeUI_()})}addTextTrack(e,t,n){if(this.tech_)return this.tech_.addTextTrack(e,t,n)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),Dt(this)&&this.trigger("languagechange"))}languages(){return z(ys.prototype.options_.languages,this.languages_)}toJSON(){const e=z(this.options_),t=e.tracks;e.tracks=[];for(let n=0;n<t.length;n++){let i=t[n];i=z(i),i.player=void 0,e.tracks[n]=i}return e}createModal(e,t){t=t||{},t.content=e||"";const n=new fn(this,t);return this.addChild(n),n.on("dispose",()=>{this.removeChild(n)}),n.open(),n}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let n=0;n<gs.length;n++){const i=gs[n],r=this.breakpoints_[i];if(t<=r){if(e===i)return;e&&this.removeClass(ms[e]),this.addClass(ms[i]),this.breakpoint_=i;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return void 0===e?Object.assign(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Object.assign({},vs,e),this.updateCurrentBreakpoint_(),Object.assign(this.breakpoints_))}responsive(e){if(void 0===e)return this.responsive_;e=Boolean(e);const t=this.responsive_;return e!==t?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return ms[this.breakpoint_]||""}loadMedia(e,t){if(!e||"object"!==typeof e)return;const n=this.crossOrigin();this.reset(),this.cache_.media=z(e);const{artist:i,artwork:r,description:s,poster:a,src:o,textTracks:l,title:u}=this.cache_.media;!r&&a&&(this.cache_.media.artwork=[{src:a,type:oi(a)}]),n&&this.crossOrigin(n),o&&this.src(o),a&&this.poster(a),Array.isArray(l)&&l.forEach(e=>this.addRemoteTextTrack(e,!1)),this.titleBar&&this.titleBar.update({title:u,description:s||i||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t=this.currentSources(),n=Array.prototype.map.call(this.remoteTextTracks(),e=>({kind:e.kind,label:e.label,language:e.language,src:e.src})),i={src:t,textTracks:n};return e&&(i.poster=e,i.artwork=[{src:i.poster,type:oi(i.poster)}]),i}return z(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},n=Le(e),i=n["data-setup"];if(Ie(e,"vjs-fill")&&(n.fill=!0),Ie(e,"vjs-fluid")&&(n.fluid=!0),null!==i)try{Object.assign(n,JSON.parse(i||"{}"))}catch(e){U.error("data-setup",e)}if(Object.assign(t,n),e.hasChildNodes()){const n=e.childNodes;for(let e=0,i=n.length;e<i;e++){const i=n[e],r=i.nodeName.toLowerCase();"source"===r?t.sources.push(Le(i)):"track"===r&&t.tracks.push(Le(i))}}return t}debug(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(void 0===e)return this.cache_.playbackRates;Array.isArray(e)&&e.every(e=>"number"===typeof e)&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}jn.names.forEach(function(e){const t=jn[e];ys.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}}),ys.prototype.crossorigin=ys.prototype.crossOrigin,ys.players={};const bs=r.a.navigator;ys.prototype.options_={techOrder:Hn.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:bs&&(bs.languages&&bs.languages[0]||bs.userLanguage||bs.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,spatialNavigation:{enabled:!1,horizontalSeek:!1},enableSmoothSeeking:!1,disableSeekWhileScrubbingOnMobile:!1},fs.forEach(function(e){ys.prototype[`handleTech${$t(e)}_`]=function(){return this.trigger(e)}}),qt.registerComponent("Player",ys);const _s="plugin",Ts="activePlugins_",Ss={},ws=e=>Ss.hasOwnProperty(e),Es=e=>ws(e)?Ss[e]:void 0,xs=(e,t)=>{e[Ts]=e[Ts]||{},e[Ts][t]=!0},ks=(e,t,n)=>{const i=(n?"before":"")+"pluginsetup";e.trigger(i,t),e.trigger(i+":"+t.name,t)},As=function(e,t){const n=function(){ks(this,{name:e,plugin:t,instance:null},!0);const n=t.apply(this,arguments);return xs(this,e),ks(this,{name:e,plugin:t,instance:n}),n};return Object.keys(t).forEach(function(e){n[e]=t[e]}),n},Is=(e,t)=>{return t.prototype.name=e,function(...n){ks(this,{name:e,plugin:t,instance:null},!0);const i=new t(...[this,...n]);return this[e]=(()=>i),ks(this,i.getEventHash()),i}};class Cs{constructor(e){if(this.constructor===Cs)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),Bt(this),delete this.trigger,Vt(this,this.constructor.defaultState),xs(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return yt(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[Ts][e]=!1,this.player=this.state=null,t[e]=Is(e,Ss[e])}static isBasic(e){const t="string"===typeof e?Es(e):e;return"function"===typeof t&&!Cs.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if("string"!==typeof e)throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(ws(e))U.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(ys.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if("function"!==typeof t)throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return Ss[e]=t,e!==_s&&(Cs.isBasic(t)?ys.prototype[e]=As(e,t):ys.prototype[e]=Is(e,t)),t}static deregisterPlugin(e){if(e===_s)throw new Error("Cannot de-register base plugin.");ws(e)&&(delete Ss[e],delete ys.prototype[e])}static getPlugins(e=Object.keys(Ss)){let t;return e.forEach(e=>{const n=Es(e);n&&(t=t||{},t[e]=n)}),t}static getPluginVersion(e){const t=Es(e);return t&&t.VERSION||""}}function Ds(e,t){let n=!1;return function(...i){return n||U.warn(e),n=!0,t.apply(this,i)}}function Rs(e,t,n,i){return Ds(`${t} is deprecated and will be removed in ${e}.0; please use ${n} instead.`,i)}Cs.getPlugin=Es,Cs.BASE_PLUGIN_NAME=_s,Cs.registerPlugin(_s,Cs),ys.prototype.usingPlugin=function(e){return!!this[Ts]&&!0===this[Ts][e]},ys.prototype.hasPlugin=function(e){return!!ws(e)};var Ms={NetworkBadStatus:"networkbadstatus",NetworkRequestFailed:"networkrequestfailed",NetworkRequestAborted:"networkrequestaborted",NetworkRequestTimeout:"networkrequesttimeout",NetworkBodyParserFailed:"networkbodyparserfailed",StreamingHlsPlaylistParserError:"streaminghlsplaylistparsererror",StreamingDashManifestParserError:"streamingdashmanifestparsererror",StreamingContentSteeringParserError:"streamingcontentsteeringparsererror",StreamingVttParserError:"streamingvttparsererror",StreamingFailedToSelectNextSegment:"streamingfailedtoselectnextsegment",StreamingFailedToDecryptSegment:"streamingfailedtodecryptsegment",StreamingFailedToTransmuxSegment:"streamingfailedtotransmuxsegment",StreamingFailedToAppendSegment:"streamingfailedtoappendsegment",StreamingCodecsChangeError:"streamingcodecschangeerror"};const Ls=e=>0===e.indexOf("#")?e.slice(1):e;function Ps(e,t,n){let i=Ps.getPlayer(e);if(i)return t&&U.warn(`Player "${e}" is already initialised. Options will not be applied.`),n&&i.ready(n),i;const s="string"===typeof e?Ke("#"+Ls(e)):e;if(!Se(s))throw new TypeError("The element or ID supplied is not valid. (videojs)");const a="getRootNode"in s&&s.getRootNode()instanceof r.a.ShadowRoot,o=a?s.getRootNode():s.ownerDocument.body;s.ownerDocument.defaultView&&o.contains(s)||U.warn("The element supplied is not included in the DOM"),t=t||{},!0===t.restoreEl&&(t.restoreEl=(s.parentNode&&s.parentNode.hasAttribute&&s.parentNode.hasAttribute("data-vjs-player")?s.parentNode:s).cloneNode(!0)),k("beforesetup").forEach(e=>{const n=e(s,z(t));$(n)&&!Array.isArray(n)?t=z(t,n):U.error("please return an object in beforesetup hooks")});const l=qt.getComponent("Player");return i=new l(s,t,n),k("setup").forEach(e=>e(i)),i}if(Ps.hooks_=x,Ps.hooks=k,Ps.hook=A,Ps.hookOnce=C,Ps.removeHook=I,!0!==r.a.VIDEOJS_NO_DYNAMIC_STYLE&&Te()){let e=Ke(".vjs-styles-defaults");if(!e){e=rt("vjs-styles-defaults");const t=Ke("head");t&&t.insertBefore(e,t.firstChild),st(e,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    ")}}nt(1,Ps),Ps.VERSION=E,Ps.options=ys.prototype.options_,Ps.getPlayers=(()=>ys.players),Ps.getPlayer=(e=>{const t=ys.players;let n;if("string"===typeof e){const i=Ls(e),r=t[i];if(r)return r;n=Ke("#"+i)}else n=e;if(Se(n)){const{player:e,playerId:i}=n;if(e||t[i])return e||t[i]}}),Ps.getAllPlayers=(()=>Object.keys(ys.players).map(e=>ys.players[e]).filter(Boolean)),Ps.players=ys.players,Ps.getComponent=qt.getComponent,Ps.registerComponent=((e,t)=>{return Hn.isTech(t)&&U.warn(`The ${e} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),qt.registerComponent.call(qt,e,t)}),Ps.getTech=Hn.getTech,Ps.registerTech=Hn.registerTech,Ps.use=qn,Object.defineProperty(Ps,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(Ps.middleware,"TERMINATOR",{value:zn,writeable:!1,enumerable:!0}),Ps.browser=ye,Ps.obj=K,Ps.mergeOptions=Rs(9,"videojs.mergeOptions","videojs.obj.merge",z),Ps.defineLazyProperty=Rs(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",W),Ps.bind=Rs(9,"videojs.bind","native Function.prototype.bind",wt),Ps.registerPlugin=Cs.registerPlugin,Ps.deregisterPlugin=Cs.deregisterPlugin,Ps.plugin=((e,t)=>{return U.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Cs.registerPlugin(e,t)}),Ps.getPlugins=Cs.getPlugins,Ps.getPlugin=Cs.getPlugin,Ps.getPluginVersion=Cs.getPluginVersion,Ps.addLanguage=function(e,t){return e=(""+e).toLowerCase(),Ps.options.languages=z(Ps.options.languages,{[e]:t}),Ps.options.languages[e]},Ps.log=U,Ps.createLogger=F,Ps.time=nn,Ps.createTimeRange=Rs(9,"videojs.createTimeRange","videojs.time.createTimeRanges",Xt),Ps.createTimeRanges=Rs(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",Xt),Ps.formatTime=Rs(9,"videojs.formatTime","videojs.time.formatTime",tn),Ps.setFormatTime=Rs(9,"videojs.setFormatTime","videojs.time.setFormatTime",Jt),Ps.resetFormatTime=Rs(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",en),Ps.parseUrl=Rs(9,"videojs.parseUrl","videojs.url.parseUrl",An),Ps.isCrossOrigin=Rs(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",Dn),Ps.EventTarget=It,Ps.any=_t,Ps.on=mt,Ps.one=bt,Ps.off=vt,Ps.trigger=yt,Ps.xhr=l.a,Ps.TextTrack=Pn,Ps.AudioTrack=On,Ps.VideoTrack=Nn,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(e=>{Ps[e]=function(){return U.warn(`videojs.${e}() is deprecated; use videojs.dom.${e}() instead`),Ze[e].apply(null,arguments)}}),Ps.computedStyle=Rs(9,"videojs.computedStyle","videojs.dom.computedStyle",Xe),Ps.dom=Ze,Ps.fn=kt,Ps.num=Bi,Ps.str=zt,Ps.url=Rn,Ps.Error=Ms;
/*! @name videojs-contrib-quality-levels @version 4.1.0 @license Apache-2.0 */
class Os{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get(){return t.enabled_()},set(e){t.enabled_(e)}}),t}}class Ns extends Ps.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get(){return e.selectedIndex_}}),Object.defineProperty(e,"length",{get(){return e.levels_.length}}),e[Symbol.iterator]=(()=>e.levels_.values()),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const n=this.levels_.length;return t=new Os(e),""+n in this||Object.defineProperty(this,n,{get(){return this.levels_[n]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let n=0,i=this.length;n<i;n++)if(this[n]===e){t=this.levels_.splice(n,1)[0],this.selectedIndex_===n?this.selectedIndex_=-1:this.selectedIndex_>n&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,n=this.length;t<n;t++){const n=this[t];if(n.id===e)return n}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}Ns.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const t in Ns.prototype.allowedEvents_)Ns.prototype["on"+t]=null;var Us="4.1.0";const Fs=function(e,t){const n=e.qualityLevels,i=new Ns,r=function(){i.dispose(),e.qualityLevels=n,e.off("dispose",r)};return e.on("dispose",r),e.qualityLevels=(()=>i),e.qualityLevels.VERSION=Us,i},Bs=function(e){return Fs(this,Ps.obj.merge({},e))};Ps.registerPlugin("qualityLevels",Bs),Bs.VERSION=Us;
/*! @name @videojs/http-streaming @version 3.17.0 @license Apache-2.0 */
const js=f["a"],Vs=(e,t)=>{return t&&t.responseURL&&e!==t.responseURL?t.responseURL:e},Hs=e=>{return Ps.log.debug?Ps.log.debug.bind(Ps,"VHS:",`${e} >`):function(){}};function $s(...e){const t=Ps.obj||Ps,n=t.merge||t.mergeOptions;return n.apply(t,e)}function Gs(...e){const t=Ps.time||Ps,n=t.createTimeRanges||t.createTimeRanges;return n.apply(t,e)}function zs(e){if(0===e.length)return"Buffered Ranges are empty";let t="Buffered Ranges: \n";for(let n=0;n<e.length;n++){const i=e.start(n),r=e.end(n);t+=`${i} --\x3e ${r}. Duration (${r-i})\n`}return t}const qs=1/30,Ws=3*qs,Ks=function(e,t){const n=[];let i;if(e&&e.length)for(i=0;i<e.length;i++)t(e.start(i),e.end(i))&&n.push([e.start(i),e.end(i)]);return Gs(n)},Ys=function(e,t){return Ks(e,function(e,n){return e-Ws<=t&&n+Ws>=t})},Xs=function(e,t){return Ks(e,function(e){return e-qs>=t})},Qs=function(e){if(e.length<2)return Gs();const t=[];for(let n=1;n<e.length;n++){const i=e.end(n-1),r=e.start(n);t.push([i,r])}return Gs(t)},Zs=function(e,t){let n=null,i=null,r=0;const s=[],a=[];if(!e||!e.length||!t||!t.length)return Gs();let o=e.length;while(o--)s.push({time:e.start(o),type:"start"}),s.push({time:e.end(o),type:"end"});o=t.length;while(o--)s.push({time:t.start(o),type:"start"}),s.push({time:t.end(o),type:"end"});for(s.sort(function(e,t){return e.time-t.time}),o=0;o<s.length;o++)"start"===s[o].type?(r++,2===r&&(n=s[o].time)):"end"===s[o].type&&(r--,1===r&&(i=s[o].time)),null!==n&&null!==i&&(a.push([n,i]),n=null,i=null);return Gs(a)},Js=e=>{const t=[];if(!e||!e.length)return"";for(let n=0;n<e.length;n++)t.push(e.start(n)+" => "+e.end(n));return t.join(", ")},ea=function(e,t,n=1){const i=e.length?e.end(e.length-1):0;return(i-t)/n},ta=e=>{const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t},na=function(e,t){if(e===t)return!1;if(!e&&t||!t&&e)return!0;if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++)if(e.start(n)!==t.start(n)||e.end(n)!==t.end(n))return!0;return!1},ia=function(e){if(e&&e.length&&e.end)return e.end(e.length-1)},ra=function(e,t){let n=0;if(!e||!e.length)return n;for(let i=0;i<e.length;i++){const r=e.start(i),s=e.end(i);t>s||(n+=t>r&&t<=s?s-t:s-r)}return n},sa=(e,t)=>{if(!t.preload)return t.duration;let n=0;return(t.parts||[]).forEach(function(e){n+=e.duration}),(t.preloadHints||[]).forEach(function(t){"PART"===t.type&&(n+=e.partTargetDuration)}),n},aa=e=>(e.segments||[]).reduce((e,t,n)=>{return t.parts?t.parts.forEach(function(i,r){e.push({duration:i.duration,segmentIndex:n,partIndex:r,part:i,segment:t})}):e.push({duration:t.duration,segmentIndex:n,partIndex:null,segment:t,part:null}),e},[]),oa=e=>{const t=e.segments&&e.segments.length&&e.segments[e.segments.length-1];return t&&t.parts||[]},la=({preloadSegment:e})=>{if(!e)return;const{parts:t,preloadHints:n}=e;let i=(n||[]).reduce((e,t)=>e+("PART"===t.type?1:0),0);return i+=t&&t.length?t.length:0,i},ua=(e,t)=>{if(t.endList)return 0;if(e&&e.suggestedPresentationDelay)return e.suggestedPresentationDelay;const n=oa(t).length>0;return n&&t.serverControl&&t.serverControl.partHoldBack?t.serverControl.partHoldBack:n&&t.partTargetDuration?3*t.partTargetDuration:t.serverControl&&t.serverControl.holdBack?t.serverControl.holdBack:t.targetDuration?3*t.targetDuration:0},ca=function(e,t){let n=0,i=t-e.mediaSequence,r=e.segments[i];if(r){if("undefined"!==typeof r.start)return{result:r.start,precise:!0};if("undefined"!==typeof r.end)return{result:r.end-r.duration,precise:!0}}while(i--){if(r=e.segments[i],"undefined"!==typeof r.end)return{result:n+r.end,precise:!0};if(n+=sa(e,r),"undefined"!==typeof r.start)return{result:n+r.start,precise:!0}}return{result:n,precise:!1}},da=function(e,t){let n,i=0,r=t-e.mediaSequence;for(;r<e.segments.length;r++){if(n=e.segments[r],"undefined"!==typeof n.start)return{result:n.start-i,precise:!0};if(i+=sa(e,n),"undefined"!==typeof n.end)return{result:n.end-i,precise:!0}}return{result:-1,precise:!1}},ha=function(e,t,n){if("undefined"===typeof t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence)return 0;const i=ca(e,t);if(i.precise)return i.result;const r=da(e,t);return r.precise?r.result:i.result+n},fa=function(e,t,n){if(!e)return 0;if("number"!==typeof n&&(n=0),"undefined"===typeof t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return r.a.Infinity}return ha(e,t,n)},pa=function({defaultDuration:e,durationList:t,startIndex:n,endIndex:i}){let r=0;if(n>i&&([n,i]=[i,n]),n<0){for(let t=n;t<Math.min(0,i);t++)r+=e;n=0}for(let s=n;s<i;s++)r+=t[s].duration;return r},ga=function(e,t,n,i){if(!e||!e.segments)return null;if(e.endList)return fa(e);if(null===t)return null;t=t||0;let r=ha(e,e.mediaSequence+e.segments.length,t);return n&&(i="number"===typeof i?i:ua(null,e),r-=i),Math.max(0,r)},ma=function(e,t,n){const i=!0,r=t||0;let s=ga(e,t,i,n);return null===s?Gs():(s<r&&(s=r),Gs(r,s))},va=function({playlist:e,currentTime:t,startingSegmentIndex:n,startingPartIndex:i,startTime:r,exactManifestTimings:s}){let a=t-r;const o=aa(e);let l=0;for(let u=0;u<o.length;u++){const e=o[u];if(n===e.segmentIndex&&("number"!==typeof i||"number"!==typeof e.partIndex||i===e.partIndex)){l=u;break}}if(a<0){if(l>0)for(let t=l-1;t>=0;t--){const n=o[t];if(a+=n.duration,s){if(a<0)continue}else if(a+qs<=0)continue;return{partIndex:n.partIndex,segmentIndex:n.segmentIndex,startTime:r-pa({defaultDuration:e.targetDuration,durationList:o,startIndex:l,endIndex:t})}}return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:t}}if(l<0){for(let n=l;n<0;n++)if(a-=e.targetDuration,a<0)return{partIndex:o[0]&&o[0].partIndex||null,segmentIndex:o[0]&&o[0].segmentIndex||0,startTime:t};l=0}for(let u=l;u<o.length;u++){const t=o[u];a-=t.duration;const n=t.duration>qs,i=0===a,c=n&&a+qs>=0;if(!i&&!c||u===o.length-1){if(s){if(a>0)continue}else if(a-qs>=0)continue;return{partIndex:t.partIndex,segmentIndex:t.segmentIndex,startTime:r+pa({defaultDuration:e.targetDuration,durationList:o,startIndex:l,endIndex:u})}}}return{segmentIndex:o[o.length-1].segmentIndex,partIndex:o[o.length-1].partIndex,startTime:t}},ya=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},ba=function(e){return e.excludeUntil&&e.excludeUntil===1/0},_a=function(e){const t=ya(e);return!e.disabled&&!t},Ta=function(e){return e.disabled},Sa=function(e){for(let t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},wa=function(e,t){return t.attributes&&t.attributes[e]},Ea=function(e,t,n,i=0){if(!wa("BANDWIDTH",n))return NaN;const r=e*n.attributes.BANDWIDTH;return(r-8*i)/t},xa=(e,t)=>{if(1===e.playlists.length)return!0;const n=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter(e=>{return!!_a(e)&&(e.attributes.BANDWIDTH||0)<n}).length},ka=(e,t)=>{return!(!e&&!t||!e&&t||e&&!t)&&(e===t||(!(!e.id||!t.id||e.id!==t.id)||(!(!e.resolvedUri||!t.resolvedUri||e.resolvedUri!==t.resolvedUri)||!(!e.uri||!t.uri||e.uri!==t.uri))))},Aa=function(e,t){const n=e&&e.mediaGroups&&e.mediaGroups.AUDIO||{};let i=!1;for(const r in n){for(const e in n[r])if(i=t(n[r][e]),i)break;if(i)break}return!!i},Ia=e=>{if(!e||!e.playlists||!e.playlists.length){const t=Aa(e,e=>e.playlists&&e.playlists.length||e.uri);return t}for(let t=0;t<e.playlists.length;t++){const n=e.playlists[t],i=n.attributes&&n.attributes.CODECS;if(i&&i.split(",").every(e=>Object(g["f"])(e)))continue;const r=Aa(e,e=>ka(n,e));if(!r)return!1}return!0};var Ca={liveEdgeDelay:ua,duration:fa,seekable:ma,getMediaInfoForTime:va,isEnabled:_a,isDisabled:Ta,isExcluded:ya,isIncompatible:ba,playlistEnd:ga,isAes:Sa,hasAttribute:wa,estimateSegmentRequestTime:Ea,isLowestEnabledRendition:xa,isAudioOnly:Ia,playlistMatch:ka,segmentDurationWithParts:sa};const{log:Da}=Ps,Ra=(e,t)=>{return`${e}-${t}`},Ma=(e,t,n)=>{return`placeholder-uri-${e}-${t}-${n}`},La=({onwarn:e,oninfo:t,manifestString:n,customTagParsers:i=[],customTagMappers:r=[],llhls:s})=>{const a=new p["a"];e&&a.on("warn",e),t&&a.on("info",t),i.forEach(e=>a.addParser(e)),r.forEach(e=>a.addTagMapper(e)),a.push(n),a.end();const o=a.manifest;if(s||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(e){o.hasOwnProperty(e)&&delete o[e]}),o.segments&&o.segments.forEach(function(e){["parts","preloadHints"].forEach(function(t){e.hasOwnProperty(t)&&delete e[t]})})),!o.targetDuration){let t=10;o.segments&&o.segments.length&&(t=o.segments.reduce((e,t)=>Math.max(e,t.duration),0)),e&&e({message:`manifest has no targetDuration defaulting to ${t}`}),o.targetDuration=t}const l=oa(o);if(l.length&&!o.partTargetDuration){const t=l.reduce((e,t)=>Math.max(e,t.duration),0);e&&(e({message:`manifest has no partTargetDuration defaulting to ${t}`}),Da.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),o.partTargetDuration=t}return o},Pa=(e,t)=>{e.mediaGroups&&["AUDIO","SUBTITLES"].forEach(n=>{if(e.mediaGroups[n])for(const i in e.mediaGroups[n])for(const r in e.mediaGroups[n][i]){const s=e.mediaGroups[n][i][r];t(s,n,i,r)}})},Oa=({playlist:e,uri:t,id:n})=>{e.id=n,e.playlistErrors_=0,t&&(e.uri=t),e.attributes=e.attributes||{}},Na=e=>{let t=e.playlists.length;while(t--){const n=e.playlists[t];Oa({playlist:n,id:Ra(t,n.uri)}),n.resolvedUri=js(e.uri,n.uri),e.playlists[n.id]=n,e.playlists[n.uri]=n,n.attributes.BANDWIDTH||Da.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},Ua=e=>{Pa(e,t=>{t.uri&&(t.resolvedUri=js(e.uri,t.uri))})},Fa=(e,t)=>{const n=Ra(0,t),i={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:r.a.location.href,resolvedUri:r.a.location.href,playlists:[{uri:t,id:n,resolvedUri:t,attributes:{}}]};return i.playlists[n]=i.playlists[0],i.playlists[t]=i.playlists[0],i},Ba=(e,t,n=Ma)=>{e.uri=t;for(let r=0;r<e.playlists.length;r++)if(!e.playlists[r].uri){const t=`placeholder-uri-${r}`;e.playlists[r].uri=t}const i=Ia(e);Pa(e,(t,r,s,a)=>{if(!t.playlists||!t.playlists.length){if(i&&"AUDIO"===r&&!t.uri)for(let t=0;t<e.playlists.length;t++){const n=e.playlists[t];if(n.attributes&&n.attributes.AUDIO&&n.attributes.AUDIO===s)return}t.playlists=[h()({},t)]}t.playlists.forEach(function(t,i){const o=n(r,s,a,t),l=Ra(i,o);t.uri?t.resolvedUri=t.resolvedUri||js(e.uri,t.uri):(t.uri=0===i?o:l,t.resolvedUri=t.uri),t.id=t.id||l,t.attributes=t.attributes||{},e.playlists[t.id]=t,e.playlists[t.uri]=t})}),Na(e),Ua(e)};class ja{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(null!==this.offset_)return;if(!e.length)return;const[t]=e;void 0!==t.programDateTime&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[t]=e,n=t.startDate.getTime();this.trimProcessedDateRanges_(n),this.pendingDateRanges_=e.reduce((e,t)=>{return e.set(t.id,t),e},new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(null===this.offset_)return[];const e={},t=[];this.pendingDateRanges_.forEach((n,i)=>{if(!this.processedDateRanges_.has(i)&&(n.startTime=n.startDate.getTime()/1e3-this.offset_,n.processDateRange=(()=>this.processDateRange(n)),t.push(n),n.class))if(e[n.class]){const t=e[n.class].push(n);n.classListIndex=t-1}else e[n.class]=[n],n.classListIndex=0});for(const n of t){const t=e[n.class]||[];n.endDate?n.endTime=n.endDate.getTime()/1e3-this.offset_:n.endOnNext&&t[n.classListIndex+1]?n.endTime=t[n.classListIndex+1].startTime:n.duration?n.endTime=n.startTime+n.duration:n.plannedDuration?n.endTime=n.startTime+n.plannedDuration:n.endTime=n.startTime}return t}trimProcessedDateRanges_(e){const t=new Map(this.processedDateRanges_);t.forEach((t,n)=>{t.startDate.getTime()<e&&this.processedDateRanges_.delete(n)})}}const Va=22,Ha=({requestType:e,request:t,error:n,parseFailure:i})=>{const r=t.status<200||t.status>299,s=t.status>=400&&t.status<=499,a={uri:t.uri,requestType:e},o=r&&!s||i;if(n&&s)a.error=h()({},n),a.errorType=Ps.Error.NetworkRequestFailed;else if(t.aborted)a.errorType=Ps.Error.NetworkRequestAborted;else if(t.timedout)a.erroType=Ps.Error.NetworkRequestTimeout;else if(o){const e=i?Ps.Error.NetworkBodyParserFailed:Ps.Error.NetworkBadStatus;a.errorType=e,a.status=t.status,a.headers=t.headers}return a},$a=Hs("CodecUtils"),Ga=function(e){const t=e.attributes||{};if(t.CODECS)return Object(g["h"])(t.CODECS)},za=(e,t)=>{const n=t.attributes||{};return e&&e.mediaGroups&&e.mediaGroups.AUDIO&&n.AUDIO&&e.mediaGroups.AUDIO[n.AUDIO]},qa=(e,t)=>{if(!za(e,t))return!0;const n=t.attributes||{},i=e.mediaGroups.AUDIO[n.AUDIO];for(const r in i)if(!i[r].uri&&!i[r].playlists)return!0;return!1},Wa=function(e){const t={};return e.forEach(({mediaType:e,type:n,details:i})=>{t[e]=t[e]||[],t[e].push(Object(g["i"])(`${n}${i}`))}),Object.keys(t).forEach(function(e){if(t[e].length>1)return $a(`multiple ${e} codecs found as attributes: ${t[e].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),void(t[e]=null);t[e]=t[e][0]}),t},Ka=function(e){let t=0;return e.audio&&t++,e.video&&t++,t},Ya=function(e,t){const n=t.attributes||{},i=Wa(Ga(t)||[]);if(za(e,t)&&!i.audio&&!qa(e,t)){const t=Wa(Object(g["d"])(e,n.AUDIO)||[]);t.audio&&(i.audio=t.audio)}return i},{EventTarget:Xa}=Ps,Qa=(e,t)=>{if(t.endList||!t.serverControl)return e;const n={};if(t.serverControl.canBlockReload){const{preloadSegment:e}=t;let i=t.mediaSequence+t.segments.length;if(e){const r=e.parts||[],s=la(t)-1;s>-1&&s!==r.length-1&&(n._HLS_part=s),(s>-1||r.length)&&i--}n._HLS_msn=i}if(t.serverControl&&t.serverControl.canSkipUntil&&(n._HLS_skip=t.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(n).length){const t=new r.a.URL(e);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(e){n.hasOwnProperty(e)&&t.searchParams.set(e,n[e])}),e=t.toString()}return e},Za=(e,t)=>{if(!e)return t;const n=$s(e,t);if(e.preloadHints&&!t.preloadHints&&delete n.preloadHints,e.parts&&!t.parts)delete n.parts;else if(e.parts&&t.parts)for(let i=0;i<t.parts.length;i++)e.parts&&e.parts[i]&&(n.parts[i]=$s(e.parts[i],t.parts[i]));return!e.skipped&&t.skipped&&(n.skipped=!1),e.preload&&!t.preload&&(n.preload=!1),n},Ja=(e,t,n)=>{const i=e.slice(),r=t.slice();n=n||0;const s=[];let a;for(let o=0;o<r.length;o++){const e=i[o+n],t=r[o];e?(a=e.map||a,s.push(Za(e,t))):(a&&!t.map&&(t.map=a),s.push(t))}return s},eo=(e,t)=>{!e.resolvedUri&&e.uri&&(e.resolvedUri=js(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=js(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=js(t,e.map.uri)),e.map&&e.map.key&&!e.map.key.resolvedUri&&(e.map.key.resolvedUri=js(t,e.map.key.uri)),e.parts&&e.parts.length&&e.parts.forEach(e=>{e.resolvedUri||(e.resolvedUri=js(t,e.uri))}),e.preloadHints&&e.preloadHints.length&&e.preloadHints.forEach(e=>{e.resolvedUri||(e.resolvedUri=js(t,e.uri))})},to=function(e){const t=e.segments||[],n=e.preloadSegment;if(n&&n.parts&&n.parts.length){if(n.preloadHints)for(let e=0;e<n.preloadHints.length;e++)if("MAP"===n.preloadHints[e].type)return t;n.duration=e.targetDuration,n.preload=!0,t.push(n)}return t},no=(e,t)=>e===t||e.segments&&t.segments&&e.segments.length===t.segments.length&&e.endList===t.endList&&e.mediaSequence===t.mediaSequence&&e.preloadSegment===t.preloadSegment,io=(e,t,n=no)=>{const i=$s(e,{}),r=i.playlists[t.id];if(!r)return null;if(n(r,t))return null;t.segments=to(t);const s=$s(r,t);if(s.preloadSegment&&!t.preloadSegment&&delete s.preloadSegment,r.segments){if(t.skip){t.segments=t.segments||[];for(let e=0;e<t.skip.skippedSegments;e++)t.segments.unshift({skipped:!0})}s.segments=Ja(r.segments,t.segments,t.mediaSequence-r.mediaSequence)}s.segments.forEach(e=>{eo(e,s.resolvedUri)});for(let a=0;a<i.playlists.length;a++)i.playlists[a].id===t.id&&(i.playlists[a]=s);return i.playlists[t.id]=s,i.playlists[t.uri]=s,Pa(e,(e,n,i,r)=>{if(e.playlists)for(let a=0;a<e.playlists.length;a++)t.id===e.playlists[a].id&&(e.playlists[a]=s)}),i},ro=(e,t)=>{const n=e.segments||[],i=n[n.length-1],r=i&&i.parts&&i.parts[i.parts.length-1],s=r&&r.duration||i&&i.duration;return t&&s?1e3*s:500*(e.partTargetDuration||e.targetDuration||10)},so=(e,t,n)=>{if(!e)return;const i=[];return e.forEach(e=>{if(!e.attributes)return;const{BANDWIDTH:t,RESOLUTION:n,CODECS:r}=e.attributes;i.push({id:e.id,bandwidth:t,resolution:n,codecs:r})}),{type:t,isLive:n,renditions:i}};class ao extends Xa{constructor(e,t,n={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=Hs("PlaylistLoader");const{withCredentials:i=!1}=n;this.src=e,this.vhs_=t,this.withCredentials=i,this.addDateRangesToTextTrack_=n.addDateRangesToTextTrack;const r=t.options_;this.customTagParsers=r&&r.customTagParsers||[],this.customTagMappers=r&&r.customTagMappers||[],this.llhls=r&&r.llhls,this.dateRangesStorage_=new ja,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();t.length&&this.addDateRangesToTextTrack_&&this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if("HAVE_METADATA"!==this.state)return;const e=this.media();let t=js(this.main.uri,e.uri);this.llhls&&(t=Qa(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials,requestType:"hls-playlist"},(e,t)=>{if(this.request)return e?this.playlistRequestError(this.request,this.media(),"HAVE_METADATA"):void this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})})}playlistRequestError(e,t,n){const{uri:i,id:r}=t;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[r],status:e.status,message:`HLS playlist request error at URL: ${i}.`,responseText:e.responseText,code:e.status>=500?4:2,metadata:Ha({requestType:e.requestType,request:e,error:e.error})},this.trigger("error")}parseManifest_({url:e,manifestString:t}){try{const n=La({onwarn:({message:t})=>this.logger_(`m3u8-parser warn for ${e}: ${t}`),oninfo:({message:t})=>this.logger_(`m3u8-parser info for ${e}: ${t}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls});return n.playlists&&n.playlists.length?(this.excludeAudioOnlyVariants(n.playlists),n):n}catch(e){this.error=e,this.error.metadata={errorType:Ps.Error.StreamingHlsPlaylistParserError,error:e}}}excludeAudioOnlyVariants(e){const t=e=>{const t=e.attributes||{},{width:n,height:i}=t.RESOLUTION||{};if(n&&i)return!0;const r=Ga(e)||[],s=Wa(r);return Boolean(s.video)};e.some(t)&&e.forEach(e=>{t(e)||(e.excludeUntil=1/0)})}haveMetadata({playlistString:e,playlistObject:t,url:n,id:i}){this.request=null,this.state="HAVE_METADATA";const r={playlistInfo:{type:"media",uri:n}};this.trigger({type:"playlistparsestart",metadata:r});const s=t||this.parseManifest_({url:n,manifestString:e});s.lastRequest=Date.now(),Oa({playlist:s,uri:n,id:i});const a=io(this.main,s);this.targetDuration=s.partTargetDuration||s.targetDuration,this.pendingMedia_=null,a?(this.main=a,this.media_=this.main.playlists[i]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(ro(this.media(),!!a)),r.parsedPlaylist=so(this.main.playlists,r.playlistInfo.type,!this.media_.endList),this.trigger({type:"playlistparsecomplete",metadata:r}),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),r.a.clearTimeout(this.mediaUpdateTimeout),r.a.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new ja,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"===typeof e){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(r.a.clearTimeout(this.finalRenditionTimeout),t){const t=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;return void(this.finalRenditionTimeout=r.a.setTimeout(this.media.bind(this,e,!1),t))}const n=this.state,i=!this.media_||e.id!==this.media_.id,s=this.main.playlists[e.id];if(s&&s.endList||e.endList&&e.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(i&&(this.trigger("mediachanging"),"HAVE_MAIN_MANIFEST"===n?this.trigger("loadedmetadata"):this.trigger("mediachange")));if(this.updateMediaUpdateTimeout_(ro(e,!0)),!i)return;if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e;const a={playlistInfo:{type:"media",uri:e.uri}};this.trigger({type:"playlistrequeststart",metadata:a}),this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,i)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=Vs(e.resolvedUri,i),t)return this.playlistRequestError(this.request,e,n);this.trigger({type:"playlistrequestcomplete",metadata:a}),this.haveMetadata({playlistString:i.responseText,url:e.uri,id:e.id}),"HAVE_MAIN_MANIFEST"===n?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}pause(){this.mediaUpdateTimeout&&(r.a.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(r.a.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const e=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=r.a.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},e)}else this.started?t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(r.a.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.media()&&!this.media().endList&&(this.mediaUpdateTimeout=r.a.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,"object"===typeof this.src)return this.src.uri||(this.src.uri=r.a.location.href),this.src.resolvedUri=this.src.uri,void setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);const e={playlistInfo:{type:"multivariant",uri:this.src}};this.trigger({type:"playlistrequeststart",metadata:e}),this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,n)=>{if(!this.request)return;if(this.request=null,t)return this.error={status:n.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:n.responseText,code:2,metadata:Ha({requestType:n.requestType,request:n,error:t})},"HAVE_NOTHING"===this.state&&(this.started=!1),this.trigger("error");this.trigger({type:"playlistrequestcomplete",metadata:e}),this.src=Vs(this.src,n),this.trigger({type:"playlistparsestart",metadata:e});const i=this.parseManifest_({manifestString:n.responseText,url:this.src});e.parsedPlaylist=so(i.playlists,e.playlistInfo.type,!1),this.trigger({type:"playlistparsecomplete",metadata:e}),this.setupInitialPlaylist(i)})}srcUri(){return"string"===typeof this.src?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists)return this.main=e,Ba(this.main,this.srcUri()),e.playlists.forEach(e=>{e.segments=to(e),e.segments.forEach(t=>{eo(t,e.resolvedUri)})}),this.trigger("loadedplaylist"),void(this.request||this.media(this.main.playlists[0]));const t=this.srcUri()||r.a.location.href;this.main=Fa(e,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const n=this.main,i=e.ID;let r=n.playlists.length;while(r--){const s=n.playlists[r];if(s.attributes["PATHWAY-ID"]===i){const a=s.resolvedUri,o=s.id;if(t){const t=this.createCloneURI_(s.resolvedUri,e),a=Ra(i,t),o=this.createCloneAttributes_(i,s.attributes),l=this.createClonePlaylist_(s,a,e,o);n.playlists[r]=l,n.playlists[a]=l,n.playlists[t]=l}else n.playlists.splice(r,1);delete n.playlists[o],delete n.playlists[a]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const n=this.main,i=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{if(n.mediaGroups[e]&&n.mediaGroups[e][i])for(const t in n.mediaGroups[e])if(t===i){for(const i in n.mediaGroups[e][t]){const r=n.mediaGroups[e][t][i];r.playlists.forEach((e,t)=>{const i=n.playlists[e.id],r=i.id,s=i.resolvedUri;delete n.playlists[r],delete n.playlists[s]})}delete n.mediaGroups[e][t]}}),t&&this.createClonedMediaGroups_(e)}addClonePathway(e,t={}){const n=this.main,i=n.playlists.length,r=this.createCloneURI_(t.resolvedUri,e),s=Ra(e.ID,r),a=this.createCloneAttributes_(e.ID,t.attributes),o=this.createClonePlaylist_(t,s,e,a);n.playlists[i]=o,n.playlists[s]=o,n.playlists[r]=o,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,n=e["BASE-ID"],i=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(r=>{if(i.mediaGroups[r]&&!i.mediaGroups[r][t])for(const s in i.mediaGroups[r])if(s===n){i.mediaGroups[r][t]={};for(const n in i.mediaGroups[r][s]){const a=i.mediaGroups[r][s][n];i.mediaGroups[r][t][n]=h()({},a);const o=i.mediaGroups[r][t][n],l=this.createCloneURI_(a.resolvedUri,e);o.resolvedUri=l,o.uri=l,o.playlists=[],a.playlists.forEach((s,a)=>{const l=i.playlists[s.id],u=Ma(r,t,n),c=Ra(t,u);if(l&&!i.playlists[c]){const t=this.createClonePlaylist_(l,c,e),n=t.resolvedUri;i.playlists[c]=t,i.playlists[n]=t}o.playlists[a]=this.createClonePlaylist_(s,c,e)})}}})}createClonePlaylist_(e,t,n,i){const r=this.createCloneURI_(e.resolvedUri,n),s={resolvedUri:r,uri:r,id:t};return e.segments&&(s.segments=[]),i&&(s.attributes=i),$s(e,s)}createCloneURI_(e,t){const n=new URL(e);n.hostname=t["URI-REPLACEMENT"].HOST;const i=t["URI-REPLACEMENT"].PARAMS;for(const r of Object.keys(i))n.searchParams.set(r,i[r]);return n.href}createCloneAttributes_(e,t){const n={["PATHWAY-ID"]:e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(i=>{t[i]&&(n[i]=e)}),n}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const i=e.contentProtection[n].attributes.keyId;i&&t.add(i.toLowerCase())}return t}}}const oo=function(e,t,n,i){const r="arraybuffer"===e.responseType?e.response:e.responseText;!t&&r&&(e.responseTime=Date.now(),e.roundTripTime=e.responseTime-e.requestTime,e.bytesReceived=r.byteLength||r.length,e.bandwidth||(e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3))),n.headers&&(e.responseHeaders=n.headers),t&&"ETIMEDOUT"===t.code&&(e.timedout=!0),t||e.aborted||200===n.statusCode||206===n.statusCode||0===n.statusCode||(t=new Error("XHR Failed with a response of: "+(e&&(r||e.responseText)))),i(t,e)},lo=(e,t)=>{if(!e||!e.size)return;let n=t;return e.forEach(e=>{n=e(n)}),n},uo=(e,t,n,i)=>{e&&e.size&&e.forEach(e=>{e(t,n,i)})},co=function(){const e=function e(t,n){t=$s({timeout:45e3},t);const i=e.beforeRequest||Ps.Vhs.xhr.beforeRequest,r=e._requestCallbackSet||Ps.Vhs.xhr._requestCallbackSet||new Set,s=e._responseCallbackSet||Ps.Vhs.xhr._responseCallbackSet;i&&"function"===typeof i&&(Ps.log.warn("beforeRequest is deprecated, use onRequest instead."),r.add(i));const a=!0===Ps.Vhs.xhr.original?Ps.xhr:Ps.Vhs.xhr,o=lo(r,t);r.delete(i);const l=a(o||t,function(e,t){return uo(s,l,e,t),oo(l,e,t,n)}),u=l.abort;return l.abort=function(){return l.aborted=!0,u.apply(l,arguments)},l.uri=t.uri,l.requestType=t.requestType,l.requestTime=Date.now(),l};return e.original=!0,e},ho=function(e){let t;const n=e.offset;return t="bigint"===typeof e.offset||"bigint"===typeof e.length?r.a.BigInt(e.offset)+r.a.BigInt(e.length)-r.a.BigInt(1):e.offset+e.length-1,"bytes="+n+"-"+t},fo=function(e){const t={};return e.byterange&&(t.Range=ho(e.byterange)),t},po=function(e,t){return e.start(t)+"-"+e.end(t)},go=function(e,t){const n=e.toString(16);return"00".substring(0,2-n.length)+n+(t%2?" ":"")},mo=function(e){return e>=32&&e<126?String.fromCharCode(e):"."},vo=function(e){const t={};return Object.keys(e).forEach(n=>{const i=e[n];Object(v["e"])(i)?t[n]={bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:t[n]=i}),t},yo=function(e){const t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},bo=function(e){return e.resolvedUri},_o=e=>{const t=Array.prototype.slice.call(e),n=16;let i,r,s="";for(let a=0;a<t.length/n;a++)i=t.slice(a*n,a*n+n).map(go).join(""),r=t.slice(a*n,a*n+n).map(mo).join(""),s+=i+" "+r+"\n";return s},To=({bytes:e})=>_o(e),So=e=>{let t,n="";for(t=0;t<e.length;t++)n+=po(e,t)+" ";return n};var wo=Object.freeze({__proto__:null,createTransferableMessage:vo,initSegmentId:yo,segmentKeyId:bo,hexDump:_o,tagDump:To,textRanges:So});const Eo=.25,xo=(e,t)=>{if(!t.dateTimeObject)return null;const n=t.videoTimingInfo.transmuxerPrependedSeconds,i=t.videoTimingInfo.transmuxedPresentationStart,r=i+n,s=e-r;return new Date(t.dateTimeObject.getTime()+1e3*s)},ko=e=>{return e.transmuxedPresentationEnd-e.transmuxedPresentationStart-e.transmuxerPrependedSeconds},Ao=(e,t)=>{let n;try{n=new Date(e)}catch(e){return null}if(!t||!t.segments||0===t.segments.length)return null;let i=t.segments[0];if(n<new Date(i.dateTimeObject))return null;for(let l=0;l<t.segments.length-1;l++){i=t.segments[l];const e=new Date(t.segments[l+1].dateTimeObject);if(n<e)break}const r=t.segments[t.segments.length-1],s=r.dateTimeObject,a=r.videoTimingInfo?ko(r.videoTimingInfo):r.duration+r.duration*Eo,o=new Date(s.getTime()+1e3*a);return n>o?null:(n>new Date(s)&&(i=r),{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:Ca.duration(t,t.mediaSequence+t.segments.indexOf(i)),type:i.videoTimingInfo?"accurate":"estimate"})},Io=(e,t)=>{if(!t||!t.segments||0===t.segments.length)return null;let n,i=0;for(let s=0;s<t.segments.length;s++)if(n=t.segments[s],i=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:i+n.duration,e<=i)break;const r=t.segments[t.segments.length-1];if(r.videoTimingInfo&&r.videoTimingInfo.transmuxedPresentationEnd<e)return null;if(e>i){if(e>i+r.duration*Eo)return null;n=r}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:i-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}},Co=(e,t)=>{let n,i;try{n=new Date(e),i=new Date(t)}catch(e){}const r=n.getTime(),s=i.getTime();return(s-r)/1e3},Do=e=>{if(!e.segments||0===e.segments.length)return!1;for(let t=0;t<e.segments.length;t++){const n=e.segments[t];if(!n.dateTimeObject)return!1}return!0},Ro=({playlist:e,time:t,callback:n})=>{if(!n)throw new Error("getProgramTime: callback must be provided");if(!e||void 0===t)return n({message:"getProgramTime: playlist and time must be provided"});const i=Io(t,e);if(!i)return n({message:"valid programTime was not found"});if("estimate"===i.type)return n({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:i.estimatedStart});const r={mediaSeconds:t},s=xo(t,i.segment);return s&&(r.programDateTime=s.toISOString()),n(null,r)},Mo=({programTime:e,playlist:t,retryCount:n=2,seekTo:i,pauseAfterSeek:r=!0,tech:s,callback:a})=>{if(!a)throw new Error("seekToProgramTime: callback must be provided");if("undefined"===typeof e||!t||!i)return a({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!t.endList&&!s.hasStarted_)return a({message:"player must be playing a live stream to start buffering"});if(!Do(t))return a({message:"programDateTime tags must be provided in the manifest "+t.resolvedUri});const o=Ao(e,t);if(!o)return a({message:`${e} was not found in the stream`});const l=o.segment,u=Co(l.dateTimeObject,e);if("estimate"===o.type)return 0===n?a({message:`${e} is not buffered yet. Try again`}):(i(o.estimatedStart+u),void s.one("seeked",()=>{Mo({programTime:e,playlist:t,retryCount:n-1,seekTo:i,pauseAfterSeek:r,tech:s,callback:a})}));const c=l.start+u,d=()=>{return a(null,s.currentTime())};s.one("seeked",d),r&&s.pause(),i(c)},Lo=(e,t)=>{if(4===e.readyState)return t()},Po=(e,t,n,i)=>{let r,s=[],a=!1;const o=function(e,t,i,r){return t.abort(),a=!0,n(e,t,i,r)},l=function(e,t){if(a)return;if(e)return e.metadata=Ha({requestType:i,request:t,error:e}),o(e,t,"",s);const n=t.responseText.substring(s&&s.byteLength||0,t.responseText.length);if(s=Object(v["d"])(s,Object(v["h"])(n,!0)),r=r||Object(T["a"])(s),s.length<10||r&&s.length<r+2)return Lo(t,()=>o(e,t,"",s));const l=Object(S["a"])(s);return"ts"===l&&s.length<188?Lo(t,()=>o(e,t,"",s)):!l&&s.length<376?Lo(t,()=>o(e,t,"",s)):o(null,t,l,s)},u={uri:e,beforeSend(e){e.overrideMimeType("text/plain; charset=x-user-defined"),e.addEventListener("progress",function({total:t,loaded:n}){return oo(e,null,{statusCode:e.status},l)})}},c=t(u,function(e,t){return oo(c,e,t,l)});return c},{EventTarget:Oo}=Ps,No=function(e,t){if(!no(e,t))return!1;if(e.sidx&&t.sidx&&(e.sidx.offset!==t.sidx.offset||e.sidx.length!==t.sidx.length))return!1;if(!e.sidx&&t.sidx||e.sidx&&!t.sidx)return!1;if(e.segments&&!t.segments||!e.segments&&t.segments)return!1;if(!e.segments&&!t.segments)return!0;for(let n=0;n<e.segments.length;n++){const i=e.segments[n],r=t.segments[n];if(i.uri!==r.uri)return!1;if(!i.byterange&&!r.byterange)continue;const s=i.byterange,a=r.byterange;if(s&&!a||!s&&a)return!1;if(s.offset!==a.offset||s.length!==a.length)return!1}return!0},Uo=(e,t,n,i)=>{const r=i.attributes.NAME||n;return`placeholder-uri-${e}-${t}-${r}`},Fo=({mainXml:e,srcUrl:t,clientOffset:n,sidxMapping:i,previousManifest:r})=>{const s=Object(y["c"])(e,{manifestUri:t,clientOffset:n,sidxMapping:i,previousManifest:r});return Ba(s,t,Uo),s},Bo=(e,t)=>{Pa(e,(n,i,r,s)=>{t.mediaGroups[i][r]&&s in t.mediaGroups[i][r]||delete e.mediaGroups[i][r][s]})},jo=(e,t,n)=>{let i=!0,r=$s(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod,timelineStarts:t.timelineStarts});for(let s=0;s<t.playlists.length;s++){const e=t.playlists[s];if(e.sidx){const t=Object(y["b"])(e.sidx);n&&n[t]&&n[t].sidx&&Object(y["a"])(e,n[t].sidx,e.sidx.resolvedUri)}const a=io(r,e,No);a&&(r=a,i=!1)}return Pa(t,(e,t,n,s)=>{if(e.playlists&&e.playlists.length){const a=e.playlists[0].id,o=io(r,e.playlists[0],No);o&&(r=o,s in r.mediaGroups[t][n]||(r.mediaGroups[t][n][s]=e),r.mediaGroups[t][n][s].playlists[0]=r.playlists[a],i=!1)}}),Bo(r,t),t.minimumUpdatePeriod!==e.minimumUpdatePeriod&&(i=!1),i?null:r},Vo=(e,t)=>{const n=Boolean(!e.map&&!t.map),i=n||Boolean(e.map&&t.map&&e.map.byterange.offset===t.map.byterange.offset&&e.map.byterange.length===t.map.byterange.length);return i&&e.uri===t.uri&&e.byterange.offset===t.byterange.offset&&e.byterange.length===t.byterange.length},Ho=(e,t)=>{const n={};for(const i in e){const r=e[i],s=r.sidx;if(s){const e=Object(y["b"])(s);if(!t[e])break;const i=t[e].sidxInfo;Vo(i,s)&&(n[e]=t[e])}}return n},$o=(e,t)=>{const n=Ho(e.playlists,t);let i=n;return Pa(e,(e,n,r,s)=>{if(e.playlists&&e.playlists.length){const n=e.playlists;i=$s(i,Ho(n,t))}}),i};class Go extends Oo{constructor(e,t,n={},i){super(),this.isPaused_=!0,this.mainPlaylistLoader_=i||this,i||(this.isMain_=!0);const{withCredentials:r=!1}=n;if(this.vhs_=t,this.withCredentials=r,this.addMetadataToTextTrack=n.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=Hs("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}get isPaused(){return this.isPaused_}requestErrored_(e,t,n){return!this.request||(this.request=null,e?(this.error="object"!==typeof e||e instanceof Error?{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2,metadata:e.metadata}:e,n&&(this.state=n),this.trigger("error"),!0):void 0)}addSidxSegments_(e,t,n){const i=e.sidx&&Object(y["b"])(e.sidx);if(!e.sidx||!i||this.mainPlaylistLoader_.sidxMapping_[i])return r.a.clearTimeout(this.mediaRequest_),void(this.mediaRequest_=r.a.setTimeout(()=>n(!1),0));const s=Vs(e.sidx.resolvedUri),a=(r,s)=>{if(this.requestErrored_(r,s,t))return;const a=this.mainPlaylistLoader_.sidxMapping_,{requestType:o}=s;let l;try{l=_()(Object(v["k"])(s.response).subarray(8))}catch(e){return e.metadata=Ha({requestType:o,request:s,parseFailure:!0}),void this.requestErrored_(e,s,t)}return a[i]={sidxInfo:e.sidx,sidx:l},Object(y["a"])(e,l,e.sidx.resolvedUri),n(!0)},o="dash-sidx";this.request=Po(s,this.vhs_.xhr,(t,n,i,r)=>{if(t)return a(t,n);if(!i||"mp4"!==i){const t=i||"unknown";return a({status:n.status,message:`Unsupported ${t} container type for sidx segment at URL: ${s}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},n)}const{offset:o,length:l}=e.sidx.byterange;if(r.length>=l+o)return a(t,{response:r.subarray(o,o+l),status:n.status,uri:n.uri});this.request=this.vhs_.xhr({uri:s,responseType:"arraybuffer",requestType:"dash-sidx",headers:fo({byterange:e.sidx.byterange})},a)},o)}dispose(){this.isPaused_=!0,this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},r.a.clearTimeout(this.minimumUpdatePeriodTimeout_),r.a.clearTimeout(this.mediaRequest_),r.a.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if("string"===typeof e){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList)return this.state="HAVE_METADATA",this.media_=e,void(n&&(this.trigger("mediachanging"),this.trigger("mediachange")));n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,n=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,r.a.clearTimeout(this.mediaRequest_),this.mediaRequest_=null,this.refreshMedia_(t.id),"HAVE_MAIN_MANIFEST"===e?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.isPaused_=!0,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),r.a.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(r.a.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),"HAVE_NOTHING"===this.state&&(this.started=!1)}load(e){this.isPaused_=!1,r.a.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const e=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=r.a.setTimeout(()=>this.load(),e)}else this.started?t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist"):this.start()}start(){if(this.started=!0,!this.isMain_)return r.a.clearTimeout(this.mediaRequest_),void(this.mediaRequest_=r.a.setTimeout(()=>this.haveMain_(),0));this.requestMain_((e,t)=>{this.haveMain_(),this.hasPendingRequest()||this.media_||this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){const t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestrequeststart",metadata:t}),this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(n,i)=>{if(n){const{requestType:e}=i;n.metadata=Ha({requestType:e,request:i,error:n})}if(this.requestErrored_(n,i))return void("HAVE_NOTHING"===this.state&&(this.started=!1));this.trigger({type:"manifestrequestcomplete",metadata:t});const r=i.responseText!==this.mainPlaylistLoader_.mainXml_;return this.mainPlaylistLoader_.mainXml_=i.responseText,i.responseHeaders&&i.responseHeaders.date?this.mainLoaded_=Date.parse(i.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=Vs(this.mainPlaylistLoader_.srcUrl,i),r?(this.handleMain_(),void this.syncClientServerClock_(()=>{return e(i,r)})):e(i,r)})}syncClientServerClock_(e){const t=Object(y["d"])(this.mainPlaylistLoader_.mainXml_);return null===t?(this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()):"DIRECT"===t.method?(this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e()):void(this.request=this.vhs_.xhr({uri:js(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(n,i)=>{if(!this.request)return;if(n){const{requestType:t}=i;return this.error.metadata=Ha({requestType:t,request:i,error:n}),this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()}let r;r="HEAD"===t.method?i.responseHeaders&&i.responseHeaders.date?Date.parse(i.responseHeaders.date):this.mainLoaded_:Date.parse(i.responseText),this.mainPlaylistLoader_.clientOffset_=r-Date.now(),e()}))}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){r.a.clearTimeout(this.mediaRequest_),this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main,t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};let n;this.trigger({type:"manifestparsestart",metadata:t});try{n=Fo({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e})}catch(e){this.error=e,this.error.metadata={errorType:Ps.Error.StreamingDashManifestParserError,error:e},this.trigger("error")}e&&(n=jo(e,n,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=n||e;const i=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];if(i&&i!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=i),(!e||n&&n.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(n),n){const{duration:e,endList:i}=n,r=[];n.playlists.forEach(e=>{r.push({id:e.id,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS})});const s={duration:e,isLive:!i,renditions:r};t.parsedManifest=s,this.trigger({type:"manifestparsecomplete",metadata:t})}return Boolean(n)}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(r.a.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;0===t&&(e.media()?t=1e3*e.media().targetDuration:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),"number"!==typeof t||t<=0?t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`):this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=r.a.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=$o(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,e=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==t[e];if(n?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const e=()=>{this.media().endList||(this.mediaUpdateTimeout=r.a.setTimeout(()=>{this.trigger("mediaupdatetimeout"),e()},ro(this.media(),Boolean(n))))};e()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const e=this.mainPlaylistLoader_.main.eventStream.map(e=>{return{cueTime:e.start,frames:[{data:e.messageData}]}});this.addMetadataToTextTrack("EventStream",e,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const i=e.contentProtection[n].attributes["cenc:default_KID"];i&&t.add(i.replace(/-/g,"").toLowerCase())}return t}}}var zo={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const qo=e=>{const t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t.buffer},Wo=function(e){return e.on=e.addEventListener,e.off=e.removeEventListener,e},Ko=function(e){try{return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(t){const n=new BlobBuilder;return n.append(e),URL.createObjectURL(n.getBlob())}},Yo=function(e){return function(){const t=Ko(e),n=Wo(new Worker(t));n.objURL=t;const i=n.terminate;return n.on=n.addEventListener,n.off=n.removeEventListener,n.terminate=function(){return URL.revokeObjectURL(t),i.call(this)},n}},Xo=function(e){return`var browserWorkerPolyFill = ${Wo.toString()};\n`+"browserWorkerPolyFill(self);\n"+e},Qo=function(e){return e.toString().replace(/^function.+?{/,"").slice(0,-1)},Zo=Xo(Qo(function(){var t="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof e?e:"undefined"!==typeof self?self:{},n=function(){this.init=function(){var e={};this.on=function(t,n){e[t]||(e[t]=[]),e[t]=e[t].concat(n)},this.off=function(t,n){var i;return!!e[t]&&(i=e[t].indexOf(n),e[t]=e[t].slice(),e[t].splice(i,1),i>-1)},this.trigger=function(t){var n,i,r,s;if(n=e[t],n)if(2===arguments.length)for(r=n.length,i=0;i<r;++i)n[i].call(this,arguments[1]);else{for(s=[],i=arguments.length,i=1;i<arguments.length;++i)s.push(arguments[i]);for(r=n.length,i=0;i<r;++i)n[i].apply(this,s)}},this.dispose=function(){e={}}}};n.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),this.on("partialdone",function(t){e.partialFlush(t)}),this.on("endedtimeline",function(t){e.endTimeline(t)}),this.on("reset",function(t){e.reset(t)}),e},n.prototype.push=function(e){this.trigger("data",e)},n.prototype.flush=function(e){this.trigger("done",e)},n.prototype.partialFlush=function(e){this.trigger("partialdone",e)},n.prototype.endTimeline=function(e){this.trigger("endedtimeline",e)},n.prototype.reset=function(e){this.trigger("reset",e)};var i,r,s,a,o,l,u,c,d,h,f,p,g,m,v,y,b,_,T,S,w,E,x,k,A,I,C,D,R,M,L,P,O,N,U,F,B=n,j=Math.pow(2,32),V=function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getBigUint64?(t=n.getBigUint64(0),t<Number.MAX_SAFE_INTEGER?Number(t):t):n.getUint32(0)*j+n.getUint32(4)},H={getUint64:V,MAX_UINT32:j},$=H.MAX_UINT32;(function(){var e;if(x={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!==typeof Uint8Array){for(e in x)x.hasOwnProperty(e)&&(x[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);k=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),I=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),A=new Uint8Array([0,0,0,1]),C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),R={video:C,audio:D},P=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),L=new Uint8Array([0,0,0,0,0,0,0,0]),O=new Uint8Array([0,0,0,0,0,0,0,0]),N=O,U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),F=O,M=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),i=function(e){var t,n,i,r=[],s=0;for(t=1;t<arguments.length;t++)r.push(arguments[t]);t=r.length;while(t--)s+=r[t].byteLength;for(n=new Uint8Array(s+8),i=new DataView(n.buffer,n.byteOffset,n.byteLength),i.setUint32(0,n.byteLength),n.set(e,4),t=0,s=8;t<r.length;t++)n.set(r[t],s),s+=r[t].byteLength;return n},r=function(){return i(x.dinf,i(x.dref,P))},s=function(e){return i(x.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},a=function(){return i(x.ftyp,k,A,k,I)},y=function(e){return i(x.hdlr,R[e])},o=function(e){return i(x.mdat,e)},v=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=255&e.samplerate),i(x.mdhd,t)},m=function(e){return i(x.mdia,v(e),y(e.type),u(e))},l=function(e){return i(x.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},u=function(e){return i(x.minf,"video"===e.type?i(x.vmhd,M):i(x.smhd,L),r(),_(e))},c=function(e,t){var n=[],r=t.length;while(r--)n[r]=S(t[r]);return i.apply(null,[x.moof,l(e)].concat(n))},d=function(e){var t=e.length,n=[];while(t--)n[t]=p(e[t]);return i.apply(null,[x.moov,f(4294967295)].concat(n).concat(h(e)))},h=function(e){var t=e.length,n=[];while(t--)n[t]=w(e[t]);return i.apply(null,[x.mvex].concat(n))},f=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return i(x.mvhd,t)},b=function(e){var t,n,r=e.samples||[],s=new Uint8Array(4+r.length);for(n=0;n<r.length;n++)t=r[n].flags,s[n+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return i(x.sdtp,s)},_=function(e){return i(x.stbl,T(e),i(x.stts,F),i(x.stsc,N),i(x.stsz,U),i(x.stco,O))},function(){var e,t;T=function(n){return i(x.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===n.type?e(n):t(n))},e=function(e){var t,n,r=e.sps||[],s=e.pps||[],a=[],o=[];for(t=0;t<r.length;t++)a.push((65280&r[t].byteLength)>>>8),a.push(255&r[t].byteLength),a=a.concat(Array.prototype.slice.call(r[t]));for(t=0;t<s.length;t++)o.push((65280&s[t].byteLength)>>>8),o.push(255&s[t].byteLength),o=o.concat(Array.prototype.slice.call(s[t]));if(n=[x.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i(x.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([r.length],a,[s.length],o))),i(x.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],e.sarRatio){var l=e.sarRatio[0],u=e.sarRatio[1];n.push(i(x.pasp,new Uint8Array([(4278190080&l)>>24,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u])))}return i.apply(null,n)},t=function(e){return i(x.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),s(e))}}(),g=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return i(x.tkhd,t)},S=function(e){var t,n,r,s,a,o,l;return t=i(x.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),o=Math.floor(e.baseMediaDecodeTime/$),l=Math.floor(e.baseMediaDecodeTime%$),n=i(x.tfdt,new Uint8Array([1,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,255&o,l>>>24&255,l>>>16&255,l>>>8&255,255&l])),a=92,"audio"===e.type?(r=E(e,a),i(x.traf,t,n,r)):(s=b(e),r=E(e,s.length+a),i(x.traf,t,n,r,s))},p=function(e){return e.duration=e.duration||4294967295,i(x.trak,g(e),m(e))},w=function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(t[t.length-1]=0),i(x.trex,t)},function(){var e,t,n;n=function(e,t){var n=0,i=0,r=0,s=0;return e.length&&(void 0!==e[0].duration&&(n=1),void 0!==e[0].size&&(i=2),void 0!==e[0].flags&&(r=4),void 0!==e[0].compositionTimeOffset&&(s=8)),[0,0,n|i|r|s,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},t=function(e,t){var r,s,a,o,l,u;for(o=e.samples||[],t+=20+16*o.length,a=n(o,t),s=new Uint8Array(a.length+16*o.length),s.set(a),r=a.length,u=0;u<o.length;u++)l=o[u],s[r++]=(4278190080&l.duration)>>>24,s[r++]=(16711680&l.duration)>>>16,s[r++]=(65280&l.duration)>>>8,s[r++]=255&l.duration,s[r++]=(4278190080&l.size)>>>24,s[r++]=(16711680&l.size)>>>16,s[r++]=(65280&l.size)>>>8,s[r++]=255&l.size,s[r++]=l.flags.isLeading<<2|l.flags.dependsOn,s[r++]=l.flags.isDependedOn<<6|l.flags.hasRedundancy<<4|l.flags.paddingValue<<1|l.flags.isNonSyncSample,s[r++]=61440&l.flags.degradationPriority,s[r++]=15&l.flags.degradationPriority,s[r++]=(4278190080&l.compositionTimeOffset)>>>24,s[r++]=(16711680&l.compositionTimeOffset)>>>16,s[r++]=(65280&l.compositionTimeOffset)>>>8,s[r++]=255&l.compositionTimeOffset;return i(x.trun,s)},e=function(e,t){var r,s,a,o,l,u;for(o=e.samples||[],t+=20+8*o.length,a=n(o,t),r=new Uint8Array(a.length+8*o.length),r.set(a),s=a.length,u=0;u<o.length;u++)l=o[u],r[s++]=(4278190080&l.duration)>>>24,r[s++]=(16711680&l.duration)>>>16,r[s++]=(65280&l.duration)>>>8,r[s++]=255&l.duration,r[s++]=(4278190080&l.size)>>>24,r[s++]=(16711680&l.size)>>>16,r[s++]=(65280&l.size)>>>8,r[s++]=255&l.size;return i(x.trun,r)},E=function(n,i){return"audio"===n.type?e(n,i):t(n,i)}}();var G,z,q,W,K,Y,X,Q,Z={ftyp:a,mdat:o,moof:c,moov:d,initSegment:function(e){var t,n=a(),i=d(e);return t=new Uint8Array(n.byteLength+i.byteLength),t.set(n),t.set(i,n.byteLength),t}},J=function(e){var t,n,i=[],r=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,i.byteLength=0,t=0;t<e.length;t++)n=e[t],"access_unit_delimiter_rbsp"===n.nalUnitType?(i.length&&(i.duration=n.dts-i.dts,r.byteLength+=i.byteLength,r.nalCount+=i.length,r.duration+=i.duration,r.push(i)),i=[n],i.byteLength=n.data.byteLength,i.pts=n.pts,i.dts=n.dts):("slice_layer_without_partitioning_rbsp_idr"===n.nalUnitType&&(i.keyFrame=!0),i.duration=n.dts-i.dts,i.byteLength+=n.data.byteLength,i.push(n));return r.length&&(!i.duration||i.duration<=0)&&(i.duration=r[r.length-1].duration),r.byteLength+=i.byteLength,r.nalCount+=i.length,r.duration+=i.duration,r.push(i),r},ee=function(e){var t,n,i=[],r=[];for(i.byteLength=0,i.nalCount=0,i.duration=0,i.pts=e[0].pts,i.dts=e[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,t=0;t<e.length;t++)n=e[t],n.keyFrame?(i.length&&(r.push(i),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.duration+=i.duration),i=[n],i.nalCount=n.length,i.byteLength=n.byteLength,i.pts=n.pts,i.dts=n.dts,i.duration=n.duration):(i.duration+=n.duration,i.nalCount+=n.length,i.byteLength+=n.byteLength,i.push(n));return r.length&&i.duration<=0&&(i.duration=r[r.length-1].duration),r.byteLength+=i.byteLength,r.nalCount+=i.nalCount,r.duration+=i.duration,r.push(i),r},te=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},ne=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},ie=function(e,t){var n=ne();return n.dataOffset=t,n.compositionTimeOffset=e.pts-e.dts,n.duration=e.duration,n.size=4*e.length,n.size+=e.byteLength,e.keyFrame&&(n.flags.dependsOn=2,n.flags.isNonSyncSample=0),n},re=function(e,t){var n,i,r,s,a,o=t||0,l=[];for(n=0;n<e.length;n++)for(s=e[n],i=0;i<s.length;i++)a=s[i],r=ie(a,o),o+=r.size,l.push(r);return l},se=function(e){var t,n,i,r,s,a,o=0,l=e.byteLength,u=e.nalCount,c=l+4*u,d=new Uint8Array(c),h=new DataView(d.buffer);for(t=0;t<e.length;t++)for(r=e[t],n=0;n<r.length;n++)for(s=r[n],i=0;i<s.length;i++)a=s[i],h.setUint32(o,a.data.byteLength),o+=4,d.set(a.data,o),o+=a.data.byteLength;return d},ae=function(e,t){var n,i=t||0,r=[];return n=ie(e,i),r.push(n),r},oe=function(e){var t,n,i=0,r=e.byteLength,s=e.length,a=r+4*s,o=new Uint8Array(a),l=new DataView(o.buffer);for(t=0;t<e.length;t++)n=e[t],l.setUint32(i,n.data.byteLength),i+=4,o.set(n.data,i),i+=n.data.byteLength;return o},le={groupNalsIntoFrames:J,groupFramesIntoGops:ee,extendFirstKeyFrame:te,generateSampleTable:re,concatenateNalData:se,generateSampleTableForFrame:ae,concatenateNalDataForFrame:oe},ue=[33,16,5,32,164,27],ce=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],de=function(e){var t=[];while(e--)t.push(0);return t},he=function(e){return Object.keys(e).reduce(function(t,n){return t[n]=new Uint8Array(e[n].reduce(function(e,t){return e.concat(t)},[])),t},{})},fe=function(){if(!G){var e={96000:[ue,[227,64],de(154),[56]],88200:[ue,[231],de(170),[56]],64000:[ue,[248,192],de(240),[56]],48000:[ue,[255,192],de(268),[55,148,128],de(54),[112]],44100:[ue,[255,192],de(268),[55,163,128],de(84),[112]],32000:[ue,[255,192],de(268),[55,234],de(226),[112]],24000:[ue,[255,192],de(268),[55,255,128],de(268),[111,112],de(126),[224]],16000:[ue,[255,192],de(268),[55,255,128],de(268),[111,255],de(269),[223,108],de(195),[1,192]],12000:[ce,de(268),[3,127,248],de(268),[6,255,240],de(268),[13,255,224],de(268),[27,253,128],de(259),[56]],11025:[ce,de(268),[3,127,248],de(268),[6,255,240],de(268),[13,255,224],de(268),[27,255,192],de(268),[55,175,128],de(108),[112]],8000:[ce,de(268),[3,121,16],de(47),[7]]};G=he(e)}return G},pe=9e4;z=function(e){return e*pe},q=function(e,t){return e*t},W=function(e){return e/pe},K=function(e,t){return e/t},Y=function(e,t){return z(K(e,t))},X=function(e,t){return q(W(e),t)},Q=function(e,t,n){return W(n?e:e-t)};var ge={ONE_SECOND_IN_TS:pe,secondsToVideoTs:z,secondsToAudioTs:q,videoTsToSeconds:W,audioTsToSeconds:K,audioTsToVideoTs:Y,videoTsToAudioTs:X,metadataTsToSeconds:Q},me=fe,ve=ge,ye=function(e){var t,n,i=0;for(t=0;t<e.length;t++)n=e[t],i+=n.data.byteLength;return i},be=function(e,t,n,i){var r,s,a,o,l=0,u=0,c=0,d=0;if(t.length&&(r=ve.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),l=Math.ceil(ve.ONE_SECOND_IN_TS/(e.samplerate/1024)),n&&i&&(u=r-Math.max(n,i),c=Math.floor(u/l),d=c*l),!(c<1||d>ve.ONE_SECOND_IN_TS/2))){for(s=me()[e.samplerate],s||(s=t[0].data),a=0;a<c;a++)o=t[0],t.splice(0,0,{data:s,dts:o.dts-l,pts:o.pts-l});return e.baseMediaDecodeTime-=Math.floor(ve.videoTsToAudioTs(d,e.samplerate)),d}},_e=function(e,t,n){return t.minSegmentDts>=n?e:(t.minSegmentDts=1/0,e.filter(function(e){return e.dts>=n&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)}))},Te=function(e){var t,n,i=[];for(t=0;t<e.length;t++)n=e[t],i.push({size:n.data.byteLength,duration:1024});return i},Se=function(e){var t,n,i=0,r=new Uint8Array(ye(e));for(t=0;t<e.length;t++)n=e[t],r.set(n.data,i),i+=n.data.byteLength;return r},we={prefixWithSilence:be,trimAdtsFramesByEarliestDts:_e,generateSampleTable:Te,concatenateFrameData:Se},Ee=ge.ONE_SECOND_IN_TS,xe=function(e,t){"number"===typeof t.pts&&(void 0===e.timelineStartInfo.pts&&(e.timelineStartInfo.pts=t.pts),void 0===e.minSegmentPts?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),void 0===e.maxSegmentPts?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),"number"===typeof t.dts&&(void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),void 0===e.minSegmentDts?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),void 0===e.maxSegmentDts?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))},ke=function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},Ae=function(e,t){var n,i,r=e.minSegmentDts;return t||(r-=e.timelineStartInfo.dts),n=e.timelineStartInfo.baseMediaDecodeTime,n+=r,n=Math.max(0,n),"audio"===e.type&&(i=e.samplerate/Ee,n*=i,n=Math.floor(n)),n},Ie={clearDtsInfo:ke,calculateTrackBaseMediaDecodeTime:Ae,collectDtsInfo:xe},Ce=4,De=128,Re=function(e){var t=0,n={payloadType:-1,payloadSize:0},i=0,r=0;while(t<e.byteLength){if(e[t]===De)break;while(255===e[t])i+=255,t++;i+=e[t++];while(255===e[t])r+=255,t++;if(r+=e[t++],!n.payload&&i===Ce){var s=String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6]);if("GA94"===s){n.payloadType=i,n.payloadSize=r,n.payload=e.subarray(t,t+r);break}n.payload=void 0}t+=r,i=0,r=0}return n},Me=function(e){return 181!==e.payload[0]?null:49!==(e.payload[1]<<8|e.payload[2])?null:"GA94"!==String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])?null:3!==e.payload[7]?null:e.payload.subarray(8,e.payload.length-1)},Le=function(e,t){var n,i,r,s,a=[];if(!(64&t[0]))return a;for(i=31&t[0],n=0;n<i;n++)r=3*n,s={type:3&t[r+2],pts:e},4&t[r+2]&&(s.ccData=t[r+3]<<8|t[r+4],a.push(s));return a},Pe=function(e){var t,n,i=e.byteLength,r=[],s=1;while(s<i-2)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),n[s]=e[a];return n},Oe={parseSei:Re,parseUserData:Me,parseCaptionPackets:Le,discardEmulationPreventionBytes:Pe,USER_DATA_REGISTERED_ITU_T_T35:Ce},Ne=B,Ue=Oe,Fe=function(e){e=e||{},Fe.prototype.init.call(this),this.parse708captions_="boolean"!==typeof e.parse708captions||e.parse708captions,this.captionPackets_=[],this.ccStreams_=[new Xe(0,0),new Xe(0,1),new Xe(1,0),new Xe(1,1)],this.parse708captions_&&(this.cc708Stream_=new Ge({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};Fe.prototype=new Ne,Fe.prototype.push=function(e){var t,n,i;if("sei_rbsp"===e.nalUnitType&&(t=Ue.parseSei(e.escapedRBSP),t.payload&&t.payloadType===Ue.USER_DATA_REGISTERED_ITU_T_T35&&(n=Ue.parseUserData(t),n)))if(e.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));i=Ue.parseCaptionPackets(e.pts,n),this.captionPackets_=this.captionPackets_.concat(i),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts}},Fe.prototype.flushCCStreams=function(e){this.ccStreams_.forEach(function(t){return"flush"===e?t.flush():t.partialFlush()},this)},Fe.prototype.flushStream=function(e){this.captionPackets_.length?(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(e)):this.flushCCStreams(e)},Fe.prototype.flush=function(){return this.flushStream("flush")},Fe.prototype.partialFlush=function(){return this.flushStream("partialFlush")},Fe.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},Fe.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1),null!==this.activeCea608Channel_[e.type]&&this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},Fe.prototype.setsChannel1Active=function(e){return 4096===(30720&e.ccData)},Fe.prototype.setsChannel2Active=function(e){return 6144===(30720&e.ccData)},Fe.prototype.setsTextOrXDSActive=function(e){return 256===(28928&e.ccData)||4138===(30974&e.ccData)||6186===(30974&e.ccData)},Fe.prototype.dispatchCea708Packet=function(e){this.parse708captions_&&this.cc708Stream_.push(e)};var Be={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},je=function(e){var t=Be[e]||e;return 4096&e&&e===t?"":String.fromCharCode(t)},Ve=function(e){return 32<=e&&e<=127||160<=e&&e<=255},He=function(e){this.windowNum=e,this.reset()};He.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},He.prototype.getText=function(){return this.rows.join("\n")},He.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},He.prototype.newLine=function(e){this.rows.length>=this.virtualRowCount&&"function"===typeof this.beforeRowOverflow&&this.beforeRowOverflow(e),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);while(this.rows.length>this.virtualRowCount)this.rows.shift(),this.rowIdx--},He.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},He.prototype.addText=function(e){this.rows[this.rowIdx]+=e},He.prototype.backspace=function(){if(!this.isEmpty()){var e=this.rows[this.rowIdx];this.rows[this.rowIdx]=e.substr(0,e.length-1)}};var $e=function(e,t,n){this.serviceNum=e,this.text="",this.currentWindow=new He(-1),this.windows=[],this.stream=n,"string"===typeof t&&this.createTextDecoder(t)};$e.prototype.init=function(e,t){this.startPts=e;for(var n=0;n<8;n++)this.windows[n]=new He(n),"function"===typeof t&&(this.windows[n].beforeRowOverflow=t)},$e.prototype.setCurrentWindow=function(e){this.currentWindow=this.windows[e]},$e.prototype.createTextDecoder=function(e){if("undefined"===typeof TextDecoder)this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(e)}catch(t){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+e+" encoding. "+t})}};var Ge=function(e){e=e||{},Ge.prototype.init.call(this);var t,n=this,i=e.captionServices||{},r={};Object.keys(i).forEach(e=>{t=i[e],/^SERVICE/.test(e)&&(r[e]=t.encoding)}),this.serviceEncodings=r,this.current708Packet=null,this.services={},this.push=function(e){3===e.type?(n.new708Packet(),n.add708Bytes(e)):(null===n.current708Packet&&n.new708Packet(),n.add708Bytes(e))}};Ge.prototype=new Ne,Ge.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},Ge.prototype.add708Bytes=function(e){var t=e.ccData,n=t>>>8,i=255&t;this.current708Packet.ptsVals.push(e.pts),this.current708Packet.data.push(n),this.current708Packet.data.push(i)},Ge.prototype.push708Packet=function(){var e=this.current708Packet,t=e.data,n=null,i=null,r=0,s=t[r++];for(e.seq=s>>6,e.sizeCode=63&s;r<t.length;r++)s=t[r++],n=s>>5,i=31&s,7===n&&i>0&&(s=t[r++],n=s),this.pushServiceBlock(n,r,i),i>0&&(r+=i-1)},Ge.prototype.pushServiceBlock=function(e,t,n){var i,r=t,s=this.current708Packet.data,a=this.services[e];for(a||(a=this.initService(e,r));r<t+n&&r<s.length;r++)i=s[r],Ve(i)?r=this.handleText(r,a):24===i?r=this.multiByteCharacter(r,a):16===i?r=this.extendedCommands(r,a):128<=i&&i<=135?r=this.setCurrentWindow(r,a):152<=i&&i<=159?r=this.defineWindow(r,a):136===i?r=this.clearWindows(r,a):140===i?r=this.deleteWindows(r,a):137===i?r=this.displayWindows(r,a):138===i?r=this.hideWindows(r,a):139===i?r=this.toggleWindows(r,a):151===i?r=this.setWindowAttributes(r,a):144===i?r=this.setPenAttributes(r,a):145===i?r=this.setPenColor(r,a):146===i?r=this.setPenLocation(r,a):143===i?a=this.reset(r,a):8===i?a.currentWindow.backspace():12===i?a.currentWindow.clearText():13===i?a.currentWindow.pendingNewLine=!0:14===i?a.currentWindow.clearText():141===i&&r++},Ge.prototype.extendedCommands=function(e,t){var n=this.current708Packet.data,i=n[++e];return Ve(i)&&(e=this.handleText(e,t,{isExtended:!0})),e},Ge.prototype.getPts=function(e){return this.current708Packet.ptsVals[Math.floor(e/2)]},Ge.prototype.initService=function(e,t){var n,i="SERVICE"+e,r=this;return i in this.serviceEncodings&&(n=this.serviceEncodings[i]),this.services[e]=new $e(e,n,r),this.services[e].init(this.getPts(t),function(t){r.flushDisplayed(t,r.services[e])}),this.services[e]},Ge.prototype.handleText=function(e,t,n){var i,r,s=n&&n.isExtended,a=n&&n.isMultiByte,o=this.current708Packet.data,l=s?4096:0,u=o[e],c=o[e+1],d=t.currentWindow;function h(e){return e.map(e=>{return("0"+(255&e).toString(16)).slice(-2)}).join("")}if(a?(r=[u,c],e++):r=[u],t.textDecoder_&&!s)i=t.textDecoder_.decode(new Uint8Array(r));else if(a){const e=h(r);i=String.fromCharCode(parseInt(e,16))}else i=je(l|u);return d.pendingNewLine&&!d.isEmpty()&&d.newLine(this.getPts(e)),d.pendingNewLine=!1,d.addText(i),e},Ge.prototype.multiByteCharacter=function(e,t){var n=this.current708Packet.data,i=n[e+1],r=n[e+2];return Ve(i)&&Ve(r)&&(e=this.handleText(++e,t,{isMultiByte:!0})),e},Ge.prototype.setCurrentWindow=function(e,t){var n=this.current708Packet.data,i=n[e],r=7&i;return t.setCurrentWindow(r),e},Ge.prototype.defineWindow=function(e,t){var n=this.current708Packet.data,i=n[e],r=7&i;t.setCurrentWindow(r);var s=t.currentWindow;return i=n[++e],s.visible=(32&i)>>5,s.rowLock=(16&i)>>4,s.columnLock=(8&i)>>3,s.priority=7&i,i=n[++e],s.relativePositioning=(128&i)>>7,s.anchorVertical=127&i,i=n[++e],s.anchorHorizontal=i,i=n[++e],s.anchorPoint=(240&i)>>4,s.rowCount=15&i,i=n[++e],s.columnCount=63&i,i=n[++e],s.windowStyle=(56&i)>>3,s.penStyle=7&i,s.virtualRowCount=s.rowCount+1,e},Ge.prototype.setWindowAttributes=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.winAttr;return i=n[++e],r.fillOpacity=(192&i)>>6,r.fillRed=(48&i)>>4,r.fillGreen=(12&i)>>2,r.fillBlue=3&i,i=n[++e],r.borderType=(192&i)>>6,r.borderRed=(48&i)>>4,r.borderGreen=(12&i)>>2,r.borderBlue=3&i,i=n[++e],r.borderType+=(128&i)>>5,r.wordWrap=(64&i)>>6,r.printDirection=(48&i)>>4,r.scrollDirection=(12&i)>>2,r.justify=3&i,i=n[++e],r.effectSpeed=(240&i)>>4,r.effectDirection=(12&i)>>2,r.displayEffect=3&i,e},Ge.prototype.flushDisplayed=function(e,t){for(var n=[],i=0;i<8;i++)t.windows[i].visible&&!t.windows[i].isEmpty()&&n.push(t.windows[i].getText());t.endPts=e,t.text=n.join("\n\n"),this.pushCaption(t),t.startPts=e},Ge.prototype.pushCaption=function(e){""!==e.text&&(this.trigger("data",{startPts:e.startPts,endPts:e.endPts,text:e.text,stream:"cc708_"+e.serviceNum}),e.text="",e.startPts=e.endPts)},Ge.prototype.displayWindows=function(e,t){var n=this.current708Packet.data,i=n[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var s=0;s<8;s++)i&1<<s&&(t.windows[s].visible=1);return e},Ge.prototype.hideWindows=function(e,t){var n=this.current708Packet.data,i=n[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var s=0;s<8;s++)i&1<<s&&(t.windows[s].visible=0);return e},Ge.prototype.toggleWindows=function(e,t){var n=this.current708Packet.data,i=n[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var s=0;s<8;s++)i&1<<s&&(t.windows[s].visible^=1);return e},Ge.prototype.clearWindows=function(e,t){var n=this.current708Packet.data,i=n[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var s=0;s<8;s++)i&1<<s&&t.windows[s].clearText();return e},Ge.prototype.deleteWindows=function(e,t){var n=this.current708Packet.data,i=n[++e],r=this.getPts(e);this.flushDisplayed(r,t);for(var s=0;s<8;s++)i&1<<s&&t.windows[s].reset();return e},Ge.prototype.setPenAttributes=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.penAttr;return i=n[++e],r.textTag=(240&i)>>4,r.offset=(12&i)>>2,r.penSize=3&i,i=n[++e],r.italics=(128&i)>>7,r.underline=(64&i)>>6,r.edgeType=(56&i)>>3,r.fontStyle=7&i,e},Ge.prototype.setPenColor=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.penColor;return i=n[++e],r.fgOpacity=(192&i)>>6,r.fgRed=(48&i)>>4,r.fgGreen=(12&i)>>2,r.fgBlue=3&i,i=n[++e],r.bgOpacity=(192&i)>>6,r.bgRed=(48&i)>>4,r.bgGreen=(12&i)>>2,r.bgBlue=3&i,i=n[++e],r.edgeRed=(48&i)>>4,r.edgeGreen=(12&i)>>2,r.edgeBlue=3&i,e},Ge.prototype.setPenLocation=function(e,t){var n=this.current708Packet.data,i=n[e],r=t.currentWindow.penLoc;return t.currentWindow.pendingNewLine=!0,i=n[++e],r.row=15&i,i=n[++e],r.column=63&i,e},Ge.prototype.reset=function(e,t){var n=this.getPts(e);return this.flushDisplayed(n,t),this.initService(t.serviceNum,e)};var ze={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},qe=function(e){return null===e?"":(e=ze[e]||e,String.fromCharCode(e))},We=14,Ke=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Ye=function(){var e=[],t=We+1;while(t--)e.push({text:"",indent:0,offset:0});return e},Xe=function(e,t){Xe.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(e){var t,n,i,r,s;if(t=32639&e.ccData,t!==this.lastControlCode_){if(4096===(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),i=t>>>8,r=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),n=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=n,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=Ye();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Ye();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=Ye()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(i,r))i=(3&i)<<8,s=qe(i|r),this[this.mode_](e.pts,s),this.column_++;else if(this.isExtCharacter(i,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),i=(3&i)<<8,s=qe(i|r),this[this.mode_](e.pts,s),this.column_++;else if(this.isMidRowCode(i,r))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14===(14&r)&&this.addFormatting(e.pts,["i"]),1===(1&r)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(i,r)){const e=3&r;this.nonDisplayed_[this.row_].offset=e,this.column_+=e}else if(this.isPAC(i,r)){var a=Ke.indexOf(7968&t);if("rollUp"===this.mode_&&(a-this.rollUpRows_+1<0&&(a=this.rollUpRows_-1),this.setRollUp(e.pts,a)),a!==this.row_&&a>=0&&a<=14&&(this.clearFormatting(e.pts),this.row_=a),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16===(16&t)){const e=(14&t)>>1;this.column_=4*e,this.nonDisplayed_[this.row_].indent+=e}this.isColorPAC(r)&&14===(14&r)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(i)&&(0===r&&(r=null),s=qe(i),s+=qe(r),this[this.mode_](e.pts,s),this.column_+=s.length)}else this.lastControlCode_=null}};Xe.prototype=new Ne,Xe.prototype.flushDisplayed=function(e){const t=e=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+e+"."})},n=[];this.displayed_.forEach((e,i)=>{if(e&&e.text&&e.text.length){try{e.text=e.text.trim()}catch(e){t(i)}e.text.length&&n.push({text:e.text,line:i+1,position:10+Math.min(70,10*e.indent)+2.5*e.offset})}else void 0!==e&&null!==e||t(i)}),n.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,content:n,stream:this.name_})},Xe.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Ye(),this.nonDisplayed_=Ye(),this.lastControlCode_=null,this.column_=0,this.row_=We,this.rollUpRows_=2,this.formatting_=[]},Xe.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Xe.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63},Xe.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&t>=32&&t<=63},Xe.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&t>=32&&t<=47},Xe.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&t>=33&&t<=35},Xe.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&t>=64&&t<=127},Xe.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127},Xe.prototype.isNormalChar=function(e){return e>=32&&e<=127},Xe.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=We,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=Ye(),this.displayed_=Ye()),void 0!==t&&t!==this.row_)for(var n=0;n<this.rollUpRows_;n++)this.displayed_[t-n]=this.displayed_[this.row_-n],this.displayed_[this.row_-n]={text:"",indent:0,offset:0};void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},Xe.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var n=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,n)},Xe.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},Xe.prototype.popOn=function(e,t){var n=this.nonDisplayed_[this.row_].text;n+=t,this.nonDisplayed_[this.row_].text=n},Xe.prototype.rollUp=function(e,t){var n=this.displayed_[this.row_].text;n+=t,this.displayed_[this.row_].text=n},Xe.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]={text:"",indent:0,offset:0};for(e=this.row_+1;e<We+1;e++)this.displayed_[e]={text:"",indent:0,offset:0};for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},Xe.prototype.paintOn=function(e,t){var n=this.displayed_[this.row_].text;n+=t,this.displayed_[this.row_].text=n};var Qe={CaptionStream:Fe,Cea608Stream:Xe,Cea708Stream:Ge},Ze={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Je=B,et=8589934592,tt=4294967296,nt="shared",it=function(e,t){var n=1;e>t&&(n=-1);while(Math.abs(t-e)>tt)e+=n*et;return e},rt=function(e){var t,n;rt.prototype.init.call(this),this.type_=e||nt,this.push=function(e){"metadata"!==e.type?this.type_!==nt&&e.type!==this.type_||(void 0===n&&(n=e.dts),e.dts=it(e.dts,n),e.pts=it(e.pts,n),t=e.dts,this.trigger("data",e)):this.trigger("data",e)},this.flush=function(){n=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){n=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};rt.prototype=new Je;var st,at={TimestampRolloverStream:rt,handleRollover:it},ot=(e,t,n)=>{if(!e)return-1;for(var i=n;i<e.length;i++)if(e[i]===t)return i;return-1},lt={typedArrayIndexOf:ot},ut=lt.typedArrayIndexOf,ct={Iso88591:0,Utf16:1,Utf16be:2,Utf8:3},dt=function(e,t,n){var i,r="";for(i=t;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r},ht=function(e,t,n){return decodeURIComponent(dt(e,t,n))},ft=function(e,t,n){return unescape(dt(e,t,n))},pt=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},gt={APIC:function(e){var t,n,i=1,r="--\x3e";e.data[0]===ct.Utf8&&(t=ut(e.data,0,i),t<0||(e.mimeType=ft(e.data,i,t),i=t+1,e.pictureType=e.data[i],i++,n=ut(e.data,0,i),n<0||(e.description=ht(e.data,i,n),i=n+1,e.mimeType===r?e.url=ft(e.data,i,e.data.length):e.pictureData=e.data.subarray(i,e.data.length))))},"T*":function(e){e.data[0]===ct.Utf8&&(e.value=ht(e.data,1,e.data.length).replace(/\0*$/,""),e.values=e.value.split("\0"))},TXXX:function(e){var t;e.data[0]===ct.Utf8&&(t=ut(e.data,0,1),-1!==t&&(e.description=ht(e.data,1,t),e.value=ht(e.data,t+1,e.data.length).replace(/\0*$/,""),e.data=e.value))},"W*":function(e){e.url=ft(e.data,0,e.data.length).replace(/\0.*$/,"")},WXXX:function(e){var t;e.data[0]===ct.Utf8&&(t=ut(e.data,0,1),-1!==t&&(e.description=ht(e.data,1,t),e.url=ft(e.data,t+1,e.data.length).replace(/\0.*$/,"")))},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=ft(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},mt=function(e){var t,n,i=10,r=0,s=[];if(!(e.length<10||e[0]!=="I".charCodeAt(0)||e[1]!=="D".charCodeAt(0)||e[2]!=="3".charCodeAt(0))){r=pt(e.subarray(6,10)),r+=10;var a=64&e[5];a&&(i+=4,i+=pt(e.subarray(10,14)),r-=pt(e.subarray(16,20)));do{if(t=pt(e.subarray(i+4,i+8)),t<1)break;n=String.fromCharCode(e[i],e[i+1],e[i+2],e[i+3]);var o={id:n,data:e.subarray(i+10,i+t+10)};o.key=o.id,gt[o.id]?gt[o.id](o):"T"===o.id[0]?gt["T*"](o):"W"===o.id[0]&&gt["W*"](o),s.push(o),i+=10,i+=t}while(i<r);return s}},vt={parseId3Frames:mt,parseSyncSafeInteger:pt,frameParsers:gt},yt=B,bt=Ze,_t=vt;st=function(e){var t,n={descriptor:e&&e.descriptor},i=0,r=[],s=0;if(st.prototype.init.call(this),this.dispatchType=bt.METADATA_STREAM_TYPE.toString(16),n.descriptor)for(t=0;t<n.descriptor.length;t++)this.dispatchType+=("00"+n.descriptor[t].toString(16)).slice(-2);this.push=function(e){var t,n,a,o,l,u;if("timed-metadata"===e.type)if(e.dataAlignmentIndicator&&(s=0,r.length=0),0===r.length&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0)))this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});else if(r.push(e),s+=e.data.byteLength,1===r.length&&(i=_t.parseSyncSafeInteger(e.data.subarray(6,10)),i+=10),!(s<i)){for(t={data:new Uint8Array(i),frames:[],pts:r[0].pts,dts:r[0].dts},l=0;l<i;)t.data.set(r[0].data.subarray(0,i-l),l),l+=r[0].data.byteLength,s-=r[0].data.byteLength,r.shift();n=10,64&t.data[5]&&(n+=4,n+=_t.parseSyncSafeInteger(t.data.subarray(10,14)),i-=_t.parseSyncSafeInteger(t.data.subarray(16,20)));do{if(a=_t.parseSyncSafeInteger(t.data.subarray(n+4,n+8)),a<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(u=String.fromCharCode(t.data[n],t.data[n+1],t.data[n+2],t.data[n+3]),o={id:u,data:t.data.subarray(n+10,n+a+10)},o.key=o.id,_t.frameParsers[o.id]?_t.frameParsers[o.id](o):"T"===o.id[0]?_t.frameParsers["T*"](o):"W"===o.id[0]&&_t.frameParsers["W*"](o),"com.apple.streaming.transportStreamTimestamp"===o.owner){var c=o.data,d=(1&c[3])<<30|c[4]<<22|c[5]<<14|c[6]<<6|c[7]>>>2;d*=4,d+=3&c[7],o.timeStamp=d,void 0===t.pts&&void 0===t.dts&&(t.pts=o.timeStamp,t.dts=o.timeStamp),this.trigger("timestamp",o)}t.frames.push(o),n+=10,n+=a}while(n<i);this.trigger("data",t)}}},st.prototype=new yt;var Tt,St,wt,Et=st,xt=B,kt=Qe,At=Ze,It=at.TimestampRolloverStream,Ct=188,Dt=71;Tt=function(){var e=new Uint8Array(Ct),t=0;Tt.prototype.init.call(this),this.push=function(n){var i,r=0,s=Ct;t?(i=new Uint8Array(n.byteLength+t),i.set(e.subarray(0,t)),i.set(n,t),t=0):i=n;while(s<i.byteLength)i[r]!==Dt||i[s]!==Dt?(r++,s++):(this.trigger("data",i.subarray(r,s)),r+=Ct,s+=Ct);r<i.byteLength&&(e.set(i.subarray(r),0),t=i.byteLength-r)},this.flush=function(){t===Ct&&e[0]===Dt&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}},Tt.prototype=new xt,St=function(){var e,t,n,i;St.prototype.init.call(this),i=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,i){var r=0;i.payloadUnitStartIndicator&&(r+=e[r]+1),"pat"===i.type?t(e.subarray(r),i):n(e.subarray(r),i)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],i.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=i.pmtPid},n=function(e,t){var n,r,s,a;if(1&e[5]){i.programMapTable={video:null,audio:null,"timed-metadata":{}},n=(15&e[1])<<8|e[2],r=3+n-4,s=(15&e[10])<<8|e[11],a=12+s;while(a<r){var o=e[a],l=(31&e[a+1])<<8|e[a+2];o===At.H264_STREAM_TYPE&&null===i.programMapTable.video?i.programMapTable.video=l:o===At.ADTS_STREAM_TYPE&&null===i.programMapTable.audio?i.programMapTable.audio=l:o===At.METADATA_STREAM_TYPE&&(i.programMapTable["timed-metadata"][l]=o),a+=5+((15&e[a+3])<<8|e[a+4])}t.programMapTable=i.programMapTable}},this.push=function(t){var n={},i=4;if(n.payloadUnitStartIndicator=!!(64&t[1]),n.pid=31&t[1],n.pid<<=8,n.pid|=t[2],(48&t[3])>>>4>1&&(i+=t[i]+1),0===n.pid)n.type="pat",e(t.subarray(i),n),this.trigger("data",n);else if(n.pid===this.pmtPid){n.type="pmt",e(t.subarray(i),n),this.trigger("data",n);while(this.packetsWaitingForPmt.length)this.processPes_.apply(this,this.packetsWaitingForPmt.shift())}else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,i,n]):this.processPes_(t,i,n)},this.processPes_=function(e,t,n){n.pid===this.programMapTable.video?n.streamType=At.H264_STREAM_TYPE:n.pid===this.programMapTable.audio?n.streamType=At.ADTS_STREAM_TYPE:n.streamType=this.programMapTable["timed-metadata"][n.pid],n.type="pes",n.data=e.subarray(t),this.trigger("data",n)}},St.prototype=new xt,St.STREAM_TYPES={h264:27,adts:15},wt=function(){var e,t=this,n=!1,i={data:[],size:0},r={data:[],size:0},s={data:[],size:0},a=function(e,t){var n;const i=e[0]<<16|e[1]<<8|e[2];t.data=new Uint8Array,1===i&&(t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=0!==(4&e[6]),n=e[7],192&n&&(t.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,t.pts*=4,t.pts+=(6&e[13])>>>1,t.dts=t.pts,64&n&&(t.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,t.dts*=4,t.dts+=(6&e[18])>>>1)),t.data=e.subarray(9+e[8]))},o=function(e,n,i){var r,s=new Uint8Array(e.size),o={type:n},l=0,u=0,c=!1;if(e.data.length&&!(e.size<9)){for(o.trackId=e.data[0].pid,l=0;l<e.data.length;l++)r=e.data[l],s.set(r.data,u),u+=r.data.byteLength;a(s,o),c="video"===n||o.packetLength<=e.size,(i||c)&&(e.size=0,e.data.length=0),c&&t.trigger("data",o)}};wt.prototype.init.call(this),this.push=function(a){({pat:function(){},pes:function(){var e,t;switch(a.streamType){case At.H264_STREAM_TYPE:e=i,t="video";break;case At.ADTS_STREAM_TYPE:e=r,t="audio";break;case At.METADATA_STREAM_TYPE:e=s,t="timed-metadata";break;default:return}a.payloadUnitStartIndicator&&o(e,t,!0),e.data.push(a),e.size+=a.data.byteLength},pmt:function(){var i={type:"metadata",tracks:[]};e=a.programMapTable,null!==e.video&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),n=!0,t.trigger("data",i)}})[a.type]()},this.reset=function(){i.size=0,i.data.length=0,r.size=0,r.data.length=0,this.trigger("reset")},this.flushStreams_=function(){o(i,"video"),o(r,"audio"),o(s,"timed-metadata")},this.flush=function(){if(!n&&e){var i={type:"metadata",tracks:[]};null!==e.video&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),t.trigger("data",i)}n=!1,this.flushStreams_(),this.trigger("done")}},wt.prototype=new xt;var Rt={PAT_PID:0,MP2T_PACKET_LENGTH:Ct,TransportPacketStream:Tt,TransportParseStream:St,ElementaryStream:wt,TimestampRolloverStream:It,CaptionStream:kt.CaptionStream,Cea608Stream:kt.Cea608Stream,Cea708Stream:kt.Cea708Stream,MetadataStream:Et};for(var Mt in At)At.hasOwnProperty(Mt)&&(Rt[Mt]=At[Mt]);var Lt,Pt=Rt,Ot=B,Nt=ge.ONE_SECOND_IN_TS,Ut=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Lt=function(e){var t,n=0;Lt.prototype.init.call(this),this.skipWarn_=function(e,t){this.trigger("log",{level:"warn",message:`adts skiping bytes ${e} to ${t} in frame ${n} outside syncword`})},this.push=function(i){var r,s,a,o,l,u=0;if(e||(n=0),"audio"===i.type){var c;t&&t.length?(a=t,t=new Uint8Array(a.byteLength+i.data.byteLength),t.set(a),t.set(i.data,a.byteLength)):t=i.data;while(u+7<t.length)if(255===t[u]&&240===(246&t[u+1])){if("number"===typeof c&&(this.skipWarn_(c,u),c=null),s=2*(1&~t[u+1]),r=(3&t[u+3])<<11|t[u+4]<<3|(224&t[u+5])>>5,o=1024*(1+(3&t[u+6])),l=o*Nt/Ut[(60&t[u+2])>>>2],t.byteLength-u<r)break;this.trigger("data",{pts:i.pts+n*l,dts:i.dts+n*l,sampleCount:o,audioobjecttype:1+(t[u+2]>>>6&3),channelcount:(1&t[u+2])<<2|(192&t[u+3])>>>6,samplerate:Ut[(60&t[u+2])>>>2],samplingfrequencyindex:(60&t[u+2])>>>2,samplesize:16,data:t.subarray(u+7+s,u+r)}),n++,u+=r}else"number"!==typeof c&&(c=u),u++;"number"===typeof c&&(this.skipWarn_(c,u),c=null),t=t.subarray(u)}},this.flush=function(){n=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}},Lt.prototype=new Ot;var Ft,Bt=Lt;Ft=function(e){var t=e.byteLength,n=0,i=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+i},this.loadWord=function(){var r=e.byteLength-t,s=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");s.set(e.subarray(r,r+a)),n=new DataView(s.buffer).getUint32(0),i=8*a,t-=a},this.skipBits=function(e){var r;i>e?(n<<=e,i-=e):(e-=i,r=Math.floor(e/8),e-=8*r,t-=r,this.loadWord(),n<<=e,i-=e)},this.readBits=function(e){var r=Math.min(i,e),s=n>>>32-r;return i-=r,i>0?n<<=r:t>0&&this.loadWord(),r=e-r,r>0?s<<r|this.readBits(r):s},this.skipLeadingZeros=function(){var e;for(e=0;e<i;++e)if(0!==(n&2147483648>>>e))return n<<=e,i-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var jt,Vt,Ht,$t=Ft,Gt=B,zt=$t;Vt=function(){var e,t,n=0;Vt.prototype.init.call(this),this.push=function(i){var r;t?(r=new Uint8Array(t.byteLength+i.data.byteLength),r.set(t),r.set(i.data,t.byteLength),t=r):t=i.data;for(var s=t.byteLength;n<s-3;n++)if(1===t[n+2]){e=n+5;break}while(e<s)switch(t[e]){case 0:if(0!==t[e-1]){e+=2;break}if(0!==t[e-2]){e++;break}n+3!==e-2&&this.trigger("data",t.subarray(n+3,e-2));do{e++}while(1!==t[e]&&e<s);n=e-2,e+=3;break;case 1:if(0!==t[e-1]||0!==t[e-2]){e+=3;break}this.trigger("data",t.subarray(n+3,e-2)),n=e-2,e+=3;break;default:e+=3;break}t=t.subarray(n),e-=n,n=0},this.reset=function(){t=null,n=0,this.trigger("reset")},this.flush=function(){t&&t.byteLength>3&&this.trigger("data",t.subarray(n+3)),t=null,n=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},Vt.prototype=new Gt,Ht={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},jt=function(){var e,t,n,i,r,s,a,o=new Vt;jt.prototype.init.call(this),e=this,this.push=function(e){"video"===e.type&&(t=e.trackId,n=e.pts,i=e.dts,o.push(e))},o.on("data",function(a){var o={trackId:t,pts:n,dts:i,data:a,nalUnitTypeCode:31&a[0]};switch(o.nalUnitTypeCode){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=r(a.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=r(a.subarray(1)),o.config=s(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp";break}e.trigger("data",o)}),o.on("done",function(){e.trigger("done")}),o.on("partialdone",function(){e.trigger("partialdone")}),o.on("reset",function(){e.trigger("reset")}),o.on("endedtimeline",function(){e.trigger("endedtimeline")}),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},a=function(e,t){var n,i,r=8,s=8;for(n=0;n<e;n++)0!==s&&(i=t.readExpGolomb(),s=(r+i+256)%256),r=0===s?r:s},r=function(e){var t,n,i=e.byteLength,r=[],s=1;while(s<i-2)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;t=i-r.length,n=new Uint8Array(t);var a=0;for(s=0;s<t;a++,s++)a===r[0]&&(a++,r.shift()),n[s]=e[a];return n},s=function(e){var t,n,i,r,s,o,l,u,c,d,h,f,p,g=0,m=0,v=0,y=0,b=[1,1];if(t=new zt(e),n=t.readUnsignedByte(),r=t.readUnsignedByte(),i=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),Ht[n]&&(s=t.readUnsignedExpGolomb(),3===s&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(h=3!==s?8:12,p=0;p<h;p++)t.readBoolean()&&a(p<6?16:64,t);if(t.skipUnsignedExpGolomb(),o=t.readUnsignedExpGolomb(),0===o)t.readUnsignedExpGolomb();else if(1===o)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),l=t.readUnsignedExpGolomb(),p=0;p<l;p++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),u=t.readUnsignedExpGolomb(),c=t.readUnsignedExpGolomb(),d=t.readBits(1),0===d&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(g=t.readUnsignedExpGolomb(),m=t.readUnsignedExpGolomb(),v=t.readUnsignedExpGolomb(),y=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){switch(f=t.readUnsignedByte(),f){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:b=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()];break}b&&(b[0],b[1])}return{profileIdc:n,levelIdc:i,profileCompatibility:r,width:16*(u+1)-2*g-2*m,height:(2-d)*(c+1)*16-2*v-2*y,sarRatio:b}}},jt.prototype=new Gt;var qt,Wt={H264Stream:jt,NalByteStream:Vt},Kt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Yt=function(e,t){var n=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],i=e[t+5],r=(16&i)>>4;return n=n>=0?n:0,r?n+20:n+10},Xt=function(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=Yt(e,t),Xt(e,t))},Qt=function(e){var t=Xt(e,0);return e.length>=t+2&&255===(255&e[t])&&240===(240&e[t+1])&&16===(22&e[t+1])},Zt=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Jt=function(e,t,n){var i,r="";for(i=t;i<n;i++)r+="%"+("00"+e[i].toString(16)).slice(-2);return r},en=function(e,t,n){return unescape(Jt(e,t,n))},tn=function(e,t){var n=(224&e[t+5])>>5,i=e[t+4]<<3,r=6144&e[t+3];return r|i|n},nn=function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":!0&e[t]&&240===(240&e[t+1])?"audio":null},rn=function(e){var t=0;while(t+5<e.length){if(255===e[t]&&240===(246&e[t+1]))return Kt[(60&e[t+2])>>>2];t++}return null},sn=function(e){var t,n,i,r;t=10,64&e[5]&&(t+=4,t+=Zt(e.subarray(10,14)));do{if(n=Zt(e.subarray(t+4,t+8)),n<1)return null;if(r=String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]),"PRIV"===r){i=e.subarray(t+10,t+n+10);for(var s=0;s<i.byteLength;s++)if(0===i[s]){var a=en(i,0,s);if("com.apple.streaming.transportStreamTimestamp"===a){var o=i.subarray(s+1),l=(1&o[3])<<30|o[4]<<22|o[5]<<14|o[6]<<6|o[7]>>>2;return l*=4,l+=3&o[7],l}break}}t+=10,t+=n}while(t<e.byteLength);return null},an={isLikelyAacData:Qt,parseId3TagSize:Yt,parseAdtsSize:tn,parseType:nn,parseSampleRate:rn,parseAacTimestamp:sn},on=B,ln=an;qt=function(){var e=new Uint8Array,t=0;qt.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(n){var i,r,s,a,o=0,l=0;e.length?(a=e.length,e=new Uint8Array(n.byteLength+a),e.set(e.subarray(0,a)),e.set(n,a)):e=n;while(e.length-l>=3)if(e[l]!=="I".charCodeAt(0)||e[l+1]!=="D".charCodeAt(0)||e[l+2]!=="3".charCodeAt(0))if(255!==(255&e[l])||240!==(240&e[l+1]))l++;else{if(e.length-l<7)break;if(o=ln.parseAdtsSize(e,l),l+o>e.length)break;s={type:"audio",data:e.subarray(l,l+o),pts:t,dts:t},this.trigger("data",s),l+=o}else{if(e.length-l<10)break;if(o=ln.parseId3TagSize(e,l),l+o>e.length)break;r={type:"timed-metadata",data:e.subarray(l,l+o)},this.trigger("data",r),l+=o}i=e.length-l,e=i>0?e.subarray(l):new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}},qt.prototype=new on;var un,cn,dn,hn,fn=qt,pn=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],gn=pn,mn=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],vn=mn,yn=B,bn=Z,_n=le,Tn=we,Sn=Ie,wn=Pt,En=ge,xn=Bt,kn=Wt.H264Stream,An=fn,In=an.isLikelyAacData,Cn=ge.ONE_SECOND_IN_TS,Dn=gn,Rn=vn,Mn=function(e,t){t.stream=e,this.trigger("log",t)},Ln=function(e,t){for(var n=Object.keys(t),i=0;i<n.length;i++){var r=n[i];"headOfPipeline"!==r&&t[r].on&&t[r].on("log",Mn.bind(e,r))}},Pn=function(e,t){var n;if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},On=function(e,t,n,i,r,s){var a=n-t,o=i-t,l=r-n;return{start:{dts:e,pts:e+a},end:{dts:e+o,pts:e+l},prependedContentDuration:s,baseMediaDecodeTime:e}};cn=function(e,t){var n,i=[],r=0,s=0,a=1/0;t=t||{},n=t.firstSequenceNumber||0,cn.prototype.init.call(this),this.push=function(t){Sn.collectDtsInfo(e,t),e&&Dn.forEach(function(n){e[n]=t[n]}),i.push(t)},this.setEarliestDts=function(e){r=e},this.setVideoBaseMediaDecodeTime=function(e){a=e},this.setAudioAppendStart=function(e){s=e},this.flush=function(){var o,l,u,c,d,h,f;0!==i.length?(o=Tn.trimAdtsFramesByEarliestDts(i,e,r),e.baseMediaDecodeTime=Sn.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),f=Tn.prefixWithSilence(e,o,s,a),e.samples=Tn.generateSampleTable(o),u=bn.mdat(Tn.concatenateFrameData(o)),i=[],l=bn.moof(n,[e]),c=new Uint8Array(l.byteLength+u.byteLength),n++,c.set(l),c.set(u,l.byteLength),Sn.clearDtsInfo(e),d=Math.ceil(1024*Cn/e.samplerate),o.length&&(h=o.length*d,this.trigger("segmentTimingInfo",On(En.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),o[0].dts,o[0].pts,o[0].dts+h,o[0].pts+h,f||0)),this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+h})),this.trigger("data",{track:e,boxes:c}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){Sn.clearDtsInfo(e),i=[],this.trigger("reset")}},cn.prototype=new yn,un=function(e,t){var n,i,r,s=[],a=[];t=t||{},n=t.firstSequenceNumber||0,un.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){Sn.collectDtsInfo(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.config,e.sps=[t.data],Rn.forEach(function(t){e[t]=i[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.data,e.pps=[t.data]),s.push(t)},this.flush=function(){var i,r,o,l,u,c,d,h,f=0;while(s.length){if("access_unit_delimiter_rbsp"===s[0].nalUnitType)break;s.shift()}if(0===s.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(i=_n.groupNalsIntoFrames(s),o=_n.groupFramesIntoGops(i),o[0][0].keyFrame||(r=this.getGopForFusion_(s[0],e),r?(f=r.duration,o.unshift(r),o.byteLength+=r.byteLength,o.nalCount+=r.nalCount,o.pts=r.pts,o.dts=r.dts,o.duration+=r.duration):o=_n.extendFirstKeyFrame(o)),a.length){var p;if(p=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o),!p)return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");Sn.clearDtsInfo(e),o=p}Sn.collectDtsInfo(e,o),e.samples=_n.generateSampleTable(o),u=bn.mdat(_n.concatenateNalData(o)),e.baseMediaDecodeTime=Sn.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),d=o[0],h=o[o.length-1],this.trigger("segmentTimingInfo",On(e.baseMediaDecodeTime,d.dts,d.pts,h.dts+h.duration,h.pts+h.duration,f)),this.trigger("timingInfo",{start:o[0].pts,end:o[o.length-1].pts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),s=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),l=bn.moof(n,[e]),c=new Uint8Array(l.byteLength+u.byteLength),n++,c.set(l),c.set(u,l.byteLength),this.trigger("data",{track:e,boxes:c}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),s=[],this.gopCache_.length=0,a.length=0,this.trigger("reset")},this.resetStream_=function(){Sn.clearDtsInfo(e),i=void 0,r=void 0},this.getGopForFusion_=function(t){var n,i,r,s,a,o=45e3,l=1e4,u=1/0;for(a=0;a<this.gopCache_.length;a++)s=this.gopCache_[a],r=s.gop,e.pps&&Pn(e.pps[0],s.pps[0])&&e.sps&&Pn(e.sps[0],s.sps[0])&&(r.dts<e.timelineStartInfo.dts||(n=t.dts-r.dts-r.duration,n>=-l&&n<=o&&(!i||u>n)&&(i=s,u=n)));return i?i.gop:null},this.alignGopsAtStart_=function(e){var t,n,i,r,s,o,l,u;s=e.byteLength,o=e.nalCount,l=e.duration,t=n=0;while(t<a.length&&n<e.length){if(i=a[t],r=e[n],i.pts===r.pts)break;r.pts>i.pts?t++:(n++,s-=r.byteLength,o-=r.nalCount,l-=r.duration)}return 0===n?e:n===e.length?null:(u=e.slice(n),u.byteLength=s,u.duration=l,u.nalCount=o,u.pts=u[0].pts,u.dts=u[0].dts,u)},this.alignGopsAtEnd_=function(e){var t,n,i,r,s,o,l;t=a.length-1,n=e.length-1,s=null,o=!1;while(t>=0&&n>=0){if(i=a[t],r=e[n],i.pts===r.pts){o=!0;break}i.pts>r.pts?t--:(t===a.length-1&&(s=n),n--)}if(!o&&null===s)return null;if(l=o?n:s,0===l)return e;var u=e.slice(l),c=u.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return u.byteLength=c.byteLength,u.duration=c.duration,u.nalCount=c.nalCount,u.pts=u[0].pts,u.dts=u[0].dts,u},this.alignGopsWith=function(e){a=e}},un.prototype=new yn,hn=function(e,t){this.numberOfTracks=0,this.metadataStream=t,e=e||{},"undefined"!==typeof e.remux?this.remuxTracks=!!e.remux:this.remuxTracks=!0,"boolean"===typeof e.keepOriginalTimestamps?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,hn.prototype.init.call(this),this.push=function(e){return e.content||e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):(this.pendingTracks.push(e.track),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track,this.pendingBoxes.push(e.boxes)),void("audio"===e.track.type&&(this.audioTrack=e.track,this.pendingBoxes.unshift(e.boxes))))}},hn.prototype=new yn,hn.prototype.flush=function(e){var t,n,i,r,s=0,a={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,Rn.forEach(function(e){a.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,Dn.forEach(function(e){a.info[e]=this.audioTrack[e]},this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?a.type=this.pendingTracks[0].type:a.type="combined",this.emittedTracks+=this.pendingTracks.length,i=bn.initSegment(this.pendingTracks),a.initSegment=new Uint8Array(i.byteLength),a.initSegment.set(i),a.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)a.data.set(this.pendingBoxes[r],s),s+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)t=this.pendingCaptions[r],t.startTime=En.metadataTsToSeconds(t.startPts,o,this.keepOriginalTimestamps),t.endTime=En.metadataTsToSeconds(t.endPts,o,this.keepOriginalTimestamps),a.captionStreams[t.stream]=!0,a.captions.push(t);for(r=0;r<this.pendingMetadata.length;r++)n=this.pendingMetadata[r],n.cueTime=En.metadataTsToSeconds(n.pts,o,this.keepOriginalTimestamps),a.metadata.push(n);for(a.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",a),r=0;r<a.captions.length;r++)t=a.captions[r],this.trigger("caption",t);for(r=0;r<a.metadata.length;r++)n=a.metadata[r],this.trigger("id3Frame",n)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},hn.prototype.setRemux=function(e){this.remuxTracks=e},dn=function(e){var t,n,i=this,r=!0;dn.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="aac",r.metadataStream=new wn.MetadataStream,r.aacStream=new An,r.audioTimestampRolloverStream=new wn.TimestampRolloverStream("audio"),r.timedMetadataTimestampRolloverStream=new wn.TimestampRolloverStream("timed-metadata"),r.adtsStream=new xn,r.coalesceStream=new hn(e,r.metadataStream),r.headOfPipeline=r.aacStream,r.aacStream.pipe(r.audioTimestampRolloverStream).pipe(r.adtsStream),r.aacStream.pipe(r.timedMetadataTimestampRolloverStream).pipe(r.metadataStream).pipe(r.coalesceStream),r.metadataStream.on("timestamp",function(e){r.aacStream.setTimestamp(e.timeStamp)}),r.aacStream.on("data",function(s){"timed-metadata"!==s.type&&"audio"!==s.type||r.audioSegmentStream||(n=n||{timelineStartInfo:{baseMediaDecodeTime:i.baseMediaDecodeTime},codec:"adts",type:"audio"},r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new cn(n,e),r.audioSegmentStream.on("log",i.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",i.trigger.bind(i,"audioTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream),i.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!t}))}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),Ln(this,r)},this.setupTsPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="ts",r.metadataStream=new wn.MetadataStream,r.packetStream=new wn.TransportPacketStream,r.parseStream=new wn.TransportParseStream,r.elementaryStream=new wn.ElementaryStream,r.timestampRolloverStream=new wn.TimestampRolloverStream,r.adtsStream=new xn,r.h264Stream=new kn,r.captionStream=new wn.CaptionStream(e),r.coalesceStream=new hn(e,r.metadataStream),r.headOfPipeline=r.packetStream,r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream).pipe(r.timestampRolloverStream),r.timestampRolloverStream.pipe(r.h264Stream),r.timestampRolloverStream.pipe(r.adtsStream),r.timestampRolloverStream.pipe(r.metadataStream).pipe(r.coalesceStream),r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream),r.elementaryStream.on("data",function(s){var a;if("metadata"===s.type){a=s.tracks.length;while(a--)t||"video"!==s.tracks[a].type?n||"audio"!==s.tracks[a].type||(n=s.tracks[a],n.timelineStartInfo.baseMediaDecodeTime=i.baseMediaDecodeTime):(t=s.tracks[a],t.timelineStartInfo.baseMediaDecodeTime=i.baseMediaDecodeTime);t&&!r.videoSegmentStream&&(r.coalesceStream.numberOfTracks++,r.videoSegmentStream=new un(t,e),r.videoSegmentStream.on("log",i.getLogTrigger_("videoSegmentStream")),r.videoSegmentStream.on("timelineStartInfo",function(t){n&&!e.keepOriginalTimestamps&&(n.timelineStartInfo=t,r.audioSegmentStream.setEarliestDts(t.dts-i.baseMediaDecodeTime))}),r.videoSegmentStream.on("processedGopsInfo",i.trigger.bind(i,"gopInfo")),r.videoSegmentStream.on("segmentTimingInfo",i.trigger.bind(i,"videoSegmentTimingInfo")),r.videoSegmentStream.on("baseMediaDecodeTime",function(e){n&&r.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),r.videoSegmentStream.on("timingInfo",i.trigger.bind(i,"videoTimingInfo")),r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)),n&&!r.audioSegmentStream&&(r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new cn(n,e),r.audioSegmentStream.on("log",i.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",i.trigger.bind(i,"audioTimingInfo")),r.audioSegmentStream.on("segmentTimingInfo",i.trigger.bind(i,"audioSegmentTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)),i.trigger("trackinfo",{hasAudio:!!n,hasVideo:!!t})}}),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("id3Frame",function(e){e.dispatchType=r.metadataStream.dispatchType,i.trigger("id3Frame",e)}),r.coalesceStream.on("caption",this.trigger.bind(this,"caption")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),Ln(this,r)},this.setBaseMediaDecodeTime=function(i){var r=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=i),n&&(n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,Sn.clearDtsInfo(n),r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),t&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[]),t.timelineStartInfo.dts=void 0,t.timelineStartInfo.pts=void 0,Sn.clearDtsInfo(t),r.captionStream.reset()),r.timestampRolloverStream&&r.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){n&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.setRemux=function(t){var n=this.transmuxPipeline_;e.remux=t,n&&n.coalesceStream&&n.coalesceStream.setRemux(t)},this.alignGopsWith=function(e){t&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.getLogTrigger_=function(e){var t=this;return function(n){n.stream=e,t.trigger("log",n)}},this.push=function(e){if(r){var t=In(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():t||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},dn.prototype=new yn;var Nn,Un,Fn={Transmuxer:dn,VideoSegmentStream:un,AudioSegmentStream:cn,AUDIO_PROPERTIES:Dn,VIDEO_PROPERTIES:Rn,generateSegmentTimingInfo:On},Bn=function(e){return e>>>0},jn=function(e){return("00"+e.toString(16)).slice(-2)},Vn={toUnsigned:Bn,toHexString:jn},Hn=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3]),t},$n=Hn,Gn=Vn.toUnsigned,zn=$n,qn=function(e,t){var n,i,r,s,a,o=[];if(!t.length)return null;for(n=0;n<e.byteLength;)i=Gn(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),r=zn(e.subarray(n+4,n+8)),s=i>1?n+i:e.byteLength,r===t[0]&&(1===t.length?o.push(e.subarray(n+8,s)):(a=qn(e.subarray(n+8,s),t.slice(1)),a.length&&(o=o.concat(a)))),n=s;return o},Wn=qn,Kn=Vn.toUnsigned,Yn=H.getUint64,Xn=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4))};return 1===t.version?t.baseMediaDecodeTime=Yn(e.subarray(4)):t.baseMediaDecodeTime=Kn(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),t},Qn=Xn,Zn=function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:n.getUint32(4)},r=1&i.flags[2],s=2&i.flags[2],a=8&i.flags[2],o=16&i.flags[2],l=32&i.flags[2],u=65536&i.flags[0],c=131072&i.flags[0];return t=8,r&&(t+=4,i.baseDataOffset=n.getUint32(12),t+=4),s&&(i.sampleDescriptionIndex=n.getUint32(t),t+=4),a&&(i.defaultSampleDuration=n.getUint32(t),t+=4),o&&(i.defaultSampleSize=n.getUint32(t),t+=4),l&&(i.defaultSampleFlags=n.getUint32(t)),u&&(i.durationIsEmpty=!0),!r&&c&&(i.baseDataOffsetIsMoof=!0),i},Jn=Zn,ei=H.getUint64,ti=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},i=12;0===n.version?(n.earliestPresentationTime=t.getUint32(i),n.firstOffset=t.getUint32(i+4),i+=8):(n.earliestPresentationTime=ei(e.subarray(i)),n.firstOffset=ei(e.subarray(i+8)),i+=16),i+=2;var r=t.getUint16(i);for(i+=2;r>0;i+=12,r--)n.references.push({referenceType:(128&e[i])>>>7,referencedSize:2147483647&t.getUint32(i),subsegmentDuration:t.getUint32(i+4),startsWithSap:!!(128&e[i+8]),sapType:(112&e[i+8])>>>4,sapDeltaTime:268435455&t.getUint32(i+8)});return n},ni=ti,ii=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},ri=ii,si=ri,ai=function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=1&n.flags[2],s=4&n.flags[2],a=1&n.flags[1],o=2&n.flags[1],l=4&n.flags[1],u=8&n.flags[1],c=i.getUint32(4),d=8;r&&(n.dataOffset=i.getInt32(d),d+=4),s&&c&&(t={flags:si(e.subarray(d,d+4))},d+=4,a&&(t.duration=i.getUint32(d),d+=4),o&&(t.size=i.getUint32(d),d+=4),u&&(1===n.version?t.compositionTimeOffset=i.getInt32(d):t.compositionTimeOffset=i.getUint32(d),d+=4),n.samples.push(t),c--);while(c--)t={},a&&(t.duration=i.getUint32(d),d+=4),o&&(t.size=i.getUint32(d),d+=4),l&&(t.flags=si(e.subarray(d,d+4)),d+=4),u&&(1===n.version?t.compositionTimeOffset=i.getInt32(d):t.compositionTimeOffset=i.getUint32(d),d+=4),n.samples.push(t);return n},oi=ai,li=H,ui=li.getUint64,ci=function(e){return new Date(1e3*e-20828448e5)},di=$n,hi=Wn,fi=function(e){var t,n,i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=[];for(t=0;t+4<e.length;t+=n)if(n=i.getUint32(t),t+=4,n<=0)r.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&e[t]){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+e[t]&31);break}return r},pi={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:Nn(e.subarray(78,e.byteLength))}},avcC:function(e){var t,n,i,r,s=new DataView(e.buffer,e.byteOffset,e.byteLength),a={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:3&e[4],sps:[],pps:[]},o=31&e[5];for(i=6,r=0;r<o;r++)n=s.getUint16(i),i+=2,a.sps.push(new Uint8Array(e.subarray(i,i+n))),i+=n;for(t=e[i],i++,r=0;r<t;r++)n=s.getUint16(i),i+=2,a.pps.push(new Uint8Array(e.subarray(i,i+n))),i+=n;return a},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},edts:function(e){return{boxes:Nn(e)}},elst:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),edits:[]},r=n.getUint32(4);for(t=8;r;r--)0===i.version?(i.edits.push({segmentDuration:n.getUint32(t),mediaTime:n.getInt32(t+4),mediaRate:n.getUint16(t+8)+n.getUint16(t+10)/65536}),t+=12):(i.edits.push({segmentDuration:ui(e.subarray(t)),mediaTime:ui(e.subarray(t+8)),mediaRate:n.getUint16(t+16)+n.getUint16(t+18)/65536}),t+=20);return i},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:31&e[8],decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(7&e[26])<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={majorBrand:di(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},i=8;while(i<e.byteLength)n.compatibleBrands.push(di(e.subarray(i,i+4))),i+=4;return n},dinf:function(e){return{boxes:Nn(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:Nn(e.subarray(8))}},hdlr:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:di(e.subarray(8,12)),name:""},i=8;for(i=24;i<e.byteLength;i++){if(0===e[i]){i++;break}n.name+=String.fromCharCode(e[i])}return n.name=decodeURIComponent(escape(n.name)),n},mdat:function(e){return{byteLength:e.byteLength,nals:fi(e)}},mdhd:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return 1===r.version?(i+=4,r.creationTime=ci(n.getUint32(i)),i+=8,r.modificationTime=ci(n.getUint32(i)),i+=4,r.timescale=n.getUint32(i),i+=8,r.duration=n.getUint32(i)):(r.creationTime=ci(n.getUint32(i)),i+=4,r.modificationTime=ci(n.getUint32(i)),i+=4,r.timescale=n.getUint32(i),i+=4,r.duration=n.getUint32(i)),i+=4,t=n.getUint16(i),r.language+=String.fromCharCode(96+(t>>10)),r.language+=String.fromCharCode(96+((992&t)>>5)),r.language+=String.fromCharCode(96+(31&t)),r},mdia:function(e){return{boxes:Nn(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:Nn(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(n.streamDescriptor=Nn(e.subarray(28))[0]),n},moof:function(e){return{boxes:Nn(e)}},moov:function(e){return{boxes:Nn(e)}},mvex:function(e){return{boxes:Nn(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===i.version?(n+=4,i.creationTime=ci(t.getUint32(n)),n+=8,i.modificationTime=ci(t.getUint32(n)),n+=4,i.timescale=t.getUint32(n),n+=8,i.duration=t.getUint32(n)):(i.creationTime=ci(t.getUint32(n)),n+=4,i.modificationTime=ci(t.getUint32(n)),n+=4,i.timescale=t.getUint32(n),n+=4,i.duration=t.getUint32(n)),n+=4,i.rate=t.getUint16(n)+t.getUint16(n+2)/16,n+=4,i.volume=t.getUint8(n)+t.getUint8(n+1)/8,n+=2,n+=2,n+=8,i.matrix=new Uint32Array(e.subarray(n,n+36)),n+=36,n+=24,i.nextTrackId=t.getUint32(n),i},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t,n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]};for(t=4;t<e.byteLength;t++)n.samples.push({dependsOn:(48&e[t])>>4,isDependedOn:(12&e[t])>>2,hasRedundancy:3&e[t]});return n},sidx:ni,smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:Nn(e)}},ctts:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),compositionOffsets:[]},r=n.getUint32(4);for(t=8;r;t+=8,r--)i.compositionOffsets.push({sampleCount:n.getUint32(t),sampleOffset:n[0===i.version?"getUint32":"getInt32"](t+4)});return i},stss:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:n.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),syncSamples:[]},r=n.getUint32(4);for(t=8;r;t+=4,r--)i.syncSamples.push(n.getUint32(t));return i},stco:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},r=n.getUint32(4);for(t=8;r;t+=4,r--)i.chunkOffsets.push(n.getUint32(t));return i},stsc:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i=n.getUint32(4),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]};for(t=8;i;t+=12,i--)r.sampleToChunks.push({firstChunk:n.getUint32(t),samplesPerChunk:n.getUint32(t+4),sampleDescriptionIndex:n.getUint32(t+8)});return r},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:Nn(e.subarray(8))}},stsz:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:n.getUint32(4),entries:[]};for(t=12;t<e.byteLength;t+=4)i.entries.push(n.getUint32(t));return i},stts:function(e){var t,n=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},r=n.getUint32(4);for(t=8;r;t+=8,r--)i.timeToSamples.push({sampleCount:n.getUint32(t),sampleDelta:n.getUint32(t+4)});return i},styp:function(e){return pi.ftyp(e)},tfdt:Qn,tfhd:Jn,tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=4,i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===i.version?(n+=4,i.creationTime=ci(t.getUint32(n)),n+=8,i.modificationTime=ci(t.getUint32(n)),n+=4,i.trackId=t.getUint32(n),n+=4,n+=8,i.duration=t.getUint32(n)):(i.creationTime=ci(t.getUint32(n)),n+=4,i.modificationTime=ci(t.getUint32(n)),n+=4,i.trackId=t.getUint32(n),n+=4,n+=4,i.duration=t.getUint32(n)),n+=4,n+=8,i.layer=t.getUint16(n),n+=2,i.alternateGroup=t.getUint16(n),n+=2,i.volume=t.getUint8(n)+t.getUint8(n+1)/8,n+=2,n+=2,i.matrix=new Uint32Array(e.subarray(n,n+36)),n+=36,i.width=t.getUint16(n)+t.getUint16(n+2)/65536,n+=4,i.height=t.getUint16(n)+t.getUint16(n+2)/65536,i},traf:function(e){return{boxes:Nn(e)}},trak:function(e){return{boxes:Nn(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:3&e[20],sampleIsDependedOn:(192&e[21])>>6,sampleHasRedundancy:(48&e[21])>>4,samplePaddingValue:(14&e[21])>>1,sampleIsDifferenceSample:!!(1&e[21]),sampleDegradationPriority:t.getUint16(22)}},trun:oi,"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}};Nn=function(e){for(var t,n,i,r,s,a=0,o=[],l=new ArrayBuffer(e.length),u=new Uint8Array(l),c=0;c<e.length;++c)u[c]=e[c];t=new DataView(l);while(a<e.byteLength)n=t.getUint32(a),i=di(e.subarray(a+4,a+8)),r=n>1?a+n:e.byteLength,s=(pi[i]||function(e){return{data:e}})(e.subarray(a+8,r)),s.size=n,s.type=i,o.push(s),a=r;return o},Un=function(e,t){var n;return t=t||0,n=new Array(2*t+1).join(" "),e.map(function(e,i){return n+e.type+"\n"+Object.keys(e).filter(function(e){return"type"!==e&&"boxes"!==e}).map(function(t){var i=n+"  "+t+": ",r=e[t];if(r instanceof Uint8Array||r instanceof Uint32Array){var s=Array.prototype.slice.call(new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).map(function(e){return" "+("00"+e.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return s?1===s.length?i+"<"+s.join("").slice(1)+">":i+"<\n"+s.map(function(e){return n+"  "+e}).join("\n")+"\n"+n+"  >":i+"<>"}return i+JSON.stringify(r,null,2).split("\n").map(function(e,t){return 0===t?e:n+"  "+e}).join("\n")}).join("\n")+(e.boxes?"\n"+Un(e.boxes,t+1):"")}).join("\n")};var gi,mi={inspect:Nn,textify:Un,parseType:di,findBox:hi,parseTraf:pi.traf,parseTfdt:pi.tfdt,parseHdlr:pi.hdlr,parseTfhd:pi.tfhd,parseTrun:pi.trun,parseSidx:pi.sidx},vi=function(e){var t=0,n=String.fromCharCode(e[t]),i="";while("\0"!==n)i+=n,t++,n=String.fromCharCode(e[t]);return i+=n,i},yi={uint8ToCString:vi},bi=yi.uint8ToCString,_i=H.getUint64,Ti=function(e){var t,n,i,r,s,a,o,l,u=4,c=e[0];if(0===c){t=bi(e.subarray(u)),u+=t.length,n=bi(e.subarray(u)),u+=n.length;var d=new DataView(e.buffer);i=d.getUint32(u),u+=4,s=d.getUint32(u),u+=4,a=d.getUint32(u),u+=4,o=d.getUint32(u),u+=4}else if(1===c){d=new DataView(e.buffer);i=d.getUint32(u),u+=4,r=_i(e.subarray(u)),u+=8,a=d.getUint32(u),u+=4,o=d.getUint32(u),u+=4,t=bi(e.subarray(u)),u+=t.length,n=bi(e.subarray(u)),u+=n.length}l=new Uint8Array(e.subarray(u,e.byteLength));var h={scheme_id_uri:t,value:n,timescale:i||1,presentation_time:r,presentation_time_delta:s,event_duration:a,id:o,message_data:l};return wi(c,h)?h:void 0},Si=function(e,t,n,i){return e||0===e?e/t:i+n/t},wi=function(e,t){var n="\0"!==t.scheme_id_uri,i=0===e&&Ei(t.presentation_time_delta)&&n,r=1===e&&Ei(t.presentation_time)&&n;return!(e>1)&&i||r},Ei=function(e){return void 0!==e||null!==e},xi={parseEmsgBox:Ti,scaleTime:Si};gi="undefined"!==typeof window?window:"undefined"!==typeof t?t:"undefined"!==typeof self?self:{};var ki,Ai,Ii,Ci,Di,Ri,Mi,Li=gi,Pi=Vn.toUnsigned,Oi=Vn.toHexString,Ni=Wn,Ui=$n,Fi=xi,Bi=Jn,ji=oi,Vi=Qn,Hi=H.getUint64,$i=Li,Gi=vt.parseId3Frames;ki=function(e){var t={},n=Ni(e,["moov","trak"]);return n.reduce(function(e,t){var n,i,r,s,a;return n=Ni(t,["tkhd"])[0],n?(i=n[0],r=0===i?12:20,s=Pi(n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3]),a=Ni(t,["mdia","mdhd"])[0],a?(i=a[0],r=0===i?12:20,e[s]=Pi(a[r]<<24|a[r+1]<<16|a[r+2]<<8|a[r+3]),e):null):null},t)},Ai=function(e,t){var n;n=Ni(t,["moof","traf"]);var i=n.reduce(function(t,n){var i,r=Ni(n,["tfhd"])[0],s=Pi(r[4]<<24|r[5]<<16|r[6]<<8|r[7]),a=e[s]||9e4,o=Ni(n,["tfdt"])[0],l=new DataView(o.buffer,o.byteOffset,o.byteLength);let u;return i=1===o[0]?Hi(o.subarray(4,12)):l.getUint32(4),"bigint"===typeof i?u=i/$i.BigInt(a):"number"!==typeof i||isNaN(i)||(u=i/a),u<Number.MAX_SAFE_INTEGER&&(u=Number(u)),u<t&&(t=u),t},1/0);return"bigint"===typeof i||isFinite(i)?i:0},Ii=function(e,t){var n,i=Ni(t,["moof","traf"]),r=0,s=0;if(i&&i.length){var a=Ni(i[0],["tfhd"])[0],o=Ni(i[0],["trun"])[0],l=Ni(i[0],["tfdt"])[0];if(a){var u=Bi(a);n=u.trackId}if(l){var c=Vi(l);r=c.baseMediaDecodeTime}if(o){var d=ji(o);d.samples&&d.samples.length&&(s=d.samples[0].compositionTimeOffset||0)}}var h=e[n]||9e4;"bigint"===typeof r&&(s=$i.BigInt(s),h=$i.BigInt(h));var f=(r+s)/h;return"bigint"===typeof f&&f<Number.MAX_SAFE_INTEGER&&(f=Number(f)),f},Ci=function(e){var t=Ni(e,["moov","trak"]),n=[];return t.forEach(function(e){var t=Ni(e,["mdia","hdlr"]),i=Ni(e,["tkhd"]);t.forEach(function(e,t){var r,s,a,o=Ui(e.subarray(8,12)),l=i[t];"vide"===o&&(r=new DataView(l.buffer,l.byteOffset,l.byteLength),s=r.getUint8(0),a=0===s?r.getUint32(12):r.getUint32(20),n.push(a))})}),n},Ri=function(e){var t=e[0],n=0===t?12:20;return Pi(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3])},Di=function(e){var t=Ni(e,["moov","trak"]),n=[];return t.forEach(function(e){var t,i,r={},s=Ni(e,["tkhd"])[0];s&&(t=new DataView(s.buffer,s.byteOffset,s.byteLength),i=t.getUint8(0),r.id=0===i?t.getUint32(12):t.getUint32(20));var a=Ni(e,["mdia","hdlr"])[0];if(a){var o=Ui(a.subarray(8,12));r.type="vide"===o?"video":"soun"===o?"audio":o}var l=Ni(e,["mdia","minf","stbl","stsd"])[0];if(l){var u=l.subarray(8);r.codec=Ui(u.subarray(4,8));var c,d,h=Ni(u,[r.codec])[0];h&&(/^[asm]vc[1-9]$/i.test(r.codec)?(c=h.subarray(78),d=Ui(c.subarray(4,8)),"avcC"===d&&c.length>11?(r.codec+=".",r.codec+=Oi(c[9]),r.codec+=Oi(c[10]),r.codec+=Oi(c[11])):r.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(r.codec)?(c=h.subarray(28),d=Ui(c.subarray(4,8)),"esds"===d&&c.length>20&&0!==c[19]?(r.codec+="."+Oi(c[19]),r.codec+="."+Oi(c[20]>>>2&63).replace(/^0/,"")):r.codec="mp4a.40.2"):r.codec=r.codec.toLowerCase())}var f=Ni(e,["mdia","mdhd"])[0];f&&(r.timescale=Ri(f)),n.push(r)}),n},Mi=function(e,t=0){var n=Ni(e,["emsg"]);return n.map(e=>{var n=Fi.parseEmsgBox(new Uint8Array(e)),i=Gi(n.message_data);return{cueTime:Fi.scaleTime(n.presentation_time,n.timescale,n.presentation_time_delta,t),duration:Fi.scaleTime(n.event_duration,n.timescale),frames:i}})};var zi={findBox:Ni,parseType:Ui,timescale:ki,startTime:Ai,compositionStartTime:Ii,videoTrackIds:Ci,tracks:Di,getTimescaleFromMediaHeader:Ri,getEmsgID3:Mi};const{parseTrun:qi}=mi,{findBox:Wi}=zi;var Ki=Li,Yi=function(e){var t=Wi(e,["moof","traf"]),n=Wi(e,["mdat"]),i=[];return n.forEach(function(e,n){var r=t[n];i.push({mdat:e,traf:r})}),i},Xi=function(e,t,n){var i=t,r=n.defaultSampleDuration||0,s=n.defaultSampleSize||0,a=n.trackId,o=[];return e.forEach(function(e){var t=qi(e),n=t.samples;n.forEach(function(e){void 0===e.duration&&(e.duration=r),void 0===e.size&&(e.size=s),e.trackId=a,e.dts=i,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),"bigint"===typeof i?(e.pts=i+Ki.BigInt(e.compositionTimeOffset),i+=Ki.BigInt(e.duration)):(e.pts=i+e.compositionTimeOffset,i+=e.duration)}),o=o.concat(n)}),o},Qi={getMdatTrafPairs:Yi,parseSamples:Xi},Zi=Oe.discardEmulationPreventionBytes,Ji=Qe.CaptionStream,er=Wn,tr=Qn,nr=Jn,{getMdatTrafPairs:ir,parseSamples:rr}=Qi,sr=function(e,t){for(var n=e,i=0;i<t.length;i++){var r=t[i];if(n<r.size)return r;n-=r.size}return null},ar=function(e,t,n){var i,r,s,a,o=new DataView(e.buffer,e.byteOffset,e.byteLength),l={logs:[],seiNals:[]};for(r=0;r+4<e.length;r+=s)if(s=o.getUint32(r),r+=4,!(s<=0))switch(31&e[r]){case 6:var u=e.subarray(r+1,r+1+s),c=sr(r,t);if(i={nalUnitType:"sei_rbsp",size:s,data:u,escapedRBSP:Zi(u),trackId:n},c)i.pts=c.pts,i.dts=c.dts,a=c;else{if(!a){l.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+r+" for trackId "+n+". See mux.js#223."});break}i.pts=a.pts,i.dts=a.dts}l.seiNals.push(i);break}return l},or=function(e,t){var n={},i=ir(e);return i.forEach(function(e){var i,r,s=e.mdat,a=e.traf,o=er(a,["tfhd"]),l=nr(o[0]),u=l.trackId,c=er(a,["tfdt"]),d=c.length>0?tr(c[0]).baseMediaDecodeTime:0,h=er(a,["trun"]);t===u&&h.length>0&&(i=rr(h,d,l),r=ar(s,i,u),n[u]||(n[u]={seiNals:[],logs:[]}),n[u].seiNals=n[u].seiNals.concat(r.seiNals),n[u].logs=n[u].logs.concat(r.logs))}),n},lr=function(e,t,n){var i;if(null===t)return null;i=or(e,t);var r=i[t]||{};return{seiNals:r.seiNals,logs:r.logs,timescale:n}},ur=function(){var e,t,n,i,r,s,a=!1;this.isInitialized=function(){return a},this.init=function(t){e=new Ji,a=!0,s=!!t&&t.isPartial,e.on("data",function(e){e.startTime=e.startPts/i,e.endTime=e.endPts/i,r.captions.push(e),r.captionStreams[e.stream]=!0}),e.on("log",function(e){r.logs.push(e)})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"===typeof t&&0===Object.keys(t).length)&&(n!==e[0]||i!==t[n])},this.parse=function(e,s,a){var o;if(!this.isInitialized())return null;if(!s||!a)return null;if(this.isNewInit(s,a))n=s[0],i=a[n];else if(null===n||!i)return t.push(e),null;while(t.length>0){var l=t.shift();this.parse(l,s,a)}return o=lr(e,n,i),o&&o.logs&&(r.logs=r.logs.concat(o.logs)),null!==o&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),r):r.logs.length?{logs:r.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;s?e.partialFlush():e.flush()},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={},r.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){t=[],n=null,i=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},cr=ur;const{parseTfdt:dr}=mi,hr=Wn,{getTimescaleFromMediaHeader:fr}=zi,{parseSamples:pr,getMdatTrafPairs:gr}=Qi,mr=function(){let e=9e4;this.init=function(t){const n=hr(t,["moov","trak","mdia","mdhd"])[0];n&&(e=fr(n))},this.parseSegment=function(t){const n=[],i=gr(t);let r=0;return i.forEach(function(t){const i=t.mdat,s=t.traf,a=hr(s,["tfdt"])[0],o=hr(s,["tfhd"])[0],l=hr(s,["trun"]);if(a){const e=dr(a);r=e.baseMediaDecodeTime}if(l.length&&o){const t=pr(l,r,o);let s=0;t.forEach(function(t){const r="utf-8",a=new TextDecoder(r),o=i.slice(s,s+t.size),l=hr(o,["vtte"])[0];if(l)return void(s+=t.size);const u=hr(o,["vttc"]);u.forEach(function(i){const r=hr(i,["payl"])[0],s=hr(i,["sttg"])[0],o=t.pts/e,l=(t.pts+t.duration)/e;let u,c;if(r)try{u=a.decode(r)}catch(e){console.error(e)}if(s)try{c=a.decode(s)}catch(e){console.error(e)}t.duration&&u&&n.push({cueText:u,start:o,end:l,settings:c})}),s+=t.size})}}),n}};var vr=mr,yr=Ze,br=function(e){var t=31&e[1];return t<<=8,t|=e[2],t},_r=function(e){return!!(64&e[1])},Tr=function(e){var t=0;return(48&e[3])>>>4>1&&(t+=e[4]+1),t},Sr=function(e,t){var n=br(e);return 0===n?"pat":n===t?"pmt":t?"pes":null},wr=function(e){var t=_r(e),n=4+Tr(e);return t&&(n+=e[n]+1),(31&e[n+10])<<8|e[n+11]},Er=function(e){var t={},n=_r(e),i=4+Tr(e);if(n&&(i+=e[i]+1),1&e[i+5]){var r,s,a;r=(15&e[i+1])<<8|e[i+2],s=3+r-4,a=(15&e[i+10])<<8|e[i+11];var o=12+a;while(o<s){var l=i+o;t[(31&e[l+1])<<8|e[l+2]]=e[l],o+=5+((15&e[l+3])<<8|e[l+4])}return t}},xr=function(e,t){var n=br(e),i=t[n];switch(i){case yr.H264_STREAM_TYPE:return"video";case yr.ADTS_STREAM_TYPE:return"audio";case yr.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},kr=function(e){var t=_r(e);if(!t)return null;var n=4+Tr(e);if(n>=e.byteLength)return null;var i,r=null;return i=e[n+7],192&i&&(r={},r.pts=(14&e[n+9])<<27|(255&e[n+10])<<20|(254&e[n+11])<<12|(255&e[n+12])<<5|(254&e[n+13])>>>3,r.pts*=4,r.pts+=(6&e[n+13])>>>1,r.dts=r.pts,64&i&&(r.dts=(14&e[n+14])<<27|(255&e[n+15])<<20|(254&e[n+16])<<12|(255&e[n+17])<<5|(254&e[n+18])>>>3,r.dts*=4,r.dts+=(6&e[n+18])>>>1)),r},Ar=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},Ir=function(e){for(var t,n=4+Tr(e),i=e.subarray(n),r=0,s=0,a=!1;s<i.byteLength-3;s++)if(1===i[s+2]){r=s+5;break}while(r<i.byteLength)switch(i[r]){case 0:if(0!==i[r-1]){r+=2;break}if(0!==i[r-2]){r++;break}s+3!==r-2&&(t=Ar(31&i[s+3]),"slice_layer_without_partitioning_rbsp_idr"===t&&(a=!0));do{r++}while(1!==i[r]&&r<i.length);s=r-2,r+=3;break;case 1:if(0!==i[r-1]||0!==i[r-2]){r+=3;break}t=Ar(31&i[s+3]),"slice_layer_without_partitioning_rbsp_idr"===t&&(a=!0),s=r-2,r+=3;break;default:r+=3;break}return i=i.subarray(s),r-=s,s=0,i&&i.byteLength>3&&(t=Ar(31&i[s+3]),"slice_layer_without_partitioning_rbsp_idr"===t&&(a=!0)),a},Cr={parseType:Sr,parsePat:wr,parsePmt:Er,parsePayloadUnitStartIndicator:_r,parsePesType:xr,parsePesTime:kr,videoPacketContainsKeyFrame:Ir},Dr=Ze,Rr=at.handleRollover,Mr={};Mr.ts=Cr,Mr.aac=an;var Lr=ge.ONE_SECOND_IN_TS,Pr=188,Or=71,Nr=function(e,t){var n,i,r=0,s=Pr;while(s<e.byteLength)if(e[r]!==Or||e[s]!==Or)r++,s++;else{switch(n=e.subarray(r,s),i=Mr.ts.parseType(n,t.pid),i){case"pat":t.pid=Mr.ts.parsePat(n);break;case"pmt":var a=Mr.ts.parsePmt(n);t.table=t.table||{},Object.keys(a).forEach(function(e){t.table[e]=a[e]});break}r+=Pr,s+=Pr}},Ur=function(e,t,n){var i,r,s,a,o,l=0,u=Pr,c=!1;while(u<=e.byteLength)if(e[l]!==Or||e[u]!==Or&&u!==e.byteLength)l++,u++;else{switch(i=e.subarray(l,u),r=Mr.ts.parseType(i,t.pid),r){case"pes":s=Mr.ts.parsePesType(i,t.table),a=Mr.ts.parsePayloadUnitStartIndicator(i),"audio"===s&&a&&(o=Mr.ts.parsePesTime(i),o&&(o.type="audio",n.audio.push(o),c=!0));break}if(c)break;l+=Pr,u+=Pr}u=e.byteLength,l=u-Pr,c=!1;while(l>=0)if(e[l]!==Or||e[u]!==Or&&u!==e.byteLength)l--,u--;else{switch(i=e.subarray(l,u),r=Mr.ts.parseType(i,t.pid),r){case"pes":s=Mr.ts.parsePesType(i,t.table),a=Mr.ts.parsePayloadUnitStartIndicator(i),"audio"===s&&a&&(o=Mr.ts.parsePesTime(i),o&&(o.type="audio",n.audio.push(o),c=!0));break}if(c)break;l-=Pr,u-=Pr}},Fr=function(e,t,n){var i,r,s,a,o,l,u,c,d=0,h=Pr,f=!1,p={data:[],size:0};while(h<e.byteLength)if(e[d]!==Or||e[h]!==Or)d++,h++;else{switch(i=e.subarray(d,h),r=Mr.ts.parseType(i,t.pid),r){case"pes":if(s=Mr.ts.parsePesType(i,t.table),a=Mr.ts.parsePayloadUnitStartIndicator(i),"video"===s&&(a&&!f&&(o=Mr.ts.parsePesTime(i),o&&(o.type="video",n.video.push(o),f=!0)),!n.firstKeyFrame)){if(a&&0!==p.size){l=new Uint8Array(p.size),u=0;while(p.data.length)c=p.data.shift(),l.set(c,u),u+=c.byteLength;if(Mr.ts.videoPacketContainsKeyFrame(l)){var g=Mr.ts.parsePesTime(l);g?(n.firstKeyFrame=g,n.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}p.size=0}p.data.push(i),p.size+=i.byteLength}break}if(f&&n.firstKeyFrame)break;d+=Pr,h+=Pr}h=e.byteLength,d=h-Pr,f=!1;while(d>=0)if(e[d]!==Or||e[h]!==Or)d--,h--;else{switch(i=e.subarray(d,h),r=Mr.ts.parseType(i,t.pid),r){case"pes":s=Mr.ts.parsePesType(i,t.table),a=Mr.ts.parsePayloadUnitStartIndicator(i),"video"===s&&a&&(o=Mr.ts.parsePesTime(i),o&&(o.type="video",n.video.push(o),f=!0));break}if(f)break;d-=Pr,h-=Pr}},Br=function(e,t){if(e.audio&&e.audio.length){var n=t;("undefined"===typeof n||isNaN(n))&&(n=e.audio[0].dts),e.audio.forEach(function(e){e.dts=Rr(e.dts,n),e.pts=Rr(e.pts,n),e.dtsTime=e.dts/Lr,e.ptsTime=e.pts/Lr})}if(e.video&&e.video.length){var i=t;if(("undefined"===typeof i||isNaN(i))&&(i=e.video[0].dts),e.video.forEach(function(e){e.dts=Rr(e.dts,i),e.pts=Rr(e.pts,i),e.dtsTime=e.dts/Lr,e.ptsTime=e.pts/Lr}),e.firstKeyFrame){var r=e.firstKeyFrame;r.dts=Rr(r.dts,i),r.pts=Rr(r.pts,i),r.dtsTime=r.dts/Lr,r.ptsTime=r.pts/Lr}}},jr=function(e){var t,n=!1,i=0,r=null,s=null,a=0,o=0;while(e.length-o>=3){var l=Mr.aac.parseType(e,o);switch(l){case"timed-metadata":if(e.length-o<10){n=!0;break}if(a=Mr.aac.parseId3TagSize(e,o),a>e.length){n=!0;break}null===s&&(t=e.subarray(o,o+a),s=Mr.aac.parseAacTimestamp(t)),o+=a;break;case"audio":if(e.length-o<7){n=!0;break}if(a=Mr.aac.parseAdtsSize(e,o),a>e.length){n=!0;break}null===r&&(t=e.subarray(o,o+a),r=Mr.aac.parseSampleRate(t)),i++,o+=a;break;default:o++;break}if(n)return null}if(null===r||null===s)return null;var u=Lr/r,c={audio:[{type:"audio",dts:s,pts:s},{type:"audio",dts:s+1024*i*u,pts:s+1024*i*u}]};return c},Vr=function(e){var t={pid:null,table:null},n={};for(var i in Nr(e,t),t.table)if(t.table.hasOwnProperty(i)){var r=t.table[i];switch(r){case Dr.H264_STREAM_TYPE:n.video=[],Fr(e,t,n),0===n.video.length&&delete n.video;break;case Dr.ADTS_STREAM_TYPE:n.audio=[],Ur(e,t,n),0===n.audio.length&&delete n.audio;break}}return n},Hr=function(e,t){var n,i=Mr.aac.isLikelyAacData(e);return n=i?jr(e):Vr(e),n&&(n.audio||n.video)?(Br(n,t),n):null},$r={inspect:Hr,parseAudioPes_:Ur};const Gr=function(e,t){t.on("data",function(t){const n=t.initSegment;t.initSegment={data:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength};const i=t.data;t.data=i.buffer,e.postMessage({action:"data",segment:t,byteOffset:i.byteOffset,byteLength:i.byteLength},[t.data])}),t.on("done",function(t){e.postMessage({action:"done"})}),t.on("gopInfo",function(t){e.postMessage({action:"gopInfo",gopInfo:t})}),t.on("videoSegmentTimingInfo",function(t){const n={start:{decode:ge.videoTsToSeconds(t.start.dts),presentation:ge.videoTsToSeconds(t.start.pts)},end:{decode:ge.videoTsToSeconds(t.end.dts),presentation:ge.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:ge.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(n.prependedContentDuration=ge.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:n})}),t.on("audioSegmentTimingInfo",function(t){const n={start:{decode:ge.videoTsToSeconds(t.start.dts),presentation:ge.videoTsToSeconds(t.start.pts)},end:{decode:ge.videoTsToSeconds(t.end.dts),presentation:ge.videoTsToSeconds(t.end.pts)},baseMediaDecodeTime:ge.videoTsToSeconds(t.baseMediaDecodeTime)};t.prependedContentDuration&&(n.prependedContentDuration=ge.videoTsToSeconds(t.prependedContentDuration)),e.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:n})}),t.on("id3Frame",function(t){e.postMessage({action:"id3Frame",id3Frame:t})}),t.on("caption",function(t){e.postMessage({action:"caption",caption:t})}),t.on("trackinfo",function(t){e.postMessage({action:"trackinfo",trackInfo:t})}),t.on("audioTimingInfo",function(t){e.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:ge.videoTsToSeconds(t.start),end:ge.videoTsToSeconds(t.end)}})}),t.on("videoTimingInfo",function(t){e.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:ge.videoTsToSeconds(t.start),end:ge.videoTsToSeconds(t.end)}})}),t.on("log",function(t){e.postMessage({action:"log",log:t})})};class zr{constructor(e,t){this.options=t||{},this.self=e,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new Fn.Transmuxer(this.options),Gr(this.self,this.transmuxer)}pushMp4Captions(e){this.captionParser||(this.captionParser=new cr,this.captionParser.init());const t=new Uint8Array(e.data,e.byteOffset,e.byteLength),n=this.captionParser.parse(t,e.trackIds,e.timescales);this.self.postMessage({action:"mp4Captions",captions:n&&n.captions||[],logs:n&&n.logs||[],data:t.buffer},[t.buffer])}initMp4WebVttParser(e){this.webVttParser||(this.webVttParser=new vr);const t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.webVttParser.init(t)}getMp4WebVttText(e){this.webVttParser||(this.webVttParser=new vr);const t=new Uint8Array(e.data,e.byteOffset,e.byteLength),n=this.webVttParser.parseSegment(t);this.self.postMessage({action:"getMp4WebVttText",mp4VttCues:n||[],data:t.buffer},[t.buffer])}probeMp4StartTime({timescales:e,data:t}){const n=zi.startTime(e,t);this.self.postMessage({action:"probeMp4StartTime",startTime:n,data:t},[t.buffer])}probeMp4Tracks({data:e}){const t=zi.tracks(e);this.self.postMessage({action:"probeMp4Tracks",tracks:t,data:e},[e.buffer])}probeEmsgID3({data:e,offset:t}){const n=zi.getEmsgID3(e,t);this.self.postMessage({action:"probeEmsgID3",id3Frames:n,emsgData:e},[e.buffer])}probeTs({data:e,baseStartTime:t}){const n="number"!==typeof t||isNaN(t)?void 0:t*ge.ONE_SECOND_IN_TS,i=$r.inspect(e,n);let r=null;i&&(r={hasVideo:i.video&&2===i.video.length||!1,hasAudio:i.audio&&2===i.audio.length||!1},r.hasVideo&&(r.videoStart=i.video[0].ptsTime),r.hasAudio&&(r.audioStart=i.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:r,data:e},[e.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(e){const t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}reset(){this.transmuxer.reset()}setTimestampOffset(e){const t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(ge.secondsToVideoTs(t)))}setAudioAppendStart(e){this.transmuxer.setAudioAppendStart(Math.ceil(ge.secondsToVideoTs(e.appendStart)))}setRemux(e){this.transmuxer.setRemux(e.remux)}flush(e){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())}}self.onmessage=function(e){"init"===e.data.action&&e.data.options?this.messageHandlers=new zr(self,e.data.options):(this.messageHandlers||(this.messageHandlers=new zr(self)),e.data&&e.data.action&&"init"!==e.data.action&&this.messageHandlers[e.data.action]&&this.messageHandlers[e.data.action](e.data))}}));var Jo=Yo(Zo);const el=(e,t,n)=>{const{type:i,initSegment:r,captions:s,captionStreams:a,metadata:o,videoFrameDtsTime:l,videoFramePtsTime:u}=e.data.segment;t.buffer.push({captions:s,captionStreams:a,metadata:o});const c=e.data.segment.boxes||{data:e.data.segment.data},d={type:i,data:new Uint8Array(c.data,c.data.byteOffset,c.data.byteLength),initSegment:new Uint8Array(r.data,r.byteOffset,r.byteLength)};"undefined"!==typeof l&&(d.videoFrameDtsTime=l),"undefined"!==typeof u&&(d.videoFramePtsTime=u),n(d)},tl=({transmuxedData:e,callback:t})=>{e.buffer=[],t(e)},nl=(e,t)=>{t.gopInfo=e.data.gopInfo},il=e=>{const{transmuxer:t,bytes:n,audioAppendStart:i,gopsToAlignWith:r,remux:s,onData:a,onTrackInfo:o,onAudioTimingInfo:l,onVideoTimingInfo:u,onVideoSegmentTimingInfo:c,onAudioSegmentTimingInfo:d,onId3:h,onCaptions:f,onDone:p,onEndedTimeline:g,onTransmuxerLog:m,isEndOfTimeline:v,segment:y,triggerSegmentEventFn:b}=e,_={buffer:[]};let T=v;const S=n=>{t.currentTransmux===e&&("data"===n.data.action&&el(n,_,a),"trackinfo"===n.data.action&&o(n.data.trackInfo),"gopInfo"===n.data.action&&nl(n,_),"audioTimingInfo"===n.data.action&&l(n.data.audioTimingInfo),"videoTimingInfo"===n.data.action&&u(n.data.videoTimingInfo),"videoSegmentTimingInfo"===n.data.action&&c(n.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===n.data.action&&d(n.data.audioSegmentTimingInfo),"id3Frame"===n.data.action&&h([n.data.id3Frame],n.data.id3Frame.dispatchType),"caption"===n.data.action&&f(n.data.caption),"endedtimeline"===n.data.action&&(T=!1,g()),"log"===n.data.action&&m(n.data.log),"transmuxed"===n.data.type&&(T||(t.onmessage=null,tl({transmuxedData:_,callback:p}),rl(t))))},w=()=>{const e={message:"Received an error message from the transmuxer worker",metadata:{errorType:Ps.Error.StreamingFailedToTransmuxSegment,segmentInfo:wu({segment:y})}};p(null,e)};if(t.onmessage=S,t.onerror=w,i&&t.postMessage({action:"setAudioAppendStart",appendStart:i}),Array.isArray(r)&&t.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),"undefined"!==typeof s&&t.postMessage({action:"setRemux",remux:s}),n.byteLength){const e=n instanceof ArrayBuffer?n:n.buffer,i=n instanceof ArrayBuffer?0:n.byteOffset;b({type:"segmenttransmuxingstart",segment:y}),t.postMessage({action:"push",data:e,byteOffset:i,byteLength:n.byteLength},[e])}v&&t.postMessage({action:"endTimeline"}),t.postMessage({action:"flush"})},rl=e=>{e.currentTransmux=null,e.transmuxQueue.length&&(e.currentTransmux=e.transmuxQueue.shift(),"function"===typeof e.currentTransmux?e.currentTransmux():il(e.currentTransmux))},sl=(e,t)=>{e.postMessage({action:t}),rl(e)},al=(e,t)=>{if(!t.currentTransmux)return t.currentTransmux=e,void sl(t,e);t.transmuxQueue.push(sl.bind(null,t,e))},ol=e=>{al("reset",e)},ll=e=>{al("endTimeline",e)},ul=e=>{if(!e.transmuxer.currentTransmux)return e.transmuxer.currentTransmux=e,void il(e);e.transmuxer.transmuxQueue.push(e)},cl=e=>{const t=new Jo;t.currentTransmux=null,t.transmuxQueue=[];const n=t.terminate;return t.terminate=(()=>{return t.currentTransmux=null,t.transmuxQueue.length=0,n.call(t)}),t.postMessage({action:"init",options:e}),t};var dl={reset:ol,endTimeline:ll,transmux:ul,createTransmuxer:cl};const hl=function(e){const t=e.transmuxer,n=e.endAction||e.action,i=e.callback,r=h()({},e,{endAction:null,transmuxer:null,callback:null}),s=r=>{r.data.action===n&&(t.removeEventListener("message",s),r.data.data&&(r.data.data=new Uint8Array(r.data.data,e.byteOffset||0,e.byteLength||r.data.data.byteLength),e.data&&(e.data=r.data.data)),i(r.data))};if(t.addEventListener("message",s),e.data){const n=e.data instanceof ArrayBuffer;r.byteOffset=n?0:e.data.byteOffset,r.byteLength=e.data.byteLength;const i=[n?e.data:e.data.buffer];t.postMessage(r,i)}else t.postMessage(r)},fl={FAILURE:2,TIMEOUT:-101,ABORTED:-102},pl="wvtt",gl=e=>{e.forEach(e=>{e.abort()})},ml=e=>{return{bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}},vl=e=>{const t=e.target,n=Date.now()-t.requestTime,i={bandwidth:1/0,bytesReceived:0,roundTripTime:n||0};return i.bytesReceived=e.loaded,i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3),i},yl=(e,t)=>{const{requestType:n}=t,i=Ha({requestType:n,request:t,error:e});return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:fl.TIMEOUT,xhr:t,metadata:i}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:fl.ABORTED,xhr:t,metadata:i}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:fl.FAILURE,xhr:t,metadata:i}:"arraybuffer"===t.responseType&&0===t.response.byteLength?{status:t.status,message:"Empty HLS response at URL: "+t.uri,code:fl.FAILURE,xhr:t,metadata:i}:null},bl=(e,t,n,i)=>(r,s)=>{const a=s.response,o=yl(r,s);if(o)return n(o,e);if(16!==a.byteLength)return n({status:s.status,message:"Invalid HLS key at URL: "+s.uri,code:fl.FAILURE,xhr:s},e);const l=new DataView(a),u=new Uint32Array([l.getUint32(0),l.getUint32(4),l.getUint32(8),l.getUint32(12)]);for(let e=0;e<t.length;e++)t[e].bytes=u;const c={uri:s.uri};return i({type:"segmentkeyloadcomplete",segment:e,keyInfo:c}),n(null,e)},_l=(e,t)=>{t===pl&&e.transmuxer.postMessage({action:"initMp4WebVttParser",data:e.map.bytes})},Tl=(e,t,n)=>{t===pl&&hl({action:"getMp4WebVttText",data:e.bytes,transmuxer:e.transmuxer,callback:({data:t,mp4VttCues:i})=>{e.bytes=t,n(null,e,{mp4VttCues:i})}})},Sl=(e,t)=>{const n=Object(S["a"])(e.map.bytes);if("mp4"!==n){const i=e.map.resolvedUri||e.map.uri,r=n||"unknown";return t({internal:!0,message:`Found unsupported ${r} container for initialization segment at URL: ${i}`,code:fl.FAILURE,metadata:{mediaType:r}})}hl({action:"probeMp4Tracks",data:e.map.bytes,transmuxer:e.transmuxer,callback:({tracks:n,data:i})=>{return e.map.bytes=i,n.forEach(function(t){e.map.tracks=e.map.tracks||{},e.map.tracks[t.type]||(e.map.tracks[t.type]=t,"number"===typeof t.id&&t.timescale&&(e.map.timescales=e.map.timescales||{},e.map.timescales[t.id]=t.timescale),"text"===t.type&&_l(e,t.codec))}),t(null)}})},wl=({segment:e,finishProcessingFn:t,triggerSegmentEventFn:n})=>(i,r)=>{const s=yl(i,r);if(s)return t(s,e);const a=new Uint8Array(r.response);if(n({type:"segmentloaded",segment:e}),e.map.key)return e.map.encryptedBytes=a,t(null,e);e.map.bytes=a,Sl(e,function(n){if(n)return n.xhr=r,n.status=r.status,t(n,e);t(null,e)})},El=({segment:e,finishProcessingFn:t,responseType:n,triggerSegmentEventFn:i})=>(r,s)=>{const a=yl(r,s);if(a)return t(a,e);i({type:"segmentloaded",segment:e});const o="arraybuffer"!==n&&s.responseText?qo(s.responseText.substring(e.lastReachedChar||0)):s.response;return e.stats=ml(s),e.key?e.encryptedBytes=new Uint8Array(o):e.bytes=new Uint8Array(o),t(null,e)},xl=({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:f})=>{const p=e.map&&e.map.tracks||{},g=Boolean(p.audio&&p.video);let m=i.bind(null,e,"audio","start");const v=i.bind(null,e,"audio","end");let y=i.bind(null,e,"video","start");const b=i.bind(null,e,"video","end"),_=()=>ul({bytes:t,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,remux:g,onData:t=>{t.type="combined"===t.type?"video":t.type,c(e,t)},onTrackInfo:t=>{n&&(g&&(t.isMuxed=!0),n(e,t))},onAudioTimingInfo:e=>{m&&"undefined"!==typeof e.start&&(m(e.start),m=null),v&&"undefined"!==typeof e.end&&v(e.end)},onVideoTimingInfo:e=>{y&&"undefined"!==typeof e.start&&(y(e.start),y=null),b&&"undefined"!==typeof e.end&&b(e.end)},onVideoSegmentTimingInfo:t=>{const n={pts:{start:t.start.presentation,end:t.end.presentation},dts:{start:t.start.decode,end:t.end.decode}};f({type:"segmenttransmuxingtiminginfoavailable",segment:e,timingInfo:n}),r(t)},onAudioSegmentTimingInfo:t=>{const n={pts:{start:t.start.pts,end:t.end.pts},dts:{start:t.start.dts,end:t.end.dts}};f({type:"segmenttransmuxingtiminginfoavailable",segment:e,timingInfo:n}),s(t)},onId3:(t,n)=>{a(e,t,n)},onCaptions:t=>{o(e,[t])},isEndOfTimeline:l,onEndedTimeline:()=>{u()},onTransmuxerLog:h,onDone:(t,n)=>{d&&(t.type="combined"===t.type?"video":t.type,f({type:"segmenttransmuxingcomplete",segment:e}),d(n,e,t))},segment:e,triggerSegmentEventFn:f});hl({action:"probeTs",transmuxer:e.transmuxer,data:t,baseStartTime:e.baseStartTime,callback:i=>{e.bytes=t=i.data;const r=i.result;r&&(n(e,{hasAudio:r.hasAudio,hasVideo:r.hasVideo,isMuxed:g}),n=null),_()}})},kl=({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:f})=>{let p=new Uint8Array(t);if(Object(S["b"])(p)){e.isFmp4=!0;const{tracks:r}=e.map,s=r.text&&(!r.audio||!r.video);if(s)return c(e,{data:p,type:"text"}),void Tl(e,r.text.codec,d);const l={isFmp4:!0,hasVideo:!!r.video,hasAudio:!!r.audio};r.audio&&r.audio.codec&&"enca"!==r.audio.codec&&(l.audioCodec=r.audio.codec),r.video&&r.video.codec&&"encv"!==r.video.codec&&(l.videoCodec=r.video.codec),r.video&&r.audio&&(l.isMuxed=!0),n(e,l);const u=(t,n)=>{c(e,{data:p,type:l.hasAudio&&!l.isMuxed?"audio":"video"}),n&&n.length&&a(e,n),t&&t.length&&o(e,t),d(null,e,{})};hl({action:"probeMp4StartTime",timescales:e.map.timescales,data:p,transmuxer:e.transmuxer,callback:({data:n,startTime:s})=>{t=n.buffer,e.bytes=p=n,l.hasAudio&&!l.isMuxed&&i(e,"audio","start",s),l.hasVideo&&i(e,"video","start",s),hl({action:"probeEmsgID3",data:p,transmuxer:e.transmuxer,offset:s,callback:({emsgData:n,id3Frames:i})=>{t=n.buffer,e.bytes=p=n,r.video&&n.byteLength&&e.transmuxer?hl({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:e.transmuxer,data:p,timescales:e.map.timescales,trackIds:[r.video.id],callback:n=>{t=n.data.buffer,e.bytes=p=n.data,n.logs.forEach(function(e){h($s(e,{stream:"mp4CaptionParser"}))}),u(n.captions,i)}}):u(void 0,i)}})}})}else if(e.transmuxer){if("undefined"===typeof e.container&&(e.container=Object(S["a"])(p)),"ts"!==e.container&&"aac"!==e.container)return n(e,{hasAudio:!1,hasVideo:!1}),void d(null,e,{});xl({segment:e,bytes:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:f})}else d(null,e,{})},Al=function({id:e,key:t,encryptedBytes:n,decryptionWorker:i,segment:r,doneFn:s},a){const o=t=>{if(t.data.source===e){i.removeEventListener("message",o);const e=t.data.decrypted;a(new Uint8Array(e.bytes,e.byteOffset,e.byteLength))}};let l;i.onerror=(()=>{const e="An error occurred in the decryption worker",t=wu({segment:r}),n={message:e,metadata:{error:new Error(e),errorType:Ps.Error.StreamingFailedToDecryptSegment,segmentInfo:t,keyInfo:{uri:r.key.resolvedUri||r.map.key.resolvedUri}}};s(n,r)}),i.addEventListener("message",o),l=t.bytes.slice?t.bytes.slice():new Uint32Array(Array.prototype.slice.call(t.bytes)),i.postMessage(vo({source:e,encrypted:n,key:l,iv:t.iv}),[n.buffer,l.buffer])},Il=({decryptionWorker:e,segment:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:f})=>{f({type:"segmentdecryptionstart"}),Al({id:t.requestId,key:t.key,encryptedBytes:t.encryptedBytes,decryptionWorker:e,segment:t,doneFn:d},e=>{t.bytes=e,f({type:"segmentdecryptioncomplete",segment:t}),kl({segment:t,bytes:t.bytes,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:f})})},Cl=({activeXhrs:e,decryptionWorker:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:f})=>{let p=0,g=!1;return(m,v)=>{if(!g){if(m)return g=!0,gl(e),d(m,v);if(p+=1,p===e.length){const p=function(){if(v.encryptedBytes)return Il({decryptionWorker:t,segment:v,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:f});kl({segment:v,bytes:v.bytes,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c,doneFn:d,onTransmuxerLog:h,triggerSegmentEventFn:f})};if(v.endOfAllRequests=Date.now(),v.map&&v.map.encryptedBytes&&!v.map.bytes)return f({type:"segmentdecryptionstart",segment:v}),Al({decryptionWorker:t,id:v.requestId+"-init",encryptedBytes:v.map.encryptedBytes,key:v.map.key,segment:v,doneFn:d},t=>{v.map.bytes=t,f({type:"segmentdecryptioncomplete",segment:v}),Sl(v,t=>{if(t)return gl(e),d(t,v);p()})});p()}}}},Dl=({loadendState:e,abortFn:t})=>n=>{const i=n.target;i.aborted&&t&&!e.calledAbortFn&&(t(),e.calledAbortFn=!0)},Rl=({segment:e,progressFn:t,trackInfoFn:n,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:o,isEndOfTimeline:l,endedTimelineFn:u,dataFn:c})=>n=>{const i=n.target;if(!i.aborted)return e.stats=$s(e.stats,vl(n)),!e.stats.firstBytesReceivedAt&&e.stats.bytesReceived&&(e.stats.firstBytesReceivedAt=Date.now()),t(n,e)},Ml=({xhr:e,xhrOptions:t,decryptionWorker:n,segment:i,abortFn:r,progressFn:s,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:d,isEndOfTimeline:h,endedTimelineFn:f,dataFn:p,doneFn:g,onTransmuxerLog:m,triggerSegmentEventFn:v})=>{const y=[],b=Cl({activeXhrs:y,decryptionWorker:n,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:d,isEndOfTimeline:h,endedTimelineFn:f,dataFn:p,doneFn:g,onTransmuxerLog:m,triggerSegmentEventFn:v});if(i.key&&!i.key.bytes){const n=[i.key];i.map&&!i.map.bytes&&i.map.key&&i.map.key.resolvedUri===i.key.resolvedUri&&n.push(i.map.key);const r=$s(t,{uri:i.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),s=bl(i,n,b,v),a={uri:i.key.resolvedUri};v({type:"segmentkeyloadstart",segment:i,keyInfo:a});const o=e(r,s);y.push(o)}if(i.map&&!i.map.bytes){const n=i.map.key&&(!i.key||i.key.resolvedUri!==i.map.key.resolvedUri);if(n){const n=$s(t,{uri:i.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),r=bl(i,[i.map.key],b,v),s={uri:i.map.key.resolvedUri};v({type:"segmentkeyloadstart",segment:i,keyInfo:s});const a=e(n,r);y.push(a)}const r=$s(t,{uri:i.map.resolvedUri,responseType:"arraybuffer",headers:fo(i.map),requestType:"segment-media-initialization"}),s=wl({segment:i,finishProcessingFn:b,triggerSegmentEventFn:v});v({type:"segmentloadstart",segment:i});const a=e(r,s);y.push(a)}const _=$s(t,{uri:i.part&&i.part.resolvedUri||i.resolvedUri,responseType:"arraybuffer",headers:fo(i),requestType:"segment"}),T=El({segment:i,finishProcessingFn:b,responseType:_.responseType,triggerSegmentEventFn:v});v({type:"segmentloadstart",segment:i});const S=e(_,T);S.addEventListener("progress",Rl({segment:i,progressFn:s,trackInfoFn:a,timingInfoFn:o,videoSegmentTimingInfoFn:l,audioSegmentTimingInfoFn:u,id3Fn:c,captionsFn:d,isEndOfTimeline:h,endedTimelineFn:f,dataFn:p})),y.push(S);const w={};return y.forEach(e=>{e.addEventListener("loadend",Dl({loadendState:w,abortFn:r}))}),()=>gl(y)},Ll=Hs("PlaylistSelector"),Pl=function(e){if(!e||!e.playlist)return;const t=e.playlist;return JSON.stringify({id:t.id,bandwidth:e.bandwidth,width:e.width,height:e.height,codecs:t.attributes&&t.attributes.CODECS||""})},Ol=function(e,t){if(!e)return"";const n=r.a.getComputedStyle(e);return n?n[t]:""},Nl=function(e,t){const n=e.slice();e.sort(function(e,i){const r=t(e,i);return 0===r?n.indexOf(e)-n.indexOf(i):r})},Ul=function(e,t){let n,i;return e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||r.a.Number.MAX_VALUE,t.attributes.BANDWIDTH&&(i=t.attributes.BANDWIDTH),i=i||r.a.Number.MAX_VALUE,n-i},Fl=function(e,t){let n,i;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||r.a.Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(i=t.attributes.RESOLUTION.width),i=i||r.a.Number.MAX_VALUE,n===i&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:n-i};let Bl=function(e){const{main:t,bandwidth:n,playerWidth:i,playerHeight:s,playerObjectFit:a,limitRenditionByPlayerDimensions:o,playlistController:l}=e;if(!t)return;const u={bandwidth:n,width:i,height:s,limitRenditionByPlayerDimensions:o};let c=t.playlists;Ca.isAudioOnly(t)&&(c=l.getAudioTrackPlaylists_(),u.audioOnly=!0);let d=c.map(e=>{let t;const n=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,i=e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height;return t=e.attributes&&e.attributes.BANDWIDTH,t=t||r.a.Number.MAX_VALUE,{bandwidth:t,width:n,height:i,playlist:e}});Nl(d,(e,t)=>e.bandwidth-t.bandwidth),d=d.filter(e=>!Ca.isIncompatible(e.playlist));let h=d.filter(e=>Ca.isEnabled(e.playlist));h.length||(h=d.filter(e=>!Ca.isDisabled(e.playlist)));const f=h.filter(e=>e.bandwidth*zo.BANDWIDTH_VARIANCE<n);let p=f[f.length-1];const g=f.filter(e=>e.bandwidth===p.bandwidth)[0];if(!1===o){const e=g||h[0]||d[0];if(e&&e.playlist){let t="sortedPlaylistReps";return g&&(t="bandwidthBestRep"),h[0]&&(t="enabledPlaylistReps"),Ll(`choosing ${Pl(e)} using ${t} with options`,u),e.playlist}return Ll("could not choose a playlist with options",u),null}const m=f.filter(e=>e.width&&e.height);Nl(m,(e,t)=>e.width-t.width);const v=m.filter(e=>e.width===i&&e.height===s);p=v[v.length-1];const y=v.filter(e=>e.bandwidth===p.bandwidth)[0];let b,_,T,S;if(y||(b=m.filter(e=>{return"cover"===a?e.width>i&&e.height>s:e.width>i||e.height>s}),_=b.filter(e=>e.width===b[0].width&&e.height===b[0].height),p=_[_.length-1],T=_.filter(e=>e.bandwidth===p.bandwidth)[0]),l.leastPixelDiffSelector){const e=m.map(e=>{return e.pixelDiff=Math.abs(e.width-i)+Math.abs(e.height-s),e});Nl(e,(e,t)=>{return e.pixelDiff===t.pixelDiff?t.bandwidth-e.bandwidth:e.pixelDiff-t.pixelDiff}),S=e[0]}const w=S||T||y||g||h[0]||d[0];if(w&&w.playlist){let e="sortedPlaylistReps";return S?e="leastPixelDiffRep":T?e="resolutionPlusOneRep":y?e="resolutionBestRep":g?e="bandwidthBestRep":h[0]&&(e="enabledPlaylistReps"),Ll(`choosing ${Pl(w)} using ${e} with options`,u),w.playlist}return Ll("could not choose a playlist with options",u),null};const jl=function(){let e=this.useDevicePixelRatio&&r.a.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(e=this.customPixelRatio),Bl({main:this.playlists.main,bandwidth:this.systemBandwidth,playerWidth:parseInt(Ol(this.tech_.el(),"width"),10)*e,playerHeight:parseInt(Ol(this.tech_.el(),"height"),10)*e,playerObjectFit:this.usePlayerObjectFit?Ol(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})},Vl=function(e){let t=-1,n=-1;if(e<0||e>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let i=this.useDevicePixelRatio&&r.a.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(i=this.customPixelRatio),t<0&&(t=this.systemBandwidth,n=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==n&&(t=e*this.systemBandwidth+(1-e)*t,n=this.systemBandwidth),Bl({main:this.playlists.main,bandwidth:t,playerWidth:parseInt(Ol(this.tech_.el(),"width"),10)*i,playerHeight:parseInt(Ol(this.tech_.el(),"height"),10)*i,playerObjectFit:this.usePlayerObjectFit?Ol(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})}},Hl=function(e){const{main:t,currentTime:n,bandwidth:i,duration:r,segmentDuration:s,timeUntilRebuffer:a,currentTimeline:o,syncController:l}=e,u=t.playlists.filter(e=>!Ca.isIncompatible(e));let c=u.filter(Ca.isEnabled);c.length||(c=u.filter(e=>!Ca.isDisabled(e)));const d=c.filter(Ca.hasAttribute.bind(null,"BANDWIDTH")),h=d.map(e=>{const t=l.getSyncPoint(e,r,o,n),u=t?1:2,c=Ca.estimateSegmentRequestTime(s,i,e),d=c*u-a;return{playlist:e,rebufferingImpact:d}}),f=h.filter(e=>e.rebufferingImpact<=0);return Nl(f,(e,t)=>Ul(t.playlist,e.playlist)),f.length?f[0]:(Nl(h,(e,t)=>e.rebufferingImpact-t.rebufferingImpact),h[0]||null)},$l=function(){const e=this.playlists.main.playlists.filter(Ca.isEnabled);Nl(e,(e,t)=>Ul(e,t));const t=e.filter(e=>!!Ya(this.playlists.main,e).video);return t[0]||null},Gl=e=>{let t,n=0;return e.bytes&&(t=new Uint8Array(e.bytes),e.segments.forEach(e=>{t.set(e,n),n+=e.byteLength})),t};function zl(e){try{return new URL(e).pathname.split("/").slice(-2).join("/")}catch(e){return""}}const ql=function(e,t,n){if(!e[n]){t.trigger({type:"usage",name:"vhs-608"});let i=n;/^cc708_/.test(n)&&(i="SERVICE"+n.split("_")[1]);const r=t.textTracks().getTrackById(i);if(r)e[n]=r;else{const r=t.options_.vhs&&t.options_.vhs.captionServices||{};let s=n,a=n,o=!1;const l=r[i];l&&(s=l.label,a=l.language,o=l.default),e[n]=t.addRemoteTextTrack({kind:"captions",id:i,default:o,label:s,language:a},!1).track}}},Wl=function({inbandTextTracks:e,captionArray:t,timestampOffset:n}){if(!t)return;const i=r.a.WebKitDataCue||r.a.VTTCue;t.forEach(t=>{const r=t.stream;t.content?t.content.forEach(s=>{const a=new i(t.startTime+n,t.endTime+n,s.text);a.line=s.line,a.align="left",a.position=s.position,a.positionAlign="line-left",e[r].addCue(a)}):e[r].addCue(new i(t.startTime+n,t.endTime+n,t.text))})},Kl=function(e){Object.defineProperties(e.frame,{id:{get(){return Ps.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key}},value:{get(){return Ps.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data}},privateData:{get(){return Ps.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data}}})},Yl=({inbandTextTracks:e,metadataArray:t,timestampOffset:n,videoDuration:i})=>{if(!t)return;const s=r.a.WebKitDataCue||r.a.VTTCue,a=e.metadataTrack_;if(!a)return;if(t.forEach(e=>{const t=e.cueTime+n;!("number"!==typeof t||r.a.isNaN(t)||t<0)&&t<1/0&&e.frames&&e.frames.length&&e.frames.forEach(e=>{const n=new s(t,t,e.value||e.url||e.data||"");n.frame=e,n.value=e,Kl(n),a.addCue(n)})}),!a.cues||!a.cues.length)return;const o=a.cues,l=[];for(let r=0;r<o.length;r++)o[r]&&l.push(o[r]);const u=l.reduce((e,t)=>{const n=e[t.startTime]||[];return n.push(t),e[t.startTime]=n,e},{}),c=Object.keys(u).sort((e,t)=>Number(e)-Number(t));c.forEach((e,t)=>{const n=u[e],r=isFinite(i)?i:e,s=Number(c[t+1])||r;n.forEach(e=>{e.endTime=s})})},Xl={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},Ql=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),Zl=({inbandTextTracks:e,dateRanges:t})=>{const n=e.metadataTrack_;if(!n)return;const i=r.a.WebKitDataCue||r.a.VTTCue;t.forEach(e=>{for(const t of Object.keys(e)){if(Ql.has(t))continue;const r=new i(e.startTime,e.endTime,"");r.id=e.id,r.type="com.apple.quicktime.HLS",r.value={key:Xl[t],data:e[t]},"scte35Out"!==t&&"scte35In"!==t||(r.value.data=new Uint8Array(r.value.data.match(/[\da-f]{2}/gi)).buffer),n.addCue(r)}e.processDateRange()})},Jl=(e,t,n)=>{e.metadataTrack_||(e.metadataTrack_=n.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,Ps.browser.IS_ANY_SAFARI||(e.metadataTrack_.inBandMetadataTrackDispatchType=t))},eu=function(e,t,n){let i,r;if(n&&n.cues){i=n.cues.length;while(i--)r=n.cues[i],r.startTime>=e&&r.endTime<=t&&n.removeCue(r)}},tu=function(e){const t=e.cues;if(!t)return;const n={};for(let i=t.length-1;i>=0;i--){const r=t[i],s=`${r.startTime}-${r.endTime}-${r.text}`;n[s]?e.removeCue(r):n[s]=r}},nu=(e,t,n)=>{if("undefined"===typeof t||null===t||!e.length)return[];const i=Math.ceil((t-n+3)*w["ONE_SECOND_IN_TS"]);let r;for(r=0;r<e.length;r++)if(e[r].pts>i)break;return e.slice(r)},iu=(e,t,n)=>{if(!t.length)return e;if(n)return t.slice();const i=t[0].pts;let r=0;for(r;r<e.length;r++)if(e[r].pts>=i)break;return e.slice(0,r).concat(t)},ru=(e,t,n,i)=>{const r=Math.ceil((t-i)*w["ONE_SECOND_IN_TS"]),s=Math.ceil((n-i)*w["ONE_SECOND_IN_TS"]),a=e.slice();let o=e.length;while(o--)if(e[o].pts<=s)break;if(-1===o)return a;let l=o+1;while(l--)if(e[l].pts<=r)break;return l=Math.max(l,0),a.splice(l,o-l+1),a},su=function(e,t){if(!e&&!t||!e&&t||e&&!t)return!1;if(e===t)return!0;const n=Object.keys(e).sort(),i=Object.keys(t).sort();if(n.length!==i.length)return!1;for(let r=0;r<n.length;r++){const s=n[r];if(s!==i[r])return!1;if(e[s]!==t[s])return!1}return!0},au=function(e,t,n){t=t||[];const i=[];let r=0;for(let s=0;s<t.length;s++){const a=t[s];if(e===a.timeline&&(i.push(s),r+=a.duration,r>n))return s}return 0===i.length?0:i[i.length-1]},ou=1,lu=500,uu=e=>"number"===typeof e&&isFinite(e),cu=1/60,du=(e,t,n)=>{return"main"===e&&t&&n?n.hasAudio||n.hasVideo?t.hasVideo&&!n.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.hasVideo&&n.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null},hu=(e,t,n)=>{let i=t-zo.BACK_BUFFER_LENGTH;e.length&&(i=Math.max(i,e.start(0)));const r=t-n;return Math.min(r,i)},fu=e=>{const{startOfSegment:t,duration:n,segment:i,part:r,playlist:{mediaSequence:s,id:a,segments:o=[]},mediaIndex:l,partIndex:u,timeline:c}=e,d=o.length-1;let h="mediaIndex/partIndex increment";e.getMediaInfoForTime?h=`getMediaInfoForTime (${e.getMediaInfoForTime})`:e.isSyncRequest&&(h="getSyncSegmentCandidate (isSyncRequest)"),e.independent&&(h+=` with independent ${e.independent}`);const f="number"===typeof u,p=e.segment.uri?"segment":"pre-segment",g=f?la({preloadSegment:i})-1:0;return`${p} [${s+l}/${s+d}]`+(f?` part [${u}/${g}]`:"")+` segment start/end [${i.start} => ${i.end}]`+(f?` part start/end [${r.start} => ${r.end}]`:"")+` startOfSegment [${t}]`+` duration [${n}]`+` timeline [${c}]`+` selected by [${h}]`+` playlist [${a}]`},pu=e=>`${e}TimingInfo`,gu=({segmentTimeline:e,currentTimeline:t,startOfSegment:n,buffered:i,overrideCheck:r})=>{return r||e!==t?e<t?n:i.length?i.end(i.length-1):n:null},mu=({timelineChangeController:e,currentTimeline:t,segmentTimeline:n,loaderType:i,audioDisabled:r})=>{if(t===n)return!1;if("audio"===i){const t=e.lastTimelineChange({type:"main"});return!t||t.to!==n}if("main"===i&&r){const t=e.pendingTimelineChange({type:"audio"});return!t||t.to!==n}return!1},vu=e=>{if(!e)return!1;const t=e.pendingTimelineChange({type:"audio"}),n=e.pendingTimelineChange({type:"main"}),i=t&&n,r=i&&t.to!==n.to,s=i&&-1!==t.from&&-1!==n.from;return!(!s||!r)},yu=e=>{const t=e.timelineChangeController_.pendingTimelineChange({type:"audio"}),n=e.timelineChangeController_.pendingTimelineChange({type:"main"}),i=t&&n;return i&&t.to<n.to},bu=e=>{const t=e.pendingSegment_;if(!t)return;const n=mu({timelineChangeController:e.timelineChangeController_,currentTimeline:e.currentTimeline_,segmentTimeline:t.timeline,loaderType:e.loaderType_,audioDisabled:e.audioDisabled_});if(n&&vu(e.timelineChangeController_)){if(yu(e))return void e.timelineChangeController_.trigger("audioTimelineBehind");e.timelineChangeController_.trigger("fixBadTimelineChange")}},_u=e=>{let t=0;return["video","audio"].forEach(function(n){const i=e[`${n}TimingInfo`];if(!i)return;const{start:s,end:a}=i;let o;"bigint"===typeof s||"bigint"===typeof a?o=r.a.BigInt(a)-r.a.BigInt(s):"number"===typeof s&&"number"===typeof a&&(o=a-s),"undefined"!==typeof o&&o>t&&(t=o)}),"bigint"===typeof t&&t<Number.MAX_SAFE_INTEGER&&(t=Number(t)),t},Tu=({segmentDuration:e,maxDuration:t})=>{return!!e&&Math.round(e)>t+qs},Su=(e,t)=>{if("hls"!==t)return null;const n=_u({audioTimingInfo:e.audioTimingInfo,videoTimingInfo:e.videoTimingInfo});if(!n)return null;const i=e.playlist.targetDuration,r=Tu({segmentDuration:n,maxDuration:2*i}),s=Tu({segmentDuration:n,maxDuration:i}),a=`Segment with index ${e.mediaIndex} `+`from playlist ${e.playlist.id} `+`has a duration of ${n} `+`when the reported duration is ${e.duration} `+`and the target duration is ${i}. `+"For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1";return r||s?{severity:r?"warn":"info",message:a}:null},wu=({type:e,segment:t})=>{if(!t)return;const n=Boolean(t.key||t.map&&t.map.ke),i=Boolean(t.map&&!t.map.bytes),r=void 0===t.startOfSegment?t.start:t.startOfSegment;return{type:e||t.type,uri:t.resolvedUri||t.uri,start:r,duration:t.duration,isEncrypted:n,isMediaInitialization:i}};class Eu extends Ps.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if("function"!==typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=(()=>this.trigger("syncinfoupdate")),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=Hs(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(e){e!==this.state_&&(this.logger_(`${this.state_} -> ${e}`),this.state_=e,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():bu(this)}),this.sourceUpdater_.on("codecschange",e=>{this.trigger(h()({type:"codecschange"},e))}),"main"===this.loaderType_&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():bu(this)}),"audio"===this.loaderType_&&this.timelineChangeController_.on("timelinechange",e=>{this.trigger(h()({type:"timelinechange"},e)),this.hasEnoughInfoToLoad_()?this.processLoadQueue_():bu(this),this.hasEnoughInfoToAppend_()?this.processCallQueue_():bu(this)})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return dl.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&r.a.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if("WAITING"!==this.state)return this.pendingSegment_&&(this.pendingSegment_=null),void this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_);this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,r.a.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==e:(this.state="READY",!0)}error(e){return"undefined"!==typeof e&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&dl.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return Gs();if("main"===this.loaderType_){const{hasAudio:t,hasVideo:n,isMuxed:i}=e;if(n&&t&&!this.audioDisabled_&&!i)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const n=yo(e);let i=this.initSegments_[n];return t&&!i&&e.bytes&&(this.initSegments_[n]=i={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),i||e}segmentKey(e,t=!1){if(!e)return null;const n=bo(e);let i=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!i&&e.bytes&&(this.keyCache_[n]=i={resolvedUri:e.resolvedUri,bytes:e.bytes});const r={resolvedUri:(i||e).resolvedUri};return i&&(r.bytes=i.bytes),r}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),this.playlist_)return"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e)return;if(this.playlist_&&this.playlist_.endList&&e.endList&&this.playlist_.uri===e.uri)return;const n=this.playlist_,i=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,"INIT"===this.state&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(e));let r=null;if(n&&(n.id?r=n.id:n.uri&&(r=n.uri)),this.logger_(`playlist update [${r} => ${e.id||e.uri}]`),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_(`Playlist update:\ncurrentTime: ${this.currentTime_()}\nbufferedEnd: ${ia(this.buffered_())}\n`,this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri){if(null!==this.mediaIndex){const t=!e.endList&&"number"===typeof e.partTargetDuration;t?this.resetLoader():this.resyncLoader()}return this.currentMediaInfo_=void 0,void this.trigger("playlistupdate")}const s=e.mediaSequence-n.mediaSequence;if(this.logger_(`live window shift [${s}]`),null!==this.mediaIndex)if(this.mediaIndex-=s,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const e=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!e.parts||!e.parts.length||!e.parts[this.partIndex])){const e=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=e}}i&&(i.mediaIndex-=s,i.mediaIndex<0?(i.mediaIndex=null,i.partIndex=null):(i.mediaIndex>=0&&(i.segment=e.segments[i.mediaIndex]),i.partIndex>=0&&i.segment.parts&&(i.part=i.segment.parts[i.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(r.a.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return null===this.checkBufferTimeout_}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&dl.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4,t="hls"===this.sourceType_&&!e;t&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,n=(()=>{}),i=!1){if(t===1/0&&(t=this.duration_()),t<=e)return void this.logger_("skipping remove because end ${end} is <= start ${start}");if(!this.sourceUpdater_||!this.getMediaInfo_())return void this.logger_("skipping remove because no source updater or starting media info");let r=1;const s=()=>{r--,0===r&&n()};!i&&this.audioDisabled_||(r++,this.sourceUpdater_.removeAudio(e,t,s)),(i||"main"===this.loaderType_)&&(this.gopBuffer_=ru(this.gopBuffer_,e,t,this.timeMapping_),r++,this.sourceUpdater_.removeVideo(e,t,s));for(const a in this.inbandTextTracks_)eu(e,t,this.inbandTextTracks_[a]);eu(e,t,this.segmentMetadataTrack_),s()}monitorBuffer_(){this.checkBufferTimeout_&&r.a.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=r.a.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&r.a.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=r.a.setTimeout(this.monitorBufferTick_.bind(this),lu)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();if(!e)return;const t={segmentInfo:wu({type:this.loaderType_,segment:e})};this.trigger({type:"segmentselected",metadata:t}),"number"===typeof e.timestampOffset&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e)}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,n=this.partIndex){if(!t||!this.mediaSource_)return!1;const i="number"===typeof e&&t.segments[e],r=e+1===t.segments.length,s=!i||!i.parts||n+1===i.parts.length;return t.endList&&"open"===this.mediaSource_.readyState&&r&&s}chooseNextRequest_(){const e=this.buffered_(),t=ia(e)||0,n=ra(e,this.currentTime_()),i=!this.hasPlayed_()&&n>=1,r=n>=this.goalBufferLength_(),s=this.playlist_.segments;if(!s.length||i||r)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const a={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)};if(a.isSyncRequest)a.mediaIndex=au(this.currentTimeline_,s,t),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${a.mediaIndex}`);else if(null!==this.mediaIndex){const e=s[this.mediaIndex],n="number"===typeof this.partIndex?this.partIndex:-1;a.startOfSegment=e.end?e.end:t,e.parts&&e.parts[n+1]?(a.mediaIndex=this.mediaIndex,a.partIndex=n+1):a.mediaIndex=this.mediaIndex+1}else{let e,n,i;const r=this.fetchAtBuffer_?t:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_(`chooseNextRequest_ request after Quality Switch:\nFor TargetTime: ${r}.\nCurrentTime: ${this.currentTime_()}\nBufferedEnd: ${t}\nFetch At Buffer: ${this.fetchAtBuffer_}\n`,this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const t=this.getSyncInfoFromMediaSequenceSync_(r);if(!t){const e="No sync info found while using media sequence sync";return this.error({message:e,metadata:{errorType:Ps.Error.StreamingFailedToSelectNextSegment,error:new Error(e)}}),this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null}this.logger_(`chooseNextRequest_ mediaSequence syncInfo (${t.start} --\x3e ${t.end})`),e=t.segmentIndex,n=t.partIndex,i=t.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const t=Ca.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:r,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});e=t.segmentIndex,n=t.partIndex,i=t.startTime}a.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${r}`:`currentTime ${r}`,a.mediaIndex=e,a.startOfSegment=i,a.partIndex=n,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${a.mediaIndex} `)}const o=s[a.mediaIndex];let l=o&&"number"===typeof a.partIndex&&o.parts&&o.parts[a.partIndex];if(!o||"number"===typeof a.partIndex&&!l)return null;"number"!==typeof a.partIndex&&o.parts&&(a.partIndex=0,l=o.parts[0]);const u=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!n&&l&&!u&&!l.independent)if(0===a.partIndex){const e=s[a.mediaIndex-1],t=e.parts&&e.parts.length&&e.parts[e.parts.length-1];t&&t.independent&&(a.mediaIndex-=1,a.partIndex=e.parts.length-1,a.independent="previous segment")}else o.parts[a.partIndex-1].independent&&(a.partIndex-=1,a.independent="previous part");const c=this.mediaSource_&&"ended"===this.mediaSource_.readyState;return a.mediaIndex>=s.length-1&&c&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,a.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(a))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const t=Math.max(e,this.mediaSequenceSync_.start);e!==t&&this.logger_(`getSyncInfoFromMediaSequenceSync_. Pulled target time from ${e} to ${t}`);const n=this.mediaSequenceSync_.getSyncInfoForTime(t);if(!n)return null;if(!n.isAppended)return n;const i=this.mediaSequenceSync_.getSyncInfoForTime(n.end);return i?(i.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),i):null}generateSegmentInfo_(e){const{independent:t,playlist:n,mediaIndex:i,startOfSegment:r,isSyncRequest:s,partIndex:a,forceTimestampOffset:o,getMediaInfoForTime:l}=e,u=n.segments[i],c="number"===typeof a&&u.parts[a],d={requestId:"segment-loader-"+Math.random(),uri:c&&c.resolvedUri||u.resolvedUri,mediaIndex:i,partIndex:c?a:null,isSyncRequest:s,startOfSegment:r,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:u.timeline,duration:c&&c.duration||u.duration,segment:u,part:c,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:l,independent:t},h="undefined"!==typeof o?o:this.isPendingTimestampOffset_;d.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:u.timeline,currentTimeline:this.currentTimeline_,startOfSegment:r,buffered:this.buffered_(),overrideCheck:h});const f=ia(this.sourceUpdater_.audioBuffered());return"number"===typeof f&&(d.audioAppendStart=f-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(d.gopsToAlignWith=nu(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),d}timestampOffsetForSegment_(e){return gu(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return;if(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),n=e.bandwidth,i=this.pendingSegment_.duration,r=Ca.estimateSegmentRequestTime(i,n,this.playlist_,e.bytesReceived),s=ea(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(r<=s)return;const a=Hl({main:this.vhs_.playlists.main,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:i,timeUntilRebuffer:s,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!a)return;const o=r-s,l=o-a.rebufferingImpact;let u=.5;s<=qs&&(u=1),!a.playlist||a.playlist.uri===this.playlist_.uri||l<u||(this.bandwidth=a.playlist.attributes.BANDWIDTH*zo.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${fu(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||this.trigger("progress")}handleTrackInfo_(e,t){const{hasAudio:n,hasVideo:i}=t,r={segmentInfo:wu({type:this.loaderType_,segment:e}),trackInfo:{hasAudio:n,hasVideo:i}};this.trigger({type:"segmenttransmuxingtrackinfoavailable",metadata:r}),this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId)||this.checkForIllegalMediaSwitch(t)||(t=t||{},su(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),this.checkForAbort_(e.requestId)||(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()?this.processCallQueue_():bu(this)))}handleTimingInfo_(e,t,n,i){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const r=this.pendingSegment_,s=pu(t);r[s]=r[s]||{},r[s][n]=i,this.logger_(`timinginfo: ${t} - ${n} - ${i}`),this.hasEnoughInfoToAppend_()?this.processCallQueue_():bu(this)}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(0===t.length)return void this.logger_("SegmentLoader received no captions from a caption event");const n=this.pendingSegment_;if(!n.hasAppendedData_)return void this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));const i=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),r={};t.forEach(e=>{r[e.stream]=r[e.stream]||{startTime:1/0,captions:[],endTime:0};const t=r[e.stream];t.startTime=Math.min(t.startTime,e.startTime+i),t.endTime=Math.max(t.endTime,e.endTime+i),t.captions.push(e)}),Object.keys(r).forEach(e=>{const{startTime:t,endTime:n,captions:s}=r[e],a=this.inbandTextTracks_;this.logger_(`adding cues from ${t} -> ${n} for ${e}`),ql(a,this.vhs_.tech_,e),eu(t,n,a[e]),Wl({captionArray:s,inbandTextTracks:a,timestampOffset:i})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const i=this.pendingSegment_;i.hasAppendedData_?this.addMetadataToTextTrack(n,t,this.duration_()):this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,n))}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(e=>e())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(e=>e())}hasEnoughInfoToLoad_(){if("audio"!==this.loaderType_)return!0;const e=this.pendingSegment_;return!!e&&(!this.getCurrentMediaInfo_()||!mu({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready())return!1;if(this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:n,hasVideo:i,isMuxed:r}=t;return!(i&&!e.videoTimingInfo)&&(!(n&&!this.audioDisabled_&&!r&&!e.audioTimingInfo)&&!mu({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_())return bu(this),void this.callQueue_.push(this.handleData_.bind(this,e,t));const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),"closed"!==this.mediaSource_.readyState){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[pu(t.type)].start;else{const e=this.getCurrentMediaInfo_(),t="main"===this.loaderType_&&e&&e.hasVideo;let i;t&&(i=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:t,firstVideoFrameTimeForData:i,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,t.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:"main"===this.loaderType_});const e=this.chooseNextRequest_();if(e.mediaIndex!==n.mediaIndex||e.partIndex!==n.partIndex)return void this.logger_("sync segment was incorrect, not appending");this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,t)}}updateAppendInitSegmentStatus(e,t){"main"!==this.loaderType_||"number"!==typeof e.timestampOffset||e.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:n,playlist:i}){if(n){const e=yo(n);if(this.activeInitSegmentId_===e)return null;t=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=e}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=i,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n},i){const s=this.sourceUpdater_.audioBuffered(),a=this.sourceUpdater_.videoBuffered();s.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+ta(s).join(", ")),a.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+ta(a).join(", "));const o=s.length?s.start(0):0,l=s.length?s.end(s.length-1):0,u=a.length?a.start(0):0,c=a.length?a.end(a.length-1):0;if(l-o<=ou&&c-u<=ou)return this.logger_("On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. "+`Appended byte length: ${n.byteLength}, `+`audio buffer: ${ta(s).join(", ")}, `+`video buffer: ${ta(a).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:n}));const d=this.currentTime_(),h=d-ou;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${h}`),this.remove(0,h,()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${ou}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=r.a.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},1e3*ou)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:n},i){i&&(i.code!==Va?(this.logger_("Received non QUOTA_EXCEEDED_ERR on append",i),this.error({message:`${t} append of ${n.length}b failed for segment `+`#${e.mediaIndex} in playlist ${e.playlist.id}`,metadata:{errorType:Ps.Error.StreamingFailedToAppendSegment}}),this.trigger("appenderror")):this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n}))}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:n,data:i,bytes:r}){if(!r){const e=[i];let t=i.byteLength;n&&(e.unshift(n),t+=n.byteLength),r=Gl({bytes:t,segments:e})}const s={segmentInfo:wu({type:this.loaderType_,segment:e})};this.trigger({type:"segmentappendstart",metadata:s}),this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:r},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:r}))}handleSegmentTimingInfo_(e,t,n){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const i=this.pendingSegment_.segment,r=`${e}TimingInfo`;i[r]||(i[r]={}),i[r].transmuxerPrependedSeconds=n.prependedContentDuration||0,i[r].transmuxedPresentationStart=n.start.presentation,i[r].transmuxedDecodeStart=n.start.decode,i[r].transmuxedPresentationEnd=n.end.presentation,i[r].transmuxedDecodeEnd=n.end.decode,i[r].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,t){const{type:n,data:i}=t;if(!i||!i.byteLength)return;if("audio"===n&&this.audioDisabled_)return;const r=this.getInitSegmentAndUpdateState_({type:n,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:r,data:i})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),"number"===typeof e.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_())return bu(this),void this.loadQueue_.push(()=>{const t=h()({},e,{forceTimestampOffset:!0});h()(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),i=null!==this.mediaIndex,r=e.timeline!==this.currentTimeline_&&e.timeline>0,s=n||i&&r;this.logger_(`Requesting\n${zl(e.uri)}\n${fu(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=Ml({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:s,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:t,level:n,stream:i})=>{this.logger_(`${fu(e)} logged from transmuxer stream ${i} as a ${n}: ${t}`)},triggerSegmentEventFn:({type:e,segment:t,keyInfo:n,trackInfo:i,timingInfo:r})=>{const s=wu({segment:t}),a={segmentInfo:s};n&&(a.keyInfo=n),i&&(a.trackInfo=i),r&&(a.timingInfo=r),this.trigger({type:e,metadata:a})}})}trimBackBuffer_(e){const t=hu(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,n=e.part,i=e.segment.key||e.segment.map&&e.segment.map.key,r=e.segment.map&&!e.segment.map.bytes,s={resolvedUri:n?n.resolvedUri:t.resolvedUri,byterange:n?n.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part,type:this.loaderType_,start:e.startOfSegment,duration:e.duration,isEncrypted:i,isMediaInitialization:r},a=e.playlist.segments[e.mediaIndex-1];if(a&&a.timeline===t.timeline&&(a.videoTimingInfo?s.baseStartTime=a.videoTimingInfo.transmuxedDecodeEnd:a.audioTimingInfo&&(s.baseStartTime=a.audioTimingInfo.transmuxedDecodeEnd)),t.key){const n=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);s.key=this.segmentKey(t.key),s.key.iv=n}return t.map&&(s.map=this.initSegmentForMap(t.map)),s}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<cu)return void this.logger_(`Ignoring segment's bandwidth because its duration of ${e}`+` is less than the min to record ${cu}`);const n={bandwidthInfo:{from:this.bandwidth,to:t.bandwidth}};this.trigger({type:"bandwidthupdated",metadata:n}),this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,n){if(this.callQueue_.length)return void this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,n));if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return;if(t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===fl.ABORTED)return;return this.pause(),e.code===fl.TIMEOUT?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error"))}const i=this.pendingSegment_;this.saveBandwidthRelatedStats_(i.duration,t.stats),i.endOfAllRequests=t.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=iu(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(i)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);null!==t&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){"number"===typeof e.start&&"number"===typeof e.end?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return null!==e&&("main"===this.loaderType_&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset())}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:n,firstVideoFrameTimeForData:i,currentVideoTimestampOffset:r,useVideoTimingInfo:s,videoTimingInfo:a,audioTimingInfo:o}){if("undefined"!==typeof e)return e;if(!s)return o.start;const l=t.segments[n-1];return 0!==n&&l&&"undefined"!==typeof l.start&&l.end===i+r?a.start:i}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t)return this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),void this.trigger("error");const{hasAudio:n,hasVideo:i,isMuxed:r}=t,s="main"===this.loaderType_&&i,a=!this.audioDisabled_&&n&&!r;if(e.waitingOnAppends=0,!e.hasAppendedData_)return e.timingInfo||"number"!==typeof e.timestampOffset||(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),void this.checkAppendsDone_(e);s&&e.waitingOnAppends++,a&&e.waitingOnAppends++,s&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),a&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,0===e.waitingOnAppends&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=du(this.loaderType_,this.getCurrentMediaInfo_(),e);return!!t&&(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0)}updateSourceBufferTimestampOffset_(e){if(null===e.timestampOffset||"number"!==typeof e.timingInfo.start||e.changedTimestampOffset||"main"!==this.loaderType_)return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:n}){return this.useDtsForTimestampOffset_?e&&"number"===typeof e.transmuxedDecodeStart?e.transmuxedDecodeStart:t&&"number"===typeof t.transmuxedDecodeStart?t.transmuxedDecodeStart:n.start:n.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),n="main"===this.loaderType_&&t&&t.hasVideo,i=n&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;i&&(e.timingInfo.end="number"===typeof i.end?i.end:i.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_){const e={segmentInfo:wu({type:this.loaderType_,segment:this.pendingSegment_})};this.trigger({type:"appendsdone",metadata:e})}if(!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:"main"===this.loaderType_});const t=Su(e,this.sourceType_);if(t&&("warn"===t.severity?Ps.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_))return void this.logger_(`Throwing away un-appended sync request ${fu(e)}`);this.logger_(`Appended ${fu(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),"main"!==this.loaderType_||this.audioDisabled_||this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,i=e.part,r=n.end&&this.currentTime_()-n.end>3*e.playlist.targetDuration,s=i&&i.end&&this.currentTime_()-i.end>3*e.playlist.partTargetDuration;if(r||s)return this.logger_(`bad ${r?"segment":"part"} ${fu(e)}`),void this.resetEverything();const a=null!==this.mediaIndex;a&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<cu)return void this.logger_(`Ignoring segment's throughput because its duration of ${e.duration}`+` is less than the min to record ${cu}`);const t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,i=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(i-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,n=t.start,i=t.end;if(!uu(n)||!uu(i))return;eu(n,i,this.segmentMetadataTrack_);const s=r.a.WebKitDataCue||r.a.VTTCue,a={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:i},o=JSON.stringify(a),l=new s(n,i,o);l.value=a,this.segmentMetadataTrack_.addCue(l)}}function xu(){}const ku=function(e){return"string"!==typeof e?e:e.replace(/./,e=>e.toUpperCase())},Au=["video","audio"],Iu=(e,t)=>{const n=t[`${e}Buffer`];return n&&n.updating||t.queuePending[e]},Cu=(e,t)=>{for(let n=0;n<t.length;n++){const i=t[n];if("mediaSource"===i.type)return null;if(i.type===e)return n}return null},Du=(e,t)=>{if(0===t.queue.length)return;let n=0,i=t.queue[n];if("mediaSource"!==i.type){if("mediaSource"!==e&&t.ready()&&"closed"!==t.mediaSource.readyState&&!Iu(e,t)){if(i.type!==e){if(n=Cu(e,t.queue),null===n)return;i=t.queue[n]}return t.queue.splice(n,1),t.queuePending[e]=i,i.action(e,t),i.doneFn?void 0:(t.queuePending[e]=null,void Du(e,t))}}else t.updating()||"closed"===t.mediaSource.readyState||(t.queue.shift(),i.action(t),i.doneFn&&i.doneFn(),Du("audio",t),Du("video",t))},Ru=(e,t)=>{const n=t[`${e}Buffer`],i=ku(e);n&&(n.removeEventListener("updateend",t[`on${i}UpdateEnd_`]),n.removeEventListener("error",t[`on${i}Error_`]),t.codecs[e]=null,t[`${e}Buffer`]=null)},Mu=(e,t)=>e&&t&&-1!==Array.prototype.indexOf.call(e.sourceBuffers,t),Lu={appendBuffer:(e,t,n)=>(i,r)=>{const s=r[`${i}Buffer`];if(Mu(r.mediaSource,s)){r.logger_(`Appending segment ${t.mediaIndex}'s ${e.length} bytes to ${i}Buffer`);try{s.appendBuffer(e)}catch(e){r.logger_(`Error with code ${e.code} `+(e.code===Va?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${t.mediaIndex} to ${i}Buffer`),r.queuePending[i]=null,n(e)}}},remove:(e,t)=>(n,i)=>{const r=i[`${n}Buffer`];if(Mu(i.mediaSource,r)){i.logger_(`Removing ${e} to ${t} from ${n}Buffer`);try{r.remove(e,t)}catch(r){i.logger_(`Remove ${e} to ${t} from ${n}Buffer failed`)}}},timestampOffset:e=>(t,n)=>{const i=n[`${t}Buffer`];Mu(n.mediaSource,i)&&(n.logger_(`Setting ${t}timestampOffset to ${e}`),i.timestampOffset=e)},callback:e=>(t,n)=>{e()},endOfStream:e=>t=>{if("open"===t.mediaSource.readyState){t.logger_(`Calling mediaSource endOfStream(${e||""})`);try{t.mediaSource.endOfStream(e)}catch(e){Ps.log.warn("Failed to call media source endOfStream",e)}}},duration:e=>t=>{t.logger_(`Setting mediaSource duration to ${e}`);try{t.mediaSource.duration=e}catch(e){Ps.log.warn("Failed to set media source duration",e)}},abort:()=>(e,t)=>{if("open"!==t.mediaSource.readyState)return;const n=t[`${e}Buffer`];if(Mu(t.mediaSource,n)){t.logger_(`calling abort on ${e}Buffer`);try{n.abort()}catch(t){Ps.log.warn(`Failed to abort on ${e}Buffer`,t)}}},addSourceBuffer:(e,t)=>n=>{const i=ku(e),r=Object(g["e"])(t);n.logger_(`Adding ${e}Buffer with codec ${t} to mediaSource`);const s=n.mediaSource.addSourceBuffer(r);s.addEventListener("updateend",n[`on${i}UpdateEnd_`]),s.addEventListener("error",n[`on${i}Error_`]),n.codecs[e]=t,n[`${e}Buffer`]=s},removeSourceBuffer:e=>t=>{const n=t[`${e}Buffer`];if(Ru(e,t),Mu(t.mediaSource,n)){t.logger_(`Removing ${e}Buffer with codec ${t.codecs[e]} from mediaSource`);try{t.mediaSource.removeSourceBuffer(n)}catch(t){Ps.log.warn(`Failed to removeSourceBuffer ${e}Buffer`,t)}}},changeType:e=>(t,n)=>{const i=n[`${t}Buffer`],r=Object(g["e"])(e);if(!Mu(n.mediaSource,i))return;const s=e.substring(0,e.indexOf(".")),a=n.codecs[t],o=a.substring(0,a.indexOf("."));if(o===s)return;const l={codecsChangeInfo:{from:a,to:e}};n.trigger({type:"codecschange",metadata:l}),n.logger_(`changing ${t}Buffer codec from ${a} to ${e}`);try{i.changeType(r),n.codecs[t]=e}catch(e){l.errorType=Ps.Error.StreamingCodecsChangeError,l.error=e,e.metadata=l,n.error_=e,n.trigger("error"),Ps.log.warn(`Failed to changeType on ${t}Buffer`,e)}}},Pu=({type:e,sourceUpdater:t,action:n,doneFn:i,name:r})=>{t.queue.push({type:e,action:n,doneFn:i,name:r}),Du(e,t)},Ou=(e,t)=>n=>{const i=t[`${e}Buffered`](),r=zs(i);if(t.logger_(`received "updateend" event for ${e} Source Buffer: `,r),t.queuePending[e]){const n=t.queuePending[e].doneFn;t.queuePending[e]=null,n&&n(t[`${e}Error_`])}Du(e,t)};class Nu extends Ps.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=(()=>Du("mediaSource",this)),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=Hs("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=Ou("video",this),this.onAudioUpdateEnd_=Ou("audio",this),this.onVideoError_=(e=>{this.videoError_=e}),this.onAudioError_=(e=>{this.audioError_=e}),this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){Pu({type:"mediaSource",sourceUpdater:this,action:Lu.addSourceBuffer(e,t),name:"addSourceBuffer"})}abort(e){Pu({type:e,sourceUpdater:this,action:Lu.abort(e),name:"abort"})}removeSourceBuffer(e){this.canRemoveSourceBuffer()?Pu({type:"mediaSource",sourceUpdater:this,action:Lu.removeSourceBuffer(e),name:"removeSourceBuffer"}):Ps.log.error("removeSourceBuffer is not supported!")}canRemoveSourceBuffer(){return!Ps.browser.IS_FIREFOX&&r.a.MediaSource&&r.a.MediaSource.prototype&&"function"===typeof r.a.MediaSource.prototype.removeSourceBuffer}static canChangeType(){return r.a.SourceBuffer&&r.a.SourceBuffer.prototype&&"function"===typeof r.a.SourceBuffer.prototype.changeType}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){this.canChangeType()?Pu({type:e,sourceUpdater:this,action:Lu.changeType(t),name:"changeType"}):Ps.log.error("changeType is not supported!")}addOrChangeSourceBuffers(e){if(!e||"object"!==typeof e||0===Object.keys(e).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const n=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,n);this.canChangeType()&&this.changeType(t,n)})}appendBuffer(e,t){const{segmentInfo:n,type:i,bytes:r}=e;if(this.processedAppend_=!0,"audio"===i&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([e,t]),void this.logger_(`delayed audio append of ${r.length} until video append`);const s=t;if(Pu({type:i,sourceUpdater:this,action:Lu.appendBuffer(r,n||{mediaIndex:-1},s),doneFn:t,name:"appendBuffer"}),"video"===i){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const e=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${e.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,e.forEach(e=>{this.appendBuffer.apply(this,e)})}}audioBuffered(){return Mu(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:Gs()}videoBuffered(){return Mu(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:Gs()}buffered(){const e=Mu(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=Mu(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():Zs(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=xu){Pu({type:"mediaSource",sourceUpdater:this,action:Lu.duration(e),name:"duration",doneFn:t})}endOfStream(e=null,t=xu){"string"!==typeof e&&(e=void 0),Pu({type:"mediaSource",sourceUpdater:this,action:Lu.endOfStream(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,n=xu){this.audioBuffered().length&&0!==this.audioBuffered().end(0)?Pu({type:"audio",sourceUpdater:this,action:Lu.remove(e,t),doneFn:n,name:"remove"}):n()}removeVideo(e,t,n=xu){this.videoBuffered().length&&0!==this.videoBuffered().end(0)?Pu({type:"video",sourceUpdater:this,action:Lu.remove(e,t),doneFn:n,name:"remove"}):n()}updating(){return!(!Iu("audio",this)&&!Iu("video",this))}audioTimestampOffset(e){return"undefined"!==typeof e&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(Pu({type:"audio",sourceUpdater:this,action:Lu.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return"undefined"!==typeof e&&this.videoBuffer&&this.videoTimestampOffset_!==e&&(Pu({type:"video",sourceUpdater:this,action:Lu.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&Pu({type:"audio",sourceUpdater:this,action:Lu.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&Pu({type:"video",sourceUpdater:this,action:Lu.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),Au.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>Ru(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const Uu=e=>decodeURIComponent(escape(String.fromCharCode.apply(null,e))),Fu=e=>{const t=new Uint8Array(e);return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")},Bu=new Uint8Array("\n\n".split("").map(e=>e.charCodeAt(0)));class ju extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class Vu extends Eu{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return Gs();const e=this.subtitlesTrack_.cues,t=e[0].startTime,n=e[e.length-1].startTime;return Gs([[t,n]])}initSegmentForMap(e,t=!1){if(!e)return null;const n=yo(e);let i=this.initSegments_[n];if(t&&!i&&e.bytes){const t=Bu.byteLength+e.bytes.byteLength,r=new Uint8Array(t);r.set(e.bytes),r.set(Bu,e.bytes.byteLength),this.initSegments_[n]=i={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:r}}return i||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return"undefined"===typeof e?this.subtitlesTrack_:(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}remove(e,t){eu(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(null===this.syncController_.timestampOffsetForTimeline(e.timeline)){const e=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};return this.syncController_.one("timestampoffset",e),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){while(e&&e.segment.empty){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,n){if(!this.subtitlesTrack_)return void(this.state="READY");if(this.saveTransferStats_(t.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(e)return e.code===fl.TIMEOUT&&this.handleTimeout_(),e.code===fl.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(e);const i=this.pendingSegment_,s=n.mp4VttCues&&n.mp4VttCues.length;s&&(i.mp4VttCues=n.mp4VttCues),this.saveBandwidthRelatedStats_(i.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const a=i.segment;if(a.map&&(a.map.bytes=t.map.bytes),i.bytes=t.bytes,"function"!==typeof r.a.WebVTT&&"function"===typeof this.loadVttJs)return this.state="WAITING_ON_VTTJS",void this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,n),()=>this.stopForError({message:"Error loading vtt.js"}));a.requested=!0;try{this.parseVTTCues_(i)}catch(e){return void this.stopForError({message:e.message,metadata:{errorType:Ps.Error.StreamingVttParserError,error:e}})}if(s||this.updateTimeMapping_(i,this.syncController_.timelines[i.timeline],this.playlist_),i.cues.length?i.timingInfo={start:i.cues[0].startTime,end:i.cues[i.cues.length-1].endTime}:i.timingInfo={start:i.startOfSegment,end:i.startOfSegment+i.duration},i.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");i.byteLength=i.bytes.byteLength,this.mediaSecondsLoaded+=a.duration,i.cues.forEach(e=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new r.a.VTTCue(e.startTime,e.endTime,e.text):e)}),tu(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(e,t){const n=e&&"vtt"===e.type,i=t&&"text"===t.type,r=n&&i;r&&super.handleData_(e,t)}updateTimingInfoEnd_(){}parseMp4VttCues_(e){const t=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();e.mp4VttCues.forEach(n=>{const i=n.start+t,s=n.end+t,a=new r.a.VTTCue(i,s,n.cueText);n.settings&&n.settings.split(" ").forEach(e=>{const t=e.split(":"),n=t[0],i=t[1];a[n]=isNaN(i)?i:Number(i)}),e.cues.push(a)})}parseVTTCues_(e){let t,n=!1;if("function"!==typeof r.a.WebVTT)throw new ju;if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},e.mp4VttCues)return void this.parseMp4VttCues_(e);"function"===typeof r.a.TextDecoder?t=new r.a.TextDecoder("utf8"):(t=r.a.WebVTT.StringDecoder(),n=!0);const i=new r.a.WebVTT.Parser(r.a,r.a.vttjs,t);if(i.oncue=e.cues.push.bind(e.cues),i.ontimestampmap=(t=>{e.timestampmap=t}),i.onparsingerror=(e=>{Ps.log.warn("Error encountered when parsing cues: "+e.message)}),e.segment.map){let t=e.segment.map.bytes;n&&(t=Uu(t)),i.parse(t)}let s=e.bytes;n&&(s=Uu(s)),i.parse(s),i.flush()}updateTimeMapping_(e,t,n){const i=e.segment;if(!t)return;if(!e.cues.length)return void(i.empty=!0);const{MPEGTS:r,LOCAL:s}=e.timestampmap,a=r/w["ONE_SECOND_IN_TS"],o=a-s+t.mapping;if(e.cues.forEach(e=>{const n=e.endTime-e.startTime,i=this.handleRollover_(e.startTime+o,t.time);e.startTime=Math.max(i,0),e.endTime=Math.max(i+n,0)}),!n.syncInfo){const t=e.cues[0].startTime,r=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(t,r-i.duration)}}}handleRollover_(e,t){if(null===t)return e;let n=e*w["ONE_SECOND_IN_TS"];const i=t*w["ONE_SECOND_IN_TS"];let r;r=i<n?-8589934592:8589934592;while(Math.abs(n-i)>4294967296)n+=r;return n/w["ONE_SECOND_IN_TS"]}}const Hu=function(e,t){const n=e.cues;for(let i=0;i<n.length;i++){const e=n[i];if(t>=e.adStartTime&&t<=e.adEndTime)return e}return null},$u=function(e,t,n=0){if(!e.segments)return;let i,s=n;for(let a=0;a<e.segments.length;a++){const n=e.segments[a];if(i||(i=Hu(t,s+n.duration/2)),i){if("cueIn"in n){i.endTime=s,i.adEndTime=s,s+=n.duration,i=null;continue}if(s<i.endTime){s+=n.duration;continue}i.endTime+=n.duration}else if("cueOut"in n&&(i=new r.a.VTTCue(s,s+n.duration,n.cueOut),i.adStartTime=s,i.adEndTime=s+parseFloat(n.cueOut),t.addCue(i)),"cueOutCont"in n){const[e,a]=n.cueOutCont.split("/").map(parseFloat);i=new r.a.VTTCue(s,s+n.duration,""),i.adStartTime=s-e,i.adEndTime=i.adStartTime+a,t.addCue(i)}s+=n.duration}};class Gu{constructor({start:e,end:t,segmentIndex:n,partIndex:i=null,appended:r=!1}){this.start_=e,this.end_=t,this.segmentIndex_=n,this.partIndex_=i,this.appended_=r}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class zu{constructor(e,t=[]){this.segmentSyncInfo_=e,this.partsSyncInfo_=t}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class qu{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,t){const{mediaSequence:n,segments:i}=e;if(this.isReliable_=this.isReliablePlaylist_(n,i),this.isReliable_)return this.updateStorage_(i,n,this.calculateBaseTime_(n,i,t))}getSyncInfoForTime(e){for(const{segmentSyncInfo:t,partsSyncInfo:n}of this.storage_.values())if(n.length){for(const i of n)if(i.isInRange(e))return i}else if(t.isInRange(e))return t;return null}getSyncInfoForMediaSequence(e){return this.storage_.get(e)}updateStorage_(e,t,n){const i=new Map;let r="\n",s=n,a=t;this.start_=s,e.forEach((e,t)=>{const n=this.storage_.get(a),o=s,l=o+e.duration,u=Boolean(n&&n.segmentSyncInfo&&n.segmentSyncInfo.isAppended),c=new Gu({start:o,end:l,appended:u,segmentIndex:t});e.syncInfo=c;let d=s;const h=(e.parts||[]).map((e,i)=>{const s=d,o=d+e.duration,l=Boolean(n&&n.partsSyncInfo&&n.partsSyncInfo[i]&&n.partsSyncInfo[i].isAppended),u=new Gu({start:s,end:o,appended:l,segmentIndex:t,partIndex:i});return d=o,r+=`Media Sequence: ${a}.${i} | Range: ${s} --\x3e ${o} | Appended: ${l}\n`,e.syncInfo=u,u});i.set(a,new zu(c,h)),r+=`${zl(e.resolvedUri)} | Media Sequence: ${a} | Range: ${o} --\x3e ${l} | Appended: ${u}\n`,a++,s=l}),this.end_=s,this.storage_=i,this.diagnostics_=r}calculateBaseTime_(e,t,n){if(!this.storage_.size)return 0;if(this.storage_.has(e))return this.storage_.get(e).segmentSyncInfo.start;const i=Math.min(...this.storage_.keys());if(e<i){const n=i-e;let r=this.storage_.get(i).segmentSyncInfo.start;for(let e=0;e<n;e++){const n=t[e];r-=n.duration}return r}return n}isReliablePlaylist_(e,t){return void 0!==e&&null!==e&&Array.isArray(t)&&t.length}}class Wu extends qu{constructor(e){super(),this.parent_=e}calculateBaseTime_(e,t,n){if(!this.storage_.size){const t=this.parent_.getSyncInfoForMediaSequence(e);return t?t.segmentSyncInfo.start:0}return super.calculateBaseTime_(e,t,n)}}const Ku=86400,Yu=[{name:"VOD",run:(e,t,n,i,r)=>{if(n!==1/0){const e={time:0,segmentIndex:0,partIndex:null};return e}return null}},{name:"MediaSequence",run:(e,t,n,i,r,s)=>{const a=e.getMediaSequenceSync(s);if(!a)return null;if(!a.isReliable)return null;const o=a.getSyncInfoForTime(r);return o?{time:o.start,partIndex:o.partIndex,segmentIndex:o.segmentIndex}:null}},{name:"ProgramDateTime",run:(e,t,n,i,r)=>{if(!Object.keys(e.timelineToDatetimeMappings).length)return null;let s=null,a=null;const o=aa(t);r=r||0;for(let l=0;l<o.length;l++){const n=t.endList||0===r?l:o.length-(l+1),i=o[n],u=i.segment,c=e.timelineToDatetimeMappings[u.timeline];if(!c||!u.dateTimeObject)continue;const d=u.dateTimeObject.getTime()/1e3;let h=d+c;if(u.parts&&"number"===typeof i.partIndex)for(let e=0;e<i.partIndex;e++)h+=u.parts[e].duration;const f=Math.abs(r-h);if(null!==a&&(0===f||a<f))break;a=f,s={time:h,segmentIndex:i.segmentIndex,partIndex:i.partIndex}}return s}},{name:"Segment",run:(e,t,n,i,r)=>{let s=null,a=null;r=r||0;const o=aa(t);for(let l=0;l<o.length;l++){const e=t.endList||0===r?l:o.length-(l+1),n=o[e],u=n.segment,c=n.part&&n.part.start||u&&u.start;if(u.timeline===i&&"undefined"!==typeof c){const e=Math.abs(r-c);if(null!==a&&a<e)break;(!s||null===a||a>=e)&&(a=e,s={time:c,segmentIndex:n.segmentIndex,partIndex:n.partIndex})}}return s}},{name:"Discontinuity",run:(e,t,n,i,r)=>{let s=null;if(r=r||0,t.discontinuityStarts&&t.discontinuityStarts.length){let n=null;for(let i=0;i<t.discontinuityStarts.length;i++){const a=t.discontinuityStarts[i],o=t.discontinuitySequence+i+1,l=e.discontinuities[o];if(l){const e=Math.abs(r-l.time);if(null!==n&&n<e)break;(!s||null===n||n>=e)&&(n=e,s={time:l.time,segmentIndex:a,partIndex:null})}}}return s}},{name:"Playlist",run:(e,t,n,i,r)=>{if(t.syncInfo){const e={time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence,partIndex:null};return e}return null}}];class Xu extends Ps.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={};const t=new qu,n=new Wu(t),i=new Wu(t);this.mediaSequenceStorage_={main:t,audio:n,vtt:i},this.logger_=Hs("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,t,n,i,r){if(t!==1/0){const n=Yu.find(({name:e})=>"VOD"===e);return n.run(this,e,t)}const s=this.runStrategies_(e,t,n,i,r);if(!s.length)return null;for(const a of s){const{syncPoint:t,strategy:n}=a,{segmentIndex:r,time:s}=t;if(r<0)continue;const o=e.segments[r],l=s,u=l+o.duration;if(this.logger_(`Strategy: ${n}. Current time: ${i}. selected segment: ${r}. Time: [${l} -> ${u}]}`),i>=l&&i<u)return this.logger_("Found sync point with exact match: ",t),t}return this.selectSyncPoint_(s,{key:"time",value:i})}getExpiredTime(e,t){if(!e||!e.segments)return null;const n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;const i=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return i.segmentIndex>0&&(i.time*=-1),Math.abs(i.time+pa({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:i.segmentIndex,endIndex:0}))}runStrategies_(e,t,n,i,r){const s=[];for(let a=0;a<Yu.length;a++){const o=Yu[a],l=o.run(this,e,t,n,i,r);l&&(l.strategy=o.name,s.push({strategy:o.name,syncPoint:l}))}return s}selectSyncPoint_(e,t){let n=e[0].syncPoint,i=Math.abs(e[0].syncPoint[t.key]-t.value),r=e[0].strategy;for(let s=1;s<e.length;s++){const a=Math.abs(e[s].syncPoint[t.key]-t.value);a<i&&(i=a,n=e[s].syncPoint,r=e[s].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy`+` [${r}]: [time:${n.time},`+` segmentIndex:${n.segmentIndex}`+("number"===typeof n.partIndex?`,partIndex:${n.partIndex}`:"")+"]"),n}saveExpiredSegmentInfo(e,t){const n=t.mediaSequence-e.mediaSequence;if(n>Ku)Ps.log.warn(`Not saving expired segment info. Media sequence gap ${n} is too large.`);else for(let i=n-1;i>=0;i--){const n=e.segments[i];if(n&&"undefined"!==typeof n.start){t.syncInfo={mediaSequence:e.mediaSequence+i,time:n.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time},`+` mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],n=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-n}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const n=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),i=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:i.start}));const r=i.dateTimeObject;i.discontinuity&&t&&r&&(this.timelineToDatetimeMappings[i.timeline]=-r.getTime()/1e3)}timestampOffsetForTimeline(e){return"undefined"===typeof this.timelines[e]?null:this.timelines[e].time}mappingForTimeline(e){return"undefined"===typeof this.timelines[e]?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,n){const i=e.segment,r=e.part;let s,a,o=this.timelines[e.timeline];if("number"===typeof e.timestampOffset)o={time:e.startOfSegment,mapping:e.startOfSegment-t.start},n&&(this.timelines[e.timeline]=o,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: `+`[time: ${o.time}] [mapping: ${o.mapping}]`)),s=e.startOfSegment,a=t.end+o.mapping;else{if(!o)return!1;s=t.start+o.mapping,a=t.end+o.mapping}return r&&(r.start=s,r.end=a),(!i.start||s<i.start)&&(i.start=s),i.end=a,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let i=0;i<t.discontinuityStarts.length;i++){const r=t.discontinuityStarts[i],s=t.discontinuitySequence+i+1,a=r-e.mediaIndex,o=Math.abs(a);if(!this.discontinuities[s]||this.discontinuities[s].accuracy>o){let i;i=a<0?n.start-pa({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:r}):n.end+pa({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:r}),this.discontinuities[s]={time:i,accuracy:o}}}}dispose(){this.trigger("dispose"),this.off()}}class Qu extends Ps.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:n}){return"number"===typeof t&&"number"===typeof n&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:n}){if("number"===typeof t&&"number"===typeof n){this.lastTimelineChanges_[e]={type:e,from:t,to:n},delete this.pendingTimelineChanges_[e];const i={timelineChangeInfo:{from:t,to:n}};this.trigger({type:"timelinechange",metadata:i})}return this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const Zu=Xo(Qo(function(){var t=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,a=0;a<s;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}();
/*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */function n(e){return e.subarray(0,e.byteLength-e[e.byteLength-1])}
/*! @name aes-decrypter @version 4.0.2 @license Apache-2.0 */const i=function(){const e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],n=e[1],i=t[4],r=n[4];let s,a,o;const l=[],u=[];let c,d,h,f,p,g;for(s=0;s<256;s++)u[(l[s]=s<<1^283*(s>>7))^s]=s;for(a=o=0;!i[a];a^=c||1,o=u[o]||1)for(f=o^o<<1^o<<2^o<<3^o<<4,f=f>>8^255&f^99,i[a]=f,r[f]=a,h=l[d=l[c=l[a]]],g=16843009*h^65537*d^257*c^16843008*a,p=257*l[f]^16843008*f,s=0;s<4;s++)t[s][a]=p=p<<24^p>>>8,n[s][f]=g=g<<24^g>>>8;for(s=0;s<5;s++)t[s]=t[s].slice(0),n[s]=n[s].slice(0);return e};let r=null;class s{constructor(e){let t,n,s;r||(r=i()),this._tables=[[r[0][0].slice(),r[0][1].slice(),r[0][2].slice(),r[0][3].slice(),r[0][4].slice()],[r[1][0].slice(),r[1][1].slice(),r[1][2].slice(),r[1][3].slice(),r[1][4].slice()]];const a=this._tables[0][4],o=this._tables[1],l=e.length;let u=1;if(4!==l&&6!==l&&8!==l)throw new Error("Invalid aes key size");const c=e.slice(0),d=[];for(this._key=[c,d],t=l;t<4*l+28;t++)s=c[t-1],(t%l===0||8===l&&t%l===4)&&(s=a[s>>>24]<<24^a[s>>16&255]<<16^a[s>>8&255]<<8^a[255&s],t%l===0&&(s=s<<8^s>>>24^u<<24,u=u<<1^283*(u>>7))),c[t]=c[t-l]^s;for(n=0;t;n++,t--)s=c[3&n?t:t-4],d[n]=t<=4||n<4?s:o[0][a[s>>>24]]^o[1][a[s>>16&255]]^o[2][a[s>>8&255]]^o[3][a[255&s]]}decrypt(e,t,n,i,r,s){const a=this._key[1];let o,l,u,c=e^a[0],d=i^a[1],h=n^a[2],f=t^a[3];const p=a.length/4-2;let g,m=4;const v=this._tables[1],y=v[0],b=v[1],_=v[2],T=v[3],S=v[4];for(g=0;g<p;g++)o=y[c>>>24]^b[d>>16&255]^_[h>>8&255]^T[255&f]^a[m],l=y[d>>>24]^b[h>>16&255]^_[f>>8&255]^T[255&c]^a[m+1],u=y[h>>>24]^b[f>>16&255]^_[c>>8&255]^T[255&d]^a[m+2],f=y[f>>>24]^b[c>>16&255]^_[d>>8&255]^T[255&h]^a[m+3],m+=4,c=o,d=l,h=u;for(g=0;g<4;g++)r[(3&-g)+s]=S[c>>>24]<<24^S[d>>16&255]<<16^S[h>>8&255]<<8^S[255&f]^a[m++],o=c,c=d,d=h,h=f,f=o}}class a extends t{constructor(){super(t),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const o=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},l=function(e,t,n){const i=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),r=new s(Array.prototype.slice.call(t)),a=new Uint8Array(e.byteLength),l=new Int32Array(a.buffer);let u,c,d,h,f,p,g,m,v;for(u=n[0],c=n[1],d=n[2],h=n[3],v=0;v<i.length;v+=4)f=o(i[v]),p=o(i[v+1]),g=o(i[v+2]),m=o(i[v+3]),r.decrypt(f,p,g,m,l,v),l[v]=o(l[v]^u),l[v+1]=o(l[v+1]^c),l[v+2]=o(l[v+2]^d),l[v+3]=o(l[v+3]^h),u=f,c=p,d=g,h=m;return a};class u{constructor(e,t,i,r){const s=u.STEP,l=new Int32Array(e.buffer),c=new Uint8Array(e.byteLength);let d=0;for(this.asyncStream_=new a,this.asyncStream_.push(this.decryptChunk_(l.subarray(d,d+s),t,i,c)),d=s;d<l.length;d+=s)i=new Uint32Array([o(l[d-4]),o(l[d-3]),o(l[d-2]),o(l[d-1])]),this.asyncStream_.push(this.decryptChunk_(l.subarray(d,d+s),t,i,c));this.asyncStream_.push(function(){r(null,n(c))})}static get STEP(){return 32e3}decryptChunk_(e,t,n,i){return function(){const r=l(e,t,n);i.set(r,e.byteOffset)}}}var c,d="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof e?e:"undefined"!==typeof self?self:{};c="undefined"!==typeof window?window:"undefined"!==typeof d?d:"undefined"!==typeof self?self:{};var h=c,f=function(e){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},p=h.BigInt||Number;p("0x1"),p("0x100"),p("0x10000"),p("0x1000000"),p("0x100000000"),p("0x10000000000"),p("0x1000000000000"),p("0x100000000000000"),p("0x10000000000000000"),function(){var e=new Uint16Array([65484]),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);255===t[0]||t[0]}();const g=function(e){const t={};return Object.keys(e).forEach(n=>{const i=e[n];f(i)?t[n]={bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:t[n]=i}),t};self.onmessage=function(e){const t=e.data,n=new Uint8Array(t.encrypted.bytes,t.encrypted.byteOffset,t.encrypted.byteLength),i=new Uint32Array(t.key.bytes,t.key.byteOffset,t.key.byteLength/4),r=new Uint32Array(t.iv.bytes,t.iv.byteOffset,t.iv.byteLength/4);new u(n,i,r,function(e,n){self.postMessage(g({source:t.source,decrypted:n}),[n.buffer])})}}));var Ju=Yo(Zu);const ec=e=>{let t=e.default?"main":"alternative";return e.characteristics&&e.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},tc=(e,t)=>{e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},nc=(e,t)=>{t.activePlaylistLoader=e,e.load()},ic=(e,t)=>()=>{const{segmentLoaders:{[e]:n,main:i},mediaTypes:{[e]:r}}=t,s=r.activeTrack(),a=r.getActiveGroup(),o=r.activePlaylistLoader,l=r.lastGroup_;a&&l&&a.id===l.id||(r.lastGroup_=a,r.lastTrack_=s,tc(n,r),a&&!a.isMainPlaylist&&(a.playlistLoader?(n.resyncLoader(),nc(a.playlistLoader,r)):o&&i.resetEverything()))},rc=(e,t)=>()=>{const{segmentLoaders:{[e]:n},mediaTypes:{[e]:i}}=t;i.lastGroup_=null,n.abort(),n.pause()},sc=(e,t)=>()=>{const{mainPlaylistLoader:n,segmentLoaders:{[e]:i,main:r},mediaTypes:{[e]:s}}=t,a=s.activeTrack(),o=s.getActiveGroup(),l=s.activePlaylistLoader,u=s.lastTrack_;if((!u||!a||u.id!==a.id)&&(s.lastGroup_=o,s.lastTrack_=a,tc(i,s),o)){if(o.isMainPlaylist){if(!a||!u||a.id===u.id)return;const e=t.vhs.playlistController_,i=e.selectPlaylist();if(e.media()===i)return;return s.logger_(`track change. Switching main audio from ${u.id} to ${a.id}`),n.pause(),r.resetEverything(),void e.fastQualityChange_(i)}if("AUDIO"===e){if(!o.playlistLoader)return r.setAudio(!0),void r.resetEverything();i.setAudio(!0),r.setAudio(!1)}l!==o.playlistLoader?(i.track&&i.track(a),i.resetEverything(),nc(o.playlistLoader,s)):nc(o.playlistLoader,s)}},ac={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:n},excludePlaylist:i}=t,r=n.activeTrack(),s=n.activeGroup(),a=(s.filter(e=>e.default)[0]||s[0]).id,o=n.tracks[a];if(r!==o){Ps.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const e in n.tracks)n.tracks[e].enabled=n.tracks[e]===o;n.onTrackChanged()}else i({error:{message:"Problem encountered loading the default audio track."}})},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:n}}=t;Ps.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const i=n.activeTrack();i&&(i.mode="disabled"),n.onTrackChanged()}},oc={AUDIO:(e,t,n)=>{if(!t)return;const{tech:i,requestOptions:r,segmentLoaders:{[e]:s}}=n;t.on("loadedmetadata",()=>{const e=t.media();s.playlist(e,r),(!i.paused()||e.endList&&"none"!==i.preload())&&s.load()}),t.on("loadedplaylist",()=>{s.playlist(t.media(),r),i.paused()||s.load()}),t.on("error",ac[e](e,n))},SUBTITLES:(e,t,n)=>{const{tech:i,requestOptions:r,segmentLoaders:{[e]:s},mediaTypes:{[e]:a}}=n;t.on("loadedmetadata",()=>{const e=t.media();s.playlist(e,r),s.track(a.activeTrack()),(!i.paused()||e.endList&&"none"!==i.preload())&&s.load()}),t.on("loadedplaylist",()=>{s.playlist(t.media(),r),i.paused()||s.load()}),t.on("error",ac[e](e,n))}},lc={AUDIO:(e,t)=>{const{vhs:n,sourceType:i,segmentLoaders:{[e]:r},requestOptions:s,main:{mediaGroups:a},mediaTypes:{[e]:{groups:o,tracks:l,logger_:u}},mainPlaylistLoader:c}=t,d=Ia(c.main);a[e]&&0!==Object.keys(a[e]).length||(a[e]={main:{default:{default:!0}}},d&&(a[e].main.default.playlists=c.main.playlists));for(const h in a[e]){o[h]||(o[h]=[]);for(const r in a[e][h]){let f,p=a[e][h][r];if(d?(u(`AUDIO group '${h}' label '${r}' is a main playlist`),p.isMainPlaylist=!0,f=null):f="vhs-json"===i&&p.playlists?new ao(p.playlists[0],n,s):p.resolvedUri?new ao(p.resolvedUri,n,s):p.playlists&&"dash"===i?new Go(p.playlists[0],n,s,c):null,p=$s({id:r,playlistLoader:f},p),oc[e](e,p.playlistLoader,t),o[h].push(p),"undefined"===typeof l[r]){const e=new Ps.AudioTrack({id:r,kind:ec(p),enabled:!1,language:p.language,default:p.default,label:r});l[r]=e}}}r.on("error",ac[e](e,t))},SUBTITLES:(e,t)=>{const{tech:n,vhs:i,sourceType:r,segmentLoaders:{[e]:s},requestOptions:a,main:{mediaGroups:o},mediaTypes:{[e]:{groups:l,tracks:u}},mainPlaylistLoader:c}=t;for(const d in o[e]){l[d]||(l[d]=[]);for(const s in o[e][d]){if(!i.options_.useForcedSubtitles&&o[e][d][s].forced)continue;let h,f=o[e][d][s];if("hls"===r)h=new ao(f.resolvedUri,i,a);else if("dash"===r){const e=f.playlists.filter(e=>e.excludeUntil!==1/0);if(!e.length)return;h=new Go(f.playlists[0],i,a,c)}else"vhs-json"===r&&(h=new ao(f.playlists?f.playlists[0]:f.resolvedUri,i,a));if(f=$s({id:s,playlistLoader:h},f),oc[e](e,f.playlistLoader,t),l[d].push(f),"undefined"===typeof u[s]){const e=n.addRemoteTextTrack({id:s,kind:"subtitles",default:f.default&&f.autoselect,language:f.language,label:s},!1).track;u[s]=e}}}s.on("error",ac[e](e,t))},"CLOSED-CAPTIONS":(e,t)=>{const{tech:n,main:{mediaGroups:i},mediaTypes:{[e]:{groups:r,tracks:s}}}=t;for(const a in i[e]){r[a]||(r[a]=[]);for(const t in i[e][a]){const o=i[e][a][t];if(!/^(?:CC|SERVICE)/.test(o.instreamId))continue;const l=n.options_.vhs&&n.options_.vhs.captionServices||{};let u={label:t,language:o.language,instreamId:o.instreamId,default:o.default&&o.autoselect};if(l[u.instreamId]&&(u=$s(u,l[u.instreamId])),void 0===u.default&&delete u.default,r[a].push($s({id:t},o)),"undefined"===typeof s[t]){const e=n.addRemoteTextTrack({id:u.instreamId,kind:"captions",default:u.default,language:u.language,label:u.label},!1).track;s[t]=e}}}}},uc=(e,t)=>{for(let n=0;n<e.length;n++){if(ka(t,e[n]))return!0;if(e[n].playlists&&uc(e[n].playlists,t))return!0}return!1},cc=(e,t)=>n=>{const{mainPlaylistLoader:i,mediaTypes:{[e]:{groups:r}}}=t,s=i.media();if(!s)return null;let a=null;s.attributes[e]&&(a=r[s.attributes[e]]);const o=Object.keys(r);if(!a)if("AUDIO"===e&&o.length>1&&Ia(t.main))for(let e=0;e<o.length;e++){const t=r[o[e]];if(uc(t,s)){a=t;break}}else r.main?a=r.main:1===o.length&&(a=r[o[0]]);return"undefined"===typeof n?a:null!==n&&a&&a.filter(e=>e.id===n.id)[0]||null},dc={AUDIO:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:n}}}=t;for(const e in n)if(n[e].enabled)return n[e];return null},SUBTITLES:(e,t)=>()=>{const{mediaTypes:{[e]:{tracks:n}}}=t;for(const e in n)if("showing"===n[e].mode||"hidden"===n[e].mode)return n[e];return null}},hc=(e,{mediaTypes:t})=>()=>{const n=t[e].activeTrack();return n?t[e].activeGroup(n):null},fc=e=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(t=>{lc[t](t,e)});const{mediaTypes:t,mainPlaylistLoader:n,tech:i,vhs:r,segmentLoaders:{["AUDIO"]:s,main:a}}=e;["AUDIO","SUBTITLES"].forEach(n=>{t[n].activeGroup=cc(n,e),t[n].activeTrack=dc[n](n,e),t[n].onGroupChanged=ic(n,e),t[n].onGroupChanging=rc(n,e),t[n].onTrackChanged=sc(n,e),t[n].getActiveGroup=hc(n,e)});const o=t.AUDIO.activeGroup();if(o){const e=(o.filter(e=>e.default)[0]||o[0]).id;t.AUDIO.tracks[e].enabled=!0,t.AUDIO.onGroupChanged(),t.AUDIO.onTrackChanged();const n=t.AUDIO.getActiveGroup();n.playlistLoader?(a.setAudio(!1),s.setAudio(!0)):a.setAudio(!0)}n.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(e=>t[e].onGroupChanged())}),n.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(e=>t[e].onGroupChanging())});const l=()=>{t.AUDIO.onTrackChanged(),i.trigger({type:"usage",name:"vhs-audio-change"})};i.audioTracks().addEventListener("change",l),i.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),r.on("dispose",()=>{i.audioTracks().removeEventListener("change",l),i.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)}),i.clearTracks("audio");for(const u in t.AUDIO.tracks)i.audioTracks().addTrack(t.AUDIO.tracks[u])},pc=()=>{const e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(t=>{e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:xu,activeTrack:xu,getActiveGroup:xu,onGroupChanged:xu,onTrackChanged:xu,lastTrack_:null,logger_:Hs(`MediaGroups[${t}]`)}}),e};class gc{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){1===e&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=js(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(e=>[e.ID,e])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class mc extends Ps.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new gc,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=Hs("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const n=t.serverUri||t.serverURL;if(!n)return this.logger_(`steering manifest URL is ${n}, cannot request steering manifest.`),void this.trigger("error");n.startsWith("data:")?this.decodeDataUriManifest_(n.substring(n.indexOf(",")+1)):(this.steeringManifest.reloadUri=js(e,n),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering"))}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const n=e?t:this.getRequestURI(t);if(!n)return this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),void this.dispose();const i={contentSteeringInfo:{uri:n}};this.trigger({type:"contentsteeringloadstart",metadata:i}),this.request_=this.xhr_({uri:n,requestType:"content-steering-manifest"},(e,t)=>{if(e){if(410===t.status)return this.logger_(`manifest request 410 ${e}.`),this.logger_(`There will be no more content steering requests to ${n} this session.`),void this.excludedSteeringManifestURLs.add(n);if(429===t.status){const n=t.responseHeaders["retry-after"];return this.logger_(`manifest request 429 ${e}.`),this.logger_(`content steering will retry in ${n} seconds.`),void this.startTTLTimeout_(parseInt(n,10))}return this.logger_(`manifest failed to load ${e}.`),void this.startTTLTimeout_()}let r;this.trigger({type:"contentsteeringloadcomplete",metadata:i});try{r=JSON.parse(this.request_.responseText)}catch(e){const t={errorType:Ps.Error.StreamingContentSteeringParserError,error:e};this.trigger({type:"error",metadata:t})}this.assignSteeringProperties_(r);const s={contentSteeringInfo:i.contentSteeringInfo,contentSteeringManifest:{version:this.steeringManifest.version,reloadUri:this.steeringManifest.reloadUri,priority:this.steeringManifest.priority}};this.trigger({type:"contentsteeringparsed",metadata:s}),this.startTTLTimeout_()})}setProxyServerUrl_(e){const t=new r.a.URL(e),n=new r.a.URL(this.proxyServerUrl_);return n.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(n.toString())}decodeDataUriManifest_(e){const t=JSON.parse(r.a.atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new r.a.URL(e),n=this.getPathway(),i=this.getBandwidth_();if(n){const e=`_${this.manifestType_}_pathway`;t.searchParams.set(e,n)}if(i){const e=`_${this.manifestType_}_throughput`;t.searchParams.set(e,i)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version)return this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),void this.trigger("error");this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const t=e=>{for(const t of e)if(this.availablePathways_.has(t))return t;return[...this.availablePathways_][0]},n=t(this.steeringManifest.priority);this.currentPathway!==n&&(this.currentPathway=n,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=e=>this.excludedSteeringManifestURLs.has(e);if(this.proxyServerUrl_){const n=this.setProxyServerUrl_(e);if(!t(n))return n}const n=this.setSteeringParams_(e);return t(n)?null:n}startTTLTimeout_(e=this.steeringManifest.ttl){const t=1e3*e;this.ttlTimeout_=r.a.setTimeout(()=>{this.requestSteeringManifest()},t)}clearTTLTimeout_(){r.a.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new gc}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&(js(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}const vc=(e,t)=>{let n=null;return(...i)=>{clearTimeout(n),n=setTimeout(()=>{e.apply(null,i)},t)}},yc=10;let bc;const _c=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],Tc=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]},Sc=function({currentPlaylist:e,buffered:t,currentTime:n,nextPlaylist:i,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:a,bufferBasedABR:o,log:l}){if(!i)return Ps.log.warn("We received no playlist to switch to. Please check your stream."),!1;const u=`allowing switch ${e&&e.id||"null"} -> ${i.id}`;if(!e)return l(`${u} as current playlist is not set`),!0;if(i.id===e.id)return!1;const c=Boolean(Ys(t,n).length);if(!e.endList)return c||"number"!==typeof e.partTargetDuration?(l(`${u} as current playlist is live`),!0):(l(`not ${u} as current playlist is live llhls, but currentTime isn't in buffered.`),!1);const d=ra(t,n),h=o?zo.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:zo.MAX_BUFFER_LOW_WATER_LINE;if(a<h)return l(`${u} as duration < max low water line (${a} < ${h})`),!0;const f=i.attributes.BANDWIDTH,p=e.attributes.BANDWIDTH;if(f<p&&(!o||d<s)){let e=`${u} as next bandwidth < current bandwidth (${f} < ${p})`;return o&&(e+=` and forwardBuffer < bufferHighWaterLine (${d} < ${s})`),l(e),!0}if((!o||f>p)&&d>=r){let e=`${u} as forwardBuffer >= bufferLowWaterLine (${d} >= ${r})`;return o&&(e+=` and next bandwidth > current bandwidth (${f} > ${p})`),l(e),!0}return l(`not ${u} as no switching criteria met`),!1};class wc extends Ps.EventTarget{constructor(e){super(),this.fastQualityChange_=vc(this.fastQualityChange_.bind(this),100);const{src:t,withCredentials:n,tech:i,bandwidth:s,externVhs:a,useCueTags:o,playlistExclusionDuration:l,enableLowInitialPlaylist:u,sourceType:c,cacheEncryptionKeys:d,bufferBasedABR:h,leastPixelDiffSelector:f,captionServices:p,experimentalUseMMS:g}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:m}=e;null!==m&&"undefined"!==typeof m||(m=1/0),bc=a,this.bufferBasedABR=Boolean(h),this.leastPixelDiffSelector=Boolean(f),this.withCredentials=n,this.tech_=i,this.vhs_=i.vhs,this.player_=e.player_,this.sourceType_=c,this.useCueTags_=o,this.playlistExclusionDuration=l,this.maxPlaylistRetries=m,this.enableLowInitialPlaylist=u,this.usingManagedMediaSource_=!1,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:m,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=pc(),g&&r.a.ManagedMediaSource?(this.tech_.el_.disableRemotePlayback=!0,this.mediaSource=new r.a.ManagedMediaSource,this.usingManagedMediaSource_=!0,Ps.log("Using ManagedMediaSource")):r.a.MediaSource&&(this.mediaSource=new r.a.MediaSource),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.load=this.load.bind(this),this.pause=this.pause.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.mediaSource.addEventListener("startstreaming",this.load),this.mediaSource.addEventListener("endstreaming",this.pause),this.seekable_=Gs(),this.hasPlayed_=!1,this.syncController_=new Xu(e),this.segmentMetadataTrack_=i.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.segmentMetadataTrack_.mode="hidden",this.decrypter_=new Ju,this.sourceUpdater_=new Nu(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new Qu,this.keyStatusMap_=new Map;const v={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:p,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:s,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:d,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_="dash"===this.sourceType_?new Go(t,this.vhs_,$s(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new ao(t,this.vhs_,$s(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new Eu($s(v,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new Eu($s(v,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new Vu($s(v,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((e,t)=>{function n(){i.off("vttjserror",r),e()}function r(){i.off("vttjsloaded",n),t()}i.one("vttjsloaded",n),i.one("vttjserror",r),i.addWebVttScript_()})}),e);const y=()=>{return this.mainSegmentLoader_.bandwidth};this.contentSteeringController_=new mc(this.vhs_.xhr,y),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),_c.forEach(e=>{this[e+"_"]=Tc.bind(this,e)}),this.logger_=Hs("pc"),this.triggeredFmp4Usage=!1,"none"===this.tech_.preload()?(this.loadOnPlay_=(()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()}),this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const b="none"===this.tech_.preload()?"play":"loadstart";this.tech_.one(b,()=>{const e=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-e,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return-1===e||-1===t?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,n){const i=this.media(),r=i&&(i.id||i.uri),s=e&&(e.id||e.uri);if(r&&r!==s){this.logger_(`switch media ${r} -> ${s} from ${t}`);const n={renditionInfo:{id:s,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS},cause:t};this.trigger({type:"renditionselected",metadata:n}),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})}this.mainPlaylistLoader_.media(e,n)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const t=this.mediaTypes_[e],n=t?t.activeGroup():null,i=this.contentSteeringController_.getPathway();if(n&&i){const t=n.length?n[0].playlists:n.playlists,r=t.filter(e=>e.attributes.serviceLocation===i);r.length&&this.mediaTypes_[e].activePlaylistLoader.media(r[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=r.a.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(r.a.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const n=e.mediaGroups.AUDIO,i=Object.keys(n);let r;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)r=this.mediaTypes_.AUDIO.activeTrack();else{const e=n.main||i.length&&n[i[0]];for(const t in e)if(e[t].default){r={label:t};break}}if(!r)return t;const s=[];for(const a in n)if(n[a][r.label]){const t=n[a][r.label];if(t.playlists&&t.playlists.length)s.push.apply(s,t.playlists);else if(t.uri)s.push(t);else if(e.playlists.length)for(let n=0;n<e.playlists.length;n++){const t=e.playlists[n];t.attributes&&t.attributes.AUDIO&&t.attributes.AUDIO===a&&s.push(t)}}return s.length?s:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;xa(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,e.endList&&"none"!==this.tech_.preload()&&(this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.mainSegmentLoader_.load()),fc({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),e),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let e=this.mainPlaylistLoader_.media();if(!e){let t;if(this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_(),this.enableLowInitialPlaylist&&(t=this.selectInitialPlaylist()),t||(t=this.selectPlaylist()),!t||!this.shouldSwitchToMedia_(t))return;this.initialMedia_=t,this.switchMedia_(this.initialMedia_,"initial");const n="vhs-json"===this.sourceType_&&this.initialMedia_.segments;if(!n)return;e=this.initialMedia_}this.handleUpdatedMediaPlaylist(e)}),this.mainPlaylistLoader_.on("error",()=>{const e=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const e=this.mainPlaylistLoader_.media(),t=1.5*e.targetDuration*1e3;xa(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=t,"dash"===this.sourceType_&&this.mainPlaylistLoader_.isPaused&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const e=this.mainPlaylistLoader_.media();if("playlist-unchanged"===e.lastExcludeReason_)return;const t=this.stuckAtPlaylistEnd_(e);t&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})});const e=["manifestrequeststart","manifestrequestcomplete","manifestparsestart","manifestparsecomplete","playlistrequeststart","playlistrequestcomplete","playlistparsestart","playlistparsecomplete","renditiondisabled","renditionenabled"];e.forEach(e=>{this.mainPlaylistLoader_.on(e,e=>{this.player_.trigger(h()({},e))})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const n=e.mediaGroups||{};let i=!0;const r=Object.keys(n.AUDIO);for(const s in n.AUDIO)for(const e in n.AUDIO[s]){const t=n.AUDIO[s][e];t.uri||(i=!1)}i&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),bc.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),r.length&&Object.keys(n.AUDIO[r[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),i=this.bufferLowWaterLine(),r=this.bufferHighWaterLine(),s=this.tech_.buffered();return Sc({buffered:s,currentTime:n,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:i,bufferHighWaterLine:r,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const e=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:e.playlist,error:e})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.timelineChangeController_.on("audioTimelineBehind",()=>{const e=this.audioSegmentLoader_.pendingSegment_;if(!e||!e.segment||!e.segment.syncInfo)return;const t=e.segment.syncInfo.end+.01;this.tech_.setCurrentTime(t)}),this.timelineChangeController_.on("fixBadTimelineChange",()=>{this.logger_("Fix bad timeline change. Restarting al segment loaders..."),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}),this.mainSegmentLoader_.on("earlyabort",e=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:yc}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const e=this.getCodecsOrExclude_();e&&this.sourceUpdater_.addOrChangeSourceBuffers(e)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()});const t=["segmentselected","segmentloadstart","segmentloaded","segmentkeyloadstart","segmentkeyloadcomplete","segmentdecryptionstart","segmentdecryptioncomplete","segmenttransmuxingstart","segmenttransmuxingcomplete","segmenttransmuxingtrackinfoavailable","segmenttransmuxingtiminginfoavailable","segmentappendstart","appendsdone","bandwidthupdated","timelinechange","codecschange"];t.forEach(e=>{this.mainSegmentLoader_.on(e,e=>{this.player_.trigger(h()({},e))}),this.audioSegmentLoader_.on(e,e=>{this.player_.trigger(h()({},e))}),this.subtitleSegmentLoader_.on(e,e=>{this.player_.trigger(h()({},e))})})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}pause(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}fastQualityChange_(e=this.selectPlaylist()){e&&e===this.mainPlaylistLoader_.media()?this.logger_("skipping fastQualityChange because new media is same as old"):(this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0)}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0)?this.tech_.setCurrentTime(e.end(e.length-1)):void 0}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const n=t.end(0);let i=n;if(e.start){const r=e.start.timeOffset;i=r<0?Math.max(n+r,t.start(0)):Math.min(n,r)}this.trigger("firstplay"),this.tech_.setCurrentTime(i)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();"undefined"!==typeof e&&"function"===typeof e.then&&e.then(null,e=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();e=!t||t.hasVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){const t=this.seekable();if(!t.length)return!1;const n=this.syncController_.getExpiredTime(e,this.duration());if(null===n)return!1;const i=bc.Playlist.playlistEnd(e,n),r=this.tech_.currentTime(),s=this.tech_.buffered();if(!s.length)return i-r<=Ws;const a=s.end(s.length-1);return a-r<=Ws&&i-a<=Ws}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:n}){if(e=e||this.mainPlaylistLoader_.media(),n=n||t.playlistExclusionDuration||this.playlistExclusionDuration,!e)return this.error=t,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));e.playlistErrors_++;const i=this.mainPlaylistLoader_.main.playlists,r=i.filter(_a),s=1===r.length&&r[0]===e;if(1===i.length&&n!==1/0)return Ps.log.warn(`Problem encountered with playlist ${e.id}. `+"Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(s);if(s){if(this.main().contentSteering){const t=this.pathwayAttribute_(e),n=1e3*this.contentSteeringController_.steeringManifest.ttl;return this.contentSteeringController_.excludePathway(t),this.excludeThenChangePathway_(),void setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(t)},n)}let t=!1;i.forEach(n=>{if(n===e)return;const i=n.excludeUntil;"undefined"!==typeof i&&i!==1/0&&(t=!0,delete n.excludeUntil)}),t&&(Ps.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let a;a=e.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*n,e.excludeUntil=a,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const o=this.selectPlaylist();if(!o)return this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error");const l=t.internal?this.logger_:Ps.log.warn,u=t.message?" "+t.message:"";l(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.`+`${u} Switching to playlist ${o.id}.`),o.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),o.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const c=o.targetDuration/2*1e3||5e3,d="number"===typeof o.lastRequest&&Date.now()-o.lastRequest<=c;return this.switchMedia_(o,"exclude",s||d)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const n=[],i="all"===e;(i||"main"===e)&&n.push(this.mainPlaylistLoader_);const r=[];(i||"audio"===e)&&r.push("AUDIO"),(i||"subtitle"===e)&&(r.push("CLOSED-CAPTIONS"),r.push("SUBTITLES")),r.forEach(e=>{const t=this.mediaTypes_[e]&&this.mediaTypes_[e].activePlaylistLoader;t&&n.push(t)}),["main","audio","subtitle"].forEach(t=>{const i=this[`${t}SegmentLoader_`];!i||e!==t&&"all"!==e||n.push(i)}),n.forEach(e=>t.forEach(t=>{"function"===typeof e[t]&&e[t]()}))}setCurrentTime(e){const t=Ys(this.tech_.buffered(),e);return this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media()&&this.mainPlaylistLoader_.media().segments?t&&t.length?e:(this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),void this.load()):0}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:bc.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}getSeekableRange_(e,t){const n=e.media();if(!n)return null;const i=this.syncController_.getMediaSequenceSync(t);if(i&&i.isReliable){const e=i.start,t=i.end;if(!isFinite(e)||!isFinite(t))return null;const r=bc.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n),s=Math.max(e,t-r);return Gs([[e,s]])}const r=this.syncController_.getExpiredTime(n,this.duration());if(null===r)return null;const s=bc.Playlist.seekable(n,r,bc.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n));return s.length?s:null}computeFinalSeekable_(e,t){if(!t)return e;const n=e.start(0),i=e.end(0),r=t.start(0),s=t.end(0);return r>i||n>s?e:Gs([[Math.max(n,r),Math.min(i,s)]])}onSyncInfoUpdate_(){if(!this.mainPlaylistLoader_)return;const e=this.getSeekableRange_(this.mainPlaylistLoader_,"main");if(!e)return;let t;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.getSeekableRange_(this.mediaTypes_.AUDIO.activePlaylistLoader,"audio"),!t))return;const n=this.seekable_;if(this.seekable_=this.computeFinalSeekable_(e,t),!this.seekable_)return;if(n&&n.length&&this.seekable_.length&&n.start(0)===this.seekable_.start(0)&&n.end(0)===this.seekable_.end(0))return;this.logger_(`seekable updated [${Js(this.seekable_)}]`);const i={seekableRanges:this.seekable_};this.trigger({type:"seekablerangeschanged",metadata:i}),this.tech_.trigger("seekablechanged")}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,e),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);if(e){const e=this.seekable();if(!e.length)return;return void((isNaN(this.mediaSource.duration)||this.mediaSource.duration<e.end(e.length-1))&&this.sourceUpdater_.setDuration(e.end(e.length-1)))}const t=this.tech_.buffered();let n=bc.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(n=Math.max(n,t.end(t.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const n in t)t[n].forEach(e=>{e.playlistLoader&&e.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=!e||!!this.audioSegmentLoader_.getCurrentMediaInfo_();return!(!t||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=Ya(this.main(),t),i={},r=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(i.video=n.video||e.main.videoCodec||g["b"]),e.main.isMuxed&&(i.video+=`,${n.audio||e.main.audioCodec||g["a"]}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||r)&&(i.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||g["a"],e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!i.audio&&!i.video)return void this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});const s=(e,t)=>e?Object(g["c"])(t,this.usingManagedMediaSource_):Object(g["g"])(t),a={};let o;if(["video","audio"].forEach(function(t){if(i.hasOwnProperty(t)&&!s(e[t].isFmp4,i[t])){const n=e[t].isFmp4?"browser":"muxer";a[n]=a[n]||[],a[n].push(i[t]),"audio"===t&&(o=n)}}),r&&o&&t.attributes.AUDIO){const e=t.attributes.AUDIO;this.main().playlists.forEach(n=>{const i=n.attributes&&n.attributes.AUDIO;i===e&&n!==t&&(n.excludeUntil=1/0)}),this.logger_(`excluding audio group ${e} as ${o} does not support codec(s): "${i.audio}"`)}if(!Object.keys(a).length){if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const e=[];if(["video","audio"].forEach(t=>{const n=(Object(g["h"])(this.sourceUpdater_.codecs[t]||"")[0]||{}).type,r=(Object(g["h"])(i[t]||"")[0]||{}).type;n&&r&&n.toLowerCase()!==r.toLowerCase()&&e.push(`"${this.sourceUpdater_.codecs[t]}" -> "${i[t]}"`)}),e.length)return void this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${e.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0})}return i}{const e=Object.keys(a).reduce((e,t)=>{return e&&(e+=", "),e+=`${t} does not support codec(s): "${a[t].join(",")}"`,e},"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:e},playlistExclusionDuration:1/0})}}tryToCreateSourceBuffers_(){if("open"!==this.mediaSource.readyState||this.sourceUpdater_.hasCreatedSourceBuffers())return;if(!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(n=>{const i=e[n];if(-1!==t.indexOf(i.id))return;t.push(i.id);const r=Ya(this.main,i),s=[];!r.audio||Object(g["g"])(r.audio)||Object(g["c"])(r.audio,this.usingManagedMediaSource_)||s.push(`audio codec ${r.audio}`),!r.video||Object(g["g"])(r.video)||Object(g["c"])(r.video,this.usingManagedMediaSource_)||s.push(`video codec ${r.video}`),r.text&&"stpp.ttml.im1t"===r.text&&s.push(`text codec ${r.text}`),s.length&&(i.excludeUntil=1/0,this.logger_(`excluding ${i.id} for unsupported: ${s.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],n=this.main().playlists,i=Wa(Object(g["h"])(e)),r=Ka(i),s=i.video&&Object(g["h"])(i.video)[0]||null,a=i.audio&&Object(g["h"])(i.audio)[0]||null;Object.keys(n).forEach(e=>{const i=n[e];if(-1!==t.indexOf(i.id)||i.excludeUntil===1/0)return;t.push(i.id);const o=[],l=Ya(this.mainPlaylistLoader_.main,i),u=Ka(l);if(l.audio||l.video){if(u!==r&&o.push(`codec count "${u}" !== "${r}"`),!this.sourceUpdater_.canChangeType()){const e=l.video&&Object(g["h"])(l.video)[0]||null,t=l.audio&&Object(g["h"])(l.audio)[0]||null;e&&s&&e.type.toLowerCase()!==s.type.toLowerCase()&&o.push(`video codec "${e.type}" !== "${s.type}"`),t&&a&&t.type.toLowerCase()!==a.type.toLowerCase()&&o.push(`audio codec "${t.type}" !== "${a.type}"`)}o.length&&(i.excludeUntil=1/0,this.logger_(`excluding ${i.id}: ${o.join(" && ")}`))}})}updateAdCues_(e){let t=0;const n=this.seekable();n.length&&(t=n.start(0)),$u(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=zo.GOAL_BUFFER_LENGTH,n=zo.GOAL_BUFFER_LENGTH_RATE,i=Math.max(t,zo.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,i)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=zo.BUFFER_LOW_WATER_LINE,n=zo.BUFFER_LOW_WATER_LINE_RATE,i=Math.max(t,zo.MAX_BUFFER_LOW_WATER_LINE),r=Math.max(t,zo.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,this.bufferBasedABR?r:i)}bufferHighWaterLine(){return zo.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){Jl(this.inbandTextTracks_,"com.apple.streaming",this.tech_),Zl({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,n){const i=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();Jl(this.inbandTextTracks_,e,this.tech_),Yl({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:i,videoDuration:n})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart?this.contentSteeringController_.requestSteeringManifest(!0):this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this));const e=["contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"];e.forEach(e=>{this.contentSteeringController_.on(e,e=>{this.trigger(h()({},e))})}),"dash"===this.sourceType_&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const e=this.main(),t=this.contentSteeringController_.didDASHTagChange(e.uri,e.contentSteering),n=()=>{const t=this.contentSteeringController_.getAvailablePathways(),n=[];for(const i of e.playlists){const e=i.attributes.serviceLocation;if(e&&(n.push(e),!t.has(e)))return!0}return!(n.length||!t.size)};(t||n())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const t=this.main(),n=t.playlists,i=new Set;let r=!1;Object.keys(n).forEach(t=>{const s=n[t],a=this.pathwayAttribute_(s),o=a&&e!==a,l=s.excludeUntil===1/0&&"content-steering"===s.lastExcludeReason_;l&&!o&&(delete s.excludeUntil,delete s.lastExcludeReason_,r=!0);const u=!s.excludeUntil&&s.excludeUntil!==1/0,c=!i.has(s.id)&&o&&u;c&&(i.add(s.id),s.excludeUntil=1/0,s.lastExcludeReason_="content-steering",this.logger_(`excluding ${s.id} for ${s.lastExcludeReason_}`))}),"DASH"===this.contentSteeringController_.manifestType_&&Object.keys(this.mediaTypes_).forEach(t=>{const n=this.mediaTypes_[t];if(n.activePlaylistLoader){const t=n.activePlaylistLoader.media_;t&&t.attributes.serviceLocation!==e&&(r=!0)}}),r&&this.changeSegmentPathway_()}handlePathwayClones_(){const e=this.main(),t=e.playlists,n=this.contentSteeringController_.currentPathwayClones,i=this.contentSteeringController_.nextPathwayClones,r=n&&n.size||i&&i.size;if(r){for(const[e,t]of n.entries()){const n=i.get(e);n||(this.mainPlaylistLoader_.updateOrDeleteClone(t),this.contentSteeringController_.excludePathway(e))}for(const[e,r]of i.entries()){const i=n.get(e);if(i)this.equalPathwayClones_(i,r)||(this.mainPlaylistLoader_.updateOrDeleteClone(r,!0),this.contentSteeringController_.addAvailablePathway(e));else{const n=t.filter(e=>{return e.attributes["PATHWAY-ID"]===r["BASE-ID"]});n.forEach(e=>{this.mainPlaylistLoader_.addClonePathway(r,e)}),this.contentSteeringController_.addAvailablePathway(e)}}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...i])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const n=e["URI-REPLACEMENT"].PARAMS,i=t["URI-REPLACEMENT"].PARAMS;for(const r in n)if(n[r]!==i[r])return!1;for(const r in i)if(n[r]!==i[r])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),"DASH"===this.contentSteeringController_.manifestType_&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(n=>{const i=this.mainPlaylistLoader_.getKeyIdSet(n);i&&i.size&&i.forEach(i=>{const r="usable",s=this.keyStatusMap_.has(i)&&this.keyStatusMap_.get(i)===r,a=n.lastExcludeReason_===t&&n.excludeUntil===1/0;s?s&&a&&(delete n.excludeUntil,delete n.lastExcludeReason_,this.logger_(`enabling playlist ${n.id} because key ID ${i} is ${r}`)):(n.excludeUntil!==1/0&&n.lastExcludeReason_!==t&&(n.excludeUntil=1/0,n.lastExcludeReason_=t,this.logger_(`excluding playlist ${n.id} because the key ID ${i} doesn't exist in the keyStatusMap or is not ${r}`)),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(e=>{const n=e&&e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height<720,i=e.excludeUntil===1/0&&e.lastExcludeReason_===t;n&&i&&(delete e.excludeUntil,Ps.log.warn(`enabling non-HD playlist ${e.id} because all playlists were excluded due to ${t} key IDs`))})}addKeyStatus_(e,t){const n="string"===typeof e,i=n?e:Fu(e),r=i.slice(0,32).toLowerCase();this.logger_(`KeyStatus '${t}' with key ID ${r} added to the keyStatusMap`),this.keyStatusMap_.set(r,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}const Ec=(e,t,n)=>i=>{const r=e.main.playlists[t],s=ba(r),a=_a(r);if("undefined"===typeof i)return a;i?delete r.disabled:r.disabled=!0;const o={renditionInfo:{id:t,bandwidth:r.attributes.BANDWIDTH,resolution:r.attributes.RESOLUTION,codecs:r.attributes.CODECS},cause:"fast-quality"};return i===a||s||(i?(n(r),e.trigger({type:"renditionenabled",metadata:o})):e.trigger({type:"renditiondisabled",metadata:o})),i};class xc{constructor(e,t,n){const{playlistController_:i}=e,r=i.fastQualityChange_.bind(i);if(t.attributes){const e=t.attributes.RESOLUTION;this.width=e&&e.width,this.height=e&&e.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=Ya(i.main(),t),this.playlist=t,this.id=n,this.enabled=Ec(e.playlists,t.id,r)}}const kc=function(e){e.representations=(()=>{const t=e.playlistController_.main(),n=Ia(t)?e.playlistController_.getAudioTrackPlaylists_():t.playlists;return n?n.filter(e=>!ba(e)).map((t,n)=>new xc(e,t,t.id)):[]})},Ac=["seeking","seeked","pause","playing","error"];class Ic extends Ps.EventTarget{constructor(e){super(),this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.playedRanges_=[],this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=Hs("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),i=()=>this.techWaiting_(),s=()=>this.resetTimeUpdate_(),a=this.playlistController_,o=["main","subtitle","audio"],l={};o.forEach(e=>{l[e]={reset:()=>this.resetSegmentDownloads_(e),updateend:()=>this.checkSegmentDownloads_(e)},a[`${e}SegmentLoader_`].on("appendsdone",l[e].updateend),a[`${e}SegmentLoader_`].on("playlistupdate",l[e].reset),this.tech_.on(["seeked","seeking"],l[e].reset)});const u=e=>{["main","audio"].forEach(t=>{a[`${t}SegmentLoader_`][e]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=(()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),u("off"))}),this.clearSeekingAppendCheck_=(()=>u("off")),this.watchForBadSeeking_=(()=>{this.clearSeekingAppendCheck_(),u("on")}),this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",i),this.tech_.on(Ac,s),this.tech_.on("canplay",n),this.tech_.one("play",t),this.dispose=(()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",i),this.tech_.off(Ac,s),this.tech_.off("canplay",n),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),o.forEach(e=>{a[`${e}SegmentLoader_`].off("appendsdone",l[e].updateend),a[`${e}SegmentLoader_`].off("playlistupdate",l[e].reset),this.tech_.off(["seeked","seeking"],l[e].reset)}),this.checkCurrentTimeTimeout_&&r.a.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()})}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&r.a.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=r.a.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,n=t[`${e}SegmentLoader_`],i=n.buffered_(),r=na(this[`${e}Buffered_`],i);if(this[`${e}Buffered_`]=i,r){const n={bufferedRanges:i};return t.trigger({type:"bufferedrangeschanged",metadata:n}),void this.resetSegmentDownloads_(e)}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:n.playlist_&&n.playlist_.id,buffered:ta(i)}),this[`${e}StalledDownloads_`]<10||(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),"subtitle"!==e&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+Ws>=t.end(t.length-1)))return this.techWaiting_();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime)this.consecutiveUpdates++,this.waiting_();else if(e===this.lastRecordedTime)this.consecutiveUpdates++;else{this.playedRanges_.push(Gs([this.lastRecordedTime,e]));const t={playedRanges:this.playedRanges_};this.playlistController_.trigger({type:"playedrangeschanged",metadata:t}),this.consecutiveUpdates=0,this.lastRecordedTime=e}}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){const e=this.tech_.seeking();if(!e)return!1;const t=this.seekable(),n=this.tech_.currentTime(),i=this.afterSeekableWindow_(t,n,this.media(),this.allowSeeksWithinUnsafeLiveWindow);let r;if(i){const e=t.end(t.length-1);r=e}if(this.beforeSeekableWindow_(t,n)){const e=t.start(0);r=e+(e===t.end(0)?0:Ws)}if("undefined"!==typeof r)return this.logger_(`Trying to seek outside of seekable at time ${n} with `+`seekable range ${Js(t)}. Seeking to `+`${r}.`),this.tech_.setCurrentTime(r),!0;const s=this.playlistController_.sourceUpdater_,a=this.tech_.buffered(),o=s.audioBuffer?s.audioBuffered():null,l=s.videoBuffer?s.videoBuffered():null,u=this.media(),c=u.partTargetDuration?u.partTargetDuration:2*(u.targetDuration-qs),d=[o,l];for(let f=0;f<d.length;f++){if(!d[f])continue;const e=ra(d[f],n);if(e<c)return!1}const h=Xs(a,n);return 0!==h.length&&(r=h.start(0)+Ws,this.logger_(`Buffered region starts (${h.start(0)}) `+` just beyond seek point (${n}). Seeking to ${r}.`),this.tech_.setCurrentTime(r),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),n=Ys(t,e);return n.length&&e+3<=n.end(0)?(this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region `+`[${n.start(0)} -> ${n.end(0)}]. Attempting to resume `+"playback by seeking to the current time."),void this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"})):void 0}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const n=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to `+`live point (seekable end) ${n}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(n),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,i=this.tech_.buffered(),r=this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t});if(r)return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const s=Xs(i,t);return s.length>0&&(this.logger_(`Stopped at ${t} and seeking to ${s.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0)}afterSeekableWindow_(e,t,n,i=!1){if(!e.length)return!1;let r=e.end(e.length-1)+Ws;const s=!n.endList,a="number"===typeof n.partTargetDuration;return s&&(a||i)&&(r=e.end(e.length-1)+3*n.targetDuration),t>r}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:n}){if(!e)return;let i;if(e.length&&t.length){const r=Ys(e,n-3),s=Ys(e,n),a=Ys(t,n);a.length&&!s.length&&r.length&&(i={start:r.end(0),end:a.end(0)})}else{const t=Xs(e,n);t.length||(i=this.gapFromVideoUnderflow_(e,n))}return!!i&&(this.logger_(`Encountered a gap in video from ${i.start} to ${i.end}. `+`Seeking to current time ${n}`),!0)}skipTheGap_(e){const t=this.tech_.buffered(),n=this.tech_.currentTime(),i=Xs(t,n);if(this.resetTimeUpdate_(),0===i.length||n!==e)return;this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",i.start(0)),this.tech_.setCurrentTime(i.start(0)+qs);const r={gapInfo:{from:n,to:i.start(0)}};this.playlistController_.trigger({type:"gapjumped",metadata:r}),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"})}gapFromVideoUnderflow_(e,t){const n=Qs(e);for(let i=0;i<n.length;i++){const e=n.start(i),r=n.end(i);if(t-e<4&&t-e>2)return{start:e,end:r}}return null}}const Cc={errorInterval:30,getSource(e){const t=this.tech({IWillNotUseThisInPlugins:!0}),n=t.currentSource_||this.currentSource();return e(n)}},Dc=function(e,t){let n=0,i=0;const r=$s(Cc,t);e.ready(()=>{e.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const s=function(){i&&e.currentTime(i)},a=function(t){null!==t&&void 0!==t&&(i=e.duration()!==1/0&&e.currentTime()||0,e.one("loadedmetadata",s),e.src(t),e.trigger({type:"usage",name:"vhs-error-reload"}),e.play())},o=function(){if(Date.now()-n<1e3*r.errorInterval)e.trigger({type:"usage",name:"vhs-error-reload-canceled"});else{if(r.getSource&&"function"===typeof r.getSource)return n=Date.now(),r.getSource.call(e,a);Ps.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}},l=function(){e.off("loadedmetadata",s),e.off("error",o),e.off("dispose",l)},u=function(t){l(),Dc(e,t)};e.on("error",o),e.on("dispose",l),e.reloadSourceOnError=u},Rc=function(e){Dc(this,e)};var Mc="3.17.0",Lc="7.1.0",Pc="1.3.1",Oc="7.2.0",Nc="4.0.2";const Uc={PlaylistLoader:ao,Playlist:Ca,utils:wo,STANDARD_PLAYLIST_SELECTOR:jl,INITIAL_PLAYLIST_SELECTOR:$l,lastBandwidthSelector:jl,movingAverageBandwidthSelector:Vl,comparePlaylistBandwidth:Ul,comparePlaylistResolution:Fl,xhr:co()};Object.keys(zo).forEach(e=>{Object.defineProperty(Uc,e,{get(){return Ps.log.warn(`using Vhs.${e} is UNSAFE be sure you know what you are doing`),zo[e]},set(t){Ps.log.warn(`using Vhs.${e} is UNSAFE be sure you know what you are doing`),"number"!==typeof t||t<0?Ps.log.warn(`value of Vhs.${e} must be greater than or equal to 0`):zo[e]=t}})});const Fc="videojs-vhs",Bc=function(e,t){const n=t.media();let i=-1;for(let r=0;r<e.length;r++)if(e[r].id===n.id){i=r;break}e.selectedIndex_=i,e.trigger({selectedIndex:i,type:"change"})},jc=function(e,t){t.representations().forEach(t=>{e.addQualityLevel(t)}),Bc(e,t.playlists)};Uc.canPlaySource=function(){return Ps.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const Vc=(e,t,n)=>{if(!e)return e;let i={};t&&t.attributes&&t.attributes.CODECS&&(i=Wa(Object(g["h"])(t.attributes.CODECS))),n&&n.attributes&&n.attributes.CODECS&&(i.audio=n.attributes.CODECS);const r=Object(g["e"])(i.video),s=Object(g["e"])(i.audio),a={};for(const o in e)a[o]={},s&&(a[o].audioContentType=s),r&&(a[o].videoContentType=r),t.contentProtection&&t.contentProtection[o]&&t.contentProtection[o].pssh&&(a[o].pssh=t.contentProtection[o].pssh),"string"===typeof e[o]&&(a[o].url=e[o]);return $s(e,a)},Hc=(e,t)=>{return e.reduce((e,n)=>{if(!n.contentProtection)return e;const i=t.reduce((e,t)=>{const i=n.contentProtection[t];return i&&i.pssh&&(e[t]={pssh:i.pssh}),e},{});return Object.keys(i).length&&e.push(i),e},[])},$c=({player:e,sourceKeySystems:t,audioMedia:n,mainPlaylists:i})=>{if(!e.eme.initializeMediaKeys)return Promise.resolve();const r=n?i.concat([n]):i,s=Hc(r,Object.keys(t)),a=[],o=[];return s.forEach(t=>{o.push(new Promise((t,n)=>{e.tech_.one("keysessioncreated",t)})),a.push(new Promise((n,i)=>{e.eme.initializeMediaKeys({keySystems:t},e=>{e?i(e):n()})}))}),Promise.race([Promise.all(a),Promise.race(o)])},Gc=({player:e,sourceKeySystems:t,media:n,audioMedia:i})=>{const r=Vc(t,n,i);return!!r&&(e.currentSource().keySystems=r,!(r&&!e.eme)||(Ps.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1))},zc=()=>{if(!r.a.localStorage)return null;const e=r.a.localStorage.getItem(Fc);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},qc=e=>{if(!r.a.localStorage)return!1;let t=zc();t=t?$s(t,e):e;try{r.a.localStorage.setItem(Fc,JSON.stringify(t))}catch(e){return!1}return t},Wc=e=>{return 0===e.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(e.substring(e.indexOf(",")+1)):e},Kc=(e,t)=>{e._requestCallbackSet||(e._requestCallbackSet=new Set),e._requestCallbackSet.add(t)},Yc=(e,t)=>{e._responseCallbackSet||(e._responseCallbackSet=new Set),e._responseCallbackSet.add(t)},Xc=(e,t)=>{e._requestCallbackSet&&(e._requestCallbackSet.delete(t),e._requestCallbackSet.size||delete e._requestCallbackSet)},Qc=(e,t)=>{e._responseCallbackSet&&(e._responseCallbackSet.delete(t),e._responseCallbackSet.size||delete e._responseCallbackSet)};Uc.supportsNativeHls=function(){if(!a.a||!a.a.createElement)return!1;const e=a.a.createElement("video");if(!Ps.getTech("Html5").isSupported())return!1;const t=["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"];return t.some(function(t){return/maybe|probably/i.test(e.canPlayType(t))})}(),Uc.supportsNativeDash=function(){return!!(a.a&&a.a.createElement&&Ps.getTech("Html5").isSupported())&&/maybe|probably/i.test(a.a.createElement("video").canPlayType("application/dash+xml"))}(),Uc.supportsTypeNatively=(e=>{return"hls"===e?Uc.supportsNativeHls:"dash"===e&&Uc.supportsNativeDash}),Uc.isSupported=function(){return Ps.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")},Uc.xhr.onRequest=function(e){Kc(Uc.xhr,e)},Uc.xhr.onResponse=function(e){Yc(Uc.xhr,e)},Uc.xhr.offRequest=function(e){Xc(Uc.xhr,e)},Uc.xhr.offResponse=function(e){Qc(Uc.xhr,e)};const Zc=Ps.getComponent("Component");class Jc extends Zc{constructor(e,t,n){if(super(t,n.vhs),"number"===typeof n.initialBandwidth&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=Hs("VhsHandler"),t.options_&&t.options_.playerId){const e=Ps.getPlayer(t.options_.playerId);this.player_=e}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(a.a,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],e=>{const t=a.a.fullscreenElement||a.a.webkitFullscreenElement||a.a.mozFullScreenElement||a.a.msFullscreenElement;t&&t.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=$s(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.usePlayerObjectFit=this.options_.usePlayerObjectFit||!1,this.options_.useBandwidthFromLocalStorage="undefined"!==typeof this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi="undefined"===typeof this.options_.useNetworkInformationApi||this.options_.useNetworkInformationApi,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=!1!==this.options_.llhls,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,"number"!==typeof this.options_.playlistExclusionDuration&&(this.options_.playlistExclusionDuration=60),"number"!==typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){const e=zc();e&&e.bandwidth&&(this.options_.bandwidth=e.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),e&&e.throughput&&(this.options_.throughput=e.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}"number"!==typeof this.options_.bandwidth&&(this.options_.bandwidth=zo.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===zo.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","usePlayerObjectFit","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(e=>{"undefined"!==typeof this.source_[e]&&(this.options_[e]=this.source_[e])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio,this.usePlayerObjectFit=this.options_.usePlayerObjectFit;const t=this.options_.customPixelRatio;"number"===typeof t&&t>=0&&(this.customPixelRatio=t)}setOptions(e={}){this.setOptions_(e)}src(e,t){if(!e)return;this.setOptions_(),this.options_.src=Wc(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=Uc,this.options_.sourceType=Object(m["a"])(t),this.options_.seekTo=(e=>{this.tech_.setCurrentTime(e)}),this.options_.player_=this.player_,this.playlistController_=new wc(this.options_);const n=$s({liveRangeSafeTimeDelta:Ws},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new Ic(n),this.attachStreamingEventListeners_(),this.playlistController_.on("error",()=>{const e=Ps.players[this.tech_.options_.playerId];let t=this.playlistController_.error;"object"!==typeof t||t.code?"string"===typeof t&&(t={message:t,code:3}):t.code=3,e.error(t)});const i=this.options_.bufferBasedABR?Uc.movingAverageBandwidthSelector(.55):Uc.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):i.bind(this),this.playlistController_.selectInitialPlaylist=Uc.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(e){this.playlistController_.selectPlaylist=e.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(e){this.playlistController_.mainSegmentLoader_.throughput.rate=e,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let e=this.playlistController_.mainSegmentLoader_.bandwidth;const t=r.a.navigator.connection||r.a.navigator.mozConnection||r.a.navigator.webkitConnection,n=1e7;if(this.options_.useNetworkInformationApi&&t){const i=1e3*t.downlink*1e3;e=i>=n&&e>=n?Math.max(e,i):i}return e},set(e){this.playlistController_.mainSegmentLoader_.bandwidth=e,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const e=1/(this.bandwidth||1);let t;t=this.throughput>0?1/this.throughput:0;const n=Math.floor(1/(e+t));return n},set(){Ps.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>ta(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>ta(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&qc({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{kc(this)}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=r.a.URL.createObjectURL(this.playlistController_.mediaSource),(Ps.browser.IS_ANY_SAFARI||Ps.browser.IS_IOS)&&this.options_.overrideNative&&"hls"===this.options_.sourceType&&"function"===typeof this.tech_.addSourceElement?(this.tech_.addSourceElement(this.mediaSourceUrl_),this.tech_.addSourceElement(this.source_.src)):this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),$c({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(e=>{this.logger_("error while creating EME key session",e),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=Gc({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});this.player_.tech_.on("keystatuschange",e=>{this.playlistController_.updatePlaylistByKeyStatus(e.keyId,e.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),t?this.createKeySessions_():this.playlistController_.sourceUpdater_.initializedEme()}setupQualityLevels_(){const e=Ps.players[this.tech_.options_.playerId];e&&e.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{jc(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{Bc(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":Mc,"mux.js":Lc,"mpd-parser":Pc,"m3u8-parser":Oc,"aes-decrypter":Nc}}version(){return this.constructor.version()}canChangeType(){return Nu.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&r.a.URL.revokeObjectURL&&(r.a.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return Ro({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,n=!0,i=2){return Mo({programTime:e,playlist:this.playlistController_.media(),retryCount:i,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=(e=>{Kc(this.xhr,e)}),this.xhr.onResponse=(e=>{Yc(this.xhr,e)}),this.xhr.offRequest=(e=>{Xc(this.xhr,e)}),this.xhr.offResponse=(e=>{Qc(this.xhr,e)}),this.player_.trigger("xhr-hooks-ready")}attachStreamingEventListeners_(){const e=["seekablerangeschanged","bufferedrangeschanged","contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"],t=["gapjumped","playedrangeschanged"];e.forEach(e=>{this.playlistController_.on(e,e=>{this.player_.trigger(h()({},e))})}),t.forEach(e=>{this.playbackWatcher_.on(e,e=>{this.player_.trigger(h()({},e))})})}}const ed={name:"videojs-http-streaming",VERSION:Mc,canHandleSource(e,t={}){const n=$s(Ps.options,t);return!(!n.vhs.experimentalUseMMS&&!Object(g["c"])("avc1.4d400d,mp4a.40.2",!1))&&ed.canPlayType(e.type,n)},handleSource(e,t,n={}){const i=$s(Ps.options,n);return t.vhs=new Jc(e,t,i),t.vhs.xhr=co(),t.vhs.setupXhrHooks_(),t.vhs.src(e.src,e.type),t.vhs},canPlayType(e,t){const n=Object(m["a"])(e);if(!n)return"";const i=ed.getOverrideNative(t),r=Uc.supportsTypeNatively(n),s=!r||i;return s?"maybe":""},getOverrideNative(e={}){const{vhs:t={}}=e,n=!(Ps.browser.IS_ANY_SAFARI||Ps.browser.IS_IOS),{overrideNative:i=n}=t;return i}},td=()=>{return Object(g["c"])("avc1.4d400d,mp4a.40.2",!0)};td()&&Ps.getTech("Html5").registerSourceHandler(ed,0),Ps.VhsHandler=Jc,Ps.VhsSourceHandler=ed,Ps.Vhs=Uc,Ps.use||Ps.registerComponent("Vhs",Uc),Ps.options.vhs=Ps.options.vhs||{},Ps.getPlugin&&Ps.getPlugin("reloadSourceOnError")||Ps.registerPlugin("reloadSourceOnError",Rc)}).call(this,n("c8ba"))},f123:function(e,t,n){var i=n("9f82"),r=i.prepareDataCoordInfo,s=i.getStackedOnPoint;function a(e,t){var n=[];return t.diff(e).add(function(e){n.push({cmd:"+",idx:e})}).update(function(e,t){n.push({cmd:"=",idx:t,idx1:e})}).remove(function(e){n.push({cmd:"-",idx:e})}).execute(),n}function o(e,t,n,i,o,l,u,c){for(var d=a(e,t),h=[],f=[],p=[],g=[],m=[],v=[],y=[],b=r(o,t,u),_=r(l,e,c),T=0;T<d.length;T++){var S=d[T],w=!0;switch(S.cmd){case"=":var E=e.getItemLayout(S.idx),x=t.getItemLayout(S.idx1);(isNaN(E[0])||isNaN(E[1]))&&(E=x.slice()),h.push(E),f.push(x),p.push(n[S.idx]),g.push(i[S.idx1]),y.push(t.getRawIndex(S.idx1));break;case"+":var k=S.idx;h.push(o.dataToPoint([t.get(b.dataDimsForPoint[0],k),t.get(b.dataDimsForPoint[1],k)])),f.push(t.getItemLayout(k).slice()),p.push(s(b,o,t,k)),g.push(i[k]),y.push(t.getRawIndex(k));break;case"-":k=S.idx;var A=e.getRawIndex(k);A!==k?(h.push(e.getItemLayout(k)),f.push(l.dataToPoint([e.get(_.dataDimsForPoint[0],k),e.get(_.dataDimsForPoint[1],k)])),p.push(n[k]),g.push(s(_,l,e,k)),y.push(A)):w=!1}w&&(m.push(S),v.push(v.length))}v.sort(function(e,t){return y[e]-y[t]});var I=[],C=[],D=[],R=[],M=[];for(T=0;T<v.length;T++){k=v[T];I[T]=h[k],C[T]=f[k],D[T]=p[k],R[T]=g[k],M[T]=m[k]}return{current:I,next:C,stackedOnCurrent:D,stackedOnNext:R,status:M}}e.exports=o},f17f:function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=n("f706"),a=n("1418"),o=n("f123"),l=n("2306"),u=n("e0d3"),c=n("d4d1"),d=c.Polyline,h=c.Polygon,f=n("e887"),p=n("3842"),g=p.round,m=n("9f82"),v=m.prepareDataCoordInfo,y=m.getStackedOnPoint;function b(e,t){if(e.length===t.length){for(var n=0;n<e.length;n++){var i=e[n],r=t[n];if(i[0]!==r[0]||i[1]!==r[1])return}return!0}}function _(e){return"number"===typeof e?e:e?.5:0}function T(e){var t=e.getGlobalExtent();if(e.onBand){var n=e.getBandWidth()/2-1,i=t[1]>t[0]?1:-1;t[0]+=i*n,t[1]-=i*n}return t}function S(e,t,n){if(!n.valueDim)return[];for(var i=[],r=0,s=t.count();r<s;r++)i.push(y(n,e,t,r));return i}function w(e,t,n,i){var r=T(e.getAxis("x")),s=T(e.getAxis("y")),a=e.getBaseAxis().isHorizontal(),o=Math.min(r[0],r[1]),u=Math.min(s[0],s[1]),c=Math.max(r[0],r[1])-o,d=Math.max(s[0],s[1])-u;if(n)o-=.5,c+=.5,u-=.5,d+=.5;else{var h=i.get("lineStyle.width")||2,f=i.get("clipOverflow")?h/2:Math.max(c,d);a?(u-=f,d+=2*f):(o-=f,c+=2*f)}var p=new l.Rect({shape:{x:o,y:u,width:c,height:d}});return t&&(p.shape[a?"width":"height"]=0,l.initProps(p,{shape:{width:c,height:d}},i)),p}function E(e,t,n,i){var r=e.getAngleAxis(),s=e.getRadiusAxis(),a=s.getExtent().slice();a[0]>a[1]&&a.reverse();var o=r.getExtent(),u=Math.PI/180;n&&(a[0]-=.5,a[1]+=.5);var c=new l.Sector({shape:{cx:g(e.cx,1),cy:g(e.cy,1),r0:g(a[0],1),r:g(a[1],1),startAngle:-o[0]*u,endAngle:-o[1]*u,clockwise:r.inverse}});return t&&(c.shape.endAngle=-o[0]*u,l.initProps(c,{shape:{endAngle:-o[1]*u}},i)),c}function x(e,t,n,i){return"polar"===e.type?E(e,t,n,i):w(e,t,n,i)}function k(e,t,n){for(var i=t.getBaseAxis(),r="x"===i.dim||"radius"===i.dim?0:1,s=[],a=0;a<e.length-1;a++){var o=e[a+1],l=e[a];s.push(l);var u=[];switch(n){case"end":u[r]=o[r],u[1-r]=l[1-r],s.push(u);break;case"middle":var c=(l[r]+o[r])/2,d=[];u[r]=d[r]=c,u[1-r]=l[1-r],d[1-r]=o[1-r],s.push(u),s.push(d);break;default:u[r]=l[r],u[1-r]=o[1-r],s.push(u)}}return e[a]&&s.push(e[a]),s}function A(e,t){var n=e.getVisual("visualMeta");if(n&&n.length&&e.count()&&"cartesian2d"===t.type){for(var i,s,a=n.length-1;a>=0;a--){var o=n[a].dimension,u=e.dimensions[o],c=e.getDimensionInfo(u);if(i=c&&c.coordDim,"x"===i||"y"===i){s=n[a];break}}if(s){var d=t.getAxis(i),h=r.map(s.stops,function(e){return{coord:d.toGlobalCoord(d.dataToCoord(e.value)),color:e.color}}),f=h.length,p=s.outerColors.slice();f&&h[0].coord>h[f-1].coord&&(h.reverse(),p.reverse());var g=10,m=h[0].coord-g,v=h[f-1].coord+g,y=v-m;if(y<.001)return"transparent";r.each(h,function(e){e.offset=(e.coord-m)/y}),h.push({offset:f?h[f-1].offset:.5,color:p[1]||"transparent"}),h.unshift({offset:f?h[0].offset:.5,color:p[0]||"transparent"});var b=new l.LinearGradient(0,0,0,0,h,!0);return b[i]=m,b[i+"2"]=v,b}}}function I(e,t,n){var i=e.get("showAllSymbol"),s="auto"===i;if(!i||s){var a=n.getAxesByScale("ordinal")[0];if(a&&(!s||!C(a,t))){var o=t.mapDimension(a.dim),l={};return r.each(a.getViewLabels(),function(e){l[e.tickValue]=1}),function(e){return!l.hasOwnProperty(t.get(o,e))}}}}function C(e,t){var n=e.getExtent(),i=Math.abs(n[1]-n[0])/e.scale.count();isNaN(i)&&(i=0);for(var r=t.count(),s=Math.max(1,Math.round(r/5)),o=0;o<r;o+=s)if(1.5*a.getSymbolSize(t,o)[e.isHorizontal()?1:0]>i)return!1;return!0}var D=f.extend({type:"line",init:function(){var e=new l.Group,t=new s;this.group.add(t.group),this._symbolDraw=t,this._lineGroup=e},render:function(e,t,n){var i=e.coordinateSystem,s=this.group,a=e.getData(),o=e.getModel("lineStyle"),l=e.getModel("areaStyle"),u=a.mapArray(a.getItemLayout),c="polar"===i.type,d=this._coordSys,h=this._symbolDraw,f=this._polyline,p=this._polygon,g=this._lineGroup,m=e.get("animation"),y=!l.isEmpty(),T=l.get("origin"),w=v(i,a,T),E=S(i,a,w),C=e.get("showSymbol"),D=C&&!c&&I(e,a,i),R=this._data;R&&R.eachItemGraphicEl(function(e,t){e.__temp&&(s.remove(e),R.setItemGraphicEl(t,null))}),C||h.remove(),s.add(g);var M=!c&&e.get("step");f&&d.type===i.type&&M===this._step?(y&&!p?p=this._newPolygon(u,E,i,m):p&&!y&&(g.remove(p),p=this._polygon=null),g.setClipPath(x(i,!1,!1,e)),C&&h.updateData(a,{isIgnore:D,clipShape:x(i,!1,!0,e)}),a.eachItemGraphicEl(function(e){e.stopAnimation(!0)}),b(this._stackedOnPoints,E)&&b(this._points,u)||(m?this._updateAnimation(a,E,i,n,M,T):(M&&(u=k(u,i,M),E=k(E,i,M)),f.setShape({points:u}),p&&p.setShape({points:u,stackedOnPoints:E})))):(C&&h.updateData(a,{isIgnore:D,clipShape:x(i,!1,!0,e)}),M&&(u=k(u,i,M),E=k(E,i,M)),f=this._newPolyline(u,i,m),y&&(p=this._newPolygon(u,E,i,m)),g.setClipPath(x(i,!0,!1,e)));var L=A(a,i)||a.getVisual("color");f.useStyle(r.defaults(o.getLineStyle(),{fill:"none",stroke:L,lineJoin:"bevel"}));var P=e.get("smooth");if(P=_(e.get("smooth")),f.setShape({smooth:P,smoothMonotone:e.get("smoothMonotone"),connectNulls:e.get("connectNulls")}),p){var O=a.getCalculationInfo("stackedOnSeries"),N=0;p.useStyle(r.defaults(l.getAreaStyle(),{fill:L,opacity:.7,lineJoin:"bevel"})),O&&(N=_(O.get("smooth"))),p.setShape({smooth:P,stackedOnSmooth:N,smoothMonotone:e.get("smoothMonotone"),connectNulls:e.get("connectNulls")})}this._data=a,this._coordSys=i,this._stackedOnPoints=E,this._points=u,this._step=M,this._valueOrigin=T},dispose:function(){},highlight:function(e,t,n,i){var r=e.getData(),s=u.queryDataIndex(r,i);if(!(s instanceof Array)&&null!=s&&s>=0){var o=r.getItemGraphicEl(s);if(!o){var l=r.getItemLayout(s);if(!l)return;o=new a(r,s),o.position=l,o.setZ(e.get("zlevel"),e.get("z")),o.ignore=isNaN(l[0])||isNaN(l[1]),o.__temp=!0,r.setItemGraphicEl(s,o),o.stopSymbolAnimation(!0),this.group.add(o)}o.highlight()}else f.prototype.highlight.call(this,e,t,n,i)},downplay:function(e,t,n,i){var r=e.getData(),s=u.queryDataIndex(r,i);if(null!=s&&s>=0){var a=r.getItemGraphicEl(s);a&&(a.__temp?(r.setItemGraphicEl(s,null),this.group.remove(a)):a.downplay())}else f.prototype.downplay.call(this,e,t,n,i)},_newPolyline:function(e){var t=this._polyline;return t&&this._lineGroup.remove(t),t=new d({shape:{points:e},silent:!0,z2:10}),this._lineGroup.add(t),this._polyline=t,t},_newPolygon:function(e,t){var n=this._polygon;return n&&this._lineGroup.remove(n),n=new h({shape:{points:e,stackedOnPoints:t},silent:!0}),this._lineGroup.add(n),this._polygon=n,n},_updateAnimation:function(e,t,n,i,r,s){var a=this._polyline,u=this._polygon,c=e.hostModel,d=o(this._data,e,this._stackedOnPoints,t,this._coordSys,n,this._valueOrigin,s),h=d.current,f=d.stackedOnCurrent,p=d.next,g=d.stackedOnNext;r&&(h=k(d.current,n,r),f=k(d.stackedOnCurrent,n,r),p=k(d.next,n,r),g=k(d.stackedOnNext,n,r)),a.shape.__points=d.current,a.shape.points=h,l.updateProps(a,{shape:{points:p}},c),u&&(u.setShape({points:h,stackedOnPoints:f}),l.updateProps(u,{shape:{points:p,stackedOnPoints:g}},c));for(var m=[],v=d.status,y=0;y<v.length;y++){var b=v[y].cmd;if("="===b){var _=e.getItemGraphicEl(v[y].idx1);_&&m.push({el:_,ptIdx:y})}}a.animators&&a.animators.length&&a.animators[0].during(function(){for(var e=0;e<m.length;e++){var t=m[e].el;t.attr("position",a.shape.__points[m[e].ptIdx])}})},remove:function(e){var t=this.group,n=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),n&&n.eachItemGraphicEl(function(e,i){e.__temp&&(t.remove(e),n.setItemGraphicEl(i,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._data=null}});e.exports=D},f219:function(e,t){var n="#eee",i=function(){return{axisLine:{lineStyle:{color:n}},axisTick:{lineStyle:{color:n}},axisLabel:{textStyle:{color:n}},splitLine:{lineStyle:{type:"dashed",color:"#aaa"}},splitArea:{areaStyle:{color:n}}}},r=["#dd6b66","#759aa0","#e69d87","#8dc1a9","#ea7e53","#eedd78","#73a373","#73b9bc","#7289ab","#91ca8c","#f49f42"],s={color:r,backgroundColor:"#333",tooltip:{axisPointer:{lineStyle:{color:n},crossStyle:{color:n}}},legend:{textStyle:{color:n}},textStyle:{color:n},title:{textStyle:{color:n}},toolbox:{iconStyle:{normal:{borderColor:n}}},dataZoom:{textStyle:{color:n}},visualMap:{textStyle:{color:n}},timeline:{lineStyle:{color:n},itemStyle:{normal:{color:r[1]}},label:{normal:{textStyle:{color:n}}},controlStyle:{normal:{color:n,borderColor:n}}},timeAxis:i(),logAxis:i(),valueAxis:i(),categoryAxis:i(),line:{symbol:"circle"},graph:{color:r},gauge:{title:{textStyle:{color:n}}},candlestick:{itemStyle:{normal:{color:"#FD1050",color0:"#0CF49B",borderColor:"#FD1050",borderColor0:"#0CF49B"}}}};s.categoryAxis.splitLine.show=!1;var a=s;e.exports=a},f273:function(e,t,n){var i=n("6d8b"),r=n("2306"),s=n("fab22"),a=n("6679"),o=n("0156"),l=["axisLine","axisTickLabel","axisName"],u=["splitArea","splitLine"],c=a.extend({type:"cartesianAxis",axisPointerClass:"CartesianAxisPointer",render:function(e,t,n,a){this.group.removeAll();var d=this._axisGroup;if(this._axisGroup=new r.Group,this.group.add(this._axisGroup),e.get("show")){var h=e.getCoordSysModel(),f=o.layout(h,e),p=new s(e,f);i.each(l,p.add,p),this._axisGroup.add(p.getGroup()),i.each(u,function(t){e.get(t+".show")&&this["_"+t](e,h)},this),r.groupTransition(d,this._axisGroup,e),c.superCall(this,"render",e,t,n,a)}},remove:function(){this._splitAreaColors=null},_splitLine:function(e,t){var n=e.axis;if(!n.scale.isBlank()){var s=e.getModel("splitLine"),a=s.getModel("lineStyle"),o=a.get("color");o=i.isArray(o)?o:[o];for(var l=t.coordinateSystem.getRect(),u=n.isHorizontal(),c=0,d=n.getTicksCoords({tickModel:s}),h=[],f=[],p=a.getLineStyle(),g=0;g<d.length;g++){var m=n.toGlobalCoord(d[g].coord);u?(h[0]=m,h[1]=l.y,f[0]=m,f[1]=l.y+l.height):(h[0]=l.x,h[1]=m,f[0]=l.x+l.width,f[1]=m);var v=c++%o.length,y=d[g].tickValue;this._axisGroup.add(new r.Line(r.subPixelOptimizeLine({anid:null!=y?"line_"+d[g].tickValue:null,shape:{x1:h[0],y1:h[1],x2:f[0],y2:f[1]},style:i.defaults({stroke:o[v]},p),silent:!0})))}}},_splitArea:function(e,t){var n=e.axis;if(!n.scale.isBlank()){var s=e.getModel("splitArea"),a=s.getModel("areaStyle"),o=a.get("color"),l=t.coordinateSystem.getRect(),u=n.getTicksCoords({tickModel:s,clamp:!0});if(u.length){var c=o.length,d=this._splitAreaColors,h=i.createHashMap(),f=0;if(d)for(var p=0;p<u.length;p++){var g=d.get(u[p].tickValue);if(null!=g){f=(g+(c-1)*p)%c;break}}var m=n.toGlobalCoord(u[0].coord),v=a.getAreaStyle();o=i.isArray(o)?o:[o];for(p=1;p<u.length;p++){var y,b,_,T,S=n.toGlobalCoord(u[p].coord);n.isHorizontal()?(y=m,b=l.y,_=S-y,T=l.height,m=y+_):(y=l.x,b=m,_=l.width,T=S-b,m=b+T);var w=u[p-1].tickValue;null!=w&&h.set(w,f),this._axisGroup.add(new r.Rect({anid:null!=w?"area_"+w:null,shape:{x:y,y:b,width:_,height:T},style:i.defaults({fill:o[f]},v),silent:!0})),f=(f+1)%c}this._splitAreaColors=h}}}});c.extend({type:"xAxis"}),c.extend({type:"yAxis"})},f279:function(e,t,n){var i=n("9850"),r=n("e263"),s=n("401b"),a=n("0655");function o(e,t,n){if(this.name=e,this.geometries=t,n)n=[n[0],n[1]];else{var i=this.getBoundingRect();n=[i.x+i.width/2,i.y+i.height/2]}this.center=n}o.prototype={constructor:o,properties:null,getBoundingRect:function(){var e=this._rect;if(e)return e;for(var t=Number.MAX_VALUE,n=[t,t],a=[-t,-t],o=[],l=[],u=this.geometries,c=0;c<u.length;c++)if("polygon"===u[c].type){var d=u[c].exterior;r.fromPoints(d,o,l),s.min(n,n,o),s.max(a,a,l)}return 0===c&&(n[0]=n[1]=a[0]=a[1]=0),this._rect=new i(n[0],n[1],a[0]-n[0],a[1]-n[1])},contain:function(e){var t=this.getBoundingRect(),n=this.geometries;if(!t.contain(e[0],e[1]))return!1;e:for(var i=0,r=n.length;i<r;i++)if("polygon"===n[i].type){var s=n[i].exterior,o=n[i].interiors;if(a.contain(s,e[0],e[1])){for(var l=0;l<(o?o.length:0);l++)if(a.contain(o[l]))continue e;return!0}}return!1},transformTo:function(e,t,n,r){var a=this.getBoundingRect(),o=a.width/a.height;n?r||(r=n/o):n=o*r;for(var l=new i(e,t,n,r),u=a.calculateTransform(l),c=this.geometries,d=0;d<c.length;d++)if("polygon"===c[d].type){for(var h=c[d].exterior,f=c[d].interiors,p=0;p<h.length;p++)s.applyTransform(h[p],h[p],u);for(var g=0;g<(f?f.length:0);g++)for(p=0;p<f[g].length;p++)s.applyTransform(f[g][p],f[g][p],u)}a=this._rect,a.copy(l),this.center=[a.x+a.width/2,a.y+a.height/2]}};var l=o;e.exports=l},f47d:function(e,t,n){var i=n("6d8b"),r=(i.assert,i.isArray),s=n("4e08");s.__DEV__;function a(e){return new o(e)}function o(e){e=e||{},this._reset=e.reset,this._plan=e.plan,this._count=e.count,this._onDirty=e.onDirty,this._dirty=!0,this.context}var l=o.prototype;l.perform=function(e){var t,n=this._upstream,i=e&&e.skip;if(this._dirty&&n){var s=this.context;s.data=s.outputData=n.context.outputData}this.__pipeline&&(this.__pipeline.currentTask=this),this._plan&&!i&&(t=this._plan(this.context));var a,o=f(this._modBy),l=this._modDataCount||0,u=f(e&&e.modBy),h=e&&e.modDataCount||0;function f(e){return!(e>=1)&&(e=1),e}o===u&&l===h||(t="reset"),(this._dirty||"reset"===t)&&(this._dirty=!1,a=d(this,i)),this._modBy=u,this._modDataCount=h;var p=e&&e.step;if(this._dueEnd=n?n._outputDueEnd:this._count?this._count(this.context):1/0,this._progress){var g=this._dueIndex,m=Math.min(null!=p?this._dueIndex+p:1/0,this._dueEnd);if(!i&&(a||g<m)){var v=this._progress;if(r(v))for(var y=0;y<v.length;y++)c(this,v[y],g,m,u,h);else c(this,v,g,m,u,h)}this._dueIndex=m;var b=null!=this._settedOutputEnd?this._settedOutputEnd:m;this._outputDueEnd=b}else this._dueIndex=this._outputDueEnd=null!=this._settedOutputEnd?this._settedOutputEnd:this._dueEnd;return this.unfinished()};var u=function(){var e,t,n,i,r,s={reset:function(l,u,c,d){t=l,e=u,n=c,i=d,r=Math.ceil(i/n),s.next=n>1&&i>0?o:a}};return s;function a(){return t<e?t++:null}function o(){var s=t%r*n+Math.ceil(t/r),a=t>=e?null:s<i?s:t;return t++,a}}();function c(e,t,n,i,r,s){u.reset(n,i,r,s),e._callingProgress=t,e._callingProgress({start:n,end:i,count:i-n,next:u.next},e.context)}function d(e,t){var n,i;e._dueIndex=e._outputDueEnd=e._dueEnd=0,e._settedOutputEnd=null,!t&&e._reset&&(n=e._reset(e.context),n&&n.progress&&(i=n.forceFirstProgress,n=n.progress),r(n)&&!n.length&&(n=null)),e._progress=n,e._modBy=e._modDataCount=null;var s=e._downstream;return s&&s.dirty(),i}l.dirty=function(){this._dirty=!0,this._onDirty&&this._onDirty(this.context)},l.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd},l.pipe=function(e){(this._downstream!==e||this._dirty)&&(this._downstream=e,e._upstream=this,e.dirty())},l.dispose=function(){this._disposed||(this._upstream&&(this._upstream._downstream=null),this._downstream&&(this._downstream._upstream=null),this._dirty=!1,this._disposed=!0)},l.getUpstream=function(){return this._upstream},l.getDownstream=function(){return this._downstream},l.setOutputEnd=function(e){this._outputDueEnd=this._settedOutputEnd=e},t.createTask=a},f4a2:function(e,t,n){var i=n("9850"),r=n("c526"),s=r.onIrrelevantElement,a=n("2306");function o(e){return e=c(e),function(t,n){return a.clipPointsByRect(t,e)}}function l(e,t){return e=c(e),function(n){var i=null!=t?t:n,r=i?e.width:e.height,s=i?e.x:e.y;return[s,s+(r||0)]}}function u(e,t,n){return e=c(e),function(i,r,a){return e.contain(r[0],r[1])&&!s(i,t,n)}}function c(e){return i.create(e)}t.makeRectPanelClipPath=o,t.makeLinearBrushOtherExtent=l,t.makeRectIsTargetByCursor=u},f605:function(e,t){e.exports=function(e,t,n,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(n+": incorrect invocation!");return e}},f706:function(e,t,n){var i=n("2306"),r=n("1418"),s=n("6d8b"),a=s.isObject;function o(e){this.group=new i.Group,this._symbolCtor=e||r}var l=o.prototype;function u(e,t,n,i){return t&&!isNaN(t[0])&&!isNaN(t[1])&&!(i.isIgnore&&i.isIgnore(n))&&!(i.clipShape&&!i.clipShape.contain(t[0],t[1]))&&"none"!==e.getItemVisual(n,"symbol")}function c(e){return null==e||a(e)||(e={isIgnore:e}),e||{}}function d(e){var t=e.hostModel;return{itemStyle:t.getModel("itemStyle").getItemStyle(["color"]),hoverItemStyle:t.getModel("emphasis.itemStyle").getItemStyle(),symbolRotate:t.get("symbolRotate"),symbolOffset:t.get("symbolOffset"),hoverAnimation:t.get("hoverAnimation"),labelModel:t.getModel("label"),hoverLabelModel:t.getModel("emphasis.label"),cursorStyle:t.get("cursor")}}l.updateData=function(e,t){t=c(t);var n=this.group,r=e.hostModel,s=this._data,a=this._symbolCtor,o=d(e);s||n.removeAll(),e.diff(s).add(function(i){var r=e.getItemLayout(i);if(u(e,r,i,t)){var s=new a(e,i,o);s.attr("position",r),e.setItemGraphicEl(i,s),n.add(s)}}).update(function(l,c){var d=s.getItemGraphicEl(c),h=e.getItemLayout(l);u(e,h,l,t)?(d?(d.updateData(e,l,o),i.updateProps(d,{position:h},r)):(d=new a(e,l),d.attr("position",h)),n.add(d),e.setItemGraphicEl(l,d)):n.remove(d)}).remove(function(e){var t=s.getItemGraphicEl(e);t&&t.fadeOut(function(){n.remove(t)})}).execute(),this._data=e},l.isPersistent=function(){return!0},l.updateLayout=function(){var e=this._data;e&&e.eachItemGraphicEl(function(t,n){var i=e.getItemLayout(n);t.attr("position",i)})},l.incrementalPrepareUpdate=function(e){this._seriesScope=d(e),this._data=null,this.group.removeAll()},l.incrementalUpdate=function(e,t,n){function i(e){e.isGroup||(e.incremental=e.useHoverLayer=!0)}n=c(n);for(var r=e.start;r<e.end;r++){var s=t.getItemLayout(r);if(u(t,s,r,n)){var a=new this._symbolCtor(t,r,this._seriesScope);a.traverse(i),a.attr("position",s),this.group.add(a),t.setItemGraphicEl(r,a)}}},l.remove=function(e){var t=this.group,n=this._data;n&&e?n.eachItemGraphicEl(function(e){e.fadeOut(function(){t.remove(e)})}):t.removeAll()};var h=o;e.exports=h},f8a8:function(e,t,n){"use strict";var i,r=n("de66"),s=(new Uint8Array([79,112,117,115,72,101,97,100]),function(e){return"string"===typeof e?Object(r["h"])(e):e}),a=function(e){return Array.isArray(e)?e.map(function(e){return s(e)}):[s(e)]},o=function(e){e=Object(r["k"])(e);var t=[],n=0;while(e.length>n){var s=e[n],a=0,o=0;o++;var l=e[o];o++;while(128&l)a=(127&l)<<7,l=e[o],o++;a+=127&l;for(var u=0;u<i.length;u++){var c=i[u],d=c.id,h=c.parser;if(s===d){t.push(h(e.subarray(o,o+a)));break}}n+=a+o}return t};i=[{id:3,parser:function(e){var t={tag:3,id:e[0]<<8|e[1],flags:e[2],size:3,dependsOnEsId:0,ocrEsId:0,descriptors:[],url:""};if(128&t.flags&&(t.dependsOnEsId=e[t.size]<<8|e[t.size+1],t.size+=2),64&t.flags){var n=e[t.size];t.url=Object(r["c"])(e.subarray(t.size+1,t.size+1+n)),t.size+=n}return 32&t.flags&&(t.ocrEsId=e[t.size]<<8|e[t.size+1],t.size+=2),t.descriptors=o(e.subarray(t.size))||[],t}},{id:4,parser:function(e){var t={tag:4,oti:e[0],streamType:e[1],bufferSize:e[2]<<16|e[3]<<8|e[4],maxBitrate:e[5]<<24|e[6]<<16|e[7]<<8|e[8],avgBitrate:e[9]<<24|e[10]<<16|e[11]<<8|e[12],descriptors:o(e.subarray(13))};return t}},{id:5,parser:function(e){return{tag:5,bytes:e}}},{id:6,parser:function(e){return{tag:6,bytes:e}}}];var l=function e(t,n,i){void 0===i&&(i=!1),n=a(n),t=Object(r["k"])(t);var s=[];if(!n.length)return s;var o=0;while(o<t.length){var l=(t[o]<<24|t[o+1]<<16|t[o+2]<<8|t[o+3])>>>0,u=t.subarray(o+4,o+8);if(0===l)break;var c=o+l;if(c>t.length){if(i)break;c=t.length}var d=t.subarray(o+8,c);Object(r["a"])(u,n[0])&&(1===n.length?s.push(d):s.push.apply(s,e(d,n.slice(1),i))),o=c}return s},u={EBML:Object(r["k"])([26,69,223,163]),DocType:Object(r["k"])([66,130]),Segment:Object(r["k"])([24,83,128,103]),SegmentInfo:Object(r["k"])([21,73,169,102]),Tracks:Object(r["k"])([22,84,174,107]),Track:Object(r["k"])([174]),TrackNumber:Object(r["k"])([215]),DefaultDuration:Object(r["k"])([35,227,131]),TrackEntry:Object(r["k"])([174]),TrackType:Object(r["k"])([131]),FlagDefault:Object(r["k"])([136]),CodecID:Object(r["k"])([134]),CodecPrivate:Object(r["k"])([99,162]),VideoTrack:Object(r["k"])([224]),AudioTrack:Object(r["k"])([225]),Cluster:Object(r["k"])([31,67,182,117]),Timestamp:Object(r["k"])([231]),TimestampScale:Object(r["k"])([42,215,177]),BlockGroup:Object(r["k"])([160]),BlockDuration:Object(r["k"])([155]),Block:Object(r["k"])([161]),SimpleBlock:Object(r["k"])([163])},c=[128,64,32,16,8,4,2,1],d=function(e){for(var t=1,n=0;n<c.length;n++){if(e&c[n])break;t++}return t},h=function(e,t,n,i){void 0===n&&(n=!0),void 0===i&&(i=!1);var s=d(e[t]),a=e.subarray(t,t+s);return n&&(a=Array.prototype.slice.call(e,t,t+s),a[0]^=c[s-1]),{length:s,value:Object(r["b"])(a,{signed:i}),bytes:a}},f=function e(t){return"string"===typeof t?t.match(/.{1,2}/g).map(function(t){return e(t)}):"number"===typeof t?Object(r["f"])(t):t},p=function(e){return Array.isArray(e)?e.map(function(e){return f(e)}):[f(e)]},g=function e(t,n,i){if(i>=n.length)return n.length;var s=h(n,i,!1);if(Object(r["a"])(t.bytes,s.bytes))return i;var a=h(n,i+s.length);return e(t,n,i+a.length+a.value+s.length)},m=function e(t,n){n=p(n),t=Object(r["k"])(t);var i=[];if(!n.length)return i;var s=0;while(s<t.length){var a=h(t,s,!1),o=h(t,s+a.length),l=s+a.length+o.length;127===o.value&&(o.value=g(a,t,l),o.value!==t.length&&(o.value-=l));var u=l+o.value>t.length?t.length:l+o.value,c=t.subarray(l,u);Object(r["a"])(n[0],a.bytes)&&(1===n.length?i.push(c):i=i.concat(e(c,n.slice(1))));var d=a.length+o.length+c.length;s+=d}return i},v=n("321f"),y=Object(r["k"])([0,0,0,1]),b=Object(r["k"])([0,0,1]),_=Object(r["k"])([0,0,3]),T=function(e){var t=[],n=1;while(n<e.length-2)Object(r["a"])(e.subarray(n,n+3),_)&&(t.push(n+2),n++),n++;if(0===t.length)return e;var i=e.length-t.length,s=new Uint8Array(i),a=0;for(n=0;n<i;a++,n++)a===t[0]&&(a++,t.shift()),s[n]=e[a];return s},S=function(e,t,n,i){void 0===i&&(i=1/0),e=Object(r["k"])(e),n=[].concat(n);var s,a=0,o=0;while(a<e.length&&(o<i||s)){var l=void 0;if(Object(r["a"])(e.subarray(a),y)?l=4:Object(r["a"])(e.subarray(a),b)&&(l=3),l){if(o++,s)return T(e.subarray(s,a));var u=void 0;"h264"===t?u=31&e[a+l]:"h265"===t&&(u=e[a+l]>>1&63),-1!==n.indexOf(u)&&(s=a+l),a+=l+("h264"===t?1:2)}else a++}return e.subarray(0,0)},w=function(e,t,n){return S(e,"h264",t,n)},E=function(e,t,n){return S(e,"h265",t,n)};n.d(t,"a",function(){return C}),n.d(t,"b",function(){return D});var x={webm:Object(r["k"])([119,101,98,109]),matroska:Object(r["k"])([109,97,116,114,111,115,107,97]),flac:Object(r["k"])([102,76,97,67]),ogg:Object(r["k"])([79,103,103,83]),ac3:Object(r["k"])([11,119]),riff:Object(r["k"])([82,73,70,70]),avi:Object(r["k"])([65,86,73]),wav:Object(r["k"])([87,65,86,69]),"3gp":Object(r["k"])([102,116,121,112,51,103]),mp4:Object(r["k"])([102,116,121,112]),fmp4:Object(r["k"])([115,116,121,112]),mov:Object(r["k"])([102,116,121,112,113,116]),moov:Object(r["k"])([109,111,111,118]),moof:Object(r["k"])([109,111,111,102])},k={aac:function(e){var t=Object(v["a"])(e);return Object(r["a"])(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=Object(v["a"])(e);return Object(r["a"])(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=m(e,[u.EBML,u.DocType])[0];return Object(r["a"])(t,x.webm)},mkv:function(e){var t=m(e,[u.EBML,u.DocType])[0];return Object(r["a"])(t,x.matroska)},mp4:function(e){return!k["3gp"](e)&&!k.mov(e)&&(!(!Object(r["a"])(e,x.mp4,{offset:4})&&!Object(r["a"])(e,x.fmp4,{offset:4}))||(!(!Object(r["a"])(e,x.moof,{offset:4})&&!Object(r["a"])(e,x.moov,{offset:4}))||void 0))},mov:function(e){return Object(r["a"])(e,x.mov,{offset:4})},"3gp":function(e){return Object(r["a"])(e,x["3gp"],{offset:4})},ac3:function(e){var t=Object(v["a"])(e);return Object(r["a"])(e,x.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return 71===e[0];var t=0;while(t+188<e.length&&t<188){if(71===e[t]&&71===e[t+188])return!0;t+=1}return!1},flac:function(e){var t=Object(v["a"])(e);return Object(r["a"])(e,x.flac,{offset:t})},ogg:function(e){return Object(r["a"])(e,x.ogg)},avi:function(e){return Object(r["a"])(e,x.riff)&&Object(r["a"])(e,x.avi,{offset:8})},wav:function(e){return Object(r["a"])(e,x.riff)&&Object(r["a"])(e,x.wav,{offset:8})},h264:function(e){return w(e,7,3).length},h265:function(e){return E(e,[32,33],3).length}},A=Object.keys(k).filter(function(e){return"ts"!==e&&"h264"!==e&&"h265"!==e}).concat(["ts","h264","h265"]);A.forEach(function(e){var t=k[e];k[e]=function(e){return t(Object(r["k"])(e))}});var I=k,C=function(e){e=Object(r["k"])(e);for(var t=0;t<A.length;t++){var n=A[t];if(I[n](e))return n}return""},D=function(e){return l(e,["moof"]).length>0}},f934:function(e,t,n){var i=n("6d8b"),r=n("9850"),s=n("3842"),a=s.parsePercent,o=n("eda2"),l=i.each,u=["left","right","top","bottom","width","height"],c=[["width","left","right"],["height","top","bottom"]];function d(e,t,n,i,r){var s=0,a=0;null==i&&(i=1/0),null==r&&(r=1/0);var o=0;t.eachChild(function(l,u){var c,d,h=l.position,f=l.getBoundingRect(),p=t.childAt(u+1),g=p&&p.getBoundingRect();if("horizontal"===e){var m=f.width+(g?-g.x+f.x:0);c=s+m,c>i||l.newline?(s=0,c=m,a+=o+n,o=f.height):o=Math.max(o,f.height)}else{var v=f.height+(g?-g.y+f.y:0);d=a+v,d>r||l.newline?(s+=o+n,a=0,d=v,o=f.width):o=Math.max(o,f.width)}l.newline||(h[0]=s,h[1]=a,"horizontal"===e?s=c+n:a=d+n)})}var h=d,f=i.curry(d,"vertical"),p=i.curry(d,"horizontal");function g(e,t,n){var i=t.width,r=t.height,s=a(e.x,i),l=a(e.y,r),u=a(e.x2,i),c=a(e.y2,r);return(isNaN(s)||isNaN(parseFloat(e.x)))&&(s=0),(isNaN(u)||isNaN(parseFloat(e.x2)))&&(u=i),(isNaN(l)||isNaN(parseFloat(e.y)))&&(l=0),(isNaN(c)||isNaN(parseFloat(e.y2)))&&(c=r),n=o.normalizeCssArray(n||0),{width:Math.max(u-s-n[1]-n[3],0),height:Math.max(c-l-n[0]-n[2],0)}}function m(e,t,n){n=o.normalizeCssArray(n||0);var i=t.width,s=t.height,l=a(e.left,i),u=a(e.top,s),c=a(e.right,i),d=a(e.bottom,s),h=a(e.width,i),f=a(e.height,s),p=n[2]+n[0],g=n[1]+n[3],m=e.aspect;switch(isNaN(h)&&(h=i-c-g-l),isNaN(f)&&(f=s-d-p-u),null!=m&&(isNaN(h)&&isNaN(f)&&(m>i/s?h=.8*i:f=.8*s),isNaN(h)&&(h=m*f),isNaN(f)&&(f=h/m)),isNaN(l)&&(l=i-c-h-g),isNaN(u)&&(u=s-d-f-p),e.left||e.right){case"center":l=i/2-h/2-n[3];break;case"right":l=i-h-g;break}switch(e.top||e.bottom){case"middle":case"center":u=s/2-f/2-n[0];break;case"bottom":u=s-f-p;break}l=l||0,u=u||0,isNaN(h)&&(h=i-g-l-(c||0)),isNaN(f)&&(f=s-p-u-(d||0));var v=new r(l+n[3],u+n[0],h,f);return v.margin=n,v}function v(e,t,n,s,a){var o=!a||!a.hv||a.hv[0],l=!a||!a.hv||a.hv[1],u=a&&a.boundingMode||"all";if(o||l){var c;if("raw"===u)c="group"===e.type?new r(0,0,+t.width||0,+t.height||0):e.getBoundingRect();else if(c=e.getBoundingRect(),e.needLocalTransform()){var d=e.getLocalTransform();c=c.clone(),c.applyTransform(d)}t=m(i.defaults({width:c.width,height:c.height},t),n,s);var h=e.position,f=o?t.x-c.x:0,p=l?t.y-c.y:0;e.attr("position","raw"===u?[f,p]:[h[0]+f,h[1]+p])}}function y(e,t){return null!=e[c[t][0]]||null!=e[c[t][1]]&&null!=e[c[t][2]]}function b(e,t,n){!i.isObject(n)&&(n={});var r=n.ignoreSize;!i.isArray(r)&&(r=[r,r]);var s=o(c[0],0),a=o(c[1],1);function o(n,i){var s={},a=0,o={},c=0,h=2;if(l(n,function(t){o[t]=e[t]}),l(n,function(e){u(t,e)&&(s[e]=o[e]=t[e]),d(s,e)&&a++,d(o,e)&&c++}),r[i])return d(t,n[1])?o[n[2]]=null:d(t,n[2])&&(o[n[1]]=null),o;if(c!==h&&a){if(a>=h)return s;for(var f=0;f<n.length;f++){var p=n[f];if(!u(s,p)&&u(e,p)){s[p]=e[p];break}}return s}return o}function u(e,t){return e.hasOwnProperty(t)}function d(e,t){return null!=e[t]&&"auto"!==e[t]}function h(e,t,n){l(e,function(e){t[e]=n[e]})}h(c[0],e,s),h(c[1],e,a)}function _(e){return T({},e)}function T(e,t){return t&&e&&l(u,function(n){t.hasOwnProperty(n)&&(e[n]=t[n])}),e}t.LOCATION_PARAMS=u,t.HV_NAMES=c,t.box=h,t.vbox=f,t.hbox=p,t.getAvailableSize=g,t.getLayoutRect=m,t.positionElement=v,t.sizeCalculable=y,t.mergeLayoutParam=b,t.getLayoutParams=_,t.copyLayoutParams=T},f97d:function(e,t){var n={"":!0,up:!0};function i(e){if("string"!==typeof e)return!1;var t=n[e.toLowerCase()];return!!t&&e.toLowerCase()}function r(e){return"number"===typeof e&&e>=0&&e<=100}function s(){var e=100,t=3,n=0,s=100,a=0,o=100,l="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!r(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return t},set:function(e){if("number"!==typeof e)throw new TypeError("Lines must be set to a number.");t=e}},regionAnchorY:{enumerable:!0,get:function(){return s},set:function(e){if(!r(e))throw new Error("RegionAnchorX must be between 0 and 100.");s=e}},regionAnchorX:{enumerable:!0,get:function(){return n},set:function(e){if(!r(e))throw new Error("RegionAnchorY must be between 0 and 100.");n=e}},viewportAnchorY:{enumerable:!0,get:function(){return o},set:function(e){if(!r(e))throw new Error("ViewportAnchorY must be between 0 and 100.");o=e}},viewportAnchorX:{enumerable:!0,get:function(){return a},set:function(e){if(!r(e))throw new Error("ViewportAnchorX must be between 0 and 100.");a=e}},scroll:{enumerable:!0,get:function(){return l},set:function(e){var t=i(e);!1===t?console.warn("Scroll: an invalid or illegal string was specified."):l=t}}})}e.exports=s},fab2:function(e,t,n){var i=n("7726").document;e.exports=i&&i.documentElement},fab22:function(e,t,n){var i=n("6d8b"),r=i.retrieve,s=i.defaults,a=i.extend,o=i.each,l=n("eda2"),u=n("2306"),c=n("4319"),d=n("3842"),h=d.isRadianAroundZero,f=d.remRadian,p=n("a15a"),g=p.createSymbol,m=n("1687"),v=n("401b"),y=v.applyTransform,b=Math.PI;function _(e){var t={componentType:e.mainType};return t[e.mainType+"Index"]=e.componentIndex,t}var T=function(e,t){this.opt=t,this.axisModel=e,s(t,{labelOffset:0,nameDirection:1,tickDirection:1,labelDirection:1,silent:!0}),this.group=new u.Group;var n=new u.Group({position:t.position.slice(),rotation:t.rotation});n.updateTransform(),this._transform=n.transform,this._dumbGroup=n};T.prototype={constructor:T,hasBuilder:function(e){return!!S[e]},add:function(e){S[e].call(this)},getGroup:function(){return this.group}};var S={axisLine:function(){var e=this.opt,t=this.axisModel;if(t.get("axisLine.show")){var n=this.axisModel.axis.getExtent(),i=this._transform,r=[n[0],0],s=[n[1],0];i&&(y(r,r,i),y(s,s,i));var l=a({lineCap:"round"},t.getModel("axisLine.lineStyle").getLineStyle());this.group.add(new u.Line(u.subPixelOptimizeLine({anid:"line",shape:{x1:r[0],y1:r[1],x2:s[0],y2:s[1]},style:l,strokeContainThreshold:e.strokeContainThreshold||5,silent:!0,z2:1})));var c=t.get("axisLine.symbol"),d=t.get("axisLine.symbolSize"),h=t.get("axisLine.symbolOffset")||0;if("number"===typeof h&&(h=[h,h]),null!=c){"string"===typeof c&&(c=[c,c]),"string"!==typeof d&&"number"!==typeof d||(d=[d,d]);var f=d[0],p=d[1];o([{rotate:e.rotation+Math.PI/2,offset:h[0],r:0},{rotate:e.rotation-Math.PI/2,offset:h[1],r:Math.sqrt((r[0]-s[0])*(r[0]-s[0])+(r[1]-s[1])*(r[1]-s[1]))}],function(t,n){if("none"!==c[n]&&null!=c[n]){var i=g(c[n],-f/2,-p/2,f,p,l.stroke,!0),s=t.r+t.offset,a=[r[0]+s*Math.cos(e.rotation),r[1]-s*Math.sin(e.rotation)];i.attr({rotation:t.rotate,position:a,silent:!0}),this.group.add(i)}},this)}}},axisTickLabel:function(){var e=this.axisModel,t=this.opt,n=D(this,e,t),i=R(this,e,t);k(e,i,n)},axisName:function(){var e=this.opt,t=this.axisModel,n=r(e.axisName,t.get("name"));if(n){var i,s,o=t.get("nameLocation"),c=e.nameDirection,d=t.getModel("nameTextStyle"),h=t.get("nameGap")||0,f=this.axisModel.axis.getExtent(),p=f[0]>f[1]?-1:1,g=["start"===o?f[0]-p*h:"end"===o?f[1]+p*h:(f[0]+f[1])/2,C(o)?e.labelOffset+c*h:0],m=t.get("nameRotate");null!=m&&(m=m*b/180),C(o)?i=w(e.rotation,null!=m?m:e.rotation,c):(i=E(e,o,m||0,f),s=e.axisNameAvailableWidth,null!=s&&(s=Math.abs(s/Math.sin(i.rotation)),!isFinite(s)&&(s=null)));var v=d.getFont(),y=t.get("nameTruncate",!0)||{},T=y.ellipsis,S=r(e.nameTruncateMaxWidth,y.maxWidth,s),k=null!=T&&null!=S?l.truncateText(n,S,v,T,{minChar:2,placeholder:y.placeholder}):n,A=t.get("tooltip",!0),I=t.mainType,D={componentType:I,name:n,$vars:["name"]};D[I+"Index"]=t.componentIndex;var R=new u.Text({anid:"name",__fullText:n,__truncatedText:k,position:g,rotation:i.rotation,silent:x(t),z2:1,tooltip:A&&A.show?a({content:n,formatter:function(){return n},formatterParams:D},A):null});u.setTextStyle(R.style,d,{text:k,textFont:v,textFill:d.getTextColor()||t.get("axisLine.lineStyle.color"),textAlign:i.textAlign,textVerticalAlign:i.textVerticalAlign}),t.get("triggerEvent")&&(R.eventData=_(t),R.eventData.targetType="axisName",R.eventData.name=n),this._dumbGroup.add(R),R.updateTransform(),this.group.add(R),R.decomposeTransform()}}},w=T.innerTextLayout=function(e,t,n){var i,r,s=f(t-e);return h(s)?(r=n>0?"top":"bottom",i="center"):h(s-b)?(r=n>0?"bottom":"top",i="center"):(r="middle",i=s>0&&s<b?n>0?"right":"left":n>0?"left":"right"),{rotation:s,textAlign:i,textVerticalAlign:r}};function E(e,t,n,i){var r,s,a=f(n-e.rotation),o=i[0]>i[1],l="start"===t&&!o||"start"!==t&&o;return h(a-b/2)?(s=l?"bottom":"top",r="center"):h(a-1.5*b)?(s=l?"top":"bottom",r="center"):(s="middle",r=a<1.5*b&&a>b/2?l?"left":"right":l?"right":"left"),{rotation:a,textAlign:r,textVerticalAlign:s}}function x(e){var t=e.get("tooltip");return e.get("silent")||!(e.get("triggerEvent")||t&&t.show)}function k(e,t,n){var i=e.get("axisLabel.showMinLabel"),r=e.get("axisLabel.showMaxLabel");t=t||[],n=n||[];var s=t[0],a=t[1],o=t[t.length-1],l=t[t.length-2],u=n[0],c=n[1],d=n[n.length-1],h=n[n.length-2];!1===i?(A(s),A(u)):I(s,a)&&(i?(A(a),A(c)):(A(s),A(u))),!1===r?(A(o),A(d)):I(l,o)&&(r?(A(l),A(h)):(A(o),A(d)))}function A(e){e&&(e.ignore=!0)}function I(e,t,n){var i=e&&e.getBoundingRect().clone(),r=t&&t.getBoundingRect().clone();if(i&&r){var s=m.identity([]);return m.rotate(s,s,-e.rotation),i.applyTransform(m.mul([],s,e.getLocalTransform())),r.applyTransform(m.mul([],s,t.getLocalTransform())),i.intersect(r)}}function C(e){return"middle"===e||"center"===e}function D(e,t,n){var i=t.axis;if(t.get("axisTick.show")&&!i.scale.isBlank()){for(var r=t.getModel("axisTick"),a=r.getModel("lineStyle"),o=r.get("length"),l=i.getTicksCoords(),c=[],d=[],h=e._transform,f=[],p=0;p<l.length;p++){var g=l[p].coord;c[0]=g,c[1]=0,d[0]=g,d[1]=n.tickDirection*o,h&&(y(c,c,h),y(d,d,h));var m=new u.Line(u.subPixelOptimizeLine({anid:"tick_"+l[p].tickValue,shape:{x1:c[0],y1:c[1],x2:d[0],y2:d[1]},style:s(a.getLineStyle(),{stroke:t.get("axisLine.lineStyle.color")}),z2:2,silent:!0}));e.group.add(m),f.push(m)}return f}}function R(e,t,n){var i=t.axis,s=r(n.axisLabelShow,t.get("axisLabel.show"));if(s&&!i.scale.isBlank()){var a=t.getModel("axisLabel"),l=a.get("margin"),d=i.getViewLabels(),h=(r(n.labelRotate,a.get("rotate"))||0)*b/180,f=w(n.rotation,h,n.labelDirection),p=t.getCategories(!0),g=[],m=x(t),v=t.get("triggerEvent");return o(d,function(r,s){var o=r.tickValue,d=r.formattedLabel,h=r.rawLabel,y=a;p&&p[o]&&p[o].textStyle&&(y=new c(p[o].textStyle,a,t.ecModel));var b=y.getTextColor()||t.get("axisLine.lineStyle.color"),T=i.dataToCoord(o),S=[T,n.labelOffset+n.labelDirection*l],w=new u.Text({anid:"label_"+o,position:S,rotation:f.rotation,silent:m,z2:10});u.setTextStyle(w.style,y,{text:d,textAlign:y.getShallow("align",!0)||f.textAlign,textVerticalAlign:y.getShallow("verticalAlign",!0)||y.getShallow("baseline",!0)||f.textVerticalAlign,textFill:"function"===typeof b?b("category"===i.type?h:"value"===i.type?o+"":o,s):b}),v&&(w.eventData=_(t),w.eventData.targetType="axisLabel",w.eventData.value=h),e._dumbGroup.add(w),w.updateTransform(),g.push(w),e.group.add(w),w.decomposeTransform()}),g}}var M=T;e.exports=M},fb05:function(e,t,n){var i=n("6d8b"),r=i.each,s=i.isArray,a=i.isObject,o=n("26e1"),l=n("e0d3"),u=l.normalizeToArray;function c(e,t){t=t.split(",");for(var n=e,i=0;i<t.length;i++)if(n=n&&n[t[i]],null==n)break;return n}function d(e,t,n,i){t=t.split(",");for(var r,s=e,a=0;a<t.length-1;a++)r=t[a],null==s[r]&&(s[r]={}),s=s[r];(i||null==s[t[a]])&&(s[t[a]]=n)}function h(e){r(f,function(t){t[0]in e&&!(t[1]in e)&&(e[t[1]]=e[t[0]])})}var f=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]],p=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"];function g(e,t){o(e,t),e.series=u(e.series),r(e.series,function(e){if(a(e)){var t=e.type;if("pie"!==t&&"gauge"!==t||null!=e.clockWise&&(e.clockwise=e.clockWise),"gauge"===t){var n=c(e,"pointer.color");null!=n&&d(e,"itemStyle.normal.color",n)}h(e)}}),e.dataRange&&(e.visualMap=e.dataRange),r(p,function(t){var n=e[t];n&&(s(n)||(n=[n]),r(n,function(e){h(e)}))})}e.exports=g},fc82:function(e,t,n){var i=n("4e08"),r=(i.__DEV__,n("6d8b")),s=n("1fab"),a=n("2306"),o=n("a4fe"),l=n("80f0"),u=r.curry,c=r.each,d=r.map,h=Math.min,f=Math.max,p=Math.pow,g=1e4,m=6,v=6,y="globalPan",b={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},_={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},T={brushStyle:{lineWidth:2,stroke:"rgba(0,0,0,0.3)",fill:"rgba(0,0,0,0.1)"},transformable:!0,brushMode:"single",removeOnClick:!1},S=0;function w(e){s.call(this),this._zr=e,this.group=new a.Group,this._brushType,this._brushOption,this._panels,this._track=[],this._dragging,this._covers=[],this._creatingCover,this._creatingPanel,this._enableGlobalPan,this._uid="brushController_"+S++,this._handlers={},c(ne,function(e,t){this._handlers[t]=r.bind(e,this)},this)}function E(e,t){var n=e._zr;e._enableGlobalPan||o.take(n,y,e._uid),c(e._handlers,function(e,t){n.on(t,e)}),e._brushType=t.brushType,e._brushOption=r.merge(r.clone(T),t,!0)}function x(e){var t=e._zr;o.release(t,y,e._uid),c(e._handlers,function(e,n){t.off(n,e)}),e._brushType=e._brushOption=null}function k(e,t){var n=re[t.brushType].createCover(e,t);return n.__brushOption=t,C(n,t),e.group.add(n),n}function A(e,t){var n=R(t);return n.endCreating&&(n.endCreating(e,t),C(t,t.__brushOption)),t}function I(e,t){var n=t.__brushOption;R(t).updateCoverShape(e,t,n.range,n)}function C(e,t){var n=t.z;null==n&&(n=g),e.traverse(function(e){e.z=n,e.z2=n})}function D(e,t){R(t).updateCommon(e,t),I(e,t)}function R(e){return re[e.__brushOption.brushType]}function M(e,t,n){var i,r=e._panels;if(!r)return!0;var s=e._transform;return c(r,function(e){e.isTargetByCursor(t,n,s)&&(i=e)}),i}function L(e,t){var n=e._panels;if(!n)return!0;var i=t.__brushOption.panelId;return null==i||n[i]}function P(e){var t=e._covers,n=t.length;return c(t,function(t){e.group.remove(t)},e),t.length=0,!!n}function O(e,t){var n=d(e._covers,function(e){var t=e.__brushOption,n=r.clone(t.range);return{brushType:t.brushType,panelId:t.panelId,range:n}});e.trigger("brush",n,{isEnd:!!t.isEnd,removeOnClick:!!t.removeOnClick})}function N(e){var t=e._track;if(!t.length)return!1;var n=t[t.length-1],i=t[0],r=n[0]-i[0],s=n[1]-i[1],a=p(r*r+s*s,.5);return a>m}function U(e){var t=e.length-1;return t<0&&(t=0),[e[0],e[t]]}function F(e,t,n,i){var r=new a.Group;return r.add(new a.Rect({name:"main",style:H(n),silent:!0,draggable:!0,cursor:"move",drift:u(e,t,r,"nswe"),ondragend:u(O,t,{isEnd:!0})})),c(i,function(n){r.add(new a.Rect({name:n,style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:u(e,t,r,n),ondragend:u(O,t,{isEnd:!0})}))}),r}function B(e,t,n,i){var r=i.brushStyle.lineWidth||0,s=f(r,v),a=n[0][0],o=n[1][0],l=a-r/2,u=o-r/2,c=n[0][1],d=n[1][1],h=c-s+r/2,p=d-s+r/2,g=c-a,m=d-o,y=g+r,b=m+r;V(e,t,"main",a,o,g,m),i.transformable&&(V(e,t,"w",l,u,s,b),V(e,t,"e",h,u,s,b),V(e,t,"n",l,u,y,s),V(e,t,"s",l,p,y,s),V(e,t,"nw",l,u,s,s),V(e,t,"ne",h,u,s,s),V(e,t,"sw",l,p,s,s),V(e,t,"se",h,p,s,s))}function j(e,t){var n=t.__brushOption,i=n.transformable,r=t.childAt(0);r.useStyle(H(n)),r.attr({silent:!i,cursor:i?"move":"default"}),c(["w","e","n","s","se","sw","ne","nw"],function(n){var r=t.childOfName(n),s=z(e,n);r&&r.attr({silent:!i,invisible:!i,cursor:i?_[s]+"-resize":null})})}function V(e,t,n,i,r,s,a){var o=t.childOfName(n);o&&o.setShape(X(Y(e,t,[[i,r],[i+s,r+a]])))}function H(e){return r.defaults({strokeNoScale:!0},e.brushStyle)}function $(e,t,n,i){var r=[h(e,n),h(t,i)],s=[f(e,n),f(t,i)];return[[r[0],s[0]],[r[1],s[1]]]}function G(e){return a.getTransform(e.group)}function z(e,t){if(t.length>1){t=t.split("");var n=[z(e,t[0]),z(e,t[1])];return("e"===n[0]||"w"===n[0])&&n.reverse(),n.join("")}var i={w:"left",e:"right",n:"top",s:"bottom"},r={left:"w",right:"e",top:"n",bottom:"s"};n=a.transformDirection(i[t],G(e));return r[n]}function q(e,t,n,i,r,s,a,o){var l=i.__brushOption,u=e(l.range),d=K(n,s,a);c(r.split(""),function(e){var t=b[e];u[t[0]][t[1]]+=d[t[0]]}),l.range=t($(u[0][0],u[1][0],u[0][1],u[1][1])),D(n,i),O(n,{isEnd:!1})}function W(e,t,n,i,r){var s=t.__brushOption.range,a=K(e,n,i);c(s,function(e){e[0]+=a[0],e[1]+=a[1]}),D(e,t),O(e,{isEnd:!1})}function K(e,t,n){var i=e.group,r=i.transformCoordToLocal(t,n),s=i.transformCoordToLocal(0,0);return[r[0]-s[0],r[1]-s[1]]}function Y(e,t,n){var i=L(e,t);return i&&!0!==i?i.clipPath(n,e._transform):r.clone(n)}function X(e){var t=h(e[0][0],e[1][0]),n=h(e[0][1],e[1][1]),i=f(e[0][0],e[1][0]),r=f(e[0][1],e[1][1]);return{x:t,y:n,width:i-t,height:r-n}}function Q(e,t,n){if(e._brushType){var i=e._zr,r=e._covers,s=M(e,t,n);if(!e._dragging)for(var a=0;a<r.length;a++){var o=r[a].__brushOption;if(s&&(!0===s||o.panelId===s.panelId)&&re[o.brushType].contain(r[a],n[0],n[1]))return}s&&i.setCursorStyle("crosshair")}}function Z(e){var t=e.event;t.preventDefault&&t.preventDefault()}function J(e,t,n){return e.childOfName("main").contain(t,n)}function ee(e,t,n,i){var s,a=e._creatingCover,o=e._creatingPanel,l=e._brushOption;if(e._track.push(n.slice()),N(e)||a){if(o&&!a){"single"===l.brushMode&&P(e);var u=r.clone(l);u.brushType=te(u.brushType,o),u.panelId=!0===o?null:o.panelId,a=e._creatingCover=k(e,u),e._covers.push(a)}if(a){var c=re[te(e._brushType,o)],d=a.__brushOption;d.range=c.getCreatingRange(Y(e,a,e._track)),i&&(A(e,a),c.updateCommon(e,a)),I(e,a),s={isEnd:i}}}else i&&"single"===l.brushMode&&l.removeOnClick&&M(e,t,n)&&P(e)&&(s={isEnd:i,removeOnClick:!0});return s}function te(e,t){return"auto"===e?t.defaultBrushType:e}w.prototype={constructor:w,enableBrush:function(e){return this._brushType&&x(this),e.brushType&&E(this,e),this},setPanels:function(e){if(e&&e.length){var t=this._panels={};r.each(e,function(e){t[e.panelId]=r.clone(e)})}else this._panels=null;return this},mount:function(e){e=e||{},this._enableGlobalPan=e.enableGlobalPan;var t=this.group;return this._zr.add(t),t.attr({position:e.position||[0,0],rotation:e.rotation||0,scale:e.scale||[1,1]}),this._transform=t.getLocalTransform(),this},eachCover:function(e,t){c(this._covers,e,t)},updateCovers:function(e){e=r.map(e,function(e){return r.merge(r.clone(T),e,!0)});var t="\0-brush-index-",n=this._covers,i=this._covers=[],s=this,a=this._creatingCover;return new l(n,e,u,o).add(c).update(c).remove(d).execute(),this;function o(e,n){return(null!=e.id?e.id:t+n)+"-"+e.brushType}function u(e,t){return o(e.__brushOption,t)}function c(t,r){var o=e[t];if(null!=r&&n[r]===a)i[t]=n[r];else{var l=i[t]=null!=r?(n[r].__brushOption=o,n[r]):A(s,k(s,o));D(s,l)}}function d(e){n[e]!==a&&s.group.remove(n[e])}},unmount:function(){return this.enableBrush(!1),P(this),this._zr.remove(this.group),this},dispose:function(){this.unmount(),this.off()}},r.mixin(w,s);var ne={mousedown:function(e){if(this._dragging)ie.call(this,e);else if(!e.target||!e.target.draggable){Z(e);var t=this.group.transformCoordToLocal(e.offsetX,e.offsetY);this._creatingCover=null;var n=this._creatingPanel=M(this,e,t);n&&(this._dragging=!0,this._track=[t.slice()])}},mousemove:function(e){var t=this.group.transformCoordToLocal(e.offsetX,e.offsetY);if(Q(this,e,t),this._dragging){Z(e);var n=ee(this,e,t,!1);n&&O(this,n)}},mouseup:ie};function ie(e){if(this._dragging){Z(e);var t=this.group.transformCoordToLocal(e.offsetX,e.offsetY),n=ee(this,e,t,!0);this._dragging=!1,this._track=[],this._creatingCover=null,n&&O(this,n)}}var re={lineX:se(0),lineY:se(1),rect:{createCover:function(e,t){return F(u(q,function(e){return e},function(e){return e}),e,t,["w","e","n","s","se","sw","ne","nw"])},getCreatingRange:function(e){var t=U(e);return $(t[1][0],t[1][1],t[0][0],t[0][1])},updateCoverShape:function(e,t,n,i){B(e,t,n,i)},updateCommon:j,contain:J},polygon:{createCover:function(e,t){var n=new a.Group;return n.add(new a.Polyline({name:"main",style:H(t),silent:!0})),n},getCreatingRange:function(e){return e},endCreating:function(e,t){t.remove(t.childAt(0)),t.add(new a.Polygon({name:"main",draggable:!0,drift:u(W,e,t),ondragend:u(O,e,{isEnd:!0})}))},updateCoverShape:function(e,t,n,i){t.childAt(0).setShape({points:Y(e,t,n)})},updateCommon:j,contain:J}};function se(e){return{createCover:function(t,n){return F(u(q,function(t){var n=[t,[0,100]];return e&&n.reverse(),n},function(t){return t[e]}),t,n,[["w","e"],["n","s"]][e])},getCreatingRange:function(t){var n=U(t),i=h(n[0][e],n[1][e]),r=f(n[0][e],n[1][e]);return[i,r]},updateCoverShape:function(t,n,i,r){var s,a=L(t,n);if(!0!==a&&a.getLinearBrushOtherExtent)s=a.getLinearBrushOtherExtent(e,t._transform);else{var o=t._zr;s=[0,[o.getWidth(),o.getHeight()][1-e]]}var l=[i,s];e&&l.reverse(),B(t,n,l,r)},updateCommon:j,contain:J}}var ae=w;e.exports=ae},fd63:function(e,t,n){var i=n("42e5"),r={createOnAllSeries:!0,performRawSeries:!0,reset:function(e,t){var n=e.getData(),r=(e.visualColorAccessPath||"itemStyle.color").split("."),s=e.get(r)||e.getColorFromPalette(e.name,null,t.getSeriesCount());if(n.setVisual("color",s),!t.isSeriesFiltered(e)){"function"!==typeof s||s instanceof i||n.each(function(t){n.setItemVisual(t,"color",s(e.getDataParams(t)))});var a=function(e,t){var n=e.getItemModel(t),i=n.get(r,!0);null!=i&&e.setItemVisual(t,"color",i)};return{dataEach:n.hasItemOption?a:null}}}};e.exports=r},fdde:function(e,t){var n={average:function(e){for(var t=0,n=0,i=0;i<e.length;i++)isNaN(e[i])||(t+=e[i],n++);return 0===n?NaN:t/n},sum:function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n]||0;return t},max:function(e){for(var t=-1/0,n=0;n<e.length;n++)e[n]>t&&(t=e[n]);return isFinite(t)?t:NaN},min:function(e){for(var t=1/0,n=0;n<e.length;n++)e[n]<t&&(t=e[n]);return isFinite(t)?t:NaN},nearest:function(e){return e[0]}},i=function(e,t){return Math.round(e.length/2)};function r(e){return{seriesType:e,modifyOutputEnd:!0,reset:function(e,t,r){var s=e.getData(),a=e.get("sampling"),o=e.coordinateSystem;if("cartesian2d"===o.type&&a){var l,u=o.getBaseAxis(),c=o.getOtherAxis(u),d=u.getExtent(),h=d[1]-d[0],f=Math.round(s.count()/h);if(f>1)"string"===typeof a?l=n[a]:"function"===typeof a&&(l=a),l&&e.setData(s.downSample(s.mapDimension(c.dim),1/f,l,i))}}}}e.exports=r},fdef:function(e,t){e.exports="\t\n\v\f\r \u2028\u2029\ufeff"},fe21:function(e,t,n){var i=n("e86a"),r=n("2306"),s=["textStyle","color"],a={getTextColor:function(e){var t=this.ecModel;return this.getShallow("color")||(!e&&t?t.get(s):null)},getFont:function(){return r.getFont({fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},this.ecModel)},getTextRect:function(e){return i.getBoundingRect(e,this.getFont(),this.getShallow("align"),this.getShallow("verticalAlign")||this.getShallow("baseline"),this.getShallow("padding"),this.getShallow("rich"),this.getShallow("truncateText"))}};e.exports=a},ff2e:function(e,t,n){var i=n("6d8b"),r=n("2306"),s=n("e86a"),a=n("eda2"),o=n("1687"),l=n("697e"),u=n("fab22");function c(e){var t,n=e.get("type"),i=e.getModel(n+"Style");return"line"===n?(t=i.getLineStyle(),t.fill=null):"shadow"===n&&(t=i.getAreaStyle(),t.stroke=null),t}function d(e,t,n,i,r){var o=n.get("value"),l=f(o,t.axis,t.ecModel,n.get("seriesDataIndices"),{precision:n.get("label.precision"),formatter:n.get("label.formatter")}),u=n.getModel("label"),c=a.normalizeCssArray(u.get("padding")||0),d=u.getFont(),p=s.getBoundingRect(l,d),g=r.position,m=p.width+c[1]+c[3],v=p.height+c[0]+c[2],y=r.align;"right"===y&&(g[0]-=m),"center"===y&&(g[0]-=m/2);var b=r.verticalAlign;"bottom"===b&&(g[1]-=v),"middle"===b&&(g[1]-=v/2),h(g,m,v,i);var _=u.get("backgroundColor");_&&"auto"!==_||(_=t.get("axisLine.lineStyle.color")),e.label={shape:{x:0,y:0,width:m,height:v,r:u.get("borderRadius")},position:g.slice(),style:{text:l,textFont:d,textFill:u.getTextColor(),textPosition:"inside",fill:_,stroke:u.get("borderColor")||"transparent",lineWidth:u.get("borderWidth")||0,shadowBlur:u.get("shadowBlur"),shadowColor:u.get("shadowColor"),shadowOffsetX:u.get("shadowOffsetX"),shadowOffsetY:u.get("shadowOffsetY")},z2:10}}function h(e,t,n,i){var r=i.getWidth(),s=i.getHeight();e[0]=Math.min(e[0]+t,r)-t,e[1]=Math.min(e[1]+n,s)-n,e[0]=Math.max(e[0],0),e[1]=Math.max(e[1],0)}function f(e,t,n,r,s){e=t.scale.parse(e);var a=t.scale.getLabel(e,{precision:s.precision}),o=s.formatter;if(o){var u={value:l.getAxisRawValue(t,e),seriesData:[]};i.each(r,function(e){var t=n.getSeriesByIndex(e.seriesIndex),i=e.dataIndexInside,r=t&&t.getDataParams(i);r&&u.seriesData.push(r)}),i.isString(o)?a=o.replace("{value}",a):i.isFunction(o)&&(a=o(u))}return a}function p(e,t,n){var i=o.create();return o.rotate(i,i,n.rotation),o.translate(i,i,n.position),r.applyTransform([e.dataToCoord(t),(n.labelOffset||0)+(n.labelDirection||1)*(n.labelMargin||0)],i)}function g(e,t,n,i,r,s){var a=u.innerTextLayout(n.rotation,0,n.labelDirection);n.labelMargin=r.get("label.margin"),d(t,i,r,s,{position:p(i.axis,e,n),align:a.textAlign,verticalAlign:a.textVerticalAlign})}function m(e,t,n){return n=n||0,{x1:e[n],y1:e[1-n],x2:t[n],y2:t[1-n]}}function v(e,t,n){return n=n||0,{x:e[n],y:e[1-n],width:t[n],height:t[1-n]}}function y(e,t,n,i,r,s){return{cx:e,cy:t,r0:n,r:i,startAngle:r,endAngle:s,clockwise:!0}}t.buildElStyle=c,t.buildLabelElOption=d,t.getValueLabel=f,t.getTransformedPosition=p,t.buildCartesianSingleLabelElOption=g,t.makeLineShape=m,t.makeRectShape=v,t.makeSectorShape=y},ffdf:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return a});var i=n("be09"),r=n.n(i),s=function(t){return r.a.atob?r.a.atob(t):e.from(t,"base64").toString("binary")};function a(e){for(var t=s(e),n=new Uint8Array(t.length),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}}).call(this,n("b639").Buffer)}}]);
//# sourceMappingURL=chunk-vendors.836e8f0e.js.map